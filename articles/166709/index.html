<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>[Translation] Introduction to CocosBuilder</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Translation of the article Introduction to CocosBuilder . 
 The author of the original article, Ali Khafiji , a developer for iOS and Android. 

 Coco...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>[Translation] Introduction to CocosBuilder</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/a9a/8bc/700/a9a8bc700d28d9bf4d44626c127cca53.png"><br><br>  Translation of the article <a href="http://www.raywenderlich.com/23996/introduction-to-cocosbuilder">Introduction to CocosBuilder</a> . <br>  The author of the original article, <a href="http://www.raywenderlich.com/about">Ali Khafiji</a> , a developer for iOS and Android. <br><br>  CocosBuilder is a free tool that allows you to quickly and easily manage sprites, layouts and scenes when developing your game using Cocos2D. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      CocosBuilder is ideal for quick planning of menus and other interface elements of game scenes, while you will not have problems with their layout in space. <br>  During the training, you write the game Cat Jump.  You will see how CocosBuilder will save you a lot of time and code. <br><a name="habracut"></a><br>  Before CocosBuilder appeared, creating even the basic interface in a Cocos2D game was a headache for the developer.  To add a menu or button to a game, you usually did something like this: <br><ul><li>  Attempt to guess.  ‚ÄúMmm ... I think this button should be around 50 to 50.‚Äù </li><li>  Application launch.  ‚ÄúYeah, not really ...‚Äù </li><li>  Another attempt.  ‚ÄúI think 60 to 50 will be better!‚Äù </li><li>  Check and everything is new.  ‚ÄúDamn, it's still not that.  Grrr! ‚Äù </li></ul><br>  CocosBuilder eliminates how all the mass iterations on setting up and testing the position of the sprite.  CocosBuilder frees up time for you to focus on the logic of the game, rather than tearing your hair out, punching through your interface, which makes you a more productive developer - and that‚Äôs always good, isn't it? <br><br>  This beginner's guide will show you how to use CocosBuilder to create simple interfaces.  In CocosBuilder, you will learn how to create menus, buttons, particle systems, layers, and connect interfaces. <br>  During the training, you will write a Cat Jump game, originally developed for the <a href="http://www.raywenderlich.com/3411/june-cocos2d-via-minigames">Cocos2D via Minigames seminar</a> .  Of course, this time there will be much less coding.  You will see how CocosBuilder will save you a lot of time and code. <br>  This guide assumes that you have a basic knowledge of Cocos2D.  If you are new to Cocos2D, read <a href="http://www.raywenderlich.com/tutorials">Cocos2D</a> first. <br><br><h1>  Cat Jump Game </h1><br>  Cat Jump is a game about a cat that has a bad day.  He just walks about his business, walks down the street when suddenly everything stumbles across it - cars, trucks, and even children on bicycles! <br>  The screen shot of the game you saw at the beginning of this guide. <br><br>  Your poor cat has a limited number of lives (of course 9), and your goal is to stay alive as long as possible while avoiding trouble. <br>  To get started, download the <a href="">CatJump</a> version <a href="">without CocosBuilder</a> .  Open it in Xcode, run it and play for a while - it's a lot of fun! <br>  After you play, take a look at the code - you will see tons, set right in the code, the offsets and positions of the menu, text elements and sprites.  It was very hard to write all this - you will learn about the way to make it better! <br>  During training, you remake the Cat Jump game by completing the following tasks: <br><ul><li>  <b>Redo the main menu using CocosBuilder.</b>  Now the main menu is done by placing the menu items in hard-coded coordinates - you delete this code and redo the menu using CocosBuilder. </li><li>  <b>Add screen options.</b>  You will add a new screen with three buttons for choosing the difficulty level: Easy, Medium and Hard.  The choice of the complexity option will cause a selector in the program code. </li><li>  <b>Add an About screen.</b>  You will also add a screen with a description of the program and a demonstration of a cool graphic effect.  Using CocosBuilder, you do not write a single line of code to do it! </li><li>  <b>Redo the main game screen using CocosBuilder.</b>  You remove the manual placement of the sprites and use CocosBuilder instead. </li><li>  <b>Redo the end game screen using CocosBuilder.</b>  Again, no hard-coded offsets! </li></ul><br>  Finally, you will get helpful tips on how to find and fix common errors in CocosBuilder.  You will learn about it now and save your time later. <br><br><h1>  Getting Started with CocosBuilder </h1><br>  If you have not done so already, <a href="http://cocosbuilder.com/">download CocosBuilder</a> .  Make sure to download the latest version, which at the time of this writing is 2.1.  Also download sample files. <br><img src="https://habrastorage.org/storage2/d13/275/56a/d1327556a261ac847b172fbae9698124.png"><br><br>  Unpack CocosBuilder from the downloaded archive and copy it into the Programs folder. <br>  Before you create a new project in CocosBuilder, you must create a directory for your project.  This is the place where you will store all game resources / assets. <br><br><blockquote>  <b>Note</b> : You can also use resource references in your project, but using the directory structure with the resources stored there is more convenient, as this allows me to know exactly where all my files and helps to keep my resources organized. <br></blockquote><br>  Create a new folder on your desktop and name it <b>CocosBuilderFiles</b> .  Then create two subfolders in this folder and name them <b>Resources</b> and <b>Scenes</b> . <br><img src="https://habrastorage.org/storage2/5d2/e70/e67/5d2e70e67f10ecb1c55d6e5c035c8935.png"><br><br>  The Resources folder will obviously contain all the resources for the game (sprites, fonts, etc.).  If you want, you can copy all the resources from the Cat Jump project that you downloaded earlier, but to make it even easier, I created a <a href="">ZIP file</a> with everything you need.  Download, unpack and copy its contents into the Resources folder. <br><br>  Launch CocosBuilder and select the File \ New \ New Project menu item.  Name the project CatJump and save it in the CocosBuilderFiles folder. <br>  Now that you have created the project, you will see the resource folders and scenes in the project sidebar on the left side of CocosBuilder.  Also note that CocosBuilder automatically created a new folder called <b>ccbResources</b> .  In the same place you will see a new file with the name <b>HelloCocosBuilder.ccb</b> .  Double click on the file to see its contents. <br>  This is a very simple layer labeled ‚ÄúHello CocosBuilder‚Äù: <br><img src="https://habrastorage.org/storage2/8cf/5be/41b/8cf5be41b2bb725730e0b92f7e2e021c.png"><br><br>  Don't worry, your CatJump game will be a bit more complicated than that. <br><br><h1>  Look, mom, there's no code at all! </h1><br>  Let's start the remake of CatJump by creating the main menu of the game.  This scene will have three buttons: <br><ul><li>  <b>Play</b> - So the game starts! </li><li> <b>Options</b> - Show the scene with the parameters where users can choose the level of difficulty of the game. </li><li>  <b>About</b> - Show the scene where there will be information about how to play the game. </li></ul><br>  And the first thing you need to do is delete the HelloCocosBuilder.ccb file, since this is just a template file created by CocosBuilder. <br><br><blockquote>  <b>Note:</b> You might think that it is simple enough to remove an unused scene file from the project, but I was not able to do it directly from CocosBuilder.  I had to close CocosBuilder, remove HelloCocosBuilder.ccb from Finder, and then run the project in CocosBuilder again.  If someone knows an easier way to do this, please post on the forum! <br></blockquote><br>  Then select the menu item File \ New \ New File.  In the window that appears, make sure that CCLayer is selected in the Root object type field and tick the following permission types: <b>iPhone Landscape</b> and <b>iPhone 5 Landscape</b> . <br><img src="https://habrastorage.org/storage2/4c3/8cd/6b4/4c38cd6b4c61bd0c1e01e379dc4243ae.png"><br><br>  Click the Create button, enter the file name <b>MainMenuScene</b> and save it in the Scenes folder. <br>  The project panel should look something like this: <br><img src="https://habrastorage.org/storage2/49c/a09/45b/49ca0945b93379fe521085a377ccfe9e.png"><br><br>  Well, you created your first scene!  Now, how about adding multiple sprites? <br>  Click on the CCSprite button on the toolbar.  Hint: The button is circled in the image below. <br><img src="https://habrastorage.org/storage2/a26/0fb/e6d/a260fbe6dd2f4e739aa61592f60a5503.png"><br><br>  So you add a new sprite to the scene. <br>  Select the created sprite and set it as a frame for the file <b>Title_catjump.png</b> .  To do this, use the right sidebar on which the properties of the selected item appear.  In the CCSprite section of the <b>Sprite frame</b> field, in the drop-down menu, select the file <b>Title_catjump.png</b> in the Resources \ Normal folder. <br><img src="https://habrastorage.org/storage2/3d0/92b/08f/3d092b08f7d112d249a5f7bbd761e7ed.png"><br><br>  Then, put the sprite in the center of the scene, simply dragging it to the center.  Or, if you prefer to be precise, then you can set the <b>Anchor Point</b> property (in the CCNode section) to 0 for the X and Y values. <br>  Please note that this will only work if your <b>Position</b> field is set to the value of the lower left corner.  If you change the value of this field, then you must change the values ‚Äã‚Äãof X and Y accordingly. Have fun - see what happens when you put different values. <br><br>  Fine!  You now have a background image.  The next thing to do is add buttons for menu items. <br>  Click the <b>CCControlButton</b> toolbar to create a new button on the screen. <br><img src="https://habrastorage.org/storage2/b6e/5f3/8a4/b6e5f38a4fb584d0165fc7f162131e6f.png"><br><br>  A new button is created with a nice background image that you can find in the <b>ccbResources</b> folder created by CocosBuilder.  Give this button a Play name using the CCControlButton section on the right sidebar, the Title field. <br><img src="https://habrastorage.org/storage2/f56/99d/ab7/f5699dab775407b08f999d1c1c182fce.png"><br><br>  Adjust the position of the button.  You can place it anywhere just by dragging it or set an absolute position using the properties on the right side panel. <br>  Okay, we need more buttons!  Repeat the above procedure to add two more.  Name the second button Options, third - About.  Your final layout should look like the one shown in the image below: <br><img src="https://habrastorage.org/storage2/405/c9a/ce0/405c9ace0a6289054ec66ceb9dbc5d92.png"><br><br>  Hurray, the layout of the first scene is complete! <br><br><h1>  Connect layer to class </h1><br>  Before proceeding, you need to make some adjustments.  If you create a scene using a layer created in CocosBuilder, and if this layer is a scene of a custom class, then you should say CocosBuilder the name of this class. <br>  For example, if you initialize a scene using the <b>MainMenuScene</b> file and you want its layer to be the class you created, then you need to specify the name of this class in the <b>Code Connections</b> section. <br>  Select the <b>MainMenuScene.ccb</b> file and select the CCLayer root node on the timeline. <br>  In the <b>Code Connections</b> section, in the <b>Custom class</b> field, write the name of your <b>MainMenuLayer</b> class.  Now, when you initialize this scene, CocosBuilder will look for a class named MainMenuLayer and use it to create an instance of the scene layer. <br><img src="https://habrastorage.org/storage2/a89/1c9/ce5/a891c9ce5ca70cfe8421cedea0846cc9.png"><br><br>  Next you need to publish the CocosBuilder interface file.  To do this, simply select the menu item File \ Publish.  This will create a new file named <b>MainMenuScene.ccbi</b> in the Scenes directory. <br>  Stop messing with CocosBuilder - now is the time to try it all out in Xcode! <br><br><h1>  Time to write code! </h1><br>  First, make sure you have the latest version of Cocos2D 2.X installed (2.1-beta4 at the time of writing this tutorial). <br>  Then launch Xcode and create a new project with the iOS \ cocos2d v2.x \ cocos2d template.  Enter CatJump in the <b>Product Name</b> field, fill in the <b>Company Identifier</b> field as usual, and select iPhone in the <b>Device Family</b> field: <br><img src="https://habrastorage.org/storage2/224/59e/25e/22459e25e91fc9f684207dcc028577e1.png"><br><br>  Complete the project creation and save it somewhere on your disk. <br>  Then, at the root of the project, create a new group Scenes, and drag the file <b>MainMenuScene.ccb</b> that you made before.  Make sure that there is a tick next to the ‚ÄúCopy items to destination group's folder (if needed)‚Äù item and a tick box next to CatJump in the ‚ÄúAdd to targets‚Äù section. <br><br>  Now you need to add a CCBReader to your project.  CCBReader comes with sample files that you downloaded earlier from CocosBuilder.  Unzip the sample files (if you haven‚Äôt already done this) to a folder on your hard drive.  Find the CCBReader folder in the <b>Add to Your Project \ cocos2d-iphone</b> folder. <br>  Drag the entire CCBReader folder into your project.  Make sure that the ‚ÄúCreate groups for any added folders‚Äù option is selected and that the ‚ÄúCopy items into destination group's folder‚Äù option is checked.  Do the same with the CCControlExtension folder. <br>  Next, create a new group in your project and name it <b>Layers</b> .  Create a new file with the template iOS \ cocos2d v2.x \ CCNode.  Subclass it to CCLayer and name it <b>MainMenuLayer.m</b> . <br>  Before writing code, open <b>AppDelegate.m</b> and add the following import statement (immediately after the #import statements in the file): <br><br><pre><code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CCBReader.h"</span></span></span></span></code> </pre> <br>  Then find the <b>application: didFinishLaunchingWithOptions:</b> procedure, and in it the following line: <br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">director_ pushScene: [IntroLayer scene</span></span>]];</code> </pre><br>  Once you find it, replace it with this: <br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">director_ pushScene: [CCBReader sceneWithNodeGraphFromFile:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"MainMenuScene.ccbi"</span></span></span></span>]];</code> </pre><br>  And that's all you need to do in the code, in order to run scenes created with CocosBuilder!  The CCBReader class will parse the MainMenuScene.ccbi file and create the scene itself! <br>  But before you start the program, you need to take one last step.  Remember that background image that you added to your scene and images of buttons from the ccbResources folder in your CocosBuilder project folder? <br>  These images are not in the project, and we need them in order for the program to work normally.  Otherwise, the application will cause an error.  (Actually, you can check it right now by trying to start the program ...) <br>  Take all the files from your CocosBuilder project's resources folder and drag them into your Xcode project's resources folder.  Do the same with all files in the ccbResources folder.  As before, make sure that there is a check mark next to the item ‚ÄúCopy items into destination group's folder‚Äù, that the option ‚ÄúCreate groups for any added folders‚Äù is selected and that there is a check mark next to our CatJump project. <br><img src="https://habrastorage.org/storage2/081/cf0/9fc/081cf09fce0a74fc9b98799621544da8.png"><br><br>  Now run the program.  If you received an error message while compiling CCBReader.m, replace the line with the error with the following: <br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [_bundle pathForResource:resource ofType:ext inDirectory:subpath];</code> </pre><br>  Run the program, you will see the main menu with three buttons, as shown below: <br><img src="https://habrastorage.org/storage2/351/432/105/3514321050b3403b544db0333ebec354.png"><br><br><h1>  Developments </h1><br>  Congratulations, you now have a working layout created in CocosBuilder, with just one line of code!  :) <br>  But how to get the event that the user clicked on one of these buttons? <br>  CocosBuilder to cope with this task is very simple!  It allows you to specify the name of the method to be called if the user clicks the button.  You can also specify an event for which this method will be triggered (using a set of parameters). <br>  Let's add this functionality to MainMenuScene.  Open <b>MainMenuScene.ccb</b> in CocosBuilder and select the Play button.  In the right pane, in the CCNode section, change the Tag property to 1. <br>  Then, in the CCControl section, fill in the <b>Selector</b> text box with the name of the <b>buttonPressed:</b> method to be called.  Also ensure that the <b>Target</b> field contains the <b>Document root</b> value. <br><img src="https://habrastorage.org/storage2/956/569/b7f/956569b7f9ef217416ab150b815abd15.png"><br><br>  Do the same for the other two buttons, but with different tags - for Options - the Tag field will be 2, for About - 3. <br>  Amazing  You linked button presses to the selector provided in CCLayer.  Save the changes, publish MainMenuScene.ccb, and copy the published file into the Xcode project folder. <br><br><blockquote>  <b>Note</b> : You do not need to drag the file to the Xcode project as before, since the file already exists in the project.  So either delete the file from the project and then drag it back into the project, or copy the new file from the CocosBuilderFiles folder to the folder with the files of your Xcode project using Finder. <br></blockquote><br>  Now open MainMenuLayer.m in Xcode and add the following import statements there: <br><pre> <code class="hljs scala">#<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"CCControlButton.h"</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"CCBReader.h"</span></span></code> </pre><br>  In addition, add the following #define operators with constants immediately below the #import operators.  They describe the tags of the buttons that you put on the scene: <br><pre> <code class="hljs cs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PLAY_BUTTON_TAG 1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> OPTIONS_BUTTON_TAG 2 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ABOUT_BUTTON_TAG 3</span></span></code> </pre><br>  How about the <b>buttonPressed:</b> method?  Add it to MainMenuLayer.m: <br><pre> <code class="hljs lua">-(void)buttonPressed:(id)sender { CCControlButton *button = (CCControlButton*) sender; switch (button.tag) { case PLAY_BUTTON_TAG: <span class="hljs-string"><span class="hljs-string">[[CCDirector sharedDirector] replaceScene:[CCTransitionCrossFade transitionWithDuration:1.0 scene:[CCBReader sceneWithNodeGraphFromFile:@"GameScene.ccbi"]]</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case OPTIONS_BUTTON_TAG: <span class="hljs-string"><span class="hljs-string">[[CCDirector sharedDirector] replaceScene:[CCTransitionFlipAngular transitionWithDuration:1.0 scene:[CCBReader sceneWithNodeGraphFromFile:@"OptionsScene.ccbi"]]</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case ABOUT_BUTTON_TAG: <span class="hljs-string"><span class="hljs-string">[[CCDirector sharedDirector] replaceScene:[CCTransitionCrossFade transitionWithDuration:1.0 scene:[CCBReader sceneWithNodeGraphFromFile:@"AboutScene.ccbi"]]</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre><br>  In this method, everything should be clear: here, pressing each button is processed separately.  For example, when you click the About button, the scene is AboutScene.ccbi. <br><br>  Run the game.  You should now have a fully functional main menu. <br>  Awesome, you just created your first scene, and you barely wrote any code. <br>  Of course, you noticed that the code for <b>buttonPressed:</b> is associated with CCBI files that you haven‚Äôt done yet.  Therefore, if you click on any of the buttons in the menu, the program will generate an error, since these scenes are not yet in place. <br>  This is what you are going to do next - fill in the blanks! <br><br><h1>  There is nothing difficult! </h1><br>  As in the main menu, there will be three buttons in the difficulty selection scene, and creating this scene will be just as easy. <br>  In the Options scene, pressing the buttons will allow the user to select Easy, Medium or Hard difficulty levels.  There will also be a button to return to the main menu. <br>  Open CocosBuilder and create a new scene by selecting the File \ New \ New File menu item (follow the same steps as creating MainMenuScene), name it OptionsScene and save it in the Scenes folder. <br>  Add three buttons to the scene and give them the names Easy, Medium and Hard.  Then tag them with values ‚Äã‚Äã1, 2 and 3, respectively. <br>  To receive events when the user clicks on the buttons, you must specify the method that will be invoked.  Just as you did with MainMenuScene, write for each of the buttons in the Selector field the <b>difficultyButtonPressed</b> value <b>:</b> and in the Target field, select the <b>Document Root</b> value. <br><br><blockquote>  <b>Note</b> : I wonder what this Document Root means?  This means the root node in the ‚ÄúDefault Timeline‚Äù timeline tree.  Soon you will install a custom class - OptionsLayer to the root node (CCLayer).  This means that the OptionsLayer class will act as the Document Root. <br></blockquote><br>  Your layout will look like this: <br><img src="https://habrastorage.org/storage2/f6f/4a5/4cf/f6f4a54cf66863721e3188f22f8b9f98.png"><br>  Now back to the main menu button.  This time, instead of adding CCControlButton, you need to add the CCMenu menu item. <br>  Click the CCMenu button on the toolbar. <br><img src="https://habrastorage.org/storage2/e6a/422/c21/e6a422c21e08e4a1da534e51bd0e79dd.png"><br><br>  This will create a CCMenu menu and add it to the OptionsScene layer.  Now add the CCMenuItemImage menu item by clicking the CCMenuItemImage button on the toolbar. <br><img src="https://habrastorage.org/storage2/8bb/c6c/f37/8bbc6cf373c392b464cf002722cdaccb.png"><br><br>  Specify different sprites in the Normal and Selected fields, for each - <b>btn-back-0.png</b> and <b>btn-back-1.png</b> .  These properties can be changed in the CCMenuItemImage section of the panel on the right. <br><img src="https://habrastorage.org/storage2/20e/90b/189/20e90b189c5d5f3191a423111e557fb8.png"><br><br>  Insert the ‚ÄúBack‚Äù button in the upper left corner of the scene and set the <b>backButtonPressed:</b> selector for it.  Remember to select Document root in the Target field. <br>  That's all!  The scene should look like this: <br><img src="https://habrastorage.org/storage2/720/c92/334/720c923346dcf0ef667a9e3ce183e06e.png"><br><br>  Just as you did with MainMenuScene before, add a custom class for OptionsScene.  Call it <b>OptionsLayer</b> . <br><img src="https://habrastorage.org/storage2/953/cf2/16f/953cf216fb34f3784f9d984913944481.png"><br><br>  As before, save the changes, publish the scene, and add the CCBI file to the Xcode project. <br>  Go to Xcode, create a new class in the Layers group and name it <b>OptionsLayer</b> (make sure it is a subclass of the CCLayer class), just like you did before. <br>  Then add the following import statements and definitions to the top of OptionsLayer.m: <br><pre> <code class="hljs css"><span class="hljs-selector-id"><span class="hljs-selector-id">#import</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">CCBReader</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.h</span></span>" <span class="hljs-selector-id"><span class="hljs-selector-id">#import</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">CCControlButton</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.h</span></span>" <span class="hljs-selector-id"><span class="hljs-selector-id">#define</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DIFFICULTY_EASY_BUTTON_TAG</span></span> 1 <span class="hljs-selector-id"><span class="hljs-selector-id">#define</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DIFFICULTY_MEDIUM_BUTTON_TAG</span></span> 2 <span class="hljs-selector-id"><span class="hljs-selector-id">#define</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DIFFICULTY_HARD_BUTTON_TAG</span></span> 3</code> </pre><br>  And also the following methods: <br><pre> <code class="hljs objectivec">-(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)backButtonPressed:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)sender { [[CCDirector sharedDirector] replaceScene:[CCTransitionFlipAngular transitionWithDuration:<span class="hljs-number"><span class="hljs-number">1.0</span></span> scene:[CCBReader sceneWithNodeGraphFromFile:<span class="hljs-string"><span class="hljs-string">@"MainMenuScene.ccbi"</span></span>]]]; } -(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)difficultyButtonPressed:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)sender { CCControlButton *button = (CCControlButton*) sender; <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *difficultyLevel = <span class="hljs-string"><span class="hljs-string">@"Hard"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (button.tag == DIFFICULTY_EASY_BUTTON_TAG) { difficultyLevel = <span class="hljs-string"><span class="hljs-string">@"Easy"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(button.tag == DIFFICULTY_MEDIUM_BUTTON_TAG) { difficultyLevel = <span class="hljs-string"><span class="hljs-string">@"Medium"</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"Difficulty is set to %@"</span></span>, difficultyLevel); }</code> </pre><br>  All this should be familiar to you.  The procedure <b>backButtonPressed:</b> returns the user back to the main scene menu. <br>  The procedure <b>difficultyButtonPressed:</b> in its current form does not establish the level of complexity, but only writes to the log the fact of the user's choice.  Feel free to choose a high level of complexity, nothing changes. <br>  Start the game, now you have two fully functional scenes.  You are already halfway to the full game interface! <br><br><h1>  It was the turn of ... fire! </h1><br>  About scenes are needed to provide users with additional information about your program - how to play or use the application, who made it, version number, and so on. <br>  Your About scene will be special: it will be a burning hell!  This is not only to look cool, but also to understand how to add a particle system (for example, a special effect) using CocosBuilder. <br>  Switch to CocosBuilder, create a new file called <b>AboutScene</b> and save it in the Scenes directory. <br>  Get started with your layout by clicking the CCParticleSystemQuad button on the toolbar. <br><img src="https://habrastorage.org/storage2/55f/60f/c4b/55f60fc4b76514f086098d5d2d046727.png"><br><br>  So you create a fiery particle system.  Select a particle system and change the <b>Particle texture</b> property to <b>cat_leap_1.png</b> .  Play around with the CCParticleSystemQuad parameter until you are happy with the result.  Then slide the particle system to the lower right corner of the screen, as shown below: <br><img src="https://habrastorage.org/storage2/4ff/574/889/4ff574889a58faed7ef5cf45539c6ead.png"><br><br>  Now you need to add some text.  Add CCLabelBMFont by clicking the following button on the toolbar: <br><img src="https://habrastorage.org/storage2/215/24b/a1a/21524ba1abe1f22d80331159c8e76517.png"><br><br>  In the font properties, select <b>Arial.fnt</b> (from the Resources folder).  Then add two more text elements, one below the other, also specify the same font. <br>  Break the text of the following content - <b>Help the cat jump over all the obstacles trying to run him over</b> - between the three text elements.  There are no nuances here anymore. <br>  Now, the About scene will look like this: <br><img src="https://habrastorage.org/storage2/d5c/4e3/bb9/d5c4e3bb99e6b256d220d71f75d54205.png"><br><br>  You are almost done with this scene!  All that's left is the Back button. <br>  Add the Back button to the upper left corner, as you did before.  As a selector, write <b>backButtonPressed:,</b> in the Target field - Document root. <br>  The final step is to add a custom class for this scene, as well as for the two previous scenes.  The name of the custom class is <b>AboutLayer</b> , as shown below: <br><img src="https://habrastorage.org/storage2/2b3/d51/59a/2b3d5159ab40b2d480db7e2619b13f4e.png"><br><br>  As before, save the changes, publish the scene, and add it to the Xcode project.  Then go to Xcode and create a new Cocos2D class in the Layers group.  Call it <b>AboutLayer</b> and make sure it is a subclass of the CCLayer class. <br>  Open <b>AboutLayer.m</b> and add the following import statement: <br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CCBReader.h"</span></span></span></span></code> </pre><br>  And also this method: <br><pre> <code class="hljs lua">-(void)backButtonPressed:(id)sender { <span class="hljs-string"><span class="hljs-string">[[CCDirector sharedDirector] replaceScene:[CCTransitionFlipAngular transitionWithDuration:1.0 scene:[CCBReader sceneWithNodeGraphFromFile:@"MainMenuScene.ccbi"]]</span></span>]; }</code> </pre><br>  The method will be called when the user presses the Back button (green arrow) and the method replaces the current scene with the MainMenu scene. <br>  Run the game.  Check: clicking the About button displays the AboutScene scene, and the Back button takes you back to the main menu.  Not bad for a few minutes of your time, eh? <br><br><h1>  In Game! </h1><br>  Finally, it is time to put into play our star - a cat who will have a hard day!  All you have to do is put all the sprites you need to play in the right places, and you will do this without tinkering with the code.  So let's get started! <br>  Go to CocosBuilder and create a new file.  Name it <b>GameScene</b> and save it in the Scenes folder. <br>  Then click the CCSprite button on the toolbar to create a new sprite.  Set the frame of this sprite to <b>bg.png</b> and put it in the center of the screen.  Your scene should look like the one below: <br><img src="https://habrastorage.org/storage2/d43/911/c4c/d43911c4ca7c0e775e6eabe4caad9308.png"><br><br>  Now add the main character of the game - the cat!  Add another sprite to the layer by clicking the CCSprite button again.  In the Frame field of the sprite, select <b>cat_stand_1.png</b> and coordinates X: 75, Y: 75. <br>  In addition, we add two CCLabelBMFonts elements.  They will show the number of lives of the cat, and the number of jumps made. <br>  Press the CCLabelBMFont button two times and in the resulting elements enter the text <b>Lives:</b> and <b>Dodges:.</b>  With these elements, become the font <b>Arial.fnt</b> .  Place the resulting text elements in the upper left and right corners of the screen, as shown below: <br><img src="https://habrastorage.org/storage2/86b/18e/44e/86b18e44ebf26ce61bcb793070d9c4c9.png"><br><br>  Fine!  All is ready. <br>  Or not everything?  Sprites you posted, but you have no way to refer to them in the code.  For example, how would you manipulate a cat in the logic of the game?  Do not break your head - with CocosBuilder it's easy. <br>  Let's start with our hero, a cat.  Select the cat sprite and in the right pane, in the <b>Code Connections</b> section, you will see the drop-down menu below the <b>Custom class</b> fields. <br>  In this menu (the value Don‚Äôt assign is now selected there) select the value <b>Doc root var</b> and in the adjacent text field write the variable name <b>cat</b> .  So we linked the variable "cat" with a link to this sprite.  The value "Doc root var" means that this variable will be present in the root document, in our case - the layer class. <br><img src="https://habrastorage.org/storage2/698/21a/746/69821a746d450fb53754a0807fc051aa.png"><br><br>  Now repeat the same for text elements and associate them with the variables <b>livesLabel</b> and <b>dodgesLabel</b> . <br>  Guess what will happen next?  Just like the previous scenes, this scene requires communication with the layer class.  Link this scene to the <b>GameLayer</b> class, as shown below: <br><img src="https://habrastorage.org/storage2/044/827/af2/044827af28aa396ba85ad2c0e6b06657.png"><br><br>  Save the changes, publish the scene, and add the CCBI file to the project.  Go to Xcode and create a new class in the Layers group, calling it <b>GameLayer</b> and making sure it is a subclass of CCLayer. <br>  It is time to describe the game logic.  But since this is a guide to working with CocosBuilder (and not on building the logic of the game), just replace GameLayer.m with this long block of code: <br><br><div class="spoiler">  <b class="spoiler_title">the contents of the GameLayer.m file</b> <div class="spoiler_text"><pre> <code class="hljs lua">#import <span class="hljs-string"><span class="hljs-string">"GameLayer.h"</span></span> #import <span class="hljs-string"><span class="hljs-string">"CCBReader.h"</span></span> #import <span class="hljs-string"><span class="hljs-string">"SimpleAudioEngine.h"</span></span> #define kVehicleTypeNone <span class="hljs-number"><span class="hljs-number">-1</span></span> #define kVehicleTypeRedCar <span class="hljs-number"><span class="hljs-number">0</span></span> #define kVehicleTypeYellowCar <span class="hljs-number"><span class="hljs-number">1</span></span> #define kVehicleTypeDog <span class="hljs-number"><span class="hljs-number">2</span></span> #define kVehicleTypeKid <span class="hljs-number"><span class="hljs-number">3</span></span> @interface GameLayer() { CCLabelBMFont *livesLabel; CCLabelBMFont *dodgesLabel; CCSprite *cat; CCNode *_vehicles; BOOL _invincible; BOOL _jumping; double _nextSpawn; int _lives; int _dodges; CCSpriteBatchNode *_catJumpBatchNode; CCAnimation *_catJumpAnimation; } @<span class="hljs-keyword"><span class="hljs-keyword">end</span></span> @implementation GameLayer - (id) init { self = [super init]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self) { <span class="hljs-string"><span class="hljs-string">[[CCSpriteFrameCache sharedSpriteFrameCache] addSpriteFramesWithFile:@"CatJumpAtlas.plist"]; _catJumpBatchNode = [CCSpriteBatchNode batchNodeWithFile:@"CatJumpAtlas.png"]; [self addChild:_catJumpBatchNode z:1]; _catJumpAnimation = [CCAnimation animation]; [_catJumpAnimation addSpriteFrame:[[CCSpriteFrameCache sharedSpriteFrameCache] spriteFrameByName:@"cat_leap_1.png"]]; [_catJumpAnimation addSpriteFrame:[[CCSpriteFrameCache sharedSpriteFrameCache] spriteFrameByName:@"cat_leap_2.png"]]; [_catJumpAnimation setDelayPerUnit:0.625f]; [_catJumpAnimation retain]; // If you want to add this to the AnimationCache instead of retaining //[[CCAnimationCache sharedAnimationCache] addAnimation:catJumpAnimation name:@"catJumpAnim"]; // Dog Animation CCAnimation *dogAnimation = [CCAnimation animation]; [dogAnimation addSpriteFrame:[[CCSpriteFrameCache sharedSpriteFrameCache] spriteFrameByName:@"dog_1.png"]]; [dogAnimation addSpriteFrame:[[CCSpriteFrameCache sharedSpriteFrameCache] spriteFrameByName:@"dog_2.png"]]; [dogAnimation addSpriteFrame:[[CCSpriteFrameCache sharedSpriteFrameCache] spriteFrameByName:@"dog_3.png"]]; [dogAnimation addSpriteFrame:[[CCSpriteFrameCache sharedSpriteFrameCache] spriteFrameByName:@"dog_4.png"]]; [[CCAnimationCache sharedAnimationCache] addAnimation:dogAnimation name:@"dogAnimation"]; // Kid Animation CCAnimation *kidAnimation = [CCAnimation animation]; [kidAnimation addSpriteFrame:[[CCSpriteFrameCache sharedSpriteFrameCache] spriteFrameByName:@"kidontrike_1.png"]]; [kidAnimation addSpriteFrame:[[CCSpriteFrameCache sharedSpriteFrameCache] spriteFrameByName:@"kidontrike_2.png"]]; [kidAnimation addSpriteFrame:[[CCSpriteFrameCache sharedSpriteFrameCache] spriteFrameByName:@"kidontrike_3.png"]]; [kidAnimation addSpriteFrame:[[CCSpriteFrameCache sharedSpriteFrameCache] spriteFrameByName:@"kidontrike_4.png"]]; [[CCAnimationCache sharedAnimationCache] addAnimation:kidAnimation name:@"kidAnimation"]; self.isTouchEnabled = YES; [self scheduleUpdate]; _vehicles = [CCNode node]; [self addChild:_vehicles]; _lives = 9; _dodges = 0; double curTime = [[NSDate date] timeIntervalSince1970]; _nextSpawn = curTime + 4; } return self; } - (void) didLoadFromCCB { [self setLives:_lives]; [self setDodges:_dodges]; } - (void) setDodges:(int) noOfDodges { dodgesLabel.string = [NSString stringWithFormat:@"Dodges:%d", noOfDodges]; } - (void) setLives:(int) noOfLives { livesLabel.string = [NSString stringWithFormat:@"Lives:%d", noOfLives]; } - (void)carDone:(id)sender { CCSprite *vehicle = (CCSprite *)sender; [vehicle removeFromParentAndCleanup:YES]; _dodges++; [self setDodges:_dodges]; } - (void)doneInvincible { _invincible = FALSE; } - (void)update:(ccTime)dt { CGSize winSize = [CCDirector sharedDirector].winSize; CCSprite *vehicleSprite; // Spawn Vehicles (new) double curTime = [[NSDate date] timeIntervalSince1970]; if (curTime &gt; _nextSpawn) { int randomVehicle = arc4random() % 4; if (randomVehicle == kVehicleTypeRedCar) { // Red Car vehicleSprite = [CCSprite spriteWithSpriteFrame:[[CCSpriteFrameCache sharedSpriteFrameCache] spriteFrameByName:@"car1_1.png"]]; [vehicleSprite setUserData:[NSNumber numberWithInt:kVehicleTypeRedCar]]; CCSprite *wheel1 = [CCSprite spriteWithSpriteFrame:[[CCSpriteFrameCache sharedSpriteFrameCache] spriteFrameByName:@"car1_tire.png"]]; CCSprite *wheel2 = [CCSprite spriteWithSpriteFrame:[[CCSpriteFrameCache sharedSpriteFrameCache] spriteFrameByName:@"car1_tire.png"]]; id tireRotateAction1 = [CCRotateBy actionWithDuration:1.0f angle:360.0f]; // Ray, these are backwards on purpose as a lab exercise. id tireRotateAction2 = [CCRotateBy actionWithDuration:1.0f angle:360.0f]; [wheel1 runAction:[CCRepeatForever actionWithAction:tireRotateAction1]]; [wheel2 runAction:[CCRepeatForever actionWithAction:tireRotateAction2]]; [vehicleSprite addChild:wheel1]; [vehicleSprite addChild:wheel2]; [wheel1 setPosition:ccp(65,18)]; [wheel2 setPosition:ccp(212,18)]; } else if (randomVehicle == kVehicleTypeYellowCar) { // Yellow Car (Same code as Red Car except for wheel placement, re-listed for clarity. Consilidate in your own games) vehicleSprite = [CCSprite spriteWithSpriteFrame:[[CCSpriteFrameCache sharedSpriteFrameCache] spriteFrameByName:@"car2_1.png"]]; [vehicleSprite setUserData:[NSNumber numberWithInt:kVehicleTypeYellowCar]]; CCSprite *wheel1 = [CCSprite spriteWithSpriteFrame:[[CCSpriteFrameCache sharedSpriteFrameCache] spriteFrameByName:@"car2_tire.png"]]; CCSprite *wheel2 = [CCSprite spriteWithSpriteFrame:[[CCSpriteFrameCache sharedSpriteFrameCache] spriteFrameByName:@"car2_tire.png"]]; id tireRotateAction1 = [CCRotateBy actionWithDuration:1.0f angle:-360.0f]; id tireRotateAction2 = [CCRotateBy actionWithDuration:1.0f angle:-360.0f]; [wheel1 runAction:[CCRepeatForever actionWithAction:tireRotateAction1]]; [wheel2 runAction:[CCRepeatForever actionWithAction:tireRotateAction2]]</span></span>; [vehicleSprite addChild:wheel1]; [vehicleSprite addChild:wheel2]; [wheel1 setPosition:ccp(<span class="hljs-number"><span class="hljs-number">62</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>)]; [wheel2 setPosition:ccp(<span class="hljs-number"><span class="hljs-number">195</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>)]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (randomVehicle == kVehicleTypeDog) { // Dog vehicleSprite = [CCSprite spriteWithSpriteFrame:<span class="hljs-string"><span class="hljs-string">[[CCSpriteFrameCache sharedSpriteFrameCache] spriteFrameByName:@"dog_1.png"]]</span></span>; [vehicleSprite setUserData:[NSNumber numberWithInt:kVehicleTypeDog]]; // In your code, check that the animationByName did <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> (due to memory warnings) CCAnimation *vehicleAnimation = <span class="hljs-string"><span class="hljs-string">[[CCAnimationCache sharedAnimationCache] animationByName:@"dogAnimation"]; vehicleAnimation.restoreOriginalFrame = NO; vehicleAnimation.delayPerUnit = 0.5f/ vehicleAnimation.frames.count; id animationAction = [CCAnimate actionWithAnimation:vehicleAnimation]; [vehicleSprite runAction:[CCRepeatForever actionWithAction:animationAction]]</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { // Kid on Bike (Same code as Dog, re-listed <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> clarity. Consilidate <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> your own games) vehicleSprite = [CCSprite spriteWithSpriteFrame:<span class="hljs-string"><span class="hljs-string">[[CCSpriteFrameCache sharedSpriteFrameCache] spriteFrameByName:@"kidontrike_1.png"]]</span></span>; [vehicleSprite setUserData:[NSNumber numberWithInt:kVehicleTypeKid]]; // In your code, check that the animationByName did <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> (due to memory warnings) CCAnimation *vehicleAnimation = <span class="hljs-string"><span class="hljs-string">[[CCAnimationCache sharedAnimationCache] animationByName:@"kidAnimation"]; vehicleAnimation.restoreOriginalFrame = NO; vehicleAnimation.delayPerUnit = 0.5f/ vehicleAnimation.frames.count; id animationAction = [CCAnimate actionWithAnimation:vehicleAnimation]; [vehicleSprite runAction:[CCRepeatForever actionWithAction:animationAction]]</span></span>; } // Common placement <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> movement code <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> all vehicles vehicleSprite.position = ccp(winSize.width + vehicleSprite.contentSize.width/<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span>); [_catJumpBatchNode addChild:vehicleSprite]; [vehicleSprite runAction:[CCSequence actions: [CCMoveBy actionWithDuration:<span class="hljs-number"><span class="hljs-number">1.25</span></span> position:ccp(-winSize.width-vehicleSprite.contentSize.width, <span class="hljs-number"><span class="hljs-number">0</span></span>)], [CCCallFuncN actionWithTarget:self selector:@selector(carDone:)], <span class="hljs-literal"><span class="hljs-literal">nil</span></span>]]; float randomInterval = arc4random() % <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">1.5</span></span>; _nextSpawn = curTime + randomInterval; } // Check <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> collisions <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_invincible) { float insetAmtX = <span class="hljs-number"><span class="hljs-number">10</span></span>; float insetAmtY = <span class="hljs-number"><span class="hljs-number">10</span></span>; BOOL isCatColliding; CGRect catRect = CGRectInset(cat.boundingBox, insetAmtX, insetAmtY); CGRect vehicleRect; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (CCSprite *vehicle <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _catJumpBatchNode.children) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([vehicle tag] == <span class="hljs-number"><span class="hljs-number">1</span></span>) { continue; // No need to check <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> the Cat collides with itself } isCatColliding = NO; NSNumber *vehicleTypeNumber = (NSNumber*)[vehicle userData]; int vehicleType = [vehicleTypeNumber intValue]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (vehicleType == kVehicleTypeRedCar) { CGPoint boundingBoxOrigin = vehicle.boundingBox.origin; CGRect carHood = CGRectMake(boundingBoxOrigin.x+<span class="hljs-number"><span class="hljs-number">10</span></span>,boundingBoxOrigin.y , <span class="hljs-number"><span class="hljs-number">40</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>); insetAmtX = <span class="hljs-number"><span class="hljs-number">50</span></span>; insetAmtY = <span class="hljs-number"><span class="hljs-number">10</span></span>; vehicleRect = CGRectInset(vehicle.boundingBox,insetAmtX,insetAmtY); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((CGRectIntersectsRect(catRect,carHood)) || (CGRectIntersectsRect(catRect, vehicleRect))) { isCatColliding = YES; CCLOG(@<span class="hljs-string"><span class="hljs-string">"Collided with Red Car"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (vehicleType == kVehicleTypeYellowCar) { CGPoint boundingBoxOrigin = vehicle.boundingBox.origin; CGRect carHood = CGRectMake(boundingBoxOrigin.x+<span class="hljs-number"><span class="hljs-number">10</span></span>,boundingBoxOrigin.y , <span class="hljs-number"><span class="hljs-number">68</span></span>,<span class="hljs-number"><span class="hljs-number">65</span></span>); insetAmtX = <span class="hljs-number"><span class="hljs-number">68</span></span>; insetAmtY = <span class="hljs-number"><span class="hljs-number">10</span></span>; vehicleRect = CGRectInset(vehicle.boundingBox,insetAmtX,insetAmtY); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((CGRectIntersectsRect(catRect,carHood)) || (CGRectIntersectsRect(catRect, vehicleRect))) { isCatColliding = YES; CCLOG(@<span class="hljs-string"><span class="hljs-string">"Collided with Yellow Car"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { // Dog <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> Kid CGRect vehicleRect = CGRectInset(vehicle.boundingBox, insetAmtX, insetAmtY); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CGRectIntersectsRect(catRect, vehicleRect)) { isCatColliding = YES; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isCatColliding == YES) { // Play sound, take a hit, invincible, <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> out of the loop <span class="hljs-string"><span class="hljs-string">[[SimpleAudioEngine sharedEngine] playEffect:@"squish.wav"]; _invincible = TRUE; [cat runAction:[CCSequence actions: [CCBlink actionWithDuration:1.0 blinks:6], [CCCallFunc actionWithTarget:self selector:@selector(doneInvincible)], nil]]</span></span>; _lives<span class="hljs-comment"><span class="hljs-comment">--; [self setLives:_lives]; if (_lives &lt;= 0) { [[CCDirector sharedDirector] replaceScene:[CCTransitionJumpZoom transitionWithDuration:1.0 scene:[CCBReader sceneWithNodeGraphFromFile:@"GameOver.ccbi"]]]; } break; } } } } - (void)doneJump { _jumping = FALSE; } - (void)ccTouchesBegan:(NSSet *)touches withEvent:(UIEvent *)event { if (!_jumping) { _jumping = TRUE; [[SimpleAudioEngine sharedEngine] playEffect:@"meow.wav"]; CCLOG(@"Making the Cat Jump"); _catJumpAnimation.restoreOriginalFrame = YES; CCAnimate *jumpAnimation = [CCAnimate actionWithAnimation:_catJumpAnimation]; CCJumpBy *jumpAction = [CCJumpBy actionWithDuration:1.25 position:ccp(0,0) height:200 jumps:1]; CCCallFunc *doneJumpAction = [CCCallFunc actionWithTarget:self selector:@selector(doneJump)]; CCSequence *sequenceAction = [CCSequence actions:jumpAction,doneJumpAction, nil]; [cat runAction:[CCSpawn actions:jumpAnimation,sequenceAction, nil]]; } } @end</span></span></code> </pre><br></div></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feel free to look at the code to get an idea of ‚Äã‚Äãwhat is happening with the logic of the game, but do not worry about it too much - CocosBuilder is in the center of our attention. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notice the variables at the top of the code, immediately after the #defines operator:</font></font><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">CCLabelBMFont</span></span> *livesLabel; <span class="hljs-attribute"><span class="hljs-attribute">CCLabelBMFont</span></span> *dodgesLabel; <span class="hljs-attribute"><span class="hljs-attribute">CCSprite</span></span> *cat;</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">These variables, I'm sure you remember them, correspond to the variables that you created in CocosBuilder. </font><font style="vertical-align: inherit;">They are automatically initialized as a cat sprite, a text about the number of lives and the number of jumps. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run the game. </font><font style="vertical-align: inherit;">Now, if you click the Play button in the main menu, you can play the game.</font></font><br>  Hooray!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You have created a game scene. </font><font style="vertical-align: inherit;">It was much easier than dodging children on tricycles.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> End of the game </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Do you think you did everything? </font></font> Not really. <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You may have noticed that when a cat loses all lives, the game gives an error. </font><font style="vertical-align: inherit;">This is because the Game Over scene that the CCBReader is trying to load is missing. </font><font style="vertical-align: inherit;">This may be because you have not done it yet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This scene will have two buttons:</font></font><br><ul><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Main Menu</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Returns the user to the main menu.</font></font></li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Replay</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : User plays the game again.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Switch to CocosBuilder and create a new file called </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GameOver</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Add two CCControlButtons buttons with the names listed above. </font><font style="vertical-align: inherit;">Make sure you don‚Äôt forget to tag 1 and 2. Also, do not forget to enter the value of </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buttonPressed:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the Selector field </font><font style="vertical-align: inherit;">and the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Document root</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> value in the Target field </font><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finally, set the class for the root layer to </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GameOverLayer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , save the changes, and publish the file. </font></font><br><img src="https://habrastorage.org/storage2/a2f/7bb/9e4/a2f7bb9e47a4de9d625bcec87a459fef.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Switch back to Xcode and add the CCBI file to the project. </font><font style="vertical-align: inherit;">Then create a new Cocos2D class in the Layers group and name it </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GameOverLayer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , making sure that this class is a sub-class of the CCLayer class.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Add the following import statements to GameOverLayer.m: </font></font><br><pre> <code class="hljs scala">#<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"CCControlButton.h"</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"CCBReader.h"</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And also definition operators: </font></font><br><pre> <code class="hljs cs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAIN_MENU_BUTTON_TAG 1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PLAY_AGAIN_BUTTON_TAG 2</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Add a method that handles button presses: </font></font><br><pre> <code class="hljs lua">-(void)buttonPressed:(id)sender { CCControlButton *button = (CCControlButton*) sender; switch (button.tag) { case MAIN_MENU_BUTTON_TAG: <span class="hljs-string"><span class="hljs-string">[[CCDirector sharedDirector] replaceScene:[CCTransitionFlipY transitionWithDuration:1.0 scene:[CCBReader sceneWithNodeGraphFromFile:@"MainMenuScene.ccbi"]]</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case PLAY_AGAIN_BUTTON_TAG: <span class="hljs-string"><span class="hljs-string">[[CCDirector sharedDirector] replaceScene:[CCTransitionFadeUp transitionWithDuration:1.0 scene:[CCBReader sceneWithNodeGraphFromFile:@"GameScene.ccbi"]]</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run the program. </font><font style="vertical-align: inherit;">You now have a full featured game. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It was much easier than selecting the positions of the sprites in the game code?</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CocosBuilder troubleshooting </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CocosBuilder is a great tool for creating scenes quickly and efficiently. </font><font style="vertical-align: inherit;">However, this tool is not very good at communicating when something is wrong with the stage. </font><font style="vertical-align: inherit;">In order to save your time, I have compiled a checklist that I need to go through in case the scene does not work properly or you get unexpected errors.</font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Make sure you save your changes to CocosBuilder before publishing the file. </font></font> It is very important. CocosBuilder     ,      ,    .      ‚Äî      . </li><li>    CCBI-  Xcode-,  ,    <b>Add to target</b> ,      . ,         Add to targets,   .     CCBI. ,     ,         . </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Read messages in the debug console. </font><font style="vertical-align: inherit;">If CocosBuilder cannot tell you what went wrong, the debug console may contain a message that will help you figure out what went wrong. </font><font style="vertical-align: inherit;">If it says: ‚ÄúFile not found: GameOver.ccbi‚Äù, then this means that the GameOver.ccbi file was either not added to the project, or is not part of the target assembly that you are compiling, or there is simply an error in the file name.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Make sure you are not sealed. </font><font style="vertical-align: inherit;">When you enter text such as the names of variables, user-defined classes, or the name of event selectors, it is very important not to be sealed. </font><font style="vertical-align: inherit;">Try to use copying through the clipboard.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If you use these tips, you will save yourself time, and if the problem does occur, we hope you pounce on her like a frisky cat on a mouse. </font></font><br><br><h1>  What's next? </h1><br> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here is the entire source code of the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> final project. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now you are ready to use CocosBuilder to create your own games. </font><font style="vertical-align: inherit;">I hope that this lesson will save you a lot of time to create new games!</font></font></div><p>Source: <a href="https://habr.com/ru/post/166709/">https://habr.com/ru/post/166709/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../166695/index.html">Acceptance of online payments in Europe in 2013</a></li>
<li><a href="../166697/index.html">Review of offers of Coursera and edX</a></li>
<li><a href="../166699/index.html">Degrees are the key to fast hierarchy in a relational database</a></li>
<li><a href="../166701/index.html">Efficient string concatenation in .NET</a></li>
<li><a href="../166705/index.html">New asteroid development project</a></li>
<li><a href="../166711/index.html">TheSortableTree 2.0 gem release</a></li>
<li><a href="../166715/index.html">Never distract a programmer</a></li>
<li><a href="../166719/index.html">Announced the release of smartphones "Firefox OS developer preview"</a></li>
<li><a href="../166721/index.html">Yota-script or save with Yota cross platform</a></li>
<li><a href="../166723/index.html">Iconomania or fear of not using icons</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>