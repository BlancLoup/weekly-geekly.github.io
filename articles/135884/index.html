<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GNS3 and dynamips on a remote server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today, we will look at the diversity of GNS3 shell and Cisco IOS Dynamips emulator to different computers. 

 Given: 
 powerful server (home / work / ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GNS3 and dynamips on a remote server</h1><div class="post__text post__text-html js-mediator-article">  Today, we will look at the diversity of GNS3 shell and Cisco IOS Dynamips emulator to different computers. <br><br>  <b>Given:</b> <br>  powerful server (home / work / Hetzner / Amazone) and a rather weak workstation (laptop / netbook / etc.). <br>  <b>Task:</b> <br>  transfer the load from emulating a large number of IOS to a server for comfortable work. <br>  <b>Decision:</b> <br>  Several options will be considered - regular (! Yes, you didn‚Äôt notice the ‚ÄúHypervisors‚Äù tab in the settings?) And working with crutches [unix way], but in my opinion it is somewhat more convenient. <br><br>  For work we will use the following software: <br>  - GNS3 0.8.2-BETA, but should work on the 0.7.x branch <br>  - Dinamips 0.2.8-RC2 <br>  - Linux Ununtu 11.10 / Windows 7 <br>  - bash, tmux, ssh <br><a name="habracut"></a><ul><li>  <a href="https://habr.com/ru/post/135884/">Option 1 - regular</a> <br>  - <a href="https://habr.com/ru/post/135884/">Server: Linux</a> <br>  - <a href="https://habr.com/ru/post/135884/">Server: Windows</a> <br>  - <a href="https://habr.com/ru/post/135884/">Client: Linux</a> <br>  - <a href="https://habr.com/ru/post/135884/">Client: Windows</a> <br></li><li>  <a href="https://habr.com/ru/post/135884/">Option 2 - unix way</a> </li><li>  <a href="https://habr.com/ru/post/135884/">Option 3 - unix way / part 2</a> </li><li>  <a href="https://habr.com/ru/post/135884/">PS1 - baseconfig.txt</a> </li><li>  <a href="https://habr.com/ru/post/135884/">PS2 - tmux</a> </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="q"></a><h2>  Option 1 - regular </h2><br>  How it works. <br>  The server is running dynamips in hypervisor mode.  On the client (workstation with GNS3), the management of local hypervisors is disabled and the remote ones are registered. <br><br><a name="w"></a><h3>  Server: Linux </h3><br><pre><code class="bash hljs">$ sudo apt-get install dynamips $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /tmp $ dynamips -H 7220 Cisco Router Simulation Platform (version 0.2.8-RC2-amd64) Copyright (c) 2005-2007 Christophe Fillot. Build date: Jan 18 2011 19:25:29 Hypervisor TCP control server started (port 7220).</code> </pre> <br>  If you see a similar message about starting the server, everything works. <br>  Before launching the hypervisor, you need to go to the "working" directory, because  in the process, he creates a lot of temporary files.  In this case, they do not interest us, so we will work in the tmp folder. <br>  You can leave the server and go to another terminal or stop the hypervisor. <br><pre> <code class="bash hljs">^CHypervisor: closing control sockets. Hypervisor: closing remote client connections. Shutdown <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> progress... Shutdown completed.</code> </pre><br>  <i>For convenience, I advise you to use <a href="http://habrahabr.ru/blogs/linux/126996/">tmux</a> .</i> <br><br>  Also, when using a firewall, do not forget to make exceptions to the incoming port of the hypervisor (in this case, TCP 7220) and console connections (configured in GNS3). <br><br>  The hypervisor is ready, it remains to prepare the images of iOS. <br>  Download the image from cisco.com or, in the absence of a subscription, from a known torrent tracker. <br>  We do not forget to speed up the unpacking of images, for this we download the ‚Äú <a href="">Cisco image unpacker 0.1 source code</a> ‚Äù from the <a href="http://www.gns3.net/download/">GNS3</a> website. <br><br><pre> <code class="bash hljs">$ mkdir ~/IOS $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/IOS $ mv ~/Downloads/Unpack-0.1_src.tar.bz2 ./ $ mv ~/Downloads/c2600-ipbasek9-mz.124-17.bin ./ $ tar -xjf Unpack-0.1_src.tar.bz2 $ rm Unpack-0.1_src.tar.bz2 $ python ./Unpack/unpack.py --format=IOS c2600-ipbasek9-mz.124-17.bin warning [c2600-ipbasek9-mz.124-17.bin]: 17812 extra bytes at beginning or within zipfile (attempting to process anyway) IOS binary image successfully unpacked <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> c2600-ipbasek9-mz.124-17.bin.unpacked</code> </pre><br><a name="e"></a><h3>  Server: Windows </h3><br>  As they say, knowledgeable people - dynamips under win works stably worse, but proceed to install. <br>  <a href="http://www.gns3.net/download/">Downloading</a> " <a href="">GNS3 v0.8.2 BETA all-in-one</a> ". <br>  After installation, open the folder with GNS3 and dynamips and find the .bat file to start the hypervisor. <br><br><img src="https://habrastorage.org/storage2/2c5/5f8/014/2c55f801481695a58df6712ca3f8cfb1.png"><br><br>  You can take a shortcut to a convenient place, for example on the desktop, because  will have to run it often. <br><br>  Next, in the editor, edit the port from the standard 7200 to 7220: <br><br><pre> <code class="bash hljs">rem Launch a <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> copy of dynamips <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dynamips=%CD%\dynamips.exe <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> %TEMP% start /belownormal /B /<span class="hljs-built_in"><span class="hljs-built_in">wait</span></span> <span class="hljs-string"><span class="hljs-string">"Dynamips"</span></span> <span class="hljs-string"><span class="hljs-string">"%dynamips%"</span></span> -H 7220 pause</code> </pre><br>  Once launched, the console window should look like this. <br><br><img src="https://habrastorage.org/storage2/2c9/fb1/827/2c9fb18278d8e30c3c80096ee38bed7d.png"><br><br>  All other actions are not very different from those under Linux (see above): <br>  - open ports in the firewall; <br>  - download iOS images; <br>  - unpack the image, <a href="">unpacker</a> . <br><br><a name="r"></a><h3>  Client: Linux </h3><br>  Ubuntu can install GNS3 through packages <br><br><pre> <code class="bash hljs">$ sudo apt-get install gns3</code> </pre><br>  But there is a rather old version (0.7.4), so download the source code.  Compiling does not have to, because  it is written in python.  To satisfy all dependencies, we first install GNS3 from the package, then download the latest version from the repository. <br><br><pre> <code class="bash hljs">$ sudo apt-get install gns3 $ sudo apt-get install mercurial $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/IOS/ $ hg <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> http://code.gns3.net/gns3-devel $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> gns3-devel $ ./gns3.pyw</code> </pre><br><img src="https://habrastorage.org/storage2/3ee/c2b/052/3eec2b0521052143575848576c775fc7.png"><br><br>  Edit-&gt; Preferences check the local dynamic settings. <br>  Do not forget to click "Test Settings" <br><br><img src="https://habrastorage.org/storage2/bdf/6b1/c65/bdf6b1c652beeae8244dab6107140dce.png"><br><br>  Edit-&gt; IOS images and hypervisors <br>  In the HOST field, enter the ip address of our server with dynamips, the PORT is the port selected for manual launch of dynamips. <br><br><img src="https://habrastorage.org/storage2/e75/310/eda/e75310eda907dba8c9131e38c28bbe8e.png"><br><br>  Now in the tab IOS images add the image. <br><br><img src="https://habrastorage.org/storage2/daf/e96/950/dafe96950723670ed6633e7b245fe120.png"><br><br>  <b>IMPORTANT.</b>  The path to the "Image file" and "Base config" are indicated on the server.  For the user from which dynamips is running, these files must be readable. <br>  Locally such files may not exist. <br>  Remove the item ‚ÄúUse the hypervisor manager‚Äù and select the server you need. <br>  Then save.  In the list of images, we see that the call will go not to the local hypervisor, but to that on server 172.16.1.1. <br>  Further, as usual, we create a topology and work. <br><br><a name="t"></a><h3>  Client: Windows </h3><br>  <a href="http://www.gns3.net/download/">From here,</a> download and install " <a href="">GNS3 v0.8.2 BETA all-in-one</a> " - compiled the latest version of GNS3. <br>  All settings correspond to the client under Linux. <br><br><a name="y"></a><h2>  Option 2 - unix way </h2><br>  There are two disadvantages to a regular solution: <br>  - the need to manually log in to a remote server to start the hypervisor; <br>  - the open channel of the control connection with the hyper-visitor and consoles. <br><br>  When you start the device with the key "-H 7220", dynamips opens a listening socket on all available addresses: <br><br><pre> <code class="bash hljs">$ sudo netstat --numeric --listening --program | grep dynamips tcp 0 0 0.0.0.0:7220 0.0.0.0:* LISTEN 12756/dynamips</code> </pre><br>  No authorization and encryption is provided, and when the paranoia mode is on, this is not exposed to the Internet.  There is no opportunity to hang the hypervisor on a specific ip, for example 127.0.0.1, and in any case the port must be closed with a firewall. <br>  At first glance, you need to use a VPN, which is beyond the scope of this article. <br><br>  Also, when working locally, the manager of the hyper-detectors, under certain circumstances, runs several copies of dynamips on different ports. <br><br>  Solution option - we configure GNS3 to work with local dynamips, but we create a layer that opens a remote connection via ssh to the server, automatically starts the hypervisor there and forwards ports on top of its encrypted connection.  In fact, it will be one script, run with different keys - for the control connection and for the remote console. <br><br>  Let's get started! <br><br>  <i>NOTE.</i>  <i>For correct operation, authentication in SSH using the keys ||</i>  <i>edit the script.</i> <br><br>  <i>NOTE.</i>  <i>The GNS3 version should be above 0.8.2 beta2 (for example, from the repository), because</i>  <i>it has a bug in which the control script cannot correctly extinguish the remote dynamips.</i> <br><br>  Edit-&gt; Preferences in the settings of the local dynamips and instead of its binary we write the path to our script <pre> <code class="bash hljs">/home/%username%/IOS/rdyn.sh</code> </pre> <br>  We also change the console connection string <br><pre> <code class="bash hljs">gnome-terminal -t %d -e <span class="hljs-string"><span class="hljs-string">'/home/%username%/rdyn.sh -R %p'</span></span> &gt;/dev/null 2&gt;&amp;1 &amp;</code> </pre> <br>  Do not forget to set the full path to the file in the command and replace the variables in the script. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env bash HOST=host.tld #HOST=2001:470::1 PORT=4444 USER=username ####################################### WRKDIR='/tmp' DYNAMIPS='/usr/bin/dynamips' RCMD=$1 RPORT=$2 SSHOPT="-a -T -q -x -o ExitOnForwardFailure=yes -o TCPKeepAlive=yes -o BatchMode=yes -o ControlPersist=10 -o ControlPath=/tmp/rdyn.%h.%p.%r -p $PORT $USER@$HOST " TELNETCMD="ssh -N -f -L 127.0.0.1:$2:127.0.0.1:$2 $SSHOPT" ######################################## trap quit INT TERM HUP KILL function quit { if [ $RCMD = '-H' ] ; then ssh $SSHOPT "pkill -f \"$DYNAMIPS -H $RPORT\"" &amp; else pkill -f "$TELNETCMD" fi exit } ######################################## if [ "$1" = '' ] ; then echo 'Error: script expects some commands.' exit fi ssh -M -f $SSHOPT exit &gt; /dev/null 2&gt;&amp;1 if [ "$1" = '--help' ] ; then ssh $SSHOPT "$DYNAMIPS --help" else if [ "$1" = '-H' ] ; then ssh -L 127.0.0.1:$2:127.0.0.1:$2 $SSHOPT "cd $WRKDIR ; $DYNAMIPS -H $2" 2&gt; /dev/null &amp; while : ; do wait; sleep 1; done else $TELNETCMD &gt; /dev/null 2&gt;&amp;1 telnet 127.0.0.1 $2 pkill -f "$TELNETCMD" read fi fi</span></span></code> </pre><br>  Principle of operation: <br>  - an attempt to start the master connection to the server (automatically completing by idle timeout); <br>  <i>in the course of work, quite a lot of dynamips-over-ssh and telnet-over-ssh sessions are created and multiplexing, in this case, significantly speeds up the work.</i> <br>  - the creation of a trap for the correct stopping of a remote dynamips; <br>  - launch a hypervisor or telnet connection. <br><br><a name="u"></a><h2>  Option 3 - unix way / part 2 </h2><br>  Forwarding X11 GUI applications. <br><br>  Pros: it works, and everything is out of the box. <br>  Cons: slowly.  A satisfactory result is only within the LAN at low latency and high speeds. <br><br><pre> <code class="bash hljs">$ ssh -X -C username@host.tld gns3</code> </pre> <br>  -C includes compression <br>  -X activates X11 session forwarding / don't forget to enable 'X11 Forwarding yes' in sshd_config / <br><br>  But in the case of using X11 Forwording, we actually lose the ability to download .net files and view saved configurations locally. <br>  For users of heavy shells can take advantage of built-in functions.  For example, Nautilus can add sftp links to bookmarks. <br><br>  A more versatile option is possible in conjunction fuse + ssh = sshfs. <br>  This topic has already been <a href="http://habrahabr.ru/blogs/personal/31253/">discussed</a> in Habr√©, so the idea will be only. <br><br>  Create in the home directory the main folder for working with GNS and the auxiliary script. <br><pre> <code class="bash hljs">$ sshfs username@host.tld:/home/%username%/CISCO ~/CISCO $ cat &lt;&lt; ENDL &gt; ~/CISCO/rgns3 ssh -X -C username@host.tld gns3 \<span class="hljs-variable"><span class="hljs-variable">$1</span></span> ENDL $ chmod +x ~/CISCO/rgns3</code> </pre><br>  Work model: <br>  - Download, for example, laboratory.  Assume <a href="http://habrahabr.ru/blogs/cisconetworks/125972/">ROUTE: EIGRP</a> . <br>  - Mount sshfs. <br>  - Unpack the archive in ~ / CISCO <br>  - we start <br><br><pre> <code class="bash hljs">$ ~/CISCO/rgns3 ~/CISCO/EIGRP/topology.net</code> </pre> <br><br><a name="o"></a>  <b>PS1</b> <br>  baseconfig.txt <br><pre> <code class="bash hljs">! hostname %h no ip domain-lookup line con 0 <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span>-timeout 0 0 logging synchronous privilege level 15 service timestamps debug datetime msec line vty 0 15 no login <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span>-timeout 0 0 logging synchronous privilege level 15</code> </pre><br>  This is not a combat configuration and has security problems, but is convenient for training. <br><br><a name="p"></a>  <b>PS2</b> <br>  Configure tmux to work with dynamips consoles. <br>  In tmux, I create a separate session for consoles, and from GNS3 I only add a connection to an existing one. <br><pre> <code class="bash hljs">$ cat gconsole.sh <span class="hljs-built_in"><span class="hljs-built_in">unset</span></span> TMUX; tmux new-session -d -s GNS3 &gt;/dev/null 2&gt;&amp;1 gnome-terminal -e <span class="hljs-string"><span class="hljs-string">'/usr/bin/tmux attach-session -t GNS3'</span></span></code> </pre><br>  GNS3 Edit-&gt; Preferences "Terminal command" <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">unset</span></span> TMUX; tmux new-window -t GNS3 -n <span class="hljs-string"><span class="hljs-string">'%d'</span></span> <span class="hljs-string"><span class="hljs-string">'telnet %h %p ; cat'</span></span> &gt;/dev/null 2&gt;&amp;1 &amp;</code> </pre>  and using the dynamips-over-ssh option <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">unset</span></span> TMUX; tmux new-window -t GNS3 -n <span class="hljs-string"><span class="hljs-string">'%d'</span></span> <span class="hljs-string"><span class="hljs-string">'/home/%username%/IOS/rdyn.sh -R %p'</span></span> &gt;/dev/null 2&gt;&amp;1 &amp;</code> </pre> <br><br><h6>  Materials: <br>  - <a href="http://forum.gns3.net/">forum.gns3.net</a> <br>  - man dynamips <br>  - man tmux <br></h6></div><p>Source: <a href="https://habr.com/ru/post/135884/">https://habr.com/ru/post/135884/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135878/index.html">Instagram filters like Photoshop Actions</a></li>
<li><a href="../135880/index.html">To begin, reboot</a></li>
<li><a href="../135881/index.html">How to put your products on the show like PMA / CES?</a></li>
<li><a href="../135882/index.html">Habrarebresta in Arkhangelsk</a></li>
<li><a href="../135883/index.html">Extending hook_node_info () to customize comments, display, and other things.</a></li>
<li><a href="../135885/index.html">Fresh free Cyrillic fonts: PT Mono, ROSA Arion, ROSA Verde, Oxygen</a></li>
<li><a href="../135886/index.html">How to implement bloom post effect in flash</a></li>
<li><a href="../135887/index.html">Startup? Tie</a></li>
<li><a href="../135888/index.html">Epigram (imitation of John Harington)</a></li>
<li><a href="../135890/index.html">Acer has introduced its own "cloud", AcerCloud</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>