<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How not to wind rating on Habr√©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In continuation of the article . Tale about how Habr patched one more way to cheat the rating faster than I could poked on that. 


 We continue to ex...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How not to wind rating on Habr√©</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/web/12e/989/145/12e9891453fc49efa76f36d0e0045744.png"><br>  In continuation of the <a href="https://habrahabr.ru/post/332296/">article</a> .  Tale about how Habr patched one more way to cheat the rating faster than I could poked on that. </p><br><p>  We continue to explore the site API Habrahabr and accidentally find changes in the mechanics of rating calculation. </p><br><p>  I want to say from the shore that the article is of an entertaining nature and does not pretend to be scientific. <br>  So, if you are good today, then welcome under cat. </p><br><a name="habracut"></a><br><h2 id="vstuplenie">  Introduction </h2><br><p>  Well, Habr, you have imposed a limit of 3 posts per day, but you can‚Äôt just forbid flood in the comments.  And as we know, every comment is <del>  vitamins, proteins and calcium </del>  potential 0.1 ratings, which in total give about the same amount as posts. </p><br><p>  You might think: "Aah, just spawn comments with pluses and that's it ... Well, it's not interesting," but not here - we'll scoff at the Hubr API and catch funny bugs. </p><br><p>  So, for this recipe, we need: one old article, so as not to attract attention, and a verified account of a friend, which we will push into the top. </p><br><p>  By the way, despite the fact that the article is old (as much as six months already), it still crawls into the most discussed one: <br><img src="https://habrastorage.org/web/572/c2f/203/572c2f203eac478e910a6bb161d8c6ba.png"></p><br><p>  Fortunately, this is the most discussed thing, far from hanging on the front page, you can not worry. </p><br><p>  In essence, we need two requests: to post a comment and approve it. </p><br><h2 id="api">  API </h2><br><p>  As it turned out, in the request for posting a comment, everything is rather clumsy, but found a strange thing.  The parameters in the API for the desktop version and the mobile version are somewhat different. </p><br><p>  For example, creating a comment from a regular browser, we send the following request, specifying the value add as action: <br><img src="https://habrastorage.org/web/82e/6cf/bcb/82e6cfbcbc45404986578fc5d8f3a861.png"><br>  But if you do the same thing from the mobile version, which comes with the prefix m.  in the way of the site, now the action gets the value of mobile_add: <br><img src="https://habrastorage.org/web/a8c/626/0a9/a8c6260a93304a7785ca9ade48770290.png"><br>  This solution is a bit surprising, since it is possible to determine the site behavior at the level of mobile-specific headers.  Nevertheless, I did not find significant differences in behavior on this basis. </p><br><p>  A small digression. <br>  I tried to see how it was done in the habr iOS application, but everything turned out to be extremely serious and SSL Pinning was turned on, which prohibits eavesdropping, which cannot be bypassed even with the help of a fake root certificate: <br><img src="https://habrastorage.org/web/08b/cfb/a61/08bcfba611864510bb8b821191098370.png"><br>  Now while trying to arrange <del>  hara-kiri </del>  jailbreak your iPhone to get the opportunity to play with the API through <a href="https://github.com/nabla-c0d3/ssl-kill-switch2">black magic</a> , but this is still in progress.  Technically, the API is generally open, there is even a string on a <a href="https://github.com/kafeman/habrahabr-api-python-client">boa</a> and a <a href="https://github.com/thematicmedia/habrahabr_api">puff</a> , but without a token issued by the habr, nothing will work.  Or just find an Android device, but there also need a witch. </p><br><p>  But with the voting all the more interesting. <br>  It turned out that the method of voting for comments and articles in general is the same and differs only in the only parameter responsible for the article in which there is a comment. <br>  Let me remind you the structure for voting for an article: </p><br><pre><code class="ruby hljs">body = { <span class="hljs-comment"><span class="hljs-comment"># id  'ti' =&gt; params[:id], 'tt' =&gt; 2, 'v' =&gt; 1 }</span></span></code> </pre> <br><p>  And this is how the structure of voting for a comment in it looks like: </p><br><pre> <code class="ruby hljs">body = { <span class="hljs-comment"><span class="hljs-comment">#   id  'ti' =&gt; params[:id], 'tt' =&gt; 3, #    id  'pti' =&gt; 322908, 'v' =&gt; 1 }</span></span></code> </pre> <br><p>  In my humble opinion, done a little crooked. <br>  The same parameter in the same action has two different purposes.  In general, this is one request for two different actions.  But it‚Äôs not for me to judge Habr, it all works in the end. </p><br><p>  And you can calm down, run the script and go to drink tea, but that would be boring. <br>  We will play with the parameters.  What if the <em>v</em> field is set to 100?  No, writes that the page is not found.  Or maybe -100?  Same. </p><br><p>  In general, habr to any wrong action always returns 404: <br><img src="https://habrastorage.org/web/32a/b13/b4c/32ab13b4c9a946d1b2eed29c71d323bf.png"><br>  Whether it is an error in a parameter or something else.  It is impossible to understand whether there really is no page or you were simply sealed somewhere.  It‚Äôs probably effective against hackers, but was it convenient during the site development process? </p><br><p>  And nevertheless at some point Habr freaked out: <br><img src="https://habrastorage.org/web/272/341/2d4/2723412d40034c13bae7157472637211.png"><br>  It happened when <em>v</em> became zero.  I heard something like that in kindergarten from a caregiver when I was throwing bread at lunch. </p><br><p>  And if there is still a wrong comment <em>id</em> to indicate, then we will still be scolded: <br><img src="https://habrastorage.org/web/4b6/83d/bf8/4b683dbf8cc74a33a07fa9bbf984dcb0.png"></p><br><p>  Of the interesting points, I noticed that the comment number is incremented by 2, not one. <br>  That is, if the first comment comes with the value: </p><br><pre> <code class="bash hljs">comment_100002</code> </pre> <br><p>  then the next one will be </p><br><pre> <code class="bash hljs">comment_100004</code> </pre> <br><p>  I am sure that one more comment could not interpose between them.  The situation was stably reproduced over a dozen tests late at night with a split in a split second. <br>  But maybe I'm wrong.  If anyone can explain the logic of this phenomenon, then write in the comments. </p><br><h2 id="smertnye-grehi">  Mortal sins </h2><br><p>  But what about without the human factor.  This time I decided not to hide and simply rivet comments on my old article, without hiding it in drafts.  And this was my fatal mistake. </p><br><p>  Someone was so baked on the kind of undeserved advantages that he was not too lazy to go and put minus for each of the <strong>50</strong> (oh my god) comments: <br><img src="https://habrastorage.org/web/134/96c/8ec/13496c8ecdbc4c46bf764dacbcc88ddb.png"></p><br><p>  Fortunately or not, by that moment the shop was already covered, I do not have time to score a dozen points.  I noticed it only after a full run of the script, going to the profile to enjoy my victory ... but I was only waiting for complete disappointment. </p><br><p>  Naturally, I decided not to leave it just like that and headed straight for support with the question of where my rating went, which I had so hard worked out.  And that's what they said to me: <br><img src="https://habrastorage.org/web/8da/766/3bb/8da7663bb0a445fa92a597670dd55aa0.png"></p><br><p>  Apparently, "not so noticeable" now means "nothing at all." </p><br><p>  Seriously, to the direct question of how many comments are now added to the ratings, the support replied: "We are not authorized to disclose this information." </p><br><p>  Even when later I independently walked through other people's comments in different articles, leaving the pros and cons to reveal any dependence, nothing happened, unfortunately.  Regardless of how many have already voted for a certain comment, a lot or no one at all, my vote could not change the rating of the author. </p><br><p>  If you have any information about this, I will be glad to hear. </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  That's how Habr rapidly cooled my ardor, showing that I was still far from a hacker. </p><br><p>  In general, of course, the essence is not in the markup, but in the research of the site.  The impression is that in Habr√©, as elsewhere, there is a multitude of legacy code and solutions left over from the launch of the project that simply makes no sense to redo it. <br>  Next time we will dig in a more serious direction, towards the real API used in the mobile application, which even looks superficially professional. </p><br><p>  <strong>UPD1:</strong> Numbers of comments go through 2 for compatibility with Geektimes: on Habr√© even, on Geektimes odd.  Thanks to <a href="https://habrahabr.ru/users/lexnekr/" class="user_link">lexnekr</a> for the <a href="https://habrahabr.ru/post/333358/">clarification</a> . <br>  <strong>UPD2:</strong> A special opinion approached about the increment id.  It is said that this is due to the MySQL configuration.  Thanks <a href="https://habrahabr.ru/users/yourock/" class="user_link">youROCK</a> and <a href="https://habrahabr.ru/users/kafeman/" class="user_link">kafeman</a> for <a href="https://habrahabr.ru/users/kafeman/" class="user_link">info</a> . <br>  I would be grateful for the proofs if someone can provide them. <br>  <strong>UPD3:</strong> But I am more impressed with the <a href="https://habrahabr.ru/post/319426/">third</a> opinion: <br><img src="https://habrastorage.org/web/f65/bef/0bb/f65bef0bb14b404b8706b8caec9b101e.png"></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/333358/">https://habr.com/ru/post/333358/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../333348/index.html">Where to go, what to read, with whom to communicate on professional topics: a roadmap for an iOS developer</a></li>
<li><a href="../333350/index.html">Sieve of Eratosthenes, an attempt to minimize memory</a></li>
<li><a href="../333352/index.html">Applications in the electronic document management system. Part 6: Views</a></li>
<li><a href="../333354/index.html">World Champions - about sports programming</a></li>
<li><a href="../333356/index.html">BFGS method or one of the most effective optimization methods. Python implementation example</a></li>
<li><a href="../333360/index.html">The balance between security devices in proxy mode and the impact on network performance</a></li>
<li><a href="../333362/index.html">Scala Collection: Secrets and Tricks</a></li>
<li><a href="../333364/index.html">Identify numbers with CallKit</a></li>
<li><a href="../333366/index.html">How much is your company worth? Brief on business valuation</a></li>
<li><a href="../333368/index.html">Startup cycle: how (in general) venture investment works</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>