<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Four-channel voltmeter 0-50V based on the set of "Digital Lab" NR05</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Often there is a need to simultaneously control several voltages, for example, the output voltages of a computer power supply unit, several batteries,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Four-channel voltmeter 0-50V based on the set of "Digital Lab" NR05</h1><div class="post__text post__text-html js-mediator-article">  Often there is a need to simultaneously control several voltages, for example, the output voltages of a computer power supply unit, several batteries, etc. In the <a href="https://geektimes.ru/company/masterkit/blog/273864/">last publication,</a> we examined the principle of operation of the code lock, and now, based on the <a href="http://masterkit.ru/%3F2016109">Digital Lab NR05 expansion board</a> , we assemble a four-channel digital voltmeter with indication of results on the built-in board display.  The range of measured voltages can be changed using an external divider, and the measurement step is determined by the digit capacity of the Atmega 328 microcontroller‚Äôs Atmega 328 microcontroller used in the Arduino board and amounts to 1024 values.  Then, in the voltage range of 0-50V, the voltage measurement step will be about 50 mV, which is quite enough for domestic use. <br><br><img src="https://habrastorage.org/files/1c8/740/bbe/1c8740bbebde493992785c65a2974e5e.jpg" width="500"><br><a name="habracut"></a><br>  The measured voltages will be connected to the free analog inputs of the board.  These are the inputs A0, A4, A5 and A7, located in the lower right of the board.  To use the A0 input, temporarily drop the resistor R4 located near the XP3 connector on the bottom right of the board. <br><br><img src="https://habrastorage.org/files/725/c9b/33d/725c9b33dd8e44b7999e89b30c2d566c.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      An external divider with connectors for connecting measured voltages and expansion boards will be manufactured using the LUT method (the so-called ‚Äúlaser-iron technology‚Äù) and weed the board in a solution of ferric chloride.  We used SMD resistors, but if you do not have a laser printer, you can make a divider by drawing the conductors with a waterproof felt-tip pen.  In this case, it is better to use output resistors, since the dimensional accuracy of the resulting conductors will be lower.  In detail, the manufacturing technology of printed circuit boards by the method of etching in <a href="http://masterkit.ru/%3F1923400">ferric chloride</a> can be studied by purchasing the Master Kit production <a href="http://masterkit.ru/%3F1923400">set NN201</a> . <br><br>  The finished divider board is shown in the photo below. <br><br><img src="https://habrastorage.org/files/528/eb4/bd8/528eb4bd8c1e4c6799e66e46b7dffed5.jpg"><br><br>  The expansion board has a 2-line LCD indicator with 16 characters in each line.  On this indicator, four readings from 0 to 50 volts with one decimal place and channel IDs will be quite comfortable. <br><br>  The measurements themselves should be carried out several times over a short period of time, averaging their values.  So we will reduce random measurement errors. <br>  We also realize in the program ‚Äúfreezing‚Äù the results when you click on one of the buttons built into the board, for example, the middle one.  With a second press, continuous measurements will resume. <br><br>  We activate the LED connected to the 13th digital output of Arduino to indicate the measurement process. <br><br>  In view of the above, we will create a program for Arduino: <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler</b> <div class="spoiler_text">  / * ------------------------------------------------ -------------- <br>  Four-channel voltmeter 0-50V, with averaging, <br>  one digit after the decimal point, with display on the LCD-indicator <br>  16 characters, 2 lines, <br><br>  Used expansion card from a set of Master Kit <br>  NR05 "Digital Laboratory";  4 dividers for 10 on resistors <br>  1M, 100k connected with analog inputs A0, A4, A5, A7 <br><br>  Voltage Reference Calibration <br>  Measure the voltage of 5V and change the values ‚Äã‚Äãof the constant V_REF <br>  according to the measured value. <br>  Measure Voltage with LCD Connected <br>  and with a running sketch. <br><br>  Determination of the calibration values ‚Äã‚Äãof the dividers (held <br>  for each divider) <br>  Connect the stable voltage Vin to the input of the divider and <br>  measure it. <br>  Measure the voltage Vout at the output of the divider. <br>  The calibration DIV_ * value will be Vin / Vout. <br><br>  The project is based on <a href="http://startingelectronics.com/">startingelectronics.com</a> <br>  -------------------------------------------------- ------------ * / <br>  #include &lt;LiquidCrystal.h&gt; <br><br>  // built-in LED (used to indicate the measurement process) <br>  #define LED 13 <br>  // number of samples per measurement <br>  #define NUM_SAMPLES 20 <br>  // divider calibration values <br>  #define DIV_1 11.186 <br>  #define DIV_2 11.186 <br>  #define DIV_3 11.186 <br>  #define DIV_4 11.186 <br>  // calibration value of the reference voltage <br>  #define V_REF 4.575 <br>  // number of buttons on the board <br>  #define NUM_KEYS 5 <br>  // calibration values ‚Äã‚Äãfor each button (derived experimentally) <br>  int adcKeyVal [NUM_KEYS] = {30, 150, 360, 535, 760}; <br><br>  LiquidCrystal lcd (A1, A2, A3, 2, 4, 7); <br>  unsigned long sum [4] = {0};  // sum of samples in each channel <br>  unsigned char sample_count = 0;  // current sample number <br>  float voltage [4] = {0.0};  // calculated voltage <br>  int cnt = 0;  // service variable <br>  int keyIsPressed = 0;  // flag of pressing the ‚Äúfreezing‚Äù button of measurements <br><br>  void setup () <br>  { <br>  lcd.begin (16, 2); <br>  pinMode (LED, OUTPUT); <br>  digitalWrite (LED, LOW); <br>  } <br><br>  void loop () <br>  { <br>  // if button 3 is pressed, we invert the flag of pressing the ‚Äúfreezing‚Äù button <br>  if (get_key () == 3) { <br>  keyIsPressed =! keyIsPressed; <br>  delay (500); <br>  } <br>  // if the flag is set (1), the information on the display is not updated <br>  if (keyIsPressed == 0) { <br>  digitalWrite (LED, LOW); <br>  // take samples in each channel and summarize them <br>  while (sample_count &lt;NUM_SAMPLES) { <br>  // sample channel A0, A4, A5, A7 <br>  sum [0] + = analogRead (A0); <br>  sum [1] + = analogRead (A4); <br>  sum [2] + = analogRead (A5); <br>  sum [3] + = analogRead (A7); <br>  sample_count ++; <br>  delay (10); <br>  } <br>  digitalWrite (LED, HIGH); <br>  // calculate the voltage in each channel by averaging the samples <br>  for (cnt = 0; cnt &lt;4; cnt ++) { <br>  voltage [cnt] = ((float) sum [cnt] / (float) NUM_SAMPLES * V_REF) / 1024.0; <br>  } <br>  // display the values ‚Äã‚Äãon the idicator <br>  lcd.setCursor (0, 0); <br>  lcd.print (‚ÄúA‚Äû); <br>  lcd.print (voltage [0] * DIV_1, 1); <br>  lcd.print (‚ÄúV‚Äû); <br>  // voltage 2 - B (A4 pin) <br>  lcd.setCursor (8, 0); <br>  lcd.print (‚ÄúB‚Äû); <br>  lcd.print (voltage [1] * DIV_2, 1); <br>  lcd.print (‚ÄúV‚Äû); <br>  // voltge 3 - C (pin A5) <br>  lcd.setCursor (0, 1); <br>  lcd.print (‚ÄúC‚Äû); <br>  lcd.print (voltage [2] * DIV_3, 1); <br>  lcd.print (‚ÄúV‚Äû); <br>  // voltage 4 - D (pin A7) <br>  lcd.setCursor (8, 1); <br>  lcd.print (‚ÄúD‚Äû); <br>  lcd.print (voltage [3] * DIV_4, 1); <br>  lcd.print (‚ÄúV‚Äû); <br><br>  // reset the counter and the amount <br>  sample_count = 0; <br>  for (cnt = 0; cnt &lt;4; cnt ++) sum [cnt] = 0; <br>  delay (20); <br>  } <br>  } <br><br>  // function returns the number of the button pressed <br>  int get_key () <br>  { <br>  int input = analogRead (A6); <br>  int k; <br>  for (k = 0; k &lt;NUM_KEYS; k ++) <br>  if (input &lt;adcKeyVal [k]) <br>  return k + 1; <br>  return 0; <br>  } <br></div></div><br><br>  The program is provided with sufficiently detailed comments explaining the features of the implementation of the algorithm. <br><br>  Perhaps the most important feature is the process of calibration of the constants described in the comments, which are involved in the calculation of the measured voltages.  To calibrate the divider (made once), you should use a stable constant voltage source.  Taking into account that the calibration takes a short time, you can successfully use a 9V battery of the ‚ÄúKrona‚Äù type and a digital multimeter.  A multimeter from the "Set of the young electronics engineer" NR02 is quite suitable.  This kit is also great for teaching soldering and PCB assembly. <br><br>  It should be noted that when the supply voltage to the Arduino changes, it is necessary to change the calibration values ‚Äã‚Äãof the reference voltage, the relative values ‚Äã‚Äãof which are measured values. <br><br>  To change the measurement range, you must apply a divider with a different division factor of the input voltage. <br><br><img src="https://habrastorage.org/files/fa0/05b/268/fa005b268fa4431ca6ee067bb716048a.jpg"></div><p>Source: <a href="https://habr.com/ru/post/393225/">https://habr.com/ru/post/393225/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../393215/index.html">Japan will replace farmers with robots and unmanned tractors</a></li>
<li><a href="../393217/index.html">Geohot hacker will work on unmanned cars - Tesla competitor together ... with the lead engineer Tesla Motors</a></li>
<li><a href="../393219/index.html">What to expect IT-specialist in the field of finance: Requirements and technologies used</a></li>
<li><a href="../393221/index.html">Viber introduces end-to-end encryption after WhatsApp and Telegram</a></li>
<li><a href="../393223/index.html">Circulation of drugs in nature: the drug is eliminated from the body again goes into food</a></li>
<li><a href="../393227/index.html">Taking aspirin increases the chances of cancer patients to survive by 20%.</a></li>
<li><a href="../393229/index.html">DARPA has tested a drone with 24 impellers and vertical takeoff</a></li>
<li><a href="../393231/index.html">MI Guitar - guitar for those who want to play the guitar, but do not want to learn it</a></li>
<li><a href="../393233/index.html">Simple and effective movement system in virtuality: controller in pants</a></li>
<li><a href="../393235/index.html">At the Vostochny cosmodrome, the Soyuz 2.1a launch vehicle was installed for the first launch</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>