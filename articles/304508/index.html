<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Windocks - SQL Server and .NET containers on Windows Server 2012 R2 with docker api support</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear readers of Habr. Today we will talk about Windocks, a product of the company of the same name, positioning itself as the first docker engi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Windocks - SQL Server and .NET containers on Windows Server 2012 R2 with docker api support</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/1c9/e08/4d2/1c9e084d2e5140dfb3687385ed0edc48.png"><br><br>  Hello, dear readers of Habr.  Today we will talk about <a href="https://windocks.com/">Windocks, a</a> product of the company of the same name, positioning itself as the first docker engine for Windows.  While Microsoft clients are expecting a new version of Windows Server, namely Windows Server 2016 (at the time of writing, <a href="https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-technical-preview">Technical Preview 5 is available</a> ) with <a href="http://www.infoworld.com/article/2973492/application-virtualization/windows-server-containers-arrive-with-docker-support.html">native support for docker containers</a> , the creators of windocks tried to provide docker containers for the current generation of windows server systems. <br><br>  So, what is Windocks?  In short, this is a mixture of a ported version of an existing daemon docker and an <a href="https://windocks.com/blog-2/windows-server-2012-containers/">open source container project</a> from <a href="https://github.com/UhuruSoftware">Uhuru Software</a> .  About the features of Windocks and the challenges that faced the developers, you can read <a href="https://windocks.com/blog-2/docker-windows">here</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As part of this material, we will try to figure out how working with windocks is fundamentally different from working with the <a href="https://docs.docker.com/engine/installation/linux/">original daemon for linux</a> , what are the limitations of the current version of windocks and whether to embed the tool in its development and testing processes. <a name="habracut"></a><br><br><h2>  What is available now </h2><br>  At the time of this writing, windocks supports the following operating systems: <br><ul><li>  Windows 8 / 8.1 </li><li>  Windows 10 </li><li>  Windows Server 2012 / Windows Server 2012 R2 </li><li>  Windows Server 2016 </li></ul><br><br>  In these OSs you can create containers from images: <br><ul><li>  SQL Server 2016/2014/2012/2008 R2 / 2008 </li><li>  Net 4.5 / 3.5 / 2.0 </li><li>  Jenkins (agents, demos upon request) </li><li>  Office conversion (for converting powerpoint presentations to video, demo upon request) </li><li>  Microsoft Dynamics (line of ERP and CRM solutions, demo on request) </li></ul><br><br><h2>  Deploy windocks to VPS with Windows Server 2012 </h2><br>  <a href="http://www.prweb.com/releases/2016/06/prweb13478472.htm">More recently,</a> Windocks announced the release of the community edition, in order to be able to get acquainted with the product features for free.  This version we will deploy.  We send a request through the <a href="https://windocks.com/leads/add%3Fsrc%3Ddownloadcommunity">form on the site</a> .  The answer comes instantly, and in a minute the link is already with us. <br><br>  We will use <a href="http://ruvds.com/">VPS</a> with 2x2.6GHz configuration, 2GB RAM, 20GB HDD / Windows Server 2012 R2 as the environment for deployment of windocks.  In order to use SQL Server containers on a VPS, you must install SQL Server.  Install and then install the windocks itself.  No additional settings are required during the installation process. <br><br>  <a href="https/">Generate certificates and keys</a> for the host and for the client to configure two-way authentication and provide them with windocks: <br><pre><code class="dos hljs">server-key.pem -&gt; C:\Users\Administrator\.docker\key.pem server-cert.pem -&gt; C:\Users\Administrator\.docker\cert.pem ca.pem -&gt; C:\Users\Administrator\.docker\ca.pem</code> </pre> <br><br>  Now run the windocks (the launch command looks a little different than for the Linux docker daemon): <br><pre> <code class="dos hljs">docker -H tcp://WINDOCKS_IP:<span class="hljs-number"><span class="hljs-number">2376</span></span> -dD --tlsverify=true</code> </pre> <br><br>  In the launch logs see: <br><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">time</span></span>="<span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">06</span></span>-<span class="hljs-number"><span class="hljs-number">30</span></span>T14:<span class="hljs-number"><span class="hljs-number">32</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span>.<span class="hljs-number"><span class="hljs-number">901345300</span></span>+<span class="hljs-number"><span class="hljs-number">03</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>" level=info msg="Daemon has completed initialization"</code> </pre> <br>  Do not forget to allow incoming connections to tcp port 2376 in the firewall for the desired ip-addresses. <br><br><h2>  Connect using standard docker client </h2><br>  As you probably guessed from the title, Windocks supports <a href="https://docs.docker.com/engine/reference/api/docker_remote_api/">docker RESTful api</a> .  This means that you can use the <a href="https://windocks.com/lps/reference">standard console client docker</a> to work with it.  However, windocks currently do not support all commands, but <a href="https://windocks.com/lps/reference">only part of them.</a>  DockerFile also supports a limited set of commands (FROM, ADD, COPY, ADDDB, MOUNTDB).  A complete list of commands for comparison can be found <a href="https://docs.docker.com/engine/reference/builder/">here</a> . <br><br>  We connect to the windocks absolutely as well as to the usual docker host (we recommend creating aliases commands for working with the client, in windows you can do this, for example, using DOSKEY): <br><pre> <code class="dos hljs">docker.exe --tlsverify --tlscacert=ca.pem --tlscert=cert.pem --tlskey=key.pem -H=WINDOCKS_IP:<span class="hljs-number"><span class="hljs-number">2376</span></span> version</code> </pre> <br><br>  As a result, we get something like: <br><pre> <code class="dos hljs">Client version: <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">7</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> Client API version: <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span> Go version (client): go1.<span class="hljs-number"><span class="hljs-number">4</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> Git commit (client): <span class="hljs-number"><span class="hljs-number">0</span></span>baf609 OS/Arch (client): windows/amd64 Server version: $VERSION Server API version: <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span> Go version (server): go1.<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> Git commit (server): $GITCOMMIT OS/Arch (server): windows/amd64</code> </pre><br><br><h2>  Run the .NET application in windocks </h2><br>  Windocks has its own local registry of images, which in the community addition contains 2 images by default: dotnet and mssql.  Its contents can be obtained by running (we believe that we have already done an alias with the parameters for authentication using certificates): <br><pre> <code class="dos hljs">docker images</code> </pre> <br><br>  Result: <br><img src="https://habrastorage.org/files/156/508/a1f/156508a1f6de4244867a60c8c20df38c.png"><br><br>  So, 2 basic images are available to us: dotnet-4.5 and mssql-2014.  Together with Windocks there is a set of samples that <a href="https://windocks.com/blog-2/Start-SQL-Server-Containers">demonstrate its capabilities.</a> <a href="https://windocks.com/blog-2/Start-SQL-Server-Containers"><br></a> <br>  As part of this article, we will look at testMountDb and testDotnet samples.  The first mounts into a container created on the basis of the mssql-2014 image, the base for the test application.  The second is using this database to work in another container.  Copy them to the client OS to work directly with a standard client. <br><br>  Collect the container from the sample testMountDb and run it. <br><pre> <code class="dos hljs">docker build testMountDb</code> </pre> <br><br>  We get the following: <br><pre> <code class="dos hljs">Sending build context to Docker daemon <span class="hljs-number"><span class="hljs-number">2</span></span>.<span class="hljs-number"><span class="hljs-number">048</span></span> kB Sending build context to Docker daemon Step <span class="hljs-number"><span class="hljs-number">0</span></span> : FROM mssql-<span class="hljs-number"><span class="hljs-number">2014</span></span> Step <span class="hljs-number"><span class="hljs-number">1</span></span> : MOUNTDB customers C:\dcr\mountDbExample\customerdata.mdf ContainerId = c4d6e4f7bdc9cfc4c8b62b09572b255f43b56716d862b28e291e7af86e08bc3f &amp; ContainerPort = <span class="hljs-number"><span class="hljs-number">10001</span></span> &amp; ContainerUserName = prison_oo_aqRdapH &amp; ContainerPassword = Pr!<span class="hljs-number"><span class="hljs-number">5</span></span>n5A39SvNRo &amp; MSSQLPort = <span class="hljs-number"><span class="hljs-number">10001</span></span> &amp; MSSQLServerUserName = sa &amp; MSSQLServer SaPassword = Pr!<span class="hljs-number"><span class="hljs-number">54</span></span>q0flmqoM1 &amp; DockerFile output: &amp; Line <span class="hljs-number"><span class="hljs-number">2</span></span>- Mounted DB: customers, C:\ dcr \mountDbExample\customerdata.mdf</code> </pre><br><br>  From here we will need MSSQLServerUserName and SaPassword, which we will use in web.cfg in the connection string. <br>  Run the created container: <br><pre> <code class="dos hljs">docker <span class="hljs-built_in"><span class="hljs-built_in">start</span></span> c4d</code> </pre> <br><br>  Now we will assemble the container from the testDotnet sample and run (all the same): <br><pre> <code class="dos hljs">docker build testDotnet</code> </pre> <br><br>  Result: <br><pre> <code class="dos hljs">SECURITY WARNING: You are building a Docker image from Windows against a Linux Docker host. All files and directories added to build context will have '-rwxr-xr-x' permissions. It is recommended to double check and reset permissions <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> sensitive files and directories. Sending build context to Docker daemon <span class="hljs-number"><span class="hljs-number">20</span></span>.<span class="hljs-number"><span class="hljs-number">99</span></span> kB Sending build context to Docker daemon Step <span class="hljs-number"><span class="hljs-number">0</span></span> : FROM dotnet-<span class="hljs-number"><span class="hljs-number">4</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span> Step <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">COPY</span></span> web.config app-root\\runtime\\repo Step <span class="hljs-number"><span class="hljs-number">2</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">COPY</span></span> default.aspx app-root\\runtime\\repo Step <span class="hljs-number"><span class="hljs-number">3</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">COPY</span></span> default.aspx.cs app-root\\runtime\\repo Step <span class="hljs-number"><span class="hljs-number">4</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">COPY</span></span> main.css app-root\\runtime\\repo Step <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">COPY</span></span> windockslogo.png app-root\\runtime\\repo Step <span class="hljs-number"><span class="hljs-number">6</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">COPY</span></span> testrun.bat . Step <span class="hljs-number"><span class="hljs-number">7</span></span> : RUN <span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span>.exe /C .\testrun.bat ContainerId = <span class="hljs-number"><span class="hljs-number">3</span></span>b8cefeef04d3ac5010fa8e37b04ce42aa207359e4848581222d521839ea7a04 &amp; ContainerPort = <span class="hljs-number"><span class="hljs-number">10003</span></span> &amp; ContainerUserName = prison_oo_P4yo5gA &amp; ContainerPassword = Pr!<span class="hljs-number"><span class="hljs-number">5</span></span>c6g8mVfQq7 &amp; DOTNETPort = <span class="hljs-number"><span class="hljs-number">10003</span></span> &amp; DockerFile output: PS docker <span class="hljs-built_in"><span class="hljs-built_in">start</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>b8</code> </pre><br><br>  Open in browser <pre> <code class="html hljs xml">http://WINDOCKS_IP:10003</code> </pre>  and, if done correctly, we see the following: <br><img src="https://habrastorage.org/files/dbd/1da/21f/dbd1da21ffc343089e94e94fa934b122.jpg"><br><br>  Now save the application image in the windocks registry by doing the following: <br><pre> <code class="dos hljs">docker commit a29 windocks_dotnet_demo_v1</code> </pre> <br><br>  And display an updated list of images: <br><pre> <code class="dos hljs">docker images</code> </pre> <br><br><img src="https://habrastorage.org/files/a8c/ea8/cee/a8cea8cee3774b578faa3919f440858e.png"><br><br>  Now other users can use the windocks_dotnet_demo_v1 image. <br><br><h2>  findings </h2><br>  In our opinion, despite the fact that windocks is quite limited (what we have mentioned at the very beginning of the article) is a tool compared to a docker for Linux, it copes well with its standard tasks for providing SQL Server and .NET containers.  It can also be quite comfortable to use for developing and testing applications on ASP.NET 4.5 / MSSQL in small teams, however, for use in production, the tool is still too young and may still become irrelevant after the release of Windows Server 2016. What do you think, dear readers? </div><p>Source: <a href="https://habr.com/ru/post/304508/">https://habr.com/ru/post/304508/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304492/index.html">Translation of C ++ project for development with unit testing / TDD</a></li>
<li><a href="../304496/index.html">Kodogenerator-based music generator</a></li>
<li><a href="../304502/index.html">Mathematical notation: Past and Future</a></li>
<li><a href="../304504/index.html">CRM communications</a></li>
<li><a href="../304506/index.html">Intel Edison, Windows Phone and Microsoft Azure: Cloud Console and LED Union</a></li>
<li><a href="../304510/index.html">Latest C ++ Development News</a></li>
<li><a href="../304514/index.html">Root - a robot that helps children learn programming</a></li>
<li><a href="../304516/index.html">What is AXON</a></li>
<li><a href="../304518/index.html">How HTTP / 2 will make the web faster</a></li>
<li><a href="../304520/index.html">Four ways to extract values ‚Äã‚Äãfrom hidden fields in C #</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>