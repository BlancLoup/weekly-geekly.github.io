<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>UHF RFID Reader connect to NodeJS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What for? 
 UHF Reader allows you to control the tags at a distance of 10 meters, which gives interesting perspectives for various uses. The most obvi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>UHF RFID Reader connect to NodeJS</h1><div class="post__text post__text-html js-mediator-article"><h2>  What for? </h2><br>  UHF Reader allows you to control the tags at a distance of 10 meters, which gives interesting perspectives for various uses.  The most obvious one is the control of passing vehicles.  But you can come up with more exotic options: control of equipment in the garage / shed.  It is unlikely that the thief would think that the RFID tag was glued to the bike (tool case), and he was able to report his departure beyond the limits of the observed perimeter. <br>  NodeJS + RaspberryPI is a flexible and cheap server for data processing and peripheral management. <br><br><h2>  Equipment </h2><br>  I took tests CF-RU5109 (CHAFON), which supports RS232, RS485, Wiegand, TCP connections. <a name="habracut"></a>  (I need TCP only for the convenience of hardware testing) <br>  Model Page - <a href="http://www.chafon.com/productdetails.aspx%3Fpid%3D537">CF-RU5109</a> <br><br>  Tags - rfid gen2 uhf paper tag with Alien H3 chip 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Read range.  Experiments have shown that the reading depends on the activity of the label (its movement in space).  The passively lying label is read confidently at a distance of 3 meters, moving slowly - 5-5.5 meters, at a distance of 8 meters it was necessary to actively swing a hand.  My reader has an integrated 9dbi antenna. <br><br><img src="https://habrastorage.org/webt/da/t1/hr/dat1hr2re-wwzcc0hylpkbeoyai.jpeg"><br><br><img src="https://habrastorage.org/webt/je/ub/ag/jeubagdzhntkafr8dbvpqgra5jk.jpeg"><br><br><h2>  Soft </h2><br>  The reader is accompanied by an SDK, a detailed description of the commands, several test programs under Windows.  I use this software only to try to work with the Reader - we do not need anything from working with NodeJS. <br><br><h2>  Connect to Node </h2><br><pre><code class="javascript hljs">tcpclient.prototype.Start = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> net.Socket(); client.setEncoding(<span class="hljs-string"><span class="hljs-string">'ascii'</span></span>); client.connect(<span class="hljs-number"><span class="hljs-number">6000</span></span>, <span class="hljs-string"><span class="hljs-string">'192.168.0.190'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ }); client.on(<span class="hljs-string"><span class="hljs-string">'connect'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'UHF reader connected'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bytes = Buffer.from([<span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0xff</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x19</span></span>, <span class="hljs-number"><span class="hljs-number">0x95</span></span>], <span class="hljs-string"><span class="hljs-string">"ascii"</span></span>); client.write(bytes); client.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'UHF reader respond:'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> buffer = Buffer.from(data, <span class="hljs-string"><span class="hljs-string">"ascii"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(buffer); }); }); client.on(<span class="hljs-string"><span class="hljs-string">'close'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'UHF reader - connection closed'</span></span>); }); client.on(<span class="hljs-string"><span class="hljs-string">'error'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(err) }); }; tcpclient.prototype.Write = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bytes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Buffer(req, <span class="hljs-string"><span class="hljs-string">"ascii"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(bytes); client.write(bytes); };</code> </pre> <br>  From the manual.  The command block is structured as follows: <br>  Len, Adr, Cmd, Data [], LSB-CRC16, MSB-CRC16 <br><br>  The last two bytes are the CRC16 checksum, with the polynomial 0x8408, the starting number 0xFFFF.  Bytes are displayed in the reverse order.  The manufacturer has kindly provided the C code for the calculation, and I rewrote it in JS (see below). <br><br>  Accordingly, [0x04, 0xff, 0x21, 0x19, 0x95] is a command that requests the status of the reader at the default address FF.  04-length, 21-team, 19 and 95 - CRC16 checksum. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> PRESET_VALUE = <span class="hljs-number"><span class="hljs-number">0xFFFF</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> POLYNOMIAL = <span class="hljs-number"><span class="hljs-number">0x8408</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> CRC16 = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pucY</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> uiCrcValue = PRESET_VALUE; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; pucY.length; i++){ uiCrcValue = uiCrcValue ^ (pucY[i]); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; <span class="hljs-number"><span class="hljs-number">8</span></span>; j++){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(uiCrcValue &amp; <span class="hljs-number"><span class="hljs-number">0x0001</span></span>){ uiCrcValue = (uiCrcValue &gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) ^ POLYNOMIAL; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { uiCrcValue = (uiCrcValue &gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>); } } } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> buf = Buffer.from(uiCrcValue.toString(<span class="hljs-number"><span class="hljs-number">16</span></span>), <span class="hljs-string"><span class="hljs-string">'hex'</span></span>); buf = Buffer.from([buf[<span class="hljs-number"><span class="hljs-number">1</span></span>], buf[<span class="hljs-number"><span class="hljs-number">0</span></span>]], <span class="hljs-string"><span class="hljs-string">'hex'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> buf; }; <span class="hljs-comment"><span class="hljs-comment">//CRC16([0x04, 0xff, 0x21]); //returns &lt;Buffer 19 95&gt;</span></span></code> </pre> <br><h2>  Command Examples </h2><br>  <b>Inventory</b> - a request to read the card once.  Operates in Answer-mode <br><br><pre> <code class="javascript hljs">req =[<span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xdb</span></span>, <span class="hljs-number"><span class="hljs-number">0x4b</span></span>]; tcpClient.Write(req);</code> </pre> <br>  If the label is in sight, then we get the answer <br><blockquote>  UHF reader respond: <br>  &lt;Buffer 13 00 01 01 01 0c 62 00 51 79 17 19 00 04 05 60 5b 28 2f 24&gt; </blockquote>  62 00 51 79 17 19 00 04 05 60 5b 28 is a tag tag. <br><br><h3>  Switching reader operation modes </h3><br>  <b>Answer-mode</b> : [0x0a, 0x00, 0x35, 0x00, 0x02, 0x01, 0x00, 0x01, 0x00, 0x2a, 0x9f] <br>  <b>Scan / Active mode</b> : [0x0a, 0x00, 0x35, 0x01, 0x02, 0x01, 0x00, 0x01, 0x00, 0x01, 0x9b].  In this mode, the reader constantly polls tags and gives them tags. <br><br><h2>  What's next? </h2><br>  And further, if a simple solution is required, then either we write code that sends the 0x01 (Inventory) command at intervals.  Tags in the visible area give their tags, we compare them with the database and initiate the appropriate actions.  Or we write code that, in the constant scan mode, waits for the mark to enter the zone of visibility and responds with an event. </div><p>Source: <a href="https://habr.com/ru/post/423369/">https://habr.com/ru/post/423369/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../423351/index.html">Tor Browser switched to Firefox Quantum and Photon UI codebase</a></li>
<li><a href="../423353/index.html">Who is the monopolist of pirated video content in runet?</a></li>
<li><a href="../423359/index.html">We study the mat with CalculiX</a></li>
<li><a href="../423363/index.html">Give us back the headphone jack: why USB-C audio is still not working</a></li>
<li><a href="../423367/index.html">Discover Azure DevOps</a></li>
<li><a href="../423371/index.html">Volvo introduced an autonomous electric truck without cab</a></li>
<li><a href="../423375/index.html">Korean scientists have found a way to avoid damage to the tokamak walls due to plasma instability</a></li>
<li><a href="../423377/index.html">Build pgModeler</a></li>
<li><a href="../423379/index.html">Why giving up cash may be too expensive for developing countries</a></li>
<li><a href="../423381/index.html">Control over resources. Customize SwiftGen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>