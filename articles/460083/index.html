<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create Redux-like global storage using React Hooks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! I present to you the translation of the article "Build a Redux-like Global Store Using React Hooks" by Ramsay. 


 Let's imagine that I wrot...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create Redux-like global storage using React Hooks</h1><div class="post__text post__text-html js-mediator-article"><p>  Hi, Habr!  I present to you the translation of the article <a href="https://dev.to/ramsay/build-a-redux-like-global-store-using-react-hooks-4a7n">"Build a Redux-like Global Store Using React Hooks"</a> by Ramsay. </p><br><p>  Let's imagine that I wrote an interesting preface to this article and now we can immediately move on to really interesting things.  In short, we will <br>  use <strong>useReducer</strong> and <strong>useContext</strong> to create a custom React hook that provides access to a global repository like Redux. </p><a name="habracut"></a><br><p>  I do not in any way assume that this solution is the full equivalent of Redux, because I am sure that it is not.  By saying "redux-like", I mean, <br>  That you will update the repository using <em>dispatch</em> and <em>actions</em> , which will mutate the state of the repository and return a new copy of the mutated state. <br>  If you have never used Redux, just pretend not to read this paragraph. </p><br><h2 id="huki">  Hooks </h2><br><p>  Let's start by creating a context ( <em>hereafter</em> <strong>Context</strong> ) that will contain our state ( <em>hereafter</em> <strong>state</strong> ) and the dispatch function ( <em>hereafter</em> <strong>dispatch</strong> ).  We will also create the <strong>useStore</strong> function, which will behave like our hook. </p><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// store/useStore.js import React, { createContext, useReducer, useContext } from "react"; //     const initialState = {} const StoreContext = createContext(initialState); // useStore    React       export const useStore = store =&gt; { const { state, dispatch } = useContext(StoreContext); return { state, dispatch }; };</span></span></code> </pre> <br><p>  Since everything is stored inside the <a href="https://ru.reactjs.org/docs/context.html">React Context</a> , you need to create a <a href="https://ru.reactjs.org/docs/context.html">Provider</a> that will give <br>  The <strong>state</strong> object and the <strong>dispatch</strong> function.  <strong>The provider</strong> is where we use <strong>useReducer</strong> . </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// store/useStore.js ... const StoreContext = createContext(initialState); export const StoreProvider = ({ children }) =&gt; { const [state, dispatch] = useReducer(reducer, initialState); return ( &lt;StoreContext.Provider value={{ state, dispatch }}&gt; {children} &lt;/StoreContext.Provider&gt; ); }; ...</span></span></code> </pre> <br><p>  We use <strong>useReducer</strong> to get <strong>state</strong> and <strong>dispatch</strong> .  Actually, this is exactly what <a href="https://ru.reactjs.org/docs/hooks-reference.html">useReducer</a> does.  Next, we pass <strong>state</strong> and <strong>dispatch</strong> to <strong>Provider</strong> . <br>  Now we can wrap any React component using <strong>&lt;Provider /&gt;</strong> and this component will be able to use <strong>useStore</strong> to interact with the repository. </p><br><p>  We have not created a <strong>reducer</strong> .  This will be our next step. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// store/useStore.js ... const StoreContext = createContext(initialState); //    actions,     state const Actions = {}; // reducer   ,  action    dispatch // action.type -  ,     Actions //   update   state      const reducer = (state, action) =&gt; { const act = Actions[action.type]; const update = act(state); return { ...state, ...update }; }; ...</span></span></code> </pre> <br><p>  I'm a big fan of separating <em>actions</em> and <em>state</em> into logical groups, for example: you may need to track the state of the counter (a classic example of the counter implementation) or the state of the user (whether the user has logged into the system or his personal preferences). <br>  In some component, you may need access to both of these states, so the idea of ‚Äã‚Äãstoring them in a single global repository makes sense.  We can divide our <em>actions</em> into logical groups, such as <strong>userActions</strong> and <strong>countActions</strong> , which will make managing them much easier. </p><br><p>  Let's create the <strong>countActions.js</strong> and <strong>userActions.js files</strong> in the store folder. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// store/countActions.js export const countInitialState = { count: 0 }; export const countActions = { increment: state =&gt; ({ count: state.count + 1 }), decrement: state =&gt; ({ count: state.count - 1 }) };</span></span></code> </pre> <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// store/userActions.js export const userInitialState = { user: { loggedIn: false } }; export const userActions = { login: state =&gt; { return { user: { loggedIn: true } }; }, logout: state =&gt; { return { user: { loggedIn: false } }; } };</span></span></code> </pre> <br><p>  In both of these files, we export the <strong>initialState</strong> , because we want to later merge them in the <strong>useStore.js</strong> file into a single <strong>initialState</strong> object. <br>  We also export the Actions object, which provides functions for state mutations.  Notice that we do not return a new state object, because we want this to happen in a <strong>reducer</strong> , in the file <strong>useStore.js</strong> . </p><br><p>  Now we import all this into <strong>useStore.js</strong> to get the full picture. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// store/useStore.js import React, { createContext, useReducer, useContext } from "react"; import { countInitialState, countActions } from "./countActions"; import { userInitialState, userActions } from "./userActions"; //    (initial states) const initialState = { ...countInitialState, ...userInitialState }; const StoreContext = createContext(initialState); //  actions const Actions = { ...userActions, ...countActions }; const reducer = (state, action) =&gt; { const act = Actions[action.type]; const update = act(state); return { ...state, ...update }; }; export const StoreProvider = ({ children }) =&gt; { const [state, dispatch] = useReducer(reducer, initialState); return ( &lt;StoreContext.Provider value={{ state, dispatch }}&gt; {children} &lt;/StoreContext.Provider&gt; ); }; export const useStore = store =&gt; { const { state, dispatch } = useContext(StoreContext); return { state, dispatch }; };</span></span></code> </pre> <br><p>  We did it!  Make a lap of honor, and when you return, we will see how to use all this in a component. </p><br><p>  Welcome back!  I hope your lap was truly honorable.  Let's look at <strong>useStore</strong> in action. </p><br><p>  First, we can wrap our <strong>App</strong> component in <strong>&lt;StoreProvider /&gt;</strong> . </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// App.js import React from "react"; import ReactDOM from "react-dom"; import { StoreProvider } from "./store/useStore"; import App from "./App"; function Main() { return ( &lt;StoreProvider&gt; &lt;App /&gt; &lt;/StoreProvider&gt; ); } const rootElement = document.getElementById("root"); ReactDOM.render(&lt;Main /&gt;, rootElement);</span></span></code> </pre> <br><p>  We wrap the <strong>App</strong> in <strong>StoreProvider</strong> so that the child component would have access to the value from the provider.  This value is both <strong>state</strong> and <strong>dispatch</strong> . </p><br><p>  Now, let's assume that we have an <strong>AppHeader</strong> component that has a login / logout button. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// AppHeader.jsx import React, {useCallback} from "react"; import { useStore } from "./store/useStore"; const AppHeader = props =&gt; { const { state, dispatch } = useStore(); const login = useCallback(() =&gt; dispatch({ type: "login" }), [dispatch]); const logout = useCallback(() =&gt; dispatch({ type: "logout" }), [dispatch]); const handleClick = () =&gt; { loggedIn ? logout() : login(); } return ( &lt;div&gt; &lt;button onClick={handleClick}&gt; {loggedIn ? "Logout" : "Login"}&lt;/button&gt; &lt;span&gt;{state.user.loggedIn ? "logged in" : "logged out"}&lt;/span&gt; &lt;span&gt;Counter: {state.count}&lt;/span&gt; &lt;/div&gt; ); }; export default AppHeader;</span></span></code> </pre> <br><p>  <a href="https://codesandbox.io/s/xpjm9p052z%3Ffrom-embed">Link to Code Sandbox with full implementation</a> </p><br><p>  Original author: <a href="https://dev.to/ramsay">Ramsay</a> <br>  <a href="https://dev.to/ramsay/build-a-redux-like-global-store-using-react-hooks-4a7n">Link to the original</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/460083/">https://habr.com/ru/post/460083/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../460054/index.html">Tips for freelancers: how to catch zen while working</a></li>
<li><a href="../460058/index.html">Incredibly true stories from the life of tech support</a></li>
<li><a href="../460060/index.html">Creating Amazon Prime, the most successful and destructive membership program in Internet history</a></li>
<li><a href="../46007/index.html">Functional python</a></li>
<li><a href="../460070/index.html">Crafts from non-working HDD - mini-pump</a></li>
<li><a href="../460087/index.html">Pyramid sorting (HeapSort)</a></li>
<li><a href="../460089/index.html">Zimbra Collaboration Suite secure upgrade</a></li>
<li><a href="../46009/index.html">How did I get a job at Guerrilla</a></li>
<li><a href="../460091/index.html">Direct printing on T-shirts with Epson SureColor SC ‚Äì F and its difference from silk-screen printing, decal and sublimation</a></li>
<li><a href="../460095/index.html">Caught ban for fork deepNude on gitlab.com</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>