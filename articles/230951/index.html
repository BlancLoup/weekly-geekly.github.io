<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Build routes with OpenStreetMap, OSRM and Leaflet</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi% username%! I want to write a small article about how to use OpenStreetMap, OSRM and Leaflet to create routes in your project. I will not tell what...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Build routes with OpenStreetMap, OSRM and Leaflet</h1><div class="post__text post__text-html js-mediator-article">  Hi% username%!  I want to write a small article about how to use OpenStreetMap, OSRM and Leaflet to create routes in your project.  I will not tell what the above technologies are - I‚Äôve written about them more than once already, the article will be small and only relevant.  So, if you want to build routes - please under the cat. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d47/623/d4e/d47623d4e6a86dbe60b59cc92a2b2789.png" alt="image"><br><a name="habracut"></a><br>  So let's get started.  To work, we need JQuery and Leaflet.  The latter can be taken on the official website - <a href="http://leafletjs.com/">leafletjs.com</a> <br>  If you wish, you can use CDN (I‚Äôd just note that it loads quite quickly). <br><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Next we need a container where the map will be loaded.  Create a div and give it a map id <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  If necessary, it can set the width / height, use in pop-up windows, etc. <br>  Now directly initialization - we bind the map to our div. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> map = L.map(<span class="hljs-string"><span class="hljs-string">'map'</span></span>);</code> </pre> <br><br>  After that the map is loaded into our div.  But what in this case will load Leaflet?  Obviously not the city where we are.  To fix this, we write the following code: <br><br><pre> <code class="javascript hljs">map.setView([<span class="hljs-number"><span class="hljs-number">55.7422</span></span>, <span class="hljs-number"><span class="hljs-number">37.5719</span></span>], <span class="hljs-number"><span class="hljs-number">11</span></span>);</code> </pre> <br><br>  This design will load us a map of Moscow (coordinates must be inserted in the LatLng sequence, zoom), where zoom is the scale.  Oh yeah, I almost forgot - we need to specify where to get the images for the map.  Sources can be very different, from the official site to your own server.  Take the official website: <br><br><pre> <code class="javascript hljs">L.tileLayer(<span class="hljs-string"><span class="hljs-string">'http://{s}.tile.osm.org/{z}/{x}/{y}.png'</span></span>).addTo(map);</code> </pre> <br><br>  At this stage we have in our div loaded map of the city we need.  Now let's start building routes.  To begin with, we will add a marker by clicking on the map.  In total there will be 2 markers - for the beginning of the path and the end, we will not do routing with several points for now.  So, we need to handle the 'click' event on the map.  I implemented it like this: <br><br><pre> <code class="javascript hljs">map.on(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ onMapClick(e); }); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMapClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loc1 == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { loc1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> L.marker(e.latlng, {<span class="hljs-attr"><span class="hljs-attr">draggable</span></span>: <span class="hljs-string"><span class="hljs-string">'true'</span></span>}); loc1.on(<span class="hljs-string"><span class="hljs-string">'dragend'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   }); map.addLayer(loc1); } else if (loc2 == null) { loc2 = new L.marker(e.latlng, {draggable: 'true'}); loc2.on('dragend', function(event) { //   }); map.addLayer(loc2); //   } } ;</span></span></code> </pre> <br><br>  After clicking on the map, the onMapClick function checks whether the points loc1 and loc2 exist.  If both points exist, only the movement of the marker on the map ('dragend') is tracked.  Dragging itself is enabled using the draggable: 'true' parameter.  There are markers, dragging is tracked, it remains only to fasten the drawing of the route.  Where to send a request is up to you, you can use OSRM (and I strongly advise you that this is a free tool with high speed).  I use my own server, which gives me the result of a polyline line.  On the Internet, there is a ready implementation for all the PLs for decoding this string into an array of values.  How to implement it in your case is up to you.  My decoding is done using php and the result is returned as an array of coordinates.  So, the method of sending requests and drawing routes: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> polyline; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendPost</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loc2 != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; loc1 != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p1 = loc1.getLatLng(), p2 = loc2.getLatLng(); $.post( <span class="hljs-comment"><span class="hljs-comment">//  , {l1: p1.lat + ',' + p1.lng, l2: p2.lat + ',' + p2.lng}, function(data) { if (data) { if (polyline) { map.removeLayer(polyline); } var points = data; polyline = new L.polyline(points, {color: 'red'}); map.addLayer(polyline); map.fitBounds(polyline.getBounds()); } }, "json" ); } }</span></span></code> </pre> <br><br>  I admit at once - I know javascript extremely terribly, but you probably already understood this.  But we will continue.  Set the polyline variable, which we will use later to create the route line.  The line will be added with a new layer so that when dragging, you can delete the old route.  If the request is successfully completed, the check is in progress - there is already a layer or not.  If it exists (i.e. there is already a route), the new one is deleted and built. <br><br>  That's basically it.  I ask experienced programmers not to swear much - the article is more focused on beginners like me.  When performing this task, I was faced with the lack of examples in the network for constructing routes using this library and other minor nuances that I encountered.  I will be happy to answer all your questions and add what you think I missed. </div><p>Source: <a href="https://habr.com/ru/post/230951/">https://habr.com/ru/post/230951/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230939/index.html">How I improved the performance of SSRS reports</a></li>
<li><a href="../230941/index.html">Modular comics - an easy way to captivate an audience</a></li>
<li><a href="../230943/index.html">Level generation in the arcade on the example of indie game</a></li>
<li><a href="../230945/index.html">Programmers, speak correctly!</a></li>
<li><a href="../230949/index.html">Tournament of Young Physicists</a></li>
<li><a href="../230955/index.html">GoPro Hero 3+ Black Edition - sight of the tourist and cyclist</a></li>
<li><a href="../230957/index.html">Magento step by step</a></li>
<li><a href="../230959/index.html">"Father of the Internet" Vint Cerf explains what ICANN is and how the Internet works</a></li>
<li><a href="../230961/index.html">A bit of Tor / I2P / Tails / SORM-3</a></li>
<li><a href="../230963/index.html">Microsoft has opened an account on Github</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>