<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>[Translation] Do not be afraid of functional programming</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I present to your attention the translation of Jonathan Morgan‚Äôs article on functional programming that has recently slipped into the digest links on ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>[Translation] Do not be afraid of functional programming</h1><div class="post__text post__text-html js-mediator-article">  I present to your attention the translation of Jonathan Morgan‚Äôs <a href="http://www.smashingmagazine.com/2014/07/02/dont-be-scared-of-functional-programming/">article</a> on functional programming that has recently slipped into the <a href="http://habrahabr.ru/post/228757/">digest</a> links on the example of JavaScript.  The material is designed for beginners, but nevertheless it is quite interesting. <br><br>  I would be grateful for constructive comments and suggestions for typos, translation and / or design.  Enjoy reading! <br><a name="habracut"></a><br><br><h4>  Do not be afraid of functional programming. </h4><br>  <b>Functional programming is a mustache hipster from programming paradigms.</b>  <b>Being a product of the times of the academic development of computer science, functional programming not long ago experienced a revival due to its great use when used in distributed systems (and, probably, due to the fact that ‚Äúpure‚Äù functional languages ‚Äã‚Äãlike Haskell are not easy to understand, which also leaves its mark).</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      More rigorous functional programming languages ‚Äã‚Äãare usually used when performance and coherence are critical - for example, if a program should always do exactly what is expected of it and work in an environment where tasks can be divided between hundreds and thousands of networked ones computers.  Clojure, for example, is at the core of Akamai, the huge content delivery network used by companies like Facebook, and Twitter perfectly adapted Scala for its most performance-demanding components, and AT &amp; T uses Haskell for the security systems of its networks. <br><br>  For most front-end developers, these languages ‚Äã‚Äãhave a steep learning curve;  However, many simpler and more accessible languages ‚Äã‚Äãhave features of functional programming ‚Äî at least the same Python with its standard library and its functions like <code>map</code> and <code>reduce</code> (which we will talk about later) and third-party libraries like Fn.py, or JavaScript that actively use methods of working with collections and having libraries like Underscore.js and Bacon.js. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/888/af7/234/888af7234731c42793bb69828f81d08c.png"><br><br>  Functional programming, of course, may seem complicated, but we must remember that it was created not only for doctors of science, adherents of data science and systems architecture gurus.  For most, the real benefit of the functional style is that the programs can be divided into smaller and simpler parts, more reliable and much more understandable at the same time.  If you are a frontend developer working with data, especially if you use <a href="http://d3js.org/">D3</a> , <a href="http://raphaeljs.com/">Raphael</a> or similar libraries for visualization, then functional programming can be a serious weapon in your arsenal. <br><br>  Finding a strict definition of functional programming is not easy, and most of the literature relies on statements like "well, there functions are first-class objects" and "side effects disappear."  If this has not yet torn your brain to pieces, then closer to theory, functional programming is often explained in terms of <a href="http://en.wikipedia.org/wiki/Lambda_calculus">lambda calculus</a> (although some argue that functional programming is, in principle, just mathematics), but please do not worry.  In fact, it is enough for a beginner to understand only two ideas in order to use functional programming for their daily tasks (and without any lambdas!). <br><br>  First, with the functional approach, the data must be unchanged (immobile), which sounds complicated, but it just means that they cannot change.  At first glance, this may look strange (after all, who needs a program that does not change anything?), But in fact you just constantly create new data structures instead of changing existing ones.  For example, if you need to do something with an array, you create a new array with new values ‚Äã‚Äãinstead of changing the old array.  Just the same! <br><br>  Secondly, programs in a functional style should not have a state, which, in general, means that they should be performed as if no one had done anything before them, and without information about what could or could not happen in the program previously (we can say that the program without a state does not take into account its past).  Together with immutability, this allows us to perceive each function as if it works in a vacuum, blissfully slaughtering everything else that is in the program, besides other functions.  It also means that the function works only with data transmitted as parameters, and therefore can perform its work independently of some external values. <br><br>  Data immutability and lack of state are the basis of functional programming, and it is extremely important to understand them, but don‚Äôt worry if everything is still vague for you.  By the end of the article you will understand the essence of these principles, and I promise that the beauty, accuracy and power of functional programming will turn your code into a bright, brilliant, gnawing rainbow data.  But for now, let's start with simple functions that return data (or other functions), and then combine them to perform more complex tasks. <br><br>  For example, suppose we have some response from the API: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = [{ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"Jamestown"</span></span>, <span class="hljs-attr"><span class="hljs-attr">population</span></span>: <span class="hljs-number"><span class="hljs-number">2047</span></span>, <span class="hljs-attr"><span class="hljs-attr">temperatures</span></span>: [<span class="hljs-number"><span class="hljs-number">-34</span></span>, <span class="hljs-number"><span class="hljs-number">67</span></span>, <span class="hljs-number"><span class="hljs-number">101</span></span>, <span class="hljs-number"><span class="hljs-number">87</span></span>] }, { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"Awesome Town"</span></span>, <span class="hljs-attr"><span class="hljs-attr">population</span></span>: <span class="hljs-number"><span class="hljs-number">3568</span></span>, <span class="hljs-attr"><span class="hljs-attr">temperatures</span></span>: [<span class="hljs-number"><span class="hljs-number">-3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>] }, { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"Funky Town"</span></span>, <span class="hljs-attr"><span class="hljs-attr">population</span></span>: <span class="hljs-number"><span class="hljs-number">1000000</span></span>, <span class="hljs-attr"><span class="hljs-attr">temperatures</span></span>: [<span class="hljs-number"><span class="hljs-number">75</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span>] }];</code> </pre><br>  If we want to use the graphic library to compare the average temperature and population, we need to write a little code that prepares the data for visualization.  Let our library for plotting graphs waiting for the input array <code>x</code> - and <code>y</code> coordinates, like this: <br><br><pre> <code class="javascript hljs">[ [x, y], [x, y] <span class="hljs-comment"><span class="hljs-comment">// ...  .. ]</span></span></code> </pre><br>  where <code>x</code> is the average temperature, and <code>y</code> is the population. <br><br>  Without functional programming (or without its application, i.e. in the <a href="http://en.wikipedia.org/wiki/Imperative_programming">imperative style</a> ), our code would look something like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> coords = [], totalTemperature = <span class="hljs-number"><span class="hljs-number">0</span></span>, averageTemperature = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; data.length; i++) { totalTemperature = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; data[i].temperatures.length; j++) { totalTemperature += data[i].temperatures[j]; } averageTemperature = totalTemperature / data[i].temperatures.length; coords.push([averageTemperature, data[i].population]); }</code> </pre><br>  Even in this example sucked from the finger is not easy to keep track of everything.  Well, let's see how to make everything clearer. <br><br>  The functional approach is always characterized by the search for simple, frequently repeated actions that can be distinguished in a function.  Then you can do more complex actions by calling these functions in a certain order (which is also called <a href="http://en.wikipedia.org/wiki/Function_composition">composition of functions</a> ) - I‚Äôll soon focus on this in more detail.  We define what needs to be done to bring the source data into the format required by the library.  Looking at the code at the edge of the eye, the following actions can be highlighted: <br><ul><li>  add each number to the list; </li><li>  calculate the average value; </li><li>  extract each property from the list of objects. </li></ul><br>  We will write a function for each of these actions, and then compose a program of these functions.  At the beginning, functional programming can be a bit confusing, and you will probably be tempted to fall back on your old imperative habits.  To prevent this from happening, I‚Äôll provide below a list of the main rules to ensure that you follow the best practices: <br><ul><li>  all your functions must take at least one parameter; </li><li>  all your functions must return either data or another function; </li><li>  no cycles! </li></ul><br>  Well, let's start the development.  Step one - add each number to the list.  Let's make a function that takes a parameter - an array of numbers, and returns some data. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">totalForArray</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arr</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   return total; }</span></span></code> </pre><br>  So far so good, but ... how can we get access to each element of the list if we cannot cycle around it?  Say hello to your new mate - recursion!  When you use recursion, you create a function that calls itself if the special exit condition is not fulfilled - in this case, the current value is simply returned.  It may not be clear, but look at this simplest example: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,      ‚Äî     function totalForArray(currentTotal, arr) { currentTotal += arr[0]; //    JavaScript-:    Array.shift, //          ,     var remainingList = arr.slice(1); //    ,   ()   , //  currentTotal ‚Äî   if (remainingList.length &gt; 0) { return totalForArray(currentTotal, remainingList); } // ,     ‚Äî       currentTotal else { return currentTotal; } }</span></span></code> </pre><br>  <b>Caution:</b> Recursion makes the code more readable and natural for programming in a functional style.  However, in some languages ‚Äã‚Äã(including JavaScript), problems will arise if the program makes too many recursive calls (at the time of writing the article ‚Äútoo many‚Äù - that's about 10,000 calls in Chrome, 50,000 calls in Firefox and 11,000 calls in Node.js).  Detailed parsing goes beyond the scope of this article, but the bottom line is that at least until the final release of <a href="https://leanpub.com/understandinges6/read">ECMAScript 6,</a> JavaScript will not support something called ‚Äútail recursion‚Äù - a more efficiently organized form of recursion.  This is a complex and infrequent topic, but nevertheless it is useful to know about it. <br><br>  Now back to our problem - we need to calculate the total temperature over the array of temperatures in order to then calculate the average.  Now, instead of traversing an array in a loop, we can simply write: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> totalTemp = totalForArray(<span class="hljs-number"><span class="hljs-number">0</span></span>, temperatures);</code> </pre><br>  If you are a perfectionist, you can say that the <code>totalForArray</code> function <code>totalForArray</code> also be broken down into functions.  For example, the addition of numbers may occur elsewhere in the program and, therefore, must also be performed by a separate function. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addNumbers</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b; }</code> </pre><br>  Now our <code>totalForArray</code> function looks something like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">totalForArray</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">currentTotal, arr</span></span></span><span class="hljs-function">) </span></span>{ currentTotal = addNumbers(currentTotal, arr[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> remainingArr = arr.slice(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (remainingArr.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> totalForArray(currentTotal, remainingArr); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> currentTotal; } }</code> </pre><br>  Excellent!  Getting a single value through an array is so often found in functional programming that it even has its own name ‚Äî <a href="http://en.wikipedia.org/wiki/Fold_%2528higher-order_function%2529">convolution</a> ‚Äî you may have heard as a verb ‚Äî something like ‚Äúminimize the list to a single meaning.‚Äù  JavaScript has a special method for doing this.  There is a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce">detailed description</a> on the Mozilla Developer Network, but for our task an example is enough: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//       ,   //          var totalTemp = temperatures.reduce(function(previousValue, currentValue) { //      currentValue   previousValue + currentValue, //    previousValue      return previousValue + currentValue; });</span></span></code> </pre><br>  But wait, we already defined the function <code>addNumbers</code> , so we can use it: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> totalTemp = temperatures.reduce(addNumbers);</code> </pre><br>  And since the bundle is so steep, let's separate it into a separate function, so that we can simply call it without having to remember all these intricate details. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">totalForArray</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arr</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> arr.reduce(addNumbers); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> totalTemp = totalForArray(temperatures);</code> </pre><br>  Oh, now the code is easy to read!  By the way, methods like convolutions are present in most functional languages.  These helper methods that perform actions on lists instead of messing <a href="http://en.wikipedia.org/wiki/Higher-order_function">around</a> with cycles are called <a href="http://en.wikipedia.org/wiki/Higher-order_function">higher order functions</a> . <br><br>  Well, moving on;  The next task in our list is to calculate the average.  It is very simple. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">average</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">total, count</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> total / count; }</code> </pre><br>  How far will we go to calculate the average of the entire array? <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">averageForArray</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arr</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> average(totalForArray(arr), arr.length); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> averageTemp = averageForArray(temperatures);</code> </pre><br>  I hope you started to understand how the composition of functions works to perform more complex tasks.  All this is possible due to following the rules listed at the beginning of the article, namely that functions must take parameters and return data.  Conveniently. <br><br>  Now we need to extract one property from each object in the array.  Instead of showing examples of recursion, I will focus on the important and show another method built into JavaScript: <a href="http://en.wikipedia.org/wiki/Map_%2528higher-order_function%2529"><code>map</code></a> .  This method is needed if you need to display an array of structures of one type in the list of structures of another type: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     ‚Äî ,  , //     var allTemperatures = data.map(function(item) { return item.temperatures; });</span></span></code> </pre><br>  All this is cool, but extracting a property from a collection of objects is something that is being done all the time, so we will write a function for that. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  ‚Äî  ,    function getItem(propertyName) { //  ,   ,     . //    ,       . return function(item) { return item[propertyName]; } }</span></span></code> </pre><br>  Wow, we wrote a function that returns a function!  Now we can pass it to the <code>map</code> method: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> temperatures = data.map(getItem(<span class="hljs-string"><span class="hljs-string">'temperature'</span></span>));</code> </pre><br>  If you like the details, I‚Äôll explain: the reason we can do this is that the JavaScript functions are ‚Äúfirst class objects,‚Äù which means that you can use the function just like any other value.  Although this can be done in many languages, this is one of the requirements for a language to be used for programming in a functional style.  By the way, this is also the reason why you can do things like <code>$('#my-element').on('click', function(e) { //... })</code> .  The second parameter of the <code>on</code> method is a function, and when you pass functions as parameters, you use them just as you would use ordinary values ‚Äã‚Äãin imperative languages.  Gracefully. <br><br>  Finally, we wrap the call to the <code>map</code> method into our own function to make it more readable. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pluck</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arr, propertyName</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> arr.map(getItem(propertyName)); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> allTemperatures = pluck(data, <span class="hljs-string"><span class="hljs-string">'temperatures'</span></span>);</code> </pre><br>  So, now we have a set of generic functions that can be used anywhere in the application and even in other projects.  We can count the elements of an array, get average values ‚Äã‚Äãover the array and create new arrays, extracting properties from the lists of objects.  Now, last but not least, let's return to the original problem: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = [{ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"Jamestown"</span></span>, <span class="hljs-attr"><span class="hljs-attr">population</span></span>: <span class="hljs-number"><span class="hljs-number">2047</span></span>, <span class="hljs-attr"><span class="hljs-attr">temperatures</span></span>: [<span class="hljs-number"><span class="hljs-number">-34</span></span>, <span class="hljs-number"><span class="hljs-number">67</span></span>, <span class="hljs-number"><span class="hljs-number">101</span></span>, <span class="hljs-number"><span class="hljs-number">87</span></span>] }, { <span class="hljs-comment"><span class="hljs-comment">// ... }];</span></span></code> </pre><br>  We need to convert an array of objects like the one above into an array of pairs <code>x</code> , <code>y</code> : <br><br><pre> <code class="javascript hljs">[ [<span class="hljs-number"><span class="hljs-number">75</span></span>, <span class="hljs-number"><span class="hljs-number">1000000</span></span>], <span class="hljs-comment"><span class="hljs-comment">// ... ];</span></span></code> </pre><br>  where <code>x</code> is the average temperature, and <code>y</code> is the population.  First, we extract the data we need: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> populations = pluck(data, <span class="hljs-string"><span class="hljs-string">'population'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> allTemperatures = pluck(data, <span class="hljs-string"><span class="hljs-string">'temperatures'</span></span>);</code> </pre><br>  Now calculate the list of averages.  It must be remembered that the function that we pass to the <code>map</code> method will be called for each element of the array;  the return value of the transferred function will be added to the new array, and this new array will be assigned to our variable <code>averageTemps</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> averageTemps = allTemperatures.map(averageForArray);</code> </pre><br>  So far, everything is OK, but now we have two arrays: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// populations [2047, 3568, 1000000] // averageTemps [55.25, 5.5, 75]</span></span></code> </pre><br>  But we need only one array, so we will write a function to combine them.  Our function will check that the element at index 0 from the first array is paired with the element at index 0 from the second array, and so on for the remaining indices from 1 to n (where n is the total number of elements of each of the arrays) [since in pure JavaScript is missing <a href="http://zvon.org/other/haskell/Outputprelude/zip_f.html"><code>zip</code></a> - approx.  translator]. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">combineArrays</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arr1, arr2, finalArr</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     finalArr = finalArr || []; //         finalArr.push([arr1[0], arr2[0]]); var remainingArr1 = arr1.slice(1), remainingArr2 = arr2.slice(1); //    ,    if ((remainingArr1.length === 0) &amp;&amp; (remainingArr2.length === 0)) { return finalArr; } else { // ! return combineArrays(remainingArr1, remainingArr2, finalArr); } }; var processed = combineArrays(averageTemps, populations);</span></span></code> </pre><br>  One-liners are fun: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> processed = combineArrays(pluck(data, <span class="hljs-string"><span class="hljs-string">'temperatures'</span></span>).map(averageForArray), pluck(data, <span class="hljs-string"><span class="hljs-string">'population'</span></span>)); <span class="hljs-comment"><span class="hljs-comment">// [ // [ 55.25, 2047 ], // [ 5.5, 3568 ], // [ 75, 1000000 ] // ]</span></span></code> </pre><br><br><h4>  Closer to life </h4><br>  Finally, consider a more realistic example, this time adding to our toolkit <a href="http://underscore.org/">Underscore.js</a> , a JavaScript library that provides many great support functions.  We will receive data from the <a href="http://crisis.net/">CrisisNET</a> service to collect information about collisions and disasters, and visualize them using the amazing <a href="http://d3js.org/">D3</a> library. <br><br>  The goal is to give CrisisNET visitors a picture of all the types of information offered by the service.  To do this, we will calculate the number of documents received through the API of the service corresponding to a certain category (for example, ‚Äúphysical violence‚Äù or ‚Äúarmed conflict‚Äù).  So the user will be able to see how much information is available on those topics that seem to him the most interesting. <br><br>  A bubble chart can be a great option because they are often used to represent the relative sizes of large groups of people.  Fortunately, D3 supports a special type of diagram called <code>pack</code> .  Well, let's make such a graph, and let it show the number of times that the specified category name appears in the response from the CrisisNET API. <br><br>  Before we begin, it should be recalled that D3 is a complex library that requires separate study.  Since this article focuses on functional programming, we will not waste time describing how D3 works.  Do not worry - if you are not familiar with this library, you can always copy the code to disassemble it.  <a href="http://alignedleft.com/tutorials/d3">Scott Murray‚Äôs D3 Tutorial</a> is a great source of knowledge about this library. <br><br>  First of all, make sure that we have a DOM element in which D3 can place the graph generated from our data. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bubble-graph"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Now create our chart and place it in the DOM. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   var diameter = 960, format = d3.format(",d"), //    20  color = d3.scale.category20c(), //  ,       var bubble = d3.layout.pack() .sort(null) .size([diameter, diameter]) .padding(1.5); //   DOM SVG-,  D3     var svg = d3.select("#bubble-graph").append("svg") .attr("width", diameter) .attr("height", diameter) .attr("class", "bubble");</span></span></code> </pre><br>  The <code>pack</code> object takes an array of objects of the following format: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">children</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">className</span></span>: , <span class="hljs-attr"><span class="hljs-attr">package</span></span>: <span class="hljs-string"><span class="hljs-string">"cluster"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: }] }</code> </pre><br>  CrisisNET API returns the following data format: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">summary</span></span>: <span class="hljs-string"><span class="hljs-string">"Example summary"</span></span>, <span class="hljs-attr"><span class="hljs-attr">content</span></span>: <span class="hljs-string"><span class="hljs-string">"Example content"</span></span>, <span class="hljs-comment"><span class="hljs-comment">// ... tags: [{ name: "physical-violence", confidence: 1 }] }] }</span></span></code> </pre><br>  We see that each document has a tag property ( <code>tag</code> ), and this property contains an array of elements, each of which has a <code>name</code> property that contains a name ‚Äî that is what we need.  We will have to count the number of times the name of each tag is found in the results returned by the CrisisNET API.  To begin with, we extract the information we need using the <code>pluck</code> function already written. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tagArrays = pluck(data, <span class="hljs-string"><span class="hljs-string">'tags'</span></span>);</code> </pre><br>  Now we have an array of this format: <br><br><pre> <code class="javascript hljs">[ [{ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"physical-violence"</span></span>, <span class="hljs-attr"><span class="hljs-attr">confidence</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }], [{ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"conflict"</span></span>, <span class="hljs-attr"><span class="hljs-attr">confidence</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }] ]</code> </pre><br>  But we need a single array of all tags.  Hmm, <code>flatten</code> 's use the convenient <code>flatten</code> function from Underscore.js - it will extract values ‚Äã‚Äãfrom nested arrays and return us one common array without nesting. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tags = _.flatten(tagArrays);</code> </pre><br>  Well, now it's a little easier to work with our array: <br><br><pre> <code class="javascript hljs">[{ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"physical-violence"</span></span>, <span class="hljs-attr"><span class="hljs-attr">confidence</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"conflict"</span></span>, <span class="hljs-attr"><span class="hljs-attr">confidence</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }]</code> </pre><br>     <code>pluck</code>   ,    ‚Äî    . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tagNames = pluck(tags, <span class="hljs-string"><span class="hljs-string">'name'</span></span>); [ <span class="hljs-string"><span class="hljs-string">"physical-violence"</span></span>, <span class="hljs-string"><span class="hljs-string">"conflict"</span></span> ]</code> </pre><br> ,   . <br><br>       ‚Äî   ,        ,      ,     .    ,       ‚Äî         [   ¬´¬ª (¬´arrays¬ª),    , , ,            ‚Äî . ].       : <br><br><pre> <code class="javascript hljs">[ [<span class="hljs-string"><span class="hljs-string">"physical-violence"</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>], [<span class="hljs-string"><span class="hljs-string">"conflict"</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>] ]</code> </pre><br>       ,     ‚Äî  ,    ‚Äî ,     .    ,        .  , Underscore.js     . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tagNamesUnique = _.uniq(tagNames);</code> </pre><br>     <code>false</code> - ( <code>false</code> , <code>null</code> , <code>""</code>  ..) <code>y</code> -,     Underscore.js: <br><br><pre> <code class="javascript hljs">tagNamesUnique = _.compact(tagNamesUnique);</code> </pre><br>   ,    ,     JavaScript  ‚Äî <code>filter</code> ,     ,    . <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeArrayCount</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">keys, arr</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      return keys.map(function(key) { return [ key, //        arr.filter(function(item) { return item === key; }).length ] }); }</span></span></code> </pre><br>       ,   D3    <code>pack</code> ,    <code>map</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> packData = makeArrayCount(tagNamesUnique, tagNames).map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tagArray</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">className</span></span>: tagArray[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-attr"><span class="hljs-attr">package</span></span>: <span class="hljs-string"><span class="hljs-string">"cluster"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: tagArray[<span class="hljs-number"><span class="hljs-number">1</span></span>] } });</code> </pre><br> ,      D3    DOM-   SVG ‚Äî         ,    ,        API CrisisNET. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setGraphData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> node = svg.selectAll(<span class="hljs-string"><span class="hljs-string">".node"</span></span>) <span class="hljs-comment"><span class="hljs-comment">//      .data(bubble.nodes(data) .filter(function(d) { return !d.children; })) .enter().append("g") .attr("class", "node") .attr("transform", function(d) { return "translate(" + dx + "," + dy + ")"; }); //       node.append("circle") .attr("r", function(d) { return dr; }) .style("fill", function(d) { return color(d.className); }); //         node.append("text") .attr("dy", ".3em") .style("text-anchor", "middle") .style("font-size", "10px") .text(function(d) { return d.className }); }</span></span></code> </pre><br>   ,      <code>setGraphData</code>  <code>makeArray</code>   ,    API CrisisNET   jQuery (,    <a href="http://api.crisis.net/"> API-</a> ).    <a href="https://github.com/gati/lilfunc/blob/master/smashing.html">    </a>  GitHub. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dataResponse</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tagNames = pluck(_.flatten(pluck(dataResponse.data, <span class="hljs-string"><span class="hljs-string">'tags'</span></span>)), <span class="hljs-string"><span class="hljs-string">'name'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tagNamesUnique = _.uniq(tagNames); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> packData = makeArrayCount(tagNamesUnique, tagNames).map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tagArray</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">className</span></span>: tagArray[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-attr"><span class="hljs-attr">package</span></span>: <span class="hljs-string"><span class="hljs-string">"cluster"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: tagArray[<span class="hljs-number"><span class="hljs-number">1</span></span>] } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> packData; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateGraph</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dataResponse</span></span></span><span class="hljs-function">) </span></span>{ setGraphData(processData(dataResponse)); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> apikey = <span class="hljs-comment"><span class="hljs-comment">//  API-  : http://api.crisis.net var dataRequest = $.get('http://api.crisis.net/item?limit=100&amp;apikey=' + apikey); dataRequest.done(updateGraph);</span></span></code> </pre><br>      ,      !    ,       ,         ! <br><br>          ,     ,     .   ,       ,     ,       .       ,         ‚Äî  ,    ! </div><p>Source: <a href="https://habr.com/ru/post/228893/">https://habr.com/ru/post/228893/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../228871/index.html">Google closes orkut</a></li>
<li><a href="../228875/index.html">5 key elements of friendly notifications</a></li>
<li><a href="../228877/index.html">Where games grow from. Interview with David Helgason - CEO Unity</a></li>
<li><a href="../228879/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ116 (June 29 - July 6, 2014)</a></li>
<li><a href="../228881/index.html">We implement pull to refresh and infinite scrolling on Swift</a></li>
<li><a href="../228895/index.html">Digest of articles on data analysis No. 4 (06.23.2014 ‚Äî06.07.2014)</a></li>
<li><a href="../228897/index.html">FiDELYS: smart watches, fitness tracker and security system</a></li>
<li><a href="../228899/index.html">Elena, "electronic girl" from the support service</a></li>
<li><a href="../228901/index.html">When you need something almost ready</a></li>
<li><a href="../228903/index.html">Hackspace (technical creativity club) opened in Nizhnevartovsk</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>