<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dynamic favicon or display karma without refreshing the page</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For each of us, I believe, several tabs are constantly open in your favorite browser at the same time. More than once there are cases that the tab hea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dynamic favicon or display karma without refreshing the page</h1><div class="post__text post__text-html js-mediator-article"><img src="http://img5.imagebanana.com/img/33726pgt/_002.png" alt="image" align="right"><br>  For each of us, I believe, several tabs are constantly open in your favorite browser at the same time.  More than once there are cases that the tab header is not visible - only <a href="http://ru.wikipedia.org/wiki/Favicon">favicons</a> .  But often they do not provide information other than displaying the site‚Äôs logo.  And, probably, in vain.  But we will try to use this place here (as much as 16px * 16px!) As we want.  At the very least, we will know how to do it. <br><a name="habracut"></a><br><h4>  Don't even try to change &lt;link [rel = "icon"] ... /&gt;. </h4><br>  Someone may exclaim: ‚ÄúWhy is it so difficult?  I took the link tag and changed the src in it! ‚Äù.  But it was not there, comrades.  This code will not work: <br><blockquote><ol><li> <code><font color="black"><font color="#0000ff">var</font> oldicons = <font color="#0000ff">document</font> .querySelectorAll( <font color="#A31515">'link[rel="icon"], link[rel="shortcut icon"]'</font> ); <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> i = 0; i &lt; oldicons.length; i++ ) { oldicons[i].setAttribute( <font color="#A31515">"src"</font> , <font color="#A31515">"/newicon.png"</font> ); }</font></code> </li> <li> <code><font color="black"><font color="#0000ff">var</font> oldicons = <font color="#0000ff">document</font> .querySelectorAll( <font color="#A31515">'link[rel="icon"], link[rel="shortcut icon"]'</font> ); <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> i = 0; i &lt; oldicons.length; i++ ) { oldicons[i].setAttribute( <font color="#A31515">"src"</font> , <font color="#A31515">"/newicon.png"</font> ); }</font></code> </li> <li> <code><font color="black"><font color="#0000ff">var</font> oldicons = <font color="#0000ff">document</font> .querySelectorAll( <font color="#A31515">'link[rel="icon"], link[rel="shortcut icon"]'</font> ); <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> i = 0; i &lt; oldicons.length; i++ ) { oldicons[i].setAttribute( <font color="#A31515">"src"</font> , <font color="#A31515">"/newicon.png"</font> ); }</font></code> </li> <li> <code><font color="black"><font color="#0000ff">var</font> oldicons = <font color="#0000ff">document</font> .querySelectorAll( <font color="#A31515">'link[rel="icon"], link[rel="shortcut icon"]'</font> ); <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> i = 0; i &lt; oldicons.length; i++ ) { oldicons[i].setAttribute( <font color="#A31515">"src"</font> , <font color="#A31515">"/newicon.png"</font> ); }</font></code> </li> </ol></blockquote><br>  This one too: <br><blockquote><ol><li>  $ ( <font color="#A31515">'link [rel = "shortcut icon"]'</font> ) .attr ( <font color="#A31515">"src"</font> , <font color="#A31515">"/newicon.png"</font> ); </li></ol></blockquote><br>  Why so - I will not say (someone will explain?), But it can be done like this (on jQuery): <br><blockquote><ol><li>  $ ( <font color="#A31515">'link [rel $ = icon]'</font> ) .remove (); </li><li>  $ ( <font color="#A31515">'head'</font> ) .append ($ ( <font color="#A31515">'&lt;link rel = "shortcut icon" type = "image / x-icon" /&gt;'</font> ) .attr ( <font color="#A31515">'href'</font> , <font color="#A31515">"/newicon.png"</font> )); </li></ol></blockquote><br><br>  That is, we first delete the element, if any, and then add it as a child to the head tag.  Instead of <i>remove (),</i> you can also use <i>replaceWith ('')</i> . <br><br>  Since we need dynamic favicons, we will draw them on canvas, and then use it as favicons. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote><ol><li>  <font color="#0000ff">var</font> c = <font color="#0000ff">document</font> .createElement ( <font color="#A31515">'canvas'</font> ); </li><li>  c.height = c.width = 16; </li><li>  <font color="#0000ff">var</font> x = c.getContext ( <font color="#A31515">'2d'</font> ); </li><li>  x.font = <font color="#A31515">'18px bold Calibri'</font> ; </li><li>  x.fillStyle = <font color="#A31515">'# 000'</font> ; </li><li>  <font color="#0000ff">if</font> (m) { </li><li>  x.fillText (parseInt (m [1])&gt; 9? <font color="#A31515">'9+'</font> : m [1], 0, 16, 16); </li><li>  } </li></ol></blockquote><br><br><h4>  Use __defineSetter__ </h4><br>  In GMail, the number of new messages is displayed in the header: <br> <code> (15) - v.pupkin@gmail.com - GMail</code> <br>  Let's extract from there regexp'om tsiferku and get the number of new messages. <br><br>  To avoid this, you can use Google XML / API, but you need authorization for it, and I will not consider this method, since this is not about GMail mail.  And how it is possible to process changes of title of a window, without resorting to different window.setTimeOut.  To do this, we will take the Gecko's __defineSetter__ method (read more about it <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object/defineSetter">here</a> ). <br><br>  This method allows you to use an event handler when the data of an element changes (but has not yet changed): <br><blockquote><ol><li>  Object.prototype .__ defineSetter __ ( <font color="#A31515">'Id'</font> , <font color="#0000ff">function</font> (data) { </li><li>  alert ( <font color="#A31515">"hooked data ="</font> + data); </li><li>  }); </li></ol></blockquote><br>  This example shows that when the id attribute of the Object element changes (and this can be any tag or global variable), we will be shown an alert alert ("hooked data =" + data); <br><br>  And let's hang this "handler" on document.title, after which we will perform all of the above actions, thus summing up the first part of the article. <br><blockquote><ol><li>  <font color="#0000ff">document</font> .__ defineSetter __ ( <font color="#A31515">'title'</font> , <font color="#0000ff">function</font> (v) { </li><li>  delete <font color="#0000ff">document</font> .title;  <font color="#008000">// remove the old "handler"</font> </li><li>  <font color="#0000ff">document</font> .title = v;  <font color="#008000">// intercept new data and put into variable</font> </li><li>  <font color="#0000ff">document</font> .__ defineSetter __ ( <font color="#A31515">'title'</font> , arguments.callee);  <font color="#008000">// and quickly return the handler to the place</font> </li><li>  <font color="#0000ff">var</font> m = / \ (([0-9] +) \) /. exec (v);  <font color="#008000">// we take a regular bite with the number of messages with a variable</font> </li><li>  <font color="#0000ff">var</font> c = <font color="#0000ff">document</font> .createElement ( <font color="#A31515">'canvas'</font> );  <font color="#008000">// start the canvas.</font>  <font color="#008000">Create a canvas</font> </li><li>  c.height = c.width = 16;  <font color="#008000">// and assign it dimensions</font> </li><li>  <font color="#0000ff">var</font> x = c.getContext ( <font color="#A31515">'2d'</font> );  <font color="#008000">// get context</font> </li><li>  x.font = <font color="#A31515">'18px bold Calibri'</font> ;  <font color="#008000">// set the font style</font> </li><li>  x.fillStyle = <font color="#A31515">'# 000'</font> ;  <font color="#008000">// and fill color</font> </li><li>  <font color="#0000ff">if</font> (m) { </li><li>  x.fillText (parseInt (m [1])&gt; 9? <font color="#A31515">'9+'</font> : m [1], 0, 16, 16);  <font color="#008000">// If qty&gt; 9, then show ‚Äú9+‚Äù</font> </li><li>  } </li><li>  <font color="#0000ff">var</font> o = <font color="#0000ff">document</font> .querySelectorAll ( <font color="#A31515">'link [rel = "icon"], link [rel = "shortcut icon"]'</font> );  <font color="#008000">// find all possible favicon tags</font> </li><li>  <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> i = 0; i &lt;o.length; i ++) { </li><li>  o [i] .parentNode.removeChild (o [i]);  <font color="#008000">// and bang them,</font> </li><li>  } </li><li>  <font color="#0000ff">var</font> n = <font color="#0000ff">document</font> .createElement ( <font color="#A31515">'link'</font> );  <font color="#008000">// then re-create</font> </li><li>  n.setAttribute ( <font color="#A31515">'rel'</font> , <font color="#A31515">'icon'</font> );  <font color="#008000">// with the required atrubutsy</font> </li><li>  n.setAttribute ( <font color="#A31515">'href'</font> , c.toDataURL ());  <font color="#008000">// c.toDataURL () gets the finished image on our canvas as text "data: image / png; base64, ......" /</font> </li><li>  <font color="#0000ff">document</font> .querySelector ( <font color="#A31515">'head'</font> ) .appendChild (n);  <font color="#008000">// well, and finally, apply the newly created favicon to the document.</font>  <font color="#008000">Voila!</font> </li><li>  }); </li></ol></blockquote><br><br>  To check how it works, go to the <a href="https://dl.dropbox.com/u/527508/test.html">link</a> , and then to the inbox on GMail.  If there are new messages, you will see a counter as a picture of a favion.  I worked on Opera and Firefox under Ubuntu.  Chrome didn't like the idea. <br><br><h4>  Where can this be applied? </h4><br>  Yes, wherever you want.  For example, in order not to look into the tab, whether there are new messages, you can apply this method.  Although, you can use <a href="http://habrahabr.ru/blogs/GMail/112523/">counter</a> type things <a href="http://habrahabr.ru/blogs/GMail/112523/">with Google Labs</a> and <a href="https://addons.mozilla.org/uk/firefox/addon/gmail-notifier/">gmail-notifier for FF</a> . <br>  But maybe you want to inform your users on your site about something. <br><br>  Or even enjoy how your karma grows or falls in Habr√© :) <br><br>  The last case and take as a basis for another example. <br><br>  As a "engine" for the script used <a href="https://addons.mozilla.org/ru/firefox/addon/greasemonkey/">Greasemonkey</a> .  You can use <a href="http://userscripts.org/scripts/show/95356">this userscript</a> . <br><br>  Mapping will work only when you are in a habrocentre (by the way, not only yours).  You can simply screw the ajax and get tsiferki not being in your haborcenter, it is on your own.  With a great desire, you can screw it to Google Chrome (write an extension) or Opera (for example, the same ‚Äújavascript bookmark‚Äù). <br><br>  Here is the script itself ( <b>upd:</b> slightly updated): <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">var</font> c = <font color="#0000ff">document</font> .createElement ( <font color="#A31515">"canvas"</font> );  <font color="#008000">// Use the same canvas</font> </li><li>  c.height = c.width = 16; </li><li>  <font color="#0000ff">var</font> cx = c.getContext ( <font color="#A31515">"2d"</font> ); </li><li>  cx.beginPath ();  <font color="#008000">// draw a blue square and black text on it</font> </li><li>  cx.rect (0, 3, 18, 11);  <font color="#008000">// and put them on canvas</font> </li><li>  cx.fillStyle = <font color="#A31515">"# 6DA3BD"</font> ; </li><li>  cx.fill (); </li><li></li><li>  cx.font = <font color="#A31515">"10px Normal Tahoma"</font> ; </li><li>  cx.fillStyle = <font color="#A31515">"#fff"</font> ; </li><li></li><li>  <font color="#0000ff">var</font> mark = <font color="#0000ff">document</font> .querySelectorAll ( <font color="#A31515">".mark span"</font> );  <font color="#008000">// get tsiferki from the page</font> </li><li>  cx.fillText (parseInt (mark [0] .innerHTML), 0, 12, 16); </li><li></li><li>  <font color="#008000">// use favicon</font> </li><li>  <font color="#0000ff">var</font> oldicons = <font color="#0000ff">document</font> .querySelectorAll ( <font color="#A31515">'link [rel = "icon"], link [rel = "shortcut icon"]'</font> ); </li><li>  <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> i = 0; i &lt;oldicons.length; i ++) { </li><li>  oldicons [i] .parentNode.removeChild (oldicons [i]); </li><li>  } </li><li></li><li>  <font color="#0000ff">var</font> newicon = <font color="#0000ff">document</font> .createElement ( <font color="#A31515">"link"</font> ); </li><li>  newicon.setAttribute ( <font color="#A31515">"rel"</font> , <font color="#A31515">"icon"</font> ); </li><li>  newicon.setAttribute ( <font color="#A31515">"href"</font> , c.toDataURL ()); </li><li>  <font color="#0000ff">document</font> .querySelector ( <font color="#A31515">"head"</font> ) .appendChild (newicon); </li><li></li><li>  <font color="#008000">// update the page every 2 minutes</font> </li><li>  window.setTimeout ( <font color="#0000ff">function</font> () { </li><li>  window.clearTimeout (); </li><li>  window.location.reload (); </li><li>  }, 120000); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  Actually that's all.  If you have found at least some part of the post useful for yourself, even if it doesn‚Äôt even concern the topic topic, then allow time to be considered spent not in vain for writing it. <br>  If you are interested in the dynamic change of favicon, then you can use the <a href="http://hellowebapps.com/products/jquery-favicon/">ready</a> -made jQuery <a href="http://hellowebapps.com/products/jquery-favicon/">plugin</a> - there you can also animate favicons (via the same canvas). <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/112551/">https://habr.com/ru/post/112551/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../112542/index.html">New design apple.com</a></li>
<li><a href="../112544/index.html">Amazon announces service to send email (Amazon SES)</a></li>
<li><a href="../112548/index.html">SED outside offices</a></li>
<li><a href="../112549/index.html">Participation in the tender for the development of the site (part 1)</a></li>
<li><a href="../112550/index.html">Participation in the tender for the development of the site (part 2)</a></li>
<li><a href="../112552/index.html">Commentary of the day: Storage of information</a></li>
<li><a href="../112553/index.html">Simple web scraping on f #</a></li>
<li><a href="../112554/index.html">Joint life of Agile and UCD on the example of a real project</a></li>
<li><a href="../112555/index.html">How anonymous is the survey?</a></li>
<li><a href="../112558/index.html">Microsoft unveiled plans to counter iPad in 2011</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>