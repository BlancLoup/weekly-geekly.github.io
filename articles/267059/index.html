<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Overview of the Intent Sender plugin for Android Studio and certain features of its development</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When developing Android applications, you often have to resort to using adb to optimize your work and save time. Adb is the only tool that allows, for...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Overview of the Intent Sender plugin for Android Studio and certain features of its development</h1><div class="post__text post__text-html js-mediator-article">  When developing Android applications, you often have to resort to using adb to optimize your work and save time.  Adb is the only tool that allows, for example, bypassing the long chain of activity and launching the desired message immediately or sending a broadcast message without waiting for the fulfillment of any external conditions.  Using adb entails all the inconvenience of using the terminal to form long commands, which led me to write a plugin to speed up and simplify working with adb when sending intent to devices. <br><a name="habracut"></a><br>  Finding information and detailed descriptions of how to develop a plugin for IntelliJ IDEA is not a problem, so at the end of the article I will devote a few paragraphs to this topic, showing the features that I encountered.  Now I want to describe the result of my work. <br><br>  So, <a href="https://plugins.jetbrains.com/plugin/7945%3Fpr%3D">Android Intent Sender</a> is tied to the following adb shell commands: <br><br><ul><li>  Broadcast - using the command allows you to send broadcast messages to the client </li><li>  StartActivity - starting the activity </li><li>  StartService - start the service </li></ul><br>  When sending these commands, you can attach an intent supplied with all the necessary parameters (action, data, category, component, mime type, flag) and extra data. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The appearance of the plug-in was decided to be in the form of a separate working window with the necessary UI elements.  Access to the plugin is carried out through the menu View -&gt; Tool Windows, the icon on the left-bottom of the screen and from the right panel: <br><br><img src="https://habrastorage.org/files/459/b03/237/459b03237dc04424bcc9bdf1e7c188b4.png" alt="plugin general image"><br><br>  The plugin window is divided into the following main sections: device / emulator selection window, intent parameters section, command sending buttons.  The plugin implements automatic updating of devices when they are connected and disconnected.  In the intent parameters section, in addition to the input fields, there is a history button (to the right of the section title), a picker of the current project‚Äôs classes next to the component entry field, a picker of flags and an extra data button. <br><br>  The class picker of the current project greatly simplifies the selection of a component (for example, a running activity).  Clicking on the button opens a window with project classes with the ability to search and switch to the project tree.  When you select a class, the required separator ‚Äú/‚Äù for the package border (for example, com.weezlabs.blabla / .MainActivity) will be automatically inserted in the right place: <br><br><img src="https://habrastorage.org/files/2e4/872/6dc/2e48726dcd3f461e9aebb53575088d8f.png" alt="class picker image"><br><br>  The flags picker allows you to select one or more flags to add to the intent: <br><br><img src="https://habrastorage.org/files/025/473/2eb/0254732eb6e1475b92c088a5f6599e7b.png" alt="flags picker image"><br><br>  To send a command to the device, use the buttons <i>‚ÄúSend Broadcast‚Äù</i> , <i>‚ÄúStart Activity‚Äù</i> , <i>‚ÄúStart Service‚Äù</i> . <br><br>  To launch activity and service via adb, it is generally necessary that the manifest for this component have the <code>android:exported=‚Äùtrue‚Äù</code> flag in it <code>android:exported=‚Äùtrue‚Äù</code> .  However, as it turned out, there is a solution that allows you to start a component whose exported flag is set to false.  For this, the <i>‚ÄúAdd user‚Äù</i> field has been added to the plugin, in which the package id is automatically substituted when selecting a component from the piker.  Unfortunately, this functionality may not work on some devices (it seems that this applies to most Samsung devices). <br><br>  Consider some cases of possible use of the plugin: <br><br><ol><li><div class="spoiler">  <b class="spoiler_title">Testing broadcast receiver</b> <div class="spoiler_text">  Everything is simple: we specify the necessary parameters and send intent.  For example, we have a receiver with the code in onReceive: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ String action = intent.getAction(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action.equals(<span class="hljs-string"><span class="hljs-string">"simple_intent_action"</span></span>)){ Log.d(<span class="hljs-string"><span class="hljs-string">"SimpleReceiver"</span></span>, <span class="hljs-string"><span class="hljs-string">"Got intent with action: "</span></span> + action + <span class="hljs-string"><span class="hljs-string">" and string extra: "</span></span> + intent.getStringExtra(<span class="hljs-string"><span class="hljs-string">"string_extra"</span></span>)); } }</code> </pre><br>  Receiver is registered by specifying the corresponding IntentFilter: <br><br><pre> <code class="java hljs">IntentFilter simpleFilter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IntentFilter(<span class="hljs-string"><span class="hljs-string">"simple_intent_action"</span></span>);</code> </pre><br>  Then, in order to send a broadcast message in the plugin in the action field, we specify <i>‚Äúsimple_intent_action‚Äù</i> and, by clicking on the <i>‚ÄúAdd extra‚Äù</i> button, we add extra with the key <i>‚Äústring_extra‚Äù</i> and any text.  Click <i>‚ÄúSend Broadcast‚Äù</i> and see something in the logs, like: <br> <code>Got intent with action: simple_intent_action and string extra: Awesome string <br></code> </div></div></li><li><div class="spoiler">  <b class="spoiler_title">Running an activity, service</b> <div class="spoiler_text">  Suppose we need to start the MessageActivity, while the MessageActivity during creation takes the id of the displayed message of type long from the intent.  The key in the extra data for id let it be ‚ÄúmessageId‚Äù. <br><br>  To run this activation in the plugin in the component picker, select MessageActivity, and make sure that the user is automatically added.  Next, add an extra object of type <i>long</i> with the key <i>‚ÄúmessageId‚Äù</i> and the desired value.  Everything is ready, click <i>‚ÄúStart Activity‚Äù</i> and look at the started activity with the display of the specified message. <br><br>  If MessageActivity in the onCreate method writes logs: <br><br><pre> <code class="java hljs">Log.d(LOG_TAG, <span class="hljs-string"><span class="hljs-string">"Message id: "</span></span> + getIntent().getLongExtra(<span class="hljs-string"><span class="hljs-string">"messageId"</span></span>, -<span class="hljs-number"><span class="hljs-number">1</span></span>));</code> </pre><br>  then we will see in the logs: <br> <code>Message data: 234 <br></code> </div></div></li><li><div class="spoiler">  <b class="spoiler_title">Testing your own data schema</b> <div class="spoiler_text">  For example, we need to implement the automatic launch of the application by clicking on certain links, like <code><a href="http://myhost.com/"></a> myhost.com... <br></code>  / To do this in manifest, we specify the following intent filter for the desired activity: <br><br><pre> <code class="java hljs">&lt;intent-filter&gt; &lt;action android:name=<span class="hljs-string"><span class="hljs-string">"android.intent.action.VIEW"</span></span> /&gt; &lt;category android:name=<span class="hljs-string"><span class="hljs-string">"android.intent.category.DEFAULT"</span></span> /&gt; &lt;category android:name=<span class="hljs-string"><span class="hljs-string">"android.intent.category.BROWSABLE"</span></span> /&gt; &lt;data android:scheme=<span class="hljs-string"><span class="hljs-string">"http"</span></span> android:host=<span class="hljs-string"><span class="hljs-string">"myhost.com"</span></span>/&gt; &lt;/intent-filter&gt;</code> </pre><br>  In the onCreate method of the called activity add logging: <br><br><pre> <code class="java hljs">Log.d(<span class="hljs-string"><span class="hljs-string">"TAG"</span></span>, <span class="hljs-string"><span class="hljs-string">"Intent data: "</span></span> + getIntent().getDataString());</code> </pre><br>  Then, for testing, in the plugin we specify the action: <i>android.intent.action.VIEW</i> , data: <i><a href="http://myhost.com/some_data">myhost.com/some_data</a></i> and click <i>Start Activity</i> .  On the device, select our application and look at the logs: <br> <code><a href="http://myhost.com/some_data"></a> Intent data: myhost.com/some_data <br></code> <br>  We will see the same thing if we send yourself an sms with the text ‚ÄúTest <a href="http://myhost.com/some_data">myhost.com/some_data</a> ‚Äù and click on the link </div></div></li><li><div class="spoiler">  <b class="spoiler_title">Testing Google Cloud Messaging (GCM) service</b> <div class="spoiler_text">  Suppose we have a class GcmBroadcastReceiver which is responsible for receiving GCM messages.  Registration of such components in manifest takes place with the indication for the receiver of the permission <code>android:permission="com.google.android.c2dm.permission.SEND" <br></code> <code>android:permission="com.google.android.c2dm.permission.SEND" <br></code>  . <br>  Unfortunately, at the time of testing, this permission must be removed, otherwise the intent from the plugin will not be processed.  The filter in manifest will be similar to the following: <br><br><pre> <code class="java hljs">&lt;intent-filter&gt; &lt;action android:name=<span class="hljs-string"><span class="hljs-string">"com.google.android.c2dm.intent.RECEIVE"</span></span> /&gt; &lt;category android:name=<span class="hljs-string"><span class="hljs-string">"com.your.package"</span></span> /&gt; &lt;/intent-filter&gt;</code> </pre><br>  Suppose that in the body of the GCM intent we expect json with some data, transmitted by the string with the key <i>‚Äúmessage‚Äù</i> . <br>  We create intent in the plugin, for which we specify the action <i>com.google.android.c2dm.intent.RECEIVE</i> and the category <i>com.your.package</i> .  Add an extra field of type <i>String</i> with the key <i>‚Äúmessage_type‚Äù</i> and the value of <i>‚Äúgcm‚Äù</i> and a field of type <i>String</i> with the key <i>‚Äúmessage‚Äù</i> and transmitted by json inside. <br><br>  Now, by clicking <i>‚ÄúSend broadcast‚Äù</i> , the application will receive and process the broadcast, as it would process the real GCM message. <br></div></div></li></ol><br>  As can be seen, in some cases, the use of a plug-in can significantly reduce unreasonable loss of time and, I hope, the plug-in will become a really useful tool in the developer‚Äôs arsenal. <br><br>  Regarding the plugin development process itself, I can say that the complexity is determined by the complexity of the implementation of the idea embedded in the plugin.  Preparation and setting up the environment itself does not cause problems, there is a lot of information on the Internet.  I will give in brief the necessary steps to set up the environment: <br><br><ul><li>  We are looking for the IDEA branch used for AndroidStudio.  To do this, look for the line in AndroidStudioApplicationInfo.xml, similar to <i>apiVersion = "135.1286"</i> and <i>pick</i> up the branch number from it - in my case 135. AndroidStudioApplicationInfo.xml we look at the link: <a href="">android.googlesource.com/platform/tools/adt/idea/+/ idea133 / adt-branding / src / idea / AndroidStudioApplicationInfo.xml</a> <br>  Naturally, the link is not strictly recommended and you can go to the desired version of AndroidStudio, cutting the link to <a href="https://android.googlesource.com/platform/tools/adt/idea/">android.googlesource.com/platform/tools/adt/idea</a> and then, by walking through the folders, you can easily find the desired AndroidStudioApplicationInfo.xml </li><li>  Download IntelliJ Community Edition as <a href="http://www.jetbrains.org/pages/viewpage.action%3FpageId%3D983225">described</a> and switch to the branch found earlier (I have 135) </li><li>  <a href="http://www.jetbrains.org/intellij/sdk/docs/basics/getting_started/setting_up_environment.html">Create an SDK</a> for plugin development <br></li><li>  The penultimate step: add to the SDK in the classpath section of the android plugin dependencies: <br><img src="https://habrastorage.org/files/0e6/4a3/5d5/0e64a35d54ba4c59bda949880eb04f13.png" alt="image"></li><li>  Add org.jetbrains.android dependency to <code>org.jetbrains.android <br></code> <code>org.jetbrains.android <br></code> </li></ul><br>  Next, create a new project like IntelliJ Platform Plugin and you can safely start writing a plugin using the <a href="http://www.jetbrains.org/intellij/sdk/docs/index.html">IntelliJ Platform SDK Documentation</a> , <a href="https://devnet.jetbrains.com/community/idea/open_api_and_plugin_development">Open API and Plugin Development community</a> , numerous articles on Habr√© and examples on github. <br><br>  I decided to implement the plugin based on the toolWindow component using the swing framework for the UI elements.  As a person who has never encountered working with UI in Java and with swing in particular, had to adapt slightly to its features, however, there were no particular difficulties.  Perhaps the similarity with the work on the UI in Android helped. <br><br>  Additionally, I note that for working with adb, the ddmlib library, which is part of the Android SDK and located along the path <i>$ {SDK_HOME} / sdk / tools / lib</i> , turned out to be extremely useful.  There are quite a lot of other jar-s in this directory, so I recommend viewing, all of a sudden some library will simplify the solution of the tasks.  I also draw attention to the <i>org.jetbrains.android</i> package, which greatly helps when working with the Android part.  So, with his help, the path to the Android SDK directory was obtained and the package was pulled out of the manifest.  Just in case, the plugin also provides the search for the path to the Android SDK in the ANDROID_HOME environment variable and the ability to manually set the path if it was not possible to find the SDK in the previous steps.  When working with adb, the plugin parses the console response, which makes it possible in some cases to understand that the sending failed and give the corresponding error. <br><br>  To store the history of commands used json, stored in the settings of the plugin. <br><br>  In connection with the development of a plug-in in a Windows environment, when it was launched on OS X, a number of <i>crashes occurred</i> with a <i>NoSuchMethodException</i> .  The reason is the difference between Java for Windows and OS X. I had to disturb my colleagues working on OS X and debug it with their help. <br><br>  After completion of testing and debugging the plug-in, an application was submitted to add it to the jetbrains plugin repository. The first submitted version was quickly moderated and was available for download no more than an hour after the application was submitted. <br><br><h3>  Conclusion: </h3><br>  To my surprise, the writing of the plugin did not cause any significant technical difficulties.  Perhaps, the desire to make an open useful tool, switching from Android development or just inspired, helped, but somehow the development of the plug gave a good moral shake and charged for some time with an additional positive attitude.  Although the plugin is already self-sufficient and fully functional, work on the plugin is not yet completed, there is something to improve and there are ideas for other useful plug-ins.  Todo sheet for the plugin: <br><ul><li>  Add the ability to initiate the assembly and run the project with the indication of the activity being started and its parameters </li><li>  Try to bypass the temporary removal of permission from the GCM receiver </li><li>  Implement support for passing intent Parcelable objects. </li><li>  Solve the problem of running non-exported components on Samsung devices </li></ul><br>  Plugin on <a href="https://github.com/WeezLabs/idea-intent-sender-plugin">github</a> : <a href="https://github.com/WeezLabs/idea-intent-sender-plugin">github.com/WeezLabs/idea-intent-sender-plugin</a> <br>  As a bug tracker, you can safely use <a href="https://github.com/WeezLabs/idea-intent-sender-plugin/issues">github issues</a> : <a href="https://github.com/WeezLabs/idea-intent-sender-plugin/issues">github.com/WeezLabs/idea-intent-sender-plugin/issues</a> . <br><br>  I would welcome any suggestions for improving the plugin or questions on its implementation, as well as updating the list of non-obvious ways to use it. </div><p>Source: <a href="https://habr.com/ru/post/267059/">https://habr.com/ru/post/267059/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267049/index.html">Ice started off: KC published a draft document on paperless transfer of .RU domains between registrars</a></li>
<li><a href="../267051/index.html">We are switching from STM32 to the Russian K1986BE92QI microcontroller. Practical application: We interrogate keys, we generate PWM. Comparison of CMSIS and SPL code (PWM + TIM + PORT). Part one</a></li>
<li><a href="../267053/index.html">What can I learn from WhatsApp</a></li>
<li><a href="../267055/index.html">‚ÄúMade and forgotten‚Äù: Why is it not so in the layout of email-letters</a></li>
<li><a href="../267057/index.html">SYNful knock on the OS of Cisco Systems routers</a></li>
<li><a href="../267061/index.html">Card game: we realize attack and we will find application of ShadowDOM</a></li>
<li><a href="../267063/index.html">Functional C #: Non-nullable reference types (non-zero reference types)</a></li>
<li><a href="../267067/index.html">The story of the damn doubles</a></li>
<li><a href="../267069/index.html">A new way of MITM-attack on the TLS protocol makes the attacker invisible</a></li>
<li><a href="../267071/index.html">Already a year we create an operator together</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>