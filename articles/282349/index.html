<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DGA Domain Detection</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article we will talk about the method of identifying domain names generated using the Domain Generation Algorithm. For example, moqbwfijgtxi.i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DGA Domain Detection</h1><div class="post__text post__text-html js-mediator-article">  In this article we will talk about the method of identifying domain names generated using the Domain Generation Algorithm.  For example, moqbwfijgtxi.info, nraepfprcpnu.com, ocfhoajbsyek.net, pmpgppocssgv.biz, qwujokiljcwl.ru, our e-mail service, our cfmkugwwgccuit.info, pohyqxdbrqiu.com, your e-mail, your email, your qqmkugwwgccuit.info, pohyqxdbrqiu.com, your e-mail;  Such domain names are often given to sites related to illegal activities. <br><br>  One of the DGA usage scenarios can be observed in the event of malware infection of a computer system.  Malicious software on a compromised machine will attempt to connect to systems under the attacker's control in order to receive commands or send back the collected information. <br><br>  Attackers use DGA to compute the sequence of domain names to which infected machines will attempt to connect.  This is done to prevent loss of control over the hacked infrastructure in cases where the domains or IP addresses of the attacker, written directly in the code, are blocked by security systems. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Solving the problem of detecting a malicious DGA domain using a blacklist does not work, here a different approach is required.  One of these approaches will be discussed. <br><br>  The basic idea is that the sequences of characters used in legitimate domain names are different from the sequences of characters of domain names obtained using DGA, since the legitimate domain is often human-readable and carries a meaning. <br><br>  To solve the problem, machine learning and N-gram analysis were used.  The top million from alexa (white domains) and 700 thousand from bambenekconsulting.com (malicious domains) were taken as a training sample. <br><br><h4>  Method Description </h4><br>  To begin with, the entire set of domains is divided into a training and test sample.  On the basis of the training sample of domains, a multitude of N-grams is constructed taking into account their uniqueness.  As the N-gram is taken the substring of the domain name of a fixed length. <br><br>  Consider the example of the DGA-domain Cryptolocker vzdzrsensinaix.com.  It will make 11 N-grams 4 characters long. <br><br><img src="https://habrastorage.org/files/b68/e3d/791/b68e3d79189c427cb273a28657e7351d.png"><br><br>  <i>Fig.</i>  <i>1. Domain Splitting into N-grams</i> <br><br>  The set of unique N-grams built on the basis of the training sample is divided into three parts: the set of non-harmful N-grams (found only in legitimate domains), the set of malicious N-grams (found only in malicious domains) and many neutral N-grams (found in both types of domains).  Each unique N-gram is assigned a numerical coefficient: <br><br><ul><li>  1 - legitimate, </li><li>  ‚àí1 - Malicious, </li><li>  the numbers from {‚àí1.0..1.0} are neutral. </li></ul><br>  Under the trained model, we will understand many pairs <br><br>  <code>{( q, Ng(q))}</code> , where <code>Ng(q) = p</code> , <code>p</code> is the numerical coefficient of the N-gram q, q belongs to Q, Q is the set of all N-grams in the training set. <br><br><h4>  Sample split </h4><br>  For this task, we have developed a specific sampling method.  Its main idea is that as a training sample of the set of malicious and white domains is composed of a set containing a maximum of information about all available domains.  In essence, this means that for any domain from the test sample there are at least k N-grams in the model belonging to this domain, where k is a predetermined natural number. <br><br>  In this case, for training, we essentially take as a model the core of our sample.  This allows you to avoid situations at the training stage when the next domain from the test sample does not have a single match with the model and, accordingly, it is impossible to make a decision about its belonging to one or another class. <br><br>  This method of sampling made it possible to improve the accuracy of the classification of domains - compared to, for example, random sampling.  The test results of both methods will be presented below. <br><br><img src="https://habrastorage.org/files/182/16a/0fc/18216a0fc18b4fd888405487148abd6d.jpg"><br><br>  <i>Fig.</i>  <i>2. Each domain name contains a non-empty intersection with a training set.</i>  <i>The minimum number of intersections for each domain is specified in the parameters of the splitting algorithm.</i> <br><br><h4>  Model training </h4><br><img src="https://habrastorage.org/files/fcf/f1b/694/fcff1b6940394093ad2e659f4d83407a.png"><br><br>  <i>Fig.</i>  <i>3. Scheme of work of the classifier</i> <br><br>  To determine the harmfulness of the analyzed domain, the algorithm calculates the recursive function: <code>I(i) = I(i-1) * Œ± + Ng(q <sub>i</sub> )</code> , where q <sub>i</sub> is the i-th N-gram of the domain, Ng (qi) is the coefficient of the considered N -grams, Œ± is a softening coefficient, I (0) = 0. For acceptable values ‚Äã‚Äãof the recursive function, the boundary T is defined. As soon as the result of the calculation of the next iteration of the recursive function becomes less than this limit, the corresponding domain is declared malicious. <br><br>  We illustrate the operation of the analyzer on the example of a malicious (pushdo bot) domain. <br>  jrgxmwgwjz.com (Œ± = 0.9; T = ‚àí1.5) <br><br>  Table 1. An example of the analyzer: <br><br><table><tbody><tr><th>  N-grams number </th><th>  N-gram </th><th>  Coefficient <br>  N-grams from the model </th><th>  Value <br>  recursive function </th></tr><tr><td>  one </td><td>  jrgx </td><td>  -one </td><td>  ‚àí1 </td></tr><tr><td>  2 </td><td>  rgxm </td><td>  0 </td><td>  ‚àí0.9 </td></tr><tr><td>  3 </td><td>  gxmw </td><td>  0 </td><td>  ‚àí0,81 </td></tr><tr><td>  four </td><td>  xmwg </td><td>  0 </td><td>  ‚àí0.73 </td></tr><tr><td>  five </td><td>  mwgw </td><td>  0.06 </td><td>  ‚àí0,6 </td></tr><tr><td>  6 </td><td>  wgwj </td><td>  ‚àí0.92 </td><td>  ‚àí1.45 </td></tr><tr><td>  7 </td><td>  gwjz </td><td>  ‚àí0.68 </td><td>  ‚àí1.99 </td></tr></tbody></table><br>  ‚àí1.99 &lt;T therefore the domain is malicious.  The threshold value T is determined empirically based on the studies performed (see Fig. 4). <br><br>  Now let's take a closer look at the coefficients of neutral N-grams.  To obtain these coefficients, an evolutionary algorithm is used (evolutionary algorithms are a family of algorithms designed to solve optimization problems based on the principles of natural evolution), in which a vector of N-gram coefficients is taken as an individual of a population. <br><br>  The task of this implementation of the evolutionary algorithm is the calculation of optimal numerical values ‚Äã‚Äãfor neutral N-grams.  The solution obtained as a result of the work of the evolutionary algorithm is the vector of values ‚Äã‚Äãof the coefficients of neutral N-grams, which ensures the greatest accuracy of the classifier.  The accuracy of the classifier is estimated by the value of a non-decreasing objective function chosen as a result of experimental testing: <br><br> <code>Fitness = P/TP + N/TN + FP/P + FN/N</code> <br> <br>  The closer the Fitness value is to 2, the higher the classification accuracy. <br><br><h4>  results </h4><br>  To assess the effectiveness of our proposal, a series of experiments was conducted on a sample of domains.  The entire set of domains was divided into two parts: a training and test sample. <br><br>  Table 2. Sizes of the studied samples: <br><br><table><tbody><tr><th></th><th>  amount <br>  malicious domains </th><th>  amount <br>  legitimate domains </th></tr><tr><td>  Training <br>  sample </td><td>  60,000 </td><td>  70,000 </td></tr><tr><td>  Test <br>  sample </td><td>  640,000 </td><td>  830,000 </td></tr></tbody></table><br><img src="https://habrastorage.org/files/580/770/468/58077046847f47c7a6ad07c5d7581acd.png"><br><br>  <i>Fig.</i>  <i>4. The choice of the optimal threshold</i> <br><br>  From the graph in fig.  4 it follows that the optimal threshold value is ‚àí1.5, since a balance is reached between false positive and false negative (both errors of the order of 1%). <br><br><h4>  Quality assessment method </h4><br><img src="https://habrastorage.org/files/90e/5d6/ca6/90e5d6ca6da9471c9eeeb96529eda899.png"><br><br>  <i>Fig.</i>  <i>5. Comparison of sample breaks</i> <br><br>  Experiments have shown that our proposed method has a sufficiently high classification accuracy, which additionally increases with the application of the developed partitioning method. <br><br>  <b>Posted by</b> Alexander Kolokoltsev, Positive Technologies </div><p>Source: <a href="https://habr.com/ru/post/282349/">https://habr.com/ru/post/282349/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282335/index.html">Difficult integrity constraint - 2</a></li>
<li><a href="../282337/index.html">Report from Percona Live 2016: what to expect from MySQL 8?</a></li>
<li><a href="../282339/index.html">"Have I been pwned" received the first "independent request"</a></li>
<li><a href="../282345/index.html">Results of the big programming championship - 2016 for 5 thousand people</a></li>
<li><a href="../282347/index.html">The experience of automating uneasy correspondence (Completion. Sampling and Export)</a></li>
<li><a href="../282351/index.html">The Internet of Things on a real example - car search system</a></li>
<li><a href="../282353/index.html">Explosive final of the Imagine Cup 2016</a></li>
<li><a href="../282357/index.html">Local positioning technology. Part II</a></li>
<li><a href="../282359/index.html">cx_Freeze + virtualenv = bugs and zigzags</a></li>
<li><a href="../282361/index.html">Connect to the Shielded VM webinar on Windows Server 2016. Begin on April 27 at 11:00 (GMT)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>