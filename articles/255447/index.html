<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Microsoft hackathon "IoT - Internet of Things" in Nizhny Novgorod</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Reason to start 
 I want to tell you about the hackathon, which was conducted by Microsoft and Intel in Nizhny Novgorod during the Microsoft Developer...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Microsoft hackathon "IoT - Internet of Things" in Nizhny Novgorod</h1><div class="post__text post__text-html js-mediator-article"><h1>  Reason to start </h1><br>  I want to tell you about the hackathon, which was conducted by Microsoft and Intel in Nizhny Novgorod during the Microsoft Developer Tour Technology Expedition.  So say firsthand.  As a member.  I think this will be the most interesting. <br><br>  The topic of the hackathon, which was supposed to be held in Nizhny Novgorod, is IoT - Internet of Things.  To be honest, for me this term was new and I had to google to understand the basic principles.  It turned out all quite simple, there is a device that collects information from some sensors and sends it to the Internet for access and processing. <br><a name="habracut"></a><br>  The fact that the tour will be held hackathon, I learned shortly from the event.  It was written that the hackathon will need to create something using the Intel Galileo board. <br><br>  And how well it coincided that about a month ago I attended the Intel conference dedicated to Intel Galileo and Intel Edison.  Where I got the Intel Galileo Gen 2 board. Thank you!  But her hands did not reach her at all, and she just lay on the table.  Of course, I ordered sensors and shields for it on the well-known Chinese website, but they still have not reached. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A few words about Intel Galileo and Intel Edison.  These are cards that are compatible with Arduino Uno R3 contacts.  You can insert standard sensors and shields into them.  There are development tools to run arduino sketches.  And then it may be asked why these boards are needed, if they are more expensive and consume more.  I confess that I also thought so initially.  But upon reflection, I came to the conclusion that the purpose of these boards is completely different.  Compare Arduino with 16 MHz and Intel Galileo Gen 2 with 400 MHz.  The RAM memory is 2 KB against 256 MGB DDR3.  Even on the boards from Intel, there is a built-in 100 Mbit network interface and running Linux.  They do not need to be compared, they are for different tasks. <br><br>  Read more here: <a href="http://habrahabr.ru/company/intel/blog/248279/">habrahabr.ru/company/intel/blog/248279</a> <br><br>  In general, I had an Intel Galileo Gen 2 motherboard, which just lay in a box.  I didn‚Äôt have experience with this board as with Arduino.  And here is the hackathon. <br><br>  A few days before the hackathon, I decided to put Linux on my board with this instruction: <a href="http://habrahabr.ru/company/intel/blog/248893/">habrahabr.ru/company/intel/blog/248893</a> <br><br>  I connected to the board via SSH, via a local network.  There's normal Linux, nice.  Everything is fine, everything works.  I wrote a simple example in C ++ from the Internet, which flashes with a built-in LED.  It didn't work immediately (I forgot to specify -lmraa in the compilation parameters).  Hooray!  Everything works, you can go to sleep. <br><br>  Once the board is working, you can try to connect something.  I went to the radio market to see if you can buy something for the arduino.  Bought a breadboard, wires.  Something on the little things, some sensors.  But I did not test anything, again my hands did not reach. <br><br><h1>  Idea </h1><br>  In the past few days, I had a brainstorm that can be implemented on this board.  I didn‚Äôt want something simple, like LED blinking, measuring the temperature in the room.  All this has happened before, and Intel Galileo is too powerful for such tasks.  I wanted something with big calculations, data processing, sending them to the server for further processing or analysis. <br><br>  And then the next idea came to mind.  Some years ago, in the journal Computerra, there was news about experimental technology for determining the position of a source of a loud sound, for example, a shot.  There are microphones on the street.  They perceive sound, and because sound reaches all microphones not simultaneously, but with a delay, you can find the position of the sound source.  I decided to create such a system. <br><br>  The idea is, you can go to the radio market to buy sensors.  Googling, I found that there are two types of sound sensors.  The first with a digital output, responds to a threshold overflow and has, respectively, three contacts (ground, +5, a threshold signal).  The second sensor additionally has an analog output and, accordingly, four contacts (ground, +5, a threshold signal, an analog signal).  I wanted a second one that produces an analog signal.  Having received a signal from several sensors, it will be possible to superimpose them and find a match to accurately determine the delay.  Well, either dynamically look for the trigger threshold.  More to the sensors were needed wires.  10 meters each.  So, just in case.  On the market, I found sound sensors, but with only three conclusions.  There were no others.  The seller assured that their output is analog.  Okay, believe it, although why is there a trimmer resistor?  I took 5 sensors.  Now the wires.  50 meters of a red-black sound wire 0.25 mm and 30 meters of light (0.25 mm, double).  I was counting on each sensor to start up red and black for power and one of a pair of light for the signal. <br><br>  Okay, everything is there.  It was all on Thursday, and on Saturday it was already a conference. <br><br>  At home I tried to connect sensors.  The first time it's scary to stick something into the board, it will suddenly burn.  But nothing, stuck, there is no smoke, the console works.  I try to get analog values ‚Äã‚Äãfrom the sensor.  And here is a surprise, the sensor turns out to be binary, i.e.  only responds to signal overshoot.  And this level is set by the tuning resistor on the board.  Aaaa!  To run the next day, on Friday, it makes no sense to market.  It is not known whether the correct sensors will be there.  And there is no time, any business, also Visual Studio on to put and to adjust a grid.  The market will take another half day.  And on Saturday, a conference from 9 in the morning, I‚Äôd still be able to sleep. <br><br>  Friday evening, coming home at 10 o'clock, I started to set things up. <br>  For the hackathon, I decided to stock up on everything just in case.  Extension, as there will be a lot of participants, and sockets may not be enough.  Router, because  The board must be connected via a network wire.  A router is also needed to connect to the Internet via a USB modem.  In general, complete autonomy.  I thought to meet a couple of hours.  Put on the installation of Visual Studio 2013 Community.  From the installation of VC 2015 refused.  So, the preparation and collection of all the glands that need to be taken to the hackathon, instead of the planned couple of hours, lasted until 4 am  And yes, at 8 to get up. <br>  As a result, I took with me: an extension cord, adhesive tape, blue electrical tape (yes, the same one), long wires, connecting wires for a breadboard and sensors, scissors, a router, 5 sound sensors, a USB modem, a vibration sensor, a tape measure.  Everything, it's time to sleep, we will understand there. <br><br><h1>  Magical Mystery Tour </h1><br><img src="https://habrastorage.org/files/95a/9fb/f80/95a9fbf80b134e879093d01a4106739c.jpg"><br><br>  There were many reports at the conference.  Diverse, interesting. <br><br>  There was a report about WebGL and the Babylon JS library, with which you can easily draw in the browser in 3D.  The idea is good, you can try to fasten it to your project later on the hackathon. <br>  The conference ended at 19:00, the hackathon began at 20:00 in the Polytech building.  You can walk on foot.  On the way, I bought a pizza for a little snack. <br><br><h1>  Hackathon </h1><br>  So 20:00, I'm on the spot.  The hall is big.  From university I used to sit on the first row, so I occupy the first table in the center.  For my glands just the whole table will be needed. <br><br><img src="https://habrastorage.org/files/3f7/fcc/b9a/3f7fccb9a92045cca82e27976d3d6aa7.jpg"><br><br><img src="https://habrastorage.org/files/c40/212/b30/c40212b30427459fb9780d70cb6c007e.jpg"><br>  Photo from the hackathon <a href="http://events.techdays.ru/msdevtour/news">events.techdays.ru/msdevtour/news#fe58625b-bcd9-498a-94e8-161ccc286f11</a> <br><br>  From 20:00 to 00:00 lectures about IoT and Azure from Microsoft and Intel. <br><br><img src="https://habrastorage.org/files/911/192/cc5/911192cc56d9405d83e6f7991b7045f5.jpg"><br><br>  One lecture was from Intel about Galileo and Edison.  One thing about using Azure.  What he knows how and how to use it.  This was the most important thing, because until that time I had never worked with Azure. <br><br>  Dmitry Soshnikov told how Microsoft sees IoT.  This is a small device that collects some data from sensors, transmits them to the cloud and allows them to receive and analyze.  My project just met all these requirements, it remained to implement it. <br><br>  While there were lectures, so as not to waste time in vain, I decided to deduce the formulas that will be needed to determine the position of the signal source. <br><br>  Our task is to find a point in space that best suits the received times of delays from the sensors.  That is, an optimization problem in which there may be more variables than unknowns.  Maybe something like the method of least squares. <br><br>  Wrote dependencies, began to deduce.  I used up two pages, and I realized that I‚Äôm lazy to solve 4-degree equations, and I can spend all my time on it, and there can also be mistakes.  And it became somehow sad. <br><br><img src="https://habrastorage.org/files/6a6/ded/ddd/6a6deddddbaf4a7d98f832352378045f.jpg"><br><br>  As a result, I decided to act by a universal method, a method of complete enumeration.  I estimated the size of the audience, about 10 by 10 meters, let it be a cube 10x10x10, let it be 10 cm accuracy. We get 1 million points.  A lot, but the processor can handle it.  In which case, accuracy can be reduced. <br><br>  So, the lectures are over, everyone should come up with projects and put together teams.  There were 60 people in the hall. <br>  The presentation of the teams has begun.  I came out third.  Briefly explained what my project is about and said that I already have a fee, and I plan to do the project alone.  The name is Audio sprut, because the sound sensors are like tentacles. <br>  All told about their projects.  People began to walk and join projects. <br><br>  Well, let's start.  The first thing was to accurately determine the time.  The first option is to count how many steps of the loop have been completed.  But here it is necessary to determine how long each step of the cycle takes, and this is not very accurate.  We had to find a high-precision timer.  I remembered that there is something in C ++ 11.  Searches on the Internet gave the decision. <br><br>  So the algorithm for working with sensors is as follows.  We interrogate all the sensors until one of them shows a signal.  His time is taken as zero.  Then we poll the remaining sensors and as soon as a signal appears at some signal, we record the current time for it.  We perform this survey until all sensors give a signal.  According to the obtained times for each sensor, we find its distance delta, multiplying the speed of sound by time. <br><br>  Measurements showed that digital sensors are polled at a rate of 83 kHz.  This gives an accuracy of about 2 cm for five sensors. Very good.  For the sake of interest, I measured the speed of the analog read.  About 4 kHz. <br><br>  It seems that the sensors I bought are not the ones I wanted, but they simplify my task.  Firstly, there is no need to look for a correspondence between analog signals, and secondly, accuracy is higher. <br><br>  But we must also take into account that Linux is not a real-time operating system.  Therefore, it is not guaranteed that the system will be occupied only by our code, and will not switch to something else.  Intel Edison with two cores would certainly help here.  But what is, that is. <br><br>  For tests, I took two sensors located at a short distance, about 15 centimeters. And I clicked the boys from the side of one sensor, then from the other.  In this case, it was clearly visible that the signal was delayed and the calculated delta of the distance was consistent with reality. <br><br>  Since I had my own board and a configured router, I was not dependent on the work of WiFi.  But there was a big problem, my internet was sometimes terrible.  At times the speed dropped to 100 kbits / s. <br><br><h1>  Must be cloudy today </h1><br>  So, the program determines the position of the sound source, it remains to transmit this information to the cloud. <br>  We were told that the simplest option is to send data through events.  I am trying to figure out the Python script to send something to the server (I have not worked on python before).  First, the script generates errors in the response from the server.  The neighboring team is also trying to send data and to no avail.  I tinker for a long time, and about a miracle, the answer is 201, it means there is no error and the data is transferred.  I go to Azure, and there is no data visible.  There are references, but I do not see the data.  I have been trying to figure it out for a long time, I ask the organizers, and it turns out that events do not suit me.  They are disposable, if it is considered it is deleted.  Surprise!  And what to use?  Tables <br><br>  Great, all over again.  The tables are not so simple.  The interface in Azure is not very intuitive.  I do not remember the details, but I created the server, I created the table.  Now write data there.  And this already turned out to be not such a trivial task.  Code similar to messages does not work.  After talking with Tatiana Smetanina, who surprisingly managed to run between the teams and help everyone, it becomes clear that the database is standard and you can work with it as with any MySQL.  It remains to connect to the database and make INSERT.  Left a little.  How to connect?  From C ++, I have no desire.  I don't know Python well.  But on Gagileo there is perl.  Fine!  I try to write a small test script.  But the DBI module is not installed.  I run cpan.  The Internet is slowing down for me, but something is swinging, it's already nice.  But at the end of the installation in about 20 minutes, it turns out that some kind of library or modules are missing.  I try to put this library in a similar way.  I try to put something else.  Time is running out, nothing works.  It's a shame.  As I understand it, the neighbors are similar.  Everything is somehow difficult, but the presentation was simple, just a few lines.  And it turns out that the database can be accessed via the REST protocol, for this you need to create a mobile client in Azure.  Good try.  Again a bunch of searches on the Internet.  Found an example on python.  And lo and behold, he writes to the database!  On the Azure website you can see the data that Galileo sends.  Great, add a call from C ++ to the system function, which runs the python script with parameters.  Everything.  You can forget about this part.  Now we need to learn how to read data from the database through JavaScript. <br><br><h1>  Base, give the data! </h1><br>  If you enter the address of the table in the browser, the browser displays JSON with the data.  All perfectly.  It remains to parse the data.  I am writing a small local html-ku with javascript, which should load the tablet and show it on the page.  Does not work.  No data.  Something is coming, but it is not clear what.  Begin to understand.  The debugger in the browser writes something about some rights.  What does it have to do with rights?  At the usual address everything is shown.  Tinkering, looking, poking around, looking.  Nothing is clear why it does not work.  After that, I don‚Äôt know what kind of attempt, I decide in steps to do what is written on the Azure page for working with mobile interfaces.  There it is proposed to start a local web server.  Delov for a couple of lines, but somehow I don‚Äôt like the server locally.  Well, if nothing helps, read the instructions.  I do everything as it is written, and everything works.  The local script page receives the data and displays it on the screen.  Hooray!  Of course, I wanted a web server, which is on Azure on the Internet, but this is already good. <br><br><h1>  Babylon, but not 5, but JS </h1><br>  There is data, it is necessary to fasten a 3D visualization based on Babylon JS. <br><br>  I measure the size of the table at which I sit, to make the correct 3D model of the room.  106 centimeters in length one section.  That is, the whole table is 2 meters.  Fine.  Three blocks with tables plus a passage, it turns out 10 meters.  Fine.  I add on the front wall, tables of the first row, tables of the organizers.  of the department.  In the browser, everything looks fine.  I think where to put the sensors.  While doing the estimation it turns out that something does not converge.  Tables, it turns out, consist not of two sections of 1 meter each, but of four.  And three blocks from the tables do not fit in 10 meters.  I go with a tape measure into the hallway, measure the size of the audience outside.  16 meters.  It is necessary to redraw everything. <br><br>  Dinner.  No, thanks, I can be patient without lunch.  Although half an hour, but it can help. <br><br>  Everything is working.  Data with the position of the points is read, you can still suffer with getting data from the site, and not from the local page.  Looking, looking, looking for a long time.  Then somewhere I notice in the security settings that access to the site is allowed only from localhost.  Well, yes, exactly, I remember that MySQL has a similar effect.  I add the address of the site to the allowed hosts and it all worked right away.  Hooray.  Everything had time.  I still have more than an hour. <br><br>  (It should be noted that while I was experimenting with adding and receiving data, the access was set up for all. Therefore, no access keys are specified in the data adding script. Now I have turned it off.) <br><br><h1>  Last preparations, time in bulk </h1><br>  Everything works, sensors receive data, the board calculates the position, sends it to the cloud, the site does a visualization.  It only remained to attach the long wires to the sensors in order to place them far apart in the audience and set their absolute position in space in the settings file.  I expected to place two sensors on the edges of my desk, two sensors on the chairs for the report and one in the center at the main table.  There was a whole hour left for that.  Time in bulk, I thought, and began to tear the double wires along.  The wires to the first two sensors should have been three meters. <br><br><img src="https://habrastorage.org/files/cf1/11c/228/cf111c228be749d0a38a9308b9f2bb40.jpg"><br><br>  The wire broke.  It is necessary to add a pair of wires with a single, so that they become three.  I start to twist them together, fixing with scotch tape every half meter.  All this took 10 minutes.  It is clear that at this rate I will not have time.  The wire is ready, but now you need to lengthen the wire from the sensor, including new wires in the gap.  I clean, twist, wrap tape.  I connect to the board, the sensor works.  Great, go to the next.  Since the time is not enough for everything, I decide to leave only 3 sensors.  With wires 3 meters, 3 meters and 8 meters.  The last eight-meter one already does not fix it with scotch tape, I just twist it a little.  Hurry, and this is very bad.  We clean the wire, it naturally breaks.  Corrected.  Made.  I connect the sensor.  And the LED on it is lit, although it should not.  I look at the wires, and I +5 served on the sensor output, immediately to the LED.  Fine, I think maybe burned.  I change the wires correctly, the sensor still glows red.  Just burned it!  I take one more.  Well there is a spare.  I connect.  It also glows red.  The tuning resistor does not help.  What's the matter?  I understand.  It turns out to be incorrectly connected to the board.  Well, maybe the ports burned on the board.  This is the end, there will be no demo.  I check everything again, I connect everything correctly.  And lo and behold, everything works.  And just 16:00, the beginning of the reports.  My second. <br><br><h1>  Reports </h1><br>  It‚Äôs good that I managed to launch a project on the Azure website, I don‚Äôt need to connect a laptop for a presentation.  Moreover, it is connected to the board through a router and it would be difficult to disable it.  I tell about the project.  Showing a 3D audience model with balls, previous debug positions of signal sources.  Clap your hands.  In the logs from the console you can see that the data has gone, rebooting the browser.  A new point should have appeared, but I honestly do not remember which were and which were not.  Everything. <br><br>  It is very pleasant to be one of the first, then you can sit and quietly listen to other reports.  Reports were different. <br><br><img src="https://habrastorage.org/files/d9a/0ed/248/d9a0ed248ae4499bb8c6b3f7a1045012.jpg"><br><br>  That's all.  Oh yeah, I became one of the winners of the hackathon and received a prize. <br><br><h1>  General impressions </h1><br>  Liked.  Such a large crowd of people who are interested.  I talked to some of them. <br>  Thanks to the hackathon, but it is unknown when I would take up Intel Galileo.  And to get to Azure, it is generally something impossible.  A lot has been learned. <br>  In general, thanks to Microsoft and Intel. <br><br>  And in conclusion, I bring the code that I had on the hackathon without changes. <br><br>  Files: <br><br><div class="spoiler">  <b class="spoiler_title">dist1.cpp</b> <div class="spoiler_text"><pre><code class="hljs lua">#include <span class="hljs-string"><span class="hljs-string">"mraa.h"</span></span> #include &lt;ctime&gt; #include &lt;ratio&gt; #include &lt;chrono&gt; #include &lt;vector&gt; #include &lt;iostream&gt; #include &lt;stdlib.h&gt; #include <span class="hljs-string"><span class="hljs-string">"funcs.h"</span></span> int main() { init(); int waitId = <span class="hljs-number"><span class="hljs-number">0</span></span>; const int numMics = NUM; // std::cout&lt;&lt;<span class="hljs-string"><span class="hljs-string">"Num sensors="</span></span>&lt;&lt;numMics&lt;&lt;std::endl; // <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; mraa_gpio_context gpio[numMics]; bool on[numMics]; int dist[numMics]; // std::chrono::high_resolution_clock::time_point times[numMics]; std::chrono::duration&lt;double&gt; times[numMics]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( int k = <span class="hljs-number"><span class="hljs-number">0</span></span>; k &lt; numMics; k++ ) { gpio[k] = mraa_gpio_init(k); mraa_gpio_dir(gpio[k],MRAA_GPIO_IN); } <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { std::cout&lt;&lt;<span class="hljs-string"><span class="hljs-string">"Wait..."</span></span>&lt;&lt;waitId&lt;&lt;std::endl; waitId++; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( int k = <span class="hljs-number"><span class="hljs-number">0</span></span>; k &lt; numMics; k++ ) { on[k] = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; dist[k] = <span class="hljs-number"><span class="hljs-number">0</span></span>; } auto numOn = <span class="hljs-number"><span class="hljs-number">0</span></span>; int currStep = <span class="hljs-number"><span class="hljs-number">0</span></span>; std::chrono::high_resolution_clock::time_point startTime; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( int k = <span class="hljs-number"><span class="hljs-number">0</span></span>; k &lt; numMics; k++ ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( ! on[k] ) { int v = mraa_gpio_read(gpio[k]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( v == <span class="hljs-number"><span class="hljs-number">0</span></span> ) { std::chrono::high_resolution_clock::time_point now = std::chrono::high_resolution_clock::now(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( numOn == <span class="hljs-number"><span class="hljs-number">0</span></span> ) { currStep = <span class="hljs-number"><span class="hljs-number">0</span></span>; startTime = now; } on[k] = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; dist[k] = currStep; times[k] = std::chrono::duration_cast&lt;std::chrono::duration&lt;double&gt; &gt;(now-startTime); numOn++; } } } currStep++; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (numOn &lt; numMics &amp;&amp; (currStep &lt; <span class="hljs-number"><span class="hljs-number">8000</span></span> || numOn &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( currStep &gt;= <span class="hljs-number"><span class="hljs-number">8000</span></span> ) continue; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( int k = <span class="hljs-number"><span class="hljs-number">0</span></span>; k &lt; numMics; k++ ) { printf(<span class="hljs-string"><span class="hljs-string">"%d "</span></span>,dist[k]); } printf(<span class="hljs-string"><span class="hljs-string">" === time(s): "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( int k = <span class="hljs-number"><span class="hljs-number">0</span></span>; k &lt; numMics; k++ ) { printf(<span class="hljs-string"><span class="hljs-string">"%f "</span></span>,times[k].count()); } printf(<span class="hljs-string"><span class="hljs-string">" === dist(m): "</span></span>); std::vector&lt;float&gt; L; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( int k = <span class="hljs-number"><span class="hljs-number">0</span></span>; k &lt; numMics; k++ ) { float d = <span class="hljs-number"><span class="hljs-number">300</span></span>*times[k].count(); L.push_back(d); printf(<span class="hljs-string"><span class="hljs-string">"%f "</span></span>,d); } Point3 event = getPosition(L); std::cout&lt;&lt;<span class="hljs-string"><span class="hljs-string">"Event=("</span></span>&lt;&lt;event.x&lt;&lt;<span class="hljs-string"><span class="hljs-string">","</span></span>&lt;&lt;event.y&lt;&lt;<span class="hljs-string"><span class="hljs-string">","</span></span>&lt;&lt;event.z&lt;&lt;<span class="hljs-string"><span class="hljs-string">")"</span></span>&lt;&lt;std::endl; <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> str[<span class="hljs-number"><span class="hljs-number">300</span></span>]; sprintf(str,<span class="hljs-string"><span class="hljs-string">"./test_rest_add.py %f %f %f"</span></span>,event.x,event.y,event.z); std::cout&lt;&lt;<span class="hljs-string"><span class="hljs-string">"send data"</span></span>&lt;&lt;std::endl; system(str); std::cout&lt;&lt;<span class="hljs-string"><span class="hljs-string">"send ok"</span></span>&lt;&lt;std::endl; // <span class="hljs-built_in"><span class="hljs-built_in">create</span></span> dists sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( int k = <span class="hljs-number"><span class="hljs-number">0</span></span>; k &lt; numMics; k++ ) { mraa_gpio_close(gpio[k]); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">funcs.h</b> <div class="spoiler_text"><pre> <code class="hljs rust">#include &lt;vector&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Point3</span></span></span></span> { float x,y,z; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DistPos</span></span></span></span> { Point3 p; float dist; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Box</span></span></span></span> { Point3 p1,p2; float step; }; void init(); Point3 getPosition(std::vector&lt;float&gt; &amp;dists); <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> int NUM;</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">funcs.cpp</b> <div class="spoiler_text"><pre> <code class="hljs rust">#include &lt;vector&gt; #include &lt;fstream&gt; #include &lt;iostream&gt; #include <span class="hljs-string"><span class="hljs-string">"funcs.h"</span></span> #include &lt;math.h&gt; std::vector&lt;Point3&gt; sensorPos; int NUM = <span class="hljs-number"><span class="hljs-number">0</span></span>; void readSensorPos() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( sensorPos.size() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } std::ifstream file(<span class="hljs-string"><span class="hljs-string">"positions.txt"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( ! file ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } int num = <span class="hljs-number"><span class="hljs-number">0</span></span>; file&gt;&gt;num; std::cout&lt;&lt;<span class="hljs-string"><span class="hljs-string">"Num="</span></span>&lt;&lt;num&lt;&lt;std::endl; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( int k = <span class="hljs-number"><span class="hljs-number">0</span></span>; k &lt; num; k++ ) { float x,y,z; file&gt;&gt;x&gt;&gt;y&gt;&gt;z; Point3 point; point.x = x; point.y = y; point.z = z; sensorPos.push_back( point ); std::cout&lt;&lt;<span class="hljs-string"><span class="hljs-string">"x="</span></span>&lt;&lt;x&lt;&lt;<span class="hljs-string"><span class="hljs-string">" "</span></span>; std::cout&lt;&lt;<span class="hljs-string"><span class="hljs-string">"y="</span></span>&lt;&lt;y&lt;&lt;<span class="hljs-string"><span class="hljs-string">" "</span></span>; std::cout&lt;&lt;<span class="hljs-string"><span class="hljs-string">"z="</span></span>&lt;&lt;z&lt;&lt;std::endl; } NUM = num; } void init() { readSensorPos(); } Point3 getPosition( std::vector&lt;DistPos&gt; dists, <span class="hljs-built_in"><span class="hljs-built_in">Box</span></span> <span class="hljs-keyword"><span class="hljs-keyword">box</span></span>) { std::cout&lt;&lt;<span class="hljs-string"><span class="hljs-string">"Box=("</span></span>; std::cout&lt;&lt;<span class="hljs-keyword"><span class="hljs-keyword">box</span></span>.p1.x&lt;&lt;<span class="hljs-string"><span class="hljs-string">","</span></span>&lt;&lt;<span class="hljs-keyword"><span class="hljs-keyword">box</span></span>.p1.y&lt;&lt;<span class="hljs-string"><span class="hljs-string">","</span></span>&lt;&lt;<span class="hljs-keyword"><span class="hljs-keyword">box</span></span>.p1.z&lt;&lt;<span class="hljs-string"><span class="hljs-string">")-("</span></span>; std::cout&lt;&lt;<span class="hljs-keyword"><span class="hljs-keyword">box</span></span>.p2.x&lt;&lt;<span class="hljs-string"><span class="hljs-string">","</span></span>&lt;&lt;<span class="hljs-keyword"><span class="hljs-keyword">box</span></span>.p2.y&lt;&lt;<span class="hljs-string"><span class="hljs-string">","</span></span>&lt;&lt;<span class="hljs-keyword"><span class="hljs-keyword">box</span></span>.p2.z&lt;&lt;<span class="hljs-string"><span class="hljs-string">")"</span></span>&lt;&lt;std::endl; std::cout&lt;&lt;<span class="hljs-string"><span class="hljs-string">"dists.size="</span></span>&lt;&lt;dists.size()&lt;&lt;std::endl; Point3 bestPoint; bestPoint.x = <span class="hljs-number"><span class="hljs-number">0</span></span>; bestPoint.y = <span class="hljs-number"><span class="hljs-number">0</span></span>; bestPoint.z = <span class="hljs-number"><span class="hljs-number">0</span></span>; float minErr = <span class="hljs-number"><span class="hljs-number">10e20</span></span>; float normDist[NUM]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( float tx = <span class="hljs-keyword"><span class="hljs-keyword">box</span></span>.p1.x; tx &lt;= <span class="hljs-keyword"><span class="hljs-keyword">box</span></span>.p2.x; tx+= <span class="hljs-keyword"><span class="hljs-keyword">box</span></span>.step ) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( float ty = <span class="hljs-keyword"><span class="hljs-keyword">box</span></span>.p1.y; ty &lt;= <span class="hljs-keyword"><span class="hljs-keyword">box</span></span>.p2.y; ty+= <span class="hljs-keyword"><span class="hljs-keyword">box</span></span>.step ) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( float tz = <span class="hljs-keyword"><span class="hljs-keyword">box</span></span>.p1.z; tz &lt;= <span class="hljs-keyword"><span class="hljs-keyword">box</span></span>.p2.z; tz+= <span class="hljs-keyword"><span class="hljs-keyword">box</span></span>.step ) { float currErr = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//std::vector&lt;float&gt; normDist(dists.size()); int kk = 0; for( auto iter = dists.begin(); iter != dists.end(); iter++, kk++ ) { float dx = iter-&gt;px - tx; float dy = iter-&gt;py - ty; float dz = iter-&gt;pz - tz; float d = sqrt(dx*dx + dy*dy + dz*dz); normDist[kk] = d; // float err = d - (iter-&gt;dist * iter-&gt;dist); // currErr += err*err; } float minVal = normDist[0]; for( int k = 1; k &lt; NUM; k++ ) { if( normDist[k] &lt; minVal ) minVal = normDist[k]; } for( int k = 0; k &lt; NUM; k++ ) { normDist[k] -= minVal; } currErr = 0; for( int k = 0; k &lt; NUM; k++ ) { float delta = normDist[k] - dists[k].dist; currErr = delta*delta; } if( currErr &lt; minErr ) { minErr = currErr; Point3 p; px = tx; py = ty; pz = tz; bestPoint = p; } } } } return bestPoint; } Point3 getPosition(std::vector&lt;float&gt; &amp;dists) { Point3 p1,p2; p1.x = -5; p1.y = 0; p1.z = -5; p2.x = 5; p2.y = 3; p2.z = 5; float step = 0.1; Box box; box.p1 = p1; box.p2 = p2; box.step = step; std::cout&lt;&lt;"DistPos="&lt;&lt;std::endl; std::vector&lt;DistPos&gt; distPos; for( int k = 0; k &lt; dists.size(); k++ ) { DistPos dp; dp.p = sensorPos[k]; dp.dist = dists[k]; distPos.push_back(dp); std::cout&lt;&lt;"("&lt;&lt;dp.px&lt;&lt;","&lt;&lt;dp.py&lt;&lt;","&lt;&lt;dp.pz&lt;&lt;") d="&lt;&lt;dp.dist&lt;&lt;std::endl; } Point3 bestPoint = getPosition( distPos, box); return bestPoint; } //const int NUM = 3; //float dist[NUM];</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">positions.txt</b> <div class="spoiler_text"><pre> <code class="hljs">3 2 1 3 -2 1 3 0 1 5</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">test_rest_add.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python import urllib import urllib2 import sys x = sys.argv[1] y = sys.argv[2] z = sys.argv[3] #print x," ",y," ",z,"\n" url = 'https://audiosprut.azure-mobile.net/tables/pos' params = urllib.urlencode({ "x": x, "y": y, "z": z, "present" : "true" }) response = urllib2.urlopen(url, params).read()</span></span></code> </pre><br></div></div><br><br>  Link: <a href="http://audiosprut.azurewebsites.net/">audiosprut.azurewebsites.net</a> </div><p>Source: <a href="https://habr.com/ru/post/255447/">https://habr.com/ru/post/255447/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255435/index.html">Google removed scandalous photo to avoid ban</a></li>
<li><a href="../255437/index.html">Use the built-in firewall in InfoboxCloud</a></li>
<li><a href="../255439/index.html">Intel Summer School 0x7DF. Time to apply</a></li>
<li><a href="../255443/index.html">Git for Windows Alternatives</a></li>
<li><a href="../255445/index.html">RTOS should simplify the development of IoT devices</a></li>
<li><a href="../255449/index.html">Analysis of all tasks of the qualifying game Yandex.Root</a></li>
<li><a href="../255451/index.html">The story of one spacewalk</a></li>
<li><a href="../255453/index.html">Microsoft Unveils New Container Technology for Next-Generation Cloud</a></li>
<li><a href="../255455/index.html">Ice cream candy, or how to add some Material to your application</a></li>
<li><a href="../255457/index.html">Lights Out and its unusual uses</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>