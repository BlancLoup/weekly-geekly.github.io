<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to calculate (user city) by IP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Knowing the location of a person, you can do a thousand useful and not so much things: to offer the right product and call the delivery price in advan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to calculate (user city) by IP</h1><div class="post__text post__text-html js-mediator-article">  Knowing the location of a person, you can do a thousand useful and not so much things: to offer the right product and call the delivery price in advance, show the habitat of the Pokemon, display local news or advise a cafe nearby. <br><br>  Location is important. <br><br><img src="https://habrastorage.org/webt/59/e4/ed/59e4ed65ca433566036926.jpeg"><br><a name="habracut"></a><br><h2>  What are the methods of geolocation? </h2><br>  There are 2 basic methods of geolocation, if we exclude the parsing of geotags of photos and espionage from satellites. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Take the IP-address of the user and in a special directory to find a city with the country.</b> <br><br><img src="https://habrastorage.org/webt/59/e6/49/59e649ec07d43532212060.png"><br><br>  <b>Find out the location through the HTML5 Geolocation API.</b> <br><br><img src="https://habrastorage.org/webt/59/e6/4b/59e64bd81e05e413530105.png"><br><br>  In this article we tell how to find the city of the user, because such accuracy is usually enough.  City is enough online stores, courier services, news aggregators, sites with weather forecasts. <br><br>  The city is better identified by IP: the method always works and does not disturb the user.  And in geolocation over IP, the main thing is to find a directory that conveniently connects and gives the city without errors.  The second part of the article is about this. <br><br><h2>  How we chose the directory of IP addresses </h2><br>  There is a big problem in comparing directories: it is impossible to verify whether the IP address belongs to the city found by the directory right now.  Yesterday IP was related to Peter, and today it is Nizhny Novgorod. <br><br>  Therefore, we compared reference books by such criteria: <br><br><ol><li>  Cost <br></li><li>  The frequency of updates. <br></li><li>  The number of IP address ranges for Russia. <br></li><li>  The number of addresses "on the ground", or completeness.  To measure completeness, we drove all the addresses from each directory through <a href="https://dadata.ru/api/clean/%3Futm_source%3Dhabrahabr%26utm_medium%3Darticle%26utm_content%3Dfull_spec%26utm_campaign%3Dgeolocation">the standardization API "Dadata"</a> .  The service brought addresses to the same format and sorted out by type: region, district, city.  We considered these standardized addresses. <br></li><li>  Format: how handy it is to use. <br></li><li>  Libraries and integration with popular frameworks. <br></li><li>  What can be pulled out of the base in addition to the city. <br></li><li>  Whose is Crimea (politics is politics, but business needs work). <br></li><li>  Detailing by human settlements.  To find out, we drove 35,000 random unique IP addresses through each directory.  Then they compared how many unique cities each directory has split. <br></li></ol><br>  We considered such reference books: <br><br><ul><li>  <a href="http://ipgeobase.ru/">IPGeoBase</a> , <br></li><li>  <a href="https://sypexgeo.net/ru/download/">SypexGEO</a> , <br></li><li>  <a href="https://dev.maxmind.com/geoip/geoip2/geolite2/">MaxMind Lite</a> , <br></li><li>  <a href="http://ip2ruscity.com/">ip2ruscity</a> . <br></li></ul><br><h2>  IPGeoBase </h2><br>  <b>Cost</b>  Free. <br><br>  <b>Updates.</b>  Everyday. <br><br>  <b>IP address pools in Russia.</b>  43751 pool, <i>this is the first place</i> . <br><br>  <b>Completeness.</b>  728 objects: <br><br><ul><li>  3 regions (Moscow, St. Petersburg, Sevastopol); <br></li><li>  2 districts; <br></li><li>  601 city; <br></li><li>  113 other settlements. <br></li></ul><br>  <i>Third place for this parameter.</i> <br><br>  <b>Base format</b>  Tab-separated text files.  In one city file with an ID, in the other - the IP ranges linked to them. <br><br><img src="https://habrastorage.org/webt/59/e5/01/59e501be6d6b6769881527.jpeg"><br><br>  Encoding in files is a pain called Windows-1251.  Well, there is iconv - we received UTF-8 with a flick of the wrist: <br><br><pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">iconv</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-f</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">WINDOWS-1251</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">UTF-8</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cities</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.txt</span></span> &gt; <span class="hljs-selector-tag"><span class="hljs-selector-tag">cities_utf8</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.txt</span></span></code> </pre> <br>  The base is slow (still, this is a text file) - the traversal of 35,000 addresses took several minutes. <br><br>  <b>Libraries.</b>  There are ready for <a href="http://ipgeobase.ru/files/soft/new_search.pl">Perl</a> , <a href="https://github.com/mokevnin/ipgeobase">Ruby</a> and <a href="https://github.com/greggy/python-ipgeobase">Python</a> , but the newest one is from 2013.  For 4 years, Trump became the president of the United States, PHP 7 was released, a million JS frameworks appeared, but none of the libraries were updated to this handbook. <br><br>  It took an hour to port the library to Python 3. <br><br>  <b>What can be pulled out of the base.</b> <br><br><pre> <code class="hljs 1c">('RU', '-', '-', '59.<span class="hljs-number"><span class="hljs-number">939037</span></span>', '30.<span class="hljs-number"><span class="hljs-number">315784</span></span>')</code> </pre> <br>  <b>Crimea.</b>  Our. <br><br>  <b>Detailing</b>  The sample of 35,000 addresses found 372 different localities. <br><br>  <i>This is the third place with a slight lag from the second.</i> <br><br>  <b>Verdict.</b>  IPGeoBase is a collection of cities and IP address ranges that is wrapped in .txt files with a tab-separated structure.  Updated frequently. <br><br>  The minuses are the libraries of Ochakov times, and the text file is not the most convenient solution for accessing data. <br><br>  <i>I've seen life, but still flying Tu-154.</i> <br><br><img src="https://habrastorage.org/webt/59/e5/01/59e501bdb9adb867685930.jpeg"><br><br><br><h2>  SypexGEO </h2><br>  <b>Cost</b>  Free, distributed under the BSD license. <br><br>  <b>Updates.</b>  A couple of times a month. <br><br>  <b>IP address pools in Russia.</b>  Total ranges 1696337, but it is unclear how many of them belong to Russia: the data are buried in the directory.  <i>By this parameter, the place is not awarded.</i> <br><br>  <b>Completeness.</b>  832 objects: <br><br><ul><li>  2 regions <br></li><li>  1 district <br></li><li>  630 cities, <br></li><li>  196 other settlements. <br></li></ul><br>  <i>Second place.</i>  <i>Not bad!</i> <br><br>  <b>Format.</b>  Strange .dat file with structure at offsets.  The insides quickly pick it up did not work out - the creator on the forum says that there is no converter for translating the base into a human-readable form. <br><br>  How to work with the directory, if not through the library - is unclear.  For the curious there is a <a href="https://sypexgeo.net/ru/docs/sxgeo22/">specification on the site directory</a> . <br><br>  The speed is good: bypassing 35,000 addresses took a few seconds. <br><br>  <b>Libraries.</b>  There are for <a href="https://github.com/idlesign/pysyge">Python</a> , <a href="https://github.com/marciocamello/yii2-sypexgeo/">PHP Yii</a> , <a href="https://github.com/scriptixru/sypexgeo">PHP Laravel</a> , <a href="https://github.com/sypexgeo/sypexgeo4j">Java</a> , <a href="https://github.com/kolesnikovde/sypex_geo">Ruby</a> .  Updated 2-3 years ago.  There is also integration with <a href="https://github.com/yamilovs/SypexGeoBundle/">symfony</a> and a plugin for <a href="https://github.com/akalevich/wp-sypexgeo/">wordpress</a> . <br><br>  <b>What can be pulled out of the database:</b> <br><br><pre> <code class="hljs 1c">{'city':   {'id': <span class="hljs-number"><span class="hljs-number">498817</span></span>,    'lat': <span class="hljs-number"><span class="hljs-number">59.93863</span></span>,    'lon': <span class="hljs-number"><span class="hljs-number">30.31413</span></span>,    'name_ru': '-',    'name_en': 'Saint Petersburg'}, 'region': {'id': <span class="hljs-number"><span class="hljs-number">536203</span></span>, 'name_ru': '-', 'name_en': 'Sankt-Peterburg', 'iso': 'RU-SPE'}, 'country': {'id': <span class="hljs-number"><span class="hljs-number">185</span></span>, 'iso': 'RU', 'lat': <span class="hljs-number"><span class="hljs-number">60.0</span></span>, 'lon': <span class="hljs-number"><span class="hljs-number">100.0</span></span>, 'name_ru': '', 'name_en': 'Russia'}, 'region': '-', 'tz': ''<span class="hljs-string"><span class="hljs-string">"}</span></span></code> </pre> <br>  <b>Crimea</b>  Not ours. <br><br>  <b>Detailing</b>  400 different settlements were found on a sample of 35,000 addresses. <br><br>  <i>This is the second place.</i> <br><br>  <b>Verdict.</b>  Very captivating speed, bias - force.  The authors say that they specifically optimized the base for high loads. <br><br>  In terms of content and accuracy, it is similar to IPGeoBase - here there are a few more objects, 10% of the addresses are resolved differently. <br><br>  The base is fully open. <br><br>  Unfortunately, the Crimea does not rezolvit to Russia. <br><br>  <i>Helicopter Black Hawk - it flies cool, but not everyone will do.</i> <br><br><img src="https://habrastorage.org/webt/59/e5/01/59e501bd51e2f792098859.jpeg"><br><br><br><h2>  MaxMind Lite </h2><br>  <b>Cost</b>  Free with a Creative Commons license.  There is a paid version, which costs $ 1,470 per year. <br><br>  <b>Updates.</b>  The first Tuesday of each month (just like a passport office). <br><br>  <b>IP address pools in Russia.</b>  91432. If you remove the IP-addresses that rezolvitsya in Russia without a city - 42822. <i>This is the second place.</i> <br><br>  <b>Completeness.</b>  1392 objects: <br><br><ul><li>  61 region <br></li><li>  819 cities <br></li><li>  497 settlements. <br></li></ul><br>  <i>First place by a wide margin!</i> <br><br>  <b>Base format</b>  Own .mmdb.  Cities and ranges of IP addresses are also available in .csv files that are archived with the database. <br><br>  The database has versions with different accuracy: to the country, to the city, as well as the ASN directory (unique numbers of Internet providers).  There is also a base for IPv6 addresses. <br><br>  <b>Libraries.</b>  There is a complete order here - there are <a href="https://github.com/maxmind">several dozen</a> libraries for working with the database on the Githab. <br><br>  <b>What can be pulled out of the base.</b>  Extraction is super detailed and multilanguage.  MaxMind gives an interesting parameter <i>accuracy_radius</i> - the accuracy of the radius of coordinates in kilometers. <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"city"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"geoname_id"</span></span>: <span class="hljs-number"><span class="hljs-number">498817</span></span>, <span class="hljs-attr"><span class="hljs-attr">"names"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"de"</span></span>: <span class="hljs-string"><span class="hljs-string">"Sankt Petersburg"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"en"</span></span>: <span class="hljs-string"><span class="hljs-string">"Saint Petersburg"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"es"</span></span>: <span class="hljs-string"><span class="hljs-string">"San Petersburgo"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"fr"</span></span>: <span class="hljs-string"><span class="hljs-string">"Saint-P√©tersbourg"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ja"</span></span>: <span class="hljs-string"><span class="hljs-string">"„Çµ„É≥„ÇØ„Éà„Éö„ÉÜ„É´„Éñ„É´„ÇØ"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pt-BR"</span></span>: <span class="hljs-string"><span class="hljs-string">"S√£o Petersburgo"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ru"</span></span>: <span class="hljs-string"><span class="hljs-string">"-"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"zh-CN"</span></span>: <span class="hljs-string"><span class="hljs-string">"Âú£ÂΩºÂæóÂ†°"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"continent"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"code"</span></span>: <span class="hljs-string"><span class="hljs-string">"EU"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"geoname_id"</span></span>: <span class="hljs-number"><span class="hljs-number">6255148</span></span>, <span class="hljs-attr"><span class="hljs-attr">"names"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"de"</span></span>: <span class="hljs-string"><span class="hljs-string">"Europa"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"en"</span></span>: <span class="hljs-string"><span class="hljs-string">"Europe"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"es"</span></span>: <span class="hljs-string"><span class="hljs-string">"Europa"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"fr"</span></span>: <span class="hljs-string"><span class="hljs-string">"Europe"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ja"</span></span>: <span class="hljs-string"><span class="hljs-string">"„É®„Éº„É≠„ÉÉ„Éë"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pt-BR"</span></span>: <span class="hljs-string"><span class="hljs-string">"Europa"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ru"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"zh-CN"</span></span>: <span class="hljs-string"><span class="hljs-string">"Ê¨ßÊ¥≤"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"country"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"geoname_id"</span></span>: <span class="hljs-number"><span class="hljs-number">2017370</span></span>, <span class="hljs-attr"><span class="hljs-attr">"iso_code"</span></span>: <span class="hljs-string"><span class="hljs-string">"RU"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"names"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"de"</span></span>: <span class="hljs-string"><span class="hljs-string">"Russland"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"en"</span></span>: <span class="hljs-string"><span class="hljs-string">"Russia"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"es"</span></span>: <span class="hljs-string"><span class="hljs-string">"Rusia"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"fr"</span></span>: <span class="hljs-string"><span class="hljs-string">"Russie"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ja"</span></span>: <span class="hljs-string"><span class="hljs-string">"„É≠„Ç∑„Ç¢"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pt-BR"</span></span>: <span class="hljs-string"><span class="hljs-string">"R√∫ssia"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ru"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"zh-CN"</span></span>: <span class="hljs-string"><span class="hljs-string">"‰øÑÁΩóÊñØ"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"location"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"accuracy_radius"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-attr"><span class="hljs-attr">"latitude"</span></span>: <span class="hljs-number"><span class="hljs-number">59.9321</span></span>, <span class="hljs-attr"><span class="hljs-attr">"longitude"</span></span>: <span class="hljs-number"><span class="hljs-number">30.1968</span></span>, <span class="hljs-attr"><span class="hljs-attr">"time_zone"</span></span>: <span class="hljs-string"><span class="hljs-string">"Europe/Moscow"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"postal"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"code"</span></span>: <span class="hljs-string"><span class="hljs-string">"191023"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"registered_country"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"geoname_id"</span></span>: <span class="hljs-number"><span class="hljs-number">2017370</span></span>, <span class="hljs-attr"><span class="hljs-attr">"iso_code"</span></span>: <span class="hljs-string"><span class="hljs-string">"RU"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"names"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"de"</span></span>: <span class="hljs-string"><span class="hljs-string">"Russland"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"en"</span></span>: <span class="hljs-string"><span class="hljs-string">"Russia"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"es"</span></span>: <span class="hljs-string"><span class="hljs-string">"Rusia"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"fr"</span></span>: <span class="hljs-string"><span class="hljs-string">"Russie"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ja"</span></span>: <span class="hljs-string"><span class="hljs-string">"„É≠„Ç∑„Ç¢"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pt-BR"</span></span>: <span class="hljs-string"><span class="hljs-string">"R√∫ssia"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ru"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"zh-CN"</span></span>: <span class="hljs-string"><span class="hljs-string">"‰øÑÁΩóÊñØ"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"subdivisions"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"geoname_id"</span></span>: <span class="hljs-number"><span class="hljs-number">536203</span></span>, <span class="hljs-attr"><span class="hljs-attr">"iso_code"</span></span>: <span class="hljs-string"><span class="hljs-string">"SPE"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"names"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"en"</span></span>: <span class="hljs-string"><span class="hljs-string">"St.-Petersburg"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"es"</span></span>: <span class="hljs-string"><span class="hljs-string">"San Petersburgo"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"fr"</span></span>: <span class="hljs-string"><span class="hljs-string">"L√©ningrad"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ru"</span></span>: <span class="hljs-string"><span class="hljs-string">"-"</span></span> } } ], <span class="hljs-attr"><span class="hljs-attr">"traits"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"ip_address"</span></span>: <span class="hljs-string"><span class="hljs-string">"109.205.249.212"</span></span> } }</code> </pre> <br>  <b>Crimea.</b>  Not ours. <br><br>  <b>Detailing</b>  On a sample of 35,000 addresses, the directory found 749 address objects. <br><br>  <i>This is the first place.</i> <br><br>  But there are nuances: <br><br><ul><li>  in 13% of cases, the base failed to determine the city.  I understood only that he is in the Russian Federation, and split the country; <br></li><li>  The creators hint that determining the IP address is not the strongest side of the free version.  For accuracy control, they suggest monitoring <i>accuracy_radius</i> . <br></li></ul><br>  <b>Verdict.</b>  Detailed base with elegant issuance. <br><br>  In 50% of cases, the results diverge from the previous two databases - the accuracy and detail of MaxMind Lite is higher. <br><br>  But there are fundamental disadvantages - the frequency of updates and the Crimea. <br><br>  <i>Heaped spacecraft, which is updated once a month and does not consider the Crimea Russian.</i> <br><br><img src="https://habrastorage.org/webt/59/e5/01/59e501bda7c37355449126.jpeg"><br><br><br><h2>  ip2ruscity </h2><br>  <b>Cost</b>  Paid, costs 5,000 rubles a year. <br><br>  <b>Updates.</b>  Once a month. <br><br>  <b>IP address pools in Russia.</b>  34907 pool, <i>third place</i> . <br><br>  <b>Completeness.</b>  486 objects: <br><br><ul><li>  4 regions <br></li><li>  454 cities <br></li><li>  28 settlements. <br></li></ul><br>  <i>The fourth place, which is much weaker than the third.</i> <br><br>  <b>Base format</b>  Tab-separated text files or SQL files.  In them - cities, regions, ranges of IP addresses.  There are also telephone codes of cities, but for some reason they are only available in MySQL-format.  In general, as in the program of the party ‚ÄúUncertain Russia‚Äù - it will be medium (not directly cool, so normal). <br><br>  The beginning and end of the ranges of IP addresses to save space are wrapped in a uint-format.  They will have to independently lead to the appearance of IP addresses. <br><br><img src="https://habrastorage.org/webt/59/e5/01/59e501be01679920365456.jpeg"><br><br>  Not very convenient, but you can live.  In Python, it is easy to do: <br><br><pre> <code class="hljs go"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> socket, <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> socket.inet_ntoa(<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>.pack(<span class="hljs-string"><span class="hljs-string">'!I'</span></span>, <span class="hljs-number"><span class="hljs-number">84098303</span></span>)) <span class="hljs-string"><span class="hljs-string">'5.3.60.255'</span></span></code> </pre> <br>  <b>Libraries.</b>  Not a single one was found :(. I had to nest my avant-garde teaming for research, I will not publish the code. <br><br>  The service recently appeared API.  Through it give: <br><br><ul><li>  city, <br></li><li>  region, <br></li><li>  coordinates on Google Maps and Yandex. Maps. <br></li></ul><br>  The API is relatively free - no more than 20 requests per day from a single IP address.  In the paid version give 3000 requests per hour. <br><br>  <b>What can be pulled out of the base.</b> <br><br><pre> <code class="hljs cs">{<span class="hljs-string"><span class="hljs-string">'city'</span></span>: <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'region'</span></span>: <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'region_id'</span></span>: <span class="hljs-string"><span class="hljs-string">'78'</span></span>}</code> </pre> <br>  If you use the MySQL-format database, the telephone code of the city is also returned. <br><br>  <b>Crimea.</b>  Our. <br><br>  <b>Detailing</b>  The sample of 35,000 addresses found 273 localities.  <i>This is the last place.</i> <br><br>  <b>Verdict.</b>  It seems to be inexpensive, but for money it could be better. <br><br>  <i>Screw ATR-72 airline Air Serbia.</i> <br><br><img src="https://habrastorage.org/webt/59/e5/01/59e501be0e0b6565468587.jpeg"><br><br><br><h2>  Summing up (as the first channel) </h2><br>  Free MaxMind Lite in almost all parameters faster, higher and stronger than the rest.  However, it has 2 important drawbacks - it is updated only once a month and does not consider Crimea to be Russian. <br><br>  At Dadat, we did not sleep at night and thought about which directory to choose for <a href="https://dadata.ru/api/detect_address_by_ip/%3Futm_source%3Dhabrahabr%26utm_medium%3Darticle%26utm_content%3DAPI_landing%26utm_campaign%3Dgeolocation">our geolocation API</a> .  As a result, they took IPGeoBase as a basis and screwed it on top of any advantages. <br><br>  Compared with the ‚Äúbare‚Äù IPGeoBase, ‚ÄúDadata‚Äù is more convenient. <br><br>  <b>Updated automatically.</b>  The service updates the directory as soon as a new version is released; there is no need to recall this. <br><br>  <b>Libraries are not needed</b> .  The reference book is accessible on API, any HTTP-library will be connected to it.  The request is very simple: you only send the IP address and the token that you give when registering at <a href="https://dadata.ru/api/detect_address_by_ip/%3Futm_source%3Dhabrahabr%26utm_medium%3Darticle%26utm_content%3Ddadata_direct%26utm_campaign%3Dgeolocation">DaData.ru</a> . <br><br><pre> <code class="hljs kotlin">curl -X GET \ -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"Authorization: Token </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${yoursecrettoken}</span></span></span><span class="hljs-string">"</span></span> \ https:<span class="hljs-comment"><span class="hljs-comment">//suggestions.dadata.ru/suggestions/api/4_1/rs/detectAddressByIp?ip=213.180.193.3</span></span></code> </pre><br>  <b>The service gives much more data</b> than the "bare" directory.  In addition to the name of the found object: <br><br><ul><li>  detailing which the IP could be split: country, region, district, city, town; <br></li><li>  types and names of the found and all higher address objects (for example, city ‚Üí district ‚Üí region ‚Üí country); <br></li><li>  KLADR and FIAS codes for the found and all higher address objects (region, district, etc.); <br></li><li>  a sign of the district center, region, region, and region; <br></li><li>  codes IFTS, OKATO and OKTMO. <br></li></ul><br>  In total, there are several dozens of fields for IP, and there is a <a href="https://dadata.ru/api/detect_address_by_ip/%3Futm_source%3Dhabrahabr%26utm_medium%3Darticle%26utm_content%3Dfull_spec%26utm_campaign%3Dgeolocation">full specification</a> on DaData.ru. <br><br>  <i>We turned a working but unpainted Tu-154 into an Airbus A-380.</i> <br><br>  In the economy we carry free of charge - you can make 10,000 requests per day to the API, <a href="https://dadata.ru/%3Futm_source%3Dhabrahabr%26utm_medium%3Darticle%26utm_content%3Dregistration%26utm_campaign%3Dgeolocation">simply by registering</a> .  If you need more, it will cost from 4000 rubles per year. <br><br><img src="https://habrastorage.org/webt/59/e5/01/59e501bd61436167692769.jpeg"></div><p>Source: <a href="https://habr.com/ru/post/340466/">https://habr.com/ru/post/340466/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../340456/index.html">Empowered pull requests</a></li>
<li><a href="../340458/index.html">How to check if the pointer value is in the specified memory area</a></li>
<li><a href="../340460/index.html">The course of the young fighter PostgreSQL</a></li>
<li><a href="../340462/index.html">SoundCloud Sound Quality Study</a></li>
<li><a href="../340464/index.html">SALI is your ~ programming language</a></li>
<li><a href="../340474/index.html">How was DevFest Siberia 2017</a></li>
<li><a href="../340476/index.html">User Convenience in Virtual Reality Solutions - VRMonkey Tips</a></li>
<li><a href="../340478/index.html">Burp Suite Extensions for Effective Web Application Testing</a></li>
<li><a href="../340480/index.html">Uneducated youth. Babylonian babies</a></li>
<li><a href="../340484/index.html">UPS APC BC750-RS - convenient protection for the "home office"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>