<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Language R to help habra-extra</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The following topic inspired me to write this article: In search of the perfect post, or the riddle of Habr . The fact is that after acquaintance with...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Language R to help habra-extra</h1><div class="post__text post__text-html js-mediator-article">  The following topic inspired me to write this article: <a href="http://habrahabr.ru/post/162209/">In search of the perfect post, or the riddle of Habr</a> .  The fact is that after acquaintance with the language R, I look askance at any attempts, to calculate something in Excel.  But I must admit that I met R only a week ago. <br><br>  Purpose: To collect data from the beloved HabraHabr by means of the R language and to carry out, in fact, what the R language was created for, namely: statistical analysis. <br><br>  So, after reading this topic you will learn: <br><ul><li>  How can R be used to extract data from Web resources </li><li>  How to convert data for later analysis </li><li>  What resources are highly recommended for reading for everyone to get acquainted with R closer </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It is expected that the reader is self-sufficient enough to become familiar with the basic structures of the language.  For this, the links at the end of the article are better suited. <br><br><a name="habracut"></a><br><h4>  Training </h4><br>  We will need the following resources: <br><ul><li>  <a href="http://www.r-project.org/">Language Interpreter R</a> </li><li>  <a href="http://www.rstudio.com/">RStudio is a very convenient IDE for working with R</a> </li></ul><br>  After installation, you should see something like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/50d/5e4/6b9/50d5e46b9524d60d630b516208289832.png" alt="image"><br>  In the right bottom panel on the Packages tab, you can find a list of installed packages.  We will need to additionally install the following: <br><ul><li>  Rcurl - to work with the network.  Anyone who has worked with CURL will immediately understand all the possibilities. </li><li>  XML - package for working with DOM tree XML document.  We need the functionality of finding elements by xpath </li></ul><br>  Click ‚ÄúInstall Packages‚Äù, select the ones you need, and then select them with a check mark to load them into the current environment. <br><br><h4>  Get the data </h4><br>  To obtain a DOM document object obtained from the Internet, it is enough to execute the following lines: <br><pre><code class="hljs lisp">url&lt;-<span class="hljs-string"><span class="hljs-string">"http://habrahabr.ru/feed/posts/habred/page10/"</span></span> cookie&lt;-<span class="hljs-string"><span class="hljs-string">"  "</span></span> html&lt;-getURL(<span class="hljs-name"><span class="hljs-name">url</span></span>, cookie=cookie) doc&lt;-htmlParse(<span class="hljs-name"><span class="hljs-name">html</span></span>)</code> </pre> <br>  Pay attention to the transmitted cookies.  If you want to repeat the experiment, then you will need to substitute your cookies, which your browser receives after logging in to the site.  Next we need to get the data we are interested in, namely: <br><ul><li>  When the entry was posted </li><li>  How many views </li><li>  How many people registered in favorites </li><li>  How many clicks on +1 and -1 (total) </li><li>  How many +1 clicks </li><li>  How much -1 </li><li>  Current rating </li><li>  Number of comments </li></ul><br>  Not giving in particular in details I will give the code immediately: <br><pre> <code class="hljs lisp"> published&lt;-xpathSApply(<span class="hljs-name"><span class="hljs-name">doc</span></span>, <span class="hljs-string"><span class="hljs-string">"//div[@class='published']"</span></span>, xmlValue) pageviews&lt;-xpathSApply(<span class="hljs-name"><span class="hljs-name">doc</span></span>, <span class="hljs-string"><span class="hljs-string">"//div[@class='pageviews']"</span></span>, xmlValue) favs&lt;-xpathSApply(<span class="hljs-name"><span class="hljs-name">doc</span></span>, <span class="hljs-string"><span class="hljs-string">"//div[@class='favs_count']"</span></span>, xmlValue) scoredetailes&lt;-xpathSApply(<span class="hljs-name"><span class="hljs-name">doc</span></span>, <span class="hljs-string"><span class="hljs-string">"//span[@class='score']"</span></span>, xmlGetAttr, <span class="hljs-string"><span class="hljs-string">"title"</span></span>) scores&lt;-xpathSApply(<span class="hljs-name"><span class="hljs-name">doc</span></span>, <span class="hljs-string"><span class="hljs-string">"//span[@class='score']"</span></span>, xmlValue) comments&lt;-xpathSApply(<span class="hljs-name"><span class="hljs-name">doc</span></span>, <span class="hljs-string"><span class="hljs-string">"//span[@class='all']"</span></span>, xmlValue) hrefs&lt;-xpathSApply(<span class="hljs-name"><span class="hljs-name">doc</span></span>, <span class="hljs-string"><span class="hljs-string">"//a[@class='post_title']"</span></span>, xmlGetAttr, <span class="hljs-string"><span class="hljs-string">"href"</span></span>)</code> </pre><br>  Here we used the search for elements and attributes using xpath. <br>  Further, it is highly recommended to generate data.frame from the obtained data - this is an analogue of the database tables.  It will be possible to make requests of different levels of complexity.  Sometimes you wonder how elegant you can do this or that thing in R. <br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">posts</span></span>&lt;-<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.frame(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hrefs</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">published</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">scoredetailes</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">scores</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pageviews</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">favs</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comments</span></span></span><span class="hljs-class">)</span></span></code> </pre><br>  After the data.frame is formed, it will be necessary to correct the received data: convert the lines into numbers, get the real date in the normal format, etc.  We do it this way: <br><br><pre> <code class="hljs php"> posts$comments&lt;-<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.character(posts$comments)) posts$scores&lt;-<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.character(posts$scores)) posts$favs&lt;-<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.character(posts$favs)) posts$pageviews&lt;-<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.character(posts$pageviews)) posts$published&lt;-sub(<span class="hljs-string"><span class="hljs-string">"   "</span></span>,<span class="hljs-string"><span class="hljs-string">"/12/2012 "</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.character(posts$published)) posts$published&lt;-sub(<span class="hljs-string"><span class="hljs-string">"   "</span></span>,<span class="hljs-string"><span class="hljs-string">"/11/2012 "</span></span>,posts$published) posts$published&lt;-sub(<span class="hljs-string"><span class="hljs-string">"   "</span></span>,<span class="hljs-string"><span class="hljs-string">"/10/2012 "</span></span>,posts$published) posts$published&lt;-sub(<span class="hljs-string"><span class="hljs-string">"   "</span></span>,<span class="hljs-string"><span class="hljs-string">"/09/2012 "</span></span>,posts$published) posts$published&lt;-sub(<span class="hljs-string"><span class="hljs-string">"^ "</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>,posts$published) posts$publishedDate&lt;-<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.Date(posts$published, format=<span class="hljs-string"><span class="hljs-string">"%d/%m/%Y %H:%M"</span></span>)</code> </pre><br><br>  It is also useful to add additional fields that are calculated from those already received: <br><pre> <code class="hljs pgsql"> scoressplitted&lt;-sapply(strsplit(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.character(posts$scoredetailes), "\\D+", perl=<span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span>),unlist) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(scoressplitted)=="matrix" &amp;&amp; dim(scoressplitted)[<span class="hljs-number"><span class="hljs-number">1</span></span>]==<span class="hljs-number"><span class="hljs-number">4</span></span>) { scoressplitted&lt;-t(scoressplitted[<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">4</span></span>,]) posts$actions&lt;-<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.character(scoressplitted[,<span class="hljs-number"><span class="hljs-number">1</span></span>])) posts$plusactions&lt;-<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.character(scoressplitted[,<span class="hljs-number"><span class="hljs-number">2</span></span>])) posts$minusactions&lt;-<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.character(scoressplitted[,<span class="hljs-number"><span class="hljs-number">3</span></span>])) } posts$weekDay&lt;-format(posts$publishedDate, "%A")</code> </pre><br>  Here we all well-known messages of the type ‚ÄúTotal 35: ‚Üë 29 and ‚Üì 6‚Äù converted into an array of data on how many actions were taken at all, how many advantages there were and how many minuses there were. <br><br>  At this point, it can be said that all data has been received and converted to a format ready for analysis.  I designed the code above as a ready-to-use function.  At the end of the article you can find a link to the source. <br><br>  But the attentive reader has already noticed that in this way, we obtained data for only one page in order to get for a whole series.  To get the data for the whole list of pages, the following function was written: <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">getPostsForPages</span></span>&lt;-function(pages, cookie, sleep=<span class="hljs-number"><span class="hljs-number">0</span></span>) { urls&lt;-paste(<span class="hljs-string"><span class="hljs-string">"http://habrahabr.ru/feed/posts/habred/page"</span></span>, pages, <span class="hljs-string"><span class="hljs-string">"/"</span></span>, sep=<span class="hljs-string"><span class="hljs-string">""</span></span>) ret&lt;-<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.frame() for(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">url</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">in</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">urls</span></span></span><span class="hljs-class">) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ret</span></span></span><span class="hljs-class">&lt;-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rbind</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ret</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getPosts</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">url</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cookie</span></span></span><span class="hljs-class">)) </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Sys</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sleep</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sleep</span></span></span><span class="hljs-class">) } return(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ret</span></span></span><span class="hljs-class">) }</span></span></code> </pre><br>  Here we use the system function Sys.sleep in order not to accidentally arrange the habraeffect itself :) <br>  This function is proposed to use as follows: <br><pre> <code class="hljs lisp">posts&lt;-getPostsForPages(<span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">100</span></span>, cookie,<span class="hljs-number"><span class="hljs-number">5</span></span>)</code> </pre><br>  Thus we download all pages from 10 to 100 with a pause of 5 seconds.  Pages to 10 are not interesting to us, since the estimates are not visible there yet.  After a few minutes of waiting, all our data is in the posts variable.  I recommend to save them right away, so as not to disturb Habr every time!  It is done this way: <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">write</span></span>.csv(posts, file="posts.csv")</code> </pre><br>  And we read as follows: <br><pre> <code class="hljs pgsql">posts&lt;-<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>.csv("posts.csv")</code> </pre><br><br>  Hooray!  We learned to get statistical data from the habr and save them locally for the next analysis! <br><br><h4>  Data analysis </h4><br>  This section I will leave unsaid.  I suggest the reader to play with the data himself and get his own conclusions.  For example, try to analyze the dependence of mood plus and minus depending on the day of the week.  I will cite only 2 interesting conclusions that I made. <br><br><h5>  Habr users are much more willing to plus than minus. </h5><br>  This is seen in the following graph.  Notice how much the "cloud" of the minuses is more even and wider than the spread of the pros.  The correlation of pluses from the number of views is much stronger than for minuses.  In other words: plus without thinking, and minus the cause! <br>  (I apologize for the inscriptions on the graphs: until I figured out how to display them correctly in Russian) <br><br><img src="http://habrastorage.org/storage2/23a/006/5a7/23a0065a7617b7942dd14d3c23515a28.png"><br><br><h5>  There are indeed several classes of posts. </h5><br>  This statement in the post mentioned was used as a given, but I wanted to see this in reality.  To do this, it is enough to calculate the average share of benefits to the total number of actions, the same for minuses and divide the second into the first.  If everything was homogeneous, then we should not observe the set of local peaks in the histogram, but they are there. <br><img src="http://habrastorage.org/storage2/9d6/006/460/9d6006460e3aa275b3dda3e9f2901b86.png"><br>  As you can see, there are pronounced peaks around 0.1, 0.2 and 0.25.  I suggest the reader to find and ‚Äúname‚Äù these classes. <br>  I want to note that R is rich in algorithms for data clustering, for approximation, for testing hypotheses, etc. <br><br><h4>  Useful resources </h4><br>  If you really want to dive into the world of R, I recommend the following links.  Please share in the comments your interesting blogs and websites on R. Is anyone writing about R in Russian? <br><br><ul><li>  <a href="http://www.codeschool.com/courses/try-r">Free online courses at CodeSchool R</a> </li><li>  <a href="https://www.coursera.org/course/compdata">Coursera on data analysis</a> </li><li>  <a href="http://www.statmethods.net/">Quick r</a> </li><li>  <a href="http://www.r-bloggers.com/">R-bloggers</a> </li><li>  <a href="http://is-r.tumblr.com/">is.R ()</a> </li></ul><br><br>  I believe that such languages ‚Äã‚Äãas R, haskell, lisp, javascript, python - every self-respecting programmer should know: if not for work, then at least to expand the horizons! <br><br>  PS <a href="http://pastebin.com/Eqap6X1m">Promised source</a> </div><p>Source: <a href="https://habr.com/ru/post/162583/">https://habr.com/ru/post/162583/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../162571/index.html">ETERNUS DX - disk arrays, what is inside. Part 1</a></li>
<li><a href="../162575/index.html">Automatically update project build number in Xcode</a></li>
<li><a href="../162577/index.html">Comprehensive protection of mobile phone information. Results of 2012</a></li>
<li><a href="../162579/index.html">AWS: Status Check + CloudWatch</a></li>
<li><a href="../162581/index.html">New controller from Aruba Networks - 72xx series - first look</a></li>
<li><a href="../162585/index.html">Animated buttons of arbitrary width on CSS3</a></li>
<li><a href="../162591/index.html">Forbes: What awaits cloud computing in 2013?</a></li>
<li><a href="../162595/index.html">Windows Live Mesh closes</a></li>
<li><a href="../162599/index.html">Open beta testing steam for linux next week</a></li>
<li><a href="../162601/index.html">Would you like Web Notifications support in Opera browser (like in Chrome)?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>