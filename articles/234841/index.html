<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hibernate and PostgreSQL JSON Type</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi habr! In this article there will be no in-depth analysis of the json type in PostgreSQL or the next useless attempts to compare this PostgreSQL fea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hibernate and PostgreSQL JSON Type</h1><div class="post__text post__text-html js-mediator-article">  Hi habr!  In this article there will be no in-depth analysis of the json type in PostgreSQL or the next <s>useless</s> attempts to compare this PostgreSQL feature with NoSQL databases like MongoDB.  I'll just talk about how to use Hibernate and PostgreSQL json.  I think someone this may be useful. <br><br><h4>  Object inside an entity </h4><br>  Suppose you have a relational data model.  A situation may well arise that for some of the entities it is necessary to store an object (a document, if you wish).  Of course, you can extend the data model for this object with a single (or maybe several) entity, or simply store this object as an array of bytes.  But for PostgreSQL, a <a href="http://www.postgresql.org/docs/9.3/static/datatype-json.html">json</a> data type capable of storing a json object in accordance with <a href="http://www.ietf.org/rfc/rfc4627.txt">RFC 4627</a> has appeared for quite some time.  It became interesting how it can be used, and what opportunities it can provide.  When I first accessed <a href="http://google.com/">google,</a> I found several unstructured posts and Q &amp; A that explained something, but did not give a complete picture.  Having poked around a bit and figured out what was happening, I came to the conclusion that using these fields is very convenient, and decided to create a <a href="https://github.com/bazar-nazar/pgjson">small library</a> that will simplify the use of json types.  Below I will tell you how to use it, well, a little more comparison with the first alternatives that come to mind. <br><a name="habracut"></a><br><h4>  Dialect </h4><br>  Of course, there is no talk of any support for this type in the standard dialect.  I would very much like hibernate to recognize the type itself and validate / update the schema.  Therefore, the library contains a JsonPostgreSQLDialect dialect extending PostgreSQL9Dialect.  Just use this dialect in your persistance.xml. <br><br><h4>  Storage facility </h4><br>  You can store the json field in both object and Map.  If you want to store an object, then it is enough to inherit the class that you are going to store PGJsonObject <br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CacheObject</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PGJsonObject</span></span></span><span class="hljs-class"> </span></span>{ ... }</code> </pre> <br>  and use annotations to define the type in your Entity: <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@TypeDefs</span></span>({<span class="hljs-meta"><span class="hljs-meta">@TypeDef</span></span>( name= <span class="hljs-string"><span class="hljs-string">"JsonObject"</span></span>, typeClass = CacheObject.class)}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@Type</span></span>(type = <span class="hljs-string"><span class="hljs-string">"JsonObject"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CacheObject </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCache</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cache; } }</code> </pre><br>  If this breaks your inheritance scheme, you can create a class separate from your class for storage that is responsible for the type.  It will inherit the same PGJsonObject, and must override the returnedClass () method, which will return the class of the object you want to store.  This class will then need to be used in your Entity to determine the type. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JsonCustomType</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PGJsonObject</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Class </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returnedClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Custom.class; } }</code> </pre><br>  Then the type definition in Entity will look like this: <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@TypeDefs</span></span>({<span class="hljs-meta"><span class="hljs-meta">@TypeDef</span></span>( name= <span class="hljs-string"><span class="hljs-string">"JsonObject"</span></span>, typeClass = JsonCustomType.class)}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@Type</span></span>(type = <span class="hljs-string"><span class="hljs-string">"JsonObject"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Custom </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCustom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> custom; } }</code> </pre><br>  If you are going to store the Map, then simply use the type JsonMapType already available in the library. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Recommendations </h4><br><ul><li>  Be careful with changing object data.  If the object that you are storing is not immutable, then any changes that you make in it will be saved to the database (of course, if the transaction does not roll back), so if you do not want to save the changes, make a copy </li><li>  Check your native requests.  Make sure your Entity is listed. </li></ul><br><br><h4>  Benefits of JSON Fields </h4><br>  Immediately comes to mind 2 alternative implementations <br><ul><li>  Expand the database schema for the object </li><li>  store byte array </li></ul><br>  The first option can greatly complicate your data model, if the object has a deep hierarchy.  If an object stores a large array, such as an array of points, then a table with points can have a huge number of records, which can slow down the selection.  Also, with this option, the application should know everything about the data schema in order to pull them out of the table. <br>  In the second variant, no schema extension is required, but the information stored in this field is absolutely not representative and not indexable.  And as in the previous case, the application should be aware of the structure of the stored data, only this time for proper deserialization. <br>  When using json fields, all information in the database is presented in a readable form.  Also in <a href="http://www.postgresql.org/docs/9.3/static/functions-json.html">jar functions</a> in PostgreSQL, you can write convenient native query for selection on certain fields of a json object.  And thanks to <a href="http://www.postgresql.org/docs/8.1/static/indexes-expressional.html">expression indexes,</a> you can hang the index on any field of your json object. <br>  Also, using json fields can be a great help in integration tasks.  By saving an object in one json field, in another you can drag a Map out of it, and vice versa.  If you know only a part of the object structure, you can deserialize only the part of the json object that you need and know into a java-object, and either ignore the rest or deserialize it again into a Map. <br><br>  The source code of the project can be found on <a href="https://github.com/bazar-nazar/pgjson">github</a> .  So far, the project is raw.  I hope in the future to simplify use, enter annotations. </div><p>Source: <a href="https://habr.com/ru/post/234841/">https://habr.com/ru/post/234841/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../234831/index.html">What does ITshnik like to love some marketers or marketing guide for an IT startup?</a></li>
<li><a href="../234833/index.html">As I pointed out to the bank on the bugs or data leakage</a></li>
<li><a href="../234835/index.html">Asynchronous multithreaded pool of Perl workers</a></li>
<li><a href="../234837/index.html">Reflections on Personal Information Management</a></li>
<li><a href="../234839/index.html">The 2014 LVEE Conference was held. Results</a></li>
<li><a href="../234845/index.html">Study: PHP sites turned out to be the most vulnerable for hackers</a></li>
<li><a href="../234847/index.html">How Wikipedia works (part 3)</a></li>
<li><a href="../234849/index.html">Welcome to CocoaHeads August 29</a></li>
<li><a href="../234851/index.html">Innovative technologies in localization</a></li>
<li><a href="../234853/index.html">Guide to animated display of views in a table on Swift</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>