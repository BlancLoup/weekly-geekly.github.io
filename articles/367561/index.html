<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Programming Technology ARM Cortex-M0 +</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Here I will talk about a convenient set of tools and the technology of rapid development of simple programs on the S9KEAZN64AMLC microcontroller with ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Programming Technology ARM Cortex-M0 +</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/geektimes/post_images/503/a6e/c3d/503a6ec3d433eb63656b1ab561ef8596.png"><br>  Here I will talk about a convenient set of tools and the technology of rapid development of simple programs on the <a href="http://www.nxp.com/products/microcontrollers-and-processors/arm-processors/kinetis-cortex-m/ea-series/ultra-reliable-kea-arm-based-automotive-and-industrial-microcontrollers-mcus:KEA%3Flang_cd%3Den"><b>S9KEAZN64AMLC</b></a> microcontroller with a <b>32-</b> bit <b>40 MHz</b> <b>ARM Cortex-M0 + core</b> .  As a hardware basis, let's take a fee from <b><a href="http://geektimes.ru/post/259138/">a previously announced project</a> .</b>  The board turned out to be surprisingly tenacious at low temperatures and even surpassed the expectations in this sense. <br>  Let's start with a detailed description of the creation of the thermometer without the use of external sensors and with the function of the logger. <br><br><a name="habracut"></a><br><br><h1>  Introduction. </h1><br>  As it should be according to the <b>laws of Murphy, the</b> first soldered fresh board burned down.  But it allowed to find out that the <font color="#FF0000"><b>S9KEAZN64</b></font> is able to withstand voltage up to 12 V without breakdown, and the <b><a href="http://www.digikey.com/product-detail/en/LT3973IDD-5%2523TRPBF/LT3973IDD-5%2523TRPBF-ND/3248441">LT3973IDD-5 # PBF stabilizer</a></b> perfectly tolerates short circuits on the output and maintains a stable output voltage of 5 V at almost zero load.  The reason for the failure was the poor soldering of the stabilizer body. <br>  But that was not all!  Inattentive study of the documentation led to an erroneous scheme of connecting the two indicator segments to the <font color="#C00000">PTA2</font> <font color="#C00000">and</font> <font color="#C00000">PTA3 lines of the</font> <font color="#C00000">microcontroller</font> ; they turned out to be conclusions with a clean open collector, i.e.  without top key required.  They had to be paralleled <font color="#C00000">with the</font> <font color="#C00000">findings of</font> <font color="#C00000">PTB7</font> , <font color="#C00000">PTB6</font> and lose the functionality that was previously planned for them.  Inattention also led to the absence of a filtering capacitor at the output of the <font color="#C00000"><b>U2</b></font> reference voltage source.  All this led to small corrections of the board, which I euphonically call <font color="#FFBF01"><b>tuning</b></font> . <br> <a href=""><img align="left" width="265" src="https://habrastorage.org/getpro/geektimes/post_images/b8a/a8e/2e8/b8aa8e2e877ad79d4f0a8686db4c6833.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I cite the <b>final version of the board</b> with a microcontroller with a marked tuning. <br> <a href=""><img align="left" width="1021" src="https://habrastorage.org/getpro/geektimes/post_images/a15/e40/c13/a15e40c13fde6e0f2bebee264dc99294.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br><h1>  Description of the scheme </h1><br>  The central element of the circuit is a microcontroller <a href="http://www.nxp.com/products/microcontrollers-and-processors/arm-processors/kinetis-cortex-m/ea-series/ultra-reliable-kea-arm-based-automotive-and-industrial-microcontrollers-mcus:KEA%3Flang_cd%3Den"><b>S9KEAZN64AMLC</b></a> . <br>  Him: <br><pre><code class="dos hljs">- <span class="hljs-number"><span class="hljs-number">32</span></span>- , -     <span class="hljs-number"><span class="hljs-number">40</span></span> , -   ,      <span class="hljs-number"><span class="hljs-number">20</span></span> . -   FLASH  - <span class="hljs-number"><span class="hljs-number">64</span></span> , -   - <span class="hljs-number"><span class="hljs-number">4</span></span> . -   <span class="hljs-number"><span class="hljs-number">5</span></span> </code> </pre>  The program code is written to the microcontroller via the <a href="http://www.arm.com/products/system-ip/debug-trace/coresight-soc-components/serial-wire-debug.php">SWD (Serial Wire Debug)</a> interface.  The SWD interface consists of two digital lines, denoted in the diagram as: SWD_DIO, SWD_CLK. <br>  The microcontroller has a multi-channel <b>12-bit digital-to-analog converter</b> , an analog comparator, two channels of pulse-width modulators, an <b>internal clock generator</b> with a multiplier of up to 40 MHz, <b>a temperature sensor</b> , SPI, I2S, UART interfaces. <br>  The microcontroller can be transferred to deep sleep while maintaining the activity of the ADC and analog comparator. <br>  Digital inputs are additionally protected from interference by the <b>built-in hardware filters of</b> digital signals. <br><br>  For accurate measurement of analog signals on the board, a <b>U2</b> reference voltage <b><font color="#FFBF01">driver</font> ( <font color="#FFBF01">ISL21080CIH341Z</font> - <font color="#FFBF01">TK</font> ) is located</b> with an output voltage of 4.096 V. This is conveniently combined with a 12-bit ADC range of 4096 counts. <br><br>  The original purpose of the board was to work as a controller for car headlights.  Therefore, the original labels of assigning pairs of contacts on the board are left.  But of course they can perform other arbitrary functions.  I will list these pairs: <br>  <b><font color="#7030A0">LED</font></b> - Exit.  Connecting an external LED.  May be the entrance. <br>  <b><font color="#7030A0">TERMISTOR</font></b> - Login.  Connect an external temperature sensor based on a thermistor, but there may be another sensor with variable resistance. <br>  <b><font color="#7030A0">VAN</font></b> - Login.  Voltage measurement from 0 to 30 V <br>  <b><font color="#7030A0">BUTTON</font></b> - Login.  Connect button.  It can be an output or analog input. <br>  <b><font color="#7030A0">High</font> - <font color="#7030A0">Side</font> <font color="#7030A0">switch</font></b> - a group of signals designed to control the power multichannel key card with SPI interface.  In the absence of such a board, the signals remain free for other functions. <br><br>  The microcontroller according to the specification is capable of operating up to <b>-40 ¬∞ C.</b>  During the tests, he continued to work at <b>-42 ¬∞ C.</b>  Lower temperature just could not be obtained. <br><br>  For the board, the dependence of the maximum current consumption on the supply voltage was measured, with all the LED indicators on. <br>  The normal operation of the board according to this schedule lies in the range <b>from 6 to 30 V.</b>  After 30 V, the shunting of the suppressor D2 begins to activate and then the current increases unlimitedly until the suppressor breaks out or the self-resetting fuse F1 of 1.1 A rated continuous current trips. <br>  <b>The board is turned on at a voltage of 3.5 V</b> , but the ADC begins to function normally from 5 V, and the rather low level of noise in the measurements starts from 6 V. <br> <a href=""><img align="left" width="1010" src="https://habrastorage.org/getpro/geektimes/post_images/82b/82d/98f/82b82d98f2785edb7e93585d4010d700.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br><h1>  The next step is to solder the <a href="http://infocenter.arm.com/help/index.jsp%3Ftopic%3D/com.arm.doc.ddi0413c/Chdgabea.html">SWD</a> interface </h1><br>  <a href="http://infocenter.arm.com/help/index.jsp%3Ftopic%3D/com.arm.doc.ddi0413c/Chdgabea.html"><b>SWD</b></a> interface is what fundamentally distinguishes programming for <b>ARM</b> from programming 8-bit microcontrollers such as Arduino.  With the <b>SWD</b> interface, the program on the microcontroller is also easy to debug as if it is executed locally on your computer.  If we add to this the convenience of technology such as <a href="http://habrahabr.ru/post/259205/">a communication channel and real-time debugging RTT</a> , then to return to the 8-bit microcontroller completely disappears from any desire. <br>  In the diagram, the interface is indicated by a rectangle <b>SWD</b> with the contacts P1, P2, P3, P4, P6 located next to it.  I use <a href="https://www.segger.com/jlink-debug-probes.html">Segger's J-Link</a> <b>SWD</b> adapter.  For him, I have adapters for more miniature connectors.  I used this adapter here to connect to the board.  The power supply in this case comes from the board to the <b>J-Link</b> adapter.  The adapter has a two-way power supply buffer converter, so there is <font color="#FF0000">no</font> <font color="#FF0000">risk of</font> <font color="#FF0000">applying</font> <font color="#FF0000">5</font> - <font color="#FF0000">volts</font> to the adapter.  How exactly to solder the adapter signals to the board can be found by reading the manual for the adapter.  A more economical option would be to use <a href="http://www.nxp.com/products/software-and-tools/run-time-software/kinetis-software-and-tools/ides-for-kinetis-mcus/opensda-serial-and-debug-adapter:OPENSDA">OpenSDA</a> adapters that are present on many cheap debugging boards from <b>NXP-Freescale</b> , but in this case you have to sacrifice some of the <b>J-Link</b> features. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/904/c50/2f5/904c502f5fe0ecaa563bb9cd23d6faa3.png"><br><br><h1>  Start programming </h1><br>  For Kinetis series microcontrollers from the former <b>Freescale</b> company, there is a special <b><i>Kinetis Design Studio (KDS)</i></b> development environment <b><i>.</i></b>  The environment was created with the intention of freeing the developer from in-depth study of programming guides and datasheets. To some extent this turns out. Therefore, we start with <b>KDS</b> .  The environment will generate us the source texts of the microcontroller peripheral initialization procedures, the project directory structure and the stub for the <font color="#FFBF01"><b>main</b></font> function, insert the necessary header files and the linker configuration.  In it, we can also carry out a compilation of the project until we move on to a more efficient tool. <br><br>  Create a subdirectory <b>Firmware</b> in the project directory.  Launch <b><i>Kinetis Design Studio 3.0.0 IDE</i></b> and create a workspace in <b>Firmware</b> .  Then in the menu <b>File-&gt; New-&gt; Kinetis Project</b> enter the name of the project, say - <b>AccTester</b> .  Choose a family of microcontrollers <font color="#C00000"><b>SKEAZN64xxx2</b></font> <br> <a href=""><img align="left" width="350" src="https://habrastorage.org/getpro/geektimes/post_images/2ea/06d/231/2ea06d2311776c7751a978181dbe3552.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br>  Then this dialogue: <br> <a href=""><img align="left" width="350" src="https://habrastorage.org/getpro/geektimes/post_images/0c4/d3d/61e/0c4d3d61e3486c88723977c8d6aeebeb.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br>  Then we select the <b>IAR</b> compiler.  We can choose <b>GCC</b> , but then the article will be about <b>IAR.</b> <br>  An explanation can be found in this comparison of compilers <a href="http://geektimes.ru/post/264558/"><b>was carried out here</b></a> . <br><br>  You may need to specify before this where to look for the <b>IAR</b> compiler, or else the previous item may hang. <br>  The <b>Add-On</b> <b>IAR</b> for <b>Eclipse,</b> which is <b>KDS,</b> can be found <a href="http://eclipse-update.iar.com/">here</a> .  I used the <b>eclipse-iar-arm-7.20-201510121518.zip</b> version.  Add-On should be put before we start creating a project in KDS <br> <a href=""><img align="left" width="350" src="https://habrastorage.org/getpro/geektimes/post_images/ec5/e7b/70e/ec5e7b70e9de448706fbc6b8ff5b680a.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br>  As a result, we get the following project window: <br> <a href=""><img align="left" width="350" src="https://habrastorage.org/getpro/geektimes/post_images/3eb/d24/e91/3ebd24e91e127d25b921e0322f2d64b6.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br>  Select the correct chip package ( <b>Select Package</b> in the <b>Processor</b> tab), since <font color="#C00000"><b>SKEAZN64</b></font> has several <font color="#C00000"><b>package</b></font> options: <br> <a href=""><img align="left" width="350" src="https://habrastorage.org/getpro/geektimes/post_images/32d/592/fc4/32d592fc4209f73bd5a85d11f1916ef1.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br><h1>  Clock system </h1><br>  To our convenience, the default clock initialization completely suits us and does not need to change anything.  But the default frequency will be 32 MHz.  This is more than enough.  It is necessary to carefully study the tab Clock source settings shown in the screenshot below.  Everything should be so. <br> <a href=""><img align="left" width="741" src="https://habrastorage.org/getpro/geektimes/post_images/f95/246/44e/f9524644e5cb1f48de6228ff6aa54aec.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br><h1>  Port initialization </h1><br>  In the <b><i>Components Library</i></b> tab, select and paste into the <b>Init_GPIO</b> and <b>Init_PORT project</b> <br>  Kinetis microcontrollers, as always, have a separation of pin functions into two peripheral modules: <font color="#FFBF01"><b>PORT</b></font> and <font color="#FFBF01"><b>GPIO</b></font> .  <font color="#FFBF01"><b>PORT</b></font> is responsible for the general properties of the port such as driver strength, the inclusion of port lines and the filters on the port lines.  <font color="#FFBF01"><b>The GPIO</b></font> is responsible for the operational management of the states of the pins individually and all together. <br>  Therefore, it is necessary to configure the correct initialization in both modules. <br>  C <b>Processor Expert</b> can not rush and try to configure everything at once.  You can easily get lost in obscure parameters and settings.  First you need to understand the settings of the generator clock frequency of the core and bus of the microcontroller.  Then try to bring the simplest external signal.  This signal will be a illuminated segment on the 7th segment indicator. <br><br>  In the <font color="#FFBF01"><b>PORT</b></font> module, we initialize the pins <font color="#C00000"><b>PTD1</b></font> and <font color="#C00000"><b>PTC6</b></font> .  In the <font color="#FFBF01"><b>GPIOA</b></font> module <font color="#FFBF01"><b>I</b></font> install 1 on these pins. <br>  Click <b>Project-&gt; Generate Processor Expert Code</b> , <br> <a href=""><img align="left" width="250" src="https://habrastorage.org/getpro/geektimes/post_images/a3a/ca1/332/a3aca13325959e916e9ef32e9bad379f.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br>  then <b>Buil All</b> . <br> <a href=""><img align="left" width="250" src="https://habrastorage.org/getpro/geektimes/post_images/b1d/79f/867/b1d79f8679b478c0b8d328867cce9383.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br>  If the process runs without errors, select <b>Run-&gt; Flash from file ..</b> and <b>F11</b> (Debug) <br> <a href=""><img align="left" width="350" src="https://habrastorage.org/getpro/geektimes/post_images/b36/ab7/c43/b36ab7c43b7dc12c01c6350c92872137.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br>  Segment lit <br><br><h1>  Initialization of the rest of the periphery </h1><br>  For further program development, we will need more ADC, SPI interface, and timers. <br>  We drag the necessary periphery from the panel with the tab Components library into the panel with the tab Components <br>  Should make this composition: <br> <a href=""><img align="left" width="250" src="https://habrastorage.org/getpro/geektimes/post_images/1d5/541/ec9/1d5541ec9296f4db276eb9eede1aaaaf.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br>  Here <font color="#7030A0"><b>GPIOA</b></font> and <font color="#7030A0"><b>PORT</b></font> have already been condemned.  Added components <font color="#7030A0"><b>PIT</b></font> , <font color="#7030A0"><b>SysTickInit</b></font> , <font color="#7030A0"><b>ADC</b></font> , <font color="#7030A0"><b>SPI0</b></font> <br>  Adding these components will cause the source code to be generated to initialize the corresponding peripherals. <br>  And the purpose of the components in the context of this project is: <br>  <b><font color="#7030A0">PIT</font></b> is a <b>periodic interrupt generator</b> .  Designed to generate signals to start the conversion of the ADC. <br>  <b><font color="#7030A0">SysTickInit</font></b> - <b>ARM core system timer</b> .  Used by us for the periodic formation of interruptions in which the display is scanned. <br>  <b><font color="#7030A0">ADC</font></b> - <b>ADC</b> .  In the first project, we will digitize not the external signal, but the signal of the internal temperature sensor. <br>  <b><font color="#7030A0">SPI0</font></b> - <b>SPI</b> interface number 0. Needed to control the SPI key. <br><br>  Here I no longer provide screenshots of the initialization of each of the components.  In the source code laid out on github it will be possible to open the KDS project and consider everything. <br><br>  It is not worth much to get involved in the configuration of different peripherals in <b>Processor Expert</b> .  The fact is that this tool does not initialize all dependencies of the periphery.  For example, we will need to run the ADC via a hardware trigger, but it will not be possible to configure it correctly in <b>Processor Expert</b> , since there is no installation of a hardware trigger channel in the <b>SIM_SOPT</b> register. <br>  This somewhat complicates the task.  A look into the <b>KEA</b> family programming manual will come soon.  But not before I finish this article. <br><br><h1>  Migration to <b>IAR</b> </h1><br>  We click once again on the source generation command and turn on the <b>IAR Embedded Workbench</b> development environment. <br>  Here, many people familiar with <b>IAR</b> may have a feeling of discomfort.  After all, in <b>IAR</b> again and from scratch, it will be necessary to form a tree for the entire project, and even a project with an unknown directory structure.  It comes to the aid of my project tree forming utility for <b>IAR</b> . <br><br><h1>  We form automatically a project tree in IDE <b>IAR</b> . </h1><br> <a href=""><img align="left" width="500" src="https://habrastorage.org/getpro/geektimes/post_images/a02/5b8/b61/a025b8b61caddae7661f69738fc3632e.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br>  The <b>IAR</b> _Proj directory contains the <b>IAR</b> C.exe file along with the <b>IAR</b> workspace.  This is an automatic project tree generation utility for <b>IAR</b> .  It is used as follows: <br>  1. If the <b>IAR</b> workspace has not yet been created, then it is created in the <b>IAR</b> IDE with the File-&gt; New-&gt; Workspace command.  We give it the name AccTester for definiteness. <br>  2. In the workspace, create an empty Project-&gt; Create New Project ... <br> <a href=""><img align="left" width="250" src="https://habrastorage.org/getpro/geektimes/post_images/e76/528/405/e765284053e205856dba13b86fa92369.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br>  call it the same name as the workspace. <br>  3. In the project, create an empty group and call it arbitrarily.  Save the project.  We get files with the .eww and .ewp extension and the same name. <br> <a href=""><img align="left" width="250" src="https://habrastorage.org/getpro/geektimes/post_images/32e/07d/bdc/32e07dbdc1364db1313585c9ed2a488a.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br>  4. Run the utility <b>IARC.exe</b> .  The utility stores its settings in <b>Ini.JSON</b> and <b>EscDirs.JSON</b> .  In the screenshot, it is configured to convert the project named <b>AccTester.ewp</b> and scan the directory tree with the root <b>C: \ Embedded \ Projects \ AccTester \ Firmware_IAR \ AccTester</b> <br>  5. Press the Exec button. <br>  6. The program passes recursively all directories starting from the root and skipping excluded directories.  <b>All C and and. H files found will be included in the IAR project file accordingly</b> . <br>  7. Open the <b>.eww</b> workspace <b>file</b> in <b>IAR</b> .  In it we will see a project tree with groups following the directory structure.  Then we can continue to customize the project options: select the type of microcontroller, configure the type of libraries, debugger, etc. <br><br>  In the <b>IAR_Proj</b> directory there is already a prepared <b>IAR</b> workspace which can be studied. <br><br>  The important thing is that by setting up an <b>IAR</b> in this way, we <b>do not lose the opportunity to continue using Processor Expert</b> .  Only every time after the new generation of sources, and if this causes the appearance of new files, <b>IARC.exe</b> must be launched <b>again</b> and click the Exec button.  The project in <b>IAR</b> then needs to be fully recompiled, but it takes a split second. <br><br><h1>  <b>IAR</b> project setup </h1><br>  <b>IAR</b> project set up for a long time is not necessary.  The most important thing is to set the type of the microcontroller in the options window: <br> <a href=""><img align="left" width="250" src="https://habrastorage.org/getpro/geektimes/post_images/5de/d91/4a3/5ded914a396655050ee95fa3833b3af4.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br>  The default optimization will be minimal. <br>  The file of the memory card with the extension <b>.icf</b> <b>IAR</b> uses from its own directory and it suits us. <br>  In the debugger tab, select <b>J-Link</b> . <br> <a href=""><img align="left" width="250" src="https://habrastorage.org/getpro/geektimes/post_images/41f/128/21b/41f12821b54647132ef0bc0a9493ffbf.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br>  <b>IAR</b> has its own loader module for the microcontroller, just point out that they need to use.  Check <b>Use Flash Loader</b> : <br> <a href=""><img align="left" width="250" src="https://habrastorage.org/getpro/geektimes/post_images/2f7/60d/8e0/2f760d8e0f0e5a4c1b8146b8750ef87b.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br><h1>  The structure of the source files of the project thermometer. </h1><br>  <b>Processor Expert is</b> able to generate initialization procedures and in it you can specify the flags for generating interrupt handlers from the periphery.  But the generated handlers appear in the source texts for the corresponding periphery commented out.  Therefore, the interrupt handlers from the <b>ADC.c</b> and <b>SysTick.c</b> files were manually transferred to the <b>Events.c</b> file and uncommented. <br><br>  Important.  If you plan to continue to use <b>Processor Expert</b> with <b>IAR</b> , then you need to be well aware of what files will be <br>  overwritten, and in what files the information entered by us will be saved. <br>  All files in the <b>Generated Code</b> directory will be <b>overwritten</b> . <br>  The <b>main.c</b> file is also overwritten, but the line remains intact after the corresponding comment. <br>  Here's what it looks like: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*lint -save -e970 Disable MISRA rule (6.3) checking. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">/*lint -restore Enable MISRA rule (6.3) checking. */</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* Write your local variable definition here */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*** Processor Expert internal initialization. DON'T REMOVE THIS CODE!!! ***/</span></span> PE_low_level_init(); <span class="hljs-comment"><span class="hljs-comment">/*** End of Processor Expert internal initialization. ***/</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Write your code here */</span></span> Application(); <span class="hljs-comment"><span class="hljs-comment">/*** Don't write any code pass this line, or it will be deleted during code generation. ***/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*** RTOS startup code. Macro PEX_RTOS_START is defined by the RTOS component. DON'T MODIFY THIS CODE!!! ***/</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> PEX_RTOS_START PEX_RTOS_START(); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Startup of the selected RTOS. Macro is defined by the RTOS component. */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*** End of RTOS startup code. ***/</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*** Processor Expert end of main routine. DON'T MODIFY THIS CODE!!! ***/</span></span></span><span class="hljs-meta"> for(;;){} </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*** Processor Expert end of main routine. DON'T WRITE CODE BELOW!!! ***/</span></span></span><span class="hljs-meta"> } </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*** End of main routine. DO NOT MODIFY THIS TEXT!!! ***/</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* END main */</span></span></span></span></code> </pre>  Here I just added the string <b>Application</b> ();  to transfer control to your procedure in the <b>Indicator.c</b> file <br>  More in the <b>main.c</b> file, I do not change anything. <br><br>  <b>Processor Expert</b> also creates multiple files in the <b>Static_code \ PDD</b> directory.  Practical benefit from them is small, I do not use them.  They are essentially wrappers access to the registers of the periphery which can be accessed directly.  The meaning of such files is the portability of projects from one type of microcontroller to another within the same family.  They are needed more for developers of <b>Processor Expert</b> itself than for end users who do not have such an urgent need for on-line switching between microcontrollers within a single project. <br><br>  All the application logic is concentrated in the <b>Indicator.c</b> file.  It contains both the main loop and all interrupt handlers.  The program is too small to break it into separate files. <br><br>  And this is how the main application loop itself looks like: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Application</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> uuid[<span class="hljs-number"><span class="hljs-number">2</span></span>]; ADC_prepere(); Clear_display(); <span class="hljs-comment"><span class="hljs-comment">//    RTT        Get_unique_identificator(uuid); RTT_printf("\r\n\r\nS9KEAZN64AMLC (64 KB FLASH, 4 KB RAM) UUID=%08X-%08X\r\n", uuid[0], uuid[1]); //     for (;;) { if (meas_done != 0) //        { //          float if (INTTEMPER_adcr &gt; T25SMPL) { //  25  int_temperature = 25 - (INTTEMPER_adcr - T25SMPL) / (1000.0 * TSLOPE_LOW); } else { //  25  int_temperature = (T25SMPL - INTTEMPER_adcr) / (1000.0 * TSLOPE_HIGH) + 25; } Show_float("%0.1f", int_temperature); //    RTT_printf("%0.3f\r\n", int_temperature); //    RTT     meas_done = 0; //  ,      } } }</span></span></code> </pre><br>  The internal temperature sensor of the chip is used as a temperature sensor.  Logging of measurement results is made to the <b>RTT</b> interface. <br>  On the computer, the <b>RTT</b> interface <b>is visible as a <font color="#FFFF01">telnet</font></b> port of the form: telnet: // localhost: 19021 <br>  You can connect to this port, for example, using the TeraTerm terminal emulator program with the following line: <br><pre> <code class="dos hljs">"C:/Program Files (x86)/teraterm/ttermpro.exe" /T=<span class="hljs-number"><span class="hljs-number">1</span></span> telnet://localhost:<span class="hljs-number"><span class="hljs-number">19021</span></span> /X=<span class="hljs-number"><span class="hljs-number">0</span></span> /Y=<span class="hljs-number"><span class="hljs-number">0</span></span> /W="Jlink RTT"</code> </pre>  But we must remember that this <b>port is open only when the</b> <b>IAR</b> <b>debugger is running</b> via the <b>J-Link</b> adapter. <br>  When the adapter is disconnected, the port immediately closes. <br><br>  Here is the output to the terminal. <br> <a href=""><img align="left" width="500" src="https://habrastorage.org/getpro/geektimes/post_images/e15/049/6c2/e150496c2aae51d0288e4cfcf70c939a.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br>  The first three lines are displayed by the J-Link adapter itself. <br><br>  That's all for now.  <b><i>Successful experiments with ARM Cortex-M0 +!</i></b> <b><i><br></i></b> <br> <a href=""><img align="left" width="487" src="https://habrastorage.org/getpro/geektimes/post_images/f36/21d/ea0/f3621dea07d8faee42aad25b0a394cb3.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br>  <b>All <font color="#FF0000">sources</font> are still available at <a href="https://github.com/Indemsys/Light-Control-Module-PCB">https://github.com/Indemsys/Light-Control-Module-PCB</a></b> </div><p>Source: <a href="https://habr.com/ru/post/367561/">https://habr.com/ru/post/367561/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../367549/index.html">About why the Hubble telescope can create relatively detailed images of distant galaxies, but can not ‚Äúsee‚Äù Pluto</a></li>
<li><a href="../367551/index.html">The court refused the monkey to copy on their own selfie</a></li>
<li><a href="../367553/index.html">Jaq - charging for a fuel cell smartphone</a></li>
<li><a href="../367555/index.html">Oculus Rift for $ 599. Why so expensive?</a></li>
<li><a href="../367557/index.html">The special effects in the movie "Mad Max: Fury Road". Part 2/2</a></li>
<li><a href="../367563/index.html">Fetch Robotics introduces Fetch and Freight robots: your warehouse will now be automated.</a></li>
<li><a href="../367565/index.html">Univer Kaspersky 2020 - an application to improve the information security of users of the social network VKontakte</a></li>
<li><a href="../367567/index.html">6 years of observing gamma-radiation sources in the Universe: video from NASA</a></li>
<li><a href="../367569/index.html">The American company Sealed Air has released a film with bubbles that do not burst</a></li>
<li><a href="../367571/index.html">Making your own Z-Wave device based on Z-Uno</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>