<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The story of a widget</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This modest topic tells how important it is to pay enough attention and man hours to side service projects. 

 Intro 
 Vkontakte is an excellent examp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The story of a widget</h1><div class="post__text post__text-html js-mediator-article">  This modest topic tells how important it is to pay enough attention and man hours to side service projects. <br><br><h4>  Intro </h4><br>  Vkontakte is an excellent example of service, for people in which: both a high-quality code and excellent support.  However, its disadvantages are side projects. <br><br>  So the xmpp protocol was closed, sawed out: group widgets, ad space, api stores and much more.  This story is about one interesting vulnerability of the Vkontakte widget, which could. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      One evening, when I added a social component to my new site (like, repost, subscription), the spirit of the pentester awoke in me and I decided to check out the comment widget that was most interesting to me. <br><a name="habracut"></a><br><h4>  Main part </h4><br>  Since I was interested in the logic of the request and the ability to change it to fit my needs, armed with tamper data, the request sent to the server barked: <br><img src="https://habrastorage.org/storage3/cc3/e01/946/cc3e0194632f8f17dbfa2bee505be521.png"><br>  Widget = frame, so as not to create unnecessary obstacles for yourself, it was decided to act without an intermediary, since VK allows it.  To do this, take the referrer string, in its pure form, without any extra parameters (height, width, etc.), it represents: <br><pre><code class="hljs perl">http:<span class="hljs-regexp"><span class="hljs-regexp">//vk</span></span>.com/widget_comments.php?app=APPID&amp;_ver=<span class="hljs-number"><span class="hljs-number">1</span></span>&amp;page=<span class="hljs-number"><span class="hljs-number">0</span></span>&amp;status_publish=<span class="hljs-number"><span class="hljs-number">1</span></span>&amp;attach=*&amp;url=http%3A%2F%2Fsite.ru%2F&amp;title=&amp;description=&amp;image=</code> </pre> <br>  When working directly, the functionality of sending comments is saved, but, unfortunately, attachments refuse to load. <br><br>  It is empirically established that, in this form, the widget is no longer tied to the site on which it was placed (any type of widget requires to ‚Äúconnect‚Äù the site to the system, if the appid does not match the domain, then the widget will not be displayed) that the url parameter in the attachment is responsible for the link.  No, this is logical, but only relative to the attached link. <br><br>  Let me remind you that a comment that is added to the user's wall has two links. <br><img src="https://habrastorage.org/storage3/ec8/794/973/ec8794973c2e4742e6fc934334fde33b.png"><br>  In the basement is our attachment, and the top one should display the domain to which this widget and the custom link name are attached if the title parameter is used, however this is not the case and we can modify this data as we want. <br>  Add a text description to the link and the header of the popup block: <br><pre> <code class="hljs mel">vk.com/widget_comments.php?app=APPID&amp;_ver=<span class="hljs-number"><span class="hljs-number">1</span></span>&amp;page=<span class="hljs-number"><span class="hljs-number">0</span></span>&amp;status_publish=<span class="hljs-number"><span class="hljs-number">1</span></span>&amp;attach=*&amp;url=http%3A%2F%2Fm.habrahabr.ru%2F&amp;title=habrahabr.ru&amp;description=, !&amp;<span class="hljs-keyword"><span class="hljs-keyword">image</span></span>=XXXX_XXXX</code> </pre><br>  Where image = XXXXX_XXXXX from photoXXXXX_XXXXX, which is in the url of any VK pictures. <br>  We write an arbitrary comment (with the flag ‚Äúdisplay on your page) and publish it.  We get on the wall <br><img src="https://habrastorage.org/storage3/5d8/3a2/da4/5d83a2da4006c2ee177b9ed503bb2483.png"><br><br>  I have already mentioned that any widget is screwed to the site and if you open it, bypassing the frame, this condition is bypassed, but it is also impossible to insert the domain vk.com, instead of your domain.  After manipulating the source link, we can very simply refer to the page of any user and leave a comment, allegedly on his wall.  Of course, there is no practical benefit, but as one of the use cases is SI. <br><img src="https://habrastorage.org/storage3/5c7/ad3/4b6/5c7ad34b681ae9d2645d926a360bbbb4.png"><br><br><h4>  Conclusion </h4><br>  After finding this flaw, I, of course, reported to their technical support, the agent of which found this fact interesting and sent the bug for revision. <br>  Thanks to the developers for the fact that they get such a wonderful product and I wish them to deal with all the shortcomings of side services. </div><p>Source: <a href="https://habr.com/ru/post/193944/">https://habr.com/ru/post/193944/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../193930/index.html">Scala Training at JetBrains: How It Was</a></li>
<li><a href="../193932/index.html">Customer advice to the tenderer</a></li>
<li><a href="../193936/index.html">Normal numbers: educational program</a></li>
<li><a href="../193938/index.html">GifCam - animated screenshot in two clicks</a></li>
<li><a href="../193942/index.html">Couchbase usage example in conjunction with PHP</a></li>
<li><a href="../193946/index.html">Again the XMP tags are individuals. Everything is bad, but it is fixable</a></li>
<li><a href="../193950/index.html">Wonderful speech by a real programmer</a></li>
<li><a href="../193954/index.html">Hardware Trojans: Now with Dope</a></li>
<li><a href="../193956/index.html">Microduino - what if everything is taken and divided?</a></li>
<li><a href="../193964/index.html">EVI technology for data center integration</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>