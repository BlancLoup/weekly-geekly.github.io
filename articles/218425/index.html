<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development of Chromecast Ready applications for the Android platform</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. What is Chromecast and how does it work? 
 Chromecast is a gadget that allows users to stream media content from mobile devices to a TV. 

 The dev...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development of Chromecast Ready applications for the Android platform</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/3e1/8e2/687/3e18e2687c1cf9283f5aadf4e38e9cd5.jpg" alt="image"><br><h4>  1. What is Chromecast and how does it work? </h4><br>  Chromecast is a gadget that allows users to stream media content from mobile devices to a TV. <br><br>  The device, priced at $ 35, was announced on July 24, 2013 and was named the gadget of the year according to Time's 2013 version. First of all, it is a technology for transferring media content from phones, tablets or laptops to a device with a large screen - for example, a TV. <br><a name="habracut"></a><br><br>  Immediately after the announcement, the Chromacast SDK was in beta testing, which limited its practical application.  But on February 3, 2014, Google released the final version of the SDK. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now the number of applications supporting Chromecast is growing rapidly, so we decided to describe our experience in developing Chromecast ready applications for Android.  This article covers the development theme of the Chromecast ready application: below you will find some notes, comments and recommendations for developers as well as examples and source codes of our application. <br><br><h5>  How it works? </h5><br>  The Chromecast device executes a special version of the Chrome browser that can display special Web applications (called ‚ÄúReceiver‚Äù applications).  The immediate goal of these applications is to display media content to end users.  But the Chromecast device does not have any direct control levers, so there should obviously be some external controls, and as mentioned earlier, this could be either a mobile app or a Web app (which is called the ‚ÄúSender‚Äù app). <br><br>  Thus, using Sender apps, we can control the Chromecast device.  But how exactly does this happen? <br><br>  This can be done through a shared WiFi network - i.e.  Both Sender and Receiver applications must be connected to a single WiFi network.  This channel is bidirectional, so the ‚ÄúSender‚Äù application, for example, can issue commands for playing media content, while the ‚ÄúReceiver‚Äù application will notify ‚ÄúSender‚Äù the application about the playback status and position. <br><br><h4>  2. Application development </h4><br>  In general, developing applications for Chromecast includes developing Sender and Receiver applications.  As mentioned earlier, the Sender application can be a mobile or Web application, although this is not a limitation.  Receiver app is a special Web application that can be launched on a Chromecast device. <br><br>  In this article, we describe the development of a simple Chromecast application that allows messaging between sender and receiver parts.  The application that we developed can be used as a template for further development. <br><br>  But before we begin, we need to set up a Chromecast device and register our app. <br><br><h5>  2.1.  Configure Chromecast Device </h5><br>  The procedure is described <a href="https://support.google.com/chromecast/answer/2998456%3Fhl%3Den">here</a> . <br><br><h5>  2.2.  Application registration </h5><br>  You need to register your application in order to get the application ID (which will be used in both ‚Äúsender‚Äù and ‚Äúreceiver‚Äù applications). <br><br>  The registration procedure is described <a href="https://developers.google.com/cast/docs/registration">here</a> . <br><br><h5>  2.3.  Development of ‚ÄúSender‚Äù application </h5><br>  We will now discuss the development process of the ‚ÄúSender‚Äù application.  Although in order to be functional, ‚ÄúSender‚Äù application requires a working ‚ÄúReceiver‚Äù application.  So that we can check the results only after developing the ‚ÄúReceiver‚Äù application. <br><br>  Also, the development of the ‚ÄúSender‚Äù application for Android is described <a href="https://developers.google.com/cast/docs/android_sender">here</a> . <br><br>  In our case, the ‚ÄúSender‚Äù application is an Android application that uses a set of technologies and libraries to communicate with the ‚ÄúReceiver‚Äù application. <br><br><h5>  2.3.1.  Prerequisites: </h5><br><ul><li>  IDE for developing Android applications (for example, Eclipse) </li><li>  <a href="http://developer.android.com/sdk/index.html">Android SDK</a> </li><li>  <a href="http://developer.android.com/google/play-services/setup.html">Google Play Services SDK</a> version 15 or higher </li><li>  appcompat and media router libraries from the <a href="http://developer.android.com/tools/support-library/index.html">Android Support Library</a> </li></ul><br><h5>  2.3.2.  Making skeleton </h5><br>  Create an empty Android application and add the following libraries and dependencies: <br><br><ul><li>  android-sdk \ extras \ android \ support \ v7 \ appcompat </li><li>  android-sdk \ extras \ android \ support \ v7 \ mediarouter </li><li>  android-sdk \ extras \ google \ google_play_services \ libproject \ google-play-services_lib </li></ul><br>  Specify the minimum Android version, permissions, and other required data: <br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-sdk</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:minSdkVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"9"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:targetSdkVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"19"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.INTERNET"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.ACCESS_NETWORK_STATE"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.ACCESS_WIFI_STATE"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/app_name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/ic_launcher"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:theme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@style/Theme.AppCompat.Light.DarkActionBar"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta-data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.google.android.gms.version"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@integer/google_play_services_version"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Now create an activating expanding ActionBarActivity. <br><br><h5>  2.3.3.  Implementation </h5><br>  There are several key states in the application: <br><br><ul><li>  Device detection </li><li>  Work with session </li><li>  Messaging between Sender and Receiver Applications </li></ul><br>  Let's describe each state in more detail: <br><br><h6>  1) Device Detection: </h6><br>  Detection can be triggered by clicking on the ‚ÄúCast‚Äù button.  There are several ways to show this button, but we will use the MediaRouter ActionBar provider. <br><br>  Add the following to your menu: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/media_route_menu_item"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Route"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:actionProviderClass</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.support.v7.app.MediaRouteActionProvider"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:showAsAction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"always"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  The following fields are involved in the process: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> MediaRouter.Callback mediaRouterCallback = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MediaRouter.Callback() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onRouteSelected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MediaRouter router, MediaRouter.RouteInfo route)</span></span></span><span class="hljs-function"> </span></span>{ CastDevice device = CastDevice.getFromBundle(route.getExtras()); <span class="hljs-comment"><span class="hljs-comment">//setSelectedDevice(device); } @Override public void onRouteUnselected(MediaRouter router, MediaRouter.RouteInfo route) { //setSelectedDevice(null); } }; private MediaRouter mediaRouter; private MediaRouteSelector mediaRouteSelector;</span></span></code> </pre><br>  Initialize the mediaRouter and mediaRouteSelector in the onCreate method: <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); mediaRouter = MediaRouter.getInstance(getApplicationContext()); mediaRouteSelector = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MediaRouteSelector.Builder().addControlCategory(CastMediaControlIntent.categoryForCast(APP_ID)).build(); }</code> </pre><br>  Configure the action provider: <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateOptionsMenu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Menu menu)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreateOptionsMenu(menu); getMenuInflater().inflate(R.menu.main, menu); MenuItem mediaRouteMenuItem = menu.findItem(R.id.media_route_menu_item); MediaRouteActionProvider mediaRouteActionProvider = (MediaRouteActionProvider) MenuItemCompat.getActionProvider(mediaRouteMenuItem); mediaRouteActionProvider.setRouteSelector(mediaRouteSelector); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre><br>  and register the callback in the onStart and onStop methods: <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onStart(); mediaRouter.addCallback(mediaRouteSelector, mediaRouterCallback, MediaRouter.CALLBACK_FLAG_PERFORM_ACTIVE_SCAN); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//setSelectedDevice(null); mediaRouter.removeCallback(mediaRouterCallback); super.onStop(); }</span></span></code> </pre><br><br>  APP_ID is a string with the application identifier obtained when registering the application in part 2.2 <br><br>  Now connect your Android device to a shared WiFi network device with Chromecast and start the application (note that the receiver application should already be available. It is very simple in our case, so we can take it from the source codes. We will return to this later). <br><br>  If all conditions are met, the broadcast icon will appear in the upper right corner.  Clicking on it will open with a list of available devices, allowing you to connect to one of them.  After connecting, the icon will turn blue, indicating that the connection has been established.  Clicking on it again opens another dialog, which will allow you to change the volume on the Chromecast device or disconnect from it: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7db/f5f/921/7dbf5f921993f6b9d5cca712b6f57f35.png" alt="image"></div><br><h6>  2) Session Management: </h6><br>  To control the session, we will add several fields and methods: <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onStart(); mediaRouter.addCallback(mediaRouteSelector, mediaRouterCallback, MediaRouter.CALLBACK_FLAG_PERFORM_ACTIVE_SCAN); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//setSelectedDevice(null); mediaRouter.removeCallback(mediaRouterCallback); super.onStop(); }</span></span></code> </pre><br>  and a few listeners: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CastDevice selectedDevice; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GoogleApiClient apiClient; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> applicationStarted; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setSelectedDevice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CastDevice device)</span></span></span><span class="hljs-function"> </span></span>{ Log.d(TAG, <span class="hljs-string"><span class="hljs-string">"setSelectedDevice: "</span></span> + device); selectedDevice = device; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (selectedDevice != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { stopApplication(); disconnectApiClient(); connectApiClient(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IllegalStateException e) { Log.w(TAG, <span class="hljs-string"><span class="hljs-string">"Exception while connecting API client"</span></span>, e); disconnectApiClient(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (apiClient != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { disconnectApiClient(); } mediaRouter.selectRoute(mediaRouter.getDefaultRoute()); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connectApiClient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Cast.CastOptions apiOptions = Cast.CastOptions.builder(selectedDevice, castClientListener).build(); apiClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GoogleApiClient.Builder(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) .addApi(Cast.API, apiOptions) .addConnectionCallbacks(connectionCallback) .addOnConnectionFailedListener(connectionFailedListener) .build(); apiClient.connect(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">disconnectApiClient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (apiClient != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { apiClient.disconnect(); apiClient = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopApplication</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (apiClient == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applicationStarted) { Cast.CastApi.stopApplication(apiClient); applicationStarted = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } }</code> </pre><br>  Now if you connect to the Chromecast, the ‚ÄúReceiver‚Äù app will be activated and you will see some debug information.  Let's open the topic of messaging. <br><br><h6>  3) Messaging between Sender and Receiver applications. </h6><br>  Outgoing messages are sent using the connection method: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String message)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (apiClient != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Cast.CastApi.sendMessage(apiClient, NAMESPACE, message) .setResultCallback(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ResultCallback&lt;Status&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Status result)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!result.isSuccess()) { Log.e(TAG, <span class="hljs-string"><span class="hljs-string">"Sending message failed"</span></span>); } } }); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { Log.e(TAG, <span class="hljs-string"><span class="hljs-string">"Exception while sending message"</span></span>, e); } } }</code> </pre><br>  In our case, NAMESPACE is the string "urn: x-cast: com.ls.cast.sample".  It is used to separate our channel from others.  The same should be used in the Receiver application. <br><br>  To process incoming messages, we need to register Cast.MessageReceivedCallback as a message receiver.  We do this in connectionResultCallback: <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Cast.ApplicationConnectionResult result)</span></span></span><span class="hljs-function"> </span></span>{ Status status = result.getStatus(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (status.isSuccess()) { applicationStarted = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Cast.CastApi.setMessageReceivedCallbacks(apiClient, NAMESPACE, incomingMsgHandler); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { Log.e(TAG, <span class="hljs-string"><span class="hljs-string">"Exception while creating channel"</span></span>, e); } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Cast.MessageReceivedCallback incomingMsgHandler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cast.MessageReceivedCallback() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMessageReceived</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CastDevice castDevice, String namespace, String message)</span></span></span><span class="hljs-function"> </span></span>{ } };</code> </pre><br>  And the last thing you can do is exchange messages.  In our demo application, we have created a simple layout that allows you to show incoming messages.  You can read the full source code in the <a href="">attached file</a> . <br><br><h5>  2.4.  Development of ‚ÄúReceiver‚Äù application </h5><br>  ‚ÄúReceiver‚Äù application is a special Web application that can work in a Chromecast device. <br><br>  The ultimate goal of the application is to show the user useful information and allow him to interact with this information through the ‚ÄúSender‚Äù application. <br><br>  The first task of displaying information is common for Web applications and can be very different: it can be a media application like YouTube or something like a media player, or it can be some heavy UI application like Google Maps with additional layers, or be a simple HTML page displaying some statistics. <br><br>  About the second task of interaction between Receiver and Sender by the application - the Chromecast SDK provides a JavaScript library for this.  This allows you to exchange string messages in both directions.  Let's open this topic. <br><br>  First of all, keep in mind that the application must be registered as described in clause 2.2.  When registering, you must provide a URL.  This URL will be used to host your Receiver application.  Receiver application development consists of the following stages: <br>  1) application development locally; <br><br>  2) placing it on the specified URL; <br><br>  3) activation and debugging of the application through a special URL.  To activate the application, simply launch the Sender application and connect to the device.  To debug the ‚ÄúReceiver‚Äù application, open the following link on your PC: <a href="http://chromecast_ip:9222/">http: // CHROMECAST_IP: 9222</a> , where CHROMECAST_IP is the IP address of the Chromecast device.  In order to get the IP address of the device, run the Chromecast configuration utility for PC or for mobile devices.  Please note that the device used for the configuration must have a direct WiFi connection to the Chromecast device (so your PC must have a WiFi adapter if you select it for configuration): <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ba8/56c/9e0/ba856c9e01a0e9c9923eb7e5b519602f.png" alt="image" width="500"></div><br><br>  Also note that the ‚ÄúSend this Chromecast's serial number when checking for updates‚Äù option should be enabled to enable debugging.  After the browser opens the found address, you will see the following: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4f5/4a8/0e1/4f54a80e1c7b8faaebe63be26b6dc966.png" alt="image"></div><br><br>  The highlighted link refers to the executing application. If you click on it, a new page with Chrome Developer tools will open.  Do not stray them with local developer tools - in fact they are remote and belong to your Chromecast device: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ccb/3dd/372/ccb3dd372321868c45f877cecce92ab0.png" alt="image"></div><br><br>  Now we are finally ready to develop the application. <br><br>  First of all, enable the Chromecast support script: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="undefined"></span></code> </pre><br>  After that, we need a cast.receiver.CastReceiverManager instance, connect onSenderConnected, onSenderDisconnected and onMessage listeners and start the exchange of messages.  We can do this in the onLoad listener: <br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.castReceiverManager = cast.receiver.CastReceiverManager.getInstance(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.castReceiverManager.onSenderConnected = onChannelOpened; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.castReceiverManager.onSenderDisconnected = onChannelClosed; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.customMessageBus = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.castReceiverManager.getCastMessageBus(namespace); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.customMessageBus.onMessage = onMessage; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.castReceiverManager.start();</code> </pre><br>  The following method can be used to process incoming messages: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMessage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> message = event.data; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> senderId = event.senderId; log(<span class="hljs-string"><span class="hljs-string">"message from: "</span></span> + senderId + <span class="hljs-string"><span class="hljs-string">" message: "</span></span> + message); }</code> </pre><br>  The following method will be used to send outgoing messages: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">broadcast</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">message</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.customMessageBus.broadcast(message); }</code> </pre><br>  Please note that several Sender applications can connect to one Receiver application at the same time.  Therefore, we use the broadcast method to send a message to all connected sender applications. <br><br>  In our demo application, we send timer messages for demonstration purposes. <br><br>  And a few more comments.  The default text color is black, so you need to redefine it via CSS in order to see something.  Also note that the screen resolution in the Chromecast device is 1280x720 pixels. <br><br>  Fuh.  We have created a custom Sender and Receiver application capable of messaging both ways.  This should be enough to understand and use the full power of the Chromecast device. <br><br>  The full source code can be downloaded <a href="">here</a> . <br><br>  PS In fact, I am also the author of the article, so I can answer technical questions. </div><p>Source: <a href="https://habr.com/ru/post/218425/">https://habr.com/ru/post/218425/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../218413/index.html">Minimalism when creating landing page</a></li>
<li><a href="../218417/index.html">WebView or a story about how the browser was written in KolibriOS</a></li>
<li><a href="../218419/index.html">Qt is now on Windows Phone</a></li>
<li><a href="../218421/index.html">Epidemic of online consultants</a></li>
<li><a href="../218423/index.html">Work with ZeroMQ and PostgreSQL in asyncio</a></li>
<li><a href="../218429/index.html">Functional image processing in D</a></li>
<li><a href="../218431/index.html">Stock Market Technologies: Brokerage Trading System</a></li>
<li><a href="../218437/index.html">Terms of Service, Privacy Policy and License Agreement: an educational program for an indie mobile developer</a></li>
<li><a href="../218441/index.html">Universal applications for Windows and Windows Phone</a></li>
<li><a href="../218443/index.html">Epson on Droidcon Moscow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>