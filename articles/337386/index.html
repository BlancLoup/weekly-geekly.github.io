<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Allure 2: New Generation Test Reports</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For the last eight years, Artem Eroshenko has been involved in test automation. During this time, he managed to interact with different teams in diffe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Allure 2: New Generation Test Reports</h1><div class="post__text post__text-html js-mediator-article">  For the last eight years, Artem Eroshenko has been involved in test automation.  During this time, he managed to interact with different teams in different positions, but most of his career he worked in the development team of testing tools.  In this team, a tool was born to build Autotest reports Allure, which they zaopensorsili. <br><br>  There are people who do not know about this tool.  Therefore, we begin with a brief introduction to the Allure report. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/tTV00kSutQI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>The basis of this material was the <a href="https://www.youtube.com/watch%3Fv%3DtTV00kSutQI">speech of</a> Artem Eroshenko at the conference Heisenbag 2017 Piter.</i>  <i>At the <a href="https://heisenbug-moscow.ru/"><b>Moscow conference</b></a> on December 8-9, Artem will make a new report.</i> <br><a name="habracut"></a><br><h2>  What is the Allure framework? </h2><br>  First of all, the Allure framework is a tool for constructing clear autotest reports. <br><br><img src="https://habrastorage.org/web/354/6f1/370/3546f1370d2945f7af7788fe3d2a8b94.png"><br><br>  What problems does Allure solve?  First, it shows what happens in your test. <br><br><img src="https://habrastorage.org/web/d85/4f3/2fe/d854f32febd0412099f72e0b001fea26.png"><br><br>  To solve this problem, Allure for each test case attaches a detailed execution script, including attachment, step, etc. <br><br>  Secondly, different roles in a team have different requirements for displaying test results in general.  For example, a developer is much more comfortable seeing the grouping of tests by test classes.  He wonders in which test class and method the error occurred.  On the other hand, the manager is much more interesting in terms of features.  It is closer to functionality.  He is interested to know which feature does not work and for what reason.  Allure solves this problem. <br><br><img src="https://habrastorage.org/web/292/305/d1b/292305d1bec749e0a2099c7a0308194c.png"><br><br><img src="https://habrastorage.org/web/43d/d90/25a/43dd9025a07b4a7098a55f6557801771.png"><br><br>  Well, the third problem that Allure solves is the browser zoo.  You can always build a single report - no matter what framework you use. <br><br><img src="https://habrastorage.org/web/9f4/599/07b/9f459907b5d541c992335000b8b46811.png"><br><br>  This is the Allure Report. <br><br>  In general, it seems that Allure is a pretty cool thing.  From the limitations, I see that he always has one data source - the so-called adapter.  This is how this mythic adapter works. <br><br><img src="https://habrastorage.org/web/4fc/398/091/4fc39809144d4ac18490d6fbeb78f313.png"><br><br>  Imagine that you are writing tests on jUnit.  You connect the Allure jUnit adapter to it.  During the execution of your tests, the adapter collects all the necessary information.  He understands when the test began, when the test ended, with what error it fell.  It also collects detailed information about your test scripts. <br><br>  After running the tests, the adapter saves the data as xml.  This is his task. <br><br>  Based on several such xml files, the Allure report is built. <br><br><img src="https://habrastorage.org/web/913/6f4/46a/9136f446a661412491e169db7d2264a7.png"><br><br>  An independent adapter is written for each testing framework. <br><br><img src="https://habrastorage.org/web/0c2/831/712/0c2831712ac3438eab7931dfeceb90a5.png"><br><br>  But the adapter is not all the information.  Those.  It is impossible to remove all information from the adapter, because it is very close to a specific framework. <br><br><img src="https://habrastorage.org/web/d1a/8f2/66b/d1a8f266bd3f4be1b01585d49ac9d63b.png"><br><br>  For example, there is no information in the adapter regarding configurations - what exactly are you testing;  no historical data ‚Äî when tests were run, when they were restarted, etc.  Also in the adapter there is no information about open and closed issues.  That is why the new version of Allure provides many data sources. <br><br><img src="https://habrastorage.org/web/556/7aa/e65/5567aae6526542f7a0343f4112086462.png"><br><br>  For example, we will still take information about the test from the adapter.  This is normal information, it has a script and so on.  Information about the history of the test - when it was last launched, with what error it fell, and so on - we will take from the CI server.  Information about open tickets, status, errors in the product, we can take from Jira.  And, if necessary, you can implement an extension that some adapter already supports and adds the necessary information to Allure.  Those.  The new version of Allure is primarily configured to have multiple data sources.  We will expand the number of sources and supplement the report so that it contains all the necessary information, and you can quickly understand what your problem is: in the product or in the test. <br><br><h2>  Allure 2 </h2><br>  Next, I will tell: <br><br><ul><li>  what were the main big features for Allure as a whole (not specific for a specific framework); <br></li><li>  how you can customize Allure for yourself; there is an excellent extension mechanism for this; <br></li><li>  how to migrate to Allure. <br></li></ul><br><h2>  What is new? </h2><br><h3>  Test execution scripts </h3><br>  We are very pleased with the upgrade test execution scripts. <br>  What appeared there? <br><br><ul><li>  support test fixtures.  Now you can see which code was run before the test (before, before class) and after the test (after, after class).  Information on the preparation and cleaning of the configuration is now in the set up and tear down blocks; <br></li></ul><br><br><img src="https://habrastorage.org/web/138/4da/5d6/1384da5d60c24e8d903105303038b398.png"><br><br><ul><li>  we added parameters to the steps.  Now there is no need to print all parameters in tittle, you can just print only the necessary parameter, for example, username.  And all other parameters will be in a convenient label: <br></li></ul><br><br><img src="https://habrastorage.org/web/200/721/bd8/200721bd893f409aa1af3b4d76691f3a.png"><br><br><ul><li>  It has become possible to add custom blocks to the test execution script.  For example, if you use the screenshots comparison engine, you can directly add a diff to the test script and you will immediately understand that such a problem has occurred, because your screenshots are different; <br></li></ul><br><img width="300" src="https://habrastorage.org/web/194/d1e/97e/194d1e97ebfc435e9e67344566483d99.png"><br><br><h3>  Test restarts </h3><br>  Tests are not always perfect.  Especially imperfect environment test infrastructure.  And often there is a situation when you need to restart the tests.  That is, you once launched the test, it broke, you restarted - it broke again, and the third time it was launched - everything is fine.  And the restarts were due to some kind of infrastructure problem.  Previously, Allure did not know how to glue these tests together.  He thought it was 3 different tests. <br><br><img src="https://habrastorage.org/web/19f/bc1/195/19fbc1195c4f443c9c49ded003690833.png"><br><br>  In order not to spoil the statistics, testers usually used custom adapters to change the status of broken tests on skipped - that is, they are supposedly not needed.  However, this still spoiled the statistics.  It was not 100% green tests, but 90% green tests and 10% skipped.  Plus, these tests in the tree were visible - interfered with the look. <br><br><img src="https://habrastorage.org/web/693/7a1/852/6937a18523f8426a85f091f500d20a36.png"><br><br>  The new Allure can automatically recognize retries (restarts) and glue them into one test. <br><br><img src="https://habrastorage.org/web/971/7df/511/9717df5119ce46ca93b5cb0269b2761d.png"><br><br>  How does this happen?  We are able to analyze the classes, methods and parameters of the test.  Based on this, the so-called history ID is generated - a unique test key by which we can glue together.  According to this key tests are collected, ordered by time.  The latest status is determined from the last test (by time). <br><br>  It looks like this: <br><br><img src="https://habrastorage.org/web/b03/19f/737/b0319f73770e4aafa0ba958545654767.png"><br><br>  The test at the bottom has a special block called retries.  It contains information about restarting tests.  I note that these tests, except in this block, are not displayed anywhere else.  They do not spoil the statistics, do not appear in the tree. <br><br>  Links to tests are clickable: you can click on the links and see why the last time this or that test fell. <br><br><img src="https://habrastorage.org/web/0ef/695/e1e/0ef695e1eb70417ebc9717cc9c3a58bb.png"><br><br>  In my opinion, such tests are not very good, because they are unstable.  It turns out that at first the test fell with an error, then you poshamanil something there, and the test passed.  We put such tests on the side with a bomb, denoting that he should not be trusted.  A similar icon is displayed in the tree.  Those.  such tests you do not lose - just open the tree, and immediately see all the tests for which you need to analyze the causes of the fall. <br><br><img src="https://habrastorage.org/web/541/671/564/541671564f264ca8b78f7df5fef0089c.png"><br><br>  However, such tests will not affect overall performance statistics. <br><br><h3>  Startup Combination </h3><br>  This feature is a consequence of the functionality described above.  It allows you to combine multiple runs into one. <br><br>  Imagine that you run the tests and some of them fell on infrastructure issues.  Then you restarted the tests, again some part fell.  In the end, you repaired your tests, and you want to see a report in which it is clear that the tests you actually passed.  Yes, last time they fell, and there is some "red" information that some tests were broken. <br><br><img src="https://habrastorage.org/web/2a7/58a/fb1/2a758afb17b84097ab3ffba625b8d1b1.png"><br><br>  You can do this in one command: <br><br><pre><code class="javascript hljs">$ allure generate \ #<span class="hljs-number"><span class="hljs-number">1</span></span> first-launch \ #<span class="hljs-number"><span class="hljs-number">2</span></span> second-launch \ #<span class="hljs-number"><span class="hljs-number">3</span></span> third-launch \</code> </pre> <br>  You execute allure generate, specify three directories for it (first, second and third launch), and it marks all the tests that were in retries, i.e.  he sticks together all the tests that were run, takes the last result in time (maybe he is not green, but red), and all the other tests add up to him in retries. <br><br>  This mechanism allows you to generate a summary report based on several launches or restarts. <br><br><img src="https://habrastorage.org/web/7f7/a27/a63/7f7a27a6363c485f8293860ba9b9e0e6.png"><br><br><h3>  Error categories </h3><br>  I really like this feature, because it allows you to more quickly analyze and analyze reports. <br><br>  As you know, there are 4 completion states in Allure: <br><br><img src="https://habrastorage.org/web/5f7/9ee/6c8/5f79ee6c89924fc5995a9e91cf0923c5.png"><br><br>  It: <br><ul><li>  skipped (skipped); <br></li><li>  broken; <br></li><li>  failed; <br></li><li>  passed (test passed). <br></li></ul><br>  We were very often asked to add additional statuses, for example, ‚Äúerror creating user for testing‚Äù or ‚Äúerror of Selenium‚Äù, ‚Äúproblem in selectors‚Äù and so on.  We decided not to expand the number of statuses, but to add some orthogonal concept - the category of errors. <br><br>  To use categories, you need to prepare a configuration file called categories.json.  This file contains information about the categories of errors that you will use: <br><br><pre> <code class="javascript hljs">[ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"  ()"</span></span>, <span class="hljs-string"><span class="hljs-string">"messageRegex"</span></span>: <span class="hljs-string"><span class="hljs-string">".*Unable to locate element.*"</span></span>, <span class="hljs-string"><span class="hljs-string">"matchedStatuses"</span></span>: [<span class="hljs-string"><span class="hljs-string">"broken"</span></span>] }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"   "</span></span>, <span class="hljs-string"><span class="hljs-string">"messageRegex"</span></span>: <span class="hljs-string"><span class="hljs-string">".*Timed out .* from renderer.*"</span></span>, <span class="hljs-string"><span class="hljs-string">"matchedStatuses"</span></span>: [<span class="hljs-string"><span class="hljs-string">"broken"</span></span>] } ]</code> </pre><br>  For example, you create a category called ‚Äúobsolete tests‚Äù - these are outdated tests that need to be corrected.  It will add all the errors that satisfy the template (in our case, if the element is not found on the page) - here it will be necessary to correct the selectors.  After that we say that all tests with the broken status should be included here. <br><br>  We can also track down problems in a cluster of browsers and put a timeout of exits there. <br><br>  After you generate a report, you will have a new tab. <br><br><img src="https://habrastorage.org/web/49b/ef3/cb9/49bef3cb9da641bc863568c798716f83.png"><br><br>  Previously, this tab was called Defects, that is, there was information about product defects and tests.  Now there is more and more data, in particular, information about our categories: ‚ÄúProblems in the cluster of browsers‚Äù is one problem, ‚ÄúOutdated tests‚Äù is the second problem.  Then found problems and new problems in tests that need to be disassembled.  Thus, after running your tests, you can use this tab to quickly understand what really happened in the tests and why they fell. <br><br>  The error category is displayed in each test. <br><br><img src="https://habrastorage.org/web/e7c/7b3/c37/e7c7b3c37a574297bf3205b571d5d0e3.png"><br><br>  You can see the new block that shows which error category this test belongs to.  There may be several such categories - the test may fall due to several problems, respectively, you will have several categories here. <br><br>  We just started working on the categories of errors, and we have a lot of plans to develop.  In particular, I really want to add categorization in BDD and suites.  I would like to understand something like this: we did not check the authorization, because everything fell on the problems of Selenium, and we did not check the creation of the client, because we do not create an agreement.  That is, we want us to operate with additional data in the report.  So that we are not limited to information like ‚Äúsome kind of feature does not work‚Äù on 5 test cases, but understand what specifically does not work in this functionality.  The second thing you want to understand is some statistics by category.  It is very interesting to come to your infrastructure support team and say: ‚ÄúI have 20% of tests constantly falling due to Selenium errors.  Let's do something about it already. ‚Äù  We will work on this, and this functionality will appear in the near future. <br><br><h3>  Test history </h3><br>  The most interesting point about which we have been asked a lot is the history of tests. <br>  Ordered - get it.  The test history is now officially supported in Allure via communication with the CI server, which is the source of the data.  Jenkins, TeamCity and Bamboo are now supported.  You can also easily adapt your framework and do generation through Allure. <br><br>  It is very important to understand that this all works out of the box.  Allure has not acquired the database, it is still the same simple, easy and reliable tool.  It essentially generates a static report, but just during generation it pulls data from CI servers about when some tests were run. <br><br>  The first thing you will see when you use Allure 2 is information about trends. <br><br><img src="https://habrastorage.org/web/311/f1a/f23/311f1af23efb460eb9bcb772160ea567.png"><br><br>  You will see the graph for the last 20 runs - when what tests were run.  You will be able to click on this schedule, and you will move on to previous builds. <br><br>  Also history is displayed on the test case page. <br><br><img src="https://habrastorage.org/web/fc7/a32/c15/fc7a32c150f7439c991657ab04cd87fb.png"><br><br>  She is now like the Retries block.  The lines there are also clickable.  If you click on a line, you will move ‚Äúback to history‚Äù to the previous build for a specific result. <br><br><img src="https://habrastorage.org/web/fc8/123/706/fc81237065504f82b8985add0f7c5522.png"><br><br>  You can easily switch and quickly analyze specific problems. <br><br>  Stories are also just the beginning.  In the future, I really want to work out the mechanism of exactly new tests: ‚Äúhow many tests were added this week‚Äù, ‚Äúand if by people - how many tests did one tester add, how many tests did the second tester add‚Äù, ‚Äúand how stable are new tests for us? tests indicators success rate "and so on.  We will move in this direction - in Allure there will be information about new tests, what problems there are in these tests. <br><br>  In addition, I want to work out the issue based on historical data about known problems.  I would like to immediately show that such a problem has already occurred, where she met, and so on.  And this will also be done on the basis of historical data. <br><br><h3>  Data export </h3><br>  Another feature that was asking for itself was the export of data.  It is now supported as such, i.e.  The ability to export data is there, but features with data export are not yet ready.  However, I really want to talk about them. <br><br>  The first feature is a summary report. <br><br><img src="https://habrastorage.org/web/17c/f8c/b93/17cf8cb93d6842ad8fadfaba8a8a9a0d.png"><br><br>  Allure has long been asking for a report that can be sent by e-mail.  This is especially true for all CI-servers, when you have passed the tests, and CI can simply say: "You have some problems in the build."  We will generate some summary report that can be attached to the build and sent by mail. <br><br>  In addition, I want to do some export of summary statistics in CSV and PDF formats.  You can print Allure to transfer to a friend or customer so that he does not need to click on the report. <br><br>  At this point, the talk about Allure's big features is over.  We started collecting data for the report from various sources and will continue to develop in this direction. <br><br><h3>  How to customize? </h3><br>  Now I want to talk about how you can customize Allure for yourself.  He is not just called the framework.  You should be able to add something to it. <br><br>  In Allure, there is a pretty good, in my opinion, system extensions.  Extensions are written using Java and JavaScript (Allure itself is written in Java and JavaScript - the muzzle is written in JavaScript, and the kernel in Java). <br><br><h3>  Screenshot Comparison </h3><br>  As an example, let's write a small extension that will help display a comparison of screenshots directly on the test case page, i.e.  will add an extra block there.  I think that every tester who deals with a web interface has encountered such a task.  By comparing screenshots, you can quickly roll up the primary tests for the functionality of the service.  You take a screenshot of the elements in the testing, take a screenshot of the elements in the production and check the Diff, which will look like this: <br><br><img src="https://habrastorage.org/web/5f0/2e7/ff2/5f02e7ff20df48889ad78f773e8b7533.png"><br><br>  So you very quickly have a large set of tests. <br><br>  Previously, screenshots were added as attachments.  In order to get to them, it was necessary to first open the test case, then the test, then go to the execution, click the link to the screenshot there, and then it will be displayed. <br><br><img src="https://habrastorage.org/web/5a3/3da/135/5a33da1350ea44fa94f5fd51cd716c5f.png"><br><br>  Now it is possible to add blocks directly to test execution scripts - directly on the main page. <br><br><img src="https://habrastorage.org/web/ada/9f9/0d2/ada9f90d2fc04382bd04f900f79a2970.png"><br><br>  How to make such an extension? <br><br>  First, we use gradle as a project build system. <br><br><img width="300" src="https://habrastorage.org/web/e44/f43/5c5/e44f435c5fe449a19970f248e6072871.png"><br><br>  I will not tell you more about the insides, I want to concentrate on the expansion itself.  For this we need to write a piece of JavaScript, which simply pastes the necessary information in the execution. <br><br><img width="300" src="https://habrastorage.org/web/cb3/27b/d94/cb327bd94f054df19eab39c78a80fcd9.png"><br><br>  First we will make a function that renders the image. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">renderImage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">src</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;div class="‚Ä¶"&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;img src="'</span></span> + src + <span class="hljs-string"><span class="hljs-string">'"&gt;'</span></span> + <span class="hljs-string"><span class="hljs-string">'&lt;/div&gt;'</span></span>; } } <span class="hljs-comment"><span class="hljs-comment">//Backbone.Marionette.View var ScreenDiffView = View.extend({ ‚Ä¶ }) allure.api.addTestcaseBlock( ScreenDiffView, {position: 'before'} );</span></span></code> </pre><br>  After that, we extend it with Marionette.View, that is, we will do this additional extension in which we can add JavaScript logic.  For example, press the button - it shows the production, press the button - it shows the testik, press the button - it shows the Diff.  After that we call the Allure API and add the block directly to the result of the tests.  As a result, you will display it directly on the main page. <br><br><h3>  Own format </h3><br>  The second extension, which you want to talk about, is support for your format.  It happens that you have all the necessary information in the framework - about the launch of the test, all the features, exceptions and so on.  And you do not want to connect some of our adapter or, say, the desired adapter does not exist.  In this case, if you already have the results, you can simply read them out, at the time of building the report, converting them into Allure results.  That is, it is possible, in principle, to bypass the stage of connecting the adapter.  This will be useful, for example, to read already standard formats.  Here TeamCity supports the format mst, testng and so on.  After some time, Allure will also support these formats by default, i.e.  we will be able to generate a report without connecting an adapter.  This report will be minimalistic, but for people who write unit tests or integration tests on HTTP, there will be all the necessary information. <br><br>  What does this extension look like? <br><br><img width="300" src="https://habrastorage.org/web/289/bfa/849/289bfa84983b4f75b64209119dd366f6.png"><br><br>  There is no JavaScript in this extension, this is purely Java logic: we need to read the results, after which we convert them to Allure.  We are interested in the Java part: <br><br><img width="300" src="https://habrastorage.org/web/457/b89/cb7/457b89cb7a9545378dd5ca935cfa28d0.png"><br><br>  To support its own format, there is an interface called Reader. <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Reader</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Extension</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readResults</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Configuration configuration, ResultsVisitor visitor, Path resultsDirectory)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//your code here }</span></span></code> </pre><br>  A configuration is sent to the input (here you will find the entire confederation regarding Allure), then you will receive some Visitor as input.  It allows you to add new tests to the Allure Report.  And the last is the directory that we will analyze. <br><br>  How do we write a new extension: <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomReader</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Reader</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readResults</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(config, visitor, results)</span></span></span></span>{ listFiles(directory).stream() .map(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::readFileToCustomResult) .map(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::convertToAllureTestResult) .forEach(visitor::visitTestResult); } }</code> </pre><br>  We first read all the files from this directory.  Then we put all these files in some kind of your object.  After that we convert your data structure to Allure Results and add them to Visitor.  In principle, there is nothing difficult here - you just need to convert your format to Allure Results. <br><br>  With the help of such extensions, you can support your frameworks that you can‚Äôt get into anymore.  For example, if there are no listeners. <br><br><h3>  Arbitrary tree </h3><br>  As you know, Allure has the first categorization - by test cases (i.e., you see the package, and there is a specific test case in it), and the second categorization is by feature story (first, all the tests are grouped by features, then all tests are grouped by story). <br><br>  To make an arbitrary tree, you need to do 2 points: <br><br><ul><li>  generate the data structure itself, i.e.  some JSON in which you will have information about the collected tree; <br></li><li>  embed this tree in Allure reports, i.e.  make some implementation right in the web interface. <br></li></ul><br>  Let's analyze the solution structure in order. <br><br><img width="300" src="https://habrastorage.org/web/6e5/a46/7fd/6e5a467fd2294e0480b2153c8a0879dd.png"><br><br>  Let's start with the java part.  To collect information on the categories of tests, you need extended-it abstract or agregator.  He should implement the name of the file in which you will have information about the categories, and a list of categories.  That is, first we collect information on the component, then on the module. <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomTab</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractTreeAggregator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFileName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"custom.json"</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> List&lt;TreeGroup&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getGroups</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Arrays.asList({ allByLabel(result, <span class="hljs-string"><span class="hljs-string">"component"</span></span>) allByLabel(result, <span class="hljs-string"><span class="hljs-string">"module"</span></span>) }) } }</code> </pre><br>  Then this information should be displayed in the Allure-report itself. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> components = allure.components; allure.api.addTab(<span class="hljs-string"><span class="hljs-string">'custom'</span></span>, { title: <span class="hljs-string"><span class="hljs-string">'Custom'</span></span>, icon: <span class="hljs-string"><span class="hljs-string">'fa fa-list'</span></span> route: <span class="hljs-string"><span class="hljs-string">'custom/(:/testcaseId)'</span></span> onEnter: (function(){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> routeParams=‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> components.TreeLayout({ routeParams: routeParams, tabName: <span class="hljs-string"><span class="hljs-string">'Custom'</span></span>, baseUrl: <span class="hljs-string"><span class="hljs-string">'custom'</span></span> url: <span class="hljs-string"><span class="hljs-string">'data/custom.json'</span></span> }) })});</code> </pre><br>  To do this, we pull the Allure API, add a Tab, which is called custom.  In it we fill in the title, icon and route (i.e. all requests that will go to the custom ID will be sent to this tab). <br><br>  With the help of standard components Allure you draw a new tree.  You can add arbitrary information, in particular, new graphics or widgets.  We have a library of components for this, which you can use. <br><br>  After starting Allure and connecting the extension, a custom tab will appear, in which the grouping according to your settings will be implemented. <br><br><img src="https://habrastorage.org/web/93a/818/65d/93a81865d0f7436ca3c09a073417bee9.png"><br><br>  This solution is suitable for companies that already have some kind of test structuring, for example, that comes from the past (let's say you are not using or not using a feature story). <br><br><h3>  Distribution of extensions </h3><br>  Now the distribution of such extensions is not yet ready.  There is no mechanism through which you can select a new extension and load it into Allure (extension market).  Nevertheless, we are working on it and we hope that after some time we will have a set of extensions, and we will be able to load them flexibly into Allure.  That is, you can indicate directly in the configuration that I need this and this extension.  It would be desirable, that in Allure appeared as much as possible new functionality. <br><br><h3>  System extensions </h3><br>  I tried to fit almost every extension on one slide.  It is clear that in reality this is too cool - I missed a lot of code, because I wanted to show the possibilities.  In fact, only quite experienced users who can program in Java and JavaScript, Backbone, and so on can write an extension.  In my opinion, it is not as easy as it seems.  But you can try.  If you have any ideas on how to make any extensions that will be useful to the entire community, we will be happy to listen to you and write these extensions yourself.  Send us your ideas about what information you can add to the report, to the repository. <br><br><h2>  How to migrate? </h2><br>  Let's talk about how to migrate to the new Allure and what is migration. <br>  Allure is fully backward compatible.  You can now download version 2.1.0, put it to yourself and build a report based on current data.  There is no need to change anything except the version of the Allure Report itself. <br><br>  For example, you can do it like this for Jenkins: <br><br><img src="https://habrastorage.org/web/ca7/ee9/ba0/ca7ee9ba02ff4be6af8f241d3077e5d4.png"><br><br>  You had before Allure 1.5.4.  You pumped it out of Maven Central.  You add a new tool - Allure 2.1.0, specify the URL (unfortunately, now there will be such a long URL - I have already sent a request to Jenkins, and they should zapruvit it soon, then it will be available as before via the drop-down menu). <br><br><img src="https://habrastorage.org/web/170/659/fe4/170659fe427f41ef8a2f72ffe5b7057d.png"><br><br>  After adding a new URL, you configure some of your job, where you have the opportunity to switch from 1.5.4 to 2.1.0, and everything works. <br><br><img src="https://habrastorage.org/web/7bc/1ed/664/7bc1ed6641e74cec84a21bf4e793116b.png"><br><br>  At the same time, you immediately get the chips discussed above: restarts, pooling reports, history, the ability to add new blocks to test cases, and so on. <br><br>  Why then update adapters? <br><br>  We try to collect information from tests as much as possible.  For example, in the latest version we begin to integrate more tightly with all sorts of standard solutions.  The first thing we will do now is custom attachments for http probes, for an http client, for retrofit, etc.  If you use one of these technologies, you simply connect Allure retrofit to yourself, and you will immediately have Allure with detailed scripts with logs, requests and responses. <br><br>  We will carry out further integration with ready-made frameworks and make strapping around them. <br><br><img src="https://habrastorage.org/web/d24/ae9/944/d24ae99448dd4c51afa03e05653901a3.png"><br><br>  If you use Allure and want to keep abreast of the latest events, join our community. <br><br>  The first thing you can do is subscribe <a href="https://github.com/allure-framework">to us on Github</a> .  There are all the repositories and integrations that are in Allure.  Come, subscribe to the integration you are interested in.  And you will be aware of what is happening there. <br><br>  If you have some kind of emergency problem, if you don‚Äôt understand what is happening, come to our Gitter: <a href="https://gitter.im/allure-framework/allure-ru">here</a> and <a href="https://gitter.im/allure-framework/allure-core">here</a> .  This is an online chat.  We are constantly in real-time answering all questions there.  If you encounter any problem that you cannot quickly resolve, and you need a quick solution, write to us there, we will promptly answer you and help you figure it out. <br><br>  Follow us on Twitter: <a href="https://habrahabr.ru/users/eroshenkoam/" class="user_link">eroshenkoam</a> (i) and @QametaSoftware (twitter, where we will post about new versions of Allure, adapters, etc.). <br><br>  If you want to click on some demo, I made a <a href="https://bit.ly/allure-demo">link</a> .  By clicking on it, you can find out what's new in Allure. <br><br><hr><br>  Artem Eroshenko is preparing an interesting new report especially for <a href="https://heisenbug-moscow.ru/">Heisenbag 2017 Moscow</a> , which will be held in Moscow.  The program is still being formed, but some key reports are <a href="https://habrahabr.ru/company/jugru/blog/332704/">already known</a> .  Detailed information about the event and the conditions of participation are available <a href="https://heisenbug-moscow.ru/">on the</a> conference <a href="https://heisenbug-moscow.ru/">website</a> . </div><p>Source: <a href="https://habr.com/ru/post/337386/">https://habr.com/ru/post/337386/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337370/index.html">Fast Shader for Subsurface Scattering in Unity</a></li>
<li><a href="../337374/index.html">Do not use Lockstep in RTS strategies</a></li>
<li><a href="../337376/index.html">ISDEF conference: we are developing not a product, but a business</a></li>
<li><a href="../337378/index.html">RailsClub 2017: Interview with Richard Schneeman</a></li>
<li><a href="../337382/index.html">User behavior patterns</a></li>
<li><a href="../337388/index.html">New NASH encryption algorithm</a></li>
<li><a href="../337390/index.html">Windows shortcuts: where do they lead and can they be dangerous?</a></li>
<li><a href="../337392/index.html">Metacomputations and deep convolutional networks: an interview with ITMO professor</a></li>
<li><a href="../337394/index.html">iOS development: quick start methods</a></li>
<li><a href="../337398/index.html">We teach the robot to cook pizza. Part 2: Neural Network Contest</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>