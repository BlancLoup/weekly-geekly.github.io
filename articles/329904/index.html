<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to use a token to make a Windows domain safer? Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Email is not just a way to deliver messages today. It can be safely called the most important means of communication, information distribution and man...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to use a token to make a Windows domain safer? Part 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/49c/66e/274/49c66e27466f4e1499e348e5ee1d6f51.jpg" alt="Letter for you"><br><p>  Email is not just a way to deliver messages today.  It can be safely called the most important means of communication, information distribution and management of various processes in business.  But can we always be sure of the correctness and safety of its work? </p><a name="habracut"></a><br><p>  In fact, email vulnerability is a big problem. </p><br><p>  Email is one of the oldest network services.  It appeared in 1982, and at that time security issues on the Internet were not as acute as they are now.  According to Mimecast's research, about 94% of the surveyed companies are completely powerless against e-mail leakage. </p><br><p>  News feeds are regularly filled with messages about hacked e-mails of politicians, athletes, artists and other public people.  Such situations could be avoided, for this you just need to know about the ability to encrypt emails. </p><br><p>  After all, it is inexpensive, and works reliably. </p><br><h2>  What can you do to protect email? </h2><br><p>  In the last article, <a href="https://habrahabr.ru/company/aktiv-company/blog/327232/">‚ÄúHow can I use a token to make a Windows domain safer?</a>  <a href="https://habrahabr.ru/company/aktiv-company/blog/327232/">Part 1 ‚Äù</a> we told you how to configure secure domain login.  They recalled what is two-factor authentication and what are its advantages. </p><br><p>  In this article we will talk about email security. </p><br><p>  Standard mail protocols do not include obvious security mechanisms that would guarantee the authorship of the letters and ensure simple and easy verification.  This situation with the protection of mail systems allows attackers to create letters with fake addresses.  Therefore, one cannot be 100% sure that the person whose data is indicated in the ‚ÄúFrom‚Äù field is really the author of the letter.  Also, the body of an e-mail is easy to change, because there are no means of checking the integrity and when sending through multiple servers, the letter can be read and changed. </p><br><p>  One of the ways to ensure the confidentiality of correspondence is to <b>encrypt</b> messages, and one of the ways to verify the integrity of a letter and establish authorship is by <b>signing</b> it with an <b>electronic signature</b> . </p><br><p>  The encrypted message will be available for reading only to those recipients who have a private key corresponding to the public one, with which the message was encrypted.  Any other recipient will not even be able to open the letter. </p><br><h2>  How does the S / MIME protocol work? </h2><br><p>  <b>S / MIME</b> (Secure / Multipurpose Internet Mail Extensions) protocol provides authentication, message integrity, authorship, and data security. </p><br><p>  S / MIME identifies the holder of the public key using an X.509 certificate. </p><br><p>  S / MIME provides protection against three types of security breaches: </p><br><ul><li>  perusal (opening and viewing letters without the knowledge of the author and the recipient); </li><li>  distortion (change the text of letters); </li><li>  falsification (substitution of letters). </li></ul><br><p>  S / MIME uses a digital signature to protect against mail corruption or tampering.  Having a digital signature ensures that the message has not been changed during the transfer.  In addition, does not allow the sender of the message to give up their authorship. </p><br><p>  However, a digital signature in itself does not guarantee the transfer of messages in a confidential manner.  In S / MIME, this function is encrypted.  Roughly speaking, it is performed using an asymmetric cryptographic algorithm. </p><br><p>  The S / MIME specification defines two types of MIME files: one for digital signatures, the other for message encryption.  Both types are based on the syntax of cryptographic messages of the PKCS # 7 standard. </p><br><p>  If the message must be encrypted, and some attributes must be assigned to the ciphertext, then nested envelopes are used.  The outer and inner envelopes are designed to protect the digital signature, and the intermediate envelope - to protect the ciphertext. </p><br><p>  When working with S / MIME, you must have two keys - open and closed.  The keys are accompanied by a certificate, that is, information about the user, which allows to determine that he is exactly who he claims to be.  The certificate can be compared with some kind of electronic passport, a kind of identity card. </p><br><p>  To send an encrypted message, you must obtain the public key of the recipient of the message and, roughly speaking, encrypt the message using it. </p><br><img src="https://habrastorage.org/web/685/cf9/7cd/685cf97cd9b0416fbb652b5ad8abcbd9.png" alt="Message Encryption Stages"><br><p>  The figure shows the steps for encrypting an email in S / MIME: </p><br><ol><li>  Alice creates a message that she wants to encrypt and send to Bob.  Decides to send it to Bob.  The messaging client, seeing that the letter needs to be encrypted, generates a random encryption key (the private key, which is usually called a session key, then a new random key is generated every time an encrypted message is sent) and encrypts the message with it. </li><li>  The session key is encrypted with the recipient‚Äôs public key and attached to the message, which means that only the Bob‚Äôs private key can decrypt it. </li><li>  The encrypted text and encrypted key are sent to Bob via SMTP (Simple Mail Transfer Protocol). </li><li>  Bob's mail client uses Bob's private key to decrypt the encrypted key and gets the decrypted session key.  Privacy is guaranteed here, because only the Bob private key can be used to decrypt the session key needed to decrypt the message. </li><li>  Bob's mail client uses the decrypted session key to decrypt the mail, the result of which is the decrypted original message that was sent by Alice. </li></ol><br><p>  Encryption does not protect the message from forgery and content changes during transmission.  Therefore, along with encryption to protect the email, you must use an electronic signature. </p><br><img src="https://habrastorage.org/web/5db/e40/765/5dbe40765abc4293813dbd69d82ad993.png" alt="Phases of authentication and forgery detection"><br><p>  The figure shows the steps of authenticating and detecting a fake message using an electronic signature: </p><br><ol><li>  Alice creates the message and signs it electronically.  The mail client, seeing that the message must be signed, generates a hash of Alice's message (the result is the hash d - ‚Äúdigest‚Äù). </li><li>  The hash is signed by the messaging client using Alice's private key.  This means that only her public key will be able to verify the signature on this hash. </li><li>  The signed hash along with the message is sent to Bob. </li><li>  Bob's mail client uses Alice's public key to verify the hash signature and makes sure that the signature on the hash is correct. </li><li>  Bob's mail client computes a new hash based on the text sent by Alice (result in hash d). </li><li>  After that, Bob‚Äôs mail client compares the verified hash and the newly calculated one in step 5. This allows Bob to know if the digital signature is valid.  If the two hashes are the same, then the message actually came from Alice and was not forged during the transfer. </li></ol><br><p>  Microsoft Outlook and other email clients use the S / MIME protocol to encrypt and sign emails.  If the recipient and the sender of the encrypted email are used by different email clients, this does not mean that they will not be able to read each other's encrypted emails.  For example, we consider the process of setting up the Microsoft Outlook email client, as the most common in a corporate environment.  Other email clients can also be used to encrypt and sign messages.  Their setup is generally similar, but there may be nuances. </p><br><h2>  How to set up message protection in Microsoft Outlook using Rutoken EDS PKI? </h2><br><p>  And now for the cause.  Set up <b>encryption</b> and <b>signing letters</b> . </p><br><p>  For example, I will use the device for secure storage of keys and certificates <a href="https://www.rutoken.ru/products/all/rutoken-ecp-pki/">Rutoken EDS PKI</a> . </p><br><img src="https://habrastorage.org/web/ebf/a32/a24/ebfa32a249c54ebba44d392a91bb226b.JPG" alt="Rutoken EDS PKI"><br><br><p>  As keys and certificates appeared on the token, we will not explain in detail.  You can get them in the certification center or create them yourself, as described in one of our past articles. </p><br><p>  To begin with, using the Rutoken panel, save the certificate to the local storage and set its ‚Äúdefault‚Äù parameter. </p><br><p>  On the ‚ÄúCertificates‚Äù tab click on the name of the required certificate, click ‚ÄúDefault‚Äù.  Also check the box in the row with this certificate in the "Registered" column. </p><br><img src="https://habrastorage.org/web/095/56c/3b6/09556c3b6d1a4b5297754783e4e159c4.jpg" alt="Certificates tab"><br><br><p>  In Microsoft Outlook, select the ‚ÄúFile‚Äù menu item and the ‚ÄúParameters‚Äù sub-item. </p><br><p>  Select "Security Control Center" and click "Security Control Center Settings ...". </p><br><img src="https://habrastorage.org/web/c4e/9cb/589/c4e9cb5891544786a9152fe79696ad00.jpg" alt="Security Management Center">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>  Select "Email Protection" and select the necessary checkboxes. </p><br><img src="https://habrastorage.org/web/d58/246/4ed/d582464edc364a8baa74af568982363a.jpg" alt="Email Protection"><br><br><p>  Click "Options". </p><br><p>  Change the configuration name, select the certificates for signing and encryption. </p><br><img src="https://habrastorage.org/web/663/102/2cf/6631022cf8734600b410eb2dc0a29935.jpg" alt="Select certificates for signing and encryption"><br><br><p>  After that, all emails sent using MS Outlook will be automatically encrypted and signed. </p><br><p>  To start the exchange of emails, you must send a certificate to the recipient of the encrypted letter.  To do this, you can send him a letter with a certificate file or an email signed by electronic signature. </p><br><p>  We will send a signed letter. </p><br><p>  To sign a letter with an electronic signature, go to the ‚ÄúSettings‚Äù tab and click ‚ÄúEncryption‚Äù (so that the letter is only signed).  It's simple! </p><br><img src="https://habrastorage.org/web/b73/8e9/f1b/b738e9f1babc4f93ba32c9a35be72b86.jpg" alt="Click Encryption"><br><br><p>  The recipient needs to add you to the Outlook contacts and reply to your email with an encrypted and signed email.  After that, you can exchange encrypted letters with the recipient, and no one except you two can read them. </p><br><p>  Sometimes it is necessary to sign only the file attached to the letter.  This can be done by signing the file itself in one of the popular Microsoft Word or Microsoft Excel applications. </p><br><p>  We will look at the process of signing a file in Microsoft Word. </p><br><h2>  How to sign a file in Microsoft Word? </h2><br><p>  You can protect the file from changes with an electronic signature. </p><br><p>  The public key of the author of the document should be distributed to all users. <br>  which will work with the signed document.  This is usually done by sending a public key certificate to all users in your contact list. </p><br><h3>  How it works? </h3><br><p>  There is a document that must be signed.  Using a special software from the content of the document and the private key creates a unique character sequence.  This sequence is an electronic signature.  It is always unique to this user and this document. </p><br><img src="https://habrastorage.org/web/d85/ef6/7c3/d85ef67c33c446e8858922c78a498c2a.png" alt="Electronic signature"><br><p>  <b>The electronic signature</b> is a document requisite that allows you to establish the fact of distortion of information in an electronic document from the moment the electronic signature was generated and to confirm that it belongs to its owner. </p><br><p>  An electronic signature can be tantamount to a handwritten signature on a paper document, so it is very important that the attacker is unable to deliver the attacker. </p><br><p>  To secure your electronic signature, the private key of the electronic signature must be stored on a token or smart card.  Then your electronic signature will be protected by a PIN, and even in case of theft of a token or smart card, the attacker will not be able to use it. </p><br><p>  For example, let's sign any document in DOCX format. </p><br><p>  I will use the Microsoft Word 2016 application. </p><br><p>  You will need a token or a smart card.  For example, I will use <a href="https://www.rutoken.ru/products/all/rutoken-ecp/">Rutoken EDS 2.0.</a> </p><br><img src="https://habrastorage.org/web/8c2/004/1ba/8c20041ba923469c9708470d36b3b837.JPG" alt="Rutoken EDS 2.0"><br><br><p>  To get started, open the document you want to sign. </p><br><p>  Select "File" and click "Document Protection". </p><br><img src="https://habrastorage.org/web/12a/625/6b5/12a6256b5be549159172edc6ddf1db04.jpg" alt="Click Document Security"><br><br><p>  Select "Add Digital Signature". </p><br><p>  A signature window will open.  It allows you to add personal certificates that will be used when generating a signature.  One of the certificates is selected automatically. </p><br><p>  In the drop-down list, select the type of confirmation and, if necessary, enter the purpose of signing the document. </p><br><p>  Click "Change" and select the required certificate. </p><br><img src="https://habrastorage.org/web/8cc/52e/353/8cc52e35326349a9b089ea74a87a8470.jpg" alt="Choose a certificate"><br><br><p>  After selecting the certificate, click "Sign" and enter the token PIN.  The signature will be saved in the document.  An icon appears in the status bar indicating that the document was created with a signature. </p><br><img src="https://habrastorage.org/web/a5c/568/f64/a5c568f6470444b19169a4da84eb8e2e.jpg" alt="Document created with signature"><br><br><p>  Now, if someone changes the document, he will have to sign it again.  And this means that you will always know who is the author of the latest version of the document.  And you will understand whether your version of the document has been changed. </p><br><p>  This, in turn, will make the exchange of documents more secure and ‚Äútransparent‚Äù. </p><br><h2>  We summarize </h2><br><p>  As a result of the settings you made, you can send messages that will: </p><br><ul><li>  sent by you; </li><li>  read only by selected recipients; </li><li>  protected against changes during transmission; </li><li>  created and signed by you. </li></ul><br><p>  In the next article we will explain what Bitlocker is, how it can protect your information from intruders and how to configure it. </p></div><p>Source: <a href="https://habr.com/ru/post/329904/">https://habr.com/ru/post/329904/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329894/index.html">Reactive Stream Log Processing with RxJava - Part 1</a></li>
<li><a href="../329896/index.html">Recipes for Android: Scroll-To-Dismiss Activity</a></li>
<li><a href="../329898/index.html">Must see: videos of MoscowJS 37 mitap</a></li>
<li><a href="../329900/index.html">Initial setup of Puppet is not as simple as it sounds.</a></li>
<li><a href="../329902/index.html">Routers, attack vectors and other adventures of Shurik</a></li>
<li><a href="../329906/index.html">I want to break free. What and how to learn to escape from 1C</a></li>
<li><a href="../329908/index.html">Visual Studio Mobile Center: Deploy mobile software using Microsoft devops pipeline</a></li>
<li><a href="../329910/index.html">Analysis of changes in the game</a></li>
<li><a href="../329914/index.html">How do i make backups. DBMS FireBird</a></li>
<li><a href="../329916/index.html">5 sources about algorithmic design, if you just started to be interested in them</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>