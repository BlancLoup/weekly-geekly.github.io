<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Selfish gene</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It all started one summer evening, while reading the book of evolutionary biologist Richard Dawkins "God as an illusion." This book is about religion,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Selfish gene</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/eac/d4c/822/eacd4c8223f04eaa98a0c0137f82c521.png" align="left" alt="Picture to attract attention (http://xkcd.com/534/)">  It all started one summer evening, while reading the book of evolutionary biologist <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25BE%25D0%25BA%25D0%25B8%25D0%25BD%25D0%25B7,_%25D0%25A0%25D0%25B8%25D1%2587%25D0%25B0%25D1%2580%25D0%25B4">Richard Dawkins</a> "God as an illusion."  This book is about religion, faith, and atheism, but the author briefly refers to another book, The Selfish Gene, and introduces the concept of the same name.  For a long time, I was fascinated by the elegance of genetic algorithms.  And now, a month later, once again trying to come up with some mini-project, it suddenly dawned on me - what if, with the help of genetic algorithms, to simulate evolution and see what will evolve.  The task is difficult and at this stage of development of IT, I think, unsolvable, so I had to do something simpler.  Namely, test the hypothesis of the selfish gene.  Interested, please under the cat ... <br><a name="habracut"></a><br>  To begin with, we will define the standard representation of evolution.  According to <a href="https://ru.wikipedia.org/wiki/%25D0%25AD%25D0%25B2%25D0%25BE%25D0%25BB%25D1%258E%25D1%2586%25D0%25B8%25D1%258F">Wikipedia</a> : "Biological evolution is a natural process of the development of wildlife, accompanied by a change in the genetic composition of populations, the formation of adaptations, speciation and extinction of species, the transformation of ecosystems and the biosphere as a whole."  And what is important, the unit of evolution is the population.  Richard Dawkins put forward the theory that the unit of evolution is not the population of individuals of any species, but the gene itself (therefore, it is called selfish).  And the ‚Äúpurpose‚Äù of a gene is not to adapt an individual to environmental conditions (so that it survives and gives birth to offspring), but to do everything so that the gene itself ‚Äúsurvives‚Äù.  Another view on this issue is genetic algorithms in programming - in them the "unit of evolution" is recognized as a separate individual. <br><br><div class="spoiler">  <b class="spoiler_title">Denial of responsibility</b> <div class="spoiler_text">  <i>I want to note that my knowledge of biology and evolution is limited to the school course and popular science films, so that if there are errors in the text, please unsubscribe in the comments or in the PM.</i> <br></div></div><br>  Thus, it is possible to investigate (and model) which genes will prevail in the gene pool of any population: <br><br><ol><li>  Those that benefit the whole population; </li><li>  Those [genes] that benefit the relatives of the current individual (since it is relatives who are more likely to ‚Äústore‚Äù the same genes); </li><li>  Those that benefit only the current individual. </li></ol><br><hr><br>  For the simulation developed a program on C # 6 and. NET 4.6. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The data model in the program is quite simple.  We have the World and Creature classes and a couple of Relation and Gene auxiliary enumerations.  There is also a class Statistic, encapsulating in itself the necessary data on the state of the world at a certain iteration. <br><br><div class="spoiler">  <b class="spoiler_title">World</b> <div class="spoiler_text">  <i>Hereinafter, only basic code cuts are given.</i>  <i>All the code is laid out on the githab by the link at the end of the article.</i> <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">World</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> List&lt;Creature&gt;[] Species = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Creature&gt;[<span class="hljs-number"><span class="hljs-number">8</span></span>]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> generations</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; generations; i++, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.age = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Age + <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SelectBest(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.MakeChildren(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Mutate(); Debug.Print(<span class="hljs-string"><span class="hljs-string">"Age: {0}"</span></span>, i); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SelectBest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> allCreatures = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Creature&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Species.Sum(kind =&gt; kind.Count)); allCreatures.AddRange(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Species.SelectMany(kind =&gt; kind)); allCreatures = allCreatures.OrderByDescending(creature =&gt; creature.SummaryStrength).Take(allCreatures.Count &gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>).ToList(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Species.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Species[i].ForEach(creature =&gt; creature.BreakRedundantConnections()); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Species[i].Clear(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Species[i].AddRange(allCreatures.Where(creature =&gt; creature.IdOfSpecies == i)); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MakeChildren</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Parallel.For( <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Species.Length, i =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> temp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Creature&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Species[i].Count &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Random parents (of same species) - for supporting different genes this.Species[i].Shuffle(); Random rnd = RandomProvider.GetThreadRandom(); for (int j = 1; j &lt; this.Species[i].Count; j += 2) { double value = rnd.NextDouble(); if (value &lt; 0.33) { temp.Add(new Creature(this.Species[i][j - 1], this.Species[i][j])); temp.Add(new Creature(this.Species[i][j - 1], this.Species[i][j])); temp.Add(new Creature(this.Species[i][j - 1], this.Species[i][j])); } else if (value &lt; 0.665) { temp.Add(new Creature(this.Species[i][j - 1], this.Species[i][j])); temp.Add(new Creature(this.Species[i][j - 1], this.Species[i][j])); temp.Add(new Creature(this.Species[i][j - 1], this.Species[i][j])); temp.Add(new Creature(this.Species[i][j - 1], this.Species[i][j])); } else { temp.Add(new Creature(this.Species[i][j - 1], this.Species[i][j])); temp.Add(new Creature(this.Species[i][j - 1], this.Species[i][j])); temp.Add(new Creature(this.Species[i][j - 1], this.Species[i][j])); temp.Add(new Creature(this.Species[i][j - 1], this.Species[i][j])); temp.Add(new Creature(this.Species[i][j - 1], this.Species[i][j])); } } this.Species[i].ForEach(creature =&gt; creature.BreakRedundantConnections()); this.Species[i].Clear(); this.Species[i] = temp; }); } private void Mutate() { Parallel.ForEach(this.Species, list =&gt; list.ForEach(creature =&gt; creature.Mutate())); } }</span></span></code> </pre> <br></div></div><br>  World contains only one public Run method, which performs a specified number of iterations of the ‚Äúmodeling the world‚Äù, which includes selecting the best individuals, creating their offspring and then introducing mutations into their [offspring] genes.  In the world there are 8 species.  Initially, in each of them 1024 individuals.  Several species are present in order: first, to simulate a race between species (a battle for survival);  secondly, to reduce the probability of finding a local maximum. <br><br>  The fitness function in this experiment is simple - each creature has a certain ‚ÄúStrength‚Äù parameter;  the higher it is, the more adapted the creature to survive in a simulated world.  The world ("environment") is static.  Of all the creatures selected 50% of the fittest. <br>  The child generation is created on the basis of the ‚Äúsurviving‚Äù individuals of the parent generation.  Individuals of the parent generation are selected by random pairs (from the same species), on the basis of whose genes daughters are created.  At the same time, with a probability of 33%, 3 individuals will be created, 33.5% - 4 individuals and 33.5% - 5 individuals.  Thus, the number of individuals will slowly grow from generation to generation.  In my simulation, the number of individuals in the world increased from 8.192 to ~ 30.000 in 1024 iterations. <br><br>  Mutations are simply applied to all newly created individuals. <br><br><div class="spoiler">  <b class="spoiler_title">Enums</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Gene : <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> { SelfishGene = <span class="hljs-number"><span class="hljs-number">1</span></span>, AltruisticGene = <span class="hljs-number"><span class="hljs-number">2</span></span>, CreatureLevelGene = <span class="hljs-number"><span class="hljs-number">4</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Relation { Child, BrotherOrSister, GrandChild, NephewOrNiece, Cousin }</code> </pre><br></div></div><br>  Genes are simply represented by listing three values. <br><br>  Relatives influenced by genes are represented by five values.  The limitations were as follows: the similarity of genes with the genes of a relative should not be less than 10%, individuals of older generations can help individuals of this or younger generations (since each individual (generation) participates in the selection in this simulation only once), individuals of generation n can help individuals of a generation not larger than n + 2 (I suppose this is some average real assumption for humans and some other mammals). <br><br><div class="spoiler">  <b class="spoiler_title">Creature</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Creature</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> GeneStrength = <span class="hljs-number"><span class="hljs-number">128</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Gene[] genes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Gene[<span class="hljs-number"><span class="hljs-number">128</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> List&lt;Creature&gt; childs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Creature&gt;(<span class="hljs-number"><span class="hljs-number">8</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Creature mother; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Creature father; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Creature</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> idOfSpecies, World world</span></span></span><span class="hljs-function">)</span></span> { Contract.Requires&lt;ArgumentNullException&gt;(world != <span class="hljs-literal"><span class="hljs-literal">null</span></span>); Contract.Ensures(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IdOfSpecies == idOfSpecies); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IdOfSpecies = idOfSpecies; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.world = world; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.genes.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.genes[i] = EnumHelper.CreateRandomGene(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Creature</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Creature mommy, Creature daddy</span></span></span><span class="hljs-function">)</span></span> { Debug.Assert(mommy.IdOfSpecies == daddy.IdOfSpecies, <span class="hljs-string"><span class="hljs-string">"Interspecies relation are FORBIDDEN!!!"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mother = mommy; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.father = daddy; mommy.childs.Add(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); daddy.childs.Add(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.world = mommy.world; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IdOfSpecies = mommy.IdOfSpecies; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.genes.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.genes[i] = EnumHelper.ChooseRandomGene(mommy.genes[i], daddy.genes[i]); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SummaryStrength { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> sum = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; World world = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.world; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> cacheKey = <span class="hljs-string"><span class="hljs-string">$"AltruisticGenesOutStrength</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.IdOfSpecies}</span></span></span><span class="hljs-string">"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> cachedValue = Cache.Get(cacheKey, world.Age); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cachedValue != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { sum = (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)cachedValue; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; world.Species[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IdOfSpecies].Count; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (world.Species[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IdOfSpecies][i] != <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) { sum += world.Species[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IdOfSpecies][i].AltruisticGenesOutStrength; } } Cache.Put(cacheKey, world.Age, sum); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ThisCreatureGenesStrength + (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)sum + (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.HelpFromRelations; } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ThisCreatureGenesStrength =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.genes.Sum(g =&gt; g == Gene.CreatureLevelGene ? GeneStrength : GeneStrength &gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> AltruisticGenesOutStrength { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.genes.Length; i++) { Gene gene = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.genes[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gene == Gene.AltruisticGene) { sum += GeneStrength &gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)sum / (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.world.Species[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IdOfSpecies].Count - <span class="hljs-number"><span class="hljs-number">1</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> HelpFromRelations { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { Creature mommy = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mother; Creature daddy = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.father; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mommy == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mommy.mother == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mommy.GetSelfishGenesOutStrength(Relation.Child) + daddy.GetSelfishGenesOutStrength(Relation.Child) + mommy.childs.Sum( brother =&gt; brother == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> ? <span class="hljs-number"><span class="hljs-number">0</span></span> : brother.GetSelfishGenesOutStrength(Relation.BrotherOrSister)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mommy.GetSelfishGenesOutStrength(Relation.Child) + daddy.GetSelfishGenesOutStrength(Relation.Child) + mommy.childs.Sum( brother =&gt; brother == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> ? <span class="hljs-number"><span class="hljs-number">0</span></span> : brother.GetSelfishGenesOutStrength(Relation.BrotherOrSister)) + mommy.mother.GetSelfishGenesOutStrength(Relation.GrandChild) + mommy.father.GetSelfishGenesOutStrength(Relation.GrandChild) + daddy.mother.GetSelfishGenesOutStrength(Relation.GrandChild) + daddy.father.GetSelfishGenesOutStrength(Relation.GrandChild) + mommy.mother.childs.Sum( aunt =&gt; aunt == mommy ? <span class="hljs-number"><span class="hljs-number">0</span></span> : aunt.GetSelfishGenesOutStrength(Relation.NephewOrNiece)) + daddy.mother.childs.Sum( uncle =&gt; uncle == daddy ? <span class="hljs-number"><span class="hljs-number">0</span></span> : uncle.GetSelfishGenesOutStrength(Relation.NephewOrNiece)) + mommy.mother.childs.Sum( aunt =&gt; aunt == mommy ? <span class="hljs-number"><span class="hljs-number">0</span></span> : aunt.childs.Sum(cousin =&gt; cousin.GetSelfishGenesOutStrength(Relation.Cousin))) + daddy.mother.childs.Sum( uncle =&gt; uncle == daddy ? <span class="hljs-number"><span class="hljs-number">0</span></span> : uncle.childs.Sum(cousin =&gt; cousin.GetSelfishGenesOutStrength(Relation.Cousin))); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Mutate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Tries to change 6 genes with 50% probability int length = this.genes.Length; int rnd = RandomProvider.GetThreadRandom().Next(length &lt;&lt; 1); int limit = Math.Min(length, rnd + 6); for (; rnd &lt; limit; rnd++) { this.genes[rnd] = EnumHelper.CreateRandomGene(); } } public void BreakRedundantConnections() { Creature mommy = this.mother; Creature daddy = this.father; if (mommy?.mother?.mother != null) { mommy.mother.mother?.childs.Clear(); mommy.mother.mother = null; mommy.mother.father?.childs.Clear(); mommy.mother.father = null; mommy.father.mother?.childs.Clear(); mommy.father.mother = null; mommy.father.father?.childs.Clear(); mommy.father.father = null; daddy.mother.mother?.childs.Clear(); daddy.mother.mother = null; daddy.mother.father?.childs.Clear(); daddy.mother.father = null; daddy.father.mother?.childs.Clear(); daddy.father.mother = null; daddy.father.father?.childs.Clear(); daddy.father.father = null; } } private double GetSelfishGenesOutStrength(Relation whoAreYou) { Creature mommy = this.mother; Creature daddy = this.father; int summarySelfishStrength = this.genes.Sum(g =&gt; g == Gene.SelfishGene ? GeneStrength &gt;&gt; 1 : 0); switch (whoAreYou) { case Relation.Child: return summarySelfishStrength / this.childs.Count * 30.78; case Relation.BrotherOrSister: Debug.Assert(mommy.childs.Count &gt; 1, "LIER! He is not our brother!"); return summarySelfishStrength / (mommy.childs.Count - 1) * 30.78; case Relation.GrandChild: return summarySelfishStrength / this.childs.Sum(creature =&gt; creature.childs.Count) * 15.38; case Relation.NephewOrNiece: Debug.Assert(mommy.childs.Count &gt; 1, "LIER! We don't have any brothers!"); return summarySelfishStrength / mommy.childs.Sum(brother =&gt; brother == this ? 0 : brother.childs.Count) * 15.38; case Relation.Cousin: return summarySelfishStrength / (mommy.mother.childs.Sum(aunt =&gt; aunt == mommy ? 0 : aunt.childs.Count) + daddy.mother.childs.Sum(uncle =&gt; uncle == daddy ? 0 : uncle.childs.Count)) * 7.68; default: throw new NotImplementedException("Unknown enum value"); } } }</span></span></code> </pre><br></div></div><br>  Each individual contains exactly 128 genes.  For individuals of the zero generation, genes are selected randomly.  Individuals of each next generation take random genes from their parents.  Each gene has a basic power of 128. The genes act as follows: <br><ol><li>  AltruisticGene - 50% of the gene's strength goes ‚Äúin the piggy bank‚Äù of a gene carrier, the remaining 50% is divided equally among all creatures of this species; </li><li>  CreatureLevelGene - all 100% of the gene's power goes ‚Äúto the piggy bank‚Äù of the creature carrier; </li><li>  SelfishGene - 50% of the gene's strength goes ‚Äúto the piggy bank‚Äù of the gene carrier, the remaining 50% is divided between the relatives of this individual in the following ratio: children receive 15.39% of power, siblings and sisters - the same amount, grandchildren - 7.69%, nephews - 7.69 % and cousins ‚Äã‚Äã- 3.84% of gene power. </li></ol><br><div class="spoiler">  <b class="spoiler_title">The ratios are related to the likelihood of the presence of the same genes in relatives:</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/d33/21d/dc9/d3321ddc990b49cdb31d391cec1509a4.png" alt="probabilities"><br></div></div><br>  A mutation with a probability of 50% changes 4 genes. <br><br>  The last interesting method is BreakRedundantConnections.  To allow the garbage collector to collect memory, it is necessary to remove references to parents when they are no longer needed (the difference in generations is more than two). <br><br><div class="spoiler">  <b class="spoiler_title">Memory leak</b> <div class="spoiler_text">  <i>At this stage a funny memory leak was obtained.</i>  <i>In theory, the GC should collect all the objects in the heap that it cannot reach, since it works according to the algorithm for traversing the object graph.</i>  <i>For this, it was enough for the child generations to set in null the links to the parents (since this is the only place where the links to the (outdated) creatures are stored).</i>  <i>However, this did not work, and I also had to clear the array of references to the children of the parents.</i>  <i>I can not say what is the reason for this behavior: I do not want to believe that this is a .NET bug.</i>  <i>Most likely, I don‚Äôt know something or I‚Äôve been naughty with LINQ and the helper classes it creates.</i> <br></div></div><br><hr><br>  The program runs 1024 iterations in ~ 20 minutes (on a laptop with an Intel Core i7 2.4 GHz processor), consuming up to 50 MB of RAM.  On average, one iteration takes 1 second.  The number of individuals at each iteration ranges from ~ 10,000 to ~ 30,000.  For the entire simulation, about 20,000,000 individuals and 2,500,000,000 gene are calculated. <br><br>  68% of existing genes are selfish genes.  Equally (16% each) of absolutely good genes and genes that benefit only carrier individuals.  To this ratio came on the 89th generation.  At the 201st generation, only one species remained (which took the lead only in the 9th generation (the first from which statistics were taken)). <br><br><div class="spoiler">  <b class="spoiler_title">Awful unaesthetic screenshots</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/237/21e/97b/23721e97bdd84dc5a83e380661428dd7.PNG"><br>  ... <br><img src="https://habrastorage.org/files/883/39f/bb4/88339fbb468540e3861eedd14b281591.PNG"><br><br><img src="https://habrastorage.org/files/065/63f/255/06563f2554ea4096a4f6379c6ab81b3e.PNG"><br>  ... <br><img src="https://habrastorage.org/files/ccc/81d/402/ccc81d402f99444ca2590d1a598f744a.PNG"><br></div></div><br>  Which can from this try to draw conclusions: <br><br><ol><li>  <b>We are genetically programmed to help relatives;</b> </li><li>  One of the properties of evolution is that it is not accidental.  This is the law.  On any planet in the universe on which there is a simple life and the carrier of genetic information will evolve as well as on Earth.  No matter how much we run the simulation, we get the same results.  That is a small confirmation of this.  In fact, this is a confirmation that an optimized brute force (called the genetic algorithm) finds some maximum of a certain function.  But evolution does the same thing! </li><li>  Perhaps, it is worthwhile to think about the future, when using genetic algorithms for solving real problems, to take into account this feature of evolution. </li></ol><br><hr><br>  Sources are available (under the free CC 4.0 license) on <a href="https://github.com/zzz77/GeneticSimulation">github</a> . <br><br>  I will be glad to constructive criticism.  If you have questions - please ask in the comments. <br><br>  <b>Thank you all for your attention!</b> <br><br><div class="spoiler">  <b class="spoiler_title">If you are interested in this article</b> <div class="spoiler_text">  <i>PS In anticipation of the delivery of the book ‚ÄúThe Selfish Gene‚Äù, the next version is planned (programs and / or articles) with the following changes: increased productivity (at the moment there are several highly non-optimized sections in the code, as well as furious memory traffic), removal of more statistical data and their visualization, perhaps the release of a (probably next) mini-framework for simulating processes using genetic algorithms and a more precise determination of how good we are.</i>  <i>Also, if you have any wishes (more accurate modeling of natural selection, genetic algorithms applied to memes, but not genes, a study of the advantages / disadvantages of polygamy / monogamy, genetic modeling of the parameters of another genetic modeling ...), please unsubscribe in comments.</i> <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/267399/">https://habr.com/ru/post/267399/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267387/index.html">Local number formatting speed</a></li>
<li><a href="../267389/index.html">Java collections: what many people forget</a></li>
<li><a href="../267391/index.html">Droidcon Moscow 2015: already this Friday</a></li>
<li><a href="../267393/index.html">Application and Desktop Virtualization: A New Look at Old Issues</a></li>
<li><a href="../267395/index.html">Advantageous replacement with tiring arrays: review and tests of the HP 3PAR 7400 full-flash hardware</a></li>
<li><a href="../267401/index.html">Spectral method on the example of simple problems of mathematical physics</a></li>
<li><a href="../267403/index.html">High Frequency Trading: A Guide from the Hero of the Flash Boys</a></li>
<li><a href="../267405/index.html">History how we want to make our world a little bit better</a></li>
<li><a href="../267407/index.html">I am a developer, but this is not my passion</a></li>
<li><a href="../267409/index.html">Checklist for creative processes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>