<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work automation in nanoCAD using Visual Basic for Applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article describes one of the options for automating the work of designers in the CAD system nanoCAD, which allows to use to a large extent the par...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work automation in nanoCAD using Visual Basic for Applications</h1><div class="post__text post__text-html js-mediator-article">  The article describes one of the options for automating the work of designers in the CAD system nanoCAD, which allows to use to a large extent the parameterization of constructions and reduce the time for performing various tasks. <br><br><img src="https://habrastorage.org/files/591/393/23e/59139323e2de450c979d0a753e5e0984.jpg"><br><br>  Many designers use MS Excel to perform mathematical calculations in tabular form.  However, the functionality of the program is not limited to this.  Using the Visual Basic for Applications (VBA) programming language integrated into Microsoft Office products, you can interact with the nanoCAD object model (and other products on its platform).  In this article, we will demonstrate this possibility using a simple and universal example - we will create and adjust layers, draw a rectangle, dimension it and add text containing the figure area value. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The example uses MS Excel 2010 and nanoCAD 5.0, but the software version does not really matter. <br><br>  First you need to start Excel and prepare the data for building: <br><br><img src="https://habrastorage.org/files/76e/d33/79b/76ed3379b9a944b8b85b100fe4e38a3f.PNG"><br><br>  The data in cells B1 and B2 are written with a prime number, but they can be calculated using the formula.  Now you need to switch to the Excel system for developing and debugging code embedded in Excel - press Alt + F11.  The development environment window appears: <br><br><img src="https://habrastorage.org/files/d7e/b76/251/d7eb7625154e4c8ab153b57d21bb3be0.PNG"><br><br>  For the convenience of debugging the code, you need to connect certain libraries: in the Tools menu, select the References ... item and connect nanoCAD Type Library (NCAuto.dll) and OdaX Type Library (OdaX_csd.dll).  By default, both libraries are located in the folder: C: \ Program Files \ Nanosoft \ nanoCAD 5.0 ‚Äã‚Äã\ bin \. <br><br>  Now you need to create a module.  Right click in the project tree on the folder Microsoft Excel Objects, in the drop-down list select Insert - Module: <br><br><img src="https://habrastorage.org/files/17f/07d/800/17f07d80016d4a63b873eb8b990aaa52.png"><br><br>  In the window that appears, prepare the basis for the future program: <br><pre><code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Option</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Explicit</span></span> <span class="hljs-comment"><span class="hljs-comment">'       Public app As nanoCAD.Application '   nanoCAD Public ThisDrawing As nanoCAD.Document ' ,     nanoCAD Sub my_drawing() '   Set app = GetObject("", "nanoCAD.Application") '  nanoCAD app.Visible = True '    nanoCAD Set ThisDrawing = app.ActiveDocument '   ,   nanoCAD</span></span></code> </pre> <br>  After explicitly declaring variables, it becomes much more convenient to work with them: just enter the name of the variable, put a full stop and the program will prompt all parameters and methods related to the object of this type. <br>  Text after the apostrophe - comments to the code. <br>  We declare the variables with the parameters of the future shape and assign them the values: <br><pre> <code class="vbscript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> r_height As Double, r_width As Double <span class="hljs-comment"><span class="hljs-comment">',     r_height = Range("B1").Value '  r_width = Range("B2").Value ' </span></span></code> </pre><br>  Create a new layer, assign a thickness and color to it: <br><pre> <code class="vbscript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> layer As AcadLayer <span class="hljs-comment"><span class="hljs-comment">'  "" Set layer = ThisDrawing.Layers.Add(" ") '   layer.Color = 21 '-  layer.LineWeight = acLnWt050 '  0.50  ThisDrawing.ActiveLayer = layer '    </span></span></code> </pre><br>  We offer the user to choose the object insertion coordinates: <br><pre> <code class="vbscript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> insert_point() As Double <span class="hljs-comment"><span class="hljs-comment">' ,     insert_point = ThisDrawing.Utility.GetPoint("0,0,0", "   ") '   insert_point(0)   X,    , '  insert_point(1)   Y,    insert_point(2) -  Z</span></span></code> </pre><br>  Constructing a rectangle consisting of four segments: <br><pre> <code class="vbscript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> x1 As Double, x2 As Double, y1 As Double, y2 As Double x1 = insert_point(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment">'     x2 = x1 + r_width '     y1 = insert_point(1) '     y2 = y1 + r_height '     Dim pt1(2) As Double, pt2(2) As Double, pt3(2) As Double, pt4(2) As Double ' 4  ,        pt1(0) = x1 '    pt1(1) = y1 '    pt2(0) = x2 '    pt2(1) = y1 '    pt3(0) = x2 '    pt3(1) = y2 '    pt4(0) = x1 '    pt4(1) = y2 '    Dim obj As AcadLine '  "" Set obj = ThisDrawing.ModelSpace.AddLine(pt1, pt2) '   Set obj = ThisDrawing.ModelSpace.AddLine(pt2, pt3) '   Set obj = ThisDrawing.ModelSpace.AddLine(pt3, pt4) '   Set obj = ThisDrawing.ModelSpace.AddLine(pt4, pt1) '  </span></span></code> </pre><br>  Dimensioning: <br><pre> <code class="vbscript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> pt5(<span class="hljs-number"><span class="hljs-number">2</span></span>) As Double, pt6(<span class="hljs-number"><span class="hljs-number">2</span></span>) As Double pt5(<span class="hljs-number"><span class="hljs-number">0</span></span>) = (x1 + x2) / <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-comment"><span class="hljs-comment">'    pt5(1) = y1 - 500 '    pt6(0) = x2 + 500 '    pt6(1) = (y1 + y2) / 2 '    Dim dimrot As AcadDimRotated '  " " Set dimrot = ThisDrawing.ModelSpace.AddDimRotated(pt1, pt2, pt5, 0) '   Set dimrot = ThisDrawing.ModelSpace.AddDimRotated(pt2, pt3, pt6, 3.1416 / 2) '   '         </span></span></code> </pre><br>  Calculate the area of ‚Äã‚Äãthe shape and paste the mtext into the center of the rectangle: <br><pre> <code class="vbscript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> pt7(<span class="hljs-number"><span class="hljs-number">2</span></span>) As Double pt7(<span class="hljs-number"><span class="hljs-number">0</span></span>) = (x1 + x2) / <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-comment"><span class="hljs-comment">'   pt7(1) = (y1 + y2) / 2 '   Dim txt As AcadMText '  "" Set txt = ThisDrawing.ModelSpace.AddMText(pt7, 3000, CStr((x2 - x1) * (y2 - y1) / 1000000)) '    ,   ‚Äì   txt.AttachmentPoint = acAttachmentPointMiddleCenter '   ""  "  "</span></span></code> </pre><br>  Completion of the basic function: <br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span></code> </pre><br>  To run a written program, just press F5 (after that, do not forget to specify the insertion point in nanoCAD).  The result of the program is shown in the picture: <br><br><img src="https://habrastorage.org/files/81e/b35/ada/81eb35ada1df4f6dbede1ef0d48bd1d7.PNG"><br><br>  The example demonstrates the ability to create basic primitives.  More information on the nanoCAD object model can be found on the Internet, in particular, on the websites: <a href="http://vbamodel.narod.ru/">vbamodel.narod.ru</a> and <a href="http://www.alex160570.narod.ru/AcadVBA/vba01.htm">www.alex160570.narod.ru/AcadVBA/vba01.htm</a> <br><br>  It is worth noting that to write so many lines of the same type of code in order to build one line, is laborious and boring, there is a high probability of making mistakes.  For more convenience, you can create custom functions for constructing individual primitives.  As an example, consider the function of constructing a segment.  The function receives as parameters the X and Y coordinates of the beginning and end of the segment and builds it: <br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span> my_line(x1 As Double, y1 As Double, x2 As Double, y2 As Double) <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> pt1(<span class="hljs-number"><span class="hljs-number">2</span></span>) As Double, pt2(<span class="hljs-number"><span class="hljs-number">2</span></span>) As Double pt1(<span class="hljs-number"><span class="hljs-number">0</span></span>) = x1 <span class="hljs-comment"><span class="hljs-comment">'    pt1(1) = y1 '    pt2(0) = x2 '    pt2(1) = y2 '    Dim obj As AcadLine Set obj = ThisDrawing.ModelSpace.AddLine(pt1, pt2) '       End Sub</span></span></code> </pre><br>  Additional user functions must be located after the base function, i.e.  after the End Sub line related to the base function. <br>  Now you can use abbreviated code to build a rectangle: <br><pre> <code class="vbscript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> x1 As Double, x2 As Double, y1 As Double, y2 As Double x1 = insert_point(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment">'     x2 = x1 + r_width '     y1 = insert_point(1) '     y2 = y1 + r_height '     my_line x1, y1, x2, y1 '   my_line x2, y1, x2, y2 '   my_line x2, y2, x1, y2 '   my_line x1, y2, x1, y1 '  </span></span></code> </pre><br>  Similar user-defined functions can be written for any tasks that need to be performed more than once.  At the same time, there are many operators available to the user, such as If ... Then ... Else, For ... Next, Do ... Loop, etc.  For those users who are just familiar with programming, it will not be difficult to understand the possibilities of the language - for this there is help and numerous websites with examples of solved problems. <br><br>  For the convenience of launching the created program, you can place the button directly on the Excel sheet.  To do this, on the ‚ÄúDeveloper‚Äù tab, select ‚ÄúInsert‚Äù - ‚ÄúForm control‚Äù - ‚ÄúButton‚Äù: <br><br><img src="https://habrastorage.org/files/751/f25/6de/751f256ded74412888ed5cb9086a5e6a.png"><br><br>  In the window that appears, select our basic function, then place the button on the sheet. <br><br><img src="https://habrastorage.org/files/948/4fe/25b/9484fe25b9c94ea0aac2c47fd0bff5b1.png"><br><br><img src="https://habrastorage.org/files/7ef/928/341/7ef92834103e4e93a7ee5103a08676d5.PNG"><br><br>  In one module, you can add any number of functions, create a button for each function and run them all from one place. <br><br>  Sometimes there is a need to simulate the introduction of some commands in the command line.  To do this, you can use the following structure: <br><br><pre> <code class="vbscript hljs"> ThisDrawing.SendCommand <span class="hljs-string"><span class="hljs-string">"CIRCLE"</span></span> &amp; vbCr &amp; <span class="hljs-string"><span class="hljs-string">"100,100,0"</span></span> &amp; vbCr &amp; <span class="hljs-string"><span class="hljs-string">"1000"</span></span> &amp; vbCr</code> </pre><br>  This command will build a circle centered at point X: 100, Y: 100, Z: 0 with a radius of 1000 drawing units. <br><br>  To debug created programs, you can display data in the form of pop-up windows or in the command line nanoCAD.  After executing the following code: <br><br><pre> <code class="vbscript hljs"> <span class="hljs-built_in"><span class="hljs-built_in">MsgBox</span></span> <span class="hljs-string"><span class="hljs-string">"x1: "</span></span> &amp; x1</code> </pre><br>  A dialog box appears with the value of the variable x1: <br><br><img src="https://habrastorage.org/files/e61/ed6/855/e61ed685501442f0b0e8a71991d4eba4.PNG"><br><br>  To display the text in the command line nanoCAD, you can use the following code: <br><br><pre> <code class="vbscript hljs"> ThisDrawing.Utility.Prompt <span class="hljs-string"><span class="hljs-string">"x1: "</span></span> &amp; x1 &amp; <span class="hljs-string"><span class="hljs-string">" y1: "</span></span> &amp; y1</code> </pre><br>  On the basis of this approach, we have developed a program for automating the construction of developments of monolithic reinforced concrete walls.  After setting the initial data (about 30 parameters), at the output we get a practically finished drawing of the wall, taking into account the actual geometry, the presence of openings, and the adjoining of other walls: <br><br><img src="https://habrastorage.org/files/8b2/792/6a5/8b27926a5de3475da1bd12a7da8a19e0.PNG"><br><br>  Such an approach to work allows not only to reduce the time for preparing documentation in dozens, if not hundreds, of times, but also to completely eliminate the need for checking it. <br><br>  In this article, we described how to build new primitives.  But the nanoCAD object model allows editing the primitives existing in the drawing, including the nanoCAD DPS objects ‚Äî the next article will be devoted to this. <br><br>  <b>Dmitry Rudenko</b> , Chief Project Engineer, Fordevind Project Bureau <br><br>  Update (2014-10-06): <br>  Video demonstrating the work of such a script: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/0F_EozaZ4DM%3Ffeature%3Doembed&amp;xid=17259,15700019,15700186,15700191,15700253&amp;usg=ALkJrhiD16wPPazqCzEmduGINTnNWuUazg" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/238867/">https://habr.com/ru/post/238867/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../238857/index.html">FUJITSU against all or Japanese killer RISC servers</a></li>
<li><a href="../238859/index.html">For the protection of airports in the Netherlands created a bird-robots</a></li>
<li><a href="../238861/index.html">How search engines rely on behavioral data when ranking (for example, Google)</a></li>
<li><a href="../238863/index.html">Meet the user environment management system, Norskale VUEM</a></li>
<li><a href="../238865/index.html">Open lecture on the basics of Swift from MasterUp</a></li>
<li><a href="../238869/index.html">Happy Birthday, Nokia 3310</a></li>
<li><a href="../238875/index.html">What is the "understandable Russian language" in terms of technology. Let's look at the text readability metrics</a></li>
<li><a href="../238877/index.html">Polls on the site: How to interpret the results</a></li>
<li><a href="../238879/index.html">Curry on C ++</a></li>
<li><a href="../238883/index.html">How to help software in the Russian Federation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>