<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>L√ñVE + Android + AdMob = friendship</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One day, there was a desire to learn Lua for its modest needs. But just reading the specifications and examples is not interesting, and for a long tim...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>L√ñVE + Android + AdMob = friendship</h1><div class="post__text post__text-html js-mediator-article">  One day, there was a desire to learn <a href="http://ru.wikipedia.org/wiki/Lua">Lua</a> for its modest needs.  But just reading the specifications and examples is not interesting, and for a long time there was an idea to write your logical game for Android, the search for a suitable framework for comfortable work began. <br><a name="habracut"></a><br>  After a brief viewing of Google, 2 main candidates stood out: <a href="http://coronalabs.com/products/corona-sdk/">Corona SDK</a> and <a href="http://love2d.org/">L√ñVE</a> .  Corona SDK has, from my point of view, undoubted advantages: support, good documentation, easy integration of various shops / advertisements / social networks (underline the necessary).  Despite this, the SDK itself is paid, there is no version for Linux.  Starter version has a number of limitations. <br><br>  After the Corona SDK, I took a close look at L√ñVE.  The first thing bribed the inscription on the start page: <br><blockquote>  It's free, open source, and works on Windows, Mac OS X and Linux. </blockquote><br><blockquote>  L√ñVE is licensed under the liberal <a href="http://opensource.org/licenses/zlib-license.php">zlib / libpng license</a> .  It can be used for commercial purposes. </blockquote><br><br>  There is quite good documentation even in Russian.  The framefork is easy to install.  How to write a game using L√ñVE user <a href="http://habrahabr.ru/users/yegorf1/" class="user_link">yegorf1</a> wrote <a href="http://habrahabr.ru/post/202540/">here</a> and continued <a href="http://habrahabr.ru/post/203082/">here</a> .  So, slowly studying the possibilities of the framework, I wrote a prototype of my application.  And here the fun began. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Question number 1 </h5><br>  How to run the application under the android, to finally check your "miracle" on your favorite smartphone? <br>  Finding the answer to this question led me to the <a href="https://bitbucket.org/MartinFelis/love-android-sdl2/overview">love-android-sdl2 project</a> , developed by <a href="https://bitbucket.org/MartinFelis">Martin Felis</a> .  As the author writes, the project is a port of L√ñVE for android.  In fact, this is a Lua port on <a href="http://habrahabr.ru/post/189924/">SDL 2.0 for Android</a> . <br><ol><li>  We pack our application in a zip-archive and rename it to game.love </li><li>  We copy the archive into the assets folder of the project. </li><li>  We assemble the .apk file according to the instructions for <a href="https://bitbucket.org/MartinFelis/love-android-sdl2/wiki/Building_L%25C3%2596VE_for_Android_-_Linux">Linux</a> , <a href="https://bitbucket.org/MartinFelis/love-android-sdl2/wiki/Building_L%25C3%2596VE_for_Android_-_Windows">Windows</a> , <a href="https://bitbucket.org/MartinFelis/love-android-sdl2/wiki/Building_L%25C3%2596VE_for_Android_-_Mac_OS_X">Mac OS X.</a>  The process is described in detail by the author, if briefly describe it, then these are a few steps: <br><ol><li>  Install Android SDK, Android NDK </li><li>  Installing Android SDK Platoform-tools, Android SDK Built-tools, Android 4.4.2 (API 19) and the Android Support Library via SDK Manager </li><li>  Run the build in the project directory.  First ndk-build, then ant debug. </li></ol></li></ol><br>  At the output we have a .apk-file, which can be poured into the phone and finally tested!  How to collect the release and sign it, you can read in detail <a href="http://developer.android.com/tools/building/building-cmdline.html">here</a> . <br>  So, the answer to the first question is received.  Of course, to make a quick or very economical application is unlikely to work, but for rapid prototyping on Lua or a lightweight game, that's the thing.  Almost empty .apk-file immediately weighs about 5 mb, and the main application in assets can plunge Java or C ++ aesthetes into a light shock, although I‚Äôm not sure about the latter.  You can try to remove unnecessary libraries, but this is a topic for other experiments. <br><br>  When the application began to acquire more and more complete features, it was time to think about a possible monetization.  Of course, there is an option quite for the lazy.  Set the application for a fixed price and wait for the light breeze by the sea in the Maldives.  But I can‚Äôt afford it at the moment, and considering targeting to android, I thought that it was necessary to embed advertising in one way or another.  Integration with the AdMob advertising service I have never done.  Given the specifics of the resulting "sandwich" from the libraries, I became even more interesting. <br><br><h5>  Question number 2 </h5><br>  How to integrate AdMob into your application? <br>  As the official reference ( <a href="https://developers.google.com/mobile-ads-sdk/docs/">en</a> and <a href="https://developers.google.com/mobile-ads-sdk/docs/%3Fhl%3Dru-ru">rus</a> ) suggests using Eclipse in this process, it became obvious that: <br><ol><li>  You need to build the application in Eclipse.  This part is mainly useful for beginners.  To do this, download the clean project love-android-sdl2. <br><pre><code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git@bitbucket.org:MartinFelis/love-android-sdl2.git</code> </pre> </li><li>  Open Eclipse (I use from ADT Bundle).  Create a new workspace and add our project <i>File ‚Üí New ‚Üí Project ... ‚Üí Android ‚Üí Android Project from Existing Code</i> . <br><img src="https://habrastorage.org/getpro/habr/post_images/8ca/0b8/d88/8ca0b8d8861dc770b0fac7a598cb1f4a.png"><br>  Next, specify the path to the folder with the project.  2 projects should be defined: love-android-sdl2 and SDLActivity.  Click <i>Finish</i> . </li><li>  Go to the properties of the project SDLActivity.  Left-click on the project, select <i>Properties</i> .  Next, Android and tick <i>Is Library</i> .  Click <i>OK</i> . <br><img src="https://habrastorage.org/getpro/habr/post_images/534/c98/cc2/534c98cc2075bd83926d921ea1b47db9.png"><br></li><li>  Go to the properties of the project love-android-sdl2.  <i>Java Build Path ‚Üí Libraries tab ‚Üí Add JARs ... ‚Üí find SDLActivity / bin / sdlactivity.jar</i> . <br><img src="https://habrastorage.org/getpro/habr/post_images/72a/dc7/1b4/72adc71b49798e1f75f935cf691156f0.png"><br></li><li>  Then we go to the <i>Builders</i> tab and uncheck the box next to <i>[L√∂ve] Generate Internal Scripts</i> . </li><li>  Push the <i>Run As</i> button <i>... ‚Üí Android Application</i> <img src="https://habrastorage.org/getpro/habr/post_images/4c8/96d/ba6/4c896dba6feffd6eafc18235432b0628.png">  . </li><li>  We are waiting for the project to be assembled, and Eclipse will ask us to connect the device or run love-android-sdl2.apk on the emulator. </li></ol><br><br>  The first series of experiments using the official AdMob integration reference did not lead to success.  I turned for help to the project developer, but he replied that he had not yet tried adding AdMob to his project, and that he would also be interested in how to do this. <br><ol><li>  Follow the instructions in the standard help starting from section <a href="https://developers.google.com/mobile-ads-sdk/docs/%3Fhl%3Dru-ru">1. Embedding the Google Play services library into the project</a> .  The only reservation is that the google-play-services_lib project must first be added from sdk / extras / google / google_play_services / libproject / google-play-services_lib. </li><li>  Then you can do <i>Project ‚Üí Clean ... ‚Üí Clean all project ‚Üí OK</i> and restart the assembly. </li><li>  Open the file love-android-sdl2 / src / org.love2d.android / GameActivity.java </li><li>  We add the necessary code. <br><div class="spoiler">  <b class="spoiler_title">Listing GameActivity.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.love2d.android; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.android.gms.ads.*; <span class="hljs-comment"><span class="hljs-comment">//     import org.libsdl.app.SDLActivity; import java.io.BufferedInputStream; import java.io.BufferedOutputStream; import java.io.FileOutputStream; import java.io.IOException; import java.io.InputStream; import java.io.OutputStream; import java.net.HttpURLConnection; import java.net.URL; import android.app.DownloadManager; import android.app.ProgressDialog; import android.content.Context; import android.content.DialogInterface; import android.content.Intent; import android.net.Uri; import android.os.AsyncTask; import android.os.Build; import android.os.Bundle; import android.os.Environment; import android.os.Handler; import android.os.PowerManager; import android.os.ResultReceiver; import android.util.Log; import android.util.DisplayMetrics; import android.widget.RelativeLayout; import android.widget.Toast; public class GameActivity extends SDLActivity { private static DisplayMetrics metrics = new DisplayMetrics(); private static String gamePath = ""; private static Context context; private AdView adView; @Override protected void onCreate(Bundle savedInstanceState) { Log.d("GameActivity", "started"); context = this.getApplicationContext(); Uri game = this.getIntent().getData(); if (game != null) { if (game.getScheme().equals ("file")) { gamePath = game.getPath(); } else { copyGameToCache (game); } Log.d("GameActivity", "Selected the file: " + getGamePath()); } super.onCreate(savedInstanceState); getWindowManager().getDefaultDisplay().getMetrics(metrics); //   AdView adView = new AdView(mSingleton); adView.setAdSize(AdSize.BANNER); //   adView.setAdUnitId("ca-app-pub-1209995634500922/8885931497"); //  id  //    RelativeLayout.LayoutParams params = new RelativeLayout.LayoutParams( RelativeLayout.LayoutParams.WRAP_CONTENT, RelativeLayout.LayoutParams.WRAP_CONTENT); params.addRule(RelativeLayout.ALIGN_PARENT_TOP); params.addRule(RelativeLayout.CENTER_HORIZONTAL); AdRequest adRequest = new AdRequest.Builder().build(); adView.loadAd(adRequest); mLayout.addView(adView, params); } public static String getGamePath() { Log.d ("GameActivity", "called getGamePath(), game path = " + gamePath); return gamePath; } public static DisplayMetrics getMetrics() { return metrics; } public static void openURL (String url) { Log.d ("GameActivity", "opening url = " + url); Intent i = new Intent(Intent.ACTION_VIEW); i.setData(Uri.parse(url)); i.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK); context.startActivity(i); } void copyGameToCache (Uri sourceuri) { String destinationFilename = this.getCacheDir().getPath()+"/downloaded.love"; gamePath = destinationFilename; BufferedOutputStream bos = null; try { bos = new BufferedOutputStream(new FileOutputStream(destinationFilename, false)); } catch (IOException e) { Log.d ("GameActivity", "Could not open destination file:" + e.getMessage()); } int chunk_read = 0; int bytes_written = 0; BufferedInputStream bis = null; if (sourceuri.getScheme().equals("content")) { try { bis = new BufferedInputStream(getContentResolver().openInputStream(sourceuri)); } catch (IOException e) { Log.d ("GameActivity", "Could not open game file:" + e.getMessage()); } } else { Log.d ("GameActivity", "Unsupported scheme: " + sourceuri.getScheme()); } if (bis != null) { // actual copying try { byte[] buf = new byte[1024]; chunk_read = bis.read(buf); do { bos.write(buf, 0, chunk_read); bytes_written += chunk_read; chunk_read = bis.read(buf); } while(chunk_read != -1); } catch (IOException e) { Log.d ("GameActivity", "Copying failed:" + e.getMessage()); } } // close streams try { if (bis != null) bis.close(); if (bos != null) bos.close(); } catch (IOException e) { Log.d ("GameActivity", "Copying failed: " + e.getMessage()); } Log.d("GameActivity", "Copied " + bytes_written + " bytes"); } }</span></span></code> </pre><br></div></div><br></li><li>  We reassemble our application, launch it, wait a bit and see the ads above! <br><img width="320" height="480" src="https://habrastorage.org/getpro/habr/post_images/dbb/97a/6a4/dbb97a6a437ab09456f2feab7c26a069.png"><br></li></ol><br><br>  The answer to the second and most troubling question for me was found.  In this way I managed to ‚Äúmake friends‚Äù with L√ñVE, Android and AdMob.  My game is almost over, I hope for a quick release.  Happy end. </div><p>Source: <a href="https://habr.com/ru/post/219255/">https://habr.com/ru/post/219255/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../219245/index.html">Long-awaited check of Unreal Engine 4</a></li>
<li><a href="../219247/index.html">Twitter: Revolutions Continue?</a></li>
<li><a href="../219249/index.html">Automatic monitoring using Nagios and Puppet</a></li>
<li><a href="../219251/index.html">Connecting the VFD Futaba GP1183A01B display to the Raspberry Pi</a></li>
<li><a href="../219253/index.html">Quadcopter DJI Phantom FC40 - mini-stripping and first flight</a></li>
<li><a href="../219257/index.html">Eron-dong-dong or what else could your Windows Phone do?</a></li>
<li><a href="../219259/index.html">5 The most exciting events that occurred in space [translation]</a></li>
<li><a href="../219261/index.html">Monitoring and diagnostics of virtual desktop infrastructure</a></li>
<li><a href="../219263/index.html">Batl: STM32 Developer Platform</a></li>
<li><a href="../219267/index.html">Database design. Design and method</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>