<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How does Grunt work: see the source</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Grunt.js has long gained the popularity of a great tool for streamlining and automating workflow. Recognized as the best open source project in the fi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">🔎</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">📜</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">⬆️</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">⬇️</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How does Grunt work: see the source</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/e90/bc3/601/e90bc36018a9bba95b1e240c68854004.png" width="130"><br><br>  <a href="http://gruntjs.com/">Grunt.js</a> has long gained the popularity of a great tool for streamlining and automating workflow.  <a href="https://thenetawards.com/">Recognized as the</a> best open source project in the field of web technologies for 2014.  It is easy to use, effective in work, <a href="https://github.com/search%3Fq%3Dgrunt%2Bin%253Apath%26type%3DRepositories%26ref%3Dsearchresults">used</a> in many projects.  We will not talk about what you can do with it, it is implied that there is no need for this.  Better try to see what's inside. <br><a name="habracut"></a><br><br><h4>  Getting Started </h4><br>  The source code for Grunt is <a href="https://github.com/gruntjs">organized</a> as an <a href="https://github.com/gruntjs">organization</a> on Github.  In which there are about the following projects: <br><ul><li>  <a href="https://github.com/gruntjs/grunt">grunt</a> - directly grunt itself; </li><li>  <a href="https://github.com/gruntjs/grunt-cli">grunt-cli</a> - command line interface </li><li>  <a href="https://github.com/gruntjs/grunt-init">grunt-init</a> is a tool for creating new projects; </li><li>  <a href="">gruntjs.com</a> - <a href="http://gruntjs.com/">http://gruntjs.com/;</a> </li><li>  <a href="https://github.com/gruntjs/grunt-contrib">grunt-contrib- *</a> is a plugin collection that is supported by grunt developers. </li></ul><br><h6>  Gruntfile </h6><br>  Configuration file  This can be either Gruntfile.js, Gruntfile.coffee, which is needed for loading and configuring plugins, creating tasks, etc.  All our communication with Grunt happens through him.  It is a wrapper function into which the grunt object is passed: <br><pre><code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">grunt</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Do grunt-related things in here };</span></span></code> </pre> <br>  <i>Developers seem to like CoffeeScript, by default it can be used for everything (configuring <code>Gruntfile.coffee</code> , writing plugins, ...)</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Command Line Interface </h4><br>  On the official website we are recommended to install the command line interface for Grunt. <br><pre> <code class="bash hljs">npm install -g grunt-cli</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Grunt-cli structure:</b> <div class="spoiler_text"><pre> <code class="bash hljs">├── AUTHORS ├── Gruntfile.js <span class="hljs-comment"><span class="hljs-comment"># jshint ├── LICENSE-MIT ├── README.md ├── bin │  └── grunt #  ├── completion #  │  ├── bash │  └── zsh ├── lib │  ├── cli.js #  cli │  ├── completion.js #   │  └── info.js #      └── package.json 3 directories, 11 files</span></span></code> </pre><br></div></div><br>  Its only purpose is to locate the <a href="https://github.com/substack/node-resolve">locally installed</a> Grunt in the current directory and run: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resolve = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'resolve'</span></span>).sync; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { gruntpath = resolve(<span class="hljs-string"><span class="hljs-string">'grunt'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">basedir</span></span>: basedir}); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ex) { gruntpath = findup(<span class="hljs-string"><span class="hljs-string">'lib/grunt.js'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// No grunt install found! if (!gruntpath) { if (options.version) { process.exit(); } if (options.help) { info.help(); } info.fatal('Unable to find local grunt.', 99); } } /** * gruntpath -&gt; {HOME_DIR}/node_modules/grunt/lib/grunt.js *  .cli()   grunt */ require(gruntpath).cli();</span></span></code> </pre><br><br><h4>  Grunt core </h4><br>  The main project, <a href="https://github.com/gruntjs/grunt">grunt</a> , here the tasks and run.  Designed as an npm module. <br><div class="spoiler">  <b class="spoiler_title">File structure:</b> <div class="spoiler_text"><pre> <code class="bash hljs">├── AUTHORS ├── CHANGELOG ├── CONTRIBUTING.md ├── Gruntfile.js <span class="hljs-comment"><span class="hljs-comment"># jshint, test, watch ├── LICENSE-MIT ├── README.md ├── appveyor.yml ├── docs │  └── README.md ├── internal-tasks #   │  ├── bump.js │  └── subgrunt.js ├── lib │  ├── grunt #   │  │  ├── cli.js │  │  ├── config.js │  │  ├── event.js │  │  ├── fail.js │  │  ├── file.js │  │  ├── help.js │  │  ├── option.js │  │  ├── task.js │  │  └── template.js │  ├── grunt.js #  │  └── util │  └── task.js #   ├── package.json └── test └── **/*.js #  22 directories, 71 files</span></span></code> </pre><br></div></div><br><h6>  Code Style </h6><br>  Understandable.  There are a lot of comments and explanations in the code, practically in every method or block, and they are written somehow “humanly”, for example <code>Yes, this is a total hack...</code> They urge you to do more, but easier than shorter, but “sly ". <br><div class="spoiler">  <b class="spoiler_title">Examples:</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// bad var foo = 'bar' , bizz = 'bazz'; // better var foo = 'bar'; var bizz = 'bazz'; // bad isOk &amp;&amp; doGrunt(); // better if (isOk) { doGrunt(); } // bad isOk ? doGrunt() : doMake(); // better if (isOk) { doGrunt(); } else { doMake(); }</span></span></code> </pre><br></div></div><br>  Like almost any Grunt npm-module has its own <a href="">dependencies</a> , it is important to pay attention to them for a better understanding of what is happening. <br><div class="spoiler">  <b class="spoiler_title">dependencies:</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-string"><span class="hljs-string">"async"</span></span>: <span class="hljs-string"><span class="hljs-string">"~0.1.22"</span></span>, <span class="hljs-string"><span class="hljs-string">"coffee-script"</span></span>: <span class="hljs-string"><span class="hljs-string">"~1.3.3"</span></span>, <span class="hljs-string"><span class="hljs-string">"colors"</span></span>: <span class="hljs-string"><span class="hljs-string">"~0.6.2"</span></span>, <span class="hljs-string"><span class="hljs-string">"dateformat"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.2-1.2.3"</span></span>, <span class="hljs-string"><span class="hljs-string">"eventemitter2"</span></span>: <span class="hljs-string"><span class="hljs-string">"~0.4.13"</span></span>, <span class="hljs-string"><span class="hljs-string">"findup-sync"</span></span>: <span class="hljs-string"><span class="hljs-string">"~0.1.2"</span></span>, <span class="hljs-string"><span class="hljs-string">"glob"</span></span>: <span class="hljs-string"><span class="hljs-string">"~3.1.21"</span></span>, <span class="hljs-string"><span class="hljs-string">"hooker"</span></span>: <span class="hljs-string"><span class="hljs-string">"~0.2.3"</span></span>, <span class="hljs-string"><span class="hljs-string">"iconv-lite"</span></span>: <span class="hljs-string"><span class="hljs-string">"~0.2.11"</span></span>, <span class="hljs-string"><span class="hljs-string">"minimatch"</span></span>: <span class="hljs-string"><span class="hljs-string">"~0.2.12"</span></span>, <span class="hljs-string"><span class="hljs-string">"nopt"</span></span>: <span class="hljs-string"><span class="hljs-string">"~1.0.10"</span></span>, <span class="hljs-string"><span class="hljs-string">"rimraf"</span></span>: <span class="hljs-string"><span class="hljs-string">"~2.2.8"</span></span>, <span class="hljs-string"><span class="hljs-string">"lodash"</span></span>: <span class="hljs-string"><span class="hljs-string">"~0.9.2"</span></span>, <span class="hljs-string"><span class="hljs-string">"underscore.string"</span></span>: <span class="hljs-string"><span class="hljs-string">"~2.2.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"which"</span></span>: <span class="hljs-string"><span class="hljs-string">"~1.0.5"</span></span>, <span class="hljs-string"><span class="hljs-string">"js-yaml"</span></span>: <span class="hljs-string"><span class="hljs-string">"~2.0.5"</span></span>, <span class="hljs-string"><span class="hljs-string">"exit"</span></span>: <span class="hljs-string"><span class="hljs-string">"~0.1.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"getobject"</span></span>: <span class="hljs-string"><span class="hljs-string">"~0.1.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"grunt-legacy-util"</span></span>: <span class="hljs-string"><span class="hljs-string">"~0.2.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"grunt-legacy-log"</span></span>: <span class="hljs-string"><span class="hljs-string">"~0.1.0"</span></span></code> </pre><br></div></div><br><h6>  Task runner </h6><br>  The main file of the “factory” is located in <code>/lib/grunt.js</code> .  It "builds" and <a href="http://nodejs.org/api/modules.html">exports</a> the <code>grunt</code> object, connects the internal project libraries from <code>/lib/grunt/*.js</code> : <br><pre> <code class="javascript hljs">... <span class="hljs-comment"><span class="hljs-comment">// Grunt -&gt; export var grunt = module.exports = {}; ... //       grunt function gRequire(name) { return grunt[name] = require('./grunt/' + name); } //   gRequire('template'); ... //    (alias)      grunt function gExpose(obj, methodName, newMethodName) { grunt[newMethodName || methodName] = obj[methodName].bind(obj); } //    registerTask  task   grunt gExpose(task, 'registerTask'); ...</span></span></code> </pre><br>  The <code>tasks</code> method is added to the object, which is subsequently called from the CLI: <br><pre> <code class="javascript hljs">grunt.tasks = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tasks, options, done</span></span></span><span class="hljs-function">) </span></span>{ ... if (option(<span class="hljs-string"><span class="hljs-string">'version'</span></span>)) { <span class="hljs-comment"><span class="hljs-comment">// show version return; } ... if(option('help')) { // show help return; } ... //      ,  'default' //  task -&gt; /lib/grunt/task.js var tasksSpecified = tasks &amp;&amp; tasks.length &gt; 0; tasks = task.parseArgs([tasksSpecified ? tasks : 'default']); ... //       // ,    `grunt {TASK_1} {TASK_2}` tasks.forEach(function(name) { task.run(name); }); //  task.start({asyncDone:true}); };</span></span></code> </pre><br><h6>  CLI </h6><br>  As we have already noticed, from the command line we call the <code>grunt.cli()</code> method, this method goes in the set of internal libraries <code>/lib/grunt/*.js</code> , its task is to <a href="https://github.com/npm/nopt">parry the</a> transferred tasks and options and run <code>grunt.tasks()</code> : <br><pre> <code class="javascript hljs">... var nopt = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'nopt'</span></span>); ... <span class="hljs-comment"><span class="hljs-comment">//  cli() var cli = module.exports = function(options, done) { if (options) { //   ... } //  grunt.tasks(cli.tasks, cli.options, done); }; ... //    var optlist = cli.optlist = { help: { short: 'h', info: 'Display this help text.', type: Boolean } ... }; ... //       var parsed = nopt(known, aliases, process.argv, 2); cli.tasks = parsed.argv.remain; cli.options = parsed;</span></span></code> </pre><br><br><h4>  Tasks </h4><br>  Starting and automating tasks is the main function of <code>Grunt</code> .  The task for him is just a function that needs to be called at the right moment. <br><div class="spoiler">  <b class="spoiler_title">Example registerTask:</b> <div class="spoiler_text"><pre> <code class="javascript hljs">grunt.registerTask(<span class="hljs-string"><span class="hljs-string">'foo'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(a, b); }); <span class="hljs-comment"><span class="hljs-comment">// &gt; grunt foo // &gt; undefined undefined // &gt; grunt foo:bar:baz // &gt; bar baz //  : /lib/util.task.js -&gt; task.init() -&gt; task._taskPlusArgs() -&gt; task.splitArgs()</span></span></code> </pre><br></div></div><br>  To work with <code>Grunt</code> tasks, the internal library <a href="">/lib/grunt/task.js</a> and the utilities library <a href="">/lib/util/task.js are used</a> , look at the <code>registerTask</code> method: <br><pre> <code class="javascript hljs">... <span class="hljs-comment"><span class="hljs-comment">// ""  "task" util lib. var parent = grunt.util.task.create(); //          var task = module.exports = Object.create(parent); ... task.registerTask = function(name) { ... //  .registerTask()  //       {name: name, info: info, fn: fn} //      task._tasks parent.registerTask.apply(task, arguments); //       var thisTask = task._tasks[name]; //     var _fn = thisTask.fn; thisTask.fn = function(arg) { ... //   ,   ... //    return _fn.apply(this, arguments); }; return task; };</span></span></code> </pre><br>  <code>Grunt</code> allows us to declare tasks using the <code>registerMultiTask</code> method.  Its only difference from <code>registerTask</code> is that <code>Grunt</code> will search for a property with the same name as the task name in the <code>grunt.initConfig({})</code> config, which specifies various configurations (targets) and data to be executed: <br><div class="spoiler">  <b class="spoiler_title">Example registerMultiTask:</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Gruntfile.js grunt.initConfig({ log: { bar: [1, 2, 3], baz: 'hello world' } }); grunt.registerMultiTask('foo', function() { grunt.log.writeln(this.target + ': ' + this.data); }); // &gt; grunt foo // &gt; Running "foo:bar" (foo) task // &gt; bar: 1,2,3 // &gt; Running "foo:baz" (foo) task // &gt; baz: hello world // &gt; grunt foo:bar // &gt; Running "foo:bar" (foo) task // &gt; bar: 1,2,3</span></span></code> </pre><br></div></div><br><pre> <code class="javascript hljs">task.registerMultiTask = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name, info, fn</span></span></span><span class="hljs-function">) </span></span>{ ... var thisTask; task.registerTask(name, info, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">target</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     ()     if (!target || target === '*') { return task.runAllTargets(name, this.args); } else if (!isValidMultiTaskTarget(target)) { throw new Error('Invalid target "' + target + '" specified.'); } //        `name` this.requiresConfig([name, target]); //     {name: target} //  /lib/grunt/config.js -&gt; .get() -&gt; .getRow() this.data = grunt.config([name, target]); //  return fn.apply(this, this.args); }); thisTask = task._tasks[name]; thisTask.multi = true; };</span></span></code> </pre><br><h4>  Conclusion </h4><br>  It cannot be said that <code>Grunt</code> one of a kind and there are no alternatives to it.  But it is safe to say that he won popularity and authority.  It is easy to install, quickly configured, has an attractive declarative style of configuring tasks, a rather “modular” structure of the project. <br><br>  I would also like to attach a link to the slides of one of the <a href="https://twitter.com/cowboy">authors of the</a> project <a href="http://cowboy.github.io/state-of-grunt-fe-summit-2014-talk/">The State of Grunt</a> , which tells about what <code>Grunt</code> is now and what it is going to be.  I hope the article turned out to be at least a little interesting and helped to look deeper at the tool that we use so often. </div><p>Source: <a href="https://habr.com/ru/post/230753/">https://habr.com/ru/post/230753/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230737/index.html">What do not need to code yourself</a></li>
<li><a href="../230743/index.html">About the leak of the user password database</a></li>
<li><a href="../230747/index.html">Implementation of the Kutter-Jordan-Bossen method in MATLAB</a></li>
<li><a href="../230749/index.html">One-page IDE in the browser [AngularJS / Ace]</a></li>
<li><a href="../230751/index.html">What is HTML import and how does it work?</a></li>
<li><a href="../230755/index.html">Juniper SRX: Upgrading JunOS Version</a></li>
<li><a href="../230757/index.html">Free up hard disk space: WIMBoot</a></li>
<li><a href="../230759/index.html">I guess this tune by three notes!</a></li>
<li><a href="../230761/index.html">With great strength comes a big responsibility - the safety technique in AngularJS</a></li>
<li><a href="../230763/index.html">Implementing bundles of goods in online stores ReadyScript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>