<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Parse the qualified X.509 certificates in the search for TIN, SNILS and OGRN</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúColleagues, we need to keep a register of issued qualified certificates with the ability to search on the TIN, SNILS and OGRN. How many days are need...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Parse the qualified X.509 certificates in the search for TIN, SNILS and OGRN</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/files/ceb/207/91a/ceb20791a59b40839e25aac8110e5001.png" alt="Parse the qualified X.509 certificates in the search for TIN, SNILS and OGRN">  ‚ÄúColleagues, we need to keep a register of issued qualified certificates with the ability to search on the TIN, SNILS and OGRN.  How many days are needed to create the certificate parser and the first layout? ‚Äù- the next bulletin started with this question from the head. <br><br>  Since I was asked to write the parser, I had to think and delve into memory in order to assess the complexity of the task and the approximate time frame for its implementation. <br><br>  I once participated in a small SSL MITM modeling project, where I was responsible for generating keys and certificates for this very ‚Äúman in the middle‚Äù.  Therefore, it represented that a qualified certificate of the electronic signature verification key (hereinafter referred to as a <i>qualified certificate</i> ) is an X.509 certificate, for describing the internal structure of which <s>everyone's favorite</s> ASN.1 is used. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But I didn‚Äôt remember that then these INNs, SNILSs and OGRNs would come across.  Therefore, he answered more than modestly: ‚ÄúBoss, two days, no less!‚Äù, Hoping to complete the task in a few hours. <br><br>  Below is a story about how badly I made a mistake in the calculations, as well as a ready-made solution for parsing X.509 certificates in C # with the ability to extract fields and their attributes with given object identifiers (OID). <a name="habracut"></a><br><br><h2>  Step 1. Preliminary research and hypothesis testing </h2><br>  No, seriously, is it true that there is a SNILS in the X.509 certificate?  To check, we will find a sample - we ask for help from Yandex on the request ‚Äúregister of issued qualified certificates‚Äù, on the very first page of issue we find the <a href="http://ca.lenobl.ru/index.php/sertifikaty">Register of certificates issued by TC GKU LO ‚ÄúOEP‚Äù certificates</a> , download the first received certificate (number 10842) - <a href="">Komarov_Aleksey_Petrovich_2017-03-31_a2ba20c4. cer</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Komarov Alexey Petrovich: a view from the inside</b> <div class="spoiler_text">  ----- BEGIN CERTIFICATE ----- <br>  MIIIzjCCCH2gAwIBAgIRAJ6w9zrKuNKX5xH + FfdJYxwwCAYGKoUDAgIDMIH4MRww <br>  GgYJKoZIhvcNAQkBFg11ZGNAbGVucmVnLnJ1MRgwFgYFKoUDZAESDTExMjQ3MDMw <br>  MDAzMzMxGjAYBggqhQMDgQMBARIMMDA0NzAzMTI1OTU2MQswCQYDVQQGEwJSVTEs <br>  MCoGA1UECAwjNzgg0LMu0KHQsNC90LrRgi3Qn9C10YLQtdGA0LHRg9GA0LMxJjAk <br>  BgNVBAcMHdCh0LDQvdC60YIt0J / QtdGC0LXRgNCx0YPRgNCzMR0wGwYDVQQKDBTQ <br>  k9Ca0KMg0JvQniAi0J7QrdCfIjEgMB4GA1UEAwwX0KPQpiDQk9Ca0KMg0JvQniDQ <br>  ntCt0J8wHhcNMTcwMzMxMTAyODEwWhcNMTgwMzMxMTAyODEwWjCCAo4xIzAhBgkq <br>  hkiG9w0BCQEWFGFwX2tvbWFyb3ZAbGVucmVnLnJ1MRowGAYIKoUDA4EDAQESDDAw <br>  Nzg0MjM1NDk2NjEWMBQGBSqFA2QDEgswNzMxMTk5NjY2ODEYMBYGBSqFA2QBEg0x <br>  MDc3ODQ3MTkyNjA5MSwwKgYDVQQMDCPQk9C70LDQstC90YvQuSDRgdC / 0LXRhtC4 <br>  0LDQu9C40YHRgjFBMD8GA1UECww40JTQtdC / 0LDRgNGC0LDQvNC10L3RgiDQu9C1 <br>  0YHQvdC + 0LPQviDQutC + 0LzQv9C70LXQutGB0LAxajBoBgNVBAoMYdCa0L7QvNC4 <br>  0YLQtdGCINC / 0L4g0L / RgNC40YDQvtC00L3Ri9C8INGA0LXRgdGD0YDRgdCw0Lwg <br>  0JvQtdC90LjQvdCz0YDQsNC00YHQutC + 0Lkg0L7QsdC70LDRgdGC0LgxKjAoBgNV <br>  BAkMIdGD0Lsu0KLQvtGA0LbQutC + 0LLRgdC60LDRjywg0LQuNDEmMCQGA1UEBwwd <br>  0KHQsNC90LrRgi3Qn9C10YLQtdGA0LHRg9GA0LMxLDAqBgNVBAgMIzc4INCzLtCh <br>  0LDQvdC60YIt0J / QtdGC0LXRgNCx0YPRgNCzMQswCQYDVQQGEwJSVTEoMCYGA1UE <br>  Kgwf0JDQu9C10LrRgdC10Lkg0J / QtdGC0YDQvtCy0LjRhzEXMBUGA1UEBAwO0JrQ <br>  vtC80LDRgNC + 0LIxajBoBgNVBAMMYdCa0L7QvNC40YLQtdGCINC / 0L4g0L / RgNC4 <br>  0YDQvtC00L3Ri9C8INGA0LXRgdGD0YDRgdCw0Lwg0JvQtdC90LjQvdCz0YDQsNC0 <br>  0YHQutC + 0Lkg0L7QsdC70LDRgdGC0LgwYzAcBgYqhQMCAhMwEgYHKoUDAgIkAAYH <br>  KoUDAgIeAQNDAARA2jaQisiN ++ YQULAiW4b8Llik90VIKNPqUcEOVlrfplASb2W / <br>  qc9giz + rP1 / VvQXAmRKPaL3dM33MExypCJOlGaOCBEUwggRBMA4GA1UdDwEB / wQE <br>  AwIDqDAdBgNVHQ4EFgQU7SOIwRLKC8mDQV / q2KtCaTA06Q8wNQYJKwYBBAGCNxUH <br>  BCgwJeKoUDAgIyAQmDx + sNh / eeXoXlhVqDn / dWgZtags1fAgEBAgEAMIIBYwYD <br>  VR0jBIIBWjCCAVaAFNGDmDS2EE52TJ + tKf2SJRHjAFYJoYIBKaSCASUwggEhMRow <br>  GAYIKoUDA4EDAQESDDAwNzcxMDQ3NDM3NTEYMBYGBSqFA2QBEg0xMDQ3NzAyMDI2 <br>  NzAxMR4wHAYJKoZIhvcNAQkBFg9kaXRAbWluc3Z5YXoucnUxPDA6BgNVBAkMMzEy <br>  NTM3NSDQsy4g0JzQvtGB0LrQstCwINGD0LsuINCi0LLQtdGA0YHQutCw0Y8g0LQu <br>  NzEsMCoGA1UECgwj0JzQuNC90LrQvtC80YHQstGP0LfRjCDQoNC + 0YHRgdC40Lgx <br>  FTATBgNVBAcMDNCc0L7RgdC60LLQsDEcMBoGA1UECAwTNzcg0LMuINCc0L7RgdC6 <br>  0LLQsDELMAkGA1UEBhMCUlUxGzAZBgNVBAMMEtCj0KYgMSDQmNChINCT0KPQpoIR <br>  BKgeQAWpGF6C5hHB / EETxEYwOQYDVR0lBDIwMAYIKwYBBQUHAwIGCCsGAQUFBwME <br>  BggqhQMFARgCLAYIKoUDBQEYAgYGBiqFA2QCATBJBgkrBgEEAYI3FQoEPDA6MAoG <br>  CCsGAQUFBwMCMAoGCCsGAQUFBwMEMAoGCCqFAwUBGAIsMAoGCCqFAwUBGAIGMAgG <br>  BiqFA2QCATATBgNVHSAEDDAKMAgGBiqFA2RxATCCAQYGBSqFA2RwBIH8MIH5DCsi <br>  0JrRgNC40L / RgtC + 0J / RgNC + IENTUCIgKNCy0LXRgNGB0LjRjyA0LjApDCoi0JrR <br>  gNC40L / RgtC + 0J / QoNCeINCj0KYiINCy0LXRgNGB0LjQuCAyLjAMTtCh0LXRgNGC <br>  0LjRhNC40LrQsNGCINGB0L7QvtGC0LLQtdGC0YHRgtCy0LjRjyDihJbQodCkLzEy <br>  NC0zMDEwINC + 0YIgMzAuMTIuMjAxNgxO0KHQtdGA0YLQuNGE0LjQutCw0YIg0YHQ <br>  vtC + 0YLQstC10YLRgdGC0LLQuNGPIOKEltCh0KQvMTI4LTI5ODMg0L7RgiAxOC4x <br>  MS4yMDE2MDgGBSqFA2RvBC8MLSLQmtGA0LjQv9GC0L7Qn9GA0L4gQ1NQIiAo0LLQ <br>  tdGA0YHQuNGPIDMuNi4xKTBWBgNVHR8ETzBNMCWgI6Ahhh9odHRwOi8vY2EubGVu <br>  b2JsLnJ1L2UtZ292LTUuY3JsMCSgIqAghh5odHRwOi8vdWNsby5zcGIucnUvZS1n <br>  b3YtNS5jcmwwOwYIKwYBBQUHAQEELzAtMCsGCCsGAQUFBzAChh9odHRwOi8vY2Eu <br>  bGVub2JsLnJ1L2UtZ292LTUuY2VyMAgGBiqFAwICAwNBAEe1iKkhV4BQcDsBSAJa <br>  kWfh5tNaPIp / jFc + HZtpmgJoGU8CpOdX3I5YAgJTx9O + Q4ylHwJl68rfCD44s0Q4 <br>  wqE = <br>  ----- END CERTIFICATE ----- <br></div></div><br>  We open the certificate using the standard Windows OC viewer and find in the subject description a suspiciously similar string with the object identifier 1.2.643.100.3, consisting of 11 digits.  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2582%25D1%2580%25D0%25B0%25D1%2585%25D0%25BE%25D0%25B2%25D0%25BE%25D0%25B9_%25D0%25BD%25D0%25BE%25D0%25BC%25D0%25B5%25D1%2580_%25D0%25B8%25D0%25BD%25D0%25B4%25D0%25B8%25D0%25B2%25D0%25B8%25D0%25B4%25D1%2583%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE%25D0%25B3%25D0%25BE_%25D0%25BB%25D0%25B8%25D1%2586%25D0%25B5%25D0%25B2%25D0%25BE%25D0%25B3%25D0%25BE_%25D1%2581%25D1%2587%25D1%2591%25D1%2582%25D0%25B0">SNILS</a> ? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/052/227/4d4/0522274d4a784dc0a05074bd4299b84d.png" alt="View a qualified certificate using the standard Windows OS tool"></div><br><blockquote>  Lyrical digression <br><br>  The fact that such an object identifier (OID) in general is best read <a href="http://www.oid-info.com/faq.htm">here</a> .  How object identifiers are used in the description of the structure of X.509 certificates - see <a href="http://pro-ldap.ru/tr/zytrax/tech/ssl.html">Survival Guide - TLS / SSL and SSL certificates (X.509)</a> . </blockquote><br>  We open the certificate in a virtual machine with an established crypto-provider CryptoPRO CSP, which certainly knows the specifics of the country, and confirm the guess. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/3a0/22e/b7a/3a022eb7aea24a2aa409a57b31415e2c.png" alt="View a qualified certificate with an established CryptoPro CSP crypto-provider"></div><br>  So, the task posed is potentially feasible, there is a SNILS in a qualified certificate.  Go ahead. <br><br><h2>  Step 2. Acquaintance with the regulatory framework </h2><br>  Naturally, it is not possible to find the TIN, SNILS and OGRN in any X.509 certificate.  For example, if in the browser you click on the lock next to the address bar ‚Äúhttps://yandex.ru/‚Äù and export the certificate, then there will not be any long numeric sequences. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/633/cce/87c/633cce87c271448ca4592d5a10d7f07d.png" alt="View Yandex certificate"></div><br>  It should be noted that the standard X.509 does not limit the set of attributes that can be specified in the name of the publisher and / or subject.  The standard only recommends maintaining a number of attributes, among which are a country, an organization, a region, a common name, etc., but not a word is said about SNILS and other things. <br><br>  The data we are interested in is precisely contained in certificates that fall within the scope of the Federal Law <a href="http://base.garant.ru/12184522/">‚ÄúOn Electronic Signature‚Äù</a> of April 6, 2011 No. 63-FZ.  We carefully study article 17 and make sure that the INN, SNILS and OGRN really should be contained in qualified certificates. <br><br>  Now it is necessary to find out which OID corresponds to the TIN value, and which one - the SNILS and OGRN.  With this question, the <a href="https://habrahabr.ru/post/139196/">review of the regulatory framework</a> , which refers to the Order of the Federal Security Service of the Russian Federation of December 27, 2011 No. 795 <a href="http://base.garant.ru/70133464/">‚ÄúOn approval of requirements for the form of a qualified certificate ...‚Äù,</a> will help.  Open the order and find the information we are interested in: <br><br><blockquote>  18. Additional attributes of the name, the need to use which is established in accordance with federal law, include: <br><br>  <i>1) OGRN.</i> <br>  The value of the OGRN attribute is a string consisting of 13 digits and representing the OGRN of the owner of a qualified certificate - a legal entity.  The object identifier of the attribute type OGRN is <i>1.2.643.100.1</i> , the attribute type OGRN is described as follows: OGRN :: = NUMERIC STRING SIZE 13; <br><br>  <i>2) SNILS (SNILS).</i> <br>  The value of the SNILS attribute is a string consisting of 11 digits representing the SNILS of the owner of a qualified certificate - an individual.  The object identifier of the attribute type SNILS is <i>1.2.643.100.3</i> , the attribute type SNILS is described as follows: SNILS :: = NUMERIC STRING SIZE 11; <br><br>  <i>3) INN (INN).</i> <br>  The value of the INN attribute is a 12-digit string representing the TIN of the owner of the qualified certificate.  The object identifier of the type of the INN attribute is <i>1.2.643.3.131.1.1</i> , the attribute type of the INN is described as follows: INN :: = NUMERIC STRING SIZE 12. </blockquote><br>  You can try to check yourself - knowing the OID, find the object described by it.  For example, we take OID = 1.2.643.100.3 (SNILS).  We turn to the official <a href="http://oid-info.com/cgi-bin/display%3Ftree%3D">register of</a> identifiers and "walk" on the tree: <br><br><pre><code class="tex hljs">1 - International Organization for Standardization (ISO) 1.2 - ISO Member Bodies 1.2.643 - Russian federation</code> </pre> <br>  The value 1.2.643.100 can no longer be found, this OID is not listed in the lists of the official catalog.  Follow the link to the <a href="https://oid.iitrust.ru/">national registry</a> , continue to search.  Detected identifiers that you managed to ‚Äúdescend‚Äù through the tree: <br><br><pre> <code class="tex hljs">1.2.643.100 ( OID' 1.2.643.100.1,  ,  OID' 1.2.643.100.3,  ) -   1.2.643.3.131 ( OID' 1.2.643.3.131.1.1,  ) -    </code> </pre> <br>  Check yourself will not work, because not all tiers are displayed on the site of the national register of object identifiers.  But hope dies last, we try to send an official request to the operator of the national tree - to OJSC Infoteks Internet Trust.  We quote the correspondence: <br><br>  <i>- Tell <a href="https://oid.iitrust.ru/">me</a> , is it possible on the site <a href="https://oid.iitrust.ru/">oid.iitrust.ru to</a> clarify which objects correspond to OIDs: 1.2.643.3.131.1.1, 1.2.643.100.1, 1.2.643.100.3?</i>  <i>They are not in the search, but we assume that this is an TIN, OGRN and SNILS.</i>  <i>How can I get confirmation of this?</i> <i><br><br></i>  <i>- Good afternoon!</i>  <i>The OID specified by you was approved by order No. 795 of the FSB of Russia of December 27, 2011.</i> <br><br>  The circle is closed, we believe that the test was carried out successfully. <br><br>  We continue to study the Order of the Federal Security Service of the Russian Federation of December 27, 2011 No. 795 and draw attention to the fact that the filling in of fields and their attributes depends on the owner of a qualified certificate - a natural or legal person.  For example, the description of filling in the attribute commonName (common name): <br><br><blockquote>  As the value of this attribute of the name, you should use a text string containing the name, surname and patronymic (if any) - for an individual, or the name - for a legal entity.  The object identifier of the commonName attribute type is 2.5.4.3. </blockquote><br>  In our case (Komarov_Aleksey_Petrovich_2017-03-31_a2ba20c4.cer) the value of the commonName attribute is the string ‚ÄúCommittee on Natural Resources of the Leningrad Region‚Äù, therefore, the certificate holder is a legal entity. <br><br>  For a legal entity, we establish the following correspondence of object identifiers (not all selectively interesting for us) to attribute types: <br><br><pre> <code class="tex hljs">2.5.4.3 ‚Äì    2.5.4.8 -     1.2.643.3.131.1.1 ‚Äì  1.2.643.100.1 ‚Äì  1.2.643.100.3 ‚Äì     1.2.840.113549.1.9.1 ‚Äì   </code> </pre> <br><h2>  Step 3. Development of the parser X.509 certificate in  # </h2><br>  It so happened that we are developing in C #, so the example of the parser will be in C #, nothing personal and no holivar. <br><br>  For simplicity, we formalize the problem as follows.  <i>Given:</i> file of a qualified certificate in the system of restrictions CER (Canonical encoding rules).  <i>Required:</i> parse (parse) the certificate and extract the values ‚Äã‚Äãof TIN, SNILS and OGRN from the subject field (Subject). <br><br>  For the first sketches, we refer to the capabilities of the System.Security.Cryptography.X509Certificates namespace: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.IO; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Security.Cryptography.X509Certificates; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Diagnostics; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">X509Parser</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> fileName = <span class="hljs-string"><span class="hljs-string">@"c:\Komarov_Aleksey_Petrovich_2017-03-31_a2ba20c4.cer"</span></span>; X509Certificate cert = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> X509Certificate(File.ReadAllBytes(fileName)); Debug.Print(<span class="hljs-string"><span class="hljs-string">" : {0}"</span></span>, cert.GetSerialNumberString()); Debug.Print(<span class="hljs-string"><span class="hljs-string">"    : {0}"</span></span>, cert.GetExpirationDateString()); Debug.Print(<span class="hljs-string"><span class="hljs-string">": {0}"</span></span>, cert.Subject); } } }</code> </pre> <br>  At the output we get: <br><br><pre> <code class="tex hljs"> : 009EB0F73ACAB8D297E711FE15F749631C     : 31.03.2018 13:28:10 : CN=     , SN=, G= , C=RU, S=78 .-, L=-, STREET="., .4", O=     , OU=  , T= , OID.1.2.643.100.1=1077847192609, OID.1.2.643.100.3=07311996668, OID.1.2.643.3.131.1.1=007842354966, E=ap_komarov@lenreg.ru</code> </pre> <br>  The X509Certificate.Subject property returns the subject name of the certificate of type string. <br><br>  At first glance, it is possible to stop with simple regular expressions ( <a href="https://regex101.com/r/loBUA4/3">example</a> ) to select the values ‚Äã‚Äãof interest from the row, knowing their OIDs and types of values.  But agree, the elegance of such a decision is clearly not enough.  In addition, the installed cryptographic provider can replace OID codes with symbolic notation, which will lead to unnecessary complication of the code. <br><br>  We try further, carefully review the .NET class library in search of a suitable solution.  After several attempts to access the subject field as a sequence of bytes, it becomes clear that using standard tools of the .NET platform, it is quite inconvenient to implement viewing the certificate structure with the ability to search by OIDs. <br><br>  StackOverflow gives a <a href="http://stackoverflow.com/questions/27064336/how-to-extract-the-email-from-a-x509-certificate-in-net">hint</a> - use third-party libraries, choose the most quoted - <a href="http://www.bouncycastle.org/csharp/index.html">BouncyCastle</a> . <br><br>  The library is connected in one click by adding reference to the project.  The proposed level of abstraction allows you to intuitively view data in the format of ASN.1.  It remains only to clarify the ‚Äúoffset‚Äù of the values ‚Äã‚Äãof interest to us relative to the beginning of the certificate file in order to correctly specify the position for the parser. <br><br>  Open the certificate in the ASN.1 Editor and set the correspondence with the certificate structure: <br><br><img src="https://habrastorage.org/files/af5/afd/9ef/af5afd9efdaa44918d2d0d21d7dc002d.png" alt="View a qualified certificate in ASN.1 Editor"><br><br><pre>  (0, 2254) SEQUENCE - root sequence, in brackets hereinafter (offset, length)
	 (4, 2173) SEQUENCE - certificate
		 (8, 3) CONTEXT SPECIFIC - Certificate Version
		 (13, 17) INTEGER - serial number
		 (32, 8) SEQUENCE - the signature algorithm identifier
		 (42, 248) SEQUENCE - publisher name
		 (293, 30) SEQUENCE - period of validity
		 (325, 654) SEQUENCE - the name of the subject </pre><br>  We are interested in the ‚ÄúName of the Subject‚Äù field, in which the values ‚Äã‚Äãof the TIN, SNILS and OGRN are recorded.  If you look closely at the picture, you can draw the following conclusion: the Subject Name field (325, 654) SEQUENCE is a sequence (SEQUENCE) of sets (SET) consisting of sequences (SEQUENCE) of key / value pairs. <br><br>  In accordance with this logic, we implement the parser: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Diagnostics; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.IO; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Org.BouncyCastle.Asn1; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Org.BouncyCastle.X509; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">X509Parser</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//         27.12.2011 ‚Ññ795 string fileName = @"c:\Komarov_Aleksey_Petrovich_2017-03-31_a2ba20c4.cer"; X509CertificateParser parser = new X509CertificateParser(); X509Certificate cert = parser.ReadCertificate(File.ReadAllBytes(fileName)); Debug.Print(" : {0}", cert.SerialNumber.ToString(16).ToUpper()); Debug.Print("    : {0}", cert.NotAfter.ToString("dd.MM.yyyy")); //   subject = SEQ of SET of SEQ of {OID/value} DerSequence subject = cert.SubjectDN.ToAsn1Object() as DerSequence; foreach (Asn1Encodable setItem in subject) { DerSet subSet = setItem as DerSet; if (subSet == null) continue; //    SET -   SEQ of {OID/value} DerSequence subSeq = subSet[0] as DerSequence; foreach (Asn1Encodable subSeqItem in subSeq) { DerObjectIdentifier oid = subSeqItem as DerObjectIdentifier; if (oid == null) continue; string value = subSeq[1].ToString(); if (oid.Id.Equals("2.5.4.3")) Debug.Print("   /   : {0}", value); if (oid.Id.Equals("2.5.4.8")) Debug.Print("   : {0}", value); if (oid.Id.Equals("1.2.643.3.131.1.1")) Debug.Print(": {0}", value); if (oid.Id.Equals("1.2.643.100.1")) Debug.Print(": {0}", value); if (oid.Id.Equals("1.2.643.100.3")) Debug.Print(": {0}", value); if (oid.Id.Equals("1.2.840.113549.1.9.1")) Debug.Print(" : {0}", value); } } } } }</span></span></code> </pre> <br>  We look at the conclusion, agree: <br><br><pre> <code class="tex hljs"> : 9EB0F73ACAB8D297E711FE15F749631C     : 31.03.2018  : ap_komarov@lenreg.ru : 007842354966 : 07311996668 : 1077847192609    : 78 .-    /   :      </code> </pre> <br>  Problem solved. <br><br><h2>  Summarizing </h2><br>  So, summing up the work done, we: <br><br><ol><li>  We have dealt with the structure of X.509 qualified certificates that fall within the scope of the Federal Law "On Electronic Signature". </li><li>  We learned that the Order of the Federal Security Service of the Russian Federation No. 795 defines additional attributes - TIN, SNILS, OGRN and others.  The corresponding object identifiers (OID) are also indicated here. </li><li>  Developed a parser for X.509 certificates in C # with the ability to extract fields and their attributes with given object identifiers.  The BouncyCastle library added simplicity to the solution. </li></ol><br>  There was an error in the time calculations - instead of the planned several hours, I had to sort it all day.  And two more days on preparation of research for Habr. <br><br>  Thanks for attention! <br><br><h2>  List of sources </h2><br><ul><li>  <a href="http://www.itu.int/rec/T-REC-X.509-200508-S">X.509</a> Specification </li><li>  Federal Law <a href="http://base.garant.ru/12184522/">‚ÄúOn Electronic Signature‚Äù</a> of April 06, 2011 No. 63-FZ </li><li>  <a href="http://base.garant.ru/70133464/">Order of the</a> Federal Security Service of the Russian Federation dated December 27, 2011 No. 795 ‚ÄúOn approval of requirements for the form of a qualified electronic signature verification key certificate‚Äù </li><li>  Official <a href="http://oid-info.com/cgi-bin/display%3Ftree%3D">register of</a> object identifiers OID </li><li>  <a href="https://oid.iitrust.ru/">National Register of</a> Object Identifiers OID </li><li>  <a href="http://pro-ldap.ru/tr/zytrax/tech/ssl.html">Survival Guide - TLS / SSL and SSL Certificates (X.509)</a> </li><li>  <a href="https://habrahabr.ru/post/150757/">ASN.1 in simple terms (REAL type encoding)</a> </li><li>  <a href="https://habrahabr.ru/post/194664/">Parse the x.509 certificate</a> </li><li>  <a href="https://habrahabr.ru/post/139196/">Electronic signature in simple words</a> </li><li>  <a href="http://www.bouncycastle.org/csharp/index.html">BouncyCastle</a> Library </li></ul></div><p>Source: <a href="https://habr.com/ru/post/325998/">https://habr.com/ru/post/325998/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325988/index.html">Checking the integrity of the roulette game on the Ethereum smart contract</a></li>
<li><a href="../325990/index.html">Character Design 2B for Nier: Automata</a></li>
<li><a href="../325992/index.html">VAT and freelancers working with Upwork</a></li>
<li><a href="../325994/index.html">6 fresh examples of parsing and design improvements in simple ways</a></li>
<li><a href="../325996/index.html">e-Government of the future</a></li>
<li><a href="../326002/index.html">We write our monads on Scala using the example of a CSV parser</a></li>
<li><a href="../326004/index.html">The digest of interesting materials for the mobile developer # 198 (April 2-9)</a></li>
<li><a href="../326006/index.html">An example of creating a web application on PureQML</a></li>
<li><a href="../326008/index.html">Integration of IS with ESIA via SAML</a></li>
<li><a href="../326014/index.html">Looks like I'm not an entrepreneur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>