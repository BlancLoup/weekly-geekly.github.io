<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Profiling Applications in Visual Studio 2010</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today, we will measure the performance of our application using the Visual Studio Profiling Tool . 

 Visual Studio Profiling Tool allows developers t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Profiling Applications in Visual Studio 2010</h1><div class="post__text post__text-html js-mediator-article">  Today, we will measure the performance of our application using the <b>Visual Studio Profiling Tool</b> . <br><br>  <b>Visual Studio Profiling Tool</b> allows developers to measure, evaluate application and code performance.  These tools are fully embedded in the IDE to provide the developer with continuous monitoring. <br>  In this guide, we will <b>step by step</b> profile <b>PeopleTrax</b> applications using <b>Sampling</b> and <b>Instrumentation</b> profiling methods to identify problems in application performance. <br><br><img src="https://habrastorage.org/storage/habraeffect/22/c5/22c5b241391462bbd58fbebaa4f886a9.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A lot of pictures. <br><a name="habracut"></a><br><h4>  Training </h4><br>  To work with this guide, you will need: <br><ul><li>  Microsoft Visual Studio 2010 </li><li>  Average knowledge of C # </li><li>  A copy of the PeopleTrax test application, available for download from <a href="http://go.microsoft.com/fwlink/%3FLinkId%3D160299">MSDN Code Gallery</a> </li></ul><br><br><h4>  Profiling methods </h4><br>  We will slightly deviate from the main topic of the article and consider possible methods of profiling.  You can skip this chapter; the profiling methods used will be briefly described before use. <br><br><h5>  Sampling </h5><br>  <b>Sampling</b> - collects statistics about the application (during profiling).  This method is lightweight and therefore, as a result of its work there is a very small error in the data obtained. <br><br>  Each specific time interval is collected information about the call stack (call stack).  Based on this data, performance is calculated.  Used for initial profiling and for identifying problems related to processor usage. <br><br><h5>  Instrumentation </h5><br>  <b>Instrumentation</b> - collects detailed information about the operation time of each function called.  Used to measure I / O performance. <br><br>  The method injects its code into a binary file that captures synchronization information (time) for each function in the file, and for each function that is called in this one. <br><br>  The report contains 4 values ‚Äã‚Äãfor providing elapsed time: <br><ul><li>  <b>Elapsed Inclusive</b> - total time spent on the function </li><li>  <b>Application Inclusive</b> - the time spent on the function, with the exception of the time of calls to the operating system. </li><li>  <b>Elapsed Exclusive</b> is the time spent executing code in the body.  The time spent by functions caused by the target function. </li><li>  <b>Application Exclusive</b> - the time spent on executing code in the body.  Eliminates the time spent making calls to the operating system and the time spent executing functions caused by the target function. </li></ul><br><br><h5>  Concurrency </h5><br>  <b>Concurrency</b> - collects information about multi-threaded applications (how to debug multi-threaded applications, see the <a href="http://habrahabr.ru/blogs/vs/97817/">"Guide to debugging multi-threaded applications in Visual Studio 2010"</a> ).  The method collects detailed information about the call stack, each time when competing threads are forced to wait for access to the resource. <br><br><h5>  .NET Memory </h5><br>  <b>.NET Memory</b> - profiler collects information about the type, size, and the number of objects that were created in the distribution or were destroyed by the garbage collector.  Memory profiling hardly affects the performance of the application as a whole. <br><br><h5>  Tier interaction </h5><br>  <b>Tier Interaction</b> - adds information to the file for profiling about <b>ADO.NET</b> synchronous calls between an <b>ASP.NET</b> page or other applications and a <b>SQL</b> server.  Data includes the number and time of calls, as well as the maximum and minimum time. <br><br>  This is where we‚Äôll finish profiling methods and continue to learn how to profile applications. <br><br><h4>  Profiling Sampling Method </h4><br>  Sampling is a profiling method that periodically polls the process in question to determine the active function.  As a result, it shows the number of times the function was at the beginning of the call stack during testing. <br><br><h5>  Profiling </h5><br>  Open the <i>PeopleTrax</i> test project.  We set the configuration in <i>Release</i> (additional information is embedded in the Debug version for debugging the application, and it will have a bad effect on the accuracy of the profiling results). <br><br>  In the <b>Analyze</b> menu, click on the <b>Launch Performance Wizard</b> . <br><br><img src="https://habrastorage.org/storage/habraeffect/cd/1c/cd1c1afe1f227dcde625766db1e5cea9.jpg" alt="image"><br><br>  At this step, you need to select a profiling method.  Select CPU Sampling (recommended) and click Next. <br><br><img src="https://habrastorage.org/storage/habraeffect/f4/40/f440d603757145f714bc5f8bdd145804.jpg" alt="image"><br><br>  Choose which application we will profile, this is <i>PeopleTrax</i> and the Next button.  Next, click Finish and the profiler and our application will automatically start.  On the screen we see the PeopleTrax program.  Click the <b>Get People</b> button, wait for the completion of work and <b>Export Data</b> .  Close the notebook and the program and the profiler will generate a report. <br><br><img src="https://habrastorage.org/storage/habraeffect/c5/b4/c5b4bdac15257504dfc553b501f4e2ec.jpg" alt="image"><br><br>  Profiler generated report (* .vsp) <br><br><img src="https://habrastorage.org/storage/habraeffect/d1/49/d149fe7e73fe6cb0212192f15af590a4.jpg" alt="image"><br><br><h5>  Analysis of the Sampling Method Report </h5><br>  The <b>Summary</b> displays a graph of processor usage over the entire profiling time.  The <b>Hot Path</b> list shows the call branches that are most active.  And in the list of <b>Functions, Doing Most Individual Work</b> (whose name speaks for itself) are functions that took up more time in the body of these functions. <br><br>  Looking at the <b>Hot Path</b> list, we see that the <i>PeopleNS.People.GetNames</i> method occupies almost the last place in the call branch.  You can examine it more carefully for performance improvements.  Click on <i>PeopleNS.People.GetNames</i> and <b>Function Details will</b> open before us. <br><br><img src="https://habrastorage.org/storage/habraeffect/48/63/486364667b71f3ba0746c255523b24ff.jpg" alt="image"><br><br>  This window contains two parts.  The expenditure window provides a graphical representation of the functions that work, and the contribution of the function and its callers to the number of instances that were selected.  You can change the function in question by clicking on it with the mouse. <br><br>  <b>The Function Code View</b> shows the method code when it is available and highlights the most ‚Äúexpensive‚Äù lines in the selected method.  When the <b>GetNames</b> method is selected, you can see that it reads strings from application resources using a <u>StringReader</u> , adding each string to an <u>ArrayList</u> .  There are no obvious ways to improve this part. <br><br>  Since <i>PeopleNS.People.GetPeople is the</i> only one who calls <b>GetNames</b> , we‚Äôll click <b>GetPeople</b> .  This method returns an <u>ArrayList</u> of <u>PersonInformationNS.PersonInformation</u> objects with the names of people and companies returned by the <b>GetNames</b> method.  However, <b>GetNames</b> is called twice each time a <u>PersonInformation</u> is created.  (This is shown in yellow and red).  Obviously, you can easily optimize the method by creating lists only once at the beginning of the method. <br><br><img src="https://habrastorage.org/storage/habraeffect/70/91/7091c06b96d1b99ad5e80248256d1d33.jpg" alt="image"><br><br>  An alternative version of <b>GetPeople is</b> also in the code and we will <b>enable</b> it now.  To do this, you need to define <b>OPTIMIZED_GETPEOPLE</b> as a Conditional compilation symbol in the properties window of the <b>People</b> and <b>PeopleTrax project</b> .  <i>And yes, if you want to repeat my experiments, then you need to correct the error in the project.</i>  <i>In the optimized class constructor, the name of resources is not correctly written: you need PeopleNS.Resources together PeopleNS.Resource.</i>  <i>If this does not change, everything falls with terrible mistakes.</i> <br><br><img src="https://habrastorage.org/storage/habraeffect/9d/b6/9db6783ef54c59947ef02ae35183c840.jpg" alt="image"><br><br>  The optimized method will replace the old one with the next build. <br><br>  Restart profiling in the current session by clicking <b>Launch with Profiling</b> in the <b>Performance Explorer</b> window.  Click on <b>Get People</b> and <b>Export Data</b> .  Close the notebook and the program and the profiler will generate a new report. <br><br><img src="https://habrastorage.org/storage/habraeffect/4e/b6/4eb60da6a6423cf52af172359e9e4596.jpg" alt="image"><br><br>  To compare two reports, we select both and the <b>Compare Performance Reports</b> reports.  The delta column shows the performance difference of the <b>Baseline</b> version with the later <b>Comparison</b> .  Select <b>Inclusive Samples%</b> and Apply. <br><br>  As you can see the performance gain is noticeable to the naked eye. <br><br><img src="https://habrastorage.org/storage/habraeffect/71/07/71077b0c1d4be1e8ea7f600804852f80.jpg" alt="image"><br><br><h4>  Instrumentation Profiling </h4><br>  This method is useful for profiling I / O operations, writing to disk, and exchanging data over a network.  This method provides more information than the previous one, but it carries with it more overhead.  Binaries received after inserting additional code are more common, and are not intended for deployment. <br><br>  This time we will focus our analysis on the export of data, in which the list of people is recorded in the notepad file. <br><br><h5>  Profiling </h5><br>  In <b>Performance Explorer,</b> select <b>Instrumentation</b> and click Start Profiling.  Click Get People.  After loading people, wait 10 seconds and click Export Data.  Close the notebook and the program.  The profiler will generate a report. <br><br><h5>  Analysis </h5><br>  The profiler will show this picture: <br><br><img src="https://habrastorage.org/storage/habraeffect/99/88/998805352ab3b6171ffc344e5cf403af.jpg" alt="image"><br><br>  We did not get the information we wanted.  Filter the data.  We deliberately waited 10 seconds to simply filter out the profiling data that is no longer needed.  Mark from the 13th to the end and click <b>Filter by selection</b> .  Already another result: <br><br><img src="https://habrastorage.org/storage/habraeffect/cb/9f/cb9f6391716d9ebd8d6d7aebf960561d.jpg" alt="image"><br><br>  <b>Hot Path</b> shows that the <u>Concat</u> method takes a lot of time (it is also the first in the list of Functions With Most Individual Work).  Click on <u>Concat</u> to view detailed information about the method. <br><br><img src="https://habrastorage.org/storage/habraeffect/ed/e9/ede968e0e9fff832ecc2f5567dae4940.jpg" alt="image"><br><br>  You can see that <i>PeopleTrax.Form1.ExportData</i> is the only method that calls <u>Concat</u> .  Click <i>PeopleTrax.Form1.ExportData</i> in the calling methods ( <b>Function calling this function</b> ). <br><br><img src="https://habrastorage.org/storage/habraeffect/de/7d/de7d1adf9d88264fc616efd394210d17.jpg" alt="image"><br><br>  Analyze the method in the code window.  Please note that there is no direct call to Concat.  Together this is the use of the operand <b>+ =</b> , which the compiler replaces with the methods <u>System.String.Concat</u> .  As almost everyone knows, any changes in rows in .NET lead to the destruction of the old version of the string and the creation of a modified string.  Fortunately, in .NET there is a class <u>StringBuilder</u> which is intended for such work. <br><br>  The project already has an optimized method using <u>StringBuilder</u> .  In the PeopleTrax project, add the <b>OPTIMIZED_EXPORTDATA</b> compilation variable.  We save and run the profiler again and compare the reports.  We immediately see (and logically understandable) that we have optimized the Concat calls (from 6000 to 0 times). <br><br>  After starting the application, there is a noticeable improvement in performance by eye.  It is very important to run the profiling again, there are even visible improvements.  Viewing new data after fixing a problem may show other problems in application performance. <br><br><h4>  Literature </h4><br><ul><li>  <a href="http://msdn.microsoft.com/en-us/library/bb385749.aspx">Getting Started with Profiling Tools</a> </li><li>  <a href="http://msdn.microsoft.com/en-us/library/ms182398.aspx">Walkthrough: Profiling Applications</a> </li><li>  <a href="http://go.microsoft.com/fwlink/%3FLinkId%3D160299">PeopleTrax Sample (draft)</a> </li><li>  <a href="http://blogs.msdn.com/b/profiler/">Visual Studio Profiler Team Blog</a> </li><li>  <a href="http://habrahabr.ru/blogs/vs/97817/">Guide to debugging multi-threaded applications in Visual Studio 2010</a> </li></ul><br>  <i>Thanks for attention.</i>  <i>Quick as lightning you code.</i> </div><p>Source: <a href="https://habr.com/ru/post/98361/">https://habr.com/ru/post/98361/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../98351/index.html">New dictionaries from Paragon for Mac OS - learn to make apple fresh</a></li>
<li><a href="../98353/index.html">Lunar Tweet: project to support the Russian team in the lunar race</a></li>
<li><a href="../98354/index.html">Competition for webmasters and bloggers from the partner program FXEarn</a></li>
<li><a href="../98359/index.html">Response to misleading ASCAP statements</a></li>
<li><a href="../98360/index.html">Mobile Internet will overtake wired broadband already in 2010</a></li>
<li><a href="../98362/index.html">Droider Chart. Issue 8</a></li>
<li><a href="../98364/index.html">Problems with XNA 4 CTP</a></li>
<li><a href="../98369/index.html">Three-minute charging for electric cars</a></li>
<li><a href="../98370/index.html">Facebook vs Vkontakte, Athens vs Sparta, USA vs USSR, liberalism vs power vertical</a></li>
<li><a href="../98371/index.html">Wet 3D display presented at SIGGRAPH</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>