<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>List of useful ideas for high-load services</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I decided to collect a hodgepodge of tips on how to develop high-load services, obtained in a practical way. For each piece of advice...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>List of useful ideas for high-load services</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/js/kx/ga/jskxgauv7gcocmubltb7bsxxr-w.jpeg" align="left">  In this article, I decided to collect a hodgepodge of tips on how to develop high-load services, obtained in a practical way.  For each piece of advice, I will try to give a small justification, without details (otherwise the article would have turned out to be comparable in size to war and peace).  Since I will not give a lot of justifications, you should not take this article as a dogma - in each particular case, the advice given here can be harmful.  Always think with your head before doing something. <br><br><h3>  1. Think with your head and check the facts. </h3><br>  It's the most important.  There should be no absolute authority for you.  If someone says complete nonsense, or says something that contradicts your practice - do not listen to such advice, and no matter how much this person is known and respected.  If you are developing a large system and it does not work well, then they will ask you and in this case ‚Äúwe followed the best international practices‚Äù is not an excuse.  The ability to apply the right technology in the right place and makes you a valuable specialist, and not blindly following someone else's advice - for this just qualification is not required. <br><a name="habracut"></a><br><h3>  2. Simple is better than complicated and ‚Äúcorrect‚Äù </h3><br>  The systems that you develop should be understandable, first of all, to you and your colleagues, and not to the ‚Äúspherical horse in a vacuum‚Äù.  For example, if the finished system to which you want to go with the whole team is not transparent and not understandable to all participants, then you can hardly hope that people will be able to use it effectively.  As a rule, various kinds of problems emerge under load even in the best and most efficient systems, and the time to troubleshoot problems is usually short, since at this point a large number of users suffer.  Without a good understanding of how everything works, you have little chance to solve the problem quickly.  We can recall, for example, how <a href="https://www.kp.ru/daily/26059/2969072/">classmates lay for several days</a> ‚Äî in a well-designed and well-designed system, even serious failures are eliminated in a few hours, not days. <br><br><h3>  3. Do not forget about monitoring. </h3><br>  Usually, no one forgets that you need to test changes before you upload them.  But much less often people think about what happens <i>after</i> deployment, and how the system behaves in production.  But in fact, monitoring is a logical continuation of QA for code.  Your infrastructure should also have Quality Assurance - you should see problems in advance, and if they do, you can quickly diagnose the causes.  Without monitoring this is simply impossible to do. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  4. Write postmortems (each breakdown has a cost) </h3><br>  When something important has fallen - write a post-mortem in which it will be described: <br><ul><li>  what happened </li><li>  why did it happen </li><li>  how many users have suffered (if it is possible to count, and how much money the company has lost) </li><li>  what needs to be systematically changed so that this does not happen again (options like ‚Äúbe careful‚Äù do not work in practice) </li></ul><br><br>  Often, already in preparation for writing a post-mortem, we can conclude that in fact nothing terrible happened.  That is, eliminating the causes of the incident will cost the company more than leaving it "as it is."  Do not forget about this option - that is, sometimes something will break, and it is normal if it is within the permissible boundaries (for each company, these boundaries are different). <br><br><h3>  5. Performance is a feature </h3><br>  Despite the fact that the formal definition of a ‚Äúhigh-loaded project‚Äù does not exist, usually more or less everyone understands what is meant.  One of the features of applications under good load is that it is often much easier to optimize a piece of code than to spread the logic across multiple servers.  That is, when developing high-load systems it is often necessary to engage in optimization and it is useful to be able to do this.  If not only bandwidth is optimized, but also response time, then at the same time you improve user experience.  Win-win. <br><br><h3>  6. Two-phase commit - it is difficult, but inevitable </h3><br>  Unless your system fits entirely on one server, you will inevitably be confronted with the need to do something.  ‚ÄúTwo-phase commit‚Äù - the need to atomically update data in several places, for example, in a database and in a service.  A two-phase commit in practice is a myth.  Atomic update for more than one server is impossible.  There are different ways to achieve consistency in such cases, but the most common are queues - you add data and writing to a separate table in one transaction - the queue for updating the service.  Since this is a transaction on one server, it will either go entirely or not at all.  Accordingly, even if the update data in the service immediately failed, eventually the data will be consistent. <br><br><h3>  7. Paginated navigation is challenging. </h3><br>  ‚ÄúWhat else is difficult?  You make the usual SELECT with LIMIT / OFFSET and everything, there is page-by-page navigation! ‚Äù- you must have thought.  You are right, but this approach works well only if the data does not change (otherwise doubles will occur and, on the contrary, some records will be omitted).  In addition, the use of large OFFSET values ‚Äã‚Äãusually leads to a serious loss of performance, since the database needs to literally select all the requested rows in the number LIMIT + OFFSET, discard the OFFSET pieces and return the remaining LIMIT.  This task is linear in time with respect to the OFFSET value, and for large values ‚Äã‚Äãthis construction usually slows down significantly. <br><br>  Depending on the task, the solution to this problem may be different, but it is almost never simple and unambiguous.  For example, you can use minId instead of the page number ‚Äî you simply skip most of the entries by index.  Or, if the pages are returned as a result of the search, you need to be able to ignore the new changes or store snapshot data for the corresponding request somewhere. <br><br><h3>  8. (Re) Sharding - Challenge </h3><br>  In general, there is no way to effectively scale up the database in order to get a near-linear performance boost.  You need to choose a sharding strategy that will be suitable for your project, and you need to choose very well, because the process of resharing, and even more so changing the sharding scheme is one of the most difficult tasks when storing large amounts of data and it is also in general practically not solved. <br><br>  If you think that projects like CockroachDB are a silver bullet that will solve all your problems, then you are mistaken.  If you want to get normal performance from the system, you still need to understand at least in general terms how sharding occurs within the database to minimize communication between nodes (intensive communication between nodes is the main reason why productivity increases are rarely linear when adding new nodes). <br><br><h3>  9. Good code differs from bad code in how errors are handled. </h3><br>  Contrary to popular belief, a good code is not only determined by how well everything is laid out in packages, whether it is possible to read this code, whether it follows the imaginable and unthinkable style guides, and so on.  This is all important, but users of the system (by users here are meant not only the end users of the site, but also system administrators, other programmers, etc.) first of all care that everything works as expected, and when it did not work, it was it is clear what is happening. <br><br>  Surprisingly, a lot of software does not handle errors at all, or processes them in the style of ‚Äúoh, something happened,‚Äù or they start to DDoS themselves at all with endless retracts.  Error handling is difficult, and an adequate response to them is even more so.  Errors are very different, and not all of them require, for example, the completion of the program.  For example, if you are developing a file system and it stops working altogether (including not allowing you to delete data) when the disk is 100% full, then this is a bad file system.  At the same time, you could follow all the "best practices" from famous people and you have a million stars on a githaba - this does not mean anything.  Roughly speaking, shit happens, and even among the coolest people, space on the servers sometimes ends unexpectedly, and you should be able to handle this situation. <br><br><h3>  That's all </h3><br>  Thank you for reading this ‚Äúarticle.‚Äù  It will be interesting to read your opinion, or your own advice, which is based on practical experience, write about it in the comments! </div><p>Source: <a href="https://habr.com/ru/post/344160/">https://habr.com/ru/post/344160/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../344142/index.html">When the butler is a victim</a></li>
<li><a href="../344144/index.html">Binary search in graphs</a></li>
<li><a href="../344146/index.html">Kotlin Night Moscow - video, photo, presentation</a></li>
<li><a href="../344150/index.html">Survey for users of the browser Vivaldi</a></li>
<li><a href="../344156/index.html">Visual Studio extension to render instances of custom classes in debug mode. Part 2</a></li>
<li><a href="../344164/index.html">Layers, Bulbs, Hexogons, Ports and Adapters - it's all about one thing</a></li>
<li><a href="../344166/index.html">TeamCity 2017.2: 100 free build configurations, Docker, .NET CLI, composite builds and improvements in Kotlin DSL</a></li>
<li><a href="../344170/index.html">How we taught smart socket to measure power</a></li>
<li><a href="../344172/index.html">Malfunctions of the site. How to effectively organize the support of web resources by third-party services</a></li>
<li><a href="../344174/index.html">How I came up with and used the format of storing the results of experiments Measurelook</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>