<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Compress Unicode data</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In one future project, the challenge was to transfer and store data in a VCard format, which contain Cyrillic letters. Since the size of the transmitt...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Compress Unicode data</h1><div class="post__text post__text-html js-mediator-article">  In one future project, the challenge was to transfer and store data in a VCard format, which contain Cyrillic letters.  Since the size of the transmitted information is limited, it was necessary to reduce the size of the data. <br><br>  There were several options: <br><ol><li>  Use traditional encodings (for Cyrillic - CP1251). </li><li>  Use Unicode compression formats.  Today it is SCSU and BOCU-1.  I provide a detailed description of these two formats below. </li><li>  Use universal compression algorithms (gzip). </li></ol><br>  Beautiful, but useless, results graph: <br><img src="https://habrastorage.org/getpro/habr/post_images/a59/bf7/559/a59bf7559efb71b2353fc1985546af51.png" alt="image"><br><br><a name="habracut"></a><br><h4>  Input data </h4><br>  Business card format VCard 3.0 (length 260 characters): 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> BEGIN: VCARD
 VERSION: 3.0
 N: Pupkin; Vasily
 FN: Vasily Pupkin
 ORG: Horns and Hoofs LLC
 TITLE: The Most Important
 TEL; TYPE = WORK, VOICE: +380 (44) 123-45-67
 ADR; TYPE = WORK:; 1; Khreshchatyk; Kiev ;; 01001; UKRAINE
 EMAIL; TYPE = PREF, INTERNET: vasiliy.pupkin@example.com
 END: VCARD
</pre><br>  <font color="#AAA">All the results below concern this example.</font>  <font color="#AAA">For Cyrillic business cards, the results should not differ.</font>  <font color="#AAA">For business cards in other languages, probably, additional research will be required, this was not part of the task.</font> <br><br>  Option using CP1251 dropped immediately.  Despite the small size of the finished files, its use (as well as any other traditional encoding) severely limits the capabilities of the service. <br><br><h1>  SCSU </h1><br>  The standard compression scheme (The Standard Compression Scheme for Unicode, SCSU) is based on Reuters development. <br><br>  The main idea of ‚Äã‚ÄãSCSU is the definition of dynamic windows in Unicode code space.  Characters belonging to small alphabets (for example, Cyrillic) can be encoded with one byte, which indicates the character index in the current window.  The windows are pre-installed to the blocks that are most often used, so the encoder does not have to set them. <br><br>  For large alphabets, including Chinese, SCSU allows switching between single-byte and ‚ÄúUnicode‚Äù modes, which is actually UTF-16BE. <br><br>  Control bytes ("tags") are inserted into the text to change windows and modes.  Screening tags ("quote" tags) are used to switch to another window only for the next character.  This is useful for encoding a single character outside the current window, or a character that conflicts with the tags. <br><br><h5>  Example </h5><br><pre> ... N: P of p to to and N ... FN: In and with and l and th ...
 ... 4E 3A 12 9F C3 BF BA B8 BD ... 46 4E 3A 92 B0 C1 B8 BB B8 B9 ...
</pre><br>  Before the first Cyrillic letter, the coder uses the SC2 tag (hexadecimal 12) to switch to the dynamic window No. 2, which is preset to the Cyrillic character block.  When reusing Cyrillic characters, the tag is not used. <br><br><h5>  Benefits </h5><br><ul><li>  Text encoded in SCSU generally takes up as much space as traditional encoding.  The overhead of tags is relatively minor. </li><li>  SCSU decoder is easy to implement, compared to universal compression algorithms. </li></ul><br><h5>  disadvantages </h5><br><ul><li>  SCSU uses ASCII control characters, not only as tags, but also as part of normal characters.  This makes SCSU an inappropriate format for protocols such as MIME, which interpret control characters without decoding them. </li></ul><br><br><h1>  BOCU-1 </h1><br>  The concept of Binary Ordered Compression (The Binary Ordered Compression for Unicode, BOCU) was developed in 2001 (by Mark Davis and Markus Scherer for the ICU project). <br><br>  The BOCU-1 based idea is to encode each character as a difference (distance in the Unicode table) to the previous character.  Small differences occupy fewer bytes than large ones.  By coding differences, BOCU-1 achieves the same compression for small alphabets, whatever block they are in. <br><br>  BOCU-1 supplements the concept with the following rules: <br><ul><li>  The previous or base value is aligned in the middle of the block, in order to avoid big jumps from the beginning of the block to the end. </li><li>  32 control characters ASCII, as well as the spaces do not change when encoding, for compatibility with e-mail and to preserve the binary order </li><li>  The space does not cause a change in the base value.  This means that when encoding non-Latin words separated by spaces, there is no need to make a big jump to U + 0020 and back. </li><li>  ASCII control characters reset the base value, which makes the adjacent lines in the file independent. </li></ul><br><br><h5>  Example </h5><br><pre> ... N: P u p to and n;  B ... FN: B a s and l and th ...
 ... 9e 8a d3 d3 93 8f 8a 88 8d 4c 11 d3 c6 ... 96 9e 8a d3 c6 80 91 88 8b 88 89 ...
</pre><br>  For each block change (transition from Cyrillic to Latin), the encoder needs two bytes (d3 - to switch to Cyrillic block, 4c - for the colon). <br><br><h5>  Benefits </h5><br><ul><li>  ASCII control characters remain when encoding </li><li>  Like SCSU, BOCU-1 requires little overhead compared to traditional encodings </li></ul><br><br><h5>  disadvantages </h5><br><ul><li>  Latin letters (and all ASCII characters, except the control ones) change their meaning when encoding.  For example, the XML parser should obtain BOCU-1 encoding information from a higher level protocol. </li><li>  The BOCU-1 algorithm is not formally described anywhere, except for the software code accompanying UTN # 6. </li></ul><br><br><h1>  Universal compression algorithms </h1><br>  To compare the efficiency, the gzip compression algorithm was chosen.  For large texts, gzip shows a greater degree of compression in comparing SCSU and BOCU-1 (since the number of different characters, even in multilingual documents, is limited).  On small texts, like VCard in the example, it is difficult to get an unambiguous result. <br><br>  A significant drawback of universal compression algorithms is the complexity of the implementation of the compressor and decompressor. <br>  The question of two-stage compression (for example, SCSU + gzip) remains open for me. <br><br><h1>  results </h1><br>  The results of the SCSU and BOCU-1 algorithms for the source data in comparison with CP1251 and UTF8 are shown in the first column. <br><br>  The second column represents the number of bytes issued directly by the encoder (without the Marker bayt order, BOM, which indicates the type of Unicode representation in the file). <br><br>  The third column is a compressed gzip file. <br><br>  The fourth column shows the number of data bytes in the gzip archive (no header, 18 bytes). <br><br><table><tbody><tr><td>  <strong>File</strong> </td><td>  <strong>File without bom</strong> </td><td>  <strong>In the archive</strong> </td><td>  <strong>The length of the data in the archive</strong> </td></tr><tr><td>  <strong>CP1251</strong> </td><td>  260 </td><td>  260 </td><td>  258 </td><td>  240 </td></tr><tr><td>  <strong>SCSU</strong> </td><td>  267 </td><td>  264 </td><td>  266 </td><td>  248 </td></tr><tr><td>  <strong>BOCU-1</strong> </td><td>  278 </td><td>  275 </td><td>  273 </td><td>  255 </td></tr><tr><td>  <strong>UTF8</strong> </td><td>  329 </td><td>  326 </td><td>  299 </td><td>  281 </td></tr></tbody></table><br>  All files in the <a href="">archive</a> (5 kb). <br><br><h1>  Application </h1><br>  SQL Server 2008 R2 uses SCSU to store nchar (n) and nvarchar (n).  Symbian OS uses SCSU to serialize strings. <br><br>  You can use <a href="http://site.icu-project.org/">ICU</a> or <a href="http://www.unipad.org/main/">SC UniPad</a> to work with SCSU and BOCU-1 <a href="http://www.unipad.org/main/"><br></a>  . <br><br>  I was very surprised that none of the common barcode readers recognize SCSU or BOCU-1. <br><br><h1>  What else to read </h1><br>  Unicode Technical Note # 14.  <a href="http://www.unicode.org/notes/tn14/">A Survey of Unicode Compression</a> <br>  Unicode Technical Standard # 6.  <a href="http://www.unicode.org/reports/tr6/">A Standard Compression Scheme for Unicode</a> <br>  Unicode Technical Note # 6.  <a href="http://www.unicode.org/notes/tn6/">BOCU-1: MIME-Compatible Unicode Compression</a> </div><p>Source: <a href="https://habr.com/ru/post/79200/">https://habr.com/ru/post/79200/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../79191/index.html">Bad management vs. curved arms</a></li>
<li><a href="../79192/index.html">Beeline plans to transfer your personal data to collector companies if you owe</a></li>
<li><a href="../79194/index.html">Oh, here you are, habraklovek!</a></li>
<li><a href="../79197/index.html">PuTTY in Linux: how to copy text</a></li>
<li><a href="../79198/index.html">5 tips for developing the design of your application icons for the app store</a></li>
<li><a href="../79204/index.html">Web 2.0 suicide machine</a></li>
<li><a href="../79205/index.html">Having told about the product on Habrahabr and having given the link to Wikipedia, it is possible to provoke removal of article about it in Wikipedia</a></li>
<li><a href="../79206/index.html">Ronny CMS, introduction</a></li>
<li><a href="../79207/index.html">Big Evernote iPhone Update: Offline Notebooks and More</a></li>
<li><a href="../79210/index.html">Elements of the semantic web</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>