<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Authorization of the user on your site through Telegram for Django</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! On February 6, Telegram introduced the ability to add a widget to its site to authorize a user through his Telegram account. Widgets by the typ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Authorization of the user on your site through Telegram for Django</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/po/5s/08/po5s08xbotfmrak0gsgcdvetka4.png"></div><br>  Hello!  On February 6, Telegram introduced the ability to add a widget to its site to authorize a user through his Telegram account.  Widgets by the type of implementation on the server are divided into two types - process user data "here and now" in JavaScript or redirect data in the URL parameters to the specified address.  Also, the button itself can be customized externally: resize, round corners, turn off and turn on the photo. <br><br>  Material - a guide to setting up user authorization through a Telegram account on your site using the <a href="https://github.com/dmytrostriletskyi/django-telegram-login"><b>django-telegram-login</b></a> package. <br><a name="habracut"></a><br><h2>  Disclaimer </h2><br>  <b>django-telegram-login</b> works for <b>Python</b> 2 and 3 for current versions of <b>Django</b> (tested on 1.11 and 2.0). <br><br>  The article contains examples for each of the tutorial items.  At the end of the article provided full examples. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Settings for Telegram </h2><br>  I recommend reading the <a href="https://telegram.org/blog/login">news</a> and <a href="https://core.telegram.org/widgets/login">documentation on widgets</a> before reading the material below. <br><br><h3>  localtunnel </h3><br>  Telegram requires a domain name for your website, because it will make requests to your website, transfer user data.  So you need a tunnel - a web site on the net that will forward all requests to your <b>localhost</b> . <br><br>  Install the <b>localtunnel</b> package using <b>npm</b> (make sure you have it installed). <br><br><pre><code class="bash hljs">$ npm install -g localtunnel</code> </pre> <br>  Run <b>localtunnel</b> on the port on which you will be raising your <b>Django</b> server. <br><br><pre> <code class="bash hljs">$ lt --port 8000</code> </pre><br>  In response, you will receive a link, for example, such <b><a href="https://kqmxkdqitb.localtunnel.me/">kqmxkdqitb.localtunnel.me</a></b> .  You can share it with any other Internet user and he will have access to your site. <br><br>  Start the server and make sure that you can reach the server through the tunnel. <br><br><pre> <code class="bash hljs">$ ./manage.py runserver 0.0.0.0:8000</code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/n_/_b/iw/n__biwgimvllroinivspivtdidc.png"></div><br><h3>  Domain Name Registration </h3><br>  As stated in the official Telegram documentation, your website needs a Telegram bot that will process user requests for authorization.  It should be linked to your site via address. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qr/u8/w2/qru8w2qtarr7kvoa69yduuo02us.png"></div><br>  In the future, we will need the user bot ( <b>HabrahabrTelegramLoginBot</b> ) and its token ( <b>540908629: AAEUGcF_M68nzHmfHtMSAWNncKBVJ75rOZI</b> ).  Based on the token, validation of the user data that comes from the Telegram is performed. <br><br><h2>  Install and configure Django </h2><br>  Download the package via <b>pip with the</b> following command. <br><br><pre> <code class="bash hljs">$ pip install django-telegram-login</code> </pre><br>  Add the application to the <b>installed apps</b> . <br><br><pre> <code class="python hljs">INSTALLED_APPS = [ ... <span class="hljs-string"><span class="hljs-string">'django_telegram_login'</span></span>, ]</code> </pre><br>  Structure information about the bot.  For example, add constants to the settings file ( <b>settings.py</b> ). <br><br><pre> <code class="python hljs">TELEGRAM_BOT_NAME = <span class="hljs-string"><span class="hljs-string">'HabrahabrTelegramLoginBot'</span></span> TELEGRAM_BOT_TOKEN = <span class="hljs-string"><span class="hljs-string">'459236585:AAEee0Ba4fRijf1BRNbBO9W-Ar15F2xgV98'</span></span> TELEGRAM_LOGIN_REDIRECT_URL = <span class="hljs-string"><span class="hljs-string">'https://kqmxkdqitb.localtunnel.me/'</span></span></code> </pre><br>  And use them in this form. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.conf <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> settings bot_name = settings.TELEGRAM_BOT_NAME bot_token = settings.TELEGRAM_BOT_TOKEN redirect_url = settings.TELEGRAM_LOGIN_REDIRECT_URL</code> </pre><br>  <b>django-telegram-login</b> allows you to use an unlimited number of bots for authorization in Telegram.  Widgets do not take the parameters of the bot from the settings, but accept them as arguments.  Therefore, it is not a problem to design many different widgets. <br><br><h2>  How the widget works </h2><br>  The widget has the following view (picture below).  You can change its size - small ( <b>small</b> ), medium ( <b>medium</b> ) and large ( <b>large</b> ), round the corners ( <b>corner_radius</b> ), remove the photo ( <b>disable user photo</b> ).  You can specify the type of user authorization processing - process user data "here and now" in JavaScript or send URL parameters to the specified address.  Telegram widget configuration documentation is available <a href="https://core.telegram.org/widgets/login">here</a> .  <b>django-telegram-login</b> already has everything inside it necessary to configure the widgets in the code. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/po/5s/08/po5s08xbotfmrak0gsgcdvetka4.png"></div><br>  <i>(the size of the image is different from the original size of the widget)</i> <br><br><h3>  Widget </h3><br>  A widget is an external <b>JavaScript</b> that accepts your arguments ( <b>data-size</b> - the size of the widget, for example), processes them and responds with user data when working correctly.  It also generates a ‚Äúbutton‚Äù <b>Log in as</b> . <br><br><pre> <code class="javascript hljs">&lt;script <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> src=<span class="hljs-string"><span class="hljs-string">"https://telegram.org/js/telegram-widget.js?2"</span></span> data-telegram-login=<span class="hljs-string"><span class="hljs-string">"samplebot"</span></span> data-size=<span class="hljs-string"><span class="hljs-string">"large"</span></span> data-auth-url=<span class="hljs-string"><span class="hljs-string">""</span></span> data-request-access=<span class="hljs-string"><span class="hljs-string">"write"</span></span>&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  <i>(Example widget with Telegram documentation)</i> <br><br>  <b>How to configure the widget using django-telegram-login</b> <br><br>  You do not need to go into the Telegram documentation to configure the script and copy it to your HTML page each time.  Use the widget generator from <b>django-telegram-login</b> . <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.conf <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> settings <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django_telegram_login.widgets.constants <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( SMALL, MEDIUM, LARGE, DISABLE_USER_PHOTO, ) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django_telegram_login.widgets.generator <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( create_callback_login_widget, create_redirect_login_widget, ) bot_name = settings.TELEGRAM_BOT_NAME bot_token = settings.TELEGRAM_BOT_TOKEN redirect_url = settings.TELEGRAM_LOGIN_REDIRECT_URL telegram_login_widget = create_callback_login_widget(bot_name, corner_radius=<span class="hljs-number"><span class="hljs-number">10</span></span>, size=MEDIUM) telegram_login_widget = create_redirect_login_widget( redirect_url, bot_name, size=LARGE, user_photo=DISABLE_USER_PHOTO )</code> </pre><br>  As you can see in the code clipping from the top - convenient constant solutions for specifying the size of the widget, a constant for turning off the user's photo. <br><br><h4>  corner_radius </h4><br>  The optional <b>corner_radius</b> parameter takes an integer from 1 to 20 (this is the default value).  Rectangular - 1, rounded - 20. <br><br><h4>  user_photo </h4><br>  Using the <b>DISABLE_USER_PHOTO</b> constant passed to the <b>user_photo</b> parameter, you can turn off the user's photo near the widget. <br><br>  <b>create_callback_login_widget</b> and <b>create_redirect_login_widget</b> , widget generators, accept these constants and, based on them, generate code for the widget according to your requirements.  Let's see what they return in the <b>telegram_login_widget</b> variables. <br><br>  As we discussed above, a widget is just external JavaScript.  Therefore, <b>telegram_login_widget</b> in case of <b>callback</b> will return the following. <br><br><pre> <code class="javascript hljs">&lt;script <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> src=<span class="hljs-string"><span class="hljs-string">"https://telegram.org/js/telegram-widget.js?2"</span></span> data-telegram-login=<span class="hljs-string"><span class="hljs-string">"HabrahabrTelegramLoginBot"</span></span> data-size=<span class="hljs-string"><span class="hljs-string">"medium"</span></span> data-radius=<span class="hljs-string"><span class="hljs-string">"10"</span></span> data-auth-url=<span class="hljs-string"><span class="hljs-string">"https://kqmxkdqitb.localtunnel.me"</span></span> data-onauth=<span class="hljs-string"><span class="hljs-string">"onTelegramAuth(user)"</span></span> data-request-access=<span class="hljs-string"><span class="hljs-string">"write"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  As you can see, the widget generator has put the bot username, widget size and link to your site into the script.  The <b>onTelegramAuth</b> function in <b>data-onauth</b> will <b>be</b> discussed below. <br><br><h2>  Widget Design Logic </h2><br>  On the example of the <b>create_redirect_login_widget</b> function, which knows how to build a widget, you can see that the <b>redirect_url</b> , <b>bot_name,</b> and <b>user_photo</b> variables passed to it are inserted into the widget body. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_redirect_login_widget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( redirect_url, bot_name, size=SMALL, user_photo=True, access_write=True )</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Create redirect widget, that allows to handle user data as get request params. """</span></span> script_initital = \ <span class="hljs-string"><span class="hljs-string">'&lt;script async src="https://telegram.org/js/telegram-widget.js?2" '</span></span> bot = <span class="hljs-string"><span class="hljs-string">'data-telegram-login="{}" '</span></span>.format(bot_name) size = <span class="hljs-string"><span class="hljs-string">'data-size="{}" '</span></span>.format(size) userpic = \ <span class="hljs-string"><span class="hljs-string">'data-userpic="{}" '</span></span>.format(str(user_photo).lower()) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> user_photo <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> redirect = <span class="hljs-string"><span class="hljs-string">'data-auth-url="{}" '</span></span>.format(redirect_url) access = <span class="hljs-string"><span class="hljs-string">'data-request-access="write"'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> access_write <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> script_end = <span class="hljs-string"><span class="hljs-string">'&gt;&lt;/script&gt;'</span></span> widget_script = \ script_initital + bot + size + userpic + redirect + access + script_end <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> widget_script</code> </pre><br>  The output is ‚Äúraw text‚Äù, which can be displayed in an <b>HTML</b> template. <br><br><h3>  Display the generated script on the HTML page </h3><br>  Generate your widget in some <b>view</b> and pass it into context. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">callback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request)</span></span></span><span class="hljs-function">:</span></span> telegram_login_widget = create_callback_login_widget(bot_name, size=SMALL) context = {<span class="hljs-string"><span class="hljs-string">'telegram_login_widget'</span></span>: telegram_login_widget} <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render(request, <span class="hljs-string"><span class="hljs-string">'telegram_auth/callback.html'</span></span>, context)</code> </pre><br>  In the HTML template itself, use the <b>telegram_login_widget</b> variable from the context using <b>Jinja</b> ( <a href="https://docs.djangoproject.com/en/2.0/intro/tutorial03/">such as that</a> ). <br><br><pre> <code class="javascript hljs">It is template to render callback Telegram widget! <span class="xml"><span class="hljs-comment"><span class="xml"><span class="hljs-comment">&lt;!-- {{ telegram_login_widget|safe }} --&gt;</span></span></span><span class="xml"> {% autoescape off %} {{ telegram_login_widget }}{% endautoescape %} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="actionscript"><span class="xml"><span class="actionscript"> </span></span><span class="hljs-function"><span class="hljs-keyword"><span class="xml"><span class="actionscript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span><span class="xml"><span class="actionscript"><span class="hljs-function"> </span></span></span><span class="hljs-title"><span class="xml"><span class="actionscript"><span class="hljs-function"><span class="hljs-title">onTelegramAuth</span></span></span></span></span><span class="hljs-params"><span class="xml"><span class="actionscript"><span class="hljs-function"><span class="hljs-params">(user)</span></span></span></span></span><span class="xml"><span class="actionscript"><span class="hljs-function"> </span></span></span></span><span class="xml"><span class="actionscript">{ alert(</span></span><span class="hljs-string"><span class="xml"><span class="actionscript"><span class="hljs-string">'Logged in as '</span></span></span></span><span class="xml"><span class="actionscript"> + user.first_name + </span></span><span class="hljs-string"><span class="xml"><span class="actionscript"><span class="hljs-string">' '</span></span></span></span><span class="xml"><span class="actionscript"> + user.last_name + </span></span><span class="hljs-string"><span class="xml"><span class="actionscript"><span class="hljs-string">'!'</span></span></span></span><span class="xml"><span class="actionscript">); } </span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  The <b>autoescape</b> tag <b>is</b> used to ‚Äúsay‚Äù HTML to display <b>telegram_login_widget</b> as markup, not as raw text.  As a result, the following will appear on the page. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ig/ue/up/igueupabxne_0dpsirjyjhoaxyg.png"></div><br>  The user presses the button, receives a request for confirmation of authorization. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2f/ot/yv/2fotyvbdsl8ot06op5r83jjorly.png"></div><br>  If the user does this for the first time, the Telegram authorization will first appear. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6s/ar/w0/6sarw0fhn6xrblq8y8digoi1uke.jpeg"></div><br>  After that and in further clicks on the <b>Log in as</b> button - the Telegram will send the user data each time until the user disconnects in the chat with Telegram (if it is disconnected, you will have to confirm the input again). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nx/r5/5j/nxr55j4sdf5jdxb8eoutbeo2twa.png"></div><br>  The <b>onTelegramAuth</b> function receives a response from the Telegram with user data. <br>  Use the <b>user</b> argument to get the data. <br><br><pre> <code class="javascript hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTelegramAuth</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">user</span></span></span><span class="hljs-function">) </span></span>{ alert(<span class="hljs-string"><span class="hljs-string">'Logged in as '</span></span> + user.first_name + <span class="hljs-string"><span class="hljs-string">' '</span></span> + user.last_name + <span class="hljs-string"><span class="hljs-string">'!'</span></span>); } &lt;<span class="hljs-regexp"><span class="hljs-regexp">/script&gt;</span></span></code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bw/0d/xp/bw0dxpjzjfsw5z4ektxrrbmgdg0.png"></div><br>  Telegram returns the following data: first_name, last_name, username, photo_url, auth_date (unix datetime) and hash (the last two values ‚Äã‚Äãare technical, for verification).  You can implement data transfer from <b>onTelegramAuth</b> to your <b>view</b> via an <b>AJAX</b> request. <br><br>  <b>The redirect</b> widget clicked on the <b>Log as in</b> button redirects the user to the specified link (TELEGRAM_LOGIN_REDIRECT_URL) and inserts the user data into the request parameters (link parameters). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pi/qf/7k/piqf7khredioufba5d6vtzwhrps.png"></div><br>  As for this type of widget, you need to authenticate the data. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django_telegram_login.authentication <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> verify_telegram_authentication <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django_telegram_login.errors <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( NotTelegramDataError, TelegramDataIsOutdatedError, ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#      ,   , #           , #    Telegram    . if not request.GET.get('hash'): return HttpResponse('Handle the missing Telegram data in the response.') try: result = verify_telegram_authentication( bot_token=bot_token, request_data=request.GET ) except TelegramDataIsOutdatedError: return HttpResponse('Authentication was received more than a day ago.') except NotTelegramDataError: return HttpResponse('The data is not related to Telegram!') return HttpResponse('Hello, ' + result['first_name'] + '!')</span></span></code> </pre><br>  The function <b>verify_telegram_authentication</b> based on the received data from the request parameters and the bot token verifies the correctness of the data (verifies that you did not receive non-existent or fake data).  The authentication algorithm is described <a href="https://core.telegram.org/widgets/login">here</a> . <br><br><h2>  Examples </h2><br>  All necessary settings - <b>settings.py</b> <br><br><pre> <code class="python hljs">TELEGRAM_BOT_NAME = <span class="hljs-string"><span class="hljs-string">'django_telegram_login_bot'</span></span> TELEGRAM_BOT_TOKEN = <span class="hljs-string"><span class="hljs-string">'459236585:AAEee0Ba4fRijf1BRNbBO9W-Ar15F2xgV98'</span></span> TELEGRAM_LOGIN_REDIRECT_URL = <span class="hljs-string"><span class="hljs-string">'https://iyjjvnvszx.localtunnel.me/'</span></span></code> </pre><br>  This is how your <b>views.py</b> file may look like with the full implementation of user authorization via Telegram. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.conf <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> settings <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.http <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpResponse <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.shortcuts <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> render <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django_telegram_login.widgets.constants <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( SMALL, MEDIUM, LARGE, DISABLE_USER_PHOTO, ) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django_telegram_login.widgets.generator <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( create_callback_login_widget, create_redirect_login_widget, ) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django_telegram_login.authentication <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> verify_telegram_authentication <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django_telegram_login.errors <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( NotTelegramDataError, TelegramDataIsOutdatedError, ) bot_name = settings.TELEGRAM_BOT_NAME bot_token = settings.TELEGRAM_BOT_TOKEN redirect_url = settings.TELEGRAM_LOGIN_REDIRECT_URL <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># Initially, the index page may have no get params in URL # For example, if it is a home page, a user should be redirected from the widget if not request.GET.get('hash'): return HttpResponse('Handle the missing Telegram data in the response.') try: result = verify_telegram_authentication( bot_token=bot_token, request_data=request.GET ) except TelegramDataIsOutdatedError: return HttpResponse('Authentication was received more than a day ago.') except NotTelegramDataError: return HttpResponse('The data is not related to Telegram!') # Or handle it like you want. For example, save to DB. :) return HttpResponse('Hello, ' + result['first_name'] + '!') def callback(request): telegram_login_widget = create_callback_login_widget(bot_name, size=SMALL) context = {'telegram_login_widget': telegram_login_widget} return render(request, 'telegram_auth/callback.html', context) def redirect(request): telegram_login_widget = create_redirect_login_widget( redirect_url, bot_name, size=LARGE, user_photo=DISABLE_USER_PHOTO ) context = {'telegram_login_widget': telegram_login_widget} return render(request, 'telegram_auth/redirect.html', context)</span></span></code> </pre><br>  Template for <b>callback</b> login - <b>callback.html</b> <br><br><pre> <code class="javascript hljs">It is template to render callback Telegram widget! <span class="xml"><span class="hljs-comment"><span class="xml"><span class="hljs-comment">&lt;!-- {{ telegram_login_widget|safe }} --&gt;</span></span></span><span class="xml"> {% autoescape off %}{{ telegram_login_widget }}{% endautoescape %} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="actionscript"><span class="xml"><span class="actionscript"> </span></span><span class="hljs-function"><span class="hljs-keyword"><span class="xml"><span class="actionscript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span><span class="xml"><span class="actionscript"><span class="hljs-function"> </span></span></span><span class="hljs-title"><span class="xml"><span class="actionscript"><span class="hljs-function"><span class="hljs-title">onTelegramAuth</span></span></span></span></span><span class="hljs-params"><span class="xml"><span class="actionscript"><span class="hljs-function"><span class="hljs-params">(user)</span></span></span></span></span><span class="xml"><span class="actionscript"><span class="hljs-function"> </span></span></span></span><span class="xml"><span class="actionscript">{ alert(</span></span><span class="hljs-string"><span class="xml"><span class="actionscript"><span class="hljs-string">'Logged in as '</span></span></span></span><span class="xml"><span class="actionscript"> + user.first_name + </span></span><span class="hljs-string"><span class="xml"><span class="actionscript"><span class="hljs-string">' '</span></span></span></span><span class="xml"><span class="actionscript"> + user.last_name + </span></span><span class="hljs-string"><span class="xml"><span class="actionscript"><span class="hljs-string">'!'</span></span></span></span><span class="xml"><span class="actionscript">); } </span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  Template for <b>redirect</b> login - <b>redirect.html</b> <br><br><pre> <code class="javascript hljs">It is template to render redirect Telegram widget! <span class="xml"><span class="hljs-comment"><span class="xml"><span class="hljs-comment">&lt;!-- {{ telegram_login_widget|safe }} --&gt;</span></span></span><span class="xml"> {% autoescape off %}{{ telegram_login_widget }}{% endautoescape %}</span></span></code> </pre><br>  Thanks for attention.  Send feedback and suggestions to your personal mail.  If you are interested in <b>django-telegram-login</b> , go to <a href="https://github.com/dmytrostriletskyi/django-telegram-login">the project page on Github</a> . </div><p>Source: <a href="https://habr.com/ru/post/348952/">https://habr.com/ru/post/348952/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../348938/index.html">Fastest Indian: Key / Value Trie-Based Container</a></li>
<li><a href="../348942/index.html">How to "learn to learn." Part 2 - Metacognitive Processes and Dudling</a></li>
<li><a href="../348944/index.html">Installation of a certification authority in the enterprise. Part 1</a></li>
<li><a href="../348946/index.html">Why you should not use a two-tier architecture in developing client-server applications</a></li>
<li><a href="../348950/index.html">Layout of a collection of abstracts of the conference in LaTeX</a></li>
<li><a href="../348956/index.html">Installation of a certification authority in the enterprise. Part 2</a></li>
<li><a href="../348960/index.html">Applying the observer pattern in Redux and Mobx</a></li>
<li><a href="../348962/index.html">English version of Habr: to be or not to be?</a></li>
<li><a href="../348964/index.html">Develop isomorphic RealWorld applications with SSR and Progressive Enhancement. Part 1 - Introduction and Stack Selection</a></li>
<li><a href="../348966/index.html">Psychological portrait using neural network and ordinary camera</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>