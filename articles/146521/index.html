<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to reanimate your PHP project using symfony2 components</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This post is not a translation of the article, as is customary, but of the report + presentation, therefore the text of the post is quite voluntary. 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to reanimate your PHP project using symfony2 components</h1><div class="post__text post__text-html js-mediator-article">  <i>This post is not a translation of the article, as is customary, but of the report + presentation, therefore the text of the post is quite voluntary.</i> <br><br>  I think everyone knows and obviously that PHP is one of the most popular programming languages ‚Äã‚Äãin which many web projects are written, starting with personal homepage pages and ending with mastodons like Facebook, Vimeo, WordPress and even YouPorn. <br><br>  PHP appeared in 1995, with full support for the PLO was only implemented in PHP5, which was released in 2005.  During this time, a large amount of code was written, both good and bad, and more precisely, it was strongly outdated and heavily followed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Many projects, as well as the PHP ecosystem as a whole, by now have begun to present a semblance of a busy urban quarter. <br><br><img src="https://habrastorage.org/storage2/e6b/5d6/e1b/e6b5d6e1b4bb0cc152ed6347f61a73dc.jpeg"><a name="habracut"></a><br><br><h4>  New versions of PHP </h4><br>  The new decade brought us PHP5.3 and PHP5.4, which, in addition to increasing the performance, carry a lot of buns!  Here are just some of them: <br><br>  1. <a href="http://www.php.net/manual/ru/language.namespaces.php">Namespaces</a> (php 5.3) <br><br><pre><code class="php hljs">Ôøº<span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">JoliCode</span></span>\<span class="hljs-title"><span class="hljs-title">Conferences</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">General</span></span>\<span class="hljs-title"><span class="hljs-title">Talk</span></span>\<span class="hljs-title"><span class="hljs-title">Session</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SymfonyLive</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Session</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runPresentation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre> <br><ul><li>  They save from coincidences in the naming of classes; </li><li>  Reduce uncertainty; </li><li>  Avoiding long class naming. </li></ul><br>  2. <a href="http://php.net/manual/ru/functions.anonymous.php">Anonymous functions and closures</a> (php 5.3), and even inside objects (php 5.4) <br><br><pre> <code class="php hljs">$container[<span class="hljs-string"><span class="hljs-string">'session'</span></span>] = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Session($c[<span class="hljs-string"><span class="hljs-string">'session_storage'</span></span>]); };</code> </pre><br>  3. <a href="http://www.php.net/manual/ru/book.phar.php">Phar archives</a> (php 5.3) <br><br>  Allowed to distribute libraries in the form of one connected phar-file. <br><br>  4. <a href="http://php.net/manual/ru/control-structures.goto.php">‚Äúgoto‚Äù</a> - what for .. ??  (php 5.3) <br><br>  5. <a href="http://www.php.net/manual/ru/language.oop5.traits.php">Traits</a> (php 5.4) <br><br>  6. Short syntax of array declaration!  (php 5.4) <br><br><pre> <code class="php hljs">Ôøº<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fruits</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'apple'</span></span>, <span class="hljs-string"><span class="hljs-string">'banana'</span></span>, <span class="hljs-string"><span class="hljs-string">'orange'</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> fruits()[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// Outputs: apple Ôøº</span></span></code> </pre> <br>  and <a href="http://www.php.net/manual/ru/migration53.new-features.php">many</a> other <a href="http://www.php.net/manual/ru/migration54.new-features.php">things</a> . <br><br><h4>  Frameworks </h4><br>  New versions of PHP have become a catalyst for the emergence of frameworks.  Among them, symfony, Zend Framework, Yii, CodeIgniter, CakePHP are worth mentioning.  Almost all of them have been significantly updated in the released second versions. <br><br>  One of these frameworks, Symfony2, is built on a <a href="http://symfony.com/doc/current/components/index.html" title="Symfony components">set of independent components</a> , as well as a number of third-party solutions that use the new features of the PHP language and help you reanimate projects with outdated code. <br><br><h4>  Project resuscitation strategy </h4><br>  Imagine that your project has existed for 5 years.  During this time: <br><br><ul><li>  A large amount of functionality has been implemented; </li><li>  The project works in production; </li><li>  It is constantly used by a large audience of users; </li><li>  A large amount of data has accumulated; </li><li>  An experienced team has been formed around the project. </li></ul><br>  Wherein: <br><br><ul><li>  Slowly the introduction of new functionality; </li><li>  The problem with the support of the project and its infrastructure; </li><li>  It is difficult to improve the existing functionality. </li></ul><br><img src="https://habrastorage.org/storage2/2ca/e40/6f6/2cae406f6d82d585d438fd8b6d8224b8.png"><br><br><h5>  Path 1: The Big Bang </h5><br>  The most natural desire in such a situation is <b>to throw out all the code and rewrite it again!</b>  Imagine that we went this way.  Undoubtedly, we will get satisfaction from the possibility of working with one of the new modern framework, forgetting about the old code, and in some places bydlokod, like a bad dream. <br><br>  But, frankly, the process is likely to be quite large-scale, difficult and lengthy and will take at least 1 person-year to rewrite all the functionality.  At the same time, the development of the existing version of the project will stop, which will cause financial losses to your project‚Äôs business and outflow of users who are not given enough attention.  There will also be high risks that it will not be possible to fully transfer all the functionality to the new platform.  One of the reasons for these risks will be the need to develop tools for migrating existing data to a new structure of storage systems. <br><br><h5>  Path 2: Be consistent </h5><br>  Therefore it is not necessary to chop off the shoulder, the strategy of gradual updating of the project will be more reasonable.  At the same time, the development and support of the project will not stop, and therefore your business will not stop either.  This approach will not allow the use of the new framework entirely in the project, but you can use its individual parts.  The components of symfony2 in this case are very well suited, since  they have no dependencies, while they provide point and seamless functionality. <br><br><h4>  Go to action </h4><br><h5>  Step 1. Translate the project into PHP 5.3 or PHP 5.4 </h5><br><img src="https://habrastorage.org/storage2/592/1bc/6ab/5921bc6abe133dc81fe8983b9c9e9384.png"><br><br>  First we update PHP to at least PHP 5.3.  We do this carefully, we will perform the update first on the dev-server and check that no parts of the system have fallen off.  Then you can check on the prod server.  At the same time, it is advisable to do this not on the whole project, but in the A / B testing mode, so that only some users will get to the new environment. <br><br>  Once you are convinced that everything is working fine, you can move on. <br><br><h5>  Step 2. Prepare the foundation for future refactoring of the system </h5><br><img src="https://habrastorage.org/storage2/d25/be3/c93/d25be3c93798cca73875c6d414a82eb1.png"><br><br>  We connect key components: ClassLoader, DependencyInjection and HTTPFoundation.  They will help us with refactoring and will be the foundation for connecting new components. <br><br>  These and all the following components can be easily connected using the <a href="http://getcomposer.org/">Composer</a> package manager.  It allows you to concisely describe the dependencies of the project on third-party libraries in json-format, automatically install and update them, and also generate an autoload-file to connect them to the project.  On Habr√© there is a <a href="http://habrahabr.ru/post/145946/">good article</a> on how to use it. <br><br>  In our case, the configuration file for Composer will look like this: <br><br><pre> <code class="javascript hljs">Ôøº{ <span class="hljs-string"><span class="hljs-string">"autoload"</span></span>: { <span class="hljs-string"><span class="hljs-string">"psr-0"</span></span>: {} }, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"xavierlacot/blog"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"My old blog on steroids"</span></span>, <span class="hljs-string"><span class="hljs-string">"require"</span></span>: { <span class="hljs-string"><span class="hljs-string">"php"</span></span>: <span class="hljs-string"><span class="hljs-string">"&gt;=5.3.3"</span></span>, <span class="hljs-string"><span class="hljs-string">"symfony/class-loader"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.1.*"</span></span>, <span class="hljs-string"><span class="hljs-string">"symfony/dependency-injection"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.1.*"</span></span>, <span class="hljs-string"><span class="hljs-string">"symfony/http-foundation"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.1.*"</span></span> } }</code> </pre><br>  Install the components: <br><br><pre> <code class="bash hljs">Ôøº$ php composer.phar install Installing dependencies from lock file - Updating symfony/class-loader (dev-master)</code> </pre><br>  And we connect them to our project: <br><br><pre> <code class="php hljs">Ôøº<span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//    Composer  require 'vendor/autoload.php';</span></span></code> </pre><br>  Now we can use them! <br><br><h5>  ClassLoader.  Standards for class autoload </h5><br>  A year and a half ago, the PHP community made several agreements, one of which, the <a href="">PSR-0 agreement</a> , describes the rules and code requirements for compatibility with modern class autoloaders (the history of autoloaders is well written <a href="http://phpmaster.com/autoloading-and-the-psr-0-standard/">here</a> and <a href="http://xipp.wordpress.com/2012/02/14/%25D0%25B0%25D0%25B2%25D1%2582%25D0%25BE%25D0%25BC%25D0%25B0%25D1%2582%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F-%25D0%25B7%25D0%25B0%25D0%25B3%25D1%2580%25D1%2583%25D0%25B7%25D0%25BA%25D0%25B0-%25D0%25BA%25D0%25BB%25D0%25B0%25D1%2581%25D1%2581%25D0%25BE%25D0%25B2-%25D0%25B2-php-%25D0%25B8-psr-0/">here</a> ) <br><br>  In short, the standard allows two types of class naming: <br><br>  <i>Via namespace (modern approach)</i> <br><pre> <code class="php hljs">Ôøº<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Symfony</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HttpFoundation</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Request</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">path</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">vendor</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">src</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Symfony</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HttpFoundation</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Request</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span></span></code> </pre><br>  <i>Through underscores (PEAR standard, outdated approach)</i> <br><pre> <code class="php hljs">Ôøº<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Twig_Extension_Core</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">path</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">vendor</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">twig</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lib</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Twig</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Extension</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Core</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span></span></code> </pre><br>  At the same time, when the class file is connected, the autoloader automatically replaces the slash (\) and underscore (_) characters with the directory separator (/), adding the .php extension to the end. <br><br>  The <a href="http://symfony.com/doc/current/components/class_loader.html">ClassLoader</a> component allows <a href="http://symfony.com/doc/current/components/class_loader.html">you</a> to organize autoloading of classes in accordance with the PSR-0 convention. <br><br><h5>  Step 3. Class refactoring and using ClassLoader </h5><br>  For example, we have a class for working with LDAP: <br><br><pre> <code class="php hljs">Ôøº<span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">prefixedLdapConnector</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// -  } }</span></span></code> </pre><br>  We bring it to the PSR-0 standard: <br><br><pre> <code class="php hljs">Ôøº<span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Prefix</span></span>\<span class="hljs-title"><span class="hljs-title">Ldap</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Client</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// -  } }</span></span></code> </pre><br>  Register the Prefix top-level space in the ClassLoader: <br><br><pre> <code class="php hljs">Ôøº<span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">ClassLoader</span></span>\<span class="hljs-title"><span class="hljs-title">UniversalClassLoader</span></span>; $loader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UniversalClassLoader(); $loader-&gt;registerNamespace(<span class="hljs-string"><span class="hljs-string">'Prefix'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/src/'</span></span>); $loader-&gt;register();</code> </pre><br>  Now when using the Prefix \ Ldap \ Client class in your code, ClassLoader will take care of its automatic loading: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//    ClassLoader use Prefix\Ldap\Client; $client = new Client();</span></span></code> </pre><br><br><h5>  Step 4. Refactoring request processing / response preparation.  Using HttpFoundation </h5><br><img src="http://habrastorage.org/storage2/d83/4cc/af3/d834ccaf3de817bddc29c86747495f46.png"><br><br>  The <a href="http_foundation/introduction.html">HTTPFoundation</a> component simplifies the processing of incoming requests and the preparation of a server response. <br><br>  Adding 2 lines to the project: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//     ClassLoader,    Ôøºuse Symfony\Component\HttpFoundation\Request; //     Request  HTTPFoundation $request = Request::createFromGlobals();</span></span></code> </pre><br><br>  we get the $ request object, which knows everything about the incoming request: <br><br><ul><li>  $ request-&gt; request replaces $ _POST </li><li>  $ request-&gt; query replaces $ _GET </li><li>  $ request-&gt; cookies replace $ _COOKIE </li><li>  etc. </li></ul><br><br>  And similarly with Response: <br><br><pre> <code class="php hljs">Ôøº<span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">HttpFoundation</span></span>\<span class="hljs-title"><span class="hljs-title">Response</span></span>; $response = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Response(); Ôøº$response-&gt;setContent(<span class="hljs-string"><span class="hljs-string">'This will be the response content'</span></span>); $response-&gt;headers-&gt;set(<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/html'</span></span>); $response-&gt;setStatusCode(<span class="hljs-number"><span class="hljs-number">200</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   Response $response-&gt;prepare($request); $response-&gt;send();</span></span></code> </pre><br><br>  It would seem, why replace the usual PHP variables and methods with new classes.  In fact, this approach has a number of advantages.  First, it allows you to enter a more understandable level of abstraction for working with data request and response, presented in the form of objects.  You can fully control the request and response from any area of ‚Äã‚Äãyour project.  Secondly, this component has <a href="http://symfony.com/blog/symfony2-security-audit">been tested by many independent developers</a> for compliance with security requirements.  Third, the code that uses HTTPFoundation is much easier to test. <br><br><h5>  Step 5. We make the project functionality in services.  Dependency Injection Component </h5><br>  In almost all projects, there are a number of functions for which different libraries, classes, or even program functions are responsible.  The Dependency Injection component allows you to organize and centralize the process of creating and configuring objects that implement this or that functionality.  Such objects may include the postal service, database manager, template engine and many others. <br><br><img src="http://habrastorage.org/storage2/60c/855/1c7/60c8551c75bae42e6e5f09b036fb9453.png"><br><br>  Suppose we have a class for sending emails: <br><br><pre> <code class="php hljs">Ôøº<span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Prefix</span></span>\<span class="hljs-title"><span class="hljs-title">Mailer</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mailer</span></span></span><span class="hljs-class"> </span></span>{ $prefix = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($to, $subject, $body)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  } }</span></span></code> </pre><br><br>  And in our code, mail is sent like this: <br><br><pre> <code class="php hljs">Ôøº<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name, $email)</span></span></span><span class="hljs-function"> </span></span>{ $mailer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mailer(); $mailer-&gt;send($user-&gt;getEmail(), <span class="hljs-string"><span class="hljs-string">'Welcome '</span></span> . $user-&gt;getName(), <span class="hljs-string"><span class="hljs-string">'A test'</span></span>); }</code> </pre><br><br>  Let's do a little refactoring, create a service container and register our mail class in it: <br><br><pre> <code class="php hljs">Ôøº<span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">DependencyInjection</span></span>\<span class="hljs-title"><span class="hljs-title">ContainerBuilder</span></span>; $container = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ContainerBuilder(); $container-&gt;register(<span class="hljs-string"><span class="hljs-string">'mailer'</span></span>, <span class="hljs-string"><span class="hljs-string">'Mailer'</span></span>);</code> </pre><br><br>  Let's do the second small refactoring in the lines of sending a letter: <br><br><pre> <code class="php hljs">Ôøº<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name, $email)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// stuff here $mailer = $this-&gt;container-&gt;get('mailer'); $mailer-&gt;send($user-&gt;getEmail(), 'Welcome '.$user-&gt;getName(), 'A test'); }</span></span></code> </pre><br><br>  These minor changes give several bonuses at once: <br><br><ul><li>  The object of the Mailer class is created only once, even if we receive it from the service container elsewhere in the project; </li><li>  Mailer service can now be centrally configured; </li><li>  It is easy to replace it with another service. </li></ul><br><br>  Similarly, it is possible to design one library of a project after another in the form of services by organizing all the work through service calls. <br><br><h5>  Step 6. What's next? </h5><br>  Having connected the first three components of Symfony2, you can start using other equally <a href="http://symfony.com/doc/current/components/index.html">useful components</a> using the same algorithm: <br><br><ul><li>  <a href="http://symfony.com/doc/current/components/console.html">Console</a> - development of console scripts (called from the command line or by cron) </li><li>  <a href="http://symfony.com/doc/current/components/finder.html">Finder</a> - search for files and folders </li><li>  <a href="http://symfony.com/doc/current/components/routing.html">Routing</a> - allows you to set the correspondence between HTTP requests and a set of configurable parameters </li><li>  <a href="http://symfony.com/doc/current/components/templating.html">Templating</a> - will provide everything you need to work with templates in the project </li><li>  other. </li></ul><br><br>  Step by step, component by component, your project will be gradually transformed and acquire a new life without any radical solutions.  Good luck and enjoy refactoring! </div><p>Source: <a href="https://habr.com/ru/post/146521/">https://habr.com/ru/post/146521/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146513/index.html">Americans have created a sensitive "skin" for the robot</a></li>
<li><a href="../146516/index.html">Facebook generated email addresses to all users</a></li>
<li><a href="../146517/index.html">Beeline turned on traffic filtering</a></li>
<li><a href="../146518/index.html">Windows 8. Contract "search" in detail</a></li>
<li><a href="../146520/index.html">Architecture plus1.wapstart.ru</a></li>
<li><a href="../146522/index.html">Google's advertising budget exceeded $ 2 billion</a></li>
<li><a href="../146523/index.html">High-resolution Bing cards will show Europe and the United States by the end of the year.</a></li>
<li><a href="../146524/index.html">TechRadar leaked user personal data</a></li>
<li><a href="../146525/index.html">Modernization of the protected General Dynamics (Itronix) XR-1 (IX270) laptop</a></li>
<li><a href="../146530/index.html">Fan-clip for MSI Z77A-GD65 motherboard. I need advice</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>