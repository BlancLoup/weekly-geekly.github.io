<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Extreme testing of PostgreSQL 9.1 streaming replication</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There was a task to introduce Postgresql 9.1 streaming replication in production. And since they hadn‚Äôt dealt with her before; they decided to conduct...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Extreme testing of PostgreSQL 9.1 streaming replication</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/78a/3cf/3b3/78a3cf3b3e9915129c9f5c002f176c23.jpg" alt="image" align="left">  There was a task to introduce Postgresql 9.1 streaming replication in production.  And since  they hadn‚Äôt dealt with her before; they decided to conduct her ‚Äúextreme testing‚Äù. <br><br>  To do this, two VMWare Player virtual machines were running from Ubuntu Server.  Installed and configured streaming replication on Postgresql 9.1. <br><a name="habracut"></a><br><h4>  Sync speed </h4><br>  A script was launched from the host machine, adding multiple rows to the test table of the replicated database in a loop.  The script was run in 3 threads. <br><br>  On virtual machines, a load was created both on the processor (an infinite loop in bash) and reading data from the test table.  The uneven load was also checked - it was switched off on the slave, then on the master. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The results were a very nice picture.  Although they were rated "by eye", out of sync was not seen for more than 1-2 seconds.  And then, such a desynchronization occurred only with a very high load (several parallel load processes) and for a short time. <br><br><h4>  Power outage stability </h4><br><h5>  fsync = off </h5><br>  To speed up the update and paste operations, the previous version of Postgresql was used with the fsync = off option.  The replication behavior was tested when fsync is disabled and the virtual machine is turned off hard (power-off simulation). <br><br>  The results were quite predictable.  After its launch and recovery of the database, it turned out that the current point in the binary log on master is earlier than the processed point on the slave.  Those.  the database is completely out of sync and servers need to be synchronized from scratch (according to the usual procedure for creating a slave database, copying the entire data directory). <br><br><h5>  fsync = on </h5><br>  After server synchronization, replication behavior was tested when fsync is enabled. <br><br>  With the ‚Äúhard‚Äù shutdown of the salve, nothing much happened.  He rose and ‚Äúcaught up‚Äù with the master magazine. <br><br>  More interesting is the situation when master is disabled.  With its accurate disconnection of the type ‚Äúdisconnected, waited, turned on, checked‚Äù, everything was normal.  The base was raised, restored and synchronized with the slave. <br><br>  Next was the simulation of "flashing electricity" in the data center.  The master server was ‚Äúhard‚Äù reloaded several times at arbitrary points in time.  Typically, these moments fell at the time of the Postgresql server launch or a little later.  As a result, the base on the master went up normally, but there were some minor problems with the slave.  In the slave log, messages about the wrong size of some transaction record started popping up and it was not synchronized with the master.  However, when restarting Postgresql on the slave, everything worked fine again. <br><br><h4>  Insert speed depending on the fsync value </h4><br>  The dependence of the insertion speed on the fsync value was tested in several cycles.  According to the results, with fsync = off, the speed is about 3.3% higher.  Is it worth such an acceleration of the loss of the base when the power is turned off - everyone should decide for themselves.  I personally intend to use Postgresql exclusively with fsync = on. <br><br><h4>  Switching the slave to master mode using a file trigger </h4><br>  Switching works well.  But there is one "but."  With this switch, the slave becomes a completely independent master.  Those.  It is impossible to return it to the slave state without full synchronization with the master.  This is due to the fact that a new timeline is being created on it - the timeline.  Also, in consequence of this, if you use several slaves, all the others are disconnected from the new master.  And for their connection requires their complete synchronization. <br><br><h4>  Results </h4><br>  As a result of these tests, I personally became confident that streming replication in Postgresql 9.1 is fully functional and reliable. </div><p>Source: <a href="https://habr.com/ru/post/133755/">https://habr.com/ru/post/133755/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../13375/index.html">BioTetris: calm down and hit records</a></li>
<li><a href="../133750/index.html">MapReduce for beginners on Erlang'e</a></li>
<li><a href="../133751/index.html">Improving notifications from HP OpenView Service Desk</a></li>
<li><a href="../133753/index.html">Captcha 2.0 - work on bugs</a></li>
<li><a href="../133754/index.html">Qt Components for Desktop</a></li>
<li><a href="../133757/index.html">A bug with various saves in the admin MODX Revolution in Opera (Eternal download)</a></li>
<li><a href="../133758/index.html">Finish fullcalendar</a></li>
<li><a href="../133759/index.html">Amazon Kindle Fire - partial Russification</a></li>
<li><a href="../13376/index.html">Yuri Sinodov: "The RuNet is still not competitive"</a></li>
<li><a href="../133760/index.html">iBar from MAC G4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>