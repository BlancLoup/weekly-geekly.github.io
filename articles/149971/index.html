<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a Windows Azure Virtual Machine for hosting web applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day! 

 In my previous article, I talked about how you can easily publish a web application written in ASP.NET MVC 4 in the new Windows Azure Web...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a Windows Azure Virtual Machine for hosting web applications</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/37b/965/4e6/37b9654e66f4fd21c75a90340feab637.png" alt="image"><br>  Good day! <br><br>  In my <a href="http://habrahabr.ru/post/147162/">previous article,</a> I talked about how you can easily publish a web application written in ASP.NET MVC 4 in the new Windows Azure Web Sites service. <br><br>  In today's article, I will try to tell you how you can expand the boundaries of using Azure using the example of creating a virtual machine in it and hosting a web application on it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Step 0. Access. </h4><br>  For those who are too lazy to click on the link at the beginning of the article, I remind you how you can get free access to new features of Windows Azure. <br><br>  First, you need to register for the <a href="http://www.windowsazure.com/ru-ru/pricing/free-trial/">90-day trial</a> , and then add to your subscription new preview functions (the very ones in question).  This is done on the <a href="http://account.windowsazure.com/PreviewFeatures/">Preview Components</a> page, where you can choose what you want to try.  In this case, choose <i>Virtual Machine</i> . <br><a name="habracut"></a><br><h4>  Step 1. Create a virtual machine </h4><br>  Once we have access to the components of Windows Azure, it's time to start using them.  To do this, select the Virtual Machines item in <a href="https://manage.windowsazure.com/">the management portal</a> and at the bottom of the page, click the big plus button (you won't miss): <br><img src="https://habrastorage.org/storage2/3e8/270/1be/3e82701be26c37f621ac69431d58e549.png"><br><br>  Two items will be available to us: Quick Create and From Gallery.  In fact, the difference between them is small, so consider a more complete path.  Choose <i>From Gallery</i> : <br><img src="https://habrastorage.org/storage2/3b2/9a0/b2e/3b29a0b2e50f01d44968b6ec3c9f38c0.png"><br><br>  In this dialog box we have several options to choose from.  To begin with, in addition to ready-made OS images (seen in the screenshot), we also have the opportunity to upload our own image or a VHD disk, from which a virtual machine will be created later.  It will be convenient for large projects where you need to create a farm of identical machines, without bothering with setting up each of them.  We are not interested in it now, so we turn our eyes on the available ready-made images. <br><br>  There are several options to choose from.  There is Windows Server 2008 R2 (two versions), Linux machines, a specialized server for SQL Server (about this image, by the way, they recently <a href="http://habrahabr.ru/company/microsoft/blog/149307/">wrote on Habr√©</a> ) and the hero of our experiment today - Windows Server 2012. Why him?  This is my personal choice.  Since I use Windows Azure so far more for informational purposes, I decided that it would be nice to try the ‚Äúnew product of the season‚Äù - the new server 2012. <br><br>  So, choose the OS we need and click the arrow below.  We get to the next screen of the virtual machine creation wizard: <br><img src="https://habrastorage.org/storage2/e9a/8f1/941/e9a8f1941fedc502251cb2ab7edb2da1.png"><br><br>  Everything is pretty clear here.  You must specify the name of the VM, the administrator password and select one of the proposed configurations of the future hardware.  The selection is pretty good and can cover most of the performance requirements for different types of project.  I chose Small, which suits me perfectly.  Go ahead. <br><br>  At the third step of the wizard, everything is also pretty clear: <br><img src="https://habrastorage.org/storage2/646/b9c/7f6/646b9c7f6fe517010ea23796cbf19fae.png"><br><br>  First you need to decide on the appointment of a future car.  If we want to use it as an independent resource (and at the moment we just want it), then choose <i>Standalone</i> .  <i>Connect To</i> mode, as written in the tooltip, will allow us to connect this VM to some existing network for load sharing.  We are not interested in it yet. <br><br>  Then you need to come up with the name of the host on which the machine will be available.  Here it is necessary not to confuse the name of the machine in the previous step and the given name of the host.  The machine name is the computer name in Windows.  The host name is a subdomain in the cloudapp.net domain, through which the server will be accessed and controlled.  This name must be unique, so we are immediately given a hint in the wizard about the availability or employment of a particular name. <br><br>  The remaining fields are quite understandable and you shouldn‚Äôt particularly focus on them.  There you have to choose a storage account (either existing or create a new one), VM location and subscription, under which this machine will be charged. <br><br>  In the fourth step, you don‚Äôt need to do anything at all; leave it as it is: <br><img src="https://habrastorage.org/storage2/6a2/308/78e/6a230878e737ea736737d550a68716fc.png"><br><br>  Click on the checkbox below, and the virtual machine will start to be created. <br><br><h4>  Step 2. Managing the virtual machine </h4><br>  Once you have created a virtual machine, it will be available in the appropriate list: <br><img src="https://habrastorage.org/storage2/1a7/b20/246/1a7b202467c4a024ea4125c7ce0de395.png"><br><br>  Be sure to wait until the machine status changes from <i>Provisioning</i> to <i>Running</i> .  This will mean that the machine is ready for use.  If you click on its name, the virtual machine control panel will open: <br><img src="https://habrastorage.org/storage2/7b5/390/bc2/7b5390bc292914c9c83ffed82ff1d422.png"><br><br>  At the bottom of the page there is a <i>Connect</i> button.  It will help you get the right rdp file to connect to this machine using remote desktop.  It's time to go to the fresh server and manage them. <br><br><h4>  Step 3. Server Management </h4><br>  In fact, in this article I will not talk in detail about the administration of Windows Server 2012. Since the title of this article mentions web applications, this is what we are going to do - install IIS. <br><br>  When you first login to the new server, the Server Manager window will open: <br><img src="https://habrastorage.org/storage2/3ca/160/15b/3ca16015ba120545c373f4df9d778762.png"><br><br>  By default, IIS is not included in Windows Server 2012, so you need to add them.  Select <i>Add roles and features</i> , and then the Add Roles Wizard opens.  Click Next three times (especially curious people read what they write there, but now we are not interested), and in the opened tree select the <i>Web Server (IIS)</i> .  Next, we need to choose the necessary IIS components that will allow running ASP.NET MVC applications on it.  I will not write the exact settings, everyone will decide for himself exactly what he needs.  Be sure to include ASP.NET, the rest to taste. <br><br>  We click Next several times, configure the future role as we need it and after the installation process is completed, our server is happy to receive guests.  You can verify this by going to <a href="http://localhost/">localhost</a> .  Something like this should appear: <br><img src="https://habrastorage.org/storage2/44d/fe5/ecf/44dfe5ecf3be3f9c32966477313119d5.png"><br><br><h4>  Step 4. Opening Access </h4><br>  Everything is great, so we finally set up a web server, placed some application on it and it opens on localhost.  How now to open it from the outside?  In fact, everything is quite simple.  Surely, at the stage of creating a virtual machine, you tried to click on the link in the control panel, which looks like &lt;your_virut_machine&gt; .cloudapp.net.  And surely you did not see anything.  This is because access to the virtual machine is closed from the outside, and not at the level of the firewall of the operating system itself, but at the level of the Windows Azure infrastructure. <br><br>  If you look up at the virtual machine control panel, you will see three menu items there: <i>Dashboard</i> , <i>Endpoints</i> and <i>Configure</i> .  We figured out the first one at the very beginning, everything is clear with the latter - the hardware parameters are configured there, but let's look at what Endpoints are. <br><br>  In the Endpoints tab, we can specify which protocols and ports will be open for this virtual machine and to which physical ports they will be redirected: <br><img src="https://habrastorage.org/storage2/7d2/0d5/f2e/7d20d5f2eda7a846c7a97c1d05854c67.png"><br><br>  By default, there will be only one port in this list ‚Äî the one through which you connect via Remote Desktop.  Moreover, the public port can be anything that, apparently, is made for greater security.  In order to open web applications on this virtual machine, you need to open the 80th port.  The screenshot above shows this.  After this action on the link &lt;your_virut_mashina&gt; .cloudapp.net you will need to see your own application.  A small victory has been achieved. <br><br><h4>  Step 5. Assigning your own domain </h4><br>  In the previous step, we did everything to make the application work in the cloud and be accessible from the outside.  However, you will agree that it would not be at all cool if we could access it only by subdomain and in no way could we assign our own one or several domains. <br><br>  Of course, this is possible and quite simple.  For this official documentation advises two different ways and both of them are associated with editing the DNS zone.  The first implies that you create a CNAME record, which indicates that, for example, <a href="http://www.mydomain.com/">www.mydomain.com</a> will be redirected to mywinazure.cloudapp.net.  This method is simple, but too straightforward.  If you have several web applications on the server, or there may be several subdomains on the main domain, this method will not work.  Fortunately, there is a second, better way. <br><br>  As a solution, which, by the way, I used, editing A records in the DNS zone is proposed.  In the control panel of the virtual machine, in the area on the right, you might notice two IP addresses.  One is called private and is the IP of the machine itself, and the second is public, virtual (Virtual IP, VIP).  That's it, and it must be specified in zone A for the edited domain.  In this case, all traffic will be sent to your virtual machine, where IIS will determine the domain and issue the appropriate application (provided that Web Sites are correctly configured in IIS itself).  Everything is simple and obvious to the obscene, but this is how it works. <br><br><h4>  Step 6. Bonus </h4><br>  As a bonus, I will talk about an example of integrating one Windows Azure service with another.  If you read my previous article, then you know that in it I described the service of facts about programming.  Within that article, I described the process of publishing an ASP.NET MVC 4 application to the cloud using Windows Azure Web Sites and the Windows Azure SQL Database.  Now, while studying Virtual Machines, I decided to transfer the same service from Web Sites to a virtual machine in order to be able to bind my own domain, and generally to have everything in one place (now several websites are hosted in VM). <br><br>  I transferred the files of the application itself painlessly.  But when I remembered the base, I was a little sad at first.  I immediately imagined that I would have to download the distribution first, then allocate some place for it.  Start the database service on the already not the fastest machine.  Have a database and web application on the same server.  Transfer data from one server to another.  Well, a few more similar troubles.  Not to say that it was so hard, but, frankly, lazy. <br><br>  And then I thought - what if I set up an application hosted in a virtual machine on a database that was created as part of hosting the site on Web Sites?  Indeed, from the point of view of the application, this database is exactly the same as if it were installed on a local server.  No sooner said than done.  I changed the web.config as necessary, specifying as the database server the same server that I had in Windows Azure.  And what would you think?  It is working.  Now I have a separate application server and a separate database, which can be independently replaced, expanded and mirrored if necessary.  Thank you Azure for such amenities. <br><br><h4>  Conclusion </h4><br>  On this pleasant note, I would like to finish the story.  I hope the material will be useful to novice Azure researchers and will help determine the choice of hosting for their web projects.  Just in case, I want to make sure that I am in no way affiliated with Microsoft and reflect only my personal point of view, without any advertising. <br><br>  If anyone is interested in seeing what kind of application is working in the cloud, then here are the links: <a href="http://prog-facts.ru/">prog-facts.ru</a> and <a href="http://ss10.ru/">ss10.ru</a> (the second just cited as an example that the two domains are perfectly forwarded to the same hosting). <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/149971/">https://habr.com/ru/post/149971/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../149966/index.html">EPIC Fail: While China will be introducing 4G in Ukrainian schools, the local 3G operator cannot find a buyer</a></li>
<li><a href="../149967/index.html">Manage power and ‚Äúreturn‚Äù Start in Windows 8</a></li>
<li><a href="../149968/index.html">Hackers from Anonymous on guard of morality of Russians</a></li>
<li><a href="../149969/index.html">Does it really matter whether Samsung Apple copies or not?</a></li>
<li><a href="../149970/index.html">3D printing: 3 hours per designer chair</a></li>
<li><a href="../149974/index.html">Creating Warcraft (Part 2)</a></li>
<li><a href="../149975/index.html">As we wrote SVG widgets for javascript</a></li>
<li><a href="../149976/index.html">Developers in Russia and India - the view of the technical director</a></li>
<li><a href="../149979/index.html">Qt5 Cinematic Experience</a></li>
<li><a href="../149982/index.html">Absolutely free hosting for your projects</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>