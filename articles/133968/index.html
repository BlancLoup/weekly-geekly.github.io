<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Flashlight for Windows Phone 7</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 I bought myself a VDNophone and decided to try to write something for it, especially since I am familiar with .NET by occupation. The idea ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Flashlight for Windows Phone 7</h1><div class="post__text post__text-html js-mediator-article"><h2>  Foreword </h2><br>  I bought myself a VDNophone and decided to try to write something for it, especially since I am familiar with .NET by occupation.  The idea was suggested by a friend with a flashlight android application, the light source of which was an LED flash. <a name="habracut"></a><br><br><br><h2>  First decision </h2><br>  I read <a href="http://msdn.microsoft.com/en-us/library/hh202949(v%3DVS.92).aspx">msdn</a> , everything seemed simple.  Create a <code>Microsoft.Devices.PhotoCamera</code> object;  see if our device supports flash photography;  if supported, then switch <code>PhotoCamera.FlashMode</code> , by pressing a button.  As Livanov would say: ‚ÄúElementary, Watson!‚Äù.  But it was not there. <br><br>  The first moment that puzzled me was the initialization of the camera.  Just creating a <code>Microsoft.Devices.PhotoCamera</code> object is not enough.  For these purposes, in the already familiar article on <a href="http://msdn.microsoft.com/en-us/library/hh202949(v%3DVS.92).aspx">msdn</a> , the installation of the created camera object is used as a source for <code>VideoBrush</code> .  This is an excessive load, as it seems to me, but I did not find other ways (maybe someone from the reader will tell).  By the way, I didn‚Äôt search tightly, because I was moving by another goal. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But the second moment stumped the described solution option.  As a result, at the touch of a button, we see that the display is illuminated, and the LED flash does not want to work.  Well, sadness. <br><br><br><h2>  Second solution </h2><br>  We are starting to dig further ... I was surprised to learn from Google that the guys from Microsoft had hidden some assemblies from the unenlightened (here are the villains). <br><br>  I found a craftsman on the <a href="http://www.codeproject.com/Articles/151485/Hacking-the-WP7-Camera-The-basics">codeproject</a> , who hacked the WP7 camera with the help of hidden features.  But the post itself is not so interesting as the links it provides for general use.  The idea is to, as described in <a href="http://thounsell.co.uk/2010/11/avoiding-reflection-adding-the-interopservices-library-to-the-wp7-sdk/">Tom's blog</a> , make the necessary assemblies available and use them for highlighting, as advised by the <a href="http://blogs.claritycon.com/kevinmarshall/2010/12/23/wp7-camera-access-flashlight-augmented-reality-and-barcode-scanning/">Clarity Consulting Blog</a> , <code>Microsoft.Devices.VideoCamera</code> . <br><br><br><h2>  Implementation </h2><br>  So, more than enough information, let's get down to business.  <a href="http://thounsell.co.uk/2010/11/avoiding-reflection-adding-the-interopservices-library-to-the-wp7-sdk/">Tom's blog</a> says that the easiest way is to get the necessary builds from the ‚ÄúEmulator BIN‚Äù or <a href="http://ifolder.ru/29320427">download</a> its own dump.  I did not understand what ‚ÄúEmulator BIN‚Äù is and did not bother for a long time, I took advantage of its work.  We take from the <i>GAC_Microsoft.Phone.Media.Extended_v7_0_0_0_cneutral_1.dll</i> archive and, to make it easier for us to add links next time to this build, copy it to the folder " <i>C: \ Program Files (x86) \ Reference Assemblies \ Microsoft \ Framework \ Silverlight \ v4 .0 \ Profile \ WindowsPhone71</i> "(need administrator rights) named <i>Microsoft.Phone.Media.Extended.dll</i> .  Naturally, one OS is on a different partition or not 64-bit, there will be small variations. <br>  Then open the folder named <i>RedistList</i> (it lies in the same directory as the file just copied), and in it is the file <i>FrameworkList.xml</i> .  It needs to be edited (I did it in the spotlight, for a folder with specific access rights).  Copy an arbitrary File node, for example, for <i>AssemblyName = "Microsoft.Phone.Interop"</i> , delete the PublicKeyToken node in the newly copied node and change the AssemblyName to <i>Microsoft.Phone.Media.Extended</i> . <br>  Now you need to open the visual studio command prompt and execute the <code>sn -Vr Microsoft.Phone.Media.Extended.dll</code> command, otherwise we will have errors when building the project with this build. <br><br><br>  Now the most pleasant thing is creating the application.  It is enough to create a regular Silverlight project for WP7 and add the <i>Microsoft.Phone.Media.Extended</i> assembly.  It will have a rather simple markup, the only thing that is worthy of attention here is the CameraVisualizer control, it displays the image captured from the camera (but we remember that we only need it to initialize the camera object).  And so that we are not distracted by the picture on the display, we will set this element to full opacity. <br>  Here is the markup <br><br><br><pre> <code class="cs hljs">&lt;phone:PhoneApplicationPage x:Class=<span class="hljs-string"><span class="hljs-string">"PhoneApp1.MainPage"</span></span> ... xmlns:media=<span class="hljs-string"><span class="hljs-string">"clr-namespace:Microsoft.Phone;assembly=Microsoft.Phone.Media.Extended"</span></span> ... shell:SystemTray.IsVisible=<span class="hljs-string"><span class="hljs-string">"False"</span></span>&gt; &lt;Grid x:Name=<span class="hljs-string"><span class="hljs-string">"LayoutRoot"</span></span> Background=<span class="hljs-string"><span class="hljs-string">"Transparent"</span></span>&gt; &lt;media:CameraVisualizer x:Name=<span class="hljs-string"><span class="hljs-string">"_cameraVisualizer"</span></span> Opacity=<span class="hljs-string"><span class="hljs-string">"0"</span></span> /&gt; &lt;Button x:Name=<span class="hljs-string"><span class="hljs-string">"_btnFlash"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"ButtonClick"</span></span> IsEnabled=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;Button.Content&gt; &lt;Image VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span> HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"300"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"300"</span></span> Source=<span class="hljs-string"><span class="hljs-string">"Power_On_Off.png"</span></span>/&gt; &lt;/Button.Content&gt; &lt;/Button&gt; &lt;/Grid&gt; &lt;/phone:PhoneApplicationPage&gt;</code> </pre><br><br>  It is also interesting that the code should indicate the need to use the LED flash <code>_videoCamera.LampEnabled = true;</code>  and the fact that the flashlight starts to work only while recording from the camera.  More precisely, the record itself will not, that is, the data stream will not occupy physical space. <br><br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Phone; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">PhoneApp1</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainPage</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> VideoCamera _videoCamera; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainPage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatedTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">System.Windows.Navigation.NavigationEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnNavigatedTo(e); InitializeCamera(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatedFrom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">System.Windows.Navigation.NavigationEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnNavigatedFrom(e); _videoCamera.Dispose(); _videoCamera = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeCamera</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _videoCamera = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VideoCamera(); <span class="hljs-comment"><span class="hljs-comment">//    _videoCamera.Initialized += VideoCameraInitialized; _cameraVisualizer.SetSource(_videoCamera);//    } void VideoCameraInitialized(object sender, System.EventArgs e) { _videoCamera.Initialized -= VideoCameraInitialized; _videoCamera.LampEnabled = true; //   !!! Dispatcher.BeginInvoke(() =&gt; { _btnFlash.IsEnabled = true; }); } private void ButtonClick(object sender, RoutedEventArgs e) { //   ,  .   ,  . if (_videoCamera.IsRecording) _videoCamera.StopRecording(); else _videoCamera.StartRecording(); } } }</span></span></code> </pre><br><br>  PS: Constructive criticism of the first topic and my presentation style is welcome. <br><br><h2>  Sources used </h2><br>  1 <a href="http://msdn.microsoft.com/en-us/library/hh202949(v%3DVS.92).aspx">msdn</a> <br>  2 <a href="http://www.codeproject.com/Articles/151485/Hacking-the-WP7-Camera-The-basics">codeproject</a> <br>  3 <a href="http://thounsell.co.uk/2010/11/avoiding-reflection-adding-the-interopservices-library-to-the-wp7-sdk/">Tom's blog</a> <br>  4 <a href="http://blogs.claritycon.com/kevinmarshall/2010/12/23/wp7-camera-access-flashlight-augmented-reality-and-barcode-scanning/">Clarity Consulting Blog</a> <br>  5 <a href="http://forum.xda-developers.com/showth2ead.php%3Fp%3D19188975">xda-developers</a> <br><habracut><br><br>  <b>UPD</b> Ladies and gentlemen, I understand perfectly well that someone liked the article, someone did not.  But in lichku write only those who positively reacted to the post as a whole, but have comments on certain points.  We kindly request - if you minus, leave a review that did not like.  It is important for me at the first stage to understand what I am doing wrong. </habracut></div><p>Source: <a href="https://habr.com/ru/post/133968/">https://habr.com/ru/post/133968/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../133963/index.html">Skype vulnerability allows you to determine the IP address of a particular user.</a></li>
<li><a href="../133964/index.html">Glory 1809 - how a wrist watch is sorted out and what it consists of</a></li>
<li><a href="../133965/index.html">Ebay company announced ql.io programming language</a></li>
<li><a href="../133966/index.html">Privatbank and Visa Internet</a></li>
<li><a href="../133967/index.html">My look at ŒºHabr</a></li>
<li><a href="../133969/index.html">iCamp Kazan 2011 - final report</a></li>
<li><a href="../133972/index.html">The release of version 0.6.4 led to the blocking of the nodejs.org domain in China</a></li>
<li><a href="../133973/index.html">Impressions of the Nokia Lumia 800</a></li>
<li><a href="../133974/index.html">Application Development for Meego Harmattan</a></li>
<li><a href="../133976/index.html">What engine do you use to create HTML5 games?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>