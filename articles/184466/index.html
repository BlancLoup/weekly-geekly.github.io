<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Elliptical Spirograph</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In childhood I had a toy called spirograph. This is such a plastic sheet with a round hole inside, and toothed gears were attached to it, also with ho...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Elliptical Spirograph</h1><div class="post__text post__text-html js-mediator-article">  In childhood I had a toy called spirograph.  This is such a plastic sheet with a round hole inside, and toothed gears were attached to it, also with holes, but small.  You put a pen in the hole, a gear in a circle <a href="http://www.youtube.com/watch%3Fv%3Dj15moh6lA1Y%26feature%3Dyoutu.be">and roll</a> .  The result is beautiful lace patterns that you can‚Äôt draw with your hands. <br><br>  When I became older, I wanted to bring the same patterns already on the computer screen.  For a long time I thought how to do it, according to what formula to draw.  In the meantime, I thought this formula was derived without me, and even put it on <a href="http://en.wikipedia.org/wiki/Spirograph">Wikipedia</a> - I don‚Äôt want to draw.  The basic idea of ‚Äã‚Äãthe conclusion there is that a small circle travels large without slipping, and, therefore, the distance traveled by a point from a small circle must be equal to the corresponding distance on a large circle. <br><br>  However, taken the fortress no longer beckon.  Now it‚Äôs natural to summarize the task - for example, to make a small circle not go inside a circle, but rather more complicated, say, an ellipse. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But then it turns out sharply that the conclusion from Wikipedia is sharpened just under the circle.  And for other figures, we immediately come across three obstacles. <br><br>  First, the circle is a simple figure and it is very easy to calculate its length: it multiplied the angle of rotation by the radius, and it was done.  But the length of an ellipse, not to mention something more complicated, is an integral of a special kind, to which even its own name is assigned ‚Äúelliptic function‚Äù.  And this integral is not perceptible - that is, it is not expressed in elementary functions.  And counting the length of an ellipse through derivatives, and taking into account that there is a parametric formula there, pleasure is small.  That is, it is possible to program, of course, but the calculations are performed very, very long. <br><br>  Secondly, the circle is a figure of constant curvature.  Therefore, the line between the point of tangency of the circles and the center of the large circle always also passes through the small circle at the same time, which simplifies the derivation of formulas.  In the case of an ellipse (and any other curve with varying curvature), these points move apart in different directions like a cow on ice.  Here is an illustration. <br><br><img src="https://habrastorage.org/storage2/5f4/a73/3b7/5f4a733b786b861a4d66749bb2ddba2f.png" alt="image"><br><br>  On the third problem will be discussed later. <br><br>  But the mind overcomes all obstacles.  Or almost everything.  If we take from Wikipedia the main idea of ‚Äã‚Äãequality of the distance traveled and the second idea - to consider the location of the hole in the gear as the sum of the location of the center of the small circle relative to the large one and the location of the hole relatively small circle, then after a certain amount of trial and error we can come up with an algorithm for drawing. <br><br>  So look again at the illustration above.  The center of the Cartesian and polar coordinates (we will have to use both) is in one place ‚Äî the middle of the main ellipse; we measure the polar angles counterclockwise from the x axis.  On a small circle, a green arrow was drawn especially for beauty.  Initially, at an angle of 0, the small circle stands so that this arrow is at an angle of 0, and its tangency point with a large circle is on the x axis. <br><br>  Now the wheel was turned so that the point of contact moved to a point that is at an angle Œ±, when viewed from the origin.  During this time, the end of the arrow passed a certain path, and this path is equal to the corresponding path on the ellipse (in the figure both are marked in blue). <br><br>  Let's get a little closer to the scene. <br><br><img src="https://habrastorage.org/storage2/1c7/6db/9e7/1c76db9e79cf60d8807b3b0703699378.png"><br><br>  Here we see the same point of contact (marked as pt), the arrow on the wheel (drawn in bold), the path traversed by the end of this arrow (highlighted in blue), and at the same time a hole in the wheel (red dot).  local is the center of the wheel, at this point the center of the local coordinate system will be placed, with which we will calculate the position of the hole. <br><br>  So, the point pt is visible from the center of the ellipse at an angle Œ±.  It is easy to find the coordinates of this point - as the intersection of an ellipse and the corresponding line.  Now it would be nice to know the coordinates of the center of the wheel, but for this we need to know the angle Œ≥ - the direction from the center of the wheel to the touch point.  ABOUT!  - the key word "touch".  At the tangency point of the curves, a common tangent can be drawn to them, and the angle we need will be perpendicular to the angle of this tangent.  The tangent of the tangent angle is the derivative of the ellipse at a point.  It remains only to simply calculate this derivative. <br><br>  Of course, you can take the parametric equation of an ellipse and get a derivative formula from it.  But it is terribly inconvenient - the parameter does not correspond in any way with any value known to us.  And if we replace the ellipse with something else? <br><br>  Physicists joke that God has an important advantage that can integrate live, directly on physical bodies.  This is the method we will use. <br><br>  What is a derivative?  If in a simple way, in a collective farm, excluding the limiting transition, this is the ratio of a change in the value of a function to a change in the value of a variable.  Since we program on a computer, we don‚Äôt have any infinities implied by the limiting transition, our world is discrete, and for us this formula is quite suitable.  Therefore, we only need to memorize the previous point and calculate the ratio (Ypt-Yprev) / (Xpt-Xprev).  The more often we take the points, the more accurate our calculations will be and in the end, no one can distinguish them from a real derivative. <br><br>  Well, then simply - we find the angle Œ≥ and the coordinates of the center of the wheel on it. <br><br>  How now to find the coordinates of the holes in the local coordinates?  All that is necessary for this to know is at what angle Œ≤ the wheel was turned.  You cannot calculate it directly, but it is equal to the angle between the touch point and the end of the arrow, from which the angle Œ≥ already known to us was subtracted (see picture).  It is necessary only to remember to take the result with the opposite sign, because our wheel turns clockwise, and the angles are measured against the hour. <br><br>  How to find a large angle?  Not so difficult - you just need to divide the length of the blue arc by the radius of the wheel.  And the length of the blue arc is equal to the corresponding part of the arc of the ellipse. <br><br>  Aha-aha, this is where terrible elliptic functions are waiting for us.  But we will unscrew as well as with the derivative - we will replace the length of the curve with the length of the polyline, which consists of short straight lines between the current point and the previous one. <br><br>  Well, the rest is easy - we find the coordinates of the red point in the local coordinate system and recalculate them into the global one. <br><br>  Now about the third problem.  In Wikipedia, the radii of the large and small circle are set and they predict that if their attitude is rational, then the curve will necessarily close (and why do we need open curves? They are not beautiful).  We can also do this, but it is useless - the length of the ellipse is expressed as an irrational number, we have no radius, and the curve is not likely to close. <br><br>  We will do it a little differently: we will set the number of times the wheel will move in an ellipse, and how many times this time it should turn itself.  According to this data, we calculate what radius the wheel should have in order for the curve to close.  Here all the same equality of ways will help us. <br><br>  Now, after long calculations, we will finally be able to enjoy the artistic result.  See how cute: <br><br><img src="https://habrastorage.org/storage2/9cb/a7f/189/9cba7f189ff04ccf9e0763e215d5354f.png"><br><br>  The yellow circle in the picture is the wheel, the outer black ellipse is the one in which we roll, the yellow ellipse is the way to the middle of the wheel. <br><br>  By the way, the resulting algorithm is completely independent of any properties of the ellipse, so the outer curve can be changed as you please, as long as it remains closed.  You can even take ... square.  The result is in the following figure.  He is not so pleased with the eye, but also nothing.  Then it will be possible to cut off all unnecessary in Photoshop. <br><br><img src="https://habrastorage.org/storage2/b81/3d0/480/b813d048086c3d943e45164cb12ad227.png"><br><br>  Beautiful, what to say.  But since this is not a promotional post, I just can not ignore an important drawback.  All of the above works if the curve is smooth enough and the wheel is small.  If the wheel is comparable in magnitude to the curve itself, then the above conclusion is no longer valid.  Doubtful jags appear on the graph, since when calculating by the algorithm, it turns out that the wheel in some places stands in such a way that it touches the outer curve only at one point, and its neighboring points turn out to be sticking out of the curve.  Of course, on a physical spirograph this will not work, but how to fix it is not yet known to modern science.  If anyone has any ideas - please pop up. <br><br>  And finally, for those who, for their flowery prose, prefer the harsh speech of algorithms, the text of the program.  It is written in <a href="http://asymptote.sourceforge.net/">Asymptote</a> , an excellent computer graphics programming tool. <br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// ,      path base = scale(3,2)*unitcircle; //     -   ;       ,      //path base = unitcircle; //    -   // path base = (-3,3)--(3,3)--(3,-3)--(-3,-3)--cycle; //       // (0 - , -1 -  , +1 -  ) real p = 0.7; import graph; size(600, 600); //    //xaxis(ticks=Ticks); //yaxis(ticks=Ticks); //     int m = 9; //   int n = 29; //   ,     real r = arclength(base)*m/2/pi/n; real hole = r*p; draw(base); //////////////////////////////////////////////// //      , phase -       real revolution(real phase) { pair prev = (500,500); real arclen = 0; real beta; real gamma; for (real alpha = 0; alpha&lt;=2pi; alpha=alpha+0.005) { //           real[][] isect = intersections(base, (0,0)--(500*cos(alpha), 500*sin(alpha))); pair pt = point(base, isect[0][0]); if (prev==(500,500)) { gamma = 0; } else { //     arclen += length(pt-prev); //  ,       pair deriv = pt - prev; //     real g = atan2(deriv.y, deriv.x); //      gamma = g - pi/2; } beta = gamma - arclen/r + phase; //       pair local = hole*( cos(beta), sin(beta) ); //        pair center = pt - r*( cos(gamma), sin(gamma) ); pair spiro = center + local; draw(center, green); draw(spiro, blue); //    -       prev = pt; } return beta; } //////////////////////////////////// //     -   real[][] isect = intersections(base, (0,0)--(100, 0)); pair first_point = point(base,isect[0][0]); draw(shift(first_point.xr,0)*scale(r)*unitcircle, yellow); //  ,          real phase = 0; for (int rev=0; rev&lt;m; rev=rev+1) { phase = revolution(phase); }</span></span></code> </pre> </div><p>Source: <a href="https://habr.com/ru/post/184466/">https://habr.com/ru/post/184466/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../184454/index.html">Sony SBH50 Bluetooth Headset Overview</a></li>
<li><a href="../184458/index.html">Seminar on the improvement of mobile products using the playtest method</a></li>
<li><a href="../184460/index.html">Introduction to JMS 2.0</a></li>
<li><a href="../184462/index.html">In good hands! SpecsMe - service for creating technical tasks</a></li>
<li><a href="../184464/index.html">Vacation while maintaining a working mood: an experiment to increase loyalty</a></li>
<li><a href="../184468/index.html">Look at me spoke out against anti-piracy law</a></li>
<li><a href="../184470/index.html">The unexpected popularity of TinyRSS.ru</a></li>
<li><a href="../184472/index.html">Holy struggle with Mikhalkov and Acop</a></li>
<li><a href="../184474/index.html">Advanced naval battle</a></li>
<li><a href="../184476/index.html">Product Management: See the product through the user's eyes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>