<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to manage your OpenStack projects using Keystone domains in the Havana release</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Author Sergey Kashaba 

 Domains in OpenStack are a method of merging projects or tenants (as they were called in Grizzly) into independent groups. In...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to manage your OpenStack projects using Keystone domains in the Havana release</h1><div class="post__text post__text-html js-mediator-article">  <i>Author Sergey Kashaba</i> <br><br>  Domains in OpenStack are a method of merging projects or tenants (as they were called in Grizzly) into independent groups.  In addition, they allow you to restrict access to a specific domain.  For example, as you probably remember, when domains were not applied, a user who was assigned the administrator role in one project was the administrator of the entire cluster and could perform any operations.  With the advent of domains, you can assign the user the role of administrator in one domain with administrator privileges only in this domain. <br>  This article will briefly review some situations in which domains can help you organize your projects.  Once you understand this, we will proceed to consider how to actually use domains for this purpose. <a name="habracut"></a><br><br><h4>  Motivation </h4><br>  We first came across domains about a year ago when one of our corporate clients requested functionality that is very similar to OpenStack domains.  This was part of the Grizzly cycle.  We read about it and said: ‚ÄúYo-ho-ho!  We can use domain functionality! ‚Äù  At that time, it was just introduced. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But OpenStack is ... OpenStack, and this functionality was not supported by all the required components.  Therefore, we made a patch for Keystone to implement the requested usage scenarios and decided to come back to this later. <br><br>  After six months, the release of Havana.  Since the domain functionality is very useful for the corporate segment, we decided to get proof of the concept using the vanilla Havana release. <br><br>  We wanted to cover the following usage scenarios: <br>  1. As an IaaS administrator, I should be able to create domains to aggregate tenants (now called projects). <br><br>  2. As an IaaS administrator, I should be able to add a user as a domain administrator. <br><br>  3. As a domain administrator, I should be able to: <br><br>  ‚Ä¢ Create, delete, move, update and delete projects within this domain.  The project list should include only the project of this domain. <br><br>  ‚Ä¢ Perform CRUD operations on the user in relation to project roles. <br><br>  4. LDAP should be used as the source of the username / password. <br><br>  5. Be sure to use only the REST API.  Neither UI nor CLI is required. <br><br>  This time we did it.  Not to say that there were no problems, but the project showed that the domains in the release of Havana, at a minimum, can be applied. <br><br><h4>  Reade set Go! </h4><br>  We tested domains using the stable / havana branch in Devstack.  The localrc file contains only options for providing passwords. <br><br>  In the process of research, we found out that CLI is only partially ready for the use of domains.  It provides full functionality for the average user, but not all for administration (a <a href="https://bugs.launchpad.net/python-openstackclient/%2Bbug/1274343">description of this problem</a> and the status of its solution can be found <a href="https://bugs.launchpad.net/python-openstackclient/%2Bbug/1274343">here</a> ). <br><br>  To use domain functionality, do the following: <br>  1. Change the marker format to UUID (keystone.conf file, [signing] section, token_format = UUID).  Glance has <a href="https://bugs.launchpad.net/glance/%2Bbug/1248842">problems</a> with PKI markers (at least with v3 markers), and during authentication, the error is 'body is too large' (‚Äútoo big body‚Äù) when using the default PKI (the problem occurs not only when using domains) . <br><br>  2. Apply the correct policy.json file for keystone.  Domain verification is not supported in the default policy file.  We reused the file that comes with the keystone from <a href="">git</a> and then <a href="">made changes to it</a> . <br><br>  3. Modify the Nova, Glance-api and paste.registry configuration files in Glance to enable the use of V3.0 authentication by adding 'auth_version = v3.0' to the [filter: authtoken] section.  In the test environment, we used only Nova and Glance to start the VM.  If you use other services, do not forget to make changes to the corresponding configuration files.  If this is not done, the Nova and Glance clients will check the V2 tokens and give the error ‚ÄúOnly default domain is allowed over the V2.0‚Äù (‚ÄúOnly the default domain can be used in V2.0). <br><br>  4. Update the keystone endpoints so that the identity service points to v3, not v2.0. <br><br>  5. Restart the services, the settings of which have been changed. <br><br>  Note that at the request of the client, we used only the REST interface and did not use CLI / PythonAPI / UI clients. <br><br><h4>  How to manage domains </h4><br>  Having spent about a week studying domains, I can say that there are two key points for understanding how they work: <br>  1. How the marker is created and, in particular, the token scope. <br><br>  2. How policies are launched. <br><br>  In this article, all the examples will be given using curl commands.  This is done for two reasons.  First, when writing this document, the CLI did not support setting domain-related parameters via the command line.  Secondly, and in practice, more importantly, the CLI does not reveal some of the details that are essential for understanding how it works. <br><br><h5>  Creating a marker </h5><br>  First you need to create a marker, which is quite simple.  This is done using the following query: <br><br>  curl -si -X POST -H ‚ÄúContent-Type: application / json‚Äù -d '{‚Äúauth‚Äù: {‚Äúscope‚Äù: {‚Äúdomain‚Äù: {‚Äúid‚Äù: ‚ÄúXXXXX‚Äù}}, ‚Äúidentity‚Äù: {‚ÄúPassword‚Äù: {‚Äúuser‚Äù: {‚Äúdomain‚Äù: {‚Äúname‚Äù: ‚Äúdefault‚Äù}, ‚Äúpassword‚Äù: ‚Äúqwerty‚Äù, ‚Äúid‚Äù: ‚ÄúYYYYYY‚Äù}}, ‚Äúmethods‚Äù: [‚Äúpassword ¬ª]}}}‚Äù <a href="http://127.0.0.1/">127.0.0.1</a> : 5000 / v3 / auth / tokens |  awk '/ X-Subject-Token / {print $ 2}' |  tr -d '\ r' <br><br>  Here you can see the important part of the json file, which is transmitted as a body, the scope.  A domain can be either a domain or a project.  The marker area is involved in the launch of the policy, so it is important to understand and remember.  If interested, you can look at function keystone / auth / controllers.py: AuthInfo._validate_and_normalize_scope_data to find out the code used to create the object, which was then used to generate policy data (policy credentials). <br><br><h5>  Policy launch </h5><br>  Launching a policy is more difficult.  This is the main use case.  Fortunately, once you have a clear understanding of how this happens, you will be able to perform most of the domain operations.  When launching a policy, three new keywords are used: credential, policy, and target.  Now let's see what is the creation and use of each of them. <br><br><h6>  Credentials (Credentials) </h6><br>  A credential object is a dictionary created on the basis of a marker and includes the area of ‚Äã‚Äãthe resulting marker, as well as the roles assigned to the user. <br><br><h6>  Policy </h6><br>  A policy is simply a set of rules, united according to the logic of OR / AND.  In future releases, it should become more readable, but for now we will use the format currently used.  Below are some fragments of the policy as an example of the above. <br><br>  ‚ÄúAdmin_required‚Äù: [[‚Äúrole: admin‚Äù]], <br><br>  ‚ÄúOwner‚Äù: [["user_id:% (user_id) s"], ["user_id:% (target.entity.user_id) s"]], <br><br>  ‚ÄúIdentity: get_project‚Äù: [[rule: admin_required ‚Äù, <br>  "Domain_id:% (target.project.domain_id) s"]], <br><br>  ‚ÄúIdentity: list_projects‚Äù: [["rule: admin_required", "domain_id:% (domain_id) s"]], <br><br>  ‚ÄúIdentity: list_user_projects‚Äù: [[‚Äúrule: owner‚Äù], [‚Äúrule: admin_required‚Äù, <br>  "Domain_id:% (domain_id) s"]], <br><br>  Everything must be enclosed in square brackets ([]). <br><br>  The minimum fragment of the rule (you can call it the ‚Äúatomic‚Äù rule) is a string with a colon as the delimiter (':').  It may be: <br>  1. Link to another rule.  In this case, the left side is the ‚Äúrule‚Äù and the right side is the name of the rule. <br><br>  2. The definition of validation logic.  In this case, the left side defines the key that is in the credential object, and the right side is something that is in the 'target'.  It can also be a constant.  This can be expressed as credentials_object [left_side] == right_side% target_object. <br><br>  Multiple atomic rules can be combined using a comma (,).  This means that these rules are combined based on AND logic (for example: [‚Äúrule: admin_required‚Äù, ‚Äúdomain_id:% (domain_id) s‚Äù]).  Call it the "rule and". <br><br>  If there are two sets of rules enclosed in [], then they are combined based on the OR logic.  For example, [[‚Äúrule: owner‚Äù], [‚Äúrule: admin_required‚Äù]] means that the rule is executed if the owner rule or the rule required by the administrator is executed. <br><br>  If the rule uses another rule, then the rule enclosed in brackets should be described in the same way. <br><br>  To summarize: an example of ‚Äú‚Äù identity: list_user_projects ‚Äù: [[‚Äú rule: owner ‚Äù], [‚Äú rule: admin_required ‚Äù,‚Äú domain_id:% (domain_id) s ‚Äù]] means‚Äú the list of user projects is allowed only if the rule with the name 'owner' OR is executed and the rule required by the administrator, AND the domain_id from the marker area is equal to the domain id from the target '.  Now we will talk about the goal. <br><br><h6>  Target (Target) </h6><br>  The target object is also a dictionary created based on the following: <br>  ‚Ä¢ query string (query string) from the query (request); <br><br>  ‚Ä¢ launched objects. <br><br>  For example: <br>  ‚Ä¢ If we are trying to get information about a project, then the goal is this project. <br><br>  ‚Ä¢ If we are trying to assign a user to a project with a specific role, then the goal is the role + project + user. <br><br>  ‚Ä¢ If we are trying to list all the projects, the goal value will be empty (At first it made me sad because I thought that some of the operations requested by our clients were not available in the Havana release. But we were lucky, I was wrong.). <br><br>  ‚Ä¢ If we try to list all projects using a filter for a specific value (for example, by domains_id), then the goal includes all filters (This was a surprise for me, but it turned out to be very useful). <br><br>  Request example: <br><br>  curl -sX GET -H ‚ÄúX-Auth-Token: $ OS_MYTOKEN‚Äù <a href="http://127.0.0.1/">127.0.0.1</a> : 5000 / v3 / projects? domain_id = $ OS_DOMAIN_ID <br><br>  In this request, only domain_id is included in the target.  The rule that should be included in the policy.json file can be ‚Äúidentity: list_projects‚Äù: [[‚Äúrule: admin_required‚Äù, ‚Äúdomain_id:% (domain_id) s‚Äù]]. <br><br>  Knowing all this, you can easily manage access by making changes to the policy.json file. <br>  In addition, in keystone / policy / backends / rules.py: enforce, you can write debugging messages for logging credentials, rules, and goals for more thorough analysis.  This method helped me understand what is happening in some use cases. <br><br><h5>  <i>Cloud Administrator (Cloud admin)</i> </h5><br>  In the existing policy.json file, I did not understand what the rule 'cloud_admin' meant: <br><br>  ‚ÄúCloud_admin‚Äù: ‚Äúrule: admin_required and domain_id: admin_domain_id‚Äù, <br>  ‚ÄúIdentity: get_domain‚Äù: ‚Äúrule: cloud_admin‚Äù, <br><br>  Having done some research, I found out that this is a very sophisticated workaround for determining the 'super administrator' without using a service token.  You simply create a domain that is 'super domain', and specify the corresponding ID as the value of admin_domain_id in the rule.  For example, in devstack you can use 'default', and specify the default domain as the 'super' administrator. <br>  According to the <a href="https://bugs.launchpad.net/keystone/%2Bbug/1264325">discussion of</a> keystone key managers, the concept of a cloud administrator is a temporary solution and will be replaced by <a href="https://blueprints.launchpad.net/keystone/%2Bspec/service-scoped-tokens">a service administrator concept</a> . <br><br><h4>  Horizon support </h4><br>  Horizon can also support multiple domains according to blueprints.  To do this, you need to make only minor changes either in settings.py or local_setting (which we tested in our laboratory): <br><br>  OPENSTACK_API_VERSIONS = { <br>  ‚ÄúIdentity‚Äù: 3 <br>  } <br><br>  OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True <br>  #OPENSTACK_KEYSTONE_URL = ‚Äúhttp: //% s: 5000 / v2.0 ‚Ä≥% OPENSTACK_HOST <br>  OPENSTACK_KEYSTONE_URL = ‚Äúhttp: //% s: 5000 / v3 ‚Ä≥% OPENSTACK_HOST <br>  Having made these changes, you will receive an additional input field at the login stage to indicate the domain name.  Unfortunately, admin actions (such as domain management and assignments) are not available on Horizon when applied to a keystone V3 policy ( <a href="https://answers.launchpad.net/horizon/%2Bquestion/242932">link</a> ). However, thanks to this, a regular user can at least use the UI instead of sending CURL commands. <br><br><h4>  Command Line Interface (CLI) </h4><br>  In mid-January 2014, domain support was added to the CLI, which now supports the following additional set of options: <br><br>  ‚ÄìOs-domain-name &lt;auth-domain-name&gt; <br><br>  Domain name of the requested domain level authorization scope (Environment: OS_DOMAIN_NAME). <br><br>  ‚ÄìOs-domain-id &lt;auth-domain-id&gt; <br><br>  Domain ID of the requested domain level authorization scope (Environment: OS_DOMAIN_ID). <br><br>  ‚ÄìOs-user-domain-name &lt;auth-user-domain-name&gt; <br><br>  Domain name of the user (Environment: OS_USER_DOMAIN_NAME). <br><br>  ‚ÄìOs-user-domain-id &lt;auth-user-domain-id&gt; <br><br>  User domain ID (Environment: OS_USER_DOMAIN_ID). <br><br>  ‚ÄìOs-project-domain-name &lt;auth-project-domain-name&gt; <br><br>  The domain name of the project that is the requested domain level authorization scope (Environment: OS_PROJECT_DOMAIN_NAME). <br><br>  ‚ÄìOs-project-domain-id &lt;auth-project-domain-id&gt; <br><br>  Project domain ID, which is the requested domain-level authorization scope (Environment: OS_PROJECT_DOMAIN_ID). <br>  With the help of these parameters, we can set the marker area, project domain and user domain. <br><br><h4>  We summarize everything said together </h4><br>  By applying all the above changes, you can perform all the required functions.  Below is a list of curl commands.  I remind you that I needed to ensure the launch of ONLY REST requests in order for the functionality to work during this testing. <br><br><h6>  Prerequisites: </h6><br>  For convenient analysis of json responses, I used the jq tool. <br><br>  sudo apt-get install jq <br><br>  We also created users (from LDAP): user0, demo <br><br><h6>  Example: </h6><br>  The test is as follows: <br><br>  #export start variables. <br><br>  export OS_AUTH_URL = http: //127.0.0.1: 5000 / v3 <br><br>  export OS_SERVICE_TOKEN = openstack <br><br>  #list domains <br><br>  curl -sX GET -H ‚ÄúX-Auth-Token: $ OS_SERVICE_TOKEN‚Äù <a href="http://127.0.0.1/">127.0.0.1</a> : 35357 / v3 / domains |  jq '.domains' <br><br>  #or <br><br>  openstack ‚Äìos-identity-api-version 3 ‚Äìos-url <a href="http://127.0.0.1/">127.0.0.1</a> : 35357 / v3 ‚Äìos-token openstack domain list <br><br>  #create domain <br><br>  curl -sX POST -H ‚ÄúX-Auth-Token: $ OS_SERVICE_TOKEN‚Äù -H ‚ÄúContent-Type: application / json‚Äù -d '{‚Äúdomain‚Äù: {‚Äúenabled‚Äù: true, ‚Äúname‚Äù: ‚Äúdom0 ‚Ä≥} } ' <a href="http://127.0.0.1/">127.0.0.1</a> : 35357 / v3 / domains |  jq '.' <br><br>  #list show domain0 <br><br>  curl -s -X GET -H ‚ÄúX-Auth-Token: $ OS_SERVICE_TOKEN‚Äù <a href="http://127.0.0.1/">127.0.0.1</a> : 35357 / v3 / domains? name = dom0 |  jq '.domains' <br><br>  #assign user as an domain admin <br><br>  #get user id <br><br>  curl -sX GET -H ‚ÄúX-Auth-Token: $ OS_SERVICE_TOKEN‚Äù <a href="http://127.0.0.1/">127.0.0.1</a> : 35357 / v3 / users? name = user0 |  jq '.users' <br><br>  export OS_USER_ID = curl -sX GET -H "X-Auth-Token: $ OS_SERVICE_TOKEN" <a href="http://127.0.0.1/">127.0.0.1</a> : 35357 / v3 / users? name = user0 |  jq '.users []. id' | tr -d '"' <br><br>  curl -sX GET -H ‚ÄúX-Auth-Token: $ OS_SERVICE_TOKEN‚Äù <a href="http://127.0.0.1/">127.0.0.1</a> : 35357 / v3 / domains? name = dom0 |  jq '.domains' <br><br>  export OS_DOMAIN_ID = curl -sX GET -H "X-Auth-Token: $ OS_SERVICE_TOKEN" <a href="http://127.0.0.1/">127.0.0.1</a> : 35357 / v3 / domains? name = dom0 |  jq '.domains []. id' | tr -d '"' <br><br>  curl -sX GET -H ‚ÄúX-Auth-Token: $ OS_SERVICE_TOKEN‚Äù <a href="http://127.0.0.1/">127.0.0.1</a> : 35357 / v3 / roles? name = admin |  jq '.roles' <br><br>  curl -sX PUT -H ‚ÄúX-Auth-Token: $ OS_SERVICE_TOKEN‚Äù <a href="http://127.0.0.1/">127.0.0.1</a> : 35357 / v3 / domains / $ OS_DOMAIN_ID / users / $ OS_USER_ID / roles / bc485df1732140928ad44804a1c9b546 <br><br>  curl -sX GET -H ‚ÄúX-Auth-Token: $ OS_SERVICE_TOKEN‚Äù <a href="http://127.0.0.1/">127.0.0.1</a> : 35357 / v3 / domains / $ OS_DOMAIN_ID / users / $ OS_USER_ID / roles / |  jq '.roles' <br><br>  #Authenticate as an domain admin <br><br>  export OS_MYTOKEN = curl -si -X POST -H "Content-Type: application / json" -d "{\" auth \ ": {\" scope \ ": {\" domain \ ": {\" id \ " : \ "$ OS_DOMAIN_ID \"}}, \ "identity \": {\ "password \": {\ "user \": {\ "domain \": {\ "name \": \ "default \"} , \ "Password \": \ "qwerty \", \ "id \": \ "$ OS_USER_ID \"}}, \ "methods \": [\ "password \"]}}} " <a href="http://127.0.0.1/">127.0.0.1</a> : 5000 / v3 / auth / tokens |  awk '/ X-Subject-Token / {print $ 2}' |  tr -d '\ r' <br><br>  #create project <br><br>  curl -sX POST -H ‚ÄúX-Auth-Token: $ OS_MYTOKEN‚Äù -H ‚ÄúContent-Type: application / json‚Äù -d ‚Äú{\‚Äù project \ ‚Äù: {\‚Äù name \ ‚Äù: \‚Äù dom0p0 \ ‚Äù, \ ‚ÄùEnabled \‚Äù: true, \ ‚Äùdomain_id \‚Äù: \ ‚Äù$ OS_DOMAIN_ID \‚Äù, \ ‚Äùdescription \‚Äù: \ ‚Äù\‚Äù}} ‚Äù <a href="http://127.0.0.1/">127.0.0.1</a> : 5000 / v3 / projects | jq '.' <br><br>  curl -sX GET -H ‚ÄúX-Auth-Token: $ OS_MYTOKEN‚Äù <a href="http://127.0.0.1/">127.0.0.1</a> : 5000 / v3 / projects? domain_id = $ OS_DOMAIN_ID \ &amp; name = dom0p0 | jq '.projects' <br><br>  export OS_PROJECT_ID = curl -sX GET -H "X-Auth-Token: $ OS_MYTOKEN" <a href="http://127.0.0.1/">127.0.0.1</a> : 5000 / v3 / projects? domain_id = $ OS_DOMAIN_ID \ &amp; name = dom0p0 |  jq '.projects []. id' | tr -d '"' <br><br>  #add user to project <br><br>  curl -sX GET -H ‚ÄúX-Auth-Token: $ OS_MYTOKEN‚Äù <a href="http://127.0.0.1/">127.0.0.1</a> : 35357 / v3 / users? name = demo |  jq '.users' <br><br>  export OS_DEMOUSER_ID = curl -sX GET -H "X-Auth-Token: $ OS_MYTOKEN" <a href="http://127.0.0.1/">127.0.0.1</a> : 35357 / v3 / users? name = demo |  jq '.users []. id' | tr -d '"' <br><br>  curl -sX GET -H ‚ÄúX-Auth-Token: $ OS_MYTOKEN‚Äù <a href="http://127.0.0.1/">127.0.0.1</a> : 35357 / v3 / roles? name = Member |  jq '.roles' <br><br>  curl -X PUT -H ‚ÄúX-Auth-Token: $ OS_MYTOKEN‚Äù <a href="http://127.0.0.1/">127.0.0.1</a> : 5000 / v3 / projects / $ OS_PROJECT_ID / users / $ OS_DEMOUSER_ID / roles / c861b57d824d4619a739823d863064b6 <br><br>  curl -X GET -H ‚ÄúX-Auth-Token: $ OS_MYTOKEN‚Äù <a href="http://127.0.0.1/">127.0.0.1</a> : 5000 / v3 / projects / $ OS_PROJECT_ID / users / $ OS_DEMOUSER_ID / roles / | jq '.roles' <br><br>  #authenticate as a user <br><br>  export OS_DEMOTOKEN_ID = curl -si -X POST -H "Content-Type: application / json" -d "{\" auth \ ": {\" scope \ ": {\" project \ ": {\" id \ " : \ "$ OS_PROJECT_ID \", \ "domain \": {\ "id \": \ "$ OS_DOMAIN_ID \"}}}, \ "identity \": {\ "password \": {\ "user \" : {\ "Domain \": {\ "name \": \ "default \"}, \ "password \": \ "openstack \", \ "id \": \ "$ OS_DEMOUSER_ID \"}}, \ "Methods \": [\ "password \"]}}} " <a href="http://127.0.0.1/">127.0.0.1</a> : 5000 / v3 / auth / tokens |  awk '/ X-Subject-Token / {print $ 2}' |  tr -d '\ r' <br><br>  #run the VM <br><br>  curl -si -X POST -H ‚ÄúX-Auth-Token: $ OS_DEMOTOKEN_ID‚Äù -H ‚ÄúContent-Type: application / json‚Äù -d '{‚Äúserver‚Äù: {‚ÄúflavorRef‚Äù: ‚Äú1 ‚Ä≥,‚Äú name ‚Äù: ‚ÄúKsn‚Äù, ‚ÄúimageRef‚Äù: ‚Äúc0843d76-0cc8-4a19-a9e3-169afd3aace2 ‚Ä≥}} ' <a href="http://127.0.0.1/">127.0.0.1</a> : 8774 / v2 / $ OS_PROJECT_ID / servers <br><br><h4>  Open questions </h4><br>  In general, this can be called a success, but we still have a couple of unresolved issues: <br>  1. It is not clear whether Horizon can manage administrator operations when applying a V3 policy to <a href="https://answers.launchpad.net/horizon/%2Bquestion/242932">keystone</a> . <br><br>  2. It is impossible to delete a domain if you assigned a domain project to a user from another domain.  <a href="https://bugs.launchpad.net/keystone/%2Bbug/1262360">The problem</a> . <br><br><h4>  findings </h4><br>  Summarizing, we can say that to use the domain functionality in Horizon, you must first make sure that you are using Keystone API version V3 and that you have changed the authentication scheme to UUID.  Then you need to create tokens, then create and run the appropriate policies.  By doing this, you can use the commands in the list to create and use domains, or you can use Horizon or new CLI settings. <br><br>  Original article <a href="http://www.mirantis.com/blog/manage-openstack-projects-using-domains-havana/">in English</a> . </div><p>Source: <a href="https://habr.com/ru/post/224693/">https://habr.com/ru/post/224693/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../224679/index.html">OrPI Preorders - Navigation Expansion Board for Raspberry PI. miscellanea</a></li>
<li><a href="../224683/index.html">Indexing applications: now in Russian</a></li>
<li><a href="../224685/index.html">Speech synthesizer Now in Russian</a></li>
<li><a href="../224687/index.html">TVPRO - interactive media player with FullHD webcam</a></li>
<li><a href="../224691/index.html">Say no to sms spam: sms through application authorization</a></li>
<li><a href="../224695/index.html">Coursera has a course from a Nobel laureate with a Russian dubbing.</a></li>
<li><a href="../224699/index.html">Released updated PyCharm 3.4 with new enhanced functionality and improved overall performance.</a></li>
<li><a href="../224701/index.html">Unboxing NetApp E2700</a></li>
<li><a href="../224703/index.html">Express Photos: A Brief Review of Flip and Amnesia Post-Modems: A Machine for Pigs</a></li>
<li><a href="../224705/index.html">Thunderargs: practice of use. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>