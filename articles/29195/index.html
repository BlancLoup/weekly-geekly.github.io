<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Search is easy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Google, of course, is looking good, but it is impossible to post corporate resources for open access, buying google-mini with its limitations is also ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Search is easy</h1><div class="post__text post__text-html js-mediator-article">  Google, of course, is looking good, but it is impossible to post corporate resources for open access, buying google-mini with its limitations is also not an option.  And a search on the basis of impressive sizes (4 gigabytes of texts for which a search is needed) is necessary.  And if you add to the search by text, and also search by some parameters, then google-mini will not help and it becomes absolutely scary. <br><br>  But do not panic!  Sphinx comes to the rescue - an open source search engine that can be screwed to almost anything without much effort. <br><br><a name="habracut"></a><br>  The beauty of the Sphinx is that it does not index the whole site, recursively following the links, pulling out information (sometimes completely unnecessary), but the base in a convenient format. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The Sphinx consists of 3 parts: the indexer, the search utility for searching from the command line, the searchd daemon to which we will access search queries.  Also in the distribution kit there is a set of examples of using the Sphinx in different languages. <br><br>  For starters, probably worth it to put the Sphinx. <br><ol><li>  We download source codes <a href="">from here</a> </li><li>  Unpacking (tar xzf sphinx-0.9.8.tar.gz) </li><li>  Configuring (./configure --prefix = / path / to / sphinx) </li><li>  Build and install (make install) </li></ol><br>  Now a little about setting up and working. <br><br>  We will deal with the search engine on a simple and clear example - a possible simplified structure of Habrahabr =) <br><br>  Let the topic have the following structure: <br><pre>  Field type
 -----------------------
  id int (11)
  blog_id int (11)
  Subject varchar (255)
  Content longtext
</pre><br>  Well, add to the topic tags, where do without them - Web 2.0, after all <br><pre>  Field type
 -------------------
  topic_id int (11)
  tag_id int (11) </pre><br><br>  The most difficult task of the search, which we have to solve and with which the Cphinx will successfully cope, is a search through the texts of the topic with some tags in a particular blog. <br><br>  Now, in fact, we will configure the Sphinx on our base. <br>  Open the config (PREFIX / etc / sphinx.conf).  We will need to configure 2 parts: <br><ol><li>  Sources </li><li>  Indexing options </li></ol><br>  The source, as the name suggests, is where the Sphinx takes data for indexing.  Sources can be of two types: some DBMS (if I am not mistaken, only mysql and postgres are supported now) or an XML database.  We work with mysql. <br><br>  Ask the source <br><pre>  source main
 {
         type = mysql
         sql_host = localhost
         sql_user = root
         sql_pass =
         sql_db = test
         sql_port = 3306<font></font>
        <font></font>
         # up to this point, I think everything is clear<font></font>
<font></font>
         # now you need to ask the Sphinx the SQl request, with which
         # he will pull information from our database<font></font>
<font></font>
         sql_query = \
                 SELECT id, subject, content FROM Topics;<font></font>
<font></font>
         # and the request by which you can get the topic.
         sql_query_info = SELECT * FROM Topics WHERE id = $ id
 }
</pre><br><br>  There is a source, now let's create an index.  There may be a lot of indices, but so far we only need one. <br><pre>  index main
 {
         source = main # use source main
         path = / var / lib / sphinx / main # the place where the index will be stored
         docinfo = extern # We need this later
         morphology = stem_ru # Define morphology so that the query "habrahabr"
                                           # we also had "habrahabra", "habrahabr"
         min_word_len = 1 # minimum word size.  Suddenly want to look for pretexts?
         charset_type = utf-8 # this is understandable - encoding
         html_strip = 0 whether to cut HTML.
                                     The documentation says that it works correctly only on
                                     # perfect html'e, but to be honest, never tried
 }
</pre><br>  The parameters of the indexer and the search daemon can be left as default. <br><br>  Run indexer <br><pre>  bin / indexer - all </pre><br>  The option --all means, then you need to re-index all indexes. <br><br>  The index is built, you can try to search.  Let's use the search utility. <br><pre>  bin / search habrabra </pre><br>  And get a list of all documents, which mentioned habrahabr. <br><br>  The search engine is ready!  Now we will solve the problem about which it was mentioned earlier: search on topics with specific tags in a particular blog. <br><br>  To do this, the Sphinx needs to know which tags belong to which topics and which blog contains which topic. <br><br>  You can add any number of attributes to each entry.  We have two of them: a topic and a blog.  We speak to the Sphinx about it.  Add the following lines to the source config: <br><pre>         # tags
         sql_attr_multi = \
                         uint tag from query;  \
                         SELECT topic_id, tag_id from tags;
         # blogs
         sql_attr_multi = \
                         uint blog from query;  \
                         SELECT id, Blog from Topics;
</pre><br>  After that, we re-index the database and use the search utility to check the result: <br><pre>  bin / search -f tag 42 search words </pre><br>  Sphinx will give us a list of topics marked with tag number 42 and containing ‚Äúsearch words‚Äù. <br>  Unfortunately, the search utility does not know how to limit the search by several attributes, but through the API it is possible (If there is any resonance, I will describe the API separately). <br><br>  I would like to add that the Sphinx has a rather powerful ‚Äúlanguage‚Äù of requests to it.  In the extended solution, you can specify which columns to match with, use expressions with brackets, sort and group search results, set the sorting function on your own, and much more. <br><br>  Full documentation in English is <a href="http://www.sphinxsearch.com/doc.html">here</a> . <br><br>  Well that's all. <br><br>  PS First topic.  Debut a success?  =) <br></div><p>Source: <a href="https://habr.com/ru/post/29195/">https://habr.com/ru/post/29195/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../291936/index.html">How professionals work. Mikhail Shklyaev, deputy director of the agency AdWatch Isobar</a></li>
<li><a href="../29194/index.html">The idea of ‚Äã‚Äãa small upgrade of your backend</a></li>
<li><a href="../291942/index.html">Business case. Marvel's wonderful resurrection (part 1)</a></li>
<li><a href="../291946/index.html">Co-owner of Mail.ru Group has invested in robot designer</a></li>
<li><a href="../291948/index.html">ua-hosting.company: hosting, VPS (KVM) SSD / SAS, servers up to 10 Gbit / s in NL, US, SIN</a></li>
<li><a href="../291950/index.html">Sports culture in IT companies</a></li>
<li><a href="../291952/index.html">From the third quarter, Ozon will start working with European and Chinese online stores as a marketplace.</a></li>
<li><a href="../291956/index.html">Google Ventures once again invested in two European startups after a year‚Äôs break.</a></li>
<li><a href="../291958/index.html">To be considered offline, or how we chose contextual advertising automation service</a></li>
<li><a href="../291962/index.html">In the first half of the year, the growth of the segment of audio advertising in runet reached 320%</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>