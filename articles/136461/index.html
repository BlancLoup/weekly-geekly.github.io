<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Controller Hierarchy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In most of the rails I have met, the structure of the controllers has no organization and the project grows as it should. In large projects, this lead...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Controller Hierarchy</h1><div class="post__text post__text-html js-mediator-article">  In most of the rails I have met, the structure of the controllers has no organization and the project grows as it should.  In large projects, this leads to the fact that controllers become huge (with dozens of actions), and conditional filters are stretched to full screen.  To understand this code is not very easy. <br><br>  Having worked with a large number of rails projects, I had an approach to organizing the hierarchy of controllers, which allowed us to unify their structure and simplify the code. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Upper level </h4><br><br>  First of all, it is convenient to locate the main names of the project, such as web, mobile, api, feeds and others, on the top level.  In this case, the admin module will be in the web. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/64a/175/de5/64a175de5a4e3570a42c0e3530afb683.png"><br><br>  Inside api, you can also select submodules divided by version, for example, v1, v2.  Or make folders on the top level api1, api2, etc. <br>  link: <a href="http://freelancing-gods.com/posts/versioning_your_ap_is">freelancing-gods.com/posts/versioning_your_ap_is</a> <br><br>  I use this structure even in the simplest cases.  Practice shows that any of these components can easily be added when no one planned it. <br><br>  For each module, a Namespace :: ApplicationController is created in order not to mix logic suitable for specific namespaces. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c1b/1a9/d66/c1b1a9d66962d1b75809890e037bd143.png"><br><br>  But in the routing there will be small differences for different modules.  Web is set as scope.  As a result, we will get helpers without unnecessary prefixes, but for the rest, we use the namespace. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1d2/500/847/1d25008473738f2a3155d8896452b15c.png"><br><br><h4>  Investment resources </h4><br><br>  I'll start right away with an example: user profile on the site.  It can be accessed by this url / users /: id and its UsersController controller.  The list of user's posts is available by / users /: id / posts.  Accordingly, we have PostsController with an index within which we get posts for the user.  Then we have the task to display all the posts in one list.  We use the same posts controller and add the index_all method there.  In this case, the user is no longer needed.  In the end, adding a variety of views, there will be a part of the methods that derive these posts (and process them) for the user, and some without him.  Then filters will appear, for example, before_filter: load_user,: only =&gt; [: index ...], and so on until there are no people left who can understand what is happening here. <br><br>  The same will happen again to display comments, likes and more.  At the same time, the output of posts can be not only by user, but also by category and many other links in which posts will be nested resources. <br><br>  In this case, it would also be wise to create modules for the appropriate resources. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/89c/7ef/47c/89c7ef47c4dbf67e0e397f387cd43b94.png"><br><br>  And for each namespace there will be its own ApplicationController containing common module methods. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/607/716/45a/60771645a5ed3f731ede63db61446543.png"><br><br>  For all controllers located in this module, current_section without filters will be available. <br><br>  <b>Profit:</b> <br><br>  Controllers are getting smaller and simpler. <br>  Looking at the structure of the controllers, we can already say a lot about how the project is organized and what can be expected in a particular controller. <br>  Many conditional filters go away. <br>  Simplified testing; <br>  Unified organizational approach; <br><br>  Also, for convenience and uniformity, the namespace input controllers are called welcome.  And connect to routs via root: to =&gt; 'welcome # index' inside the corresponding scope. <br>  Real example: <br><br>  Consider how to organize controllers for a real example.  Say it took to do integration with facebook. <br><br>  When approaching the forehead, some kind of FacebookController controller would be made, in which all methods for working with Facebook would be placed.  As a result, we would get a part of the methods, which should work only from the user account, and some only for those who are not authorized, etc. <br><br>  Split approach: <br><br><pre><code class="ruby hljs">resource <span class="hljs-symbol"><span class="hljs-symbol">:facebook</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:only</span></span> =&gt; [<span class="hljs-symbol"><span class="hljs-symbol">:new</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:create</span></span>]</code> </pre> <br><br>  In this case, nothing is known about the user, but when the integration changes (for example, autoshare setting) or deletion, we work with a specific user.  This can be implemented, for example, as follows: <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># app/controllers/web/account/facebook_controller.rb resource :account do scope :module =&gt; :account do resource :facebook, :only =&gt; [:edit, :update, :destroy] end end</span></span></code> </pre><br><br>  And if you need to give the opportunity to integrate an already authorized user?  Then in the last example add: new,: create. <br><br>  As a result, instead of one controller, we got two (but maybe more if the task requires it), but all the methods are grouped by use case. </div><p>Source: <a href="https://habr.com/ru/post/136461/">https://habr.com/ru/post/136461/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136455/index.html">How users see programmers, and programmers see users</a></li>
<li><a href="../136456/index.html">High-performance NIO server on Netty</a></li>
<li><a href="../136458/index.html">Lean in brief on the example of pizza delivery</a></li>
<li><a href="../136459/index.html">Application integration on Windows Phone with SkyDrive</a></li>
<li><a href="../136460/index.html">A simple Dropbox based blog service.</a></li>
<li><a href="../136463/index.html">Application for drawing under the Android</a></li>
<li><a href="../136464/index.html">Details about the ReFS (Protogon) file system</a></li>
<li><a href="../136465/index.html">Microsoft and Skype</a></li>
<li><a href="../136466/index.html">JMock and EasyMock: comparison and howto in examples and not only</a></li>
<li><a href="../136467/index.html">The play "Developing a multiplayer online game." Part 4: Moving into 3D</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>