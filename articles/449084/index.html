<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making the standard widget GridView Yii2 more convenient with Pjax and Modal</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It is no secret that the lion's share of the functionality of corporate (and not only) applications are CRUD operations with simple validation and bus...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making the standard widget GridView Yii2 more convenient with Pjax and Modal</h1><div class="post__text post__text-html js-mediator-article">  It is no secret that the lion's share of the functionality of corporate (and not only) applications are <a href="https://ru.wikipedia.org/wiki/CRUD">CRUD</a> operations with simple validation and business logic.  For many datasets, when working with them, it‚Äôs convenient to use a table view; for this, quite powerful tools can be used, such as jqGrid, DataTables, Handsontable, or simpler ones like the <a href="https://www.yiiframework.com/">Yrid2</a> <a href="https://www.yiiframework.com/doc/api/2.0/yii-grid-gridview">GridView</a> widget.  It copes well with the task of managing small datasets that do not require complex search and sorting methods, complies with the principles of <a href="https://ru.wikipedia.org/wiki/RAD_(%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5)">RAD</a> , but has several drawbacks and obvious points for improvement.  Consider a few of these problems and solutions. <br><a name="habracut"></a><br>  1. For any actions with data that cause a change in the state of the table, a full page reload occurs.  This is solved by a <a href="https://www.yiiframework.com/wiki/772/pjax-on-activeform-and-gridview-yii2">wiki</a> method using <a href="https://github.com/yiisoft/jquery-pjax">Pjax</a> , which is integrated into Yii2.  Enough to wrap the GridView in <br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> Pjax::begin([<span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'grid-pjax'</span></span>]); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> Pjax::end(); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  and the procedures for deleting, filtering, sorting, navigating through pages will occur without a full refresh of the page; GridView itself already integrates Pjax support in the required amount. <br>  However, in programming it is often necessary to compromise between convenience (use, support, debugging, etc.) and complexity, also in this case, using Pjax is simple and convenient, but when updating a part of the page with its help, the server still generates the full version of the page from which Pjax cuts only the necessary one on the client side.  But it's easy to fix by adding something like <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Yii::$app-&gt;request-&gt;isPjax) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;renderPartial(<span class="hljs-string"><span class="hljs-string">'index'</span></span>, [ <span class="hljs-comment"><span class="hljs-comment">//  index.php    GridView,   index.php        Pjax  GridView 'dataProvider' =&gt; $dataProvider, ]); }</span></span></code> </pre> <br><br>  2. Only updating without reloading the page after saving the form will not work, in this case you can use the mentioned method from the wiki by placing the form on the same page with the GridView, and wrapping it in Pjax as well.  Or use the <a href="https://getbootstrap.com/docs/3.4/javascript/">modal windows</a> , the latter will be discussed further and will go.  Since it turned out that Yii2 is closely related to Bootstrap, and it is used in many projects on this framework, then you can use modal windows from Bootstrap.  For these purposes, you can use the extension <a href="https://github.com/yiisoft/yii2-bootstrap">yii2-bootstrap</a> , and from it the Modal widget. <br>  Add the Modal widget to the page source code, for example, like this: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> Modal::begin([<span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'form-modal'</span></span>]); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> Modal::end(); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  When clicking on the button for adding a new record or editing, we display the form in a modal window: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> modal = $(<span class="hljs-string"><span class="hljs-string">"form-modal"</span></span>); $(<span class="hljs-string"><span class="hljs-string">"div.modal-body"</span></span>, modal).load(<span class="hljs-string"><span class="hljs-string">"url___"</span></span>); modal.modal(<span class="hljs-string"><span class="hljs-string">"show"</span></span>);</code> </pre> <br>  Next, we set the event interceptor of the beforeSubmit form (remembering to return false at the end), in which we send the contents of the form using <a href="https://ru.wikipedia.org/wiki/AJAX">AJAX</a> to the server, if everything suits us in the response received from the server, then we hide the form and reboot Pjax; data in the same modal window, or perform some other action: <br><pre> <code class="javascript hljs">modal.on(<span class="hljs-string"><span class="hljs-string">"beforeSubmit"</span></span>, <span class="hljs-string"><span class="hljs-string">"form"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> form = $(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); $.ajax({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"POST"</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: form.attr(<span class="hljs-string"><span class="hljs-string">"action"</span></span>), <span class="hljs-attr"><span class="hljs-attr">data</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FormData(form[<span class="hljs-number"><span class="hljs-number">0</span></span>]), <span class="hljs-attr"><span class="hljs-attr">processData</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">contentType</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">message</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (message) { $(<span class="hljs-string"><span class="hljs-string">".modal-body"</span></span>, modal).html(message); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } modal.modal(<span class="hljs-string"><span class="hljs-string">"hide"</span></span>); $.pjax.reload({<span class="hljs-attr"><span class="hljs-attr">container</span></span>: <span class="hljs-string"><span class="hljs-string">"#grid-pjax"</span></span>}); } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; });</code> </pre> <br><br>  With the described approach, if the id loaded into the modal window of the form is not unique within the page, then there may be problems with validation and generally correct functioning of the form.  And this can happen, because the widget's id's automatically set by the framework are automatically numbered in order, and when an AJAX request is made to the server, this numbering will start from the beginning, from scratch.  To solve a problem, you can always set the form id manually, or in the onClick event interceptor you can use the form submission buttons <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> form = $(<span class="hljs-string"><span class="hljs-string">"form"</span></span>, modal); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (form.attr(<span class="hljs-string"><span class="hljs-string">"id"</span></span>) === <span class="hljs-string"><span class="hljs-string">"w0"</span></span>) { form.attr(<span class="hljs-string"><span class="hljs-string">"id"</span></span>, widgetId + <span class="hljs-string"><span class="hljs-string">"-modal-form"</span></span>); form.yiiActiveForm(); }</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      3. Appetite comes with eating, and now I would also like to send a certain message to the user (already hiding the form and closing the modal window), a file, and can, despite all the principles of AJAX, still refresh the page or make a switch to another.  Unlinking from the standard form submission procedure in the previous paragraph, this can be easily implemented in the successor handler of the $ .ajax method described above. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (message === <span class="hljs-string"><span class="hljs-string">"#reload"</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.href = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.href.replace(<span class="hljs-string"><span class="hljs-string">"#"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (message.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) === <span class="hljs-string"><span class="hljs-string">"#redirect "</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.href = message.substring(<span class="hljs-number"><span class="hljs-number">10</span></span>); } <span class="hljs-comment"><span class="hljs-comment">//  . .</span></span></code> </pre> <br>  You can also ask the user any question, request confirmation of actions, and, depending on the answer, send a request to the server or not. <br><br>  All this (and even more) was implemented as a <a href="https://github.com/himiklab/yii2-gridview-ajaxed-widget">yii2-gridview-ajaxed-widget extension</a> , in which the modified GridView widget (inherited from the GridView framework) can be directly used as a replacement for the standard one.  In this modified widget, some optional parameters appear that are associated with additional functionality, for example, addButtons, where you can specify one or more buttons that open the form for adding a new element, each can be added with its route, you can also specify your own route for the built-in update buttons , view, delete, but more often than not, the widget itself determines the desired route and the names of the key fields of the model and forms the necessary GET parameters.  You can also specify your callback functions for handling errors and displaying a message to the user, and a little bit of any different different customization, the need for which arose in the course of working on various projects. <br>  If the widget itself can be used without changes, as standard, then the controller will need to make some changes, for example, the actions of the update and removal procedures should contain something like this code: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($model-&gt;load(Yii::$app-&gt;request-&gt;post()) &amp;&amp; $model-&gt;save()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;renderAjax(<span class="hljs-string"><span class="hljs-string">'_form'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'model'</span></span> =&gt; $model, ]);</code> </pre> <br>  Delete, may not return anything at all, or return something like ‚Äú#alert Record cannot be deleted!‚Äù, Then the corresponding message will be displayed to the user.  As you see, create.php and update.php are no longer needed, the application code is simplified, and the possibilities are somewhat extended. <br><br>  It also becomes possible to use several independent GridViews on one page, for example, as nested form elements that are independent from each other, without form dependencies on them, but dependent on the form itself: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//   if (Yii::$app-&gt;request-&gt;get('_pjax')) { return $this-&gt;renderPartial('_pjax', [ 'model' =&gt; $model, ]); } //   </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">= $this-&gt;render('_grid1', [ 'model' =&gt; $model, ]) </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> // ‚Ä¶ </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">= $this-&gt;render('_grid2', [ 'model' =&gt; $model, ]) </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> //  _pjax.php </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> if (Yii::$app-&gt;request-&gt;get('_pjax') === '#grid1-pjax'): </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">= $this-&gt;render('_grid1', [ 'model' =&gt; $model, ]) </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> elseif (Yii::$app-&gt;request-&gt;get('_pjax') === '#grid2-pjax'): </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">= $this-&gt;render('_grid2', [ 'model' =&gt; $model, ]) </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> endif; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br>  Some points in the presented code can be simplified if the form is small and special optimization is not required. <br><br>  Anticipating questions for a large number of widget parameters (like readOnly, actionColumnLeft) or the fix for <a href="https://github.com/select2/select2">Select2</a> contained in it, or support for the <a href="https://fontawesome.com/icons/spinner">spinner</a> from Font Awesome.  I can say that this does not interfere, given the small amount of code and the absence of unforeseen effects;  these libraries are widely used in many projects on Yii2;  This is a RAD development widget.  And parameters like actionColumnTemplate are needed because of adding functionality to the widget that is important for the assigned mission, no one bothers to set actionColumnEnabled to false and add your own ActionColumn by examining the corresponding part of the widget code.  And also add your own buttons with various actions, like downloading a file and sending an AJAX request to the server without changing the state of the GridView. <br>  Also, it is known that Pjax will be removed from the Yii core in the third version of the framework, but for now it is convenient to use there.  With the release of Yii3, the widget code can be completely rewritten in the realities of the new version of the framework, or even abandon Pjax and write the necessary functionality using other libraries or plain JS, you can also say about jQuery and Bootstrap. <br><br>  As usual, any constructive criticism, questions and suggestions are welcome. </div><p>Source: <a href="https://habr.com/ru/post/449084/">https://habr.com/ru/post/449084/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../449070/index.html">Superman vs Programmer</a></li>
<li><a href="../449074/index.html">Timofey Subbotin: ‚ÄúThe French counted the money and understood: it‚Äôs better to invest in OSM once than to pay someone every month‚Äù</a></li>
<li><a href="../449076/index.html">News from the world of OpenStreetMap ‚Ññ456 (09/04/2019-15.04.2019)</a></li>
<li><a href="../449078/index.html">10 ways how you can cheat when exchanging cryptocurrency</a></li>
<li><a href="../44908/index.html">Square cd</a></li>
<li><a href="../4491/index.html">Privacy died in the information age</a></li>
<li><a href="../44910/index.html">Minucion: and happiness seems so close!</a></li>
<li><a href="../449106/index.html">UPS for banking and financial institutions</a></li>
<li><a href="../44911/index.html">Zend Framework 1.7.0</a></li>
<li><a href="../449110/index.html">Fixed a bug related to the inability to use Cyrillic in IMAP folder names</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>