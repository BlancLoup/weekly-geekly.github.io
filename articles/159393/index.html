<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Faxes in Freeswitch without fax</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After the first half of the zero years, when the Internet and e-mail were widely distributed even in small cities, and the button ‚Äúsend to e-mail‚Äù app...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Faxes in Freeswitch without fax</h1><div class="post__text post__text-html js-mediator-article">  After the first half of the zero years, when the Internet and e-mail were widely distributed even in small cities, and the button ‚Äúsend to e-mail‚Äù appeared on scanners, I thought that faxes were from the category of fossils as analog modems. <a name="habracut"></a><br>  But, to my misfortune, the love of fax machines was most of all fed by the employees of the accounting departments, who, in turn, were loved by the ‚Äúexecutives‚Äù and ‚Äúgenerals‚Äù.  Considering the state of the analog lines in general, at that time the calls for ‚Äúbad faxes‚Äù were spoiled by the overall picture of the <a href="http://en.wikipedia.org/wiki/Technical_support">service desk</a> tickets, and my love for this document transfer technology was not at all. <br>  Since 2006, in my projects, I began to use <a href="http://www.asterisk.org/">Asterisk</a> or <a href="http://www.avaya.com/">Avaya</a> from business processes using Brainwashing at ‚Äúdecision makers‚Äù, thoughts about faxes were removed, in rare cases for the above-mentioned bookkeeping they left one analog line. <br>  In 2012, when designing, the customer needed to be able to call from the site.  About <a href="http://ru.wikipedia.org/wiki/WebRTC">WebRTC</a> read, but did not like it, stopped at Skype.  Decisions on the Freeswitch, as a stable gate, have already been worked out by many, and on Asterisk it was no longer interesting. <br>  After implementation, with the filing of local accounting, there was a question about faxes.  Analog lines of the project did not provide.  Consulted and agreed on the decision "at least at the reception." <br>  Especially for the passage of faxes in the "computer telephony" protocol was developed <br>  <a href="http://ru.wikipedia.org/wiki/T.38">T.38</a> .  In my case, there was no provision for additional equipment with its budget support, but I did not get an answer from the local Rostelecom.  I stopped at the decision to use the G.711 codec and receive the document directly to the file. <br><br>  In dialplan added: <br><br><pre><code class="bash hljs">&lt;extension name=<span class="hljs-string"><span class="hljs-string">"fax"</span></span>&gt; &lt;condition field=<span class="hljs-string"><span class="hljs-string">"destination_number"</span></span> expression=<span class="hljs-string"><span class="hljs-string">"^fax$"</span></span>&gt; &lt;action application=<span class="hljs-string"><span class="hljs-string">"answer"</span></span>/&gt; &lt;action application=<span class="hljs-string"><span class="hljs-string">"playback"</span></span> data=<span class="hljs-string"><span class="hljs-string">"silence_stream://2000"</span></span>/&gt; &lt;action application=<span class="hljs-string"><span class="hljs-string">"rxfax"</span></span> data=<span class="hljs-string"><span class="hljs-string">"/opt/freeswitch/fax/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${strftime(%Y-%m-%d-%H-%M-%S)}</span></span></span><span class="hljs-string">-</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${caller_id_number}</span></span></span><span class="hljs-string">.tiff"</span></span>/&gt; &lt;action application=<span class="hljs-string"><span class="hljs-string">"hangup"</span></span>/&gt; &lt;/condition&gt; &lt;/extension&gt;</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Freeswitch has a fax tones analysis function for the entire voice session <a href="http://wiki.freeswitch.org/wiki/Misc._Dialplan_Tools_tone_detect">tone detect</a> , and used it by writing: <br><br><pre> <code class="bash hljs"> &lt;action application=<span class="hljs-string"><span class="hljs-string">"tone_detect"</span></span> data=<span class="hljs-string"><span class="hljs-string">"fax 1100 r +5000 transfer fax XML default"</span></span>/&gt;</code> </pre><br><br>  immediately after the voice greeting is answered.  File folder distributed to the network via <a href="http://www.samba.org/">Samba</a> .  The customer, in the person of the chief accountant, was dissatisfied with the implementation without the usual apparatus, but in the debate against the advantage in saving money on paper, she could not argue the opposite.  There is nothing left for accounting, how to study "new technologies". <br><br>  A logical continuation of the story was the urgent need to send faxes.  Working in <a href="http://www.hylafax.org/">Hylafax</a> with the web interface, I thought it would be an impossible task for the customer.  The idea of ‚Äã‚Äãprinting a document on a virtual printer was beautiful, but it required additional actions of the recipient sending the number.  Considering that business processes in an organization involved the scanning of documents in a specific repository, there were several workstations equipped with tablets and a dock.  scanners, as well as the format used tiff, I decided that with the least resistance you can implement the following scheme;  The document to be sent is scanned into a tiff file on a samba resource for sending faxes, with the assignment of the name of the form 8923XXXXXXX.tiff, where the file name before the extension is the recipient's number. <br><br>  The script to send had the following form: <br><br><pre> <code class="bash hljs">send_fax.sh <span class="hljs-comment"><span class="hljs-comment">#/bin/bash #    # Send FAX script # Aleksey Ovchinnikov 2012 +7 913   find /home/fax/*.tif -printf "%f\n" | while read fname do mydate=$(date +%Y-%m-%d_%H-%M-%S) /usr/bin/convert -page Letter -density 204x98 -resize 1728!x1186 -units pixelsperinch -monochrome -compress Fax /home/fax/${fname%} /op t/freeswitch/fax/./$mydate"_"${fname%} rm /home/fax/${fname%} /opt/freeswitch/bin/fs_cli -x "originate sofia/gateway/rt/${fname%.*} &amp;txfax(/opt/freeswitch/fax/./$mydate"_"${fname%})" done</span></span></code> </pre><br><br>  Scanning documents in the required parameters sometimes led to an error, I had to rewrite the script and forcefully convert files using ImageMagick. <br><br>  To exclude questions, ‚Äúfax went?‚Äù Added the following extension to the dialplan: <br><br><pre> <code class="bash hljs">&lt;extension name=<span class="hljs-string"><span class="hljs-string">"send_fax"</span></span>&gt; &lt;condition field=<span class="hljs-string"><span class="hljs-string">"destination_number"</span></span> expression=<span class="hljs-string"><span class="hljs-string">"^205$"</span></span>&gt; &lt;action application=<span class="hljs-string"><span class="hljs-string">"export"</span></span> data=<span class="hljs-string"><span class="hljs-string">"api_hangup_hook=system /opt/freeswitch/scripts/send_fax.sh"</span></span>/&gt; &lt;action application=<span class="hljs-string"><span class="hljs-string">"answer"</span></span>/&gt; &lt;action application=<span class="hljs-string"><span class="hljs-string">"playback"</span></span> data=<span class="hljs-string"><span class="hljs-string">"/opt/freeswitch/sounds/ru/RU/elena/___.wav"</span></span>/&gt; &lt;action application=<span class="hljs-string"><span class="hljs-string">"hangup"</span></span>/&gt; &lt;/condition&gt; &lt;/extension&gt;</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/159393/">https://habr.com/ru/post/159393/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../159377/index.html">Monkey programming language</a></li>
<li><a href="../159381/index.html">A young, dynamic company ...</a></li>
<li><a href="../159387/index.html">uLogin a year later. Social Authorization Facts</a></li>
<li><a href="../159389/index.html">We write our std :: function (boost :: function)</a></li>
<li><a href="../159391/index.html">Hyper-V Extensible Switch in Windows Server 2012</a></li>
<li><a href="../159395/index.html">Reader Pocketbook BASIC 613: first impressions</a></li>
<li><a href="../159401/index.html">Convenient interface Habra?</a></li>
<li><a href="../159403/index.html">The final version of Firefox for Android now supports devices with ARMv6 architecture</a></li>
<li><a href="../159405/index.html">Disposal of printed circuit boards in hot water</a></li>
<li><a href="../159407/index.html">Update Opera Mini 7.1 for J2ME and BlackBerry</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>