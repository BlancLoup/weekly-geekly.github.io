<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Yii discrete projects based on a common core</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good evening to all habrausers! 

 I want to share certain ideas and thoughts on the creation of separate projects in Yii based on one common core. 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">🔎</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">📜</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">⬆️</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">⬇️</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Yii discrete projects based on a common core</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/5eb/83c/1d4/5eb83c1d48be3cee13189c2a8fc7c5b7.png"><br>  Good evening to all habrausers! <br><br>  I want to share certain ideas and thoughts on the creation of separate projects in Yii based on one common core. <br><br>  Some time ago, having passed from kohana to yii due to my working needs, I have long rejoiced at its simplicity and convenience, which, as it seemed to me, were many times more than Kohana’s (yes, the fans of this framework will forgive me), and then however, it was necessary to go deep into the architecture of Yii, and, in particular, into the possibility of distributing its projects from a single core. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Initially, what is called “out of the box”, Yii is already delivered in separate folders with the kernel itself and several demo projects on it, but this was not enough for me, since several other project management and control capabilities were needed, on the basis of which those ideas that I want to present. <br><br><a name="habracut"></a><br><h5>  Little reservations </h5><br>  Let's start with the fact that I will not bother with the fine settings of Apache, php, or other things right now, because I want to present just an idea and find out your, dear habrayusers, an opinion on whether to develop the proposed method further and how it can be modified. therefore, at once I will make a reservation that all the actions described below take place on the newly installed ubunt 11.10 and the traditional lamp from the box. <br>  It is also assumed that the reader is already familiar with the basics of Yii, and at least roughly knows its directory structure. <br><br><h5>  Training </h5><br>  So, initially we have the easiest host with some of these settings: <br><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VirtualHost</span></span></span><span class="hljs-tag"> *</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:80</span></span></span><span class="hljs-tag">&gt;</span></span> ServerName demo.lori ServerAlias demo.lori www.demo.lori DocumentRoot /home/lori/workspace/demo.lori/www ErrorLog /home/lori/workspace/demo.lori/logs/error.log CustomLog /home/lori/workspace/demo.lori/logs/access.log common <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VirtualHost</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  ZY  The <i>.lori</i> domain zone <i>is</i> selected for tests and of all the possible meanings of meaning bears in itself only the accepted alternative name of your humble servant. <br><br>  Log folders were selected for faster access to them during the development process (I do not claim to be a guru in the field of Unix, and therefore, if someone tells me that this is not kosher, I’ll be happy to hear). <br><br>  Additionally, in the workspace folder, we create a folder called <b>yii</b> , where we unpack the freshly archived archive in Yii, and more specifically, the framework folder from it (at the time of the article creation, the last stable version of the framework was 1.1.10).  From now on, this will be our core, and (purely theoretically, of course), in the future we will touch it very rarely. <br><br>  After that, in the <i>/home/lori/workspace/demo.lori/www</i> folder, <i>we</i> will organize the following structure (according to the recommendations Yii modified for this method): <br><br>  - <b>www /</b> <br>  —— <i>index.php</i> <br>  —— <i>.htaccess</i> <br>  —— <b>config /</b> <br>  ——— <b>devel /</b> <br>  ———— <i>&lt;development location config files&gt;</i> <br>  ——— <b>stable /</b> <br>  ———— <i>&lt;production location configuration files&gt;</i> <br>  —— <b>engine /</b> <br>  ——— <i>&lt;project project files&gt;</i> <br>  —— <b>themes /</b> <br>  ——— <b>basic /</b> <i>(main theme name)</i> <br>  ———— <b>static /</b> <br>  ————— <b>images /</b> <br>  ————— <b>css /</b> <br>  ————— <b>js /</b> <br>  ———— <b>views /</b> <br>  ————— <i>&lt;files of all our views by topic&gt;</i> <br><br>  Now, according to the above organization, all project files (controllers, components, models, etc.) will be stored in the <b>engine</b> folder, the <b>themes</b> folder will not change, themes and other static content like CSS or JS files will be stored here.  The <b>config</b> folder also remains canonical, however, its insides will change somewhat. <br><br>  After all the folders and files have been created, it remains, as Yii experts have rightly noticed, to create the runtime and assets folders, however, the first significant changes begin here.  These folders will be organized in a special way. <br><br>  Immediately note: all further commands are executed through sudo, because I will not specify it, assuming that we already have all the rights. <br><br>  We create a common warehouse for our projects: <br><pre> <code class="bash hljs">mkdir -p /home/projects/data/demo.lori <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/projects/data/demo.lori mkdir -p ./assets/stable mkdir -p ./runtime/stable mkdir -p ./upload/stable mkdir -p ./assets/devel mkdir -p ./runtime/devel mkdir -p ./upload/devel</code> </pre><br>  Now we need to allow our framework to create files in these folders, for this we execute: <br><pre> <code class="bash hljs">chown www-data -R /home/projects</code> </pre><br>  (There is also a small question for the experts * unix, are there any comments on the rights?) <br><br>  Now all we have to do is create symlinks for these folders in our project: <br><pre> <code class="bash hljs">ln -s /home/projects/data/demo.lori/assets /home/lori/workspace/demo.lori/www/assets ln -s /home/projects/data/demo.lori/runtime /home/lori/workspace/demo.lori/www/runtime ln -s /home/projects/data/demo.lori/upload /home/lori/workspace/demo.lori/www/upload</code> </pre><br><br>  <b>UPD1 (Based on Comments):</b> Why use a similar directory structure <b>?</b> <br>  1) According to the theory of Yii, assets should store files that somehow join the project, for example, some third-party js scripts, css-files, pictures and other things, so if I use in all my projects, for example , trivial jQuery or CSS reset, it would be more logical to store them in one place outside of all projects. <br>  2) Runtime did not make much sense, but theoretically it does not play a special role in development and is needed by Yii himself, because in order not to clutter up the project folder itself, this directory is moved beyond its limits. <br>  3) Remote and centralized uploading is needed so that, for example, when there is some kind of environment on the local network, the files used in the projects are common for all developers, for example, if in some project there is an avatar download to the user, it is more logical to do so that if one person loads the picture, then all other developers should see it, if there is some link to it in the database. <br><br>  At this basic training completed, go directly to setting up the project. <br><br><h5>  Configure entry point </h5><br>  Let's start with the index.php file, it is almost no different from the standard Yii entry point, with the exception of corrections for splitting locations into production and production: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> date_default_timezone_set(<span class="hljs-string"><span class="hljs-string">'Europe/Moscow'</span></span>); error_reporting(E_ALL); ini_set(<span class="hljs-string"><span class="hljs-string">'display_errors'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  Yii $yii = dirname(__FILE__).'/../../yii/yii.php'; /* ,      .    ,     ,   .     ,       . */ define('DEVELOP_LOCATION', (gethostname() == 'lori-desktop' ? 'devel' : 'stable')); /*     ,    .    . */ if (array_key_exists('HTTP_LORI_DEBUG', $_SERVER) and $_SERVER['HTTP_LORI_DEBUG'] == 'DEBUG IT, DEBUG!') { defined('YII_DEBUG') or define('YII_DEBUG',true); defined('YII_TRACE_LEVEL') or define('YII_TRACE_LEVEL', 10); } /*       .htaccess.      ,  ,    . */ if ($_SERVER['REQUEST_URI'] != $_SERVER['REDIRECT_URL']) $_SERVER['REQUEST_URI'] = $_SERVER['REDIRECT_URL']; //        $config = dirname(__FILE__).'/config/'.DEVELOP_LOCATION.'/main.php'; require_once($yii); Yii::createWebApplication($config)-&gt;run();</span></span></code> </pre><br>  .Htaccess itself looks like this at the moment: <br><pre> <code class="html hljs xml">AddDefaultCharset UTF-8 RewriteEngine on RewriteBase / RewriteCond %{REQUEST_FILENAME} -d RewriteRule ^upload/(.*)$ /forbidden [L] RewriteCond %{REQUEST_FILENAME} -d RewriteRule ^assets/(.*)$ /forbidden [L] RewriteCond %{REQUEST_FILENAME} !-f RewriteRule ^assets/(.*)$ /nofile [L] RewriteCond %{REQUEST_FILENAME} !-f RewriteRule ^upload/(.*)$ /nofile [L] RewriteCond %{REQUEST_URI} !^/assets RewriteCond %{REQUEST_URI} !^/upload RewriteRule ^(.*)$ index.php [L]</code> </pre><br>  Entry points are ready, now you need to configure configs for them. <br><br><h5>  Setting options :) </h5><br>  I will not paint the creation of settings for each of the locations, and I will describe the actions for the devel-location, since all changes will take place on it, and the creation of a config for the production-location occurs identically. <br><br>  To begin with, in the folder <b>config / devel /</b> create the file <b>main.php</b> .  It will look like the usual <b>main.php</b> from the <b>config</b> of any project on Yii, but we will add some additions to it according to our file organization: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-comment"><span class="hljs-comment">//          engine 'basePath' =&gt; dirname(__FILE__).'/../../engine/', 'name' =&gt; 'Demo project', //     runtime    'runtimePath' =&gt; dirname(__FILE__).'/../../runtime/devel', //        /themes 'theme' =&gt; 'basic', 'preload' =&gt; ..., 'import' =&gt; ..., 'defaultController' =&gt; 'default', //         'components' =&gt; array( 'assetManager' =&gt; array( 'basePath' =&gt; dirname(__FILE__).'/../../assets/devel', ), 'user' =&gt; ..., 'db' =&gt; ..., 'errorHandler' =&gt; ..., 'urlManager' =&gt; array( 'urlFormat' =&gt; 'path', 'rules' =&gt; require_once dirname(__FILE__).'/routes.php', ), 'log' =&gt; ... ), 'params' =&gt; require(dirname(__FILE__).'/params.php'), );</span></span></code> </pre><br>  In the above configuration, the three-dot numbers replace the standard blocks of code that are not affected by the current changes in the file organization and which therefore do not need to be described. <br>  Additionally, it is worth <b>mentioning the urlManager</b> setting: <br>  I don’t like that the classical routing is confused with the config, so I always <b>put</b> it in a separate <b>routes.php</b> file in the same folder as <b>main.php</b> , and it contains the usual structure of the form <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'var1'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'value1'</span></span> );</code> </pre><br><h5>  Afterword </h5><br>  This, in principle, the entire basic project setup is completed - the project is set up. <br><br>  Advantages of this approach: <br>  - The separation of projects from each other <br>  - One engine for all projects, which allows you to update it or supplement it once and for all projects at once <br>  - Presence of division into development and production locations, with own configs and included files <br>  - Convenience when working with version control systems like Git <br>  - To some extent, the theme catalog separated from the project <br><br>  Minuses: <br>  - not yet detected <br><br>  I like this approach with my flexibility, because, if you look at it, you can seriously expand it, operating with htaccess locations, creating separate configs for different environments, and much more, while not worrying about some kind of buns into the core, transfer changes in all your projects (after all, the core, like any project, is a project in itself, which can also be changed to dev-location and unloaded to production. <br><br>  If someone has any comments or questions, I will be glad to hear and, if possible, to answer or correct some places in the given example. <br><br>  Also, I would like to ask the public about the need to create a series of articles devoted to the full cycle of creating a project on Yii, because, frankly, I did not find similar articles on the web, basically there are a lot of articles on certain topics like caching or validation, and the original guide, presented by the developers, also does not give a full perception of the project on Yii as a whole. <br><br>  Thanks to everyone who read the article to the end! <br><br>  <b>UPD:</b> Some nevertheless expressed that the course of articles is not such a bad proposal, then I would like to ask: if you make a cycle on the subject of OT and DL, then what is not a trivial (like the proposed blog or address book) site you would like to see ? </div><p>Source: <a href="https://habr.com/ru/post/141695/">https://habr.com/ru/post/141695/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../141690/index.html">Load Testing with Visual Studio 2010</a></li>
<li><a href="../141691/index.html">Practical use of a thermistor with Arduino</a></li>
<li><a href="../141692/index.html">What part of your life does a computer take?</a></li>
<li><a href="../141693/index.html">EnerGenie EG-PMS-LAN Surge Protector with LAN</a></li>
<li><a href="../141694/index.html">IPTV head station</a></li>
<li><a href="../141696/index.html">"Let's cut off Susanin's foot?" (C)</a></li>
<li><a href="../141697/index.html">Will interstellar travel become a reality? Orientation problem</a></li>
<li><a href="../141698/index.html">Shellcodes, exploits ... Tulsa under Win</a></li>
<li><a href="../141699/index.html">Identify all the classes that the Java application uses.</a></li>
<li><a href="../141701/index.html">Creating Windows 8 and IE10 - a selection of materials for March'12</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>