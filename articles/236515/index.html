<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About blocking the Yota mobile application by MTS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr. As you know, on August 13, we started to issue Yota SIM cards from pre-order . It took a little more than a week from that moment - first on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About blocking the Yota mobile application by MTS</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr.  As you know, on August 13, we started <a href="http://habrahabr.ru/company/yota/blog/233173/">to issue Yota SIM cards from pre-order</a> .  It took a little more than a week from that moment - first on Twitter, then on other social media, and then in calls to our support service, similar complaints from users began to appear - they reported that the Yota mobile application was not working.  As a result of the analysis, it turned out that problems arose only among MTS subscribers who were trying to launch the Yota application, and precisely when connected to the mobile Internet.  When connected via Wi-Fi, the application worked without any complaints.  Also, MTS subscribers did not open the <a href="http://www.yota.ru/voice/">Voice</a> section on the yota.ru website. <br><br>  We assumed that MTS blocked the operation of our application in its network.  And soon our guesses were confirmed.  But first things first. <br><a name="habracut"></a><br><h4>  A few words about the application </h4><br>  Using the Yota application, any smartphone user can order, activate the Yota SIM card and select the required service package.  This approach is non-standard for the Russian market - the application allows you to order a new Yota SIM card, or go to us with your current number from another operator. <br><br><h4>  Outset </h4><br>  The first messages about the problem with the Yota mobile app appeared on August 19, one of the MTS subscribers wrote about it in his microblog on Twitter.  The application was successfully downloaded and installed, but it hung on the first screen.  Experienced, the user found out that this behavior of the application is observed only when using the mobile Internet in the MTS network, when connecting via Wi-Fi everything began to work correctly. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/d33/3ce/5ce/d333ce5ce0ad44fd86094a314de5340a.jpg"><br><br><img src="https://habrastorage.org/files/cc7/b4b/fb3/cc7b4bfb336c43c7b588ae734a4d0b28.jpg"><br><br><img src="https://habrastorage.org/files/709/6e5/ca2/7096e5ca227c462783e270186bb7e1c6.jpg"><br><br><img src="https://habrastorage.org/files/49f/001/071/49f001071155445d9bab06501f928103.jpg"><br><br>  After receiving this information, we checked the operation of our application in the networks of other mobile operators.  In all cases, except for the MTS network, the application worked correctly.  That is, the problem described by the user was indeed reproduced when using the SIM card by our testers. <br><br><h4>  First act </h4><br>  After a decent amount of complaints from users, our experts turned to MTS support service.  On the website mts.ru, according to all the rules, there was a problem with access to certain resources and a request to solve it. <br><br><img src="https://habrastorage.org/files/6ab/1ab/210/6ab1ab21027141988ec54caa912b9d46.jpg"><br><br>  We also duplicated our complaint to the MTS contact center.  From the second time, after a long wait for the operator‚Äôs response, after several switchings to different specialists, I managed to get an answer that they would take up the question.  A few days later the bell rang: they called from the contact center, asked if the problem was resolved.  A Yota employee replied that she did not dare.  The caller promised to transfer the application to another specialist.  More MTS support service did not take any action, we did not receive a written response to our request, or calls. <br><br>  By the time of our contacting the support service, there were already many messages from other MTS users in the network who were faced with the fact of blocking.  This situation even managed <a href="http://tjournal.ru/paper/yota-mts-war">to attract the</a> attention of <a href="http://siliconrus.com/2014/08/mts-bans-yota/">journalists</a> .  However, the operator every time denied the fact of blocking, and the head of their press service, in response, accused Yota of <a href="https://www.facebook.com/photo.php%3Ffbid%3D10204066020678400%26set%3Da.1609771011766.2085833.1460955984%26type%3D1%26_fb_noscript%3D1">‚Äúimpudent lies‚Äù and attempts to ‚Äúhand out feils for the evil will of a competitor operator‚Äù</a> . <br><br><img src="https://habrastorage.org/files/806/fdb/918/806fdb9182614566a7f3b34206ca2592.jpg"><br><br><h4>  Second act </h4><br>  In parallel with the attempts to reach the MTS, we studied how blocking is performed.  It was clear that this is being done much more thinly than the full circumcision of traffic, since all IP addresses respond without problems.  It also turned out that the reason for the inoperability of the application and the Voice section on the site is the following: for their correct operation, access to the service resources static.yota.ru and wa.yota.ru is necessary.  When packets are exchanged with them to establish a session, nothing prevents this process.  In our case, all subsequent data packets are ‚Äúcut.‚Äù  That is, a formal connection is established, but the exchange of ‚Äúuseful‚Äù data with a remote resource is immediately blocked. <br><br><h4>  Third act </h4><br>  Since we did not receive a response from MTS, and the blocking continued, we sent an official letter to their management.  The very fact of blocking was certified by a notary.  We also turned to the independent expert company SPIIRAN, which conducted its own analysis and issued a multi-page official conclusion confirming our ‚Äúdiscoveries‚Äù.  The total volume of the document was more than 100 pages, so we present only the tasks and conclusions made during the study: <br><br>  <b>Baseline Study / Extended Study</b> <br><br>  Objective: to confirm or refute the fact that there are problems with the performance of the mobile application and the Yota site from the subscriber‚Äôs point of view when using SIM cards and the MTS network, and identify the sources of problems with the performance of the mobile application and the Yota section of the voice, using the MTS network . <br><br><img src="https://habrastorage.org/files/860/462/cea/860462cea9a94dfeb60ed2ae91971dfb.jpg"><br><br>  <b>Scenario</b> : <br>  1. Turn off the phone <br>  2. Place the SIM card in the phone <br>  3. Turn on the phone, connect to the network operator <br>  4. To fix the service provider to which the connection was established and the connection conditions <br>  5. Check the functionality of the data transfer service: open the websites yandex.ru, google.ru, lenta.ru through the standard browser of the operating system <br>  6. Check the absence of access through a proxy server - go to the 2ip.ru website, fix the external IP address, make sure that the IP address belongs to the operator to which you are connected via the IP address database <br>  7. Measure the data transfer speed using the Speedtest application. <br>  8. Install Yota mobile app on your mobile device. <br>  9. Perform basic checks of the mobile application Yota <br>  10. Open the website section yota.ru/voice through the standard browser of the operating system. <br>  11. Record results <br>  The script must be executed on each phone and with each SIM card used for the current study. <br><br>  <b>Conclusions</b> : the results of the study confirm the existence of problems with the performance of the mobile application and the Yota site section / voice from the subscriber's point of view when using all the MTS SIM cards purchased for the research and the MTS network of the carrier.  At the same time, it is confirmed that when using an alternative telecom operator Beeline, the operability of the Yota mobile application corresponds to the stated behavior, the Yota section of the site is opened by regular means of the operating system. <br><br>  The results of the extended study showed that for all SIM-cards of MTS, all devices used in the study and for all problematic scenarios, one problem is relevant, with symptoms inherent in all client connections to Yota servers with IP addresses 94.25.232.254, 94.25.232.127.  When using an alternative carrier, Beeline, the problem of connecting to these IP addresses is not reproduced, all network connections are established correctly.  The problem is that after a correct TCP connection is established, further network communication is interrupted due to the lack of a server response to the TCP client request. <br><br>  <b>Determining the cause of problems</b> <br><br>  <b>Purpose</b> : by carrying out an in-depth study to determine the causes of the problem of network interruption when MTS subscribers access Yota servers with IP addresses 94.25.232.254, 94.25.232.127. <br><br><img src="https://habrastorage.org/files/a2c/08a/be7/a2c08abe759b47429330d70493867393.jpg"><br><br>  To conduct an in-depth study, specialized software was developed that emulates various stages of a TCP connection.  The specialized software was launched from the side of the test computer (2) connected to the test phone (1) via the Wi-Fi interface. <br><br>  In order to further analyze the interim results of the study, these network connections were removed from the Wi-Fi interface of the test computer (2) using the WIRESHARK software package.  At the same time, from the servers of Yota, TCPDUMP was also used to remove these network connections with the utility. <br><br>  <b>Scenario</b> : <br>  1. Turn off the mobile device (1) <br>  2. Place the SIM card in a mobile device (1) <br>  3. Turn on the mobile device (1), connect to the carrier network <br>  4. To fix the service provider to which the connection was made, as well as the connection conditions <br>  5. Perform basic checks of data services <br>  6. Connect the test computer (2) to the Wi-Fi interface of the mobile device (1) <br>  7. Conduct basic checks of the availability of IP addresses and routing to IP addresses via ICMP using the TRACEROUTE and PING standard tools. <br>  8. Record and analyze intermediate results. <br>  9. Carry out a specialized test according to the developed method (see the description of the method below) by passing a TCP packet along the network route to the IP addresses of the Yota servers. <br>  10. Record and analyze the results. <br>  The script must be carried out on each SIM-card MTS. <br><br>  <b>Methods of specialized research</b> : The method consists in emulating a TCP connection to the Yota server and sequentially changing the TTL TCP packets with a request for data from the client to the server by analogy with the ICMP route determination method (TRACEROUTE command). <br><br><img src="https://habrastorage.org/files/d3e/321/31c/d3e32131c4414ee487f72f8fc5484b71.jpg"><br><br>  When determining the route to the server, the client sends ICMP Echo Request packets with a packet lifetime from TTL = 1 to TTL = (route length).  Each network node, having received a packet, reduces it by one and passes further along the route.  After receiving an IP packet with TTL = 1, if it is not the destination node of the packet, the network node drops the packet and sends an ICMP Time-to-live exceeded packet to the sender, indicating to the sender that the packet was not forwarded further.  If the receiving node is an end node, then it responds to the request with an ICMP Echo Reply packet.  By analyzing the headers of the received packets, the client can determine the complete route to the destination node.  It is also possible to track potential filtering of IP and ICMP packets on network equipment using this method. <br><br>  The methodology of the current study repeats the algorithm for determining the route to the receiving node, except that the study does not use the ICMP protocol, but the TCP protocol.  In this case, the client first establishes the correct TCP connection, and then sends a TCP packet to request data to the server with the specified TTL.  By increasing the TCP packet lifetime from TTL = 1 to TTL = (route length), it is possible to check the presence of filtering of TCP packets on the network equipment, provided that the same equipment does not have ICMP Echo Request / Reply and ICMP Time-to-live filtering Exceeded. <br><br>  <b>Scenario study</b> : <br>  1. Determination of the "length" of the route to the server.  For this information is used from the results of the TRACEROUTE command. <br>  2. Emulated TCP connection establishment (TCP handshake) <br>  3. Send a TCP packet with a given TTL <br>  4. Waiting for a response from the hardware (server). <br><br>  The script repeats the number of times, according to the length of the route, until a host is found on which the ICMP response to the packet does not arrive, provided there is an ICMP response during the determination of the length of the route.  The script is carried out on each SIM card MTS.  If filtering of network packets is present on any of the network nodes, then the response to the test packet will not come from this equipment.  The carrier that filters packets on the route path is determined by the IP address of the equipment that does not respond to the test packet. <br><br>  <b>Results</b> : based on the results, it can be concluded that the servers are available via IP, routing is functioning correctly - the distance to the Yota IP addresses is 15 network nodes, including a test phone, IP packets are delivered to the server, responses come from the server, average server response time is 90 ms. <br><br>  Checking the passage of IP-packets ICMP Echo Request to the IP-addresses of servers Yota was successful.  Checking the passage of ICMP Echo Request packets and ICMP Time-to-live exceeded packets with an incremental change in TTL packets revealed partial filtering of ICMP packets at the stage between IP addresses 37.29.4.162 and 94.25.208.193.  At the same time, filtering affects only ICMP responses, regardless of whether this type of filtering is available, the request packets reach the Yota IP addresses. <br><br>  <b>Conclusions</b> : the results of the in-depth study show that the cause of the problem, due to which the client‚Äôs mobile device, after sending a TCP data packet, does not receive a response from the server, is the filtering of TCP data packets on the MTS operator‚Äôs side in the network equipment area, which is the first network layer equipment that receives traffic from subscriber devices. <br><br><img src="https://habrastorage.org/files/fe6/a2c/6e5/fe6a2c6e571c49709481bd381dfdcee7.jpg"><br><br><img src="https://habrastorage.org/files/b05/687/569/b05687569b224423a64c66cd54eb80b6.jpg"><br>  <i>The result of the TRACERT command for the server static.yota.ru</i> <br><br>  Delivery of IP-packets and routing packets from and to the IP-addresses of Yota servers are made correctly.  IP service packet filtering was detected that does not affect the final connection establishment and data transfer in the case of using the TCP protocol of the transport layer with guaranteed packet delivery. <br><br>  An in-depth study on a specially developed method of passing a TCP packet data request with different TTL values ‚Äã‚Äãshowed the presence of TCP packet filtering on the MTS equipment with IP address 10.25.132.90, which is the first network layer equipment that receives traffic from subscriber devices. <br><br><img src="https://habrastorage.org/files/d40/cf4/bf8/d40cf4bf89b3444cbee6685d13520fbd.jpg"><br>  <i>The result of sending a TCP packet with TTL = 1 for the server static.yota.ru</i> <br><br><img src="https://habrastorage.org/files/98b/a27/297/98ba2729710046759afd169dcee16e33.jpg"><br>  <i>The result of the TCP packet transmission with TTL = 2 for the server static.yota.ru</i> <br><br><img src="https://habrastorage.org/files/7fa/516/3c1/7fa5163c17a248679b8516e5eac11782.jpg"><br>  <i>The result of the TCP packet transmission with TTL = 3 for the server static.yota.ru</i> <br><br><img src="https://habrastorage.org/files/b4a/711/c8d/b4a711c8dba441a782e9a2f8b9bf140d.jpg"><br>  <i>The result of the TRACERT command for wa.yota.ru server</i> <br><br><img src="https://habrastorage.org/files/d83/2c6/a40/d832c6a401d1429683771e91bc78fa13.jpg"><br>  <i>The result of sending a TCP packet with TTL = 14 for wa.yota.ru server</i> <br><br><img src="https://habrastorage.org/files/17f/743/a44/17f743a44f124319ba0aed95e6087841.jpg"><br>  <i>The result of sending a TCP packet with TTL = 15 for wa.yota.ru server</i> <br><br><h4>  Conclusion </h4><br>  So, according to the results of the examination, the blocking of auxiliary resources that ensure the performance of the application and the section of the site was confirmed - 94.25.232.254 (wa.yota.ru) and 94.25.232.127 (static.yota.ru).  This was observed on all MTS SIM cards used during testing.  In networks of other operators, the application and the Voice section on the yota.ru website work correctly. <br><br>  The expertise confirmed that the network equipment MTS, which receives traffic from subscriber devices, is selectively filtering network packets of data requests.  And the filtering was carried out not from the IP addresses of our servers, but to them.  At the same time, service packets intended for the correct establishment and termination of the connection are not filtered. <br><br>  As a result, the mobile application established a connection with the server, sent requests for data for some time, but without waiting, closed the connection.  All this led to the fact that ‚Äúthe user observed a very characteristic behavior of the application - a long‚Äú hang ‚Äùand lack of response to user actions, which can be regarded as errors and incorrect operation of the application itself‚Äù.  As a result, users could not use any functions of the application, including ordering a Yota SIM card. <br><br>  It is worth noting that such selective filtering is misleading technical specialists when trying to analyze network problems, since it is not possible to detect such filtering using regular network failure analysis tools. <br><br>  MTS actions indirectly damaged our reputation, because users blame Yota for the application‚Äôs inoperability.  This is not to mention the time, effort and money we spent on the above described investigation. <br><br><img src="https://habrastorage.org/files/970/690/ce3/970690ce38d14746a8a86c412358c654.jpg"><br><br><h4>  The climax (or not yet?) </h4><br>  Since August 21, we have repeatedly appealed to MTS representatives at different levels with the requirement to unlock the Yota application.  No action was taken by them.  Today, according to the results of tests and feedback from MTS customers who have previously experienced problems with the application, we confirm that the application has started to work correctly.  We attribute this to the fact that today the general public has become aware of <a href="http://www.forbes.ru/news/267401-yota-khochet-poprosit-fas-vozbudit-delo-protiv-mts">our preparation of a statement to the FAS</a> , and MTS promptly took steps to unlock Yota.  Despite the solution to the problem, we will still file a complaint. </div><p>Source: <a href="https://habr.com/ru/post/236515/">https://habr.com/ru/post/236515/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../236505/index.html">Wearable electronics at IFA 2014</a></li>
<li><a href="../236507/index.html">Summation of divergent series by the methods of Abel, Borel, Cesaro and Dirichlet</a></li>
<li><a href="../236509/index.html">Epson Photo Contest - not just yet another photo contest</a></li>
<li><a href="../236511/index.html">Introduction to the Content Delivery Network</a></li>
<li><a href="../236513/index.html">Conversion optimization: where is the best place to place a call to action? [case]</a></li>
<li><a href="../236519/index.html">Convenient downloading from Books.ru or attaching to WWW :: Mechanize</a></li>
<li><a href="../236523/index.html">Disadvantages of RDBMS or RDBMS vs NoSQL</a></li>
<li><a href="../236529/index.html">News DerbyJS 09.2014</a></li>
<li><a href="../236531/index.html">What is ‚ÄúDark web‚Äù?</a></li>
<li><a href="../236533/index.html">ASUS Gladius - review of the game mouse from the Republic Of Gamers series</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>