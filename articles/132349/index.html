<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Your task switch logging in one day</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Even at the dawn of my career I had a chance to work with RTOS VxWorks and the Tornado development environment. The impressions were extremely positiv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Your task switch logging in one day</h1><div class="post__text post__text-html js-mediator-article">  Even at the dawn of my career I had a chance to work with RTOS VxWorks and the Tornado development environment.  The impressions were extremely positive (especially now there is something to compare), but the post is not about that.  A component of the system at that time was a system for collecting and visualizing information on switching tasks in real time.  I must say that the thing is extremely useful, not for nothing that they say that it is better to see once.  For example, if you have at least two dozen tasks in your system, then with 99% certainty you can be surprised that when you see the task switching visualization, it will not be at all what you imagined it to be. <br><br>  You can see the last moments of the system‚Äôs life, for example, in case of an unexpected failure, freeze or reboot! <br><br>  But what to do if you have to work with RTOS and the environment where there is no such convenient mechanism?  Of course, do it yourself! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  Part one, collecting statistics. <br><br>  Everything is simple - we need an exact timer (microseconds or more precisely) and some free memory space.  In memory, we allocate space for the array for data (based on ‚Äúone switch - taskId + time‚Äù), ‚Äúhang‚Äù on the OC event ‚Äúswitch tasks‚Äù (and on the input-output to / from the interrupt, if you want to track them too), and save the data (the ID of the active task and the timer value) into an array (which is used as a cyclic buffer). <br><br>  You can also implement ‚ÄúUser-defined events‚Äù - write a function that, when it is called, will enter values ‚Äã‚Äãinto this array to see when exactly one or another event in the code happens. <br><br>  We implement the ability to start-stop logging on demand (CLI, function call ...) and the possibility of continuous logging (to track, for example, the last moments before a failure - after all, after rebooting, the saved data will be perfectly stored in memory, unless of course the memory is not forcibly cleared). <br><br>  And, depending on the embedded system, we will implement some method of transferring this array from the embedded device to the PC, where we will visualize it.  If embedded has a file system - it can be an entry in the file, if not - then some other option - sending over the network, for example.  I used RS232, used in the system for debugging. <br><br>  It remains to visualize the collected information.  And here we don‚Äôt even have to write anything (or almost nothing).  You can use the free package Octave, which can draw 2D graphics functions and perfectly implements zoom-in - zoom-out (even if you collect data in just a couple of seconds, considering that usually a task time slice is 1 millisecond, without a zoom not enough). <br><br>  All you need to do is convert the collected data to the Octave format: <br><br>  y = [time1, time2, ..., timeN]; <br>  x = [task1, task2, ..., taskN]; <br>  plot (x, y) <br>  grid on <br><br>  Here, timeX is time (in any units, it is more convenient to use, for example, micro- or milliseconds, and make time1 equal 0), and taskX is the task ID (in principle, any number, but it is more convenient, again, to sort tasks by priorities and ration them so that their IDs were 1, 2, 3 ..., remembering what value of which task).  If there are interruptions and user events, you can also think of something, for example, by numbering user events with negative numbers. <br><br>  How to do this conversion - everyone can choose for himself (it is here that you will have to write a little of your code). <br><br>  The result will be something like this.  This is how the system looked in the idle state: <br><br><img src="https://habrastorage.org/storage1/0ea65700/bc87ae51/f87292eb/dfec42a7.png"><br><br>  And so - fully loaded: <br><br><img src="https://habrastorage.org/storage1/7911708d/c806a030/0cb37bfe/dffcaeaf.png">  " <br><br>  It seems to me that the opportunity to see what is really happening in the system with my own eyes is worth it to spend a little time and do the above actions. <br><br>  A professionally made decision from WindRiver was, of course, more beautiful, it showed task names, not abstract IDs, showed interesting points in dots on the graph ... But if it isn‚Äôt, then it‚Äôs better to have your own, albeit simpler than not to have it at all. </div><p>Source: <a href="https://habr.com/ru/post/132349/">https://habr.com/ru/post/132349/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132343/index.html">Marketing Planning Module: A Strategic Approach</a></li>
<li><a href="../132344/index.html">The first working attack on the SSL / TLS protocol</a></li>
<li><a href="../132345/index.html">Autosave, or Preserve time and nerve cells</a></li>
<li><a href="../132346/index.html">Personal data from the FIU got into the Internet</a></li>
<li><a href="../132347/index.html">Mielophone - a month later</a></li>
<li><a href="../132350/index.html">European Internet market and promotion of startups abroad</a></li>
<li><a href="../132351/index.html">Do-Ra. Dosimeter in mobile phone</a></li>
<li><a href="../132352/index.html">Samizdat - library in your pocket. Version 2.0.0 Beta</a></li>
<li><a href="../132353/index.html">Creating a web service based on WSF / PHP with UsernameToken authentication and HTTPS</a></li>
<li><a href="../132354/index.html">Remote programming pair using GNU Screen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>