<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Non-standard approach to programming the microcontroller</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will consider a non-standard approach to creating a program for the microcontroller. For example, build a project "code lock"; The progra...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">🔎</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">📜</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">⬆️</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">⬇️</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Non-standard approach to programming the microcontroller</h1><div class="post__text post__text-html js-mediator-article">  This article will consider a non-standard approach to creating a program for the microcontroller.  For example, build a project "code lock";  The program for the microcontroller will be written in the Horizont Configurator visual environment. <br><a name="habracut"></a><br>  A simplified schematic diagram of the project is presented in the following figure.  This figure does not show the power pins, and the LED is used as an actuator.  The ATmega8 microcontroller was chosen as the manager. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f09/f72/69b/f09f7269b5532d1fa78c75cee0e6e21a.png" alt="image"></div><br><br>  To implement the project, it is necessary to use 4 outputs of the microcontroller, namely, data input from the “push-button field 0-9”, data input from the “save code” button, output for controlling the actuator “lock”, output confirmation of entering the digit “digit”. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To enter the code, a 0-9 field is used, made in the form of a voltage divider with a variable division factor.  The coefficients are chosen as follows. When you press 0, a voltage of 0 volts, 1 0.5, 2 1.0, 3 1.5, 4 2.0, 5 2.5, .., 9 4.5, is formed at the output, and 5 volts in the free state. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d1d/8a2/d29/d1d8a2d29b9731a051178905c4d79e2a.png" alt="image"></div><br><br>  To measure the potential from the “keypad 0-9” I used a microcontroller output connected to the ADC, this is “PINCO”.  To be able to measure the voltage at the pinco pin, the ADC_ATmega8A and ADC PinCO blocks were added to the canvas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/946/d65/db7/946d65db72aa52d6dd7c739deffe4fdd.png" alt="image"></div><br><br>  The “ADC_ATmega8A” block adjusts the parameters of the analog-to-digital converter built into the microcontroller, in the settings indicated the value of the reference voltage equal to the microcontroller supply voltage.  So I set up the ADC for measuring voltage in the range of 0-5 volts.  To obtain the voltage value at the pinco microcontroller output, I used the ADC PinCO block.  At the output of the block, a discrete signal will be received in the range of 0-1023 proportional to the voltage value at the PINCO pin, with 0 volts corresponding to 0, and 5 volts to 1023. To bring the voltage to a convenient value, we used the “division” and “constant” ". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97d/2d3/660/97d2d366065e65528d2958c9f594916d.png" alt="image"></div><br><br>  When dividing the input range 0-1023 by 90, we get the range convenient for us 0-11 range 0-11.  Moreover, pressing the “button 0” will correspond to the value 0, 1-1, .., 9-9, and in the free state (no button is pressed) will be 11. To record the steady state event of the line, use the “delay” and block "equality". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/988/4f4/70e/9884f470efd85f7eabb7f8370de27a2c.png" alt="image"></div><br><br>  At the output of the block "delay" we get the value that was at the input of the block "delay" in the previous working cycle.  If the values ​​in the previous cycle and in the current one are equal, we fix the steady state of the line, while the output of the “equality” block will be a logical 1 (true) signal, otherwise 0 (false).  To filter the value of 11 “free line state”, we use the “less” blocks, the constant 11 and the logical “AND” block. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc9/1de/b41/bc91deb416bf7982b19c79ad6992291a.png" alt="image"></div><br><br>  At the output of the “logical AND” block there will be a logical unit if the line is in a steady state and the value after the divider is less than 11. To limit the allowable input speed of values ​​from the “push-button field 0-9”, this increases the noise immunity and limits the speed of the “code matching”, I use the “on delay” block and the “millisecond counter” block it needs. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e6e/b64/0aa/e6eb640aa947cb377edf9e252efc137e.png" alt="image"></div><br><br>  For the final formation of the “digit input” signal, we will track the rising edge and form a single “digit input” pulse using this signal.  To do this, use the block "RTRIG". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7e9/76b/24f/7e976b24f9b0c0833c26ec2ea093bcd3.png" alt="image"></div><br><br>  In order to read the scheme and reduce additional connecting lines, I will add “transitions” of connecting lines.  The first transition is “entered digit”, the second is “digit input signal”.  Enable the output control LED "digit accepted" in my circuit is the output of the microcontroller "PinB6". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/16e/66a/4a8/16e66a4a8d9924f9883fbfb493e9b62b.png" alt="image"></div><br><br>  We will use the “entered digit” and “digit input signal” signals, as well as blocks for storing discrete numbers “memory” and organize the logic for storing the last entered numbers.  In my case, I used four “memory” blocks, which would determine the secrecy of the lock in four digits. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a41/98f/28b/a4198f28bbbe09877e913bd48a046462.png" alt="image"></div><br><br>  The logic works as follows: when a “symbol input signal” is received, the “entered digit” value will be recorded in the “memory 1” block, while the value previously contained in the “memory 1” block will be written into the “memory 2” block and so on.  The “memory 1” - “memory 2” blocks will store the last entered digits.  And in the “memory 1” block the last entered digit will be stored, in the “memory 2” block - the penultimate one, and so on.  Add "transitions" for the values ​​of the entered characters. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c84/504/422/c84504422d19fc9668eb38638f9fa6ea.png" alt="image"></div><br><br>  To store the lock code, we will use the non-volatile EEPROM memory of the microcontroller.  Each digit of the code will be stored in a separate EEPROM cell.  In our case, we will need 4 memory cells.  Select the addresses of the EEPROM cells to store the code, for my project I selected cells 10, 11, 12, 13. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ac8/0ba/55e/ac80ba55ec7da91b598692919cf5ad92.png" alt="image"></div><br><br>  To read the value stored in the EEPROM cells, we will use the “read byte EEPROM” block. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/13f/901/c7a/13f901c7a5d2de1af49f0be0b497e2d0.png" alt="image"></div><br><br>  As a result, we have the digits entered from the “push-button field 0-9” and the digits obtained from the EEPROM cells, it remains to make a comparison of the digits and form a control signal to the actuators of the lock.  For this task, I used the “equality” block and the “logical AND” block. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/edd/062/f01/edd062f0131ce8da2a858871b6cefcb5.png" alt="image"></div><br><br>  At this stage, the code lock logic is fully functional, the only thing left is to “teach” the microcontroller to independently save the lock code needed by the user in the EEPROM memory.  For this task, I use an external signal “save code” and by this signal I will generate an EEPROM recording impulse, for this I will use the “PinD6” logic input blocks and the “RTRIG” block, and also create a corresponding transition for convenience. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/897/c6e/76b/897c6e76bfb707810aafc254892e5d3c.png" alt="image"></div><br><br>  Let's build the logic of writing data to the EEPROM, all the signals and data have already been formed, directly for writing data to the EEPROM we will use the “byte writing to EEPROM” block. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/949/82b/b88/94982bb88bd9a46e3bc6fdfee3edb2c5.png" alt="image"></div><br><br>  The logic of the code lock is described, the general view of the project is as follows. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/79a/4f0/cc0/79a4f0cc0983a171dfe06f96c630eb32.png" alt="image"></div><br><br>  We collect the project: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/372/d48/800/372d488000c7a135a2a5c2716af4252b.png" alt="image"></div><br><br>  After assembling the project, we received an executable * .hex file of 1450 bytes in size, we conclude that we can use a microcontroller with a flash memory size of 2 kb. <br><br>  Testing the project: <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/lzLj2GexnaM%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhj8fGs_u_P6jTAN0k8lH3bOMkwenA" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/304830/">https://habr.com/ru/post/304830/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304820/index.html">Gartner's Magic Quadrant for Data Center Networking Market: Arista Networks Leading</a></li>
<li><a href="../304822/index.html">How to create a Telegram bot using WCF service</a></li>
<li><a href="../304824/index.html">Moving responsibility of the repository pattern</a></li>
<li><a href="../304826/index.html">Elementary, Watson, or social media analysis in Aybiems</a></li>
<li><a href="../304828/index.html">Oracle from arithmetic</a></li>
<li><a href="../304832/index.html">Vim and IDE are different things.</a></li>
<li><a href="../304834/index.html">4 moments when Tom Hanks completely changed our attitude to life</a></li>
<li><a href="../304836/index.html">5 principles about which it is important to know to every founder of a technology startup</a></li>
<li><a href="../304838/index.html">Style or lack of it?</a></li>
<li><a href="../304842/index.html">Critical vulnerability allows to intercept all network traffic of users of Windows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>