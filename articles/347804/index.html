<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>WebAssembly and DOM manipulations</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About WebAssembly in our time heard, I think, almost everything. If you have not heard, then on Habr√© there is a wonderful introductory material about...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>WebAssembly and DOM manipulations</h1><div class="post__text post__text-html js-mediator-article">  About WebAssembly in our time heard, I think, almost everything.  If you have not heard, then on Habr√© there is a <a href="https://habrahabr.ru/post/342180/">wonderful introductory material</a> about this technology. <br><img src="https://habrastorage.org/webt/hq/jo/pf/hqjopfuqrpshwebe2chyfqwshf0.png" alt="image"><br>  Another thing is that very often you can find comments like ‚ÄúHooray, now we will write frontend in C ++!‚Äù, ‚ÄúLet's <a href="https://users.rust-lang.org/t/rust-wasm-project-idea-accelerate-react/9944">rewrite React in Rust</a> ‚Äù and so on, and so forth ... <a name="habracut"></a><br>  <a href="https://habrahabr.ru/post/326276/">Interview with Brendan Ike</a> very well reveals the idea of ‚Äã‚ÄãWebAssembly and its purpose: WASM is not a complete replacement for JS, but only a technology that allows you to write resource-critical modules and compile them into portable byte code with a linear memory model and static typing: performance or simplify the transfer of existing code for web applications working with multimedia, online games, and other "heavy" things. <br><br>  With a great desire, you can implement the GUI, for example, imgui library is ported to <a href="https://pbrfrat.com/post/imgui_in_browser.html">WASM</a> , there are <a href="https://pbrfrat.com/post/imgui_in_browser.html">advances</a> in porting Qt to WASM ( <a href="http://qtandeverything.blogspot.com/2017/06/qt-for-web-assembly.html">once</a> and <a href="https://msorvig.github.io/qt-webassembly-examples/">twice</a> ). <br> <a href=""><img src="https://habrastorage.org/webt/k5/6n/gm/k56ngm2e68raehxl0sffwzaswty.png" alt="image"></a> <br><br>  But most often a simple question is voiced: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  ‚ÄúBut still, is it possible to work with DOM from WebAssembly?‚Äù </h4><br>  So far, the categorical answer sounds like ‚ÄúNo, it cannot‚Äù, the more accurate and correct one sounds like ‚ÄúYou can, using Javascript functions‚Äù.  And this article, in fact, is a story about the results of my little research on how to do this as conveniently and efficiently as possible. <br><br><h4>  What is the problem? </h4><br>  Let's see how the generation of page elements in general and working with them from scripts takes place using the example of the Blink web engine (Chromium) and the V8 JS engine.  In fact, almost any DOM element within Blink is embodied as a C ++ object inherited from HTMLElement, inherited from Element, inherited from ContainerNode, inherited from Node ... in fact, this is not the whole chain, but in our case it is not important.  For example, for a tag when parsing HTML and building a tree, an object of class <a href="">HTMLImageElement</a> will be created: <br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CORE_EXPORT</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTMLImageElement</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HTMLElement, ... { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HTMLImageElement* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Document&amp;)</span></span></span></span>; ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; ... <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AltText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> final</span></span>; ... <span class="hljs-function"><span class="hljs-function">KURL </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Src</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetSrc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String&amp;)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setWidth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setHeight</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; ... }</code> </pre> <br>  In order to control the lifetime of objects and their removal, older versions of Blink used smart pointers with reference counting, in modern versions a Garbage Collector called <a href="https://docs.google.com/document/d/1y7_0ni0E_kxvrah-QtnreMlzCDKN3QP4BN1Aw7eSLfY/edit">Oilpan is used</a> . <br><br>  To access the page elements from JavaScript, the object is described as <a href="http://www.chromium.org/blink/webidl">IDL</a> to specify which fields and methods of the object will be available in JavaScript: <br><pre> <code class="cpp hljs">[ ActiveScriptWrappable, ConstructorCallWith=Document, NamedConstructor=Image(optional <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> width, optional <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> height) ] interface HTMLImageElement : HTMLElement { [CEReactions, Reflect] attribute DOMString alt; [CEReactions, Reflect, URL] attribute DOMString src; ... [CEReactions] attribute <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> width; [CEReactions] attribute <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> height; ... [CEReactions, Reflect] attribute DOMString name; [CEReactions, Reflect, TreatNullAs=EmptyString] attribute DOMString border; ...</code> </pre> <br>  after which we can work with them from JavaScript code.  The V8 JS engine also has its own Garbage Collector, and with C ++, Blink objects are wrapped in special wrappers, which are called <a href="https://github.com/v8/v8/wiki/Embedder%2527s-Guide">Template Objects</a> in V8 terminology.  As a result, Blink and V8 garbage collectors monitor the page's lifetime. <br><br>  Now let's imagine how WebAssembly modules fit into this case.  At the moment, what is happening inside the WASM browser for the ‚Äúdark forest‚Äù.  For example, if we take an element from the document, pass the pointer to the WASM module, save the link to it there, and then call removeChild for it, according to Blink, the object will no longer indicate any link and the object should be deleted - because the environment does not know that the element pointer is still stored inside WASM.  What this situation may lead to, I think, is not difficult.  And this is just one example. <br>  Working with garbage-collected objects is in the Roadmap of WebAssembly development and a special <a href="https://github.com/WebAssembly/design/issues/1079">Issue</a> on this issue was launched on github, plus there is a <a href="">document</a> with details of proposals for implementing all of this. <br><br>  So, the WebAssembly code is completely isolated in its ‚Äúsandbox‚Äù, and today it is impossible to transfer a pointer to any object of the DOM tree in a normal way, it is impossible to call any method directly in the same way.  The only correct way to interact with any objects of the DOM tree or use any other browser API is to write JS functions, transfer them to the <b>imports</b> field of the <b>WebAssmebly</b> module and call them from WASM code. <br><br>  helloworld.c: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showMessage</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> num)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> num1)</span></span></span><span class="hljs-function"> </span></span>{ showMessage(num1); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> num1 + <span class="hljs-number"><span class="hljs-number">42</span></span>; }</code> </pre> <br><br>  helloworld.js: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wasmImports = { <span class="hljs-attr"><span class="hljs-attr">env</span></span>: { <span class="hljs-attr"><span class="hljs-attr">showMessage</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">num</span></span></span><span class="hljs-function"> =&gt;</span></span> alert(num) } }; <span class="hljs-comment"><span class="hljs-comment">// wasmCode    -  var wasmModule = new WebAssembly.Module(wasmCode); var wasmInstance = new WebAssembly.Instance(wasmModule, wasmImports); console.log(wasmInstance.exports.main(5));</span></span></code> </pre><br><br>  In the generated bytecode, everything is simple and transparent: the external function is imported, the argument is put on the stack, the function is called, and the result of the addition is stored on the stack. <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">module</span></span> (<span class="hljs-name"><span class="hljs-name">type</span></span> $FUNCSIG$vi (<span class="hljs-name"><span class="hljs-name">func</span></span> (<span class="hljs-name"><span class="hljs-name">param</span></span> i32))) (<span class="hljs-name"><span class="hljs-name">import</span></span> <span class="hljs-string"><span class="hljs-string">"env"</span></span> <span class="hljs-string"><span class="hljs-string">"showMessage"</span></span> (<span class="hljs-name"><span class="hljs-name">func</span></span> $showMessage (<span class="hljs-name"><span class="hljs-name">param</span></span> i32))) (<span class="hljs-name"><span class="hljs-name">table</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> anyfunc) (<span class="hljs-name"><span class="hljs-name">memory</span></span> $<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">export</span></span> <span class="hljs-string"><span class="hljs-string">"memory"</span></span> (<span class="hljs-name"><span class="hljs-name">memory</span></span> $<span class="hljs-number"><span class="hljs-number">0</span></span>)) (<span class="hljs-name"><span class="hljs-name">export</span></span> <span class="hljs-string"><span class="hljs-string">"main"</span></span> (<span class="hljs-name"><span class="hljs-name">func</span></span> $main)) (<span class="hljs-name"><span class="hljs-name">func</span></span> $main (<span class="hljs-comment"><span class="hljs-comment">; 1 ;) (param $0 i32) (result i32) ;//  int main(int) (call $showMessage (get_local $0) ;//    showMessage    () ) (i32.add ;//     ()  i32  (get_local $0) (i32.const 42) ) ) )</span></span></code> </pre><br><br>  It is possible to check in practice how the whole thing works using WasmFiddle: <a href="https://wasdk.github.io/WasmFiddle/%3Fl7d05">https://wasdk.github.io/WasmFiddle/?l7d05</a> <br><br>  It would seem that all is well, but with the complication of the problem problems arise.  But what if we need to transfer from WASM code not a number, but a string (despite the fact that only 32-bit and 64-bit integers and 32-bit and 64-bit floating-point numbers are supported in WebAssembly)?  But what if we need to perform a lot of very different manipulations with the DOM and browser API calls, and it is extremely inconvenient to write a separate JS function in each case? <br><br><h4>  This is where Emscripten comes to the rescue. </h4><br>  <a href="https://kripken.github.io/emscripten-site/">Emscripten</a> was originally designed as an LLVM backend for compiling in asm.js.  In addition to compiling directly in asm.js and WASM, it also contains ‚Äúwrappers‚Äù that emulate the functionality of various libraries (libc, libcxx, OpenGL, SDL, etc.) through the API available in the browser, and its own set of support functions that facilitate porting applications and the interaction of WASM and JS code. <br>  The simplest example.  As is known, only i32, i64, f32, f64 can be arguments and results when calling functions from or from a WASM module.  The WebAssembly module has linear memory that can be mapped to JS as Int8Array, Int16Array, etc.  Therefore, in order to get the value of any non-standard type (string, array, etc.) from WASM to JS, we can put it in the address space of the WASM module, pass the pointer outwards, and already in JS code pull the necessary bytes from the array and convert them to the required object (for example, the strings in JS are stored in UTF-16).  When transferring data ‚Äúinside‚Äù of a WASM module, we should, on the contrary, ‚Äúoutside‚Äù put them into a memory array at a specific address, and only then use this address in C / C ++ code.  For these purposes, Emscripten has a large set of support functions.  So, besides <b>getValue ()</b> and <b>setValue ()</b> (reading and writing heap values ‚Äã‚Äãof a WASM application by pointers), there is, for example, the function <b>Pointer_stringify (), which</b> converts C-strings to JavaScript string objects. <br><br>  Another handy feature is the ability to inline javascript code directly into C ++ code.  The compiler will do the rest for us. <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;emscripten.h&gt; int main() { char* s = "hello world"; EM_ASM({ alert(Pointer_stringify($0)); }, s); return 0; }</span></span></span></span></code> </pre><br>  After compilation, we get a .wasm file with compiled bytecode and a .js file containing the startup code of the wasm module and a huge number of various auxiliary functions. <br>  Directly, our inline macro EM_ASM JS-code has become a .js-file in the following structure: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ASM_CONSTS = [<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">) </span></span>{ alert(Pointer_stringify($<span class="hljs-number"><span class="hljs-number">0</span></span>)); }]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_emscripten_asm_const_ii</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">code, a0</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ASM_CONSTS[code](a0); }</code> </pre> <br>  In the bytecode, we have almost the same thing as in the previous example, only when calling a function, the number 0 is also put on the stack (the function identifier in the <b>ASM_CONSTS</b> array), as well as a pointer to a string constant (char *) in the address space The WASM module, equal in our case to 1024. The <b>Pointer_stringify ()</b> method in the javascript code retrieves data from the ‚Äúheap‚Äù represented in JS as Uint8Array, and performs the conversion from the UTF8 array to a String object. <br>  A closer look confuses the fact that the string constant (char *) located at 1024 for some reason contains not only the text ‚Äúhello world‚Äù with a zero byte, but also a double of the inline JS code.  I cannot explain the reason for the appearance of this inside the compiled wasm file, I would be grateful if someone would share their suggestions in the comments. <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">import</span></span> <span class="hljs-string"><span class="hljs-string">"env"</span></span> <span class="hljs-string"><span class="hljs-string">"_emscripten_asm_const_ii"</span></span> (<span class="hljs-name"><span class="hljs-name">func</span></span> $_emscripten_asm_const_ii (<span class="hljs-name"><span class="hljs-name">param</span></span> i32 i32) (<span class="hljs-name"><span class="hljs-name">result</span></span> i32))) (<span class="hljs-name"><span class="hljs-name">data</span></span> (<span class="hljs-name"><span class="hljs-name">i32</span></span>.const <span class="hljs-number"><span class="hljs-number">1024</span></span>) <span class="hljs-string"><span class="hljs-string">"hello world\00{ alert(Pointer_stringify($0)); }"</span></span>) (<span class="hljs-name"><span class="hljs-name">func</span></span> $_main (<span class="hljs-comment"><span class="hljs-comment">; 14 ;) (result i32) (drop (call $_emscripten_asm_const_ii (i32.const 0) (i32.const 1024) ) ) (i32.const 0) )</span></span></code> </pre> <br><br>  In any case, the conclusion suggests itself that calling the JavaScript functions from the WASM code is not the fastest thing in terms of performance.  At a minimum time will take away the overhead of the interaction of WASM-code and JS-interpreter, type conversion when passing arguments, and much more. <br><br><h4>  Cheerp </h4><br>  Reading the articles and studying the documentation for various libraries, I was caught by the <a href="https://leaningtech.com/cheerp/">Cheerp</a> compiler, which generates WASM code from C / C ++, and according to a loud assurance on the landing page on the official site, providing ‚Äúno-overhead access to HTML5 DOM‚Äù.  My inner skeptic, however, said that there is no magic.  To begin with we try to compile the simplest example from the documentation: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;cheerp/clientlib.h&gt; #include &lt;cheerp/client.h&gt; [[cheerp::genericjs]] void domOutput(const char* str) { client::console.log(str); } void webMain() { domOutput("Hello World"); }</span></span></span></span></code> </pre><br><br>  At the output we get a .wasm file, a quick look at which tells us that there is no data section with a string constant. <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">module</span></span> (<span class="hljs-name"><span class="hljs-name">type</span></span> $vt_v (<span class="hljs-name"><span class="hljs-name">func</span></span> )) (<span class="hljs-name"><span class="hljs-name">func</span></span> (<span class="hljs-name"><span class="hljs-name">import</span></span> <span class="hljs-string"><span class="hljs-string">"imports"</span></span> <span class="hljs-string"><span class="hljs-string">"__Z9domOutputPKc"</span></span>)) (<span class="hljs-name"><span class="hljs-name">table</span></span> anyfunc (<span class="hljs-name"><span class="hljs-name">elem</span></span> $__wasm_nullptr)) (<span class="hljs-name"><span class="hljs-name">memory</span></span> (<span class="hljs-name"><span class="hljs-name">export</span></span> <span class="hljs-string"><span class="hljs-string">"memory"</span></span>) <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>) (<span class="hljs-name"><span class="hljs-name">global</span></span> (<span class="hljs-name"><span class="hljs-name">mut</span></span> i32) (<span class="hljs-name"><span class="hljs-name">i32</span></span>.const <span class="hljs-number"><span class="hljs-number">1048576</span></span>)) (<span class="hljs-name"><span class="hljs-name">func</span></span> $__wasm_nullptr (<span class="hljs-name"><span class="hljs-name">export</span></span> <span class="hljs-string"><span class="hljs-string">"___wasm_nullptr"</span></span>) (<span class="hljs-name"><span class="hljs-name">local</span></span> i32) unreachable ) (<span class="hljs-name"><span class="hljs-name">func</span></span> $_Z7webMainv (<span class="hljs-name"><span class="hljs-name">export</span></span> <span class="hljs-string"><span class="hljs-string">"__Z7webMainv"</span></span>) (<span class="hljs-name"><span class="hljs-name">local</span></span> i32) call <span class="hljs-number"><span class="hljs-number">0</span></span> ) )</code> </pre> <br><br>  Looking in JS: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; a = h(); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(a); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">h</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, d = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; a = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>(); d = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.fromCharCode(<span class="hljs-number"><span class="hljs-number">72</span></span>); a = a.concat(d); d = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.fromCharCode(<span class="hljs-number"><span class="hljs-number">101</span></span>); a = a.concat(d); d = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.fromCharCode(<span class="hljs-number"><span class="hljs-number">108</span></span>); a = a.concat(d); d = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.fromCharCode(<span class="hljs-number"><span class="hljs-number">108</span></span>); a = a.concat(d); d = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.fromCharCode(<span class="hljs-number"><span class="hljs-number">111</span></span>); a = a.concat(d); d = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.fromCharCode(<span class="hljs-number"><span class="hljs-number">32</span></span>); a = a.concat(d); d = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.fromCharCode(<span class="hljs-number"><span class="hljs-number">87</span></span>); a = a.concat(d); d = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.fromCharCode(<span class="hljs-number"><span class="hljs-number">111</span></span>); a = a.concat(d); d = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.fromCharCode(<span class="hljs-number"><span class="hljs-number">114</span></span>); a = a.concat(d); d = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.fromCharCode(<span class="hljs-number"><span class="hljs-number">108</span></span>); a = a.concat(d); d = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.fromCharCode(<span class="hljs-number"><span class="hljs-number">100</span></span>); a = a.concat(d); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>(a); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_asm_f</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ f(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__dummy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">'this should be unreachable'</span></span>); }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> importObject = { <span class="hljs-attr"><span class="hljs-attr">imports</span></span>: { <span class="hljs-attr"><span class="hljs-attr">__Z9domOutputPKc</span></span>: _asm_f, } }; instance.exports.i();</code> </pre> <br><br><img src="https://habrastorage.org/webt/pe/mc/no/pemcnooxmx9vcd78nz2v2afqhfi.jpeg" alt="image"><br><br>  Honestly, it‚Äôs not at all clear why, in such a case, you need to generate a WASM module, since nothing happens in it except for one external function call, and all the logic is located in the JS code.  Anyway. <br><br>  An interesting feature of the compiler are the bindings to all standard DOM objects in C ++ (judging by the documentation, obtained by auto-generating code from IDL), which allow you to write C ++ code ‚Äúdirectly‚Äù that manipulates the necessary objects: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;cheerp/client.h&gt; #include &lt;cheerp/clientlib.h&gt; using namespace client; int test = 1; [[cheerp::genericjs]] void domOutput(int a) { const char* str1 = "Hello world!"; const char* str2 = "LOL"; Element* titleElement=document.getElementById("pagetitle"); titleElement-&gt;set_textContent(a / 2 == 0 ? str1 : str2); } void webMain() { test++; domOutput(test); test++; domOutput(test); }</span></span></span></span></code> </pre> <br><br>  Let's see what we did after compilation ... <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, c = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; a = <span class="hljs-string"><span class="hljs-string">"pagetitle"</span></span>; a = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(a); a = a; a.textContent; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b + <span class="hljs-number"><span class="hljs-number">1</span></span> &gt;&gt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>) { c = <span class="hljs-string"><span class="hljs-string">"Hello world!"</span></span>; a.textContent = c; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { c = <span class="hljs-string"><span class="hljs-string">"LOL"</span></span>; a.textContent = c; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f, g</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = <span class="hljs-number"><span class="hljs-number">0</span></span>, c = <span class="hljs-number"><span class="hljs-number">0</span></span>, a = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, t = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; a = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>(); b = f[g] | <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((b &amp; <span class="hljs-number"><span class="hljs-number">255</span></span>) === <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>(a); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { c = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) { t = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.fromCharCode(b &lt;&lt; <span class="hljs-number"><span class="hljs-number">24</span></span> &gt;&gt; <span class="hljs-number"><span class="hljs-number">24</span></span>); a = a.concat(t); c = c + <span class="hljs-number"><span class="hljs-number">1</span></span> | <span class="hljs-number"><span class="hljs-number">0</span></span>; b = f[g + c | <span class="hljs-number"><span class="hljs-number">0</span></span>] | <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((b &amp; <span class="hljs-number"><span class="hljs-number">255</span></span>) === <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>(a); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Uint8Array</span></span>([<span class="hljs-number"><span class="hljs-number">112</span></span>, <span class="hljs-number"><span class="hljs-number">97</span></span>, <span class="hljs-number"><span class="hljs-number">103</span></span>, <span class="hljs-number"><span class="hljs-number">101</span></span>, <span class="hljs-number"><span class="hljs-number">116</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span>, <span class="hljs-number"><span class="hljs-number">116</span></span>, <span class="hljs-number"><span class="hljs-number">108</span></span>, <span class="hljs-number"><span class="hljs-number">101</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Uint8Array</span></span>([<span class="hljs-number"><span class="hljs-number">76</span></span>, <span class="hljs-number"><span class="hljs-number">79</span></span>, <span class="hljs-number"><span class="hljs-number">76</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> q = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Uint8Array</span></span>([<span class="hljs-number"><span class="hljs-number">72</span></span>, <span class="hljs-number"><span class="hljs-number">101</span></span>, <span class="hljs-number"><span class="hljs-number">108</span></span>, <span class="hljs-number"><span class="hljs-number">108</span></span>, <span class="hljs-number"><span class="hljs-number">111</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">119</span></span>, <span class="hljs-number"><span class="hljs-number">111</span></span>, <span class="hljs-number"><span class="hljs-number">114</span></span>, <span class="hljs-number"><span class="hljs-number">108</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">33</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_asm_j</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">b</span></span></span><span class="hljs-function">) </span></span>{ j(b); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__dummy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">'this should be unreachable'</span></span>); }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> importObject = { <span class="hljs-attr"><span class="hljs-attr">imports</span></span>: { <span class="hljs-attr"><span class="hljs-attr">__Z9domOutputi</span></span>: _asm_j, } }; ... instance.exports.p();</code> </pre> <br><img src="https://habrastorage.org/webt/km/yz/ys/kmyzys17jove7zcmsdd--eunli0.jpeg" alt="image"><br><br>  I think I was wrong about magic.  String constants were in JavaScript code in Uint8 arrays, and when the script is run, they are converted to String by a sequence of character calls to <b>String.concat ()</b> .  Given that the same lines are slightly higher than the direct text in the JavaScript code.  Test increment is done in WASM code;  in the function that sets the text content of the DOM element, you can meet the wonderful ‚Äúa = a‚Äù and call the textContent getter without using its result;  checking the parity for the parity as a result of the work of the optimizer degenerated into the outgoing brain ‚Äúb + 1 &gt;&gt;&gt; 0 &lt;3‚Äù (yes, exactly, with a bit shift by 0 positions). <br>  Can this be called ‚Äúzero overhead DOM-manipulations‚Äù?  Even if we take into account that, in fact, all the same, all the manipulations are performed in the same way through JS (it was difficult to expect something else, in fact), at best you can talk about ‚Äúzero overhead‚Äù compared to pure JS, and strange dances With a tambourine around the performance lines, they obviously will not add, as well as the joy of debugging all this. <br>  As they say, do not believe advertising.  But It is worth noting that the project is still actively developing.  When I forgot to set the <b>[[cheerp :: genericjs]]</b> attribute for the void domOutput (int a) function, when compiled with the ‚Äúwasm‚Äù target, the compiler simply dropped from SIGSEGV.  I started Issue on github of developers about this problem, the next day they explained to me what the error was, and literally a week later in the master branch there was a fix for this problem.  It may be worth watching Cheerp in the longer term. <br><br><h3>  Stdweb </h3><br>  Speaking of compilers and libraries created for interaction between WASM, JS and WebAPI, not to mention <a href="https://github.com/koute/stdweb">Stdweb for Rust</a> . <br>  It allows JS code to be inlined into Rust code with support for closures and provides wrappers for DOM objects and browser APIs as close as possible to what JS is used to see: <br><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> button = document().query_selector( <span class="hljs-string"><span class="hljs-string">"#hide-button"</span></span> ).unwrap(); button.add_event_listener( <span class="hljs-keyword"><span class="hljs-keyword">move</span></span> |_: ClickEvent| { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> anchor <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> document().query_selector_all( <span class="hljs-string"><span class="hljs-string">"#main a"</span></span> ) { js!( @{anchor}.style = <span class="hljs-string"><span class="hljs-string">"display: none;"</span></span>; ); } });</code> </pre> <br><br>  The delivery immediately included examples of the implementation of various things on Rust / WASM, of which the greatest interest is TodoMVC.  It can be run through the cargo-web team. <br>  <b>cargo web start ‚Äìtarget-webasm-emscripten</b> <br>  as a result, we get a web server on port 8000 with our application. <br>  After compilation, we see the same Emscripten helpers in the .js file, but much more interesting (bearing in mind what was in the previous paragraph) is how the JS code call from the WASM module and the work with objects . <br>  Exactly the same as in the second example (compiling C ++ using Emscripten), the ASM_CONSTS array is filled with functions of approximately the following form: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ASM_CONSTS = [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">) </span></span>{ Module.STDWEB.decrement_refcount( $<span class="hljs-number"><span class="hljs-number">0</span></span> ); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">3</span></span></span></span></span><span class="hljs-function">) </span></span>{ $<span class="hljs-number"><span class="hljs-number">1</span></span> = Module.STDWEB.to_js($<span class="hljs-number"><span class="hljs-number">1</span></span>); $<span class="hljs-number"><span class="hljs-number">2</span></span> = Module.STDWEB.to_js($<span class="hljs-number"><span class="hljs-number">2</span></span>); $<span class="hljs-number"><span class="hljs-number">3</span></span> = Module.STDWEB.to_js($<span class="hljs-number"><span class="hljs-number">3</span></span>); Module.STDWEB.from_js($<span class="hljs-number"><span class="hljs-number">0</span></span>, (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> listener = ($<span class="hljs-number"><span class="hljs-number">1</span></span>); ($<span class="hljs-number"><span class="hljs-number">2</span></span>). addEventListener (($<span class="hljs-number"><span class="hljs-number">3</span></span>), listener); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> listener; })()); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">) </span></span>{ Module.STDWEB.tmp = Module.STDWEB.to_js( $<span class="hljs-number"><span class="hljs-number">0</span></span> ); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function">) </span></span>{ $<span class="hljs-number"><span class="hljs-number">0</span></span> = Module.STDWEB.to_js($<span class="hljs-number"><span class="hljs-number">0</span></span>); $<span class="hljs-number"><span class="hljs-number">1</span></span> = Module.STDWEB.to_js($<span class="hljs-number"><span class="hljs-number">1</span></span>); ($<span class="hljs-number"><span class="hljs-number">0</span></span>). appendChild (($<span class="hljs-number"><span class="hljs-number">1</span></span>)); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span></span><span class="hljs-function">) </span></span>{ $<span class="hljs-number"><span class="hljs-number">1</span></span> = Module.STDWEB.to_js($<span class="hljs-number"><span class="hljs-number">1</span></span>); $<span class="hljs-number"><span class="hljs-number">2</span></span> = Module.STDWEB.to_js($<span class="hljs-number"><span class="hljs-number">2</span></span>); Module.STDWEB.from_js($<span class="hljs-number"><span class="hljs-number">0</span></span>, (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { ($<span class="hljs-number"><span class="hljs-number">1</span></span>). removeChild (($<span class="hljs-number"><span class="hljs-number">2</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (exception) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exception <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> NotFoundError) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> exception; } } })()); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function">) </span></span>{ $<span class="hljs-number"><span class="hljs-number">1</span></span> = Module.STDWEB.to_js($<span class="hljs-number"><span class="hljs-number">1</span></span>); Module.STDWEB.from_js($<span class="hljs-number"><span class="hljs-number">0</span></span>, (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ($<span class="hljs-number"><span class="hljs-number">1</span></span>). classList; })()); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span></span><span class="hljs-function">) </span></span>{ $<span class="hljs-number"><span class="hljs-number">1</span></span> = Module.STDWEB.to_js($<span class="hljs-number"><span class="hljs-number">1</span></span>); $<span class="hljs-number"><span class="hljs-number">2</span></span> = Module.STDWEB.to_js($<span class="hljs-number"><span class="hljs-number">2</span></span>); Module.STDWEB.from_js($<span class="hljs-number"><span class="hljs-number">0</span></span>, (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ($<span class="hljs-number"><span class="hljs-number">1</span></span>). querySelector (($<span class="hljs-number"><span class="hljs-number">2</span></span>)); })()); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (Module.STDWEB.acquire_js_reference( $<span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> HTMLElement) | <span class="hljs-number"><span class="hljs-number">0</span></span>; }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (Module.STDWEB.acquire_js_reference( $<span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> HTMLInputElement) | <span class="hljs-number"><span class="hljs-number">0</span></span>; }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">) </span></span>{ $<span class="hljs-number"><span class="hljs-number">0</span></span> = Module.STDWEB.to_js($<span class="hljs-number"><span class="hljs-number">0</span></span>);($<span class="hljs-number"><span class="hljs-number">0</span></span>). blur (); },</code> </pre> <br><br>  In other words, for example, <br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> label = document().create_element( <span class="hljs-string"><span class="hljs-string">"label"</span></span> ); label.append_child( &amp;document().create_text_node( text ) );</code> </pre> <br><br>  will be implemented with the help of helpers <br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span></span><span class="hljs-function">) </span></span>{ $<span class="hljs-number"><span class="hljs-number">1</span></span> = Module.STDWEB.to_js($<span class="hljs-number"><span class="hljs-number">1</span></span>); $<span class="hljs-number"><span class="hljs-number">2</span></span> = Module.STDWEB.to_js($<span class="hljs-number"><span class="hljs-number">2</span></span>); Module.STDWEB.from_js($<span class="hljs-number"><span class="hljs-number">0</span></span>, (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ($<span class="hljs-number"><span class="hljs-number">1</span></span>). createElement (($<span class="hljs-number"><span class="hljs-number">2</span></span>)); })()); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span></span><span class="hljs-function">) </span></span>{ $<span class="hljs-number"><span class="hljs-number">1</span></span> = Module.STDWEB.to_js($<span class="hljs-number"><span class="hljs-number">1</span></span>); $<span class="hljs-number"><span class="hljs-number">2</span></span> = Module.STDWEB.to_js($<span class="hljs-number"><span class="hljs-number">2</span></span>); Module.STDWEB.from_js($<span class="hljs-number"><span class="hljs-number">0</span></span>, (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ($<span class="hljs-number"><span class="hljs-number">1</span></span>). createTextNode (($<span class="hljs-number"><span class="hljs-number">2</span></span>)); })()); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function">) </span></span>{ $<span class="hljs-number"><span class="hljs-number">0</span></span> = Module.STDWEB.to_js($<span class="hljs-number"><span class="hljs-number">0</span></span>); $<span class="hljs-number"><span class="hljs-number">1</span></span> = Module.STDWEB.to_js($<span class="hljs-number"><span class="hljs-number">1</span></span>); ($<span class="hljs-number"><span class="hljs-number">0</span></span>). appendChild (($<span class="hljs-number"><span class="hljs-number">1</span></span>)); },</code> </pre><br><br>  moreover, as you can see, it is not translated into one holistic JavaScript method, and the ‚Äúpointers‚Äù to the objects used are constantly transmitted between WASM and JS code.  Given that WASM code cannot work with JS objects directly, this trick is done in a rather interesting way, and you can look at the implementation in the <a href="">source code of</a> stdweb. <br><br>  When transmitting a JS / DOM object to WASM, the object is added to the ‚Äúkey-value‚Äù containers in JS, storing the correspondences like ‚ÄúJS object ‚Üê ‚Üí unique RefId‚Äù and vice versa, where the unique RefId is essentially an auto-creme number: <br><br><pre> <code class="javascript hljs">Module.STDWEB.acquire_rust_reference = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> reference </span></span></span><span class="hljs-function">) </span></span>{ ... ref_to_id_map.set( reference, refid ); ... id_to_ref_map[ refid ] = reference; id_to_refcount_map[ refid ] = <span class="hljs-number"><span class="hljs-number">1</span></span>; ... };</code> </pre> <br><br>  At the same time, it is checked that this object has never been transmitted (otherwise, it will not create a new record, but the reference count will be increased).  An object type identifier is written to the memory of the WASM application (for example, 11 for Object, 12 for Array), followed by the entry RefId of the object.  When transferring an object in the opposite direction from the map, the necessary object is simply retrieved by a unique ID and used. <br><br>  Without tests, it is impossible to say exactly how strongly the calls to JS functions for each of WASM, type conversion (and string conversion), coupled with constant searches for objects in tables, slow down work, but in general, this approach to the interaction between ‚Äúworlds‚Äù seems to me much more beautiful than the incomprehensible mix of code from the previous examples. <br><br><h4>  asm-dom </h4><br><br>  Well, the most delicious thing in the end: <a href="https://github.com/mbasso/asm-dom">asm-dom</a> .  This is a virtual DOM library (for more details on the Virtual DOM concept, <a href="https://habrahabr.ru/post/256965/">see the article</a> on Habr√©), inspired by the JavaScript VDOM library <a href="https://github.com/snabbdom/snabbdom">Snabbdom</a> and intended for developing SPA (Single-page applications) in C ++ / WebAssembly. <br>  The code for describing page elements looks like this: <br><pre> <code class="cpp hljs"> VNode* newVnode = h(<span class="hljs-string"><span class="hljs-string">"div"</span></span>, Data( Callbacks { {<span class="hljs-string"><span class="hljs-string">"onclick"</span></span>, [](emscripten::val e) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> { emscripten::val::global(<span class="hljs-string"><span class="hljs-string">"console"</span></span>).call&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"log"</span></span>, emscripten::val(<span class="hljs-string"><span class="hljs-string">"another click"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }} } ), Children { h(<span class="hljs-string"><span class="hljs-string">"span"</span></span>, Data( Attrs { {<span class="hljs-string"><span class="hljs-string">"style"</span></span>, <span class="hljs-string"><span class="hljs-string">"font-weight: normal; font-style: italic"</span></span>} } ), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-string"><span class="hljs-string">"This is now italic type"</span></span>) ), h(<span class="hljs-string"><span class="hljs-string">" and this is just normal text"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>), h(<span class="hljs-string"><span class="hljs-string">"a"</span></span>, Data( Attrs { {<span class="hljs-string"><span class="hljs-string">"href"</span></span>, <span class="hljs-string"><span class="hljs-string">"/bar"</span></span>} } ), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-string"><span class="hljs-string">"I'll take you places!"</span></span>) ) } ); patch( emscripten::val::global(<span class="hljs-string"><span class="hljs-string">"document"</span></span>).call&lt;emscripten::val&gt;( <span class="hljs-string"><span class="hljs-string">"getElementById"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-string"><span class="hljs-string">"root"</span></span>) ), vnode );</code> </pre> <br>  There is also <a href="https://github.com/mbasso/gccx">gccx</a> , a converter that generates code like the one above from CPX, which, in turn, is an analog of JSX, known by many for ReactJS, which allows describing components right inside C ++ code: <br><pre> <code class="xml hljs"> VNode* vnode = ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{[](emscripten::val</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">e</span></span></span><span class="hljs-tag">) </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span><span class="hljs-tag">&gt;</span></span> bool { emscripten::val::global("console").call<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">void</span></span></span><span class="hljs-tag">&gt;</span></span>("log", emscripten::val("clicked")); return true; }} &gt; <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"font-weight: bold"</span></span></span><span class="hljs-tag">&gt;</span></span>This is bold<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> and this is just normal text <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/foo"</span></span></span><span class="hljs-tag">&gt;</span></span>I'll take you places!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> );</code> </pre> <br>  The ‚Äúdistillation‚Äù of VirtualDOM into a real DOM, like the interaction between the WASM code and the Web API, occurs either through HTML generation and setting the innerHTML properties of objects, or similarly to the previous example: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> addPtr = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addPtr</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">node</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (node === <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (node.asmDomPtr !== <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> node.asmDomPtr; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ptr = ++lastPtr; nodes[ptr] = node; node.asmDomPtr = ptr; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ptr; }; exports[<span class="hljs-string"><span class="hljs-string">'default'</span></span>] = { ‚Ä¶ <span class="hljs-string"><span class="hljs-string">'appendChild'</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">appendChild</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">parentPtr, childPtr</span></span></span><span class="hljs-function">) </span></span>{ nodes[parentPtr].appendChild(nodes[childPtr]); }, <span class="hljs-string"><span class="hljs-string">'removeAttribute'</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeAttribute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">nodePtr, attr</span></span></span><span class="hljs-function">) </span></span>{ nodes[nodePtr].removeAttribute(attr); }, <span class="hljs-string"><span class="hljs-string">'setAttribute'</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAttribute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">nodePtr, attr, value</span></span></span><span class="hljs-function">) </span></span>{ ...</code> </pre><br><br>  Also on the Github project there is a link to <a href="https://github.com/mbasso/asm-dom/tree/master/benchmarks">performance tests</a> as compared to the JS VDOM library of Snabbdom, which show that in some test cases the WASM option loses to JS, in some it overtakes it, and only in one test run on Firefox see serious acceleration.  In principle, such results are not surprising, considering the fact that JS calls are still used to update the ‚Äúreal‚Äù DOM tree, plus when executing the JS code, the ‚Äúgarbage‚Äù from remote objects remains hanging in the heap until the Garbage Collector is triggered , and asm-dom honestly deletes objects immediately if necessary, which also affects the performance. <br><img src="https://habrastorage.org/webt/nw/n5/ak/nwn5akn3qq6okokkmnanbukjjky.jpeg" alt="image"><br>  The author of the library in README.md himself laments that so far the GC / DOM integration in WebAssembly is impossible, but is optimistic in anticipation of the implementation of this functionality - let's hope that then asm-dom will shine in all its glory. <br><br>  Useful links: <br><ol><li>  <a href="https://habrahabr.ru/post/342180/">Introduction to WASM</a> </li><li>  <a href="https://habrahabr.ru/post/326276/">Interview with Brendan Ike about WebAssembly</a> </li><li>  <a href="https://pbrfrat.com/post/imgui_in_browser.html">Native ImGui in the Browser</a> </li><li>  <a href="http://qtandeverything.blogspot.com/2017/06/qt-for-web-assembly.html">Qt for WebAssembly</a> </li><li>  <a href="https://kripken.github.io/emscripten-site/docs/index.html">Emscripten Documentation</a> </li><li>  <a href="https://leaningtech.com/cheerp/">Cheerp - the C ++ compiler for the Web</a> </li><li>  <a href="https://github.com/koute/stdweb">Stdweb: A standard library for the client-side Web</a> </li><li>  <a href="https://github.com/mbasso/asm-dom">asm-dom: A minimal WebAssembly virtual DOM to build C ++ SPA</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/347804/">https://habr.com/ru/post/347804/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347790/index.html">Winter open lectures on the gaming industry</a></li>
<li><a href="../347794/index.html">We make our firmware for an IP camera on Rust and fight fraud</a></li>
<li><a href="../347798/index.html">Lectures Technopolis. Design of high-load systems (fall 2017)</a></li>
<li><a href="../347800/index.html">VoiceAttack Security Study</a></li>
<li><a href="../347802/index.html">I hated javascript. And now I like him</a></li>
<li><a href="../347806/index.html">20+ resources to start freelancing</a></li>
<li><a href="../347808/index.html">fx - jq alternative for command line JSON processing</a></li>
<li><a href="../347810/index.html">Learning to reliably manage Kubernetes</a></li>
<li><a href="../347812/index.html">For your attention - Webpack 4</a></li>
<li><a href="../347816/index.html">Learning the Spring Framework is 100% through practice. Active Tutorials and KML Markup Language. Project KciTasks (beta)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>