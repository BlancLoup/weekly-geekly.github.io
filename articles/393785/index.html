<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>WiFi-kettle at home, or how to make an ordinary kettle really smart</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 

 If you read my previous article ( Running line on Arduino ), then you probably already know that we at the university have the opportunity...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>WiFi-kettle at home, or how to make an ordinary kettle really smart</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/13e/789/ac5/13e789ac5ab64c99bb2243540c6188bc.jpg" alt="image"><br><br><h2>  Foreword </h2><br><br>  If you read my previous article ( <a href="https://geektimes.ru/post/268486/">Running line on Arduino</a> ), then you probably already know that we at the university have the opportunity to do hardware course projects.  And I, inspired by my previous work, decided once again to try to do something with my own hands.  Only now the topic should have been more serious.  By the way, to think about what to do, I started on the winter holidays, that is, before the start of the semester.  I wanted to do something interesting and useful at the same time. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><h2>  Search for an idea </h2><br><br>  Once on a pair of Basic Information Security, we had a topic related to intellectual property and patents.  The teacher gave us the task to issue a patent for any device according to all requirements and cited the wifi kettle as an example. <br>  He said - and forgot.  And everyone forgot, but in my head this topic remained.  And when it came time to think about what to do as coursework in the next semester, I remembered this teapot. <br><br>  The first thing I decided to see what has already been done.  And what was my surprise when I saw that there were only three models of teapots for sale with support for WiFi control, and then two of them belong to the same company.  These were Smarter iKettle 1.0 and 2.0 and the Russian Polaris PWK 1792CGL. <br><br><img src="https://psv4.vk.me/c615220/u9412861/docs/0ad68e7b3b82/imgonline-com-ua-twotoonefP6QyHRwpyGH.jpg?extra=DYIN0iLJbtamO0yymkG01568IjGjd-b5TPTlrxOGOg9GKUkRFG9qAbzX7whoNtLphkadbiiUq9AIz1X7jxfJ5trWX89OM_uDNpnwCw7j1tyXwPGFSsnL" alt="image"><br><br>  Interestingly, ordinary electric kettles are in almost every home, and there are so few smart ones.  Comparing the functions offered by the manufacturers of iKettle and Polaris, I made a list of the most necessary.  Here is what happened: <br><br><ol><li>  on / off from the smartphone; </li><li>  setting any water heating temperature; </li><li>  the ability to know the current temperature; </li><li>  tracking the current amount of water in the kettle; </li><li>  warning and protection against inclusion with a small amount of water; </li><li>  set auto-on time; </li><li>  readiness alert; </li></ol><br><br>  It seems to be real, it's time to get down to business. <br><br><h2>  Search for the necessary components </h2><br><br>  Since it was not possible to make a completely new kettle, it was decided to modify the ready-made ordinary electric one.  Just at home was an ownerless kettle with a broken switch. <br><br>  ‚ÄúSo, the base is already there‚Äù - I thought. <br><br>  Now it was necessary to look for components for the hardware.  Since I already had some experience with Arduino, I decided to implement everything on it.  Especially since Arduina herself and the modules for her are inexpensive. <br><br>  Since I had to insert the whole part of the kettle control inside the kettle, the choice fell on the Arduino Nano.  It is small and it has an interface for connecting the cable, unlike the Pro Mini, which needs to be flashed through the UART. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/bd1/d8a/273/bd1d8a273b5189fb42cdd0834246dbc4.jpg" alt="image"><br><br>  The main component of the wifi kettle is, of course, the wifi module.  Searching on the Internet for something affordable and for which many tutorials, ran into ESP8266.  Namely, on version 01. I looked at what was cheap (around $ 2) and seemed to be a lot of instructions for connecting.  Stopped on it.  As for the module itself, the phrase here is good: cheap and cheerful.  But more on that later. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/a39/db0/0e5/a39db00e5e05bc51f4c727c9b75ee18a.jpg" alt="image"><br><br>  To control the temperature needed some waterproof thermal sensor.  I found a waterproof NTC thermistor on aliexpress that can withstand temperatures of more than 100 degrees.  I also found an example of working with him, so I quickly decided on that too. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/205/649/1b9/2056491b9c4e3906446017711d069826.jpg" alt="image"><br><br>  It was necessary to decide how to turn on the kettle at a given point in time, of course, it was possible to make a software clock on the Arduino and if the time coincides, turn on the kettle, but it would work unstably, and accidentally reset the program, everything would go wrong.  Therefore, a real time clock came to the rescue.  Namely DS1307.  They have independent power supply (from a 3 V battery), and even on the module on which I stopped, there was a 32K bit EEPROM memory chip, which I used to save on-time. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/f8b/6d4/3e1/f8b6d43e1e1ddcf1ab573ad49bec80f3.jpg" alt="image"><br><br>  Oh yeah, since the kettle should now be turned on programmatically, it still took a 1-channel relay. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/be1/f74/46d/be1f7446d29e3cdcc3a226860e31d01d.jpg" alt="image"><br><br>  As for the liquid level sensor, it had to be done manually.  Details below. <br><br>  Of the rest, it still took several resistors of different ratings, a prototype board for tests, a circuit board for proper installation, wiring, a soldering iron with flux and solder, and the lion's share of patience. <br><br><h2>  Start of development </h2><br><br>  Since the project is a wifi maker, the first thing I wanted and had to deal with the wifi module.  As soon as the message came, he immediately unpacked and began to connect. <br><br>  Found a bunch of examples on the Internet.  All right, voltage regulator 3.3 V, voltage dividers for RX and TX.  I collected everything by example, I connect - it did not fly!  A heap of text was displayed in the COM port monitor, as it turned out, the module was permanently reset.  Does not respond to commands sent by AT.  The author of the article works, I do not. <br><br>  What's the matter?  I tried to look for other connection schemes, and this way and that, and the module still either resets or outputs nothing.  But everywhere it is written in red: "Do not apply to the 5 V module, otherwise it will fail."  So the search for solutions sometimes lasted in the evenings, was already thinking of buying another module, but decided to check the voltage with a multimeter. <br><br>  It turned out that when the module is connected to 3.3 V, there is a voltage drop below 3.2 V. It seems that, well and good, it falls and falls.  I decided to power it from another power source and it turned out that the module works normally when the voltage on it is higher than 3.2 V, and below it is not enough and it is constantly being reset. <br><br>  In the end, at your own risk, connected to 5 V and everything worked and is still working normally. <br><br><img src="https://habrastorage.org/files/d5d/17e/780/d5d17e7804c34c46a595c059100295e1.jpg"><br><br>  There were no such problems with the other components. <br><br>  Once I figured out wifi, I had to decide what to do with the fluid level sensor.  Googling, I found an article in which the author made a soil moisture sensor.  When the soil dries out, the resistance of the sensor increases and the voltage at the analog port of Arduino increases.  Catching the change in voltage, you can fix the appearance of fluid.  To determine the liquid level in my project, instead of two contacts, 6 were used. One of them is connected to the 5 V output, and the rest to the analog inputs and 10 kŒ© resistors to GND. <br><br>  Here is a photo of the tests. <br><br><img src="https://habrastorage.org/files/43c/536/5fd/43c5365fd8464326bf5b4eee5bfbe806.jpg"><br><img src="https://habrastorage.org/files/c99/d28/fee/c99d28fee740489a9b3893e4f9fdd418.jpg"><br><br>  This is the result of the level sensor. <br><br><img src="https://habrastorage.org/files/b1e/2bb/10d/b1e2bb10db5f4e7ea647a746bc7e039c.jpg"><br><br>  The next thing I tested is the real time clock.  But working with them is basically simple.  To set the time and get information about him, I used only examples that come bundled with the library for working with DS1307. <br><br>  As a result, when everything was assembled on a breadboard, such a mixture of wires and modules came out.  By the way, on these photos while there is another temperature sensor. <br><br><img src="https://habrastorage.org/files/2f9/74d/288/2f974d288e8b43b0ab3612641a985f0e.jpg"><br><br><h2>  Getting Started </h2><br><br>  Now all this had to be unsoldered on the circuit board.  There is nothing special to comment on, so only the photo.  As you can see, another button has been added so that you can turn on the kettle not only from your smartphone, but also in the usual way. <br><br><img src="https://habrastorage.org/files/98a/ad1/920/98aad19203204e46a644e52c9f905af0.jpg"><br><img src="https://habrastorage.org/files/995/592/45e/99559245edb048699172208c2584b689.jpg"><br><img src="https://habrastorage.org/files/2dd/594/23c/2dd59423cb0a447295593b52da781dd5.jpg"><br><br>  Next, you need to place everything inside the kettle. <br><br><img src="https://habrastorage.org/files/9cb/50e/bf8/9cb50ebf8d05486babe76682ce68fddf.jpg"><br><img src="https://habrastorage.org/files/39d/b11/53b/39db1153b86c4592862b1b2f66531252.jpg"><br><img src="https://habrastorage.org/files/605/7db/1e6/6057db1e6ead493c81d399e164b399d4.jpg"><br><img src="https://habrastorage.org/files/853/6fc/00e/8536fc00ead6460ab5e581029bbdaf64.jpg"><br><br>  An asbestos insert was added to protect all viscera from overheating. <br><br><img src="https://habrastorage.org/files/027/99a/f36/02799af362264b6682b3355bae815b9c.jpg"><br><br>  True, the case had to be slightly raised with the help of an additional plastic insert. <br><br><img src="https://habrastorage.org/files/ec3/06e/ab8/ec306eab83114666a94c62b33f9ce6f2.jpg"><br><img src="https://habrastorage.org/files/836/47b/9ac/83647b9ac23a43c7bd39ec57c4b2807c.jpg"><br><br><h2>  Now go to the mobile part. </h2><br><br>  As for the application, since it was developed under the Android OS, it was originally planned to use Android Studio.  But in order to study the new technologies, it was decided to use a ready-made platform for developing programs in the field of the Internet of things.  As a result, the choice fell on the company's product Evothings - Evothings Studio. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/74f/e14/7b1/74fe147b1a99d6a7fd6dd0b6a01ac2a2.png" alt="image"><br><br>  Here are its main advantages: <br><br>  - A large number of standard examples of working with various modules (Wifi, Bluetooth); <br>  - development of applications using JS, HTML, CSS, which allows you to write one code that will work equally on Android and iOS OS, i.e.  binding to only one platform disappears; <br>  - ease of testing the application: an application is installed on the smartphone to preview its development, and all test messages and error messages are displayed in the program on the computer; <br>  - A large amount of information on the Internet about the development using JS, HTML, CSS; <br><br>  In this Evothings Studio there was an example of turning on the LED, sending a request to turn on via ESP8266.  I decided to take this example as a basis, as there was the most valuable thing for me - communication with the WiFi module via tcp socket.  And in the same way as the request to turn on the LED was transmitted, I made the transmission of the request for updating the kettle sensors, to set the on time, set the temperature, etc. <br><br>  Then he screwed up the notification of readiness and a small amount of water, the good is that everything in our time is easily googled.  The result is such an application (a nice thing to make an application interface using CSS): <br><br><img src="https://habrastorage.org/files/0b9/985/b2d/0b9985b2d0fb4c97bb36d4ebeb772ab6.jpg"><br><img src="https://habrastorage.org/files/431/aaa/445/431aaa44557d42de996527f587d8691f.jpg"><br><img src="https://habrastorage.org/files/e3a/f8d/fb1/e3af8dfb13764be2b2b9e9acbad28769.jpg"><br><img src="https://habrastorage.org/files/9c0/db4/c6e/9c0db4c6e1b44b0f86f725b5e75a265a.jpg"><br><img src="https://habrastorage.org/files/80a/7ff/90f/80a7ff90f43b46e197fdfc3594297e1a.jpg"><br><br><h2>  Brief description of the interaction between the smartphone and the kettle </h2><br><br>  Communication between the server and the client part is carried out using the WiFi module.  When you turn on the kettle control module, the WiFi module starts distributing a network called artKettle.  This is done using AT commands on the server side.  So, for example, to put the module into the access point mode, it needs to send the command AT + CWMODE = 2.  Next, using such commands, you need to assign network settings, allow connection of several devices and get the ip address of the wifi itself. <br><br>  On the client side, the connection is made via a specific port and at the ip address of the wifi module using chrome.tcp.socket. <br><br>  After connecting the client to the server, you can control the kettle from your smartphone.  Consider an example of the inclusion of a kettle. <br><br>  When you press the power button in the artKettle application, the corresponding function of the app.kettleOn () is called.  Inside this function, two lines are transmitted to the server side: <br><br><pre><code class="cpp hljs">app.sendString(<span class="hljs-string"><span class="hljs-string">'H'</span></span>); app.sendString(<span class="hljs-string"><span class="hljs-string">'U'</span></span>);</code> </pre> <br><br>  Next comes the work is already on the side of Arduino.  After the arrival of the first line with the character 'H', the following part of the code is executed: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(message.indexOf(<span class="hljs-string"><span class="hljs-string">"H"</span></span>) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; waterDetected()) { digitalWrite(POWER_PIN, LOW); IS_ON = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; Serial.println(<span class="hljs-string"><span class="hljs-string">"ON"</span></span>); sendCIPData(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"ON"</span></span>); }</code> </pre><br><br>  First, there is a check whether there is water in the kettle by calling the waterDetected () method.  Consider the option when water is present in the kettle. <br><br>  A low voltage level is applied to the relay control pin, which corresponds to its activation, i.e.  power supply circuit closes: <br><pre> <code class="cpp hljs">digitalWrite(POWER_PIN, LOW);</code> </pre><br><br>  Then there is the installation of the flag that the kettle is turned on, and the display of the switch-on message on the serial port monitor. <br><br>  After that, a function is called that sends a response message to the client side that all the activation was successful: <br><br><pre> <code class="cpp hljs">sendCIPData(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"ON"</span></span>);</code> </pre><br><br>  On the client side, after checking the incoming message, the power button is set to the On state: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (buf.substr(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) == <span class="hljs-string"><span class="hljs-string">"ON"</span></span>) { app.setButtonOn(); }</code> </pre><br><br>  After that, there is a processing of a text message with the symbol 'U', sent from the client to the server.  Here, in the same way as the inclusion, the information on the current temperature and the volume of liquid in the kettle is updated. <br><br>  In this way, two-way communication between the client and the server is organized, so that any of them knows about the state of the other at any time. <br><br><h2>  Conclusion </h2><br><br>  As a result of the course project, a modification was developed for an ordinary electric kettle, which allows it to be controlled from a smartphone via wifi.  Now this kettle can be attributed to the representatives of the Internet of Things.  All the functions were fully implemented, so now this kettle has the following features: <br><br>  - on / off from the smartphone; <br>  - setting any water heating temperature; <br>  - the ability to find out the current temperature; <br>  - tracking the current volume of water in the kettle; <br>  - warning and protection against inclusion with a small volume of water; <br>  - set the auto-on time; <br>  - notification of readiness; <br><br>  The advantages of the implemented project is the availability of the element base, because everything you need can be found in the shops of radioelectronic components, the extensibility of the project.  Since the kettle has all the necessary sensors installed, it can be modified programmatically and done no worse than its counterparts.  Given the versatility of the wifi module used, you can connect it to the Internet and manage the kettle from anywhere in the world, and using the online SMS processing service, you can organize the activation via SMS.  Those.  the project is still very expandable, there are opportunities for this, but they were not implemented because they were not part of the goals of the project being developed. <br><br>  Of course there are drawbacks of the project.  The first one is the unstable operation of the Wifi module.  The module sometimes just loses the network, begins to reset the settings, or simply does not process the incoming signals.  And this is a popular problem with users of this module.  The second drawback is the lack of mechanical shutdown of the kettle.  Switching off is implemented by software, when the boiling point is reached, the circuit is broken using a relay.  If suddenly the program fails, the kettle may not turn off.  The third drawback is the problem of tracking the heating temperature.  For example, if the kettle is turned off at a temperature of 60 degrees, the heating ten will continue to give off heat, and after a while the water temperature will already be about 70 degrees.  But this is corrected by making adjustments to the program. </div><p>Source: <a href="https://habr.com/ru/post/393785/">https://habr.com/ru/post/393785/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../393773/index.html">"Thinking machine" Shchukarev</a></li>
<li><a href="../393775/index.html">Dolphins have discovered the beginnings of language communication.</a></li>
<li><a href="../393777/index.html">The passage of Mercury in the Sun - photos and video</a></li>
<li><a href="../393779/index.html">In the UAE are planning to create a man-made mountain to increase the amount of precipitation</a></li>
<li><a href="../393783/index.html">The base of solar and lunar eclipses from -1999 to +3000</a></li>
<li><a href="../393787/index.html">How to repair nuclear reactors</a></li>
<li><a href="../393789/index.html">Smartphones with the national OS will appear this year</a></li>
<li><a href="../393791/index.html">The Swiss city allowed to pay utility payments in bitcoins</a></li>
<li><a href="../393795/index.html">Due to global warming, parts of the Middle East and North Africa will become uninhabitable</a></li>
<li><a href="../393797/index.html">Launched preorders for the game console Pyra</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>