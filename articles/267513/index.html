<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Matreshka.js 2: events</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Documentation in Russian 
 Github repository 


 Hello! 


 The functionality of the events in Matreshka.js has become so rich that she undoubtedly de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Matreshka.js 2: events</h1><div class="post__text post__text-html js-mediator-article"><p> <a href="http://matreshka.io/"><img src="https://habrastorage.org/getpro/habr/post_images/2c1/7dd/c95/2c17ddc954b9bb6c001888f64f42d865.png" alt="image"></a> </p><br><p>  <a href="http://ru.matreshka.io/">Documentation in Russian</a> <br>  <a href="https://github.com/finom/matreshka">Github repository</a> </p><br><p>  Hello! </p><br><p>  The functionality of the events in Matreshka.js has become so rich that she undoubtedly deserved a separate article. </p><br><p>  <a href="https://github.com/matreshkajs/examples-and-tutorials/tree/master/events">This article is in English.</a> </p><a name="habracut"></a><br><h1>  Basics: arbitrary events </h1><br><p>  Let's start with the simplest.  events in the framework are added using the <a href="http://ru.matreshka.io/">on</a> method. </p><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> handler = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { alert(<span class="hljs-string"><span class="hljs-string">'"someeevent" is fired'</span></span>); }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'someevent'</span></span>, handler);</code> </pre> <br><p>  To which you can send a list of events separated by spaces. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'someevent1 someevent2'</span></span>, handler);</code> </pre> <br><p>  To declare an event handler in an arbitrary object (whether or not it is an instance of <code>Matreshka</code> ), use the static <a href="http://ru.matreshka.io/">Matreshka.on</a> method (the only difference is that the target object is the first argument, not <code>this</code> ). </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> object = {}; Matreshka.on(object, <span class="hljs-string"><span class="hljs-string">'someevent'</span></span>, handler);</code> </pre> <br><p>  Events can be generated using the <a href="http://ru.matreshka.io/">trigger</a> method. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.trigger(<span class="hljs-string"><span class="hljs-string">'someevent'</span></span>);</code> </pre> <br><p>  For arbitrary objects, you can use the <a href="http://ru.matreshka.io/">static analogue of the method</a> . </p><br><pre> <code class="javascript hljs">Matreshka.trigger(object, <span class="hljs-string"><span class="hljs-string">'someevent'</span></span>);</code> </pre> <br><p>  In this case, you can pass some data to the handler, specifying the first and subsequent arguments. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'someevent'</span></span>, (a, b, c) =&gt; { alert([a, b, c]); <span class="hljs-comment"><span class="hljs-comment">// 1,2,3 }); this.trigger('someevent', 1, 2, 3);</span></span></code> </pre> <br><p>  Or </p><br><pre> <code class="javascript hljs">Matreshka.on(object, <span class="hljs-string"><span class="hljs-string">'someevent'</span></span>, (a, b, c) =&gt; { alert([a, b, c]); <span class="hljs-comment"><span class="hljs-comment">// 1, 2, 3 }); Matreshka.trigger(object, 'someevent', 1, 2, 3);</span></span></code> </pre> <br><p>  Here you can see the Backbone syntax.  That's right: the first lines of the Matreshka.js code were written under the impression of Backbone (even the code was originally borrowed from there, although it suffered great changes later). </p><br><p>  Further, in this post, I will give a variant of the methods using the keyword <code>this</code> (with the exception of examples of delegated events).  Just remember that <a href="http://ru.matreshka.io/">on</a> , <a href="http://ru.matreshka.io/">once</a> , <a href="http://ru.matreshka.io/">onDebounce</a> , <a href="http://ru.matreshka.io/">trigger</a> , <a href="http://ru.matreshka.io/">set</a> , <a href="http://ru.matreshka.io/">bindNode</a> and other methods of Matreshka.js have static analogs taken by an arbitrary target object as the first argument. </p><br><p>  In addition to the <code>on</code> method, there are two more: <code>once</code> and <code>onDebounce</code> .  The first hangs up the handler, which can only be called once. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.once(<span class="hljs-string"><span class="hljs-string">'someevent'</span></span>, () =&gt; { alert(<span class="hljs-string"><span class="hljs-string">'yep'</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.trigger(<span class="hljs-string"><span class="hljs-string">'someevent'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// yep this.trigger('someevent'); // nothing</span></span></code> </pre> <br><p>  The second "eliminates the rattle" handler.  When an event is triggered, a timer starts with a delay set by the programmer.  If the timer with the same name is not raised after the timer expires, the handler is started.  If the event worked before the end of the delay, the timer is updated and waits again.  This is an implementation of the very popular debounce micro pattern, which can be read on <a href="http://habrahabr.ru/post/60957/">Habr√©</a> , on an <a href="http://davidwalsh.name/javascript-debounce-function">English-language resource</a> . </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.onDebounce(<span class="hljs-string"><span class="hljs-string">'someevent'</span></span>, () =&gt; { alert(<span class="hljs-string"><span class="hljs-string">'yep'</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">1000</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.trigger(<span class="hljs-string"><span class="hljs-string">'someevent'</span></span>); } <span class="hljs-comment"><span class="hljs-comment">//        'yep'</span></span></code> </pre> <br><p>  Do not forget that the method may take a delay. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.onDebounce(<span class="hljs-string"><span class="hljs-string">'someevent'</span></span>, handler, <span class="hljs-number"><span class="hljs-number">1000</span></span>);</code> </pre> <br><h1>  Property change events </h1><br><p>  When the property changes, Matreshka.js generates a <code>change:KEY</code> trip. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'change:x'</span></span>, () =&gt; { alert(<span class="hljs-string"><span class="hljs-string">'x is changed'</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x = <span class="hljs-number"><span class="hljs-number">42</span></span>;</code> </pre> <br><p>  In case you want to pass some information to the event handler or change the property value without calling the <code>"change:KEY"</code> event, instead of the usual assignment, use the <a href="http://ru.matreshka.io/">Matreshka # set</a> method (or the static <a href="http://ru.matreshka.io/">Matreshka.set</a> method), which takes three arguments : key, value and object with data or flags. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'change:x'</span></span>, evt =&gt; { alert(evt.someData); }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.set(<span class="hljs-string"><span class="hljs-string">'x'</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>, { <span class="hljs-attr"><span class="hljs-attr">someData</span></span>: <span class="hljs-string"><span class="hljs-string">'foo'</span></span> });</code> </pre> <br><p>  And here is how you can change a property without calling an event handler: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.set(<span class="hljs-string"><span class="hljs-string">'x'</span></span>, <span class="hljs-number"><span class="hljs-number">9000</span></span>, { <span class="hljs-attr"><span class="hljs-attr">silent</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }); <span class="hljs-comment"><span class="hljs-comment">//    </span></span></code> </pre> <br><p>  The <code>set</code> method supports a few more flags, the description of which would make it go beyond the scope of the article, therefore, please refer to the <a href="http://ru.matreshka.io/">documentation for the method</a> . </p><br><h1>  Events generated before property change </h1><br><p>  In version 1.1, another event appeared: <code>"beforechange:KEY"</code> , generated before the property was changed.  An event can be useful in cases where you define a <code>"change:KEY"</code> event and want to call the code preceding this event. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'beforechange:x'</span></span>, () =&gt; { alert(<span class="hljs-string"><span class="hljs-string">'x will be changed in few microseconds'</span></span>); });</code> </pre> <br><p>  You can pass some data to the handler or cancel the event generation. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'beforechange:x'</span></span>, evt =&gt; { alert(evt.someData); }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.set(<span class="hljs-string"><span class="hljs-string">'x'</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>, { <span class="hljs-attr"><span class="hljs-attr">someData</span></span>: <span class="hljs-string"><span class="hljs-string">'foo'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.set(<span class="hljs-string"><span class="hljs-string">'x'</span></span>, <span class="hljs-number"><span class="hljs-number">9000</span></span>, { <span class="hljs-attr"><span class="hljs-attr">silent</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }); <span class="hljs-comment"><span class="hljs-comment">//    </span></span></code> </pre> <br><h1>  Property deletion events </h1><br><p>  When properties are removed by the <a href="http://ru.matreshka.io/">remove</a> method, the <code>delete:KEY</code> and <code>delete</code> events are generated. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'delete:x'</span></span>, () =&gt; { alert(<span class="hljs-string"><span class="hljs-string">'x is deleted'</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'delete'</span></span>, evt =&gt; { alert(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${evt.key}</span></span></span><span class="hljs-string"> is deleted`</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.remove(<span class="hljs-string"><span class="hljs-string">'x'</span></span>);</code> </pre> <br><h1>  Binding events </h1><br><p>  When a binding is declared, two events are generated: <code>"bind"</code> and <code>"bind:KEY"</code> , where KEY is the key of the associated property. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'bind:x'</span></span>, () =&gt; { alert(<span class="hljs-string"><span class="hljs-string">'x is bound'</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'bind'</span></span>, evt =&gt; { alert(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${evt.key}</span></span></span><span class="hljs-string"> is bound`</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bindNode(<span class="hljs-string"><span class="hljs-string">'x'</span></span>, <span class="hljs-string"><span class="hljs-string">'.my-node'</span></span>);</code> </pre> <br><p>  This event can be useful, for example, when the banding is controlled by another class, and you need to run your code after some sort of binding (for example, a sandbox binding). </p><br><h1>  Events add and delete events </h1><br><img src="http://i.imgur.com/KouqpDG.jpg" alt="image"><br><p>  When an event is added, the events <code>"addevent"</code> and <code>"addevent:NAME"</code> are generated, when they are deleted - <code>"removeevent"</code> and <code>"removeevent:NAME"</code> , where NAME is the name of the event. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'addevent'</span></span>, handler); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'addevent:someevent'</span></span>, handler); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'removeevent'</span></span>, handler); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'removeevent:someevent'</span></span>, handler);</code> </pre> <br><p>  One of the ways to use it is to use the framework events in conjunction with the events engine of the third-party library.  Let's say you want to place all the handlers for a class in a single <a href="http://ru.matreshka.io/">on</a> call, making the code more readable and more compact.  With the help of <code>"addevent"</code> you intercept all subsequent event initiations, and in the handler check the event name for any conditions and initialize the event using the API of a third-party library.  In the example below, the code is from a project that uses <a href="http://fabricjs.com/">Fabric.js</a> .  The <code>"addevent"</code> handler checks the event name for the presence of the <code>"fabric:"</code> prefix and, if validated, adds the appropriate handler to the canvas using the Fabric API. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.canvas = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fabric.Canvas(node); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on({ <span class="hljs-string"><span class="hljs-string">'addevent'</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">evt</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { name, callback } = evt; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> prefix = <span class="hljs-string"><span class="hljs-string">'fabric:'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(name.indexOf(prefix) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fabricEventName = name.slice(prefix.length); <span class="hljs-comment"><span class="hljs-comment">// add an event to the canvas this.canvas.on(fabricEventName, callback); } }, 'fabric:after:render': evt =&gt; { this.data = this.canvas.toObject(); }, 'fabric:object:selected': evt =&gt; { /* ... */ } });</span></span></code> </pre> <br><h1>  Delegated Events </h1><br><p>  Now let's get down to the most interesting: the delegation of events.  The syntax of the delegated events is as follows: <code>PATH@EVENT_NAME</code> , where PATH is the path (properties separated by a dot) to the object on which the EVENT_NAME event is attached.  Let's look at examples. </p><br><h2>  Example 1 </h2><br><p>  You want to hang up an event handler in the <code>"a"</code> property, which is an object. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'a@someevent'</span></span>, handler);</code> </pre> <br><p>  The handler will be called when the <code>"someevent"</code> event occurred in <code>"a"</code> <code>"someevent"</code> . </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a.trigger(<span class="hljs-string"><span class="hljs-string">'someevent'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  a -  Matreshka Matreshka.trigger(this.a, 'someevent'); //  a -     Matreshka</span></span></code> </pre> <br><p>  In this case, the handler can be declared before the property <code>"a"</code> declared.  If the property <code>"a"</code> overwritten by another object, the internal mechanism Matreshka.js will catch this change, remove the handler from the previous value of the property and add a new value. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Matreshka(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a.trigger(<span class="hljs-string"><span class="hljs-string">'someevent'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// this.a = {}; Matreshka.trigger(this.a, 'someevent');</span></span></code> </pre> <br><p>  The <code>handler</code> will be called again. </p><br><h2>  Example 2 </h2><br><p>  And what if our object is a collection inherited from <a href="http://ru.matreshka.io/">Matreshka.Array</a> or <a href="http://ru.matreshka.io/">Matreshka.Object</a> ( <code>Matreshka.Object</code> is a collection, such as key-value)?  We do not know in advance in which element of the collection an event will occur (in the first or tenth).  Therefore, instead of the name of the property, for these classes, you can use the asterisk "*", indicating that the event handler should be called when the event is called on one of the members of the collection. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'*@someevent'</span></span>, handler);</code> </pre> <br><p>  If the incoming item is an instance of <code>Matreshka</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.push(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Matreshka()); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>].trigger(<span class="hljs-string"><span class="hljs-string">'someevent'</span></span>);</code> </pre> <br><p>  Or, in case the incoming element is either a regular object or an instance of <code>Matreshka</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.push({}); Matreshka.trigger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">'someevent'</span></span>);</code> </pre> <br><h2>  Example 3 </h2><br><p>  We go deeper.  Let's say we have the property <code>"a"</code> , which contains an object with the property <code>"b"</code> , in which the event <code>"someevent"</code> should occur.  In this case, the properties are separated by a dot: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'ab@someevent'</span></span>, handler); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.abtrigger(<span class="hljs-string"><span class="hljs-string">'someevent'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Matreshka.trigger(this.ab, 'someevent');</span></span></code> </pre> <br><h2>  Example 4 </h2><br><p>  We have property <code>"a"</code> , which is a collection.  We want to catch the event <code>"someevent"</code> , which should occur in any element included in this collection.  Combining examples (2) and (3). </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'a.*@someevent'</span></span>, handler); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a[<span class="hljs-number"><span class="hljs-number">0</span></span>].trigger(<span class="hljs-string"><span class="hljs-string">'someevent'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Matreshka.trigger(this.a[0], 'someevent');</span></span></code> </pre> <br><h2>  Example 5 </h2><br><p>  We have a collection of objects containing the property <code>"a"</code> , which is an object.  We want to hang the handler on all objects contained under the key <code>"a"</code> for each element of the collection: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'*.a@someevent'</span></span>, handler); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>].a.trigger(<span class="hljs-string"><span class="hljs-string">'someevent'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Matreshka.trigger(this[0].a, 'someevent');</span></span></code> </pre> <br><h2>  Example 6 </h2><br><img src="http://lrtcdn.linkresearchtools.com/wp-content/uploads/2015/03/12-inception-meme.png" alt="image"><br><p>  We have a collection whose elements contain property <code>"a"</code> , which is a collection.  In turn, the latter includes elements containing the property <code>"b"</code> , which is an object.  We want to catch <code>"someevent"</code> on all objects <code>"b"</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'*.a.*.b@someevent'</span></span>, handler); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>].a[<span class="hljs-number"><span class="hljs-number">0</span></span>].b.trigger(<span class="hljs-string"><span class="hljs-string">'someevent'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Matreshka.trigger(this[0].a[0].b, 'someevent');</span></span></code> </pre> <br><h2>  Example 7. Various combinations </h2><br><p>  In addition to arbitrary events, you can use the built-in Matreshka.js.  Instead of <code>"someevent"</code> you can use the <code>"change:KEY"</code> event described above or <code>"modify"</code> , which allows you to listen to any changes in <code>Matreshka.Object</code> and <code>Matreshka.Array</code> . </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   "a"   "b",       "c". this.on('ab@change:c', handler); //  "a" -   //     (// ) . this.on('a.*@modify', handler);</span></span></code> </pre> <br><p>  I remind you that delegated events are hung dynamically.  When declaring a handler, any branch of the path may be missing.  If something in the object tree is redefined, the link with the old value is broken and a link is created with the new value: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'abcd@someevent'</span></span>, handler); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ab = {<span class="hljs-attr"><span class="hljs-attr">c</span></span>: {<span class="hljs-attr"><span class="hljs-attr">d</span></span>: {}}}; Matreshka.trigger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.abcd, <span class="hljs-string"><span class="hljs-string">'someevent'</span></span>);</code> </pre> <br><h1>  DOM events </h1><br><p>  As you know, Matreshka.js allows you to associate a DOM element on a page with some property of an instance of <code>Matreshka</code> or a regular object, implementing one or two-way binding: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bindNode(<span class="hljs-string"><span class="hljs-string">'x'</span></span>, <span class="hljs-string"><span class="hljs-string">'.my-node'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Matreshka.bindNode(object, 'x', '.my-node');</span></span></code> </pre> <br><p>  <a href="http://ru.matreshka.io/">Learn more about the bindNode method</a> . </p><br><p>  Before or after a binding declaration, you can create a handler that listens for the DOM event of the bound element.  The syntax is: <code>DOM_EVENT::KEY</code> , where <code>DOM_EVENT</code> is a DOM or jQuery event (if jQuery is used), and <code>KEY</code> is the key of a bound property.  <code>DOM_EVENT</code> and <code>KEY</code> separated by a double colon. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'click::x'</span></span>, evt =&gt; { evt.preventDefault(); });</code> </pre> <br><p>  The object of the original DOM event is the <code>domEvent</code> of the event object passed to the handler.  In addition, several properties and methods are available in the object in order not to access the <code>domEvent</code> each time: <code>preventDefault</code> , <code>stopPropagation</code> , <code>which</code> , <code>target</code> and several other properties. </p><br><p>  This feature is syntactic sugar, over ordinary DOM and jQuery events, and the code below does the same as the previous one: </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">'.my-node'</span></span>).addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, evt =&gt; { evt.preventDefault(); });</code> </pre> <br><h1>  DOM delegated events </h1><br><p>  Announcing the events from the example above requires a binding declaration.  You must perform two steps: call the <code>bindNode</code> method and, in fact, declare the event.  This is not always convenient, as there are often cases where the DOM node is not used anywhere except in a single DOM event.  For such a case, another variant of the DOM event syntax is provided, which looks like <code>DOM_EVENT::KEY(SELECTOR)</code> .  <code>KEY</code> , in this case - a certain key associated with a certain DOM element.  and <code>SELECTOR</code> is the DOM selector of the element that is included in the element associated with the <code>KEY</code> . </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my-node"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my-inner-node"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bindNode(<span class="hljs-string"><span class="hljs-string">'x'</span></span>, <span class="hljs-string"><span class="hljs-string">'.my-node'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'click::x(.my-inner-node)'</span></span>, handler);</code> </pre> <br><h1>  DOM delegated events inside the sandbox </h1><br><p>  If we need to create a handler for some sandbox element, we use a slightly simplified syntax <code>DOM_EVENT::(SELECTOR)</code> . </p><br><p>  Let me remind you that the sandbox limits the effect of a <code>Matreshka</code> instance or an arbitrary object to a single element in a web application.  For example, if there are several widgets on a page, and each widget is controlled by its class, it is highly desirable to set a sandbox for each class that points to the root element of the widget affected by this class. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bindNode(<span class="hljs-string"><span class="hljs-string">'sandbox'</span></span>, <span class="hljs-string"><span class="hljs-string">'.my-node'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'click::(.my-inner-node)'</span></span>, handler);</code> </pre> <br><p>  This code does the exact same thing: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'click::sandbox(.my-inner-node)'</span></span>, handler);</code> </pre> <br><h1>  Events class Matreshka.Object </h1><br><p>  Let me remind you, <code>Matreshka.Object</code> is a class responsible for data, such as key-value.  Read more about this class <a href="http://ru.matreshka.io/">in the documentation</a> . </p><br><p>  Each time the properties responsible for the data change, a <code>"set"</code> event is generated. </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>(<span class="hljs-string"><span class="hljs-string">'set'</span></span>, handler);</code> </pre> <br><p>  Each time the properties responsible for the data are deleted, a <code>"remove"</code> event is generated. </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>(<span class="hljs-string"><span class="hljs-string">'remove'</span></span>, handler);</code> </pre> <br><p>  Each time you change or delete the properties responsible for the data, a <code>"modify"</code> event is generated. </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>(<span class="hljs-string"><span class="hljs-string">'modify'</span></span>, handler);</code> </pre> <br><p>  In this simple way, you can listen to all changes in the data, instead of manually eavesdropping the properties. </p><br><h1>  Events class Matreshka.Array </h1><br><p>  With an array, everything is much more interesting.  <a href="http://ru.matreshka.io/">Matreshka.Array</a> includes a lot of useful events that make it possible to find out what happened in the collection: insert an element, delete an element, re-sort. </p><br><p>  Let me remind you, <code>Matreshka.Array</code> is the class responsible for implementing collections in the framework.  The class completely repeats the methods of the built-in <code>Array.prototype</code> , and the programmer does not need to think about which method to call in order to add or remove something.  What you need to know about the events <code>Matreshka.Array</code> : </p><br><ul><li>  When calling methods borrowed from <code>Array.prototype</code> , the corresponding event is raised ( <code>"push"</code> , <code>"splice"</code> , <code>"pop"</code> ...) </li><li>  When inserting elements into an array, <code>"add"</code> and <code>"addone"</code> events are generated.  Using the first, an array of inserted elements gets into the <code>"added"</code> property.  Using the second, the inserted element gets into the <code>"addedItem"</code> property, and the event is generated as many times as there are elements added. </li><li>  When removing items, the same logic is used: <code>"remove"</code> generated by passing an array of deleted items to the <code>"removed"</code> property of the event object, and <code>"removeone"</code> generated on each removed item, passing the removed item to the <code>"removedItem"</code> property. </li><li>  Any modifications to the collection will generate a <code>"modify"</code> event.  That is, it is not necessary to catch the events <code>"remove"</code> and <code>"add"</code> separately. </li></ul><br><p>  Some examples from the documentation: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'add'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">evt</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(evt.added); <span class="hljs-comment"><span class="hljs-comment">// [1,2,3] }); //   , //         this.on('addone', function(evt) { console.log(evt.addedItem); // 1 ‚Ä¶ 2 ‚Ä¶ 3 }); this.push(1, 2, 3);</span></span></code> </pre> <br><p>  In order not to copy the contents of the documentation in full, I suggest that you <a href="http://ru.matreshka.io/">familiarize yourself with the documentation for Matreshka.Array yourself.</a> </p><br><p>  Thanks to everyone who stays with the project.  All good. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/267513/">https://habr.com/ru/post/267513/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267503/index.html">Python Meetup 08.28.15: full-text search and Europython 2015</a></li>
<li><a href="../267505/index.html">Basics of NHibernate (easy tutorial)</a></li>
<li><a href="../267507/index.html">Another way to disable telemetry collection in Windows 10 OS</a></li>
<li><a href="../267509/index.html">Replicated object. Part 1: Introduction</a></li>
<li><a href="../267511/index.html">Yandeks.Blogi - we will think for you</a></li>
<li><a href="../267515/index.html">C # attributes and types</a></li>
<li><a href="../267517/index.html">JetBrains have published updates to the new licensing and pricing policy.</a></li>
<li><a href="../267519/index.html">Adaptive video as a background site caps</a></li>
<li><a href="../267523/index.html">Setting up sending email notifications in Zabbix on CentOS 7</a></li>
<li><a href="../267525/index.html">From Euroset to game design or 5 beginner's mistakes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>