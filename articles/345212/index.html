<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Can you afford it? Real-world web performance budget</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Posted by Alex Russell, developer of Chrome, Blink and Google‚Äôs web platform. 

 TL; DR: performance budgets are a significant but undervalued part of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Can you afford it? Real-world web performance budget</h1><div class="post__text post__text-html js-mediator-article">  <i><font color="gray">Posted by Alex Russell, developer of Chrome, Blink and Google‚Äôs web platform.</font></i> <br><br>  <i>TL; DR: performance budgets are a significant but undervalued part of a successful product and a healthy team.</i>  <i>Most of our partners are not aware of the conditions of the real world - and as a result, they choose the wrong technology.</i>  <i>We set a budget for the <b>time of</b> five seconds or less before the <a href="https://developers.google.com/web/tools/lighthouse/audits/time-to-interactive">interactivity of the site</a> after the first download, as well as two or less seconds for subsequent downloads.</i>  <i>If these guidelines are followed, we are limited to a typical real-world device and a typical network configuration.</i>  <i>This is an Android smartphone for $ 200 on a 400 Kbps channel, RTT 400 ms.</i>  <i>This means a budget of ~ 130-170 KB of critical path resources, depending on their composition: the larger the JS, the smaller the volume.</i> <br><br>  Over the past few years we have had the pleasure of working with dozens of teams.  The work was enlightening, sometimes in very unexpected places.  One of the most unexpected results is the frequent occurrences of ‚Äújams of javascript‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); width: 500px; margin: 10px auto; max-width: 100%; min-width: 220px;" data-tweet-id="915617755675504640"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  <i>‚ÄúWe need a new term for missed business opportunities because of the modern frontend.</i>  <i>Could it be a ‚ÄúJavaScript trap‚Äù?</i> <br><br>  Managers who give the go-ahead to the creation of progressive web applications (PWA) are often referred to as the <a href="https://www.forbes.com/sites/forbespr/2017/03/07/forbes-launches-all-new-mobile-web-experience-for-forbes-com/">main motive for</a> virtually seamless coverage of new users.  At the same time, developers are mastering the tools that make it possible to achieve such a goal.  Nobody wanted bad.  However, the results of the ‚Äúfinished‚Äù PWA project often require weeks or months of painful rework to ensure minimally acceptable performance. <br><a name="habracut"></a><br>  Such an alteration delays the launch, which in turn delays the collection of data on the viability of the chosen PWA strategy.  Developers are often not aware of the problems until it is too late.  They launch sites that are simply impossible to use, unless you are one of the wealthy owners of the best smartphones. <br><br><h1>  Baseline setting </h1><br>  Those teams that manage to avoid unpleasant results tend to show a few similarities: <br><br><ol><li>  The leaders are enthusiastic.  They use the ‚Äúdo what you need‚Äù approach to ensure and keep the application running fast. </li><li>  At an early stage, performance budgets are established. </li><li>  Budgets are scaled according to the parameters of the network and devices on the market. </li><li>  Continuous Integration (CI) tools and systems help track progress and prevent regression. </li></ol><br>  These parameters are based on each other: it‚Äôs difficult to plan the right things if you don‚Äôt have a manual that appreciates the importance of a user-friendly interface and its long-term importance to the business.  Teams with such support can set performance budgets, hold contests between competing approaches, and invest in performance infrastructure.  They have more will to go against ‚Äúgenerally accepted standards‚Äù when popular tools prove their inconsistency. <br><br>  Thanks to performance budgets, everyone is in the same boat - a culture of shared enthusiasm is being created to improve the user interface.  Teams with budgets are also easier to track progress and make graphs.  This helps managers: they have meaningful metrics in support of investments. <br><br>  Budgets establish <i>objective</i> boundaries to determine which changes in the code base will be a step forward, and which - a step back from the user's point of view.  Without this, you will inevitably fall into the trap and begin to pretend that you can afford more than allowed in reality.  Very rarely, we have seen teams that succeed without a budget, collect RUM metrics, and use representative user devices. <br><br>  Meetings with partners are indicative.  We immediately got a clear idea of ‚Äã‚Äãhow bad the site‚Äôs performance is in terms of the percentage of leading programmers, project managers and managers with top smartphones that they use mainly in <a href="http://www.telecompetitor.com/report-u-s-rural-mobile-broadband-speeds-are-20-9-slower-than-urban/">urban areas</a> . <br><br>  User enhancements consist of two steps: <br><br><ul><li>  Revising assumptions and growing understanding of real world conditions </li><li>  Automated objective baseline testing </li></ul><br>  Never before have front-end developers had access to such excellent performance measurement tools and diagnostic techniques, however, poor results are normal.  What's the matter? <br><br><h1>  JS is your most expensive resource </h1><br>  One distinct trend is the belief that the JavaScript framework and single-page architecture (SPA) must be used to develop progressive web applications.  This is not true (more on this in the next article), and such sites will definitely need more scripts in each document (for example, for the router components).  We regularly see websites loading more than 500 KB of scripts (compressed).  This is important because all script downloads affect the most important metric: the time before the appearance of interactivity ( <a href="https://developers.google.com/web/tools/lighthouse/audits/time-to-interactive">Time to Interactive</a> ).  Sites with so many scripts are simply <i>not available to a</i> significant part of users;  statistically, users will not wait for the interface to load for so long.  If they wait for the download, then they experience terrible lags. <br><br>  We were often asked: ‚ÄúWhy is the JS limit of 200 KB so important, do we have some bigger pictures?‚Äù Good question!  To answer it, it is important to understand how the browser handles resources (of different types) and the concept of a <a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/optimizing-critical-rendering-path">critical path</a> .  As a timely introduction, I recommend <a href="https://www.youtube.com/watch%3Fv%3D0A-2BhEZiM4">Kevin Schaaf‚Äôs recent talk</a> . <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Lx1cYJAVnzA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i><font color="gray">Loading JavaScript with a delay can lead to the fact that the ‚Äúrendered on the server‚Äù pages do not work as the user expects, which is very annoying.</font></i>  <i><font color="gray">This effect is the main reason why we strive to guarantee reliable interactivity.</font></i> <br><br>  Imagine this page: <br><br><pre><code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/styles.css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/app.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">async</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my-app</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">picture</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">slot</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hero-image"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">srcset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"img@desktop.png, img@desktop-2x.png 2x"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">media</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"(min-width: 990px)"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">srcset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"img@tablet.png, img@tablet-2x.png 2x"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">media</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"(min-width: 750px)"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">srcset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"img@mobile.png, img@mobile-2x.png 2x"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">alt</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"I don't know why. It's a perfectly cromunlent word!"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">picture</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my-app</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The browser receives this document in response to a GET request to <code>https://example.com/</code> .  The server sends it as a stream of bytes, and when the browser encounters each of the sub-resources mentioned in the document, it requests them. <br><br>  After the download is complete, this page should respond to user actions - there is the most ‚Äúinteractivity‚Äù from the <a href="https://developers.google.com/web/tools/lighthouse/audits/time-to-interactive">‚ÄúTime to Interactive‚Äù</a> (TTI) parameter.  Browsers process user actions by generating DOM events that application code waits for.  User actions are processed in the <i>main</i> document <i>stream</i> , where JavaScript also works. <br><br>  Here are some operations that can occur in other threads, in any case, preserving the browser's ability to respond to user actions: <br><br><ul><li>  HTML parsing </li><li>  CSS parsing </li><li>  JavaScript parsing and compilation (sometimes) </li><li>  Some JS garbage collection tasks </li><li>  Parsing and screening pictures </li><li>  Hardware Accelerated CSS Transformations and Animations </li><li>  Scrolling the main document (if there are no active touch event handlers) </li></ul><br>  However, the following operations should go in the main thread: <br><br><ul><li>  Run javascript </li><li>  DOM construction </li><li>  Layout </li><li>  Processing input from the user (including scrolling in the presence of active touch event handlers) </li></ul><br>  If the document in our example did not rely on JavaScript to create the <code>&lt;my-app&gt;</code> element, the document content would most likely become interactive as soon as enough CSS and content is loaded for meaningful rendering. <br><br>  Script execution delays interactivity in several ways: <br><br><ul><li>  If the script runs longer than 50 ms, the time to reach the interactive state is increased by the <i>entire</i> time required for downloading, compiling and executing JS </li><li>  Any DOM or UI created on JS is not available for use while the script is running. </li></ul><br>  The images do not block the main stream, do not block the interaction during parsing and rasterization and do not interfere with other parts of the UI to run in interactive mode or save it.  Therefore, a 150 KB image will not significantly increase TTI, but a JS of this size will delay interactivity by the time required for the following tasks: <br><br><ul><li>  Code request, including DNS, TCP, HTTP with unarchiving overhead </li><li>  Parsing and compiling top-level JS functions </li><li>  Script execution </li></ul><br>  These steps are often repeated. <br><br>  If the script execution fits into 50 ms, then the TTI will not increase, but this is unrealistic.  150 KB of compressed JavaScript is unzipped to about 1 MB of code.  As <a href="https://medium.com/reloading/javascript-start-up-performance-69200f43b201">Eddie</a> <a href="https://docs.google.com/spreadsheets/d/1wHcNNQea28LhwQ_amFamT33d5woVrJfJy53Z1k6V090/edit">documented</a> , the whole process takes more than a second on most phones in the world, <i>not counting the download time</i> . <br><br>  JavaScript is the <i>most braking</i> part of any web page, both for downloading and for device performance.  For developers and managers with fast smartphones on fast networks, these hidden costs can be doubly incomprehensible. <br><br><h1>  Global truth </h1><br>  It is extremely important to decide which benchmark to use to determine the performance budget.  Some developers and companies know their audience very closely - and can make informed assessments about devices and networks for current and future users.  However, most do not have such information for setting the base level.  Where to begin? <br><br>  Two numbers are important here: <br><br><ul><li>  45% of <a href="https://www.gsma.com/mobileeconomy/">mobile connections in the world are 2G</a> </li><li>  75% of <a href="https://www.gsma.com/mobileeconomy/">connections carried by 2G or 3G</a> </li></ul><br>  <i>The median user is working on a slow network</i> .  The only question is how slow the connection is. <br><br>  Our metrics on Google give a controversial picture (I'm working to clarify).  Some systems show median RTTs of about 100 ms for 3G users.  Others indicate that the median user is not able to transmit or receive a separate packet in less than 400 ms in some large markets. <br><br>  I think you should choose a conservative option.  <a href="http://frankrayal.com/2011/06/27/lte-peak-capacity/">The competing, overloaded cells</a> can make ‚Äúfast‚Äù networks brutally slow, <a href="https://cs.nyu.edu/~jchen/publications/sigcomm15-zaki.pdf">transmission dispersion greatly reduces the effectiveness of TCP</a> , and <a href="http://www-personal.umich.edu/~hjx/file/sigcomm13.pdf">natural surges of network traffic work against us</a> . <br><br>  For Google developers, a specially created ‚Äúdegraded 3G‚Äù network works to evaluate the behavior of applications in such conditions.  It simulates an RTT connection of 400 ms and a bandwidth of 400-600 Kbps (plus latency dispersion and packet loss simulation).  Given the contradictory picture that our metrics show, this can be taken as a basic level. <br><br>  However, simulating packet loss and latency dispersion can make benchmarks very difficult and underestimate results.  The effect of a lost packet during a DNS lookup gives a difference in <i>seconds</i> , making it difficult to compare the result before and after the changes made during development.  Probably our baseline should take lower bandwidth and increased latency, sacrificing packet loss.  We lose the accuracy of the real world, but we get the repeatability of tests, the ability to compare the results before and after the changes made, as well as to compare different products.  Here you can still talk and talk about the influence of DNS, TLS, network topology and other factors.  If you want to delve into this topic, I highly recommend the <a href="https://hpbn.co/">book ‚ÄúHigh Performance Browser Networking‚Äù by Ilya Grigorik</a> .  <a href="https://hpbn.co/mobile-networks/">RRC description</a> alone is worth your time. <br><br>  Let's return to our basic level.  We have roughly decided on network simulation: <i>RTT 400 ms, channel 400 Kbps</i> .  What about the device itself? <br><br>  At last year‚Äôs Chrome Dev Summit conference, <a href="https://www.youtube.com/watch%3Fv%3D4bZvq3nodf4">I discussed some temperature and energy limitations that make a huge difference in performance between a mobile device and a desktop device</a> .  Add to this the gaping gap between the performance of top and low end devices due to different chip characteristics, such as cache size.  Fortunately, it‚Äôs easier to pick a basic level there than with network speed: <a href="http://www.prnewswire.com/news-releases/comscore-reports-february-2017-us-smartphone-subscriber-market-share-300437639.html">more than half of mobile users in the US</a> use Android devices.  If you look at other countries, the <a href="https://www.idc.com/promo/smartphone-market-share/os">vast majority of smartphones sold now (and the last five years) work under Android</a> .  <a href="https://www.statista.com/statistics/283334/global-average-selling-price-smartphones/">The average price of such devices in most regions <i>falls</i></a> due to the pervasiveness of Android and the <a href="http://fortune.com/2016/02/15/apple-android-asps/">steady decline in prices in the ecosystem</a> .  In turn, this affects the only major trend in determining the global base level of hardware performance budget: the next billion users will go online <i>when they can afford it</i> .  This means a decrease in the average price of smartphones in the foreseeable future.  And this, in turn, means that all the improvements in the quantity of transistors-per-dollar are converted into a lower price, and not into faster devices (on average). <br><br>  In 2016, a true median device was sold for about $ 200 without being tied to an operator.  This year the median device is even cheaper, but with about the same performance.  It can be expected that the performance of the median device will freeze at one level for several more years.  This is one of the reasons why I <a href="https://building.calibreapp.com/beyond-the-bubble-real-world-performance-9c991dcd5342">proposed the</a> <a href="https://www.gsmarena.com/motorola_moto_g4-8103.php">Moto G4</a> as the base device last year, and this year I recommend it as the <a href="https://www.gsmarena.com/motorola_moto_g5_plus-8453.php">Moto G5 Plus</a> . <br><br>  To summarize, our global baseline for measuring performance is: <br><br><ul><li>  ~ $ 200 (new, without binding to the operator) Android-smartphone </li><li>  On slow 3G networks, emulation: <br><ul><li>  RTT 400 ms </li><li>  400 Kbps speed </li></ul></li></ul><br>  For most developers, creating applications in such an environment is akin to growing vegetables on Mars.  Fortunately, <a href="https://github.com/WPO-Foundation/webpagetest/blob/6a79fedb6bb5792f11d2891d9ae80f8ffb8b1a7d/www/settings/connectivity.ini.sample">this configuration</a> is available at <a href="https://www.webpagetest.org/easy">webpagetest.org/easy</a> , so that we can recreate the Martian conditions here on Earth at any time. <br><br><h1>  Calculation of the acceptable level </h1><br>  The last thing to discuss in the performance budget is time.  What time is too long? <br><br>  I like the definition of Monica: <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-1" style="position: static; visibility: visible; display: block; transform: rotate(0deg); width: 500px; margin: 10px auto; max-width: 100%; min-width: 220px;" data-tweet-id="778248810371747840"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  <i>‚ÄúThe Monica Perf Test: if you have time to look away to eye contact with a stranger while the application is loading before the first rendering, then it is too slow‚Äù</i> <br><br>  ... but it is more qualitative than quantitative.  In numbers, I would like <i>each</i> page load to take less than a second ( <a href="https://developers.google.com/web/fundamentals/performance/rail">see RAIL</a> ).  In the real world, this is impossible, so we set <a href="https://developers.google.com/web/tools/lighthouse/audits/time-to-interactive">the Time-to-Interactive (TTI) metric</a> with partners: <br><br><ul><li>  TTI up to <i><a href="https://www.doubleclickbygoogle.com/articles/mobile-speed-matters/">5 seconds</a></i> for the first boot </li><li>  TTI up to <i>2 seconds</i> for subsequent downloads </li></ul><br>  Now we have everything we need to create a rough performance budget for the product in 2017. <br><br><h3>  First boot </h3><br>  If we subtract the time, conditions of the network connection and the main stages of the critical path, then we get some interesting results.  You can start with a budget for the first boot in 5 seconds and calculate what transfer you can afford. <br><br>  First, subtract 1.6 seconds from the budget for a DNS lookup and TLS handshake, which leaves 3.4 seconds for everything else. <br><br>  Now let's calculate how much data can be transmitted over such a channel in 3.4 seconds: 400 Kbps = 50 KB / s.  50 KB / s * 3.4 = 170 KB. <br><br><blockquote>  NOTE: This discussion will clearly enrage competent network engineers.  In previous versions of this article, slow start, bdp, tcp window scaling and the like were discussed.  It was all hard to understand.  Simplification does not significantly affect the overall conclusions, so these details were excluded. </blockquote><br>  Modern web applications mainly consist of JS, that is, we also need to subtract the time to parse and evaluate JS.  The gzip compression for the JS code is from 5x to 7x, so 170 KB of the JS archive is converted into approximately 850 KB-1 MB of JS code.  According to previous estimates, it takes about a second to launch it (assuming that there is no resource-intensive DOM there, but of course there is one).  After playing a little with these figures, you can get within 3.4 seconds of downloading and parsing / evaluating, limiting yourself to the transfer of JS in the amount of 130 KB. <br><br>  And the last detail: if one of the critical path resources is loaded from another place (for example, from a CDN), then you need to subtract from the budget another connection time with it (~ 1.6 s), which further reduces the fraction of time from 5 seconds We can spend on network data transfer and work on the client side. <br><br>  Summing up, under ideal conditions, our approximate budget for critical path resources (CSS, JS, HTML and data) is: <br><br><ul><li>  <i>170 KB</i> for sites without a special amount of JS </li><li>  <i>130 KB</i> for sites made on JS frameworks </li></ul><br>  This gives us the opportunity to consider the single most pressing question that stands in modern front-end development: <i>‚ÄúCan you afford it?‚Äù</i> <br><br>  For example, if your JS framework takes ~ 40 KB on a site overloaded with JS (which has a budget of 130 KB due to JS processing time), then only 90 KB remains for the rest.  Your entire application should fit in this volume.  A 100-kilobyte framework loaded from a CDN <i>already exceeds the budget by 20 KB</i> . <br><br>  Remember: your favorite framework might fit in 40KB, but what about the data system?  Router components that you added?  Suddenly, 130 KB doesn‚Äôt seem to be such a large volume, given the data, patterns and styles. <br><br>  Living on a budget means constantly asking yourself: ‚ÄúCan I really afford it?‚Äù <br><br><img src="https://habrastorage.org/webt/rt/2-/gb/rt2-gbw9vt3s5pwuip3tueoesou.png"><br><br><h3>  Second download </h3><br>  In an ideal world, all pages load faster than a second, but for many reasons this is often not feasible.  Therefore, we will give ourselves a little more freedom and a budget of 2 seconds for the second (third, fourth, etc.) load. <br><br>  Why not five?  Because we no longer need to go online to download the UI.  <a href="https://developers.google.com/web/fundamentals/primers/service-workers/">Service Workers</a> and <a href="http://offlinefirst.org/">offline first</a> architectures allow you to display interactive pixels on the screen without even accessing the network.  This is the key to <a href="https://infrequently.org/2016/05/service-workers-and-pwas-its-about-reliable-performance-not-offline/">consistently high performance</a> . <br><br>  Two seconds is an <i>eternity</i> on modern CPUs, but we still need to correctly distribute them taking into account the following factors: <br><br><ul><li>  Process creation time (Android is relatively slow compared to other OSs) </li><li>  Time to read bytes from disk (it is non-zero even on flash drives!) </li><li>  Code execution time </li></ul><br>  All the applications I have seen that fit into the five-second first boot and correctly implemented the principle of offline-first, also fit into the budget of two seconds, and it is also possible to reach the limit of one second!  But the introduction of offline-first is a huge problem for many teams.  Designing with local saving of last user data (last-seen), reliable and consistent caching of application resources, tricks with updating application code using <a href="https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle">the Service Worker life cycle</a> can be a big task. <br><br>  I look forward to the tools continue to evolve in this direction.  The most advanced framework I know now is the <a href="https://www.polymer-project.org/2.0/toolbox/">Polymer App Toolbox</a> , so if you are not sure where to start, start with it. <br><br><h1>  130-170 KB ... Yes, you are just kidding!?! </h1><br>  Many teams with whom we had to talk, asked the question: is it possible to fit something meaningful at all in such a small amount of 130 KB.  Maybe!  <a href="https://www.polymer-project.org/2.0/toolbox/prpl">The PRPL pattern</a> does this by aggressively splitting code depending on the route, caching granular resources (sequential pages) using the Service Worker, and cleverly using modern protocol extensions like <a href="https://en.wikipedia.org/wiki/HTTP/2_Server_Push">HTTP / 2 Push</a> . <br><br>  Together, these tools <a href="https://www.webpagetest.org/video/compare.php%3Ftests%3D171009_XR_4af2434b042e8ded9256ce3de39e5345-r%253A1-c%253A0%26thumbSize%3D200%26ival%3D100%26end%3Dfull">allow you to fit a modern functional interface of less than 100 KB on a critical path</a> . <br><br>  Unfortunately, it is still difficult to determine which parts of the page are critical resources for TTI and which are not from a specific log.  But I believe that the tools will quickly fix this flaw, given the exceptional importance of this metric. <br><br>  Despite all the arguments, it is possible to keep within the budget without even giving up completely the frameworks.  Both <a href="https://www.wego.com/">Wego</a> and <a href="https://h5.ele.me/msite/">Ele.me are</a> created with the help of modern tools ( <a href="https://www.polymer-project.org/">Polymer</a> and <a href="https://vuejs.org/">Vue</a> , respectively) - and they really work <i>today</i> , helping customers make transactions.  Most applications are less complex than these.  Living on a budget does not mean starving. <br><br><h1>  Tools for teams on a budget </h1><br>  Meeting the budget is <i>really</i> difficult, but the benefits to businesses and users are enormous.  Benefits for development teams and their managers are not often discussed.  No lead programmer or project manager wants to be in front of the manager who comes up to him with the phone in his hands and asks: ‚ÄúWhy does it work so slowly when I'm on vacation?‚Äù <br><br>  This is not a theoretical argument. <br><br>  I saw teams that had just finished rewriting the code on a modern technological stack ‚Äî and they sat nailed for an hour when we showed their ‚Äúbest‚Äù and ‚Äúfast‚Äù applications in real world conditions. <br><br>  <i>Anyone</i> will lose face if the product does not meet expectations.  Months of unscheduled prompting to improve performance push back the introduction of new functions and negatively affect the team morale.  When productivity becomes a problem, middle managers try to suppress self-doubt and at the same time close the team from the flying crap, which the team itself expects.  Worse, managers themselves may begin to doubt the team.  A performance crisis can have lasting effects;  can the organization be sure that the team will issue a quality product?  Can they trust a lead programmer who recommends using a new technology or make additional major investments?  Then recriminations.  This is a <i>terrible</i> experience, especially for developers who are too often in the position of incredible ‚Äúfix it as soon as possible‚Äù pressure ‚Äî and ‚Äúthis‚Äù can be the underlying technology on which the product is based. <br><br>  In the worst cases, the product cannot be fixed in a time small enough to help the business.  Often, development proceeds in an evolutionary way, and if a startup or a small team has relied on the wrong technology stack, in the absence of time, an error can become fatal.  What is the worst, the error can not notice very, very long.  If all employees of the group carry top-smartphones with the latest version of iOS in their pockets and do not leave the city, and the economy of the product is based on the growth of a wide audience, then no one will understand the lack of growth of this audience. <br><br>  Of course, productivity is not a (whole) product.  Many applications that are slowed down or intended for a narrow niche feel great.  The unique service that people need (and they are ready to try to get it) is able to outweigh any of these concerns.  Some have succeeded even in the App Store and Play Market, where it is <i>not easy</i> to attract an audience.  But products in competitive markets matter every advantage. <br><br>  Some specific tools and techniques can help teams that implement a performance budget: <br><br><ul><li>  <a href="https://www.webpagetest.org/easy">webpagetest.org/easy</a> : our favorite one-time analysis tool </li><li>  <a href="https://sites.google.com/a/webpagetest.org/docs/using-webpagetest/scripting">WPT scripts</a> : for teams that don‚Äôt want to install a special WPT instance, and they have public URLs for WIP applications, integration with WPT scripts could be a good option for regular ‚Äúchecks‚Äù </li><li>  <a href="https://sites.google.com/a/webpagetest.org/docs/private-instances">WPT private instances</a> : if a team wants to integrate WPT directly into its CI or into commit-queue systems (automated test queue before a commit), then you should consider installing a private WPT server and equipment </li><li>  <a href="https://developers.google.com/web/tools/lighthouse/">Scripted Lighthouse</a> : Not Ready for a Full WPT Instance?  Scripting Lighthouse helps CI automate site analysis and regression search </li><li>  <code><a href="https://github.com/tkadlec/grunt-perfbudget">grunt-perfbudget</a></code> is an even simpler automated WPT test tool for your CI.  Use it! </li><li>  <a href="https://speedcurve.com/">Speedcurve</a> and <a href="https://calibreapp.com/">Caliber</a> : network services automate regular performance checks in the real world </li><li> <a href="https://webpack.js.org/configuration/performance/">Webpack Performance Budgets</a> :    Webpack   ,            ,   </li><li> <a href="https://github.com/siddharthkp/bundlesize">bundlesize</a>  <a href="https://github.com/GoogleChromeLabs/pr-bot">pr-bot</a>     ,         -. ! </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fighting code blowing often means that you need </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to make obvious mistakes out of warnings</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">For teams using continuous integration systems or automated test queues before committing, it is strongly recommended to disable commits that exceed the performance budget. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the group starts from scratch, my </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strong</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> recommendation is to start with a stack that focuses on the structure of the application, the separation of code and the target assembly. </font><font style="vertical-align: inherit;">The best for today:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Polymer App Toolbox </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Next.js, preferably with Preact as a lighter runtime library </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Whatever tools your team chooses, the most important is the budget. </font><font style="vertical-align: inherit;">Without it, even the most advanced ‚Äúlightweight‚Äù frameworks can easily create bloated, unusable applications. </font><font style="vertical-align: inherit;">Starting from a global base level and increasing the budget only on the basis of specific metrics is the only way I know that the project will be good for everyone.</font></font><br><br><h1>  Notes </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the sake of saving time and space, you will have to postpone for the next article a discussion of architectures that have a reserve for the future. </font><font style="vertical-align: inherit;">Curious users can explore </font></font><a href="https://developers.google.com/web/fundamentals/primers/service-workers/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Service Workers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://developers.google.com/web/updates/2017/02/navigation-preload"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Navigation Preload</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://developers.google.com/web/updates/2016/06/sw-readablestreams"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Streams</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Their combined power must fundamentally transform the optimal page load time in 2018 and beyond.</font></font><br><br>  And the last.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I thank everyone who reviewed the first drafts of this article, among them: </font></font><a href="https://twitter.com/vinamratas"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Winamrata Singhal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://twitter.com/Paul_Kinlan"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paul Quinlan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://twitter.com/poshaughnessy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peter O'Shaughnessy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://twitter.com/addyosmani"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eddie Osmani</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://twitter.com/graynorton"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gray Norton</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">I hope their heroic attempts to rid the article of errors are not inferior to my talent to add new ones.</font></font></div><p>Source: <a href="https://habr.com/ru/post/345212/">https://habr.com/ru/post/345212/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345202/index.html">Typescript. Read Only Properties</a></li>
<li><a href="../345204/index.html">How to learn to think in images using visual analogies</a></li>
<li><a href="../345206/index.html">We tried to hire these two for five years. And every minute of our waiting paid off.</a></li>
<li><a href="../345208/index.html">1Kb autocomplete</a></li>
<li><a href="../345210/index.html">Anonymous Father Frost 2017-2018: post boasting New Year's gifts</a></li>
<li><a href="../345214/index.html">How to quit graduate school and become a developer</a></li>
<li><a href="../345216/index.html">Expanding Ansible with plugins: part 2</a></li>
<li><a href="../345218/index.html">Not soon the fence is built, especially a beautiful data center. How we build the data center "Avantage". Part 2</a></li>
<li><a href="../345222/index.html">Deploying ElectrumX Server</a></li>
<li><a href="../345224/index.html">Live broadcast of the Waves Platform in Digital October</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>