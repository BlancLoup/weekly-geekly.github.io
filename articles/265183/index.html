<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Billions of requests per day meet Go 1.5</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Translation of an article about how the company transferred its infrastructure to Go 1.5 and reduced the garbage collector pauses from ~ 279ms to ~ 10...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Billions of requests per day meet Go 1.5</h1><div class="post__text post__text-html js-mediator-article">  <i>Translation of an article about how the company transferred its infrastructure to Go 1.5 and reduced the garbage collector pauses from ~ 279ms to ~ 10ms.</i> <br><br>  Customer-focused marketing systems depend on collecting and analyzing as many related events as possible.  Customers are literally everywhere, and the amount of data grows exponentially.  Go language plays an important role in our data collection system.  Today FLXone handles 3+ billion requests per day with our application written from scratch. <br><a name="habracut"></a><br>  Our way to achieve such performance began with identifying the key tasks of the interface between marketing and advertising with technology: <br><ul><li>  huge amounts of data must be collected and processed </li><li>  customers can generate millions of events, increasing our workload in seconds </li><li>  responsiveness (latency) is the key to real-time data analysis </li></ul><br>  In 2013, we decided that Go (at that time 1.1 more) looks promising, and we wrote the first version of our application in less than 5 days, and only 2 programmers worked on it.  Chips of the language, such as gorutiny and channels, greatly simplified the task of writing code, with abundant competitiveness (concurrency).  Reaching thousands of requests per second on a Macbook Pro with minimal optimizations looked very promising. <br><br>  The application, in fact, does the following: accepts requests, with a large number of URL parameters, an average of 1KB each.  The server parsit requests, and sends a message to the distributed queue.  Upon completion of this, it returns an empty response to the client. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  We grow further </h4><br>  As soon as our business began to grow, we saw that the response time began to increase.  We had an SLA of about 100ms per request.  And when we grew even bigger, it became more and more of a problem.  At first we decided that this was somehow related to the network connections to the servers, but even though we generated terabytes of data daily, the problem was something else. <br><br>  Then we began to analyze the behavior of our Go program.  On average, the application spent ~ 2ms on the request, and it was great!  We still had 98ms on the network overhead, SSL handshake, DNS requests and everything else that keeps the Internet afloat. <br><br>  Unfortunately, the standard deviation of response time was large, about 100ms.  To meet our demand for SLA has become a gamble.  Using Go ‚Äúruntime‚Äù package, we made profiling of our application and realized that our problem was garbage collection, which resulted in a 95-percentile response time of 279 milliseconds ... <br><br>  We decided to rewrite large chunks of our application so that they do not generate garbage at all.  This greatly reduced the interval at which the garbage collector stopped the entire application to do its magical actions.  But problems with the response time did not matter, so we decided to add more nodes to fit into our SLA.  With peak loads of 80K requests per second, even minimal garbage can be a serious problem. <br><br><h4>  And this day has come </h4><br>  There has been a lot of talk about Go 1.5 in recent months.  The compiler was completely rewritten from C to Go, which reminded me of the movie ‚ÄúInception‚Äù.  But more than that, the garbage collector was completely redone. <br><br>  Last night (August 19), this moment finally arrived.  Stable version of Go 1.5 came out with the statement: <br><blockquote>  The pause of the ‚Äústop of the world‚Äù collector will almost always be less than 10 ms, and in most cases, much less. </blockquote><br>  Just a few hours after the release, we rebuilt our application with Go 1.5 and ran our unit and function tests;  everything went smoothly.  It looked too good, so we checked the functionality also manually.  After a few hours, we decided that it would be safe to roll out this build for one node in production. <br><br>  We gave her 12 hours of work and analyzed the new values ‚Äã‚Äãof response time: the entire request, separate applications, and, no less important parameter, the time of the garbage collector pauses.  In the graph below, you can see how the variation in values ‚Äã‚Äãand the average response time have decreased: <br><br><img src="https://habrastorage.org/files/9a5/9e2/827/9a59e28278ac4e8d9913ce9eb3cc3e6c.png"><br>  <i>Two histograms of application response time (the only thing important to us).</i>  <i>X axis: response time, Y axis: number of requests.</i>  <i>Left: server running Go 1.4, right: server running Go 1.5, the difference is visible to the naked eye.</i> <br><br>  The new version of Go has reduced our value of the 95-percentile garbage collector from 279 ms to only 10 ms.  This is a fantastic reduction of the pause by 96% and this is exactly what <a href="">was stated</a> in the release notes. <br><br><blockquote>  Garbage collection pauses decreased by 96% </blockquote><br>  We decided to close the new version to the rest of our infrastructure (12 data centers in 7 geographic areas) and saw that our average response time to requests decreased by 53%.  This meant that we could easily fit into our 100ms, plus each node can now hold a large load. <br><br>  Thanks to the efficiency and flexibility of our team, the release of Go 1.5 greatly improved our performance and this happened in 24 hours. </div><p>Source: <a href="https://habr.com/ru/post/265183/">https://habr.com/ru/post/265183/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265173/index.html">I invite you to meet with Vadim Makeev from Opera</a></li>
<li><a href="../265175/index.html">Property Attributes in Objective-C. Instructions for beginners</a></li>
<li><a href="../265177/index.html">SPLA fun to make money on the clouds</a></li>
<li><a href="../265179/index.html">How is the flash revolution going</a></li>
<li><a href="../265181/index.html">Connect to the Jump Start online event on September 2: "Windows 10 on the corporate network"</a></li>
<li><a href="../265185/index.html">Rakes that you wouldn‚Äôt want to step on in your project</a></li>
<li><a href="../265187/index.html">Career in Information Security</a></li>
<li><a href="../265189/index.html">Dell and TLC 3D NAND: Something New</a></li>
<li><a href="../265191/index.html">An update is available for ReSharper Ultimate</a></li>
<li><a href="../265195/index.html">How the computer itself improved its code, or we program the programming process.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>