<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Encrypted file system in file: recipe ready</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On Habr√© already had many articles on how to safely transfer data, protecting the channel, or encrypting the data file. But often storing data in a fi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Encrypted file system in file: recipe ready</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://www.picamatic.com/view/6107455_bank1/"><img align="right" src="http://www.picamatic.com/show/2009/11/28/05/47/6107455_bigthumb.jpg" alt="Picamatic - upload your images" title="Data protection" width="267" height="200"></a>  On Habr√© already had many articles on how to safely transfer data, protecting the channel, or encrypting the data file.  But often storing data in a file is not very convenient (for example, it is not convenient to store a SVN repository in the file, or maildir with mail). <br><br>  Under the cut is another solution that I find very convenient, maybe it will be useful to someone else. <br><br><a name="habracut"></a>  Why am I not using the archive, but the file system?  Because the file system can use all the programs that work with files.  And the archive would have to be unzipped and create an unencrypted copy, which you can then accidentally forget to delete.  In short, an encrypted file system is a natural solution, and saving files with all their attributes in an encrypted archive is an artificial solution.  On this let me finish the lyric part and go to the specifics. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Create a file with an encrypted file system </h2><br>  We load the kernel module geom_bde <br><pre>  # kldload geom_bde </pre>  or for automatic loading we register in / boot / loader.conf <br><pre>  geom_bde_load = "YES" </pre>  Create the file itself (in my case, one megabyte): <br><pre>  # dd bs = 1024 count = 1024 if = / dev / zero of = / mnt / nokia / virt-fs </pre>  Create a device that looks into this file: <br><pre>  # mdconfig -a -t vnode -f / mnt / nokia / virt-fs -u 0 </pre>  Now we have a device / dev / md0. <br>  Initialize encryption: <br><pre>  # gbde init / dev / md0 </pre>  Here you will be asked to enter the password twice. <br><blockquote>  Attention, this is the easiest way.  gbde allows more sophisticated security with lock and key files.  If you're interested, see man. </blockquote>  Now the encrypted device must be connected: <br><pre>  # gbde attach / dev / md0 </pre>  Enter the password again.  If the password is not correct, nothing will happen.  If the correct one is, the device /dev/md0.bde appears. <br>  Create a file system on it: <br><pre>  # newfs -U -O2 /dev/md0.bde </pre>  That's all, you can disassemble the whole structure, if you no longer need it (for more details, see below): <br><pre>  # gbde detach / dev / md0;  mdconfig -d -u 0 </pre><br><h2>  We connect </h2><br>  Here, I think, unfamiliar teams will not be: <br><pre>  # mdconfig -a -t vnode -f / mnt / nokia / virt-fs -u 0
 # gbde attach / dev / md0
 # mount /dev/md0.bde / mnt-private </pre>  Now an encrypted file system is mounted in / mnt-private, located in the / mnt / nokia / virt-fs file and any program can use it (by the way, they are driving simlinks!). <br><br><h2>  Disable </h2><br>  It's still easier here: <br><pre>  # umount / mnt-private
 # gbde detach / dev / md0
 # mdconfig -d -u 0 </pre>  Please note that if one of these commands does not work (for example, the file system is busy and not unmounted), then the rest will not work either.  This must be taken into account when writing a connection / disconnection script. <br><br><h2>  That's all </h2><br>  Now, if the enemy kidnaps my ‚Äúnokiyu‚Äù, then nothing can be disassembled in the virt-fs file. <br><br>  All success and safety of private data! </div><p>Source: <a href="https://habr.com/ru/post/76643/">https://habr.com/ru/post/76643/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../76634/index.html">ICQ of the ideal world</a></li>
<li><a href="../76635/index.html">Abuse in code</a></li>
<li><a href="../76637/index.html">VKontakte and phishing protection</a></li>
<li><a href="../76638/index.html">Non cross-browser event</a></li>
<li><a href="../76640/index.html">The Passenger: 7 minutes in 8 years</a></li>
<li><a href="../76646/index.html">Printliminator - bookmarklet for easy printing sites</a></li>
<li><a href="../76648/index.html">Advertising Win7 VKontakte - a hint with a cheek or just like that?</a></li>
<li><a href="../76650/index.html">What to do with negative reviews?</a></li>
<li><a href="../76656/index.html">Navitel Navigator - now on Android</a></li>
<li><a href="../76657/index.html">Mobile phone vs bad weather</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>