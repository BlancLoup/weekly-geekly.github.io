<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Xamarin.UITest</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will tell you about Xamarin.UITest - the framework for acceptance UI testing from Xamarin. 

 What is it and how to cook it 
 Xamari...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Xamarin.UITest</h1><div class="post__text post__text-html js-mediator-article">  In this article I will tell you about Xamarin.UITest - the framework for acceptance UI testing from Xamarin. <br><br><h3>  What is it and how to cook it </h3><br>  Xamarin.UITest is based on Calabash and has a similar working principle.  However, tests on this framework are written in C # and NUnit (unlike Calabash, which uses Gherkin + Ruby).  The framework is cross-platform and, therefore, it allows you to write tests for both the iOS platform and Android.  Windows Phone is not supported, which I personally consider a disadvantage of this tool.  But it supports test native applications in Java and Objective-C. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/bc9/293/8a5/bc92938a5b984c4ab7d5aba9651670df.png" alt="image"></div><br><a name="habracut"></a><br><h3>  Why Xamarin.UITest </h3><br>  Of course, many of you may argue, they say, Java and Objective-C have their own native frameworks that do an excellent job with their task.  But if you need to write acceptance UI tests simultaneously for two platforms, Xamarin.UITest will come in handy.  Moreover, it has box support <a href="https://xamarin.com/test-cloud">Xamarin Test Cloud</a> .  The testclaud itself is a very useful thing, but rather expensive. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Learn more about how this works. </h3><br>  The mechanism of work on iOS and Android is different.  On iOS, the Nuget package is built into the application, which raises the http server inside your application.  Here's how it works on iOS: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/177/fed/39e/177fed39e30d41c38b26aa2e7fb3672d.png"></div><br><br>  When working with Android, things are a little different.  In fact, when building and running tests, two applications are installed on the device: yours and Test Cloud server.  Both of them are signed with the same key, so the Test Cloud server has rights to manage your application.  It looks like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/6b4/cec/249/6b4cec2498c649c7a33baa1e2bb70f4a.png"></div><br><br>  Embedded Hamarin.UITest in a solution is quite simple, almost in a couple of clicks.  All you need is to create another project for UI tests. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f26/e54/fa4/f26e54fa4ac44f8bae93fee3356a4cb9.png"></div><br><br>  After these simple actions, a project with an initialization template and installed packages is added.  Then, in the iOS project, you need to add the Nuget package Xamarin Test Cloud Agent NuGet, and in AppDelegate we write the following lines: <br><br><pre><code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> DEBUG Xamarin.Calabash.Start(); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> return true;</span></span></code> </pre> <br>  If you are using marinated IDE, then the integration process can be considered complete on this.  For Visual studio, you have to do everything manually, but everything is pretty simple here.  In addition to manipulating the iOS project, you need to add a PCL project and install the Nunit and Xamarin.UITest packages into it. <br><br><h3>  Now let's talk about configuring our tests. </h3><br>  We will be interested in two classes: Tests and Appinitializer.  Let's start with the second: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AppInitializer</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IApp </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartApp</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Platform platform</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> If the iOS or Android app being tested is included in the solution // then open the Unit Tests window, right click Test Apps, select Add App Project // and select the app projects that should be tested. if (platform == Platform.Android) { return ConfigureApp .Android // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Update this path to point to your Android app and uncomment the // code if the app is not included in the solution. //.ApkFile ("../../../Droid/bin/Debug/xamarinforms.apk") .StartApp (); } return ConfigureApp .iOS // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Update this path to point to your iOS app and uncomment the // code if the app is not included in the solution. //.AppBundle ("../../../iOS/bin/iPhoneSimulator/Debug/XamarinForms.iOS.app") .StartApp (); } }</span></span></code> </pre><br>  In addition to the path to the apk and ipa files specified in TODO, there are a number of parameters, for example, the device identifier on which the tests will be run, the api key for Xamarin Test Cloud and others.  The class itself determines the platform to run and starts the tests on the selected platform.  Now let's look at the Tests class: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Tests</span></span> { IApp app; Platform platform; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tests</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Platform platform</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.platform = platform; } [SetUp] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BeforeEachTest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { app = AppInitializer.StartApp(platform); } [Test] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AppLaunches</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { app.Repl(); } }</code> </pre><br>  The method with the SetUp attribute and will run our tests by passing a platform to StartApp.  Unfortunately, the ‚Äúout-of-the-box‚Äù version will only work for a project on Xamarin.Forms.  And on MVVM-Cross, you can somehow get out like this: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetUp</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> TestiOS Path = "path/to/app"; _app = ConfigureApp.iOS .AppBundle(Path) //Xcode -&gt;Window -&gt;Devices -&gt; Identifier .DeviceIdentifier("Identifier") .StartApp(); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> Path = "path/to/apk"; _app = ConfigureApp .Android .ApkFile (Path) //.EnableLocalScreenshots () .StartApp (); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> }</span></span></code> </pre><br>  Accordingly, it is necessary to create TestiOS and TestDroid targets. <br><br><h3>  Well ... set up, launched, it's time to start writing tests! </h3><br>  Tests usually have quite standard Arrange-Act-Assert structure <s>the same Nunit, only in a profile</s> .  We should start by creating a test containing the Repl method (read-eval-print-loop).  It launches a console in which, using queries, we can see the structure of the visible part of our application.  This is done like this: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AppLaunches</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { app.Repl(); }</code> </pre><br>  This method calls the REPL console.  For clarity, I executed the tree command in it, providing information on all visible elements: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/597/963/897/5979638975bb4a628338c079284a4894.png"></div><br><br>  And the application itself looks like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/1dc/b94/0d1/1dcb940d16034cfea64926f2f7dc6023.png"></div><br><br>  In order to interact with the controls, we need to use the methods of the IApp interface.  In this article, we will consider only three of them: Tap (), WaitForElement () and Query ().  Although they are much larger, and their full list with all the properties can be found <a href="https://developer.xamarin.com/api/namespace/Xamarin.UITest/">here</a> . <br><br>  First we need to get the identifiers of the elements of type AppQuery.  This is done like this: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Func&lt;AppQuery, AppQuery&gt; InitialMessage = c =&gt; c.Marked(<span class="hljs-string"><span class="hljs-string">"MyLabel"</span></span>).Text(<span class="hljs-string"><span class="hljs-string">"Hello, Habrahabr!"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Func&lt;AppQuery, AppQuery&gt; Button = c =&gt; c.Marked(<span class="hljs-string"><span class="hljs-string">"MyButton"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Func&lt;AppQuery, AppQuery&gt; DoneMessage = c =&gt; c.Marked(<span class="hljs-string"><span class="hljs-string">"MyLabel"</span></span>).Text(<span class="hljs-string"><span class="hljs-string">"Was clicked"</span></span>);</code> </pre><br>  So, we received AppQuery for all elements and now we can interact with them.  Let's validate the start message, tap on the button and validate the received message. <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AppLaunches</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { app.Repl(); <span class="hljs-comment"><span class="hljs-comment">// Arrange - Nothing to do because the queries have already been initialized. AppResult[] result = app.Query(InitialMessage); Assert.IsTrue(result.Any(), "The initial message string isn't correct - maybe the app wasn't re-started?"); // Act app.Tap(Button); app.WaitForElement (DoneMessage, "Timeout", TimeSpan.FromSeconds (2)); // Assert result = app.Query(DoneMessage); Assert.IsTrue(result.Any (), "The 'clicked' message is not being displayed."); }</span></span></code> </pre><br>  As you can see from the example, IApp methods (the instance in this case is app) take as input parameters the data of type AppQuery and return the result of type AppResult [].  Linq expressions are applicable only to AppResult [], and therefore the asserts look like this.  And AppResult [] itself looks like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/643/d26/cf9/643d26cf932846a8a39797e7019813e9.png"></div><br><br>  In this example, when running locally, tests can run in parallel on both platforms, and all the results will be dumped into one console (which, IMHO, is not very convenient).  In addition, it is possible in a couple of clicks to integrate the maritime TestCloud service and run tests in the cloud.  Running tests is done from the unit test panel, which is quite convenient. <br><br>  In addition to the agent, in order to run tests in TestCloud, you need to add an api key (I did not add it in this sample).  How to get it and apply is described in detail <a href="https://developer.xamarin.com/guides/testcloud/organizations-and-teams/">here</a> . <br><br>  On this, perhaps, it is worth completing our brief excursion into Xamarin.UITest.  I hope my review was useful to you.  Thank you all for your attention. <br><br>  <a href="https://github.com/xamarin/xamarin-forms-samples/tree/master/UsingUITest">Link</a> to the sample that was used in the article. <br><br>  Useful links on the topic: <br>  <a href="https://developer.xamarin.com/api/namespace/Xamarin.UITest/">developer.xamarin.com/api/namespace/Xamarin.UITest</a> <br>  <a href="https://developer.xamarin.com/guides/testcloud/uitest/intro-to-uitest/">developer.xamarin.com/guides/testcloud/uitest/intro-to-uitest</a> <br>  <a href="http://www.nunit.org/index.php%3Fp%3DquickStart%26r%3D2.6.3">www.nunit.org/index.php?p=quickStart&amp;r=2.6.3</a> <br>  <a href="https://msdn.microsoft.com/ru-ru/library/bb397926.aspx">msdn.microsoft.com/en-ru/library/bb397926.aspx</a> </div><p>Source: <a href="https://habr.com/ru/post/269389/">https://habr.com/ru/post/269389/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269379/index.html">Analysis of options for building telephony based on Microsoft Skype For Business</a></li>
<li><a href="../269381/index.html">Pirate metrics: how to create an AARRR email campaign from Dave McClure. Part 1</a></li>
<li><a href="../269383/index.html">Embed JSON in Embedded? Easy peasy</a></li>
<li><a href="../269385/index.html">Cache in Drupal from A to Z</a></li>
<li><a href="../269387/index.html">Oracle regular expressions. Dangerous range</a></li>
<li><a href="../269391/index.html">ShishNashKi</a></li>
<li><a href="../269393/index.html">Security Week 43: hard prime numbers, cryptography in HDD, Adobe and Oracle patches</a></li>
<li><a href="../269395/index.html">Golden Site distributed elephants to the best Internet projects.</a></li>
<li><a href="../269397/index.html">Instant download of desktop and mobile sites: part 1</a></li>
<li><a href="../269399/index.html">Application Lifecycle in Windows 8.1 and UWP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>