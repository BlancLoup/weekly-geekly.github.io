<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Actors and AJAX</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For writing programs that perform parallel computing, threads are widely used. Given that the streams allow for quite flexible organization of parrall...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Actors and AJAX</h1><div class="post__text post__text-html js-mediator-article">  For writing programs that perform parallel computing, threads are widely used.  Given that the streams allow for quite flexible organization of parrallism in programs, they have a number of drawbacks.  The fact is that threads share memory among themselves.  This means that it is very easy to neglect the integrity of the program.  This can be overcome with the help of locks that allow some code to get exclusive access to the shared resource.  However, the locks themselves, besides the fact that they need to be remembered to be affixed, cause problems in turn.  One of the worst problems is the ability to spawn a deadlock.  However, even without this, writing a really well-functioning multi-threaded program turns into jewelry work. <br><br>  But threads have alternatives.  From known to me - model of actors (actors) and software transaction memory.  The hero of this article, as is clear from the title, are the first.  However, on STM there are a lot of articles on the Internet that will satisfy your curiosity. <br><br><a name="habracut"></a><br><h2>  What is the model of actors </h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The Internet is full of references to the model of actors.  Therefore, I will only write about what actors are, without going into history, application, usage patterns. <br><br>  So, actors are objects that: <br><ul><li>  do not share states with each other; </li><li>  interact with each other only through the sending of asynchronous messages; </li><li>  the actor does not process any two messages simultaneously;  instead, the actor collects incoming messages in a queue and processes them sequentially. </li></ul><br><br>  Actors are very reminiscent of various message queue systems, such as JMS, ActiveMQ or MSMQ.  In addition, in many GUI frameworks, controls, like actors, interact with each other using asynchronous messages. <br><br><h2>  Distributed computing </h2><br><br>  Why is it necessary in parallel computing to represent that the calculations are spinning on one physical machine?  And if we have a cluster?  For high-load projects this is especially important, since  sooner or later they rest against the boundaries of one car.  The thread model in this case does not fit at all, since  threads have shared memory.  If you try to implement something similar in the case of a distributed system, there will be a problem with the synchronization of data between the nodes, because the threads running on different nodes should seem to have shared memory.  But the actors interact with each other only through asynchronous messages, which are well transmitted over the network. <br><br>  Actors have another advantage for distributed computing.  Because  the actor does not share its state with anyone; this very state is easy to serialize and transfer between nodes.  On the other hand, the actor is not obliged to respond to messages instantly, because all messages are delivered asynchronously, so it will be normal for the actor if he spends some time on the serialization / deserialization of the state, postponing the message processing for a while. <br><br><h2>  Existing implementations </h2><br><br>  Traditionally, the model of actors is loved among Erlang and Scala programmers, where actors are supported natively.  There are libraries for various languages, including Java, the most famous of which is Akka.  On Habr√© there is an <a href="http://habrahabr.ru/post/125717/">overview of</a> this library. <br><br>  However, even the presence of Akka did not stop me from wanting to make my own library to support the actors.  Why do I need it, I will explain below.  In the meantime, I'll show you how actors work in my library. <br><br><h2>  nop.actors </h2><br><br>  I implemented support of actors in the <a href="http://code.google.com/p/nop/">framework</a> .  The mechanism resembles typed actors from Akka, and there is only asynchronous message passing. <br><br>  How to describe an actor?  To do this, you need to describe the interface, i.e.  the set of messages processed by the actor, and the implementation, i.e.  proper processing of messages.  If we draw parallels with the languages ‚Äã‚Äãwhere pattern matching is supported, then the interface description is equivalent to an algebraic type declaration, and the implementation is the pattern matching itself.  Here is an example of the description of the actor: <br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Actor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pingable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ping</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String token, Pinger pinger)</span></span></span></span>; }</code> </pre> <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Actor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pinger</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pong</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String token)</span></span></span></span>; }</code> </pre><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultPingable</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pingable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ping</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String token, Pinger pinger)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">"Pinging with: "</span></span> + token); pinger.pong(token); } }</code> </pre><br><br>  This is how it will be used: <br><br><pre> <code class="java hljs">Pingable pingable = Actors.wrap(Pingable.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultPingable()); pingable.ping(<span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pinger() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pong</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String a)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">"Ping received: "</span></span> + a); } });</code> </pre><br><br>  There are certain restrictions on the data passed in the arguments.  Informally, they can be understood in such a way that only primitives, POJOs, other actors and lists can be transmitted.  Formally, this is described as follows.  Let S be the set of all types that are transmitted in messages.  Then: <br><ul><li>  primitive types and wrapper classes are included in S; </li><li>  any interface marked with Actor annotation is included in S; </li><li>  any enum is in S; </li><li>  List &lt;T&gt;, Set &lt;T&gt;, T [] are included in S if T is included in S; </li><li>  Any class consisting of private fields and a pair of accessor methods for each of them is included in S if the type of each of the fields is in S. </li></ul><br><br>  Now let's see how to make actors accessible remotely via the HTTP protocol.  For this, there is a mechanism integrated into nop and using the framework tools.  To make an actor accessible remotely, you must call the exportActor method on an ActorManager object.  ActorManager can be obtained through dependency injection: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PingController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ActorManager actorManager; <span class="hljs-meta"><span class="hljs-meta">@Injected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PingController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ActorManager actorManager)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.actorManager = actorManager; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Content </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pingDemo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ActorInfo fooInfo = actorManager.exportActor(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultPingable()); <span class="hljs-comment"><span class="hljs-comment">//    ,    hello // ... } }</span></span></code> </pre><br><br>  Of course, it is not necessary to use the features provided by the nop framework as a whole.  If you do not need to drag all the dependencies, it is enough to do with the HttpActorDispatcher class alone, placing it in your servlet. <br><br><h2>  Actors on the browser side </h2><br><br>  The above properties of the actors suggest that the actors are just perfect for web applications where you need to actively exchange data between the browser and the web server in both directions.  But this requires support for the actor model in JavaScript.  And she is in nop.actors! <br><br>  If you take the actors only within the browser itself, then everything is simple with them.  First, the constructor of the actor class needs to be wrapped in the actor call.  Secondly, to make an instance of a class an actor, you need to wrap it with the actor method.  Here is what the Pinger actor would look like: <br><br><pre> <code class="javascript hljs">DefaultPinger = actor(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">elem</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elem = elem; }); DefaultPinger.prototype.pong = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">token</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> messageElem = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">"div"</span></span>); messageElem.textContent = token; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elem.appendChild(messageElem); }</code> </pre><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pinger = actor(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultPinger(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"pingResult"</span></span>))); pinger.pong(<span class="hljs-string"><span class="hljs-string">"hello"</span></span>);</code> </pre><br><br>  If it is necessary to ensure the interaction of the actors on the browser side with the actors on the web server side, then the JavaScript interface should be described.  For our example, the description will look like this: <br><br><pre> <code class="javascript hljs">Pingable = {}; Pinger = {}; Pingable.ping = [<span class="hljs-string"><span class="hljs-string">"value"</span></span>, actorRef(Pinger)]; Pinger.pong = [<span class="hljs-string"><span class="hljs-string">"value"</span></span>];</code> </pre><br><br>  The general principle here is.  The protocol by which you need to communicate with the actor is described as an object.  The properties of the object correspond to the messages processed by the actors.  The property value should always be an array listing the types of arguments passed with the message.  The framework understands the following types of arguments: <br><br><ul><li>  the string ‚Äúvalue‚Äù matches any primitive type or enum; </li><li>  actorRef (A), where A is the actor description; </li><li>  an array consisting of one element A indicates that the argument is a collection with an element of type A; </li><li>  an arbitrary object means POJO, and the values ‚Äã‚Äãof the properties of the object indicate the types of the POJO properties. </li></ul><br><br>  The class ActorRemoting is responsible for working with remote actors.  Here is an example of initializing and using the class: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> remoting = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActorRemoting(<span class="hljs-string"><span class="hljs-string">"/actors/"</span></span> + sessionId); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pingable = remoting.importActor(Pingable, nodeId, actorId); remoting.start(pregable.ping(<span class="hljs-string"><span class="hljs-string">"hello"</span></span>, pinger);</code> </pre><br><br>  Of course, the server should, first, somehow transfer sessionId, nodeId and actorId to the browser.  For example, it can do this when generating a page by adding JavaScript code to it that initializes these variables. <br><br><h2>  Complete example </h2><br><br>  Above, I talked about the implementation of the model of actors in nop, both on the server side and on the browser side.  However, I still kept silent about how to tie all this together in one small application.  So, we also need the following classes: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Route</span></span>(prefix = <span class="hljs-string"><span class="hljs-string">"pingpong"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PingRoute</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@RoutePattern</span></span>(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RouteBinding</span></span>(PingRoute.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PingController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ActorManager actorManager; <span class="hljs-meta"><span class="hljs-meta">@Injected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PingController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ActorManager actorManager)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.actorManager = actorManager; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Content </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ActorInfo pingInfo = actorManager.exportActor(Pingable.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultPingable()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> html(createView(PingView.class).setActorInfo(pingInfo)); } }</code> </pre><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PingView</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Template</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">PingView </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setActorInfo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ActorInfo actorInfo)</span></span></span></span>; }</code> </pre><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ModuleRequires</span></span>(modules = ActorsModule.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PingModule</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractModule</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ app.loadPackage(PingModule.class.getPackage().getName()); } }</code> </pre><br><br>  In addition, you need to add a PingView.xml template with the following content: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">t:template</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:t</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://nop.org/schemas/templating/core"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">t:head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">t:parameter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"actorInfo"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">t:service</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"actorsRoute"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.nop.actors.ActorsRoute"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">t:head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">t:body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>A simple actors example<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=UTF-8"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${actorsRoute.resource('actors.js')}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">/&gt;</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"argument"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"pingButton"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Ping</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"pingResult"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="javascript"><span class="xml"><span class="javascript"> Pingable = {}; Pinger = {}; Pingable.ping = [</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"value"</span></span></span></span><span class="xml"><span class="javascript">, actorRef(Pinger)]; Pinger.pong = [</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"value"</span></span></span></span><span class="xml"><span class="javascript">]; DefaultPinger = actor(</span></span><span class="hljs-function"><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">(</span></span></span><span class="hljs-params"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-params">elem</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">) </span></span></span></span><span class="xml"><span class="javascript">{ </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">this</span></span></span></span><span class="xml"><span class="javascript">.elem = elem; }); DefaultPinger.prototype.pong = </span></span><span class="hljs-function"><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">(</span></span></span><span class="hljs-params"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-params">token</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">) </span></span></span></span><span class="xml"><span class="javascript">{ </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">var</span></span></span></span><span class="xml"><span class="javascript"> messageElem = </span></span><span class="hljs-built_in"><span class="xml"><span class="javascript"><span class="hljs-built_in">document</span></span></span></span><span class="xml"><span class="javascript">.createElement(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"div"</span></span></span></span><span class="xml"><span class="javascript">); messageElem.textContent = token; </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">this</span></span></span></span><span class="xml"><span class="javascript">.elem.appendChild(messageElem); } </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">var</span></span></span></span><span class="xml"><span class="javascript"> pinger = actor(</span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">new</span></span></span></span><span class="xml"><span class="javascript"> DefaultPinger( </span></span><span class="hljs-built_in"><span class="xml"><span class="javascript"><span class="hljs-built_in">document</span></span></span></span><span class="xml"><span class="javascript">.getElementById(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"pingResult"</span></span></span></span><span class="xml"><span class="javascript">))); </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">var</span></span></span></span><span class="xml"><span class="javascript"> remoting = </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">new</span></span></span></span><span class="xml"><span class="javascript"> ActorRemoting(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"/actors/${actorInfo.sessionId}"</span></span></span></span><span class="xml"><span class="javascript">); </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">var</span></span></span></span><span class="xml"><span class="javascript"> pingable = remoting.importActor(Pingable, ${actorInfo.nodeId}, ${actorInfo.actorId}); remoting.start(); </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">var</span></span></span></span><span class="xml"><span class="javascript"> argumentElem = </span></span><span class="hljs-built_in"><span class="xml"><span class="javascript"><span class="hljs-built_in">document</span></span></span></span><span class="xml"><span class="javascript">.getElementById(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"argument"</span></span></span></span><span class="xml"><span class="javascript">); </span></span><span class="hljs-built_in"><span class="xml"><span class="javascript"><span class="hljs-built_in">document</span></span></span></span><span class="xml"><span class="javascript">.getElementById(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"pingButton"</span></span></span></span><span class="xml"><span class="javascript">).onclick = </span></span><span class="hljs-function"><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">(</span></span></span><span class="hljs-params"></span><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span></span><span class="xml"><span class="javascript">{ pingable.ping(argumentElem.value, pinger); } </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">t:body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">t:template</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  An example ready for launch can be downloaded <a href="">here</a> . <br><br><h2>  Chess on the actors </h2><br><br>  Here, it seems, everything is obvious: there are three actors in the game: two players and one playing field.  The last actor checks the players' moves and notifies them about each other's moves.  So one could write about such interfaces: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Actor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Board</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registerPlayer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Player player, PieceColor color)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Player player, BoardLocation source, BoardLocation destination)</span></span></span></span>; }</code> </pre><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Actor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Player</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moveRejected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moved</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BoardLocation source, BoardLocation destination)</span></span></span></span>; }</code> </pre><br><br>  The Board implementation obviously sends the message MoveRejected back to the player if he made a wrong move or went at the wrong time.  The message moved is sent to both players.  Walked - in confirmation of the move, the opponent - as a notification of the opponent's progress. <br><br>  Here only this interface is made very naive.  The player making the move himself indicates on whose behalf the move is made.  An attacker can use this insidiously.  In addition, if, for some reason, one of the player actors ‚Äúfell‚Äù, then it is not possible to restore the state of the game.  So, we write the following interfaces to overcome these disadvantages: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Actor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Board</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">authorizePlayer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PlayerObserver observer, String key)</span></span></span></span>; }</code> </pre><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Actor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Player</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BoardLocation source, BoardLocation destination, PieceType promotedType)</span></span></span></span>; }</code> </pre><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Actor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlayerObserver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">authorizationAccepted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PieceColor color, Player player)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">authorizationRejected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moveRejected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">boardStateChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BoardState state)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moved</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BoardLocation source, BoardLocation destination)</span></span></span></span>; }</code> </pre><br><br>  So, that's what happened.  Now the player is hidden behind the PlayerObserver interface.  And the playing field is represented by one Board and one Player.  Player - this is something like the angle of the playing field, available to one particular player.  Entering the game, the actor player tells the playing field a password and passes the link to himself.  From the playing field, he receives confirmation in the form of a message authorizationAccepted.  In addition, by connecting to the game, the actor receives the state of the playing field at the moment as a message boardStateChanged. <br><br>  Please note that both the Player and Board actor must share state with each other.  So it really is, nop supports it.  We can say that this is one actor that is visible from different angles.  Here‚Äôs what the authorizePlayer message handling actually looks like: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">authorizePlayer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PlayerObserver observer, String key)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> matches = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (PlayerImpl player : players.values()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (player.token.equals(key)) { observer.authorizationAccepted(player.color, player); sendFullState(observer); player.setPlayerObserver(observer); updateObserverList(); matches = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!matches) { observer.authorizationRejected(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendFullState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PlayerObserver observer)</span></span></span><span class="hljs-function"> </span></span>{ BoardState state = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BoardState(); <span class="hljs-comment"><span class="hljs-comment">//      . // ... observer.boardStateChanged(state); }</span></span></code> </pre><br><br>  Here the player is passed to the observer during message processing by the board.  Because  Player was clearly not done by actor, the framework will automatically make it as such and at the same time combine with the board.  In fact, to create a new actor that does not have a common state with others, it is necessary to explicitly make it an actor using Actors.wrap. <br><br>  The full code of Board / Player actors can be found <a href="">here</a> . <br><br>  The JavaScript part requires an actor interface description.  Here's what it looks like: <br><br><pre> <code class="javascript hljs">Board = {}; Player = {}; PlayerObserver = {}; BoardLocation = { <span class="hljs-attr"><span class="hljs-attr">row</span></span> : <span class="hljs-string"><span class="hljs-string">"value"</span></span>, <span class="hljs-attr"><span class="hljs-attr">column</span></span> : <span class="hljs-string"><span class="hljs-string">"value"</span></span> }; PieceState = { <span class="hljs-attr"><span class="hljs-attr">type</span></span> : <span class="hljs-string"><span class="hljs-string">"value"</span></span>, <span class="hljs-attr"><span class="hljs-attr">color</span></span> : <span class="hljs-string"><span class="hljs-string">"value"</span></span>, <span class="hljs-attr"><span class="hljs-attr">location</span></span> : BoardLocation }; Move = { <span class="hljs-attr"><span class="hljs-attr">source</span></span> : BoardLocation, <span class="hljs-attr"><span class="hljs-attr">destination</span></span> : BoardLocation, <span class="hljs-attr"><span class="hljs-attr">piece</span></span> : <span class="hljs-string"><span class="hljs-string">"value"</span></span>, <span class="hljs-attr"><span class="hljs-attr">capturedPiece</span></span> : <span class="hljs-string"><span class="hljs-string">"value"</span></span> }; BoardState = { <span class="hljs-attr"><span class="hljs-attr">moves</span></span> : [Move], <span class="hljs-attr"><span class="hljs-attr">pieces</span></span> : [PieceState] }; Board.authorizePlayer = [actorRef(PlayerObserver), <span class="hljs-string"><span class="hljs-string">"value"</span></span>]; Player.move = [BoardLocation, BoardLocation]; PlayerObserver.authorizationAccepted = [<span class="hljs-string"><span class="hljs-string">"value"</span></span>, actorRef(Player)]; PlayerObserver.authorizationRejected = []; PlayerObserver.moveRejected = []; PlayerObserver.boardStateChanged = [BoardState]; PlayerObserver.moved = [BoardLocation, BoardLocation];</code> </pre><br><br>  The PlayerObserver implementation simply redraws the page when messages arrive from the server and sends messages to the server when the player moves the piece. <br><br>  The full implementation of the browser actor is available <a href="">here</a> . <br><br>  The chess example is included in the nop distribution as a demonstration application.  The application code is located in the / demo / chess folder.  I also raised the finished <a href="https://justplay.j.rsnx.ru/chess">service</a> . <br><br><h2>  Benefits </h2><br><br>  In addition to achieving transparent messaging, nop.actors can also do the following things. <br><br>  First, the framework is fully modular.  There is an implementation of the mechanism of actors within the process.  There is an implementation of remote actors, made on top of the actors within the process, and this implementation can use any transport. <br><br>  Secondly, asynchronous processing of long-poll requests using servlets version 3.0.  If 1000 clients are connected to the server, this will not mean that it will create 1000 threads that do nothing. <br><br>  Thirdly, the system automatically unloads the do-nothing actors onto the disk, freeing memory.  At the same time, the life of any actor is potentially infinite. </div><p>Source: <a href="https://habr.com/ru/post/142792/">https://habr.com/ru/post/142792/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142784/index.html">Store energy bags</a></li>
<li><a href="../142785/index.html">jQuery UI Bootstrap Theme</a></li>
<li><a href="../142786/index.html">PhoneSoap kills microorganisms on the surface of the smartphone</a></li>
<li><a href="../142788/index.html">Twitter Bootstrap 2.0 - Russian PSD style library</a></li>
<li><a href="../142791/index.html">Google is building a new data center in the US</a></li>
<li><a href="../142793/index.html">Trial versions of CS6 are available for download from Adobe servers.</a></li>
<li><a href="../142794/index.html">"Crouching cars, hidden piano", or the theory of probability in action</a></li>
<li><a href="../142795/index.html">EAP-SIM authentication in WLAN</a></li>
<li><a href="../142796/index.html">Determine which row was clicked in UIPickerView</a></li>
<li><a href="../142798/index.html">Google Street View in Donetsk</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>