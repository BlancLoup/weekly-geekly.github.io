<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Chronos library: make writing long operations easier</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! I want to tell you about the Chronos for Android library (API level> = 9), the purpose of which is to facilitate writing long operations, su...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Chronos library: make writing long operations easier</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  I want to tell you about the Chronos for Android library (API level&gt; = 9), the purpose of which is to facilitate writing long operations, such as network requests, or database calls. <br><img src="https://habrastorage.org/files/0ce/983/746/0ce983746d20401e8d8dd86f32c13286.png"><br>  <b>What problem we solve?</b> <br><br>  It's no secret that for Android, the task of performing asynchronous operations has always been one of the most frequently encountered.  Indeed, very few applications work exclusively offline, and where you can do without network interaction.  And absolutely tiny part of them goes without reference to the device‚Äôs permanent memory, be it a database, Preferences or a regular file.  However, throughout the history of the development of the system, we have never been offered a single, fairly convenient solution out of the box. <br><a name="habracut"></a><br><img src="https://habrastorage.org/files/bfe/ed1/06e/bfeed106ee2a414f9c1e6b4913d93662.png"><br><div class="spoiler">  <b class="spoiler_title">What solved the problem - a brief history</b> <div class="spoiler_text">  Let's take a look at the existing toolkit in the context of the task ‚Äúwork out the click on the‚Äú authorization ‚Äùbutton‚Äù.  Actually, what do we have? <br><br>  <b>1. Standard streams</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="java hljs">Button signInButton = (Button) findViewById(R.id.button_auth); signInButton.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Activity activity = AuthActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; showProgress(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thread(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Runnable() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ APIFactory.getApi().signIn(); activity.runOnUiThread(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Runnable() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ goToMainContent(); } }); } }).start(); } });</code> </pre> <br>  This code is literally everything.  It is difficult to read, memory flows in it, it cannot be canceled, the screen rotation is not processed in it, as well as any API call errors (and if they are processed, then everything will look completely indigestible). <br><br>  <b>2. AsynkTask</b> <br><br><pre> <code class="java hljs">Button signInButton = (Button) findViewById(R.id.button_auth); signInButton.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AuthTask().execute(); } }); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthTask</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AsyncTask</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Boolean</span></span></span><span class="hljs-class">&gt;</span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPreExecute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ showProgress(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> Boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doInBackground</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Void... params)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { APIFactory.getApi().signIn(); }<span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPostExecute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Boolean result)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!isCancelled() &amp;&amp; result) { goToMainContent(); } } }</code> </pre><br>  Already a little better, but still not enough.  Appeared readable error handling, the ability to cancel.  However, until now this code is not able to work properly when the screen is rotated at the time of the request to the API - the link to the Activity in which the class is defined flows away. <br><br>  <b>3. Loader</b> <br>  When Google introduced the Loaders, it seemed that they would become Silver bullet for asynchronous requests, shifting the classic AsyncTask and at that time.  Unfortunately, the miracle did not happen.  At the moment, Loaders are a rare guest in commercial projects, since they were very inconvenient to use.  In this section, I will not give the code by analogy with the previous two.  Instead, I recommend a curious reader to get acquainted with the official guide on this technology in order to assess the amount of code required by the Loader: <a href="http://developer.android.com/reference/android/content/AsyncTaskLoader.html">developer.android.com/reference/android/content/AsyncTaskLoader.html</a> <br><br>  <b>4. Service</b> <br>  Services are good for performing long tasks that ‚Äúhang‚Äù in the background during the use of the application.  However, to launch operations, the result of which is needed here and now, the structure of services is not ideal.  Mainly, the limitation is imposed by the method of data transmission via Intent, which, firstly, contains only a limited amount of data, and secondly, requires that the transmitted data be serializable in one way or another.  On this technology, the popular library of <a href="https://github.com/stephanenicolas/robospice">Robospice works</a> . </div></div><br>  <b>What does Chronos offer?</b> <br><br><img src="https://habrastorage.org/files/fbc/ec8/440/fbcec8440f0642a5bca8f61c6dc38fec.png"><br><br>  Chronos does all the work for you in performing the task in a parallel thread and delivering the result or execution error to the main thread.  Roughly speaking, this library provides a container for any kind of long operations. <br>  There is a full-fledged wiki in the project, part of the code from there will be used in the article, but for a more complete guide, please contact <a href="https://github.com/RedMadRobot/Chronos/wiki">github.com/RedMadRobot/Chronos/wiki</a> . <br><br>  <b>Example</b> <br><br>  Let's solve a typical problem using Chronos: in the Activity, you need to request some object from a certain repository, access to which is long enough not to make a request in the UI stream.  First, we write the code, and then we analyze what we did. <br><br>  <b>1.</b> The first thing you need to connect Chronos to the project.  To do this, simply write the dependency in the gradle: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">compile</span></span> <span class="hljs-string"><span class="hljs-string">'com.redmadrobot:chronos:1.0.5'</span></span></code> </pre><br>  <b>2.</b> Now we will describe Activity.  The base class <i>ChronosActivity</i> is one of the library components, however you can easily write its analogue, examples of which are in the documentation.  Also Chronos can be used in fragments, the code will not differ. <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChronosActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); Button startButton = (Button) findViewById(R.id.button_start); startButton.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> View v)</span></span></span><span class="hljs-function"> </span></span>{ runOperation(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyOperation()); } }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOperationFinished</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> MyOperation.Result result)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.isSuccessful()) { showData(result.getOutput()); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { showDataLoadError(result.getError()); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BusinessObject data)</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">//... } private void showDataLoadError(Exception exception){ //... } }</span></span></code> </pre><br><br>  <b>3.</b> And finally, we describe the business logic of receiving data in the class <i>MyOperation</i> : <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyOperation</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChronosOperation</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BusinessObject</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Nullable</span></span> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> BusinessObject </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> BusinessObject result ; <span class="hljs-comment"><span class="hljs-comment">// here you should write what you do to get the BusinessObject return result; } @NonNull @Override public Class&lt;? extends ChronosOperationResult&lt;BusinessObject&gt;&gt; getResultClass(){ return Result.class; } public final static class Result extends ChronosOperationResult&lt;BusinessObject&gt; { } }</span></span></code> </pre><br>  That's all.  Let's see in detail what happens in this code.  Start over. <br><br>  <i>Setting UI Class</i> <br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChronosActivity</span></span></span><span class="hljs-class"> </span></span>{</code> </pre> <br>  To work with Chronos, the Acvitity base class or a fragment must either inherit from those offered in the library, or contain specific code in the life-cycle methods, examples can be seen in the <a href="https://github.com/RedMadRobot/Chronos/wiki/How-to-use-Chronos">documentation</a> . <br><br>  <i>Running operation</i> <br><pre> <code class="java hljs">runOperation(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyOperation());</code> </pre><br>  This is where the base method of the ChronosActivity class is called, to which the newly created activity is passed.  Immediately after calling this method, Chronos will take the operation into the queue and begin its execution in a parallel thread. <br><br>  <i>Processing the result of the operation</i> <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOperationFinished</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> MyOperation.Result result)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.isSuccessful()) { showData(result.getOutput()); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { showDataLoadError(result.getError()); } }</code> </pre><br>  This method will be called after the operation is completed, or an exception is thrown during execution.  Such handler methods must have a signature <i>public void onOperationFinished (ResultType)</i> .  The important point: the method will be called only between the onResume () and onPause () calls, that is, in it you can easily change the UI, without fear that it has already become invalid by that moment.  Moreover, if the Activity was recreated due to rotation, going into the background, or other reasons, Chronos will return the result anyway (the only exception is that the system has run out of memory, in this case, to prevent OutOfMemory, Chronos can erase the old results data). <br><div class="spoiler">  <b class="spoiler_title">‚ÄúWhere does the call come from?‚Äù</b> <div class="spoiler_text">  An attentive reader will notice that Activity does not implement any specific interfaces, so where does this method come from?  The answer is from the code containing the reflection.  The decision to make reflection instead of an interface was made because of TypeErasure in Java, which makes it impossible to simultaneously implement the same template interface with different parameters.  That is, this is done so that in one Activity it is possible to process the result of any number of types of operations. </div></div><br>  <i>Setting the class of operation</i> <br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyOperation</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChronosOperation</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BusinessObject</span></span></span><span class="hljs-class">&gt; </span></span>{</code> </pre><br>  The <i>ChronosOperation</i> class encapsulates the business logic for retrieving an object of a particular type, in this case <i>BusinessObject</i> .  All user operations must be inherited from <i>ChronosOperation</i> . <br><br>  <i>Business logic</i> <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Nullable</span></span> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> BusinessObject </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> BusinessObject result ; <span class="hljs-comment"><span class="hljs-comment">// here you should write what you do to get the BusinessObject return result; }</span></span></code> </pre><br>  This abstract method of the <i>ChronosOperation</i> class <i>is</i> responsible, in fact, for the business logic of receiving an object.  It runs in a parallel thread, so you can do as long as you want in it, it will not cause lags in the application interface.  Also, any exceptions thrown in it will be carefully passed to the caller without causing the application to crash. <br><br>  <i>Result Naming</i> <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Class&lt;? extends ChronosOperationResult&lt;BusinessObject&gt;&gt; getResultClass(){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Result.class; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Result</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChronosOperationResult</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BusinessObject</span></span></span><span class="hljs-class">&gt; </span></span>{ }</code> </pre><br>  The following method and class are designed to enable the Activity code to write a result handler for each specific operation, specifying the class as the parameter type of the <i>onOperationFinished</i> method.  You can use the same result class for different operations if you want their result to be processed in the same way. <br><br>  <b>I summarize: we will collect the minimum set of code sections needed for working with Chronos.</b> <br><br><ul><li>  Class of operation </li><li>  Operation invocation code in a UI object </li><li>  Result handling code in a UI object </li></ul><br>  <b>What else is there?</b> <br><br><ul><li>  In order not to lose the already running query when the screen is rotated, Chronos <a href="https://github.com/RedMadRobot/Chronos/wiki/Single-launch-mode">provides the ability to ‚Äúname‚Äù operation launches</a> . </li><li>  It is <a href="https://github.com/RedMadRobot/Chronos/wiki/Canceling-operations">possible to cancel operations</a> . </li><li>  If you want the result of the operation to receive not only the object that caused it, but also everything subscribed to it, <a href="https://github.com/RedMadRobot/Chronos/wiki/Broadcasting-results">you can do Broadcast launches</a> . </li><li>  In addition, if desired, operations can be performed synchronously using the Chronos class. </li></ul><br>  <b>So why and why can Chronos be used?</b> <br><br><ul><li>  Chronos assumes the transfer of data between threads, leaving you to worry only about business logic. </li><li>  Chronos takes into account all the nuances of the Life cycle of the Activity and fragments, delivering the result only when they are ready to process it, saving the data until then. </li><li>  Chronos does not leak memory.  You no longer risk catching crashes because too many Activity objects flowed away. </li><li>  Chronos is covered by unit tests. </li><li>  And finally, Chronos is an open-source project.  You can always take the code and rewrite it to fit your needs.  Thanks to the tests, it will be easy for you to validate code changes. </li></ul><br>  <a href="https://github.com/RedMadRobot/Chronos">Link to the project in GitHub</a> .  There you will find a complete library guide, usage examples and, of course, source code. <br><br>  See also: <br>  <a href="http://habrahabr.ru/company/redmadrobot/blog/257861/">We put controllers on a diet: Android</a> <br>  <a href="http://habrahabr.ru/company/redmadrobot/blog/246551/">Architectural design of mobile applications: part 1</a> <br>  <a href="http://habrahabr.ru/company/redmadrobot/blog/251337/">Architectural design of mobile applications: part 2</a> </div><p>Source: <a href="https://habr.com/ru/post/263111/">https://habr.com/ru/post/263111/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263099/index.html">Skype turned to people?</a></li>
<li><a href="../263101/index.html">Work with passwords: how to protect your accounts (expert opinion)</a></li>
<li><a href="../263103/index.html">Unobvious performance problems in Doctrine related to the hydration of objects</a></li>
<li><a href="../263105/index.html">Getting rid of the ‚Äúhistorical reasons‚Äù in cmd.exe in an easier and standard way.</a></li>
<li><a href="../263109/index.html">User data leakage in QIWI</a></li>
<li><a href="../263113/index.html">Trouble came from not waiting, XSS vulnerability in Yandex.Metrica</a></li>
<li><a href="../263115/index.html">Clojure Web Applications</a></li>
<li><a href="../263117/index.html">10 years "on the knee" and forced evolution - note for young</a></li>
<li><a href="../263121/index.html">We continue to get acquainted with Intel Xeon Phi: "native" code</a></li>
<li><a href="../263125/index.html">International Mathematical Olympiad for Schoolchildren 2015. Am I? If I want to? Will I decide?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>