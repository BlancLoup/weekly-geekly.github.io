<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making a map editor for your platform</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many, I think, created, or at least tried to create some kind of toy. And very often, indie developers choose the genre of arcade, scrolling shooter, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making a map editor for your platform</h1><div class="post__text post__text-html js-mediator-article">  Many, I think, created, or at least tried to create some kind of toy.  And very often, indie developers choose the genre of arcade, scrolling shooter, platformer or something like that.  Here I want to talk about creating a simplest level editor for such an arcade game. <br>  As a platform, I chose C # + XNA 4.0, and WinForms for custom elements in the level editor. <br>  Create a Windows Game project in VisualStudio and go! <br> <a href=""><img height="380" src="https://habrastorage.org/getpro/habr/post_images/3f0/b23/e65/3f0b23e65022c9d318812bc2f9371e7e.png" width="499"></a> <br><br><a name="habracut"></a><br><h3>  0. Architecture </h3><br>  For the level, I created a separate class that is used both in the game itself and in the editor.  For convenience, I brought it to a separate project and added to both solutions.  The level object itself is created in the editor, serialized to a file, and then from that file it is deserialized into the game. <br><br><h3>  1. Interface </h3><br>  As I said, I did the interface on Windows Forms.  We connect System.Windows.Forms to our project.  Some Windows Forms class names may conflict with names in Xna, the poet will do so <br><blockquote><code>using WinForms = System.Windows.Forms;</code> </blockquote> <br>  MSDN has an excellent description of Windows Forms and all of its widgets, so I will not dwell on this.  With the interaction of Windows Forms and XNA, I had no problems.  Create a procedure in the Game1 class (the standard name of the game class in Xna) that creates a window, widgets and sets them up, and calls it in the Initialize () method.  I did something like this: <br> <a href=""><img height="305" src="https://habrastorage.org/getpro/habr/post_images/5ef/7e5/cfa/5ef7e5cfac6cd21dae452204318dc296.png" width="130"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  2. Class level </h3><br>  Create a level class and indicate that it is serializable: <br><blockquote> <code>[Serializable] <br> public class Level <br> { <br> //... <br> <br> } <br></code> </blockquote><br>  This class contains lists of all objects (I made only one type of object, but adding others is no longer difficult) <br><blockquote> <code>public List&lt;Block&gt; Blocks = new List&lt;Block&gt;(); <br> public Vector2 cameraPos;</code> </blockquote> <br><br>  Block class: <br><blockquote> <code>[Serializable] <br> public class Block <br> { <br> [NonSerialized] <br> public Texture2D tex; <br> <br> public Rectangle rect; <br> <br> public Block(Texture2D texture, Rectangle rectangle) <br> { <br> this.tex = texture; <br> this.rect = rectangle; <br> } <br> <br> }</code> </blockquote> <br>  Please note that it should also be serializable, and the texture should not be serialized (otherwise, an error), but we add it directly when loading the level into the game itself (for this you can create an additional String Texturename property, int TextureType or whatever you want). <br><br>  CameraPos is a vector pointing to the camera position needed to make the level scroll. <br>  In the same class methods for translating coordinated from screen to world and vice versa: <br><blockquote> <code>public Vector2 ScreenToWorld(Vector2 vector) <br> { <br> Vector2 rvect; <br> rvect = cameraPos + vector; <br> return rvect; <br> } <br> <br> public Vector2 WorldToScreen(Vector2 vector) <br> { <br> Vector2 rvect; <br> rvect = vector - cameraPos; <br> return rvect; <br> }</code> </blockquote> <br><br> <a href=""><img height="207" src="https://habrastorage.org/getpro/habr/post_images/c4b/9a8/cbb/c4b9a8cbbc06eb8218d0a1e76d3e6bda.png" width="328"></a> <br><br><h3>  3. The editor himself </h3><br>  In the Game1 class, we create a description of the current tool: <br><blockquote> <code>enum CurrentTool <br> { <br> None, <br> Brick, <br> Delete <br> } <br> CurrentTool currTool = CurrentTool.None; <br> <br></code> </blockquote><br>  And in the event handler of the tool switch in our auxiliary window, we change the currTool variable to what the user chooses. <br><br>  If a block is selected, then we create it and drag it around the window, when we click the mouse, we add it to the list of blocks and it is fixed in the level. <br>  The tool for creating a block has two modes of operation: a free location and a location at certain places, at a distance that is a multiple of the block size, so that the level is more correct. <br><br>  Scroll window: <br><blockquote> <code>if (Keyboard.GetState().IsKeyDown(Keys.Left) &amp;&amp; lastKeyboardState.IsKeyUp(Keys.Left)) <br> { <br> level.cameraPos += new Vector2(-10, 0); <br> } <br> //    <br> <br></code> </blockquote><br><br>  We do not forget when doing a translation from screen coordinates to world coordinates and vice versa, when it is necessary (when drawing, adding an object, etc.). <br><br><h3>  4. Save / load level. </h3><br>  In the handler of clicking on the Save / Load buttons, we call class methods for working with load saving. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> using System.Runtime.Serialization.Formatters.Binary; <br> using System.IO; <br> <br> namespace LevelLib <br> { <br> public static class SaveOpenLevel <br> { <br> public static Level OpenLevel(string filename) <br> { <br> Level level; <br> if (filename == "") <br> { <br> return null; <br> } <br> if (!File.Exists(filename)) <br> { <br> return null; <br> } <br> BinaryFormatter bf = new BinaryFormatter(); <br> Stream fs = new FileStream(filename, FileMode.Open); <br> level = (Level)bf.Deserialize(fs); <br> fs.Close(); <br> return level; <br> } <br> <br> public static int SaveLevel(string filename, Level level) <br> { <br> if (filename == "") <br> { <br> return 1; <br> } <br> BinaryFormatter bf = new BinaryFormatter(); <br> Stream fs = new FileStream(filename, FileMode.Create); <br> bf.Serialize(fs, level); <br> fs.Close(); <br> return 0; <br> } <br> } <br> } <br> <br> * This source code was highlighted with Source Code Highlighter.</code> </blockquote> <br>  This class is located in the project for working with a level (in the same place as Level, Block, etc.) <br><br>  We make this.level = OpenLevel (‚Äúfoo.lvl‚Äù) in the game, but don't forget to add texture to the blocks. <br>  Next, we process the player's interaction with the level (for me, for now this is limited to this: <br><blockquote> <code>foreach(Block block in level.blocks) <br> { <br> if(block.Intersets(player.Rectangle) <br> return true; <br> } <br> <br></code> </blockquote><br>  ) <br><h3>  5. Afterword </h3><br>  That's how I made the frame for the level editor.  Now you can add other objects, expand it. <br>  Please do not swear for sloppy / ugly / crooked code. <br>  I post a screenshot, a project in which you can throw these blocks on the stage and the game itself, in which you can run around the level I can‚Äôt lay out, it‚Äôs raw now, but if you're interested, then there‚Äôs enough to see.  By default, an accelerator with the name Test.lev from the folder with the game binarics loads, and the editor saves the file in the folder with the entire file, so the level file will need to be transferred.  Otherwise, you need to correct the name of the level in the source code (all sources are attached). <br>  <a href="">Link to skydrive (7z file)</a> <br>  <a href="http://narod.ru/disk/20421650001/Tommy2dGame.zip.html">On narod.ru (file in zip format)</a> - for those who do not have 7zip <br><br> <a href=""><img height="324" src="https://habrastorage.org/getpro/habr/post_images/eb6/6ad/44d/eb66ad44d222de55d1ec5419a5efeb2c.png" width="566"></a> <br><br>  <b>UPD:</b> added files to the article. <br><br></div><p>Source: <a href="https://habr.com/ru/post/125225/">https://habr.com/ru/post/125225/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../125219/index.html">Apple's financial reserves exceeded US government operating reserves</a></li>
<li><a href="../125220/index.html">Startup Poster Updated</a></li>
<li><a href="../125222/index.html">Secure password storage</a></li>
<li><a href="../125223/index.html">Job Digest: Web Studios</a></li>
<li><a href="../125224/index.html">Canobuvosti, 102nd edition</a></li>
<li><a href="../125226/index.html">The sysadmin of our galaxy is dedicated!</a></li>
<li><a href="../125228/index.html">New smilies in Skype 5.5</a></li>
<li><a href="../125231/index.html">Collector collected all existing PS2 games</a></li>
<li><a href="../125232/index.html">Google inc returning Google.ua, wants to return and Youtube.ua</a></li>
<li><a href="../125238/index.html">Singleton - pattern or antipattern?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>