<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Free Clouds from Amazon + Ruby on Rails. First impressions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Since November 2010, Amazon provides a minimum cloud hosting package for free (for a period of 1 year and only for new users). I have long been going ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Free Clouds from Amazon + Ruby on Rails. First impressions</h1><div class="post__text post__text-html js-mediator-article"> Since November 2010, Amazon provides a minimum cloud hosting package <a href="http://aws.amazon.com/free/">for free</a> (for a period of 1 year and only for new users).  I have long been going to feel what it is, and the freebie was the last straw.  I have never dealt with a whole dedicated server.  I moved to Linux just a few months ago, due to my interest in Ruby on Rails, so I am a reference example of a curious teapot.  I hope that this article will become an ideal entry point into the clouds for teapots like me. <br><a name="habracut"></a><br>  Registering with <a href="http://aws.amazon.com/">Amazon Web Services</a> is a completely trivial process.  If you have a payment card for the Internet, you just need to fill out a form.  If not, google a query like ‚ÄúVisa virtuon, e-card, internet card, banks,% name of your country%‚Äù and, after reading the issue, go to the bank.  The closest thing to my house was the Pravex Bank branch, the conditions there are quite acceptable, although there is no Internet banking.  Card service costs $ 3 per year, minimum balance is $ 5.  They activated it three days later, after an unsuccessful attempt to tie it to an account, I had to call the bank's hotline to <a href="http://www.google.com.ua/search%3Fsourceid%3Dchrome%26ie%3DUTF-8%26q%3D%25D1%2580%25D0%25B0%25D0%25B7%25D1%2580%25D0%25B5%25D1%2588%25D0%25B8%25D1%2582%25D1%258C%2B%25D0%25B0%25D0%25B2%25D1%2582%25D0%25BE%25D1%2580%25D0%25B8%25D0%25B7%25D0%25B0%25D1%2586%25D0%25B8%25D1%258E%2B%25D0%25B1%25D0%25B5%25D0%25B7%2BCVV2">allow authorization without CVV2</a> .  Five minutes later, I started my first server. <br><br>  The first impression from AWS - too much of everything - forever can not figure it out!  Dozens of FAQs, manuals, tabs, and new incomprehensible terms.  Most of all, it was not the links that helped me jump, but the reading on the diagonal of <a href="http://awsdocs.s3.amazonaws.com/EC2/latest/ec2-ug.pdf">this manual</a> .  Although there are 269 pages, but a lot can be missed the first time, so do not be intimidated. <br><br>  The most productive metaphor for understanding what AWS is and how its parts are interconnected is the data center.  The account control panel is best imagined not as a shared-hosting admin or shell of a dedicated server, but as software for automating a normal, non-cloud data center.  That is, instead of calling the admin to reboot the server, install 3 more of the same, or upgrade the hardware, you press the buttons, and everything is done automatically in a few minutes instead of a few hours or days. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Instances is your server rack.  AMIs are customized server images that can be installed in your datacenter.  Volumes - screws that can be inserted into any of the servers.  Snapshots - backup copies of screws.  Security Groups - firewalls, each of which can hide one or more servers. <br><br><img src="https://habrastorage.org/storage/80a6aaa4/26245e70/4ab2800e/dc79a9cc.png"><br><br>  How does all this work?  The central object of all this cloud abundance is Amazon Machine Image, or AMI.  AMIs are of two types - S3-backed and EBS-backed.  EBS-backed is an image of a virtual machine with a virtual screw - <a href="http://aws.amazon.com/ebs/">EBS volume</a> .  S3-backed is a machine without a screw, a heavy legacy of those times when Amazon did not have any EBS yet, and all files had to be stored on S3.  The S3-backed server cannot be turned off (stop) in the evening, and next morning to turn on (start), it can only be destroyed (terminate), and if necessary, a new one (launch) can be created.  All data that has not been saved on S3 is lost.  I didn‚Äôt dig into it deeply, because it‚Äôs much easier to work with EBS-backed AMI, which from the user's point of view is no different from a real car, standing somewhere in the next room. <br><br>  Amazon servers store hundreds of server images to suit all tastes, with virtually any server operating system and a bunch of pre-installed software options.  I chose the <a href="http://aws.amazon.com/amis/4347%3F_encoding%3DUTF8%26jiveRedirect%3D1">official image of bare Ubuntu Server 10.04</a> .  Technically, all these AMIs are <a href="http://ru.wikipedia.org/wiki/Xen">XEN</a> <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D0%25B0%25D1%2580%25D0%25B0%25D0%25B2%25D0%25B8%25D1%2580%25D1%2582%25D1%2583%25D0%25B0%25D0%25BB%25D0%25B8%25D0%25B7%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F">para</a> - <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D0%25B0%25D1%2580%25D0%25B0%25D0%25B2%25D0%25B8%25D1%2580%25D1%2582%25D1%2583%25D0%25B0%25D0%25BB%25D0%25B8%25D0%25B7%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F">virtual</a> machines.  In principle, you can blind such an image from scratch, but for me the server is only a Ruby on Rails stand, so I didn‚Äôt waste my time, and so everything works fine.  Before you start working, install the ec2-api-tools package on your local machine: <code>sudo apt-get install ec2-api-tools</code> . <br><br>  The server is managed via SSH, the user name is ubuntu, the external IP address and domain name are visible on the panel or in the ec2-describe-instances command output, the keys are most easily generated in the AWS Management Console and saved on the local machine (in the sense of , teapots are the easiest, and command line Jedi may be easier to get the keys locally and download to Amazon using the familiar chord.  The Firewall (Security Group) by default closes everything at all, so before trying to connect, you need to open port <nobr>22</nobr> .  If you have a static IP, then for security, you can specify it in the Source (IP or group) field.  To stop the machine when you exit the SSH session, simply write sudo poweroff, and it goes into stopped mode.  If we want it to continue working, we write exit. <br><br><img src="https://habrastorage.org/storage/99f8a700/36c93bd3/38f526b6/4ba57b00.png"><br><br>  The first pitfall to which you immediately need to pay attention - the freebie package includes an EBS-volume of 10 GB, and standard Amazon AMIs have a <nobr>15-gig</nobr> screw onboard by default.  At the same time, the bare system takes less than 1G.  The Internet is full of articles on how to expand the EBS section, but not a single sensible article on how to reduce it.  As a rule, it is proposed to rsync-nut the whole screw on a new smaller section, but after that the system failed to boot.  I found the solution <a href="http://alestic.com/2010/02/ec2-resize-running-ebs-root">somewhere in the comments of a blog</a> .  And here I got on the headstock!  The fact is that <a href="http://ru.wikipedia.org/wiki/Dd">dd</a> I used the first time in my life.  Of course, I forgot to specify the block size (by default - only 512 bytes).  In addition, I had the sense to understand that the system files + 9.3 gigabytes of zeros will be copied for a very long time, and I reduced the size of the file system to 1G.  But to notify dd about this was no longer enough.  And he doesn't care about file systems, and it stopped only when the <nobr>10-gig</nobr> partition ended.  10 gigs in pieces of 512 bytes each is not a joke, but the free monthly I / O limit on EBS volumes is only 1,000,000 pieces.  In addition, in a hurry when launching the second server, I forgot to change the default configuration of the standard AMI (m1.small, what it is - see below) to t1.micro, and this is also not free.  Total: 22 cents per dd and 10 cents - per hour of work m1.small instance. <br><br>  After these manipulations, I saved my own AMI version with a <nobr>10-gig</nobr> screw (one click on the instance context menu).  When creating an AMI, a snapshot of the system is automatically taken.  Actually, AMI is a snapshot, only registered as a virtual machine and having an identifier of the form ami-xxxxxxxx.  Unlike EBS volumes, the payment for which is charged for the full volume regardless of how many files actually occupy, snapshot s are stored compressed and made incrementally.  So they take up very little space on S3.  From one AMI, you can run several instances, each of them will have its own screw, so to keep the application data, for example, the MySQL database, you will immediately need a separate server, but it will already cost money, so for now you can put MySQL on the same machine as the web server.  In the case of a dedicated database server, you can not even bother with the setting, <a href="https://aws.amazon.com/rds/">the Amazon has ready</a> .  Another important point.  When a machine is created, an EBS volume is created, and when it is destroyed (it is terminate, not stop!) It defaults by default.  It is logical - they threw the server out of the rack, the screw also went away.  After all, for every EBS volume, money drips, regardless of whether the machine is turned on or not.  But if you wish, you can get the screw out of the server and <a href="http://docs.amazonwebservices.com/AWSEC2/latest/UserGuide/index.html%3FUsing_ChangeRootDeviceVolumeToPersist.html">keep it</a> . <br><br>  Now more detail about what these m1.small and t1.micro.  Here is a <a href="http://aws.amazon.com/ec2/">list of</a> all available configurations.  T1.micro has one maaaaaa lanky nuance.  Unlike all other types, micro processor resources are variable.  While he is not touched, this is twice as much as m1.small, but under the load he quickly gets tired and falls below the baseboard.  That is, you should not abuse cron-ohm, convert video or try to keep projects with a peak load of more than a few dozen requests per minute on it - it will choke.  It feels like it‚Äôs smartly working for the first few seconds ‚Äî more than enough to process any request to the site, or even several requests at once, but the Ruby interpreter was very, very long to compile.  Small bags like Midnight Commander or small gems are put at lightning speed, the web server runs three times faster than on my ThinkPad X100e.  In my opinion - quite a reasonable compromise.  Here, people drove tests, they write that although it slows down, but for money, <a href="http://blog.documentcloud.org/blog/2010/09/evaluating-amazons-ec2-micro-instances/">micro-instances are one and a half times steeper than small-instance.</a> <br><br>  Having dealt with the server hardware and the system, go to Ruby on Rails.  I somehow didn‚Äôt have a relationship with <a href="http://rvm.beginrescueend.com/">RVM</a> - at first I couldn‚Äôt deliver it, then some gems were buggy, so I installed Ruby 1.9.2-p0 from the sources on my local machine.  I did the same here.  At the same time, my hands finally reached the heap of everything needed to install Rails3 + Ruby 1.9.2 + MySQL on Ubuntu 10.04: <br><br> <code><a href=""></a> sudo apt-get install libxml2 libxml2-dev libxslt1-dev gcc g++ build-essential libssl-dev libreadline5-dev zlib1g-dev linux-headers-generic libsqlite3-dev mysql-server libmysqlclient-dev libmysql-ruby <br> <br> wget ftp.ruby-lang.org//pub/ruby/1.9/ruby-1.9.2-p0.tar.gz <br> tar -xvzf ruby-1.9.2-p0.tar.gz <br> cd ruby-1.9.2-p0/ <br> ./configure ‚Äîprefix=/usr/local/ruby <br> make &amp;&amp; sudo make install <br> <br> export PATH=$PATH:/usr/local/ruby/bin #    .bashrc <br> sudo ln -s /usr/local/ruby/bin/ruby /usr/local/bin/ruby <br> sudo ln -s /usr/local/ruby/bin/gem /usr/bin/gem <br> <br> echo ¬´gem: ‚Äîno-ri ‚Äîno-rdoc¬ª &gt; $HOME/.gemrc <br> sudo gem install tzinfo builder memcache-client rack rack-test erubis mail text-format bundler thor i18n sqlite3-ruby mysql2 rack-mount rails <br> <br> ruby -v <br> rails -v</code> <br> <br>  I got the idea that I would have a real production-server, and prepared to install some Apach, Nginx or Lighttpd, followed by the Mongrel cluster, as written in the clever Rails books.  Not WEBrick, in fact, to drive on a real-present production-server!  We'll have to suffer.  But Phusion Passenger is, as it turned out, not just a passenger who rides Apache and others.  In standalone mode, it includes nginx.  Actually, sudo gem install passenger is all you need to know.  He himself finds where the application is, and runs it without any tinkering in the configs.  <a href="http://www.modrails.com/documentation/Users%2520guide%2520Standalone.html">The user manual</a> simply touches with its conciseness.  DTSTTCPW, however! <br><br>  What is the result?  Now I am gradually moving from the lame typing on the link in the Amazon web-face to ec2-api-tools.  There is basically nothing complicated here - ec2-describe / run / start / stop / terminate-instances, ec2-describe / create / delete-volumes, etc.  The instructions are all sensibly described.  The Amazon <a href="http://calculator.s3.amazonaws.com/calc5.html">price calculator</a> shows that a free package would cost about 20 bucks a month if it were paid.  Own dedicated server, plus the ability to experiment with a datacenter with two dozen servers, firewalls, load balancers and other goodies for a pittance.  The ability to raise any operating system available in the form of a public AMI in a couple of minutes and feel it alive.  The ability to raise and drive a cluster with dozens of cores and hundreds of gigabytes of memory in just a few minutes is just a few dollars per hour.  In short, I am satisfied! <br><br>  upd: When I created AMI from snapshot, I had such a glitch: the instance seemed to start up, but there was no connection.  At the end of the system log there were several lines of this type: <br> <code>modprobe: FATAL: Could not load /lib/modules/2.6.16-xenU/modules.dep: No such file</code> <br>  It turns out that when creating an AMI, you must explicitly specify the kernel, something like this: <br> <code>ec2-register -n image_name -d image_description --root-device-name /dev/sda1 -b /dev/sda1=snap-XXXXXXXX::false --kernel aki-XXXXXXXX</code> <br>  How do I know which kernel image I need?  Start the original, obviously working public instance, on the basis of which you built your server, and see the kernel version in the output of the ec2-describe-instances command </div><p>Source: <a href="https://habr.com/ru/post/109045/">https://habr.com/ru/post/109045/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../109037/index.html">OpenStreetMap website launches new fully rewritten editor Potlatch 2</a></li>
<li><a href="../109039/index.html">HTC Desire HD Android Review: The Hungry Giant</a></li>
<li><a href="../109041/index.html">Code Interface Driven Design</a></li>
<li><a href="../109043/index.html">Last-Modified Heading, Symfony and Search Indexing Acceleration</a></li>
<li><a href="../109044/index.html">Google Earth 6</a></li>
<li><a href="../109046/index.html">Firebug 1.6 release</a></li>
<li><a href="../109049/index.html">#poSEEDelki in December: ideas, motivation, investment</a></li>
<li><a href="../109050/index.html">Increased performance with block caching</a></li>
<li><a href="../109052/index.html">KBookOCR for Linux. FineReader Killer for Linux in its initial stages</a></li>
<li><a href="../109055/index.html">Video with a demonstration of the computer class in the "thin clients" mode</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>