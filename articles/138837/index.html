<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>QML and C ++. A simple example of a bunch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="QML technology is beautiful and pleasing to the eye. She was very interested in me, and I decided to master it. But it was not there, for I was stupid...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>QML and C ++. A simple example of a bunch</h1><div class="post__text post__text-html js-mediator-article"><img src="http://www.harrix.org/files/80/logo.jpg" alt="image"><br>  QML technology is beautiful and pleasing to the eye.  She was very interested in me, and I decided to master it.  But it was not there, for I was stupid and helpless.  Nowhere on the net did I find an example ‚Äúfor dummies‚Äù (I was probably looking bad) to build from scratch the simplest QML and C ++ applications in conjunction.  Everywhere something was missing: either Qt Creator was not taken into account, or the code produced errors, or there were no points that users themselves had to know.  Official documentation and examples here in Habr√© were also with these shortcomings.  So I decided after long attempts and mistakes to write such an article for beginners with a detailed description. <br><br>  <b>Task</b> .  You need to write a QML program in conjunction with C ++, where <br>  1. On the form there is a button, an input line, and an output field. <br>  2. It is required to read a number from the input line, add 1, and the answer is displayed in the output field. <br>  3. The interface is written in QML. <br>  4. Functional in C ++, that is, we need to ensure the relationship between QML and C ++: the QML button calls the C ++ function, and the function changes the properties of QML objects. <br><a name="habracut"></a><br><br><h4>  Creating a basic QML application </h4><br>  We use Qt Creator.  I used version 2.3 with Qt 4.7.4 <br><img src="http://www.harrix.org/files/78/qtcreator.png" alt="image"><br><h5>  Creating a QML Application </h5><br>  <b>1.</b> Create a GUI Application: <b>File -&gt; New File or Project ....</b>  There, on the left, select the <b>Qt Widget Project</b> , with the right <b>Qt GUI application</b> .  Then click below the button " <b>Select ...</b> ". <br><img src="http://www.harrix.org/files/78/gui.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>2.</b> In the next window, select the name of our project (without spaces and Russian letters).  For example, in our case it is " <b>Example</b> ". <br><img src="http://www.harrix.org/files/78/nameproject.png"><br><br>  <b>3.</b> In the next window, you should have a tick near " <b>Desktop</b> ".  If you do not have it, then you have installed Qt Creator incorrectly (or you do not intend to create desktop applications).  That Qt Creator official build, which I installed (2.3), for some reason did not install the desktop parts by default. <br><img src="http://www.harrix.org/files/78/desktop.png"><br><br>  <b>4.</b> In the next window, <b>uncheck</b> " <b>Create form</b> ". <br><img src="http://www.harrix.org/files/78/nonform.png"><br><br>  <b>5.</b> In the next window, you can not change anything.  And click the " <b>Finish</b> " button. <br><img src="http://www.harrix.org/files/78/control.png"><br><br><h5>  Editing the project file </h5><br><br>  <b>6.</b> Edit the project file (we have <b>Example.pro here</b> ): <br><img src="http://www.harrix.org/files/78/pro.png"><br><br>  And add to the line " <b>QT + = core gui</b> " the word " <b>declarative</b> ".  As a result, we get the line: <br><br><pre><code class="cpp hljs">QT += core gui declarative</code> </pre> <br><br><h5>  Creating a QML project </h5><br>  <b>7.</b> On the folder with the project in Qt Creator, right-click and go to the item " <b>Add a new ...</b> " <br><img src="http://www.harrix.org/files/78/pr.png"><br><br>  <b>8.</b> Select " <b>QML</b> " on the left and " <b>QML</b> <b>file</b> " on the right. <br><img src="http://www.harrix.org/files/78/newqml.png"><br><br>  <b>9.</b> Call it " <b>main</b> ". <br><img src="http://www.harrix.org/files/78/nameqml.png"><br><br>  <b>10.</b> The next window is unchanged. <br><img src="http://www.harrix.org/files/78/newqml2.png"><br><br>  <b>11.</b> As a result, we get the file "main.qml" with the text: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> QtQuick <span class="hljs-number"><span class="hljs-number">1.0</span></span> Rectangle { width: <span class="hljs-number"><span class="hljs-number">100</span></span> height: <span class="hljs-number"><span class="hljs-number">62</span></span> }</code> </pre> <br><br><h5>  Create a resource file </h5><br>  <b>12.</b> On the folder with the project in Qt Creator, right-click and go to the item " <b>Add a new ...</b> " <br><br><img src="http://www.harrix.org/files/78/pr2.png"><br><br>  <b>13.</b> Select " <b>Qt</b> " on the left and " <b>Qt</b> <b>Resource File</b> " on the right. <br><img src="http://www.harrix.org/files/78/newr.png"><br><br>  <b>14.</b> Call it <b>res</b> . <br><img src="http://www.harrix.org/files/78/namer.png"><br><br>  <b>15.</b> The next window is unchanged. <br><img src="http://www.harrix.org/files/78/newr2.png"><br><br>  As a result, we get the file " <b>res.qrc</b> " <br><br>  <b>16.</b> Add the prefix.  To do this, click on the " <b>Add</b> " button, and then click " <b>Add prefix</b> ". <br><img src="http://www.harrix.org/files/78/addr.png"><br><br>  <b>17.</b> Change the prefix text to " <b>/</b> ". <br><img src="http://www.harrix.org/files/78/addr2.png"><br><br>  <b>18.</b> Add our QML file.  To do this, click on the " <b>Add</b> " button, and then click " <b>Add files</b> ". <br><img src="http://www.harrix.org/files/78/addr3.png"><br><br>  <b>19.</b> And choose our file " <b>main.qml</b> ".  And the file will be added to the resources of our application: <br><img src="http://www.harrix.org/files/78/addr4.png"><br><br>  If we now run our application, we will not see qml yet: <br><img src="http://www.harrix.org/files/78/first.png"><br><br><h5>  Source Editing </h5><br>  Now let's do the qml connection to make it work. <br><br>  <b>20.</b> We proceed to editing the file " <b>mainwindow.h</b> " (located in the header).  It looks like: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAINWINDOW_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAINWINDOW_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QtGui/QMainWindow&gt; class MainWindow : public QMainWindow { Q_OBJECT public: MainWindow(QWidget *parent = 0); ~MainWindow(); }; #endif // MAINWINDOW_H</span></span></span></span></code> </pre> <br><br>  Change it to this view: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAINWINDOW_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAINWINDOW_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QMainWindow&gt; #include &lt;QtDeclarative/QDeclarativeView&gt; #include &lt;QGraphicsObject&gt; #include &lt;QtGui&gt; #include &lt;QDeclarativeContext&gt; namespace Ui { class MainWindow; } class MainWindow : public QMainWindow { Q_OBJECT public: explicit MainWindow(QWidget *parent = 0); ~MainWindow(); private: QDeclarativeView *ui; }; #endif // MAINWINDOW_H</span></span></span></span></code> </pre><br><br>  We added <b>#include &lt;QtDeclarative / QDeclarativeView&gt;</b> , <b>#include &lt;QGraphicsObject&gt;</b> and others, added a <b>namespace</b> , added the keyword <b>explicit</b> , and most importantly added <b>QDeclarativeView * ui</b> . <br><br>  <b>21.</b> Now let's edit the <b>mainwindow.cpp</b> file.  It looks like: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"mainwindow.h"</span></span></span><span class="hljs-meta"> MainWindow::MainWindow(QWidget *parent) : QMainWindow(parent) { } MainWindow::~MainWindow() { }</span></span></code> </pre><br><br>  Change to this: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"mainwindow.h"</span></span></span><span class="hljs-meta"> MainWindow::MainWindow(QWidget *parent) : QMainWindow(parent) { </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//  QML ui = new QDeclarativeView; ui-&gt;setSource(QUrl("qrc:/main.qml")); setCentralWidget(ui); ui-&gt;setResizeMode(QDeclarativeView::SizeRootObjectToView); } MainWindow::~MainWindow() { // QML delete ui; }</span></span></span></span></code> </pre> <br><br>  <b>22.</b> Run our application and get a white window.  Our QML is working. <br><img src="http://www.harrix.org/files/78/great.png"><br><br><h4>  Writing application </h4><br>  Now we can proceed to writing the application itself, which will solve our problem. <br><br><h5>  Build interface. </h5><br>  <b>23.</b> At the moment, <b>main.qml</b> looks like this: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">import</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">QtQuick</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Rectangle</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> height: <span class="hljs-number"><span class="hljs-number">62</span></span> }</code> </pre> <br><br><img src="http://www.harrix.org/files/80/qml.png"><br><br>  Edit it by changing the main window rectangle: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">import</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">QtQuick</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> //  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Rectangle</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">300</span></span> height: <span class="hljs-number"><span class="hljs-number">300</span></span> anchors.fill: parent }</code> </pre> <br><br>  <b>24.</b> Add a simple button to our form. <br><br><pre> <code class="css hljs"> // <span class="hljs-selector-tag"><span class="hljs-selector-tag">Rectangle</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">id</span></span>: button //  //   x: parent.width / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.width / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">y</span></span>: parent.height / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.height / <span class="hljs-number"><span class="hljs-number">2</span></span>; //  <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> height: <span class="hljs-number"><span class="hljs-number">30</span></span> //  color: <span class="hljs-string"><span class="hljs-string">"gray"</span></span> //  Text { id: buttonLabel text: <span class="hljs-string"><span class="hljs-string">""</span></span> anchors.centerIn: parent; } //  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MouseArea</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">anchors.fill</span></span>: parent id: mouseArea } }</code> </pre> <br><br>  As a result, <b>main.qml</b> will look like this: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">import</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">QtQuick</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Rectangle</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">300</span></span> height: <span class="hljs-number"><span class="hljs-number">300</span></span> anchors.fill: parent // Rectangle { id: button //  //   x: parent.width / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.width / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">y</span></span>: parent.height / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.height / <span class="hljs-number"><span class="hljs-number">2</span></span>; //  <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> height: <span class="hljs-number"><span class="hljs-number">30</span></span> //  color: <span class="hljs-string"><span class="hljs-string">"gray"</span></span> //  Text { id: buttonLabel text: <span class="hljs-string"><span class="hljs-string">""</span></span> anchors.centerIn: parent; } //  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MouseArea</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">anchors.fill</span></span>: parent id: mouseArea } } }</code> </pre> <br><br>  If we run the application, <br><img src="http://www.harrix.org/files/80/run.png"><br>  then we get the following: <br><img src="http://www.harrix.org/files/80/ex01.png"><br><br>  <b>25.</b> Add an input line where the user will enter information with the name <b>textinput</b> . <br><br><pre> <code class="css hljs">//  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Rectangle</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">id</span></span>: textinputRect //   //  x: parent.width / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.width / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">y</span></span>: parent.height / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.height / <span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">40</span></span>; //   <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> height: <span class="hljs-number"><span class="hljs-number">18</span></span> //   color: <span class="hljs-string"><span class="hljs-string">"gray"</span></span> TextInput { id: textinput objectName: <span class="hljs-string"><span class="hljs-string">"textinput"</span></span> color: <span class="hljs-string"><span class="hljs-string">"#151515"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">selectionColor</span></span>: <span class="hljs-string"><span class="hljs-string">"blue"</span></span> font.pixelSize: <span class="hljs-number"><span class="hljs-number">12</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: parent.width-<span class="hljs-number"><span class="hljs-number">4</span></span> anchors.centerIn: parent focus: true text:<span class="hljs-string"><span class="hljs-string">"1"</span></span> } }</code> </pre> <br><br>  As a result, <b>main.qml</b> will look like this: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">import</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">QtQuick</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Rectangle</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">300</span></span> height: <span class="hljs-number"><span class="hljs-number">300</span></span> anchors.fill: parent // Rectangle { id: button //  //   x: parent.width / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.width / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">y</span></span>: parent.height / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.height / <span class="hljs-number"><span class="hljs-number">2</span></span>; //  <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> height: <span class="hljs-number"><span class="hljs-number">30</span></span> //  color: <span class="hljs-string"><span class="hljs-string">"gray"</span></span> //  Text { id: buttonLabel text: <span class="hljs-string"><span class="hljs-string">""</span></span> anchors.centerIn: parent; } //  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MouseArea</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">anchors.fill</span></span>: parent id: mouseArea } } //  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Rectangle</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">id</span></span>: textinputRect //   //  x: parent.width / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.width / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">y</span></span>: parent.height / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.height / <span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">40</span></span>; //   <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> height: <span class="hljs-number"><span class="hljs-number">18</span></span> //   color: <span class="hljs-string"><span class="hljs-string">"gray"</span></span> TextInput { id: textinput objectName: <span class="hljs-string"><span class="hljs-string">"textinput"</span></span> color: <span class="hljs-string"><span class="hljs-string">"#151515"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">selectionColor</span></span>: <span class="hljs-string"><span class="hljs-string">"blue"</span></span> font.pixelSize: <span class="hljs-number"><span class="hljs-number">12</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: parent.width-<span class="hljs-number"><span class="hljs-number">4</span></span> anchors.centerIn: parent focus: true text:<span class="hljs-string"><span class="hljs-string">"1"</span></span> } } }</code> </pre> <br>  Note the following: <ul><li>  In order for us to access the input string from C ++, in addition to the <b>id</b> parameter, there is also an <b>objectName</b> parameter, which is enclosed in double quotes. </li><li>  The information that we will need later is contained in the <b>text</b> parameter. </li></ul><br><br>  At startup, we get the following: <br><img src="http://www.harrix.org/files/80/ex02.png"><br><br>  <b>26.</b> Add an output field where the program will display the answer with the name <b>memo</b> . <br><br><pre> <code class="css hljs"> //  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Rectangle</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">id</span></span>: memoRect //   //  x: parent.width / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.width / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">y</span></span>: parent.height / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.height / <span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">70</span></span>; //   <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> height: <span class="hljs-number"><span class="hljs-number">35</span></span> //   color: <span class="hljs-string"><span class="hljs-string">"gray"</span></span> TextEdit{ id: memo objectName: <span class="hljs-string"><span class="hljs-string">"memo"</span></span> wrapMode: TextEdit.Wrap width:parent.width; <span class="hljs-attribute"><span class="hljs-attribute">readOnly</span></span>:true } }</code> </pre> <br><br>  As a result, <b>main.qml</b> will look like this: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">import</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">QtQuick</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Rectangle</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">300</span></span> height: <span class="hljs-number"><span class="hljs-number">300</span></span> anchors.fill: parent // Rectangle { id: button //  //   x: parent.width / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.width / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">y</span></span>: parent.height / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.height / <span class="hljs-number"><span class="hljs-number">2</span></span>; //  <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> height: <span class="hljs-number"><span class="hljs-number">30</span></span> //  color: <span class="hljs-string"><span class="hljs-string">"gray"</span></span> //  Text { id: buttonLabel text: <span class="hljs-string"><span class="hljs-string">""</span></span> anchors.centerIn: parent; } //  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MouseArea</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">anchors.fill</span></span>: parent id: mouseArea } } //  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Rectangle</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">id</span></span>: textinputRect //   //  x: parent.width / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.width / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">y</span></span>: parent.height / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.height / <span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">40</span></span>; //   <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> height: <span class="hljs-number"><span class="hljs-number">18</span></span> //   color: <span class="hljs-string"><span class="hljs-string">"gray"</span></span> TextInput { id: textinput objectName: <span class="hljs-string"><span class="hljs-string">"textinput"</span></span> color: <span class="hljs-string"><span class="hljs-string">"#151515"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">selectionColor</span></span>: <span class="hljs-string"><span class="hljs-string">"blue"</span></span> font.pixelSize: <span class="hljs-number"><span class="hljs-number">12</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: parent.width-<span class="hljs-number"><span class="hljs-number">4</span></span> anchors.centerIn: parent focus: true text:<span class="hljs-string"><span class="hljs-string">"1"</span></span> } } //  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Rectangle</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">id</span></span>: memoRect //   //  x: parent.width / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.width / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">y</span></span>: parent.height / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.height / <span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">70</span></span>; //   <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> height: <span class="hljs-number"><span class="hljs-number">35</span></span> //   color: <span class="hljs-string"><span class="hljs-string">"gray"</span></span> TextEdit{ id: memo objectName: <span class="hljs-string"><span class="hljs-string">"memo"</span></span> wrapMode: TextEdit.Wrap width:parent.width; <span class="hljs-attribute"><span class="hljs-attribute">readOnly</span></span>:true } } }</code> </pre><br><br>  At startup, we get the following: <br><img src="http://www.harrix.org/files/80/ex03.png"><br><br>  So, we have described the interface of our program. <br><br><h5>  C ++ part </h5><br>  <b>27.</b> When you press a button, nothing happens.  Fix it.  First, let's establish the relationship between the QML model and C ++ code.  To do this, edit the <b>mainwindow.cpp</b> file, namely the <b>MainWindow</b> function, adding the lines: <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">//   Root = ui-&gt;rootObject(); // C++  QML,    ++   window ui-&gt;rootContext()-&gt;setContextProperty("window", this);</span></span></code> </pre> <br><br>  We get the following: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"mainwindow.h"</span></span></span><span class="hljs-meta"> MainWindow::MainWindow(QWidget *parent) : QMainWindow(parent) { </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//  QML ui = new QDeclarativeView; ui-&gt;setSource(QUrl("qrc:/main.qml")); setCentralWidget(ui); ui-&gt;setResizeMode(QDeclarativeView::SizeRootObjectToView); //   Root = ui-&gt;rootObject(); // C++  QML,    ++   window ui-&gt;rootContext()-&gt;setContextProperty("window", this); } MainWindow::~MainWindow() { // QML delete ui; }</span></span></span></span></code> </pre> <br><br>  <b>28.</b> In the added code, we have an undeclared variable <b>Root</b> .  Through it, we will then search for all other children.  <b>Let's</b> declare it in <b>mainwindow.h</b> in the class in the private section: <br><br><pre> <code class="cpp hljs">QObject *Root;<span class="hljs-comment"><span class="hljs-comment">//  QML </span></span></code> </pre> <br><br>  As a result, we get: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAINWINDOW_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAINWINDOW_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QMainWindow&gt; #include &lt;QtDeclarative/QDeclarativeView&gt; #include &lt;QGraphicsObject&gt; #include &lt;QtGui&gt; #include &lt;QDeclarativeContext&gt; namespace Ui { class MainWindow; } class MainWindow : public QMainWindow { Q_OBJECT public: explicit MainWindow(QWidget *parent = 0); ~MainWindow(); private: QDeclarativeView *ui; QObject *Root;//  QML  }; #endif // MAINWINDOW_H</span></span></span></span></code> </pre> <br><br>  <b>29.</b> Let our QML button call the C ++ function under an arbitrary name <b>FunctionC</b> .  <b>Let's</b> declare it in <b>mainwindow.h</b> in the class in the public section: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Q_INVOKABLE </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FunctionC</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;<span class="hljs-comment"><span class="hljs-comment">// C++   QML</span></span></code> </pre> <br><br>  As a result, we get: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAINWINDOW_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAINWINDOW_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QMainWindow&gt; #include &lt;QtDeclarative/QDeclarativeView&gt; #include &lt;QGraphicsObject&gt; #include &lt;QtGui&gt; #include &lt;QDeclarativeContext&gt; namespace Ui { class MainWindow; } class MainWindow : public QMainWindow { Q_OBJECT public: explicit MainWindow(QWidget *parent = 0); ~MainWindow(); Q_INVOKABLE void FunctionC();// C++   QML private: QDeclarativeView *ui; QObject *Root;//  QML  }; #endif // MAINWINDOW_H</span></span></span></span></code> </pre> <br><br>  Notice the <b>Q_INVOKABLE</b> keyword.  This is what makes the function for QML visible. <br><br>  <b>30.</b> Now we describe our function in <b>mainwindow.cpp</b> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> MainWindow::FunctionC() { <span class="hljs-comment"><span class="hljs-comment">//   QObject* textinput = Root-&gt;findChild&lt;QObject*&gt;("textinput"); //   QObject* memo = Root-&gt;findChild&lt;QObject*&gt;("memo"); QString str;//    //       text str=(textinput-&gt;property("text")).toString(); int a; a=str.toInt();//    a++;//   1 QString str2;//     str2=QString::number(a);//    //         memo-&gt;setProperty("text", str+"+1="+str2); }</span></span></code> </pre> <br><br>  <b>31.</b> Finally, add our function in the handler of our QML button in the <b>main.qml</b> file.  The mouse action handler now looks like this: <br><br><pre> <code class="css hljs">//  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MouseArea</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">anchors.fill</span></span>: parent id: mouseArea }</code> </pre> <br><br>  Now it will become like this: <br><br><pre> <code class="css hljs"> //  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MouseArea</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">anchors.fill</span></span>: parent id: mouseArea //    window.<span class="hljs-built_in"><span class="hljs-built_in">FunctionC</span></span>() onClicked: window.<span class="hljs-built_in"><span class="hljs-built_in">FunctionC</span></span>() }</code> </pre> <br><br>  As a result, we get: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">import</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">QtQuick</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Rectangle</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">300</span></span> height: <span class="hljs-number"><span class="hljs-number">300</span></span> anchors.fill: parent // Rectangle { id: button //  //   x: parent.width / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.width / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">y</span></span>: parent.height / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.height / <span class="hljs-number"><span class="hljs-number">2</span></span>; //  <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> height: <span class="hljs-number"><span class="hljs-number">30</span></span> //  color: <span class="hljs-string"><span class="hljs-string">"gray"</span></span> //  Text { id: buttonLabel text: <span class="hljs-string"><span class="hljs-string">""</span></span> anchors.centerIn: parent; } //  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MouseArea</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">anchors.fill</span></span>: parent id: mouseArea //    window.<span class="hljs-built_in"><span class="hljs-built_in">FunctionC</span></span>() onClicked: window.<span class="hljs-built_in"><span class="hljs-built_in">FunctionC</span></span>() } } //  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Rectangle</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">id</span></span>: textinputRect //   //  x: parent.width / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.width / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">y</span></span>: parent.height / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.height / <span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">40</span></span>; //   <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> height: <span class="hljs-number"><span class="hljs-number">18</span></span> //   color: <span class="hljs-string"><span class="hljs-string">"gray"</span></span> TextInput { id: textinput objectName: <span class="hljs-string"><span class="hljs-string">"textinput"</span></span> color: <span class="hljs-string"><span class="hljs-string">"#151515"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">selectionColor</span></span>: <span class="hljs-string"><span class="hljs-string">"blue"</span></span> font.pixelSize: <span class="hljs-number"><span class="hljs-number">12</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: parent.width-<span class="hljs-number"><span class="hljs-number">4</span></span> anchors.centerIn: parent focus: true text:<span class="hljs-string"><span class="hljs-string">"1"</span></span> } } //  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Rectangle</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">id</span></span>: memoRect //   //  x: parent.width / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.width / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">y</span></span>: parent.height / <span class="hljs-number"><span class="hljs-number">2</span></span> - button.height / <span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">70</span></span>; //   <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> height: <span class="hljs-number"><span class="hljs-number">35</span></span> //   color: <span class="hljs-string"><span class="hljs-string">"gray"</span></span> TextEdit{ id: memo objectName: <span class="hljs-string"><span class="hljs-string">"memo"</span></span> wrapMode: TextEdit.Wrap width:parent.width; <span class="hljs-attribute"><span class="hljs-attribute">readOnly</span></span>:true } } }</code> </pre> <br><br>  Notice that we call the function through the <b>window</b> . <br><br>  That's all!  Now run the program and click on the button.  If you did everything correctly and I made no mistakes, then you will see: <br><br><img src="http://www.harrix.org/files/80/ex04.png" alt="null" title="null"><br><br>  Link to source: <a href="">Download</a> . <br>  Link to executable file: <a href="">Download</a> . </div><p>Source: <a href="https://habr.com/ru/post/138837/">https://habr.com/ru/post/138837/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../138828/index.html">Golden rules of a successful button</a></li>
<li><a href="../138830/index.html">Shared hosting for Django (FreeBSD + Apache + mod_python / mod_wsgi)</a></li>
<li><a href="../138833/index.html">An inside look: LCD and E-Ink displays</a></li>
<li><a href="../138834/index.html">The first public build of PhpStorm 4.0 has been released.</a></li>
<li><a href="../138836/index.html">The 25 billionth download Apple App will receive a gift of $ 10,000</a></li>
<li><a href="../138842/index.html">Ranking pages by importance for the online store</a></li>
<li><a href="../138844/index.html">The main problems of the project manager and how to deal with them</a></li>
<li><a href="../138845/index.html">Do I really use the social network Google +? (poll)</a></li>
<li><a href="../138847/index.html">Opera import problem solving importScripts ()</a></li>
<li><a href="../138848/index.html">Performance: LINQ to XML vs XmlDocument vs XmlReader on Desktop and Windows Phone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>