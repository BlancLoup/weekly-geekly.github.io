<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A hybrid way to display data on google maps</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article describes how to display data on interactive maps (maps.google.com, maps.yandex.ru). 

 In the posts of highly respected Kashey , the met...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A hybrid way to display data on google maps</h1><div class="post__text post__text-html js-mediator-article">  This article describes how to display data on interactive maps (maps.google.com, maps.yandex.ru). <br><a name="habracut"></a><br>  In the posts of highly respected <a href="https://geektimes.ru/users/kashey/" class="user_link">Kashey</a> , the method of displaying objects on maps was discussed <a href="http://habrahabr.ru/blogs/personal/98597/">here</a> and <a href="http://habrahabr.ru/blogs/google/38408/">here</a> . <br><br>  Having studied this method, I started its implementation for the largest automotive resource. <br>  In November, when most of the code was written, an unexpected thing happened - Google launched a map service, in which pictures (tiles) of maps with search results were formed on the fly. <br><img src="https://habrastorage.org/getpro/geektimes/post_images/4be/c87/595/4bec875950dc5a66b157213b6318ad12.jpg" alt="image"><br>  I called this technology ‚Äúacne technology‚Äù - search results are displayed with small red dots applied directly to the png-image, which is a separate layer on top of the map layer.  You can see <a href="http://maps.google.com/maps%3Ff%3Dq%26source%3Ds_q%26hl%3Dru%26geocode%3D%26q%3D%25D0%25BE%25D0%25B1%25D1%2583%25D0%25B2%25D1%258C%26aq%3D%26sll%3D55.746439,37.563629%26sspn%3D0.210247,0.727158%26ie%3DUTF8%26hq%3D%25D0%25BE%25D0%25B1%25D1%2583%25D0%25B2%25D1%258C%26hnear%3D%26ll%3D55.746439,37.563629%26spn%3D0.216043,0.727158%26z%3D11%2522">here</a> . <br>  Displaying data as a separate layer has long been used, for example, on wikimapia.org.  The main breakthrough of Google was that images with "acne" are formed "on the fly" and are not cached on the server.  This requires large server costs. <br>  I conducted my tests, and found out that the modern server draws up to 160 tiles per second.  Comparing the load, it became clear that one server can serve no more than a hundred of simultaneously connected users, which is extremely small.  Moreover, the technology also has several significant drawbacks: <br><ul><li>  a large number of server requests (for each tile) </li><li>  the need to select objects for display for each request for a tile </li></ul><br>  At the same time there is an important plus - the ability to display a large number of objects without "clustering" and the load on the client and the browser's DOM. <br>  By the way, in the newly launched realty.yandex.ru maps are made just on the DOM (that is, each marker is a DIV).  Therefore it turns out like <a href="http://realty.yandex.ru/-/C6B1aiT">this</a> <br>  Walk around the map ... <br><br>  As a result of subsequent surveys, the so-called  "Hybrid" system. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The essence of the ‚Äúhybrid‚Äù is that, depending on the capabilities of the browser (of course, we are talking about ie), its own way of displaying data is used. <br>  For example, all modern browsers (except ie up to version 9) support the canvas tag. <br>  For these browsers, I applied the technology of drawing a layer with objects directly on the client. <br>  Thus, when moving / zooming a card, only 1 server request occurs.  After receiving the data, the browser itself draws a layer. <br>  The second way to display - for ie8 and some other browsers - uses dataUrl.  Again for each movement - 1 request.  Pictures are drawn on the server and sent with the data in one xml file. <br>  To date, such requests - about 18%.  it is clear that gradually the percentage will decrease. <br>  The third way is classic.  First, data is transmitted, and then images are requested - for each image, your request.  This is for ie 7 and below.  There are about 6%.  This method is used in Google Maps. <br><br>  In total, using such a hybrid, we received a decrease in the number of requests compared to the ‚Äúclassics‚Äù by 4 times, the load on the server ‚Äî also almost 4 times. <br><br>  Now on my maps, a maximum of 100 objects per tile are displayed.  With an average window size, this is up to 2400 "acne." <br><br><h3>  Sampling and caching </h3><br>  Separately, the problem with data retrieval was solved. <br>  If everything were simple and it was necessary to display only data for several previously known categories, there would be no point in making a garden.  But the problem was that the output was on the keywords in the search box.  Of course, for this hooked up sphinx. <br><br>  But the problem was different: <br>  Every time you move the map, you need to re-form the request, run it through the parser and sphinx, then get the dots through mysql ... You need to simplify it somehow ... <br>  As a result, a php caching engine was created using memcache. <br>  Everything happens as follows: <br>  The server receives a search string (for example, ‚ÄúAudi dealers‚Äù), parses it and sends it to sphinx.  Sphinx gives the search result, then a mysql request for getting points is formed and executed.  All received points are packed and sent to memekash. <br>  So, for 10,000 points found, the cache size is about 1mb.  As planned - this is the maximum size. <br>  Further, when the map requests for points, data is loaded from memcache and very quickly searched. <br>  Very quickly - this is up to 0.02 seconds at 10,000 points.  In the caching class, only native php functions are used for the samples, no cycles with enumeration of values, etc. <br>  Cash lives no more than 3 minutes.  If the cache does not contain the necessary data, the request is again formed, executed and cached.  To do this, a search string is duplicated in the request for the tile and data for the map. <br><br>  In general, the cache class provides the possibility of caching in various ways, including disk caching.  For the case when you need to use not a search box, but a menu with categories, various lists and daws.  If the number of types of requests will be finite, this method will do. <br><br><h3>  Markers </h3><br>  The server-class managing the cards accepts a sprite with markers and their descriptions upon initialization. <br>  Description is the size, position in sprite, anchor, shadow, etc. <br>  Accordingly, in the sprite you can fill a very large number of markers and use them all on the map.  The size of the marker for my system is up to 200x200, which is more than enough. <br>  When transferring data to the engine, for each point you can set your own marker (from sprite) with a shadow and hover.  And it will be displayed (in one of 3 ways). <br><br><h3>  Map levels </h3><br>  It was decided to use 3 levels of maps - country, region, city.  At the ‚Äúcountry‚Äù level we show markers of regional capitals, at the level of ‚Äúregion‚Äù - cities, ‚Äúcity‚Äù - points (‚Äúacne‚Äù). <br>  The number of levels is governed by the settings. <br><br>  But what about Yandex? <br>  In the written engine with small conversions, you can build in support for Yandex cards. <br>  But such a task was not set, therefore it was not implemented. <br><br>  To date, the project has been written at 80%, but the main ideas have already been implemented. <br>  You can see here <a href="http://russia.auto.ru/">russia.auto.ru</a> <br>  and here <a href="http://club-lexus.ru/partners/index.php%3Fcity%3D1%26mode%3Dcitymap">club-lexus.ru/partners/index.php?city=1&amp;mode=citymap</a> </div><p>Source: <a href="https://habr.com/ru/post/115198/">https://habr.com/ru/post/115198/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../115187/index.html">Microsoft has sold over 10 million Kinect systems, setting a new Guinness World Record</a></li>
<li><a href="../115188/index.html">Ubuntu refuses Netbook Edition</a></li>
<li><a href="../115190/index.html">Mozilla Firefox 4 release candidate released</a></li>
<li><a href="../115194/index.html">Facebook began to pay attention to the psychological state of its users.</a></li>
<li><a href="../115195/index.html">ASP.NET Image Sprites made easy by NuGet</a></li>
<li><a href="../115199/index.html">How do web studios make money on affiliate programs of SaaS services?</a></li>
<li><a href="../115200/index.html">What is not protected by copyright?</a></li>
<li><a href="../115201/index.html">Error updating Windows 7 SP1 fatal error c0000034</a></li>
<li><a href="../115202/index.html">Sberbank Online Homepage Design Contest</a></li>
<li><a href="../115203/index.html">Blekko banned 1.1 million sites</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>