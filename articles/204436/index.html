<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Aggregator Architecture: Web Services Patterns (Part 1)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today, many web applications and services have been created that have the same goal, but a different approach to execution. Since the information is s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Aggregator Architecture: Web Services Patterns (Part 1)</h1><div class="post__text post__text-html js-mediator-article">  Today, many web applications and services have been created that have the same goal, but a different approach to execution.  Since the information is scattered across the network, users have to visit many similar services in order to increase the effect of the work.  For example, the customer wants to place the task on the tender site.  In order to increase the number of applications submitted, he spends time on repetitive work: creating an offer and filling out project data on various freelance exchanges.  There are sites aggregators that are trying to solve this problem, but their support is becoming increasingly difficult with the emergence of new services theme aggregator.  It is necessary to integrate all new functions and data structures that differ from service to service.  Fortunately, we are not the first to create and maintain such things: there are already patterns that simplify the support of such applications and allow you to create a flexible architecture.  In this article I would like to give an example of the architecture of the aggregator, which allows you to combine the tender platforms for freelancers - such as Odesk, Freelancer, Elance and others. <br><br>  The main problems faced by developers: <br><a name="habracut"></a><br><ol><li>  Different principles of working with services: some of them provide an API, and others have to work through a bot - imitating human actions. </li><li>  Heterogeneity of responses from services ‚Äî some return json, others xml, and others return a web page. </li><li>  Stem from 2 - heterogeneity of data structures - for example, the structure of a Project object <br>  c freelancer looks like this: <br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xml-result</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://api.freelancer.com/schemas/xml-0.1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>588582<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>sign design web software<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://www.sandbox.freelancer.com/projects/PHP-ASP/sign-design-web-software.html<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">buyer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://www.sandbox.freelancer.com/users/1353095.html<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>1353095<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">username</span></span></span><span class="hljs-tag">&gt;</span></span>billk89<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">username</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">buyer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">short_descr</span></span></span><span class="hljs-tag">&gt;</span></span>Create and upload sign design web software for our client nlsigndesign.com Public internet users must be able to create there own signs online, then save and submit as a file. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">short_descr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jobs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">job</span></span></span><span class="hljs-tag">&gt;</span></span>PHP<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">job</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jobs</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xml-result</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  while Odesk responds as follows: <br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">response</span></span></span><span class="hljs-tag">&gt;</span></span> .... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">profile</span></span></span><span class="hljs-tag">&gt;</span></span> .... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">buyer</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cnt_assignments</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cnt_assignments</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">op_contract_date</span></span></span><span class="hljs-tag">&gt;</span></span>December 18, 2011<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">op_contract_date</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">timezone</span></span></span><span class="hljs-tag">&gt;</span></span>Russia (UTC+06)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">timezone</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">buyer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">op_title</span></span></span><span class="hljs-tag">&gt;</span></span>A social network client app for iPhone/iPad<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">op_title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ciphertext</span></span></span><span class="hljs-tag">&gt;</span></span>~~05d405f2d5b8eb27<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ciphertext</span></span></span><span class="hljs-tag">&gt;</span></span> .... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">op_required_skills</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">op_required_skill</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">skill</span></span></span><span class="hljs-tag">&gt;</span></span>ipad,ui-design,iphone-development<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">skill</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">op_required_skill</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">op_required_skills</span></span></span><span class="hljs-tag">&gt;</span></span> .... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">op_desc_digest</span></span></span><span class="hljs-tag">&gt;</span></span> Hello, We need a social network client app for iPhone/iPad to be developed. It should support Facebook, Twitter and Linked-In. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">op_desc_digest</span></span></span><span class="hljs-tag">&gt;</span></span> .... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">profile</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">response</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></li></ol><br>  For ease of understanding, I decided to describe the solution to each of the problems in a separate article.  In this article I will show how to unify work with various services using the example of two popular freelance exchanges Odesk and Freelancer.  The source code is written in PHP5 using the Yii framework. <br><br><h4>  We create the interface </h4><br>  So, the first thing that needs to be done is to create an interface in order to hide the implementation in each particular class and give the opportunity to call a single set of methods for various services. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">authorize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getServiceName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCredential</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ModelCredential $credential)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">searchProjects</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre><br><br><h4>  Create service adapters </h4><br>  Further, for each service we create service adapters (a variation of the <a href="http://en.wikipedia.org/wiki/Adapter_pattern">‚ÄúAdapter‚Äù</a> pattern applied to web services) that will implement this interface.  Both classes work with services through the API, but hide the difference in the implementation of calls. <br><br>  Freelancer Service Adapter: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FreelancerService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_serviceName = <span class="hljs-string"><span class="hljs-string">'freelancer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_service = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ModelCredential $credential = null)</span></span></span><span class="hljs-function"> </span></span>{ Yii::import(<span class="hljs-string"><span class="hljs-string">'ext.freelancer-api-wrapper.*'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_service = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Freelancer(Yii::app()-&gt;params[<span class="hljs-string"><span class="hljs-string">'freelancer'</span></span>][<span class="hljs-string"><span class="hljs-string">'token'</span></span>],Yii::app()-&gt;params[<span class="hljs-string"><span class="hljs-string">'freelancer'</span></span>][<span class="hljs-string"><span class="hljs-string">'secret'</span></span>], <span class="hljs-string"><span class="hljs-string">'http://geeks-board.local/authorizeService/freelancer/?'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($credential !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setCredential($credential); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">authorize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'oauth_token'</span></span>])) { $requestToken = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_service-&gt;requestRequestToken(); $redirectUrl = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_service-&gt;getRedirectUrl($requestToken); header(<span class="hljs-string"><span class="hljs-string">'Location: '</span></span> . $redirectUrl); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $oauth_verifier = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_service-&gt;getRequestTokenVerifier($_GET[<span class="hljs-string"><span class="hljs-string">'oauth_token'</span></span>]); $auth = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_service-&gt;requestAccessToken($oauth_verifier,$_GET[<span class="hljs-string"><span class="hljs-string">'oauth_token'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_service-&gt;oauth-&gt;setToken($auth[<span class="hljs-string"><span class="hljs-string">'oauth_token'</span></span>],$auth[<span class="hljs-string"><span class="hljs-string">'oauth_token_secret'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_service-&gt;auth = $auth; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $auth; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getServiceName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCredential</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ModelCredential $credential)</span></span></span><span class="hljs-function"> </span></span>{ .... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">searchProjects</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... } }</code> </pre><br><br>  Odesk Service Adapter: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OdeskService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_serviceName = <span class="hljs-string"><span class="hljs-string">'odesk'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_service = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ModelCredential $credential = null)</span></span></span><span class="hljs-function"> </span></span>{ Yii::import(<span class="hljs-string"><span class="hljs-string">'ext.odesk-api.*'</span></span>); Yii::import(<span class="hljs-string"><span class="hljs-string">'classes.mapper.service.RequestMapper'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_service = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> oDeskAPI(Yii::app()-&gt;params[<span class="hljs-string"><span class="hljs-string">'odesk'</span></span>][<span class="hljs-string"><span class="hljs-string">'secret'</span></span>], Yii::app()-&gt;params[<span class="hljs-string"><span class="hljs-string">'odesk'</span></span>][<span class="hljs-string"><span class="hljs-string">'token'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($credential !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setCredential($credential); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">authorize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_service-&gt;auth(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getServiceName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCredential</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ModelCredential $credential)</span></span></span><span class="hljs-function"> </span></span>{ .... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">searchProjects</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... } }</code> </pre><br><br>  Note that both classes implement the ServiceInterface interface, but the implementation of the authorize method is different for each.  Here it is also necessary to mention the ModelCredential model, which stores the data for authorization.  With Oauth, authorization is token and secret. <br><br><h4>  Create a factory </h4><br>  In the future, we need to easily add new services without changing the code of existing classes (we follow the <a href="http://en.wikipedia.org/wiki/Open/closed_principle">OCP</a> principle).  To do this, use the pattern <a href="http://en.wikipedia.org/wiki/Factory_pattern">"Factory Method"</a> . <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceFactory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($serviceName, $credentials = null)</span></span></span><span class="hljs-function"> </span></span>{ $className = ucfirst(strtolower($serviceName)).<span class="hljs-string"><span class="hljs-string">'Service'</span></span>; $serviceObject = Yii::createComponent($className, $credentials); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!($serviceObject <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ServiceInterface)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(<span class="hljs-string"><span class="hljs-string">'Not an instance of Service'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $serviceObject; } }</code> </pre><br><br>  We also added a check that this class implements ServiceInterface.  What is the use of the interface and the check for its implementation by the service classes?  If the developer makes a mistake and forgets to implement any method of the interface, php will not allow to run the code in principle.  This gives us confidence that the method is implemented.  It also gives an understanding of what specific methods the system will need to work.  On this occasion, I will share my story. <br>  One of the projects I was working on was tasked with implementing the service adapter for Google+.  The project has already integrated Facebook and Twitter adapters.  When I opened the class of one of them, I was horrified by the amount of code inside.  I did not understand which of the methods I needed to implement in order for the service to work, and which were secondary.  I had to compare several classes, check with those developers who wrote this code.  It took time.  If we had one interface for such service adapters, it would be immediately clear which of the methods needed to be created. <br><br><h4>  Putting it all together </h4><br>  So, we have prepared the classes of service adapters and the factory that will create them.  Let's see how these parts work together: <br><br><pre> <code class="php hljs"> Yii::import(<span class="hljs-string"><span class="hljs-string">'application.models.ModelCredential'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//       -   ,    Credentials -   //     . $credentialsRecords = ModelCredential::model()-&gt;findAllByAttributes(array( 'type' =&gt; 'public' )); if(!empty($credentialsRecords)) { Yii::import('classes.service.ServiceFactory'); $aggregatedProjects = array(); foreach($credentialsRecords as $serviceCredential) { try { //          credentials. $service = ServiceFactory::create($serviceCredential-&gt;service, $serviceCredential); $foundProjects = $service-&gt;searchProjects(); //       if(is_array($foundProjects)) $aggregatedProjects = array_merge($aggregatedProjects,$foundProjects); } catch(Exception $e) { print_r($e); } } } else { echo 'empty '. "\n"; }</span></span></code> </pre><br><br><h4>  Total </h4><br>  This architecture allows you to integrate new services more transparently and the developer does not need to remember the differences in the names of methods or their calls. <br><br>  In the next article I will explain what to do with the heterogeneity of returned responses and data structures. <br><br><h4>  PS </h4><br>  Simplified factory code by calling Yii :: createComponent ().  Thanks <a href="http://habrahabr.ru/users/ekstazi/" class="user_link">Ekstazi</a> . </div><p>Source: <a href="https://habr.com/ru/post/204436/">https://habr.com/ru/post/204436/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../204424/index.html">Ruslan Sinitsky: "Do not be afraid to destroy standards"</a></li>
<li><a href="../204428/index.html">SMS vulnerability in all Nexus</a></li>
<li><a href="../204430/index.html">Multiple javascript hacks for hipsters</a></li>
<li><a href="../204432/index.html">Break me down completely (ZeroNights 2013)</a></li>
<li><a href="../204434/index.html">Graph500 (supercomputers rating 2013)</a></li>
<li><a href="../204438/index.html">Tuning SQLite for PHP</a></li>
<li><a href="../204440/index.html">Scroller for video and understanding of the time representation in Objective-C</a></li>
<li><a href="../204442/index.html">"Lisp in Small Pieces" in Russian</a></li>
<li><a href="../204446/index.html">Timelapse timer on arduino</a></li>
<li><a href="../204448/index.html">Intel processors for tablets and smartphones - plans for the near future</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>