<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Autumn School on software-configured networks and home-based implementation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In September 2012, I was fortunate enough to visit the fall school on software-configurable networks of the Center for Applied Research of Computer Ne...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Autumn School on software-configured networks and home-based implementation</h1><div class="post__text post__text-html js-mediator-article">  In September 2012, I was fortunate enough to visit the <a href="http://habrahabr.ru/post/150529/">fall school</a> on software-configurable networks of the <a href="http://arccn.ru/">Center for Applied Research of Computer Networks</a> .  Nick McKeon, one of the founders and ideological inspirers of SDN-networks and OpenFlow in particular, was invited to the main thing. <br><br>  The basis of the workshop on the equipment was a NEC switch-over switch of an unknown model in Russia and several tp-link 1043 routers with a patched OpenWrt (in fact, just reassembled).  Already at home, a router of a similar model was discovered, on which I decided to try OpenFlow in action in the real world.  But first about the autumn school itself. <br><a name="habracut"></a><br><h5>  2 Inspiration and theory </h5><br>  The lecture began with the same presentation pictures that are available on the OpenFlow project at Stanford.  However, the semantic load added by Nick significantly refined and supplemented the simple presentation schedules.  Then Nick also spoke about new projects, in particular about the automatic verification of SDN, search for rings in a logical topology, checking the applicability of the rules, etc. <br><br>  During the lecture periodically there were breaks during which students and graduate students bombarded Nika with questions.  It was difficult for Nick to ask many questions, as Nick likes to answer thoroughly and extensively, to touch upon related problems.  At the end of the lecture, I also tried to get several answers to pressing questions that arose both during the course and before the lecture.  Especially interested was the explanation of the <a href="http://www.youtube.com/watch%3Fv%3Dov1DZYINg3Y%26list%3DPL0E8ACB19A8B5E17A%26index%3D8%26feature%3Dplpp_video">experiment of</a> Nick's colleagues with wireless broadcasting and parallel setup of video access points with minimal delays, where one person with a laptop traveled around the Stanford campus on a golf car and broadcast video from a webcam.  Nick explained that the OpenWRT distribution kit with a self-written application for interacting with OpenFlow was flashed at access points (now it is available as a <a href="http://www.openflow.org/wk/index.php/OpenFlow_1.0_for_OpenWRT">package</a> ). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here the idea was born to try to implement this experiment on its own. <br><br><h5>  3 First practice </h5><br>  Second day of school.  We tried the Mininet virtual environment ( <a href="http://www.openflow.org/wk/index.php/OpenFlow_Tutorial">OpenFlow tutorial</a> ), which is a topology simulator on virtual hosts.  An external OpenFlow controller was connected to the virtually created network.  This is where the real fun began. <br><br>  The POX controller is written in python, which has already been a big problem for many.  Well, I had a book on python and the Internet (I hadn‚Äôt written anything on it before, only php, perl, cpp, c #, etc.).  The most interesting thing is that the cat wept for documentation on the POX controller, there are even fewer examples.  The POX object model was clearly written by students in their free time.  For example, the src-MAC address is in the property of the <i>packet_in.dl_src</i> object, which itself is the result of the <i>event.parse</i> method, and to get the src-IP address you need to check the packet type on the protocol in a creepy way (a lot of checks on the types and pulling of various properties from left objects), spar the packet to the next header ( <i>ip_hdr = packet_in.next</i> ), and get the <i>ip_hdr.nw_src</i> object <i>(network_layer src) from there</i> .  As you can see, the POX and application interaction object model was not written by networkers, but pure programmers.  There is no uniformity of the name of the methods, protocols, properties of objects, the python language is quite indifferent, if you make a mistake suddenly in the name of an object or property - it can create a new one. <br><br>  Further more.  The documentation is clearly of a developer nature and is not intended for final use.  The correct solutions were found when digging the POX sources for the desired properties and examples after wandering aimlessly through a single manual.  For the sake of justice, it is worth noting the presence of fairly tolerable examples in the manual about working with a channel Ethernet layer and sending basic OpenFlow rules to the switch.  By the way, during the work (about 5 hours) POX fell off ‚Äúonly‚Äù 2 times.  This is about the reliability of python applications.  When testing its parent NOX (written in c ++), this was not observed. <br><br>  A small example.  The code for setting the rule of channel switching (which ethernet switches almost do not know) will look like this: <br><br><pre><code class="python hljs">fm = of.ofp_flow_mod() fm.match.in_port = <span class="hljs-number"><span class="hljs-number">3</span></span> //     .     fm.actions.append(of.ofp_action_output(port = <span class="hljs-number"><span class="hljs-number">4</span></span>)) //   ,    match </code> </pre> <br><br>  it is clearly spelled out here - all that fell on port 3 will go to the 4th.  No options. <br><br>  In fact, this tutorial is most useful in understanding SDN and how it works.  Unfortunately at the office.  There are no step-by-step examples on the tutorial site, they were successfully voiced and invented by the School‚Äôs speakers, for which they thank you very much.  Without them, I think, half of the people simply would not understand how it works. <br><br><h5>  4 Equipment </h5><br>  The third day was devoted to the real gland.  One Nec ProgrammableFlow switchboard is divided into several VLANs, four of which were managed by OpenFlow, four TP-Link 1043 routers, flashed to OpenWRT with the OpenFlow patch, virtual hosts with controllers, 16 virtual hosts from which the network was assembled.  All hosts had two network - one to control us (external network, for ssh), the other for the openflow test network.  All were divided into 4 groups, the topology was as follows - each group had 3 hosts connected to the switch in the correct VLAN, fourth to the router to the wired port (by the way, the wireless port looks from the point of view of the controller as well as the wired one). <br><br>  Detailed topology (without port numbers and other things): <br><br> <a href="http://radikal.ru/F/s017.radikal.ru/i405/1209/d3/6400e1d9cab7.jpg.html"><img src="https://habrastorage.org/getpro/geektimes/post_images/d32/ee0/a3e/d32ee0a3e3be431f4749d63c1d2daec6.jpg"></a> <br><br>  There were several tasks: <br><ol><li>  raise the POX controller with the default application (L2_learning) on ‚Äã‚Äãthe desired port (6633) and interface.  There were no problems. <br><br><pre> <code class="bash hljs">root@openflowtutorial:/home/openflow/pox<span class="hljs-comment"><span class="hljs-comment"># ./pox.py forwarding.l2_learning POX 0.0.0 / Copyright 2011 James McCauley DE</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">BUG:</span></span></span><span class="hljs-comment">core:POX 0.0.0 going up... DE</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">BUG:</span></span></span><span class="hljs-comment">core:Running on CPython (2.7.1+/Apr 11 2011 18:05:24) DE</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">BUG:</span></span></span><span class="hljs-comment">forwarding.l3_learning:Up... INFO:core:POX 0.0.0 is up. DE</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">BUG:</span></span></span><span class="hljs-comment">openflow.of_01:Listening for connections on 0.0.0.0:6633 Ready. INFO:openflow.of_01:[Con 4/150867562545] Connected to 00-00-00-00-00-01</span></span></code> </pre><br><br>  inscription <br><br> <code>INFO:openflow.of_01:[Con 1/1] Connected to 00-00-00-00-00-01</code> <br> <br>  indicates successful connection of the controller. <br><br></li><li>  To conduct testing (pairwise pings).  Unfortunately, there was no installed iperf, so it was not possible to test the performance.  Ping behaved as it should be - with training about 100-200 ms, in normal mode 0.1-10ms (after all, on virtual machines raised). <br></li><li>  Raise the network virtualization system FlowVisor to abstract OpenFlow instances from the physical network.  At first, everyone tried to understand how it works.  FlowVisor is a bidirectional pseudo-NAT server (addressing spoofing server), which from the point of view of the switch is a complete controller, and from the point of view of the controller is a switch.  Several switches are connected to FlowVisor.  It has a filtering system, and packets from the switch get only to the controller where the administrator has configured.  You can block ports or entire switches from FlowVisor and build an alternative logical network structure. <br>  Each team raised its FlowVizor on port 6633, divided the entire network into 4 segments, set up its own segment and links to neighboring controllers.  The controllers now started on a different port (6634) and saw all switches as localhost (natitsiy). <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/006/d86/93e/006d8693ea76381487ca6bd4ac15cb96.png" alt="image"><br></li></ol><br><br>  FlowVisor is a separate song.  The software implementation of this complex is made on a hellish mixture of c ++, python and java, with java being used for configuration.  Enter the command - the whole java-machine rises, configuration takes place and that's it - java is no longer needed.  One command is executed two seconds.  But there are a lot of commands, each command requires entering a password or specifying a file with a password (clear text).  First you need to create slices - logically separated parts of the network assigned to a specific controller.  Then in each slice you need to add filter rules that fall into the slice and what does not.  You can create one default slice where all unclassified traffic will go. <br><br><h5>  5 We do at home </h5><br>  A tplink 741 was found. When exploring the OpenWrt site, it turned out that OpenWrt was not installed on my hardware revision (v2.1).  However, the form is said to work.  We put Ubuntu on virtualku and libraries (we look on the openwrt site), we pour source codes <br><br><pre> <code class="bash hljs">svn co svn://svn.openwrt.org/openwrt/branches/backfire</code> </pre><br><br>  Then separately fill in the OpenFlow functionality as a package.  A small digression - it took 6 GB to compile a basic Bercia without a web, be careful. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> backfire/package git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git://gitosis.stanford.edu/openflow-openwrt</code> </pre><br><br>  And, most importantly, choose the right brunch for the architecture.  My tplink is Atheros 71xx <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> openflow-openwrt git checkout -b openflow-1.0/ar71 origin/openflow-1.0/tplink</code> </pre><br><br>  Then it is highly desirable to update the openwrt port feeds.  Go to the backfire directory and <br><br><pre> <code class="bash hljs">./scripts/feeds update -a ./scripts/feeds install -a make menuconfig</code> </pre><br><br>  In the menu, select Atheros AR71xx, TP-Link WR741ND v1 (as it turned out, it works v1), in the packages we choose kmod-tun (Kernel Modules-&gt; Network Support), tc and OpenFlow (network).  We remain, we leave. <br><br> <a href="http://radikal.ru/F/s001.radikal.ru/i193/1209/ac/8768fcb1bbaa.png.html"><img src="https://habrastorage.org/getpro/geektimes/post_images/953/5e6/21e/9535e621e4ae36622f073dc0afc2cae0.jpg"></a> <br><br>  As it turned out later, you need to add HTB QoS to the core, everything is very slow without it. <br><br><pre> <code class="bash hljs">make kernel_menuconfig</code> </pre><br><br>  Enable Hierarchical Token Bucket (HTB) (Networking Support-&gt; Networking options-&gt; QoS and / or fair queuing) <br>  Building takes place in the usual make, taking about an hour and 6 GB of space. <br><br>  In the bin / ar71xx folder there will be, among other things, the file <b>openwrt-ar71xx-tl-wr741nd-v1-squashfs-sysupgrade.bin</b> (there is also -factory.bin, it is for the initial openwrt firmware) <br><br>  It is better to make a fill on a device from some openwrt already flashed (for example, for v1) via scp (ssh cp).  We go on ssh in OpenWrt and <br><br><pre> <code class="bash hljs">scp root@ip_:/__/openwrt-ar71xx-tl-wr741nd-v1-squashfs-sysupgrade.bin /tmp sysupgrade -v /tmp/openwrt-ar71xx-tl-wr741nd-v1-squashfs-sysupgrade.bin</code> </pre><br><br>  Oddly enough, it all worked the first time. <br><br><pre> <code class="bash hljs">ps aux | grep ofprotocol 976 root 1040 S ofprotocol tcp:127.0.0.1:6634 tcp:192.168.1.10:6633</code> </pre><br><br>  Setting up OpenFlow itself takes a little time <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc/config vi openflow config <span class="hljs-string"><span class="hljs-string">'ofswitch'</span></span> option <span class="hljs-string"><span class="hljs-string">'dp'</span></span> <span class="hljs-string"><span class="hljs-string">'dp0'</span></span> option <span class="hljs-string"><span class="hljs-string">'ofports'</span></span> <span class="hljs-string"><span class="hljs-string">'eth0.0 eth0.1 eth0.2 eth0.3 '</span></span> option <span class="hljs-string"><span class="hljs-string">'ofctl'</span></span> <span class="hljs-string"><span class="hljs-string">'tcp:192.168.1.102:6633'</span></span> option <span class="hljs-string"><span class="hljs-string">'mode'</span></span> <span class="hljs-string"><span class="hljs-string">'outband'</span></span></code> </pre><br><br>  We start the network controller (I took POX as the easiest one) - <br><br><pre> <code class="bash hljs">root@openflowtutorial:/home/openflow/pox<span class="hljs-comment"><span class="hljs-comment"># ./pox.py forwarding.l3_learning POX 0.0.0 / Copyright 2011 James McCauley DE</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">BUG:</span></span></span><span class="hljs-comment">core:POX 0.0.0 going up... DE</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">BUG:</span></span></span><span class="hljs-comment">core:Running on CPython (2.7.1+/Apr 11 2011 18:05:24) DE</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">BUG:</span></span></span><span class="hljs-comment">forwarding.l3_learning:Up... INFO:core:POX 0.0.0 is up. DE</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">BUG:</span></span></span><span class="hljs-comment">openflow.of_01:Listening for connections on 0.0.0.0:6633 DE</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">BUG:</span></span></span><span class="hljs-comment">openflow.of_01:[Con 1/None] Socket error: Broken pipe DE</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">BUG:</span></span></span><span class="hljs-comment">openflow.of_01:[Con 1/None] disconnecting Ready. INFO:openflow.of_01:[Con 4/150867562545] Connected to 00-23-20-68-50-31</span></span></code> </pre><br><br>  Everything is connected, you can use it.  The only thing that strained - Socket error: Broken pipe.  The controller began to fall off regularly (for that he and POX). <br><br><h5>  What was used when writing a post </h5><br><ol><li>  <a href="http://arccn.ru/">Center for Applied Research of Computer Networks</a> - PCB School itself </li><li>  <a href="http://openflow.org/">OpenFlow site</a> - everything is there, both wikis and tutorial </li><li>  <a href="http://wiki.openwrt.org/">Wiki openwrt</a> - no way without it </li></ol></div><p>Source: <a href="https://habr.com/ru/post/152957/">https://habr.com/ru/post/152957/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../152945/index.html">Windows Azure at the conference Patterns & Practices Summit Russia</a></li>
<li><a href="../152947/index.html">Clouds and elasticity</a></li>
<li><a href="../152951/index.html">2GIS added 3D models to cards</a></li>
<li><a href="../152953/index.html">Criticism of modern project management systems</a></li>
<li><a href="../152955/index.html">How to pull out IT from a bog or about communication in stressful situations</a></li>
<li><a href="../152959/index.html">s02.e05. How to google name day</a></li>
<li><a href="../152961/index.html">Setting up the WAAM inventory system: Inventory of the state institution's property for work in 1C 8.2</a></li>
<li><a href="../152965/index.html">Android web development environment</a></li>
<li><a href="../152967/index.html">Have the courage to do not like everything. 12 obsolete interface and technology solutions</a></li>
<li><a href="../152969/index.html">Percona XtraDB Cluster. Installation and Testing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>