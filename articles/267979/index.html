<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Transition from SQL to NoSQL: the experience of the SMEV 2.0 project</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In recent years, NoSQL and BigData have become very popular in the IT industry, and thousands of projects have been successfully implemented based on ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Transition from SQL to NoSQL: the experience of the SMEV 2.0 project</h1><div class="post__text post__text-html js-mediator-article">  In recent years, NoSQL and BigData have become very popular in the IT industry, and thousands of projects have been successfully implemented based on NoSQL.  Often at different conferences and forums, students ask how to upgrade or move legacy systems to NoSQL.  Fortunately, we had the experience of switching from SQL to NoSQL in a large project <abbr title="System_of interdepartmental_electron_interaction">SMEV</abbr> 2.0, which I will discuss under the cat. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/3a9/21b/49b/3a921b49be8145ab8d21395eb18ab0e5.jpg"></div><br><a name="habracut"></a>  In 2011, in one of the flagship projects of the Electronic Government of the Russian Federation, we were faced with the problem of designing a centralized logging (logging) system.  <abbr title="Centralized logging system">CSL</abbr> is a logging for processing application and system logs (events) in a single repository.  Application logs from the server application (citizens accessing the service through the public services portal), balancing log, load and integration bus log the logs through the server log, enter the storage, then the data is indexed and aggregated for reporting.  For reporting, we used the BI system.  Below is the conceptual architecture of CSL: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b4/3df/b94/3b43dfb94c977ab87038e7d2d8c6dfb7.png" width="600"></div><br>  The situation is complicated when different legacy heterogeneous systems with their storage and logging system are involved.  One of such systems is SMEV (System of Interdepartmental Electronic Interaction, Architecture 2011).  It contains two types of Oracle integration buses: WSM and Oracle OSB.  Oracle WSM always logs messages as BLOBs in its own database schema.  OSB also logs messages in its schema, while other software has its own approach to logging.  Now imagine that this whole system is installed in several regions of the Russian Federation.  Data is replicated from other data centers to a federal data center for processing and aggregation.  After consolidation and aggregation, the resulting data is reported through the BI system.  The illustration below shows the high-level architecture of SMEV 2.0: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/176/6c2/fbd/1766c2fbd78e496caccc8475545f95fb.png"><br><br>  This system had a number of drawbacks: <br><br><ol><li>  <u>Poor scalability</u> : the first problem was the dynamics of growth of registrations and the use of services in all authorities.  At the beginning of 2011, only 4,000 services were registered, and already in the second quarter of 2013, more than 10,000. Approximately 1,000 soap-services were registered on the integration bus in each data center, and about 2,000 services were registered in the federal data center.  Thus, the need for service has increased by almost 6 times: at the federal level, the number of logs reached 21 million per day, and throughout Russia - about 41 million records, during peak hours RPS (Request per second) - 1375. Of course, compared With a high load system, these are tiny numbers.  The whole process of data processing and reporting is implemented on the basis of PL / SQL, i.e.  message handling and data consolidation were implemented in PL / SQL, which was not productive enough.  After a big update, we could parse 450 thousand messages in 110 minutes, when we received several million messages a day at the entrance. <br><br></li><li>  The second strongly influenced factor is <u>data replication</u> between data centers, which was carried out through various heterogeneous tools: WHB, Oracle Goldengate, Oracle Stream.  If for some reason there was no communication channel, they had to be restarted to avoid errors. <br><br></li><li>  <u>Oracle RAC scaling:</u> also with increasing growth in demand for services, it was necessary to scale the database, which was very expensive and difficult. <br><br></li><li>  <u>Costly licenses</u> for Oracle software. </li></ol><br>  All these reasons led us to revise our architecture and switch to NoSQL.  After a bit of discussion and benchmarking, we decided to use the Cassandra repository.  Its advantages were obvious: <br><br><ul><li>  Automatic data replication between data centers; </li><li>  Sharding data out of the box; </li><li>  Linear scaling of the Cassandra cluster; </li><li>  No single point of failure; </li><li>  Google Big Table based data model; </li><li>  Open source software. </li></ul><br>  As a result, we have the following conceptual architecture based on Cassandra: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/001/cc7/6f2/001cc76f2c39d8cffd3ec5dd5dad18da.png" width="800"></div><br>  Each region or data center log server writes protocols in its Cassandra cluster node.  Data is automatically replicated to the analysis center for analysis.  After analyzing and processing data in Hadoop Map Reduce, the data is uploaded through the SQL loader for reporting to Oracle.  If, for some reason, the communication channel between the analytical centers and the DCS is missing, data is accumulated (Hinted hands of) in each operational node of Cassandra and when a connection appears, the data from the DCS are sent to the analytical nodes. <br><br><h3>  <font color="#00a9c0">Software stack</font> </h3><br><ul><li>  Cassandra 1.1.5 </li><li>  Hadoop 1.0.3 </li><li>  Apache pig 0.1.11 </li><li>  AzKaban </li></ul><br><h3>  <font color="#00a9c0">Data model and their processing</font> </h3><br>  The data model is the Column Family, consisting of columns and values.  All columns are static, because Pig did not know how to work with dynamic columns: thus, we have a payload of soap payload in a column.  Through Hadoop Map Reduce, the message is parsed, and the result is stored in the Cassandra table for building the aggregate.  After that, Reduce is run in the resulting metadata to build different aggregates.  Aggregated data is exported via Oracle SQL Loader from Hadoop HDFS to Oracle DB. <br><br><h3>  <font color="#00a9c0">Performance</font> </h3><br>  After tuning (fine tuning) Hadoop we got such performance.  Analysis of 300 million lines from Cassandra takes about 100 minutes.  Building an aggregate of 300 million records takes an average of 170 minutes.  The Pig script of the data aggregate in our case contains 3 large join operators, so 3 more temporary maps appear. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/41a/5b9/012/41a5b9012db45542ea0da69932ecd4a2.png"></div><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d0/729/ce9/3d0729ce9460cc585d5e6baafb734d97.png"></div><br><br><h3>  <font color="#00a9c0">Results</font> </h3><br>  During the transition, it is very important to understand the data model and the reason for the transition.  Relational databases are still leading among data warehouses; using the relational model, you can implement almost all domain models: for example, we transferred only non-transactional data (application and system logs).  Cassandra helped us solve the problem of replication between data centers, and Hadoop solved the issue of data processing performance. <br><br>  <b>References:</b> <br><ol><li>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D0%25BC%25D0%25B5%25D0%25B6%25D0%25B2%25D0%25B5%25D0%25B4%25D0%25BE%25D0%25BC%25D1%2581%25D1%2582%25D0%25B2%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B3%25D0%25BE_%25D1%258D%25D0%25BB%25D0%25B5%25D0%25BA%25D1%2582%25D1%2580%25D0%25BE%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B3%25D0%25BE_%25D0%25B2%25D0%25B7%25D0%25B0%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25B4%25D0%25B5%25D0%25B9%25D1%2581%25D1%2582%25D0%25B2%25D0%25B8%25D1%258F">The system of interdepartmental electronic interaction</a> </li><li>  <a href="https://ru.wikipedia.org/wiki/MapReduce">MapReduce</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/267979/">https://habr.com/ru/post/267979/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267969/index.html">In the wake of the AzureCon conference - the main announcements</a></li>
<li><a href="../267971/index.html">Data Center for Health Protection</a></li>
<li><a href="../267973/index.html">Blog IT park. How is the state data center?</a></li>
<li><a href="../267975/index.html">Accelerate Layout with AutoCorrect in Punto Switcher</a></li>
<li><a href="../267977/index.html">Operator famous banker Trojan Citadel sentenced to prison</a></li>
<li><a href="../267981/index.html">Cloud Security</a></li>
<li><a href="../267983/index.html">WinRAR critical vulnerability</a></li>
<li><a href="../267985/index.html">PBX 3CX for hosting - change the rules of the game</a></li>
<li><a href="../267987/index.html">Windows 10 through 10. Issue # 3. Using Cortana to interact with users</a></li>
<li><a href="../267989/index.html">Li-ion battery: another step towards savings</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>