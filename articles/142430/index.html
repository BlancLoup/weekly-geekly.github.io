<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Importing information blocks from 1C-Bitrix to MODx Revolution</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The third day we were asked to write a script to move from Bitrix to MODx. The task seemed interesting, especially since it never really worked with B...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Importing information blocks from 1C-Bitrix to MODx Revolution</h1><div class="post__text post__text-html js-mediator-article">  The third day we were asked to write a script to move from Bitrix to MODx.  The task seemed interesting, especially since it never really worked with Bitrix. <br><br><img src="https://habrastorage.org/storage2/0f0/4a6/fa8/0f04a6fa8d8f67231991722a1c4fdc49.png"><br><br>  I can‚Äôt write anything about the system itself, because I didn‚Äôt even enter the admin area - I only worked with the database.  By the way, this is 322 tables, versus 68 for MODx. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  Of course, there was no complete transfer of the entire speech, the task was to import the contents of certain information blocks (articles and news), with authors and some properties (pictures, date of publication). <br>  And of course, save all url addresses well indexed by search engines. <br><br>  I think that with some zeal this script can be finished to work with other CMS, such as Joomla or Drupal. <br><br>  At the end of the topic is an archive for download, but for now I‚Äôll tell you a little how the script works. <br><br>  3 files: <br><ul><li>  <b>config.inc.php</b> - an array with a certain structure in which the settings for each information block are located </li><li>  <b>import.class.php</b> - class with methods </li><li>  <b>process.php</b> - file to run, connects the config and class </li></ul><br><br><h4>  Configuration </h4><br>  All the necessary data for work is entered into the array: <br><pre><code class="html hljs xml">'table_prefix' =&gt; 'bitrix_' ,'blocks' =&gt; array( 'articles' =&gt; array( 'id' =&gt; 3 ,'cat_tpl' =&gt; 3 ,'tpl' =&gt; 3 ,'uri_override' =&gt; 1 ,'preview_picture' =&gt; 'preview_picture' ,'detail_picture' =&gt; 'detail_picture' )</code> </pre> <br>  The block array stores the import settings for specific information blocks: <br><ul><li>  <b>id</b> is the number of the parent resource for importing all information block pages.  Need to create in advance. </li><li>  <b>cat_tpl</b> - template identifier for containers (categories) </li><li>  <b>tpl</b> - template identifier for common resources </li><li>  <b>uri_override</b> - freeze uri pages, you need to save the old links. </li><li>  <b>preview_picture</b> - TV parameter for saving a small picture of the page, optional </li><li>  <b>detail_picture</b> - TV parameter for large images, optional </li></ul><br>  Also in the settings specified prefix tables Bitrix.  I believe that they are in the same database with MODx tables. <br><br><h4>  Available methods </h4><br>  Now you need to look into the file proccess.php. <br><br>  It connects MODx itself, the import class and the necessary methods to import are called: <br><ul><li>  <b>truncateTable</b> - accepts resource id, and deletes all resources after it.  Useful for experiments. </li><li>  <b>importBlock</b> - directly import the information block, accepts its name (and looks for settings in the configuration array) </li><li>  <b>linkToAuthors</b> - the method needed personally for my situation, links the pages of the authors of articles with articles.  Useful as an example. </li><li>  <b>getProps</b> - takes the name of the information block section and displays its properties (rules for building uri and the like) </li><li>  getElements - takes a section id and displays all its child pages </li><li>  <b>getSections</b> - builds a tree of categories (from sections), puts them into each other, as on the original site.  Accepts properties from getProps and config </li><li>  <b>getFile</b> - takes the id of the file and displays its properties (address, name).  Files cling to Bitrex through a separate table in the database. </li><li>  <b>makeURI</b> - creating uri for a MODx resource (we need to save it) according to a template from the section properties </li><li>  <b>getProperty</b> - additional elements of the information block element.  Something like TV in MODx. </li></ul><br><br>  In general, almost all methods are written to work in importBlock. <br>  When it is launched, the properties of the section are obtained, its subcategories are created, then resources are imported into them and pictures are saved in TVshechki. <br><br><h4>  Uri pages </h4><br>  The most important thing is that all uri work, when using the following plugin, of course: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($modx-&gt;event-&gt;name == <span class="hljs-string"><span class="hljs-string">'OnPageNotFound'</span></span>) { $uri = parse_url(substr($_SERVER[<span class="hljs-string"><span class="hljs-string">'REQUEST_URI'</span></span>],<span class="hljs-number"><span class="hljs-number">1</span></span>)); $query = explode(<span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>, $uri[<span class="hljs-string"><span class="hljs-string">'query'</span></span>]); $num1 = count($query); $query = array_unique($query); $num2 = count($query); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($num1 != $num2) { $modx-&gt;sendRedirect($modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'site_url'</span></span>).$uri[<span class="hljs-string"><span class="hljs-string">'path'</span></span>].<span class="hljs-string"><span class="hljs-string">'?'</span></span>.implode(<span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>, $query)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($res = $modx-&gt;getObject(<span class="hljs-string"><span class="hljs-string">'modResource'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'uri'</span></span> =&gt; $uri[<span class="hljs-string"><span class="hljs-string">'path'</span></span>].<span class="hljs-string"><span class="hljs-string">'?'</span></span>.$query[<span class="hljs-number"><span class="hljs-number">0</span></span>]))) { $modx-&gt;sendForward($res-&gt;get(<span class="hljs-string"><span class="hljs-string">'id'</span></span>)); } }</code> </pre><br>  Since in Bitrix (I don‚Äôt know, always, or only in my case) these are the addresses / news / detail.php? News = 6868, you also have to force the web server to send them to index.php in the root of the site.  That is, it‚Äôs like we have such friendly urls coming out. <br><br>  The plugin even makes pagination work with getPage.  That is, news / detail.php? News = 6868 &amp; page = 5 - it will work correctly. <br><br><h4>  Conclusion </h4><br>  I tried to write the script as universally as possible, but not to the detriment of the main work.  In any case, those wishing to move from Bitrix to MODx now have something to push off. <br><br>  It works quite quickly, importing 5000 resources and linking to each other via TV parameters takes about 4 to 5 minutes on a regular home computer.  Linking is my specific task, I don‚Äôt know if anyone else will come in handy. <br><img src="https://habrastorage.org/storage2/5f0/8c3/3b3/5f08c33b38bd09fbcd4f3c8bc1cc2aa4.png"><br><br>  I will not add, modify and develop this script - only if they are asked to transfer another site from Bitrix to Revo.  In general, I give, as it is. <br><br>  Finally, in short: <br><ol><li>  Install MODx Revo. </li><li>  Create containers for import, assign TV to pictures. </li><li>  Upload dump bitrix db. </li><li>  <a href="http://narod.ru/disk/46621704001.e89c022fe7458b188cff93de08c2c463/import.zip.html">Download the archive</a> and unzip to the root of the site. </li><li>  Configure config.inc.php, specify table prefix and information block settings. </li><li>  Start importing information blocks in process.php from the console - there is a possibility of arbitrary launch. </li><li>  If something is wrong, dig in the code and edit for yourself. </li></ol><br><br>  <b>I beg you not to deploy the next holivary on the theme of ‚Äúthe world's best CMS‚Äù!</b> <br><br>  PS Ordered, paid, and allowed to share the guys from <a href="http://www.wm.ru/">Webmaster Agency</a> <br><br>  <b>UPD.</b>  It is not pleasant to receive cons in a post and a karma for, as it seems to me, a useful script.  If only someone unsubscribed - what does not suit? </div><p>Source: <a href="https://habr.com/ru/post/142430/">https://habr.com/ru/post/142430/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142424/index.html">Computational linguistics is powerless to help us in word processing.</a></li>
<li><a href="../142425/index.html">Linus Torvalds was awarded the Millennium Technology Prize 2012</a></li>
<li><a href="../142426/index.html">Two Chinese are accused of selling pirated software for $ 100 million</a></li>
<li><a href="../142428/index.html">The Tax Service of Ukraine searches the office of the company Imena.ua/Mirohost</a></li>
<li><a href="../142429/index.html">Testing, using SoapUI, a web service that returns a list of items</a></li>
<li><a href="../142432/index.html">Rusrails.ru is 2 years old!</a></li>
<li><a href="../142433/index.html">Successful premiere of Workle UX Friday in the office Workle</a></li>
<li><a href="../142435/index.html">Fresh Humble Bundle released</a></li>
<li><a href="../142436/index.html">Bitcasa continues to accelerate</a></li>
<li><a href="../142437/index.html">The creators of Android viruses use the Instagram buzz to distribute SMS Trojans</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>