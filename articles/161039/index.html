<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Guide to writing JS scripts for front-end developers under Drupal 7</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are different ways to create a layout for Drupal. Someone is making up already darkened pages, someone is trying to do with standard themes, but...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Guide to writing JS scripts for front-end developers under Drupal 7</h1><div class="post__text post__text-html js-mediator-article">  There are different ways to create a layout for Drupal.  Someone is making up already darkened pages, someone is trying to do with standard themes, but as a rule, at first the layout designer makes up pages by design, and the output is a set of html files - slices.  Then developers integrate these files piece by piece when teming. <br>  And in the process of integration are errors, some modifications, so the layout and scripts related to it, should be available for editing and testing. <br>  It is about the latter method that we will mainly talk about, I will describe typical mistakes and best practices for solving them when writing JS scripts for D7.  I think it will be interesting both for the Drupal typesetters, and for the developers of the modules.  In the case of web designers, the basic principle that should be guided is the fact that your script will work in Drupal environment, and this imposes a number of restrictions, ideally, the script should connect to Drupal and work without any additional modifications, while working on slices outside of Drupal . <br><a name="habracut"></a><br><br><h4>  JQuery variable name </h4><br>  In Drupal 7, in contrast to version 6, you can‚Äôt just take it and use jQuery methods through $, because this variable is simply not declared. <br>  Often you have to deal with the situation when the layout designer wrote the scripts that work in the layout, or you just took a ready-made script, and with the integration problems start.  Most likely the problem is in using the $ variable.  You don‚Äôt need to be scared - to go and to replace $ with jQuery everywhere. <br>  Let's say there is a script: <br><pre><code class="javascript hljs">$(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'div.menu-expanded'</span></span>).hide(); $(....); });</code> </pre> <br>  To make it work when connected to Drupal, it needs to be reissued as follows: <br><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span></span><span class="hljs-function">) </span></span>{ $(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'div.menu-expanded'</span></span>).hide(); $(...); }); }) (jQuery);</code> </pre><br>  Thus, by simply wrapping the entire code intact, using the standard scope allocation mechanism, the jQuery object became accessible by the name $. <br>  It is better to immediately explain to your typesetter such a technique in order to avoid problems in the future and not to climb on his scripts with corrections. <br><br><h4>  Drupal.behaviors </h4><br>  Drupal has a special way of handling the document ready event, Drupal.behaviors, which provides several advantages.  In D6, he was already, just a little changed the way of writing. <br>  For example, there is such a script: <br><pre> <code class="javascript hljs">$(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ $(<span class="hljs-string"><span class="hljs-string">'a.tooltip'</span></span>).someTooltipPlugin(); });</code> </pre><br>  Everything is simple and understandable, but what will happen if the elements of a, with a class of interest to us appear on the page asynchronously?  It turns out that you need to manually call a function that re-hangs all the handlers, or duplicate this code at the return point of asynchronous content. <br>  The behaviorist mechanism proposes the following concept. <br>  All code that should be called when the page is ready should be enclosed in the following construction: <br><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span></span><span class="hljs-function">) </span></span>{ Drupal.behaviors.yourName = { <span class="hljs-attr"><span class="hljs-attr">attach</span></span> : <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">context, settings</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Your code here. } }; })(jQuery);</span></span></code> </pre><br>  In this way, we have defined our behavioral - we simply added a new property to the Drupal.behaviors object.  Its advantage is that in addition to the call when loading the entire page, Drupal will call all behaviorists, for example, when receiving an ajax request response (in case it is a standard request, for example, updating a form or twisting). <br>  All behaviorists can be called manually like this: <br><pre> <code class="javascript hljs">Drupal.attachBehaviors(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>, {});</code> </pre><br>  Drupal will go through all the properties of Drupal.behaviors and call the attach method. <br>  Pay attention to the first argument (I decided not to talk about the second argument as it is in my understanding that purely front-end developers would not be helpful).  Here you need to transfer the contents (DOM element or selector) to which you want to apply (‚Äúattach‚Äù) the behaviorr.  This value will be available as a context argument in each behaviorator.  This is necessary in order to limit the scope of the code inside the behaviorr. <br>  If you take the code from the previous example, the handler will be added to all links on the page with each call of the behaviorr.  But if we rewrite the code like this: <br><pre> <code class="javascript hljs">$(<span class="hljs-string"><span class="hljs-string">'a...'</span></span>, context).someTooltipPlugin();</code> </pre><br>  Then, when loading the page, all links with a class on the whole page will be processed, because the first call of behaviorists occurs with the document object as the context. <br>  Then at each call of behaviorists, but only inside the newly received content. <br>  For example, if we have a list with ajax pagination, then on going to the second page we are interested in re-processing only the content of the second page, and not the entire document. <br>  If you write your module, you simply have to wrap up your functionality in behaviorr, which would allow third-party developers to ‚Äúattach‚Äù your logic-behavior to their content.  And at any time, and not only when loading the page. <br>  Nuance for web designers.  In the case when the layout is first prepared, and then it is planned to be bolted to Drupal - the code should be drawn up immediately using behaviorists. <br>  Naturally, on the layout, behaviorists will not work without native Drupal scripts, there will be errors in accessing non-existent variables, etc. <br>  To avoid this, I suggest connecting the drupal.js script, which lies in the Drupal core on the layout. <br>  In this way, we will be able to write basic scripts in a form suitable for Drupal, and when applying the layout, just copy them. <br>  All that the typesetter needs to know is that instead of the usual document ready to write behaviorists.  And inside always use context when building selectors. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  jQuery.once </h4><br>  If behaviorists were needed to additionally add handlers to new content, now consider the reverse problem.  Some handlers can be assigned to the same elements twice, but this is not always necessary. <br>  The easiest way is to add a class when first processing, and to include the absence condition of this class in the selector. <br><pre> <code class="javascript hljs">$(<span class="hljs-string"><span class="hljs-string">'a.tooltip:not(.processed)'</span></span>, context).addClass(<span class="hljs-string"><span class="hljs-string">'processed'</span></span>).someTooltipPlugin();</code> </pre><br>  This construction inside the behaviorr ensures that when the code is re-executed, the handler is added once. <br>  The same mechanism is embedded in the jQuery.once plugin, which is included in the D7 core and is available by default on any page. <br>  Using the plugin, the construction above can be replaced like this: <br><pre> <code class="javascript hljs">$(context).once(<span class="hljs-string"><span class="hljs-string">'myIdentifier'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Your code here. });</span></span></code> </pre><br>  Where myIdentifier is any unique value that will be used as the same processed class. <br>  Can be replaced by a shorter design: <br><pre> <code class="javascript hljs">$(context).once(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Your code here. });</span></span></code> </pre><br>  In this case, the plugin itself will form a unique class. <br><br><h4>  Base url </h4><br>  Quite a common mistake - forget to consider the base url.  Not once met her in proven Contrib modules. <br>  Recognizing it is easy - a slash at the beginning: <br>  var url = '/ ajax / my-module / some-action'; <br>  Usually they develop on the same environment, and just hardcodes the slash, and when the base URL changes - some scripts stop working ... Most often the error occurs when forming the path for ajax requests and when specifying the path for the a and img tag attributes. <br>  The correct one is to use a special variable, which is declared by the kernel: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = Drupal.settings.basePath + <span class="hljs-string"><span class="hljs-string">'ajax/my-module/some-action'</span></span>;</code> </pre><br><br><h4>  Ways for ajax requests </h4><br>  A small recommendation (in our company, this is just a standard) - when forming the ajax request path, start them with the word ajax - this will make it possible to easily separate all ajax requests from the usual ones, if necessary.  For example, exclude them from the cache at once, search in logs, etc.  Then the module name with a hyphen will immediately tell where to look for the handler of this request.  Hyphens are needed for the readability of URLs, even if no one sees it, it‚Äôs better to stick to one format, because you won‚Äôt build alias nodes with underscores? <br>  An example of the "correct" path according to this logic would be - ajax / my-module / some-action. <br><br><h4>  Line output </h4><br>  There are a number of functions that should be used when outputting text to JS. <br>  I will simply list the main ones, without deepening - all of them are analogs of the PHP core functions: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   . Drupal.t('text'); //  ""  . Drupal.checkPlain(name); //   ,    /  . Drupal.formatPlural(count, singular, plural, args, options);</span></span></code> </pre><br>  They are all announced in drupal.js, so they won't work without it. </div><p>Source: <a href="https://habr.com/ru/post/161039/">https://habr.com/ru/post/161039/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../161029/index.html">7 Grocery technicians that the developer should pay attention to</a></li>
<li><a href="../161031/index.html">Martian Code: Lecture on how to program Curiosity</a></li>
<li><a href="../161033/index.html">Dismantling the new iMac 2012</a></li>
<li><a href="../161035/index.html">10 PRINT CHR $ (205.5 + RND (1)) ;: GOTO 10</a></li>
<li><a href="../161037/index.html">Part 2: Tunnel Magic, NetDB, and Protocol Juggling</a></li>
<li><a href="../161045/index.html">Review of the tablet Freelander PD10 Typhoon - "full stuffing" at a reasonable price</a></li>
<li><a href="../161047/index.html">My first client is dead</a></li>
<li><a href="../161051/index.html">Computer crime: then and now</a></li>
<li><a href="../161053/index.html">Tame and pump firelight: The Ultimate Guide</a></li>
<li><a href="../161055/index.html">How ZFS Works - Part 2: metaslab</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>