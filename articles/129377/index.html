<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Failover Cluster for Java Applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time has passed since the launch of the project and it is time to increase the computing power for the application to work. It was decided to bui...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Failover Cluster for Java Applications</h1><div class="post__text post__text-html js-mediator-article"> Some time has passed since the launch of the project and it is time to increase the computing power for the application to work.  It was decided to build a cluster for this, which can later be easily scaled.  Thus, we need to set up a cluster to distribute requests between servers. <br><br>  For this we will use 4 servers on Linux CentOS 5.5, as well as Apache, Tomcat6, mod_jk, Heartbeat. <br>  web1, web2 servers - for distributing requests by means of Apache and fault tolerance by means of Heartbeat.  tomcat1, tomcat2 server - tomcat server for java application. <br><a name="habracut"></a><br>  <b>Software installation:</b> <br><br>  <b>We put Apache and Heartbeat</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code><font color="green">[root@web1 opt]$ yum -y install httpd heartbeat <br> [root@web2 opt]$ yum -y install httpd heartbeat</font></code> <br> <br>  Since there is no latest stable version of Tomcat in the repository, I prefer to download it from the mirror <br><br> <code><a href=""></a> <a href=""></a> <font color="green">[root@tomcat1 opt]$ wget apache.vc.ukrtel.net/tomcat/tomcat-7/v7.0.21/bin/apache-tomcat-7.0.21.tar.gz <br> [root@tomcat1 opt]$ tar xvfz apache-tomcat-7.0.21.tar.gz <br> [root@tomcat1 opt]$ mkdir tomcat $$ mv apache-tomcat-7.0.21 tomcat <br> [root@tomcat1 opt]$ rmdir apache-tomcat-7.0.21 <br> [root@tomcat1 opt]$ ln -s /opt/tomcat/bin/catalina.sh /etc/init.d/tomcat <br> <br> [root@tomcat2 opt]$ wget apache.vc.ukrtel.net/tomcat/tomcat-7/v7.0.21/bin/apache-tomcat-7.0.21.tar.gz <br> [root@tomcat2 opt]$ tar xvfz apache-tomcat-7.0.21.tar.gz <br> [root@tomcat2 opt]$ mkdir tomcat $$ move apache-tomcat-7.0.21 tomcat <br> [root@tomcat2 opt]$ rmdir apache-tomcat-7.0.21 <br> [root@tomcat2 opt]$ ln -s /opt/tomcat/bin/catalina.sh /etc/init.d/tomcat</font></code> <br> <br>  In order to teach Apache on web1 and web2 servers to distribute the load between the tomcat1 and tomcat2 servers, you need to connect the mod_jk module to Apache. <br>  Download mod_jk for your version of Apache, rename it and move it to the / etc / httpd / modules directory. <br><br> <code><a href="http://archive.apache.org/dist/tomcat/tomcat-connectors/jk/binaries/linux/jk-1.2.31/i386/mod_jk-1.2.31-"></a> <a href="http://archive.apache.org/dist/tomcat/tomcat-connectors/jk/binaries/linux/jk-1.2.31/i386/mod_jk-1.2.31-"></a> <font color="green">[root@web1 opt]$ wget archive.apache.org/dist/tomcat/tomcat-connectors/jk/binaries/linux/jk-1.2.31/i386/mod_jk-1.2.31-httpd-2.2.x.so <br> [root@web1 opt]$ move mod_jk-1.2.31-httpd-2.2.x.so /etc/httpd/modules/mod_jk.so <br> <br> [root@web2 opt]$ wget archive.apache.org/dist/tomcat/tomcat-connectors/jk/binaries/linux/jk-1.2.31/i386/mod_jk-1.2.31-httpd-2.2.x.so <br> [root@web2 opt]$ move mod_jk-1.2.31-httpd-2.2.x.so /etc/httpd/modules/mod_jk.so</font></code> <br> <br>  We do the same actions for the app2 server. <br><br>  <b>Heartbeat setup:</b> <br><br> <code><font color="green">[root@web1 opt]$ touch /etc/ha.d/authkeys <br> [root@web1 opt]$ touch /etc/ha.d/ha.cf <br> [root@web1 opt]$ touch /etc/ha.d/haresources</font></code> <br> <br>  We set the parameter to be read only by the root user to the file /etc/ha.d/authkeys, otherwise heartbeat will not start. <br><br> <code><font color="green">[root@web1 ha.d]$ chmod 600 /etc/ha.d/authkeys</font></code> <br> <br>  And add to its 2 lines.  The file must be identical on both nodes. <br><br> <code><font color="green">[root@web1 ha.d]$ nano authkeys <br> <br> auth 2 <br> 2 sha1 your-password</font></code> <br> <br>  We make the same actions for the web2 server. <br><br>  Edit the /etc/ha.d/ha.cf file.  The file must be identical on both nodes. <br><br> <code><font color="green">[root@web1 ha.d]$ nano ha.cf <br> <br> logfacility local0 <br> keepalive 2 <br> deadtime 10 <br> initdead 120 <br> bcast eth0 <br> udpport 694 <br> auto_failback on <br> node web1 <br> node web2 <br> respawn hacluster /usr/lib/heartbeat/ipfail <br> use_logd yes <br> logfile /var/log/ha.log <br> debugfile /var/log/ha-debug.log</font></code> <br> <br>  We make the same actions for the web2 server. <br><br>  Edit the /etc/ha.d/haresources file.  The file must be identical on both nodes. <br><br> <code><font color="green">[root@web1 ha.d]$ nano haresources <br> <br> web1 192.168.0.1 httpd #  ip    .</font></code> <br> <br>  We make the same actions for the web2 server. <br><br>  <b>Balancing setting:</b> <br><br>  Add the lines to the /etc/httpd/conf/httpd.conf file of both web servers: <br><br> <code><font color="green">LoadModule jk_module modules/mod_jk.so <br> <br> JkWorkersFile conf/workers.properties <br> JkLogFile logs/mod_jk.log <br> JkLogLevel info <br> JkLogStampFormat "[%a %b %d %H:%M:%S %Y] " <br> JkOptions +ForwardKeySize +ForwardURICompat -ForwardDirectories <br> JkRequestLogFormat "%w %V %T"</font></code> <br> <br>  In the section DocumentRoot add the following two lines <br><br> <code><font color="green">JkMount /*.jsp loadbalancer <br> JkMount /servlet/* loadbalancer</font></code> <br> <br>  In the / etc / httpd / conf folder of both web servers we create the file workers.properties. <br><br> <code><font color="green">[root@web1 conf]$ touch workers.properties <br> [root@web2 conf]$ touch workers.properties</font></code> <br> <br>  Add the following lines to them: <br><br> <code><font color="green">worker.list=tomcat1, tomcat2, loadbalancer <br> <br> worker.tomcat1.port=10010 <br> worker.tomcat1.host=192.168.1.1 <br> worker.tomcat1.type=ajp13 <br> worker.tomcat1.lbfactor=1 <br> <br> worker.tomcat2.port=10020 <br> worker.tomcat2.host=192.168.1.2 <br> worker.tomcat2.type=ajp13 <br> worker.tomcat2.lbfactor=1 <br> <br> worker.loadbalancer.type=lb <br> worker.loadbalancer.balanced_workers=tomcat1, tomcat2</font></code> <br> <br>  In /opt/tomcat/conf/server.xml of both Tomcat'es we configure ports (all ports must be different): <br><br> <code><font color="green">[root@tomcat1 conf]$ nano server.xml <br> <br> &lt;server port="8005" ...&gt; <br> <br> &lt;! --  HTTP , ..    AJP  <br> &lt;connector port="8080" protocol="HTTP/1.1" ... /&gt; <br> --&gt; <br> <br> &lt;connector port="10010" protocol="AJP/1.3" ... /&gt; <br> <br> [root@tomcat2 conf]$ nano server.xml <br> <br> &lt;server port="8006" ...&gt; <br> <br> &lt;! --  HTTP , ..    AJP  <br> &lt;connector port="8080" protocol="HTTP/1.1" ... /&gt; <br> --&gt; <br> <br> &lt;connector port="10020" protocol="AJP/1.3" ... /&gt;</font> <br></code> <br><br>  <b>Configuring session replication</b> <br><br>  In order that when one of the Tomcat servers is dropped, the user's session is not destroyed, it makes sense to set up session replication between Tomcat servers.  To do this, add the following lines to /opt/tomcat/conf/server.xml in the section "&lt;Engine name =" Catalina "defaultHost =" localhost "&gt;" of all Tomcat's: <br><br> <code><font color="green">[root@tomcat1 conf]$ nano server.xml <br> <br> &lt;ngine name="Catalina" defaultHost="localhost" debug="0" jvmRoute="tomcat1"&gt; <br> <br> &lt;Cluster className="org.apache.catalina.cluster.tcp.SimpleTcpCluster" <br> &lt;membership <br> className="org.apache.catalina.cluster.mcast.McastService" <br> mcastAddr="228.0.0.4" <br> mcastBindAddress="127.0.0.1" <br> mcastPort="45564" <br> mcastFrequency="500" <br> mcastDropTime="3000"/&gt; <br> &lt;receiver <br> className="org.apache.catalina.cluster.tcp.ReplicationListener" <br> tcpListenAddress="auto" <br> tcpListenPort="4001" <br> tcpSelectorTimeout="100" <br> tcpThreadCount="6"/&gt; <br> /&gt; <br> <br> [root@tomcat2 conf]$ nano server.xml <br> <br> &lt;ngine name="Catalina" defaultHost="localhost" debug="0" jvmRoute="tomcat2"&gt; <br> <br> &lt;Cluster className="org.apache.catalina.cluster.tcp.SimpleTcpCluster" <br> &lt;membership <br> className="org.apache.catalina.cluster.mcast.McastService" <br> mcastAddr="228.0.0.4" <br> mcastBindAddress="127.0.0.1" <br> mcastPort="45564" <br> mcastFrequency="500" <br> mcastDropTime="3000"/&gt; <br> &lt;receiver <br> className="org.apache.catalina.cluster.tcp.ReplicationListener" <br> tcpListenAddress="auto" <br> tcpListenPort="4002" <br> tcpSelectorTimeout="100" <br> tcpThreadCount="6"/&gt; <br> /&gt;</font> <br> <br></code> <br><br>  This completes the configuration of the fault-tolerant and productive cluster for Java servlets.  We have achieved fault tolerance and scalable performance, which will allow us to easily add new nodes to the cluster in case of lack of performance. </div><p>Source: <a href="https://habr.com/ru/post/129377/">https://habr.com/ru/post/129377/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../129365/index.html">What are you writing demons for?</a></li>
<li><a href="../129366/index.html">Amazon introduced a new touch reader and lowered the price of a regular</a></li>
<li><a href="../129370/index.html">Hardware and software system for measuring the photoelectric characteristics of a CCD</a></li>
<li><a href="../129371/index.html">The Humble Frozen Synapse Bundle</a></li>
<li><a href="../129374/index.html">Office alcohol - myth or reality?</a></li>
<li><a href="../129378/index.html">Jelastic - Java cloud platform for hosted service providers</a></li>
<li><a href="../129380/index.html">Impressions of using HP Veer</a></li>
<li><a href="../129381/index.html">MongoDB Monitoring System (MMS)</a></li>
<li><a href="../129382/index.html">We get a passport through gosuslugi.ru (part 2)</a></li>
<li><a href="../129383/index.html">Configuring J2SE and J2EE Applications: Standard Methods and Their Alternatives</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>