<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Informative about PGM protocol</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I would like to talk about the most popular protocol that provides reliable delivery of multicast messages. This protocol is called PG...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Informative about PGM protocol</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/a53/0c6/e37/a530c6e37ef23f39f5742d68101e73e9.gif" alt="image" width="16" height="16"><br>  In this article I would like to talk about the most popular protocol that provides reliable delivery of multicast messages.  This protocol is called <a href="http://tools.ietf.org/html/rfc3208">PGM (pragmatic general multicast)</a> .  Other reliable protocols over IP multicast, such as LBT-RM (from 29west) and SmartSockets (from TIBCO Software) are, in one way or another, a modification or implementation of PGM. <br><br><a name="habracut"></a><br><br>  Like many other good innovations in network software and hardware, the PGM specification originated inside Cisco Systems.  The main problem that they tried to solve in the process of standardization of a reliable multicast is control and protection from congestion in the network.  Congestion can usually occur due to messages that will not be able to be processed by listeners or excess service packets that reduce the useful throughput of the protocol. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The principles used in TCP, thanks to which the Internet works efficiently, are not suitable for multicast.  TCP allows you to dynamically change the amount of data that has been sent but not yet confirmed (transmission window) so that the sender of TCP messages can adapt to the listener.  It is clear that this is not suitable in the case when there are many listeners, and the sender is one. <br><br><h5>  Types of packages </h5><br><br>  To begin with, we will define terminology.  The protocol contains the following types of packets: <br>  ODATA - payload sent via multicast (IP Multicast) <br>  NAK is a negative acknowledgment packet sent by a unique (usually UDP) listener who found the missing ODATA to the next node in the path tree <br>  NCF - acknowledgment of receipt of the NAK, which the tree node sends by a multicast to all listeners in the subnet in which the NAK was received <br>  RDATA - the data packet of which is duplicated by ODATA, published by the sender on the multicast topic in response to the received NAK <br>  SPM - message paths and hertbit, packages are published on multicast at regular intervals and in the absence of ODATA packages <br><br><h5>  The main features of the protocol </h5><br>  Let's consider the following example: we have a grid for 100 wheelbarrows, each of which has a very different hardware and operating system.  We are developing a server application that sends messages at various small intervals (for example, the price of a stock) to applications that are running on these wheelbarrows.  To use transport unique protocols in this case means to copy data for each client.  The complexity of sending a package will grow linearly with an increase in the number of subscribers.  Multicast is just that wonderful technology that will allow to send one packet to several listeners, having made just one entry into the socket buffer on the sender's side, and the packet will be copied to the router.  Thus, an increase in the number of listeners will not affect the package delivery time. <br><img src="http://www.rtlogic.com/images/ds-pgm1.jpg" alt="image"><br><br>  This is great, but there is a problem: a multicast, like UDP, does not guarantee delivery and order of packets.  Even to people far from trading on the stock exchange, I think it is not difficult to guess what will happen with the application that will miss the quota for some symbol.  If the subscriber is a robot performing automatic purchases / sales for some strategies, then without receiving a quota, the robot does not know that the price has changed and can produce an unprofitable deal.  The most natural way to guarantee delivery is to use acknowledgment messages received (positive acknowledgment) as in TCP.  But here two problems arise - the first is that the server will have to process the confirmation from each subscriber, that is, the complexity will again become linear and the second is a large amount of multicast of the same data when packets are often lost. <br><br>  The PGM protocol solves the first problem by the fact that, instead of confirming each received message, this protocol confirms each missing message (negative acknowledgment).  Each protocol packet contains a sequence number and the listener sends a PGM acknowledgment to the sender of the package uniquely if it detects that one of the sequence numbers is missing.  In order to exclude the possibility of loss of the last packet in the series (tail-loss), the PGM source in the absence of useful messages sends special packets ‚Äî herbert beats (heartbeats) whose task is to maintain the current sequence number on the side of the listener. <br><br>  To solve the second problem, PGM stores and keeps up to date the path tree from each sender of multicast messages to listeners.  Each node of the tree knows where the packet came from, and if a leaf of the tree (the listener of multicast messages) found that the packet was not received, confirmation of the lost packet may go up from the leaf to the root of the tree (the sender of the multicast messages).  A status is set at each node of the tree, meaning that a packet is lost on the subnet.  When resending, a lost packet can be ignored on nodes where this state is not set and only reaches those subnets where the packet was lost.  Maintaining the path tree is achieved through path messages (messages) that are sent to multicast groups at equal intervals of time by each sender. <br><img src="https://habrastorage.org/getpro/habr/post_images/a7c/43b/6c5/a7c43b6c5da4e8828e68997a2c6d9858.jpg" alt="image"><br><br>  Do not confuse messages to maintain the current sequence number or hertbit and message path.  Although they duplicate the information that is delivered to the listeners, they differ in that the path messages are sent at regular intervals, while the Hertbits are sent using a more complex algorithm.  Hertbitas are defined by two parameters: the initial timet of the hertbit and the number of hertbitas.  The first hertbit is sent after a timeout after the last packet.  The second herbit is sent twice as long after the previous hertbit.  And so on until the right amount of Hertbeats has been sent. <br>  Schematically, it looks like this: <br>  | ____ | _________ | __________________ | _________________________________ | ____ <br>  time t -&gt; <br>  where the first dash is the last packet with the payload, and the rest are hertbit. <br><br><h5>  Nak storm </h5><br>  Not everything is as smooth in PGM as it may seem at first glance.  Many who try to use PGM drop out of business because of a problem known as NAK Storm.  If we go back to the example of a network over which shares are sent out, then there can be a NAK storm if one of the listeners is too slow and does not have time to read the data from the socket buffer.  Coming packets will be ignored because the buffer is clogged and such a client will send many NAK packets (crying baby receiver).  In response, the sender will have to publish RDATA packages, which will increase the load on the sender and on all its multicast subscribers, some of which can also become slow clients.  A NAK storm is dangerous in that a single source of PGM packets can have a lot of listeners.  After processing one NAK and sending an RDATA packet, the source can immediately receive a NAK on the same ODATA packet from another listener.  Plus, the listener who detects the loss of the ODATA packet will send a NAK until it receives the NCF.  This all can lead to a significant decrease in the protocol's efficiency, since most of the network bandwidth will be spent on sending NAK, NCF and RDATA instead of ODATA. <br><br>  The PGM protocol has several mechanisms for reducing the negative impact of various kinds of congestion in the network.  The number of NAKs that a source receives can be reduced with the help of special listeners of multicast messages - NAK aggregators (designated receiver).  These aggregators listen to NAKs on the subnet and send only one NAK to the source from the entire subnet.  There are routers capable of independently aggregating NAKs from a subnet, these are PGM routers. <br><br>  PGM also allows the presence of special network elements (designated local repairer or designated local retransmitter), which can independently respond with RDATA packets to the NAK.  This allows you to build a topology in which slow clients do not affect the work of students from other subnets. <br><img src="http://cygnus.cc.ncu.edu.tw/netflow/juniper/swconfig-multicast/pgm-overviewa.gif" alt="image"><br><br>  PGM also allows you to set different options - timeouts and counters to suppress the NAK storm.  The selection of these timeouts is a separate magic, in which lies the difficulty of working with PGM.  On the listeners side it <br><ul><li>  the time that passes after detecting packet loss before the first NAK is generated </li><li>  the time that passes before re-sending the NAK if the NCF was not received </li><li>  the time that passes from receiving the NCF to sending a new NAK if RDATA was not received </li><li>  maximum number of NAKs that a listener can send </li></ul><br>  On the sender side it is <br><ul><li>  the time that elapses between receiving the first NAK and sending the RDATA </li><li>  time for which duplicate NAKs are ignored after RDATA has been sent </li><li>  rate limit on which RDATA packets are sent (bytes per second) </li></ul><br>  In general, I think from the foregoing it is not difficult to guess why PGM and its variations have become so popular when developing systems with low response time (low-latency systems).  This protocol has a shorter response time than reliable protocols using positive packet acknowledgment, and allows you to increase the number of message listeners without compromising response time. <br><br>  A question for thought.  Why do GFS and Hadoop use TCP instead of reliable multicast?  It‚Äôs a known fact that all data is replicated in GFS and HFS to at least three different boxes.  Is it really possible to copy packets from a socket to a socket more efficiently or reliably than to replicate packets on network equipment? </div><p>Source: <a href="https://habr.com/ru/post/148444/">https://habr.com/ru/post/148444/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../148436/index.html">Command Pattern Remote Procedure Call (RPC) in Android</a></li>
<li><a href="../148437/index.html">How I used gem gon in Groupon</a></li>
<li><a href="../148438/index.html">Erlang plugin for IntelliJ IDEA version 0.4</a></li>
<li><a href="../148439/index.html">Is it possible to reduce the cost of implementing an ERP system?</a></li>
<li><a href="../148443/index.html">Five Years School Data Analysis</a></li>
<li><a href="../148445/index.html">What if you have a lot of third-party repositories</a></li>
<li><a href="../148446/index.html">A little about linkable variables (prepared statements)</a></li>
<li><a href="../148448/index.html">2nd Apps4All Contest: ideas, concepts and mobile apps for iOS, Android, WP7 and Bada</a></li>
<li><a href="../148449/index.html">Runetology (157): Evgeny Kobzev, Project Manager, Electronic Accountant Elba</a></li>
<li><a href="../148450/index.html">Microsoft has a patent agreement with amdocs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>