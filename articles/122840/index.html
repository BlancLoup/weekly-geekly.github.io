<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementation of the backend in multiplayer online games</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="During my short life, I have never met a programmer who would not like games. And even more so, a programmer who never wrote them. 
 Someone starts wi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementation of the backend in multiplayer online games</h1><div class="post__text post__text-html js-mediator-article">  During my short life, I have never met a programmer who would not like games.  And even more so, a programmer who never wrote them. <br>  Someone starts with Tetris, someone with a snake.  Someone passes this hobby, and someone ‚Äúgets sick‚Äù with this and turns his illness into a favorite job or an entertaining hobby. <br><br>  In the era of the Internet and social networks, it is not interesting to play alone, I want to communicate and play with friends. <br>  And not just to communicate, but to walk in a group in a dungeon or show who is the boss in the arena. <br>  In this article, I would like to talk about my approach to the server implementation of such interaction. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Task </h4><br>  Consider an example of a simple game application in which a player controls a character who can buy / sell items, fight in the arena, go to the dungeons alone or with friends. <br><br><h4>  Concept </h4><br>  For example, a player creates a group to go to a dungeon.  The player sends a request to our server, which adds a new group to the list of available groups for hikes, after which the other players have the opportunity to receive this list and join.  The group is filled, and, by pressing a button, the creator sends it to the dungeon to meet dangerous monsters. <br><br>  It would seem that everything is simple.  Create a table in the database, write down those who wish there and send it to the dungeon. <br>  So many novice programmers think, but they forget about the most important problem of multitasking systems - <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BE%25D1%2581%25D1%2582%25D0%25BE%25D1%258F%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25B3%25D0%25BE%25D0%25BD%25D0%25BA%25D0%25B8">race condition</a> . <br><br>  It is logical to assume that the correct implementation of such interaction would be a server daemon who was responsible for the state of the game world, received requests from players (in turn), processed them and gave the result. <br>  In our case, the server must keep the current state of the players in order to be able to correctly process the results. <br><br>  Schematically it looks like this: <br><br><img src="http://sapphire.questworld.ru/i/habr/scheme1.png" alt="The basic scheme of our demon"><br><br>  Perhaps the most interesting is the request handler. <br><br>  It contains the main logic of our server: <br>  - storing the status of players (free, located in a dungeon, in a group, etc.) <br>  - storing and processing information about the game world (battles in the arena, trips to dungeons, groups for trekking) <br><br>  We need to keep the player‚Äôs status so that, for example, while the character is engaged in the genocide of monsters in the dungeon, we couldn‚Äôt go to the arena or buy a new armor. <br><br>  In addition, the server should handle the game world. <br>  Let's say we went to the dungeon for 5 minutes.  In 5 minutes, the server must process the battle with the monsters, count the experience, drop, and also change the player‚Äôs state. <br><br>  It should be remembered that the number of players can be very large and our server will have a hard time. <br><br><h4>  Implementation </h4><br><br>  To implement such a demon, PHP 5.3 was chosen with the libevent extension as the most familiar to the author. <br>  There are many articles about libevent, the well-known phpDaemon has been created, so it doesn't make sense to delve into its work. <br>  It is worth noting the possibility of creating deferred events (the EV_TIMEOUT flag), which in our case solves a lot of problems. <br><br>  However, our server should, among other things, actively work with the database to record the results, buy things, etc. <br>  As is known, a database is a bottleneck of any serious application, and our server can ‚Äúlie down‚Äù from a large number of requests. <br><br>  Therefore, to handle "heavy" requests, you can provide an additional server daemon with the number of threads we need (thread / workers), which will be happy to do all the hard work. <br><br><img src="http://sapphire.questworld.ru/i/habr/scheme2.png" alt="Extra demon"><br><br>  It is worth noting that requests to work daemon also queued and are not processed until we receive a response. <br>  The principle of work daemon is the same as the main daemon, except for the presence of several threads (workers / workers) for processing requests. <br><br><h4>  findings </h4><br><br>  The advantages of this approach are as follows: <br>  - all the hard work we drop on the work daemon, and we leave the processing of player states on our main daemon, which makes it very lightweight and fast <br>  - work daemon can be taken out on a separate server, if necessary, and the number of workers varies depending on the iron <br>  - possibility of scaling <br><br>  And now about the shortcomings. <br>  The main lack of implementation: PHP flows.  Even the new garbage collector in 5.3 does not solve all the problems.  And we have: <br><br><img src="http://sapphire.questworld.ru/i/habr/munin.png" alt="Memory status for each worker"><br><br>  Solution: periodically overload the worker when the amount of memory used reaches a certain limit. <br><br>  The most correct solution I see is the use of the Erlang \ OTP programming language. <br>  The task set fits perfectly into his concept of FSM / gen_server, which the author plans to do in the near future. <br><br>  I hope that the article will help beginner game developers not to step on the rake and properly design their application. <br><br>  PS If this kind of topic is interesting to the residents of Habr, then he is ready to tell in more detail about each of the components of such a system. </div><p>Source: <a href="https://habr.com/ru/post/122840/">https://habr.com/ru/post/122840/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../122832/index.html">Conference site DevCon'11 published conference materials</a></li>
<li><a href="../122834/index.html">OAuth VKontakte: mercenary use</a></li>
<li><a href="../122835/index.html">Transparent proxying in I2P and Tor</a></li>
<li><a href="../122836/index.html">Check for monopoly</a></li>
<li><a href="../122839/index.html">The game "Terraria" and its "good" profile encryption system</a></li>
<li><a href="../122842/index.html">Home bookkeeping using Google Docs</a></li>
<li><a href="../122850/index.html">Startups Fertilization</a></li>
<li><a href="../122851/index.html">New console based on Dingux - R480</a></li>
<li><a href="../122853/index.html">T-shirt for phone</a></li>
<li><a href="../122855/index.html">On the issue of two-factor authentication using mobile devices</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>