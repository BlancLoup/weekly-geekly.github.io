<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Image palette clustering and PNG compression</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="annotation 
 In this article, the reader is offered the experience of developing an image compression algorithm stored in PNG format. Compression is a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Image palette clustering and PNG compression</h1><div class="post__text post__text-html js-mediator-article"><h4>  annotation </h4><br>  In this article, the reader is offered the experience of developing an image compression algorithm stored in PNG format.  Compression is accomplished by quantizing the palette using the K ‚Äì intragroup average classifier.  The source code of the algorithm written in the Java language is given.  Indicates problems and further ways to improve the algorithm. <br><a name="habracut"></a><br><h4>  Introduction </h4><br>  The PNG format (pronounced "ping") is intended for storing and transferring bitmaps.  The format provides a phased display of image data, storing information about the gamma index, the transparency of each pixel, as well as textual information.  The format uses an efficient lossless compression method [1]. <br>  A file (or data stream) in PNG format consists of an identification signature and at least three pieces of data.  The PNG defines four standard chunks, called critical chunks, which must be supported by all read and write programs [1]: <br><ol><li>  A portion of the header (IHDR). </li><li>  Palette Portion (PLTE) - stores color table data associated with image data.  This portion is present in the file only when the image data uses a color palette (color indexation). </li><li>  A portion of image data (IDAT). </li><li>  The final portion (IEND). </li></ol><br>  More information about the description and features of the PNG format is given in [2].  It also describes the compression algorithms used by the format and indicates the application. <br>  The main idea of ‚Äã‚Äãreducing the size of images stored in PNG format is to reduce the number of different colors represented in the image.  In this case, the loss of the initial number of colors may be completely invisible to the human eye.  According to the author, one of the most qualitative programs for today (02.2011) is the Color Quantizer (CQ) [3].  The main features of this program include: <br><ul><li>  converting to any number of colors </li><li>  convenient palette editing </li><li>  batch optimization. </li></ul><br>  As a test pattern for further research, we select an image from [4], presented in Figure 1 below.  Note that Figure 1 does not contain the alpha channel and the chess background is only an imitation.  The original image contains 43,500 unique colors.  Using the CQ program, table 1 was compiled containing data on the number of colors left on the image and the size of the output file.  When compressed in CQ, an error level of 25% was set. <br>  Table 1 - Indicators of image compression using the CQ program <br><table border="1"><tbody><tr><td>  <b>Number of colors, count</b> </td><td>  <b>Size, bytes on disk</b> </td></tr><tr><td>  43,500 (original) </td><td>  184 320 </td></tr><tr><td>  4096 </td><td>  147 456 </td></tr><tr><td>  1024 </td><td>  106,496 </td></tr><tr><td>  256 </td><td>  53,248 </td></tr></tbody></table><br>  As can be seen from the data in Table 1, reducing the number of colors to 256, the size of the resulting file is 53,248 bytes, which is almost 3.5 times smaller than the original file. <br><br><img src="https://habrastorage.org/storage/habraeffect/f5/fe/f5fe602870cef838320fbe057c261f8c.png" alt="Test image"><br>  Figure 1 - Test image format PNG for research, resolution - 800x600 <br><br><img src="https://habrastorage.org/storage/habraeffect/54/a0/54a03020469d10e3b56dd5fd4babc25b.png" alt="Compressed image using QE, 256 colors"><br>  Figure 2 - Compressed to 256 color image using the program Color Quantizer 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage/habraeffect/b3/fe/b3fe16a753aaba7959a79ece061dae8f.png" alt="Compressed image using the developed algorithm, 256 colors"><br>  Figure 3 - Compressed to 256 color image using the developed algorithm <br><br>  Naturally, such a serious loss of color can not pass without a trace for the image, but in this case it is insignificant in the author‚Äôs opinion.  Figure 2 shows a compressed image with up to 256 colors.  Thus, you can significantly reduce the amount of PNG images by simply reducing the number of colors, which is especially important when using images on the web.  However, it is not so easy to do this, the CQ program has a significant drawback - an extremely slow speed of work, which makes it difficult to use it in real time, for example, when transmitting data of geographic information systems.  It turns out that the time it takes to compress an image is several times longer than the time required to transfer the original - uncompressed image. <br>  In the next chapter, a very simple and fairly fast algorithm will be described, which allows in real time to reduce the number of colors in an image by quantizing (clustering) a palette (here we are not talking about PLTE portions) of an image. <br><br><h4>  Image Clustering Algorithm </h4><br>  An image palette is a variety of colors used in an image.  If the image is stored in RGB format, then each point of this set has three coordinates - Red, Green, Blue;  and if in the ARGB format, another, very important component is added - the alpha channel or transparency. <br>  The palette can be represented by a set of points in three-dimensional for RGB or four-dimensional for ARGB spaces.  Due to the presence of smooth transitions and halftone colors in the image, the dots will form ‚Äúclouds‚Äù - the so-called clusters, where all the points of one cluster have a color close to each other.  Therefore, for points that fall into one cluster, you can assign one averaged (one of the options) color, and thereby reduce the dimension of the set - the palette. <br>  However, it is first necessary to determine the measure of proximity between colors.  There are many options, all based on the construction of a space of colors which is visually evenly [5].  In this article, the author applies the most <b>simple</b> approach - a weighted Euclidean metric is selected.  In this case, the distance between the colors in the ARGB format is determined by the formula <br><img src="https://habrastorage.org/storage/habraeffect/5c/40/5c40b12c530cd84bb463d0f40ae94896.png" alt="image"><br>  where <i>x</i> and <i>y</i> are the colors with the components <i>{x <sub>A</sub> , x <sub>R</sub> , x <sub>G</sub> , x <sub>B</sub> }, {y <sub>A</sub> , y <sub>R</sub> , y <sub>G</sub> , y <sub>B</sub> }</i> and <i>Œ±, Œ≤, Œ≥, Œµ</i> are parameters that may provide visual uniformity which are selected experimentally. <br>  A number of data clustering algorithms have been developed [6], one of the simplest algorithms is K ‚Äì intragroup averages, which is used if the number of clusters into which many objects are divided (in our case, many colors) is known.  The algorithm can be represented by the following steps: <br><ul><li>  0. For N required clusters, any N points of the set are taken, for example, the first by number. </li><li>  1. For each cluster found, we calculate the center ‚Äî the average value (center of mass) among all the objects included in it. </li><li>  2. For each object from the set, we calculate the set of distances to each of the N clusters. </li><li>  3. We assign each object of a set to that cluster, the distance to which is minimal. </li><li>  4. Go to step 1 until some formal criterion for the quality of clustering is satisfied. </li></ul><br>  The author used the following stopping criterion for an iterative clustering algorithm: iterations stop if the number of objects that changed their cluster at the current step is equal to the number of the same objects at the previous step. <br>  The implementation of this algorithm does not cause significant difficulties.  The file attached to the article shows the source code of the algorithm.  To work with the PNG image, the PNGEncoder module [7] is used. <br>  <a href="">Link to download archive with source text</a> <br><br><h4>  An example of calling the function of reducing the number of colors </h4><br> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; <font color="#008000">//  PNG </font> PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); <font color="#008000">//  </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); <font color="#008000">// </font> encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> <font color="#008000">//   ( PLTE) -       255</font> encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); <font color="#008000">//   </font> FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> <blockquote><ol><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; <font color="#008000">//  PNG </font> PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); <font color="#008000">//  </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); <font color="#008000">// </font> encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> <font color="#008000">//   ( PLTE) -       255</font> encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); <font color="#008000">//   </font> FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; <font color="#008000">//  PNG </font> PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); <font color="#008000">//  </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); <font color="#008000">// </font> encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> <font color="#008000">//   ( PLTE) -       255</font> encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); <font color="#008000">//   </font> FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; <font color="#008000">//  PNG </font> PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); <font color="#008000">//  </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); <font color="#008000">// </font> encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> <font color="#008000">//   ( PLTE) -       255</font> encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); <font color="#008000">//   </font> FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; //  PNG  PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); <font color="#008000">//  </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); <font color="#008000">// </font> encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> <font color="#008000">//   ( PLTE) -       255</font> encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); <font color="#008000">//   </font> FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; <font color="#008000">//  PNG </font> PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); <font color="#008000">//  </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); <font color="#008000">// </font> encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> <font color="#008000">//   ( PLTE) -       255</font> encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); <font color="#008000">//   </font> FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; <font color="#008000">//  PNG </font> PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); <font color="#008000">//  </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); <font color="#008000">// </font> encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> <font color="#008000">//   ( PLTE) -       255</font> encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); <font color="#008000">//   </font> FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; <font color="#008000">//  PNG </font> PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); //   CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); <font color="#008000">// </font> encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> <font color="#008000">//   ( PLTE) -       255</font> encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); <font color="#008000">//   </font> FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; <font color="#008000">//  PNG </font> PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); <font color="#008000">//  </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); <font color="#008000">// </font> encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> <font color="#008000">//   ( PLTE) -       255</font> encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); <font color="#008000">//   </font> FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; <font color="#008000">//  PNG </font> PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); <font color="#008000">//  </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); //  encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> <font color="#008000">//   ( PLTE) -       255</font> encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); <font color="#008000">//   </font> FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; <font color="#008000">//  PNG </font> PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); <font color="#008000">//  </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); <font color="#008000">// </font> encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> <font color="#008000">//   ( PLTE) -       255</font> encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); <font color="#008000">//   </font> FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; <font color="#008000">//  PNG </font> PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); <font color="#008000">//  </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); <font color="#008000">// </font> encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> <font color="#008000">//   ( PLTE) -       255</font> encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); <font color="#008000">//   </font> FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; <font color="#008000">//  PNG </font> PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); <font color="#008000">//  </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); <font color="#008000">// </font> encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> //   ( PLTE) -       255 encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); <font color="#008000">//   </font> FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; <font color="#008000">//  PNG </font> PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); <font color="#008000">//  </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); <font color="#008000">// </font> encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> <font color="#008000">//   ( PLTE) -       255</font> encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); <font color="#008000">//   </font> FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; <font color="#008000">//  PNG </font> PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); <font color="#008000">//  </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); <font color="#008000">// </font> encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> <font color="#008000">//   ( PLTE) -       255</font> encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); //    FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; <font color="#008000">//  PNG </font> PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); <font color="#008000">//  </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); <font color="#008000">// </font> encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> <font color="#008000">//   ( PLTE) -       255</font> encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); <font color="#008000">//   </font> FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; <font color="#008000">//  PNG </font> PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); <font color="#008000">//  </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); <font color="#008000">// </font> encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> <font color="#008000">//   ( PLTE) -       255</font> encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); <font color="#008000">//   </font> FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; <font color="#008000">//  PNG </font> PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); <font color="#008000">//  </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); <font color="#008000">// </font> encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> <font color="#008000">//   ( PLTE) -       255</font> encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); <font color="#008000">//   </font> FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; <font color="#008000">//  PNG </font> PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); <font color="#008000">//  </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); <font color="#008000">// </font> encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> <font color="#008000">//   ( PLTE) -       255</font> encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); <font color="#008000">//   </font> FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> </ol> <code><code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; <font color="#008000">//  PNG </font> PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); <font color="#008000">//  </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); <font color="#008000">// </font> encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> <font color="#008000">//   ( PLTE) -       255</font> encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); <font color="#008000">//   </font> FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); * This source code was highlighted with <font color="gray">Source Code Highlighter</font> . <br></font></code></code> </blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#2B91AF">String</font> imageFileName = <font color="#A31515">"D:/Projects/PNG/big.png"</font> ; <font color="#2B91AF">String</font> outImageFileName = <font color="#A31515">"D:/Projects/PNG/bigout"</font> ; <font color="#0000ff">int</font> ColorCounts = 255; <font color="#008000">//  PNG </font> PngImage image = <font color="#0000ff">new</font> PngImage(); BufferedImage bufImage = image.read( <font color="#0000ff">new</font> <font color="#2B91AF">File</font> (imageFileName)); <font color="#008000">//  </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , ColorCounts); <font color="#008000">// </font> encoder.setColorType(encoder.COLOR_INDEXED_ALPHA); <font color="#008000">//   </font> encoder.setCompression(encoder.BEST_COMPRESSION); <font color="#008000">//   PNG</font> <font color="#008000">//   ( PLTE) -       255</font> encoder.setIndexedColorMode(encoder.INDEXED_COLORS_AUTO); <font color="#008000">//   </font> FileOutputStream outfile = <font color="#0000ff">new</font> FileOutputStream(outImageFileName + <font color="#A31515">".png"</font> ); encoder.encode(bufImage, outfile); outfile.flush(); outfile.close(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br></code> <br>  Function signature <br> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Compression ( BufferedImage aImage, <font color="#008000">//   </font> boolean aUseFixedColorList, <font color="#008000">//      </font> <font color="#0000ff">int</font> aColorCount <font color="#008000">//     </font> ) <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> <blockquote><ol><li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Compression ( BufferedImage aImage, <font color="#008000">//   </font> boolean aUseFixedColorList, <font color="#008000">//      </font> <font color="#0000ff">int</font> aColorCount <font color="#008000">//     </font> ) <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Compression ( BufferedImage aImage, <font color="#008000">//   </font> boolean aUseFixedColorList, <font color="#008000">//      </font> <font color="#0000ff">int</font> aColorCount <font color="#008000">//     </font> ) <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Compression ( BufferedImage aImage, <font color="#008000">//   </font> boolean aUseFixedColorList, <font color="#008000">//      </font> <font color="#0000ff">int</font> aColorCount <font color="#008000">//     </font> ) <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Compression ( BufferedImage aImage, <font color="#008000">//   </font> boolean aUseFixedColorList, <font color="#008000">//      </font> <font color="#0000ff">int</font> aColorCount <font color="#008000">//     </font> ) <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Compression ( BufferedImage aImage, <font color="#008000">//   </font> boolean aUseFixedColorList, <font color="#008000">//      </font> <font color="#0000ff">int</font> aColorCount <font color="#008000">//     </font> ) <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Compression ( BufferedImage aImage, <font color="#008000">//   </font> boolean aUseFixedColorList, <font color="#008000">//      </font> <font color="#0000ff">int</font> aColorCount <font color="#008000">//     </font> ) <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> </ol> <code><code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Compression ( BufferedImage aImage, <font color="#008000">//   </font> boolean aUseFixedColorList, <font color="#008000">//      </font> <font color="#0000ff">int</font> aColorCount <font color="#008000">//     </font> ) * This source code was highlighted with <font color="gray">Source Code Highlighter</font> . <br></font></code></code> </blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Compression ( BufferedImage aImage, <font color="#008000">//   </font> boolean aUseFixedColorList, <font color="#008000">//      </font> <font color="#0000ff">int</font> aColorCount <font color="#008000">//     </font> ) <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br></code> <br>  The Compression function is static for the CPNGCompression class.  If the aUseFixedColorList parameter is set to true, then some colors in the image become ‚Äúuntouchable‚Äù ‚Äîthe list of such colors is configured in the static array of the CPNGCompression class.  Untouchable colors are introduced so that, for example, there is no mixing (when calculating the center of the cluster) of white and black with the formation of gray. <br>  It is logical to assume that the visual quality of the classification strongly depends on the coefficients in formula (1), which can be defined for a limited class of images, for example, the following values ‚Äã‚Äãare selected for special cartographic data: <i>Œ± = 100, Œ≤ = 30, Œ≥ = 59, Œµ = 11</i> <br>  Figure 3 shows the result of compressing up to 256 colors of the original image using the developed algorithm.  The total opening, compression and storage times were <b>4,700 ms</b> .  The size of the output file is <b>53,248 bytes</b> , as well as for the CQ program (Table 1).  As we can see, figure 3 compared to figure 2, has a changed background color - <i>visually it became closer to yellow than to gray</i> .  This defect is easily eliminated if you specify white and gray as the ‚Äúuntouchables‚Äù, which constitute the background. <br><br><h4>  Conclusion </h4><br>  The article describes one of the simplest clustering algorithms used in the task of reducing the number of colors in an image.  The algorithm is compared with the known solution - the CQ program.  Further improvements to the algorithm may be associated with <br><ul><li>  change the criterion for completing the iterations, </li><li>  modification of the distance between colors function, </li><li>  transition to another color space during clustering. </li></ul><br><br><h4>  Additions to the article - based on comments </h4><br>  The main article does not provide an image compressed by this algorithm using ‚Äúuntouchable colors‚Äù.  Set up untouchable colors as follows: <br> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#008000">//   </font> CPNGCompression.m_fixedColors = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; CPNGCompression.m_fixedColors[0] = 0xFF969696; CPNGCompression.m_fixedColors[1] = 0xFFFFFFFF; <font color="#008000">// </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , 256); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> <blockquote><ol><li> <code><code><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> //    CPNGCompression.m_fixedColors = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; CPNGCompression.m_fixedColors[0] = 0xFF969696; CPNGCompression.m_fixedColors[1] = 0xFFFFFFFF; <font color="#008000">// </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , 256); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#008000">//   </font> CPNGCompression.m_fixedColors = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; CPNGCompression.m_fixedColors[0] = 0xFF969696; CPNGCompression.m_fixedColors[1] = 0xFFFFFFFF; <font color="#008000">// </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , 256); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#008000">//   </font> CPNGCompression.m_fixedColors = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; CPNGCompression.m_fixedColors[0] = 0xFF969696; CPNGCompression.m_fixedColors[1] = 0xFFFFFFFF; <font color="#008000">// </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , 256); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#008000">//   </font> CPNGCompression.m_fixedColors = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; CPNGCompression.m_fixedColors[0] = 0xFF969696; CPNGCompression.m_fixedColors[1] = 0xFFFFFFFF; <font color="#008000">// </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , 256); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> <li> <code><code><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#008000">//   </font> CPNGCompression.m_fixedColors = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; CPNGCompression.m_fixedColors[0] = 0xFF969696; CPNGCompression.m_fixedColors[1] = 0xFFFFFFFF; //  CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , 256); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></font></code></code> </li> <li> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#008000">//   </font> CPNGCompression.m_fixedColors = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; CPNGCompression.m_fixedColors[0] = 0xFF969696; CPNGCompression.m_fixedColors[1] = 0xFFFFFFFF; <font color="#008000">// </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , 256); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </li> </ol> <code><code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#008000">//   </font> CPNGCompression.m_fixedColors = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; CPNGCompression.m_fixedColors[0] = 0xFF969696; CPNGCompression.m_fixedColors[1] = 0xFFFFFFFF; <font color="#008000">// </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , 256); * This source code was highlighted with <font color="gray">Source Code Highlighter</font> . <br></font></code></code> </blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#008000">//   </font> CPNGCompression.m_fixedColors = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [2]; CPNGCompression.m_fixedColors[0] = 0xFF969696; CPNGCompression.m_fixedColors[1] = 0xFFFFFFFF; <font color="#008000">// </font> CPNGCompression.Compression(bufImage, <font color="#0000ff">true</font> , 256); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br></code> <br>  Then the compression result of the algorithm considered here is the image: <br><img src="https://habrastorage.org/storage/habraeffect/00/fc/00fc0dcb6c61777b5b01962995f7cb71.png" alt="image"><br>  Figure 4 - Compressed image using <b>two untouchable</b> colors <br><br>  The size of this picture is also 53,243 bytes on the disk. <br><br>  I do not know how to make a comparison of the running time of the CQ program with the required accuracy. <br>  Using the system clock, with an accuracy of + -2 seconds, CQ compresses up to 256 colors in <b>34 seconds</b> , which is an order of magnitude worse than the result of the proposed algorithm. <br><br><h4>  Sources used </h4><br><ol><li>  D. Murray, W. Van Riper.  Encyclopedia of graphic file formats. </li><li>  Greg Roelofs, Ivan Zenkov, Dimok Busheff.  PNG: A simple introduction to the features of the format / <a href="http://rus-linux.net/zen/png_feature/png_feature.html">Link</a> </li><li>  Color Quantizer: A program that allows you to easily optimize images for the web / <a href="http://x128.ho.ua/color-quantizer.html">Link</a> </li><li>  Wikipedia, test image, GNU Free Documentation License / <a href="http://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25B0%25D0%25B9%25D0%25BB:PNG_transparency_demonstration_2.png">Link</a> </li><li>  A.I.  Kulikov, T.E.  Ovchinnikov.  Space CIE Luv, Algorithmic Foundations of Modern Computer Graphics / <a href="http://www.intuit.ru/department/graphics/graphalg/2/5.html">Reference</a> </li><li>  Overview of data clustering algorithms / <a href="http://habrahabr.ru/blogs/data_mining/101338/">Link</a> </li><li>  Package PNGEncoder for working with images in PNG, Java / <a href="http://catcode.com/pngencoder/">Link</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/113393/">https://habr.com/ru/post/113393/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113382/index.html">Texas Instruments is preparing a system-on-chip OMAP 5 with 3d support</a></li>
<li><a href="../113383/index.html">Hello again</a></li>
<li><a href="../113387/index.html">Good news for those who need HPC, HA and just an SSI cluster, finally</a></li>
<li><a href="../113390/index.html">Plankton Windows</a></li>
<li><a href="../113392/index.html">Writing a rating module for Joomla, or AJAX in Russian</a></li>
<li><a href="../113395/index.html">Would you be interested in the Russian Railways corporate blog about the company's IT infrastructure and technologies?</a></li>
<li><a href="../113397/index.html">Alien Dalvik to run Android applications on Maemo / MeeGo OS</a></li>
<li><a href="../113399/index.html">Natives from Google and Facebook showed an ‚Äúideal‚Äù task tracker</a></li>
<li><a href="../113401/index.html">Do users use weak passwords? Unofficial statistics</a></li>
<li><a href="../113402/index.html">Jimbo and Wikipedia in watch advertising</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>