<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>API interface for free PBX and telephony</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A few weeks ago, the Zadarma project published its own API. It allows you to integrate the basic functions of IP-telephony and free cloud PBX. 
 Every...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>API interface for free PBX and telephony</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/75f/1ba/a57/75f1baa577c0b72e3a10013594d1c2d8.jpg" alt="image">  A few weeks ago, the Zadarma project published its own API.  It allows you to integrate the basic functions of IP-telephony and free cloud PBX. <br>  Everyone can create a free cloud PBX in few minutes and connect the API interface to it, and through it, integrate the PBX with their applications. <br>  In the article we publish a list and description of methods, references to classes and examples that already exist (PHP classes are published).  We are extremely interested in your feedback: for the further development of the API interface, integration with CRM and other systems. <br><br><a name="habracut"></a><br><h3>  The main functions available in the API: </h3><br><ul><li>  displaying and changing the settings of SIP accounts (including setting / changing number forwarding, the ability to bind to the SIM-card); </li><li>  balance display, selection of statistics with different details (both SIP and free PBX); </li><li>  making outgoing calls (CallBack function to external and internal numbers); </li><li>  sending SMS messages (outside the Russian Federation); </li><li>  notifying your server of each incoming call to the PBX, as well as the routing of these calls by your application. </li></ul><br>  Current functions will be enough for easy integration of CRM, call tracking and similar systems.  We are open to suggestions for expanding the functionality of the API in future versions, for tighter integration with any services. <br>  A full official description of all methods is available on the <a href="https://zadarma.com/ru/support/api/">website</a> . <br><br><h3>  Available examples and classes: </h3><br>  Today, the full PHP class is available for working with the API, you can download it on <a href="https://github.com/zadarma/user-api-v1">Github</a> .  There are examples of working with all its functions. <br>  In addition to the official, there are alternative classes for working under PHP, and even for the Windows command line. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Authorization and getting started </h3><br>  To start working with the API, you must already have an account registered in the Zadarma system.  If you need a <a href="https://zadarma.com/ru/services/pbx/">free PBX</a> / <a href="https://zadarma.com/ru/tariffs/numbers/">numbers</a> / <a href="https://zadarma.com/ru/tariffs/roaming-sim/">SIM-card</a> , then they also better pre-enable. <br>  Next you need to get the keys for authorization in your <a href="https://ss.zadarma.com/api/">account</a> . <br>  Each request that needs authorization is accompanied by an additional header, of the form: <br>  " <b>Authorization: User Key: Signature"</b> <br>  The signature is made according to the following algorithm: <br><ul><li>  The array of transmitted parameters (GET, POST, PUT, DELETE) is sorted by the name of the key alphabetically; </li><li>  a query string is formed from the resulting array (for example, the http_build_query function in PHP), an example is ‚Äúfrom = DATEFROM &amp; to = DATETO ...‚Äù; </li><li>  and further - connected by the formula: </li><li>  string = method_name + query_string + md5 (query_string), </li><li>  where ‚Äúmethod_name‚Äù is a query string, starting from the domain (indicating the version of the API), before the beginning of the listing of parameters, for example - / v1 / sip / " </li><li>  The resulting string is cached using the sha1 algorithm with the user's private key: </li><li>  hash = hash (string, secret_key) </li><li>  and further the hash is encoded in base64 </li><li>  signature = base64_encode (hash) </li></ul><br>  PHP example: <br><pre><code class="php hljs">ksort($params); $paramsStr = http_build_query($params); $sign = base64_encode(hash_hmac(<span class="hljs-string"><span class="hljs-string">'sha1'</span></span>, $method . $paramsStr . md5($paramsStr), $secret)); $header = <span class="hljs-string"><span class="hljs-string">'Authorization: '</span></span> . $userKey . <span class="hljs-string"><span class="hljs-string">':'</span></span> . $sign;</code> </pre> <br><br><h3>  Format and limitations </h3><br>  Response formats: json (by default) and xml. <br>  To get a response from the API in xml format, the parameter ‚Äúformat = xml‚Äù is added to the query string. <br>  Each answer contains information about limits and the current request, for example: <br><pre> <code class="xml hljs">X-Zadarma-Method: /v1/ X-RateLimit-Reset: 1434371160 X-RateLimit-Limit: 100 X-RateLimit-Remaining: 99</code> </pre>  Where, <br><ul><li>  X-Zadarma-Method - the current method being called; </li><li>  X-RateLimit-Remaining - the number of remaining requests, taking into account the limit on the method and per user; </li><li>  X-RateLimit-Limit - the total limit of hits per minute; </li><li>  X-RateLimit-Reset - time limit reset. </li></ul><br>  In the case of blocking, the method returns a response with the 429 header ‚ÄúYou exceeded the rate limit‚Äù. <br>  The answer consists of a mandatory key "status" (success or error).  Further, depending on the method, they give their keys with the requested information. <br>  In case of an error, an additional message key is given with a description of the error. <br><br><h3>  An example of an outgoing call through the API </h3><br>  Outgoing calls are made via CallBack (description of the Callback <a href="https://zadarma.com/ru/services/calls/callback/">here</a> ). <br>  Scheme of work: <br><ol><li>  You receive an API request to the Zadarma server </li><li>  You receive an incoming call and listen to the message ‚ÄúWait for the call‚Äù </li><li>  The server sends a second call to the phone of the subscriber you need. </li><li>  When the subscriber answered the call, you can communicate. </li></ol><br><img src="https://zadarma.com/images/harbr/2015_08_06/001_ru.jpg" alt="CallBackZadarma"><br>  Pay attention: both on the place of ‚Äúyour phone‚Äù and on the place of ‚Äúthe phone you are calling to‚Äù can be your SIP-login or internal PBX number.  This allows you to make outgoing calls from office IP-phones / gateways / SIP programs as well as calls within the network. <br>  Method name: <b>/ v1 / request / callback /</b> <br>  Options: <br><ul><li>  from - your phone number or SIP, which is called callback; </li><li>  to - telephone or SIP phone number; </li><li>  sip (optional) - SIP-user number if he wants to use a specific CallerID assigned to this SIP-ohm; </li><li>  predicted (optional) - if this flag is specified, the request is predicative (the system initially calls the ‚Äúto‚Äù number and only if it dials, connects to your SIP or telephone number); </li></ul><br>  Sample answer: <br>  <b>Json</b> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"status"</span></span>:<span class="hljs-string"><span class="hljs-string">"success"</span></span>, <span class="hljs-string"><span class="hljs-string">"from"</span></span>: <span class="hljs-number"><span class="hljs-number">442037691880</span></span>, <span class="hljs-string"><span class="hljs-string">"to"</span></span>: <span class="hljs-number"><span class="hljs-number">442037691881</span></span>, <span class="hljs-string"><span class="hljs-string">"time"</span></span>: <span class="hljs-number"><span class="hljs-number">1435573082</span></span> }</code> </pre>  <b>XML</b> <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">answer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status</span></span></span><span class="hljs-tag">&gt;</span></span>success<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">from</span></span></span><span class="hljs-tag">&gt;</span></span>442037691880<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">from</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">to</span></span></span><span class="hljs-tag">&gt;</span></span>442037691881<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">to</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">time</span></span></span><span class="hljs-tag">&gt;</span></span>1435573082<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">time</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">answer</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  <b>PHP</b> example with Zadarma class: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include_once</span></span> <span class="hljs-string"><span class="hljs-string">'include.php'</span></span>; $params = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'from'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'442037691880'</span></span>, <span class="hljs-string"><span class="hljs-string">'to'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'442037691881'</span></span>, <span class="hljs-comment"><span class="hljs-comment">// 'sip' =&gt; 'YOURSIP' ); $zd = new \Zadarma_API\Client(KEY, SECRET); $answer = $zd-&gt;call('/v1/request/callback/', $params); $answerObject = json_decode($answer); if ($answerObject-&gt;status == 'success') { print_r($answerObject); } else { echo $answerObject-&gt;message; }</span></span></code> </pre><br><br><h4>  Convenience for call centers </h4><br>  Especially for call centers there is the possibility of predicative dialing - the system initially calls the ‚Äúto‚Äù number and only if it dials, connects to your SIP or telephone number. <br>  For example: you have a large list of numbers where to call and several employees of a call center; with predictive dialing, you do not need employees to dial numbers one by one and wait for the result (losing working time). <br>  For convenient call-up of numbers from the call center: <br><ul><li>  pass the list of numbers through calls to the API callback function </li><li>  in the from parameter, specify the number of your free PBX, to which the call center employees are connected, also indicate the predicted flag </li><li>  is ready!  The system will call your customers, and only if the customer picks up the phone and your employees receive an incoming call and the conversation begins.  Considerable time savings for employees. </li></ul>  Note: The system will make such a call only if it has more than a quarter of valid numbers. <br><br><h3>  Incoming Call Notification </h3><br>  Zadarma system can send information about each incoming call to the virtual PBX and route the call to the desired extension number, depending on the answer.  To do this, you need to create a public link that will receive POST requests with information from the Zadarma system. <br>  In order for the system to accept the link, you must add a verification code at the beginning of the script. <br>  PHP example: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'zd_echo'</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'zd_echo'</span></span>]); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre>  Parameters that are sent to the callback link: <br><ul><li>  caller_id - caller number; </li><li>  called_did - the number to which they called; </li><li>  callstart - the start time of the call </li></ul>  For each request, you can ‚Äúon the fly‚Äù change the scenario for the current call by sending in response to the information: <br><pre> <code class="php hljs">{ <span class="hljs-string"><span class="hljs-string">"redirect"</span></span>: ID, <span class="hljs-string"><span class="hljs-string">"caller_name"</span></span>: NAME }</code> </pre>  Where, <br><ul><li>  redirect ‚Äî id of the redirect script or internal PBX number, or ‚Äúblacklist‚Äù - in this case the call will be rejected with a busy signal; </li><li>  caller_name - you can give the name of the incoming number. </li></ul><br>  Sample PHP code: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'zd_echo'</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'zd_echo'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($_POST) { $callerId = $_POST[<span class="hljs-string"><span class="hljs-string">'caller_id'</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// number of calling party; $calledDid = $_POST['called_did']; // number of called party; $callstart = $_POST['callstart']; // start time of call /* // For each request you can easily change work scenario for current call by sending in response on information: echo json_encode(array( 'redirect' =&gt; 1, 'caller_name' =&gt; 'TestName' )); exit(); */ }</span></span></code> </pre><br><h3>  Full list of API methods: </h3><br>  <b>/ v1 / info / balance /</b> - current user balance; <br>  <b>/ v1 / info / price /</b> - the cost of the call, taking into account the current rate of the user; <br>  <b>/ v1 / request / callback /</b> - callback request (described above); <br>  <b>/ v1 / sip /</b> - list of user SIP-numbers; <br>  <b>/ v1 / sip / callerid /</b> - change CallerID (from purchased or confirmed numbers); <br>  <b>/ v1 / sip / redirection /</b> - display of current redirects on user SIP-numbers, redirection on / off, change of redirection parameters; <br>  <b>/ v1 / sms / send /</b> - sending SMS; <br>  <b>/ v1 / statistics /</b> - getting general statistics; <br>  <b>/ v1 / statistics / pbx /</b> - statistics on free PBX. <br><br>  In the future, an increase in the number of methods is planned.  If you think that there are methods that need to be added to the API - write in the comments. </div><p>Source: <a href="https://habr.com/ru/post/264279/">https://habr.com/ru/post/264279/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264269/index.html">Your cloud hosting in 5 minutes. Part 3: Consul, Registrator, Consul-Template</a></li>
<li><a href="../264271/index.html">Preparing ASP.NET5, issue number 2 - repeat the basics for the most beginners</a></li>
<li><a href="../264273/index.html">ESET & Intel Security on Black Hat USA 2015</a></li>
<li><a href="../264275/index.html">SIP registration, trunk, softphone and other scary words of cloud PBX</a></li>
<li><a href="../264277/index.html">HP is the leader of the Gartner Magic Quadrant for modular servers</a></li>
<li><a href="../264281/index.html">PostgreSQL 9.5: what's new? Part 1. INSERT ... ON CONFLICT DO NOTHING / UPDATE and ROW LEVEL SECURITY</a></li>
<li><a href="../264283/index.html">Welcome to Windows Camp - September 10, Moscow</a></li>
<li><a href="../264285/index.html">Data Science: the path to professionalism</a></li>
<li><a href="../264287/index.html">Two-factor authentication. New challenges</a></li>
<li><a href="../264289/index.html">Making the code cleaner: Refactoring the PCI driver for a NAND Denali controller</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>