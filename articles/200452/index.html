<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Multiple DNS servers: why it is hosted and how it is implemented in Parallels Plesk Panel</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prehistory 
 Puzzled by receiving feedback and more accurate prioritization of tasks, the Plesk developers started an account on UserVoice - http://pl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Multiple DNS servers: why it is hosted and how it is implemented in Parallels Plesk Panel</h1><div class="post__text post__text-html js-mediator-article"><h4>  Prehistory </h4><br>  Puzzled by receiving feedback and more accurate prioritization of tasks, the Plesk developers started an account on UserVoice - <a href="http://plesk.uservoice.com/">http://plesk.uservoice.com</a> .  Thus, they organized a place where customers can offer their innovations, write what they don‚Äôt like, vote for the functions they need (the ones that get the most votes get into the design).  One of the popular requests we received from our users is ‚ÄúAutomate slave DNS support‚Äù.  This is a rather old feature request that almost all Plesk Server Administrators want.  In order to close this issue once and for all, we decided to make the appropriate Plesk extension.  What were the reasons to do it that way?  What exactly did we do? <br><a name="habracut"></a><br><br><br><br>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <br>  There are several reasons why a hoster may need at least two NS servers (or even more): <br><ul><li>  You bought a domain from a registrar.  In order for a domain to be delegated, most registrars (for example, Russian nic.ru, Reg.ru, webnames.ru, etc.) require that the domain zone be served by at least a couple of name server (NS); </li><li>  You have several servers with hosting, you have not yet ‚Äúgrown‚Äù to use products of the <a href="http://www.parallels.com/ru/products/automation/">Parallels Automation</a> level or <a href="http://www.parallels.com/ru/products/plesk-automation/">Parallels Plesk Automation</a> level, but you want to use a single set of NS servers for all domains hosted by you; </li><li>  You want to have your NS servers and not depend on third parties; </li><li>  You want your domain information in whois to have your NS servers.  For example, hereis data for whois on parallels.com: <br><pre><code class="bash hljs">Domain Name: PARALLELS.COM Registrar: MONIKER ONLINE SERVICES LLC Whois Server: whois.moniker.com ‚Ä¶ Name Server: NS1.PARALLELS.COM Name Server: NS2.PARALLELS.COM Name Server: NS3.PARALLELS.COM ‚Ä¶</code> </pre> </li></ul><br><br>  As you can see, there are enough reasons to have your own NS servers.  Usually, hosters configure a pair of name servers in master-slave mode to solve these problems.  At the same time, domain zones are created on both servers, but resource records of domain zones are managed only on the master.  A secondary (slave) name server downloads changes automatically from the wizard.  Thus, you always have two name servers with an identical set of domain zones and with an identical set of resource records. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/414/e4e/850/414e4e8509047492d5171f8d5bc1d8bd.jpg" alt="Schematic diagram"></div><br><br>  The only nasty little thing - you need to create / delete a zone on both servers.  Automatically this does not happen.  Therefore, we create a domain zone on the master.  Then we create a domain zone on the slave, specifying the address of the master server.  Everything, now, adding domain resource records on the master, we can be sure that the slave will automatically take them from there. <br><br><h4>  How did we implement it? </h4><br>  The integration of Parallels Plesk Panel and slave DNS for many years was not a very trivial task.  This implies that the Plesk server performs the role of a master.  Plesk has implemented slave / master modes for a domain zone, there is a global list of IP addresses that can be used to request domain zones.  But there is no mechanism for creating new domain zones on the slave server.  And will not.  Because the concept of Plesk is the hosting automation panel for a single server.  If you need integration of several servers, separation by types of services, then Parallels has other products: Parallels Plesk Automation, Parallels Operation Automation, and, finally, a large complex solution of Parallels Automation. <br><br>  ‚ÄúSo what's the problem?‚Äù You ask.  But the fact is that there are a number of Plesk users for whom the products listed above are not required, they are overqualified for solving their specific tasks.  And they only need integration with the slave-name server. <br><br>  To solve this problem, at one time each Plesk administrator wrote his own software solutions.  Or bought commercial.  Or manually performed the operation of creating / deleting domain zones on the slave server. <br><br>  It would seem that difficult?  Plesk has a local NS-server, let it be a master, there is an event system, let's hang up the execution of our script for the events "creating a DNS zone" and "deleting a DNS zone".  Everyone will be happy.  Unfortunately, there are no such events in Plesk. <br><br>  Plesk developers not only develop Plesk, but they themselves constantly use their product.  Therefore, we have made for Plesk users an extension that allows Plesk to integrate with the external slave-name server, on which BIND9 stands.  Download it for free, without SMS, please follow the link - <a href="">autoinstall.plesk.com/extensions/packages/slave-dns-manager-1.0-1.zip</a> <br><br><h4>  How it works? </h4><br>  Plesk uses BIND as the local NS server.  He has the ability to remote control using the standard utility rndc.  Nobody bothers us to put BIND on a remote server and manage it through rndc.  In Plesk 11.5, the ‚ÄúCustom DNS backend‚Äù mechanism appeared.  Through it, you can connect a third-party DNS service, such as AWS Route53.  You can read more about this in the <a href="http://download1.parallels.net/Plesk/PP11/11.5/Doc/en-US/online/plesk-extensions-guide/72158.htm">documentation</a> . <br><br>  In a nutshell, the meaning of this functionality can be described as the ability to register a script in Plesk that will receive a JSON description of the DNS zone, what needs to be done with the zone each time Plesk creates / updates / deletes any active zone.  That's all we need.  At implementation of this functionality it was meant that you will not put local BIND with Plesk, and you will use external service.  But!  Deleting a local BIND is not necessary.  The script can work in parallel with the local DNS-service.  This is the idea that our extension uses. <br><br>  The extension operation algorithm is as follows: <br><ol><li>  In the settings of the extension register slave-server </li><li>  The IP address of the slave server is automatically added to the list of those who are allowed to transfer domain zones from the Plesk server </li><li>  When an active domain zone is created / updated / deleted in Plesk, Plesk creates / changes / deletes a domain zone in a local DNS service </li><li>  Next, a script is launched that receives the domain name, the command (create / update / delete) </li><li>  The script runs the rndc command for each connected slave server. </li><li>  Slave Servers Synchronize Domain Zones from a Plesk Server </li></ol><br>  Thus, we got a very simple and very solid scheme of work with slave-name servers.  All the problems associated with the file format of the zones, the connection and the restart of the service are taken over by the DNS service itself.  The administrator only needs to configure the slave server once to work with an external Plesk.  Now you can go to the registrar and say that the Plesk server and the slave server are the NS servers of your domains.  And thanks to this, we solved all the tasks listed at the beginning of the post. <br><br><h5>  And now a little more, with lots of technical details. </h5><br>  Configure the slave name server (using the example of a server with Debian 7): <br><ol><li>  We put BIND <br><pre> <code class="bash hljs">apt-get install bind9</code> </pre></li><li>  We allow the creation of new zones through rndc.  In the <code>/etc/bind/named.conf.options</code> file, inside the options {} directive, we write: <br><pre> <code class="bash hljs">allow-new-zones yes;</code> </pre></li><li>  We specify from which IP address control commands can be received, and we tell BIND to listen to all available network interfaces.  In the <code>/etc/bind/named.conf.local</code> file <code>/etc/bind/named.conf.local</code> write: <br><pre> <code class="bash hljs">controls { inet * port 953 allow { &lt;PLESK_IP&gt;; &lt;ANOTHER_PLESK_IP&gt; 127.0.0.1; }; };</code> </pre></li><li>  Be sure to remember the access key, it is located in the <code>/etc/bind/rndc.key</code> file: <br><pre> <code class="bash hljs">key <span class="hljs-string"><span class="hljs-string">"rndc-key"</span></span> { algorithm hmac-md5; secret <span class="hljs-string"><span class="hljs-string">"vwOxonI4n4CVRUhKAOAAIA=="</span></span>; };</code> </pre></li></ol><br>  That's it, the configuration of the name server slave is over. <br><br>  The next step is to go to our Plesk and install the extension (we already said above where to download it).  On the extension page we add our slave server, specifying its IP and key.  The extension will create a configuration file for the rndc utility, which will contain the settings for our slave server.  Now Plesk will create all created, updated and deleted zones on the slave server automatically by executing the following commands for each configured slave server: <br><ul><li>  Creature <br><pre> <code class="bash hljs">/usr/sbin/rndc -c slave.config addzone example.com <span class="hljs-string"><span class="hljs-string">'{ type slave; file "/var/lib/bind/example.com"; masters { &lt;PLESK_IP&gt;; }; };'</span></span></code> </pre><br></li><li>  Update <br><pre> <code class="bash hljs">/usr/sbin/rndc -c slave.config refresh example.com</code> </pre><br></li><li>  Deletion <br><pre> <code class="bash hljs">/usr/sbin/rndc -c slave.config delzone example.com</code> </pre></li></ul><br>  Now, when adding domains to Plesk, the DNS zone is automatically created on both the master server and the slave server. <br><br>  By the way, we read the comments and answer the questions (also in our tech-blog of the Parallels Plesk Panel developers - also: <a href="http://devblog.plesk.com/">devblog.plesk.com</a> ). <br><br><h5>  Links </h5><br><ul><li>  <a href="http://download1.parallels.net/Plesk/PP11/11.5/Doc/en-US/online/plesk-extensions-guide/">How to write extensions for Plesk</a> </li><li>  <a href="">DNS slave integration extension</a> </li><li>  <a href="">AWS Route53 Integration Extension</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/200452/">https://habr.com/ru/post/200452/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../200436/index.html">Several interesting and useful things for a web developer (release 8)</a></li>
<li><a href="../200440/index.html">Hematite Ridge - A New Hope for Astrobiologists</a></li>
<li><a href="../200446/index.html">Automatic tests in the cloud</a></li>
<li><a href="../200448/index.html">How does the automatic selection of the document on the image in the program ABBYY FineScanner?</a></li>
<li><a href="../200450/index.html">The best in artistic disarray. A small review of Corel Painter X3</a></li>
<li><a href="../200454/index.html">Evolution and Genetic Algorithms</a></li>
<li><a href="../200456/index.html">DiemCms development team is recruited (OpenSource)</a></li>
<li><a href="../200458/index.html">Open data of Moscow and API Challenge competition based on them</a></li>
<li><a href="../200460/index.html">FOSS Sea technical conference: back-end based on free and open technologies</a></li>
<li><a href="../200462/index.html">5 reasons to teach children programming</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>