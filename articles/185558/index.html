<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Arranging text selection in textarea</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. 

 In the development of interfaces, it is sometimes possible to meet the task of highlighting user-entered text depending on certain condit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Arranging text selection in textarea</h1><div class="post__text post__text-html js-mediator-article">  Good day. <br><br>  In the development of interfaces, it is sometimes possible to meet the task of highlighting user-entered text depending on certain conditions.  (For example, a server grammar check was implemented, or it is necessary to highlight certain words / sections, etc., in a certain color) <br>  However, the textarea element does not support html \ bb tags.  As one of the solutions, use contenteditable in div elements. <br>  In this short article, I propose to consider in more or less detail how to select text using textarea. <br><a name="habracut"></a><br><br><h4>  General idea of ‚Äã‚Äãthe solution </h4><br>  Since there is no way to add tag support to the textarea, the next option is to use "layering." <br>  With the help of z-index and absolute positioning, we place the pre block behind the textarea we need. <br>  In the pre element we set up a font similar to the textarea and also set css properties that will allow us to mirror the text of the textarea block (about them just below) <br>  We will also create a class that, after each change in the content of the textarea, synchronizes data, searches for the data necessary for selection. <br>  Illustration of this solution: <br><img src="https://habrastorage.org/storage2/110/59e/be2/11059ebe21368277e2f38ffa04b50c0e.png"><br><h4>  Parse solution </h4><br>  Let's take the main task - creating a class that receives the values ‚Äã‚Äãof the target node (textarea) as input, functions - checks for the selection and font value (css of the font property) <br>  The class constructor must add a pre element to the DOM document model, position it, and hang events.  Here you can add the installation of css properties. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs cmake">/** *   <span class="hljs-string"><span class="hljs-string">""</span></span> textarea * @name TextareaExtension * @param <span class="hljs-keyword"><span class="hljs-keyword">target</span></span> -   textarea * @param processor -       * @param font -  */ <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> TextareaExtension(<span class="hljs-keyword"><span class="hljs-keyword">target</span></span> , processor, font) { var setStyleOptions = <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>() { //  (    ),   DOM,  font preItem.className = <span class="hljs-string"><span class="hljs-string">"text-area-selection"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>.parentNode.appendChild(preItem); <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>.style.font = preItem.style.font = font || <span class="hljs-string"><span class="hljs-string">"14px Ariel"</span></span>; // , ,     <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>.style.width = preItem.style.width = <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>.offsetWidth + <span class="hljs-string"><span class="hljs-string">"px"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>.style.height = preItem.style.height = <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>.offsetHeight + <span class="hljs-string"><span class="hljs-string">"px"</span></span>; preItem.style.top = <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>.offsetTop + <span class="hljs-string"><span class="hljs-string">"px"</span></span>; preItem.style.left = <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>.offsetLeft + <span class="hljs-string"><span class="hljs-string">"px"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>.style.background = <span class="hljs-string"><span class="hljs-string">"transparent"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>.style.overflow = <span class="hljs-string"><span class="hljs-string">"scroll"</span></span>; //  pre  margin   = <span class="hljs-number"><span class="hljs-number">1</span></span>em <span class="hljs-number"><span class="hljs-number">0</span></span>px.   . //( ,  span  pre   ) preItem.style.margin = <span class="hljs-string"><span class="hljs-string">"0px 0px"</span></span>; } setStyleOptions(); //  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">target</span></span>.addEventListener) { //     textarea <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">"change"</span></span>, this.analyse, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">"keyup"</span></span>, this.analyse, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); //     -    textarea  pre <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">"scroll"</span></span>, this.scrollSync, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); //    resize <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">"mousemove"</span></span>, this.resize, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">target</span></span>.attachEvent) { <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>.attachEvent(<span class="hljs-string"><span class="hljs-string">"onchange"</span></span>, this.analyse); <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>.attachEvent(<span class="hljs-string"><span class="hljs-string">"onkeyup"</span></span>, this.analyse); <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>.attachEvent(<span class="hljs-string"><span class="hljs-string">"onscroll"</span></span>, this.scrollSync); <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>.attachEvent(<span class="hljs-string"><span class="hljs-string">"mousemove"</span></span>, this.resize); } }</code> </pre> <br><br>  So, the frame of the class is created.  Define the remaining class methods: <br><br><pre> <code class="hljs javascript"> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scrollSync = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ preItem.scrollTop = target.scrollTop; }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.resize = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ preItem.style.width = target.style.width; preItem.style.height = target.style.height; preItem.style.top = target.offsetTop + <span class="hljs-string"><span class="hljs-string">"px"</span></span>; preItem.style.left = target.offsetLeft + <span class="hljs-string"><span class="hljs-string">"px"</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.analyse = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text = target.value; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> words = text.split(<span class="hljs-regexp"><span class="hljs-regexp">/[\s]/</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> textPosition = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> words) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (processor(words[i])) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> textIndex; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (text.indexOf) { textIndex = text.indexOf(words[i]); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> textIndex = findText(text, words[i]); result += text.substr(<span class="hljs-number"><span class="hljs-number">0</span></span>, textIndex) + <span class="hljs-string"><span class="hljs-string">"&lt;span class='text-color-bordered text-checker'&gt;"</span></span> + words[i] + <span class="hljs-string"><span class="hljs-string">"&lt;/span&gt;"</span></span>; text = text.substr(textIndex + words[i].length, text.length); } } result += text; preItem.innerHTML = result; };</code> </pre><br><br>  The analyze method iterates through each word, sending it to a function defined in advance.  If the word should be highlighted - the method copies the previous content to the pre and ‚Äúwraps‚Äù the necessary word in the span with the class that determines the selection method (in this example, the underscore underscore) <br>  For browsers that do not support the indexOf function, we define the direct search method - findText (in it we implement a direct pass through the arrays) <br><br><h4>  CSS properties </h4><br><br>  Here is a list of certain properties, and then analyze them: <br><pre> <code class="hljs css"><span class="hljs-selector-class"><span class="hljs-selector-class">.text-area-selection</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>:absolute; <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>:<span class="hljs-number"><span class="hljs-number">2px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">z-index</span></span>:-<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>:block; <span class="hljs-attribute"><span class="hljs-attribute">word-wrap</span></span>:break-word; <span class="hljs-attribute"><span class="hljs-attribute">white-space</span></span>:pre-wrap; <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>:white; <span class="hljs-attribute"><span class="hljs-attribute">overflow</span></span>:scroll; } <span class="hljs-selector-class"><span class="hljs-selector-class">.text-color-bordered</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">border-bottom</span></span>:<span class="hljs-number"><span class="hljs-number">1px</span></span> dotted red; }</code> </pre><br><br>  As already mentioned, the pre element must be positioned under the textarea, so we position it absolutely and set the z-index to -1.  Add indents, scrolls. <br>  We now turn to the definitions of word-wrap and white-space.  In this task, these properties play a very important role. <br>  white-space: pre-wrap allows you to take into account all the spaces in the lines and at the same time it does not allow you to continue the text horizontally (transfers it) if it does not fit in 1 line <br>  word-wrap: break-word - defines the behavior of the text, in which words that do not fit on 1 line do not stretch an element, but are transferred to another line. <br><br>  As a result, we get the selection of the text on the result of the work of our function: <br><img src="https://habrastorage.org/storage2/7b6/a9b/a56/7b6a9ba56582c2a402e1c467028ff762.png"><br><br>  Sources: <br>  <a href="https://github.com/xnimorz/textArea-selector">GitHub link</a> <br>  <a href="http://codepen.io/xnimorz/pen/iLsjv">Codepen</a> <br><br><h4>  Extensions </h4><br><br>  This example presents the operation method for the built-in function. <br>  In certain situations, there are cases when the result (select / not select) must be obtained from the server.  In this case, it is possible to use the pattern command to send only a list of changes to the server.  And, directly, the selection is organized in a separate callback function. </div><p>Source: <a href="https://habr.com/ru/post/185558/">https://habr.com/ru/post/185558/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../185544/index.html">Sony Tablet Z: waterproof tablet on humanized Android</a></li>
<li><a href="../185546/index.html">About the features of the security settings "Internet from MGTS"</a></li>
<li><a href="../185548/index.html">Target call from Yandex. Now with new features and conditions</a></li>
<li><a href="../185550/index.html">Earned "Video Parliament"</a></li>
<li><a href="../185556/index.html">Open program for developers from Thalmic Labs (MYO)</a></li>
<li><a href="../185562/index.html">Gypsum on 3d printer</a></li>
<li><a href="../185564/index.html">Oracle 12c Multitenant Architecture. New features for development and testing</a></li>
<li><a href="../185568/index.html">Automating Microsoft Outlook with VBA using the example of creating a mass mailing list</a></li>
<li><a href="../185574/index.html">Petition against the "anti-piracy" law became available on the website "Russian Public Initiative"</a></li>
<li><a href="../185580/index.html">0+ / 18+ to bet or not?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>