<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Web application development in PicoLisp</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Readers of the previous article A radical approach to application development may have rightly noted that the article is too theoretical. Therefore, I...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Web application development in PicoLisp</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  Readers of the previous article <a href="http://habrahabr.ru/post/177791/">A radical approach to application development</a> may have rightly noted that the article is too theoretical.  Therefore, I hasten to restore the balance of <s>good and evil</s> theory and practice. <br><br>  This article reveals only the tip of the iceberg called picoLisp.  Overboard were interesting moments concerning the interior of the database, the organization of a distributed database, debugging, functional I / O, an object model with multiple inheritance, PicoLisp Prolog ... <br><br>  I still hope that domestic programmers will look at this powerful tool. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Carefully, under the cut a lot of text and brackets! <br></blockquote><br><a name="habracut"></a><br>  <a href="">abu@software-lab.de</a> <br><h1>  Web application development in PicoLisp </h1><br>  ¬© Software Lab.  Alexander Burger <br><br>  This document provides an introduction to writing web applications in PicoLisp. <br><br>  It concentrates on the XHTML / CSS framework (unlike previous Java-AWT, Java-Swing, and plain-HTML frameworks), which is easier to use, more flexible in design, and independent of plug-ins, JavaScript, cookies, or CSS. <br><br>  A simple HTTP / HTML GUI has several advantages: it works in any browser and can be completely controlled by a script ("@ lib / scrape.l"). <br><br>  More precisely, CSS <i>can</i> be used to improve the layout.  And browsers <i>with</i> javascript will respond faster and more smoothly.  But this framework works fine in browsers that do not know anything about CSS or JavaScript.  All examples were also tested in a w3m text browser. <br><br>  PicoLisp system basic information: <a href="http://software-lab.de/doc/ref.html">PicoLisp Reference</a> and <a href="http://software-lab.de/doc/tut.html">PicoLisp Tutorial</a> .  Knowledge of HTML and some CSS and HTTP are assumed. <br><br>  The examples assume that PicoLisp was launched from a global installation (see <a href="http://software-lab.de/doc/ref.html">Installation</a> ). <br><br><ul><li>  <a href="https://habr.com/ru/post/178235/">Static pages</a> <br><ul><li>  <a href="https://habr.com/ru/post/178235/">Hello world</a> <br><ul><li>  <a href="https://habr.com/ru/post/178235/">Start Application Server</a> </li><li>  <a href="https://habr.com/ru/post/178235/">How it works?</a> </li></ul><br></li><li>  <a href="https://habr.com/ru/post/178235/">URL syntax</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Security</a> <br><ul><li>  <a href="https://habr.com/ru/post/178235/">File ".pw"</a> </li></ul></li><li> <a href="https://habr.com/ru/post/178235/"><code>html</code> function</a> </li><li>  <a href="https://habr.com/ru/post/178235/">CSS Attributes</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Tag Functions</a> <br><ul><li>  <a href="https://habr.com/ru/post/178235/">Simple tags</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Lists</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Tables</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Menus and Tabs</a> </li></ul></li></ul></li><li>  <a href="https://habr.com/ru/post/178235/">Interactive forms</a> <br><ul><li>  <a href="https://habr.com/ru/post/178235/">Sessions</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Forms</a> <br><ul><li>  <a href="https://habr.com/ru/post/178235/"><code>gui</code> function</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Control flow</a> </li><li>  <a href="https://habr.com/ru/post/178235/">URL switching</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Alerts and Conversations</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Calculator Example</a> </li></ul><br></li><li>  <a href="https://habr.com/ru/post/178235/">Charts</a> <br><ul><li>  <a href="https://habr.com/ru/post/178235/">Scroll</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Get and Put functions</a> </li></ul></li></ul></li><li>  <a href="https://habr.com/ru/post/178235/">GUI classes</a> <br><ul><li>  <a href="https://habr.com/ru/post/178235/">Input fields</a> <br><ul><li>  <a href="https://habr.com/ru/post/178235/">Numeric input fields</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Time and Date</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Phone numbers</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Checkboxes</a> </li></ul><br></li><li>  <a href="https://habr.com/ru/post/178235/">Field prefix classes</a> <br><ul><li>  <a href="https://habr.com/ru/post/178235/">Initialization</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Enable and disable</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Formatting</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Side effects</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Data validation</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Database connection</a> </li></ul><br></li><li>  <a href="https://habr.com/ru/post/178235/">Buttons</a> <br><ul><li>  <a href="https://habr.com/ru/post/178235/">Dialog Buttons</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Javascript</a> </li></ul></li></ul></li><li>  <a href="https://habr.com/ru/post/178235/">Minimum completed application</a> <br><ul><li>  <a href="https://habr.com/ru/post/178235/">Getting started</a> <br><ul><li>  <a href="https://habr.com/ru/post/178235/">Localization</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Navigation</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Object selection</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Editing</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Vs link buttons</a> </li></ul><br></li><li>  <a href="https://habr.com/ru/post/178235/">Data model</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Using</a> <br><ul><li>  <a href="https://habr.com/ru/post/178235/">Customer / Supplier</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Paragraph</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Order</a> </li><li>  <a href="https://habr.com/ru/post/178235/">Reports</a> </li></ul><br></li><li>  <a href="https://habr.com/ru/post/178235/">Errors</a> </li></ul></li></ul><br><hr><br><h2><a name="static"></a>  Static pages </h2><br>  PicoLisp can be used to create static HTML pages.  This in itself does not make much sense, since you can just as well write HTML-code, but it forms the basis for interactive applications and allows us to get acquainted with the application server and other basic concepts. <br><hr><br><h3><a name="hello"></a>  Hello world </h3><br>  To start with a minimal application, create a file ‚Äúproject.l‚Äù in the PicoLisp installation directory and enter the following two lines. <br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"Hello"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL <span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span> ) ########################################################################</code> </pre><br>  (We will use and modify this file in all of the following examples. Whenever you meet such a program fragment between the lines ('#####'), just copy and paste it into the project.l file and click on the button ‚ÄúRefresh‚Äù your browser to view the result) <br><br><h4><a name="server"></a>  Start Application Server </h4><br>  Open a terminal window and start the PicoLisp application server. <br><br><pre> <code class="lisp hljs">$ pil @lib/http.l @lib/xhtml.l @lib/form.l --server <span class="hljs-number"><span class="hljs-number">8080</span></span> project.l +</code> </pre><br>  A command prompt will not appear.  The server is running and waiting for a connection.  You can stop it later by pressing <code>Ctrl-C</code> in this terminal, or by running <code>killall pil</code> in another terminal window. <br><br>  (In the following examples, we assume that this HTTP server continues to work) <br><br>  Now open the URL ' <a href="http://localhost:8080/">http: // localhost: 8080</a> ' in the browser.  You should see a blank page with a single line of text. <br><br><h4><a name="how"></a>  How it works? </h4><br>  The line above loads the debugger (option ‚Äú+‚Äù), HTTP server code (‚Äú@ lib / http.l‚Äù), XHTML functions (‚Äú@ lib / xhtml.l‚Äù) and GUI-framework (‚Äú@ lib / form.l‚Äù , it will be required later for <a href="https://habr.com/ru/post/178235/">interactive forms</a> ). <br><br>  The <code>server</code> function is then called with the default port number and URL.  She will listen to this port for incoming HTTP requests in an endless loop.  Whenever a GET request arrives on port 8080, the project.l file will be loaded and executed using <a href="http://software-lab.de/doc/refL.html">(load)</a> <br><br>  During the execution of this file, all data written to the current output channel (STDOUT) is sent directly to the browser.  The code in ‚Äúproject.l‚Äù is responsible for generating HTML (or another format that is understandable for the browser). <br><br><hr><br><h3><a name="urlSyntax"></a>  URL Syntax </h3><br>  The application server uses a slightly specialized syntax when exchanging URLs with the client.  Part of the URL - ‚Äúpath‚Äù - what remains after trimming <br><br><ul><li>  protocol, node and port specifications, </li><li>  final question mark and arguments </li></ul><br>  interpreted according to some rules.  The most significant of them are: <br><ul><li>  If the path begins with an exclamation point ('!'), The rest (without the '!') Is taken as the name of a Lisp function.  All arguments after the question mark are passed to this function. </li><li>  If the path ends with a ‚Äú.l‚Äù (full stop and ‚ÄúL‚Äù), it is taken as the name of a Lisp file, which is then loaded with <a href="http://software-lab.de/doc/refL.html">(load)</a> .  This is the most common case, and we use it in our example ‚Äúproject.l‚Äù. </li><li>  If the file name extension matches an entry in the global mime <code>*Mimes</code> type table, the file is sent to the client with a mime-type and max-age value taken from this table. </li><li>  Otherwise, the file is sent to the client with the mime type ‚Äúapplication / octet-stream‚Äù and max-age in 1 second. </li></ul><br>  An application can expand or modify the <code>*Mimes</code> table with the <code>mime</code> function without restrictions.  for example <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">mime</span></span> <span class="hljs-string"><span class="hljs-string">"doc"</span></span> <span class="hljs-string"><span class="hljs-string">"application/msword"</span></span> <span class="hljs-number"><span class="hljs-number">60</span></span>)</code> </pre><br>  Defines a new mime type with max-age of one minute. <br><br>  The argument values ‚Äã‚Äãin the URL, after the path and question mark, are encoded to preserve Lisp data types: <br><br><ul><li>  Normal symbol (internal symbol) begins with a dollar symbol ("$") </li><li>  The number starts with a plus sign (+) </li><li>  External symbol (database object) begins with a dash ('-') </li><li>  The list (one-level only) is encoded with underscores ('_') </li><li>  Otherwise, it is a transit character (normal string). </li></ul><br>  Thus, high-level data types can be directly transferred to functions encoded in the URL, or assigned to global variables before loading the file. <br><br><hr><br><h3><a name="security"></a>  Security </h3><br>  Of course, this is a huge security hole, if any Lisp file can be loaded right from the URL and any function can be called.  For this reason, the application must take care to specify which files and functions are allowed in the URL.  The server checks the global variable <a href="http://software-lab.de/doc/refA.html">* Allow</a> , and when its value is not equal to <code>NIL</code> , denies access to what does not match its content. <br><br>  As a rule, <code>*Allow</code> do not change directly, but use the functions <a href="http://software-lab.de/doc/refA.html">allowed</a> and <a href="http://software-lab.de/doc/refA.html">allow</a> <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">allowed</span></span> (<span class="hljs-string"><span class="hljs-string">"app/"</span></span>) <span class="hljs-string"><span class="hljs-string">"!start"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> <span class="hljs-string"><span class="hljs-string">"customer.l"</span></span> <span class="hljs-string"><span class="hljs-string">"article.l"</span></span> )</code> </pre><br>  This is usually called at the beginning of the application and allows access to the app / directory, the start functions, and the @ lib.css, customer.l, and article.l files. <br><br>  Later in the program, <code>*Allow</code> can be dynamically extended with <code>allow</code> <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">allow</span></span> <span class="hljs-string"><span class="hljs-string">"!foo"</span></span>) (<span class="hljs-name"><span class="hljs-name">allow</span></span> <span class="hljs-string"><span class="hljs-string">"newdir/"</span></span> T)</code> </pre><br>  This adds the function ‚Äúfoo‚Äù and the directory ‚Äúnewdir /‚Äù to the set of allowed elements. <br><br><h4><a name="pw"></a>  File ".pw" </h4><br>  To be used in security monitoring (primarily to use the <code>psh</code> function, as in some later examples), you must create a file named ‚Äú.pw‚Äù in the PicoLisp installation directory.  This file must contain one line of arbitrary data for use as a password. <br><br>  The recommended way to create this file is to call the <code>pw</code> function defined in ‚Äú@ lib / http.l‚Äù <br><br><pre> <code class="lisp hljs">$ pil @lib/http.l -'pw <span class="hljs-number"><span class="hljs-number">12</span></span>' -bye</code> </pre><br>  Please run this command. <br><br><hr><br><h3><a name="htmlFoo"></a>  <code>html</code> function </h3><br>  Now back to our Hello World example.  Basically, you could write ‚Äúproject.l‚Äù as a sequence of output statements. <br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">prinl</span></span> <span class="hljs-string"><span class="hljs-string">"HTTP/1.0 200 OK^M"</span></span>) (<span class="hljs-name"><span class="hljs-name">prinl</span></span> <span class="hljs-string"><span class="hljs-string">"Content-Type: text/html; charset=utf-8"</span></span>) (<span class="hljs-name"><span class="hljs-name">prinl</span></span> <span class="hljs-string"><span class="hljs-string">"^M"</span></span>) (<span class="hljs-name"><span class="hljs-name">prinl</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;html&gt;"</span></span>) (<span class="hljs-name"><span class="hljs-name">prinl</span></span> <span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span>) (<span class="hljs-name"><span class="hljs-name">prinl</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;/html&gt;"</span></span>) ########################################################################</code> </pre><br>  but using the <code>html</code> function is much more convenient. <br><br>  In addition, <code>html</code> is nothing more than a print function.  You can easily see this if you connect the PicoLisp Shell ( <code>psh</code> ) to the server process (you had to generate a <a href="https://habr.com/ru/post/178235/">.pw file</a> for this) and enter the <code>html</code> function <br><br><pre> <code class="lisp hljs">$ /usr/lib/picolisp/bin/psh <span class="hljs-number"><span class="hljs-number">8080</span></span> : (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"Hello"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL <span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span>) HTTP/1.<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">200</span></span> OK Server: PicoLisp Date: Fri, <span class="hljs-number"><span class="hljs-number">29</span></span> Dec <span class="hljs-number"><span class="hljs-number">2006</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span>:<span class="hljs-number"><span class="hljs-number">28</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span> GMT Cache-Control: max-age=0 Cache-Control: no-cache Content-Type: text/html<span class="hljs-comment"><span class="hljs-comment">; charset=utf-8 &lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt; &lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"&gt; &lt;head&gt; &lt;title&gt;Hello&lt;/title&gt; &lt;base href="http://localhost:8080/"/&gt; &lt;link rel="stylesheet" type="text/css" href="http://localhost:8080/@lib.css"/&gt; &lt;/head&gt; &lt;body&gt;Hello World!&lt;/body&gt; &lt;/html&gt; -&gt; &lt;/html&gt; : # (type Ctrl-D here to terminate PicoLisp)</span></span></code> </pre><br>  Arguments for <code>html</code> : <br><br><ol><li>  <code>0</code> : The max-age value to control the browser cache (in seconds, zero means ‚Äúno-cache‚Äù).  You can set a higher value for pages that rarely change, or <code>NIL</code> to turn off the cache control. </li><li>  <code>"Hello"</code> : the name of the page. </li><li>  <code>"@lib.css"</code> : the name of the CSS file.  Pass <code>NIL</code> if you do not want to use CSS, or a list of file names if you want to use more than one CSS file. </li><li>  <code>NIL</code> : Specification of CSS attributes for the <code>body</code> tag (see the description <a href="https://habr.com/ru/post/178235/">of CSS attributes</a> below). </li></ol><br>  After these four arguments, an arbitrary number of expressions may follow.  They form the body of the page and are calculated according to special rules. <a name="tagRule"></a>  These rules are slightly different from the usual rules for computing: <br><br><ul><li>  If the argument is an atom (number or character / string), its value will be printed immediately. </li><li>  Otherwise (list), it is calculated as Lisp functions (usually these are some forms of the print operator). </li></ul><br>  Thus, our source file can also be written as: <br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"Hello"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">prinl</span></span> <span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span>) ) ########################################################################</code> </pre><br>  The most common printing features are some HTML tags: <br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"Hello"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">&lt;h1&gt;</span></span> NIL <span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span>) (<span class="hljs-name"><span class="hljs-name">&lt;br&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"This is some text."</span></span>) (<span class="hljs-name"><span class="hljs-name">ht</span></span><span class="hljs-symbol"><span class="hljs-symbol">:Prin</span></span> <span class="hljs-string"><span class="hljs-string">"And this is a number: "</span></span> (<span class="hljs-name"><span class="hljs-name">+</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>)) ) ########################################################################</code> </pre><br>  <code>&lt;h1&gt;</code> and <code>&lt;br&gt;</code> are tag functions.  <code>&lt;h1&gt;</code> takes the CSS attribute as its first argument. <br><br>  Note the use of <code>ht:Prin</code> instead of <code>prin</code> .  The <code>ht:Prin</code> function should be used to directly print in HTML pages, because it escapes special characters. <br><br><hr><br><h3><a name="cssAttr"></a>  CSS Attributes </h3><br>  <a href="https://habr.com/ru/post/178235/">The <code>html</code> function is</a> above and many of the <a href="https://habr.com/ru/post/178235/">tag functions</a> accept CSS attribute specifications.  This can be an atom, cons pairs, or a list of cons pairs.  Let's show it on the example of the <code>&lt;h1&gt;</code> . <br><br>  An atom (usually a character or a string) is taken as the name of a CSS class <br><br><pre> <code class="lisp hljs">: (<span class="hljs-name"><span class="hljs-name">&lt;h1&gt;</span></span> 'foo <span class="hljs-string"><span class="hljs-string">"Title"</span></span>) &lt;h1 class=<span class="hljs-string"><span class="hljs-string">"foo"</span></span>&gt;Title&lt;/h1&gt;</code> </pre><br>  For a cons pair, CAR is taken as attribute name and CDR as attribute value. <br><br><pre> <code class="lisp hljs">: (<span class="hljs-name"><span class="hljs-name">&lt;h1&gt;</span></span> '(id . bar) <span class="hljs-string"><span class="hljs-string">"Title"</span></span>) &lt;h1 id=<span class="hljs-string"><span class="hljs-string">"bar"</span></span>&gt;Title&lt;/h1&gt;</code> </pre><br>  Hence the list of cons pairs gives a set of attribute-value pairs. <br><br><pre> <code class="lisp hljs">: (<span class="hljs-name"><span class="hljs-name">&lt;h1&gt;</span></span> '((id . <span class="hljs-string"><span class="hljs-string">"abc"</span></span>) (lang . <span class="hljs-string"><span class="hljs-string">"de"</span></span>)) <span class="hljs-string"><span class="hljs-string">"Title"</span></span>) &lt;h1 id=<span class="hljs-string"><span class="hljs-string">"abc"</span></span> lang=<span class="hljs-string"><span class="hljs-string">"de"</span></span>&gt;Title&lt;/h1&gt;</code> </pre><br><hr><br><h3><a name="tags"></a>  Tag Functions </h3><br>  All the predefined functions of XHTML tags can be found in ‚Äú@ lib / xhtml.l‚Äù.  We recommend to take a look at their definitions and experiment a bit by executing them in the PicoLisp console, or by clicking the Refresh button of the browser after editing the project.l file. <br><br>  To get a suitable PicoLisp console, execute the PicoLisp Shell ( <code>psh</code> ) command in a separate terminal window (works only if the application server is running and you have created the <a href="https://habr.com/ru/post/178235/">‚Äú.pw‚Äù file</a> ) <br><br><pre> <code class="lisp hljs">$ /usr/lib/picolisp/bin/psh <span class="hljs-number"><span class="hljs-number">8080</span></span> :</code> </pre><br>  or just run the interpreter with the loading of the "@ lib / xhtml.l" module <br><br><pre> <code class="lisp hljs">$ pil @lib/http.l @lib/xhtml.l + :</code> </pre><br>  Note that for all these tag functions, the <a href="https://habr.com/ru/post/178235/">rules for calculating tag functions</a> apply. <br><br><h4><a name="simple"></a>  Simple Tags </h4><br>  Most of the tag functions are simple and straightforward.  Some of them just print their arguments. <br><br><pre> <code class="lisp hljs">: (<span class="hljs-name"><span class="hljs-name">&lt;br&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"Hello world"</span></span>) Hello world&lt;br/&gt; : (<span class="hljs-name"><span class="hljs-name">&lt;em&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"Hello world"</span></span>) &lt;em&gt;Hello world&lt;/em&gt;</code> </pre><br>  However, most of them accept a <a href="https://habr.com/ru/post/178235/">set of CSS attributes</a> as the first argument (as the <code>&lt;h1&gt;</code> above) <br><br><pre> <code class="lisp hljs">: (<span class="hljs-name"><span class="hljs-name">&lt;div&gt;</span></span> 'main <span class="hljs-string"><span class="hljs-string">"Hello world"</span></span>) &lt;div class=<span class="hljs-string"><span class="hljs-string">"main"</span></span>&gt;Hello world&lt;/div&gt; : (<span class="hljs-name"><span class="hljs-name">&lt;p&gt;</span></span> NIL <span class="hljs-string"><span class="hljs-string">"Hello world"</span></span>) &lt;p&gt;Hello world&lt;/p&gt; : (<span class="hljs-name"><span class="hljs-name">&lt;p&gt;</span></span> 'info <span class="hljs-string"><span class="hljs-string">"Hello world"</span></span>) &lt;p class=<span class="hljs-string"><span class="hljs-string">"info"</span></span>&gt;Hello world&lt;/p&gt;</code> </pre><br>  All these functions take an arbitrary number of arguments and can have an arbitrary depth of nesting (as long as the resulting HTML markup remains valid) <br><br><pre> <code class="lisp hljs">: (<span class="hljs-name"><span class="hljs-name">&lt;div&gt;</span></span> 'main (<span class="hljs-name"><span class="hljs-name">&lt;h1&gt;</span></span> NIL <span class="hljs-string"><span class="hljs-string">"Head"</span></span>) (<span class="hljs-name"><span class="hljs-name">&lt;p&gt;</span></span> NIL (<span class="hljs-name"><span class="hljs-name">&lt;br&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"Line 1"</span></span>) <span class="hljs-string"><span class="hljs-string">"Line"</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;nbsp&gt;</span></span>) (<span class="hljs-name"><span class="hljs-name">+</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) ) ) &lt;div class=<span class="hljs-string"><span class="hljs-string">"main"</span></span>&gt;&lt;h1&gt;Head&lt;/h1&gt; &lt;p&gt;Line <span class="hljs-number"><span class="hljs-number">1</span></span>&lt;br/&gt; Line <span class="hljs-number"><span class="hljs-number">2</span></span>&lt;/p&gt; &lt;/div&gt;</code> </pre><br><h4><a name="lists"></a>  Lists </h4><br>  HTML lists implemented by the <code>&lt;ol&gt;</code> and <code>&lt;ul&gt;</code> tags allow you to define hierarchical structures.  Paste the following code into your copy of ‚Äúproject.l‚Äù: <br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"Unordered List"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">&lt;ul&gt;</span></span> NIL (<span class="hljs-name"><span class="hljs-name">&lt;li&gt;</span></span> NIL <span class="hljs-string"><span class="hljs-string">"Item 1"</span></span>) (<span class="hljs-name"><span class="hljs-name">&lt;li&gt;</span></span> NIL <span class="hljs-string"><span class="hljs-string">"Sublist 1"</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;ul&gt;</span></span> NIL (<span class="hljs-name"><span class="hljs-name">&lt;li&gt;</span></span> NIL <span class="hljs-string"><span class="hljs-string">"Item 1-1"</span></span>) (<span class="hljs-name"><span class="hljs-name">&lt;li&gt;</span></span> NIL <span class="hljs-string"><span class="hljs-string">"Item 1-2"</span></span>) ) ) (<span class="hljs-name"><span class="hljs-name">&lt;li&gt;</span></span> NIL <span class="hljs-string"><span class="hljs-string">"Item 2"</span></span>) (<span class="hljs-name"><span class="hljs-name">&lt;li&gt;</span></span> NIL <span class="hljs-string"><span class="hljs-string">"Sublist 2"</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;ul&gt;</span></span> NIL (<span class="hljs-name"><span class="hljs-name">&lt;li&gt;</span></span> NIL <span class="hljs-string"><span class="hljs-string">"Item 2-1"</span></span>) (<span class="hljs-name"><span class="hljs-name">&lt;li&gt;</span></span> NIL <span class="hljs-string"><span class="hljs-string">"Item 2-2"</span></span>) ) ) (<span class="hljs-name"><span class="hljs-name">&lt;li&gt;</span></span> NIL <span class="hljs-string"><span class="hljs-string">"Item 3"</span></span>) ) ) ########################################################################</code> </pre><br>  Here you can also place arbitrary code in every node of this tree, including other tag functions. <br><br><h4><a name="tables"></a>  Tables </h4><br>  Like hierarchical structures, you can generate two-dimensional tables using the <code>&lt;table&gt;</code> and <code>&lt;row&gt;</code> functions. <br><br>  The following example displays a table of numbers and their squares: <br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"Table"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">&lt;table&gt;</span></span> NIL NIL NIL (<span class="hljs-name"><span class="hljs-name">for</span></span> N <span class="hljs-number"><span class="hljs-number">10</span></span> # A table with <span class="hljs-number"><span class="hljs-number">10</span></span> rows (<span class="hljs-name"><span class="hljs-name">&lt;row&gt;</span></span> NIL N (<span class="hljs-name"><span class="hljs-name">prin</span></span> (<span class="hljs-name"><span class="hljs-name">*</span></span> NN))) ) ) ) # and <span class="hljs-number"><span class="hljs-number">2</span></span> columns ########################################################################</code> </pre><br>  The first <code>&lt;table&gt;</code> argument is a regular CSS attribute, the second is an optional header, and the third is an optional list of column headers.  In this list, you can transfer the list for each column, from the CSS attribute to CAR, and the body of the tag to the CDR for the contents of the column header. <br><br>  The <code>&lt;table&gt;</code> body contains calls to the <code>&lt;row&gt;</code> function.  The feature of the function is that each expression in its body will go to a separate column of the table.  If a CSS attribute is specified for the column header and the <code>&lt;row&gt;</code> function, they will be combined with a space and passed to the <code>&lt;td&gt;</code> .  This allows you to specify different CSS attributes for each row and column. <br><br>  As an extension of the example table above, let's set some attributes for the table itself (although it‚Äôs not recommended to do this ‚Äî it‚Äôs better to define such styles in the CSS file and then just pass the class name to <code>&lt;table&gt;</code> ), align both columns to the right and output each string to variable (red and blue) colors <br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"Table"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">&lt;table&gt;</span></span> '((width . <span class="hljs-string"><span class="hljs-string">"200px"</span></span>) (style . <span class="hljs-string"><span class="hljs-string">"border: dotted 1px;"</span></span>)) # table style <span class="hljs-string"><span class="hljs-string">"Square Numbers"</span></span> # caption '((align <span class="hljs-string"><span class="hljs-string">"Number"</span></span>) (align <span class="hljs-string"><span class="hljs-string">"Square"</span></span>)) # <span class="hljs-number"><span class="hljs-number">2</span></span> headers (<span class="hljs-name"><span class="hljs-name">for</span></span> N <span class="hljs-number"><span class="hljs-number">10</span></span> # <span class="hljs-number"><span class="hljs-number">10</span></span> rows (<span class="hljs-name"><span class="hljs-name">&lt;row&gt;</span></span> (<span class="hljs-name"><span class="hljs-name">xchg</span></span> '(red) '(blue)) # red or blue N # <span class="hljs-number"><span class="hljs-number">2</span></span> columns (<span class="hljs-name"><span class="hljs-name">prin</span></span> (<span class="hljs-name"><span class="hljs-name">*</span></span> NN) ) ) ) ) ) ########################################################################</code> </pre><br>  If you want to combine two or more cells in a table so that one cell occupies several columns, you can pass the ‚Äú <code>-</code> ‚Äù symbol as an additional <code>&lt;row&gt;</code> parameter.  This will cause the data to the left of the " <code>-</code> " characters to be expanded to the right. <br><br>  You can also directly define the table structure with the usual tag functions, <code>&lt;th&gt;</code> , <code>&lt;tr&gt;</code> and <code>&lt;td&gt;</code> . <br><br>  If you just need a two-dimensional arrangement of components, you can use the even simpler <code>&lt;grid&gt;</code> function: <br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"Grid"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">&lt;grid&gt;</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-string"><span class="hljs-string">"A"</span></span> <span class="hljs-string"><span class="hljs-string">"B"</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> <span class="hljs-number"><span class="hljs-number">123</span></span> <span class="hljs-number"><span class="hljs-number">456</span></span> <span class="hljs-number"><span class="hljs-number">789</span></span> ) ) ########################################################################</code> </pre><br>  The first parameter is the number of columns (here: 3), and then one expression for each cell.  Instead of a number, you can also pass in a list of CSS attributes.  The length of this list will determine the number of columns.  You can change the second line in the above example to: <br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">&lt;grid&gt;</span></span> '(NIL NIL right)</code> </pre><br>  At the same time the third column will be aligned to the right. <br><br><h4><a name="menus"></a>  Menus and Tabs (Tabs) </h4><br>  The two most powerful tag functions are <code>&lt;menu&gt;</code> and <code>&lt;tab&gt;</code> .  When used alone or in combination, they form a navigation framework with <br><br><ul><li>  menu items where you can open and close submenus </li><li>  submenu items to navigate to different pages </li><li>  tabs (tabs), to go to different sub-pages </li></ul><br>  The following example is not very useful, because the URLs of all elements lead to the same page ‚Äúproject.l‚Äù, but this is enough to demonstrate the functionality: <br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"Menu+Tab"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">&lt;div&gt;</span></span> '(id . menu) (<span class="hljs-name"><span class="hljs-name">&lt;menu&gt;</span></span> (<span class="hljs-string"><span class="hljs-string">"Item"</span></span> <span class="hljs-string"><span class="hljs-string">"project.l"</span></span>) # Top level item (<span class="hljs-name"><span class="hljs-name">NIL</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;hr&gt;</span></span>)) # Plain HTML (<span class="hljs-name"><span class="hljs-name">T</span></span> <span class="hljs-string"><span class="hljs-string">"Submenu 1"</span></span> # Submenu (<span class="hljs-string"><span class="hljs-string">"Subitem 1.1"</span></span> <span class="hljs-string"><span class="hljs-string">"project.l"</span></span>) (<span class="hljs-name"><span class="hljs-name">T</span></span> <span class="hljs-string"><span class="hljs-string">"Submenu 1.2"</span></span> (<span class="hljs-string"><span class="hljs-string">"Subitem 1.2.1"</span></span> <span class="hljs-string"><span class="hljs-string">"project.l"</span></span>) (<span class="hljs-string"><span class="hljs-string">"Subitem 1.2.2"</span></span> <span class="hljs-string"><span class="hljs-string">"project.l"</span></span>) (<span class="hljs-string"><span class="hljs-string">"Subitem 1.2.3"</span></span> <span class="hljs-string"><span class="hljs-string">"project.l"</span></span>) ) (<span class="hljs-string"><span class="hljs-string">"Subitem 1.3"</span></span> <span class="hljs-string"><span class="hljs-string">"project.l"</span></span>) ) (<span class="hljs-name"><span class="hljs-name">T</span></span> <span class="hljs-string"><span class="hljs-string">"Submenu 2"</span></span> (<span class="hljs-string"><span class="hljs-string">"Subitem 2.1"</span></span> <span class="hljs-string"><span class="hljs-string">"project.l"</span></span>) (<span class="hljs-string"><span class="hljs-string">"Subitem 2.2"</span></span> <span class="hljs-string"><span class="hljs-string">"project.l"</span></span>) ) ) ) (<span class="hljs-name"><span class="hljs-name">&lt;div&gt;</span></span> '(id . main) (<span class="hljs-name"><span class="hljs-name">&lt;h1&gt;</span></span> NIL <span class="hljs-string"><span class="hljs-string">"Menu+Tab"</span></span>) (<span class="hljs-name"><span class="hljs-name">&lt;tab&gt;</span></span> (<span class="hljs-string"><span class="hljs-string">"Tab1"</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;h3&gt;</span></span> NIL <span class="hljs-string"><span class="hljs-string">"This is Tab 1"</span></span>) ) (<span class="hljs-string"><span class="hljs-string">"Tab2"</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;h3&gt;</span></span> NIL <span class="hljs-string"><span class="hljs-string">"This is Tab 2"</span></span>) ) (<span class="hljs-string"><span class="hljs-string">"Tab3"</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;h3&gt;</span></span> NIL <span class="hljs-string"><span class="hljs-string">"This is Tab 3"</span></span>) ) ) ) ) ########################################################################</code> </pre><br>  <code>&lt;menu&gt;</code> accepts a sequence of menu items.  Each menu item is a Lisp list with CAR: <br><br><ul><li>  <code>NIL</code> : inactive menu item, the rest of the list may consist of arbitrary code (usually HTML tags). </li><li>  <code>T</code> : The second element is the name of the submenu, and clicking on this name will open or close the corresponding submenu.  The tail of the list recursively defines a submenu (arbitrary depth of nesting). </li><li>  Otherwise: The menu item defines a direct action (instead of opening a submenu), where the first item in the list is the name of the menu item and the second item is the corresponding URL. </li></ul><br>  <code>&lt;tab&gt;</code> takes a list of subpages.  Each page is just a tab name, and then arbitrary code (usually HTML tags). <br><br>  Please note that only one menu and one tab can be active at one time. <br><br><hr><br><h2><a name="forms"></a>  Interactive forms </h2><br>  In HTML, the only way for user input is through the <code>&lt;form&gt;</code> and <code>&lt;input&gt;</code> elements, using the HTTP POST method to communicate with the server. <br><br>  "@ Lib / xhtml.l" defines a function called <code>&lt;post&gt;</code> and a collection of data entry tags that allow direct programming of HTML forms.  We will show only one simple example: <br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"Simple Form"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">&lt;post&gt;</span></span> NIL <span class="hljs-string"><span class="hljs-string">"project.l"</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;field&gt;</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> '*Text) (<span class="hljs-name"><span class="hljs-name">&lt;submit&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"Save"</span></span>) ) ) ########################################################################</code> </pre><br>  This example links the text input field with a global variable <code>*Text</code> .  The field displays the current value of <code>*Text</code> , and pressing the submit button causes a reload of ‚Äúproject.l‚Äù with <code>*Text</code> , which is assigned a string value entered by the user. <br><br>  An application can then use this variable for some useful actions, such as storing its value in a database. <br><br>  The problem with this straightforward use of forms is that: <br><br><ol><li>  they require the programmer to take care of maintaining a large number of global variables.  Each input field on the page requires a variable for communication between the server and the client. </li><li>  they do not preserve the internal state of the application.  Each POST request generates a separate process on the server, which sets global variables to their new values, generates HTML pages and ends thereafter.  The state of the application must be transmitted explicitly, for example using the <code>&lt;hidden&gt;</code> . </li><li>  they are not very interactive.  Usually they have only one ‚ÄúSend‚Äù button.  The user fills (possibly) a large number of input fields, but the changes will take effect only when you click the ‚ÄúSubmit‚Äù button. </li></ol><br>  Although we wrote several applications in this style, we recommend the GUI framework provided by "@ lib / form.l".  It does not need any variables for client-server interaction, but implements a hierarchy of classes of GUI components for abstracting application logic, button actions, and data communication. <br><br><hr><br><h3><a name="sessions"></a>  Sessions </h3><br>  First of all, we need to create a permanent environment on the server to handle each separate session (for each connected client). <br><br>  Technically, this is just a child server process that we launched <a href="https://habr.com/ru/post/178235/">above</a> , which <strong>does not terminate</strong> immediately after it sends an HTML page to the browser.  This is achieved by calling the <code>app</code> function somewhere in the application initialization code. <br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">app</span></span>) # Start a session (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"Simple Session"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">&lt;post&gt;</span></span> NIL <span class="hljs-string"><span class="hljs-string">"project.l"</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;field&gt;</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> '*Text) (<span class="hljs-name"><span class="hljs-name">&lt;submit&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"Save"</span></span>) ) ) ########################################################################</code> </pre><br>  No more differences from the previous example.  However, when you connect your browser and then look at the terminal window where the application server is running, you will notice a colon - the PicoLisp command line <br><br><pre> <code class="lisp hljs">$ pil @lib/http.l @lib/xhtml.l @lib/form.l --server <span class="hljs-number"><span class="hljs-number">8080</span></span> project.l + :</code> </pre><br>  A tool like the Unix <code>ps</code> utility will tell you that two <code>picolisp</code> processes are now running, the first of which is the parent of the second. <br><br>  If you enter some text, say ‚Äúabcdef‚Äù, in the text field in the browser window, and click the Save button and examine the <code>*Text</code> variable, <br><br><pre> <code class="lisp hljs">: *Text -&gt; <span class="hljs-string"><span class="hljs-string">"abcdef"</span></span></code> </pre><br>  You will see that we now have a dedicated PicoLisp process ‚Äúconnected‚Äù to the client. <br><br>  You can complete this process (like any PicoLisp interactive session) by pressing <code>Ctrl-D</code> on an empty command prompt.  Otherwise, it will finish itself, if other requests from the browser do not arrive within the waiting time (by default, 5 minutes). <br><br>  To start the sales version (without debugging), the server is usually started without the ‚Äú+‚Äù flag and with <code>-wait</code> <br><br><pre> <code class="lisp hljs">$ pil @lib/http.l @lib/xhtml.l @lib/form.l --server <span class="hljs-number"><span class="hljs-number">8080</span></span> project.l -wait</code> </pre><br>  With this launch option, the command line prompt (:) does not appear when the client connects. <br><br><hr><br><h3><a name="actionForms"></a>  Forms (action forms) </h3><br>  Now that we have a session for each client, we can set up an active GUI framework. <br><br>  To do this, we wrap the <code>html</code> function call in <code>action</code> .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inside the body, </font></font><code>html</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">besides all other types of tag functions, there can be one or several calls to</font></font><code>form</code> <br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">app</span></span>) # Start session (<span class="hljs-name"><span class="hljs-name">action</span></span> # Action handler (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"Form"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL # HTTP/HTML protocol (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL # Form (<span class="hljs-name"><span class="hljs-name">gui</span></span> 'a '(+TextField) <span class="hljs-number"><span class="hljs-number">10</span></span>) # Text Field (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Button) <span class="hljs-string"><span class="hljs-string">"Print"</span></span> # Button '(msg (val&gt; (: home a))) ) ) ) ) ########################################################################</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note that there is no longer a global variable, such as </font></font><code>*Text</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, to store the contents of the input field. </font><font style="vertical-align: inherit;">Instead, we gave the local, symbolic name </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"component"</font></font><code>+TextField</code> <br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> 'a '(+TextField) <span class="hljs-number"><span class="hljs-number">10</span></span>) # Text Field</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Other components can access it. </font></font><br><br><pre> <code class="lisp hljs"> '(msg (val&gt; (: home a)))</code> </pre><br> <code>(: home)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">always returns a link to the form that contains this GUI component. </font><font style="vertical-align: inherit;">So </font></font><code>(: home a)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- the link to the component ' </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' in the current form. </font><font style="vertical-align: inherit;">Since </font></font><a href="http://software-lab.de/doc/refM.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msg</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> outputs its argument to STDERR, and the method </font></font><code>val&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retrieves the current contents of the component, when we click the button, we will see the text entered in the text field in the console. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Individually </font></font><code>action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>form</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do not have much meaning. </font><font style="vertical-align: inherit;">However, inside </font></font><code>html</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and out </font></font><code>form</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, you can freely mix HTML functions (and any other Lisp functions). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A typical page might have this structure:</font></font><br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">action</span></span> # Action handler (<span class="hljs-name"><span class="hljs-name">html</span></span> .. # HTTP/HTML protocol (<span class="hljs-name"><span class="hljs-name">&lt;h1&gt;</span></span> ..) # HTML tags (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL # Form (<span class="hljs-name"><span class="hljs-name">&lt;h3&gt;</span></span> ..) (<span class="hljs-name"><span class="hljs-name">gui</span></span> ..) # GUI component(<span class="hljs-name"><span class="hljs-name">s</span></span>) (<span class="hljs-name"><span class="hljs-name">gui</span></span> ..) .. ) (<span class="hljs-name"><span class="hljs-name">&lt;h2&gt;</span></span> ..) (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL # Another form (<span class="hljs-name"><span class="hljs-name">&lt;h3&gt;</span></span> ..) (<span class="hljs-name"><span class="hljs-name">gui</span></span> ..) # GUI component(<span class="hljs-name"><span class="hljs-name">s</span></span>) .. ) (<span class="hljs-name"><span class="hljs-name">&lt;br&gt;</span></span> ..) .. ) )</code> </pre><br><h4><a name="guiFoo"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Function </font></font><code>gui</code> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The most significant function in the body </font></font><code>form</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the function </font></font><code>gui</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. This is a workhorse of building a graphical interface. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outside the function is </font></font><code>form</code> <code>gui</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">not defined. The first parameter is an optional alias, a list of classes and additional arguments necessary for the constructors of these classes. We saw in the previous example</font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> 'a '(+TextField) <span class="hljs-number"><span class="hljs-number">10</span></span>) # Text Field</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here ' </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' is the alias for the type component </font></font><code>(+TextField)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The numeric argument </font></font><code>10</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is passed to the text field, specifying its width. </font><font style="vertical-align: inherit;">See other examples in the </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GUI Classes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> chapter </font><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">During a GET request </font></font><code>gui</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, essentially a front end for </font></font><code>new</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">It builds the component, saves it to the internal structures of the current form, and initializes it by sending a message to the component </font></font><code>init&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Finally, it sends the message </font></font><code>show&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to generate the HTML code and pass it to the browser. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">During the POST request </font></font><code>gui</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">does not build any new components. </font><font style="vertical-align: inherit;">Instead, existing components are reused. </font><font style="vertical-align: inherit;">Therefore, </font></font><code>gui</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">there is no need to do anything more than sending a message component </font></font><code>show&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><h4><a name="ctlFlow"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Control flow </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP has only two methods for changing the browser window: GET and POST. </font><font style="vertical-align: inherit;">We use these two methods in a well-defined way:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GET means that a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">new page</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is being created </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">It is used when the page is visited for the first time, usually by entering the URL in the browser‚Äôs address field, or by clicking on a link (which is often a </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">submenu or tab</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">POST always leads to </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the same page</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">It is initiated by pressing a button on the form, updates the data structures of the corresponding form and executes the code associated with this button.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The code associated with the button can do almost everything: read and change the contents of the input field, communicate with the database, display messages and dialog boxes, or even forge a POST request with a GET request, which will result in a completely different document being shown (see </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Change URL addresses</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GET builds all the GUI components on the server. These components are objects that encapsulate the state and behavior of an HTML page in a browser. Whenever the button is pressed, the page is reloaded using a POST request. Then - before sending any data to the browser - control is transferred to the function </font></font><code>action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. It performs error checking on all components, handles user input on the HTML page, and stores the values ‚Äã‚Äãin each component in the correct format (text, number, date, object, etc.).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The state of the form persists over time. </font><font style="vertical-align: inherit;">When the user returns to the previous page with the browser's Back button, this state is resumed and can be sent again (by POST request). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The following simple example displays two text fields. </font><font style="vertical-align: inherit;">If you enter some text in the ‚ÄúSource‚Äù field, you can copy it in upper or lower case into the ‚ÄúDestination‚Äù field by pressing one of the buttons.</font></font><br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">app</span></span>) (<span class="hljs-name"><span class="hljs-name">action</span></span> (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"Case Conversion"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL (<span class="hljs-name"><span class="hljs-name">&lt;grid&gt;</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-string"><span class="hljs-string">"Source"</span></span> (<span class="hljs-name"><span class="hljs-name">gui</span></span> 'src '(+TextField) <span class="hljs-number"><span class="hljs-number">30</span></span>) <span class="hljs-string"><span class="hljs-string">"Destination"</span></span> (<span class="hljs-name"><span class="hljs-name">gui</span></span> 'dst '(+Lock +TextField) <span class="hljs-number"><span class="hljs-number">30</span></span>) ) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"Upper Case"</span></span> '(set&gt; (: home dst) (uppc (val&gt; (: home src))) ) ) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"Lower Case"</span></span> '(set&gt; (: home dst) (lowc (val&gt; (: home src))) ) ) ) ) ) ########################################################################</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The prefix class </font></font><code>+Lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the ‚ÄúDestination‚Äù field makes this field read-only. </font><font style="vertical-align: inherit;">The only way to put some text in this field is to use one of the buttons.</font></font><br><br><h4><a name="switching"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> URL switching </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since the action code (buttons) is executed before it </font></font><code>html</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">can send an HTTP header, it can interrupt the current page and submit something else to the user. This may be another HTML page, but this is not a very interesting case, since a normal link would be enough. Instead, the code can trigger the loading of dynamically generated data. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The following example shows a text box and two buttons. Any text entered in the text area is exported to a text file via the first button or a PDF document through the second button.</font></font><br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">load</span></span> <span class="hljs-string"><span class="hljs-string">"@lib/ps.l"</span></span>) (<span class="hljs-name"><span class="hljs-name">app</span></span>) (<span class="hljs-name"><span class="hljs-name">action</span></span> (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"Export"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+TextField) <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Button) <span class="hljs-string"><span class="hljs-string">"Text"</span></span> '(let Txt (tmp <span class="hljs-string"><span class="hljs-string">"export.txt"</span></span>) (out Txt (prinl (val&gt; (: home gui <span class="hljs-number"><span class="hljs-number">1</span></span>)))) (url Txt) ) ) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Button) <span class="hljs-string"><span class="hljs-string">"PDF"</span></span> '(psOut NIL <span class="hljs-string"><span class="hljs-string">"foo"</span></span> (a4) (indent <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span>) (down <span class="hljs-number"><span class="hljs-number">60</span></span>) (hline <span class="hljs-number"><span class="hljs-number">3</span></span>) (font (<span class="hljs-number"><span class="hljs-number">14</span></span> . <span class="hljs-string"><span class="hljs-string">"Times-Roman"</span></span>) (ps (val&gt; (: home gui <span class="hljs-number"><span class="hljs-number">1</span></span>))) ) (hline <span class="hljs-number"><span class="hljs-number">3</span></span>) (page) ) ) ) ) ) ########################################################################</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(when you pass two arguments to a class </font></font><code>+TextField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(width and height), an element is created </font></font><code>textarea</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The action code of the first button creates a temporary file (that is, a file called "export.txt" in the temporary directory of the current process), prints the value of the text area (this time we do not give the name of the gui-element, but simply refer to it as the first element in the form in this file, and then the function </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with the file name is called. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The second button uses the ‚Äú@ lib / ps.l‚Äù PostScript library to create a temporary file ‚Äúfoo.pdf‚Äù. </font><font style="vertical-align: inherit;">Here the creation of a temporary file and the function call are </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hidden inside </font></font><code>psOut</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">As a result, the browser receives the PDF document and displays it.</font></font><br><br><h4><a name="dialogs"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alerts and Conversations </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In fact, alerts and dialogs are not exactly what we are used to seeing ;-) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">They are not popup. In this framework, they are kind of easy-to-use forms of a predefined type. They can be called from the button code, and they always appear on the current page, immediately before the form that created them. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's look at an example that uses two alerts and a dialog box. At the beginning, it displays a simple form with a locked text field and two buttons.</font></font><br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">app</span></span>) (<span class="hljs-name"><span class="hljs-name">action</span></span> (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"Alerts and Dialogs"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Init +Lock +TextField) <span class="hljs-string"><span class="hljs-string">"Initial Text"</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-string"><span class="hljs-string">"My Text"</span></span>) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Button) <span class="hljs-string"><span class="hljs-string">"Alert"</span></span> '(alert NIL <span class="hljs-string"><span class="hljs-string">"This is an alert "</span></span> (okButton)) ) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Button) <span class="hljs-string"><span class="hljs-string">"Dialog"</span></span> '(dialog NIL (&lt;br&gt; <span class="hljs-string"><span class="hljs-string">"This is a dialog."</span></span>) (&lt;br&gt; <span class="hljs-string"><span class="hljs-string">"You can change the text here "</span></span> (gui '(+Init +TextField) (val&gt; (: top <span class="hljs-number"><span class="hljs-number">1</span></span> gui <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-number"><span class="hljs-number">20</span></span>) ) (&lt;br&gt; <span class="hljs-string"><span class="hljs-string">"and then re-submit it to the form."</span></span>) (gui '(+Button) <span class="hljs-string"><span class="hljs-string">"Re-Submit"</span></span> '(alert NIL <span class="hljs-string"><span class="hljs-string">"Are you sure? "</span></span> (yesButton '(set&gt; (: home top <span class="hljs-number"><span class="hljs-number">2</span></span> gui <span class="hljs-number"><span class="hljs-number">1</span></span>) (val&gt; (: home top <span class="hljs-number"><span class="hljs-number">1</span></span> gui <span class="hljs-number"><span class="hljs-number">1</span></span>)) ) ) (noButton) ) ) (cancelButton) ) ) ) ) ) ########################################################################</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The prefix class </font></font><code>+Init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">initializes the ‚ÄúMy Text‚Äù field with the string ‚ÄúInitial Text‚Äù. </font><font style="vertical-align: inherit;">Since the field is disabled, this value cannot be changed directly. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first button will show the alert: "This is an alert". </font><font style="vertical-align: inherit;">You can close it by clicking "OK". </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The second button shows a dialog with a text field containing a copy of the value from the text field of the main form. </font><font style="vertical-align: inherit;">You can change this value and send it back to the form if you click ‚ÄúRe-Submit‚Äù and answer ‚ÄúYes‚Äù to the warning ‚ÄúAre you sure?‚Äù.</font></font><br><br><h4><a name="calc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Calculator Example </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now we will briefly postpone our test file ‚Äúproject.l‚Äù and move on to a more substantial and practical autonomous example. </font><font style="vertical-align: inherit;">Using what we have learned, we will build a simple bignum-calculator. </font><font style="vertical-align: inherit;">(‚ÄúBignum‚Äù because there is only one type of number in PicoLisp - bignums (unlimited whole numbers)) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It uses one form, one numeric input field and many buttons. </font><font style="vertical-align: inherit;">The source code of the calculator can be found in the PicoLisp distribution (for example, in ‚Äú/usr/share/picolisp/misc/calc.l‚Äù) along with the directly executed ‚Äúmisc / calc‚Äù wrapper script.</font></font><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calc.l</font></font></b> <div class="spoiler_text"><pre> <code class="lisp hljs"># <span class="hljs-number"><span class="hljs-number">14</span></span>may11abu # (<span class="hljs-name"><span class="hljs-name">c</span></span>) Software Lab. Alexander Burger # *Init *Accu *Stack (<span class="hljs-name"><span class="hljs-name">allowed</span></span> NIL <span class="hljs-string"><span class="hljs-string">"!calculator"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span>) (<span class="hljs-name"><span class="hljs-name">load</span></span> <span class="hljs-string"><span class="hljs-string">"@lib/http.l"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib/xhtml.l"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib/form.l"</span></span>) # Calculator logic (<span class="hljs-name"><span class="hljs-name">de</span></span> digit (<span class="hljs-name"><span class="hljs-name">N</span></span>) (<span class="hljs-name"><span class="hljs-name">when</span></span> *Init (zero *Accu) (<span class="hljs-name"><span class="hljs-name">off</span></span> *Init)) (setq *Accu (<span class="hljs-name"><span class="hljs-name">+</span></span> N (<span class="hljs-name"><span class="hljs-name">*</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> *Accu))) ) (de calc () (let (Fun (caar *Stack) Val (<span class="hljs-name"><span class="hljs-name">cddr</span></span> (<span class="hljs-name"><span class="hljs-name">pop</span></span> '*Stack))) (<span class="hljs-name"><span class="hljs-name">setq</span></span> *Accu (if (and (== '/ Fun) (=0 *Accu)) (<span class="hljs-name"><span class="hljs-name">alert</span></span> <span class="hljs-string"><span class="hljs-string">"Div / 0"</span></span>) (<span class="hljs-name"><span class="hljs-name">Fun</span></span> Val *Accu) ) ) ) ) (de operand (Fun Prio) (when (&gt;= (cadar *Stack) Prio) (<span class="hljs-name"><span class="hljs-name">calc</span></span>)) (<span class="hljs-name"><span class="hljs-name">push</span></span> '*Stack (<span class="hljs-name"><span class="hljs-name">cons</span></span> Fun Prio *Accu)) (on *Init) ) (<span class="hljs-name"><span class="hljs-name">de</span></span> finish () (<span class="hljs-name"><span class="hljs-name">while</span></span> *Stack (calc)) (on *Init) ) # Calculator GUI (<span class="hljs-name"><span class="hljs-name">de</span></span> calculator () (<span class="hljs-name"><span class="hljs-name">app</span></span>) (<span class="hljs-name"><span class="hljs-name">action</span></span> (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"Bignum Calculator"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">&lt;h2&gt;</span></span> NIL <span class="hljs-string"><span class="hljs-string">"Bignum Calculator"</span></span>) (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL (<span class="hljs-name"><span class="hljs-name">&lt;br&gt;</span></span> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Var +NumField) '*Accu <span class="hljs-number"><span class="hljs-number">60</span></span>)) (<span class="hljs-name"><span class="hljs-name">&lt;grid&gt;</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"¬±"</span></span> '(setq *Accu (- *Accu))) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Able +JS +Button) '(ge0 *Accu) (char 8730) '(setq *Accu (sqrt *Accu)) ) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"\^"</span></span> '(operand '** <span class="hljs-number"><span class="hljs-number">3</span></span>)) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"/"</span></span> '(operand '/ <span class="hljs-number"><span class="hljs-number">2</span></span>)) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"7"</span></span> '(digit <span class="hljs-number"><span class="hljs-number">7</span></span>)) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"8"</span></span> '(digit <span class="hljs-number"><span class="hljs-number">8</span></span>)) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"9"</span></span> '(digit <span class="hljs-number"><span class="hljs-number">9</span></span>)) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"*"</span></span> '(operand '* 2)) (gui '(+JS +Button) "4" '(digit 4)) (gui '(+JS +Button) "5" '(digit 5)) (gui '(+JS +Button) "6" '(digit 6)) (gui '(+JS +Button) "-" '(operand '- 1)) (gui '(+JS +Button) "1" '(digit 1)) (gui '(+JS +Button) "2" '(digit 2)) (gui '(+JS +Button) "3" '(digit 3)) (gui '(+JS +Button) "+" '(operand '+ 1)) (gui '(+JS +Button) "0" '(digit 0)) (gui '(+JS +Button) "C" '(zero *Accu)) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"A"</span></span> '(main)) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"="</span></span> '(finish)) ) ) ) ) ) # Initialize (<span class="hljs-name"><span class="hljs-name">de</span></span> main () (<span class="hljs-name"><span class="hljs-name">on</span></span> *Init) (zero *Accu) (<span class="hljs-name"><span class="hljs-name">off</span></span> *Stack) ) # Start server (de go () (server 8080 "!calculator") )</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> To use, go to the PicoLisp installation directory and run it as </font></font><br><br><pre> <code class="lisp hljs">$ misc/calc</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or call it with an absolute path, for example </font></font><br><br><pre> <code class="lisp hljs">$ /usr/share/picolisp/misc/calc</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If you want to access the PicoLisp interactive session, run it instead as </font></font><br><br><pre> <code class="lisp hljs">$ pil misc/calc.l -main -go +</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Open as usual the page ' </font></font><a href="http://localhost:8080/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http: // localhost: 8080</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The code for calculator logic and GUI is quite simple. The entry point is the function </font></font><code>calculator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. It is called directly (as described in the </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URL Syntax</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), first, as the default URL of the server, and second, implicitly through POST requests. After running the calculator, file access is not required. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note that for the production version we insert the allowed statement at the beginning of ‚Äúmisc / calc.l‚Äù (as recommended in the </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Security</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> chapter </font><font style="vertical-align: inherit;">)</font></font><br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">allowed</span></span> NIL <span class="hljs-string"><span class="hljs-string">"!calculator"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This will limit external access to a single function </font></font><code>calculator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculator uses three global variables </font></font><code>*Init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>*Accu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>*Stack</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>*Init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- a boolean flag set by operator buttons to indicate that the next pressed digit will reset the battery to zero. </font></font><code>*Accu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- accumulator (accumulator). Its value is displayed in a numeric input field, accepts user input and stores the results of calculations. </font></font><code>*Stack</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">represents a store stack for storing deferred calculations (operators, priorities and intermediate results) with lower priority operators, while calculations with higher priority are performed. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The function </font></font><code>digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is called with the number buttons and adds another digit to the battery.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The function </font></font><code>calc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">takes the step of the actual calculation. </font><font style="vertical-align: inherit;">It retrieves data from the stack, checks for division by zero, and displays an error message if necessary. </font></font><br><br> <code>operand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">handles operand buttons, taking function and priority as arguments. </font><font style="vertical-align: inherit;">It compares the priority with the value at the top of the stack and postpones the calculation if it is smaller. </font></font><br><br> <code>finish</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">used to calculate the final result. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The function has </font></font><code>calculator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one numeric input field, 60 characters wide.</font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Var +NumField) '*Accu <span class="hljs-number"><span class="hljs-number">60</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The prefix class </font></font><code>+Var</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">associates this field with a global variable </font></font><code>*Accu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">All changes in the field will be displayed in this variable, and the change in the value of this variable will be displayed in the field.</font></font><br><br><a name="sqrtButton"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The square root button has a prefix class </font></font><code>+Able</code> <br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Able +JS +Button) '(ge0 *Accu) (char 8730) '(setq *Accu (sqrt *Accu)) )</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with an argument in the form of an expression that checks that the current value in the battery is greater than zero, otherwise the button is disabled. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The rest of the form is just an array (GRID) of buttons that encapsulates all the functions of the calculator. </font><font style="vertical-align: inherit;">The user can enter numbers in the input field using the numeric buttons or directly typing them, and perform calculations with the operator buttons. </font><font style="vertical-align: inherit;">Supported operations are addition, subtraction, multiplication, division, sign reversal, square root, and exponentiation (all operations are in long integer arithmetic). </font><font style="vertical-align: inherit;">The ' </font></font><code>C</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' </font><font style="vertical-align: inherit;">button </font><font style="vertical-align: inherit;">clears only the battery, while the ' </font></font><code>A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' </font><font style="vertical-align: inherit;">button </font><font style="vertical-align: inherit;">also clears all pending calculations. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And all this in 53 lines of code!</font></font><br><br><hr><br><h3><a name="charts"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tables (charts) </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Charts - virtual components for the internal presentation of tabular data. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As a rule, this data is nested lists, database selections or dynamically generated tabular information. Charts allow you to view data in rows and columns (usually in HTML </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tables</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), scroll up and down, and link them with the corresponding visible GUI components. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In fact, the logic for handling Charts constitutes a significant part of the entire framework with a large influence on all internal mechanisms. Each GUI component must know whether it is part of a Chart in order to be able to correctly process its contents during an update and user interaction. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suppose we want to collect text and numeric data. We could create a table</font></font><br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">app</span></span>) (<span class="hljs-name"><span class="hljs-name">action</span></span> (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"Table"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL (<span class="hljs-name"><span class="hljs-name">&lt;table&gt;</span></span> NIL NIL '((NIL <span class="hljs-string"><span class="hljs-string">"Text"</span></span>) (NIL <span class="hljs-string"><span class="hljs-string">"Number"</span></span>)) (<span class="hljs-name"><span class="hljs-name">do</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;row&gt;</span></span> NIL (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+TextField) <span class="hljs-number"><span class="hljs-number">20</span></span>) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+NumField) <span class="hljs-number"><span class="hljs-number">10</span></span>) ) ) ) (<span class="hljs-name"><span class="hljs-name">&lt;submit&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"Save"</span></span>) ) ) ) ########################################################################</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with two columns "Text" and "Number" and four lines, each of which contains </font></font><code>+TextField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>+NumField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can enter text in the first column and numbers in the second. </font><font style="vertical-align: inherit;">Pressing the ‚ÄúSave‚Äù button saves these values ‚Äã‚Äãto components on the server (or gives an error message if the row in the second column is not a number). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are two problems with this solution:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Although you can get the entered data for individual fields, for example </font></font><br><pre> <code class="lisp hljs">: (<span class="hljs-name"><span class="hljs-name">val&gt;</span></span> (<span class="hljs-name"><span class="hljs-name">get</span></span> *Top 'gui 2)) # Value in the first row, second column -&gt; 123</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is no direct way to get the entire data structure in a single list. </font><font style="vertical-align: inherit;">Instead, you have to bypass all the GUI components and collect data.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The user cannot enter more than four lines of data, because there is no easy way to scroll down and expand the space to enter more data. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Chart can handle these things: </font></font><br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">app</span></span>) (<span class="hljs-name"><span class="hljs-name">action</span></span> (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"Chart"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Chart) <span class="hljs-number"><span class="hljs-number">2</span></span>) # Inserted a +Chart (<span class="hljs-name"><span class="hljs-name">&lt;table&gt;</span></span> NIL NIL '((NIL <span class="hljs-string"><span class="hljs-string">"Text"</span></span>) (NIL <span class="hljs-string"><span class="hljs-string">"Number"</span></span>)) (<span class="hljs-name"><span class="hljs-name">do</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;row&gt;</span></span> NIL (<span class="hljs-name"><span class="hljs-name">gui</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> '(+TextField) <span class="hljs-number"><span class="hljs-number">20</span></span>) # Inserted '<span class="hljs-number"><span class="hljs-number">1</span></span>' (<span class="hljs-name"><span class="hljs-name">gui</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> '(+NumField) <span class="hljs-number"><span class="hljs-number">10</span></span>) ) ) ) # Inserted '<span class="hljs-number"><span class="hljs-number">2</span></span>' (<span class="hljs-name"><span class="hljs-name">&lt;submit&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"Save"</span></span>) ) ) ) ########################################################################</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notice that we inserted the component </font></font><code>+Chart</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in front of the GUI components that need to be managed using the Chart. </font><font style="vertical-align: inherit;">Argument "2" means that Chart should expect two columns of data. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Each component received an index number (here "1" and "2") as the first argument </font></font><code>gui</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, indicating the column in which this component should go inside the Chart. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now - if you entered "a", "b" and "c" in the first, and 1, 2 and 3 in the second column - we can get the full contents of the table by sending a message</font></font><code>val&gt;</code> <br><br><pre> <code class="lisp hljs">: (<span class="hljs-name"><span class="hljs-name">val&gt;</span></span> (<span class="hljs-name"><span class="hljs-name">get</span></span> *Top 'chart 1)) # Retrieve the value of the first chart -&gt; (("a" 1) ("b" 2) ("c" 3))</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> By the way, a more convenient function is </font></font><code>chart</code> <br><br><pre> <code class="lisp hljs">: (<span class="hljs-name"><span class="hljs-name">val&gt;</span></span> (<span class="hljs-name"><span class="hljs-name">chart</span></span>)) # Retrieve the value of the current chart -&gt; ((<span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-string"><span class="hljs-string">"b"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) (<span class="hljs-string"><span class="hljs-string">"c"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>))</code> </pre><br> <code>chart</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> can be used instead of the above construction, when we want to access the ‚Äúcurrent‚Äù table, that is, the last one recently used in the current form. </font></font><br><br><h4><a name="scrolling"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Scroll </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To enable scrolling, let's add two buttons. </font><font style="vertical-align: inherit;">We use predefined classes </font></font><code>+UpButton</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and</font></font><code>+DnButton</code> <br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">app</span></span>) (<span class="hljs-name"><span class="hljs-name">action</span></span> (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"Scrollable Chart"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Chart) <span class="hljs-number"><span class="hljs-number">2</span></span>) (<span class="hljs-name"><span class="hljs-name">&lt;table&gt;</span></span> NIL NIL '((NIL <span class="hljs-string"><span class="hljs-string">"Text"</span></span>) (NIL <span class="hljs-string"><span class="hljs-string">"Number"</span></span>)) (<span class="hljs-name"><span class="hljs-name">do</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;row&gt;</span></span> NIL (<span class="hljs-name"><span class="hljs-name">gui</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> '(+TextField) <span class="hljs-number"><span class="hljs-number">20</span></span>) (<span class="hljs-name"><span class="hljs-name">gui</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> '(+NumField) <span class="hljs-number"><span class="hljs-number">10</span></span>) ) ) ) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+UpButton) <span class="hljs-number"><span class="hljs-number">1</span></span>) # Inserted two buttons (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+DnButton) <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">----</span></span>) (<span class="hljs-name"><span class="hljs-name">&lt;submit&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"Save"</span></span>) ) ) ) ########################################################################</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to scroll up and down one line at a time (argument ‚Äú1‚Äù). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now you can enter a few rows of data, scroll down and enter more data. </font><font style="vertical-align: inherit;">There is no need to press the ‚ÄúSave‚Äù button (except for the very beginning when the scroll buttons are disabled), because </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">any</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> button in the form sends the changes to the server before performing any actions.</font></font><br><br><h4><a name="putGet"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Get and Put functions </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As we said, Chart is a virtual component for editing tabular data. </font><font style="vertical-align: inherit;">Thus, Chart's own data format is a list of lists: each sublist represents one row of data, and each element of the row corresponds to one GUI component. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the example above, we saw a row, such as</font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> compared </font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> '(+TextField) <span class="hljs-number"><span class="hljs-number">20</span></span>) (<span class="hljs-name"><span class="hljs-name">gui</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> '(+NumField) <span class="hljs-number"><span class="hljs-number">10</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, quite often such a one-to-one relationship is not desirable. It may be necessary to present the user with internal data structures in various forms, and user input may require conversion to an internal format. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For this, the Chart accepts ‚Äî in addition to the ‚Äúnumber of columns‚Äù argument ‚Äî two additional functional arguments. The first function is called to ‚Äúput‚Äù the internal representation into the GUI components, and the second to ‚Äúget‚Äù (receive) the data from the GUI into the internal representation.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A typical example is a table for displaying clients in a database. </font><font style="vertical-align: inherit;">While the internal representation is a one-dimensional list of customer objects, ‚Äúput‚Äù expands each object into the list: last name, first name, telephone number, address, and so on. </font><font style="vertical-align: inherit;">When the user enters the client name, ‚Äúget‚Äù finds the corresponding object in the database and stores it in an internal representation. </font><font style="vertical-align: inherit;">In turn, ‚Äúput‚Äù will deploy it to the GUI. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now, let's look at a simpler example: Chart, which contains only a list of numbers, but also displays the text form of each number in the GUI (in German).</font></font><br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">app</span></span>) (<span class="hljs-name"><span class="hljs-name">load</span></span> <span class="hljs-string"><span class="hljs-string">"@lib/zahlwort.l"</span></span>) (<span class="hljs-name"><span class="hljs-name">action</span></span> (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"Numerals"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Init +Chart) (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span> '((N) (list N (zahlwort N))) car ) (<span class="hljs-name"><span class="hljs-name">&lt;table&gt;</span></span> NIL NIL '((NIL <span class="hljs-string"><span class="hljs-string">"Numeral"</span></span>) (NIL <span class="hljs-string"><span class="hljs-string">"German"</span></span>)) (<span class="hljs-name"><span class="hljs-name">do</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;row&gt;</span></span> NIL (<span class="hljs-name"><span class="hljs-name">gui</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> '(+NumField) <span class="hljs-number"><span class="hljs-number">9</span></span>) (<span class="hljs-name"><span class="hljs-name">gui</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> '(+Lock +TextField) <span class="hljs-number"><span class="hljs-number">90</span></span>) ) ) ) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+UpButton) <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+DnButton) <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">----</span></span>) (<span class="hljs-name"><span class="hljs-name">&lt;submit&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"Save"</span></span>) ) ) ) ########################################################################</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"@ Lib / zahlwort.l" defines a helper function </font></font><code>zahlwort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which will later come in handy in the 'put' function. </font></font><code>zahlwort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">takes a number and returns its name in German. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now look at the code</font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Init +Chart) (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span> '((N) (list N (zahlwort N))) car )</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We add the prefix class </font></font><code>+Init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to </font></font><code>+Chart</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and pass it a list </font></font><code>(1 5 7)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for the initial value of the chart. </font><font style="vertical-align: inherit;">Then, after '2' (the chart has two columns), we pass the ‚Äúput‚Äù function:</font></font><br><br><pre> <code class="lisp hljs"> '((N) (list N (zahlwort N)))</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> which takes a number and returns a list of that number and its name, and the get function </font></font><br><br><pre> <code class="lisp hljs"> car )</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which in turn accepts such a list and returns a number that will just be the first element of the list. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can see from this example that ‚Äúget‚Äù is the inverse of the ‚Äúput‚Äù function. </font><font style="vertical-align: inherit;">"Get" can be omitted if the chart is read-only (does not contain (or contains only blocked) input fields). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Field in the second column</font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> '(+Lock +TextField) <span class="hljs-number"><span class="hljs-number">90</span></span>) ) ) )</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blocked because it displays the text created by the ‚Äúput‚Äù function and does not intend to accept user input. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When you open this form in a browser, you will see three prefilled lines with ‚Äú1 / eins‚Äù, ‚Äú5 / f√ºnf‚Äù and ‚Äú7 / sieben‚Äù, according to the </font></font><code>(1 5 7)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">class </font><font style="vertical-align: inherit;">arguments </font></font><code>+Init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">By entering a number in the first column and pressing the ENTER key or one of the buttons, you will see the corresponding text in the second column.</font></font><br><br><hr><br><h2><a name="guiClasses"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GUI Classes </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In previous chapters, we have seen examples of GUI classes, such as </font></font><code>+TextField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>+NumField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code>+Button</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, often in combination with prefix classes </font></font><code>+Lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>+Init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code>+Able</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Now we take a wider look at the entire hierarchy and try more examples. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The abstract class </font></font><code>+gui</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the basis of all GUI classes. </font><font style="vertical-align: inherit;">You can see class hierarchies live using the </font></font><a href="http://software-lab.de/doc/refD.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dep</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">(‚Äúdependencies‚Äù):</font></font><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gui class hierarchy</font></font></b> <div class="spoiler_text"><pre> <code class="lisp hljs">: (<span class="hljs-name"><span class="hljs-name">dep</span></span> '+gui) +gui +JsField +Button +UpButton +PickButton +DstButton +ClrButton +ChoButton +Choice +GoButton +BubbleButton +DelRowButton +ShowButton +DnButton +Img +field +Checkbox +TextField +FileField +ClassField +numField +NumField +FixField +BlobField +DateField +SymField +UpField +MailField +SexField +AtomField +PwField +ListTextField +LinesField +TelField +TimeField +HttpField +Radio -&gt; +gui</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For example, we see what </font></font><code>+DnButton</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is a subclass </font></font><code>+Button</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which in turn is a subclass </font></font><code>+gui</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Inspecting directly</font></font><code>+DnButton</code> <br><br><pre> <code class="lisp hljs">: (<span class="hljs-name"><span class="hljs-name">dep</span></span> '+DnButton) +Tiny +Rid +JS +Able +gui +Button +DnButton -&gt; +DnButton</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We see that </font></font><code>+DnButton</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inherits from </font></font><code>+Tiny</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>+Rid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>+Able</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>+Button</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The actual definition </font></font><code>+DnButton</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">can be found in "@ lib / form.l"</font></font><br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">class</span></span> +DnButton +Tiny +Rid +JS +Able +Button) ...</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In general, ‚Äú@ lib / form.l‚Äù is a comprehensive reference for the GUI framework and is recommended for familiarization. </font></font><br><br><hr><br><h3><a name="inputFields"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Input fields </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Input fields implement a visual display of application data and allow, when enabled, the input and modification of this data. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the HTML level, they can take the following forms:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Regular Input Fields </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Textarea </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> checkboxes </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> drop-down lists (combobox) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Password fields </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HTML links </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Plain html text </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With the exception of checkboxes that are implemented class </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Checkbox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , all these HTML-generated representation </font></font><code>+TextField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and its respective subclasses, such as </font></font><code>+NumField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>+DateField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etc. </font><font style="vertical-align: inherit;">Their actual appearance (as one of the above forms) depends on their arguments: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We have already seen ‚Äúnormal‚Äù text fields. </font><font style="vertical-align: inherit;">They are created by one numeric argument. </font><font style="vertical-align: inherit;">This example creates a variable field with a width of 10 characters:</font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+TextField) <span class="hljs-number"><span class="hljs-number">10</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If the second numeric argument is specified for the number of lines (in this case, '4'), you will get a textarea: </font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+TextField) <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Providing a list of values ‚Äã‚Äãinstead of a number gives the combobox: </font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+TextField) '(<span class="hljs-string"><span class="hljs-string">"Value 1"</span></span> <span class="hljs-string"><span class="hljs-string">"Value 2"</span></span> <span class="hljs-string"><span class="hljs-string">"Value 3"</span></span>))</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition to these arguments, you can pass a string. </font><font style="vertical-align: inherit;">The field will be labeled:</font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+TextField) <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-string"><span class="hljs-string">"Plain"</span></span>) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+TextField) <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-string"><span class="hljs-string">"Text Area"</span></span>) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+TextField) '(<span class="hljs-string"><span class="hljs-string">"Value 1"</span></span> <span class="hljs-string"><span class="hljs-string">"Value 2"</span></span> <span class="hljs-string"><span class="hljs-string">"Value 3"</span></span>) <span class="hljs-string"><span class="hljs-string">"Selection"</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Finally, without arguments, the field will be displayed as plain HTML text: </font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+TextField))</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This mainly makes sense in combination with type prefix classes </font></font><code>+Var</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>+Obj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, for managing the contents of these fields, and for special behavior, such as HTML links or scrollable table values.</font></font><br><br><h4><a name="numberFields"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Numeric input fields </font></font></h4><br> <code>+NumField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">returns a number in its method </font></font><code>val&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and takes a number in the method </font></font><code>set&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">It gives an error message when user input cannot be converted to a number. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Large numbers are displayed with thousands separators as defined in the current locale.</font></font><br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">app</span></span>) (<span class="hljs-name"><span class="hljs-name">action</span></span> (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"+NumField"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+NumField) <span class="hljs-number"><span class="hljs-number">10</span></span>) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"Print value"</span></span> '(msg (val&gt; (: home gui <span class="hljs-number"><span class="hljs-number">1</span></span>))) ) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"Set to 123"</span></span> '(set&gt; (: home gui <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">123</span></span>) ) ) ) ) ########################################################################</code> </pre><br> <code>+FixField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requires an additional scale-factor argument, and accepts / returns scaled numbers with a fixed comma. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The decimal separator is determined by the current locale.</font></font><br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">app</span></span>) (<span class="hljs-name"><span class="hljs-name">action</span></span> (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"+FixField"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+FixField) <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"Print value"</span></span> '(msg (format (val&gt; (: home gui <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-number"><span class="hljs-number">3</span></span>)) ) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"Set to 123.456"</span></span> '(set&gt; (: home gui <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">123456</span></span>) ) ) ) ) ########################################################################</code> </pre><br><h4><a name="timeDateFields"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Time and Date </font></font></h4><br> <code>+DateField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accepts and returns </font></font><a href="http://software-lab.de/doc/refD.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">date</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> values </font><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">app</span></span>) (<span class="hljs-name"><span class="hljs-name">action</span></span> (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"+DateField"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+DateField) <span class="hljs-number"><span class="hljs-number">10</span></span>) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"Print value"</span></span> '(msg (datStr (val&gt; (: home gui <span class="hljs-number"><span class="hljs-number">1</span></span>)))) ) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"Set to \"today\""</span></span> '(set&gt; (: home gui <span class="hljs-number"><span class="hljs-number">1</span></span>) (date)) ) ) ) ) ########################################################################</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The format for displaying and entering the date depends on the current locale (see </font></font><a href="http://software-lab.de/doc/refD.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">datStr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="http://software-lab.de/doc/refE.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">expDat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">You can change the locale, for example</font></font><br><br><pre> <code class="lisp hljs">: (<span class="hljs-name"><span class="hljs-name">locale</span></span> <span class="hljs-string"><span class="hljs-string">"DE"</span></span> <span class="hljs-string"><span class="hljs-string">"de"</span></span>) -&gt; NIL</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If no locale is selected, then the default format is YYYY-MM-DD. </font><font style="vertical-align: inherit;">Some predefined locales use the DD.MM.YYYY (DE), YYYY / MM / DD (JP), DD / MM / YYYY (UK), or MM / DD / YYYY (US) patterns. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When the user input does not match the date format of the current locale, an error is generated. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regardless of locale, </font></font><code>+DateField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trying to expand reduced input from the user:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "7" gives the 7th of the current month </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "031" or "0301" gives January 3 of the current year </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "311" or "3101" gives January 31 of the current year </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "0311" gives November 3 of the current year </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äú01023‚Äù or ‚Äú010203‚Äù are given on February 1, 2003 </font></font></li><li>  and so on </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Similar class - </font></font><code>+TimeField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">It accepts and returns the </font></font><a href="http://software-lab.de/doc/refT.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> value </font><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">app</span></span>) (<span class="hljs-name"><span class="hljs-name">action</span></span> (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"+TimeField"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+TimeField) <span class="hljs-number"><span class="hljs-number">8</span></span>) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"Print value"</span></span> '(msg (tim$ (val&gt; (: home gui <span class="hljs-number"><span class="hljs-number">1</span></span>)))) ) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"Set to \"now\""</span></span> '(set&gt; (: home gui <span class="hljs-number"><span class="hljs-number">1</span></span>) (time)) ) ) ) ) ########################################################################</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When the field width is "8", as in this example, the time is displayed in a format </font></font><code>HH:MM:SS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Another possible value is ‚Äú5‚Äù, causes the </font></font><code>+TimeField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">value to be displayed as </font></font><code>HH:MM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When user input cannot be converted to a time value, an error is generated. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The user can omit the colon. </font><font style="vertical-align: inherit;">Incomplete input is converted, just like the date. </font><font style="vertical-align: inherit;">‚Äú125‚Äù is converted to ‚Äú12:05‚Äù, ‚Äú124517‚Äù to ‚Äú12:45:17‚Äù, and so on.</font></font><br><br><h4><a name="telFields"></a>  Phone numbers </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internal representation of telephone numbers: country code (without leading signs plus or zero), then local telephone number (ideally separated by spaces) and additional number (ideally separated by a hyphen). </font><font style="vertical-align: inherit;">The exact format of the phone number is not imposed by the GUI, but for further processing (for example, searching the database), you usually use </font></font><a href="http://software-lab.de/doc/refF.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fold</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for better reproducibility. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To display a phone number, </font></font><code>+TelField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">replace the country code with a zero if it is a country code from the current locale, or is preceded by a plus sign, if it is a foreign country code (see </font></font><a href="http://software-lab.de/doc/refT.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">telStr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the number entered by the user, the plus or double zero sign is simply discarded, while one leading zero is replaced with the country code of the current locale (see </font></font><a href="http://software-lab.de/doc/refE.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">expTel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">app</span></span>) (<span class="hljs-name"><span class="hljs-name">locale</span></span> <span class="hljs-string"><span class="hljs-string">"DE"</span></span> <span class="hljs-string"><span class="hljs-string">"de"</span></span>) (<span class="hljs-name"><span class="hljs-name">action</span></span> (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"+TelField"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+TelField) <span class="hljs-number"><span class="hljs-number">20</span></span>) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"Print value"</span></span> '(msg (val&gt; (: home gui <span class="hljs-number"><span class="hljs-number">1</span></span>))) ) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"Set to \"49 1234 5678-0\""</span></span> '(set&gt; (: home gui <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"49 1234 5678-0"</span></span>) ) ) ) ) ########################################################################</code> </pre><br><h4><a name="checkboxes"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Checkboxes </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The class </font></font><code>+Checkbox</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is simple. </font><font style="vertical-align: inherit;">User interaction is limited to turning it on and off. </font><font style="vertical-align: inherit;">It takes a boolean value ( </font></font><code>NIL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or non- </font></font><code>NIL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) and returns </font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code>NIL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">app</span></span>) (<span class="hljs-name"><span class="hljs-name">action</span></span> (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"+Checkbox"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Checkbox)) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"Print value"</span></span> '(msg (val&gt; (: home gui <span class="hljs-number"><span class="hljs-number">1</span></span>))) ) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"On"</span></span> '(set&gt; (: home gui <span class="hljs-number"><span class="hljs-number">1</span></span>) T) ) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"Off"</span></span> '(set&gt; (: home gui <span class="hljs-number"><span class="hljs-number">1</span></span>) NIL) ) ) ) ) ########################################################################</code> </pre><br><hr><br><h3><a name="fieldPrefix"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Field prefix classes </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Most of the capabilities of the framework are explained by the combinatorial flexibility of the class prefix for GUI and DB objects. They allow you to 'redefine' individual methods in the inheritance tree 'in an operational way' and can be combined in various ways to achieve any desired behavior. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Technically, there is nothing special about prefix classes. These are regular classes. They are called "prefix" because they are intended to be inserted </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in front of</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> other classes in the list of superclasses of an object or class. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usually they take their own arguments for their method </font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from the list of arguments to the function </font></font><code>gui</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(the method </font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the constructor (comment of the translator).</font></font><br><br><h4><a name="initPrefix"></a>  Initialization </h4><br> <code>+Init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">overrides the method </font></font><code>init&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for this component. </font><font style="vertical-align: inherit;">The message is </font></font><code>init&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sent to the </font></font><code>+gui</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">component when the page is loaded for the first time (during a GET request). </font></font><code>+Init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accepts an expression for the initial value of this field.</font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Init +TextField) <span class="hljs-string"><span class="hljs-string">"This is the initial text"</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Other classes that automatically set the value of the field are </font></font><code>+Var</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(linking the field to a variable) and </font></font><code>+E/R</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(linking the field to the database). </font></font><br><br> <code>+Cue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">can be used, for example, in the "required" fields to prompt the user about what he should enter. </font><font style="vertical-align: inherit;">It will display the value of the argument in angle brackets, only if the field value is equal </font></font><code>NIL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and the method </font></font><code>val&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">returns </font></font><code>NIL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, despite the fact that this value will be displayed. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Call the empty field to display "&lt;Enter text here&gt;":</font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Cue +TextField) <span class="hljs-string"><span class="hljs-string">"Please enter some text here"</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span>)</code> </pre><br><h4><a name="ablePrefix"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Enable and disable </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An important feature of the GUI is context-sensitive disabling and enabling individual components, or the entire form. </font></font><br><br> <code>+Able</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the class prefix takes an expression argument and disables the component if that expression evaluates to </font></font><code>NIL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">We have seen an example of its use in </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the square root button</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> of a calculator. </font><font style="vertical-align: inherit;">Or imagine a button that should be turned on only after Christmas.</font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Able +Button) '(&gt;= (cdr (date (date))) (<span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span>)) <span class="hljs-string"><span class="hljs-string">"Close this year"</span></span> '(endOfYearProcessing) )</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or password entry field, which is disabled after logging in </font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Able +PwField) '(not *Login) 10 "Password")</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A special case is the prefix </font></font><code>+Lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which unconditionally disables the component. </font><font style="vertical-align: inherit;">He takes no arguments</font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Lock +NumField) <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-string"><span class="hljs-string">"Count"</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">("10" and "Count" are arguments for </font></font><code>+NumField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) and creates a read-only field. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The entire form can be disabled by calling </font></font><code>disable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with an </font></font><code>NIL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">argument. </font><font style="vertical-align: inherit;">This affects all components in this form. </font><font style="vertical-align: inherit;">Using the example above, we can make the form read-only before Christmas.</font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL (<span class="hljs-name"><span class="hljs-name">disable</span></span> (<span class="hljs-name"><span class="hljs-name">&gt;</span></span> (<span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span>) (<span class="hljs-name"><span class="hljs-name">cdr</span></span> (<span class="hljs-name"><span class="hljs-name">date</span></span> (<span class="hljs-name"><span class="hljs-name">date</span></span>))))) # Disable whole form (<span class="hljs-name"><span class="hljs-name">gui</span></span> ..) .. )</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, even in a completely locked form, it is often necessary to include certain components, since they are necessary for navigation, scrolling, or other actions that do not affect the contents of the form. </font><font style="vertical-align: inherit;">This is done by setting the prefix </font></font><code>+Rid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL (<span class="hljs-name"><span class="hljs-name">disable</span></span> (<span class="hljs-name"><span class="hljs-name">&gt;</span></span> (<span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span>) (<span class="hljs-name"><span class="hljs-name">cdr</span></span> (<span class="hljs-name"><span class="hljs-name">date</span></span> (<span class="hljs-name"><span class="hljs-name">date</span></span>))))) (<span class="hljs-name"><span class="hljs-name">gui</span></span> ..) .. (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Rid +Button) ..) # Button is enabled despite the disabled form .. )</code> </pre><br><h4><a name="formatPrefix"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Formatting </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GUI prefix classes allow you to fine-tune how values ‚Äã‚Äãare stored and retrieved from components. </font><font style="vertical-align: inherit;">Like the predefined classes of the type </font></font><code>+NumField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code>+DateField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, they override the methods </font></font><code>set&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code>val&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <code>+Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">takes an argument function that is called whenever a field is assigned a value. </font><font style="vertical-align: inherit;">To convert all user input to uppercase</font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Set +TextField) uppc <span class="hljs-number"><span class="hljs-number">30</span></span>)</code> </pre><br> <code>+Val</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is an addition to </font></font><code>+Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">It accepts a function that is called whenever the field value is retrieved. </font><font style="vertical-align: inherit;">To return the square of the field value</font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Val +NumField) '((N) (* NN)) <span class="hljs-number"><span class="hljs-number">10</span></span>)</code> </pre><br> <code>+Fmt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- it's just a combination </font></font><code>+Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>+Val</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, it takes two functional arguments. </font><font style="vertical-align: inherit;">In this example, the text will be displayed in capital letters, while returning in lowercase</font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Fmt +TextField) uppc lowc <span class="hljs-number"><span class="hljs-number">30</span></span>)</code> </pre><br> <code>+Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(alike </font></font><code>+Fmt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) produces two-way translation. It uses a list of cons pairs for linear searches, where CARs represent display values ‚Äã‚Äãthat are internally mapped to values ‚Äã‚Äãin the CDR. If the value is not found in this list in the process </font></font><code>set&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code>val&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, it is passed 'as is'. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usually </font></font><code>+Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">used in conjunction with a combobox (see </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Input fields</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). This example displays the user as One, Two, and Three, but returns the number 1, 2, or 3</font></font><br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">app</span></span>) (<span class="hljs-name"><span class="hljs-name">action</span></span> (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"+Map"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Map +TextField) '((<span class="hljs-string"><span class="hljs-string">"One"</span></span> . <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-string"><span class="hljs-string">"Two"</span></span> . <span class="hljs-number"><span class="hljs-number">2</span></span>) (<span class="hljs-string"><span class="hljs-string">"Three"</span></span> . <span class="hljs-number"><span class="hljs-number">3</span></span>)) '(<span class="hljs-string"><span class="hljs-string">"One"</span></span> <span class="hljs-string"><span class="hljs-string">"Two"</span></span> <span class="hljs-string"><span class="hljs-string">"Three"</span></span>) ) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Button) <span class="hljs-string"><span class="hljs-string">"Print"</span></span> '(msg (val&gt; (field <span class="hljs-number"><span class="hljs-number">-1</span></span>))) ) ) ) ) ########################################################################</code> </pre><br><h4><a name="sideEffects"></a>  Side effects </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Whenever a button is clicked in a GUI, any changes made </font></font><code>action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the current environment (for example, the state of the database or application) should be reflected in the corresponding fields of the GUI. </font><font style="vertical-align: inherit;">To do this, a message is sent to all components (on the server side) </font></font><code>upd&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Each component then takes appropriate measures (for example, updating from database objects, loading values ‚Äã‚Äãfrom variables, or calculating new values) to update its value. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">While the method </font></font><code>upd&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is mainly used by the framework itself, it can be overridden in existing classes through the class prefix </font></font><code>+Upd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Let's display the updated values ‚Äã‚Äãin STDERR</font></font><br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">app</span></span>) (<span class="hljs-name"><span class="hljs-name">default</span></span> *Number 0) (action (html 0 "+Upd" "@lib.css" NIL (form NIL (gui '(+Upd +Var +NumField) '(prog (extra) (msg *Number)) '*Number <span class="hljs-number"><span class="hljs-number">8</span></span> ) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"Increment"</span></span> '(inc '*Number) ) ) ) ) ########################################################################</code> </pre><br><h4><a name="validPrefix"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Validation </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To enable automatic verification of the entered data, a message is sent to all components at the appropriate time </font></font><code>chk&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. If the value is valid, the corresponding method should return </font></font><code>NIL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, otherwise the string describing the error. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Many of the built-in classes have a method </font></font><code>chk&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. The class </font></font><code>+NumField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">checks the correctness of the numeric entry, </font></font><code>+DateField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- the correctness of the calendar date. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On-the-fly testing can be performed using the prefix class </font></font><code>+Chk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. The following code accepts only digits not exceeding 9: the expression </font></font><code>or</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first delegates the check to the main class </font></font><code>+NumField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and ‚Äî if it does not return an error ‚Äî returns an error string when the current value is greater than 9.</font></font><br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">app</span></span>) (<span class="hljs-name"><span class="hljs-name">action</span></span> (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"+Chk"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Chk +NumField) '(or (extra) (and (&gt; (val&gt; This) <span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-string"><span class="hljs-string">"Number too big"</span></span>) ) <span class="hljs-number"><span class="hljs-number">12</span></span> ) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"Print"</span></span> '(msg (val&gt; (field <span class="hljs-number"><span class="hljs-number">-1</span></span>))) ) ) ) ) ########################################################################</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">More straightforward checking is done by the built-in class </font></font><code>+Limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">It controls the attribute of the </font></font><code>maxlength</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">created HTML input field. </font><font style="vertical-align: inherit;">Thus, it is not possible to enter more characters than allowed in the field.</font></font><br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">app</span></span>) (<span class="hljs-name"><span class="hljs-name">action</span></span> (<span class="hljs-name"><span class="hljs-name">html</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">"+Limit"</span></span> <span class="hljs-string"><span class="hljs-string">"@lib.css"</span></span> NIL (<span class="hljs-name"><span class="hljs-name">form</span></span> NIL (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Limit +TextField) <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"Print"</span></span> '(msg (val&gt; (field <span class="hljs-number"><span class="hljs-number">-1</span></span>))) ) ) ) ) ########################################################################</code> </pre><br><h4><a name="linkage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Data link </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">While </font></font><code>set&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>val&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- formal methods to get the value of the GUI-component, they are not very often used explicitly. Instead, components are directly connected to Lisp's internal data structures, which are usually variables or database objects. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The prefix class </font></font><code>+Var</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accepts a variable (in </font></font><a href="http://software-lab.de/doc/ref.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the function reference, it is</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> described as a data type </font></font><code>var</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äî a symbol or a cons pair). In the following example, we initialize the global variable with the value ‚Äúabc‚Äù and allow the field </font></font><code>+TextField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to work with it. The ‚ÄúPrint‚Äù button can be used to display its current value.</font></font><br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">app</span></span>) (<span class="hljs-name"><span class="hljs-name">setq</span></span> *TextVariable "abc") (action (html 0 "+Var" "@lib.css" NIL (form NIL (gui '(+Var +TextField) '*TextVariable <span class="hljs-number"><span class="hljs-number">8</span></span>) (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+JS +Button) <span class="hljs-string"><span class="hljs-string">"Print"</span></span> '(msg *TextVariable) ) ) ) ) ########################################################################</code> </pre><br> <code>+E/R</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accepts an entity / relationship specification. </font><font style="vertical-align: inherit;">This is a cons pair, with a relation in CAR (for example </font></font><code>nm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, for an object name) and an expression in a CDR (usually </font></font><code>(: home obj)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an object stored in the property of the </font></font><code>obj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">current form). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the following isolated and simple example, we create a temporary database and get access to the properties </font></font><code>nr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and the </font></font><code>nm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">object stored in the global variable </font></font><code>*Obj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="lisp hljs">######################################################################## (<span class="hljs-name"><span class="hljs-name">when</span></span> (<span class="hljs-name"><span class="hljs-name">app</span></span>) # On start of session (<span class="hljs-name"><span class="hljs-name">class</span></span> +Tst +Entity) # Define data model (<span class="hljs-name"><span class="hljs-name">rel</span></span> nr (<span class="hljs-name"><span class="hljs-name">+Number</span></span>)) # with a number (<span class="hljs-name"><span class="hljs-name">rel</span></span> nm (<span class="hljs-name"><span class="hljs-name">+String</span></span>)) # and a string (<span class="hljs-name"><span class="hljs-name">pool</span></span> (<span class="hljs-name"><span class="hljs-name">tmp</span></span> <span class="hljs-string"><span class="hljs-string">"db"</span></span>)) # Create temporary DB (<span class="hljs-name"><span class="hljs-name">setq</span></span> *Obj # and a single object (new! '(+Tst) 'nr 1 'nm "New Object") ) ) (action (html 0 "+E/R" "@lib.css" NIL (form NIL (gui '(+E/R +NumField) '(nr . *Obj) <span class="hljs-number"><span class="hljs-number">8</span></span>) # Linkage to 'nr' (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+E/R +TextField) '(nm . *Obj) 20) # Linkage to 'nm' (gui '(+JS +Button) "Show" # Show the object '(out 2 (show *Obj)) ) ) ) ) # on standard error ########################################################################</code> </pre><br><hr><br><h3><a name="buttons"></a>  Buttons </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buttons are, as described in </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Control Flow</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the only way to interact with the application server (through POST requests). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Basically </font></font><code>+Button</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">takes</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a name that can be a string or the name of an image file </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> optional alternate name that can be displayed when the button is disabled </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and executable expression. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Below is an example of a minimal button, with a name and expression: </font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Button) <span class="hljs-string"><span class="hljs-string">"Label"</span></span> '(doSomething))</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And this is a display of various names, depending on the state of the button: </font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Button) <span class="hljs-string"><span class="hljs-string">"Enabled"</span></span> <span class="hljs-string"><span class="hljs-string">"Disabled"</span></span> '(doSomething))</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To display an image instead of plain text, the label must be preceded by the symbol </font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">gui</span></span> '(+Button) T <span class="hljs-string"><span class="hljs-string">"img/enabled.png"</span></span> <span class="hljs-string"><span class="hljs-string">"img/disabled.png"</span></span> '(doSomething))</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The expression will be executed during processing </font></font><code>action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(see </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Forms</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) when this button is pressed. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Like other components, the button can be expanded and combined with prefix classes; for this, a number of predefined classes and their combinations are available.</font></font><br><br><h4><a name="dialogButtons"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dialog Buttons </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buttons are important for handling </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alerts and dialog boxes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In addition to buttons for common functions, such as </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scrolling</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in tables or other </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">side effects,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> there are special buttons that can </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">close an</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> alert or dialog box in addition to their main functions. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Such buttons are typically subclasses </font></font><code>+Close</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and most of them can be easily caused using prefabricated type functions </font></font><code>closeButton</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>cancelButton</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>yesButton</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code>noButton</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">We have seen several examples in </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alerts and dialogs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h4><a name="jsButtons"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Active JavaScript </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When a button is inherited from a class </font></font><code>+JS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(and JavaScript is enabled in the browser), it is possible that the button will show a much faster response to clicks. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The reason for this is that </font></font><code>+JS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instead of the usual POST, it first tries to send only the contents of all GUI components to the server via XMLHttpRequest, and get the updated values ‚Äã‚Äãin response. This avoids the flicker caused by re-loading and rendering of the entire page, it is much faster, moreover it does not cause scrolling to the top of the page if it is larger than the browser window. This is especially noticeable when scrolling through tables. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Only if this fails, the form will be sent with a regular POST request. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So it makes no sense to use the prefix</font></font><code>+JS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for buttons that trigger an HTML code change, open a dialog box or go to another page. </font><font style="vertical-align: inherit;">In such cases, the overall performance will be even worse, because XMLHttpRequest will be called first. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When JavaScript is disabled in the browser, XMLHttpRequest will not be used at all. </font><font style="vertical-align: inherit;">The form will be fully usable, with exactly the same functionality, just a little slower and not so smooth.</font></font><br><br><hr><br><h2><a name="minApp"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Minimum finished application </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The PicoLisp distribution includes a minimal but complete application in the app / directory. </font><font style="vertical-align: inherit;">This application is typical, in the sense that it implements many of the methods described in this document, and it can be easily modified and extended. </font><font style="vertical-align: inherit;">In practice, we use it as a template for developing our own applications.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is a kind of simplified ERP-system containing customers / suppliers, products (positions), orders and other data. </font><font style="vertical-align: inherit;">The order entry form performs live updates of customer and product selection, pricing, inventory, and total cost calculation and creates PDF documents on the fly. </font><font style="vertical-align: inherit;">Access is fine-tuned using users, roles, and permissions. </font><font style="vertical-align: inherit;">The application is localized in six languages ‚Äã‚Äã(English, Spanish, German, Norwegian, Russian and Japanese), has some basic data and two sample reports.</font></font><br><br><hr><br><h3><a name="getStarted"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Getting started </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For a global installation (see </font></font><a href="http://software-lab.de/doc/ref.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), create a symbolic link to the place where the program files are installed. </font><font style="vertical-align: inherit;">This is necessary because the application requires read / write access to the current working directory (for the database and other data at run time).</font></font><br><br><pre> <code class="lisp hljs">$ ln -s /usr/share/picolisp/app</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As always, you can run the application in debug mode. </font></font><br><br><pre> <code class="lisp hljs">$ pil app/main.l -main -go +</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or in production mode (non-debug) </font></font><br><br><pre> <code class="lisp hljs">$ pil app/main.l -main -go -wait</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and go to ' </font></font><a href="http://localhost:8080/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http: // localhost: 8080</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' in your browser. </font><font style="vertical-align: inherit;">You can log in as ‚Äúadmin‚Äù user, password ‚Äúadmin‚Äù. </font><font style="vertical-align: inherit;">The demonstration data contains several other users, but their roles are more limited in rights. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Another possibility is to try the online version of this application on </font></font><a href="http://app.7fach.de/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">app.7fach.de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h4><a name="localization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Localization </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Before or after you are logged in, you can select another language and click on the ‚ÄúChange‚Äù button. </font><font style="vertical-align: inherit;">This will affect all GUI components (but not the text from the database), as well as numeric formats, dates, and phone numbers.</font></font><br><br><h4><a name="navigation"></a>  Navigation </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The navigation menu on the left side shows two items ‚ÄúHome‚Äù and ‚Äúlogout‚Äù and three submenus ‚ÄúData‚Äù, ‚ÄúReport‚Äù and ‚ÄúSystem‚Äù. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Both ‚ÄúHome‚Äù and ‚Äúlogout‚Äù will switch you back to the initial login form. If you want to switch to another user (say, for a different role), use ‚Äúlogout‚Äù and ‚Äî more importantly ‚Äî log out before you close the browser to avoid possible blocking on the server. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The ‚ÄúData‚Äù submenu provides access to application data and maintenance: orders, products, customers and suppliers. The Report submenu contains two simple reports on inventory and sales. The System submenu allows you to administer user rights and their roles.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Each submenu can be closed and opened independently. </font><font style="vertical-align: inherit;">The presence of several simultaneously open submenus allows you to quickly switch between different parts of the application. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The active menu item is indicated by a different list bullet style.</font></font><br><br><h4><a name="choosing"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Object selection </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Each item in the ‚ÄúData‚Äù or ‚ÄúSystem‚Äù submenu opens a search dialog box for this class of entities. You can specify a search pattern, click the Search button (or just ENTER) and scroll through the list of results. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">While in ‚ÄúRole‚Äù and ‚ÄúUser‚Äù for entities, simple dialogs are provided (search by name only), other types of entities can be found by various criteria. In these cases, the "Reset" button clears the contents of the entire dialog box. A new object can be created with the lower right button ‚ÄúNew‚Äù. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In any case, the first column will contain either a ‚Äú@‚Äù link (to go to this object) or an ‚Äú@‚Äù button (to insert a link to this object in the current form). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By default, the search returns all database objects with an attribute value </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">greater than or equal to</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">search criteria. </font><font style="vertical-align: inherit;">Comparison is done arithmetically for numbers and alphabetically (case sensitive!) For text. </font><font style="vertical-align: inherit;">This means that if you enter ‚ÄúFree‚Äù in the ‚ÄúCity‚Äù field in the ‚ÄúCustomer / Supplier‚Äù dialog, then the value of ‚ÄúFreetown‚Äù will match the search criteria. </font><font style="vertical-align: inherit;">On the other hand, entering ‚Äúfree‚Äù or ‚Äútown‚Äù will not find ‚ÄúFreetown.‚Äù </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Some search fields, however, show different behavior depending on the application:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The names of individuals, companies, or products allow tolerant searching, matching a slightly incorrectly written name (‚ÄúM√ºhler‚Äù instead of ‚ÄúMiller‚Äù) or, for example, a substring (‚ÄúOaks‚Äù will correspond to ‚ÄúSeven Oaks Ltd.‚Äù). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the search field, an upper limit can be specified instead of a lower one, which will lead to a search for database objects with an attribute value less than or equal to the search criteria. </font><font style="vertical-align: inherit;">This is useful, for example, in the Order dialog box to list the orders according to their number or date, starting with the most recent ones.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using the scroll buttons, you can scroll through the list of results without restriction. </font><font style="vertical-align: inherit;">Clicking on the link will display the corresponding object. </font><font style="vertical-align: inherit;">Be careful to select the desired column: some dialogs (‚ÄúItem‚Äù and ‚ÄúOrder‚Äù) also provide links to related entities (for example, ‚Äúsupplier‚Äù).</font></font><br><br><h4><a name="editing"></a>  Editing </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A database object is usually displayed in its own individual form, which is determined by its entity class. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The basic layout should be consistent for all classes: under the title (which usually matches the menu item) is the object ID (name, number, etc.), and then the line with the Edit button on the left side and the Delete buttons, "Select" and two navigation links on the right side. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The form is initially displayed as read only. This is necessary to prevent multiple users from simultaneously modifying an object (unlike previous PicoLisp Java frameworks, where this was not a problem, because all changes were immediately reflected in other users' GUIs).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So if you want to change an object, you need to get exclusive access by clicking on the ‚ÄúEdit‚Äù button. The form is unlocked, and the Edit button changes to Done. If another user has already blocked this object, you will see a message with its name and process ID. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The exceptions are objects that have just been created with "New". They will automatically be reserved for you, and the ‚ÄúEdit‚Äù button will be displayed as ‚ÄúDone‚Äù. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The ‚ÄúDelete‚Äù button displays a dialog asking for confirmation. If the object is indeed deleted, this button changes to ‚ÄúRestore‚Äù and allows you to restore the object. Note that objects are never completely removed from the database as long as they are referenced from other objects. When a ‚Äúdeleted‚Äù object is displayed, its identifier is displayed in square brackets.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The ‚ÄúSelect‚Äù button (re) displays a search dialog for this entity class. Search criteria are saved between calls to search dialogs. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Navigation links pointing left and right serve a similar purpose. They allow you to step by step through all the objects in a given class, in order of index. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Other buttons, depending on the entity, are usually located at the bottom of the form. At the bottom right, there should always be another ‚ÄúEdit‚Äù / ‚ÄúDone‚Äù button. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As we said in the chapter on </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scrolling</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, any button in the form saves the changes to the underlying data model. </font><font style="vertical-align: inherit;">However, as a special case, the ‚ÄúDone‚Äù button releases the object and returns to ‚ÄúEdit‚Äù. </font><font style="vertical-align: inherit;">In addition, the editing mode will be interrupted as soon as another object appears, called by clicking on the object link (pencil icon), the top right navigation link, or the link in the search dialog box.</font></font><br><br><h4><a name="btnLinks"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vs link buttons </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The only way to interact with the HTTP-based application server is either to click on the HTML link, or on the submit button (see also </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">control flow</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">It is important to understand the various effects of such clicking on data entered or modified in the current form.</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By clicking on the link, we leave or reload the page. </font><font style="vertical-align: inherit;">Changes are undone.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> By clicking on the button, we apply the changes and perform the appropriate actions. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For this reason, the layout of the structure should clearly distinguish between links and buttons. </font><font style="vertical-align: inherit;">Buttons in the form of images is not a good idea when in other places images are used for links. </font><font style="vertical-align: inherit;">Standard buttons are preferred; </font><font style="vertical-align: inherit;">they are usually displayed by the browser in an unambiguous three-dimensional form. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Please note that if JavaScript is enabled in the browser, the changes will be automatically sent to the server. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The on or off state of a button is an integral part of the application logic. </font><font style="vertical-align: inherit;">This should be indicated to the user by appropriate styles.</font></font><br><br><hr><br><h3><a name="dataModel"></a>  Data model </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The data model for this gadget consists of only six classes of entities (see Figure E / R at the beginning of ‚Äúapp / er.l‚Äù): </font></font><br><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">### Entity / Relations ###
</font></font> #<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
# nr nm nr nm nm</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
# | </font></font> |  |  |  |<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
# + - * ---- * - + + - * ---- * - + + - * ----- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
# | </font></font> |<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sup | </font></font> |  |  |<font></font>
# str --* CuSu O-----------------* Item *-- inv | Role @-- perm<font></font>
# |  |  |  |  |  |<font></font>
# +-*-*--O-+ +----O---+ +----@---+<font></font>
# |  |  |  |  | usr<font></font>
# nm tel -+ |  |  |  |
# |  |  |  | itm | role<font></font>
# +-*-----+ |  | +-------+ +---*---+ +----*---+<font></font>
# |  |  |  |  |  | ord |  |  |  |<font></font>
# | Sal +---+ +---* Ord @--------* Pos | nm --* User *-- pw<font></font>
# |  | cus |  | pos |  |  |  |<font></font>
# +-*---*-+ +-*---*-+ +-*---*-+ +--------+<font></font>
# |  |  |  |  |  |<font></font>
# hi sex nr dat pr cnt<font></font>
</pre><br><ul><li>    ‚Äî <code>+CuSu</code> (/), <code>+Item</code> ()  <code>+Ord</code> (). </li><li>  <code>+Pos</code>     . </li><li> <code>+Role</code>  <code>+User</code>      . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Classes </font></font><code>+Role</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and are </font></font><code>+User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">defined in "@ lib / adm.l". </font></font><code>+Role</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">has a name, a list of permissions, and a list of users assigned to this role. </font></font><code>+User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">has a name, password and role. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In app / er.l, the class </font></font><code>+Role</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">expands to define a method for it </font></font><code>url&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Any object whose class has such a method is able to display itself in the GUI. In this case, the file ‚Äúapp / role.l‚Äù will be loaded ‚Äî with a global variable </font></font><code>*ID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pointing to it ‚Äî each time the HTML link to this object is activated. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The class is </font></font><code>+User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">also expanded. In addition to login, the full name, e-mail and phone number are added. And, of course, the omnipresent method </font></font><code>url&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Application logic revolves around orders. Order has number, date, customer (copy</font></font><code>+CuSu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) and a list of positions (objects </font></font><code>+Pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). The method </font></font><code>sum&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calculates the total cost of this order. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Each item has a link to the object </font></font><code>+Item</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(product), price and quantity. The price in the position overrides the default price for the corresponding item. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Each product has a number, description, supplier (also a copy </font></font><code>+CuSu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), inventory accounting (number of items from the last inventory) and price. The method </font></font><code>cnt&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calculates the current stock of this item as the difference between the inventory and the quantity of the item sold. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Function call</font></font><code>dbs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at the end of ‚Äúapp / er.l‚Äù configures the physical structure of the database. </font><font style="vertical-align: inherit;">Each of the provided lists has a number in CAR, which determines the block size of the corresponding database file as a power of 64 (64 &lt;&lt; N). </font><font style="vertical-align: inherit;">The CDR determines that instances of this class (if the element is a class symbol) or tree nodes (if the element is a list of the class symbol and property name) must be placed in this file. </font><font style="vertical-align: inherit;">This allows for some optimization in the database structure.</font></font><br><pre> <code class="lisp hljs"># Database sizes (<span class="hljs-name"><span class="hljs-name">dbs</span></span> (<span class="hljs-number"><span class="hljs-number">3</span></span> +Role +User +Sal) # <span class="hljs-number"><span class="hljs-number">512</span></span> Prevalent objects (<span class="hljs-number"><span class="hljs-number">0</span></span> +Pos) # A:<span class="hljs-number"><span class="hljs-number">64</span></span> Tiny objects (<span class="hljs-number"><span class="hljs-number">1</span></span> +Item +Ord) # B:<span class="hljs-number"><span class="hljs-number">128</span></span> Small objects (<span class="hljs-number"><span class="hljs-number">2</span></span> +CuSu) # C:<span class="hljs-number"><span class="hljs-number">256</span></span> Normal objects (<span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-name"><span class="hljs-name">+Role</span></span> nm) (<span class="hljs-name"><span class="hljs-name">+User</span></span> nm) (<span class="hljs-name"><span class="hljs-name">+Sal</span></span> nm)) # D:<span class="hljs-number"><span class="hljs-number">256</span></span> Small indexes (<span class="hljs-number"><span class="hljs-number">4</span></span> (<span class="hljs-name"><span class="hljs-name">+CuSu</span></span> nr plz tel mob)) # E:<span class="hljs-number"><span class="hljs-number">1024</span></span> Normal indexes (<span class="hljs-number"><span class="hljs-number">4</span></span> (<span class="hljs-name"><span class="hljs-name">+CuSu</span></span> nm)) # F:<span class="hljs-number"><span class="hljs-number">1024</span></span> (<span class="hljs-number"><span class="hljs-number">4</span></span> (<span class="hljs-name"><span class="hljs-name">+CuSu</span></span> ort)) # G:<span class="hljs-number"><span class="hljs-number">1024</span></span> (<span class="hljs-number"><span class="hljs-number">4</span></span> (<span class="hljs-name"><span class="hljs-name">+Item</span></span> nr sup pr)) # H:<span class="hljs-number"><span class="hljs-number">1024</span></span> (<span class="hljs-number"><span class="hljs-number">4</span></span> (<span class="hljs-name"><span class="hljs-name">+Item</span></span> nm)) # I:<span class="hljs-number"><span class="hljs-number">1024</span></span> (<span class="hljs-number"><span class="hljs-number">4</span></span> (<span class="hljs-name"><span class="hljs-name">+Ord</span></span> nr dat cus)) # J:<span class="hljs-number"><span class="hljs-number">1024</span></span> (<span class="hljs-number"><span class="hljs-number">4</span></span> (<span class="hljs-name"><span class="hljs-name">+Pos</span></span> itm)) ) # K:<span class="hljs-number"><span class="hljs-number">1024</span></span></code> </pre><br><hr><br><h3><a name="usage"></a>  Using </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After connecting to the application (see </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Getting Started</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), you can try to do some ‚Äúreal‚Äù work with it. </font><font style="vertical-align: inherit;">Through the ‚ÄúData‚Äù menu (see </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">navigation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), you can create or edit customers, suppliers, products and orders, and create simple reports through the ‚ÄúReport‚Äù menu.</font></font><br><br><h4><a name="cuSu"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Customer / Supplier </font></font></h4><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúApp / cusu.l‚Äù The </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">client / provider search dialog ( </font></font><code>choCuSu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in ‚Äúapp / gui.l‚Äù) supports many search criteria. They become necessary when the database contains a large number of clients, and can be filtered by zip, phone number prefixes, and so on. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition to the main layout (see </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Editing</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), the form is divided into four separate tabs. Splitting the form into several tabs allows you to reduce traffic, with a possible faster GUI response. In this case, perhaps four tabs are unnecessary, but quite suitable for demonstration purposes, and they leave room for extensions.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keep in mind that when the data has been changed in one of the tabs, the ‚ÄúDone‚Äù button must be pressed before selecting another tab, because the tabs are implemented as HTML links (see </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buttons vs links</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For new customers or suppliers, the next available number will be automatically assigned. You can enter another number, but if you try to use an existing number, an error will occur. The field "Name" is mandatory. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phone and fax numbers in the ‚ÄúContact‚Äù tab should be entered in the correct format, depending on the locale (see </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phone numbers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The ‚ÄúMemo‚Äù tab contains one text area. You can use it for large pieces of text, as it is stored in a blob object.</font></font><br><br><h4><a name="item"></a>  Product </h4><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúApp / item.l‚Äù </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Products also have a unique number and a required field ‚ÄúDescription‚Äù. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To assign a supplier, click on the "+" button. The customer / supplier search dialog box will appear, and you can select the desired supplier by clicking the "@" button in the first column. In addition, if you are sure that you know the exact spelling of the supplier‚Äôs name, you can also type it directly in the text field. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the Search dialog box, you can also click on the link, for example, to explore possible suppliers and then return to the search window by clicking the back button in the browser. The ‚ÄúEdit‚Äù mode will of course be canceled, since you have moved to another object (this is described in the last part of the </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">editing</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can enter inventory - the quantity of goods currently in stock. The next field automatically reflects the quantity of the remaining product after a certain quantity has been sold (that is, they have links in the order items). This value cannot be changed manually. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pricing must be entered with a decimal separator depending on the current locale. It will be formatted with two characters after the decimal separator. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The ‚ÄúMemo‚Äù field, as well as in the </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Client / provider</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> above, is stored in the DB blob object.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finally, a JPEG image can be stored in a blob for this item. Select a file using the file selection dialog and click on the ‚ÄúInstall‚Äù button. The image will appear at the bottom of the page, and the Set button changes to Delete, allowing you to delete the image.</font></font><br><br><h4><a name="order"></a>  Order </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúApp / ord.l‚Äù </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orders are identified by number and date. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The number must be unique. It is assigned when an order is created and cannot be changed. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The date for the newly created order is set to today, but can be changed manually. The date format depends on the locale. These are YYYY-MM-DD (ISO) by default, DD.MM.YYYY in German and YYYY / MM / DD in Japanese. As described in the </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time and date</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , this field allows abbreviated input, for example, just enter the day to get the full date in the current month.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To assign a customer to this order, click on the "+" button. The Search Client / Supplier dialog box appears, and you can select the desired client with the ‚Äú@‚Äù button in the first column (or enter the name directly in the text field), as described above for the </font></font><a href="https://habr.com/ru/post/178235/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">product</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now enter the order items: select the product using the "+" button. In the field "Price" will be the default price, you can change it manually. Then enter the quantity and press the button (usually the ‚Äú+‚Äù button to select the next item or the scroll button). The form will be automatically recalculated to show the total value of the items and the entire order.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instead of ‚Äú+‚Äù or the scroll button, as recommended above, of course, you can also click the ‚ÄúDone‚Äù button to save the changes. But this will cause the button to be pressed a second time (now ‚ÄúEdit‚Äù) if you want to continue to fill positions. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The ‚Äúx‚Äù button on the right side of each position deletes this position without further confirmation. It must be used with care! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The ‚Äú^‚Äù button swaps the current line with the parent line. Thus, it can be used to change the location of all the elements in the table, by raising them to the desired position.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The ‚ÄúPDF-Print‚Äù button creates and displays a PDF document for this order. The browser must be configured to display downloaded PDF documents in the appropriate viewer. The source of the postscript-creating method is in ‚Äúapp / lib.l‚Äù. It produces one or more A4 pages, depending on the number of positions.</font></font><br><br><h4><a name="reports"></a>  Reports </h4><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúApp / inventory.l and‚Äú app / sales.l ‚Äù </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Two reports (‚Äú Inventory ‚Äùand‚Äú Sales ‚Äù) contain several search fields and a‚Äú Show ‚Äùbutton. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the search criteria are not specified, the ‚ÄúShow‚Äù button will display a list of the relevant part of the entire database. </font><font style="vertical-align: inherit;">This can take a long time and cause a heavy load on the browser if the database is large. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So in the normal case, you will limit the selection by specifying the number range, description template and / or supplier for the inventory report or range of order dates and / or customer for the sales report. </font><font style="vertical-align: inherit;">If the corresponding value is omitted, objects are not filtered by this criterion. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the end of each report, a ‚ÄúCSV‚Äù link appears. </font><font style="vertical-align: inherit;">It loads the file generated in the report.</font></font></div><p>Source: <a href="https://habr.com/ru/post/178235/">https://habr.com/ru/post/178235/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../178219/index.html">Report from Silicon Valley. Hacker Dojo Tour - Free Coworking Center</a></li>
<li><a href="../178225/index.html">FAQ on UC Browser for Android</a></li>
<li><a href="../178227/index.html">The digest of news from the world of mobile development for the last week ‚Ññ11 (April 22 - 28, 2013)</a></li>
<li><a href="../178231/index.html">Women install 40% more applications and spend 87% more on them</a></li>
<li><a href="../178233/index.html">Rates on bookmaker ratios on the example of Formula 1</a></li>
<li><a href="../178243/index.html">Frisbee for robots or the game of future engineers</a></li>
<li><a href="../178245/index.html">Report from Google Code-In Final, California</a></li>
<li><a href="../178247/index.html">Work as if you have no talent.</a></li>
<li><a href="../178249/index.html">AOSP for Sony Xperia Z</a></li>
<li><a href="../178251/index.html">Windows Azure Update: point-to-site connectivity and other improvements to virtual machines and networks, cloud services, and the release of the Ruby SDK</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>