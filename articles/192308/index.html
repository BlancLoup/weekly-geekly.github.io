<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Network caching in iOS. Introduction</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Virtually every mobile application gets any data from the network. 
 Unfortunately, access to the network is not always possible and therefore it is i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Network caching in iOS. Introduction</h1><div class="post__text post__text-html js-mediator-article">  Virtually every mobile application gets any data from the network. <br>  Unfortunately, access to the network is not always possible and therefore it is important for the developer to correctly implement the network cache in the application. <br><br>  In this regard, I decided to write a series of articles on what <b>methods of cache implementation</b> exist <b>and when to use them</b> . <br><br>  So, the introduction. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Caching strategies </h1><br>  There are two approaches to caching: on-demand caching and pre-caching. <br><br>  <b>On-demand caching</b> allows you to view content that was previously viewed offline.  The data received from the server is stored on the device and for each request, their relevance is checked.  If the data is relevant, then they are taken from the disk, if not then a request is sent to the server. <br><br>  <b>Pre-caching</b> means that all data that the user may need will be retrieved and saved to disk immediately. <br><br>  To determine which caching strategy to use, you need to understand whether post processing may be required after it is loaded.  Post processing implies any modification of the loaded data.  For example, changing the links in the HTML page so that they point to cached images locally, etc. <br><br><h1>  Where to store the cache </h1><br>  Applications can store information only in their sandbox.  Since cached data is not generated by the user, they should be stored in NSCachesDirectory, not in NSDocumentsDirectory.  It is a good practice to create a separate directory for all cached data. <br><br>  In this example, the directory MyAppCache is created in the Library / Caches folder: <br><pre><code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *paths = <span class="hljs-built_in"><span class="hljs-built_in">NSSearchPathForDirectoriesInDomains</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">NSCachesDirectory</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">NSUserDomainMask</span></span>, <span class="hljs-literal"><span class="hljs-literal">YES</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *cachesDirectory = [paths objectAtIndex:<span class="hljs-number"><span class="hljs-number">0</span></span>]; cachesDirectory = [cachesDirectory stringByAppendingPathComponent:@‚ÄùMyAppCache‚Äù];</code> </pre> <br>  The reason for storing the cache in the Library / Caches folder is that iCloud (and iTunes) excludes this directory from the backup.  And, therefore, the space limited in iCloud (at present for a free account, this is about 5 GB) is not spent on storing unnecessary data. <br><br>  If an application intensively caches, it is recommended to use memory instead of a disk and upload data to disk when the application is closed.  This is due to the fact that the iPhone's flash memory has a limited number of write / read cycles and it is undesirable to load it once again. <br><br><h1>  How to store cache </h1><br>  On iOS, there are many different ways to store user data.  Best suited for caching: NSKeyedArchiver, Core Data, SQLite, NSURLCache. <br><br><h2>  NSKeyedArchiver </h2><br>  Data model caching is implemented using the NSKeyedArchiver class.  In order for model objects to be archived, model classes must implement the NSCoding protocol.  Namely methods <br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)encodeWithCoder:(<span class="hljs-built_in"><span class="hljs-built_in">NSCoder</span></span> *)aCoder; - (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)initWithCoder:(<span class="hljs-built_in"><span class="hljs-built_in">NSCoder</span></span> *)aDecoder;</code> </pre><br>  If the class implements NSCoding, for archiving it is enough to call one of the following methods: <br><pre> <code class="objectivec hljs">[<span class="hljs-built_in"><span class="hljs-built_in">NSKeyedArchiver</span></span> archiveRootObject:objectForArchiving toFile:archiveFilePath];</code> </pre><br><pre> <code class="objectivec hljs">[<span class="hljs-built_in"><span class="hljs-built_in">NSKeyedArchiver</span></span> archivedDataWithRootObject:objectForArchiving];</code> </pre><br>  The first method will create a file with the archive in the path archiveFilePath.  The second method will return an NSData object.  NSData is usually faster, since there are no additional costs for accessing the file, but the data will be stored in the application's memory. <br><br>  To unzip a model from a file (or a pointer to NSData), use the NSKeyedUnarchiver class.  You can unarchive data using one of the following methods: <br><pre> <code class="objectivec hljs">[<span class="hljs-built_in"><span class="hljs-built_in">NSKeyedUnarchiver</span></span> unarchiveObjectWithData:data];</code> </pre><br><pre> <code class="objectivec hljs">[<span class="hljs-built_in"><span class="hljs-built_in">NSKeyedUnarchiver</span></span> unarchiveObjectWithFile:archiveFilePath];</code> </pre><br>  Using NSKeyedArchiver / NSKeyedUnarchiver requires that models comply with the NSCoding protocol.  The implementation of NSCoding is very simple, but if there are many files, it can take a long time.  Therefore, to automate this process is better to use any tool.  For example, the development environment <a href="http://www.jetbrains.com/objc/">AppCode</a> . <br><br><h2>  Core data </h2><br>  To store data in Core Data, you must create a model file that contains a description of the entities (Entities), as well as relationships between them (Relationships), and write methods for storing and retrieving data.  Using Core Data, you can get a real offline mode of the application, as is done in standard Mail and Calendar applications. <br><br>  When implementing pre-caching, you need to periodically delete data that is not needed.  Otherwise, the cache size will start to grow significantly, which will cause a loss of performance.  Local changes are synchronized by tracking the change set and sending it back to the server.  There are many algorithms for tracking change sets, but it's better to use one of those that works in Git. <br><br>  Although Core Data can be used for on-demand caching, it‚Äôs best not to.  The main advantage of Core Data is to provide access to model properties without having to unzip all the data.  However, the complexity of implementing Core Data in an application outweighs this advantage. <br><br><h2>  Raw SQLite </h2><br>  To work with SQLite, you need to link the application with the libsqlite3 library, but this approach has significant drawbacks. <br>  All sqlite3 libraries and the Object Relational Mapping (ORM) mechanism are slower than Core Data.  In addition, the implementation of sqlite3 in iOS is not thread safe.  So if you are not using a separately compiled sqlite3 library (compiled with the thread-safe flag), then you are responsible for ensuring that the thread-safe read / write access to the sqlite3 database is guaranteed. <br><br>  Since Core Data can offer much more features (data migration, embedded thread-security, ...), it is recommended to avoid using native SQLite on iOS. <br><br><h2>  NSURLCache </h2><br>  Ideal for on-demand caching.  Allows you to cache the data returned by NSURLRequest almost automatically and requires a minimum of code. <br><br>  Just a couple of lines and your application will receive a disk cache for requests. <br><pre> <code class="objectivec hljs">- (<span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span>)application:(<span class="hljs-built_in"><span class="hljs-built_in">UIApplication</span></span> *)application didFinishLaunchingWithOptions:(<span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *)launchOptions { <span class="hljs-built_in"><span class="hljs-built_in">NSURLCache</span></span> *URLCache = [[<span class="hljs-built_in"><span class="hljs-built_in">NSURLCache</span></span> alloc] initWithMemoryCapacity:<span class="hljs-number"><span class="hljs-number">4</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span> diskCapacity:<span class="hljs-number"><span class="hljs-number">20</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span> diskPath:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; [<span class="hljs-built_in"><span class="hljs-built_in">NSURLCache</span></span> setSharedURLCache:URLCache]; }</code> </pre><br><br>  Unfortunately, it is only suitable for REST services and there are problems when working with some HTTP headers. <br><br><h1>  Conclusion </h1><br>  To implement on-demand caching, it is better to use NSURLCache or NSKeyedArchiver.  The implementation of a fully functional offline mode requires work with CoreData. <br><br>  In the next part, I plan to examine in detail the work with NSURLCache / NSKeyedArchiver and describe the cases for which they are suitable. </div><p>Source: <a href="https://habr.com/ru/post/192308/">https://habr.com/ru/post/192308/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../192294/index.html">0day in the Any.DO extension - access to data on all sites (bypass gmail 2-steps auth). Public disclosure. ~ 500 thousand users affected</a></li>
<li><a href="../192296/index.html">10 Tips for a Freelance Customer</a></li>
<li><a href="../192298/index.html">And let's help them, blocking content and sites</a></li>
<li><a href="../192302/index.html">We make admin panel for MySQL and MongoDB on Node.js</a></li>
<li><a href="../192304/index.html">The fourth issue of TsODY.RF magazine</a></li>
<li><a href="../192310/index.html">Quick Help for your code in Xcode 5</a></li>
<li><a href="../192312/index.html">Online music editor</a></li>
<li><a href="../192316/index.html">So what is Clodo SLA?</a></li>
<li><a href="../192318/index.html">Kim Dotcom organizes a political party in New Zealand</a></li>
<li><a href="../192320/index.html">Dark programming</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>