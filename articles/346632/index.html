<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Parsim memes in python: how to bypass the server lock</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="New Year's holidays are a great excuse to grow in a comfortable home environment and remember dear to me from 2k17 hearts that disappear forever, like...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Parsim memes in python: how to bypass the server lock</h1><div class="post__text post__text-html js-mediator-article"><p>  New Year's holidays are a great excuse to grow in a comfortable home environment and remember dear to me from 2k17 hearts that disappear forever, like the conscience of Electronic Arts. </p><br><img src="https://habrastorage.org/webt/qr/lg/rw/qrlgrwehvwohaffw-qe5reaxm6e.jpeg" width="250" align="right"><br><p>  However, even the conscience, richly flavored with salads, sometimes woke up and demanded a little bit of control and engage in useful activities.  Therefore, we combined business with pleasure and, using the example of our favorite memes, we looked at how we could parse our small base. <br>  data, passing along all sorts of locks, pitfalls and restrictions placed by the server in our path.  All interested kindly invite under the cat. </p><a name="habracut"></a><br><p>  Machine learning, econometrics, statistics and many other data sciences are engaged in the search for patterns.  Every day, valiant analyst inquisitors torture nature with different methods and extract information from it about how the great data-generating process that created our universe works.  Spanish inquisitors in their daily activities used directly the physical body of their victim.  Nature is omnipresent and does not have an unambiguous physical appearance.  Because of this, the profession of the modern inquisitor has a strange specificity - the torture of nature occurs through the analysis of data that must be taken from somewhere.  Typically, data to the inquisitors bring peace collectors.  This little article is designed to slightly open the veil of secrecy about where the data come from and how to get them a little bit. </p><br><p>  Our motto was the famous phrase of Captain Jack Sparrow: "Take everything and give nothing away."  Sometimes you have to use pretty gangster methods to collect memes.  Nevertheless, we will remain peaceful data collectors, and in no way will we become bandits.  We will take memes from the main <a href="http://knowyourmeme.com/">memorial depository.</a> </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/a7/wr/de/a7wrde9j8hwq-aztkijpk_bna8e.jpeg" width="250"></div><br><h1 id="1-vlamyvaemsya-v-memohranilische">  1. Mlamyvae in the memorial </h1><br><h2 id="11-chto-my-hotim-poluchit">  1.1.  What we want to get </h2><br><p>  So, we want to <a href="http://knowyourmeme.com/">parse knowyourmeme.com</a> and get a bunch of different variables: </p><br><ul><li>  <strong>Name</strong> - the name of the meme, </li><li>  <strong>Origin_year</strong> - the year of its creation, </li><li>  <strong>Views</strong> - the number of views </li><li>  <strong>About</strong> - textual description of the meme, </li><li>  <strong>and many others</strong> </li></ul><br><p>  Moreover, we want to do it without all this: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cg/bw/ps/cgbwpskfdnsiyv7yfnrj5fugcaq.png" width="600"></div><br><p>  After downloading and cleaning the data from the garbage can be done building models.  For example, try to predict the popularity of a meme by its parameters.  But this is all later, and now we will get acquainted with a couple of definitions: </p><br><ul><li>  <strong>Parser</strong> is a script that robs information from the site. </li><li>  <strong>The crawler</strong> is the part of the parser that roams the links. </li><li>  <strong>Crawling</strong> is a transition through pages and links. </li><li>  <strong>Scraping</strong> is the collection of data from pages. </li><li>  <strong>Parsing</strong> is at once crawling and scraping! </li></ul><br><h2 id="12--chto-takoe-html">  1.2.  What is HTML? </h2><br><p> <strong>HTML (HyperText Markup Language)</strong> is a markup language like Markdown or LaTeX.  It is standard for writing various sites.  Commands in such a language are called <strong>tags</strong> .  If you open absolutely any site, click on the right mouse button, and then click <code>View page source</code> , then you will see the HTML skeleton of this site. </p><br><p>  You can see that the HTML page is nothing more than a set of nested tags.  You may notice, for example, the following tags: </p><br><ul><li>  <code>&lt;title&gt;</code> - page title </li><li>  <code>&lt;h1&gt;‚Ä¶&lt;h6&gt;</code> - headings of different levels </li><li>  <code>&lt;p&gt;</code> - paragraph (paragraph) </li><li>  <code>&lt;div&gt;</code> - selection of a fragment of the document in order to change the appearance of the content </li><li>  <code>&lt;table&gt;</code> - drawing the table </li><li>  <code>&lt;tr&gt;</code> - separator for rows in the table </li><li>  <code>&lt;td&gt;</code> - separator for columns in a table </li><li>  <code>&lt;b&gt;</code> - sets the bold font. </li></ul><br><p>  Usually the command <code>&lt;...&gt;</code> opens the tag, and <code>&lt;/...&gt;</code> closes it.  Everything between these two commands follows the rule that the tag dictates.  For example, everything between <code>&lt;p&gt;</code> and <code>&lt;/p&gt;</code> is a separate paragraph. </p><br><p>  Tags form a kind of tree with a root in the <code>&lt;html&gt;</code> and split the page into different logical pieces.  Each tag can have its own descendants (children) - those tags that are embedded in it, and their parents. </p><br><p>  For example, an HTML tree of a page might look like this: </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>       <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span> ,   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/d9/6y/et/d96yet3figm2dgzqwxvd9kncc8c.png" width="500"></div><br><p>  You can work with this html as with the text, and you can as with the tree.  Traversing this tree is parsing a web page.  We will only find the nodes we need among all this diversity and collect information from them! </p><br><p>  Manually bypassing these trees is not very pleasant, so there are special languages ‚Äã‚Äãfor traversing trees. </p><br><ul><li>  <a href="https://ru.wikibooks.org/wiki/CSS/%25D0%25A1%25D0%25B5%25D0%25BB%25D0%25B5%25D0%25BA%25D1%2582%25D0%25BE%25D1%2580%25D1%258B">CSS selector</a> (this is when we search for a page element by a pair of key, value) </li><li>  <a href="https://ru.wikipedia.org/wiki/XPath">XPath</a> (this is when we write the path through the tree like this: / html / body / div [1] / div [3] / div / div [2] / div) </li><li>  All sorts of different libraries for all sorts of languages, for example, BeautifulSoup for python.  This is the library we will use. </li></ul><br><h2 id="13-nash-pervyy-zapros">  1.3.  Our first request </h2><br><p>  Access to the web pages allows you to receive <code>requests</code> .  We will load it.  For the company we will load a couple more efficient packages. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-comment"><span class="hljs-comment">#     import numpy as np #   ,    import pandas as pd #    import time #   -</span></span></code> </pre> <br><p>  For our noble research goals, we need to collect data on each topic from its corresponding page.  But first you need to get the addresses of these pages.  Therefore, we open the main page with all the laid out memes.  It looks like this: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bg/uj/jt/bgujjthbhbl-3rel7yaltmpt2mi.png" width="500"></div><br><p>  From here we will drag links to each of the listed memes.  Let's <code>page_link</code> address of the main page into the <code>page_link</code> variable and open it with the <code>requests</code> library. </p><br><pre> <code class="python hljs">page_link = <span class="hljs-string"><span class="hljs-string">'http://knowyourmeme.com/memes/all/page/1'</span></span> response = requests.get(page_link) response</code> </pre> <br><pre> <code class="python hljs">Out: &lt;Response [<span class="hljs-number"><span class="hljs-number">403</span></span>]&gt;</code> </pre> <br><p>  And here is the first problem!  Appeal to <img src="https://habrastorage.org/webt/s2/h3/15/s2h315819gr9jezijhucnbl7kvk.jpeg" width="280" align="right">  <a href="https://en.wikipedia.org/wiki/HTTP_403">the main source of knowledge</a> and find out that the 403rd error is issued by the server if it is available and able to process requests, but for some personal reasons refuses to do so. </p><br><p>  Let's try to find out why.  To do this, check what the final request sent by us to the server looked like, and more specifically, what our User-Agent looked like in the eyes of the server. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> key, value <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> response.request.headers.items(): print(key+<span class="hljs-string"><span class="hljs-string">": "</span></span>+value)</code> </pre> <br><pre> <code class="python hljs">Out: User-Agent: python-requests/<span class="hljs-number"><span class="hljs-number">2.14</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> Accept-Encoding: gzip, deflate Accept: */* Connection: keep-alive</code> </pre> <br><p>  It seems that we have made it clear to the server that we are sitting on a python and using the requests library under version 2.14.2.  Most likely, this caused the server some suspicions about our good intentions and he decided to ruthlessly reject us.  For comparison, you can see what the request-headers look like in a healthy person: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ug/-h/ht/ug-hhtcefyvc7bgfsdlzcvvepm8.png" width="800"></div><br><p>  Obviously, our humble request does not incur such an abundance of meta-information, which is transmitted upon request from a regular browser.  Fortunately, no one bothers us to pretend to be humane and throw dust into the eyes of the server by generating a fake user agent.  There are a lot of libraries that cope with this task; I personally like the most <a href="https://pypi.python.org/pypi/fake-useragent"><code>fake-useragent</code></a> .  When the method is called from different pieces, a random combination of the operating system, specifications and browser versions will be generated, which can be sent to the request: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#       from fake_useragent import UserAgent UserAgent().chrome</span></span></code> </pre> <br><pre> <code class="python hljs">Out: <span class="hljs-string"><span class="hljs-string">'Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2224.3 Safari/537.36'</span></span></code> </pre> <br><p>  Let's try to get rid of our request again, already with the generated agent. </p><br><pre> <code class="python hljs">response = requests.get(page_link, headers={<span class="hljs-string"><span class="hljs-string">'User-Agent'</span></span>: UserAgent().chrome}) response</code> </pre> <br><pre> <code class="python hljs">Out: &lt;Response [<span class="hljs-number"><span class="hljs-number">200</span></span>]&gt;</code> </pre> <br><p>  Great, our little disguise <img src="https://habrastorage.org/webt/7b/ue/pd/7buepdk0-3_kidrbnjhkcxsz-y4.jpeg" width="250" align="right">  the deceived server worked and meekly issued the blessed 200 answer - the connection was established and the data was received, everything is wonderful!  Let's see what we got after all. </p><br><pre> <code class="python hljs">html = response.content html[:<span class="hljs-number"><span class="hljs-number">1000</span></span>]</code> </pre> <br><pre> <code class="python hljs">Out: <span class="hljs-string"><span class="hljs-string">b'&lt;!DOCTYPE html&gt;\n&lt;html xmlns:fb=\'http://www.facebook.com/2008/fbml\' xmlns=\'http://www.w3.org/1999/xhtml\'&gt;\n&lt;head&gt;\n&lt;meta content=\'text/html; charset=utf-8\' http-equiv=\'Content-Type\'&gt;\n&lt;script type="text/javascript"&gt;window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","licenseKey":"c1a6d52f38","applicationID":"31165848","transactionName":"dFdfRUpeWglTQB8GDUNKWFRLHlcJWg==","queueTime":0,"applicationTime":59,"agent":""}&lt;/script&gt;\n&lt;script type="text/javascript"&gt;window.NREUM||(NREUM={}),__nr_require=function(e,t,n){function r(n){if(!t[n]){var o=t[n]={exports:{}};e[n][0].call(o.exports,function(t){var o=e[n][1][t];return r(o||t)},o,o.exports)}return t[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o&lt;n.length;o++)r(n[o]);return r}({1:[function(e,t,n){function r(){}function o(e,t,n){return function(){return i(e,[f.now()].concat(u(arguments)),t?null:this,n),t?void 0:this}}var i=e("handle"),a=e(2),u=e(3),c=e("ee").get("tracer")'</span></span></code> </pre> <br><p>  It looks indigestible, how about making something more beautiful out of this thing?  For example, a wonderful soup. </p><br><h2 id="14-prekrasnyy-sup">  1.4.  Lovely soup </h2><br><img src="https://habrastorage.org/webt/q6/qr/el/q6qrelgeilsjs40dfixamqc1pms.jpeg" width="200" align="right"><br><p>  Package <strong><a href="https://www.crummy.com/software/BeautifulSoup/">bs4, aka BeautifulSoup</a></strong> (there is a hyperlink to the person‚Äôs best friend - documentation) was named after the rhyme about the wonderful soup from Alice in Wonderland. </p><br><p>  A wonderful soup is a completely magical library, which, from raw and unprocessed HTML page code, will give you a structured array of data that makes it very convenient to search for the necessary tags, classes, attributes, texts, and other elements of web pages. </p><br><blockquote>  The package called <code>BeautifulSoup</code> is most likely not what we need.  This is the third version ( <em>Beautiful Soup 3</em> ), and we will use the fourth.  You will need to install the <code>beautifulsoup4</code> package.  To make it quite fun, when importing, you need to specify another package name - <code>bs4</code> , and import a function called <code>BeautifulSoup</code> .  In general, it is easy to get confused at first, but these difficulties must be overcome. </blockquote><p>  The package also works with the raw XML code of the page (XML is corrupted and turned into a dialect, with the help of its own commands, HTML).  In order for the package to work correctly with XML markup, you will have to install the <code>xml</code> package in the appendage of our entire arsenal. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> bs4 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BeautifulSoup</code> </pre> <br><p>  Pass the <code>BeautifulSoup</code> function to the text of the web page we recently received. </p><br><pre> <code class="python hljs">soup = BeautifulSoup(html,<span class="hljs-string"><span class="hljs-string">'html.parser'</span></span>) <span class="hljs-comment"><span class="hljs-comment">#      lxml, #     </span></span></code> </pre> <br><p>  We get something like this: </p><br><pre> <code class="python hljs">&lt;!DOCTYPE html&gt; &lt;html xmlns=<span class="hljs-string"><span class="hljs-string">"http://www.w3.org/1999/xhtml"</span></span> xmlns:fb=<span class="hljs-string"><span class="hljs-string">"http://www.facebook.com/2008/fbml"</span></span>&gt; &lt;head&gt; &lt;meta content=<span class="hljs-string"><span class="hljs-string">"text/html; charset=utf-8"</span></span> http-equiv=<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>/&gt; &lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt;window.NREUM||(NREUM={});NREUM.info={<span class="hljs-string"><span class="hljs-string">"beacon"</span></span>:<span class="hljs-string"><span class="hljs-string">"bam.nr-data.net"</span></span>,<span class="hljs-string"><span class="hljs-string">"errorBeacon"</span></span>:<span class="hljs-string"><span class="hljs-string">"bam.nr-data.net"</span></span>,<span class="hljs-string"><span class="hljs-string">"licenseKey"</span></span>:<span class="hljs-string"><span class="hljs-string">"c1a6d52f38"</span></span>,<span class="hljs-string"><span class="hljs-string">"applicationID"</span></span>:<span class="hljs-string"><span class="hljs-string">"31165848"</span></span>,<span class="hljs-string"><span class="hljs-string">"transactionName"</span></span>:<span class="hljs-string"><span class="hljs-string">"dFdfRUpeWglTQB8GDUNKWFRLHkUNWUU="</span></span>,<span class="hljs-string"><span class="hljs-string">"queueTime"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"applicationTime"</span></span>:<span class="hljs-number"><span class="hljs-number">24</span></span>,<span class="hljs-string"><span class="hljs-string">"agent"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span>}&lt;/script&gt; &lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt;window.NREUM||(NREUM={}),__nr_require=function(e,n,t){function r(t){<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!n[t]){var o=n[t]={exports:{}};e[t][<span class="hljs-number"><span class="hljs-number">0</span></span>].call(o.exports,function(n){var o=e[t][<span class="hljs-number"><span class="hljs-number">1</span></span>][n];<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> r(o||n)},o,o.exports)}<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n[t].exports}<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-string"><span class="hljs-string">"function"</span></span>==typeof __nr_require)<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> __nr_require;<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(var o=<span class="hljs-number"><span class="hljs-number">0</span></span>;o&lt;t.length;o++)r(t[o]);<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> r}({<span class="hljs-number"><span class="hljs-number">1</span></span>:[function(e,n,t){function r(){}function o(e,n,t){<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> function(){<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i(e,[c.now()].concat(u(arguments)),n?null:this,t),n?void <span class="hljs-number"><span class="hljs-number">0</span></span>:this}}var i=e(<span class="hljs-string"><span class="hljs-string">"handle"</span></span>),a=e(<span class="hljs-number"><span class="hljs-number">2</span></span>),u=e(<span class="hljs-number"><span class="hljs-number">3</span></span>),f=e(<span class="hljs-string"><span class="hljs-string">"ee"</span></span>).get(<span class="hljs-string"><span class="hljs-string">"tracer"</span></span>),c=e(<span class="hljs-string"><span class="hljs-string">"loader"</span></span>),s=NREUM;<span class="hljs-string"><span class="hljs-string">"undefined"</span></span>==typeof window.newrelic&amp;&amp;(newrelic=s);var p=</code> </pre> <br><p>  It has become much better, is not it?  What lies in the variable <code>soup</code> ?  An inattentive user will most likely say that nothing has changed at all.  However, it is not.  Now we can freely roam the HTML tree of the page, search for children, parents and pull them out! </p><br><p>  For example, you can wander around the vertices, indicating the path of the tags. </p><br><pre> <code class="python hljs">soup.html.head.title</code> </pre> <br><pre> <code class="python hljs">Out: &lt;title&gt;All Entries | Know Your Meme&lt;/title&gt;</code> </pre> <br><p>  You can pull out from the place where we wandered, text using the <code>text</code> method. </p><br><pre> <code class="python hljs">soup.html.head.title.text</code> </pre> <br><pre> <code class="python hljs">Out: <span class="hljs-string"><span class="hljs-string">'All Entries | Know Your Meme'</span></span></code> </pre> <br><p>  Moreover, knowing the address of the item, we can immediately find it.  For example, you can do this by class.  The next command should find the element that lies inside the a tag and has the class <code>photo</code> . </p><br><pre> <code class="python hljs">obj = soup.find(<span class="hljs-string"><span class="hljs-string">'a'</span></span>, attrs = {<span class="hljs-string"><span class="hljs-string">'class'</span></span>:<span class="hljs-string"><span class="hljs-string">'photo'</span></span>}) obj</code> </pre> <br><pre> <code class="python hljs">Out: &lt;a <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">photo</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">left</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">href</span></span></span><span class="hljs-class">="/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">memes</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nu</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">male</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">smile</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_self</span></span></span><span class="hljs-class">"&gt;&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">img</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">alt</span></span></span><span class="hljs-class">='</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">The</span></span></span><span class="hljs-class"> "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Nu</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Male</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Smile</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Is</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Duck</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Face</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Men</span></span></span><span class="hljs-class">' </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">src</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">http</span></span></span><span class="hljs-class">:</span></span>//i0.kym-cdn.com/featured_items/icons/wide/<span class="hljs-number"><span class="hljs-number">000</span></span>/<span class="hljs-number"><span class="hljs-number">007</span></span>/<span class="hljs-number"><span class="hljs-number">585</span></span>/<span class="hljs-number"><span class="hljs-number">7</span></span>a2.jpg<span class="hljs-string"><span class="hljs-string">" height="</span></span><span class="hljs-number"><span class="hljs-number">112</span></span><span class="hljs-string"><span class="hljs-string">" src="</span></span>http://a.kym-cdn.com/assets/blank-b3f96f160b75b1b49b426754ba188fe8.gi<span class="hljs-string"><span class="hljs-string">f" title='The "</span></span>Nu-Male Smile<span class="hljs-string"><span class="hljs-string">" Is Duck Face for Men' width="</span></span><span class="hljs-number"><span class="hljs-number">198</span></span><span class="hljs-string"><span class="hljs-string">"/&gt; &lt;div class="</span></span>info abs<span class="hljs-string"><span class="hljs-string">"&gt; &lt;div class="</span></span>c<span class="hljs-string"><span class="hljs-string">"&gt; The "</span></span>Nu-Male Smile<span class="hljs-string"><span class="hljs-string">" Is Duck Face for Men &lt;/div&gt; &lt;/div&gt; &lt;/a&gt;</span></span></code> </pre> <br><p>  However, contrary to our expectations, the pulled out object has the class <code>"photo left"</code> .  It turns out that <code>BeautifulSoup4</code> regards the <code>class</code> attributes as a set of separate values, so <code>"photo left"</code> for the library is equivalent to <code>["photo", "left"]</code> , and the value of this class that we have specified <code>"photo"</code> is included in this list.  To avoid such an unpleasant situation and passes through unnecessary links to us, you will have to use your own function and set strict correspondence: </p><br><pre> <code class="python hljs">obj = soup.find(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> tag: tag.name == <span class="hljs-string"><span class="hljs-string">'a'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> tag.get(<span class="hljs-string"><span class="hljs-string">'class'</span></span>) == [<span class="hljs-string"><span class="hljs-string">'photo'</span></span>]) obj</code> </pre> <br><pre> <code class="python hljs">Out: &lt;a <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">photo</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">href</span></span></span><span class="hljs-class">="/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">memes</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">people</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mf</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">doom</span></span></span><span class="hljs-class">"&gt;&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">img</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">alt</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MF</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DOOM</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">src</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">http</span></span></span><span class="hljs-class">:</span></span>//i0.kym-cdn.com/entries/icons/medium/<span class="hljs-number"><span class="hljs-number">000</span></span>/<span class="hljs-number"><span class="hljs-number">025</span></span>/<span class="hljs-number"><span class="hljs-number">149</span></span>/<span class="hljs-number"><span class="hljs-number">1489698959244.j</span></span>pg<span class="hljs-string"><span class="hljs-string">" src="</span></span>http://a.kym-cdn.com/assets/blank-b3f96f160b75b1b49b426754ba188fe8.gi<span class="hljs-string"><span class="hljs-string">f" title="</span></span>MF DOOM<span class="hljs-string"><span class="hljs-string">"/&gt; &lt;div class="</span></span>entry-labels<span class="hljs-string"><span class="hljs-string">"&gt; &lt;span class="</span></span>label label-submission<span class="hljs-string"><span class="hljs-string">"&gt; Submission &lt;/span&gt; &lt;span class="</span></span>label<span class="hljs-string"><span class="hljs-string">" style="</span></span>background: <span class="hljs-comment"><span class="hljs-comment">#d32f2e; color: white;"&gt;Person&lt;/span&gt; &lt;/div&gt; &lt;/a&gt;</span></span></code> </pre> <br><p>  The object obtained after the search also has the structure bs4.  Therefore, you can continue to search for the objects we need in it already!  Get a link to this meme.  This can be done by the attribute <code>href</code> , which is our link. </p><br><pre> <code class="python hljs">obj.attrs[<span class="hljs-string"><span class="hljs-string">'href'</span></span>]</code> </pre> <br><pre> <code class="python hljs">Out: <span class="hljs-string"><span class="hljs-string">'/memes/people/mf-doom'</span></span></code> </pre> <br><p>  Notice that after all these crazy transformations, the data has changed type.  Now they are <code>str</code> .  This means that you can work with them as with text and use it to sift out unnecessary information regular expressions. </p><br><pre> <code class="python hljs">print(<span class="hljs-string"><span class="hljs-string">"    :"</span></span>, type(obj)) print(<span class="hljs-string"><span class="hljs-string">"    :"</span></span>, type(obj.attrs[<span class="hljs-string"><span class="hljs-string">'href'</span></span>]))</code> </pre> <br><pre> <code class="python hljs">Out:     : &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bs4</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">element</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tag</span></span></span><span class="hljs-class">'&gt;     :</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">str</span></span></span><span class="hljs-class">'&gt;</span></span></code> </pre> <br><p>  If several elements on the page have the specified address, then the <code>find</code> method will return only the very first one.  To find all items with such an address, you need to use the <code>findAll</code> method, and a list will be output.  Thus, we can get all objects with links to pages with memes in one search at once. </p><br><pre> <code class="python hljs">meme_links = soup.findAll(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> tag: tag.name == <span class="hljs-string"><span class="hljs-string">'a'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> tag.get(<span class="hljs-string"><span class="hljs-string">'class'</span></span>) == [<span class="hljs-string"><span class="hljs-string">'photo'</span></span>]) meme_links[:<span class="hljs-number"><span class="hljs-number">3</span></span>]</code> </pre> <br><pre> <code class="python hljs">Out: [&lt;a <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">photo</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">href</span></span></span><span class="hljs-class">="/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">memes</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">people</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mf</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">doom</span></span></span><span class="hljs-class">"&gt;&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">img</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">alt</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MF</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DOOM</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">src</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">http</span></span></span><span class="hljs-class">:</span></span>//i0.kym-cdn.com/entries/icons/medium/<span class="hljs-number"><span class="hljs-number">000</span></span>/<span class="hljs-number"><span class="hljs-number">025</span></span>/<span class="hljs-number"><span class="hljs-number">149</span></span>/<span class="hljs-number"><span class="hljs-number">1489698959244.j</span></span>pg<span class="hljs-string"><span class="hljs-string">" src="</span></span>http://a.kym-cdn.com/assets/blank-b3f96f160b75b1b49b426754ba188fe8.gi<span class="hljs-string"><span class="hljs-string">f" title="</span></span>MF DOOM<span class="hljs-string"><span class="hljs-string">"/&gt; &lt;div class="</span></span>entry-labels<span class="hljs-string"><span class="hljs-string">"&gt; &lt;span class="</span></span>label label-submission<span class="hljs-string"><span class="hljs-string">"&gt; Submission &lt;/span&gt; &lt;span class="</span></span>label<span class="hljs-string"><span class="hljs-string">" style="</span></span>background: <span class="hljs-comment"><span class="hljs-comment">#d32f2e; color: white;"&gt;Person&lt;/span&gt; &lt;/div&gt; &lt;/a&gt;, &lt;a class="photo" href="/memes/here-lies-beavis-he-never-scored"&gt;&lt;img alt="Here Lies Beavis. He Never Scored." data-src="http://i0.kym-cdn.com/entries/icons/medium/000/025/148/maxresdefault.jpg" src="http://a.kym-cdn.com/assets/blank-b3f96f160b75b1b49b426754ba188fe8.gif" title="Here Lies Beavis. He Never Scored."/&gt; &lt;div class="entry-labels"&gt; &lt;span class="label label-submission"&gt; Submission &lt;/span&gt; &lt;/div&gt; &lt;/a&gt;, &lt;a class="photo" href="/memes/people/vanossgaming"&gt;&lt;img alt="VanossGaming" data-src="http://i0.kym-cdn.com/entries/icons/medium/000/025/147/Evan-Fong-e1501621844732.jpg" src="http://a.kym-cdn.com/assets/blank-b3f96f160b75b1b49b426754ba188fe8.gif" title="VanossGaming"/&gt; &lt;div class="entry-labels"&gt; &lt;span class="label label-submission"&gt; Submission &lt;/span&gt; &lt;span class="label" style="background: #d32f2e; color: white;"&gt;Person&lt;/span&gt; &lt;/div&gt; &lt;/a&gt;]</span></span></code> </pre> <br><p>  It remains to clear the list of garbage: </p><br><pre> <code class="python hljs">meme_links = [link.attrs[<span class="hljs-string"><span class="hljs-string">'href'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> link <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> meme_links] meme_links[:<span class="hljs-number"><span class="hljs-number">10</span></span>]</code> </pre> <br><pre> <code class="python hljs">Out: [<span class="hljs-string"><span class="hljs-string">'/memes/people/mf-doom'</span></span>, <span class="hljs-string"><span class="hljs-string">'/memes/here-lies-beavis-he-never-scored'</span></span>, <span class="hljs-string"><span class="hljs-string">'/memes/people/vanossgaming'</span></span>, <span class="hljs-string"><span class="hljs-string">'/memes/stream-sniping'</span></span>, <span class="hljs-string"><span class="hljs-string">'/memes/kids-describe-god-to-an-illustrator'</span></span>, <span class="hljs-string"><span class="hljs-string">'/memes/bad-teacher'</span></span>, <span class="hljs-string"><span class="hljs-string">'/memes/people/adam-the-creator'</span></span>, <span class="hljs-string"><span class="hljs-string">'/memes/but-can-you-do-this'</span></span>, <span class="hljs-string"><span class="hljs-string">'/memes/people/ken-ashcorp'</span></span>, <span class="hljs-string"><span class="hljs-string">'/memes/heartbroken-cowboy'</span></span>]</code> </pre> <br><p>  Done, got exactly 16 links by the number of memes on one search page. </p><br><p>  Well, the fact that you can search for an element by its address is, of course, cool, but where do you get this address from?  You can install some kind of utility for your browser that allows you to pull the necessary tags from the page, for example, <a href="http://selectorgadget.com/">select orgadget.</a> </p><br><p>  However, this path is not suitable for a true samurai.  For followers of bushido, there is another way - to search for tags for each item we need manually.  To do this, you have to right-click on the browser window and poke the <strong>Inspect</strong> button.  After all these manipulations, the browser will look something like this: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xe/wt/zo/xewtzoghswrzqywjblkkpnovgb4.png" width="800"></div><br><p>  Jumped out a piece of html in which the address of the object you selected is located, you can safely copy into the code and enjoy your brutality. </p><br><p>  Stayed last moment.  When we download all the memes from the current page, we will need to somehow get to the next one.  On the website, you can do this just by scrolling down the page with memes, the javascript functions pull new memes to the current window, but now you don‚Äôt want to touch these functions. </p><br><p>  Usually, all the parameters that we set on the site to search for, are displayed on the structure of the preach.  Memes are no exception.  If we want to get the first batch of memes, we will need to contact the site by reference. </p><br><blockquote>  <a href="http://knowyourmeme.com/memes/all/page/1">http://knowyourmeme.com/memes/all/page/1</a> </blockquote><p>  If we want to get a second one with sixteen memes, we will have to modify the link a little, namely, replace the page number with 2. </p><br><blockquote>  <a href="http://knowyourmeme.com/memes/all/page/2">http://knowyourmeme.com/memes/all/page/2</a> </blockquote><p>  In this simple way, we will be able to go through all the pages and rob a memorial depository.  Finally, we wrap up in the beautiful function all the manipulations done above: </p><br><div class="spoiler">  <b class="spoiler_title">Feature to download links to memes</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPageLinks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(page_number)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""     ,     page_number: int/string     """</span></span> <span class="hljs-comment"><span class="hljs-comment">#      page_link = 'http://knowyourmeme.com/memes/all/page/{}'.format(page_number) #     response = requests.get(page_link, headers={'User-Agent': UserAgent().chrome}) if not response.ok: #    ,       return [] #        html = response.content soup = BeautifulSoup(html,'html.parser') # ,           meme_links = soup.findAll(lambda tag: tag.name == 'a' and tag.get('class') == ['photo']) meme_links = ['http://knowyourmeme.com' + link.attrs['href'] for link in meme_links] return meme_links</span></span></code> </pre> </div></div><br><p>  Test the function and make sure everything is fine. </p><br><pre> <code class="python hljs">meme_links = getPageLinks(<span class="hljs-number"><span class="hljs-number">1</span></span>) meme_links[:<span class="hljs-number"><span class="hljs-number">2</span></span>]</code> </pre> <br><pre> <code class="python hljs">Out: [<span class="hljs-string"><span class="hljs-string">'http://knowyourmeme.com/memes/people/mf-doom'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://knowyourmeme.com/memes/here-lies-beavis-he-never-scored'</span></span>]</code> </pre> <br><p>  Great, the function works and now we can theoretically get links to the whole 17171 meme, for which we will have to go through 17171/16 ~ 1074 pages.  Before frustrating the server with so many requests, let's see how to get all the necessary information about a particular meme. </p><br><h2 id="15-finalnaya-podgotovka-k-grabezhu">  1.5 Final preparation for robbery </h2><br><p>  By analogy with links, you can pull anything.  For this you need to take a few steps: </p><br><ol><li>  Open the meme page </li><li>  Find a tag in any way for the information we need. </li><li>  Shove it all into a beautiful soup </li><li>  ...... </li><li>  Profit </li></ol><br><p>  To fix the information in the head of an inquisitive reader, pull out the number of views of the meme. </p><br><p>  As an example, let's take the most popular meme on this site - Doge, which collected more than 12 million views as of January 1, 2018. </p><br><p>  The very page from which we will reach the information dear to our research heart looks as follows: </p><br><img src="https://habrastorage.org/webt/n6/zj/wp/n6zjwpi5jcem8_hia6txycdpqa0.png"><br><p>  As before, for a start we will save the link to the page into a variable and drag out the content on it. </p><br><pre> <code class="python hljs">meme_page = <span class="hljs-string"><span class="hljs-string">'http://knowyourmeme.com/memes/doge'</span></span> response = requests.get(meme_page, headers={<span class="hljs-string"><span class="hljs-string">'User-Agent'</span></span>: UserAgent().chrome}) html = response.content soup = BeautifulSoup(html,<span class="hljs-string"><span class="hljs-string">'html.parser'</span></span>)</code> </pre> <br><p>  Let's see how you can get statistics on views, comments, and the number of downloaded videos and photos associated with our memes.  All this stuff is stored in the upper right under the tags <code>"dd"</code> and with the classes <code>"views"</code> , <code>"videos"</code> , <code>"photos"</code> and <code>"comments"</code> </p><br><pre> <code class="python hljs">views = soup.find(<span class="hljs-string"><span class="hljs-string">'dd'</span></span>, attrs={<span class="hljs-string"><span class="hljs-string">'class'</span></span>:<span class="hljs-string"><span class="hljs-string">'views'</span></span>}) print(views)</code> </pre> <br><pre> <code class="python hljs">Out: &lt;dd <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">views</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">="12,318,185 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Views</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">href</span></span></span><span class="hljs-class">="/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">memes</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">doge</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rel</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nofollow</span></span></span><span class="hljs-class">"&gt;12,318,185&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dd</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre> <br><p>  Clear tags and punctuation </p><br><pre> <code class="python hljs">views = views.find(<span class="hljs-string"><span class="hljs-string">'a'</span></span>).text views = int(views.replace(<span class="hljs-string"><span class="hljs-string">','</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>)) print(views)</code> </pre> <br><pre> <code class="python hljs">Out: <span class="hljs-number"><span class="hljs-number">12318185</span></span></code> </pre> <br><p>  Putting it all into a small function again. </p><br><div class="spoiler">  <b class="spoiler_title">The function that returns statistics on the meme</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStats</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(soup, stats)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    //... soup:  bs4.BeautifulSoup    stats: string views/videos/photos/comments """</span></span> obj = soup.find(<span class="hljs-string"><span class="hljs-string">'dd'</span></span>, attrs={<span class="hljs-string"><span class="hljs-string">'class'</span></span>:stats}) obj = obj.find(<span class="hljs-string"><span class="hljs-string">'a'</span></span>).text obj = int(obj.replace(<span class="hljs-string"><span class="hljs-string">','</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj</code> </pre> </div></div><br><p>  All is ready! </p><br><pre> <code class="python hljs">views = getStats(soup, stats=<span class="hljs-string"><span class="hljs-string">'views'</span></span>) videos = getStats(soup, stats=<span class="hljs-string"><span class="hljs-string">'videos'</span></span>) photos = getStats(soup, stats=<span class="hljs-string"><span class="hljs-string">'photos'</span></span>) comments = getStats(soup, stats=<span class="hljs-string"><span class="hljs-string">'comments'</span></span>) print(<span class="hljs-string"><span class="hljs-string">": {}\n: {}\n: {}\n: {}"</span></span>.format(views, videos, photos, comments))</code> </pre> <br><pre> <code class="python hljs">Out: : <span class="hljs-number"><span class="hljs-number">12318185</span></span> : <span class="hljs-number"><span class="hljs-number">59</span></span> : <span class="hljs-number"><span class="hljs-number">1645</span></span> : <span class="hljs-number"><span class="hljs-number">918</span></span></code> </pre> <br><p>  From the interesting and research, we‚Äôll get the date and time of adding a meme.  If you look at the page in the browser, you might think that the maximum information that we can pull out is the number of years since publication - <code>Added 4 years ago by NovaXP</code> .  However, we will not give up so easily, we will climb into the intestines of html and dig out the piece responsible for this inscription: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cr/c4/il/crc4ilgqdvx2z4cfm52tlikqa-0.png" width="550"></div><br><p>  Aha  Here are the details on the date of addition, up to a minute.  Elementary </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/e4/dj/lp/e4djlpba-1rr7yo1u9yxtcbzvzo.jpeg" width="250"></div><br><pre> <code class="python hljs">date = soup.find(<span class="hljs-string"><span class="hljs-string">'abbr'</span></span>, attrs={<span class="hljs-string"><span class="hljs-string">'class'</span></span>:<span class="hljs-string"><span class="hljs-string">'timeago'</span></span>}).attrs[<span class="hljs-string"><span class="hljs-string">'title'</span></span>] date</code> </pre> <br><pre> <code class="python hljs">Out: <span class="hljs-string"><span class="hljs-string">'2017-12-31T01:59:14-05:00'</span></span></code> </pre> <br><p>  Actually, parsers are unpredictable.  Often the pages we parse have a very heterogeneous structure.  For example, if we parse memes, some of the pages may have a description, but some may not.  As soon as the code first stumbles upon the absence of a description, it gives an error and stops.  To properly collect all the data, you have to register exceptions.  It seems that the storage of memes is well equipped and there should not be any abnormal situations. <br>  However, I really do not want to wake up in the morning and see that the code made 20 iterations, ran into an error and got chopped off.  To prevent this from happening, you can, for example, use the <code>try - except</code> construction and simply handle errors that we do not like.  About exceptions can be read <a href="https://pythonworld.ru/tipy-dannyx-v-python/isklyucheniya-v-python-konstrukciya-try-except-dlya-obrabotki-isklyuchenij.html">on the Internet</a> .  In our case, it‚Äôs possible not to bring up the error, but first check whether there is a necessary element on the page or not with the help of the usual <code>if - else</code> , and after that try to parse it. </p><br><p>  For example, we want to pull out the status of a meme, for this we find the tags surrounding it: </p><br><pre> <code class="python hljs">properties = soup.find(<span class="hljs-string"><span class="hljs-string">'aside'</span></span>, attrs={<span class="hljs-string"><span class="hljs-string">'class'</span></span>:<span class="hljs-string"><span class="hljs-string">'left'</span></span>}) meme_status = properties.find(<span class="hljs-string"><span class="hljs-string">"dd"</span></span>) meme_status</code> </pre> <br><pre> <code class="python hljs">Out: &lt;dd&gt; Confirmed &lt;/dd&gt;</code> </pre> <br><p>  Next you need to pull out the text from the tags, and then cut off all the extra spaces. </p><br><pre> <code class="python hljs">meme_status.text.strip()</code> </pre> <br><pre> <code class="python hljs">Out: <span class="hljs-string"><span class="hljs-string">'Confirmed'</span></span></code> </pre> <br><p>  However, if it suddenly turns out that the meme has no status, the <code>find</code> method returns void.  The <code>text</code> method, in turn, cannot find text in tags and will generate an error.  To protect yourself from such voids, you can write an exception or <code>if - else</code> .  Since there is still a status in the current meme, we purposely set it as an empty object to check that the error is detected in both cases. </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#  !   ,     meme_status = None #  !   ... # ...   try: print(meme_status.text.strip()) #   ,   ,  . except: print("Exception") # ...      if meme_status: print(meme_status.text.strip()) else: print("Empty")</span></span></code> </pre> <br><pre> <code class="python hljs">Out: Exception Empty</code> </pre> <br><p>  This code allows you to protect yourself from errors.  In this case, we can rewrite the whole construction with <code>if - else</code> in the form of one convenient string.  This line will check if the response <code>meme_status</code> and if not, it will give out emptiness. </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     properties = soup.find('aside', attrs={'class':'left'}) meme_status = properties.find("dd") meme_status = "" if not meme_status else meme_status.text.strip() print(meme_status)</span></span></code> </pre> <br><pre> <code class="python hljs">Out: Confirmed</code> </pre> <br><p>  By analogy, you can pull out all the rest of the information from the page, for which we again write the function </p><br><div class="spoiler">  <b class="spoiler_title">Function for parsing meme properties</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getProperties</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(soup)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""   (tuple)  , , ,       soup:  bs4.BeautifulSoup    """</span></span> <span class="hljs-comment"><span class="hljs-comment">#  -      h1,   meme_name = soup.find('section', attrs={'class':'info'}).find('h1').text.strip() #       properties = soup.find('aside', attrs={'class':'left'}) #    -     meme_status = properties.find("dd") # oneliner,  try-except:     properties,   NoneType, #    text ,          meme_status = "" if not meme_status else meme_status.text.strip() #   -    meme_type = properties.find('a', attrs={'class':'entry-type-link'}) meme_type = "" if not meme_type else meme_type.text #        Year, #  ,       -   meme_origin_year = properties.find(text='\nYear\n') meme_origin_year = "" if not meme_origin_year else meme_origin_year.parent.find_next() meme_origin_year = meme_origin_year.text.strip() #   meme_origin_place = properties.find('dd', attrs={'class':'entry_origin_link'}) meme_origin_place = "" if not meme_origin_place else meme_origin_place.text.strip() # ,    meme_tags = properties.find('dl', attrs={'id':'entry_tags'}).find('dd') meme_tags = "" if not meme_tags else meme_tags.text.strip() return meme_name, meme_status, meme_type, meme_origin_year, meme_origin_place, meme_tags</span></span></code> </pre> </div></div><br><pre> <code class="python hljs">getProperties(soup)</code> </pre> <br><pre> <code class="python hljs">Out: (<span class="hljs-string"><span class="hljs-string">'Doge'</span></span>, <span class="hljs-string"><span class="hljs-string">'Confirmed'</span></span>, <span class="hljs-string"><span class="hljs-string">'Animal'</span></span>, <span class="hljs-string"><span class="hljs-string">'2013'</span></span>, <span class="hljs-string"><span class="hljs-string">'Tumblr'</span></span>, <span class="hljs-string"><span class="hljs-string">'animal, dog, shiba inu, shibe, such doge, super shibe, japanese, super, tumblr, much, very, many, comic sans, photoshop meme, such, shiba, shibe doge, doges, dogges, reddit, comic sans ms, tumblr meme, hacked, bitcoin, dogecoin, shitposting, stare, canine'</span></span>)</code> </pre> <br><p>  Meme properties collected.  Now we collect by analogy its text description. </p><br><div class="spoiler">  <b class="spoiler_title">Function for parsing textual meme description</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(soup)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""     soup:  bs4.BeautifulSoup    """</span></span> <span class="hljs-comment"><span class="hljs-comment">#      body = soup.find('section', attrs={'class':'bodycopy'}) #  about (  ),   ,      meme_about = body.find('p') meme_about = "" if not meme_about else meme_about.text #  origin     Origin  History, #  ,       -   meme_origin = body.find(text='Origin') or body.find(text='History') meme_origin = "" if not meme_origin else meme_origin.parent.find_next().text #    (  )       if body.text: other_text = body.text.strip().split('\n')[4:] other_text = " ".join(other_text).strip() else: other_text = "" return meme_about, meme_origin, other_text</span></span></code> </pre> </div></div><br><pre> <code class="python hljs">meme_about, meme_origin, other_text = getText(soup) print(<span class="hljs-string"><span class="hljs-string">"  :\n{}\n\n:\n{}\n\n :\n{}...\n"</span></span>\ .format(meme_about, meme_origin, other_text[:<span class="hljs-number"><span class="hljs-number">200</span></span>]))</code> </pre> <br><pre> <code class="python hljs">Out:   : Doge <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> a slang term <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ‚Äúdog‚Äù that <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> primarily associated <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pictures of Shiba Inus (nicknamed ‚ÄúShibe‚Äù) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> internal monologue captions on Tumblr. These photos may be photoshopped to change the dog<span class="hljs-string"><span class="hljs-string">'s face or captioned with interior monologues in Comic Sans font. : The use of the misspelled word ‚Äúdoge‚Äù to refer to a dog dates back to June 24th, 2005, when it was mentioned in an episode of Homestar Runner'</span></span>s puppet show. In the episode titled ‚ÄúBiz Cas Fri <span class="hljs-number"><span class="hljs-number">1</span></span>‚Äù[<span class="hljs-number"><span class="hljs-number">2</span></span>], Homestar calls Strong Bad his ‚Äúdoge‚Äù <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> trying to distract him <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> his work.  : Identity On February <span class="hljs-number"><span class="hljs-number">23</span></span>rd, <span class="hljs-number"><span class="hljs-number">2010</span></span>, Japanese kindergarten teacher Atsuko Sato posted several photos of her rescue-adopted Shiba Inu dog Kabosu to her personal blog.[<span class="hljs-number"><span class="hljs-number">38</span></span>] Among the photos included a peculi...</code> </pre> <br><p> ,  ,       </p><br><div class="spoiler"> <b class="spoiler_title">,     </b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMemeData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(meme_page)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    ,      meme_page: string      """</span></span> <span class="hljs-comment"><span class="hljs-comment">#     response = requests.get(meme_page, headers={'User-Agent': UserAgent().chrome}) if not response.ok: #    ,    return response.status_code #        html = response.content soup = BeautifulSoup(html,'html.parser') #       views = getStats(soup=soup, stats='views') videos = getStats(soup=soup, stats='videos') photos = getStats(soup=soup, stats='photos') comments = getStats(soup=soup, stats='comments') #  date = soup.find('abbr', attrs={'class':'timeago'}).attrs['title'] # , ,  .. meme_name, meme_status, meme_type, meme_origin_year, meme_origin_place, meme_tags =\ getProperties(soup=soup) #   meme_about, meme_origin, other_text = getText(soup=soup) #  ,          data_row = {"name":meme_name, "status":meme_status, "type":meme_type, "origin_year":meme_origin_year, "origin_place":meme_origin_place, "date_added":date, "views":views, "videos":videos, "photos":photos, "comments":comments, "tags":meme_tags, "about":meme_about, "origin":meme_origin, "other_text":other_text} return data_row</span></span></code> </pre> </div></div><br><p>    ,      <del>  </del>   ,           </p><br><pre> <code class="python hljs">final_df = pd.DataFrame(columns=[<span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'status'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span>, <span class="hljs-string"><span class="hljs-string">'origin_year'</span></span>, <span class="hljs-string"><span class="hljs-string">'origin_place'</span></span>, <span class="hljs-string"><span class="hljs-string">'date_added'</span></span>, <span class="hljs-string"><span class="hljs-string">'views'</span></span>, <span class="hljs-string"><span class="hljs-string">'videos'</span></span>, <span class="hljs-string"><span class="hljs-string">'photos'</span></span>, <span class="hljs-string"><span class="hljs-string">'comments'</span></span>, <span class="hljs-string"><span class="hljs-string">'tags'</span></span>, <span class="hljs-string"><span class="hljs-string">'about'</span></span>, <span class="hljs-string"><span class="hljs-string">'origin'</span></span>, <span class="hljs-string"><span class="hljs-string">'other_text'</span></span>]) data_row = getMemeData(<span class="hljs-string"><span class="hljs-string">'http://knowyourmeme.com/memes/doge'</span></span>) final_df = final_df.append(data_row, ignore_index=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) final_df</code> </pre> <br><pre> <code class="python hljs">Out:</code> </pre> <br><table border="1"><thead><tr><th>  name </th><th> status </th><th>  type </th><th> origin_year </th><th>  ... </th></tr></thead><tbody><tr><td> Doge </td><td> Confirmed </td><td> Animal </td><td>  2013 </td><td>  ... </td></tr></tbody></table><br><p>      .       ‚Äî       ,     <code>meme_links</code> . </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> meme_link <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> meme_links: data_row = getMemeData(meme_link) final_df = final_df.append(data_row, ignore_index=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><pre> <code class="python hljs">Out:</code> </pre> <br><table border="1"><thead><tr><th>  name </th><th> status </th><th>  type </th><th> origin_year </th><th>  ... </th></tr></thead><tbody><tr><td> Doge </td><td> Confirmed </td><td> Animal </td><td>  2013 </td><td>  ... </td></tr></tbody><tbody><tr><td> Charles C. Johnson </td><td> Submission </td><td> Activist </td><td>  2013 </td><td>  ... </td></tr></tbody><tbody><tr><td> Bat- (Prefix) </td><td> Submission </td><td> Snowclone </td><td>  2018 </td><td>  ... </td></tr></tbody><tbody><tr><td> The Eric Andre Show </td><td> Deadpool </td><td> TV Show </td><td>  2012 </td><td>  ... </td></tr></tbody><tbody><tr><td> Hopsin </td><td> Submission </td><td> Musician </td><td>  2003 </td><td>  ... </td></tr></tbody></table><br><p>  Fine!  ,  ,       ,      ‚Äî  ,    ,   . </p><br><h1 id="2--pryachemsya-ot-strazhnikov"> 2.    </h1><br><h2 id="21-kogda-rabotayuschiy-kod-bolshe-ne-rabotaet"> 2.1       </h2><br><p>  Here he is!     ,     ,  ,  ,  ‚Äî      . ,      .      <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>1075</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.65ex" height="2.057ex" viewBox="0 -780.1 2002 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/346632/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh6fTKisIWS3Rhg2dmHCsE5gSnzIQ#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/346632/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh6fTKisIWS3Rhg2dmHCsE5gSnzIQ#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/346632/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh6fTKisIWS3Rhg2dmHCsE5gSnzIQ#MJMAIN-37" x="1001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/346632/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh6fTKisIWS3Rhg2dmHCsE5gSnzIQ#MJMAIN-35" x="1501" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1075</font></font></mn></math></span></span><script type="math/tex" id="MathJax-Element-1">1075</script>   .        <code>try-except</code> .        . </p><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   .       #   tqdm_notebook    from tqdm import tqdm_notebook final_df = pd.DataFrame(columns=['name', 'status', 'type', 'origin_year', 'origin_place', 'date_added', 'views', 'videos', 'photos', 'comments', 'tags', 'about', 'origin', 'other_text']) for page_number in tqdm_notebook(range(1075), desc='Pages'): #      meme_links = getPageLinks(page_number) for meme_link in tqdm_notebook(meme_links, desc='Memes', leave=False): #        for i in range(5): try: #       data_row = getMemeData(meme_link) #      final_df = final_df.append(data_row, ignore_index=True) #    -     break except: # ,    ,     print('AHTUNG! parsing once again:', meme_link) continue</span></span></code> </pre> </div></div><br><p>   !  -  - ,         ,      . </p><br><img src="https://habrastorage.org/webt/sd/nm/fi/sdnmfigmsvb9f7lxvbezsykv5ci.jpeg"><br><p>  ,         ,     ,   .      . </p><br><img src="https://habrastorage.org/webt/mg/ce/3j/mgce3jd8xw6dmi6lt46vpbqvvxi.png"><br><h2 id="22-tor---syn-odina"> 2.2  ‚Äî   </h2><br><p>          ,       .  ,       . </p><br><p>  .       ,  ,      ,      <code>request-header</code> .    ,      IP,    ,     IP . ,       -,          IP ,      "".       :  ‚Äî  -   ,  ‚Äî            ? </p><br><p>        <a href="https://www.torproject.org/">Tor</a> .   , Tor    ,     . ,  ,   ,  ,   ,   .  ,    Tor,       ,      .        : </p><br><ul><li> <a href="https://geektimes.ru/post/277578/">  Tor</a> </li><li> <a href="https://habrahabr.ru/post/204266/">   </a> </li><li> <a href="https://habrahabr.ru/company/etagi/blog/315002/">-   Tor</a> </li></ul><br><p>      ,        ,     ,    Tor   .      ip-.    get-  ,    IP </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkIP</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ip = requests.get(<span class="hljs-string"><span class="hljs-string">'http://checkip.dyndns.org'</span></span>).content soup = BeautifulSoup(ip, <span class="hljs-string"><span class="hljs-string">'html.parser'</span></span>) print(soup.find(<span class="hljs-string"><span class="hljs-string">'body'</span></span>).text) checkIP()</code> </pre> <br><pre> <code class="python hljs">Out: Current IP Address: <span class="hljs-number"><span class="hljs-number">82.198</span></span><span class="hljs-number"><span class="hljs-number">.191</span></span><span class="hljs-number"><span class="hljs-number">.130</span></span></code> </pre> <br><p>   ip  Tor   .  ‚Äî  ,   ‚Äî     . </p><br><p>   <a href="https://www.torproject.org/download/download">tor</a> ,      .         tor  . </p><br><ul><li> Linux ‚Äî    <code>apt-get install tor</code> , </li><li> Mac ‚Äî   <a href="">  brew</a> , <code>brew install tor</code> . </li><li> Windows ‚Äî      . </li></ul><br><h2 id="23-put-pervyy"> 2.3   </h2><br><p>        .  ip    <code>PySocks</code> .  ,   ,    <code>pip3 install PySocks</code> . </p><br><p>        9150.      socks  socket      .             ,   ‚Äì    -  . </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> socks <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> socket socks.set_default_proxy(socks.SOCKS5, <span class="hljs-string"><span class="hljs-string">"localhost"</span></span>, <span class="hljs-number"><span class="hljs-number">9150</span></span>) socket.socket = socks.socksocket</code> </pre> <br><p>     ip-a. </p><br><pre> <code class="python hljs">checkIP()</code> </pre> <br><pre> <code class="python hljs">Out: Current IP Address: <span class="hljs-number"><span class="hljs-number">51.15</span></span><span class="hljs-number"><span class="hljs-number">.92</span></span><span class="hljs-number"><span class="hljs-number">.24</span></span></code> </pre> <br><p>   , <a href="http://ru.smart-ip.net/geoip"> </a>          . </p><br><p> ‚Ä¶    ! </p><br><img src="https://habrastorage.org/webt/zi/en/tt/zienttk5uytovnrxrx2bzuqfcrg.png" width="350"><br><p>       ip-. </p><br><pre> <code class="python hljs">data_row = getMemeData(<span class="hljs-string"><span class="hljs-string">'http://knowyourmeme.com/memes/doge'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> key, value <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data_row.items(): print(key.capitalize()+<span class="hljs-string"><span class="hljs-string">":"</span></span>, str(value)[:<span class="hljs-number"><span class="hljs-number">200</span></span>], end=<span class="hljs-string"><span class="hljs-string">'\n\n'</span></span>)</code> </pre> <br><pre> <code class="python hljs">Out: Name: Doge Status: Confirmed Type: Animal Origin_year: <span class="hljs-number"><span class="hljs-number">2013</span></span> Origin_place: Tumblr Date_added: <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-31</span></span>T01:<span class="hljs-number"><span class="hljs-number">59</span></span>:<span class="hljs-number"><span class="hljs-number">14</span></span><span class="hljs-number"><span class="hljs-number">-05</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> Views: <span class="hljs-number"><span class="hljs-number">12318185</span></span> Videos: <span class="hljs-number"><span class="hljs-number">59</span></span> Photos: <span class="hljs-number"><span class="hljs-number">1645</span></span> Comments: <span class="hljs-number"><span class="hljs-number">918</span></span> Tags: animal, dog, shiba inu, shibe, such doge, super shibe, japanese, super, tumblr, much, very, many, comic sans, photoshop meme, such, shiba, shibe doge, doges, dogges, reddit, comic sans ms, tumblr meme About: Doge <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> a slang term <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ‚Äúdog‚Äù that <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> primarily associated <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pictures of Shiba Inus (nicknamed ‚ÄúShibe‚Äù) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> internal monologue captions on Tumblr...</code> </pre> <br><p>  .          .      .     . </p><br><p>  ,     :   , -  ip  10 .   ,     ?  ,  ,    Tor       torrc (      <code>~/Library/Application Support/TorBrowser-Data/torrc</code> ,     ‚Äî   <a href="https://tor.stackexchange.com/questions/11866/cant-find-torrc-file-on-mac"></a> )   .  : </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">CircuitBuildTimeout</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> LearnCircuitBuildTimeout <span class="hljs-number"><span class="hljs-number">0</span></span> MaxCircuitDirtiness <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br><p>      ip  10 .       . </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">10</span></span>): checkIP() time.sleep(<span class="hljs-number"><span class="hljs-number">5</span></span>)</code> </pre> <br><pre> <code class="python hljs">Out: Current IP Address: <span class="hljs-number"><span class="hljs-number">89.31</span></span><span class="hljs-number"><span class="hljs-number">.57</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span> Current IP Address: <span class="hljs-number"><span class="hljs-number">93.174</span></span><span class="hljs-number"><span class="hljs-number">.93</span></span><span class="hljs-number"><span class="hljs-number">.71</span></span> Current IP Address: <span class="hljs-number"><span class="hljs-number">62.210</span></span><span class="hljs-number"><span class="hljs-number">.207</span></span><span class="hljs-number"><span class="hljs-number">.52</span></span> Current IP Address: <span class="hljs-number"><span class="hljs-number">209.141</span></span><span class="hljs-number"><span class="hljs-number">.43</span></span><span class="hljs-number"><span class="hljs-number">.42</span></span> Current IP Address: <span class="hljs-number"><span class="hljs-number">209.141</span></span><span class="hljs-number"><span class="hljs-number">.43</span></span><span class="hljs-number"><span class="hljs-number">.42</span></span> Current IP Address: <span class="hljs-number"><span class="hljs-number">162.247</span></span><span class="hljs-number"><span class="hljs-number">.72</span></span><span class="hljs-number"><span class="hljs-number">.216</span></span> Current IP Address: <span class="hljs-number"><span class="hljs-number">185.220</span></span><span class="hljs-number"><span class="hljs-number">.101</span></span><span class="hljs-number"><span class="hljs-number">.17</span></span> Current IP Address: <span class="hljs-number"><span class="hljs-number">193.171</span></span><span class="hljs-number"><span class="hljs-number">.202</span></span><span class="hljs-number"><span class="hljs-number">.150</span></span> Current IP Address: <span class="hljs-number"><span class="hljs-number">128.31</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.13</span></span> Current IP Address: <span class="hljs-number"><span class="hljs-number">185.163</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.11</span></span></code> </pre> <br><p> ,  ip     10 .           .     20     . </p><br><ol><li>  ; </li><li>      ; </li><li>     </li><li> ..... </li><li> Profit </li></ol><br><div class="spoiler"> <b class="spoiler_title">    </b> <div class="spoiler_text"><pre> <code class="python hljs">final_df = pd.DataFrame(columns=[<span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'status'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span>, <span class="hljs-string"><span class="hljs-string">'origin_year'</span></span>, <span class="hljs-string"><span class="hljs-string">'origin_place'</span></span>, <span class="hljs-string"><span class="hljs-string">'date_added'</span></span>, <span class="hljs-string"><span class="hljs-string">'views'</span></span>, <span class="hljs-string"><span class="hljs-string">'videos'</span></span>, <span class="hljs-string"><span class="hljs-string">'photos'</span></span>, <span class="hljs-string"><span class="hljs-string">'comments'</span></span>, <span class="hljs-string"><span class="hljs-string">'tags'</span></span>, <span class="hljs-string"><span class="hljs-string">'about'</span></span>, <span class="hljs-string"><span class="hljs-string">'origin'</span></span>, <span class="hljs-string"><span class="hljs-string">'other_text'</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> page_number <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tqdm_notebook(range(<span class="hljs-number"><span class="hljs-number">1075</span></span>), desc=<span class="hljs-string"><span class="hljs-string">'Pages'</span></span>): <span class="hljs-comment"><span class="hljs-comment">#      meme_links = getPageLinks(page_number) for meme_link in tqdm_notebook(meme_links, desc='Memes', leave=False): #        for i in range(5): try: #       data_row = getMemeData(meme_link) #      final_df = final_df.append(data_row, ignore_index=True) #    -     break except: # ,    ,     continue final_df.to_csv('MEMES.csv')</span></span></code> </pre> </div></div><br><p>     .       .     .    : <strong>,     ip  ?</strong> </p><br><h2 id="24-put-vtoroy"> 2.4   </h2><br><p>       ip  .   <a href="https://github.com/alex-miller-0/Tor_Crawler">Github - </a>        <code>TorCrawler.py</code> .   ,    ,  .        .               .  ,       . </p><br><p>   ,     torrc .        <code>/usr/local/etc/tor/</code> ,     <code>/etc/tor/</code> .     . </p><br><ol><li>     <code>tor --hash-password mypassword</code> </li><li>  torrc     <a href="https://stackoverflow.com/questions/11828270/how-to-exit-the-vim-editor">vim</a> , <a href="">nano</a>  <a href="https://atom.io/">atom</a> </li><li>     torrc-  ,    HashedControlPassword </li><li>  ,   HashedControlPassword </li><li>  (  )  ControlPort 9051 </li><li>  . </li></ol><br><p>  tor  . : <code>service tor start</code> , : <code>tor</code> . </p><br><p>    . </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> TorCrawler <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TorCrawler <span class="hljs-comment"><span class="hljs-comment">#   ,     crawler = TorCrawler(ctrl_pass='mypassword')</span></span></code> </pre> <br><p>    get-       ,       bs4. </p><br><pre> <code class="python hljs">meme_page = <span class="hljs-string"><span class="hljs-string">'http://knowyourmeme.com/memes/doge'</span></span> response = crawler.get(meme_page, headers={<span class="hljs-string"><span class="hljs-string">'User-Agent'</span></span>: UserAgent().chrome}) type(response)</code> </pre> <br><pre> <code class="python hljs">Out: bs4.BeautifulSoup</code> </pre> <br><p>   - . </p><br><pre> <code class="python hljs">views = response.find(<span class="hljs-string"><span class="hljs-string">'dd'</span></span>, attrs={<span class="hljs-string"><span class="hljs-string">'class'</span></span>:<span class="hljs-string"><span class="hljs-string">'views'</span></span>}) views</code> </pre> <br><pre> <code class="python hljs">Out: &lt;dd <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">views</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">="12,318,185 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Views</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">href</span></span></span><span class="hljs-class">="/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">memes</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">doge</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rel</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nofollow</span></span></span><span class="hljs-class">"&gt;12,318,185&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dd</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre> <br><p>  IP   </p><br><pre> <code class="python hljs">crawler.ip</code> </pre> <br><pre> <code class="python hljs">Out: <span class="hljs-string"><span class="hljs-string">'51.15.40.23'</span></span></code> </pre> <br><p>     ip  25 .     <code>n_requests</code> .    ,      . </p><br><pre> <code class="python hljs">crawler.n_requests</code> </pre> <br><pre> <code class="python hljs">Out: <span class="hljs-number"><span class="hljs-number">25</span></span></code> </pre> <br><p>  , ip     . </p><br><pre> <code class="python hljs">crawler.rotate()</code> </pre> <br><pre> <code class="python hljs">IP successfully rotated. New IP: <span class="hljs-number"><span class="hljs-number">62.176</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span></code> </pre> <br><p>            ,     ,   IP     .            . </p><br><p>    .    . </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p> ,              .    ‚Äî  ,     ,   ,      ,  - , , ,     .    ,  ,  ,    ,    ,            DDoS-.       ,        , ‚Äî        ,         ‚Äî <a href="http://sd-company.su/article/security/ddosataka-ugolovnaya-otvetstvennost"> </a>   . </p><br><p>     ‚Äî  -   ,         .         <code>time.sleep()</code>   <code>request-header</code>     ‚Äî             . </p><br><p>           ! </p><br><p> :   <a href="https://habrahabr.ru/users/filfonul/" class="user_link">filfonul</a> ,   <a href="https://habrahabr.ru/users/skolopendriy/" class="user_link">Skolopendriy</a> </p><br><h2 id="pochitashki">  </h2><br><ul><li> <a href="https://github.com/FUlyankin/Parsers/blob/master/Ryan_Mitchell_Web_Scraping_with_Python-_Collecting_Data_from_the_Modern_Web_2015.pdf"> </a>     . </li><li> <a href="https://jarroba.com/anonymous-scraping-by-tor-network/"> </a>     Tor     . </li><li> <a href="https://github.com/DmitrySerg/memology"> </a>       16k ,       <a href="https://github.com/DmitrySerg/memology/blob/master/KnowYourMemesParser.ipynb"></a>  . </li><li> <a href="https://fulyankin.github.io/Parsers/"> </a>        .        . </li><li> <a href="http://starwars.wikia.com/wiki/Code_of_the_Sith"> </a>    . </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/346632/">https://habr.com/ru/post/346632/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346610/index.html">Reasoning around systems engineering and comments on "Richard Hamming: Chapter 28. Systems Engineering"</a></li>
<li><a href="../346618/index.html">Correcting typos with context</a></li>
<li><a href="../346622/index.html">Examination of internal FPGA defects: we are looking for a black cat in a dark room</a></li>
<li><a href="../346628/index.html">Spring Security interrogation query path</a></li>
<li><a href="../346630/index.html">Events, processes and services: a modern approach to automating business processes</a></li>
<li><a href="../346634/index.html">Lab: Introduction to Docker from scratch. Your first microservice</a></li>
<li><a href="../346636/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ297 (January 8 - 14, 2018)</a></li>
<li><a href="../346640/index.html">Studying the wget command with 12 examples</a></li>
<li><a href="../346642/index.html">PHP Digest 123 (January 1 - 14, 2018)</a></li>
<li><a href="../346644/index.html">Rust: "Back to the roots"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>