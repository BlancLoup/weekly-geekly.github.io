<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ratio of real temperature and forecast Yandex. Weather</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the morning, when I have breakfast, I look at Yandex.Pogoda almost every day, and I periodically have a feeling of deja vu, but only vice versa. Yo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ratio of real temperature and forecast Yandex. Weather</h1><div class="post__text post__text-html js-mediator-article"><p>  In the morning, when I have breakfast, I look at <a href="https://yandex.ru/pogoda/novosibirsk">Yandex.Pogoda</a> almost every day, and I periodically have a feeling of deja vu, but only vice versa.  You look - one temperature for the weekend is indicated, and the next day you look - already our other temperature indicators are promised.  Slowly you begin to doubt your memory (30 years old - this is already the fourth decade started).  But in order not to be completely discouraged - I decided to check how the forecast correlates with the actual temperature. </p><br><p>  The blue line is the real temperature.  The orange area is a range of predictions. </p><br><p><img src="https://habrastorage.org/files/4eb/bae/890/4ebbae890c624f89ae18ce1dcba91db3.png" alt="image"><br>  <a href="https://gurov.github.io/pogoda_yandex/">Source of the picture</a> . </p><a name="habracut"></a><br><h1 id="nemnogo-tehnicheskih-detaley">  Some technical details </h1><br><p>  First of all, I put a script in cron, which every hour saves the Yandex.Pogoda page as an html file and left it to work for a while. </p><br><pre><code class="bash hljs">curl https://yandex.ru/pogoda/novosibirsk &gt; <span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/`date +%Y-%m-%d-%H-%M`</code> </pre> <br><p>  The next step was to write a small <a href="https://github.com/gurov/pogoda_yandex/blob/master/go.php">php script</a> , striking in its simplicity and conciseness, for parsing the saved files and generating json files, which, in turn, are used to display graphs.  An example of processing a saved day: </p><br><pre> <code class="hljs php"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($day)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $mega, $csv, $realT; $predicts = []; $html = file_get_html(<span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/test/'</span></span> . $day); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($html-&gt;find(<span class="hljs-string"><span class="hljs-string">'.forecast-brief_cols_10'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $element) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($element-&gt;find(<span class="hljs-string"><span class="hljs-string">'.forecast-brief__item-temp-day'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $s) { $predicts[] = str_replace(<span class="hljs-string"><span class="hljs-string">'‚àí'</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>, $s-&gt;plaintext); } } $dayDate = date_create_from_format(<span class="hljs-string"><span class="hljs-string">"YmdHi"</span></span>, $day); $dayDateString = date_format($dayDate, <span class="hljs-string"><span class="hljs-string">'Ymd H:i:s'</span></span>); $dayArr = explode(<span class="hljs-string"><span class="hljs-string">'-'</span></span>, $day); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($dayArr[<span class="hljs-number"><span class="hljs-number">3</span></span>] == <span class="hljs-number"><span class="hljs-number">14</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($html-&gt;find(<span class="hljs-string"><span class="hljs-string">'.current-weather__thermometer_type_now'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $s) { $realT[] = [ intval(date_format($dayDate, <span class="hljs-string"><span class="hljs-string">'U'</span></span>) . <span class="hljs-string"><span class="hljs-string">'000'</span></span>), intval(str_replace(<span class="hljs-string"><span class="hljs-string">'‚àí'</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>, $s-&gt;plaintext)) ]; } } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">1</span></span>; $i &lt; count($predicts); $i++) { $nextDay = date(<span class="hljs-string"><span class="hljs-string">'Ym-d'</span></span>, strtotime(<span class="hljs-string"><span class="hljs-string">'+'</span></span> . $i . <span class="hljs-string"><span class="hljs-string">' day'</span></span>, strtotime($dayDateString))); $nextDayArr = explode(<span class="hljs-string"><span class="hljs-string">'-'</span></span>, $nextDay); $line = [ <span class="hljs-string"><span class="hljs-string">'Y'</span></span> =&gt; $dayArr[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">'m'</span></span> =&gt; $dayArr[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-string"><span class="hljs-string">'d'</span></span> =&gt; $dayArr[<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-string"><span class="hljs-string">'H'</span></span> =&gt; $dayArr[<span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-string"><span class="hljs-string">'i'</span></span> =&gt; $dayArr[<span class="hljs-number"><span class="hljs-number">4</span></span>], <span class="hljs-string"><span class="hljs-string">'_m'</span></span> =&gt; $nextDayArr[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-string"><span class="hljs-string">'_d'</span></span> =&gt; $nextDayArr[<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-string"><span class="hljs-string">'_C'</span></span> =&gt; $predicts[$i] ]; $mega[] = $line; $csv .= join(<span class="hljs-string"><span class="hljs-string">';'</span></span>, array_values($line)) . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; } }</code> </pre> <br><h1 id="dlya-vneseniya-yasnosti">  For clarity </h1><br><ul><li>  I considered the forecast to be daytime temperatures of the day, not shown for the current day (in the picture below, a long, highlighted rectangle); </li><li>  I took the real temperature from the upper selected rectangle at 14:25 </li></ul><br><p><img src="https://habrastorage.org/files/8a4/b7e/ab9/8a4b7eab97bc437b83887075172ed0b3.png" alt="image"></p><br><p>  You could see the result at the beginning of the article, where the real temperature tries to creep through the range of predictions, but that it does not always succeed.  See more and poke on different dates <a href="https://gurov.github.io/pogoda_yandex/">here</a> . </p><br><p>  Examples of temperature prediction graphs for a particular day: </p><br><p><img src="https://habrastorage.org/files/3d5/6e3/6df/3d56e36df14a40c0826cfef6c1e50183.png" alt="image"><br><img src="https://habrastorage.org/files/ad5/6e1/a0c/ad56e1a0c83e48a3a886856dab1fdd8d.png" alt="image"></p><br><h1 id="vyvod">  Conclusion </h1><br><p>  My memory is fine, you can not worry. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/400245/">https://habr.com/ru/post/400245/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../400235/index.html">Announcement of the Picaso Designer X PRO 3D printer</a></li>
<li><a href="../400237/index.html">Changing the diet of ancient people - one of the reasons for the development of civilization</a></li>
<li><a href="../400239/index.html">Apple has published the first work on AI</a></li>
<li><a href="../400241/index.html">QardioBase smart scales: not only weight matters</a></li>
<li><a href="../400243/index.html">FAQ about laser correction ReLEx SMILE: yes, in Russia there is, but no, in Russia there isn‚Äôt</a></li>
<li><a href="../400249/index.html">Do you need social networks?</a></li>
<li><a href="../400251/index.html">Released free video transceiver HandBrake 1.0.0</a></li>
<li><a href="../400253/index.html">Do-it-yourself snowflakes in StarWars style (upd. 2016)</a></li>
<li><a href="../400255/index.html">The cycle of sound in nature</a></li>
<li><a href="../400257/index.html">"Reading for the weekend": 30 materials about the amazing properties of sound and audio technology</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>