<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Reversi on TCL in 64 lines</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On Habr√© already have topics about writing the game Reversi (Othello) in Python , Silverlight . 
 Let's invent a bike on Tcl / Tk. Cross platform (wor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Reversi on TCL in 64 lines</h1><div class="post__text post__text-html js-mediator-article">  On Habr√© already have topics about writing the game Reversi (Othello) in <a href="http://habrahabr.ru/blogs/python/87009/">Python</a> , <a href="http://habrahabr.ru/blogs/silverlight/87426/">Silverlight</a> . <br>  Let's invent a bike on Tcl / Tk.  Cross platform (works even on Windows Mobile with a small modification), just 64 lines. <br><br><img src="http://img408.imageshack.us/img408/4840/reversi.png" alt="image"><br><br>  The code, a small description and screen with WinMobile under habrakatom. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Source (reversi.tcl): <br><pre> package require Tk 8.5
 for {set i 0} {$ i &lt;64} {incr i} {lappend icells [expr {$ i / 8}] [expr {$ i% 8}]}
 array set vs [list 1 2 2 1 cl, 1 black cl, 2 white pn, 1 black pn, 2 white]
 ttk :: button .b1 -text "New game" -command {newgame 1 2}
 ttk :: button .b2 -text "Exit" -command {exit}
 ttk :: label .l1 -text "Welcome to Reversi game"
 canvas .cv -width 479 -height 479
 grid rowconfigure.  1-weight 1
 grid columnconfigure.  2-weight 1
 grid .b1 .b2 .l1 -padx 4 -pady 4 -sticky e
 grid .cv -padx 4 -pady 4 -columnspan 3
 foreach {xy} $ icells {
   set cr1 [list [expr {$ x * 60 + 2}] [expr {$ y * 60 + 2}] [expr {$ x * 60 + 60}] [expr {$ y * 60 + 60}]]
   set cr2 [list [expr {$ x * 60 + 4}] [expr {$ y * 60 + 4}] [expr {$ x * 60 + 58}] [expr {$ y * 60 + 58}]]
   .cv create rectangle $ cr1 -fill gray -tag "cell, $ x, $ y"
   .cv create oval $ cr2 -state hidden -tag "piece $ x, $ y"
   .cv bind cell, $ x, $ y &lt;1&gt; [list evuser $ x $ y]}
 proc pieceset {xyp} {
   .cv itemconfigure $ x, $ y -state normal -fill $ :: vs (cl, $ p)
   incr :: score ($ p) [expr {+ ($ :: board ($ x, $ y)! = $ p)}]]
   incr :: score ($ :: vs (p)) [expr {- ($ :: board ($ x, $ y) == $ $ vs ($ p))}]
   set :: board ($ x, $ y) [list $ p]}
 proc newgame {p1 p2} {
   .cv itemconfigure piece -state hidden
   array set :: score [list 0 0 1 0 2 0]
   array set :: player [list 1 $ p1 2 $ p2]
   foreach {xy} $ :: icells {set :: board ($ x, $ y) 0}
   foreach {xys} {3 3 2 4 4 2 3 4 1 4 3 1} {pieceset $ x $ y $ s}
   set :: cur 1;  waitturn}
 proc getflips {xyp} {
   if {$ :: board ($ x, $ y)! = 0} return;
   set result {}
   foreach {ix iy} {0 -1 0 1 -1 0 1 0 -1 -1 1 1 1 1 -1 -1 1} {
     set temp {}
     for {set i [expr {$ x + $ ix}];  set j [expr {$ y + $ iy}]} \
         {[info exists :: board ($ i, $ j)]} {incr i $ ix;  incr j $ iy} {
         switch - $ :: board ($ i, $ j) \
           $ :: vs ($ p) {lappend temp $ i $ j} \
           $ p {foreach {mn} $ temp {lappend result $ m $ n};  break} \
           0 {break}
   }}
   return $ result}
 proc waitturn {} {
   .l1 configure -text "Go $ :: vs (pn, $ :: cur) ($ :: score (1): $ :: score (2))"
   array set v [list $ :: cur {} $ :: vs ($ :: cur) {}]  
   foreach {xy} $ :: icells {
     set l [getflips $ x $ y $ :: cur];  if {[llength $ l]} {lappend v ($ :: cur) [list $ x $ y]}
     set l [getflips $ x $ y $ :: vs ($ :: cur)];  if {[llength $ l]} {lappend v ($ :: vs ($ :: cur)) [list $ x $ y]}}
   if {[llength $ v ($ :: cur)] == 0 &amp;&amp; [llength $ v ($ :: vs ($ :: cur))] == 0} {
     tk_messageBox -title "Reversi" -message "Game over";  return}
   if {$ :: player ($ :: cur) == 1 &amp;&amp; [llength $ v ($ :: cur)]} {
     set :: waituser 1;  return}
   if {$ :: player ($ :: cur) == 2 &amp;&amp; [llength $ v ($ :: cur)]} {
     set :: waituser 0
     set :: flip [lindex $ v ($ :: cur) [expr {int ([llength $ v ($ :: cur)] * rand ())}]]]
     turn [lindex $ :: flip 0] [lindex $ :: flip 1] $ :: cur}
   set :: cur $ :: vs ($ :: cur);  after idle waitturn}
 proc evuser {xy} {
   if {[info exists :: waituser] &amp;&amp; $ :: waituser &amp;&amp; [turn $ x $ y $ :: cur]} {
     set :: cur $ :: vs ($ :: cur);  after idle waitturn}}
 proc turn {xyp} {
   set flips [getflips $ x $ y $ p]
   foreach {ij} $ flips {pieceset $ i $ j $ p}
   if {[llength $ flips]} {pieceset $ x $ y $ p;  return 1} else {return 0}}
</pre><br><br>  To make it easier to work with coordinates, create a list of icells (0 0 0 1 ... 1 1 1 2 ..). <br>  In the future, instead of a nested loop, we can use <i>foreach {xy} $ icells</i> . <br><br>  Next is the creation of the interface, work with the canvas and event binding (evuser) when you click on the cell. <br><br>  Global Variables: <br>  vs - hash array, identifies opponents ID, color of chips.  <i>vs (1) = 2;</i>  <i>vs (2) = 1</i> . <br>  score - score (number of black and white chips) <br>  player - player configuration (1 - person, 2 - computer) <br>  board - playing field <br>  cur - current player id <br>  waituser - flag waiting user progress <br><br>  Consider the declared functions. <br>  <i>newgame {p1 p2}</i> <br>  Start a new game.  Arguments determine the type of player: <br>  1 person <br>  2 - Computer <br><br>  In other matters, AI is absolutely not here, but you can see how they will play <i>Random vs Random by</i> passing {2 2} <br><br>  <i>pieceset {xyp}</i> <br>  Sets the player's chip p, in the cell x, y <br>  Recalculates current account.  Here is a little magic <br><pre> incr :: score ($ p) [expr {+ ($ :: board ($ x, $ y)! = $ p)}]]
 incr :: score ($ :: vs (p)) [expr {- ($ :: board ($ x, $ y) == $ :: vs ($ p))}].
</pre><br><br>  We are increasing the current player's account p, and his opponent $ vs ($ p) <br>  For the current player, if his chip is not yet in the cell, then +1 otherwise +0 <br>  If the opponent's chip cost, then we reduce the score to -1. <br><br>  <i>getflips {xyp}</i> <br>  Returns a list of all possible chips that a player ( <i>p</i> ) can capture by going to <i>xy</i> <br><br>  <i>waitturn {}</i> <br>  Waiting for a move. <br>  Determines the number of all possible moves for each player.  Decides when the game is over and who should make the move now. <br><br>  <i>evuser {xy}</i> <br>  The procedure is called every time a person clicks on one of the cells. <br>  If the global variable :: waituser is set and there is an opportunity to go to the current user, then we transfer control to the opponent: <br>  <i>set :: cur $ :: vs ($ :: cur);</i>  <i>after idle waitturn}}</i> <br><br>  <i>turn {xyp}</i> <br>  Make a move in x y.  Turn over the captured opponent's chips, if it works, returns 1, otherwise 0. <br><br>  References: <br>  <a href="http://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B5%25D0%25B2%25D0%25B5%25D1%2580%25D1%2581%25D0%25B8">Reversi on Wikipedia</a> <br>  <a href="http://www.activestate.com/activetcl/">ActiveTcl (Tcl distribution for Windows / OSX / Linux)</a> <br>  <a href="http://www.evolane.com/software/etcl/index.html">eTcl (Windows Mobile)</a> <a href="http://www.evolane.com/software/etcl/index.html"><br></a> <br><br>  And finally, the screen with Windows Mobile <br><img src="http://img340.imageshack.us/img340/9220/revwm.png" alt="image"><br><br>  <b>UPD:</b> <br>  <a href="">Screenshot from Ubuntu</a> .  True, to bring to normal appearance, I connected the <a href="http://www.ellogon.org/petasis/tcltk-projects-mainmenu-38/tilegtk-mainmenu-45">tile-gtk</a> module. <br><br>  <a href="http://code.google.com/p/ureversi/">Google code</a> <br>  <a href="http://code.google.com/p/ureversi/downloads/list">Starkit and build under windows (1.2 mb)</a> <br></div><p>Source: <a href="https://habr.com/ru/post/89822/">https://habr.com/ru/post/89822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../89817/index.html">How many are heeding Microsoft in Russia?</a></li>
<li><a href="../89818/index.html">New version of Rediska 0.4.0 - PHP client for Redis</a></li>
<li><a href="../89819/index.html">Bank of scripts for the Festival</a></li>
<li><a href="../89820/index.html">Ukrainian Forum of Internet Actors, Gross Report</a></li>
<li><a href="../89821/index.html">Accordion for iPad</a></li>
<li><a href="../89823/index.html">The best-selling programs for the iPad are known in advance.</a></li>
<li><a href="../89824/index.html">Android 2.1 and i5700 Spica - failed experiment</a></li>
<li><a href="../89826/index.html">How I bought the server in ServerLoft</a></li>
<li><a href="../89827/index.html">ABOUT! New Intel Xeon!</a></li>
<li><a href="../89828/index.html">Google street view now in stereo view</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>