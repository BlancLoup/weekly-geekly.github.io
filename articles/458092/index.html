<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Towards the core of Python</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! I present to your attention the translation of the article Toward a ‚ÄúKernel Python‚Äù by Glyph Lefkowitz (creator of the Twisted framework). 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Towards the core of Python</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  I present to your attention the translation of the article <a href="https://glyph.twistedmatrix.com/2019/06/kernel-python.html">Toward a ‚ÄúKernel Python‚Äù</a> by Glyph Lefkowitz (creator of the Twisted framework). <br><br>  Read more - under the cut. <br><a name="habracut"></a><br><h2>  The magic of minimizing the standard library </h2><br>  Influenced by <a href="https://pyfound.blogspot.com/2019/05/amber-brown-batteries-included-but.html">Amber Brown</a> ‚Äôs <a href="https://pyfound.blogspot.com/2019/05/amber-brown-batteries-included-but.html">speech</a> last month at the Python Language Summit (referring to her May report ‚ÄúBatteries included, but they flow‚Äù - note of the translator) Christian Himes continued <a href="https://lwn.net/Articles/755229/">his work</a> on reducing the standard Python library and created the <a href="https://www.python.org/dev/peps/pep-0594/">PEP 594</a> proposal to remove obsolete and unsupported fragments of it. <br><br>  The emergence of PEP 594 (‚ÄúRemoving dead batteries from the standard library‚Äù) is great news for Pythonists, especially for those who support the standard library and will now have a smaller front line.  A brief tour of the PEP gallery of obsolete or requiring removal modules speaks for itself (the sunau, xdrlib, and chunk modules are my personal favorites).  The standard Python library contains many useful modules, however, it also includes a real necropolis of code, a towering monument of obsolete fragments that threaten to bury their developers at any time. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      However, I believe that an erroneous approach can be implemented in this PEP proposal.  Currently, the standard library is maintained in tandem with the developers of CPython.  Her large pieces are left in the vague hope that someday it will benefit someone.  In the aforementioned PEP, this principle can be observed while protecting the colorsys module.  Why not remove it?  Answer: ‚ÄúThis module is needed to convert CSS colors between coordinate systems (RGB, YIQ, HSL and HSV).  [He] does not impose additional costs on the main development. " <br><br>  There were times when Internet access was limited, and perhaps it was a good idea to preload Python with a whole bunch of stuff, but nowadays the modules needed to convert colors between different coordinate systems are in one step from the pip install command. <br><br><h2>  Why didn't you consider my pool request? </h2><br>  So let's consider this statement: do tiny modules like colorsys impose "additional costs on basic development"? <br><br>  The main developers need only the fact that they are trying to maintain the huge and ancient code base in C, which is CPython itself.  As Marietta Vijia said in <a href="https://pyvideo.org/north-bay-python-2018/what-is-a-python-core-developer.html">her speech</a> at North Bay Python, the most common question asked by kernel developers is: ‚ÄúWhy haven't you looked at my pull request yet?‚Äù And what is the answer?  <i>It's easier to ignore these pull requests.</i>  That's what it means to be a kernel developer! <br><br>  One might ask if Twisted has the same problem?  Twisted is also a large collection of loosely coupled modules;  a kind of standard library for networking.  Are all of these clients and servers for SSH, IMAP, HTTP, TLS, etc.?  etc.  an attempt to squeeze everything into one package? <br><br>  Forced to answer: <i>yes</i> .  Twisted is monolithic because it comes from the same historical period as CPython, when the installation of components was really difficult.  Therefore, I sympathize with the position of CPython. <br><br>  Ideally, at some point, each Twisted subproject should become a separate project with its own repository, continuous integration (CI), a website and, of course, with its own more focused developers.  We are slowly but surely sharing projects where you can draw a natural border.  Some points that began in Twisted as constantly and incremental are separated, deferred and filepath are in the process of separation.  Other projects, such as klein and treq, continue to live separately.  We will do more when we figure out how to reduce the costs of setting up and supporting continuous integration and how to release the infrastructure for each of them. <br><br>  But is the monolithic nature of Twisted the most pressing or even serious problem for the project?  Let's rate it. <br><br>  At the time of this writing, Twisted had 5 outstanding outstanding pending requests in the queue.  The average time spent on reviewing the ticket is, roughly speaking, four and a half days.  The oldest ticket in the queue is dated April 22, which means less than 2 months have passed since the oldest unreviewed pull request was sent. <br><br>  It is always difficult to find a sufficient number of developers and time to respond to pool requests.  Sometimes it seems that we still get too often the question "Why do not you consider my pool-request?".  We do not always do it perfectly, but we generally cope;  the queue ranges between 0 and 25 or so in the most unfortunate month. <br><br>  And what about the CPython core, compared to these figures? <br><br>  Going to the <a href="https://github.com/python/cpython/pulls%3Fq%3Dis%253Apr%2Bis%253Aopen%2Blabel%253A%2522awaiting%2Breview%2522%2Bsort%253Aupdated-asc">githab</a> , you can see that at the moment 429 tickets are waiting for consideration.  The oldest of them is expected from February 2, 2018, that is, almost 500 days. <br><br>  How many problems with the interpreter and how many problems with the stdlib library?  Obviously, the delay in reviewing is a problem, but will removing stdlib help? <br><br>  For a quick and unscientific evaluation, I looked at the first (oldest) pull-requests page.  According to my subjective assessment, out of 25 pull requests, 14 were associated with the standard library, 10 with the core language or interpreter code, and one was associated with a minor issue with documentation.  I would venture to assume, on the basis of this proportion, that somewhere around half of the unexamined pull requests are associated with a standard library code. <br><br>  So, the first reason why the main team of CPython needs to stop supporting the standard library is that they <i>literally do not have the physical ability to</i> support the standard library.  Or, in other words, they <i>do not support</i> it, and it remains only to recognize this and begin to share the work. <br><br>  The fact that none of CPython's open pull requests is associated with the colorsys module.  Indeed, it does not impose the costs of kernel development.  <i>Kernel development itself imposes these costs.</i>  If I wanted to update the colorsys module to keep up with the times (it is possible to have a Color object, perhaps to support integer color models), most likely I would have to wait 500 days or more. <br><br>  As a result of all this, it is more difficult to change the code in the standard library, which leads to less user interest in making its own contribution.  The infrequent releases of CPython also slow down library development and reduce the benefit of user feedback.  It is no coincidence that almost all modules of the standard library have actively supported third-party alternatives, and this is not the fault of the stdlib developers.  The whole process is sharpened by the stagnation of all but the most frequently used stdlib modules. <br><br><h2>  New environments, new requirements </h2><br>  Perhaps even more important is that binding CPython to the standard library puts CPython itself in a privileged position compared to other implementations of the language. <br><br>  <a href="https://www.pythonpodcast.com/rust-python-interpreter-episode-207/">Podcast</a> for <a href="https://talkpython.fm/episodes/show/212/python-in-web-assembly-with-pyodide">podcast</a> , <a href="https://talkpython.fm/episodes/show/213/webassembly-and-cpython">podcast</a> for a <a href="https://www.youtube.com/watch%3Fv%3DftP5BQh1-YM">report</a> tell us that to continue the success and development of Python, you need to grow in new areas: especially in the web front-end, as well as mobile clients, embedded systems and console games. <br><br>  These environments require one or two conditions to be met: <br><br><ul><li>  completely different runtime environment (see <a href="https://brython.info/">Brython</a> or <a href="https://micropython.org/">MicroPython</a> ) </li><li>  modified trimmed version of the standard library. </li></ul><br>  In all these cases, the stumbling block is the definition of modules that need to be removed from the standard library.  They need to be found by trial and error;  First of all, the process is completely <i>different</i> from the standard dependency determination process in a Python application.  There is no install_requires declaration in setup.py reporting that the library uses a module from stdlib that the Python target runtime may skip due to space limitations. <br><br>  The problem may arise even if everything we use is standard Python on a Linux installation.  Even Linux distributions for servers and desktops have an equal need for a smaller Python kernel package, so the standard library is already quite arbitrarily trimmed.  This may not meet the requirements of the Python code and, as a result, lead to errors when even <a href="https://github.com/pypa/pip/issues/5356">pip install will not work</a> . <br><br><h2>  Take it all away </h2><br><blockquote> ‚ÄúWhat about the assumption that you need to clean up little by little every day?  Although it sounds convincing, do not let yourself be deceived.  The reason you feel the cleaning never ends is precisely because you are cleaning up a little.  [...] The main secret of success is: if you remove in one fell swoop, rather than gradually, you can change your thinking and life habits forever. ‚Äù </blockquote>  Marie Kondo, ‚ÄúMagical cleaning.  The Japanese art of restoring order at home and in life ‚Äù(pp. 15-16) <br><br>  While a gradual decrease in the standard library is a step in the right direction, only gradual changes are not enough.  As Marie Kondo says, if you really want to put things in order, the first step is <i>to take everything out of sight</i> in order to really see everything, and then return only what is necessary. <br><br>  It is time to pay tribute to those modules that are no longer pleasing, and send them on a long journey. <br>  We need a version of Python containing only the most necessary minimum in order for all implementations to be consistent, and for applications (even those running in web browsers or microcontrollers) to simply state their requirements in requirements.txt. <br><br>  In some business environments, an idea with a huge standard library seems attractive because adding dependencies to requirements.txt is bureaucratic, however, the ‚Äústandard library‚Äù in such environments has purely arbitrary boundaries. <br><br>  A good idea can still be to supply part of CPython binary distributions (maybe even official ones) with a wide choice of modules from PyPI.  After all, even for ordinary tasks, a certain amount of stdlib library is required, which pip-y needs in order to install other necessary modules. <br><br>  Now there is a situation where pip is distributed along with Python, but CPython is <i>not developed</i> in the repository.  Part of what the default Python installer comes with is developed in the CPython repository, some comes in a separate source archive (tarball) for the interpreter. <br><br>  To use Linux, we need bootable media with a huge set of additional programs.  But this does not mean that the Linux kernel itself resides in one giant repository, in which hundreds of applications needed for a running Linux server are developed by one team.  The Linux kernel is extremely valuable, but the operating systems using it are created from a <i>combination of</i> the Linux kernel and a wide range of separately developed libraries and programs. <br><br><h2>  Conclusion </h2><br>  The ‚ÄúBattery Included‚Äù philosophy was perfect for the time of its creation;  like a booster rocket, it delivered the python to the programming public.  However, as the open-sorts ecosystems and Python packages mature, this strategy is outdated, and, like any accelerator, we must let it go back to earth so that it does not drag us back. <br><br>  New Python runtimes, new deployment tasks, and new developer audiences all provide the Python community with tremendous opportunities to reach new heights. <br><br>  But to achieve this, we need a new, more compact and non-overloaded Python core.  We need to shake out the entire standard library on the floor, leaving only the smallest pieces we need so we can say: this is really necessary, and this is just nice to have. <br><br>  I hope that I have convinced at least some of you what kind of Python kernel we need. <br><br>  And now: who wants to write a <a href="https://www.python.org/dev/peps/pep-0001/">PEP</a> ? </div><p>Source: <a href="https://habr.com/ru/post/458092/">https://habr.com/ru/post/458092/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../458080/index.html">July 25, Moscow - QIWI iOS Meetup</a></li>
<li><a href="../458084/index.html">50 selected materials about the earnings of musicians, sound in games and movies, unusual instruments and well forgotten old ones</a></li>
<li><a href="../458088/index.html">Best Linux Distributions for Older Computers</a></li>
<li><a href="../45809/index.html">USB to VirtualBox</a></li>
<li><a href="../458090/index.html">What really happened to the disappeared Malaysian Boeing (part 2/3)</a></li>
<li><a href="../458096/index.html">What is the MERN stack and how to work with it?</a></li>
<li><a href="../458098/index.html">Pitfalls GDPR</a></li>
<li><a href="../4581/index.html">IE7 and CSS support: expert comments</a></li>
<li><a href="../458102/index.html">Effective web development workflow: Confluence, Airtable and other tools</a></li>
<li><a href="../458104/index.html">RDMA inside the data center in the implementation of Huawei</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>