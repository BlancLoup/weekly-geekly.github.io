<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Zend Framework 2: Service Manager</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Service Manager (SM, CM) in ZF2. 
 Service Manager is one of the key components of Zend Framework 2, which significantly simplifies the developer‚Äôs li...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Zend Framework 2: Service Manager</h1><div class="post__text post__text-html js-mediator-article"><h4>  Service Manager (SM, CM) in ZF2. </h4><br>  Service Manager is one of the key components of Zend Framework 2, which significantly simplifies the developer‚Äôs life by eliminating code duplication and routine operations of creating and configuring services, allowing them to be configured at the highest possible level.  CM, by its nature, is a registry of services, whose main task is the creation and storage of services.  It can be said CM is a very advanced version of the Zend Framework 1's Zend_Registry component. <br>  CM implements the Service Locator pattern.  In many parts of the application (for example, in AbstractActionController) you can find the function getServiceLocator (), which returns the class Zend \ ServiceManager \ ServiceManager.  Such a mismatch between the method name and the return type is easily explained by the fact that getServiceLocator () returns an object that implements the ServiceLocatorInterface interface: <br><a name="habracut"></a><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Zend</span></span>\<span class="hljs-title"><span class="hljs-title">ServiceManager</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceLocatorInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">has</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span></span>; }</code> </pre> <br>  Zend \ ServiceManager \ ServiceManager is as it is.  This is done because the framework itself uses several other types of CM and, by the way, no one forbids us to use our own service manager in the application. <br><br><h4>  Services. </h4><br>  A service is a regular variable of absolutely arbitrary type (not necessarily an object, see the comparison with Zend_Registry): <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// IndexController::indexAction() $arrayService = array('a' =&gt; 'b'); $this-&gt;getServiceLocator()-&gt;setService('arrayService', $arrayService); $retrievedService = $this-&gt;getServiceLocator()-&gt;get('arrayService'); var_dump($retrievedService); exit;</span></span></code> </pre><br>  will output: <br><pre> array (
     a =&gt; 'b'
 )
</pre><br><h4>  CM configuration </h4><br>  Service management can be configured in four ways: <br>  1. Through the config of the module (module.config.php): <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'service_manager'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'invokables'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(), <span class="hljs-string"><span class="hljs-string">'services'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(), <span class="hljs-string"><span class="hljs-string">'factories'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(), <span class="hljs-string"><span class="hljs-string">'abstract_factories'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(), <span class="hljs-string"><span class="hljs-string">'initializators'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(), <span class="hljs-string"><span class="hljs-string">'delegators'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(), <span class="hljs-string"><span class="hljs-string">'shared'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(), <span class="hljs-string"><span class="hljs-string">'aliases'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>() ) );</code> </pre><br>  2. defining the getServiceConfig () method (for the beauty of the code, you can also add the Zend \ ModuleManager \ Feature \ ServiceProviderInterface interface), which will return an array or Traversable in the format from clause 1; 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      3. creating a service by hand and inserting it into the CM: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// IndexController::indexAction() $arrayService = array('a' =&gt; 'b'); $this-&gt;getServiceLocator()-&gt;setService('arrayService', $arrayService);</span></span></code> </pre><br>  4. having described the service in application.config.php in the format from item 1. <br><br>  It must be remembered that the names of the services should be unique for the entire application (unless, of course, the goal is to override the existing service).  During application initialization, Zend \ ModuleManager \ ModuleManager will merge all configs into one, erasing duplicate keys.  A good practice is to add a namespace module to the name of the service.  Or use the absolute name of the class of service. <br><br><h4>  Creation of services through SM. </h4><br><h5>  Objects \ simple types </h5><br>  The easiest type.  To create such a service, you simply need to manually create an object (array, string, resource, etc.) and transfer it to the CM: <br><pre> <code class="php hljs">$myService = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyService(); $serviceManager-&gt;setService(<span class="hljs-string"><span class="hljs-string">'myService'</span></span>, $myService);</code> </pre><br>  either through the config: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'service_manager'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'services'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'myService'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyService() ) ) );</code> </pre><br>  $ serviceManager-&gt; setService ($ name, $ service) will put the object directly into the internal variable ServiceManager :: $ instances, which stores all initialized services.  When referring to this type, the SM will not try to create it and give it away as it is. <br>  Using this type, you can store arbitrary data that will be available throughout the application (as was the case with Zend_Registry). <br><br><h5>  Invokable </h5><br>  To create, you must transfer to the manager the full name of the target class.  CM will create it using the <b>new</b> operator. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// ServiceManager::createFromInvokable() protected function createFromInvokable($canonicalName, $requestedName) { $invokable = $this-&gt;invokableClasses[$canonicalName]; if (!class_exists($invokable)) { // cut } $instance = new $invokable; return $instance; }</span></span></code> </pre><br><pre> <code class="php hljs">$myService = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyService(); $serviceManager-&gt;setInvokableClass(<span class="hljs-string"><span class="hljs-string">'myService'</span></span>, $myService);</code> </pre><br>  either through the config: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'service_manager'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'invokables'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'myService'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'MyService'</span></span> ) ) );</code> </pre><br>  Application: if you just need to create a class without direct dependencies through the CM. <br>  In this case, the delegates and instantiators will still be called and will implement dependencies if necessary. <br><br><h5>  Factories. </h5><br>  Services can be created and configured in a factory.  Factories can be of two types: closure and a class that implements Zend \ ServiceManager \ FactoryInterface. <br><br>  Implementation through closure: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'service_manager'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'factories'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'myService'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ServiceLocator $serviceManager)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyService(); } ) ) );</code> </pre><br>  This approach, although it reduces the number of lines of code, but keeps a pitfall in it: closures cannot be correctly serialized into a string. <br>  A real-life example: if you enable caching of the combined config in application.config.php, then the next time you start the application will not be able to compile it and will fall with the error: <i>Fatal error: Call to undefined method Closure :: __ set_state () in / data / cache / module- config-cache..php</i> <br><br>  To avoid such problems, services should be created through factory classes that implement Zend \ ServiceManager \ FactoryInterface: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// Appliction/Service/ConfigProviderFactory.php class ConfigProviderFactory implements FactoryInterface { public function createService(ServiceLocatorInterface $serviceLocator) { return new ConfigProvider($serviceLocator-&gt;get('Configuration')); } }</span></span></code> </pre><br>  and spelled out in the config: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'service_manager'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'factories'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'ConfigProvider'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'ConfigEx\Service\ConfigProviderFactory'</span></span>, ) ) );</code> </pre><br>  You can also transfer the factory object or class name directly to the CM: <br><br><pre> <code class="php hljs">$serviceManager-&gt;setFactory(<span class="hljs-string"><span class="hljs-string">'ConfigProvider'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigEx\Service\ConfigProviderFactory());</code> </pre><br>  Application: if you need to create a service that depends on other services or needs to be configured. <br><br><h5>  Abstract Factories </h5><br>  AF is the last attempt by the CM to create the requested service.  If the SM cannot find the service, it will begin to poll all registered AFs (call the canCreateServiceWithName () method).  If the AF returns an affirmative answer, the CM will call the createServiceWithName () method from the factory, delegating the creation of the service to the AF logic. <br><br>  Transfer AF directly: <br><pre> <code class="php hljs">$serviceManager-&gt;addAbstractFactory(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AbstractFactory);</code> </pre><br>  addAbstractFactory accepts an object, not a class! <br>  Configuration via config: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'service_manager'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'abstract_factories'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'DbTableAbstractFactory'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Application\Service\'DbTableAbstractFactory'</span></span> ) ),</code> </pre><br>  And factory class: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DbTableAbstractFactory</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Zend</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceManager</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractFactoryInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canCreateServiceWithName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\Zend\ServiceManager\ServiceLocatorInterface $serviceLocator, $name, $requestedName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> preg_match(<span class="hljs-string"><span class="hljs-string">'/Table$/'</span></span>, $name); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createServiceWithName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\Zend\ServiceManager\ServiceLocatorInterface $serviceLocator, $name, $requestedName)</span></span></span><span class="hljs-function"> </span></span>{ $table = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> $name($serviceLocator-&gt;get(<span class="hljs-string"><span class="hljs-string">'DbAdapter'</span></span>)); } }</code> </pre><br>  Then, you can ask the SM to create us 2 services: <br><pre> <code class="php hljs">$serviceManager-&gt;get(<span class="hljs-string"><span class="hljs-string">'UserTable'</span></span>); $serviceManager-&gt;get(<span class="hljs-string"><span class="hljs-string">'PostTable'</span></span>);</code> </pre><br>  As a result, there will be 2 objects that have not been described in any of the types of services. <br>  This is a very handy thing.  But in my opinion, this behavior is not very predictable for other developers, so you need to use it wisely.  Who would like to spend a lot of time on debag magic that creates objects from nothing? <br><br><h4>  Aliases </h4><br>  These are just aliases for other services. <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'service_manager'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'aliases'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'myservice'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'MyService'</span></span> ) ) ); $serviceLocator-&gt;get(<span class="hljs-string"><span class="hljs-string">'myservice'</span></span>) === $serviceLocator-&gt;get(<span class="hljs-string"><span class="hljs-string">'MyService'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// true</span></span></code> </pre><br>  And now let's move on to other snacks. <br><br><h4>  Initializers </h4><br>  These are not services, but features of the CM itself.  Allow for additional service initialization after the object has been created.  They can be used to implement Interface Injection. <br>  So, after the SM has created a new object, it enumerates all registered initializers, passing them the object for the last configuration step. <br><br>  Registered in a similar way, like factories: <br>  Through closure: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'service_manager'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'initializers'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'DbAdapterAwareInterface'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($instance, ServiceLocator $serviceLocator)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($instance <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> DbAdapterAwareInterface) { $instance-&gt;setDbAdapter($serviceLocator-&gt;get(<span class="hljs-string"><span class="hljs-string">'DbAdapter'</span></span>)); } } ) ) );</code> </pre><br>  Through the class: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DbAdapterAwareInterface</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Zend</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceManager</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InitializerInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($instance, \Zend\ServiceManager\ServiceLocatorInterface $serviceLocator)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($instance <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> DbAdapterAwareInterface) { $instance-&gt;setDbAdapter($serviceLocator-&gt;get(<span class="hljs-string"><span class="hljs-string">'DbAdapter'</span></span>)); } } } <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'service_manager'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'initializers'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'DbAdapterAwareInterface'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'DbAdapterAwareInterface'</span></span> ) ) );</code> </pre><br>  In this example, Interface Injection is implemented.  If $ instance of type DbAdapterAwareInterface, then the initializer will pass the database adapter object. <br><br>  Application: Interface Injection, object tuning. <br>  It is important to know that the CM will cause all initializers for each object created, which can lead to a loss of performance. <br><br><h5>  Delegates. </h5><br>  Delegators are like initializers, the only difference is that they will be called for a specific service, and not for everyone. <br><br>  Check in: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'service_manager'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'delegators'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'Router'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'AnnotatedRouter\Delegator\RouterDelegatorFactory'</span></span> ) ) ) );</code> </pre><br>  And implementation: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RouterDelegatorFactory</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DelegatorFactoryInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createDelegatorWithName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ServiceLocatorInterface $serviceLocator, $name, $requestedName, $callback)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   ,     ,    ,  $callback  . $service = $callback(); //   ,   $service-&gt;doSomeCoolStuff(); // ,     //    return $service; } }</span></span></code> </pre><br>  In this example, the delegator RouterDelegatorFactory is applied only to the Route service. <br><br>  Application: additional configuration of the object, useful for donation of services from third-party modules.  For example, in my <a href="https://github.com/alex-oleshkevich/zf2-annotated-router">module</a> for routing through annotations, I used a delegator to add routes to a standard router.  There was an option to register the subscriber EVENT_ROUTE in Module.php with a priority higher than that of the standard listener.  But it somehow looks dirty ... <br><br><h4>  Shared services. </h4><br>  By default, the SM creates only one instance object, with each subsequent access, the same object will be returned (such is the singleton).  To disable this behavior globally, you need to call the setShareByDefault (false) method.  You can also disable this behavior for certain services using the config: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'service_manager'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'shared'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'MyService'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> ) ) ); $a = $serviceManager-&gt;get(<span class="hljs-string"><span class="hljs-string">'MyService'</span></span>); $b = $serviceManager-&gt;get(<span class="hljs-string"><span class="hljs-string">'MyService'</span></span>); spl_object_hash($a) === spl_object_hash($b); <span class="hljs-comment"><span class="hljs-comment">// false</span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/241471/">https://habr.com/ru/post/241471/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../241459/index.html">Statistics of Russian IT-specialists on stackoverflow.com and github.com</a></li>
<li><a href="../241461/index.html">Something Better A / B Testing</a></li>
<li><a href="../241463/index.html">You want a delicious beer, Arduino to help</a></li>
<li><a href="../241465/index.html">Advanced use of objects in javascript</a></li>
<li><a href="../241469/index.html">Stop doing freemium - it's time to make money</a></li>
<li><a href="../241473/index.html">How programmers solve problems</a></li>
<li><a href="../241475/index.html">Business vs Service</a></li>
<li><a href="../241479/index.html">AppCompat v21 - Material Design for Pre-Lollipop Devices</a></li>
<li><a href="../241481/index.html">And if there is no mentor?</a></li>
<li><a href="../241485/index.html">CSS Text Fading</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>