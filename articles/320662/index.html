<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pure Python Architecture: A Walkthrough. Part 4</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Content 

- Part 1 
- Part 2 
- Part 3 
- Part 4 
- Part 5 

 Scripts (Part 3) 


 Git tag: Step09 



 Our implementation of responses and requests i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pure Python Architecture: A Walkthrough. Part 4</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/6d7/c27/368/6d7c273688c345edb597ab04d7884997.png"><br><div class="spoiler">  <b class="spoiler_title">Content</b> <div class="spoiler_text"><ul><li>  <a href="https://habrahabr.ru/post/319126/">Part 1</a> </li><li>  <a href="https://habrahabr.ru/post/319202/">Part 2</a> </li><li>  <a href="https://habrahabr.ru/post/319898/">Part 3</a> </li><li>  <em>Part 4</em> </li><li>  <a href="https://habrahabr.ru/post/320928/">Part 5</a> </li></ul><br></div></div><br><h3>  Scripts (Part 3) </h3><br><p>  <b>Git tag:</b> <a href="http://github.com/lgiordani/rentomatic/tree/step09">Step09</a> <br></p><br><p> Our implementation of responses and requests is finally complete.  And now we can implement the latest version of our <abbr title="Use Case">script</abbr> .  The script correctly returns the <code><font color="#900">ResponseSuccess</font></code> object, but still does not check the validity of the incoming request. <br></p><br><p>  Let's change the test in the <code><font color="#900">tests/use_cases/test_storageroom_list_use_case.py</font></code> and add 2 more tests.  The resulting test suite (after the <code><font color="#900">domain_storagerooms</font></code> ) looks like this: <br></p><a name="habracut"></a><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mock <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.domain.storageroom <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> StorageRoom <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.shared <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> response_object <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> res <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.use_cases <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> request_objects <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> req <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.use_cases <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> storageroom_use_cases <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> uc @pytest.fixture <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">domain_storagerooms</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> [‚Ä¶] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_storageroom_list_without_parameters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(domain_storagerooms)</span></span></span><span class="hljs-function">:</span></span> repo = mock.Mock() repo.list.return_value = domain_storagerooms storageroom_list_use_case = uc.StorageRoomListUseCase(repo) request_object = req.StorageRoomListRequestObject.from_dict({}) response_object = storageroom_list_use_case.execute(request_object) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> bool(response_object) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> repo.list.assert_called_with(filters=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> response_object.value == domain_storagerooms</code> </pre><br><p>  This test differs from the previous one in that now the <code><font color="#900">assert_called_with()</font></code> method is called with the <code><font color="#900">filters=None</font></code> parameter.  In the lines with the import, <code><font color="#900">response_objects</font></code> and <code><font color="#900">request_objects</font></code> .  The fixture <code><font color="#900">Domain_storagerooms</font></code> was excluded from the code for brevity. <br></p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_storageroom_list_with_filters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(domain_storagerooms)</span></span></span><span class="hljs-function">:</span></span> repo = mock.Mock() repo.list.return_value = domain_storagerooms storageroom_list_use_case = uc.StorageRoomListUseCase(repo) qry_filters = {<span class="hljs-string"><span class="hljs-string">'a'</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>} request_object = req.StorageRoomListRequestObject.from_dict({<span class="hljs-string"><span class="hljs-string">'filters'</span></span>: qry_filters}) response_object = storageroom_list_use_case.execute(request_object) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> bool(response_object) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> repo.list.assert_called_with(filters=qry_filters) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> response_object.value == domain_storagerooms</code> </pre><br><p>  This test verifies that when calling the <abbr title="Repository">repository</abbr> , the <code><font color="#900">filters</font></code> key value is used, which is also used to create <abbr title="requests">queries</abbr> . <br></p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_storageroom_list_handles_generic_error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> repo = mock.Mock() repo.list.side_effect = Exception(<span class="hljs-string"><span class="hljs-string">'Just an error message'</span></span>) storageroom_list_use_case = uc.StorageRoomListUseCase(repo) request_object = req.StorageRoomListRequestObject.from_dict({}) response_object = storageroom_list_use_case.execute(request_object) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> bool(response_object) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> response_object.value == { <span class="hljs-string"><span class="hljs-string">'type'</span></span>: res.ResponseFailure.SYSTEM_ERROR, <span class="hljs-string"><span class="hljs-string">'message'</span></span>: <span class="hljs-string"><span class="hljs-string">"Exception: Just an error message"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_storageroom_list_handles_bad_request</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> repo = mock.Mock() storageroom_list_use_case = uc.StorageRoomListUseCase(repo) request_object = req.StorageRoomListRequestObject.from_dict({<span class="hljs-string"><span class="hljs-string">'filters'</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>}) response_object = storageroom_list_use_case.execute(request_object) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> bool(response_object) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> response_object.value == { <span class="hljs-string"><span class="hljs-string">'type'</span></span>: res.ResponseFailure.PARAMETERS_ERROR, <span class="hljs-string"><span class="hljs-string">'message'</span></span>: <span class="hljs-string"><span class="hljs-string">"filters: Is not iterable"</span></span> }</code> </pre><br><p>  These last two tests check the behavior of the script when an <abbr title="Exception">exception</abbr> occurs in the repository or if an incorrect <abbr title="request">request is made</abbr> . <br></p><br><p>  <code><font color="#900">rentomatic/use_cases/storageroom_use_cases.py</font></code> so that it contains a new script implementation that allows tests to pass successfully. <br></p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.shared <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> response_object <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> res <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StorageRoomListUseCase</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, repo)</span></span></span><span class="hljs-function">:</span></span> self.repo = repo <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, request_object)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> request_object: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res.ResponseFailure.build_from_invalid_request_object(request_object) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: storage_rooms = self.repo.list(filters=request_object.filters) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res.ResponseSuccess(storage_rooms) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> exc: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res.ResponseFailure.build_system_error( <span class="hljs-string"><span class="hljs-string">"{}: {}"</span></span>.format(exc.__class__.__name__, <span class="hljs-string"><span class="hljs-string">"{}"</span></span>.format(exc)))</code> </pre><br><p>  As you can see, the <code><font color="#900">execute()</font></code> method checks the correctness of the request; otherwise, it returns a <code><font color="#900">ResponseFailure</font></code> created based on the same <abbr title="Request Object">request object</abbr> .  Now the business logic is implemented, calling the repository and returning a successful response.  If something goes wrong in this phase, an exception is caught and the <code><font color="#900">ResponseFailure</font></code> that is formed as necessary is returned. <br></p><br><h3>  Intermission: refactoring </h3><br><p>  <b>Git tag:</b> <a href="http://github.com/lgiordani/rentomatic/tree/step10">Step10</a> <br></p><br><p>  Pure architecture is not a framework.  You should not expect as much from it as from products such as Django, which provides models, ORM, various structures and libraries.  However, some classes can be separated from our code and presented as a library, so that this code can be reused.  In this section, I will introduce you to the refactoring of already existing code, with which we isolate the main features for requests, responses and <abbr title="Use Case">scripts</abbr> . <br></p><br><p>  We have already identified the <abbr title="Response Object">object of the response</abbr> .  Since <code><font color="#900">test_valid_request_object_cannot_be_used</font></code> tests the overall behavior, not the relationship between the <code><font color="#900">StorageRoom</font></code> model and the <abbr title="Use Case">scripts</abbr> , we can move it from <code><font color="#900">tests/use_cases/test_storageroom_list_request_objects.py</font></code> to <code><font color="#900">tests/shared/test_response_object.py</font></code> . <br></p><br><p>  Then we can move the <code><font color="#900">InvalidRequestObject</font></code> and <code><font color="#900">ValidRequestObject</font></code> from <code><font color="#900">rentomatic/use_cases/request_objects.py</font></code> to <code><font color="#900">rentomatic/shared/request_object.py</font></code> , making the necessary changes to the <code><font color="#900">StorageRoomListRequestObject</font></code> class, which is now inherited from the external class. <br></p><br><p>  But the script class is undergoing significant changes.  The <code><font color="#900">UseCase</font></code> class is tested with the file code <code><font color="#900">tests/shared/test_use_case.py</font></code> : <br></p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mock <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.shared <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> request_object <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> req, response_object <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> res <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.shared <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> use_case <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> uc <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_use_case_cannot_process_valid_requests</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> valid_request_object = mock.MagicMock() valid_request_object.__bool__.return_value = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> use_case = uc.UseCase() response = use_case.execute(valid_request_object) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> response <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> response.type == res.ResponseFailure.SYSTEM_ERROR <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> response.message == \ <span class="hljs-string"><span class="hljs-string">'NotImplementedError: process_request() not implemented by UseCase class'</span></span></code> </pre><br><p>  This test verifies that the <code><font color="#900">UseCase</font></code> class cannot be used to process incoming requests. <br></p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_use_case_can_process_invalid_requests_and_returns_response_failure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> invalid_request_object = req.InvalidRequestObject() invalid_request_object.add_error(<span class="hljs-string"><span class="hljs-string">'someparam'</span></span>, <span class="hljs-string"><span class="hljs-string">'somemessage'</span></span>) use_case = uc.UseCase() response = use_case.execute(invalid_request_object) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> response <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> response.type == res.ResponseFailure.PARAMETERS_ERROR <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> response.message == <span class="hljs-string"><span class="hljs-string">'someparam: somemessage'</span></span></code> </pre><br><p>  The test executes the <abbr title="Use Case">script</abbr> with an incorrect request and checks the response.  Since the request is incorrect, the type of response is <code><font color="#900">PARAMETERS_ERROR</font></code> , thus speaking about the presence of a problem in the request parameters. <br></p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_use_case_can_manage_generic_exception_from_process_request</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> use_case = uc.UseCase() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestException</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Exception)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> use_case.process_request = mock.Mock() use_case.process_request.side_effect = TestException(<span class="hljs-string"><span class="hljs-string">'somemessage'</span></span>) response = use_case.execute(mock.Mock) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> response <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> response.type == res.ResponseFailure.SYSTEM_ERROR <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> response.message == <span class="hljs-string"><span class="hljs-string">'TestException: somemessage'</span></span></code> </pre><br><p>  This test causes the <abbr title="Use Case">script to</abbr> raise an <abbr title="Exception">exception</abbr> .  This type of error is classified as <code><font color="#900">SYSTEM_ERROR</font></code> , which is the general name for an exception that is not related to the request parameters or the actual entities. <br></p><br><p>  As you can see from the last test, the idea is to provide the <code><font color="#900">execute()</font></code> method of the <code><font color="#900">UseCase</font></code> class and call the <code><font color="#900">process_request()</font></code> method, which is defined in each child class that is our script. <br></p><br><p>  The <code><font color="#900">rentomatic/shared/use_case.py</font></code> contains the following code for passing the test successfully: <br></p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.shared <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> response_object <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> res <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UseCase</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, request_object)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> request_object: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res.ResponseFailure.build_from_invalid_request_object(request_object) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.process_request(request_object) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> exc: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res.ResponseFailure.build_system_error( <span class="hljs-string"><span class="hljs-string">"{}: {}"</span></span>.format(exc.__class__.__name__, <span class="hljs-string"><span class="hljs-string">"{}"</span></span>.format(exc))) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process_request</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, request_object)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> NotImplementedError( <span class="hljs-string"><span class="hljs-string">"process_request() not implemented by UseCase class"</span></span>)</code> </pre><br><p>  And now the <code><font color="#900">rentomatic/use_cases/storageroom_use_cases.py</font></code> contains the following code: <br></p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.shared <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> use_case <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> uc <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.shared <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> response_object <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> res <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StorageRoomListUseCase</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(uc.UseCase)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, repo)</span></span></span><span class="hljs-function">:</span></span> self.repo = repo <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process_request</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, request_object)</span></span></span><span class="hljs-function">:</span></span> domain_storageroom = self.repo.list(filters=request_object.filters) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res.ResponseSuccess(domain_storageroom)</code> </pre><br><h3>  Storage layer </h3><br><p>  <b>Git tag:</b> <a href="http://github.com/lgiordani/rentomatic/tree/step11">Step11</a> <br></p><br><p>  <abbr title="Repository Layer">The storage layer</abbr> is the layer in which there is data storage.  As you saw, when we implemented the <abbr title="Use Case">script</abbr> , we accessed the data store through the API, in this case through the <code><font color="#900">list()</font></code> store method.  The level of abstraction provided by the storage level is higher than the level provided by ORM or a tool such as SQLAlchemy.  The storage layer provides only application <abbr title="endpoints">-</abbr> specific <abbr title="endpoints">endpoints</abbr> with an interface that is tailored to specific business objectives and application goals. <br></p><br><p>  For clarity, speaking in terms of specific technologies, SQLAlchemy is an excellent tool for abstract access to an SQL database.  The internal implementation of the storage layer can use it to access the PostgreSQL database.  But the outer layer API is not the same as SQLAlchemy.  An API is a (usually diminished) set of functions that call <abbr title="Use Case">scripts</abbr> to get data.  In fact, the internal implementation of the API can use raw SQL queries.  The storage may not even be database based.  We can have a storage layer that retrieves data from a REST service or makes remote procedure calls via RabbitMQ. <br></p><br><p>  A very important feature of the storage layer is that it always returns <abbr title="Domain Models">domain models</abbr> (as well as ORM frameworks). <br></p><br><p>  In this article, I will not deploy a real database.  Perhaps I will write this in other articles, in which enough space will be allocated for implementing two different solutions, and in which it will turn out to show how the repository API can hide the actual implementation. <br></p><br><p>  Instead, I'm going to create a very simple in-memory storage system with some predefined data.  I think this will be enough to demonstrate the concept of storage. <br></p><br><p>  The first thing to do is to write a few tests that describe the public repository API.  The file <code><font color="#900">tests/repository/test_memrepo.py</font></code> contains tests for this task. <br></p><br><p>  First we will add the data that we will use in the tests.  We import the <abbr title="Domain Model">domain model</abbr> to check the correct type of the result of the API call: <br></p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.shared.domain_model <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> DomainModel <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.repository <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> memrepo storageroom1 = { <span class="hljs-string"><span class="hljs-string">'code'</span></span>: <span class="hljs-string"><span class="hljs-string">'f853578c-fc0f-4e65-81b8-566c5dffa35a'</span></span>, <span class="hljs-string"><span class="hljs-string">'size'</span></span>: <span class="hljs-number"><span class="hljs-number">215</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span>: <span class="hljs-number"><span class="hljs-number">39</span></span>, <span class="hljs-string"><span class="hljs-string">'longitude'</span></span>: <span class="hljs-string"><span class="hljs-string">'-0.09998975'</span></span>, <span class="hljs-string"><span class="hljs-string">'latitude'</span></span>: <span class="hljs-string"><span class="hljs-string">'51.75436293'</span></span>, } storageroom2 = { <span class="hljs-string"><span class="hljs-string">'code'</span></span>: <span class="hljs-string"><span class="hljs-string">'fe2c3195-aeff-487a-a08f-e0bdc0ec6e9a'</span></span>, <span class="hljs-string"><span class="hljs-string">'size'</span></span>: <span class="hljs-number"><span class="hljs-number">405</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span>: <span class="hljs-number"><span class="hljs-number">66</span></span>, <span class="hljs-string"><span class="hljs-string">'longitude'</span></span>: <span class="hljs-string"><span class="hljs-string">'0.18228006'</span></span>, <span class="hljs-string"><span class="hljs-string">'latitude'</span></span>: <span class="hljs-string"><span class="hljs-string">'51.74640997'</span></span>, } storageroom3 = { <span class="hljs-string"><span class="hljs-string">'code'</span></span>: <span class="hljs-string"><span class="hljs-string">'913694c6-435a-4366-ba0d-da5334a611b2'</span></span>, <span class="hljs-string"><span class="hljs-string">'size'</span></span>: <span class="hljs-number"><span class="hljs-number">56</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-string"><span class="hljs-string">'longitude'</span></span>: <span class="hljs-string"><span class="hljs-string">'0.27891577'</span></span>, <span class="hljs-string"><span class="hljs-string">'latitude'</span></span>: <span class="hljs-string"><span class="hljs-string">'51.45994069'</span></span>, } storageroom4 = { <span class="hljs-string"><span class="hljs-string">'code'</span></span>: <span class="hljs-string"><span class="hljs-string">'eed76e77-55c1-41ce-985d-ca49bf6c0585'</span></span>, <span class="hljs-string"><span class="hljs-string">'size'</span></span>: <span class="hljs-number"><span class="hljs-number">93</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span>, <span class="hljs-string"><span class="hljs-string">'longitude'</span></span>: <span class="hljs-string"><span class="hljs-string">'0.33894476'</span></span>, <span class="hljs-string"><span class="hljs-string">'latitude'</span></span>: <span class="hljs-string"><span class="hljs-string">'51.39916678'</span></span>, } @pytest.fixture <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">storagerooms</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [storageroom1, storageroom2, storageroom3, storageroom4]</code> </pre><br><p>  Since the <abbr title="repository">repository</abbr> object will return <abbr title="domain models">domain models</abbr> , we need a helper function to validate the results.  The following function checks the length of two lists and ensures that all returned model elements are from the domain, and compares the codes.  Note that we can use the <code><font color="#900">isinstance()</font></code> built-in function, since <code><font color="#900">DomainModel</font></code> is an abstract base class and our models are registered (see <code><font color="#900">rentomatic/domian/storagerooms.py</font></code> ) <br></p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_check_results</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(domain_models_list, data_list)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> len(domain_models_list) == len(data_list) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> all([isinstance(dm, DomainModel) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> dm <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> domain_models_list]) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> set([dm.code <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> dm <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> domain_models_list]) == set([d[<span class="hljs-string"><span class="hljs-string">'code'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data_list])</code> </pre><br><p>  We need to be able to initialize the repository with a list of dictionaries, and so that calling the <code><font color="#900">list()</font></code> method without any parameter returns the same list of entries. <br></p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_repository_list_without_parameters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(storagerooms)</span></span></span><span class="hljs-function">:</span></span> repo = memrepo.MemRepo(storagerooms) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> repo.list() == storagerooms</code> </pre><br><p>  The <code><font color="#900">list()</font></code> method must accept the <code><font color="#900">filters</font></code> parameter, which is a dictionary.  Dictionary keys should be in the form of <code><font color="#900">&lt;attribute&gt;__&lt;operator&gt;</font></code> , similar to the syntax used in Django ORM.  Thus, to express that the price should be less than 65, you can write <code><font color="#900">filters={'price__lt': 60}</font></code> . <br></p><br><p>  There are several error conditions that need to be checked: an unknown key should raise a <code><font color="#900">KeyError</font></code> exception, and using an invalid operator should cause a <code><font color="#900">ValueError</font></code> exception. <br></p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_repository_list_with_filters_unknown_key</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(storagerooms)</span></span></span><span class="hljs-function">:</span></span> repo = memrepo.MemRepo(storagerooms) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pytest.raises(KeyError): repo.list(filters={<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'aname'</span></span>}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_repository_list_with_filters_unknown_operator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(storagerooms)</span></span></span><span class="hljs-function">:</span></span> repo = memrepo.MemRepo(storagerooms) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pytest.raises(ValueError): repo.list(filters={<span class="hljs-string"><span class="hljs-string">'price__in'</span></span>: [<span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>]})</code> </pre><br><p>  Let's check that the filtering mechanism works.  We want the default operator to be <code><font color="#900">__eq</font></code> .  This means that if we do not pass any operator, the equality operator must be executed. <br></p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_repository_list_with_filters_price</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(storagerooms)</span></span></span><span class="hljs-function">:</span></span> repo = memrepo.MemRepo(storagerooms) _check_results(repo.list(filters={<span class="hljs-string"><span class="hljs-string">'price'</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>}), [storageroom3]) _check_results(repo.list(filters={<span class="hljs-string"><span class="hljs-string">'price__eq'</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>}), [storageroom3]) _check_results(repo.list(filters={<span class="hljs-string"><span class="hljs-string">'price__lt'</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>}), [storageroom1, storageroom4]) _check_results(repo.list(filters={<span class="hljs-string"><span class="hljs-string">'price__gt'</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>}), [storageroom2]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_repository_list_with_filters_size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(storagerooms)</span></span></span><span class="hljs-function">:</span></span> repo = memrepo.MemRepo(storagerooms) _check_results(repo.list(filters={<span class="hljs-string"><span class="hljs-string">'size'</span></span>: <span class="hljs-number"><span class="hljs-number">93</span></span>}), [storageroom4]) _check_results(repo.list(filters={<span class="hljs-string"><span class="hljs-string">'size__eq'</span></span>: <span class="hljs-number"><span class="hljs-number">93</span></span>}), [storageroom4]) _check_results(repo.list(filters={<span class="hljs-string"><span class="hljs-string">'size__lt'</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>}), [storageroom3]) _check_results(repo.list(filters={<span class="hljs-string"><span class="hljs-string">'size__gt'</span></span>: <span class="hljs-number"><span class="hljs-number">400</span></span>}), [storageroom2]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_repository_list_with_filters_code</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(storagerooms)</span></span></span><span class="hljs-function">:</span></span> repo = memrepo.MemRepo(storagerooms) _check_results( repo.list(filters={<span class="hljs-string"><span class="hljs-string">'code'</span></span>: <span class="hljs-string"><span class="hljs-string">'913694c6-435a-4366-ba0d-da5334a611b2'</span></span>}), [storageroom3])</code> </pre><br><p>  The implementation of the <code><font color="#900">MemRepo</font></code> class <code><font color="#900">MemRepo</font></code> fairly simple, and I will not explain it line by line. <br></p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.domain <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> storageroom <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> sr <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MemRepo</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, entries=None)</span></span></span><span class="hljs-function">:</span></span> self._entries = [] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> entries: self._entries.extend(entries) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_check</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, element, key, value)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">'__'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> key: key = key + <span class="hljs-string"><span class="hljs-string">'__eq'</span></span> key, operator = key.split(<span class="hljs-string"><span class="hljs-string">'__'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> operator <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-string"><span class="hljs-string">'eq'</span></span>, <span class="hljs-string"><span class="hljs-string">'lt'</span></span>, <span class="hljs-string"><span class="hljs-string">'gt'</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> ValueError(<span class="hljs-string"><span class="hljs-string">'Operator {} is not supported'</span></span>.format(operator)) operator = <span class="hljs-string"><span class="hljs-string">'__{}__'</span></span>.format(operator) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getattr(element[key], operator)(value) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">list</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, filters=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> filters: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._entries result = [] result.extend(self._entries) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> key, value <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> filters.items(): result = [e <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> e <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> result <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self._check(e, key, value)] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [sr.StorageRoom.from_dict(r) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> r <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> result]</code> </pre><br>  <em>Continued in <a href="https://habrahabr.ru/post/320928/">Part 5</a></em> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/320662/">https://habr.com/ru/post/320662/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320648/index.html">Analysis of the report of Andrey Akinshin about arithmetic</a></li>
<li><a href="../320650/index.html">Analysis of the interaction of mobile Android applications with the social networks API Facebook, Instagram, VKontakte</a></li>
<li><a href="../320652/index.html">Do people need online business application designers</a></li>
<li><a href="../320654/index.html">Security Week 04: missing botnet, Webex vulnerability, Apple patches</a></li>
<li><a href="../320658/index.html">GraphQL as Universal RPC</a></li>
<li><a href="../320664/index.html">Google ReCAPTCHA Invisible or down traffic signs and shop windows</a></li>
<li><a href="../320666/index.html">Netbeans tricks and tricks on live examples</a></li>
<li><a href="../320668/index.html">And if without JavaScript?</a></li>
<li><a href="../320670/index.html">PHP 7.1.1 FPM vs Node.js 7.4.0 as a web backend server</a></li>
<li><a href="../320672/index.html">Intellectual system ELIS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>