<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to stop being afraid and fall in love with mbed [Part 3]</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue a series of publications devoted to the use of the ARM mbed environment for creating a prototype measuring device. 

 Today we connect the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to stop being afraid and fall in love with mbed [Part 3]</h1><div class="post__text post__text-html js-mediator-article">  We continue a series of publications devoted to the use of the ARM mbed environment for creating a prototype measuring device. <br><br>  Today we connect the sensor. <br><br><img src="https://habrastorage.org/files/5df/3f4/ad6/5df3f4ad6fdf451a9cbc1c655cfaad9b.png" width="600">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Content of the publication cycle: <br><ul><li>  <a href="https://habrahabr.ru/company/efo/blog/308440/">[Part 1] Overview of the used software and hardware solutions.</a> </li><li>  <a href="https://habrahabr.ru/company/efo/blog/309918/">[Part 2] Getting Started with the FT800 Graphics Controller.</a>  <a href="https://habrahabr.ru/company/efo/blog/309918/">Use of ready mbed-libraries for peripheral devices.</a> </li><li>  <b>[Part 3] Connecting the sensor HYT-271.</b>  <b>Create and publish in mbed your own library for peripherals.</b> </li><li>  <a href="https://habrahabr.ru/company/efo/blog/310720/">[Part 4] Application development: Program structure, working with a touch screen.</a> </li><li>  <a href="https://habrahabr.ru/company/efo/blog/311816/">[Part 5] Application development: Display images, Russification problems.</a> </li><li>  <a href="https://habrahabr.ru/company/efo/blog/312484/">[Part 6] Printing Body Parts</a> </li></ul><br><br>  The third part under the cut. <br><a name="habracut"></a><br>  The previous article ended with a description of the project, which was created in mbed IDE and implements the output of the seconds counter on the Riverdi TFT display. <br><br>  Today we connect the sensor of temperature and relative humidity of the HYT series.  The sensor is a complete digital node - it contains a capacitive sensing element for measuring humidity, a temperature sensor, and a signal processing circuit; in addition, like most similar sensors, the HYT is factory calibrated.  All this means one thing - to use the sensor, it is enough to connect it to the controlling controller and learn the protocol by which the sensor is interrogated. <br><br>  The format of the packages and an example of the implementation of the corresponding functions in C are described in detail in <a href="https://habrahabr.ru/company/efo/blog/303350/">this article</a> .  Now I will try not to duplicate much of what has already been said and will focus on the issues of using the HYT-271 * sensor in the mbed project. <br><br>  <i>* HYT series consists of three models - HYT-271, HYT-221 and HYT-939.</i>  <i>They differ only in the case, so everything that I am writing about switching on the HYT-271 is also relevant for other models.</i> <br><br><img src="https://habrastorage.org/files/430/899/0f8/4308990f8a524989a8a4a793c77fe05b.png" width="450"><br><h1>  Inclusion scheme </h1><hr><br>  To connect sensors of the HYT series, I2C interface is usually used (sensors with SPI are available on request).  Accordingly, to connect the sensor, you need four lines: <br><br><ul><li>  Power supply (suitable for 3.3 and 5 V) </li><li>  Land </li><li>  SDA Data Line </li><li>  SLC clocking line </li></ul><br><img src="https://habrastorage.org/files/c77/966/25e/c7796625ece2487f8ab410f68070e9d6.png" width="300"><br>  The recommended pull-up resistors for SDA and SLC lines are 2.4 kŒ©. <br><br><h1>  Sensor polling order </h1><hr><br>  HYT series sensors support several types of commands.  For direct polling of the sensor, use the <b>Measuring Request</b> and <b>Data Fetch</b> commands, and the remaining instructions will be needed only if it is necessary to change the standard address of the sensor on the I2C bus. <br><br>  At once I will say that in the mbed-library HYT there are no functions for changing the I2C-address.  The reasons for this are my natural laziness and the lack of a direct need, because in most cases a single sensor hangs on the bus and for work it is sufficient to implement the polling and measurement procedures. <br><br><img src="https://habrastorage.org/files/3b3/29c/38b/3b329c38bbeb4fdd8051048a290f18ff.png" width="300"><br>  So, on receipt of the Measuring Request command, the HYT sensor goes out of sleep mode, takes measurements and generates a package with data on temperature and humidity.  To receive data, a Data Fetch command must be sent to the sensor, and there should be a delay of 100 ms between the transmission of these two commands, since  it is exactly the time it takes for the sensor to measure and form the package. <br><br>  Measuring Request is a packet consisting only of a header byte ‚Äî the address of the sensor and the record flag.  The corresponding function MRCommand () sends an empty packet to I2C. <br><br>  The Data Fetch command is a header byte with a read flag and four bytes of data that the controller receives from the sensor. <br><br><img src="https://habrastorage.org/files/68c/297/3ce/68c2973ceb2a4eb1bce5c022f534f539.png" width="550"><br>  The first bit of the first byte is the service CMode bit.  If it is set to "1", then the sensor is in a special mode of operation in which you can change its address on the bus. <br><br>  The second bit of the first byte is the service Stale bit.  If it is set to ‚Äú1‚Äù, then after performing the next measurement cycle, the same temperature and humidity values ‚Äã‚Äãare obtained as in the previous cycle. <br><br>  The next 14 digits encode the relative humidity, the next 14 digits encode temperature.  Next come two insignificant bits. <br><br>  The corresponding function DFCommand () transfers the corresponding packet to I2C and decodes the data received from the sensor.  The values ‚Äã‚Äãof relative humidity and temperature are calculated by the following formulas: <br><br><blockquote>  RH [%] = (100 / (2 <sup>14</sup> - 1)) * RH <sub>in</sub> <br>  T [¬∞ C] = (165 / (2 <sup>14</sup> - 1)) * T <sub>in</sub> - 40 </blockquote><br>  Thus, the HYT sensor polling library should implement two functions ‚Äî MRCommand () and DFCommand (). <br><br><h1>  Creating and publishing a library in mbed </h1><hr><br>  Let me remind you that mbed supports various <a href="https://developer.mbed.org/platforms/">ARM platforms</a> and <a href="https://developer.mbed.org/components/">paired devices</a> (components) - displays, drives, sensors, transceivers, and so on. <br><br>  Naturally, only the microcontroller manufacturer can provide support for the new debug board, but with the support of new peripheral components, everything is more interesting.  A couple of months ago, any user could add any device and the Add new component button hung above the list of supported components.  Now ARM changes the policy: any registered user can publish a library and a description for a new component, but in order to add my driver to the <a href="https://developer.mbed.org/components/HYT-271-HYT-221-HYT-939-Humidity-Tempera/">list of supported components,</a> extended rights are required (I now have these, hee-hee-hee). <br><br>  All mbed-libraries for peripheral devices are C ++ classes that contain the necessary functions for working with the device.  As a rule, the constructor of such a class accepts as arguments the I / O lines to which the component is connected.  If the device requires some initialization procedure, then it is also logical to include this procedure in the class constructor.  An example of a library containing an initialization procedure is the FT800 graphics controller library, which was described in detail in a <a href="https://habrahabr.ru/company/efo/blog/309918/">previous article</a> . <br><br>  In the case of the HYT sensor, everything is much simpler: sensor initialization is not required, and only two functions are needed to obtain measurement results. <br><br>  <u>HYT.h file</u> <br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> HYT_ADDR 0x50 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// 01010000 class HYT { public: /** * HYT constructor. * * @param sda mbed pin to use for SDA line of I2C interface. * @param scl mbed pin to use for SCL line of I2C interface. * * Remember about pull-up resistors on sda and scl. Recommended value is 2.4 kŒ© */ HYT(PinName sda, PinName scl); /** * @brief The totals (temperature in Celsius, relative humidity in percentages) */ float humidity; float temperature; /** * @brief Send "Measuring Request" command * @details Initiates a measuring cycle of HYT sensor * @details More information: http://www.ist-ag.com/eh/ist-ag/resource.nsf/imgref/Download_AHHYTM_E2.2.5.pdf/$FILE/AHHYTM_E2.2.5.pdf */ void MRCommand(void); /** * @brief Send "Data Fetch" command &amp; processing the data * @details Fetch the last measured value of humidity and temperature from sensor * @details Calculate values of temperature in Celsius, relative humidity in percentages * @details More information: http://www.ist-ag.com/eh/ist-ag/resource.nsf/imgref/Download_AHHYTM_E2.2.5.pdf/$FILE/AHHYTM_E2.2.5.pdf * @returns 0 if no errors, -1 if no new value received from sensor. */ int DFCommand(void); private: I2C _i2c; };</span></span></span></span></code> </pre> <br>  <u>HYT.cpp file</u> <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"HYT.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"mbed.h"</span></span></span><span class="hljs-meta"> HYT::HYT(PinName sda, PinName scl) : _i2c(sda, scl) { } </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*************************************************************************************************************************/</span></span></span><span class="hljs-meta"> void HYT::MRCommand(void) { _i2c.write(HYT_ADDR, 0, 0); } </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*************************************************************************************************************************/</span></span></span><span class="hljs-meta"> int HYT::DFCommand(void) { char dataI2C[4]; int stateBit; int humidityRaw; int temperatureRaw; _i2c.read(HYT_ADDR, dataI2C, 4); stateBit = (dataI2C[0] &amp; 0x40) &gt;&gt; 6; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (stateBit == 0) { humidityRaw = ((dataI2C[0] &amp; 0x3F) </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&lt; 8) | dataI2C[1]; temperatureRaw = ((dataI2C[2] &lt;&lt; 8) | dataI2C[3]) &gt;&gt; 2; if (temperatureRaw &lt; 0x3FFF &amp;&amp; humidityRaw &lt; 0x3FFF) { temperature = ((float)(temperatureRaw) * 165.0f / 16383.0f) - 40.0f; humidity = (float)humidityRaw * 100.0f / 16383.0f; } else { // sensor returns wrong data (1111...11) return -1; } } else { // no new value received from sensor return 0; } return 0; }</span></span></span></span></code> </pre><br>  To use the library in your own project, just <a href="https://developer.mbed.org/users/Ksenia/code/HYT/">follow the link to the page with its description</a> and import the library into your online compiler. <br><br><img src="https://habrastorage.org/files/ded/cc0/fe4/dedcc0fe4aea4c599f7f51b086ffaf51.png"><br><br>  When publishing the mbed library for a new component, it is assumed not only to create and properly document the code.  In addition, it is desirable to provide the library with a description of the hardware module, a typical device enablement scheme and the Hello World program - a simple example of using the library.  To create such an example, I again use the blank project from the <a href="https://habrahabr.ru/company/efo/blog/308440/">first article in this publication cycle</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Let me remind you that the blank project is a simple program that outputs a seconds counter to a serial interface (to a virtual COM port)</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"mbed.h"</span></span></span><span class="hljs-meta"> Serial pc(USBTX, USBRX); Ticker timeKeeping; volatile uint64_t seconds = 0; void secondsCallback(void) { pc.printf(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Number of seconds: %x\r\n"</span></span></span><span class="hljs-meta">, seconds); seconds ++; } int main() { timeKeeping.attach(&amp;secondsCallback, 1.0f); while(1) {} }</span></span></code> </pre><br><br><img src="https://habrastorage.org/files/4ec/c31/6fe/4ecc316fec904a41a9aee760f174fcd3.png"><br></div></div><br>  We connect the HYT library to the draft project and make some simple changes: <br><br><ul><li>  create a SENSOR object of the HYT class, passing as arguments the names of the pins on which the I2C interface is available </li><li>  add the polling function of the dataUpdate () sensor and call it in an infinite loop </li><li>  instead of the seconds counter, we output the obtained data on temperature and relative humidity to a serial interface </li></ul><br>  Thus we get a demo example for the created library: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"mbed.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"HYT.h"</span></span></span><span class="hljs-meta"> Serial pc(USBTX, USBRX); Ticker timeKeeping; HYT SENSOR (PD6, PD7); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// sda, scl [SLSTK3400A] //HYT SENSOR (D14, D15); // sda, scl [WIZwiki-W7500P] //HYT SENSOR (PA08, PA09); // sda, scl [ATSAMD21-XPRO] // HYT sensor polling cycle void dataUpdate(void) { SENSOR.MRCommand(); wait_ms(100); SENSOR.DFCommand(); } void secondsCallback(void) { pc.printf("Humidity level: %.1f\r\n%", SENSOR.humidity); pc.printf("Temperature level: %.1f\r\n%", SENSOR.temperature); pc.printf("-------------------------------\r\n%", SENSOR.temperature); } int main() { timeKeeping.attach(&amp;secondsCallback, 1.0f); while(1) { dataUpdate(); } }</span></span></span></span></code> </pre><br>  The project is available <a href="https://developer.mbed.org/users/Ksenia/code/HYT_example/">on developer.mbed.org</a> and works correctly on various debugging boards supported by ARM mbed. <br><br><img src="https://habrastorage.org/files/e3f/f0d/c78/e3ff0dc7820b45e99e11556fc1717a49.png"><br>  On the publication of the example of use, the process of creating a library for HYT sensors ends. <br><br><h1>  Using the library in your own project </h1><hr><br>  Now you can go back to our main project, we will not output the seconds to the touchscreen TFT display, but the data received from the HYT-271 sensor. <br><br><img src="https://habrastorage.org/files/ed6/387/b63/ed6387b630ca480b8e9212c58e35f11b"><br>  To do this, create a new project in mbed and import the <a href="https://developer.mbed.org/users/Ksenia/code/HYT/">HYT</a> and <a href="https://developer.mbed.org/users/dreschpe/code/FT800_2/">FT800_2</a> libraries there. <br>  Then we create objects of the classes HYT and FT800, using as arguments the names of I / O lines, on which the interfaces I2C and SPI are available, respectively: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">HYT </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SENSOR</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PD6, PD7)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// sda, scl [SLSTK3400A] FT800 TFT (PE10, PE11, PE12, PE13, PB11, PD4); // mosi, miso, sck, ss, int, pd [SLSTK3400A] //HYT SENSOR (D14, D15); // sda, scl [WIZwiki-W7500P] //FT800 TFT (D11, D12, D13, D10, D9, D8); // mosi, miso, sck, ss, int, pd [WIZwiki-W7500P] //HYT SENSOR (PA08, PA09); // sda, scl [ATSAMD21-XPRO] //FT800 TFT (PA18, PA16, PA19, PA17, PA20, PA21); // mosi, miso, sck, ss, int, pd [ATSAMD21-XPRO]</span></span></code> </pre><br>  Add sensor polling function: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dataUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ SENSOR.MRCommand(); wait_ms(<span class="hljs-number"><span class="hljs-number">100</span></span>); SENSOR.DFCommand(); }</code> </pre><br>  Add a function that forms and loads the display list on the graphics controller: <br><br><ul><li>  Beginning of the display list, setting the white color as the default color </li><li>  Set to black, display two text lines </li><li>  Setting the dark green color, the output of the graphic primitive "Rectangle" </li><li>  White setting, text string and number output (relative humidity values) </li><li>  Setting the dark blue color, the output of the graphic primitive "Rectangle" </li><li>  White setting, text string and number output (temperature values) </li><li>  Set to black, text line output </li><li>  Displaying the straight line graphic primitive </li><li>  End of the display list, loading pictures on the display </li></ul><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawTimeScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ TFT.DLstart(); TFT.DL(CLEAR_COLOR_RGB(<span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>)); TFT.DL(CLEAR(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)); TFT.DL(COLOR_RGB(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); TFT.Text(<span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"Demo-project for habrahabr.ru"</span></span>); TFT.Text(<span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span> + <span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"Using FT800 library and HYT library"</span></span>); TFT.DL(COLOR_RGB(<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>)); TFT.DL(BEGIN(RECTS)); TFT.DL(VERTEX2II(<span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); TFT.DL(VERTEX2II(<span class="hljs-number"><span class="hljs-number">11</span></span> + <span class="hljs-number"><span class="hljs-number">222</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span> + <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); TFT.DL(COLOR_RGB(<span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>)); TFT.Text(<span class="hljs-number"><span class="hljs-number">11</span></span> + <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span> + <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"Relative humidity, %"</span></span>); TFT.Number(<span class="hljs-number"><span class="hljs-number">11</span></span> + <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span> + <span class="hljs-number"><span class="hljs-number">10</span></span> + <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, SENSOR.humidity); TFT.DL(COLOR_RGB(<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>)); TFT.DL(BEGIN(RECTS)); TFT.DL(VERTEX2II(<span class="hljs-number"><span class="hljs-number">11</span></span> + <span class="hljs-number"><span class="hljs-number">222</span></span> + <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); TFT.DL(VERTEX2II(<span class="hljs-number"><span class="hljs-number">11</span></span> + <span class="hljs-number"><span class="hljs-number">222</span></span> + <span class="hljs-number"><span class="hljs-number">14</span></span> + <span class="hljs-number"><span class="hljs-number">222</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span> + <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); TFT.DL(COLOR_RGB(<span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>)); TFT.Text(<span class="hljs-number"><span class="hljs-number">11</span></span> + <span class="hljs-number"><span class="hljs-number">222</span></span> + <span class="hljs-number"><span class="hljs-number">14</span></span> + <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span> + <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"Temperature, C"</span></span>); TFT.Number(<span class="hljs-number"><span class="hljs-number">11</span></span> + <span class="hljs-number"><span class="hljs-number">222</span></span> + <span class="hljs-number"><span class="hljs-number">14</span></span> + <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span> + <span class="hljs-number"><span class="hljs-number">10</span></span> + <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, SENSOR.temperature); TFT.DL(COLOR_RGB(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); TFT.Text(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span> + <span class="hljs-number"><span class="hljs-number">100</span></span> + <span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"e-mail: xk@efo.ru"</span></span>); TFT.DL(BEGIN(LINES)); TFT.DL(LINE_WIDTH(<span class="hljs-number"><span class="hljs-number">8</span></span>)); TFT.DL(VERTEX2II(<span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span> + <span class="hljs-number"><span class="hljs-number">40</span></span> + <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); TFT.DL(VERTEX2II(<span class="hljs-number"><span class="hljs-number">460</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span> + <span class="hljs-number"><span class="hljs-number">40</span></span> + <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); TFT.DL(DISPLAY()); TFT.Swap(); }</code> </pre><br>  And continuously update and display data: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) { dataUpdate(); drawTimeScreen(); } }</code> </pre><br>  The project is available <a href="https://developer.mbed.org/users/Ksenia/code/Temp__RH_at_TFT-demo/">at developer.mbed.org</a> . <br><br>  As in the rest of the project development stages, I run the resulting program on three different boards - SLSTK3400A from SiLabs, ATSAMD21-XPRO from Atmel and WIZwiki-W7500P from Wiznet. <br><br><img src="https://habrastorage.org/files/217/d54/1d7/217d541d7aa046ba8ba126f16d9ed74c.png" width="600"><br>  In the last article, when we looked at a demo example for displaying information on a TFT display, it took to switch from one board to another: <br>  a) change the target platform (in the upper right corner of the compiler), <br>  b) reassign the pins used to connect the display (in the code), <br>  c) connect the display to the new board. <br><br>  The transition went smoothly and the mbed-ov program earned on the move on all three boards.  For the program that polls the HYT sensor you will also need: <br>  d) reassign the leads used to connect the sensor (in the code), <br>  e) connect the sensor to the new board, not forgetting the pull-up resistors. <br><br>  When the sensor was connected, the differences in the debug boards finally began to emerge. <br><br>  Wiznet worked without surprises - it was enough to connect the sensor according to the recommended scheme and download the firmware. <br><br><img src="https://habrastorage.org/files/98e/0cb/793/98e0cb793633496bbe68b05cfb309338.JPG"><br><br>  Data from the SiLabs board was obtained even without the use of discrete resistors.  The fact is that all GPIO EFM32 microcontrollers have built-in pull-up resistors, when working in the desktop IDE Simplicity Studio, the mode of operation of each line (open-drain push-pull, etc.) is configured manually.  Apparently, mbed automatically pulled up to power those lines on which SDA and SCL are implemented. <br><br><img src="https://habrastorage.org/files/d8f/89c/9bc/d8f89c9bc8cf43dfbf1cb71ed77da464.jpg"><br><br>  Atmel is announced today as the weakest link - on the ATSAMD21-XPRO board, the I2C interface (also known as TWI) is available on lines that are simultaneously used by the Atmel Embedded Debugger debugger.  I didn‚Äôt understand this question in detail, but the fact remains: when powering the board from USB, I2C data reception stops after 2-3 seconds.  If you apply power to a separate 5.0V IN connector, then the whole program works correctly. <br><br><img src="https://habrastorage.org/files/75d/cf0/857/75dcf0857168465c94885801b0c149db.JPG"><br><br>  However, we must admit that there were no complaints about the work of the software, which means it makes sense to continue the development using mbed. <br><br>  The next article will give a brief overview of the program structure and detailed instructions for working with touch input on the Riverdi TFT module.  Thus, we are getting closer and closer to the full-fledged application, whose work is shown on video. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/nYildtT047Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h1>  Conclusion </h1><hr><br>  In conclusion, I traditionally thank the reader for his attention and remind you that questions about the use of products, about which we write on Habr√©, can also be asked by email, specified in my profile. </div><p>Source: <a href="https://habr.com/ru/post/310058/">https://habr.com/ru/post/310058/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310048/index.html">How much conflict developers - infographics on the results of the survey on "My Circle"</a></li>
<li><a href="../310050/index.html">Tired of silencing: the truth about working in a technical support service for an IT company</a></li>
<li><a href="../310052/index.html">Animated QR codes</a></li>
<li><a href="../310054/index.html">Overview of the OPCache extension for PHP</a></li>
<li><a href="../310056/index.html">Launch Linux on FPGA: Hello, World</a></li>
<li><a href="../310060/index.html">Cycle of articles "NetRack Guards: guarding the client IT infrastructure": the story of a man who knows everything</a></li>
<li><a href="../310062/index.html">Pitfalls of conditional formatting in MS Access</a></li>
<li><a href="../310064/index.html">How to avoid mistakes using modern C ++</a></li>
<li><a href="../310066/index.html">31 best email marketing automation tools</a></li>
<li><a href="../310068/index.html">PHP: fractal misuse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>