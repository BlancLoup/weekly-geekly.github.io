<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating an editor quest and dialogs for the Unreal engine: Part 2 technical aspects</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, my name is Dmitry. I create computer games on the Unreal Engine as a hobby. Today I will continue to talk about the plugin for editing quests a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating an editor quest and dialogs for the Unreal engine: Part 2 technical aspects</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/c7a/2f1/033/c7a2f10332f64a26af461c8f13ff3683.png" alt="image"><br><br>  Hello, my name is Dmitry.  I create computer games on the Unreal Engine as a hobby.  Today I will continue to talk about the plugin for editing quests and dialogues.  In the <a href="https://habrahabr.ru/post/318366/">previous article</a> I told how to use the plugin, today I will tell you what you need to know so that the plugin can interact with the game world and its interface. <br><a name="habracut"></a><br>  First of all, to connect the plugin to your project, you need to move the StoryGraphPlugin folder from the plugins folder to the directories folder of your project \ plugins.  You may have to re-compile the game if the Unreal engine versions do not match. <br><br>  But even after you create an Asset StoryGraph you will need to perform some manipulations.  All subject objects that you place on the map should be derived from certain objects, here is their list: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1) ACharecter_StoryGraph - the base class for characters has blueprint methods: <br>  ChangeState - The method changes the character's state in this case from live to dead, that is, in the blueprint, you need to create a function that, when a character dies, will switch its state, and then StoryGraph will understand that the character has died. <br>  OpenDialog () - Blueprint method that you need to call to start a dialogue with this character. <br>  GetObjectName () - Blueprint method that returns the name of the character defined in StoryGraph, if you have placed several StoryGraph objects at the level and the name of this character is different in each of them, the function will return the name from the first StoryGraph. <br>  GetMessegeFromStoryGraph () - The Blueprint event occurs when a Send Message node is activated in StoryGraph, which sends a message to this character. <br><br>  2) APlaceTrigger_StoryGraph - The base class for a trigger has blueprint methods: <br>  GetPlaceTriggerType () - Needed to find out in which mode the trigger works. <br>  ChangeState () - Similar to the method from ACharecter_StoryGraph, only states other (UnActive, Active).  It should be used in the mode of operation of the UnInteractive trigger. <br>  Activate () - This method is not an analogy of the previous one, because it just does not work in UnInteractive mode but works in the other two.  In the Interactive mode, it activates the trigger, and in the AdvanceInteractive mode it opens the interaction dialog box with the trigger. <br>  Like the previous class, this one has the blueprint methods GetObjectName () and GetMessegeFromStoryGraph (). <br><br>  3) AInventoryItem_StoryGraph - The base class for the subject of the inventory.  In addition to the above mentioned GetObjectName () and GetMessegeFromStoryGraph (), this class has a method <br>  PickUp () - Which moves an item to the character's inventory. <br><br>  4) AOtherActor_StoryGraph - Class for objects not belonging to the above categories.  Only GetObjectName () and GetMessegeFromStoryGraph () do not have their own methods. <br><br>  5) ALevelScriptActor_StoryGraph - The base class for LevelBluprint has one Blueprint event <br>  GetMessegeFromStoryGraph () - Which is called when the node is activated Send message to level blueprint <br><br>  In addition to objects on the map, StoryGraph interacts with the interface elements, here is their list: <br><br>  1) AHUD_StoryGraph - The base class for your HUD.  Has methods: <br>  EndGame () - Blueprint event that is called when the Game Over node is triggered. <br>  PrintQuestPhaseOnScreen () - A blueprint event that is triggered when the node triggers Print quest phase on screen. <br>  OpenDialogEvent () - A blueprint event is called when one of the characters calls OpenDialog (). <br>  OpenPlaceTriggerMessagesEvent () - Same for the trigger. <br>  ChangeLocalization () - Changes the language in the game. <br>  GetCurrentLocalization () - Returns the current language. <br><br>  2) UGameScreen_StoryGraphWidget - The base class for the widget located on the game screen.  This widget displays messages for the player as well as the so-called DefaultAnswer that the player sees if the response <br><br>  3) UJurnal_StoryGraphWidget - Widget displays currently active quests on the screen. <br><br>  4) URadar_StoryGraphWidget - Radar it needs to be placed in the GameScreen widget and it will display targets <br><br>  5) UDialog_StoryGraphWidget - Displays the dialog window or the interaction window with the trigger. <br><br>  6) UInventory_StoryGraphWidget - Widget displays the inventory in which the subject objects are located. <br><br>  After that, everything will work as it should. <br><br><h3>  Problems encountered </h3><br>  Now I‚Äôll tell you about the problems that I had to solve in order to write this plugin. <br><br>  The first problem was that the level in the Unreal Engine is a closed system; all pointers of objects that are at the level must point to objects at the level and objects outside the level cannot have pointers pointing to objects at the level.  And this is a problem because the StoryGraph object is out of level, but its objects need to be brought to the level objects.  Fortunately, there are so-called lazy pointers (TAssetPtr) in the Unreal engine.  They are lazy because they can refer to objects that are not currently loaded, and also with the help of them you can refer to objects of a level from objects that are outside of it. <br><br>  The second problem for me was the fact that the graph object (UEdGraph) cannot be used in the game.  That is, the game is compiled and even packaged, but when you try to run this game, it will simply crash with an error.  Therefore, I simply stack the nodes into an array and on the graph I place an ‚Äúadapter object‚Äù UProxyNodeBase which simply redirects method calls to my nodes when editing in the editor.  And this object itself is located in the editorial module, therefore, when packing the game, it is not taken into account. <br><br>  Well, when I wrote a plugin, I tried to compile it in Development mode and get this: <br><br><div class="spoiler">  <b class="spoiler_title">Errors</b> <div class="spoiler_text"><code>UE4-StoryGraphPluginRuntime.lib(Module.StoryGraphPluginRuntime.cpp.obj) : error LNK2005: "void * __cdecl operator new(unsigned __int64)" (??2@YAPEAX_K@Z) already defined in StoryTestProgect.cpp.obj <br> 1&gt;UE4-StoryGraphPluginRuntime.lib(Module.StoryGraphPluginRuntime.cpp.obj) : error LNK2005: "void * __cdecl operator new(unsigned __int64,struct std::nothrow_t const &amp;)" (??2@YAPEAX_KAEBUnothrow_t@std@@@Z) already defined in StoryTestProgect.cpp.obj <br> 1&gt;UE4-StoryGraphPluginRuntime.lib(Module.StoryGraphPluginRuntime.cpp.obj) : error LNK2005: "void __cdecl operator delete(void *)" (??3@YAXPEAX@Z) already defined in StoryTestProgect.cpp.obj <br> 1&gt;UE4-StoryGraphPluginRuntime.lib(Module.StoryGraphPluginRuntime.cpp.obj) : error LNK2005: "void __cdecl operator delete(void *,struct std::nothrow_t const &amp;)" (??3@YAXPEAXAEBUnothrow_t@std@@@Z) already defined in StoryTestProgect.cpp.obj <br> 1&gt;UE4-StoryGraphPluginRuntime.lib(Module.StoryGraphPluginRuntime.cpp.obj) : error LNK2005: "void * __cdecl operator new[](unsigned __int64)" (??_U@YAPEAX_K@Z) already defined in StoryTestProgect.cpp.obj <br> 1&gt;UE4-StoryGraphPluginRuntime.lib(Module.StoryGraphPluginRuntime.cpp.obj) : error LNK2005: "void * __cdecl operator new[](unsigned __int64,struct std::nothrow_t const &amp;)" (??_U@YAPEAX_KAEBUnothrow_t@std@@@Z) already defined in StoryTestProgect.cpp.obj <br> 1&gt;UE4-StoryGraphPluginRuntime.lib(Module.StoryGraphPluginRuntime.cpp.obj) : error LNK2005: "void __cdecl operator delete[](void *)" (??_V@YAXPEAX@Z) already defined in StoryTestProgect.cpp.obj <br> 1&gt;UE4-StoryGraphPluginRuntime.lib(Module.StoryGraphPluginRuntime.cpp.obj) : error LNK2005: "void __cdecl operator delete[](void *,struct std::nothrow_t const &amp;)" (??_V@YAXPEAXAEBUnothrow_t@std@@@Z) already defined in StoryTestProgect.cpp.obj <br> 1&gt;UE4-StoryGraphPluginRuntime.lib(Module.StoryGraphPluginRuntime.cpp.obj) : error LNK2005: "void __cdecl UELinkerFixupCheat(void)" (?UELinkerFixupCheat@@YAXXZ) already defined in StoryTestProgect.cpp.obj <br> 1&gt;UE4-StoryGraphPluginRuntime.lib(Module.StoryGraphPluginRuntime.cpp.obj) : error LNK2005: "bool const GIsDebugGame" (?GIsDebugGame@@3_NB) already defined in StoryTestProgect.cpp.obj <br> 1&gt;UE4-StoryGraphPluginRuntime.lib(Module.StoryGraphPluginRuntime.cpp.obj) : error LNK2005: "class FFixedUObjectArray * &amp; GObjectArrayForDebugVisualizers" (?GObjectArrayForDebugVisualizers@@3AEAPEAVFFixedUObjectArray@@EA) already defined in StoryTestProgect.cpp.obj <br> 1&gt;UE4-StoryGraphPluginRuntime.lib(Module.StoryGraphPluginRuntime.cpp.obj) : error LNK2005: "bool GIsGameAgnosticExe" (?GIsGameAgnosticExe@@3_NA) already defined in StoryTestProgect.cpp.obj <br> 1&gt;UE4-StoryGraphPluginRuntime.lib(Module.StoryGraphPluginRuntime.cpp.obj) : error LNK2005: "wchar_t * GInternalGameName" (?GInternalGameName@@3PA_WA) already defined in StoryTestProgect.cpp.obj <br> 1&gt;UE4-StoryGraphPluginRuntime.lib(Module.StoryGraphPluginRuntime.cpp.obj) : error LNK2005: "wchar_t const * const GForeignEngineDir" (?GForeignEngineDir@@3PEB_WEB) already defined in StoryTestProgect.cpp.obj <br> 1&gt;UE4-StoryGraphPluginRuntime.lib(Module.StoryGraphPluginRuntime.cpp.obj) : error LNK2005: "struct FNameEntry * * * GFNameTableForDebuggerVisualizers_MT" (?GFNameTableForDebuggerVisualizers_MT@@3PEAPEAPEAUFNameEntry@@EA) already defined in StoryTestProgect.cpp.obj</code> <br> </div></div><br>  I didn‚Äôt understand where these errors came from, it turned out everything just had to be replaced in StoryGraphPluginRuntime.cpp <br><br>  This: <br><br><pre> <code class="cpp hljs">IMPLEMENT_PRIMARY_GAME_MODULE(FStoryGraphPluginRuntime, StoryGraphPluginRuntime, <span class="hljs-string"><span class="hljs-string">"StoryGraphPluginRuntime"</span></span>);</code> </pre> <br>  On this: <br><br><pre> <code class="cpp hljs">IMPLEMENT_MODULE(FStoryGraphPluginRuntime, StoryGraphPluginRuntime);</code> </pre> <br>  And it all worked.  But after that I wanted to compile the plugin in Shipping mode and then again errors got in, I unfortunately did not save them, but their essence was that I didn‚Äôt put ";"  and the compiler pointed to the files of the engine itself.  In general, everything turned out again just.  To output the log, you need to declare a new category. <br><br><pre> <code class="cpp hljs">DECLARE_LOG_CATEGORY_EXTERN(StoryGraphPluginRuntime, All, All) DEFINE_LOG_CATEGORY(StoryGraphPluginRuntime)</code> </pre> <br><br>  But in the Development and Development Editor mode everything works without a semicolon, but in the Shipping mode you need to write like this: <br><br><pre> <code class="cpp hljs">DECLARE_LOG_CATEGORY_EXTERN(StoryGraphPluginRuntime, All, All); DEFINE_LOG_CATEGORY(StoryGraphPluginRuntime);</code> </pre> <br>  And all this is aggravated by the fact that the compiler, in case of an error, does not refer to these lines, but in general to the engine library. <br><br>  That's all <br><br>  ‚Üí <a href="https://github.com/Deema35/StoryGraph">Here are the sources</a> <br>  ‚Üí <a href="https://cloud.mail.ru/public/J6Y2/gPCyFRBPG">Link to demo</a> <br><br>  As well as a link to a previous article: <a href="https://habrahabr.ru/post/318366/">Creating an editor of quests and dialogues for the Unreal engine: Part 1 plugin description</a> </div><p>Source: <a href="https://habr.com/ru/post/318386/">https://habr.com/ru/post/318386/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318372/index.html">VulnHub: Parsing the DC416 by Dick Dastardly</a></li>
<li><a href="../318374/index.html">Competitiveness: Parallelism</a></li>
<li><a href="../318376/index.html">Console to the masses. Go to the bright side. Part two</a></li>
<li><a href="../318380/index.html">Family business in IT. How we sold our startup</a></li>
<li><a href="../318384/index.html">Experience in porting a project to Python 3</a></li>
<li><a href="../318388/index.html">Backup network spheres (samba) in Linux based on Windows Server Backup</a></li>
<li><a href="../318390/index.html">How to talk with assholes. 7 strategies for communicating with inappropriate people</a></li>
<li><a href="../318392/index.html">The digest of interesting materials for the mobile # 185 developer (December 19-25)</a></li>
<li><a href="../318394/index.html">Camouflage and video game feedback</a></li>
<li><a href="../318396/index.html">Prefer SRW-blocking to critical sections.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>