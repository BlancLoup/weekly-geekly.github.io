<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create a custom filter for the list in SharePoint 2010</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will consistently describe all the steps required to write a universal filter that allows you to select from standard SharePoint lists (i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create a custom filter for the list in SharePoint 2010</h1><div class="post__text post__text-html js-mediator-article">  This article will consistently describe all the steps required to write a universal filter that allows you to select from standard <b>SharePoint</b> lists (inheritors from <b>XsltListWebPart</b> or <b>ListWebPart</b> ). <br><br>  Development was conducted on <b>VisualStudio 2010</b> , which can work only with <b>SharePoint 2010</b> , so everything described below was tested on the <b>SharePoint Foundation 2010</b> platform, however, most likely, everything will be true for <b>SharePoint 2007</b> ( <b>WSS 3.0</b> ). <br><a name="habracut"></a><br>  I will not describe the process of installing and deploying the development environment - it is easy to search on the Internet, but I have not found good examples to understand how to filter standard lists. <br><br>  So, the minimum task: Create a <b>WebPart</b> , which could filter the list of <b>Shared Documents</b> approximately like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <a href=""><img alt="image" height="328" src="https://habrastorage.org/getpro/habr/post_images/f6f/a23/dd2/f6fa23dd250aba1295bb97d621e9fe9d.png" title="image" width="897"></a> <br><br>  Those.  You can choose one of the available list fields (not only from the number of visible ones), specify one of the possible comparison operators (equal, not equal, greater, less, etc.) and the actual value.  When you click on the <b>Go</b> button - the contents of the list must satisfy our condition. <br><br>  Consider for a start how generally in <b>SharePoint</b> 'e <b>WebPart</b> ' s can interact with each other.  The standard method of interaction between two or more <b>WebParts</b> ' s is the so-called <b>Provider</b> - <b>Consumer</b> mechanism. <br><br>  At the beginning of a certain interface is determined through which communication will be carried out. <br><br>  <b>Interface example</b> <br><blockquote><code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">interface</font> ITextBoxString <br> { <br> <font color="#0000ff">string</font> TextBoxString { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> } <br></font> <br></code> </blockquote><br>  <b>Consumer</b> publishes the so-called entry points (in fact, these are methods that take an interface as a parameter and are marked with the <b>ConnectionConsumer</b> attribute). <br><br>  <b>Consumer example</b> <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> StringConsumer : WebPart <br> { <br> <font color="#0000ff">private</font> ITextBoxString _myProvider; <br> <font color="#0000ff">private</font> Label _myLabel; <br> <br> <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnPreRender( <font color="#2B91AF">EventArgs</font> e) <br> { <br> EnsureChildControls(); <br> <font color="#0000ff">if</font> (_myProvider != <font color="#0000ff">null</font> ) <br> _myLabel.Text = _myProvider.TextBoxString; <br> } <br> <br> <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> CreateChildControls() <br> { <br> Controls.Clear(); <br> _myLabel = <font color="#0000ff">new</font> Label{Text = <font color="#A31515">"Default text"</font> }; <br> Controls.Add(_myLabel); <br> } <br> <br> [ConnectionConsumer( <font color="#A31515">"String Consumer"</font> , <font color="#A31515">"StringConsumer"</font> )] <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> TextBoxStringConsumer(ITextBoxString provider) <br> { <br> _myProvider = provider; <br> } <br> } <br></font> <br></code> </blockquote><br>  <b>Provider</b> publishes outgoing points (methods that return an interface and are marked with the <b>ConnectionProvider</b> attribute). <br><br>  <b>Provider Example</b> <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> StringProvider : WebPart, ITextBoxString <br> { <br> <font color="#0000ff">private</font> TextBox _myTextBox; <br> <br> [Personalizable] <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> TextBoxString { <font color="#0000ff">get</font> { <font color="#0000ff">return</font> _myTextBox.Text; } <font color="#0000ff">set</font> { _myTextBox.Text = <font color="#0000ff">value</font> ; } } <br> <br> <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> CreateChildControls() <br> { <br> Controls.Clear(); <br> _myTextBox = <font color="#0000ff">new</font> TextBox(); <br> Controls.Add(_myTextBox); <br> Controls.Add( <font color="#0000ff">new</font> Button {Text = <font color="#A31515">"Change Text"</font> }); <br> } <br> <br> [ConnectionProvider( <font color="#A31515">"Provider for String From TextBox"</font> , <font color="#A31515">"TextBoxStringProvider"</font> )] <br> <font color="#0000ff">public</font> ITextBoxString TextBoxStringProvider() <br> { <br> <font color="#0000ff">return</font> <font color="#0000ff">this</font> ; <br> } <br> }</font> <br></code> </blockquote><br>  Communication can be established if the interfaces at the <b>Provider</b> and <b>Consumer</b> communication points match.  At the same time, after placing the corresponding WebPart's on the page, they can be linked together by selecting one of the <b>WebPart</b> 's in the <b>Connection</b> menu item.  After the connection is established - after each update (rendering) of the page, the <b>Provider</b> method will be called first ( <b>TextBoxStringProvider</b> ) to get the interface and the result will be passed to the <b>Consumer</b> method ( <b>TextBoxStringConsumer</b> ).  In principle, everything is simple.  This academic example is even described in MSDN. <br><br>  However, we need to write our own provider to a predefined <b>consumer</b> , namely <b>WebPart</b> , inherited from <b>XsltListWebPart</b> or <b>ListWebPart</b> .  To do this, we need to know which communication interfaces they support and how we can work with them.  This information, oddly enough, on the Internet is extremely small.  As in principle, there are few solutions that solve this problem (I found two commercial projects ( <a href="http://www.kwizcom.com/sharepoint-add-ons/sharepoint-list-filter-plus/overview/">KWizCom List Filter Plus</a> and <a href="http://roxority.com/filterzen/">Roxority FilterZen Filter</a> ) and not one with open source). <br><br>  The painstaking analysis and reverse engineering showed that there are two interfaces to which you can connect: <a href="http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.webpartpages.itransformablefiltervalues_members.aspx"><b>ITransformableFilterValues</b></a> and <b><a href="http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.webparts.iwebpartparameters.aspx">IWebPartParameters</a></b> . <br><br>  Using the first <a href="http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.webpartpages.itransformablefiltervalues_members.aspx"><b>ITransformableFilterValues</b></a> interface, <a href="http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.webpartpages.itransformablefiltervalues_members.aspx"><b>you</b></a> can select only one list field (possibly several, but, I didn‚Äôt find it at random), selected when establishing a connection between our provider and the list and only according to the full compliance of the field value with the filtered value (t. e. you can only implement the operation "equal").  Thus, this path does not suit us. <br><br>  The second interface <a href="http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.webparts.iwebpartparameters.aspx"><b>IWebPartParameters is</b></a> interesting because, firstly, it makes it easy to get a list of all the list fields: <br><br>  <b>IWebPartParameters</b> <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">void</font> SetConsumerSchema(PropertyDescriptorCollection schema) <br> { <br> Owner.Parameters = schema; <br> } <br></font> <br></code> </blockquote><br>  And secondly, it does not require indication of which / which fields are filtered.  In the <b>GetParametersData</b> method, the <b>dictionary is</b> transmitted with pairs of the field name - the value for the selection: <br><br>  <b>IWebPartParameters</b> <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">void</font> GetParametersData(ParametersCallback callback) <br> { <br> <font color="#0000ff">var</font> objParameters = <font color="#0000ff">new</font> StateBag(); <br> <font color="#0000ff">if</font> (Owner._searchBox != <font color="#0000ff">null</font> &amp;&amp; ! <font color="#0000ff">string</font> .IsNullOrEmpty(Owner._searchBox.Text)) <br> { <br> objParameters.Add(Owner._comboBox.SelectedItem.Value, Owner._searchBox.Text); <br> } <br> callback(objParameters); <br> }</font> <br></code> </blockquote><br>  Moreover, the filter installed in this way is similar to the filter for the columns made manually by the user (the columns will even be highlighted with a filter icon indicating that a selection has been made for this floor).  But, alas, this method does not suit us either, because  allows you to select data only on strict equality of the selection parameters. <br><br>  What to do?  It turns out that another <b>WebPart</b> can be influenced in another way - simply by changing the parameters of this <b>WebPart</b> 'at a suitable point in time (before selection). <br><br>  The appropriate time point is the <b>OnLoad</b> event - which is triggered after the page loads, but before the data is selected.  The variable parameter will be the Xml description of the list, which is stored in the <b>XmlDefinition</b> property for <b>XlstListWebPart</b> and <b>ListViewXml</b> for <b>ListWebPart</b> .  This Xml-description, among other things, has a CAML-request, for the selection of data in which you can insert the necessary conditions: <br><br>  <b>Code Sample</b> <br><blockquote> <code><font color="black"><font color="#0000ff">private</font> <font color="#0000ff">string</font> CreateQuery() <br> { <br> <font color="#0000ff">if</font> (_searchBox != <font color="#0000ff">null</font> &amp;&amp; ! <font color="#0000ff">string</font> .IsNullOrEmpty(_searchBox.Text)) <br> <font color="#0000ff">return</font> <font color="#2B91AF">String</font> .Format( <font color="#A31515">"&lt;{1}&gt;&lt;FieldRef Name='{0}'/&gt;&lt;Value Type='Text'&gt;{2}&lt;/Value&gt;&lt;/{1}&gt;"</font> , <br> _comboBox.SelectedItem.Value, _searchType.SelectedItem.Value, _searchBox.Text); <br> <font color="#0000ff">else</font> <br> <font color="#0000ff">return</font> <font color="#A31515">""</font> ; <br> } <br> <br> <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnLoad( <font color="#2B91AF">EventArgs</font> e) <br> { <br> <font color="#0000ff">base</font> .OnLoad(e); <br> <br> <font color="#0000ff">var</font> query = CreateQuery(); <br> <font color="#0000ff">if</font> (query == <font color="#A31515">""</font> ) <font color="#0000ff">return</font> ; <br> <font color="#0000ff">var</font> part = WebPartManager.WebParts[0] <font color="#0000ff">as</font> XsltListViewWebPart; <br> <font color="#0000ff">if</font> (part == <font color="#0000ff">null</font> ) <font color="#0000ff">return</font> ; <br> <br> <font color="#0000ff">var</font> doc = <font color="#0000ff">new</font> <font color="#2B91AF">XmlDocument</font> (); <br> doc.LoadXml(part.XmlDefinition); <br> <font color="#0000ff">var</font> queryNode = doc.SelectSingleNode( <font color="#A31515">"//Query"</font> ); <br> <font color="#0000ff">if</font> (queryNode == <font color="#0000ff">null</font> ) <font color="#0000ff">return</font> ; <br> <br> <font color="#0000ff">var</font> whereNode = queryNode.SelectSingleNode( <font color="#A31515">"Where"</font> ); <br> <font color="#0000ff">if</font> (whereNode != <font color="#0000ff">null</font> ) queryNode.RemoveChild(whereNode); <br> <br> <font color="#0000ff">var</font> newNode = doc.CreateNode( <font color="#2B91AF">XmlNodeType</font> .Element, <font color="#A31515">"Where"</font> , <font color="#2B91AF">String</font> .Empty); <br> newNode.InnerXml = query; <br> queryNode.AppendChild(newNode); <br> part.XmlDefinition = doc.OuterXml; <br> } <br></font> <br></code> </blockquote><br><br>  <font color="gray"><i>That's basically what you can push off from for further development.</i></font>  <font color="gray"><i>Wrote an article for yourself as a memo, so as not to forget.</i></font>  <font color="gray"><i>I hope someone will find it useful too.</i></font> <font color="gray"><br></font> </div><p>Source: <a href="https://habr.com/ru/post/139963/">https://habr.com/ru/post/139963/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../139953/index.html">FON - free Wi-Fi worldwide</a></li>
<li><a href="../139955/index.html">How I stopped storing FTP passwords in FAR</a></li>
<li><a href="../139956/index.html">5th Kiev Habravstrecha</a></li>
<li><a href="../139961/index.html">Cheats for those who make the first steps</a></li>
<li><a href="../139962/index.html">Introductory Captions from Star Wars on JS + CSS3</a></li>
<li><a href="../139964/index.html">Twitter Kung Fu with SilverBird</a></li>
<li><a href="../139968/index.html">Nginx - we leave for technical work</a></li>
<li><a href="../139969/index.html">Crossbrowser CSS</a></li>
<li><a href="../139970/index.html">Fast image compression using JPEG for CUDA</a></li>
<li><a href="../139971/index.html">How was the Moscow Django Meetup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>