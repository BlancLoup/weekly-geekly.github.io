<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>URL.js or friends with javascript handling links</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, dear habravchane! 

 Today I faced the task of generating GET parameters and the entire URL as a whole, on the client side, right here right...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>URL.js or friends with javascript handling links</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/ea3/004/0e2/ea30040e255b446291b265872f748352.jpg" alt="image"><br><br>  Good day, dear habravchane! <br><br>  Today I faced the task of generating GET parameters and the entire URL as a whole, on the client side, right here right now, without the ability to "talk" with the server.  Immediately make a reservation, I learned about <a href="http://habrahabr.ru/post/65407/">this</a> post right before writing this article because I first finished writing and then resorted to searching, and that post is not with everything about the same thing that I have. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, to the point. <br><br><h4>  Challenge and problems </h4><br>  The problems are the same as in the post that I mentioned above: <br><ul><li> The inability to use <code>window.location</code> to "cook" the URL; </li><li>  You cannot work with several <code>window.location</code> at once due to browser security policy; </li><li>  The absence of known ready-made solutions (and even now, already aposlya, I have not found such code) </li></ul><br>  Tasks that I set for myself: <br><ul><li>  Convenient syntax </li><li>  The ability to both read parts of the URL and change them </li><li>  Work with GET-parameters </li><li>  Cross-browser compatibility and versatility </li></ul><br><br>  I wrote in the cleanest JavaScript, and without using <code>prototype.__defineGetter__</code> or <code>prototype.__defineSetter__</code> in favor of cross-browser compatibility, because IE &lt;9 cannot do this.  More details about getters / setters are written in <a href="http://habrahabr.ru/post/66242/">this</a> post. <br><br>  For those who are interested, we will sort it out, and who needs a ready-made solution - you are welcome to the end of the post, the download links are there. <br><br>  Let's get started!  <s>Before we sit down - we will leave earlier.</s> <br><a name="habracut"></a><br><br><h4>  Constructor </h4><br><div class="spoiler">  <b class="spoiler_title">Constructor code</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> URL = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> param, param2 </span></span></span><span class="hljs-function">)</span></span>{ param = param || <span class="hljs-literal"><span class="hljs-literal">false</span></span>; param2 = ( param2 === <span class="hljs-literal"><span class="hljs-literal">false</span></span> ) ? <span class="hljs-literal"><span class="hljs-literal">false</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.urlEncode = param2; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data = { <span class="hljs-attr"><span class="hljs-attr">scheme</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">user</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">pass</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">host</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">port</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">query</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">params</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">fragment</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(param) == <span class="hljs-string"><span class="hljs-string">'string'</span></span> ){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url = param; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.parse(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(param) == <span class="hljs-string"><span class="hljs-string">'object'</span></span> ){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> param){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.hasOwnProperty( key ) ){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( param[ key ] || ( key == <span class="hljs-string"><span class="hljs-string">'params'</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(param.params) == <span class="hljs-string"><span class="hljs-string">'object'</span></span> ) ) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data[ key ] = param[ key ]; } } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.update(); } }</code> </pre><br></div></div><br><h5>  Read more </h5><br><ul><li>  As I said before, universality is needed.  Those.  the ability to both work with incomplete URLs, and generally create them from scratch, and therefore we can both transfer the source URL to the constructor, transfer the hash with the necessary parameters, or not, transfer anything to it. </li><li>  All url parameters are stored in a hash (in JS it is just an object with parameters), this is related to getters / setters about which a little later.  They are named in the <code>parse_url()</code> style of PHP, so it‚Äôs easier for me to do so. </li></ul><br><br><h4>  Parsing </h4><br>  It is necessary to parse the existing URL, we will do this with the help of <code>RegExp</code> .  No, you can of course handle everything with <code>str.split()</code> , but this, I think, is a special kind of fetishism. <br><pre> <code class="javascript hljs">regExp = <span class="hljs-regexp"><span class="hljs-regexp">/^(?:([a-z0-9_\-\.]+):\/\/)*(?:([a-z0-9_\-\.]+)(?:\:)*([a-z0-9_\-\.]+)*\@)*([a-z0-9][a-z0-9_\-\.]+)(?:\:([\d]+))*(?:\/([^?#]*))*(?:\?([^?#]*))*(?:\#([^?#]*))*/gi</span></span>;</code> </pre><br><div class="spoiler">  <b class="spoiler_title">And in parts</b> <div class="spoiler_text"><ul><li>  <b><code>(?:([a-z0-9_\-\.]+):\/\/)*</code></b> - SCHEME, if you believe <a href="http://en.wikipedia.org/wiki/URI_scheme">Wikipedia</a> , the scheme has the form <code>://</code> and, there may be <code>-</code> and <code>_</code> .  For the sake of universality, it is installed * i.  scheme may not be specified. </li><li>  <b><code>(?:([a-z0-9_\-\.]+)(?:\:)*([a-z0-9_\-\.]+)*\@)*</code></b> - USER: PASSWORD, password without username does not happen, and username without a password happens. </li><li>  <code>([a-z0-9][a-z0-9_\-\.]+)</code> - HOST, as far as I know, a domain name can begin only with a letter / number, and then both - and _ and can go.  Moreover, there are no domain names shorter than 6 characters, but after all, links are also intranet, where you want to drive as hostnames, the one that comes down and 1+ symbol. </li><li>  <b><code>(?:\:([\d]+))*</code></b> - PORT, this parameter is optional,: and then digits </li><li>  <b><code>(?:\/([^?#]*))*</code></b> - PATH, the path to the file, in general, in theory, is any number of any characters, but we cut it?  and # in order not to parse GET parameters or a fragmentary pointer into the path.  The path may be unspecified. </li><li>  <b><code>(?:\?([^?#]*))*</code></b> - QUERY, set of GET parameters, key = value pairs.  It may also not be specified. </li><li>  <b><code>(?:\#([^?#]*))*</code></b> - FRAGMENT, fragmentary pointer.  If anyone does not know, then <code>/index.html#fragment</code> tells the browser to scroll to a DOM element with <code>id="fragment"</code> </li></ul><br></div></div><br>  Of course, it will work in all languages ‚Äã‚Äãthat understand RegExp.  Use, do not hesitate. <br><br><div class="spoiler">  <b class="spoiler_title">Parser</b> <div class="spoiler_text"><pre> <code class="javascript hljs"> parse: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.res = <span class="hljs-regexp"><span class="hljs-regexp">/^(?:([a-z0-9_\-\.]+):\/\/)*(?:([a-z0-9_\-\.]+)(?:\:)*([a-z0-9_\-\.]+)*\@)*([a-z0-9][a-z0-9_\-\.]+)(?:\:([\d]+))*(?:\/([^?#]*))*(?:\?([^?#]*))*(?:\#([^?#]*))*/gi</span></span>.exec( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.scheme = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.res[ <span class="hljs-number"><span class="hljs-number">1</span></span> ] || <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.user = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.res[ <span class="hljs-number"><span class="hljs-number">2</span></span> ] || <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.pass = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.res[ <span class="hljs-number"><span class="hljs-number">3</span></span> ] || <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.host = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.res[ <span class="hljs-number"><span class="hljs-number">4</span></span> ] || <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.port = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.res[ <span class="hljs-number"><span class="hljs-number">5</span></span> ] || <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.path = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.res[ <span class="hljs-number"><span class="hljs-number">6</span></span> ] || <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.query = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.res[ <span class="hljs-number"><span class="hljs-number">7</span></span> ] || <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.fragment = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.res[ <span class="hljs-number"><span class="hljs-number">8</span></span> ] || <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.query ){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.parts = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.query.split( <span class="hljs-string"><span class="hljs-string">'&amp;'</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.parts.length; i++ ){ param = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.parts[ i ].split( <span class="hljs-string"><span class="hljs-string">'='</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.params[ param[ <span class="hljs-number"><span class="hljs-number">0</span></span> ] ] = <span class="hljs-built_in"><span class="hljs-built_in">decodeURIComponent</span></span>( param[ <span class="hljs-number"><span class="hljs-number">1</span></span> ] ); } } <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.res; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.parts; }</code> </pre><br></div></div><br>  Nothing <code>regExp</code> : splitting the <code>regExp</code> above and saving the data to <code>this.data</code> hash <br>  Unless, I mentioned earlier - convenient work with GET-parameters of the url is necessary, and therefore we split the query with the help of split (split () in this case ‚Äúcheaper‚Äù than <code>regExp</code> ) and save it to the same notorious hash.  It is worth noting the use of decodeURIComponent, because GET-parameters can be urlencoded. <br><br><h4>  <b>Option 1. "Beauty"</b> </h4><br><h4>  Getters / setters </h4><br>  For convenient work with reading / changing parameters, I decided to choose JS way getters and setters.  Te method by property name and if the method is called with the parameter specified, this is setter, if without a parameter it is getter. <br>  I will <code>URL.prototype = { }</code> them through the <code>URL.prototype = { }</code> so as not to produce redundant instances of the method in memory. <br>  I will give one method as an example, because they are similar: <br><pre> <code class="javascript hljs"> scheme: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> param </span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>( param ) != <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> ){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.scheme = param; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.update(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.scheme ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.scheme : <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }</code> </pre><br>  I note that in the case of a change in the value, it is not <code>String</code> that is returned, but <code>Object</code> done so that you can write the setter chains: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URL(); url.scheme(<span class="hljs-string"><span class="hljs-string">'https'</span></span>).host(<span class="hljs-string"><span class="hljs-string">'example.com'</span></span>).path(<span class="hljs-string"><span class="hljs-string">'index.php'</span></span>).params({<span class="hljs-string"><span class="hljs-string">'p1'</span></span>:<span class="hljs-string"><span class="hljs-string">"v1"</span></span>, <span class="hljs-string"><span class="hljs-string">'p2'</span></span>:<span class="hljs-string"><span class="hljs-string">"2"</span></span>}).url; <span class="hljs-comment"><span class="hljs-comment">// : https://example.com/index.php?p1=v1&amp;p2=%D0%B22</span></span></code> </pre><br><br>  Separately dwell on the getter / setter for the <code>params</code> property <br><pre> <code class="javascript hljs"> params: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> param1, param2 </span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>( param1 ) != <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> ){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>( param1 ) == <span class="hljs-string"><span class="hljs-string">'string'</span></span> ){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>( param2 ) != <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> &amp;&amp; ( param2 == <span class="hljs-string"><span class="hljs-string">''</span></span> || param2 === <span class="hljs-literal"><span class="hljs-literal">false</span></span> ) ){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.params.hasOwnProperty( param1 ) ){ <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.params[ param1 ]; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>( param2 ) != <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> ){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.params[ param1 ] = param2; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.params[ param1 ] ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.params[ param1 ] : <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>( param1 ) == <span class="hljs-string"><span class="hljs-string">'object'</span></span> ){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> param1 ){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>( param1[ key ] ) != <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> &amp;&amp; ( param1[ key ] == <span class="hljs-string"><span class="hljs-string">''</span></span> || param1[ key ] === <span class="hljs-literal"><span class="hljs-literal">false</span></span> ) ){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.params.hasOwnProperty( key ) ) <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.params[ key ]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.params[ key ] = param1[ key ]; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.update(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.params ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.params : <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }</code> </pre><br>  As you can see, both parameters are optional. <br>  And as I said - I set myself the goal - the convenience of working with GET-parameters, which means we should be able to: <br><ul><li>  To read </li><li>  Change </li><li>  Delete </li></ul><br>  both a single parameter and a group of parameters. <br><br>  Accordingly, the syntax will be as follows: <br><ul><li>  No <u>parameter</u> is passed - we read all GET parameters </li><li>  <u>Only the first parameter</u> is passed - we read one GET parameter. </li><li>  <u>Two parameters</u> are passed - we write a GET parameter with the name <code>param1</code> and the value <code>param2</code> </li><li>  An <u>empty value is passed</u> as a <u>parameter value or <code>false</code></u> ‚Äî the specified GET parameter is deleted. </li></ul><br><br><h4>  Putting the URL back </h4><br>  As you noticed, <code>this.update()</code> calls 2 functions in getters: <br><ul><li>  Putting the URL together in the url property </li><li>  Updates the <code>query</code> property when manipulating GET parameters </li></ul><br><div class="spoiler">  <b class="spoiler_title">Code collector</b> <div class="spoiler_text"><pre> <code class="javascript hljs"> update: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.query = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.params ){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.query += <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.urlEncode ? key+<span class="hljs-string"><span class="hljs-string">'='</span></span>+<span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.params[ key ] )+<span class="hljs-string"><span class="hljs-string">'&amp;'</span></span> : key+<span class="hljs-string"><span class="hljs-string">'='</span></span>+<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.params[ key ]+<span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.query ) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.query = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.query.slice( <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url += <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.scheme ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.scheme+<span class="hljs-string"><span class="hljs-string">'://'</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url += <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.user ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.user+<span class="hljs-string"><span class="hljs-string">':'</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url += <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.pass ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.pass+<span class="hljs-string"><span class="hljs-string">'@'</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url += <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.host ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.host+<span class="hljs-string"><span class="hljs-string">'/'</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url += <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.path ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.path : <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url += <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.query ? <span class="hljs-string"><span class="hljs-string">'?'</span></span>+<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.query : <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url += <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.fragment ? <span class="hljs-string"><span class="hljs-string">'#'</span></span>+<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.fragment : <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }</code> </pre><br></div></div><br>  It is worth noting that when assembling GET parameters, the values ‚Äã‚Äãof the parameters are converted to escape sequence. <br>  <u>First:</u> it is right. <br>  <u>Secondly:</u> if we receive data entered by the user with the GET-parameter, then the ampersand inserted by the user will destroy the key-value sequence and everything will roll into the map. <br><br>  Well, if so, straight from the nose, you do not need a urlencoded line - you have two options: <br>  Pass in the <u>second parameter</u> in the constructor <u>false</u> <br><ol><li>  Manually set the <code>URL.urlEncode=false;</code> property. <code>URL.urlEncode=false;</code> </li><li>  Call the <code>URL.update();</code> method <code>URL.update();</code> </li></ol><br><pre> <code class="javascript hljs">test = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URL({<span class="hljs-string"><span class="hljs-string">"path"</span></span>:<span class="hljs-string"><span class="hljs-string">"index.php"</span></span>, <span class="hljs-string"><span class="hljs-string">"params"</span></span>:{<span class="hljs-string"><span class="hljs-string">"param1"</span></span>:<span class="hljs-string"><span class="hljs-string">"value1"</span></span>, <span class="hljs-string"><span class="hljs-string">"param2"</span></span>:<span class="hljs-string"><span class="hljs-string">" &amp;"</span></span>}}, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); test.url; <span class="hljs-comment"><span class="hljs-comment">//index.php?param1=value1¬∂m2= &amp; test2 = new URL({"path":"index.php", "params":{"param1":"value1", "param2":" &amp;"}}); test2.url; //index.php?param1=value1¬∂m2=%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D0%B0%26 test2.urlEncode=false; test2.update().url; //index.php?param1=value1¬∂m2= &amp;</span></span></code> </pre><br><br>  Well, and so it was convenient - a method for clicking on the generated link: <br><pre> <code class="javascript hljs"> go: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.scheme &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.host) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.scheme = <span class="hljs-string"><span class="hljs-string">'http'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.href = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.update().url; }</code> </pre><br>  As you can see: if the scheme is not specified, but the host is specified, the <code>http</code> scheme is automatically substituted as the most common. <br>  Next, the link is updated and followed. <br><br><h4>  Extend the String object </h4><br>  In theory, this could be finished.  But, it seemed to me that it would be convenient to work directly with string variables without explicitly creating an object instance (no matter how strange it sounds, but, in JS, there are no classes as such). <br><br>  As usual I will give an example of one method: <br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.prototype.scheme = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> param </span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URL( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.valueOf() ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>( param ) != <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> ){ url.scheme( param ); result = url.url; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ result = url.scheme(); } <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> url; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre><br>  In general, the code simply passes the parameters to the appropriate method of the URL object. <br>  But it may seem strange to some that I create and delete every call to URL objects and do only one action, and this action does not change the value of the variable it is being performed on. <br>  This is where the most important inconvenience of the <code>String</code> object lies, it is impossible to change the value of an existing variable.  With it nothing can be done at all, <u>ALWAYS</u> creates a new variable.  That is why every time a new object is created and a variable of the <code>String</code> type is returned. <br>  Chains are of course supported: <br><pre> <code class="javascript hljs">url = <span class="hljs-string"><span class="hljs-string">'example.com'</span></span>; url.scheme(<span class="hljs-string"><span class="hljs-string">'https'</span></span>).path(<span class="hljs-string"><span class="hljs-string">'index.php'</span></span>).params({<span class="hljs-string"><span class="hljs-string">'p1'</span></span>:<span class="hljs-string"><span class="hljs-string">"v1"</span></span>, <span class="hljs-string"><span class="hljs-string">'p2'</span></span>:<span class="hljs-string"><span class="hljs-string">"2"</span></span>}); <span class="hljs-comment"><span class="hljs-comment">// : https://example.com/index.php?p1=v1&amp;p2=%D0%B22</span></span></code> </pre><br><br><h4>  <b>Option 2. "By Feng Shui"</b> </h4><br>  If the previous version, let's say, was ‚Äúbeautiful‚Äù to use, then this option would be concise.  both in terms of code and in terms of use. <br><br><h4>  Getters / setters </h4><br>  So, getter / setter in this case will be one for everything, well, that is, quite. <br><pre> <code class="javascript hljs"> val: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> key, param, param2 </span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data.hasOwnProperty( key ) ){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>( param ) == <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> ){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data[ key ] ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data[ key ] : <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>( param ) != <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> ){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( key == <span class="hljs-string"><span class="hljs-string">'params'</span></span> ){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>( param ) == <span class="hljs-string"><span class="hljs-string">'string'</span></span> ){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>( param2 ) != <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> ){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data[ key ][ param ] = param2; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data[ key ][ param ] ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data[ key ][ param ] : <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>( param ) == <span class="hljs-string"><span class="hljs-string">'object'</span></span> ){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keys <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> param ){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>( param[ keys ] ) != <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> &amp;&amp; ( param[ keys ] == <span class="hljs-string"><span class="hljs-string">''</span></span> || param[ keys ] === <span class="hljs-literal"><span class="hljs-literal">false</span></span> ) ){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data[ key ].hasOwnProperty( keys ) ){ <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data[ key ][ keys ]; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data[ key ][ keys ] = param[ keys ]; } } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data[ key ] = param; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.update(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>; }</code> </pre><br><br><h4>  Extend the String object </h4><br>  The situation is identical with the extension of the <code>String</code> object, only the code is smaller, since  this method only transports parameters to URL.val (); <br><br><h4>  <b>Summarizing</b> </h4><br>  So, at the exit, we have a lib, which gives us the opportunity to work adequately with the URL, and not only to parse, but also to change individual fate of the URL.  This is not to mention a very convenient, in my opinion, tool for working with GET-parameters. <br><br><h5>  <b>Pros and cons of approaches</b> </h5><br><h6>  <i>Option 1</i> </h6><br>  <u>Pros:</u> <br><ul><li>  Good readability </li><li>  Convenient to use </li></ul><br>  <u>Minuses:</u> <br><ul><li>  8.75kb (without compression and discharge removal) </li><li>  360 lines of code for, in general, a small extension of the functional </li><li>  If I may say so - cumbersome compared with option 2 </li></ul><br><br><h6>  <i>Option 2</i> </h6><br>  <u>Pros:</u> <br><ul><li>  Total 144 lines of code </li><li>  Weight 4.25kb (without compression and removal of discharge) </li><li>  Simplicity and brevity of designs </li></ul><br>  <u>Minuses:</u> <br><ul><li>  A little hard to read </li></ul><br><br>  Download the sources of both options here: [ <a href="https://yadi.sk/d/kLV-QvlFZ3xcA">Option 1</a> ||  <a href="https://yadi.sk/d/FstYPSNHZ3xYi">Option 2</a> ].  I do not see the point of putting it on the githab, for there is only 1 file. <br>  Support: <br><ul><li>  Yes, in general, absolutely everywhere where <code>JavaSript</code> works, because the plugin is written in pure, native JS, without using <code>magic</code> functions that are not supported by older browsers. </li></ul><br><br>  And for this - I will take my leave, sincerely I hope that my post will be of benefit to someone. <br>  All good code, more sleep and that IE does not spoil life. </div><p>Source: <a href="https://habr.com/ru/post/232073/">https://habr.com/ru/post/232073/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../232053/index.html">How to combine business with pleasure (anonymity and privacy) in email</a></li>
<li><a href="../232055/index.html">Java programming training with automated tests</a></li>
<li><a href="../232059/index.html">It's time to grow up: how disappointed I am in crowdfunding</a></li>
<li><a href="../232061/index.html">Communal paradise without worries and troubles</a></li>
<li><a href="../232065/index.html">What hinders the development of electronic document circulation in Russia?</a></li>
<li><a href="../232075/index.html">Stripe announces new decentralized currency Stellar</a></li>
<li><a href="../232079/index.html">SpamAssassin Training</a></li>
<li><a href="../232081/index.html">Writing a simple interpreter in C ++ using TDD, part 2</a></li>
<li><a href="../232083/index.html">How to stop worrying and start shooting panoramas</a></li>
<li><a href="../232085/index.html">Experience using smart glasses Epson Moverio BT-200</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>