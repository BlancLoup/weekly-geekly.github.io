<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ossim. Creating a simple plugin for parsing logs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This material will be useful to novice administrators who are interested in the OSSIM system. 
 The installation of the system has already been descri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ossim. Creating a simple plugin for parsing logs</h1><div class="post__text post__text-html js-mediator-article"><p>  This material will be useful to novice administrators who are interested in the OSSIM system. <br>  The installation of the system has already been described in detail in the <a href="http://habrahabr.ru/post/255433/">Habr√©</a> , so at this moment I will not stop. <br>  The article describes the procedure for writing a plug-in for processing event logs received by the OSSIM system using the syslog protocol from an application running on a remote machine.  It should be noted here that this application is not supported out of the box by OSSIM.  Thus, this instruction is suitable for developing a plug-in for any of your applications that use the syslog protocol to send event logs. <a name="habracut"></a><br>  As a basis, the vendor‚Äôs documents were used: <br>  <a href="https://www.alienvault.com/docs/AlienVault%2520Building%2520Collector%2520Plugins.pdf">Alienvault.</a>  <a href="https://www.alienvault.com/docs/AlienVault%2520Building%2520Collector%2520Plugins.pdf">Building collector plugins</a> <br>  <a href="https://www.alienvault.com/doc-repo/usm/security-intelligence/AlienVault_creating_a_data_source_plugin.pdf">Alienvault.</a>  <a href="https://www.alienvault.com/doc-repo/usm/security-intelligence/AlienVault_creating_a_data_source_plugin.pdf">How to create a data source plugin</a> </p><br><h4>  <b>1. Baseline</b> </h4><br><h5>  <b>1.1 Architecture</b> </h5><br><p>  Server with installed OSSIM (hereinafter - OSSIM Server), having the IP address 192.168.0.111 and the name alienvault. <br>  Server running CentOS 6.6 (hereinafter referred to as Server) with IP address 192.168.0.54 and cnc-2 name.  An application is installed on the Server (let's call it bw_lists by convention), which sends event logs in real time via the syslog protocol to the OSSIM Server. <br>  The application is a modification of the standard shell that filters user-entered commands. </p><br><img src="https://habrastorage.org/files/63c/e41/30c/63ce4130c9234c15ac366e240079a092.jpg"><br><p>  <b>Figure 1</b> - Solution Architecture </p><br><h5>  <b>1.2 Description of the structure of the event</b> </h5><br><p>  Event format: <br>  &lt;syslog date&gt; &lt;host name&gt; bw_lists [&lt;session number&gt;]: user: &lt;user name&gt; ip: &lt;Server IP&gt; ip_tko: &lt;target system IP&gt; IN: &lt;user command executed&gt; OUT: Res: &lt;report execution or failure&gt; &lt;command text&gt; &lt;target system output&gt; <br>  In each event sent by syslog the application includes: <br>  1) user session number (in square brackets immediately after the word bw_lists) <br>  2) the name of the user who executed the command <br>  3) IP addresses of the Server and the target system on which this command should work <br>  4) a command executed by the user (for example, "configure terminal") <br>  5) report on the performance or failure to execute the command given by the user (ACCEPT or DENY) <br>  6) console output (for example, "Enter configuration commands, one per line. End with CNTL / Z") <br>  An example of events received from the application: </p><br><pre><code class="hljs pgsql">Nov <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> cnc<span class="hljs-number"><span class="hljs-number">-2</span></span> bw_lists[<span class="hljs-number"><span class="hljs-number">19025</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>:oper1 ip:<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.54</span></span> ip_tko:<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.104</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>: configure terminal <span class="hljs-keyword"><span class="hljs-keyword">OUT</span></span>: Res: ACCEPT configure terminal Enter <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> commands, one per <span class="hljs-type"><span class="hljs-type">line</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> CNTL/Z. Nov <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span> cnc<span class="hljs-number"><span class="hljs-number">-2</span></span> bw_lists[<span class="hljs-number"><span class="hljs-number">19025</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>:oper1 ip:<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.54</span></span> ip_tko:<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.104</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>: interface Gi0/<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUT</span></span>: Res: ACCEPT interface Gi0/<span class="hljs-number"><span class="hljs-number">1</span></span> ^ % Invalid <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> detected at <span class="hljs-string"><span class="hljs-string">'^'</span></span> marker. Nov <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span> cnc<span class="hljs-number"><span class="hljs-number">-2</span></span> bw_lists[<span class="hljs-number"><span class="hljs-number">19025</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>:oper1 ip:<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.54</span></span> ip_tko:<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.104</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUT</span></span>: Res: ACCEPT <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span></code> </pre> <br><h4>  <b>2. Tasks</b> </h4><br><p>  1) Configure reception of event logs via the syslog protocol from the Server on the OSSIM Server and write them to a file; <br>  2) Configure parsing (parsing) of the received event logs in the OSSIM system.  It is necessary to extract the following information from them: </p><br><ul><li>  user session number (in square brackets immediately after the word ‚Äúbw_lists‚Äù); </li><li>  the name of the user who executed the command (after "user:"); </li><li>  Server IP addresses (after ‚Äúip:‚Äù) and target system (after ‚Äúip_tko:‚Äù), on which this command should work; </li><li>  a command executed by the user (after ‚ÄúIN:‚Äù, for example, ‚Äúconfigure terminal‚Äù); </li><li>  report on the execution or failure to execute the command (after ‚ÄúRes:‚Äù) given by the user (ACCEPT or DENY). </li></ul><br><h4>  <b>3. Decision</b> </h4><br><h5>  <b>3.1 Setting up the OSSIM Server to receive event logs from the Server</b> </h5><br><p>  As part of this task, rsyslog will be configured on the OSSIM server to receive event logs that come from the server using the syslog protocol. <br>  To do this, edit the file /etc/rsyslog.conf and add the line to it: </p><br><pre> <code class="hljs lua"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> $programname contains <span class="hljs-string"><span class="hljs-string">'bw_lists'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> -/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/SR/bw-list-<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> </pre> <br><p>  And restart rsyslog for the changes to take effect: </p><br><pre> <code class="hljs swift">/etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/rsyslog restart</code> </pre> <br><p>  Thus, events received by the OSSIM Server from the Server and containing "bw_lists" will be recorded in the /var/log/SR/bw-list-log.log file.  Next, we configure the parsing of events from this file by OSSIM. </p><br><h5>  <b>3.2 Configuring parsing (parsing) and displaying the received events in OSSIM</b> </h5><br><p>  The process of setting up the analysis of events in OSSIM is divided into two stages: </p><br><ul><li>  creating a configuration file-parser of event logs; </li><li>  adding information about the parser and event type (s) to the OSSIM database; </li><li>  enable plugin. </li></ul><br><p>  The first file is responsible for parsing the log itself and distributing the information received by the fields of the event description scheme used by OSSIM, the second file is used to display the types and classes of events in the OSSIM interface, as well as to prioritize events. <br>  To describe events, OSSIM uses a scheme consisting of several dozen fields, such as: date, sourceIP, destinationIP, username, userdata1-9, etc.  Details of the scheme given in off.  OSSIM documentation. </p><br><h5>  <b>3.2.1 Creating a configuration file-parser for event logs</b> </h5><br><p>  Parser files are located on the OSSIM server in the / etc / ossim / agent / plugins / directory <br>  Create a new file with the name bwlistlog.cfg (the name can be chosen arbitrarily, it doesn‚Äôt affect anything and doesn‚Äôt appear anywhere else. However, the name must match the &lt;alphanumeric combination without spaces&gt; .cfg). <br>  In each file several sections should be allocated (the section names are enclosed in square brackets), namely: </p><br><p>  <b>[DEFAULT]</b> <br>  In this section, the plugin number is present.  According to the recommendation of the vendor, the plugin number should be selected from the range of 9000 - 10000. This number should be unique for this OSSIM installation. <br>  You can find out if the number you chose for the plugin is as follows: <br>  grep "plugin_id = &lt;plugin number&gt;" / etc / ossim / agent / plugins / * <br>  for example </p><br><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> <span class="hljs-string"><span class="hljs-string">"plugin_id=9002"</span></span> /etc/ossim/agent/plugins/*</code> </pre> <br><p>  <b>[config]</b> <br>  This section indicates: </p><br><ul><li>  plugin type; </li><li>  is it on; </li><li>  type of message source; </li><li>  the file in which messages are stored; </li><li>  setting up processes, generating events (this is necessary for plugin'ov monitor type). </li></ul><br><p>  <b>[translation]</b> <br>  In this section, you can set the "translation" of the values ‚Äã‚Äãof certain event fields into numbers.  Further, these numbers can be used to specify classes of events, for clarity in the graphical interface.  For details, see section 3.2.2. </p><br><p>  The last section, called in the example <b>[bwlistlog],</b> is the first message parsing rule.  The names of sections - the rules can be arbitrary format.  It is recommended to set it as follows: [&lt;number&gt; - &lt;source name&gt;], for example [1 - applog], [2 - applog], etc. <br>  The fact is that within the framework of one plugin you can set several rules, i.e.  message parsing schemes.  This is done in order to handle events that have a different structure (if all the events from the source cannot be parsed using the same parsing rule). <br>  If there are several rules, OSSIM compares the message with each of them in turn, and the queue is arranged in alphabetical order.  Example - there are 3 rules with the names [a-rule], [b-rule], [c-rule].  The first to check is compliance with the rule a-rule, then b-rule, etc.  Therefore, it is better to call the more general rules in such a way that they are triggered last in the queue. <br>  Contents of the bwlistlog.cfg file with comments: </p><br><pre> <code class="hljs haskell">[<span class="hljs-type"><span class="hljs-type">DEFAULT</span></span>] #    (  <span class="hljs-type"><span class="hljs-type">OSSIM</span></span> - plugin.) plugin_id=<span class="hljs-number"><span class="hljs-number">9002</span></span> [config] #  plugin'.     - detector  monitor.    syslog   detector <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">=detector #   enable=yes #  . log -  .    database (   ), sdee ( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cisco</span></span></span><span class="hljs-class">), snortlog ( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">snort</span></span></span><span class="hljs-class">), wmi (        </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Windows</span></span></span><span class="hljs-class">   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wmi</span></span></span><span class="hljs-class">) source=log #    ,     . location=/var/log/</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SR</span></span></span><span class="hljs-class">/bw-list-log.log #   </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OSSIM</span></span></span><span class="hljs-class">      .      create_file=true #       -  </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OSSIM</span></span></span><span class="hljs-class">.  ,     </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OSSIM</span></span></span><span class="hljs-class">,    ,    - process= start=no stop=no startup= shutdown= #      ""   [translation] </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ACCEPT</span></span></span><span class="hljs-class">=1 </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DENY</span></span></span><span class="hljs-class">=2 #   (,   , )  . [bwlistlog] #  .    event_type=event #  ,      regexp="^((?</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">P</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">date</span></span></span><span class="hljs-class">&gt;\</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">S</span></span></span><span class="hljs-class">+\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">s</span></span></span><span class="hljs-class">+\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">d</span></span></span><span class="hljs-class">+\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">s</span></span></span><span class="hljs-class">+\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">d</span></span></span><span class="hljs-class">+:\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">d</span></span></span><span class="hljs-class">+:\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">d</span></span></span><span class="hljs-class">+)\s+(?</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">P</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sensor</span></span></span><span class="hljs-class">&gt;\</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">S</span></span></span><span class="hljs-class">+)\s+bw_lists\[(?</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">P</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">session</span></span></span><span class="hljs-class">&gt;\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">d</span></span></span><span class="hljs-class">+)\]\:\s+user\:(?</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">P</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class">&gt;\</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">S</span></span></span><span class="hljs-class">+)\s+ip\:(?</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">P</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sr_node</span></span></span><span class="hljs-class">&gt;\</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">S</span></span></span><span class="hljs-class">+)\s+ip_tko\:(?</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">P</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tko_node</span></span></span><span class="hljs-class">&gt;\</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">S</span></span></span><span class="hljs-class">+)\s+</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IN</span></span></span><span class="hljs-class">\:(?</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">P</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">message</span></span></span><span class="hljs-class">&gt;.*)\s+</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OUT</span></span></span><span class="hljs-class">\:\s+</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Res</span></span></span><span class="hljs-class">\:\s+(?</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">P</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">result</span></span></span><span class="hljs-class">&gt;\</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">S</span></span></span><span class="hljs-class">+).*)" #    ,     ,      </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OSSIM</span></span></span><span class="hljs-class">.    3.2.3 device={$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sr_node</span></span></span><span class="hljs-class">} date={</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">normalize_date</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">date</span></span></span><span class="hljs-class">)} plugin_sid={</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">translate</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">result</span></span></span><span class="hljs-class">)} src_ip={$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tko_node</span></span></span><span class="hljs-class">} username={$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class">} userdata1={$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">message</span></span></span><span class="hljs-class">} userdata2={$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">session</span></span></span><span class="hljs-class">}</span></span></code> </pre> <br><p>  In this regular expression, we select (using round brackets) the information we want to extract and assign an arbitrary tag to it (using a question mark, the letter P and brackets? P &lt;&gt;), which we can then access to it.  Example: </p><br><pre> <code class="hljs tex">(?P&lt;date&gt;<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">S</span></span></span></span>+<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">s</span></span></span></span>+<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">d</span></span></span></span>+<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">s</span></span></span></span>+<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">d</span></span></span></span>+:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">d</span></span></span></span>+:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">d</span></span></span></span>+)</code> </pre> <br><p>  means that the information at the beginning of a line that falls under the expression \ S + \ s + \ d + \ s + \ d +: \ d +: \ d + will be addressed by the "date" tag.  Further, we inform that in the "date" field of the OSSIM scheme we want to put the value of our "date" field after performing its normalization (OSSIM is able to convert the date in different formats to its single): </p><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">date</span></span>={normalize_date($<span class="hljs-type"><span class="hljs-type">date</span></span>)}</code> </pre> <br><p>  For testing regular expressions you can use, for example, this <a href="http://regexr.com/">tool</a> .  Keep in mind that this tool does not know how to work with tags.  Therefore, having tested your regular expression in it, you will need to add them. <br>  It is also necessary to clarify the "plugin_sid" field.  Events from one source - with the same "plugin_id" - may belong to different classes, for example, "ACCEPT" and "DENY" for our example.  "plugin_sid" just points to the class identifier, and the line: </p><br><pre> <code class="hljs pgsql">plugin_sid={translate($result)}</code> </pre> <br><p>  tells the parser to go to the [translate] section to perform the translation of the information received by the "result" tag.  "ACCEPT" is broadcast in unit, "DENY" - in two.  How and why to assign classes of events - in the next section. <br>  Yes, "plugin_sid" can also be assigned manually for each parsing rule, specifying, for example: </p><br><pre> <code class="hljs">plugin_sid=1</code> </pre> <br><p></p><h5>  <b>3.2.2 Adding information about the parser and event type (s) to the OSSIM database</b> </h5><p></p><br><p>  After writing the configuration file of the parser, you need to add information about it to the OSSIM database. <br>  This is done by writing a mysql script and running it.  Examples of scripts are on the OSSIM Server in the folder: <br>  / usr / share / doc / ossim-mysql / contrib / plugins / <br>  The name of the script can be arbitrary. <br>  For clarity, just give the script from our example: </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">plugin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> = <span class="hljs-string"><span class="hljs-string">"9002"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> plugin_sid <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> plugin_id = <span class="hljs-string"><span class="hljs-string">"9002"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IGNORE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">plugin</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, description) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">9002</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'bw-lists'</span></span>, <span class="hljs-string"><span class="hljs-string">'Bash filtering'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IGNORE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> plugin_sid (plugin_id, <span class="hljs-keyword"><span class="hljs-keyword">sid</span></span>, category_id, class_id, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">9002</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">'Command Accepted'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IGNORE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> plugin_sid (plugin_id, <span class="hljs-keyword"><span class="hljs-keyword">sid</span></span>, category_id, class_id, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">9002</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">'Command Denied'</span></span>);</code> </pre> <br><p>  The first three lines clear all old references to "plugin_id" numbered 9002 from the database and create it again. <br>  The following two just describe the event classes. <br>  As you remember from the previous section, "plugin_sid" is calculated by correlating information obtained from the event using the parser under the "result" tag (maybe "ACCEPT" and "DENY") and then transforming it into the [translate] section (in the configuration file parser).  Thus, we have two classes of events 1 - "ACCEPT", 2 - "DENY". <br>  It is about these event classes that the OSSIM database strings are reported: </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IGNORE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> plugin_sid (plugin_id, <span class="hljs-keyword"><span class="hljs-keyword">sid</span></span>, category_id, class_id, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">9002</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">'Command Accepted'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IGNORE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> plugin_sid (plugin_id, <span class="hljs-keyword"><span class="hljs-keyword">sid</span></span>, category_id, class_id, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">9002</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">'Command Denied'</span></span>);</code> </pre> <br><p>  Those familiar with the syntax "mysql" will easily understand them.  For the rest, I will explain that events classified as "ACCEPT" in the OSSIM interface will appear with the name "Command Accepted", and "DENY", respectively - "Command Denied".  Here you can also set the categorization parameters for events of this type of sources (category_id, class_id). <br>  After creating the script, it is necessary to load it into the OSSIM database with the command: </p><br><pre> <code class="hljs pgsql"># ossim-db &lt; /usr/<span class="hljs-keyword"><span class="hljs-keyword">share</span></span>/doc/ossim-mysql/contrib/plugins/bw-lists.<span class="hljs-keyword"><span class="hljs-keyword">sql</span></span></code> </pre> <br><p></p><h5>  <b>3.2.3 Enable the plugin</b> </h5><br>  You can enable the created plugin as follows: <br>  1) connect to the OSSIM server via SSH, go to the menu: "Configure sensor" - "Configure Data Source Plugins"; <br>  2) find the plugin "bw-lists" in the list and put the value "*" on it, click "OK"; <br>  3) return to the root menu with the "Back" button; <br>  4) select the "Apply all Changes" option. <br>  New plugin ready to handle event logs. <br>  However, if the events arrive, and in the OSSIM interface, specifying sorting by plugin type, you do not see them, then .... <p></p><br><h4>  <b>4. Troubleshooting</b> </h4><br><p>  1) check that the log file specified in the parser configuration file exists and records are updated in it - i.e.  logs coming in; <br>  2) check that the event format fits the regular expression you have written; <br>  3) check the file /var/log/alienvault/agent/agent.log for errors related to your plugin: </p><br><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> ERR /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/alienvault/agent/agent.log|<span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> <span class="hljs-number"><span class="hljs-number">9002</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> Discard /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/alienvault/agent/agent.log|<span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> <span class="hljs-number"><span class="hljs-number">9002</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> Warn /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/alienvault/agent/agent.log|<span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> <span class="hljs-number"><span class="hljs-number">9002</span></span></code> </pre> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/271319/">https://habr.com/ru/post/271319/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../271307/index.html">Sorting the goods and displaying the quantity of goods selected by the user in 1C-Bitrix</a></li>
<li><a href="../271309/index.html">Component-oriented C # engine [part 2]</a></li>
<li><a href="../271311/index.html">Organization of buttons on the site using Sass</a></li>
<li><a href="../271315/index.html">Game cycle</a></li>
<li><a href="../271317/index.html">As ICQ face changed: the visual evolution of the interface ICQ</a></li>
<li><a href="../271321/index.html">How to solve the problem of machine understanding of natural language</a></li>
<li><a href="../271323/index.html">Drupal 8 released - critical look</a></li>
<li><a href="../271325/index.html">The digest of news from the world of development on Unity</a></li>
<li><a href="../271329/index.html">New Yandex.Webmaster</a></li>
<li><a href="../271331/index.html">Dynamic creation of Windows and Web CRUD interfaces and not only for business applications with XAF + Entity Framework. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>