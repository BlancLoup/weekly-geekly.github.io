<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GridFS performance</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are not so many articles about GridFS performance on the Internet, here is one of them Serving files out of GridFS, which shows that returning f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GridFS performance</h1><div class="post__text post__text-html js-mediator-article">  There are not so many articles about GridFS performance on the Internet, here is one of them <a href="https://www.coffeepowered.net/2010/02/17/serving-files-out-of-gridfs/">Serving files out of GridFS,</a> which shows that returning files from GridFS is slower than from disk 6 times. <br>  But in that article there is a flaw - in testing the conversion goes to one file, and at the same time the file is cached at the level of nginx or the file system, which gives a gap compared to GridFS.  And it's a good idea to check out fresh GridFS, 3 years have passed by the way. <br>  Therefore, I decided to conduct my own testing, with reference to different file names. <br><br>  There are 52 thousand files - movie posters, totaling 2GB, the average picture weighs 40kb.  Copy files to ext4, copy to GridFS. <br>  Virtual 512MB with 1 core.  Ubuntu server 12.04 LTS 64bit, Nginx / 1.4.1 settings are standard. <br>  The test is designed for a low-cost server; for powerful servers, the results will be different. <br><br>  <b>Ways to return files:</b> <br>  1) Nginx - statics <br>  2) Gevent via nginx <br>  3) 2 x Gevent via nginx (balancing) <br>  4) Gevent directly <br>  5) Gevent via nginx (unix socket) <br>  <i>for points 2-5, the http server was used in Python + Gevent, which gave files from the GridFS</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Load methods:</b> <br>  1) ol, t2 - Appeal to one url, 2 streams <br>  2) ol, t10 - Appeal to one url, 10 threads <br>  3) t2 - Appeal to different url, 2 threads <br>  4) t10 - Appeal to different url, 10 threads <br><br><img src="https://habrastorage.org/storage3/3f4/c8b/05a/3f4c8b05a2d96a204859ef44de719a57.png"><br><a name="habracut"></a><br>  <b>Details:</b> <br>  * All tests were run 3 times, the average in the table. <br>  * Appeal to different url for all tests occurs on a single list of links, the links contain the ID of the files (in the GridFS search is on the ID) <br>  * In tests where the address goes to one url, the file size is 13.5 kb. <br>  * When returning via gevent, the last file is cached, so in tests where one url is accessed, the GridFS is not accessed and, in fact, the rate of data transfer from Python is measured. <br>  * The ‚Äúone link‚Äù test is done mainly to determine client limits. <br><br>  The client is written in Python, judging by the results, its power is enough for at least 1450 requests per second.  Increasing the threads, or starting as several processes do not give greater performance.  From here it can be judged that the server was a bottleneck, which is necessary for testing. <br><br>  As a result, we received information that the GridFS performance is not as low as previously thought, at least on small servers. <br><br>  More ideas: <br>  * Try nginx-gridfs <br>  * uwsgi-gridfs <br>  * Return files through yield <br>  * Try other proxy servers <br>  * Try other FSs (ZFS?) <br><br>  I also plan to test on a powerful server. <br><br>  Script <a href="https://bitbucket.org/lega911/gridfs_benchmark/src">sources</a> </div><p>Source: <a href="https://habr.com/ru/post/192390/">https://habr.com/ru/post/192390/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../192380/index.html">I invite you to the hack quest in Moscow - last call</a></li>
<li><a href="../192382/index.html">Concepts, concepts, ideas and products (part 3)</a></li>
<li><a href="../192384/index.html">Flights - IT reservation systems</a></li>
<li><a href="../192386/index.html">Aria2C + OpenWRT</a></li>
<li><a href="../192388/index.html">RubyNoName Podcast S05E17</a></li>
<li><a href="../192392/index.html">Electronic fabric</a></li>
<li><a href="../192394/index.html">The path to contextual advertising is through REG.RU</a></li>
<li><a href="../192396/index.html">Software Development: Facts Against Myths</a></li>
<li><a href="../192398/index.html">RailsRumble 2013</a></li>
<li><a href="../192400/index.html">Ukraine remains exactly one month to #FailOverConf!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>