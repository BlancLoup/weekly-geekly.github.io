<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Recursive (hierarchical) queries in PostgreSQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Following Oraklom with its 'connet by prior', all other DBMS introduce their own implementation of hierarchical queries (IZ). I would like to tell a w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Recursive (hierarchical) queries in PostgreSQL</h1><div class="post__text post__text-html js-mediator-article">  Following Oraklom with its 'connet by prior', all other DBMS introduce their own implementation of hierarchical queries (IZ).  I would like to tell a wide audience how it is done in PostgreSQL. <br><a name="habracut"></a><br><h3>  Story </h3><br>  It all started like this <br><blockquote>  <em>From: Evgen Potemkin &lt;evgent@ns.terminal.ru&gt;</em> <em><br></em>  <em>Subject: Proposal of hierachical queries (a la Oracle)</em> <em><br></em>  <em>Date: 2002-11-14 11:52:28 GMT</em> <em><br></em>  <em>Hi there!</em> <em><br></em>  <em>I want to order the hierarchical queries</em> <em><br></em>  <em>posibility.</em>  <em>It allows you to construct queries for Oracle for ex:</em> <em><br></em>  <em>SELECT a, b FROM t CONNECT BY a PRIOR b START WITH cond; B</em> <em><br></em>  <em>I've seen this type of query often made by adding a new type, which</em> <em><br></em>  <em>stores position of row in the tree.</em>  <em>But sorting such tree are very</em> <em><br></em>  <em>tricky (i think).</em> <em><br></em>  <em>Patch allows you to sorted, ie, subnodes of each node</em> <em><br></em>  <em>be sorted by ORDER BY clause.</em> <em><br></em>  <em>with regards, evgen</em> </blockquote><br><br>  then <br><blockquote>  <em>From: Tatsuo Ishii &lt;ishii@postgresql.org&gt;</em> <em><br></em>  <em>Subject: RFP: Recursive query in 8.4</em> <em><br></em>  <em>Date: 2008-02-19 08:36:00 GMT (1 year, 12 weeks, 6 days ago)</em> <em><br></em>  <em>Hi,</em> <em><br></em>  <em>I‚Äôve promised</em> <em><br></em>  <em>recursive query as defined in PostgreSQL 8.4.</em> <em><br></em>  <em>Sumitomo Electric Information Systems Co., Inc.</em> <em><br></em>  <em>Ltd.</em>  <em>(http://www.sei-info.co.jp/) and SRA OSS, Inc.</em>  <em>Japan</em> <em><br></em>  <em>(http://www.sraoss.co.jp).</em> </blockquote><br><br>  Well And since version 8.4 Postgresql began to support the recursive request. <br><h3>  Theory </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      FROM in PostgreSQL is implemented on the basis of standard SQL clause WITH.  Let's get a little deeper: non-recursive WITH allows you to save on repeated subqueries, split a complex query into several smaller ones, is a convenient shortcut for referring to a subquery and is convenient in terms of saving time when writing code.  as in the example below, it was possible to avoid using the subquery in WHERE by applying a temporary table top_regions formed specifically for this query. <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">WITH</font> regional_sales <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> total_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region ), top_regions <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> regional_sales <font color="#0000ff">WHERE</font> total_sales &gt; ( <font color="#0000ff">SELECT</font> <font color="#0000ff">SUM</font> (total_sales)/10 <font color="#0000ff">FROM</font> regional_sales) ) <font color="#0000ff">SELECT</font> region, product, <font color="#0000ff">SUM</font> (quantity) <font color="#0000ff">AS</font> product_units, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> product_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">WHERE</font> region <font color="#0000ff">IN</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> top_regions) <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region, product;</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <ol><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">WITH</font> regional_sales <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> total_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region ), top_regions <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> regional_sales <font color="#0000ff">WHERE</font> total_sales &gt; ( <font color="#0000ff">SELECT</font> <font color="#0000ff">SUM</font> (total_sales)/10 <font color="#0000ff">FROM</font> regional_sales) ) <font color="#0000ff">SELECT</font> region, product, <font color="#0000ff">SUM</font> (quantity) <font color="#0000ff">AS</font> product_units, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> product_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">WHERE</font> region <font color="#0000ff">IN</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> top_regions) <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region, product; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">WITH</font> regional_sales <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> total_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region ), top_regions <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> regional_sales <font color="#0000ff">WHERE</font> total_sales &gt; ( <font color="#0000ff">SELECT</font> <font color="#0000ff">SUM</font> (total_sales)/10 <font color="#0000ff">FROM</font> regional_sales) ) <font color="#0000ff">SELECT</font> region, product, <font color="#0000ff">SUM</font> (quantity) <font color="#0000ff">AS</font> product_units, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> product_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">WHERE</font> region <font color="#0000ff">IN</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> top_regions) <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region, product; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">WITH</font> regional_sales <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> total_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region ), top_regions <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> regional_sales <font color="#0000ff">WHERE</font> total_sales &gt; ( <font color="#0000ff">SELECT</font> <font color="#0000ff">SUM</font> (total_sales)/10 <font color="#0000ff">FROM</font> regional_sales) ) <font color="#0000ff">SELECT</font> region, product, <font color="#0000ff">SUM</font> (quantity) <font color="#0000ff">AS</font> product_units, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> product_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">WHERE</font> region <font color="#0000ff">IN</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> top_regions) <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region, product; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">WITH</font> regional_sales <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> total_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region ), top_regions <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> regional_sales <font color="#0000ff">WHERE</font> total_sales &gt; ( <font color="#0000ff">SELECT</font> <font color="#0000ff">SUM</font> (total_sales)/10 <font color="#0000ff">FROM</font> regional_sales) ) <font color="#0000ff">SELECT</font> region, product, <font color="#0000ff">SUM</font> (quantity) <font color="#0000ff">AS</font> product_units, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> product_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">WHERE</font> region <font color="#0000ff">IN</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> top_regions) <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region, product; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">WITH</font> regional_sales <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> total_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region ), top_regions <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> regional_sales <font color="#0000ff">WHERE</font> total_sales &gt; ( <font color="#0000ff">SELECT</font> <font color="#0000ff">SUM</font> (total_sales)/10 <font color="#0000ff">FROM</font> regional_sales) ) <font color="#0000ff">SELECT</font> region, product, <font color="#0000ff">SUM</font> (quantity) <font color="#0000ff">AS</font> product_units, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> product_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">WHERE</font> region <font color="#0000ff">IN</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> top_regions) <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region, product; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">WITH</font> regional_sales <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> total_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region ), top_regions <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> regional_sales <font color="#0000ff">WHERE</font> total_sales &gt; ( <font color="#0000ff">SELECT</font> <font color="#0000ff">SUM</font> (total_sales)/10 <font color="#0000ff">FROM</font> regional_sales) ) <font color="#0000ff">SELECT</font> region, product, <font color="#0000ff">SUM</font> (quantity) <font color="#0000ff">AS</font> product_units, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> product_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">WHERE</font> region <font color="#0000ff">IN</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> top_regions) <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region, product; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">WITH</font> regional_sales <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> total_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region ), top_regions <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> regional_sales <font color="#0000ff">WHERE</font> total_sales &gt; ( <font color="#0000ff">SELECT</font> <font color="#0000ff">SUM</font> (total_sales)/10 <font color="#0000ff">FROM</font> regional_sales) ) <font color="#0000ff">SELECT</font> region, product, <font color="#0000ff">SUM</font> (quantity) <font color="#0000ff">AS</font> product_units, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> product_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">WHERE</font> region <font color="#0000ff">IN</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> top_regions) <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region, product; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">WITH</font> regional_sales <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> total_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region ), top_regions <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> regional_sales <font color="#0000ff">WHERE</font> total_sales &gt; ( <font color="#0000ff">SELECT</font> <font color="#0000ff">SUM</font> (total_sales)/10 <font color="#0000ff">FROM</font> regional_sales) ) <font color="#0000ff">SELECT</font> region, product, <font color="#0000ff">SUM</font> (quantity) <font color="#0000ff">AS</font> product_units, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> product_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">WHERE</font> region <font color="#0000ff">IN</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> top_regions) <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region, product; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">WITH</font> regional_sales <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> total_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region ), top_regions <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> regional_sales <font color="#0000ff">WHERE</font> total_sales &gt; ( <font color="#0000ff">SELECT</font> <font color="#0000ff">SUM</font> (total_sales)/10 <font color="#0000ff">FROM</font> regional_sales) ) <font color="#0000ff">SELECT</font> region, product, <font color="#0000ff">SUM</font> (quantity) <font color="#0000ff">AS</font> product_units, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> product_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">WHERE</font> region <font color="#0000ff">IN</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> top_regions) <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region, product; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">WITH</font> regional_sales <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> total_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region ), top_regions <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> regional_sales <font color="#0000ff">WHERE</font> total_sales &gt; ( <font color="#0000ff">SELECT</font> <font color="#0000ff">SUM</font> (total_sales)/10 <font color="#0000ff">FROM</font> regional_sales) ) <font color="#0000ff">SELECT</font> region, product, <font color="#0000ff">SUM</font> (quantity) <font color="#0000ff">AS</font> product_units, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> product_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">WHERE</font> region <font color="#0000ff">IN</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> top_regions) <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region, product; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">WITH</font> regional_sales <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> total_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region ), top_regions <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> regional_sales <font color="#0000ff">WHERE</font> total_sales &gt; ( <font color="#0000ff">SELECT</font> <font color="#0000ff">SUM</font> (total_sales)/10 <font color="#0000ff">FROM</font> regional_sales) ) <font color="#0000ff">SELECT</font> region, product, <font color="#0000ff">SUM</font> (quantity) <font color="#0000ff">AS</font> product_units, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> product_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">WHERE</font> region <font color="#0000ff">IN</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> top_regions) <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region, product; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">WITH</font> regional_sales <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> total_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region ), top_regions <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> regional_sales <font color="#0000ff">WHERE</font> total_sales &gt; ( <font color="#0000ff">SELECT</font> <font color="#0000ff">SUM</font> (total_sales)/10 <font color="#0000ff">FROM</font> regional_sales) ) <font color="#0000ff">SELECT</font> region, product, <font color="#0000ff">SUM</font> (quantity) <font color="#0000ff">AS</font> product_units, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> product_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">WHERE</font> region <font color="#0000ff">IN</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> top_regions) <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region, product; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">WITH</font> regional_sales <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> total_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region ), top_regions <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> regional_sales <font color="#0000ff">WHERE</font> total_sales &gt; ( <font color="#0000ff">SELECT</font> <font color="#0000ff">SUM</font> (total_sales)/10 <font color="#0000ff">FROM</font> regional_sales) ) <font color="#0000ff">SELECT</font> region, product, <font color="#0000ff">SUM</font> (quantity) <font color="#0000ff">AS</font> product_units, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> product_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">WHERE</font> region <font color="#0000ff">IN</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> top_regions) <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region, product; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">WITH</font> regional_sales <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> total_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region ), top_regions <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> regional_sales <font color="#0000ff">WHERE</font> total_sales &gt; ( <font color="#0000ff">SELECT</font> <font color="#0000ff">SUM</font> (total_sales)/10 <font color="#0000ff">FROM</font> regional_sales) ) <font color="#0000ff">SELECT</font> region, product, <font color="#0000ff">SUM</font> (quantity) <font color="#0000ff">AS</font> product_units, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> product_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">WHERE</font> region <font color="#0000ff">IN</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> top_regions) <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region, product; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">WITH</font> regional_sales <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> total_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region ), top_regions <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> regional_sales <font color="#0000ff">WHERE</font> total_sales &gt; ( <font color="#0000ff">SELECT</font> <font color="#0000ff">SUM</font> (total_sales)/10 <font color="#0000ff">FROM</font> regional_sales) ) <font color="#0000ff">SELECT</font> region, product, <font color="#0000ff">SUM</font> (quantity) <font color="#0000ff">AS</font> product_units, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> product_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">WHERE</font> region <font color="#0000ff">IN</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> top_regions) <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region, product; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">WITH</font> regional_sales <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> total_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region ), top_regions <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> regional_sales <font color="#0000ff">WHERE</font> total_sales &gt; ( <font color="#0000ff">SELECT</font> <font color="#0000ff">SUM</font> (total_sales)/10 <font color="#0000ff">FROM</font> regional_sales) ) <font color="#0000ff">SELECT</font> region, product, <font color="#0000ff">SUM</font> (quantity) <font color="#0000ff">AS</font> product_units, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> product_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">WHERE</font> region <font color="#0000ff">IN</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> top_regions) <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region, product; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> </ol> <code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">WITH</font> regional_sales <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> total_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region ), top_regions <font color="#0000ff">AS</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> regional_sales <font color="#0000ff">WHERE</font> total_sales &gt; ( <font color="#0000ff">SELECT</font> <font color="#0000ff">SUM</font> (total_sales)/10 <font color="#0000ff">FROM</font> regional_sales) ) <font color="#0000ff">SELECT</font> region, product, <font color="#0000ff">SUM</font> (quantity) <font color="#0000ff">AS</font> product_units, <font color="#0000ff">SUM</font> (amount) <font color="#0000ff">AS</font> product_sales <font color="#0000ff">FROM</font> orders <font color="#0000ff">WHERE</font> region <font color="#0000ff">IN</font> ( <font color="#0000ff">SELECT</font> region <font color="#0000ff">FROM</font> top_regions) <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> region, product;</font> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Adding an optional RECURSEVE statement allows a Postgre query to access its output.  The query algorithm must consist of other parts.  The first part is the base, usually returning one line from the starting point of the hierarchy or part of the hierarchy.  Ie a place in the hierarchy where the countdown will start (for example, the root).  and the second recursive part that will be associated with the temporary table we declared after WITH.  The first and second parts are combined with the UNION or UNION ALL operator.  so that we would set an example for this chaotic set of words. <br>  Create a table that describes the structru of one company <br> <code>CREATE TABLE KPO <br> ( <br> "ID" character varying(55), <br> "DESCRIPTION" character varying(255), <br> "PARENT" character varying(55 <br> ) ;</code> <br> <br>  after entering the data there: <br> <code>Select * from kpo</code> <br> <br><br><br><table><tbody><tr><th>  ID </th><th>  DESCRIPTION </th><th>  PARENT </th></tr><tr><td>  == ====== </td><td>  ================================ </td><td>  ======= </td></tr><tr><td>  KPO </td><td>  KARACHAGANAK PETROLEUM OPERATING </td><td>  {null} </td></tr><tr><td>  AKSAY </td><td>  AKSAY </td><td>  KPO </td></tr><tr><td>  URALSK </td><td>  KPO </td><td>  KPO </td></tr><tr><td>  LONDON </td><td>  LONDON </td><td>  KPO </td></tr><tr><td>  KPC </td><td>  KPC </td><td>  AKSAY </td></tr><tr><td>  U2 </td><td>  UNIT-2 </td><td>  AKSAY </td></tr><tr><td>  U3 </td><td>  UNIT-3 </td><td>  AKSAY </td></tr><tr><td>  PROD </td><td>  PRODACTION </td><td>  KPC </td></tr><tr><td>  MAINT </td><td>  MAINTENANCE </td><td>  AKSAY </td></tr><tr><td>  CMMS </td><td>  CMMS TEAM </td><td>  MAINT </td></tr></tbody></table><br><br>  Now the recursive query itself: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">WITH</font> <font color="#0000ff">RECURSIVE</font> temp1 ("ID", "PARENT", "DESCRIPTION", <font color="#0000ff">PATH</font> , <font color="#0000ff">LEVEL</font> ) <font color="#0000ff">AS</font> ( </li><li>  <font color="#0000ff">SELECT</font> T1. "ID", T1. "PARENT", T1. "DESCRIPTION", <font color="#0000ff">CAST</font> (T1. "ID" <font color="#0000ff">AS</font> <font color="#0000ff">VARCHAR</font> (50)) <font color="#0000ff">as</font> <font color="#0000ff">PATH</font> , 1 </li><li>  <font color="#0000ff">FROM</font> KPO T1 <font color="#0000ff">WHERE</font> T1. "PARENT" <font color="#0000ff">IS</font> <font color="#0000ff">NULL</font> </li><li>  <font color="#0000ff">union</font> </li><li>  <font color="#0000ff">select</font> T2. "ID", T2. "PARENT", T2. "DESCRIPTION", <font color="#0000ff">CAST</font> (temp1. <font color="#0000ff">PATH</font> || <font color="#A31515">'-&gt;'</font> || T2. "ID" <font color="#0000ff">AS</font> <font color="#0000ff">VARCHAR</font> (50)), <font color="#0000ff">LEVEL</font> + 1 </li><li>  <font color="#0000ff">FROM</font> KPO T2 <font color="#0000ff">INNER</font> <font color="#0000ff">JOIN</font> temp1 <font color="#0000ff">ON</font> (temp1. "ID" = T2. "PARENT")) </li><li>  <font color="#0000ff">select</font> * <font color="#0000ff">from</font> temp1 <font color="#0000ff">ORDER</font> <font color="#0000ff">BY</font> <font color="#0000ff">PATH</font> <font color="#0000ff">LIMIT</font> 100 </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  The first part (rows 2-3) returns to the temporary table the first row in this case, the root entry of our structure, from which the countdown will begin in our hierarchy.  the second part (lines 4-5) adds to the same temporary table the records associated with the string already contained in temp1 via JOIN (ID = PARENT) and so on until the end until all the leaves of our ROOTa are in temp1. <br>  Also in this example, the Orakolavskaya function sys_connect_by_path was simulated. <br><br><br><br><table><tbody><tr><th>  "ID" </th><th>  "PARENT" </th><th>  "DESCRIPTION" </th><th>  "Path" </th><th>  "Level" </th></tr><tr><td>  KPO </td><td></td><td>  KARACHAGANAK PETROLEUM OPERATING </td><td>  KPO </td><td>  one </td></tr><tr><td>  AKSAY </td><td>  KPO </td><td>  AKSAY </td><td>  KPO-&gt; AKSAY </td><td>  2 </td></tr><tr><td>  KPC </td><td>  AKSAY </td><td>  KPC </td><td>  KPO-&gt; AKSAY-&gt; KPC </td><td>  3 </td></tr><tr><td>  PROD </td><td>  KPC </td><td>  PRODAUCTION </td><td>  KPO-&gt; AKSAY-&gt; KPC-&gt; PROD </td><td>  four </td></tr><tr><td>  MAINT </td><td>  AKSAY </td><td>  MAINTENANCE </td><td>  KPO-&gt; AKSAY-&gt; MAINT </td><td>  3 </td></tr><tr><td>  CMMS </td><td>  MAINT </td><td>  CMMS TEAM </td><td>  KPO-&gt; AKSAY-&gt; MAINT-&gt; CMMS </td><td>  four </td></tr><tr><td>  U2 </td><td>  AKSAY </td><td>  UNIT-2 </td><td>  KPO-&gt; AKSAY-&gt; U2 </td><td>  3 </td></tr><tr><td>  U3 </td><td>  AKSAY </td><td>  UNIT-3 </td><td>  KPO-&gt; AKSAY-&gt; U3 </td><td>  3 </td></tr><tr><td>  LONDON </td><td>  KPO </td><td>  LONDON </td><td>  KPO-&gt; LONDON </td><td>  2 </td></tr><tr><td>  URALSK </td><td>  KPO </td><td>  URALSK </td><td>  KPO-&gt; URALSK </td><td>  2 </td></tr></tbody></table><br><br>  Postgre does not have a built-in looping test, so if we received the data from the guys who were directly involved in creating the structure in Excel, we should check this structure for integrity.  sometimes it is enough to use UNION instead of UNION ALL, but this is only sometimes.  If you set the starting point in the hierarchy in the first part, and if there is even a break in the hierarchy, in principle, having started the above-mentioned error there will not be an error, just the lines ‚Äútweaks‚Äù will be ignored.  But we need to know where the error is, and we can implement this by introducing an additional check before performing UNION. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">WITH</font> <font color="#0000ff">RECURSIVE</font> temp1 ("ID", "PARENT", "DESCRIPTION", <font color="#0000ff">PATH</font> , <font color="#0000ff">LEVEL</font> , <font color="#0000ff">cycle</font> ) <font color="#0000ff">AS</font> ( </li><li>  <font color="#0000ff">SELECT</font> T1. "ID", T1. "PARENT", T1. "DESCRIPTION", <font color="#0000ff">cast</font> ( <font color="#0000ff">array</font> [T1. "ID"] <font color="#0000ff">as</font> <font color="#0000ff">varchar</font> (100) []), 1, <font color="#0000ff">FALSE</font> </li><li>  <font color="#0000ff">FROM</font> KPO T1 </li><li>  <font color="#0000ff">union</font> <font color="#0000ff">all</font> </li><li>  <font color="#0000ff">select</font> T2. "ID", T2. "PARENT", T2. "DESCRIPTION", <font color="#0000ff">cast</font> (temp1. <font color="#0000ff">PATH</font> || T2. "ID" <font color="#0000ff">as</font> <font color="#0000ff">varchar</font> (100) []), <font color="#0000ff">LEVEL</font> + 1, </li><li>  T2. "ID" = <font color="#0000ff">any</font> (temp1. <font color="#0000ff">PATH</font> ) </li><li>  <font color="#0000ff">FROM</font> KPO T2 <font color="#0000ff">INNER</font> <font color="#0000ff">JOIN</font> temp1 <font color="#0000ff">ON</font> (temp1. "ID" = T2. "PARENT") <font color="#0000ff">AND</font> <font color="#0000ff">NOT</font> <font color="#0000ff">CYCLE</font> ) </li><li></li><li>  <font color="#0000ff">select</font> * <font color="#0000ff">from</font> temp1 <font color="#0000ff">WHERE</font> <font color="#0000ff">CYCLE</font> <font color="#0000ff">IS</font> <font color="#0000ff">TRUE</font> <font color="#0000ff">LIMIT</font> 100; </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  Here, as you see, the same Path field is created but all previous parents are organized in an array, which makes it possible for us to compare each new ‚ÄúID‚Äù to a duplicate. we don‚Äôt use this line to search for descendants anymore, so looping is avoided (union all ... WHERE ... AND NOT CYCLE). <br><br>  Advice from the official site: use the LIMIT operator as I did in the examples.  This will help you keep your nerves. <br><br><h3>  Practical examples </h3><br><br>  Horsch's theory of course, but where all this can be applied in practice, tebolle in light of the cost of such requests. <br>  In addition, it would be nice to draw a hierarchy in one query, and to find for example all the leaves of the current ‚ÄúID‚Äù there are also other tasks. <br>  Often you need to make changes, such as for example changing the phone code to all employees of a particular department in the telephone directory.  Of course, you can use the column in the table of workers or even prefix the ‚ÄúID‚Äù.  but all this makes the base non-flexible and non-scalable.  It is much better to make a separate Workers table that will display a hierarchy with three columns ‚ÄúID‚Äù, ‚ÄúPARENT‚Äú, ‚ÄúHIERARCHID‚Äù.  the ‚ÄúHIERARCHID‚Äù field will allow you to make more than one hierarchical structure.  The table is called for an example ANCESTOR which will also consist of three columns ‚ÄúID‚Äù, ‚ÄúANCESTOR‚Äù, ‚ÄúHIERARCHID‚Äù.  in the ‚ÄúANCESTOR‚Äù field all ancestors will be contained, remember the ‚ÄúPath‚Äù array from Example 3. So this table can be filled with a recursive query. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">insert</font> <font color="#0000ff">into</font> ancestor (‚ÄúID‚Äù "ANCESTOR", "HIERARCHID") </li><li>  <font color="#0000ff">WITH</font> <font color="#0000ff">RECURSIVE</font> temp1 ("ID", "PARENT", "DESCRIPTION", <font color="#0000ff">PATH</font> , <font color="#0000ff">LEVEL</font> , <font color="#0000ff">cycle</font> ) <font color="#0000ff">AS</font> ( </li><li>  <font color="#0000ff">SELECT</font> T1. "ID", T1. "PARENT", T1. "DESCRIPTION", <font color="#0000ff">cast</font> ( <font color="#0000ff">array</font> [T1. "ID"] <font color="#0000ff">as</font> <font color="#0000ff">varchar</font> (100) []), 1, <font color="#0000ff">FALSE</font> </li><li>  <font color="#0000ff">FROM</font> KPO T1 </li><li>  <font color="#0000ff">union</font> <font color="#0000ff">all</font> </li><li>  <font color="#0000ff">select</font> T2. "ID", T2. "PARENT", T2. "DESCRIPTION", <font color="#0000ff">cast</font> (temp1. <font color="#0000ff">PATH</font> || T2. "ID" <font color="#0000ff">as</font> <font color="#0000ff">varchar</font> (100) []), <font color="#0000ff">LEVEL</font> + 1, </li><li>  T2. "ID" = <font color="#0000ff">any</font> (temp1. <font color="#0000ff">PATH</font> ) </li><li>  <font color="#0000ff">FROM</font> KPO T2 <font color="#0000ff">INNER</font> <font color="#0000ff">JOIN</font> temp1 <font color="#0000ff">ON</font> (temp1. "ID" = T2. "PARENT") <font color="#0000ff">AND</font> <font color="#0000ff">NOT</font> <font color="#0000ff">CYCLE</font> </li><li>  ) </li><li>  <font color="#0000ff">select</font> "ID" <font color="#0000ff">AS</font> "LOCATION", <font color="#0000ff">PATH</font> [1] <font color="#0000ff">AS</font> "ANCESTOR", <font color="#A31515">'DEPT'</font> <font color="#0000ff">AS</font> "DID" <font color="#0000ff">from</font> temp1 </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  such a sign will turn out <br><br><br><br><table><tbody><tr><th>  LOCATION </th><th>  ANCESTOR </th><th>  HIERARCHID </th></tr><tr><td>  ========= </td><td>  ========= </td><td>  ========== </td></tr><tr><td>  AKSAY </td><td>  AKSAY </td><td>  DEPT </td></tr><tr><td>  AKSAY </td><td>  KPO </td><td>  DEPT </td></tr><tr><td>  CMMS </td><td>  KPO </td><td>  DEPT </td></tr><tr><td>  CMMS </td><td>  MAINT </td><td>  DEPT </td></tr><tr><td>  CMMS </td><td>  CMMS </td><td>  DEPT </td></tr><tr><td>  CMMS </td><td>  AKSAY </td><td>  DEPT </td></tr><tr><td>  KPC </td><td>  AKSAY </td><td>  DEPT </td></tr><tr><td>  KPC </td><td>  KPC </td><td>  DEPT </td></tr><tr><td>  KPC </td><td>  KPO </td><td>  DEPT </td></tr><tr><td>  KPO </td><td>  KPO </td><td>  DEPT </td></tr><tr><td>  LONDON </td><td>  LONDON </td><td>  DEPT </td></tr><tr><td>  LONDON </td><td>  KPO </td><td>  DEPT </td></tr><tr><td>  MAINT </td><td>  AKSAY </td><td>  DEPT </td></tr><tr><td>  MAINT </td><td>  MAINT </td><td>  DEPT </td></tr><tr><td>  MAINT </td><td>  KPO </td><td>  DEPT </td></tr><tr><td>  PROD </td><td>  KPO </td><td>  DEPT </td></tr><tr><td>  PROD </td><td>  AKSAY </td><td>  DEPT </td></tr><tr><td>  PROD </td><td>  KPC </td><td>  DEPT </td></tr><tr><td>  PROD </td><td>  PROD </td><td>  DEPT </td></tr><tr><td>  U2 </td><td>  AKSAY </td><td>  DEPT </td></tr><tr><td>  U2 </td><td>  KPO </td><td>  DEPT </td></tr><tr><td>  U2 </td><td>  U2 </td><td>  DEPT </td></tr><tr><td>  U3 </td><td>  U3 </td><td>  DEPT </td></tr><tr><td>  U3 </td><td>  AKSAY </td><td>  DEPT </td></tr><tr><td>  U3 </td><td>  KPO </td><td>  DEPT </td></tr><tr><td>  URALSK </td><td>  KPO </td><td>  DEPT </td></tr><tr><td>  URALSK </td><td>  URALSK </td><td>  DEPT </td></tr></tbody></table><br><br>  Now all our selects and updates will be done using this table.  for example, with the same phone numbers, it would look something like this: <br><br> <code>Update EMPLOYEE SET ‚ÄúTELNUM‚Äù = '545-454' FROM ANCESTOR WHERE ‚ÄúANCESTOR‚Äù.‚ÄùANCESTOR‚Äù = 'AKSAY' AND EMPLOYEE.‚ÄùLOCATION‚Äù = ANCESTOR.‚ÄùLOCATION‚Äù AND EMPLOYEE.ISDPRT = 'N' ;</code> <br> <br>  Moreover, it will be necessary to foresee a trigger for updating the table when adding a new one or deleting an entry in the KPO table. <br><br>  Continue <br><br>  Suppose that there is a table in which logs are recorded, imagine that you need to count how many records for the previous month were made and grouped by day.  for this you will need a reference calendar for the past month, for example, so as not to miss the day when there were no records.  such a calendar (list of days in one column) can be obtained by such a request. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">WITH</font> <font color="#0000ff">RECURSIVE</font> t (n) <font color="#0000ff">AS</font> ( </li><li>  <font color="#0000ff">VALUES</font> (1) </li><li>  <font color="#0000ff">UNION</font> <font color="#0000ff">ALL</font> </li><li>  <font color="#0000ff">SELECT</font> n + 1 <font color="#0000ff">FROM</font> t <font color="#0000ff">WHERE</font> n &lt;( <font color="#0000ff">SELECT</font> <font color="#0000ff">cast</font> ( <font color="#0000ff">extract</font> ( <font color="#A31515">'day'</font> <font color="#0000ff">from</font> date_trunc ( <font color="#A31515">'month'</font> , <font color="#0000ff">current_date</font> ) - <font color="#0000ff">interval</font> <font color="#A31515">'24 hour '</font> ) <font color="#0000ff">as</font> <font color="#0000ff">integer</font> )) </li><li>  ) </li><li>  <font color="#0000ff">SELECT</font> to_date (n || <font color="#A31515">'-'</font> || <font color="#0000ff">extract</font> ( <font color="#A31515">'month'</font> <font color="#0000ff">from</font> date_trunc ( <font color="#A31515">'month'</font> , <font color="#0000ff">current_date</font> ) - <font color="#0000ff">interval</font> <font color="#A31515">'24 hour '</font> ) </li><li>  ||  <font color="#A31515">'-'</font> ||  <font color="#0000ff">extract</font> ( <font color="#A31515">'year'</font> <font color="#0000ff">from</font> date_trunc ( <font color="#A31515">'month'</font> , <font color="#0000ff">current_date</font> ) - <font color="#0000ff">interval</font> <font color="#A31515">'24 hour '</font> ), <font color="#A31515">' dd-mm-yyyy '</font> ) </li><li>  <font color="#0000ff">FROM</font> t; </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  Another not very useful example for a snack.  The original idea of ‚Äã‚ÄãGraeme Joba (Graeme Job).  the result is better to look at the text file <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">WITH</font> <font color="#0000ff">RECURSIVE</font> z (ix, iy, cx, cy, x, y, i) <font color="#0000ff">AS</font> ( </li><li>  <font color="#0000ff">SELECT</font> ix, iy, x :: <font color="#0000ff">float</font> , y :: <font color="#0000ff">float</font> , x :: <font color="#0000ff">float</font> , y :: <font color="#0000ff">float</font> , 0 </li><li>  <font color="#0000ff">FROM</font> ( <font color="#0000ff">select</font> -1.88 + 0.016 * i, i <font color="#0000ff">from</font> generate_series (0,150) <font color="#0000ff">as</font> i) <font color="#0000ff">as</font> xgen (x, ix), </li><li>  ( <font color="#0000ff">select</font> -1.11 + 0.060 * i, i <font color="#0000ff">from</font> generate_series (0.36) <font color="#0000ff">as</font> i) <font color="#0000ff">as</font> ygen (y, iy) </li><li>  <font color="#0000ff">UNION</font> <font color="#0000ff">ALL</font> </li><li>  <font color="#0000ff">SELECT</font> ix, iy, cx, cy, x * x - y * y + cx, y * x * 2 + cy, i + 1 </li><li>  <font color="#0000ff">FROM</font> z </li><li>  <font color="#0000ff">WHERE</font> x * x + y * y &lt;16 :: <font color="#0000ff">float</font> </li><li>  <font color="#0000ff">AND</font> i &lt;27 </li><li>  ) </li><li>  <font color="#0000ff">SELECT</font> array_to_string (array_agg ( <font color="#0000ff">substring</font> ( <font color="#A31515">'. ,,, ----- ++++ %%%% @@@@ ####'</font> , </li><li>  greatest (i, 1), 1)), <font color="#A31515">''</font> ) </li><li>  <font color="#0000ff">FROM</font> ( </li><li>  <font color="#0000ff">SELECT</font> ix, iy, <font color="#0000ff">max</font> (i) <font color="#0000ff">AS</font> i </li><li>  <font color="#0000ff">FROM</font> z </li><li>  <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> iy, ix </li><li>  <font color="#0000ff">ORDER</font> <font color="#0000ff">BY</font> iy, ix </li><li>  ) <font color="#0000ff">AS</font> zt </li><li>  <font color="#0000ff">GROUP</font> <font color="#0000ff">BY</font> iy </li><li>  <font color="#0000ff">ORDER</font> <font color="#0000ff">BY</font> iy </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  Well, such a post to start ;-) <br></div><p>Source: <a href="https://habr.com/ru/post/73700/">https://habr.com/ru/post/73700/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../73692/index.html">Top 12 ASP.NET MVC Practices</a></li>
<li><a href="../73693/index.html">Pricing on Windows 7 for Russia</a></li>
<li><a href="../73695/index.html">Collecting friends about yourself</a></li>
<li><a href="../73696/index.html">How Google sees the Internet of the future</a></li>
<li><a href="../73698/index.html">Yovi - Old school word game for your iPhone</a></li>
<li><a href="../73702/index.html">Patriotism</a></li>
<li><a href="../73704/index.html">CaptureOne PRO 5 began to edit JPEG</a></li>
<li><a href="../73706/index.html">The issue of software licensing in an enterprise</a></li>
<li><a href="../73708/index.html">New information on support of Oracle of technologies of Sun</a></li>
<li><a href="../73711/index.html">The first Belarusian SEO-conference opened the registration of participants</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>