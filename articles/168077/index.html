<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hor + vert + FOV, or adaptive field of view</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello to all! 

 Today, when I tested my Quake port on a tablet, I noticed that in portrait orientation it was not very pleasant to watch demos becaus...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hor + vert + FOV, or adaptive field of view</h1><div class="post__text post__text-html js-mediator-article"><img src="http://habrastorage.org/storage2/11c/756/677/11c756677807a2f9ed9ec8e5bbf03c36.jpg"><br><br>  Hello to all! <br><br>  Today, when I tested my Quake port on a tablet, I noticed that in portrait orientation it was not very pleasant to watch demos because of the narrow field of view. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So I decided to come up with a very simple, but looking good (in my opinion) both in portrait and landscape orientation, a way to fix it. <br><br>  And I called it Hor + vert + FOV. <br><a name="habracut"></a><br><br><h4>  What was the problem </h4><br>  Since my desktop has a widescreen monitor, I initially decided to use <abbr title="Expansion of horizontal viewing angle with increasing aspect ratio">Hor +</abbr> FOV instead of <abbr title="The narrowing of the vertical viewing angle with increasing aspect ratio">Vert-</abbr> , despite the fact that Quake uses Vert- because it seemed that I was looking at the world through a magnifying glass. <br><br>  <i>Quake with Vert-FOV on a widescreen monitor.</i> <br><img src="https://habrastorage.org/storage2/d6e/f29/830/d6ef29830eee9555b4a44b89586727d5.jpg"><br><br>  Hor + worked fine until I had a tablet.  Everything looked great in landscape orientation, but in portrait it was no longer an approximation, but simply cramped. <br><br>  <i>Quake with Hor + FOV in portrait orientation.</i> <br><img src="https://habrastorage.org/storage2/d3c/1fa/56f/d3c1fa56f1fa2f7af20d1774cb637760.jpg"><br><br><h4>  Decision </h4><br>  And the solution was the simplest. <br><br>  Instead of using any of the two types of FOV, I decided to combine these two types. <br><br>  Since Quake was designed for monitors with a 4: 3 aspect ratio, I began to use this ratio as a base to switch between the two modes. <br><br>  <b>If the aspect ratio is greater than 4: 3 (wide screen) - Hor + is used.</b> <b><br></b>  <b>If the aspect ratio is less than or equal to 4: 3 (the screen is narrow or close to square), Vert- is used.</b> <br><br>  But since the task was to adjust the FOV to narrow screens, this means that the narrower the screen, the more it should be visible.  Therefore, for us Vert- actually turned into Vert +. <br><br>  The implementation of this method takes a single check on the condition. <br><br>  I will give all the code to implement this method from WebQuake. <br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((vrect.width * <span class="hljs-number"><span class="hljs-number">0.75</span></span>) &lt;= vrect.height) { R.refdef.fov_x = SCR.fov.value; R.refdef.fov_y = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.atan(vrect.height / (vrect.width / <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.tan(SCR.fov.value * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI / <span class="hljs-number"><span class="hljs-number">360.0</span></span>))) * <span class="hljs-number"><span class="hljs-number">360.0</span></span> / <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { R.refdef.fov_x = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.atan(vrect.width / (vrect.height / <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.tan(SCR.fov.value * <span class="hljs-number"><span class="hljs-number">0.82</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI / <span class="hljs-number"><span class="hljs-number">360.0</span></span>))) * <span class="hljs-number"><span class="hljs-number">360.0</span></span> / <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI; R.refdef.fov_y = SCR.fov.value * <span class="hljs-number"><span class="hljs-number">0.82</span></span>; }</code> </pre> <br><br>  Explanation: <br><ul><li>  SCR.fov is a console variable denoting horizontal FOV with a 4: 3 aspect ratio (ideal aspect ratio for Quake). </li><li>  If the aspect ratio is less than or equal to 4: 3, use Vert +.  If not, use Vert-. </li><li>  In the case of Vert +, we take the horizontal FOV from the console variable, and the vertical one is calculated using a well-known algorithm. </li><li>  In the case of Hor +, we take the vertical FOV from the console variable, and the horizontal FOV is calculated. </li><li>  0.82 - the ratio of vertical FOV to horizontal at a ratio of 4: 3.  To get the vertical FOV from a console variable, multiply the value of the variable by this constant. </li></ul><br><br>  What came out of it: <br>  <i>Landscape orientation - Hor + is used.</i> <br><img src="http://habrastorage.org/storage2/0cb/ad2/09c/0cbad209c75bc4c0e9be2fd08bf6e77b.jpg"><br>  <i>Portrait orientation - Vert + is used.</i> <br><img src="http://habrastorage.org/storage2/73a/b1c/934/73ab1c93478bfc6b4869bb85185d0752.jpg"><br><br>  As you can see, there is no approximation, and the review is good. <br><br>  But there is one small problem. <br><br><h4>  Error and its solution </h4><br>  As can be seen from the previous screenshot, the weapon model is too far from the player. <br><br>  This problem is present only when Vert + is used - in Hor + this effect is not observed. <br><br>  Since the model of weapons in Quake is drawn separately from the other models, nothing prevents us from switching from Vert + to Hor + before drawing the weapon, and after that - back. <br><br>  <i>The world is drawn in Vert +, and the weapon in Hor +.</i> <br><img src="http://habrastorage.org/storage2/c97/6a3/829/c976a382935539ae3b38a49ab7a012e9.jpg"><br><br>  Bug fixed. <br><br><h4>  Outcome and conclusion </h4><br>  As a result, it turned out like in the first screenshot in this post. <br><br><img src="http://habrastorage.org/storage2/11c/756/677/11c756677807a2f9ed9ec8e5bbf03c36.jpg"><br><br>  Maybe this technique is not new (although I have not yet met a single game using something like this), but it is of great importance.  The use of adaptive FOV is very important in the era of web applications and mobile devices, since the browser window can have any rectangular shape, and smartphones and tablets work in both horizontal and vertical orientation. <br><br>  Thanks for reading. </div><p>Source: <a href="https://habr.com/ru/post/168077/">https://habr.com/ru/post/168077/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../168063/index.html">Redmine - one-time password authentication (OTP)</a></li>
<li><a href="../168067/index.html">Evolution of agents managed by a neural network</a></li>
<li><a href="../168069/index.html">I2P network has accelerated</a></li>
<li><a href="../168073/index.html">Hi, JavaFX! Let's get acquainted?</a></li>
<li><a href="../168075/index.html">Working with structures or how I learned to write readable code</a></li>
<li><a href="../168079/index.html">The story of a single SQL injection</a></li>
<li><a href="../168085/index.html">Development of GPS tracker from scratch and 512 months warranty</a></li>
<li><a href="../168087/index.html">Supercomputer for 1 billion euros: a simulation of the human brain</a></li>
<li><a href="../168089/index.html">Qt 5.0.1 and Qt Creator 2.6.2 released</a></li>
<li><a href="../168091/index.html">LiveReload on Node.js</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>