<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Looking for Performance: Monitoring JVM performance under Linux with BPF</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sasha Goldstein, a specialist in low-level application optimization, as part of his report at the JPoint, will deviate a little from the usual .NET to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Looking for Performance: Monitoring JVM performance under Linux with BPF</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/f1c/137/10f/f1c13710f9ca4d039be2c36cf4f6e518.jpg" align="left">  Sasha Goldstein, a specialist in low-level application optimization, as part of his report at the JPoint, will deviate a little from the usual .NET topic and talk about tools that help fight for Java application performance under Linux.  What is this tool, who needs it and why, we decided to find out in advance and interviewed Sasha. <br><br>  <b>JUG.Ru Group:</b> <i>Tell us a few words about yourself and your work?</i> <br><br>  <b>Sasha Goldstein:</b> My name is Sasha Goldstein, for the last 10 years I have been working for the Israeli consulting company Sela as a CTO. <br>  My work focuses on performance optimization, production diagnostics, monitoring, and all sorts of low-level tasks. <br>  My typical work week is filled with a variety of tasks: I teach, correct mistakes or performance problems for clients, and also work on internal projects.  I also enter the program committee of a couple of conferences: our own SDP (Tel Aviv, Israel), as well as DotNext (Moscow and St. Petersburg, Russia), which surprisingly takes a lot of time. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote>  <i><font color="#999999"><b>‚ÄúThe performance of most applications is not determined by hardware or the runtime environment‚Äù</b> - Sasha Goldshtein about monitoring Java performance under Linux</font></i> </blockquote><a name="habracut"></a><br>  <b>JUG.Ru Group:</b> <i>You usually talk a lot about .NET performance.</i>  <i>What pushed you towards Java?</i> <br><br>  <b>Sasha Goldstein:</b> Indeed, most of my work is related to C # and C ++ under Windows.  I spent a lot of time optimizing and solving the identified .NET performance problems.  However, in the work on low-level optimization and debugging within the framework of different technologies, common elements can be traced: tools can have different names, but the general principles, methodology and thought process are the same.  In the past couple of years, I became closely acquainted with BPF, a Linux trace framework, and this led me to the idea of ‚Äã‚Äãusing BPF to analyze JVM performance. <br><br>  <b>JUG.Ru Group:</b> <i>What are the peculiarities of the struggle for Java performance against the background of .NET?</i> <br><br>  <b>Sasha Goldstein:</b> As I said, many things are identical.  The performance of most applications is not determined by hardware or runtime (JVM, CLR, Python, or something else), but by the environment: features of database access, disk search speed and network request processing.  For this class of applications, by and large, it does not matter what runtime environment you use.  When it comes to low-level optimization, for example, minimizing memory consumption, optimizing individual algorithms, processor speed (CPU-bound), and the like, there are situations in which the difference between the platforms really matters, especially if you need to configure execution environment for your application.  In general, the JVM is more flexible than the CLR;  and, it seems to me, in recent years more effort has been invested specifically in optimizing various JVM implementations than in the Microsoft CLR. <br><br>  <b>JUG.Ru Group:</b> <i>When is the struggle for productivity really required, after all this task is ‚Äúexpensive‚Äù in terms of time costs?</i>  <i>What factors clearly indicate that there are problems with performance?</i> <br><br>  <b>Sasha Goldstein:</b> Often, performance is not a functional indicator that needs to be achieved.  But even if you are not building real-time systems or super-fast client applications, there are probably some minimal (reasonable) speed limits that your users will not be ready to cross.  For example, a web API that takes 5 seconds to process a login request is likely to piss people off.  There is also the question of cost: performance optimization usually means that you need less hardware resources, which means direct, direct cost savings, given the cloud-first policy adopted by many. <br>  It is hoped that most people will have a process for setting performance targets and at least the simplest way to monitor and verify these indicators as the development process progresses. <br><br><img src="https://habrastorage.org/files/be2/0d5/94a/be20d594a8b749178f51991c4422e222.jpg"><br><br>  <b>JUG.Ru Group:</b> <i>How to start researching performance problems?</i> <br><br>  <b>Sasha Goldstein: The</b> crucial point is to have a good description of the system, for example, a functional block diagram.  When you understand, relatively speaking, the ‚Äúmechanics of work‚Äù: what are the main components and how they are interconnected, it is much easier to guess where to look for bottlenecks, as well as much easier to understand where to start looking for a problem.  Tools are secondary.  Before you run a bunch of tools, you need to understand what the various resources are, how they can be overloaded, and how to test the proposed hypotheses to make progress.  For example, you can spend days optimizing CPU performance when executing some sorting algorithm, but after that you find that it takes 99% of the time to request data from the database, so more or less efficient sorting does not contribute to the total execution time. <br><br>  <b>JUG.Ru Group:</b> <i>Can you talk about the main features of the toolkit using the example of BPF?</i> <br><br>  <b>Sasha Goldstein:</b> BPF is a powerful kernel engine, introduced in the latest versions of Linux kernels and allows for the introduction of dynamic trace programs into the kernel.  These programs are controlled safely and cannot lead to a system crash, nor do they require compiling and loading kernel modules.  As a result, we have a trace framework that can work very close to the source of major events, in particular, to the processing of network packets, sending requests to the disk, processing hardware interrupts, and similar.  Anticipating your question, I note that there are also some JVM-specific events that I will consider as part of the <a href="https://jpoint.ru/talks/fast-and-safe-production-monitoring-of-jvm-applications-with-bpf-magic/">report at the JPoint</a> : garbage collection, distribution of objects, blocking for the release of the monitor, and many others. <br>  Moreover, BPF allows you to create tools in which aggregation occurs at the tracer level ‚Äî for example, if you are worried about a histogram of delays (for example, HTTP request delays), you do not need to dump a million events, and then post-process to calculate the histogram.  Instead, your BPF program provides aggregation in real time and gives only the final result for analysis. <br>  There is a very powerful toolkit that is developed by people from Facebook, Netflix, Plumgrid (VMWare) and other companies (including with my modest participation :-)). <br><br>  <b>JUG.Ru Group:</b> <i>How difficult is it to implement in the workflow and development?</i> <br><br>  <b>Sasha Goldstein:</b> BPF is not difficult to use, because there are a lot of tools called by just one command line that can be used to identify performance problems.  For example, there is a tool called mysqld_slower that outputs slow MySQL queries. <br>  The only problem is that you need to install a new Linux kernel in order to use BPF tools.  Most of the functionality was included in Linux 4.1 and 4.4 (which you have in Ubuntu 16.04, for example), but other functions require even newer versions, in particular, 4.9, which most people don't have in production yet.  This of course can be circumvented by updating only the kernel, thanks to this approach of the company, such as Facebook, Netflix and others, got all the benefits of BPF. <br><br><img src="https://habrastorage.org/files/cef/faf/4ad/ceffaf4ad021450d95998091a9b3c7a3.jpg"><br><br>  <b>JUG.Ru Group:</b> <i>Is it possible to give an example of ‚Äútypical rakes‚Äù in working with performance, which BPF-based toolkits can fight with?</i> <br><br>  <b>Sasha Goldstein:</b> BPF tools are useful for diagnosing applications that are limited by processor capabilities, blocking time (locking, I / O), file access problems, slow database queries, network queries, garbage collection ‚Äî in fact, a very wide range of problems.  I will consider many of them in my report. <br><br>  <b>JUG.Ru Group:</b> <i>Are there any tasks that only this toolkit allows you to deal with?</i> <br><br>  <b>Sasha Goldstein:</b> Yes.  When you need to process a large number of events with a tracer, BPF is irreplaceable.  Even fairly simple scripts, such as CPU profiling, can be made much more efficient by using BPF profiling support.  In most cases, solving problems, such as processing each incoming request and aggregating delay information, is not practical with other performance analysis tools. <br>  In my report, we will look at blocking monitoring, DNS resolution, MySQL queries and a bunch of other problems that can be called typical for production systems. <br><br>  <b>JUG.Ru Group:</b> <i>Your report is more practical.</i>  <i>Who is he primarily focused on?</i> <br><br>  <b>Sasha Goldstein:</b> My report is intended for developers and operating engineers (Ops Engineer), developing software for Linux.  The focus will be on the JVM (because this is a JPoint!), So all the examples will be in Java.  We‚Äôll look at a bunch of examples that I hope will be useful for diagnosing problems with their own systems ‚Äî and even if you don‚Äôt have a fresh enough version of the Linux kernel today, it will appear in the very near future.  I think every Linux developer will one day find uses for BPF tools. <br><br><hr><br>  <s>If you have questions, suggestions or comments - ask, Sasha is ready to answer them in the comments.</s> <s><br><br></s>  <s>PS In addition to Sasha, at <a href="https://jpoint.ru/"><b>JPoint 2017</b></a> Alexey <a href="https://twitter.com/shipilev">@shipilev</a> Shipilev, Sergey <a href="https://habrahabr.ru/users/walrus/" class="user_link">Walrus</a> Kuksenko, Vladimir <a href="https://habrahabr.ru/users/vladimirsitnikov/" class="user_link">vladimirsitnikov</a> Sitnikov and Nikolai <a href="https://habrahabr.ru/users/xpinjection/" class="user_link">xpinjection</a> Alimenkov will tell about the performance.</s>  <s>What exactly?</s>  <s>See the <a href="https://jpoint.ru/talks/">list of reports</a> .</s> <s><br><br></s>  <s>And if you live in Siberia and you don‚Äôt get to Moscow, we recommend that you look to <b><a href="https://2017.jbreak.ru/">JBreak 2017</a></b> .</s> <br><br>  <b>UPD.</b>  On the fifth of November in St. Petersburg we do training with Sasha - ‚ÄúProfiling JVM Applications in Production‚Äù, registration and participation conditions are <b><a href="https://jokerconf.com/2017/trainings/68vqefxcugkwc0wsk6gic/">on the site</a></b> . </div><p>Source: <a href="https://habr.com/ru/post/320620/">https://habr.com/ru/post/320620/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320602/index.html">Fighting cheaters in online games: 22 ‚Äúmust‚Äù and ‚Äúcannot‚Äù</a></li>
<li><a href="../320604/index.html">What has changed in 2016 in the field of programming? Results of the past year and plans for 2017</a></li>
<li><a href="../320610/index.html">Paradise perfectionist or what should be cable management</a></li>
<li><a href="../320612/index.html">A little more about Xiaomi phones and fighting with them. Updated</a></li>
<li><a href="../320614/index.html">‚ÄúWe have come from the corner,‚Äù or who might be forced out of the market by a competitor. Part One, Pessimistic</a></li>
<li><a href="../320622/index.html">February 11: The Techleads meetup. How to create and maintain dynamic development</a></li>
<li><a href="../320624/index.html">Connecting ATOL KKM to AndroidStudio (update to FZ-54)</a></li>
<li><a href="../320632/index.html">‚ÄúThe worst practices‚Äù of working with backup products on the example of Veeam Backup & Replication</a></li>
<li><a href="../320634/index.html">Disassemble it: Kaspersky Lab announces the start of the CrackMe winter competition</a></li>
<li><a href="../320636/index.html">How is storage different from chicken?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>