<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Choosing a disk system for the database MySQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For many large high-load web projects, the speed of database operation is often a bottleneck in performance. You can add memory, tyunit certain parame...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Choosing a disk system for the database MySQL</h1><div class="post__text post__text-html js-mediator-article">  For many large high-load web projects, the speed of database operation is often a bottleneck in performance.  You can add memory, tyunit certain parameters ... But in the end, most often everything depends on the disk. <br><br><img src="https://habrastorage.org/storage1/e9c280ce/2f1e80b6/cc70b220/fae9fbd4.jpg"><br><br>  We ourselves experienced similar bottlenecks on our own projects, periodically observing disc utilization close to 100% in iostat. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      About our experience in solving this issue and want to tell you in this post ... <a name="habracut"></a><br><br>  The first (and the most seemingly obvious) solution is to <b>use faster disks</b> . <br><br>  The fastest currently - probably, SSD. <br><br>  SSD drives work very, very fast!  But‚Ä¶ <br><ul><li>  Requires SSD support in servers (controller, drivers). </li><li>  SSD is expensive. </li></ul><br>  Even Domas Mituzas (a database performance engineer on Facebook), who spoke at the recent Highload ++ 2011 conference, said something like: " <i>If we could use SSD everywhere, we wouldn‚Äôt need to invent anything at all in terms of performance, our entire the work would not make much sense</i> . " <br><br>  Another approach is to <b>use not one, but several disks.</b>  <b>RAID, in other words</b> . <br><br>  We already wrote that we are hosting our own projects in the Amazon cloud.  And successfully and successfully <a href="http://habrahabr.ru/company/bitrix/blog/127932/">work with software RAID, collected from Amazon EBS disks</a> . <br><br>  <a href="http://ru.wikipedia.org/wiki/RAID">There</a> are a lot of <a href="http://ru.wikipedia.org/wiki/RAID">different RAID configurations</a> . <br><br>  Surely, many of you have already seen and read the <a href="http://www.mysqlperformanceblog.com/2009/08/06/ec2ebs-single-and-raid-volumes-io-bencmark/">results of tests on EBS disks in Amazon, published in MySQL Performance Blog</a> . <br><br>  They are quite curious and interesting, but they did not suit us very much.  Basically, by the fact that very different results are not correctly compared (for example, reading from one disk in one stream, RAID 0 - 8 threads, RAID 10 - 4; etc.) <br><br>  Therefore, we decided to conduct our own testing.  The same tool - sysbench. <br><br>  We decided to work with RAID 10. It is at the same time fast and reliable.  And, here, its various configurations - it is a lot of. <br><br>  A small retreat.  In the process of testing, we appreciated another very important advantage of the ‚Äúcloud‚Äù: <b>in the ‚Äúcloud‚Äù it is very convenient to conduct a variety of tests, collecting and disassembling any test stands!</b>  <b>And at the same time to pay - only for the time of real use!</b> <br><br>  <b>So.</b>  <b>We have collected 5 stands.</b> <br><br>  <b>1. single disk - 100 Gb</b> <br><br>  <b>2. RAID 10 - 4 50 Gb drives</b> <br><br>  They added 4 disks in the Amazon admin panel, connected them by assigning appropriate names, and then created a raid like this: <br><br> <code># mdadm --create /dev/md0 --level=10 --raid-devices=4 /dev/xvd[gj]</code> <br> <br>  <b>3. RAID 10 - RAID 0 of two RAID 1 (each with 2 disks of 50 Gb each)</b> <br><br>  The same procedure, but the final raid is created in three steps: <br><br> <code># mdadm --create /dev/md0 --level=1 --raid-devices=2 /dev/xvd[gh] <br> # mdadm --create /dev/md1 --level=1 --raid-devices=2 /dev/xvd[ij] <br> # mdadm --create /dev/md2 --level=0 --raid-devices=2 /dev/md[0-1]</code> <br> <br>  <b>4. RAID 10 - 8 25 Gb drives</b> <br><br>  Similar to paragraph 2, but only connect 8 drives, not 4. <br><br> <code># mdadm --create /dev/md0 --level=10 --raid-devices=8 /dev/xvd[gn]</code> <br> <br>  <b>5. RAID 10 - RAID 0 of four RAID 1 (each with 2 disks of 25 Gb)</b> <br><br> <code># mdadm --create /dev/md0 --level=1 --raid-devices=2 /dev/xvd[gh] <br> # mdadm --create /dev/md1 --level=1 --raid-devices=2 /dev/xvd[ij] <br> # mdadm --create /dev/md2 --level=1 --raid-devices=2 /dev/xvd[kl] <br> # mdadm --create /dev/md3 --level=1 --raid-devices=2 /dev/xvd[mn] <br> # mdadm --create /dev/md4 --level=0 --raid-devices=4 /dev/md[0-3]</code> <br> <br>  The ext4 file system was used on all test benches.  Mount options: <br><br> <code>noatime,nodiratime,data=writeback,barrier=0</code> <br> <br>  For the tests used sysbench - 256 MB file;  modes - random read, random write, random read / write;  different number of threads - from 1 to 16. <br><br><img src="https://habrastorage.org/storage1/5715e9df/64dd1e40/1c4e1dcd/5d5a3c1b.png"><br><br><img src="https://habrastorage.org/storage1/df44ed8b/e6bf8c50/1617f9bf/23a4ecb2.png"><br><br><img src="https://habrastorage.org/storage1/9824adda/c7e19c5c/9f14f347/5b79db03.png"><br><br>  X axis - the number of threads <br>  Y axis - the number of operations per second. <br><br>  On reading - everything is comparable in results.  Raid does not give much advantage. <br><br>  But this picture is very distorted, since the file cache has greatly influenced the results (the test file is placed in RAM entirely). <br><br>  According to the record, some raids are losing (some overheads have an effect). <br><br>  * * * <br><br>  Any question that begins with the words "What is better ..." does not make sense in itself. <br><br>  Which CMS is better? <br><br>  Which database to choose? <br><br>  What is better to choose as a RAID? <br><br>  <b>With any choice, the set and solved tasks are always important!</b> <br><br>  We choose a disk system for the database.  The format of data storage with us is InnoDB. <br><br>  This means that, basically, we work with large files (several GB) of ibdata. <br><br>  A typical load profile is random read / write (more reads). <br><br>  And now, based on a more understandable real problem, we are doing a new series of tests - on a 16 GB file. <br><br><img src="https://habrastorage.org/storage1/2493389f/10b636ac/04702d47/0aa91062.png"><br><br><img src="https://habrastorage.org/storage1/4dbf86e0/2dd457c8/f091eb3d/39126521.png"><br><br><img src="https://habrastorage.org/storage1/92a1b8e2/d588080e/649a7947/38e14f6c.png"><br><ul><li>  Reading - one disc immediately rests against the ceiling.  Increasing the number of threads does not increase performance. </li><li>  Raids from 4 disks on several streams give a performance increase of 3-4 times.  Raids from 8 discs - 6-7 times. </li><li>  On the record - about the same picture as with one disc. </li></ul><br>  * * * <br><br>  <b>We summarize.</b> <br><br>  The typical work of the MySQL database is random read / write, there are more reads than records.  The most productive for this task - RAID 10 with a large number of disks. <br><br>  The minus of such a solution is double the cost of the disks (which, at their current cost, is not critical). <br><br>  The main advantage is that we have a simple solution (software RAID can be collected both on a physical server and in the cloud) for scaling the performance of a disk system. </div><p>Source: <a href="https://habr.com/ru/post/130096/">https://habr.com/ru/post/130096/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../130091/index.html">Free software at school or three days spent with benefit</a></li>
<li><a href="../130092/index.html">CPIO under the microscope</a></li>
<li><a href="../130093/index.html">Understanding WinAPI</a></li>
<li><a href="../130094/index.html">A special case of using Sikuli to solve a problem on Facebook</a></li>
<li><a href="../130095/index.html">German police accused of using spyware</a></li>
<li><a href="../130098/index.html">Plex Media Center</a></li>
<li><a href="../130101/index.html">Non-blocking queues: message exchange between threads</a></li>
<li><a href="../130102/index.html">Do you often use bank plastic cards?</a></li>
<li><a href="../130103/index.html">Seminar "What is the use of metrics?" In St. Petersburg</a></li>
<li><a href="../130104/index.html">The first startup incubator in Moldova - ‚ÄúSimpals Garage‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>