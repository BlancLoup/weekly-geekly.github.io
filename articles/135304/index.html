<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Top Qt Quick Techniques: Components</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="QML provides a convenient way to break code called "Components." The easiest way to create a component that can later be used repeatedly is to add a n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Top Qt Quick Techniques: Components</h1><div class="post__text post__text-html js-mediator-article">  QML provides a convenient way to break code called "Components."  The easiest way to create a component that can later be used repeatedly is to add a new file to the working directory of the main QML file. <br><br>  <b>Example.qml:</b> <br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> QtQuick <span class="hljs-number"><span class="hljs-number">1.0</span></span> Rectangle { }</code> </pre> <br>  <b>main.qml:</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> QtQuick <span class="hljs-number"><span class="hljs-number">1.0</span></span> Example { }</code> </pre> <br><br>  Also, components can be packaged as modules (Qt Components are such a module) and published as plug-ins.  This post focuses on using components to write clean and easily maintained QML code. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Creating new components </h4><br>  The first example showed the simplicity of creating additional components, so do not be afraid to use them. <br><a name="habracut"></a><br>  Do not write reusable code as your first priority.  Aim to encapsulate implementation details and reduce decoupling of components.  Components should be small.  Following these rules you will automatically come to the code, which later can be used repeatedly. <br><br>  Let's look at this example of a simple analog clock: <br><br>  <a href="https://gitorious.org/qtquick-best-practices/02-components/archive-tarball/clock">download an example</a> / <a href="https://gitorious.org/qtquick-best-practices/02-components/trees/clock">view online</a> <br>  <b>main.qml:</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> QtQuick <span class="hljs-number"><span class="hljs-number">1.0</span></span> <span class="hljs-comment"><span class="hljs-comment">//      . Rectangle { id: root width: 320 height: 320 property variant now: new Date() Timer { id: clockUpdater interval: 1000 //     running: true repeat: true onTriggered: { root.now = new Date() } } Clock { id: clock anchors.centerIn: parent hours: root.now.getHours() minutes: root.now.getMinutes() seconds: root.now.getSeconds() } }</span></span></code> </pre> <br>  <b>Clock.qml:</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> QtQuick <span class="hljs-number"><span class="hljs-number">1.0</span></span> <span class="hljs-comment"><span class="hljs-comment">//  ,   ,   . Rectangle { id: root width: 262 //   height: 262 //   // public: property int hours: 0 property int minutes: 0 property int seconds: 0 // private: Item { id: impl Image { id: face source: "images/face.png" Image { id: shorthand source: "images/shorthand.png" smooth: true rotation: root.hours * 30 } Image { id: longhand source: "images/longhand.png" smooth: true rotation: root.minutes * 6 } Image { id: thinhand source: "images/thinhand.png" smooth: true rotation: root.seconds * 6 } Image { id: center source: "images/knob.png" } } } }</span></span></code> </pre> <br><br>  This code contains the Clock component, which at startup looks like the one shown in the screenshot below.  Despite the fact that it is used in the application once, it made sense to select it from the main file. <br><br><img src="https://habrastorage.org/storage2/09f/ada/307/09fada3072522ab611df7efdf2bfad89.png"><br><br>  First, it makes the logic that remains in the main.qml file simple and understandable: the timer that updates the hours, minutes, and seconds of the Clock component is all that the developer needs to see in main.qml if he wants to add functionality to it. <br><br>  Secondly, our Clock component may not worry about its own location in the window.  Suppose there is a Row element that uses our Clock component N times.  If the root element of the Clock component had the code 'anchors.fill: parent', we could not use its instances in the Row element: each instance of Clock would occupy the entire width_row, instead of width_row / N. That is why QML prohibits the use of most anchors (anchors ) in the elements placed in the element Row.  If we want our Clock component to remain reusable, we should not make many assumptions about its future use.  Summarizing, the root element of the component should not contain anchors to its parent or use hard-coded placement managers (layouts). <br><br>  At the same time, the Clock component sets fixed values ‚Äã‚Äãto its length and width.  From the semantic point of view, these are the dimensions of our default component.  They do not limit the use of our component, because the size of its copies can be changed if necessary.  Zero-sized components are considered invisible elements, so setting non-zero sizes by default allows you to avoid silly mistakes. <br><br>  There are also other, less obvious advantages, such as creating composite elements and encapsulating implementation details. <br><br>  Creating a composite element (let's call it ComposedElement) from the simple elements ElementA, ElementB and ElementC makes it easy to add new properties and actions to the elements.  We can add new ElementD and ElementE elements to our ComposedElement without having to change ElementA, ElementB or ElementC.  Our simple elements are isolated from each other and, therefore, cannot just break down if one of them suddenly changes. <br><br>  Components can be divided into public and private parts, just as is done in C ++ and Java classes.  The public API of a component is the sum of all its properties and methods defined in the root element (including the properties inherited by it).  This means that such properties can be changed, and such methods can be called by users of the component. <br><br>  Any property or method defined in a nested element (not root) can be considered a completely private API.  This allows you to encapsulate implementation details and should, as a result, become commonplace when developers create components. <br><br>  To prove the use of encapsulation, we can remove the inner element 'impl' from Clock.qml and start the application again (for example, through $ qmiviewer main.qml).  No new errors will be visible, since the public API of the Clock component has not been modified.  This means that we can freely change 'impl', knowing that no third-party effects from such changes for other components will appear. <br><br>  We can even extend this idea and allow Clock.qml to load any 'impl' element dynamically, depending on the situation.  This introduces the concept of polymorphism in QML;  the implementation of such a mechanism remains to the reader as an exercise. <br><br>  If we have a well-designed, minimal public API for each component, we can focus on developing the interfaces, and not the specific implementation. <br><br><h4>  Component reuse </h4><br>  Check if we can actually reuse the Clock.qml component.  It is perfect for creating clocks that display world time.  In this case, we do not need a second hand on them.  We can slightly change the behavior of Clock.qml so that the latter does not display the hours, minutes or seconds if their value is less than zero.  For the Image element with id = thinhand, we can associate the visible property with the number of seconds: <br><br><pre> <code class="cpp hljs">visible: root.seconds &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span></code> </pre> <br><br>  We did not change the public API.  We also believe that using negative values ‚Äã‚Äãfor seconds in an analog clock still makes no sense.  Therefore, we are confident that this change will not affect the operation of existing applications that use the Clock component. <br><br>  In our world clock example, we can, among other things, display local weather information.  We can use one of the available weather services APIs along with the XmlListModel, which allows you to retrieve data from the API declaratively.  The timer, which was previously used only to update the time on the clock, will now be used to update weather data once an hour.  Notice how the update signal is entered, which is connected to the XmlListModel data update function. <br><br>  The modified example displays the world clock and local weather information for the three cities. <br><br><img src="https://habrastorage.org/storage2/5bb/759/f63/5bb759f632ce1b91c21a423b845b53db.png"><br><br>  The Clock component integrates trivially.  We disabled the second hand and used UTC for time values ‚Äã‚Äãalong with the offset for a particular city.  This worked because Clock was designed as a simple interface element.  If we had a timer inside the component (instead of letting the hours, minutes, and seconds change as the properties of the component), this would complicate the work.  Unfortunately, main.qml has grown significantly in size.  The Repeater element has contributed to the complexity of the project, as well as the utcOffsets and cities arrays. <br><br>  <a href="https://gitorious.org/qtquick-best-practices/02-components/archive-tarball/weatherworldclock">download an example</a> / <a href="https://gitorious.org/qtquick-best-practices/02-components/trees/weatherworldclock">view online</a> <br>  <b>main.qml:</b> <br><pre> <code class="cpp hljs">Rectangle { ... property variant cities: [<span class="hljs-string"><span class="hljs-string">"Berlin"</span></span>, <span class="hljs-string"><span class="hljs-string">"Helsinki"</span></span>, <span class="hljs-string"><span class="hljs-string">"San Francisco"</span></span>] property variant utcOffsets: [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">-8</span></span>] property variant now: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Date() signal refresh() Timer { ... property <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> hours onTriggered: { hours = root.now.getHours() root.now = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Date() <span class="hljs-comment"><span class="hljs-comment">//      : if (hours != root.now.getHours()) { root.refresh() } } } Row { anchors.horizontalCenter: parent.horizontalCenter Repeater { model: root.cities //           . Rectangle { id: current width: 262 //   height: 320 //   property string city: cities[index] property int utcOffset: utcOffsets[index] XmlListModel { id: cityQuery ... } ListView { model: cityQuery anchors.fill: parent delegate: Item { Clock { id: clock anchors.left: parent.left anchors.top: parent.top // ,  UTC      , //     : hours: root.now.getUTCHours() + current.utcOffset + 24 minutes: root.now.getMinutes() seconds: -1 } Row { ... Image { id: icon source: "http://www.google.com" + model.iconUrl } Text { id: label text: current.city + ", "+ model.temperature + "¬∞C\n" + model.humidity + "\n" + model.windCondition } } } } } } } }</span></span></code> </pre> <br><br>  Our goal is to make main.qml easy to understand.  At the same time, we do not want to make Clock.qml unnecessarily complicated, because, in this case, it will be difficult to use it as a simple analogue clock.  Therefore, we created a new component consisting of weather data collection and the Clock component.  It contains a timer, update logic, XmlListModel, and Clock integration.  Instead of directly setting the utcOffsets and cities arrays here, we add new public properties for the WeatherWorldClock component: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// public: property string city: "" property int utcOffset: 0</span></span></code> </pre> <br><br>  We can remove these arrays and Repeater from main.qml. <br><br>  <a href="https://gitorious.org/qtquick-best-practices/02-components/archive-tarball/weatherworldclock-final">download an example</a> / <a href="https://gitorious.org/qtquick-best-practices/02-components/trees/weatherworldclock-final">view online</a> <br>  <b>main.qml:</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> QtQuick <span class="hljs-number"><span class="hljs-number">1.0</span></span> <span class="hljs-comment"><span class="hljs-comment">//       . Rectangle { id: root width: 786 height: 320 Row { id: cities anchors.fill: parent anchors.horizontalCenter: parent.horizontalCenter WeatherWorldClock { city: "Berlin" utcOffset: 1 } WeatherWorldClock { city: "Helsinki" utcOffset: 2 } WeatherWorldClock { city: "San Francisco" utcOffset: -8 } } }</span></span></code> </pre> <br><br>  The WeatherWorldClock component is isolated from changes in main.qml.  We can supplement and change its properties in any file and not worry about something going wrong.  If WeatherWorldClock becomes too complex to support, it can be divided into more components.  That is why it is very important that the main logic of our application now looks extremely simple: we initialize the components of WeatherWorldClock and specify the city and its UTC offset.  That's all! <br><br><h4>  Conclusion </h4><br>  This article showed how it is possible to maintain the purity and consistency of the code of an evolving and complicating example using components and applying the well-known principles of object-oriented design.  At one point ‚Äî when we added the ability to view the weather to our example ‚Äî we stopped following our components, so the application logic became more complicated.  It was demonstrated in such a simple way that maintaining cleanliness and order in a QML code is a serious work and requires a certain discipline from the developer. </div><p>Source: <a href="https://habr.com/ru/post/135304/">https://habr.com/ru/post/135304/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135297/index.html">Changes in the Criminal Code, which may affect many</a></li>
<li><a href="../135299/index.html">Execution of a piece of code on behalf of a specific user</a></li>
<li><a href="../135301/index.html">Project Venus = Communism + Anarchy + Bash Script for Government</a></li>
<li><a href="../135302/index.html">HP releases 10-petabyte D2D system</a></li>
<li><a href="../135303/index.html">Citrix XenServer Free: Hypervizor hardening with PAM and RBAC</a></li>
<li><a href="../135306/index.html">How to shoot a shooter</a></li>
<li><a href="../135307/index.html">Save time or manage it?</a></li>
<li><a href="../135310/index.html">Object-Oriented Gin Installer Development</a></li>
<li><a href="../135312/index.html">Video from Web Standards Days in Moscow</a></li>
<li><a href="../135316/index.html">Some conclusions about IP-telephony - the main digital signal, codecs, bandwidth</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>