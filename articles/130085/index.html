<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Encryption / decryption of data on the client in web-based systems</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nowadays, more and more programs are translated into the so-called ‚Äúweb-oriented‚Äù view, that is, the client-server principle is used, which allows sto...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Encryption / decryption of data on the client in web-based systems</h1><div class="post__text post__text-html js-mediator-article">  Nowadays, more and more programs are translated into the so-called ‚Äúweb-oriented‚Äù view, that is, the client-server principle is used, which allows storing data remotely and accessing them through a thin client (browser). <br>  At the same time with the ease of use, there is an acute question about the security of this data.  Confidential information may be available to other people in several ways.  Firstly, physical measures can be applied to the user to retrieve.  Secondly, during transmission, data can be intercepted by various sniffers.  And, thirdly, hacker attacks can be made to the server, which will allow attackers to steal information, or an unscrupulous server administrator will use it for personal purposes. <br><br><h4>  Task </h4><br>  Some time ago I had a task to develop a prototype of the program for encrypting / decrypting data on the client side in web-oriented systems. <br><a name="habracut"></a><br>  That is, it was necessary to develop a program that will allow not only to store data on the server, but also provide an opportunity to work with them through the web interface and at the same time ensure their uselessness for attackers in case of theft, which is achieved by encrypting / decrypting exclusively on the client side. <br>  For a typical use case, it is possible to work with three types of data: <br><ul><li>  plain text entered into the form input fields and stored on the server in the database in encrypted form </li><li>  files that are stored on the server in encrypted form, and if necessary, the user can download them </li><li>  images stored on the server as encrypted files, but if necessary they are decrypted on the client side and inserted into the web-page as ordinary pictures. </li></ul><br><br><h4>  Implementation </h4><br>  The fact that data processing should be done exclusively on the client side, limited the choice of means for implementation.  At the initial stage of development, a bunch of ‚ÄúJava applet - Java servlet‚Äù was tested, but after some time I had to find another way, because there were difficulties in debugging and transferring data between the applet and the servlet. <br>  I dwelled on using the features of HTML5 and the JavaScript object ‚ÄúXmlHttpRequest Level 2‚Äù in particular, because they made it possible to implement the necessary functionality with less effort. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Work with text </h5><br>  Encryption Algorithm: <br><ul><li>  we enter the text in the form field on the web page </li><li>  encrypt text using java script functions </li><li>  We send the cipher text to the server, where we save it to the database. </li></ul><br>  Reverse process: <br><ul><li>  we get the encrypted data from the database from the server </li><li>  we decrypt them using java script functions </li><li>  We display the decrypted text in the right place on the web page. </li></ul><br><br><h5>  Work with files </h5><br>  The process of encrypting / decrypting files occurs in a slightly different way. <br>  Encryption Algorithm: <br><ul><li>  we select the file from the user's computer </li><li>  get the contents of the file into a Java Script object using XmlHttpRequest Level 2 and HTML 5 features </li><li>  encrypt it using java script functions </li><li>  we send the ciphered data to the server where we save as a file. </li></ul><br>  Reverse process: <br><ul><li>  get the contents of the encrypted file from the server </li><li>  write it to a java script object using XmlHttpRequest Level 2 and HTML 5 features </li><li>  decrypt using java script functions </li><li>  We transfer the decrypted data to a Java applet to give the user the opportunity to specify the path and name for the saved file, because at the moment of technology development in browsers it is impossible to routinely call the save file dialog to an arbitrary location on the user's computer, only in a limited sandbox that does not suit us.  If for some reason the use of a Java applet is not suitable, this part can be replaced with Flash with similar functionality. </li></ul><br><br><h5>  Work with images </h5><br>  Encryption Algorithm: <br><ul><li>  select the image file from the user's computer </li><li>  write its contents to a Java Script object using XmlHttpRequest Level 2 and HTML 5 features </li><li>  base64 encoded </li><li>  encrypted using java script functions </li><li>  we send the ciphered data to the server where we save in the file. </li></ul><br>  Reverse process: <br><ul><li>  get the contents of the encrypted image from the server </li><li>  write it to a java script object using XmlHttpRequest Level 2 and HTML 5 features </li><li>  we decrypt using java script functions.  At this stage we receive the image encoded in Base64 format </li><li>  insert content into a tag on a web page (browsers by default support insertion of Base64 images). </li></ul><br><br>  Some key source code for working with files: <br><pre><code class="javascript hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt; <span class="hljs-comment"><span class="hljs-comment">/** *        * XMLHttpRequest level 2 */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">upload</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">blobOrFile</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); <span class="hljs-comment"><span class="hljs-comment">//    POST,  URL  true=  xhr.open('POST', '/File/UploadFile/', true); //   -   xhr.responseType = "arraybuffer"; //    xhr.setRequestHeader("Content-type", "multipart/form-data"); xhr.onload = function(e) { // ... }; xhr.send(blobOrFile); //   } //      document.querySelector('input[type="file"]').addEventListener('change', function(e) { var file = this.files[0]; //      var reader = new FileReader(); reader.onloadend = function(e) { var result = this.result; //    var arr = new Int8Array(result); var i; //   var newResult = new ArrayBuffer(arr.byteLength); var newRes = new Int8Array(newResult); var keyForEncrypt = $('#keyForEncrypt').val(); for(i = 0; i &lt; arr.byteLength; i++) { //    newRes[i] = arr[i] + parseInt(keyForEncrypt, 10); } //   upload(newRes.buffer); }; //      //   Chrome 11.0.696.68,    FireFox 4.0.1 reader.readAsArrayBuffer(file); }, false); /*** *         , *        Java  *      */ function download() { var xhr = new XMLHttpRequest(); xhr.open('POST', '/File/DownloadFile/', false); xhr.responseType = 'arraybuffer'; xhr.onload = function(e) { var arr = new Int8Array(this.response); // this.response == arr.buffer //     upload(arr.buffer); var result = new Array(arr.byteLength); var keyForDecrypt = $('#keyForDecrypt').val(); for(var i = 0; i &lt; arr.byteLength; i++) { result[i] = arr[i] - parseInt(keyForDecrypt, 10); } saveFileByApplet(result); }; xhr.send(); } function saveFileByApplet(data) { //     var cryptApplet = document.CryptApplet; cryptApplet.saveFile(data); } $(document).ready(function() { $('#saveFileButton').click(function() { download(); }); }); &lt;/script&gt;</span></span></code> </pre> <br><br>  Source code for working with images: <br><pre> <code class="javascript hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> selectedFile = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     document.querySelector('input[type="file"]').addEventListener('change', function(e) { selectedFile = this.files[0];//      }, false); $(document).ready(function() { $('#uploadPictureButton').click(function() { //    -  if(selectedFile != null) { var reader = new FileReader(); reader.onload = function(e) { //    var result = this.result; //   Base64 var base64Result = Base64.encode(result); //   XOR   var keyForEncrypt = $('#keyForEncrypt').val(); var encryptedData = XOREncrypt(base64Result, keyForEncrypt); //   uploadPicture(encryptedData); }; //      reader.readAsBinaryString(selectedFile); } }); $('#downloadPictureButton').click(function() { downloadPicture(); }); }); /** *         5   */ function buildExtension() { if(selectedFile != null) { var ext = ""; var fullName = selectedFile.name; for(var i = fullName.length - 1; i &gt;= 0; i--) { if(fullName[i] == '.') break; else ext += fullName[i]; } ext = ext.split('').reverse().join(''); if(ext.length &lt; 5) { for(var i = 0; i &lt;= 5-ext.length; i++) { ext += " "; } } return ext; } } /** *        * XMLHttpRequest level 2 */ function uploadPicture(picture) { var xhr = new XMLHttpRequest(); //    POST,  URL  true=  xhr.open('POST', '/Picture/UploadPicture/', true); xhr.onload = function(e) { // ... }; var sentData = "jpg " + picture; //   xhr.send(sentData); } /*** *      ,  XOR,  , *        SRC  IMG */ function downloadPicture() { var xhr = new XMLHttpRequest(); xhr.open('POST', '/Picture/DownloadPicture/', true); xhr.onload = function(e) { //  -  Base64,  XOR var result = this.response; //  5  -  var ext = rtrim(result.substr(0, 5)); //   Base64 var base64Data = result.substr(5); var keyForDecrypt = $('#keyForDecrypt').val(); var decryptedData = XORDecrypt(base64Data, keyForDecrypt); //  MIME      var mime = ""; switch (ext) { case "jpeg" : case "jpg" : case "jpe" : mime = "image/jpeg"; break; case "gif" : mime = "image/gif"; break; case "png" : mime = "image/png"; break; default: mime = "image/jpeg"; break; } $('#pict').attr('src', "data:" + mime + ";base64," + decryptedData); }; xhr.send(); } /** *  PHP- rtrim -    */ function rtrim ( str, charlist ) { charlist = !charlist ? ' \\s\u00A0' : (charlist + '').replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^\:])/g, '\\$1'); var re = new RegExp('[' + charlist + ']+$', 'g'); return (str + '').replace(re, ''); } &lt;/script&gt;</span></span></code> </pre><br><br>  I did not give here the implementation of the XOREncrypt, XORDecrypt and Base64 functions, so as not to clutter an already long listing.  They can be viewed in the attached archive with the source code. <br><br>  Java applet code to display the file save dialog. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> ExtPackage; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.applet.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.FileOutputStream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.swing.JFileChooser; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.swing.*; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CryptApplet</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Applet</span></span></span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> FileNotFoundException, IOException </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     final JFileChooser fc = new JFileChooser(); fc.showSaveDialog(CryptApplet.this); //    ,   File file = fc.getSelectedFile(); OutputStream out = new FileOutputStream(file); //      out.write(data); out.flush(); out.close(); } }</span></span></code> </pre><br><br><h4>  Summary </h4><br>  I hope the results I received will save some time for those who are faced with the task of encrypting / decrypting data on the client in web-based systems.  Source code - in the attached <a href="https://docs.google.com/viewer%3Fa%3Dv%26pid%3Dexplorer%26chrome%3Dtrue%26srcid%3D0BzMJ278sp0t0YTc2YzgzNGEtMjUzNi00NTA0LThhNjEtOTYxZGRjNjc1YWRj%26hl%3Den_US">archive.</a> </div><p>Source: <a href="https://habr.com/ru/post/130085/">https://habr.com/ru/post/130085/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../130074/index.html">VHF echo repeaters</a></li>
<li><a href="../130075/index.html">‚ÄúCreating a National Software Platform is an important step towards building an information society‚Äù</a></li>
<li><a href="../130081/index.html">Japanese cloned teeth</a></li>
<li><a href="../130082/index.html">Creating a simple module for CMS Datalife Engine (DLE)</a></li>
<li><a href="../130084/index.html">Excel Add-in Guide for Beginners</a></li>
<li><a href="../130086/index.html">PHP sample development case using TDD</a></li>
<li><a href="../130087/index.html">My experience of writing a program for Android</a></li>
<li><a href="../130088/index.html">Writing a Redmine Plugin</a></li>
<li><a href="../130089/index.html">Imitation of named variables in LESS (with an example in jsFiddle)</a></li>
<li><a href="../130090/index.html">Firewalls - a bit of theory for beginners or what you need to know before you buy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>