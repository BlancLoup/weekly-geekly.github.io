<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We continue to disassemble Caesar III ¬© (Game mechanics)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The algorithms for obtaining the textures of the game Caesar III ¬© and the drawing of the city have been dismantled, the ‚Äúsweetest‚Äù part has remained,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We continue to disassemble Caesar III ¬© (Game mechanics)</h1><div class="post__text post__text-html js-mediator-article"> The algorithms <a href="http://habrahabr.ru/post/221913/">for obtaining the textures of the game Caesar III ¬©</a> and the <a href="http://habrahabr.ru/post/222943/">drawing of the city have been</a> dismantled, the ‚Äúsweetest‚Äù part has remained, which has attracted the ‚Äúancient Roman architects‚Äù for more than 15 years - the game logic.  Using various approaches to the analysis of the game, I stand in your court the result of this small study.  I apologize in advance for a great article, but, as they say, you cannot throw out the words from a song.  In conclusion, there will be a few words about the fate of the sources recovered from the executable file of the original game. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bc4/003/eba/bc4003eba04756d5e5104e4abd715d91.png"><br><a name="habracut"></a><br><br>  <b>A bit of history</b> <br>  The game is written in C, and is available for Windows and Mac.  The official release took place in October 1998.  Most likely for Windows, the game was compiled in Visual Studio 97, 6 the studio has not yet gained its popularity at that time.  In 1999, the game was updated to version 1.0.0.3, compiled already in Visual Studio 6, which was most widely used, and patch 1.1 (c3 1.0.1.0) was later released for English versions of the game. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Date compiled:</b> Fri, September 3, 1999, 7:31:17 AM <br>  <b>Linker version:</b> 6.0 <br>  <b>Machine type:</b> Intel 386 or later processors and compatible processors <br>  <b>PE format:</b> PE32 <br>  <b>Subsystem:</b> The Windows graphical user interface (GUI) subsystem <br>  <b>Min OS:</b> Windows 95 <br>  <b>Min OS version</b> : 4.0 <br>  <b>Subsystem version:</b> 4.0 <br>  <b>File version:</b> 0.0 <br><br>  Also, fans of the game have been modified executable files to run on <a href="http://www.reddit.com/r/impressionsgames/comments/186xvb/caesar_iii_search_for_widescreen_support/">high-resolution screens</a> . <br> <a href="http://www.radikal.ru/"><img src="https://habrastorage.org/getpro/habr/post_images/f7e/e37/c45/f7ee37c4566fa9b13de4a1246e41b5ee.jpg"></a> <br><br>  The game uses the graphic engine of the second part, there are also screenshots from the intermediate (maybe debug) version, where elements of the old graphic design are visible. <br><br>  <a href="http://www.caesar2.com/">Caesar II</a> <br> <a href="http://radikal.ru/fp/95f05f423d8847a19b0923d7c018e0d2"><img src="https://habrastorage.org/getpro/habr/post_images/fd0/dba/158/fd0dba15884a9f79cd4ddf887d84a696.jpg"></a> <a href="http://radikal.ru/fp/a870e5ec79cf474d95d34269e1b9ec4a"><img src="https://habrastorage.org/getpro/habr/post_images/805/084/406/805084406402cdf22e89c723a0b85dd1.jpg"></a> <a href="http://radikal.ru/fp/67139fdd789d466fa3f838bdcd83f951"><img src="https://habrastorage.org/getpro/habr/post_images/711/63e/c44/71163ec441ed839eedbd9f8ac7100b6e.jpg"></a> <br><br>  Caesar III (Alpha) <br>  Pay attention to the road, fishing boats and warehouse. <br> <a href="http://radikal.ru/fp/6aa2cd8019514215acafc8832019abf8"><img src="https://habrastorage.org/getpro/habr/post_images/a57/85d/ef8/a5785def8506a58f1685d388f3a0362e.jpg"></a> <a href="http://radikal.ru/fp/80fe119ca6594065b8301bab98b677d4"><img src="https://habrastorage.org/getpro/habr/post_images/8b5/7e1/d51/8b57e1d516e0244c06b74c857f112c77.jpg"></a> <br><br>  <a href="http://ru.wikipedia.org/wiki/Caesar_III">Caesar III (Final)</a> <br> <a href="http://radikal.ru/fp/ec57f5b90f3e452d9972224d2074ccad"><img src="https://habrastorage.org/getpro/habr/post_images/019/b5b/898/019b5b898e5a8c3087a8b4b726f192f6.jpg"></a> <a href="http://radikal.ru/fp/a703997b381d4830b7afa100e47e51e1"><img src="https://habrastorage.org/getpro/habr/post_images/2e7/1d3/12d/2e71d312d2bbc501dfae2ef33ed3018e.jpg"></a> <br><br>  <b>And now more substantively.</b> <br>  To begin with, in the game many variables are rigidly spelled out in the code in the form of ‚Äúmagic numbers‚Äù, the given code examples are taken from <a href="https://github.com/AntonBaracuda/opencaesar3/tree/master/c3_rev">the c3_rev directory</a> , the source code is compiled and run in debug mode, you can step through the logic.  Judging by the nick, our compatriot, who finished the source code to the working state, deals with the maintenance. <br>  Our gallant localizers, when russified the game, edited the binary code of the executable file, replacing c3.eng with c3.rus, incidentally breaking compatibility with later patches. <br><br><div class="spoiler">  <b class="spoiler_title">Main (recovered) function code</b> <div class="spoiler_text"><pre><code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> main(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> argc, char* argv[] ) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> eax@2 signed <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> v5; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> [sp+<span class="hljs-number"><span class="hljs-number">4</span></span>Ch] [bp-<span class="hljs-number"><span class="hljs-number">20</span></span>h]@7 struct tagMSG Msg; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> [sp+<span class="hljs-number"><span class="hljs-number">50</span></span>h] [bp-<span class="hljs-number"><span class="hljs-number">1</span></span>Ch]@21 HINSTANCE hInstance = GetModuleHandle(<span class="hljs-number"><span class="hljs-number">0</span></span>); byte_6606BC = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( fun_loadSettings() ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( fun_readLanguageTextFiles(<span class="hljs-string"><span class="hljs-string">"c3.eng"</span></span>, <span class="hljs-string"><span class="hljs-string">"c3_mm.eng"</span></span>) ) { fun_loadDefaultNames(); fun_logDebugMessage(<span class="hljs-string"><span class="hljs-string">"OK :Game text loaded."</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( fun_setupMainWindow(hInstance) ) {} .... //some code } } }</code> </pre> <br></div></div><br><br>  <b>Text resources / Localization</b> <br>  Most of the text of the game, with the exception of text data for missions, is in files C3.eng / C3_mm.eng <br>  File C3.eng contains descriptions of buildings, events, residents, etc.  It consists of a header, 28 bytes long, and an index table, 8000 bytes long.  The index table contains offsets, which are the text for the selected index.  The algorithm for obtaining text from a localization file is such that in order to get text, for example, for the title of the adviser on education with the index TITLE_ADVISOR_EDUCATION (16), select the 16th element from the array of indices and read the characters before the final 0 by the resulting offset. <br><br><div class="spoiler">  <b class="spoiler_title">Description of the heading and element of the index table</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">struct C3EngHeader { <span class="hljs-type"><span class="hljs-type">char</span></span> tag[<span class="hljs-number"><span class="hljs-number">16</span></span>]; //  <span class="hljs-type"><span class="hljs-type">int</span></span> numGroups ; //    <span class="hljs-type"><span class="hljs-type">int</span></span> numStrings ; //    <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-type"><span class="hljs-type">unknown</span></span> ; }; struct C3EngIndexEntry { <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span>; //   <span class="hljs-type"><span class="hljs-type">int</span></span> inUse; };</code> </pre><br></div></div><br><br>  <b>User interface</b> <br>  The dimensions of the user interface elements, with the exception of the buttons, are written in the code.  Therefore you cannot shuffle the info window or help.  First, the window background was drawn, and then the elements associated with it. <br><img src="https://habrastorage.org/getpro/habr/post_images/29e/65a/575/29e65a575f20b1a331def8db332077a4.jpg"><br><div class="spoiler">  <b class="spoiler_title">Here, for example, the processing of pressing in the scrolbar area</b> <div class="spoiler_text"><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fun_dialogFile_handleScrollbarClick() { signed <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> eax@2 <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> v1; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ST60_4@15 <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> v2; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> [sp+<span class="hljs-number"><span class="hljs-number">4</span></span>Ch] [bp-<span class="hljs-number"><span class="hljs-number">10</span></span>h]@5 <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> v3; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> [sp+<span class="hljs-number"><span class="hljs-number">50</span></span>h] [bp-Ch]@13 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( filelist_numFiles &gt; <span class="hljs-number"><span class="hljs-number">12</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( mouse_isLeftClick ) { v2 = filelist_numFiles - <span class="hljs-number"><span class="hljs-number">12</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( mouseclick_x &gt;= screen_640x480_x + <span class="hljs-number"><span class="hljs-number">464</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( mouseclick_x &lt;= screen_640x480_x + <span class="hljs-number"><span class="hljs-number">496</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( mouseclick_y &gt;= screen_640x480_y + <span class="hljs-number"><span class="hljs-number">145</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( mouseclick_y &lt;= screen_640x480_y + <span class="hljs-number"><span class="hljs-number">300</span></span> ) { v3 = mouseclick_y - (screen_640x480_y + <span class="hljs-number"><span class="hljs-number">145</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( mouseclick_y - (screen_640x480_y + <span class="hljs-number"><span class="hljs-number">145</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">130</span></span> ) v3 = <span class="hljs-number"><span class="hljs-number">130</span></span>; v1 = fun_getPercentage(v3, <span class="hljs-number"><span class="hljs-number">130</span></span>); filelist_scrollPosition = fun_adjustWithPercentage(v2, v1); window_redrawRequest = <span class="hljs-number"><span class="hljs-number">1</span></span>; result = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {result = <span class="hljs-number"><span class="hljs-number">0</span></span>;} }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{result = <span class="hljs-number"><span class="hljs-number">0</span></span>;} }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{result = <span class="hljs-number"><span class="hljs-number">0</span></span>;} }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{result = <span class="hljs-number"><span class="hljs-number">0</span></span>;} }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{result = <span class="hljs-number"><span class="hljs-number">0</span></span>;} }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {result = <span class="hljs-number"><span class="hljs-number">0</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre><br></div></div><br><br>  The buttons in the game have a fixed height and are drawn using three textures, the average texture is repeated to fill the button body.  For example, a button in the usual state. <br><img src="https://habrastorage.org/getpro/habr/post_images/988/ef6/81b/988ef681b3f2bd2b013a84256465557a.png">  + <img src="https://habrastorage.org/getpro/habr/post_images/af9/80a/dec/af980adec0b7287e7d6b13e5910aac63.png">  + <img src="https://habrastorage.org/getpro/habr/post_images/452/185/5d9/4521855d9be2b87b3ac13b083caf2420.png"><br><br>  The windows are drawn according to the following algorithm: the edges of the window are drawn with special textures, the center is filled with a seamless texture <br><img src="https://habrastorage.org/getpro/habr/post_images/0f4/806/a70/0f4806a7006864c28ffb00e7b4a8a76d.png">  + <img src="https://habrastorage.org/getpro/habr/post_images/596/a81/d40/596a81d403df8ba1697456d0e1f11d02.png">  + <img src="https://habrastorage.org/getpro/habr/post_images/467/f74/ee9/467f74ee9b3600709ae7ddca462403dc.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/585/f7c/cdf/585f7ccdfe0ce38ed1a2797b9f5398c8.png">  + <img src="https://habrastorage.org/getpro/habr/post_images/5ad/382/1d0/5ad3821d0ac741e952eeb4208abd1eef.png">  + <img src="https://habrastorage.org/getpro/habr/post_images/4f3/61f/987/4f361f987f8d1b6b9d44d9e9ca3f03a9.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/cbf/70e/b0e/cbf70eb0ec53206d088fcac6e95d566a.png">  + <img src="https://habrastorage.org/getpro/habr/post_images/79e/9b3/168/79e9b31680ae4eb5c74d5d8cc4ec7438.png">  + <img src="https://habrastorage.org/getpro/habr/post_images/98f/3cc/1c3/98f3cc1c333fabe85dbc60fab7b24d36.png"><br><br>  <b>Small details of the huge mechanism</b> <br>  The game consists of a large number of subsystems (availability of water, condition of buildings, education, entertainment, etc.), each of which, upon detailed examination, is very simple, and the description of its functioning fits into several paragraphs.  The joint work of these "gears" gives an exciting gameplay with a good balance.  It should be noted that among themselves these subsystems practically do not interact (the location of the theater does not affect the neighboring school or market, the doctors do not know anything about the actors passing by).  The common point of influence are houses that accumulate the effects of subsystems: the greater their number becomes available to the house, the higher its level.  The level of the house in absolute terms is reduced to the amount of taxes paid and the number of available workers. <br><br>  <b>Routes</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/02f/5f4/df8/02f5f4df859dc5a271e6863393ff1660.png"><br><br>  The routes of different types of citizens differ, for example, the prefect (engineer )‚Äôs route will consist of path A1-A2-A1, even if point A2 is in the prefecture entrance area, after which it will return to the base, while the hairdresser will complete a bypass area, reaching point B2 .  The attendants move exclusively along the roads (bridges, gates, barns, northern tiles of warehouses, gardens and territories at the forts).  Enemies and wild animals cannot pass through the gate.  Merchants and mega-porters can move on the "off-road", but prefer to move on the road to the destination, if possible.  Porters cannot walk through gardens and fortified areas. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/064/e10/69b/064e1069b115347abe411dd62582cfed.gif"><br>  Buildings have an exit point that may not match the entry point.  The appearance priority is shifted down, the input priority is up, there can be a very long way between the entry and exit points. <br><br>  Below, I gave the maximum length of the routes for residents of the city, switching between the short and long routes occurs under different conditions, I haven‚Äôt yet disassembled everything.  A trader, for example, includes a long route if there is a barn near the market. <br><table><tbody><tr><td>  Resident type </td><td>  Mashrut length is long / short (in tiles) </td></tr><tr><td>  Prefect, Engineer </td><td>  52/43 </td></tr><tr><td>  Actor, Gladiator, Tamer, Tax collector </td><td>  43/35 </td></tr><tr><td>  Priest, Doctor, Surgeon, Teacher, Trader, Bather, Hairdresser </td><td>  35/26 </td></tr></tbody></table><br><br>  The bypass route is calculated before leaving the area.  Before starting the selection of the ‚Äúoptimal‚Äù route, a map of possible paths from the point of exit of the worker to all sides of the distribution of roads is constructed.  Then, each received path is covered by a secret, and the buildings within the worker's reach are polled for the need for its services.  For this indicator, select the route at which the services of a worker are more in demand. <br><img src="https://habrastorage.org/getpro/habr/post_images/f93/1c6/9ba/f931c69ba03c4d58a0c0abbae70af48d.png"><br>  For example, the prefect will go to the area with the highest level of fire risk.  But the difficulty is that he will not go to small clusters of houses, even if there is a maximum level of fire, and go to a large area in which the level of fire danger is still acceptable.  This is because the total level in a large area will exceed this figure in a small area.  The same applies to other service workers, as  algorithm for calculating the importance of the path is unified for the use of different types of service. <br><br>  The exception is the behavior of the trader, which when laying the route takes into account the goods on the market.  The following image shows possible paths a merchant can take, each intersection increases the number of routes to process.  In the end, a white flight will be chosen, since the maximum amount of goods from the market will be sold on it.  When the end point of the chosen route is reached by the merchant, if it has no goods left, it will search for the nearest route to the market, and if the goods remain, it will go back along the same route. <br><img src="https://habrastorage.org/getpro/habr/post_images/210/01a/f31/21001af314990a0c5d28dc8cb5669dc9.jpg"><br><br>  <b>House evolution</b> <br>  Homes with a lower level insula (Insula) the size of one tile can be combined with neighbors, then it turns out a house of the same level of size 2x2 tiles.  An additional condition for combining houses is the coincidence of the first three bits of pseudo-random numbers from the <b>byte minimap_info array [26244]</b> , which is used when generating the minimap, so not all tiles of the city could have connected huts. <br><img src="https://habrastorage.org/getpro/habr/post_images/b04/ca2/dd2/b04ca2dd23e6441abeb2752f5318b07f.png">  -&gt; <img src="https://habrastorage.org/getpro/habr/post_images/247/878/9b0/2478789b0910c657b625e8cff537b617.png"><br>  Further, upon reaching a certain level, when the size of the house of the next level is larger than the current one, the neighboring territory is captured. <br><br>  Medium insula -&gt; Large insula (1 √ó 1 -&gt; 2 √ó 2) <br><img src="https://habrastorage.org/getpro/habr/post_images/886/d32/742/886d32742e68c4f986e1e072a487cd5b.png">  -&gt; <img src="https://habrastorage.org/getpro/habr/post_images/d47/e1c/36c/d47e1c36c7cb1710b9d870c0f2bd483b.png"><br>  Medium villa -&gt; Large villa (2 √ó 2 -&gt; 3 √ó 3) <br><img src="https://habrastorage.org/getpro/habr/post_images/e64/84a/dc0/e6484adc0515da6b2091e4ab892de78b.png">  -&gt; <img src="https://habrastorage.org/getpro/habr/post_images/e8c/22d/65c/e8c22d65c5b14330fe8cfc2941b4b32a.png"><br>  Medium palace -&gt; Large palace (3 √ó 3 -&gt; 4 √ó 4) <br><img src="https://habrastorage.org/getpro/habr/post_images/d1b/299/9be/d1b2999be08f625d602a99792b37edaa.png">  -&gt; <img src="https://habrastorage.org/getpro/habr/post_images/822/dfd/7f7/822dfd7f734b0b8d621f82e5b2be53be.png"><br><br>  The following tiles are available for expansion (empty lot, garden, single house below the level or the same level).  The expansion of the house is resolved in four directions (north, west, south and east) <br><br>  <b>City population</b> <br>  The population in the city is divided by age from 0 to 99 years.  Each house contains an array of char peoples [100], which shows how many inhabitants and how old are in this house (the array index corresponds to the age of the inhabitants, the value of the element corresponds to the number of inhabitants of this age).  At the beginning of each year, the elements of the array are shifted by one element, thus long-livers are removed and a cell for newborns is added.  Called functions that are cheated the possibility of the appearance of children in the house and the natural decline in the population of the house from old age. <br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fun_gametick_population</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ...<span class="hljs-comment"><span class="hljs-comment">//some code cityinfo_happiness_immigrationAmount[4517 * ciid] = 0; cityinfo_happiness_emigrationValue[4517 * ciid] = 0; if ( cityinfo_populationYearlyBirthsDeathsCalculationNeeded[4517 * ciid] ) { fun_populationAdvanceAgesOneYear(); fun_populationBirths(); fun_updatePopulationAfterBirthsDeaths(ciid); } fun_calculateNumberOfWorkers(); ....// some code }</span></span></code> </pre><br></div></div><br><br>  <b>Consumption of services and resources</b> <br>  Houses consume resources (food, dishes, oil, furniture, wine) and services (religion, health, education, etc.).  The consumption of food occurs once a month at the rate of 0.5 food units per inhabitant of the house, the consumption of other resources occurs 2 times a month, 1 unit per house, excluding the number of inhabitants.  Consumption of services occurs every day, one 1 unit.  service, the house of any level stores no more than 100 units of each service, therefore their constant updating is required.  The store of food and resources, on the contrary, depends on the level of the house: the larger the house, the more resusts of different types it can store, in the game the house buys goods from a tradeswoman for the next six months. <br><br>  <b>Religion</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/b2b/3b5/546/b2b3b5546258bb0ef55dfcc8cdc4da53.png"><img src="https://habrastorage.org/getpro/habr/post_images/731/a55/161/731a55161991a5dac240da55adc28b98.png"><img src="https://habrastorage.org/getpro/habr/post_images/79c/a20/9cd/79ca209cd2f81109fcc8ab35d41e2d12.png"><img src="https://habrastorage.org/getpro/habr/post_images/8ff/e95/82d/8ffe9582d35c382e042356948b76a008.png"><img src="https://habrastorage.org/getpro/habr/post_images/f34/11b/cf6/f3411bcf6b976d94c3efb66b4efff589.png"><br>  The game has five gods (Ceres, Neptune, Mars, Mercury and Venus).  Mood counting algorithm for all is the same.  The city's coverage is considered by population, and not by territory, i.e.  all temples can stand as anything on the attitude of the gods this will not affect.  The mood of the houses that serve the priests of these temples depends on the location of the temples.  The percentage of coverage is calculated using the following formula <br><br>  <i>Base_value = 100 * (500 * number_of oracles + 750 * working_highlights_hams + 1500 * working_large) / number of people.</i> <br>  Under the concept of "working", get those temples, where there is at least one employee. <br><br>  Additional factors affecting the deity relationship. <br>  Festival_ Factor = 12 - max (40, months_from_of the last_Festival_for_this_God) <br>  Factor_khramov = 50. That deity will receive, the number of which temples in the city is maximum, if there are several of them, then this factor is reset to all. <br>  Factor_reference = -25.  Get the deity that has the least temples in the city.  If there are several such deities, then this factor is reset for everyone. <br><br>  Venus is not involved in the distribution of bonuses.  Probably a bug. <br><br>  <i>Summary_setting = Baseline + Festival Factor + Temple Factor + Unread Factor.</i> <br><br>  Limit the minimum values ‚Äã‚Äãof mood, depending on the population of the city. <br><table><tbody><tr><td>  Population </td><td>  Minimal mood </td></tr><tr><td>  0-99 </td><td>  50 </td></tr><tr><td>  100-199 </td><td>  40 </td></tr><tr><td>  200-299 </td><td>  40 </td></tr><tr><td>  300-399 </td><td>  thirty </td></tr><tr><td>  400-499 </td><td>  20 </td></tr><tr><td>  400-499 </td><td>  ten </td></tr><tr><td>  &gt; 500 </td><td>  0 </td></tr></tbody></table><br><br>  <b>The mood of the gods</b> <br>  Every game day (25 ticks), the mood of each of the gods is calculated.  The deity has a current mood and true, with each update the current mood approaches the true one by 1.  For example, we somehow displeased Mars and are not trying to fix it, let the current mood of Mars be 100, and the true one - 0. Every day the current mood of the god of war will decrease by 1 unit.  until it reaches 0. In the gaming month of 16 days, it turns out that our city of Mars will punish through (100/16), somewhere in half a year of playing time, maybe because there is still a ‚Äúsacred random‚Äù (before which not every Roman God can resist). <br><img src="https://habrastorage.org/getpro/habr/post_images/5e3/07b/4ea/5e307b4eabcc852b24b85ed2c1b5f218.png"><img src="https://habrastorage.org/getpro/habr/post_images/a67/326/96b/a6732696b0f74302b405b2e1a236a114.png"><img src="https://habrastorage.org/getpro/habr/post_images/944/579/1fe/9445791fe5baf41c6fa56bff95919d40.png"><img src="https://habrastorage.org/getpro/habr/post_images/849/51f/7bc/84951f7bc6c6483e6ed161fc06f90697.png"><img src="https://habrastorage.org/getpro/habr/post_images/874/c19/de6/874c19de6c5394b27685834b0811641e.png"><img src="https://habrastorage.org/getpro/habr/post_images/fef/ea6/9bb/fefea69bb928db2462d74d4a172397a1.png"><br><br>  Under the spoiler, I described the scoring of anger points (they are displayed as lightning next to the mood of the deity in the window of the religious adviser, who played Caesar will remember) <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( god.mood &lt; <span class="hljs-number"><span class="hljs-number">50</span></span> ) { god.blessing = <span class="hljs-number"><span class="hljs-number">0</span></span> god.blessingDone = <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(god.mood &gt; <span class="hljs-number"><span class="hljs-number">50</span></span> ) { god.small_curse = <span class="hljs-number"><span class="hljs-number">0</span></span> god.smallCurseDone = <span class="hljs-number"><span class="hljs-number">0</span></span> } god_id = random( <span class="hljs-number"><span class="hljs-number">7</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( god_id &lt; <span class="hljs-number"><span class="hljs-number">5</span></span> ) { current_god = romeGods[ god_id ] // (Ceres/Neptune/Mercury/Mars/Venus) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( current_god.mood &gt;= <span class="hljs-number"><span class="hljs-number">50</span></span> ) current_god.wrathPoints = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( current_god.mood &gt;= <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> current_god.mood &lt; <span class="hljs-number"><span class="hljs-number">10</span></span> ) current_god.wrathPoints += <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( current_god.mood &gt;= <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> current_god.mood &lt; <span class="hljs-number"><span class="hljs-number">20</span></span> ) current_god.wrathPoints += <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( current_god.mood &gt;= <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> current_god.mood &lt; <span class="hljs-number"><span class="hljs-number">40</span></span> ) current_god.wrathPoints += <span class="hljs-number"><span class="hljs-number">1</span></span>; } current_god.wrathPoints = min( current_god.wrathPoints, <span class="hljs-number"><span class="hljs-number">50</span></span>)</code> </pre><br></div></div><br>  Each game month (16 * 25 = 900 ticks), additional logic is executed that determines the appearance of anger and / or blessings of the gods. <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="hljs ruby"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( god_id == [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>] ) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   ,          <span class="hljs-number"><span class="hljs-number">40</span></span>  ,     current_god = find_least_happy_god(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( current_god ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( current_god.mood &gt; <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> current_god.blessingDone == <span class="hljs-number"><span class="hljs-number">0</span></span> ) { current_god.doBlessing() current_god.mood = <span class="hljs-number"><span class="hljs-number">50</span></span> current_god.blessingDone = <span class="hljs-number"><span class="hljs-number">1</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( current_god.wrathPoints &gt; <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> current_god.smallCurseDone == <span class="hljs-number"><span class="hljs-number">0</span></span> ) { current_god.doSmallCurse() current_god.smallCurseDone = <span class="hljs-number"><span class="hljs-number">1</span></span> current_god.wrathPoints = <span class="hljs-number"><span class="hljs-number">0</span></span> current_god.mood -= <span class="hljs-number"><span class="hljs-number">12</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( current_god.wrathPoints == <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> current_god.lastFesivale &gt; <span class="hljs-number"><span class="hljs-number">3_</span></span>months ) { current_god.doWrath() current_god.wrathPoints = <span class="hljs-number"><span class="hljs-number">0</span></span> current_god.mood -= <span class="hljs-number"><span class="hljs-number">30</span></span> } } }</code> </pre><br></div></div><br><br>  <b>Festivals / Mood in the city</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/f03/018/76e/f0301876ed5699380b9accdb65b19478.png"><br>  There are 3 types of festivals available in the game: small, medium and large.  The festival is dedicated to one of the gods, the festival affects the attitude of the deity to the city.  Formulas for calculating the cost of the festival are shown in the table. <br><table><tbody><tr><td>  Type of </td><td>  Cost of </td><td>  Wine </td><td>  Preparation time </td></tr><tr><td>  Small </td><td>  population / 20 + 10 </td><td>  - </td><td>  2 months </td></tr><tr><td>  Average </td><td>  population / 10 + 20 </td><td>  - </td><td>  3 months </td></tr><tr><td>  Big </td><td>  population / 5 + 40 </td><td>  population / 500 + 1 </td><td>  4 months </td></tr></tbody></table><br><br>  In addition to increasing the mood of the deity, to whom the festival is dedicated, after its holding the attitude of citizens to the ruler also improves.  For 12 months, you can hold 2 festivals that will bring an increase in mood, the following festivals held will not give a mood increase in the city.  The table shows the values ‚Äã‚Äãby which the mood increases in the city. <br><br><table><tbody><tr><td>  Type of </td><td>  The first </td><td>  Second </td></tr><tr><td>  Small </td><td>  7 </td><td>  2 </td></tr><tr><td>  Average </td><td>  9 </td><td>  3 </td></tr><tr><td>  Big </td><td>  12 </td><td>  five </td></tr></tbody></table><br><br>  <b>Finance</b> <br>  The maximum debt of the city, at which you can still build something is <b>-5000</b> denarii.  This condition is checked at every action related to finances. <br><div class="spoiler">  <b class="spoiler_title">For example when building a road</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fun_drawBuildingGhostRoad</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ... <span class="hljs-comment"><span class="hljs-comment">//some code if ( cityinfo_treasury[4517 * ciid] &lt;= -5000 ) cannotBuild = 1; if ( cannotBuild ) { sub_4D0B70(graphic_fire_almost, v2, v1 - iso_tile_half_height, (ColorMask) -1949); } ...//some code }</span></span></code> </pre><br></div></div><br><br>  The annual salary for workers, which you set on the screen of the human resources adviser is 1/10 of the specified value in denarii.  The number 30 means the payment of 3 deniers to the employee per year, this is done because of the fact that in the game financial calculations are carried out in whole numbers. <br><img src="https://habrastorage.org/getpro/habr/post_images/1b7/b70/5e1/1b7b705e18d9f275f559def46d7ef011.jpg"><br><br>  Every month there is a payment of wages to workers, according to a simple formula. <br>  <i>__  = (number of employees at the end of the month) * (_worker) / 10/12</i> <br>  This amount is taken from the treasury of the city to nowhere, for example in Tropico the money went into the wallets of the residents, but this is a completely different story. <br><br>  If the city is in debt, i.e.  the amount displayed in the top menu is less than 0, then the city starts paying interest to Rome, a kind of loan. <br>  The interest rate on the loan is 10% and is deducted from the city‚Äôs treasury every month. <br><br>  <i>payment = (-nedeg_v_kazne) * 10/100/12</i> <br><br>  When you reach 5000 debt for the first time, Rome gives a loan (depending on the mission, usually 10,000 days), the second time the amount can also be received, but it is already taken into account as a loan. <br><br>  <b>Taxes</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/008/91d/00c/00891d00c6e7ece3156fe93f4bc33921.png"><br>  Every month, houses in the city generate a tax, which depends on the level of the house and the number of people living in it.  House tax is collected when a tax collector passes by, at the beginning of a new year the amount for the previous year is burned if it has not been collected.  The level of taxes is set in the configuration file c3_model.txt, and the level of complexity in the city is also affected by the level of complexity: <br><br><table><tbody><tr><td>  Level of difficulty </td><td>  Coefficient </td></tr><tr><td>  Very easy </td><td>  300% </td></tr><tr><td>  Easy </td><td>  200% </td></tr><tr><td>  Fine </td><td>  150% </td></tr><tr><td>  Complicated </td><td>  100% </td></tr><tr><td>  Very difficult </td><td>  75% </td></tr></tbody></table><br><br>  The final formula for calculating taxes on a house looks like this. <br>  <i>Total Tax (Dn) = (tax_base / 2) * (percentage of the city) / (12 * 100 (</i> <br><br>  <b>Post empire</b> <br>  At the end of the year, the city sends part of the income to Rome, the payment depends on the profit and the number of inhabitants in the city.  In the game, profit refers to the difference between income and spending.  The tax rate is 25%, if the city is in debt, then the tax is not paid, but the emperor's favor decreases. <br><table><tbody><tr><td>  Income components </td><td>  Cost components </td></tr><tr><td>  Donations </td><td>  Building </td></tr><tr><td>  Export of goods </td><td>  Import of goods </td></tr><tr><td></td><td>  Loan interest </td></tr><tr><td></td><td>  The ruler's salary </td></tr><tr><td></td><td>  Rest </td></tr><tr><td></td><td>  Salaries </td></tr></tbody></table><br><br>  Also, the minimum value of taxes is determined by the population of the city. <br><table><tbody><tr><td>  Population </td><td>  No profit / There is profit </td></tr><tr><td>  0-500 </td><td>  0/50 </td></tr><tr><td>  501-1000 </td><td>  0/150 </td></tr><tr><td>  1001-2000 </td><td>  100/225 </td></tr><tr><td>  2001-3000 </td><td>  200/300 </td></tr><tr><td>  3001-5000 </td><td>  200/400 </td></tr><tr><td>  5000+ </td><td>  200/500 </td></tr></tbody></table><br><br>  <b>Emperor's favor</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/361/97c/688/36197c688d596c755ae69b9243c45a66.jpg"><br>  An important role in the successful completion of the mission is the attitude of the emperor towards the ruler and the ratings of the city.  Such parameters as the ‚Äúprofitability of the city‚Äù and the fulfillment / ignoring of the emperor's requests have the greatest influence on the mood of the emperor. <br><br>  Gifts greatly increase the emperor's opinion of you, but their influence is seriously reduced with frequent gifts.  When calculating the change of favor, all the gifts made in the last 12 months are taken into account, they are listed in the table. <br><table><tbody><tr><td>  Gift number </td><td>  Modest </td><td>  Dear </td><td>  Excellent </td></tr><tr><td>  one </td><td>  3 </td><td>  five </td><td>  ten </td></tr><tr><td>  2 </td><td>  one </td><td>  3 </td><td>  five </td></tr><tr><td>  3 </td><td>  0 </td><td>  one </td><td>  3 </td></tr><tr><td>  four </td><td>  0 </td><td>  0 </td><td>  one </td></tr><tr><td>  5+ </td><td>  0 </td><td>  0 </td><td>  0 </td></tr></tbody></table><br><br>  Fulfilling requests, at a time set by the emperor, gives a certain increase in favor.  If you fulfill the request later than the time set by the Caesar, you will receive only half the reward, and if you ignore it, you will lose 8 respects: 3 units will be lost if it is impossible to complete the request within the specified period, 5 more will be removed if the request is ignored within 24 months deadline. <br><br>  In addition to plot requests and gifts, the renewal of the favor value is performed at the beginning of each year and depends on the following factors: <br>  <b>Base change</b> = -2 <br>  <b>Successful payment of the tax</b> = +1 if paid successfully, -3, -5 and -8, if you did not pay one, two or more than two years, respectively. <br>  <b>Salary</b> = +1 if the salary is less than the salary of the current level of the ruler, and -1 for each rank above your level <br>  <b>Events</b> = depends on missions, for example +5 when population reaches 1000 inhabitants <br><br>  <b>Culture Rating</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/1b7/18d/cab/1b718dcabcbed9a506863c6957a8f970.jpg"><br>  The culture rating in the game is a collective rating, according to which one can judge the attractiveness of the city.  It consists of the level of coverage of the city with theaters, temples, schools, academies and libraries.  Indirectly, by the presence of the educational component (the level of culture is more than 30), one can understand that there are well-off citizens in the city. <br><br>  <i>Cultural Rating = Theatre Rating + Temple Rating + Library Rating + Schools Rating + Academy Rating</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7ca/e0b/170/7cae0b170b57b8feb6b6a4fd6141bb1a.png"><br>  The rating of theaters corresponds to the ratio of the capacity of the theaters to the number of residents without regard to their location. <br>  Rating_ of theaters = 500 * number of working_ theaters / population.  In accordance with this coverage rating is selected. <br><table><tbody><tr><td>  Coating </td><td>  Culture Points </td></tr><tr><td>  0-30% </td><td>  0 </td></tr><tr><td>  31-50% </td><td>  3 </td></tr><tr><td>  51-70% </td><td>  eight </td></tr><tr><td>  71-85% </td><td>  12 </td></tr><tr><td>  86-99% </td><td>  18 </td></tr><tr><td>  100 +% </td><td>  25 </td></tr></tbody></table><br><br><img src="https://habrastorage.org/getpro/habr/post_images/adc/ac2/b01/adcac2b014185d33c329ea78ab505b62.png"><img src="https://habrastorage.org/getpro/habr/post_images/36d/db0/cb4/36ddb0cb4f1521b956ecd32d2c4c8f19.png"><br>  The rating of theaters corresponds to the ratio of the capacity of the temples to the number of residents without regard to their location. <br>  Rating_hams = 150 * Number_small_hams + 300 * Number_small_hams + 500 * Number_Oracle. <br>  As with theaters, the rating value is selected from the table. <br><table><tbody><tr><td>  Coating </td><td>  Culture Points </td></tr><tr><td>  0-30% </td><td>  0 </td></tr><tr><td>  31-50% </td><td>  3 </td></tr><tr><td>  51-70% </td><td>  9 </td></tr><tr><td>  71-85% </td><td>  14 </td></tr><tr><td>  86-99% </td><td>  22 </td></tr><tr><td>  100 +% </td><td>  thirty </td></tr></tbody></table><br><br>  <b>Education</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/4bf/958/4d6/4bf9584d6e56e531a61a31c6de809ada.png"><img src="https://habrastorage.org/getpro/habr/post_images/571/0d3/f73/5710d3f73606e86de4c2ee8e3f434d07.png"><img src="https://habrastorage.org/getpro/habr/post_images/7ba/d3c/733/7bad3c733f8419e64644ac818340e8e2.png"><br>  Schools bring a maximum of 15 culture points, the calculation is made for residents of school age, each school holds 75 students. <br>  Academies add 10 points of culture, the calculation is made for residents of college age, the academy trains 100 students. <br>  Libraries remain 20 points, which are calculated on the total number of residents, one library can serve up to 800 residents. <br>  The dependence of culture points on the level of coverage of the city is shown in the table. <br><table><tbody><tr><td>  Coating </td><td>  Schools </td><td>  Academy </td><td>  Libraries </td></tr><tr><td>  0-30% </td><td>  0 </td><td>  0 </td><td>  9 </td></tr><tr><td>  31-50% </td><td>  one </td><td>  one </td><td>  2 </td></tr><tr><td>  51-70% </td><td>  four </td><td>  2 </td><td>  four </td></tr><tr><td>  71-85% </td><td>  6 </td><td>  four </td><td>  eight </td></tr><tr><td>  86-99% </td><td>  ten </td><td>  7 </td><td>  14 </td></tr><tr><td>  100 +% </td><td>  15 </td><td>  ten </td><td>  20 </td></tr></tbody></table><br><br>  <b>Resources and production</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/535/524/5db/5355245db487192d6a9ea180520ef532.gif"><img src="https://habrastorage.org/getpro/habr/post_images/d79/d96/7d3/d79d967d38c8aea4c2d4668735b72957.gif"><img src="https://habrastorage.org/getpro/habr/post_images/1b8/dac/629/1b8dac62998ac964841b5a27a53b0768.gif"><img src="https://habrastorage.org/getpro/habr/post_images/9c4/f30/66f/9c4f3066f6aed2d1c548f21e2e907331.gif"><img src="https://habrastorage.org/getpro/habr/post_images/e8f/872/b8e/e8f872b8e3e2d0422946006653e8c828.gif"><img src="https://habrastorage.org/getpro/habr/post_images/511/e67/959/511e67959ffb1b72609b893e30a7d278.gif"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The basis of the economy of the game are resources, some resources require processing, so there are simple production chains, for example, the iron mine -&gt; weapon. </font><font style="vertical-align: inherit;">The resources in the game are inexhaustible, with the exception of fishing places that have a finite number of fish. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wheat - the first resource with which you are introduced to the game. </font><font style="vertical-align: inherit;">In the central provinces, wheat farms are more efficient than other farms, but this does not work in northern and desert areas. </font><font style="vertical-align: inherit;">The farms are located on fertile soil, which is shown on the map by yellow shoots. </font><font style="vertical-align: inherit;">The harvest will be taken to the barn or to the warehouse. </font><font style="vertical-align: inherit;">Farms, mining buildings and workshops work in a single pattern, every 25 ticks (once a game day), the production progress is updated according to the following formula:</font></font><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The formula for calculating the daily production progress</font></font></b> <div class="spoiler_text"><pre> <code class="hljs 1c"> productionRate -      <span class="hljs-built_in"><span class="hljs-built_in"></span></span>  <span class="hljs-number"><span class="hljs-number">100</span></span>%  numberWorkers - <span class="hljs-built_in"><span class="hljs-built_in"></span></span>     <span class="hljs-number"><span class="hljs-number">12</span></span> * <span class="hljs-number"><span class="hljs-number">16</span></span> - <span class="hljs-built_in"><span class="hljs-built_in"></span></span>  * <span class="hljs-built_in"><span class="hljs-built_in"></span></span>   maximumWorkers -  <span class="hljs-built_in"><span class="hljs-built_in"></span></span>     progress += <span class="hljs-number"><span class="hljs-number">100</span></span> * ( productionRate * numberWorkers) / (<span class="hljs-number"><span class="hljs-number">12</span></span> * <span class="hljs-number"><span class="hljs-number">16</span></span> * maximumWorkers )</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the end of production, a porter is created with a product that delivers it to the nearest storage facility. If it is impossible to deliver the goods, it will still stand near the production. If the porter is busy, and the new product is already produced, then production stops until the porter is released. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Storage and Resource Allocation</font></font></b> <br><img src="https://habrastorage.org/getpro/habr/post_images/1f6/5da/153/1f65da15392e27f869501bf79fef27fe.png"><img src="https://habrastorage.org/getpro/habr/post_images/2c6/e28/f05/2c6e28f05f0a01541cfe208aa0181414.gif"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Two types of storage are involved in the storage and distribution of resources: barns and warehouses, barns store only products and market traders receive goods from barns, warehouses store goods of any type and can sell them to merchants. Storages stop accepting goods if the number of employees is less than half, the storages do not participate in the delivery of goods, except for the special ‚Äúreceive goods‚Äù mode, in this case the store begins to receive goods from other storages, so you can create a chain of movement of goods from one map area in the game in another.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The combination of resource extraction, processing and marketing of goods turned out to be quite elaborate. A small number of goods does not tire the player with micromanagement, and automating most of the routine activities, such as choosing warehousing and distribution, leaves the ruler room for strategic planning. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At this moment I‚Äôll, perhaps, finish the article, such topics as trade between cities and hostilities are overboard, each of them is quite large, and there is still not enough material. Thank you for your attention, </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZY</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the end of the article I want to say that fans of the game can certainly add many more moments that I did not find or did not pay attention when restoring the source code of the original game. It was important for me to get a general idea of ‚Äã‚Äãthe game logic, so as not to mess with the balance, so carefully polished by the authors of the original. As for the restored sources, they did not have the patience to bring them to the normal (just to compile) view, but there was a kind person (AntonBaracuda, </font></font><a href="https://github.com/AntonBaracuda/opencaesar3/c3_rev"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/AntonBaracuda/opencaesar3/c3_rev</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) who completed this really hard work. At the specified address, you will find the source code and the structures and some functions partially separated by files; all this is compiled and run; you can pass the first functions in the debugger.</font></font><br><br>  <b>Links</b> <br> <a href="http://caesar-iii.ru/">  </a> <br> <a href="http://caesar3.heavengames.com/">       </a> <br> <a href="https://github.com/AntonBaracuda/opencaesar3/tree/master/c3_rev">    (,   )</a> <br> <a href="https://bitbucket.org/dalerank/caesaria/wiki/Home">CaesarIA:   (opensource, c++, SDL)(Window,Linux,Mac,Haiku,Android)</a> </div><p>Source: <a href="https://habr.com/ru/post/224931/">https://habr.com/ru/post/224931/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../224921/index.html">DevConf 2014: Development for Android Wear (Google Glass, fitness trackers, smart watches)</a></li>
<li><a href="../224923/index.html">Certification of programmers: our experience</a></li>
<li><a href="../224925/index.html">Why is it important to write and approve the project charter?</a></li>
<li><a href="../224927/index.html">Features of the routing protocol EIGRP</a></li>
<li><a href="../224929/index.html">API creation: framed and wall mounted</a></li>
<li><a href="../224941/index.html">5 Google Glass competitors</a></li>
<li><a href="../224943/index.html">Android with Intel 64-bit kernel in questions and answers</a></li>
<li><a href="../224945/index.html">Myths about programmers: indifference to strippers, dumplings and controlled chaos</a></li>
<li><a href="../224947/index.html">Dyson Halo - smart glasses 10 years before Google Glass</a></li>
<li><a href="../224949/index.html">NASA successfully tested Morpheus's landing module in the dark on rocky terrain</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>