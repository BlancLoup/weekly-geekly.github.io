<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Whitelisting with Windows Firewall</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If paranoia dictates that you are not sufficiently protected, and only free tools are at hand for security, then you need to satisfy this feeling! Und...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Whitelisting with Windows Firewall</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/e3d/02c/32a/e3d02c32abcc443abf3aee35eff329f2.jpg" alt="image"><br><br>  If paranoia dictates that you are not sufficiently protected, and only free tools are at hand for security, then you need to satisfy this feeling!  Under the cat, we will create a white list of programs for accessing the network using standard Windows firewall, including PowerShell. <br><a name="habracut"></a><br><h4>  Introduction </h4><br>  Most encoders, trojans and other bad things from the world of cyber threats for their dark business use the ability to access the network from the victim's device: getting a key to encrypt files, sending confidential information and so on.  Anti-virus companies in the fight against such opponents train their proactive technologies, even produce separate products for cryptographers, and for ordinary users of free protection they can only fine-tune their frontiers on their own.  Since the days of Vista, the firewall built into Windows has become quite good, but most of the time it stands idle, beating off only unwritten incoming connections at best.  Not everyone knows, but he can do a bit more - filter and outgoing connections, one has only to turn on this mode and configure it correctly. <br><br><h4>  So let's get started </h4><br>  First of all, it is necessary to prohibit all outgoing connections (incoming ones, we believe, are already prohibited - the necessary software itself, as a rule, prescribes exceptions for itself).  To do this, go to Control Panel -&gt; System and Security -&gt; Windows Firewall -&gt; Advanced Settings.  Next, select "Windows Firewall in Advanced Security Mode" and open Properties using the right mouse button.  Depending on your network profile (private - local network with router, public - directly to the Internet, domain - domain network), the profile tab is selected and the ‚ÄúBlock‚Äù mode is selected for outgoing connections (I configured the same for all profiles). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Screenshots</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/9cb/85f/c8d/9cb85fc8d05f4851861c1c9c5230b4f5.png" alt="image"><br><br><img src="https://habrastorage.org/files/232/613/583/232613583f6b4010b2bb171fa4eceb8e.png" alt="image"><br></div></div><br>  At the moment, no program can go online (except for rules that already exist).  It is easy to check this by opening a browser with any site - you will certainly get a network error.  To load the page you need to create a corresponding rule.  Consider Internet Explorer - all have it on Windows.  Right-click on ‚ÄúRules for outgoing connection‚Äù -&gt; Create a rule.  A window opens with 4 types of rules, for IE the first one - ‚ÄúFor the program‚Äù.  Next you need to specify the path to the program - in our case - <code>C:\Program Files\Internet Explorer\iexplore.exe</code> .  Do not forget that the owners of 64-bit systems should create one more such rule, only for <code>Program Files (x86)</code> (IE is also installed there).  After selecting a file, select the item ‚ÄúAllow connection‚Äù, then check the desired network profiles.  It remains only to come up with a name for our rule.  I recommend all the rules to write with the same word / symbol, then it will be more convenient to search.  The created rule will be displayed in the general list. <br><br><div class="spoiler">  <b class="spoiler_title">Screenshots</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/461/183/808/461183808b7f4ad2a8745c7c936176c6.png" alt="image"><br><br><img src="https://habrastorage.org/files/cf0/e80/426/cf0e80426d7644afb73a1810372dc5f4.png" alt="image"><br><br><img src="https://habrastorage.org/files/486/d55/8a1/486d558a1acb48999a2ad505bd377d7a.png" alt="image"><br><br><img src="https://habrastorage.org/files/5ff/fef/62b/5fffef62b8a64efa93eeaeceb21ebe16.png" alt="image"><br></div></div><br>  For programs, the rules have been learned to do, and what about services?  Let the Mozilla Maintenance Service be added to the exceptions.  Create a new rule, select the type "Custom".  Next, click "Configure", select "Apply to service" and search for the desired service in the list or enter the service name manually below.  Then it is proposed to configure the protocol and ports, but in this case they can be left by default - the program is trusted and the clown knows what it uses there when delivering and installing updates.  We don‚Äôt touch IP addresses in the same way.  Next, allow the connection, select profiles and set the name for the rule. <br><br><div class="spoiler">  <b class="spoiler_title">Screenshots</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/307/263/4c3/3072634c375749adb1fd61fc3491a679.png" alt="image"><br><br><img src="https://habrastorage.org/files/15e/e43/24d/15ee4324d4d246128b4789726676fb5a.png" alt="image"><br></div></div><br>  It would seem that the main points are passed, what now?  And now the pitfalls.  If someone uses the TeamViewer remote control program in their activities that puts the service with them, it seems to be enough to find the service in the list and add a rule for it.  But it will not work.  Instead of the service, you need to add the rule ‚ÄúFor the program‚Äù and select the executable file of the service <code>C:\Program Files (x86)\TeamViewer\TeamViewer_Service.exe</code> (path for a 64-bit system).  This is a common situation, so do not rush to add services, start with exe.  In addition, ping will stop working in our system.  For it, you need to add a rule of the ‚ÄúConfigurable‚Äù type, leave everything by default, just select the ICMPv4 protocol and click ‚ÄúConfigure‚Äù at the bottom, where you can tick only the ‚ÄúEcho request‚Äù checkbox.  Now ping and tracert will work.  For IPv6 repeat, but already with the ICMPv6 protocol.  If a rule has already been created, but something needs to be changed in it, this can be easily done by selecting the necessary rule in the list and going into its properties.  On the tabs, you can customize everything for every taste - to tie the service to a specific exe, restrict the program in ports, etc. <br><br><div class="spoiler">  <b class="spoiler_title">Screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/c49/989/fd8/c49989fd81df403c92dccbf679f35f49.png" alt="image"><br>  <i>Properties of an already created rule for ping</i> <br></div></div><br>  By upgrading from Windows 8.1 to Windows 10, I could not create a workable rule for OneDrive.  It seems to be a simple rule for <code>%USERPROFILE%\AppData\Local\Microsoft\OneDrive\OneDrive.exe</code> and everything should work.  But, having spent several months, I came to the <code>C:\Users\ProfileName\AppData\Local\Microsoft\OneDrive\OneDrive.exe</code> that, it turns out, it was necessary to prescribe the direct path <code>C:\Users\ProfileName\AppData\Local\Microsoft\OneDrive\OneDrive.exe</code> , although in previous OS of the same family everything worked well and with the first option (riddle?). <br><br><h4>  Experience and PowerShell </h4><br>  The list of rules accumulated over the N-th time, I will present in the form of commands for PowerShell - easier to automate.  To be able to run the script for execution in PowerShell, you must give permission to this for unsigned scripts in the system (for paranoids, you can then return it to the place): <br><br><pre> <code class="php hljs">Set-ExecutionPolicy Unrestricted Set-ExecutionPolicy <span class="hljs-keyword"><span class="hljs-keyword">Default</span></span> <span class="hljs-comment"><span class="hljs-comment"># </span></span></code> </pre><br>  Blocking all outgoing connections with a firewall looks like this: <br><br><pre> <code class="php hljs">Set-NetFirewallProfile -All -DefaultOutboundAction Block</code> </pre><br>  The command to add a rule for all profiles and outgoing directions for explorer.exe - update tiles on Windows 8.1.  I believe that on the 10-ke used: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-NetFirewallRule -Program <span class="hljs-string"><span class="hljs-string">'C:\Windows\explorer.exe'</span></span> -Action Allow -Profile Any -DisplayName <span class="hljs-string"><span class="hljs-string">'  explorer.exe'</span></span> -Direction Outbound</code> </pre><br>  Let us have the first cell contains the name of the rule, and the second cell stores the path to the program.  And we will have N such two-cell lines - how many pieces of rules.  All this will be stored in <code>$programs</code> .  Let's start with a simple one: Internet Explorer, Google Chrome, Tor Browser, Yandex.Browser, Notepad ++, Visual Studio 2015, qBittorrent, HWMonitor, OneDrive, PowerShell, PowerShell ISE, Steam, CS GO, TeamViewer, and so on - all more or less simple applications which require access from 1-2 exe files to access the network. <br><br><div class="spoiler">  <b class="spoiler_title">Filling the $ programs table</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment"># $env -   %USERPROFILE%, %SystemRoot%  .. $programs = ('  Internet Explorer (x86)', (${env:ProgramFiles(x86)}+'\Internet Explorer\iexplore.exe')), ('  Internet Explorer', ($env:ProgramFiles+'\Internet Explorer\iexplore.exe')), ('  Google Chrome', (${env:ProgramFiles(x86)}+'\Google\Chrome\Application\chrome.exe')), ('  Google Update', (${env:ProgramFiles(x86)}+'\Google\Update\GoogleUpdate.exe')), ('  Tor Browser', ($env:USERPROFILE+'\AppData\Local\Tor Browser\Browser\firefox.exe')), ('  Tor Browser updater', ($env:USERPROFILE+'\AppData\Local\Tor Browser\Browser\updater.exe')), ('  Yandex.Browser', ($env:USERPROFILE+'\AppData\Local\Yandex\YandexBrowser\Application\browser.exe')), ('  Notepad++ (GUP)', (${env:ProgramFiles(x86)}+'\Notepad++\updater\GUP.exe')), ('  Visual Studio 2015', (${env:ProgramFiles(x86)}+'\Microsoft Visual Studio 14.0\Common7\IDE\devenv.exe')), ('  Blend (Visual Studio)', (${env:ProgramFiles(x86)}+'\Microsoft Visual Studio 14.0\Common7\IDE\Blend.exe')), ('  qBittorrent', (${env:ProgramFiles(x86)}+'\qBittorrent\qbittorrent.exe')), ('  HWMonitor', ($env:ProgramFiles+'\CPUID\HWMonitor\HWMonitor.exe')), ('  OneDrive', ($env:USERPROFILE+'\AppData\Local\Microsoft\OneDrive\OneDrive.exe')), ('  PowerShell (  )', ($env:SystemRoot+'\System32\WindowsPowerShell\v1.0\powershell.exe')), ('  PowerShell ISE (  )', ($env:SystemRoot+'\System32\WindowsPowerShell\v1.0\powershell_ise.exe')), ('  Steam', (${env:ProgramFiles(x86)}+'\Steam\Steam.exe')), ('  steamwebhelper', (${env:ProgramFiles(x86)}+'\Steam\bin\steamwebhelper.exe')), ('  Steam CS GO', ('D:\Games\SteamLibrary\steamapps\common\Counter-Strike Global Offensive\csgo.exe')), ('  TeamViewer', (${env:ProgramFiles(x86)}+'\TeamViewer\TeamViewer.exe')), ('  TeamViewer_Service', (${env:ProgramFiles(x86)}+'\TeamViewer\TeamViewer_Service.exe'))</span></span></code> </pre><br></div></div><br>  Also, if you wish, you can add a tricky Avast (he still needs a service) and Firefox (+ service) to the tablet. <br><br><div class="spoiler">  <b class="spoiler_title">Add to $ programs</b> <div class="spoiler_text"><pre> <code class="php hljs"> (<span class="hljs-string"><span class="hljs-string">'  AvastUI+'</span></span>, ($env:ProgramFiles+<span class="hljs-string"><span class="hljs-string">'\AVAST Software\Avast\AvastUI.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  AvastSvc'</span></span>, ($env:ProgramFiles+<span class="hljs-string"><span class="hljs-string">'\AVAST Software\Avast\AvastSvc.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  Avast  (AvastEmUpdate)'</span></span>, ($env:ProgramFiles+<span class="hljs-string"><span class="hljs-string">'\AVAST Software\Avast\AvastEmUpdate.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  Avast  (instup)'</span></span>, ($env:ProgramFiles+<span class="hljs-string"><span class="hljs-string">'\AVAST Software\Avast\setup\instup.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  Mozilla Firefox'</span></span>, (${env:ProgramFiles(x86)}+<span class="hljs-string"><span class="hljs-string">'\Mozilla Firefox\firefox.exe'</span></span>))</code> </pre><br></div></div><br>  All rows of the table will be processed individually as follows: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($prog in $programs) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-NetFirewallRule -Program $prog[<span class="hljs-number"><span class="hljs-number">1</span></span>] -Action Allow -Profile Any -DisplayName $prog[<span class="hljs-number"><span class="hljs-number">0</span></span>] -Direction Outbound Write-Host <span class="hljs-string"><span class="hljs-string">': '</span></span>$prog[<span class="hljs-number"><span class="hljs-number">0</span></span>] } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { Write-Host <span class="hljs-string"><span class="hljs-string">': '</span></span>$prog[<span class="hljs-number"><span class="hljs-number">0</span></span>] } Write-Host }</code> </pre><br>  In addition, it is necessary to deal with non-standard rules and services.  For example, the update center works via svchost.exe using the TCP protocol through ports 80 and 443. And the application store uses a separate WSService service for updating.  In addition, we do not forget about ping and services for the necessary applications: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $i = <span class="hljs-string"><span class="hljs-string">'  Windows Update/Modern Apps'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-NetFirewallRule -Program ($env:SystemRoot+<span class="hljs-string"><span class="hljs-string">'\System32\svchost.exe'</span></span>) -Protocol TCP -RemotePort <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-number"><span class="hljs-number">443</span></span> -Action Allow -Profile Any -DisplayName $i -Direction Outbound $i = <span class="hljs-string"><span class="hljs-string">'  Avast ()'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-NetFirewallRule -Service <span class="hljs-string"><span class="hljs-string">'avast! Antivirus'</span></span> -Action Allow -Profile Any -DisplayName $i -Direction Outbound $i = <span class="hljs-string"><span class="hljs-string">'  Mozilla Maintenance Service'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-NetFirewallRule -Service <span class="hljs-string"><span class="hljs-string">'MozillaMaintenance'</span></span> -Action Allow -Profile Any -DisplayName $i -Direction Outbound $i = <span class="hljs-string"><span class="hljs-string">'  ping (v4)'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-NetFirewallRule -Profile Any -Action Allow -DisplayName $i -Protocol ICMPv4 -IcmpType <span class="hljs-number"><span class="hljs-number">8</span></span> -Direction Outbound $i = <span class="hljs-string"><span class="hljs-string">'  ping (v6)'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-NetFirewallRule -Profile Any -Action Allow -DisplayName $i -Protocol ICMPv6 -IcmpType <span class="hljs-number"><span class="hljs-number">8</span></span> -Direction Outbound $i = <span class="hljs-string"><span class="hljs-string">'    Windows'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-NetFirewallRule -Service <span class="hljs-string"><span class="hljs-string">'WSService'</span></span> -Action Allow -Profile Any -DisplayName $i -Direction Outbound <span class="hljs-comment"><span class="hljs-comment">#   ,      (  , ) $i = '    ()' New-NetFirewallRule -Enabled False -Action Allow -Profile Private -DisplayName $i -Direction Outbound Write-Host '    ' } catch { Write-Host '      :' $i } Write-Host</span></span></code> </pre><br>  That's probably all.  At this story you can finish.  I am passing the initiative now into your hands, dare!  I hope you learned something new, or at least remembered well forgotten old.  The final script (.ps1) can be found under the spoiler below. <br><br><div class="spoiler">  <b class="spoiler_title">Summary script</b> <div class="spoiler_text"><pre> <code class="php hljs">Set-NetFirewallProfile -All -DefaultOutboundAction Block $programs = (<span class="hljs-string"><span class="hljs-string">'  Internet Explorer (x86)'</span></span>, (${env:ProgramFiles(x86)}+<span class="hljs-string"><span class="hljs-string">'\Internet Explorer\iexplore.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  Internet Explorer'</span></span>, ($env:ProgramFiles+<span class="hljs-string"><span class="hljs-string">'\Internet Explorer\iexplore.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  Google Chrome'</span></span>, (${env:ProgramFiles(x86)}+<span class="hljs-string"><span class="hljs-string">'\Google\Chrome\Application\chrome.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  Google Update'</span></span>, (${env:ProgramFiles(x86)}+<span class="hljs-string"><span class="hljs-string">'\Google\Update\GoogleUpdate.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  Tor Browser'</span></span>, ($env:USERPROFILE+<span class="hljs-string"><span class="hljs-string">'\AppData\Local\Tor Browser\Browser\firefox.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  Tor Browser updater'</span></span>, ($env:USERPROFILE+<span class="hljs-string"><span class="hljs-string">'\AppData\Local\Tor Browser\Browser\updater.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  Yandex.Browser'</span></span>, ($env:USERPROFILE+<span class="hljs-string"><span class="hljs-string">'\AppData\Local\Yandex\YandexBrowser\Application\browser.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  Notepad++ (GUP)'</span></span>, (${env:ProgramFiles(x86)}+<span class="hljs-string"><span class="hljs-string">'\Notepad++\updater\GUP.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  Visual Studio 2015'</span></span>, (${env:ProgramFiles(x86)}+<span class="hljs-string"><span class="hljs-string">'\Microsoft Visual Studio 14.0\Common7\IDE\devenv.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  Blend (Visual Studio)'</span></span>, (${env:ProgramFiles(x86)}+<span class="hljs-string"><span class="hljs-string">'\Microsoft Visual Studio 14.0\Common7\IDE\Blend.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  qBittorrent'</span></span>, (${env:ProgramFiles(x86)}+<span class="hljs-string"><span class="hljs-string">'\qBittorrent\qbittorrent.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  HWMonitor'</span></span>, ($env:ProgramFiles+<span class="hljs-string"><span class="hljs-string">'\CPUID\HWMonitor\HWMonitor.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  OneDrive'</span></span>, ($env:USERPROFILE+<span class="hljs-string"><span class="hljs-string">'\AppData\Local\Microsoft\OneDrive\OneDrive.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  PowerShell (  )'</span></span>, ($env:SystemRoot+<span class="hljs-string"><span class="hljs-string">'\System32\WindowsPowerShell\v1.0\powershell.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  PowerShell ISE (  )'</span></span>, ($env:SystemRoot+<span class="hljs-string"><span class="hljs-string">'\System32\WindowsPowerShell\v1.0\powershell_ise.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  Steam'</span></span>, (${env:ProgramFiles(x86)}+<span class="hljs-string"><span class="hljs-string">'\Steam\Steam.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  steamwebhelper'</span></span>, (${env:ProgramFiles(x86)}+<span class="hljs-string"><span class="hljs-string">'\Steam\bin\steamwebhelper.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  Steam CS GO'</span></span>, (<span class="hljs-string"><span class="hljs-string">'D:\Games\SteamLibrary\steamapps\common\Counter-Strike Global Offensive\csgo.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  TeamViewer'</span></span>, (${env:ProgramFiles(x86)}+<span class="hljs-string"><span class="hljs-string">'\TeamViewer\TeamViewer.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  TeamViewer_Service'</span></span>, (${env:ProgramFiles(x86)}+<span class="hljs-string"><span class="hljs-string">'\TeamViewer\TeamViewer_Service.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  explorer.exe'</span></span>, ($env:SystemRoot+<span class="hljs-string"><span class="hljs-string">'\explorer.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  AvastUI+'</span></span>, ($env:ProgramFiles+<span class="hljs-string"><span class="hljs-string">'\AVAST Software\Avast\AvastUI.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  AvastSvc'</span></span>, ($env:ProgramFiles+<span class="hljs-string"><span class="hljs-string">'\AVAST Software\Avast\AvastSvc.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  Avast  (AvastEmUpdate)'</span></span>, ($env:ProgramFiles+<span class="hljs-string"><span class="hljs-string">'\AVAST Software\Avast\AvastEmUpdate.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  Avast  (instup)'</span></span>, ($env:ProgramFiles+<span class="hljs-string"><span class="hljs-string">'\AVAST Software\Avast\setup\instup.exe'</span></span>)), (<span class="hljs-string"><span class="hljs-string">'  Mozilla Firefox'</span></span>, (${env:ProgramFiles(x86)}+<span class="hljs-string"><span class="hljs-string">'\Mozilla Firefox\firefox.exe'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($prog in $programs) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-NetFirewallRule -Program $prog[<span class="hljs-number"><span class="hljs-number">1</span></span>] -Action Allow -Profile Any -DisplayName $prog[<span class="hljs-number"><span class="hljs-number">0</span></span>] -Direction Outbound Write-Host <span class="hljs-string"><span class="hljs-string">': '</span></span>$prog[<span class="hljs-number"><span class="hljs-number">0</span></span>] } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { Write-Host <span class="hljs-string"><span class="hljs-string">': '</span></span>$prog[<span class="hljs-number"><span class="hljs-number">0</span></span>] } Write-Host } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $i = <span class="hljs-string"><span class="hljs-string">'  Windows Update/Modern Apps'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-NetFirewallRule -Program ($env:SystemRoot+<span class="hljs-string"><span class="hljs-string">'\System32\svchost.exe'</span></span>) -Protocol TCP -RemotePort <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-number"><span class="hljs-number">443</span></span> -Action Allow -Profile Any -DisplayName $i -Direction Outbound $i = <span class="hljs-string"><span class="hljs-string">'  Avast ()'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-NetFirewallRule -Service <span class="hljs-string"><span class="hljs-string">'avast! Antivirus'</span></span> -Action Allow -Profile Any -DisplayName $i -Direction Outbound $i = <span class="hljs-string"><span class="hljs-string">'  Mozilla Maintenance Service'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-NetFirewallRule -Service <span class="hljs-string"><span class="hljs-string">'MozillaMaintenance'</span></span> -Action Allow -Profile Any -DisplayName $i -Direction Outbound $i = <span class="hljs-string"><span class="hljs-string">'  ping (v4)'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-NetFirewallRule -Profile Any -Action Allow -DisplayName $i -Protocol ICMPv4 -IcmpType <span class="hljs-number"><span class="hljs-number">8</span></span> -Direction Outbound $i = <span class="hljs-string"><span class="hljs-string">'  ping (v6)'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-NetFirewallRule -Profile Any -Action Allow -DisplayName $i -Protocol ICMPv6 -IcmpType <span class="hljs-number"><span class="hljs-number">8</span></span> -Direction Outbound $i = <span class="hljs-string"><span class="hljs-string">'    Windows'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-NetFirewallRule -Service <span class="hljs-string"><span class="hljs-string">'WSService'</span></span> -Action Allow -Profile Any -DisplayName $i -Direction Outbound <span class="hljs-comment"><span class="hljs-comment">#   ,      (  , ) $i = '    ()' New-NetFirewallRule -Enabled False -Action Allow -Profile Private -DisplayName $i -Direction Outbound Write-Host '    ' } catch { Write-Host '      :' $i } Write-Host</span></span></code> </pre><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/275549/">https://habr.com/ru/post/275549/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../275535/index.html">Monitoring uninterruptible power supply ippon winner 3000 using apcupsd + Zabbix in Ubuntu</a></li>
<li><a href="../275539/index.html">Why is HTTPS not commonly used yet?</a></li>
<li><a href="../275541/index.html">2 ^ 74207281-1 - a prime number</a></li>
<li><a href="../275545/index.html">New interface for getting process attributes in Linux</a></li>
<li><a href="../275547/index.html">Some interesting and useful for all</a></li>
<li><a href="../275551/index.html">Watchdog timer for 4G-modem on CentOS 7</a></li>
<li><a href="../275553/index.html">How IaaS provider to choose a data center to host the cloud: IT-GRAD Experience</a></li>
<li><a href="../275555/index.html">We do FTP for Windows Azure Pack</a></li>
<li><a href="../275561/index.html">ASP.NET 5 is dead - introducing ASP.NET Core 1.0 and .NET Core 1.0</a></li>
<li><a href="../275563/index.html">Minimal HTTP Endpoint API using Elixir</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>