<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Standard Browser API Payment Request</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Do you know that many modern browsers have a built-in API called Payment Request? This API is described in the W3C standard, which aims to support the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Standard Browser API Payment Request</h1><div class="post__text post__text-html js-mediator-article">  Do you know that many modern browsers have a built-in API called Payment Request?  This API is described in <a href="https://www.w3.org/TR/payment-request/">the</a> W3C standard, which aims to support the work with billing and contact information.  <a href="https://developers.google.com/web/fundamentals/payments/">Here is an</a> overview of the standard on developers.google.com.  A review of the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Payment_Request_API">implementation of</a> this API on the MDN website suggests that the Payment Request gives the developer browser tools that allow users to associate their preferred payment systems and platforms with online stores.  This increases the convenience of making payments for goods and services, speeding up and simplifying this process.  In particular, for example, the Payment Request API allows the user to enter their billing information and address only once, and not enter the same information on each site.  Payment on all sites that support this API will look the same for the user.  The Payment Request API has other valuable features.  Among them - solving problems with the availability of payment tools for users with disabilities, synchronization of payment data between different user devices, standardized error handling tools. <br><br> <a href="https://habr.com/ru/company/ruvds/blog/460799/"><img src="https://habrastorage.org/webt/nh/fo/6j/nhfo6j9ytngnqaw1jpmed7lknp4.jpeg"></a> <br><br>  The material, the translation of which we publish today, is devoted to a demonstration of the practical use of the Payment Payment API.  It is immediately worth noting that the Payment Request API is an experimental technology that may well change in the future.  However, the author of this material says that, despite this, she is worthy to get acquainted with her.  He is confident that this technology has a bright future, and that the changes that can be made to it will not affect the basic principles of working with it too much. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">The basics</font> </h2><br>  The widespread adoption of the Payment Request API will benefit everyone involved in the creation and use of online payment systems.  In particular, for programmers and site owners, this will mean facilitating the creation of payment acceptance systems, and for users, simplifying and speeding up the process of paying for goods and services. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To use this API in JavaScript, you first need to create a <code>PaymentRequest</code> object.  The command to create it looks like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PaymentRequest(methodData: fn, <span class="hljs-attr"><span class="hljs-attr">details</span></span>: fn, options?);</code> </pre> <br>  The <code>PaymentRequest</code> constructor <code>PaymentRequest</code> passed two required parameters and one optional: <br><br><ul><li>  The <code>methodData</code> parameter is an array of objects containing information about the payment service provider.  This, for example, is information about supported payment methods. </li><li>  The <code>details</code> parameter is an object that contains information about a specific payment.  For example, the total payment amount, tax amount, shipping cost. </li><li>  The <code>options</code> parameter, optional, is an object that contains additional information about the payment. </li></ul><br>  In the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Payment_Request_API">documentation</a> with MDN, you can find information that the Payment Request API can only be used with HTTPS.  This is pretty obvious considering what this API works with. <br><br>  Here's what the user interaction with the Payment Request API looks like. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/08a/134/b1a/08a134b1adf28c682fbb993cddd848a3.gif"></div><br>  <i><font color="#999999">Using Payment Request API</font></i> <br><br>  As you can see, the payment system is integrated directly into the browser.  This means that you do not need to use unsafe redirection operations to complete the payment, you do not need to use any external APIs either.  Everything happens directly in the browser. <br><br>  <a href="https://codepen.io/DevUncoded/pen/rGjpXG">Here is a</a> project in which an implementation of a screen is presented, showing the user a list of saved payment card data. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c7/649/ee3/1c7649ee3b641ad5fc587861db440de1.png"></div><br>  <i><font color="#999999">Saved Cards</font></i> <br><br>  Consider a practical example of working with the Payment Request API. <br><br><h2>  <font color="#3AC1EF">Project Overview</font> </h2><br>  If you want to experiment with the project on your own, which we will analyze, you can execute the following command: <br><br><pre> <code class="javascript hljs">git clone https:<span class="hljs-comment"><span class="hljs-comment">//github.com/indreklasn/payments-request-api-example.git &amp;&amp; yarn &amp;&amp; yarn start</span></span></code> </pre> <br>  It clones the appropriate repository, installs the project dependencies, and starts the server, available at <code>localhost:3000</code> .  Please note that the application under consideration is launched in the local system for research purposes. <br><br>  The main page of the application is very simple.  It imitates a fragment of the interface of an online store that allows you to "put in a basket" a certain product.  To start the checkout process, click on the <code>BUY</code> button. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/569/f53/a31/569f53a31254d2af7603e10f32035044.png"></div><br>  <i><font color="#999999">Application page</font></i> <br><br>  We are dealing with a very simple application.  Therefore, we can place all the logic related to the interface of the ‚Äúonline store‚Äù and to payments in the <code>app.js</code> file: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cartIncrementButton = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'cartIncrement'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cartDecrementButton = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'cartDecrement'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> countElement = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'count'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> buyButton = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'purchase'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   countElement.innerHTML = count  cartIncrementButton.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, () =&gt; {    count++    countElement.innerHTML = <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${count}</span></span></span><span class="hljs-string">$`</span></span>  })   cartDecrementButton.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, () =&gt; {    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count === <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>    count--    countElement.innerHTML = <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${count}</span></span></span><span class="hljs-string">$`</span></span>  }) } init()</code> </pre> <br>  Here we get links to DOM elements, in particular, to buttons for increasing and decreasing the quantity of ‚Äúgoods‚Äù, and we attach event handlers to them.  The total amount is displayed in the corresponding page element. <br><br>  The <code>cartIncrementButton</code> button from our code can be imagined as a button that allows you to add some product to the basket.  The <code>cartDecrementButton</code> button allows <code>cartDecrementButton</code> to remove the goods from the basket, and the price of all goods that were put in the basket is displayed in the <code>countElement</code> element. <br><br><h2>  <font color="#3AC1EF">Implementation of a payment system</font> </h2><br>  The following code also gets into <code>app.js</code>  It is an implementation of the event handler that occurs when you click on the <code>BUY</code> button (it is called <code>buyButton</code> in the code): <br><br><pre> <code class="javascript hljs">buyButton.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, () =&gt; {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PaymentRequest(    buildSupportedPaymentMethodData(),    buildShoppingCartDetails()  ); })</code> </pre> <br>  After the user clicks the <code>BUY</code> button, we create a new instance of the <code>PaymetnRequest</code> object.  We use here a couple of functions that return what needs to be passed to the constructor of the object.  These are the functions <code>buildSupportedPaymentMethodData</code> and <code>buildShoppingCartDetails</code> . <br><br>  The first argument to the constructor is represented by a call to the <code>buildSupportedPaymentMethodData</code> function.  It returns an array of objects that are supported payment methods.  This function is declared in <code>app.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildSupportedPaymentMethodData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{  <span class="hljs-comment"><span class="hljs-comment">//    :  return [{    supportedMethods: 'basic-card',    data: {      supportedNetworks: ['visa', 'mastercard'],      supportedTypes: ['debit', 'credit']    }  }];</span></span></code> </pre> <br>  The second argument to the constructor, <code>buildShoppingCartDetails</code> , is a function call that generates the information needed to complete the purchase. <br><br>  This information may include, for example, a description of the purchased goods, their value, total purchase amount.  The code for the <code>buildShoppingCartDetails</code> function <code>buildShoppingCartDetails</code> also in <code>app.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildShoppingCartDetails</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {    <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-string"><span class="hljs-string">'count-order'</span></span>,    <span class="hljs-attr"><span class="hljs-attr">displayItems</span></span>: [      {        <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'Example item'</span></span>,        <span class="hljs-attr"><span class="hljs-attr">amount</span></span>: {<span class="hljs-attr"><span class="hljs-attr">currency</span></span>: <span class="hljs-string"><span class="hljs-string">'USD'</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">'1.00'</span></span>}      }    ],    <span class="hljs-attr"><span class="hljs-attr">total</span></span>: {      <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'Total'</span></span>,      <span class="hljs-attr"><span class="hljs-attr">amount</span></span>: {<span class="hljs-attr"><span class="hljs-attr">currency</span></span>: <span class="hljs-string"><span class="hljs-string">'USD'</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: count }    }  }; }</code> </pre> <br>  Note that this function returns an object, not an array of objects. <br><br>  Now we are ready to show the user a window for making a payment.  Call the <code>.show()</code> method of the <code>request</code> object.  This call will return the promise.  If you are not familiar with promises, take a look at <a href="https://medium.com/better-programming/improve-your-asynchronous-javascript-code-with-async-and-await-c02fc3813eda">this</a> material.  The code, again, is in <code>app.js</code> : <br><br><pre> <code class="javascript hljs">buyButton.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, () =&gt; {  <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PaymentRequest(    buildSupportedPaymentMethodData(),    buildShoppingCartDetails()  );  request.show().then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">paymentResponse</span></span></span><span class="hljs-function"> =&gt;</span></span> {    <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(paymentResponse)  }) })</code> </pre> <br>  As a result, after we press the <code>BUY</code> button, we should see what is shown in the following figure. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/225/067/ee1/225067ee11999b8b972ff6d074982e70.png"></div><br>  <i><font color="#999999">User payment review</font></i> <br><br>  At this step, you will probably need to add bank card information to the system.  I recommend using the VISA test card here.  Enter the card number, your name and address in the appropriate fields.  We are just testing the API, so the data entered may not be real. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f78/8b7/3f2/f788b73f2dd1fcd540286c628d0a7003.png"></div><br>  <i><font color="#999999">Visa Test Card Number</font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c30/0bd/88c/c300bd88ca303e9ced38f7c9b4fda792.png"></div><br>  <i><font color="#999999">Enter card details</font></i> <br><br><h2>  <font color="#3AC1EF">Payment processing</font> </h2><br>  After we entered the card information into the system and confirmed the payment, we get the <a href="https://developer.mozilla.org/en-US/docs/Web/API/PaymentResponse">PaymentResponse</a> object returned from the promise. <br><br>  Call its <a href="https://developer.mozilla.org/en-US/docs/Web/API/PaymentResponse">.complete ()</a> method to tell the user that everything is going as it should.  Here's what it looks like in code: <br><br><pre> <code class="javascript hljs">buyButton.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, () =&gt; {  <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PaymentRequest(buildSupportedPaymentMethodData(), buildShoppingCartDetails());  request.canMakePayment().then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function"> =&gt;</span></span> {    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result) {      request.show().then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">paymentResponse</span></span></span><span class="hljs-function"> =&gt;</span></span> {        <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(paymentResponse.details)        <span class="hljs-comment"><span class="hljs-comment">//    . ,   ,     ,    .        paymentResponse.complete('success')          .then(() =&gt; thankYouMessage.style.opacity = 1)      })    }     }) })</span></span></code> </pre> <br>  That's all!  We just examined the code that is needed to implement the simplest basket of an online store. <br><br>  Here is a complete demonstration of the application. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/476/8b9/c69/4768b9c69424785e830cc0297389beeb.gif"></div><br>  <i><font color="#999999">Application Demonstration</font></i> <br><br>  ‚Üí <a href="https://github.com/indreklasn/payments-request-api-example">Here</a> you can find the source code of the project. <br><br><h2>  <font color="#3AC1EF">About support for Payment Request API browsers</font> </h2><br>  <a href="https://caniuse.com/">Here is</a> information on supporting the Payment Request API with caniuse.com. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f76/8ce/4b9/f768ce4b93afd556baaf8ffcc37cf9b9.png"></div><br>  <i><font color="#999999">Which browsers support the Payment Request API?</font></i> <br><br>  As you can see, this API is relatively new, so it does not yet have particularly wide browser support.  The good thing is that it is supported by Chrome, Safari, Firefox and Edge.  You probably use at least one of these browsers, so you can fully experience everything that we talked about above. <br><br>  It should be noted that it is obvious that in the area of ‚Äã‚Äãsupport for Payment Request API browsers still have a lot of work to do.  This is especially true for mobile browsers.  Therefore, if I were to use this API now, I would not count on its work on mobile devices so far. <br><br><h2>  <font color="#3AC1EF">Summary</font> </h2><br>  The Payment Request API has every chance of becoming a widespread and popular technology.  Therefore, if this technology interests you - <a href="https://developers.google.com/web/fundamentals/payments/basics/how-payment-ecosystem-works">here</a> , <a href="https://www.w3.org/TR/payment-request/">here</a> , <a href="https://developer.mozilla.org/en-US/docs/Web/API/Payment_Request_API">here</a> and <a href="https://stripe.com/docs/payment-request-api">here</a> - materials that can help you better understand it. <br><br>  <b>Dear readers!</b>  Are you considering using the Payment Request API in your projects? <br><br> <a href="https://ruvds.com/turbo_vps/"><img src="https://habrastorage.org/webt/rw/6v/yn/rw6vyn2bxx4usoqc39holmj2z8m.jpeg"></a> </div><p>Source: <a href="https://habr.com/ru/post/460799/">https://habr.com/ru/post/460799/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../460783/index.html">Consensus on the reputation of the node. Do I need?</a></li>
<li><a href="../46079/index.html">Office behind the glass - now on the Internet</a></li>
<li><a href="../460793/index.html">Structuring React Applications</a></li>
<li><a href="../460795/index.html">12 tips for improving JavaScript application performance</a></li>
<li><a href="../460797/index.html">Responsible JavaScript Development Part 2</a></li>
<li><a href="../4608/index.html">The trend in the blogosphere: "subzamochnye" records</a></li>
<li><a href="../460801/index.html">27 awesome VS Code tools for modern JavaScript developers</a></li>
<li><a href="../460803/index.html">Reading for the summer: books for techies</a></li>
<li><a href="../460805/index.html">How to transfer data between microcontrollers at 100 Mbps</a></li>
<li><a href="../460807/index.html">Measure seven times, once implement BI tool</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>