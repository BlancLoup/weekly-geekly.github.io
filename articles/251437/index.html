<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a convenient export of photos in VK. Part 1. iPhoto</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Entry and PR 
 Finally, it became possible to describe the process of developing the Share + plugin, which allows you to send photos directly to your ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a convenient export of photos in VK. Part 1. iPhoto</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/bf4/eb3/15e/bf4eb315e2a34e888d751b2d2f23ad8e.png"><br><br><a name="habracut"></a><br><h1>  Entry and PR </h1><br>  Finally, it became possible to describe the process of developing the Share + plugin, which allows you to send photos directly to your photo album on VKontakte or to your wall.  It is a little about the reasons which prompted the author to so frivolous an undertaking.  The reason, as always, is one - laziness.  It was too lazy to export from the iPhoto library to the file system those photos that you want to place on the social network VK, it is much easier to have a tool that will automatically do the majority.  As a result, user actions are reduced to selecting photos and choosing how to export photos, and you don‚Äôt even need to go beyond the iPhoto interface.  At the output we get approximately the following sequence of screens: <br><br><img src="https://habrastorage.org/files/5b2/359/8fb/5b23598fbb474a6091081a8963a40124.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/fed/891/1b4/fed8911b43854841842870ee8aa3e61f.png"><br><br><img src="https://habrastorage.org/files/eae/f6c/1f8/eaef6c1f83074f9791d74bb8810221b6.png"><br><br>  When you click on the Export button, the selected images will first be exported to the file system in a temporary folder, then read and sent to VK, and deleted in the final.  If you want to leave a copy in the file system, you can set the appropriate setting.  This process is due to the way the export system in iPhoto works and what is open to access.  That is, in the closed part of the iPhoto API, there may be a way to bypass the file system and export the byte stream right away, which you then immediately send to VK, but this method is unknown to the author, although it would help to unload the file system. <br><br><h2>  Development process </h2><br><h3>  Creating a plug-in preset </h3><br>  The main task at this stage is to see the created UI in the menu File -&gt; Export.  It is necessary to make changes to the project settings, edit the target and implement the necessary protocols.  In fact, if you use the source code from the <a href="http://cuboidal.org/iphoto-export-plugin/">article</a> , there should be few changes.  Although I had to try - rename classes and interface files (.xib). <br>  <b>It is important to remember that the entire project needs to be created without using ARC.</b>  <b>This is due to the fact that the source code of the reference plugin was developed for iPhoto version 6, and was written before the advent of ARC.</b>  However, it is possible to use other libraries or categories written using ARC.  For this you need: <br>  1. Such categories or libraries (files of their components) add directly to the project <br>  2. Then in the Build Phases of the project target find the Compiled Sources drop-down list. <br>  3. Find all the files included in the necessary new libraries or categories and set the flag for the compiler: -fobjc-arc <br><br><img src="https://habrastorage.org/files/26b/739/e99/26b739e995d24761b3c876b9e55c8a18.png"><br><br>  To debug, as stated in the article, you need to specify iPhoto as the starting application.  It is necessary to set the exectuable parameter in iPhoto in Edit Scheme (Edit Scheme): <br><br><img src="https://habrastorage.org/files/188/85b/937/18885b9379c2410681822cecad08e019.png"><br><br>  After all these settings, you need to achieve the work of this plug-in work in its original form.  The original implementation can only export to the file system.  Next, we will expand the functionality to the final goal: export to VK. <br><br><h3>  We draw the UI for a plug-in </h3><br>  The reference plugin already provides the UI necessary for setting the quality of exported photos, adding EXIF ‚Äã‚Äãinformation.  Our task is to add elements necessary for working with VK.  We need a login button (toggle Sign In / Sign Out), a drop-down list where all existing user albums will be added, a checkbox for saving a copy of the exported image in the file system and a text field for entering the name of a new album - it will appear when the corresponding item is selected. in the drop down list of albums.  You need to get something similar on the output: <br><br><img src="https://habrastorage.org/files/653/fac/47c/653fac47c13d429dbaa5cb754c477096.png"><br><br>  Further, as usual, you need to connect all our controls with their variables in the .h file (interface). <br>  In the future, in this article I‚Äôll bring in the code sections that relate directly to the export of photos to VK, since the rest of the code is needed to implement the process of exporting from iPhoto to the file system. <br><br><h4>  Authorization </h4><br>  We will send photos using the Vkontakte API (VK API).  The first thing you need to log in to use the VK API.  Authorization happens through OAuth2.  That is, it will be necessary to work with Http requests via WebView.  Add an NSWindowController with a UI that contains only a WebView, then you need to connect this WebView with a variable in the interface created by NSWindowController.  Next, we implement several WebFrameLoadDelegate protocol methods.  All code is entirely available on <a href="https://github.com/olegbragin/SharePlus">GitHub</a> , so I‚Äôll give you a piece where all the magic happens.  The code can be divided into two parts.  The first part works out if one photo is selected for export, and the second one if a lot.  In the current example, I will show only for a set of photos, since the code for one is the same as for one iteration of the loop: <br><br><pre><code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i=<span class="hljs-number"><span class="hljs-number">0</span></span>; mCancelExport==<span class="hljs-literal"><span class="hljs-literal">NO</span></span> &amp;&amp; succeeded==<span class="hljs-literal"><span class="hljs-literal">YES</span></span> &amp;&amp; i&lt;count; i++) { dest = [[<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> exportDir] stringByAppendingPathComponent: [<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> stringWithFormat:<span class="hljs-string"><span class="hljs-string">@"shareplus-%d.jpg"</span></span>, i]]; succeeded = [mExportMgr exportImageAtIndex:i dest:dest options:&amp;imageOptions]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (succeeded) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (mAlbumPopUp.selectedTag) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ToWall: [SPVkApiClient.sharedInstance exportImageToWall:dest completion:^(<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *rawPhotos, <span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> *error) { [fileMgr removeItemAtPath:dest error:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; }]; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ToNewAlbum: [SPVkApiClient.sharedInstance makeNewAlbumWith:[mAlbumNameTextbox stringValue] accessToken:VkUser.current.accessToken completion:^(VkAlbum *album, <span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> *error) { [SPVkApiClient.sharedInstance exportImageToAlbum:dest albumId:album.Id completion:^(<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *rawPhotos, <span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> *error) { [fileMgr removeItemAtPath:dest error:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; }]; }]; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: [SPVkApiClient.sharedInstance exportImageToAlbum:dest albumId:mAlbumPopUp.selectedTag completion:^(<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *rawPhotos, <span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> *error) { [fileMgr removeItemAtPath:dest error:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; }]; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } }</code> </pre> <br>  Of course, the code still needs to be refactored, but for demonstration purposes, I will leave it in its current form.  So, it all comes down to getting the full path in the file system, where we will export the selected photos.  Using this path we call the method <br><br> <code>[mExportMgr exportImageAtIndex:i dest:dest options:&amp;imageOptions]; <br></code> <br><br>  where <i>mExportMgr</i> is the main export manager we use.  The export method returns a <i>boolean</i> indicating the success of the export. <br><br>  Next, we check that the user chooses in the drop-down list; <i>mAlbumPopUp.selectedTag</i> is responsible for this, where <i>mAlbumPopUp</i> is the variable connected to the UI element in the form of the issuing list.  Depending on what the user has chosen, we perform one of three operations.  The names of the methods speak for themselves; they are exported to the user's wall, to a specific album and saved to a new album with the automatic creation of this album. <br><br><h4>  Conclusion </h4><br>  In this part of the article, it was shown how you can create your own simple plugin for iPhoto, which can make your life easier if you often use VKontakte and / or prefer to store your photos in iPhoto.  For the author of the article both statements are true. <br><br>  But time does not stand still; last year, Apple introduced a new way of creating extensions for applications ‚Äî App Extensions; now such extensions have become systemic, that is, not for a specific program, but installed in the system and any program can use them.  Plus, at the beginning of this year, OS X Yosemite 10.10.3 was released, which included a new Photos for Mac application, it was rewritten from scratch and plug-in support was no longer available.  So in the next article I will tell you the process of creating an app extension, which can do the same (export photos, directly to VKontakte), but in a new way. <br><br>  You can view and criticize the source code on <a href="https://github.com/olegbragin/SharePlus">GitHub</a> . <br><br>  Information sources: <br>  1. <a href="http://cuboidal.org/iphoto-export-plugin/">cuboidal.org/iphoto-export-plugin</a> .  Only thanks to this article and the source code in it, I was able to start digging. <br>  2. <a href="http://habrahabr.ru/post/133504/">habrahabr.ru/post/133504</a> .  And this publication has helped to realize the basics of working with the VK API.  Many sections of the code on the interaction of my plug-in with the VK API even migrated almost unchanged. <br><br>  3rd party tools used in development: <br>  1. <a href="http://afnetworking.com/">AFNetworking 2.5.0</a> .  In my opinion, the most convenient framework for working with HTTP requests.  Actively supported. <br>  2. <a href="https://github.com/soffes/sskeychain">SSKeychain</a> .  A very simple and convenient way to work with Keychain on Mac OS X. </div><p>Source: <a href="https://habr.com/ru/post/251437/">https://habr.com/ru/post/251437/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../251425/index.html">Patterns Don't Stop at Design - Be a Pattern-Driven Team</a></li>
<li><a href="../251427/index.html">Getting to know GStreamer: items and containers</a></li>
<li><a href="../251431/index.html">How to recognize the manipulation and quickly neutralize them</a></li>
<li><a href="../251433/index.html">Started voting for the new features of the browser Vivaldi</a></li>
<li><a href="../251435/index.html">We stamp windows: automated deployment of Windows virtual machines to Hyper-V using Vagrant (part 1)</a></li>
<li><a href="../251439/index.html">The output temperature, traffic jams and exchange rates on the LED matrix Raspberry Pi</a></li>
<li><a href="../251441/index.html">Few obscure frontend tricks</a></li>
<li><a href="../251443/index.html">Visual Studio 2015 CTP6 released</a></li>
<li><a href="../251445/index.html">Vulnerability in WP-Slimstat plugin 3.9.5 and below for WordPress</a></li>
<li><a href="../251447/index.html">In search of the best signal of the mobile Internet in the spring of 2015</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>