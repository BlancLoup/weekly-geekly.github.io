<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Android Cuvettes, Part 3: SDK and RxJava (Final)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Android SDK and "surprise" - almost twins. You may know by heart the development.android.com , but at the same time continue to tear your hair when yo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Android Cuvettes, Part 3: SDK and RxJava (Final)</h1><div class="post__text post__text-html js-mediator-article">  Android SDK and "surprise" - almost twins.  You may know by heart the <a href="http://developer.android.com/intl/ru/guide/index.html">development.android.com</a> , but at the same time continue to tear your hair when you try to do something more abruptly than the form-button-progress bar. <br>  This is the final, third, part of a series of articles on Android's Ditches.  <s>In fact, of course there should have been about two dozen of them, but I am too modest.</s>  At this time, I finally finish the trouble in the SDK, which I happened to encounter, as well as touch on the now popular technology <a href="http://reactivex.io/">ReactiveX</a> . <br>  In general, the Android SDK, RxJava, Cuvettes - let's go! <br><img src="https://habrastorage.org/getpro/habr/post_images/907/5f9/f9f/9075f9f9fefe6985f639b6ae3b6230c7.jpg" alt="image"><br><a name="habracut"></a><br>  Previous parts: <br><ul><li>  <a href="https://habrahabr.ru/post/279811/">Android Cuvettes, Part 1: SDK</a> </li><li>  <a href="https://habrahabr.ru/post/280190/">Android Cuvettes, Part 2: SDK and Libraries</a> </li></ul><br><br><h4>  1. <a href="http://developer.android.com/reference/android/app/Activity.html">Activity.onOptionsItemSelected () is</a> not called when <a href="http://developer.android.com/guide/topics/resources/menu-resource.html">actionLayout is</a> set </h4><br><h5>  Situation </h5><br>  Once I did a test task.  It was boring, monotonous and ... old.  Very old.  <b>PSD</b> from the last century.  Well, not the essence.  Having finished all the main points, I began to read all the indents (agas, in handles, in a ruler, in the old fashioned way).  Things went well until I discovered a nasty menu mismatch in the app and in the <b>PSD</b> .  The icon was the same, but the <b>padding is</b> not the same.  As an adventurer, I didn‚Äôt reduce the icon, but decided to use the <a href="http://developer.android.com/intl/ru/reference/android/view/MenuItem.html">MenuItem</a> <b>actionLayout</b> property.  Quickly adding a new <b>layout</b> with the parameters I needed and rechecking the indents of the icons on the emulator, I sent the solution and went into the sunset. <br><br><h5>  Situation </h5><br>  What was my surprise when the answer came (literally): "Editing does not work."  By the way, I tested the application in the same way and this way and should not have missed something.  The panic intensified and the laconic form of the answer from which it was not clear what exactly did not work ... <br>  ... fortunately, it did not take long to search.  As it became clear from the title, <b>onOptionsItemSelected () is</b> simply ignored when setting a custom <b>layout</b> . <br><div class="spoiler">  <b class="spoiler_title">Why?</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/13b/17b/494/13b17b4944f017366c8615214fcc8301.jpg" alt="image"><br></div></div><br>  Since then, I clearly realized that with <b>Android,</b> jokes are bad and even changes in design can lead to changes in the behavior of the application.  Well, as always, the <a href="http://stackoverflow.com/questions/17764821/onmenuitemselected-isnt-called-when-layout-is-set-for-menu-item">solution</a> : <br><div class="spoiler">  <b class="spoiler_title">workaround</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateOptionsMenu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Menu menu)</span></span></span><span class="hljs-function"> </span></span>{ MenuInflater inflater = getMenuInflater(); inflater.inflate(R.menu.main_menu, menu); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Menu m = menu; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> MenuItem item = menu.findItem(R.id.your_menu_item); item.getActionView().setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ onOptionsItemSelected(item); } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre> <br></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  2. <a href="https://habrahabr.ru/post/215605/">MVC / MVP / MVVM</a> and other beautiful words <b>vs.</b>  <a href="http://developer.android.com/guide/topics/resources/runtime-changes.html">screen mover</a> </h4><br><h5>  Situation </h5><br>  Perhaps each of us at least once heard of <b>MVC</b> and its relatives.  On the <b>MVVM</b> android is not yet built (lying, you can, but so far <a href="http://robobinding.github.io/RoboBinding/getting_started.html">Beta</a> ), but <b>MVC and MVP</b> are being used extensively.  But how?  Any android developer is aware that when you rotate the screen, the <b>Activity</b> and <b>Fragment are</b> completely destroyed (and with them a handful of nerves to boot).  So how do you apply, for example, <b>MVP</b> and at the same time be able to rotate the screen without harming the <b>presenter</b> ? <br><br><h5>  Decision </h5><br>  And there are already 3 main solutions: <br><ol><li>  ‚ÄúUse <a href="http://developer.android.com/reference/android/app/Fragment.html">Fragment.setRetainInstance ()</a> everywhere and you will be happy,‚Äù or something newbies usually say.  Unfortunately, this decision, though it saves at first, but destroys all plans, if necessary, to add a <b>Presenter</b> to the <b>Activity</b> .  And it happens.  Most often with the introduction of <b>DualPane</b> . <br><div class="spoiler">  <b class="spoiler_title">What is DualPane?</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/051/3a1/9da/0513a19da226f07eaaa46b26d324aea1.jpg" alt="image"><br></div></div><br>  And also <b>setRetainInstance ()</b> has a bug that does not alleviate its benefit.  But more on that later. </li><li>  Libraries, frameworks, etc., etc.  Fortunately, there are quite a lot of them: <a href="https://habrahabr.ru/post/276189/">Moxy (the ‚Äúmust read‚Äù article on a similar topic)</a> , <a href="http://hannesdorfmann.com/mosby/">Mosby</a> , <a href="https://github.com/square/mortar">Mortar</a> , etc.  Some of them at the same time will keep you nerves when trying to restore the so-called <a href="http://trickyandroid.com/saving-android-view-state-correctly/">View State</a> . </li><li>  Well, the approach is "crazy hands" - we create a <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D0%25B4%25D0%25B8%25D0%25BD%25D0%25BE%25D1%2587%25D0%25BA%25D0%25B0_%2528%25D1%2588%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F%2529">Singleton</a> , we give it the <b>GetUniqueId ()</b> method (let it return <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/atomic/AtomicInteger.html">AtomicInteger</a> values ‚Äã‚Äãwith increment on call).  We create a <b>Presenter</b> and save the previously received <b>ID</b> in the <a href="http://developer.android.com/intl/ru/reference/android/os/Bundle.html">Bundle of</a> the <b>Activity / Fragment</b> ', and the <b>Presenter is</b> stored inside <b>Singleton</b> with access by <b>ID</b> .  Is done.  Now your <b>Presenter</b> does not depend on the <b>lifecycle</b> <s>(otherwise, it‚Äôs in <b>Singleton</b> )</s> .  Don't forget to just delete <b>Presenters</b> in <b>onDestroy ()</b> ! </li></ol><br><br><h4>  3. <b>TextView</b> with a picture </h4><br>  And as usual, one is not a ditch, but advice. <br>  What will you do if you need to do something like this? <br><div class="spoiler">  <b class="spoiler_title">Icon labeled</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/2d4/55d/070/2d455d070cfde2a3c8365ea2968dc669.jpg" alt="image"><br></div></div><br>  If your answer is ‚ÄúPF!  What problems?  <b>TextView</b> and <b>ImageView</b> in <b>LinearLayout</b> or <b>RelativeLayout</b> ‚Äù- then this advice is for you.  Oddly enough, <b>TextView</b> has a <a href="http://developer.android.com/reference/android/widget/TextView.html">TextView.drawable {ANY_SIDE}</a> property along with <a href="http://developer.android.com/reference/android/widget/TextView.html">TextView.drawablePadding</a> !  They do exactly what they are supposed to do and no nested <b>layouts to</b> you. <br><div class="spoiler">  <b class="spoiler_title">What different TextView.drawable {ANY_SIDE} looks like</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/479/65c/993/47965c993fe7c88bd595098e30e0ccab.png" alt="image"><br></div></div><br>  Honestly, I myself found out about this property relatively recently and accidentally, because it didn‚Äôt even occur to me to search <b>TextView</b> properties related to pictures. <br><br><h4>  4. <a href="http://developer.android.com/intl/ru/reference/android/app/Fragment.html">Fragment.setRetainInstance ()</a> allows you to save only <u>direct</u> descendants of <b>Activity</b> ( <a href="http://developer.android.com/intl/ru/tools/support-library/index.html">AppCompat</a> ) </h4><br><h5>  Situation </h5><br>  If your father is <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B6%25D0%25BE%25D0%25BD_%25D0%25A2%25D0%25B0%25D0%25B9%25D1%2582%25D0%25BE%25D1%2580">John Taytor</a> , and your mother is <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B0%25D1%2580%25D0%25B0_%25D0%259A%25D0%25BE%25D0%25BD%25D0%25BD%25D0%25BE%25D1%2580_%2528%25D0%25BF%25D0%25B5%25D1%2580%25D1%2581%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B6%2529">Sarah Connor</a> , and you came from far 2013, then you still have a fresh feeling of hatred for the <a href="http://developer.android.com/intl/ru/about/versions/android-4.2.html">Fragments</a> that you <a href="http://developer.android.com/intl/ru/about/versions/android-4.2.html">put in</a> .  Indeed, at that time it was quite difficult to cope with their ‚Äúdisobedience‚Äù ( <a href="http://delyan.me/android-s-matryoshka-problem/">tyts</a> , <a href="http://blog.shamanland.com/2014/01/nested-fragments-for-result.html">tyts</a> ) and the ‚Äúcode with <b>embedded Fragments</b> ‚Äù quickly turned into a ‚Äúcode with crutches‚Äù. <br>  At that time I was just beginning to program and, after reading such horrors, I decided not to take the <b>nested Fragments</b> in my hands. <br>  As time went on, I did not use <b>Fragment's nesting</b> , but for some reason all the news of this plan passed me ... And then, suddenly, I came across the news (sorry, I sowed a link) that <b>Fragment'y</b> now all <b>Nested</b> and life in general == fairy tale.  And what to say - I believed!  Created a project, dashed an example where <b>Fragment's</b> <b>hash</b> <b>Presenters were</b> converted to color (this would immediately determine if the <b>retain</b> worked), launched, turned the screen and ... <br><br><h5>  AND..? </h5><br>  And I spent the whole weekend searching for the reason why only the first level <b>Fragments</b> (those stored in the <b>Activity</b> itself) are saved.  Naturally, the first thing I began to sin on was myself.  I rummaged through all the code, starting from the painting code, ending with the eradication of <b>MVP</b> , studied the <b>SDK</b> sources, dug tons of posts on <b>Nested Fragments</b> (and there is such a cloud that even developers feel sorry for), reinstalled the emulator (!) And only by the end of the last weekend found <a href="http://ideaventure.blogspot.ru/2014/10/nested-retained-fragment-lost-state.html">THIS</a> ! <br>  For those who are too lazy to read: <b>Fragment.setRetainInstance ()</b> keeps <b>Fragment</b> from being destroyed with the help of the <a href="http://developer.android.com/intl/ru/reference/android/app/FragmentManager.html">FragmentManager</a> - that's all ok.  However, for some reason, one of the developers took, and added the line <b>mFragmentManager = null;</b>  , and only for <b>Fragment's</b> implementation - so the <b>Activity</b> was fine! <br>  Why, why and how it happened - interesting questions that remain unanswered.  This single-line bug already stretches 2.5 versions.  In the above link ( <a href="http://ideaventure.blogspot.ru/2014/10/nested-retained-fragment-lost-state.html">for the lazy, it is the same</a> ) describes the <b>workaround on reflection</b> .  Unfortunately, for now this is the only way to solve the problem (well, except for the complete copying of the source code to my project, of course).  The problem itself is described in more detail on the <a href="https://code.google.com/p/android/issues/detail%3Fid%3D76498">bug tracker</a> . <br><br>  ps I do not sell the time machine ‚î¨‚î¥‚î¨‚î¥‚î§ (ÔΩ• _‚îú‚î¨‚î¥‚î¨‚î¥ <br><br><h4>  5. <b>RxJava</b> : the difference between <a href="http://reactivex.io/documentation/operators/observeon.html">observeOn ()</a> and <a href="http://reactivex.io/documentation/operators/subscribeon.html">subscribeOn ()</a> </h4><br>  Perhaps I'll start with the simplest and most important. <br>  When I first took on the <b>Rx</b> , I was completely unclear about the difference between these methods.  From a logic point of view, <b>subscribeOn ()</b> changes the <a href="http://reactivex.io/documentation/scheduler.html">Scheduler</a> on which <a href="http://reactivex.io/documentation/operators/subscribe.html">subscribe () is</a> called.  But ... from the point of view of another logic, <a href="http://reactivex.io/RxJava/javadoc/rx/Subscriber.html">Subscriber</a> inherits the <a href="http://reactivex.io/RxJava/javadoc/rx/Observer.html">Observer</a> , and what does the <b>Observer</b> do?  <b>Observe</b> probably.  And this is where <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25B3%25D0%25BD%25D0%25B8%25D1%2582%25D0%25B8%25D0%25B2%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B4%25D0%25B8%25D1%2581%25D1%2581%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BD%25D1%2581">cognitive dissonance</a> occurred.  Understandings did not introduce either <i>google</i> , or <i>stackoverflow</i> , or even <a href="http://reactivex.io/documentation/operators/subscribeon.html">official marbles</a> .  But of course, such knowledge is extremely important and it came about after a week or two of errors with <b>Schedulers</b> . <br>  I often hear this question from my acquaintances and sometimes I meet in various forums, so here‚Äôs an explanation for those who are still going to be ‚Äúreactive‚Äù or use these operators simply intuitively, without worrying about the consequences: <br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="java hljs">Observable.just(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) .doOnNext(v0id -&gt; Log.i(<span class="hljs-string"><span class="hljs-string">"TAG"</span></span>, <span class="hljs-string"><span class="hljs-string">"0"</span></span>)) <span class="hljs-comment"><span class="hljs-comment">//  : computation .observeOn(Schedulers.newThread()) .doOnNext(v0id -&gt; Log.i("TAG", "1")) //  : newThread .observeOn(Schedulers.io()) // io .doOnNext(v0id -&gt; Log.i("TAG", "2"))  : io .subscribeOn(Schedulers.computation()) .subscribe(v0id -&gt; Log.i("TAG", "3")); // -  : io</span></span></code> </pre><br></div></div><br>  I suppose (from my own experience) that the most incomprehensible thing is that everywhere <b>ReactiveX is</b> moving forward with the slogan <b>‚ÄúEverything is a stream‚Äù</b> .  As a result, the novice expects that each operator affects only the operators following it, but not the entire stream at all.  However, it is not.  For example, <a href="http://reactivex.io/documentation/operators/startwith.html">startWith ()</a> affects the beginning of the stream, and <a href="http://reactivex.io/documentation/operators/do.html">finallyDo</a> - at its end. <br>  And as for names, having rummaged in <b>Rx</b> source codes, you find out that the data is generated not by the <b>Observable</b> class (suddenly, yes?), But by the <b>OnSubscribe</b> class.  I think it is from here that the confusing name of the operator <b>subscribeOn ()</b> . <br>  By the way, I strongly advise beginners, and even experienced connoisseurs, to familiarize themselves with the <a href="https://github.com/android10/frodo">logos for Frodo logging</a> .  Save yourself a lot of time, because debugging the <b>Rx</b> code is another problem. <br><br><h4>  6. <b>RxJava</b> : <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.Operator.html">Operators</a> and <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.Transformer.html">Transformers</a> </h4><br><h5>  Situation </h5><br>  Often it happens that the <b>Rx</b> code grows and you want to somehow reduce it.  <a href="https://en.wikipedia.org/wiki/Method_chaining">The method of calling methods in the form of chains</a> is good, yes, but here it has zero reuse - you have to call all the same methods every time doing small things, etc.  etc. <br>  Faced with such a need, beginners begin to think in terms of OOP and create, if absolutely everything is bad, static-methods and wrap the beginning of the call chain into it.  If time does not end with this approach, it will degenerate into 3-4 wrappers into one <b>Observable</b> . <br><div class="spoiler">  <b class="spoiler_title">The real code in one of the real products</b> <div class="spoiler_text"><pre> <code class="java hljs">RxUtils.HandleErrors( RxUtils.FireGlobalEvents( RxUtils.SaveToCaches( Observable.defer(() -&gt; storeApi.getAll(filter)).subscribeOn(Schedulers.io()), caches) , <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StoreDataLoadedEvent() ) ).subscribe(storeDataObserver);</code> </pre><br></div></div><br>  In the future, this will bring a lot of problems to those who just want to understand what the code is doing and to those who want to change something. <br><br><h5>  And now what? </h5><br>  <b>Chain-methods</b> are good because they are easy to read.  I advise you as soon as possible to learn how <a href="https://github.com/ReactiveX/RxJava/wiki/Implementing-Your-Own-Operators">to make your operators and transformers</a> .  It is easier than it seems.  It is only important to understand that <b>Operator</b> works with a data unit (for example, one <b>onNext ()</b> call at a time), and <b>Transformer</b> converts the <b>Observable</b> itself (here you can combine the usual <b>map () / doOnNext (), etc.</b> into one). <br><br>  All finished with children's games.  Let's go to the Tubes. <br><br><h4>  7. <b>RxJava</b> : Chaos in the implementation of <a href="http://reactivex.io/RxJava/javadoc/rx/Subscription.html">Subscriptions</a> </h4><br><h5>  Situation </h5><br>  So, you are reactive!  You tried, you liked it, you want more!  You are already writing all the tests on <b>Rx</b> .  You rewrite your home project on <b>Rx</b> .  You teach your cat <b>Rx</b> .  And now the time has come to create the Grail - to build the whole architecture on <b>Rx</b> .  You are ready, you breathe often and languidly and ... start ... <s>moooya preheelest</s> <br><br><h5>  What is it for me? </h5><br>  Unfortunately, the above is just about me.  I was so impressed with the power of <b>Rx</b> that I decided to completely revise all of my approaches to writing architecture.  You could say I tried to reinvent <b>MVVM</b> through <b>MVP + Rx</b> . <br>  However, I assume the biggest newbie mistake - I decided that I understood <b>Rx</b> . <br>  To understand it well, it is absolutely not enough to write a couple of <b>Rx applications</b> .  As soon as a task appears more difficult than to link click and download photos, videos and test data from three different sources, then sudden problems like <a href="https://github.com/ReactiveX/RxJava/wiki/Backpressure">backpressure</a> will manifest themselves.  And when you decide that you know <b>backpressure</b> , you <b>realize</b> that you know nothing about the <a href="http://reactivex.io/RxJava/javadoc/rx/Producer.html">Producer</a> (which even has no normal documentation) ... Something I digress (and at the end of the article it will be clear why). <br>  In general, the essence of the problem is again in logic, which runs counter to what is in reality. <br><div class="spoiler">  <b class="spoiler_title">How does listening usually happen?</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//... data.registerListener(listener); // data.mListener == listener //... data.unregisterListener(); // data.mListener == null</span></span></code> </pre><br></div></div><br>  That is, the data source stores a reference to the listener. <br>  But what happens in Rx?  (Carefully, pieces of code <s>trash</s> will go now) <br><h6>  <b>observer.unsubscribe ()</b> after 500ms </h6><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="java hljs">Observable.interval(<span class="hljs-number"><span class="hljs-number">300</span></span>, TimeUnit.MILLISECONDS).map(i -&gt; <span class="hljs-string"><span class="hljs-string">"t1-"</span></span> + i).subscribe(observer); l(<span class="hljs-string"><span class="hljs-string">"interval-1"</span></span>); Observable.interval(<span class="hljs-number"><span class="hljs-number">330</span></span>, TimeUnit.MILLISECONDS).map(i -&gt; <span class="hljs-string"><span class="hljs-string">"t2-"</span></span> + i).subscribe(observer); l(<span class="hljs-string"><span class="hljs-string">"interval-2"</span></span>); Observable.timer(<span class="hljs-number"><span class="hljs-number">500</span></span>, TimeUnit.MILLISECONDS).map(i -&gt; <span class="hljs-string"><span class="hljs-string">"t3-"</span></span> + i).subscribe(ignored -&gt; observer.unsubscribe());</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Result</b> <div class="spoiler_text"><pre> <code class="java hljs">interval-<span class="hljs-number"><span class="hljs-number">1</span></span> interval-<span class="hljs-number"><span class="hljs-number">2</span></span> t1-<span class="hljs-number"><span class="hljs-number">0</span></span> t2-<span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br></div></div><br>  I guess this is the most expected result.  Yes, in our class <b>Subscriber</b> (also <b>known</b> as <b>Observer</b> ) stores references to data sources, and not vice versa, so everything calms down after the first unsubscribe (just to be on the safe <b>side</b> , I <b>‚Äôm</b> reminding you that <b>unsubscribed</b> is one of the end states in <b>Rx</b> that you can't get out of how to recreate anything and everything). <br><br><h6>  <b>subscription1.unsubscribe ()</b> after 500ms </h6><br>  And now let's try to unsubscribe from <b>Subscription</b> , not from <b>Subscriber</b> .  From a logical point of view, the <b>subscription</b> should bind the <b>Observer</b> and <b>Observable</b> as 1: 1 and allow you to selectively unsubscribe from something, but ... <br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="java hljs">Subscription subscription1 = Observable.interval(<span class="hljs-number"><span class="hljs-number">300</span></span>, TimeUnit.MILLISECONDS).map(i -&gt; <span class="hljs-string"><span class="hljs-string">"t1-"</span></span> + i).subscribe(observer); l(<span class="hljs-string"><span class="hljs-string">"interval-1"</span></span>); Observable.interval(<span class="hljs-number"><span class="hljs-number">330</span></span>, TimeUnit.MILLISECONDS).map(i -&gt; <span class="hljs-string"><span class="hljs-string">"t2-"</span></span> + i).subscribe(observer); l(<span class="hljs-string"><span class="hljs-string">"interval-2"</span></span>); Observable.timer(<span class="hljs-number"><span class="hljs-number">500</span></span>, TimeUnit.MILLISECONDS).map(i -&gt; <span class="hljs-string"><span class="hljs-string">"t3-"</span></span> + i).subscribe(ignored -&gt; subscription1.unsubscribe());</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Result</b> <div class="spoiler_text"><pre> <code class="java hljs">interval-<span class="hljs-number"><span class="hljs-number">1</span></span> interval-<span class="hljs-number"><span class="hljs-number">2</span></span> t1-<span class="hljs-number"><span class="hljs-number">0</span></span> t2-<span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br></div></div><br>  ... suddenly the result is exactly the same.  I learned this far from the very beginning of my acquaintance with <b>Rx</b> , although I used a similar approach for a long time thinking that it works.  The fact is that <b>Subscriber</b> implements the <b>Observer</b> interface and ... <b>Subscription</b> .  Those.  that <b>Subscription</b> that we have is the same <b>Observer</b> !  Here is such a turn. <br><br><h6>  <a href="http://reactivex.io/documentation/operators/defer.html">Observable.defer ()</a> and <a href="http://reactivex.io/documentation/operators/from.html">Observable.fromCallable ()</a> </h6><br>  I think <b>defer ()</b> is one of the most frequently used operators in <b>Rx</b> (somewhere on par with <a href="http://reactivex.io/documentation/operators/flatmap.html">Observable.flatMap ()</a> ).  Its task is to postpone the initialization of the <b>Observable</b> data until it is called <b>subscribe ()</b> .  Let's try: <br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="java hljs">Observable.defer(() -&gt; Observable.just(<span class="hljs-string"><span class="hljs-string">"s1"</span></span>)).subscribe(observer); l(<span class="hljs-string"><span class="hljs-string">"just-1"</span></span>); Observable.defer(() -&gt; Observable.just(<span class="hljs-string"><span class="hljs-string">"s2"</span></span>)).subscribe(observer); l(<span class="hljs-string"><span class="hljs-string">"just-2"</span></span>); observer.unsubscribe(); Observable.defer(() -&gt; Observable.just(<span class="hljs-string"><span class="hljs-string">"s3"</span></span>)).subscribe(observer); l(<span class="hljs-string"><span class="hljs-string">"just-3"</span></span>);</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Result</b> <div class="spoiler_text"><pre> <code class="java hljs">s1 just-<span class="hljs-number"><span class="hljs-number">1</span></span> s2 just-<span class="hljs-number"><span class="hljs-number">2</span></span> s3 just-<span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre><br></div></div><br>  "So what?  Nothing unexpected, you say.  "Probably" - I will answer. <br>  But what if you are tired of writing <a href="http://reactivex.io/documentation/operators/just.html">Observable.just ()</a> ?  In <b>Rx,</b> and there is an answer.  A quick search in Google finds the <b>Observable.fromCallable ()</b> method, which allows <b>defer'it</b> not <b>Observable</b> , but the usual lambda.  We try: <br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="java hljs">Observable.fromCallable(() -&gt; <span class="hljs-string"><span class="hljs-string">"z1"</span></span>).subscribe(observer); l(<span class="hljs-string"><span class="hljs-string">"callable-1"</span></span>); Observable.fromCallable(() -&gt; <span class="hljs-string"><span class="hljs-string">"z2"</span></span>).subscribe(observer); l(<span class="hljs-string"><span class="hljs-string">"callable-2"</span></span>); observer.unsubscribe(); Observable.fromCallable(() -&gt; <span class="hljs-string"><span class="hljs-string">"z3"</span></span>).subscribe(observer); l(<span class="hljs-string"><span class="hljs-string">"callable-3"</span></span>);</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Result (ATTENTION! Remove children and hamsters from the screen)</b> <div class="spoiler_text"><pre> <code class="java hljs">z1 callable-<span class="hljs-number"><span class="hljs-number">1</span></span> callable-<span class="hljs-number"><span class="hljs-number">2</span></span> callable-<span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre><br></div></div><br>  It would seem that a method that does the same thing only with other initial data, but such a difference.  The most incomprehensible (if you think logically) as a result is that he is not <b>z1-z2-callable ...</b> (if you believe everything described up to this point), but <b>z1-callable ....</b>  What's the matter? <br><br><h5>  The fact is that... </h5><br>  And now to the point.  The fact is that many operators are written differently.  Someone before the next <b>onNext ()</b> checks <b>Subscriber's</b> subscription, someone checks it after emit, but until the end of <b>onNext ()</b> , and someone before and after, etc.  This brings some ... chaos to the expected result.  But even this does not explain the behavior of <b>Observable.fromCallable ()</b> . <br>  Inside <b>Rx</b> there is a class <b>SafeSubscriber</b> .  This is the class that is responsible for the main contract <b>Rx</b> (well, the one that says: ‚Äúafter <b>onError (),</b> there will be no more <b>onNext ()</b> and there will be a reply, etc., etc.‚Äù).  And whether it is necessary to use it ( <b>SafeSubscriber</b> ) in the operator or not is not stated anywhere.  In general, <b>Observable.fromCallable ()</b> calls the usual <b>subscribe ()</b> , so <b>SafeSubscriber</b> is implicitly created and <b>unsubscribe ()</b> occurs after the emith, but <b>Observable.defer ()</b> calls <b>unsafeSubscribe ()</b> , which does not cause <b>unsubscribe ()</b> at the end.  So actually (suddenly!) This is <b>Observable.defer ()</b> bad, not <b>Observable.fromCallable ()</b> . <br><br><h4>  8. <b>RxJava</b> : <a href="http://reactivex.io/documentation/operators/repeat.html">repeatWhen ()</a> instead of manual unsubscribe / subscribe </h4><br><h5>  Situation </h5><br>  You need to update the data every X-seconds.  Downloading new data, of course, cannot be done until old ones are loaded (this is possible due to lags, bugs and other mischief).  What to do? <br>  And in the answer <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/atomic/AtomicBoolean.html">everyone</a> begins: <a href="http://reactivex.io/documentation/operators/interval.html">Observable.interval ()</a> with <a href="http://reactivex.io/documentation/operators/debounce.html">Observable.throttle ()</a> or <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/atomic/AtomicBoolean.html">AtomicBoolean</a> , and some even through manual <b>unsubscribe ()</b> manage to make.  In fact, everything is much simpler. <br><br><h5>  Decision </h5><br>  Sometimes it seems that <b>Rx</b> has operators for all occasions.  So it is now.  There is a <b>repeatWhen ()</b> method that does everything for you - re-subscribes to the <b>Observable</b> at the specified interval: <br><div class="spoiler">  <b class="spoiler_title">Example use repeatWhen ()</b> <div class="spoiler_text"><pre> <code class="java hljs">Log.i(<span class="hljs-string"><span class="hljs-string">"MY_TAG"</span></span>, <span class="hljs-string"><span class="hljs-string">"Loading data"</span></span>); Observable.defer(() -&gt; api.loadData())) .doOnNext(data -&gt; view.setDataWithNotify(data)) .repeatWhen(completed -&gt; completed.delay(<span class="hljs-number"><span class="hljs-number">7_777</span></span>, TimeUnit.MILLISECONDS)) .subscribe( data -&gt; Log.i(<span class="hljs-string"><span class="hljs-string">"MY_TAG"</span></span>, <span class="hljs-string"><span class="hljs-string">"Data loaded"</span></span>), e -&gt; {}, v0id -&gt; Log.i(<span class="hljs-string"><span class="hljs-string">"MY_TAG"</span></span>, <span class="hljs-string"><span class="hljs-string">"Loading data"</span></span>)); <span class="hljs-comment"><span class="hljs-comment">// "Loading data" -   ; "Data loaded" -    ~8 .</span></span></code> </pre><br></div></div><br>  The only negative is that at first it is not entirely clear how this method works at all.  But as usual, here is a <a href="http://blog.danlew.net/2016/01/25/rxjavas-repeatwhen-and-retrywhen-explained/">good article on repeatWhen () / retryWhen ()</a> . <br><br><h5>  <a href="http://reactivex.io/documentation/operators/repeat.html">retryWhen</a> </h5><br>  By the way, besides <b>repeatWhen ()</b> there is also <b>retryWhen ()</b> , which does the same, but for <b>onError ()</b> .  But unlike <b>repeatWhen ()</b> , situations where <b>retryWhen ()</b> can be useful <b>are</b> quite specific.  In the case described above, it might be possible to add it.  But in general, it is better to use <a href="https://github.com/ReactiveX/RxJava/wiki/Plugins">Rx Plugins / Hooks</a> and hang the global handler for the error of interest.  This will not only re-subscribe to any <b>Observable</b> in case of an error, but also notify the user about it (I use something similar for a <b>SocketTimeoutException</b> for example). <br><br><h4>  Extra.  <b>RxJava</b> : 16 </h4><br>  Finally, that‚Äôs why I started writing about the Cuvettes.  The problem I devoted to 2 weeks of my life and still have no idea what the ... magic is going on there ... But let's order. <br><br><h5>  Situation </h5><br>  You need to make an authorization screen, checking for incorrectly filled fields and issuing a special warning for every 3rd error. <br>  The task itself is not difficult, and that is why I chose it as a ‚Äútest site‚Äù for <b>Rx</b> .  Thought, I will solve, I will look, as <b>Rx</b> behaves in business, other than simple data jump from the server. <br>  So, the code was something like: <br><div class="spoiler">  <b class="spoiler_title">Login error code</b> <div class="spoiler_text"><pre> <code class="java hljs">PublishSubject&lt;String&gt; wrongPasswordSubject = PublishSubject.create(); <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> wrongPasswordSubject .compose(IndexingTransformer.Create()) .map(indexed -&gt; String.format(((indexed.index % <span class="hljs-number"><span class="hljs-number">3</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) ? <span class="hljs-string"><span class="hljs-string">"GREAT ERROR"</span></span> : <span class="hljs-string"><span class="hljs-string">"Simple error"</span></span>) + <span class="hljs-string"><span class="hljs-string">" #%d : %s"</span></span>, indexed.index, indexed.value)) .observeOn(AndroidSchedulers.mainThread()) .subscribe(message -&gt; getView().setMessage(message));</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Code processing button [Sign In]</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setSignInAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ getView().getSignInButtonObservable() .observeOn(AndroidSchedulers.mainThread()) .doOnNext((v) -&gt; getView().setSigningInState()) <span class="hljs-comment"><span class="hljs-comment">//    .observeOn(Schedulers.newThread()) .withLatestFrom(formDataSubject, (v, formData) -&gt; formData) .map(formData -&gt; auth(formData.login, formData.password)) // .   WrongLoginOrPassException .lift(new SuppressErrorOperator&lt;&gt;(throwable -&gt; wrongPasswordSubject.onNext(throwable.getMessage()))) //      .compose(new UnObservableTransformer&lt;&gt;()) //       flatMap().      .observeOn(AndroidSchedulers.mainThread()) .subscribe(user -&gt; getView().setSignedInState(user)); // happy end }</span></span></code> </pre><br></div></div><br>  Postpone claims to the <b>Rx-</b> style code - everything is bad, I know myself.  The point is not that, and it was written a long time ago. <br>  So, <b>getView (). GetSignInButtonObservable ()</b> returns the <b>Observable</b> received from <a href="https://github.com/ReactiveX/RxAndroid">RxAndroid</a> 'for clicking the <b>[Sign In]</b> button.  It is <b>hot-observable</b> , i.e., it will never be able to be <b>completed</b> .  Events start from it, pass through <b>map ()</b> , in which authorization takes place and further along the chain.  If an error occurs, the custom <b>Operator will</b> intercept the error and simply will not miss it further: <br><div class="spoiler">  <b class="spoiler_title">SuppressErrorOperator</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SuppressErrorOperator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Observable</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Operator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Action1&lt;Throwable&gt; errorHandler; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SuppressErrorOperator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Action1&lt;Throwable&gt; errorHandler)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.errorHandler = errorHandler; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Subscriber&lt;? <span class="hljs-keyword"><span class="hljs-keyword">super</span></span> T&gt; call(<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Subscriber&lt;? <span class="hljs-keyword"><span class="hljs-keyword">super</span></span> T&gt; subscriber) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Subscriber&lt;T&gt;(subscriber) { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCompleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ subscriber.onCompleted(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Throwable e)</span></span></span><span class="hljs-function"> </span></span>{ errorHandler.call(e); <span class="hljs-comment"><span class="hljs-comment">//  ,    } @Override public void onNext(T t) { subscriber.onNext(t); } }; } }</span></span></code> </pre><br></div></div><br>  So the question is.  What's wrong with this code? <br>  If they asked me about it, I would even now answer: ‚Äúeverything is OK‚Äù.  Well, except that memory leaks, because nowhere is there a save <b>Subscription</b> .  Yes, only <b>onNext is</b> overwritten in <b>subscribe</b> , but other methods will never be called.  All right, working on. <br><br><h5>  Pain </h5><br><h6>  <i>Outset</i> </h6><br>  And here the strangest begins.  The code really works.  However, I am a meticulous person and therefore I decided to press the authorization button ... many times.  And, quite suddenly, I discovered that for some reason, after the 5th ‚ÄúGREAT ERROR‚Äù, the authorization progress bar (which was delivered via <b>setSigningInState ()</b> ) did not appear (this function also turns off the <b>[Sign In]</b> button). <br>  "Hmm" - I think.  Rechecked the functions in <b>Fragment</b> 'e, responsible for the <b>UI</b> (all of a sudden there is something wrong inserted).  I revised the <b>auth ()</b> function, maybe I set the timeout for the tests.  Not.  Everything is good. <br>  Then I decided that this is a <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BE%25D1%2581%25D1%2582%25D0%25BE%25D1%258F%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25B3%25D0%25BE%25D0%25BD%25D0%25BA%25D0%25B8">race of threads</a> .  I started it again and checked it again ... Exactly 5 ‚ÄúGREAT ERROR‚Äù and again the stagnation of endless progress bar.  And here I am tensed.  Launched again, and then another and another.  Exactly 5!  Each time, exactly after the 5th ‚ÄúGREAT ERROR‚Äù, the button stops responding to pressing, the progress bar turns and silence. <br>  ‚ÄúOkay‚Äù - I decided, ‚ÄúI will <b>remove the setSigningInState ()</b> .  You never know, <b>Android</b> loves to play with people.  Suddenly, there was something in the <b>SDK that</b> broke and the whole thing was just that I couldn‚Äôt press the button again, and not that its handler didn‚Äôt work. ‚Äù  Not.  Did not help. <br>  By this moment I was already very tense.  In <b>LogCat is</b> empty, there were no errors, the application is running and has not hung.  Just the handler is no longer processing. <br><br><h6>  <i>Analysis</i> </h6><br>  It turned out that the task itself had deceived me.  I considered the number of "GREAT ERROR", but in fact it was necessary to count the number of button presses.  Exactly 16. The number has changed, but the situation remains. <br>  So, the code for the next attempt after getting rid of all unnecessary: <br><div class="spoiler">  <b class="spoiler_title">Code with logs in doOnNext ()</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setSignInAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ getView().getSignInButtonObservable() .observeOn(AndroidSchedulers.mainThread()) .doOnNext((v) -&gt; l(<span class="hljs-string"><span class="hljs-string">"1"</span></span>)) .observeOn(Schedulers.newThread()) .doOnNext((v) -&gt; l(<span class="hljs-string"><span class="hljs-string">"2"</span></span>)) .map(v -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(); }) .lift(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SuppressErrorOperator&lt;&gt;(throwable -&gt; wrongPasswordSubject.onNext(throwable.getMessage()))) .doOnNext((v) -&gt; l(<span class="hljs-string"><span class="hljs-string">"3"</span></span>)) .observeOn(AndroidSchedulers.mainThread()) .doOnNext((v) -&gt; l(<span class="hljs-string"><span class="hljs-string">"4"</span></span>)) .subscribe(user -&gt; runOnView(view -&gt; view.setTextString(<span class="hljs-string"><span class="hljs-string">"ON NEXT"</span></span>))); }</code> </pre><br></div></div><br>  And here the situation has become even stranger.  From 1 to 15 clicks went right, the digits ‚Äú1‚Äù and ‚Äú2‚Äù were displayed, but for the 16th time the last line in the logs was ... ‚Äú1‚Äù!  It just did not reach the error generator! <br>  "So maybe it's not at all in <b>Exception</b> ?!" - I thought.  <b>throw new RuntimeException()</b>  <b>return null</b> ‚Ä¶  ,  4        (,     100  ,      ‚Ä¶  ). <br>      2  3     ,      : <br><ul><li>  16    </li><li>    <b>Exception</b> </li><li> - <b>doOnNext()</b>   ¬´2¬ª,  <b>Exception</b>    </li><li>      </li></ul><br><br><h6> <i>‚Ä¶</i>     </h6><br>         <a href="http://reactivex.io/">ReactiveX</a>   .    <a href="https://github.com/ReactiveX/RxJava">RxJava </a>  ,  ,   wiki,       ,       ‚Ä¶   ¬´ ¬ª. <br>   ,      ,   : <b>onBackpressureBuffer()</b> .   <b>backpressure</b>   <a href="https://github.com/ReactiveX/RxJava/wiki/Backpressure">wiki RxJava' </a> ,     ,       ,      . <br>  ,    .  <b>backpressure</b> ,      ,     .    ‚Äî <b>zip()</b> .       1   <u></u> ,   ‚Äî 1   <u></u> ,  <b>zip()</b> . <b>onBackpressureBuffer()</b> ‚Äî   ,        ,    , <b>zip()</b>     (      <b>OutOfMemoryException</b> ,   ). <br>    ,  <b>onBackpressureBuffer()</b>  ?     ,  .       <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Sign In]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> only once a minute (well, you </font><font style="vertical-align: inherit;">never </font><font style="vertical-align: inherit;">know, what if I </font><font style="vertical-align: inherit;">click </font></font><a href="http://www.imdb.com/title/tt3107288/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Flash</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and click too fast?). Of course it did not help.</font></font><br><br><h6>  <i>The final</i> </h6><br>  ,  ,  ,      <b>observeOn()</b> . ¬´    ?¬ª ‚Äî  . " ¬Ø\_(„ÉÑ)_/¬Ø " ‚Äî  . <br>          ,   <b>onBackpressureBuffer()</b>     <b>Observable</b> .      <b>OnSubscribe</b> -, <b>Producer</b>    ‚Ä¶           .   ,       <b>Rx</b> , ,   ,    ‚Äî  ,     ‚Äî  . <br>      <a href="http://stackoverflow.com/questions/35343474/why-does-it-need-onbackpressure-here-for-click-events">  stackoverflow</a> ,      . <br>       2    ,  <b>onBackpressureBuffer()</b>     (    ,   ,  ,    ?). <br><br>    , ,  <b>observeOn()</b>  <b>Subscriber</b> -   <b>Subscriber</b>    <b>Exception'</b> ,     (   <b>Exception</b>   ,     ,    16).    17 , <b>observeOn()</b>  <b>isUnsubscribed()</b> , ..   <b>true</b> ,   . (    ). <br>     16 ‚Äî    <b>Backpressure Buffer</b>  <b>Android'</b> .   <b>Java</b>    128 , ,         .  ,   16     -  ,      5 ‚Äî       .      16     ,  2+2=17. <br>   , ,      ‚Äî <b>SuppressErrorOperator</b> .      ,     <b>MissingBackpressureException</b>     .   - .    ,     ‚Äî <b>SuppressErrorOperator</b>     ,  <b>MissingBackpressureException</b> .  Since     ,       (   16  <b>[Sign In]</b>      ). <br><br><h4>  Conclusion </h4><br>         .   ,      Rx     ‚Äî           Loader'  .   Netflix  . <br> , Rx    :         .   , ,   ‚Äî    .  -    . Rx ‚Äî ,   .    Rx- .        (,   <a href="http://randomdotnext.com/retrofit-rxjava/">Retrofit-</a> ),        Rx,      ,    Subscription  .. (  -       View State     Backpressure  Producer.     . ).  ,   ,     . <br>  ,     Rx,   , : <a href="http://reactivex.io/documentation/operators.html">    </a> (Ctrl+F        - <a href="http://reactivex.io/documentation/operators/scan.html">Scan</a> ), <a href="https://github.com/ReactiveX/RxJava/wiki/Creating-Observables">RxJava wiki  github'</a>  ( - ) <a href="http://rxmarbles.com/">   </a> . <br> ps   -   ,        ‚Äî    ,    .    ,   . <br><br> <b>UPD</b> :   <a href="http://stackoverflow.com/questions/35343474/why-does-it-need-onbackpressure-here-for-click-events">  16  stackoverflow</a>  <a href="https://github.com/akarnokd">akarnokd</a> (    <b>RxJava</b> ,    <a href="https://habrahabr.ru/users/artemgapchenko/" class="user_link">artemgapchenko</a> ).    ,  <b>observeOn()</b> <b>decople'</b>     ,     <b>backpressure buffer</b> .  Since   <b>Exception</b>    <b>request()</b> ,   ¬´¬ª ,   <b>observeOn()</b>   ,    ‚Äî    <b>16</b> . <b>onBackpressureBuffer()</b>    ,     <b>Long.MAX_VALUE</b> . <a href="http://stackoverflow.com/a/36913646/2653714">  akarnokd'</a> . </div><p>Source: <a href="https://habr.com/ru/post/281312/">https://habr.com/ru/post/281312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../281298/index.html">Writing Your Lisp in JavaScript</a></li>
<li><a href="../281300/index.html">Analysis of approaches for creating Landings and Longrides in Drupal</a></li>
<li><a href="../281304/index.html">VAS for you. Part One: Integrating Mobile and Virtual PBX</a></li>
<li><a href="../281306/index.html">PHP Digest number 83 - interesting news, materials and tools (March 27 - April 10, 2016)</a></li>
<li><a href="../281308/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ206 (April 4 - 10, 2016)</a></li>
<li><a href="../281314/index.html">Easla.com review</a></li>
<li><a href="../281316/index.html">Boolean expressions in C / C ++. How are the professionals mistaken</a></li>
<li><a href="../281318/index.html">Use an Intel RealSense camera with TouchDesigner. Part 2</a></li>
<li><a href="../281320/index.html">Perspectives of the go language for the programmer</a></li>
<li><a href="../281322/index.html">Gaming simulators for the development of BrainApps cognitive brain functions with a cloud backend</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>