<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Features of ExtremeXOS Switch Configuration</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article aims to reduce the amount of time required to understand the principles of working with ExtremeXOS (XOS) . When I started getting acquain...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Features of ExtremeXOS Switch Configuration</h1><div class="post__text post__text-html js-mediator-article"><p>  This article aims to reduce the amount of time required to understand the principles of working with <strong>ExtremeXOS (XOS)</strong> .  When I started getting acquainted with XOS, I really missed such an article on Habr√©. </p><br><p>  Below I will talk about the configuration of Extreme and the problems that I encountered.  Hopefully it will help network engineers who are just starting to work with XOS.  Regardless of the switch model, the CLI syntax is exactly the same. <br><br></p><br><p><img src="https://habrastorage.org/webt/jy/kh/yn/jykhynsiykae3nk7qvyy-3chk-w.jpeg" alt="KDPV"><br>  <em>Extreme Switch Stand</em> </p><a name="habracut"></a><br><h2>  To business </h2><br><p>  For hardware virtualization, I use <a href="http://eve-ng.net/">Eve-Ng</a> and the <a href="https://github.com/extremenetworks/Virtual_EXOS">Virtual ExtremeOS ( <u>XOS</u> )</a> image.  You can also use GNS3. </p><br><p>  How does the switch setup look like <abbr title="Extreme OS">?</abbr> In <abbr title="Extreme OS">XOS,</abbr> there is no need to switch operating modes; all commands are entered from the normal mode marked with <strong>#</strong> in the case of the admin account;  and <strong>&gt;</strong> in the case of a user. <br>  To begin, I would like to identify the "basic" principles of teams in EOS.  Everything is built on three commands and their antonyms: <strong>create</strong> , <strong>configure</strong> , <strong>enable</strong> ( <strong>delete</strong> , <strong>unconfigure</strong> , <strong>disable,</strong> respectively).  That is: we create, we configure, we activate.  It looks logical. </p><br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">create</span></span> vlan <span class="hljs-number"><span class="hljs-number">10</span></span> configure vlan <span class="hljs-number"><span class="hljs-number">10</span></span> ipaddress <span class="hljs-number"><span class="hljs-number">192.168.1.1</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span></code> </pre> <br><p>  You should also understand that most configurations are configured on the <strong>VLAN</strong> .  That is, in XOS almost everything is tied to VLANs.  Even assigning a VLAN to a port occurs in the VLAN configuration, that is, the port hangs on vlan. <br>  I would like to pay special attention to virtual routers ( <em>VR</em> ), which are by default in the switch.  There is VR-Default, which owns all the ports, and VR-mgmt, which owns mgmt.  port.  In XOS, for all commands that send traffic somewhere (ping, ssh, telnet, download, etc.) you must specify VR. </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">ping</span></span> vr <span class="hljs-string"><span class="hljs-string">"VR-Default"</span></span> <span class="hljs-number"><span class="hljs-number">192.168.1.1</span></span></code> </pre> <br><h2>  XOS Switch Update </h2><br><p>  In XOS, there are two partitions under OS: primary and secondary.  Functionally, they are no different, only the names.  You can install updates only in the currently inactive section.  You can use the inactive argument for this.  After the upgrade, a reboot is required, and the switch will boot from another (just updated) partition.  This leaves the possibility of a quick rollback, in case of problems, simply by selecting another partition at boot (the one where the old OS remained).  Also note that all the images with patches are a complete image, that is, do not put a major version, and then a few minor ones.  When loading tftp is used: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">download</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">image</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">summitX-21</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.4-patch1-3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xos</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">vr</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">VR-Default</span></span>" <span class="hljs-selector-tag"><span class="hljs-selector-tag">inactive</span></span></code> </pre> <br><p>  You can find out which section is currently being used by: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">show</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">system</span></span> ‚Ä¶ <span class="hljs-selector-tag"><span class="hljs-selector-tag">Image</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Selected</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">primary</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Image</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Booted</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">secondary</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Primary</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ver</span></span>: 22<span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Secondary</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ver</span></span>: 21<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span></code> </pre> <br><h2>  Switch stacking </h2><br><p>  To stack XOS switches, you must enable stacking support and reboot the switch: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> stacking-support reboot</code> </pre> <br><p>  It is very convenient that switches of different models can be combined into a stack, while the master will be a switch with the highest performance.  For example, it may be necessary for a stack of 10G switches for 16 ports for servers, to which a 48-port 1G switch is added, to which mgmt.-interfaces are included. <br>  For stacking, switches must have the same OS version.  Stacking is performed through certain Ethernet ports, for each model is different, which can be found in the documentation.  If you assemble the switches according to the 1 in 2, 2 in 1 port, then Extreme switches can be stacked using the easy-stack simplified procedure, which itself will bind the mac addresses to the slot number and other settings.  In this case, the first will be the switch on which you apply enable stacking, the rest will be assigned numbers along the chain.  This is quite a convenient way to save a lot of time.  After stacking, the ports will look like SLOT: PORT (1: 1, 2:35). </p><br><pre> <code class="hljs pgsql">X440G2<span class="hljs-number"><span class="hljs-number">-48</span></span>p<span class="hljs-number"><span class="hljs-number">-10</span></span>G4<span class="hljs-number"><span class="hljs-number">.1</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> stacking Stack Topology <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> a Ring This node <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> an Active Topology Node MAC Address Slot Stack State <span class="hljs-keyword"><span class="hljs-keyword">Role</span></span> Flags <span class="hljs-comment"><span class="hljs-comment">------------------ ---- ----------- ------- --- *00:04:96:xx:xx:xx - Disabled Master --- 00:04:96:xx:xx:xx - Disabled Master --- 00:04:96:xx:xx:xx - Disabled Master --- 00:04:96:xx:xx:xx - Disabled Master --- 00:04:96:xx:xx:xx - Disabled Master --- * - Indicates this node Flags: (C) Candidate for this active topology, (A) Active Node (O) node may be in Other active topology X440G2-48p-10G4.2 # enable stacking You have not yet configured all required stacking parameters. Would you like to perform an easy setup for stacking operation? (y/N) Yes Executing "configure stacking easy-setup" command... For every node in the 5-node stack, this command will: - enable stacking - configure a stack MAC address - choose and configure a slot number (this node will be assigned to slot 1) - configure redundancy to minimal (slot 1 will be the master node) - configure the stacking protocol to enhanced Upon completion, the stack will automatically be rebooted into the new configuration. Warning: If stacking is already configured, this command will alter that configuration. Do you wish to proceed? (y/N) Yes Stacking configuration is complete. Rebooting...</span></span></code> </pre> <br><p>  Updating the stack is that the master is updated, and then he in turn spills the new version into the remaining slots.  <strong>A reboot is required</strong> . </p><br><h2>  Licensing </h2><br><p>  Each switch comes with a pre-installed license (edge, advanced edge, core, etc.).  Each license has its own set of features that can be activated on the switch, for example, the number of ports that can be used in OSPF.  There are also licenses for individual feature.  Read more <a href="https://gtacknowledge.extremenetworks.com/articles/Q_A/ExtremeXOS-Feature-Licensing">here</a> . <br>  One of the most frequent licenses is the license for feature: <em>Dual-10GB-Uplink</em> .  This license for the edge-1G switch allows the use of 2x 10GbE port.  For example, on X440-G2-48p. <br>  Licenses are available in the personal account on the Extreme website, after which they are activated (without rebooting) and checked by the team. </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> license XXXX-XXXX <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> licenses</code> </pre> <br><p>  In the event that different licenses are used in the switch stack, the <u>smallest one</u> will be used. </p><br><h2>  Customization </h2><br><p>  A small digression: In order to see the results of the commands below, as well as any other information, in most cases you can use show, replacing create and configure.  For example, show vlan. <br>  Hint: When using show ports, XOS will build a table that is updated every few seconds, which allows you to monitor the status of the interfaces in real time.  In order to get output without refreshing, you must use ‚Äúshow ports no-refresh‚Äù. <br>  The first thing that comes to mind is that you need to configure this <em>hostname</em> .  It would seem to be something like this: </p><br><p><del>  configure hostname Ex_sw_1 </del></p><br><p>  But not everything is so simple, in fact it is done this way: </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">configure</span></span> snmp sysName Ex-sw-<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><p>  Create a VLAN: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> vlan My_Vlan_Five tag <span class="hljs-number"><span class="hljs-number">5</span></span></code> </pre> <br><p>  Or so, and this is what will be displayed in the config: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> vlan My_Vlan10 configure vlan My_Vlan10 tag <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br><p>  Considering the practical experience and realities of the output of commands and XOS settings, I created a rule for myself: in the vlan name, append its tag at the end, which makes it easier to read and configure: </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> vlan <span class="hljs-keyword"><span class="hljs-keyword">users</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span> tag <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br><p>  In XOS there are no such as trunk and access ports.  Instead, the following concepts are used: tagged and untagged traffic on an interface tied to vlan.  There can be one untagged and many tagged vlan.  Ports are numbered (or slot: port on the stack), it's very simple. </p><br><pre> <code class="hljs cs">configure vlan My_Vlan<span class="hljs-number"><span class="hljs-number">-5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> ports <span class="hljs-number"><span class="hljs-number">1</span></span> tagged configure vlan My_Vlan1 <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> ports <span class="hljs-number"><span class="hljs-number">1</span></span> untagged</code> </pre> <br><p>  Accordingly, all traffic without a tag coming to the interface will be tagged as ‚Äú <em>My_Vlan1</em> ‚Äù. <br>  In this case, vlan can be specified both through &lt; <em>Name</em> &gt; and through &lt; <em>tag</em> &gt;, and in any combination (using <em>vlan_list</em> , that is, numeric by tags).  Without an attribute, &lt; <em>untagged</em> &gt; is used at the end: </p><br><pre> <code class="hljs cs">onfigure vlan <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span><span class="hljs-number"><span class="hljs-number">-20</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> ports <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-number"><span class="hljs-number">-8</span></span>, <span class="hljs-number"><span class="hljs-number">48</span></span> tagged configure vlan web<span class="hljs-number"><span class="hljs-number">-110</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> ports <span class="hljs-number"><span class="hljs-number">5</span></span> onfigure vlan <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> ports <span class="hljs-number"><span class="hljs-number">30</span></span><span class="hljs-number"><span class="hljs-number">-40</span></span>,<span class="hljs-number"><span class="hljs-number">45</span></span> untagged</code> </pre> <br><p>  Since most SummitX series switches are <strong>L3</strong> switches, this is how SVI is configured: </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">configure</span></span> vlan <span class="hljs-number"><span class="hljs-number">125</span></span> ipaddress <span class="hljs-number"><span class="hljs-number">192.168.125.1</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span></code> </pre> <br><p>  After that, you need to apply this command, otherwise vlan will remain non-routable: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> ipforwarding vlan <span class="hljs-number"><span class="hljs-number">125</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> ipforwarding vlan <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-number"><span class="hljs-number">-50</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span></code> </pre> <br><p>  To see what vlan is on the interface, you can use the command: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ports <span class="hljs-number"><span class="hljs-number">2</span></span> vlan</code> </pre> <br><p>  The following commands are used to view and save the configuration and there are primary and secondary configuration files: </p><br><pre> <code class="hljs pgsql">save save secondary <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span></code> </pre> <br><h2>  Channel aggregation </h2><br><p>  One of the <u>inconvenient</u> moments that I met is aggregation of channels.  (port-channel).  The general essence is as follows: you assign a master port and up to seven secondary interfaces to it.  Further, all settings are made only on a specific master port, there are no logical interfaces of the form <em>po1</em> .  The downside is that if you want to change the master port, you need to transfer all the settings to another port with your hands, because when you remove an aggregated channel, the entire config on it <u>flies</u> .  The solution to this inconvenience is in <a href="https://habr.com/company/ivi/blog/264527/">this article</a> , but it still does not work out perfectly.  In XOS, aggregation is called <strong>sharing</strong> . <br>  To enable such a port, you need to apply a command like this: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">enable</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sharing</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[MASTER_PORT]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">grouping</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[PORT_LIST]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[lacp]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">enable</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sharing</span></span> 1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">grouping</span></span> 1<span class="hljs-selector-tag"><span class="hljs-selector-tag">-2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">lacp</span></span></code> </pre> <br><p>  On the version lower than 22.X, it is necessary to add the "balancing" algorithm: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> sharing <span class="hljs-number"><span class="hljs-number">1</span></span> grouping <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span> algorithm address-based L2 lacp</code> </pre> <br><h2>  OSI Second Level Loop Protection </h2><br><p>  On the Summit-X commutator in C major version 22.2, the second level loop protection protocol was <strong><u>disabled</u></strong> by default.  (STP and others).  At the time of this writing, the software recommended by the vendor is 21.1.5.2. </p><br><h3 id="elrp">  ELRP </h3><br><p>  In one of my projects, I used the proprietary protocol <abbr title="Extreme Loop Recovery Protocol">ELRP</abbr> , which is designed to detect and prevent loops.  During the tests, he showed good results (speed of shutdown of the port with a loop, etc.).  This protocol sends multicast <abbr title="Protocol Data Unit">PDUs</abbr> , and if the sender receives it again, then there is a loop. <br>  The interval is responsible for the frequency of the PDU distribution, in this case 2 seconds.  In the case of a loop, the port will be blocked for 180 seconds, after which the PDU will be sent again.  Alert options: log, trap, log-and-trap.  In the case of trap, the snmp trap is sent accordingly. <br>  This protocol is configured per-vlan, as well as most configurations in XOS. </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> elrp-client configure elrp-client periodic Buh<span class="hljs-number"><span class="hljs-number">-123</span></span> ports <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> <span class="hljs-keyword"><span class="hljs-keyword">disable</span></span>-port ingress duration <span class="hljs-number"><span class="hljs-number">180</span></span></code> </pre> <br><p>  To prevent ELRP from blocking uplink access switches or critical connections, the command to exclude ports from blocking is used. </p><br><pre> <code class="hljs pgsql">configure elrp-client <span class="hljs-keyword"><span class="hljs-keyword">disable</span></span>-port <span class="hljs-keyword"><span class="hljs-keyword">exclude</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> configure elrp-client <span class="hljs-keyword"><span class="hljs-keyword">disable</span></span>-port <span class="hljs-keyword"><span class="hljs-keyword">exclude</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><h3 id="stp">  STP </h3><br><p>  STP is configured a little wiser, but in general there are no special problems.  In XOS, this protocol is referred to as ‚Äústpd‚Äù, in all commands to configure STP, it is used.  You can make it per-vlan using different STP domains.  ‚ÄúDomain-id‚Äù and ‚Äúvlan-id‚Äù must match.  Ports in STP can be added either manually or using vlan auto-bind.  As soon as a port is added to the vlan, this port is automatically added to the STP.  Such is the logic.  Setting mode: <abbr title="802.1d standard">dot1d</abbr> STP, <abbr title="802.1w standard">dot1w</abbr> - RSTP: </p><br><pre> <code class="hljs pgsql">configure stpd "s0" priority <span class="hljs-number"><span class="hljs-number">4096</span></span> configure stpd s0 mode dot1w <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> stpd s0 <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> stpd "s0" auto-bind "VLAN_0005"</code> </pre> <br><h2>  VRRP </h2><br><p>  VRRP is one type of <abbr title="First Hop Redundancy Protocol">FHRP</abbr> , an analogue of HSRP in Cisco.  For each network (vlan), it is necessary to use a vrid, which can be from 1 to 255. I was pleased with the ability to route traffic from the backup-vrrp-L3 switch using the fabric-routing option.  By default, the priority is 100. Which of the switches has a higher priority becomes ‚ÄúMaster‚Äù. </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> vrrp vlan test1 vrid <span class="hljs-number"><span class="hljs-number">125</span></span> configure vrrp vlan test1 vrid <span class="hljs-number"><span class="hljs-number">125</span></span> <span class="hljs-keyword"><span class="hljs-keyword">priority</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> configure vrrp vlan test1 vrid <span class="hljs-number"><span class="hljs-number">125</span></span> fabric-routing <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> vrrp vlan test1 vrid <span class="hljs-number"><span class="hljs-number">125</span></span></code> </pre> <br><h2>  MLAG </h2><br><p>  About what it is and why, very well described <a href="https://habr.com/company/muk/blog/225479/">here</a> : it is, in fact, an analogue of Cisco VPC.  <abbr title="Inter-switch connection"><strong>ISC</strong></abbr> - connection between mlag-pair switches. </p><br><p>  In my case, the following scheme was usually used: <br><img src="https://habrastorage.org/webt/zc/bu/qf/zcbuqf-hljcoauy1g6tmdlgb0vq.jpeg"></p><br><p>  It is necessary to create a neighbor (peer) in order to be able to assign specific mlag ports to a specific neighbor, since Extreme supports the possibility of using several neighbors.  For ISC, a vlan is needed, used only for ISC and having an IP address.  Accordingly, the peer for X670-1 will be X670-2, and the mlag ports will be x440.  For operation, it is necessary to create an aggregation channel, and on x670 for one port in the x440 direction, and an aggregated channel in the X670-2 direction, in which there will be <strong>ALL</strong> Vlans participating in the mlag. <br>  On x670: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Enable</span></span> sharing <span class="hljs-number"><span class="hljs-number">1</span></span> grouping <span class="hljs-number"><span class="hljs-number">1</span></span> lacp <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> mlag peer "mlag1" configure mlag peer "mlag1" ipaddress <span class="hljs-number"><span class="hljs-number">10.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> vr VR-<span class="hljs-keyword"><span class="hljs-keyword">Default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> mlag port <span class="hljs-number"><span class="hljs-number">1</span></span> peer "mlag1" id <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><p>  On x440 stack: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">enable</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sharing</span></span> 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:51</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">grouping</span></span> 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:51</span></span>,2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:51</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">lacp</span></span></code> </pre> <br><h2>  MLAG + VRRP </h2><br><p>  During testing of commutators on the stand, the problem was found that VRRP takes the Master role before all other interfaces (ISC rises first) and protocols rise, which resulted in network downtime of about a minute. <br>  This problem was solved by the following commands, but they are available only with ‚ÄúEXOS 21.1.3.7-patch1-4‚Äù and ‚ÄúEXOS 22.3‚Äù: </p><br><pre> <code class="hljs pgsql">configure mlag ports reload-delay <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> mlag port reload-delay</code> </pre> <br><h2>  Routing </h2><br><p>  Static routes are defined as follows, there should be no problems.  You can set the mask in any version. </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">configure</span></span> iproute add <span class="hljs-number"><span class="hljs-number">10.0.66.0</span></span> <span class="hljs-number"><span class="hljs-number">255.255.255.0</span></span> <span class="hljs-number"><span class="hljs-number">172.16.1.1</span></span> configure iproute add <span class="hljs-number"><span class="hljs-number">10.0.0.1</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">10.255.255.255</span></span> configure iproute add default <span class="hljs-number"><span class="hljs-number">172.16.0.1</span></span></code> </pre> <br><h3 id="ospf">  Ospf </h3><br><p>  For routing, in my practice, OSPF with one zone was used.  To ensure operability, you must specify a router-id, as well as add each vlan that needs to be announced (by analogy in Cisco: network). </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">configure</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospf</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">routerid</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">enable</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospf</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">configure</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospf</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">vlan</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">routing-5</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">area</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">configure</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospf</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">vlan</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Voip-32</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">area</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">passive</span></span></code> </pre> <br><h2>  The rest of the little things </h2><br><h3 id="dhcp-relay">  DHCP Relay </h3><br><p>  Configured as follows: </p><br><pre> <code class="hljs pgsql">configure bootprelay <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span> vr VR-<span class="hljs-keyword"><span class="hljs-keyword">Default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> bootprelay ipv4 vlan servers<span class="hljs-number"><span class="hljs-number">-500</span></span></code> </pre> <br><p>  When creating a new vlan, you need to add it manually to the vlan list with DHCP Relay. </p><br><h3 id="ssh--acl-dlya-ssh">  SSH + ACL for SSH </h3><br><p>  Ssh is included as follows: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> ssh2</code> </pre> <br><p>  To restrict access to ssh, you must create a separate policy file of the form NAME.pol and hang it on SSH. </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">vi</span></span> ssh.pol</code> </pre> <br><p>  Politics: </p><br><pre> <code class="hljs mel">Entry AllowTheseSubnets { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> any { <span class="hljs-keyword"><span class="hljs-keyword">source</span></span>-address <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> /<span class="hljs-number"><span class="hljs-number">16</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">source</span></span>-address <span class="hljs-number"><span class="hljs-number">10.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.34</span></span> /<span class="hljs-number"><span class="hljs-number">32</span></span>; } Then { permit; } }</code> </pre> <br><p>  Team to apply policy: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> ssh2 <span class="hljs-keyword"><span class="hljs-keyword">access</span></span>-profile ssh.pol</code> </pre> <br><h3 id="description--display-string">  Description + display-string </h3><br><p>  For convenience of configuration and subsequent operation, you can set the "name" and "description" of the interface. </p><br><pre> <code class="hljs kotlin">onfigure port <span class="hljs-number"><span class="hljs-number">1</span></span> description ‚Äú<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> port number one‚Äù</code> </pre> <br><p>  Interface description will be displayed only in commands like: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ports description</code> </pre> <br><p>  The name of the interface will replace almost everywhere its number in the output of commands.  The name must not contain a space and is limited to a length of 20 characters. </p><br><pre> <code class="hljs vhdl">onfigure <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> display-<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> UserPort EXOS-VM.<span class="hljs-number"><span class="hljs-number">8</span></span> # sh <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> vlan Untagged <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span> /Tagged VLAN Name(s) <span class="hljs-comment"><span class="hljs-comment">-------- -------- ------------------------------------------------------------ UserPort Untagged Default 2 Untagged Default 3 Untagged Default</span></span></code> </pre> <br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  <strong>XOS</strong> also allows you to automate many actions and adjust the system to your needs, as it natively supports Python and the built-in mechanism for creating and running scripts using command line commands ( <em>CLI-Scripting</em> ). </p><br><p>  I am open to suggestions for improving the article and correcting inaccuracies / errors, as well as questions. </p><br><p>  <strong>UPD</strong> : LLDP for IP phones is configured using the commands <a href="https://habr.com/post/419965/">in this comment</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/419965/">https://habr.com/ru/post/419965/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../419951/index.html">Experience using WebRTC. Yandex lecture</a></li>
<li><a href="../419953/index.html">I am writing a book about the first ‚Äúour‚Äù startup that has conquered the world: help</a></li>
<li><a href="../419955/index.html">UART FIFO Buffer Features in ESP32</a></li>
<li><a href="../419961/index.html">The digest of interesting materials for the mobile developer # 265 (August 6 ‚Äî August 12)</a></li>
<li><a href="../419963/index.html">Making a smart controller for an air conditioner on an ESP8266</a></li>
<li><a href="../419969/index.html">Hiding in Ruby. We also hide classes from Top-Level.</a></li>
<li><a href="../419971/index.html">Rocket lab repairs, expands and accelerates</a></li>
<li><a href="../419975/index.html">As we corporate from Windows ran away</a></li>
<li><a href="../419979/index.html">How Python Helps Replace Financial Advisors</a></li>
<li><a href="../419981/index.html">The nightlife of the sky or in search of Perseid</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>