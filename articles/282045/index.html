<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Scaling to 100 million: architecture defined by service level</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the third part of the Wix Scaling to 100 Million Users cycle. Entry and second post . 

 Wix started with a single server that provided all th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Scaling to 100 million: architecture defined by service level</h1><div class="post__text post__text-html js-mediator-article">  <i>This is the third part of the Wix Scaling to 100 Million Users cycle.</i>  <i><a href="https://habrahabr.ru/company/wix/blog/279903/">Entry</a> and <a href="https://habrahabr.ru/company/wix/blog/280033/">second post</a> .</i> <br><br>  Wix started with a single server that provided all the functionality: user registration, web site editing, maintenance of published web sites, and image upload.  At one time, this single server was the right decision, because it allowed us to grow rapidly and use flexible development methods.  However, by 2008, periodically recurring deployment problems began, leading to unplanned downtime both in the creation of new sites and in the maintenance of existing ones. <br><br>  Deploying a new version of our system in some cases required a change in the MySQL schema.  Since Hibernate does not forgive the discrepancies between the scheme it expects and the real database scheme (DB), we used general software deployment practice: a planned two-hour stop during the period of least traffic (midnight in the US at the weekend).  During this scheduled shutdown, we had to stop the service, shut down the server, make changes to the MySQL schema, deploy a new version, and restart the server. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This planned two-hour stop often turned into something more complicated due to problems that could have occurred during deployment.  In some cases, making changes to the MySQL schema took much longer than planned (changing large tables, rebuilding indexes, removing restrictions on data migration, etc.).  Sometimes, after changing the schema and trying to restart the server, it did not start due to some unintended problems with deployment, configuration, or schema that prevented it from working.  And in some cases, the new version of our software turned out to be unworkable, so to restore the service we had to change the MySQL scheme again (to bring it into line with the previous version) and re-deploy the previous version of the system. <br><a name="habracut"></a><br>  But the worst happened if, a few days after the ‚Äúsuccessful‚Äù deployment, we found in the new version a critical, albeit rare, bug that caused damage to user sites.  In this case, the best was to roll back to the previous version (at least until the bug was fixed), and for this it was necessary to change the scheme again, which meant an unplanned stop of the service. <br>  It is important to note that since we used the same server application to service all Wix systems, the shutdown affected the entire service, including published sites.  As our user base grew, more and more sites were affected by our planned and unplanned stops. <br><br><h2>  <font color="#f9a339">And then it dawned on us</font> </h2><br>  Wix performs two different functions: maintenance of existing sites and the creation of new sites.  Stopping site creation has a direct impact on our daily sales, but stopping existing sites has a direct impact on our existing and paying users.  We needed to define and create different levels of service for each of the functions. <br>  In addition, after additional analysis, we found that most of our innovations related to the development of new sites, and only a small number of changes related to existing sites.  This meant that we made frequent releases of software that jeopardized the functioning of both created and already working sites, even if the changes concerned only created sites. <br><br>  Realizing this, we divided our system into two segments: the editorial segment, which is responsible for building new sites, and the public segment, which is responsible for servicing sites.  This solution allowed us to provide different levels of service corresponding to each of the business functions. <br><br>  The technology stack chosen for building the public segment was intentionally simple.  We no longer used Hibernate, we abandoned any form of cache, and we started using Spring MVC 3.0.  An important design principle was to make the segments unrelated to each other in terms of software, release cycles and data storage, as well as to make the software stack easy to understand and optimized for serving sites. <br><br>  A clear sign of such incoherence was the publication process (the descendants of which are still present in the Wix core), which copied data from the editorial database to the public segment.  During this process, the data structures were transformed from an effective editing view to a view that best suits the published site. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ccc/be9/375/cccbe93757aa488ea31e88f122d2c516.jpg"></div><br><br>  As a result of the deployment of the public segment have become rare and low-risk.  It still functions on the Wix system, six years after the first deployment (although something has changed since then). <br><br><h2>  <font color="#f9a339">What we have learned</font> </h2><br>  We already understood that the release cycle is associated with risk, but now we realized that our two key business functions ‚Äî building and maintaining websites ‚Äî are at different risk.  We realized that we need to provide different levels of service for these functions and that it is around them that we need to build our system.  What are these different levels of service?  We considered the following aspects: accessibility, performance, riskiness of changes and recovery time after a failure.  The public segment, which affects all users and all Wix sites, should have the highest level of service on these aspects.  But in the editorial segment, failure only affects users who are directly involved in creating the site, so the consequences for the business are less significant.  Therefore, we somewhat sacrificed a high level of service for the sake of greater flexibility, which made it possible to reduce the effort required for development. <br><br>  Chief Software Architect for Wix <a href="http://ru.wix.com/">Website Designer</a> , <br>  Yoav Abrahami <br>  Original article: <a href="http://engineering.wix.com/2015/04/18/scaling-to-100m-service-level-driven-architecture/">Wix engineers blog</a> </div><p>Source: <a href="https://habr.com/ru/post/282045/">https://habr.com/ru/post/282045/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282035/index.html">Weak [weak] links in the new version of Delphi</a></li>
<li><a href="../282037/index.html">We do multitasking</a></li>
<li><a href="../282039/index.html">Moscow Python Meetup ‚Ññ34 (April 27)</a></li>
<li><a href="../282041/index.html">JS Loader + template engine or history of another</a></li>
<li><a href="../282043/index.html">On the development of non-paged keys based on passwords</a></li>
<li><a href="../282047/index.html">Evolution of viruses: from student fun to disruption of Iran‚Äôs nuclear program</a></li>
<li><a href="../282049/index.html">Preemptivity: how to take away the processor</a></li>
<li><a href="../282053/index.html">Andrei Ershov: ‚ÄúTwo Views of Programming‚Äù</a></li>
<li><a href="../282057/index.html">Xamarin Development Workshop: Technology Overview and Dive into Solution Development</a></li>
<li><a href="../282065/index.html">How it is made: mobile cross-platform engine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>