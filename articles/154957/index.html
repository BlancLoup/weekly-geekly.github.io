<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We speed up the service from the client side several times. Ajax + preloading in the background + when you hover</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When databases and server are configured, queries are optimized, all caches are turned on, what options are left to speed up the service? The last lev...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We speed up the service from the client side several times. Ajax + preloading in the background + when you hover</h1><div class="post__text post__text-html js-mediator-article">  When databases and server are configured, queries are optimized, all caches are turned on, what options are left to speed up the service?  The last level of abstraction, the user interface, allows you to achieve a speed increase from almost nothing.  These three simple recipes will help not only to speed up the site several times, but also add some convenient buns to it.  In the first part, we will easily transfer the site to primitive ajax-navigation.  In the second, add preloading pages when you hover the mouse and just in the background.  Overcome the speed of sound?  We jump! <br><br><img src="https://habrastorage.org/storage2/f6e/48f/9ab/f6e48f9abfba4deffc2490f3a1281395.jpg"><br><a name="habracut"></a><br><br><h1>  Ajax transitions between pages with instant return back. </h1><br>  Just a couple of days ago there <a href="http://habrahabr.ru/post/154617/">was an article</a> on this topic.  It so happened that my article was already ready at that time, so the part about ajax will partly repeat a colleague.  Take it as yet another experience and proof of how simple it is.  In addition, my alternative will touch on several important aspects that were not considered by a colleague, and more deeply plunge into the practical part, allowing from scratch to fully implement navigation based on the code from the article. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Implementing ajax transitions in a simple form is not that difficult.  Immediately make a reservation: <br>  Surely there are ready-made libraries that make it even easier and more accurate.  The purpose of this article is to show that it is easy to do with your hands.  What for?  For example, to adapt the script specifically for your site.  The example in the article covers far from all aspects of ajax transitions (for example, work without history api will not be affected (normal navigation will be preserved for such browsers), or script version control).  All aspects will not fit into the article, but will definitely be mentioned. <br><br><h6>  Explain briefly what a foreigner is talking about? </h6>  <i>Have you seen VKontakte audio player, working without stopping when navigating between pages?</i>  <i>This is because the pages are not reloaded, when you click on each link, javascript sends a request to the server, receives a page in response, and replaces the contents of the current page with it.</i>  <i>Obvious advantages of this approach (except the ability to make a continuous player): deeper splitting a site into components allows you to win in the page loading speed (for example, you can not reload the static header of the site), and already loaded scripts do not need to be downloaded again, which saves requests, which also gives speed increase (this task is not always solved by the cache in the browser, for example, in the case of connected third-party dynamic libraries).</i>  <i>In my case, switching to ajax is dictated by the inability to cache Google Charts, which js was given for more than a second at each transition and was not cached, and the license was locally prohibited to save it.</i> <br><br><h4>  Server side preparation. </h4><br><h5>  MVC, JSON, wrapping page content. </h5>  If you still have not separated the logic from the presentation, it's time to do it.  To give a page through ajax, you need to get its contents in the form of a line.  Therefore, if your code alternates with the output of intermediate data, you will need serious refactoring (it is still needed and will make life easier in the future): you need to ensure that all data for output is formed at the end, using a template (even regular functions returning the string can perform their role and independent of each other), to which variables with prepared dynamic data are transferred. <br><br>  When clicking on links, the page will now be rendered in JavaScript, so it must be packaged in some format.  For simplicity, use JSON. <br>  We divide the data into components: html code, inline-scripts, page title, and information about redirect-e.  Let's write a function that will receive these components as input, and return the result of the query to JS when clicking on the link (below is pseudocode, it was based on php, but you may have a different language): <br><br><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">response</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(html, options = null)</span></span></span><span class="hljs-function"> </span></span>{ define res; <span class="hljs-comment"><span class="hljs-comment">//     JSON res['html'] = html; // html  html- . //      html,   ‚Äì error. if (options) { if (options['script']) { res['script'] = options['script']; } if (options['redirect']) { res['redirect'] = options['redirect']; } if (options['title']) { res['title'] = options['title']; } } //       json   UTF-8 header('Content-Type: application/json; charset=UTF-8'); print json_encode($res); //  res  json     http. exit(); //       json . }</span></span></code> </pre> <br><br>  Now, in order to render the page during an ajax transition, it will be sufficient to call the response () function. <br>  For example, for php, it will look like this: <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapAbout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($employees)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;div&gt;   2012 .    : {$employees}&lt;/div&gt;"</span></span>; } $employees = getEmployeesNumber(); $html = wrapAbout($employees); response($html, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>));</code> </pre><br><br><h5>  Error processing. </h5>  It is not always possible to return the page.  Error information will be processed separately. <br>  To do this, we write the function: <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(num, msg)</span></span></span><span class="hljs-function"> </span></span>{ define res; <span class="hljs-comment"><span class="hljs-comment">//,     JSON define res['error']; //     res['error']['num'] = $num; //  res['error']['msg'] = $msg; //          print json_encode(res); exit(); }</span></span></code> </pre><br><br>  Now, if an exception has occurred, or incorrect data has been transmitted, we respond as follows: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($_POST[<span class="hljs-string"><span class="hljs-string">'password'</span></span>] != $password) { error(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'Invalid password'</span></span>); }</code> </pre><br><br><h5>  Support direct requests. </h5>  And what if the user did not click on the link, but went directly, or pressed F5?  Such cases also need to be handled.  For this, we optimized the code so that the line with html is returned.  It is enough to give this html directly, and not in the form of json in cases where the request did not come from ajax.  How to understand this?  When querying from ajax, we will pass an additional parameter ajax = 1, so we can always discern where the query came from and how to return the result. <br><br><h4>  Client part </h4><br><h5>  Client part preparation </h5>  Here we are also waiting for a small refactoring.  There is such a thing as "page status".  We no longer move between pages, everything happens on one, so the states need to be isolated.  We want to work with the back button, instantly returning to the previous state of the page, and at the same time we want to have all the variables in the javascript environment.  To do this, we will store the state in a single entity storing the full current state.  It sounds scary, looks trivial: <br><pre> <code class="javascript hljs">cur = {<span class="hljs-attr"><span class="hljs-attr">somevar</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>};</code> </pre> <br>  We will store all the variables of the page inside cur - then we can easily save its state. <br>  Let's get an auxiliary cache where the contents of the previous pages will be stored a couple of steps back: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> globalPageHtml = [];</code> </pre> <br><br><h5>  Processing links </h5><br>  Links are no longer links, but buttons that click on to execute JavaScript, which loads another page via ajax.  At the same time, it is necessary to preserve the possibility of a usual transition, in case ajax navigation is not available (for example, if history api is not supported and we cannot change the URL, but do not want to use hash navigation).  And you need to support ctrl + click to open the link in a new tab.  Redo all links in this way: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"go('/someurl', null, event); return false;"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/someurl"</span></span></span><span class="hljs-tag">&gt;</span></span>Some link<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  What is go?  This is the most important method, that he will be engaged in navigation, it will be about him below. <br><br><h5>  Work with URL and history </h5><br>  To work with navigation history, we will use the popular <a href="https://github.com/balupton/History.js/">history.js</a> library.  This will allow us to support hash navigation at the same time in the future, but for now we are building primitive ajax navigation, which means browsers lagging behind progress can be left behind. <br>  We initialize the work with History (it is assumed that the project uses jquery) to support the work with the back button: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> History = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.History; History.enabled = !!(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.history &amp;&amp; history.pushState); <span class="hljs-comment"><span class="hljs-comment">//Temp turn off html4 if (History.enabled) { $(window).bind('statechange', function() { var State = History.getState(); //replacingState -  ,    ajax-  .      URL   ,      -   back     .           ajax-     . if (!cur.replacingState) { cur = State.data; //,   ,   history api,      history.js if (globalPageHtml[State.url]) { //       ? $('#content').html(globalPageHtml[State.url].html); // ,       content,    html     . Html    . if (globalPageHtml[State.url].scripts) {//     ,    ,   , jquery       DOM. var fragment = document.createDocumentFragment(); globalPageHtml[State.url].scripts.each( function(nodeIndex, scriptNode) { fragment.appendChild(scriptNode); //   ,            -    DOM. }); document.getElementById('content').appendChild(fragment); //    DOM  ,     . } window.scrollTo(globalPageHtml[State.url].scroll[0], globalPageHtml[State.url].scroll[1]); //        ,    . delete globalPageHtml[State.url]; //  } else { go(State.url, null, null, true); //    "" ,      (,         URL  ).       ,      . } } cur.replacingState = false; }); }</span></span></code> </pre><br><br><h5>  Basic javascript for ajax transitions </h5><br>  That got to the most important.  The go function is called when the link is clicked: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">go</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url, query, event, back</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!History.enabled || (event &amp;&amp; (event.ctrlKey || event.metaKey))) { <span class="hljs-comment"><span class="hljs-comment">//  ctrl ( command  )   history api var requestString = url; if (query) { requestString += query; } if (!History.enabled) { window.location = requestString; //   history api,      } else { window.open(requestString, '_blank'); //    ctrl,      /,   ajax } return; } var query = query || {}; var urlString = (url.length &gt; 0) ? url : $(location).attr('href').split('?', 1); // URL   ( ),    if (jQuery.param(query).length &gt; 0) { urlString += '?' + jQuery.param(query); //    (        ) } urlString = window.decodeURI(urlString); //  .          URL  history api.   , ,   rewrite,       N     /post/N,  - /post?item=N -        ajax . $.extend(query, {ajax: 1}); //       ajax  (   ,   url    ) $.ajax({ url: url, global: false, type: "GET", data: query, dataType: "json", success: function (res) { if (res.html) { //ajax     html,         ,      if (!back) { //  ,      ,      var currentUrl = $(location).attr('href'); globalPageHtml[currentUrl] = new Object(); //    ,    url globalPageHtml[currentUrl].html = $('#content').html(); globalPageHtml[currentUrl].scroll = getScrollXY(); //     globalPageHtml[currentUrl].scripts = $('script:not([src])'); //   .      .          cur.   ,  -       (,      ),     -  ,      (disclaimer:       ).   inline  ,                 (    ). //   state, history api,   cur.replacingState = true; History.replaceState(cur, $(document).attr('title') || null, window.decodeURI(currentUrl) || null); //       cur,  ,       back,   cur.replacingState = true; History.pushState(null, res.title || null, urlString); // URL     } window.scrollTo(0, 0); //      document.getElementById('content').innerHTML = res.html; //, ,    cur = {}; $('script:not([src])').each( //  (      innerHTML,   html()  jquery        ) function(nodeIndex, scriptNode) { try {eval(scriptNode.innerHTML);} catch(e) {/*Do nothing*/} }); } else { errorAlert(res.error || 'Unable to load page ' + url); //errorAlert - ,     ,    } }, error: function (res) { errorAlert(res.error || 'Unable to load page ' + url); } }); }</span></span></code> </pre><br>  Everything!  Ajax navigation is ready. <br><br><h5>  Important notes about aspects not considered in this approach. </h5><br>  More serious ajax navigation will take into account the work with hashes for IE, but the limitations of the system implemented by us are not limited to this. <br><br><h6>  Loading different scripts for different pages </h6>  In the current form it is assumed that all JS-libraries will be loaded when you first enter any page.  This is good when you have a small service, but in a large project I would like to download only the js that is relevant only for this section of the site.  Therefore, a more serious ajax navigation should be able to load and unload third-party js-modules.  It‚Äôs easy to implement: just transfer the url list of scripts you need to load from the server, use some ready-made bootloader, and on the next ajax transition throw out the downloaded code (or you can leave it, if you‚Äôre fighting only for speed, you don‚Äôt mind the memory) ). <br><br><h6>  Script Versions </h6>  In the js-code bug and you just rolled out a new version?  Problem: during ajax-navigation, scripts may not be updated for days - a page opened in the browser, inside which scripts are not downloaded with each request, but have long been in memory, prevents the user from receiving the update.  There is a solution: transfer the version numbers of js-modules from the server at each ajax transition.  If the module is updated, download its new version, replacing the previous one from memory.  The same applies to css. <br><br><h6>  Global ajax cache </h6>  In a more serious ajax navigation system, it is convenient to implement a global query cache in order to manually cache some queries and pages.  This can be useful for preloading when you hover the cursor.  Actually, we now proceed to the preloading. <br><br><h1>  Preload pages </h1>  After we have ajax-navigation, simple but super functional features are available to us to speed up the service.  The effect of these simple techniques exceeds all expectations: the work of the site becomes instantaneous.  And preloading will help us in this.  It can be divided into two fundamentally different methods: preloading in the background, and when you hover the cursor.  The first is available for a fixed small number of sections of the site associated with the current page.  For example, if there are five tabs on the Settings page - we can download these tabs after loading the main page in the background so that they can be opened immediately upon click.  This technique does not give a ride for the list of products (and in general any list of links) - you cannot load the page of each product from the search results if the list is more than 5 items.  This will help preload when you hover the mouse. <br><br><h4>  Preload in background </h4><br>  Consider an example based on the revised code from VKontakte.  Suppose we have several tabs (instead of tabs, there can be any sections and links that it is reasonable to open instantly on the open page).  We are in one of them.  Simply execute the preloadTabs (currentTab) method at the end of the page load;  We will transfer the current tab to it, so that the north will return information only about the missing tabs, without loading the already opened one.  The general meaning of the approach is: instead of immediately downloading information about neighboring tabs, which takes time, we will load only one tab, and load the rest in the background immediately after the open tab is ready.  The effect is fantastic.  Let us consider an example: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preloadTabs</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">current</span></span></span><span class="hljs-function">) </span></span>{ cur.preloading = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   ajax    (     ajax      ,      ),    .  ,    callback   (  createElement   DOM-,         -    ,    ). function(data, tab1Html, tab2Html, tab3Html) { var page = $('#content'); if (cur.section != 'tab1') { page.append(createElement('div', {innerHTML: tab1Html})); } if (cur.section != 'tab2') { page.append(createElement('div', {innerHTML: tab2Html})); } if (cur.section != 'tab3') { page.append(createElement('div', {innerHTML: tab3Html})); } cur.preloading = 2; //0 -   , 1 -      , 2 -   }</span></span></code> </pre><br><br>  The function that will be in the handler for clicks on links and actually switch tabs: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">switchTab</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">section</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cur.section == section) { <span class="hljs-comment"><span class="hljs-comment">//    return; } var doSwitch = function(section) { hideCurrentSection(); //   id     cur.section = section; // id  showCurrentSection(); //  ,    ,     append ( display:none )  DOM   //      history  ,    }; if (!cur.preloading || cur.preloading == 1) { //     $('#load_progress').show(); // ,     ,    if (cur.preloading != 1) { preloadTabs(cur.section); } var waitPreload = setInterval(function() { if (cur.preloaded == 2) { //  $('#load_progress').hide(); //    clearInterval(waitPreload); doSwitch(section); } }, 100); } else { doSwitch(section); } }</span></span></code> </pre><br>  The convenience of this code is that it will work even when the tabs are not yet loaded (someone clicked on the link very quickly).  If the download has not started yet, it will start it, and the waiting indicator will show, and if the loading of the tabs has been started, it will wait for it to complete, and only then will show the tab.  Very simple, but the service starts to fly. <br><br><h4>  Preload on mouse over </h4><br>  Almost every click has a significant (in milliseconds) delay between the click itself and the period when the cursor is over the link.  This allows you to have time to download the link before clicking on it, turning the transition into an instant one.  Here you need to be careful: what if the user moves the cursor from point A to B, and our link came up on the way (and at the same time a couple dozens of others - let's not bomb the browser and ajax service with requests if the cursor just went through the links).  It turns out that before the click the cursor is delayed over the link, and you can calculate this minimum time range between clicks, but after hovering over the link, you can load the page, but the download will begin after a sufficient time to understand exactly what we hover over with the intention to click , and not just passing through.  Additionally, we will cache strictly by one link; if we preload the new one, the old one is pushed out of memory. <br><br>  By hovering the cursor, we will call a function (for example, for the list of friends we load user profiles): <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preloadUser</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">user_id</span></span></span><span class="hljs-function">) </span></span>{ cur.pendingPreloadUid = user_id; cur.pendingPreload = setTimeout(doPreloadUser, <span class="hljs-number"><span class="hljs-number">50</span></span>); <span class="hljs-comment"><span class="hljs-comment">//50ms -         }</span></span></code> </pre><br><br>  On the mouseout event (the cursor is moved away from the link), we will call: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cancelPreloadUser</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ clearTimeout(cur.pendingPreload); }</code> </pre><br><br>  And if you managed to wait for 50ms, then preload the link: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doPreloadUser</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> uid = cur.pendingPreloadUid; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cur.cachedUser &amp;&amp; (uid != cur.cachedUser.uid)) { <span class="hljs-comment"><span class="hljs-comment">// -   ,     ,        unloadUser(cur.cachedUser.uid); } else { cur.cachedUser = new Object(); } cur.cachedUser.uid = uid; //  ajax ,      .     ,     ,           ,          ,      ,        .       cachedUser,    . }</span></span></code> </pre><br>  Do not forget to unload the link, if a request came to preload a new one; in the unloadUser (uid) function, you need to clear the global cache. <br><br><img src="https://habrastorage.org/storage2/3b2/612/aba/3b2612abaf735821f8e4db079647c167.png"><br><br>  Thank you, if you heroically read this far, or appreciate the work in preparing this article.  All described methods are implemented depending on the size of the project from several hours to several days.  I really hope that this material will help you to speed up your web services in practice many times.  Write comments and share in the comments your experience accelerating sites. <br><img src="http://habr.habrastorage.org/post_images/afa/19d/045/afa19d045b2bce238895a5f2856f9174.gif" alt="image"></div><p>Source: <a href="https://habr.com/ru/post/154957/">https://habr.com/ru/post/154957/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../154945/index.html">How I started a project about startups, and how it developed in practice</a></li>
<li><a href="../154947/index.html">Linux ipsec decoding</a></li>
<li><a href="../154949/index.html">Personal personal documents will appear in Google personal search results.</a></li>
<li><a href="../154951/index.html">How to determine the language of the printed text? (European languages)</a></li>
<li><a href="../154953/index.html">Automate the business process on SharePoint with improvised tools</a></li>
<li><a href="../154959/index.html">As I decided to quietly teach a python, but I got into the wilds of CS188.1x Artificial Intelligence</a></li>
<li><a href="../154963/index.html">Does LK write its operating system?</a></li>
<li><a href="../154969/index.html">Another bitcoin death. Now asic</a></li>
<li><a href="../154971/index.html">7 reasons why cloud technology needs Europe</a></li>
<li><a href="../154973/index.html">Steve Ballmer will show the Russian application on Windows 8</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>