<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>System scripts in php for linux, we write a screenshot</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many people believe that php is only suitable for developing websites, and can not be used in any other areas of programming languages, for creating p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>System scripts in php for linux, we write a screenshot</h1><div class="post__text post__text-html js-mediator-article">  Many people believe that php is only suitable for developing websites, and can not be used in any other areas of programming languages, for creating programs ... In this article I would like to highlight the use of php scripts in a ‚Äúnon-targeted‚Äù way, namely, we will write the script that will make the screen, upload it to the yandex disk and output the screenshot address to the console ... <br><a name="habracut"></a><br>  Consider the structure of the project, it is very simple and consists of 3 files: <br><br>  1. screen.php - entry point to the application. <br>  2. classes / autoload.php - project autoloader. <br>  3. classes / Request.php - a class that implements requests to Yandex api. <br><br>  Next, consider the screen.php code: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Code screen.php</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/php &lt;?php require_once('classis/autoload.php'); $request = new Request(); if(isset($argv[1]) &amp;&amp; $argv[1] == '--getToken') { echo $request-&gt;getOauthLink();die; } $home = $_SERVER['HOME']; $config = include($home . '/.config/scrphp/config.php'); $nameScreenshot = date('Y_m_d_G_i_s_') . 'screen.png'; system('scrot -s /tmp/'.$nameScreenshot); $result = $request -&gt;setToken($config['token']) -&gt;setFileNameOnDisk($nameScreenshot) -&gt;setPathToFile('/tmp/'.$nameScreenshot) -&gt;upload() -&gt;publicateFile(); $url = $result['public_url']; echo $url.PHP_EOL;</span></span></code> </pre> <br></div></div><br>  As you can see this is the entry point into the application, the logic is simple: <br>  1. Formation of the screenshot name <br>  2. Calling the scrot system program <br>  3. Request api yandex.disk and upload a screenshot <br><br>  The autoload.php file is also very simple and consists of only three lines of code, I will give it only for your reference, and we will not consider it in detail. <br><br><pre> <code class="php hljs">spl_autoload_register(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.<span class="hljs-string"><span class="hljs-string">'/'</span></span>.$name.<span class="hljs-string"><span class="hljs-string">'.php'</span></span>; });</code> </pre><br>  Working with yandex api is quite simple. I wrote a small class Request.php, with a set of some methods that help me in working with it ... <br><br><div class="spoiler">  <b class="spoiler_title">Listing Request.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Request</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_token = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_href = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_method = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_filePath = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_fileName = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * get oauth link */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOauthLink</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * https://oauth.yandex.ru/authorize? * response_type=token * &amp; client_id=&lt; &gt; * [&amp; device_id=&lt; &gt;] * [&amp; device_name=&lt; &gt;] * [&amp; display=popup] * [&amp; login_hint=&lt;    &gt;] * [&amp; force_confirm=yes] * [&amp; state=&lt; &gt;] */</span></span> $link = <span class="hljs-string"><span class="hljs-string">'https://oauth.yandex.ru/authorize'</span></span> .<span class="hljs-string"><span class="hljs-string">'?response_type=token'</span></span> . <span class="hljs-string"><span class="hljs-string">'&amp;client_id=8fc231e60575439fafcdb3b9281778a3'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $link; } <span class="hljs-comment"><span class="hljs-comment">/** * set file path on disk * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $filePath * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> $this */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setFileNameOnDisk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * https://cloud-api.yandex.net/v1/disk/resources/upload ? * path=&lt;,     &gt; */</span></span> $link = <span class="hljs-string"><span class="hljs-string">'https://cloud-api.yandex.net/v1/disk/resources/upload?path='</span></span>.urlencode(<span class="hljs-string"><span class="hljs-string">'/'</span></span>.trim($name,<span class="hljs-string"><span class="hljs-string">'/'</span></span>)); $response = file_get_contents($link,<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_context(<span class="hljs-string"><span class="hljs-string">'GET'</span></span>)); $responseAsArray = json_decode($response,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_href = $responseAsArray[<span class="hljs-string"><span class="hljs-string">'href'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_method = $responseAsArray[<span class="hljs-string"><span class="hljs-string">'method'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_fileName = $name; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * get path to file on local disk * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $path * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> $this */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPathToFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($path)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_filePath = $path; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * upload file to disk */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">upload</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $ch = curl_init(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_href); curl_setopt($ch,CURLOPT_HTTPHEADER, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'Authorization'</span></span>, <span class="hljs-string"><span class="hljs-string">'OAuth '</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_token ) ); curl_setopt($ch,CURLOPT_INFILE,fopen(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_filePath,<span class="hljs-string"><span class="hljs-string">"r"</span></span>)); curl_setopt($ch,CURLOPT_INFILESIZE,filesize(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_filePath)); curl_setopt($ch,CURLOPT_PUT,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); curl_exec($ch); curl_close($ch); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * public file and get public url for screenshot * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> mixed */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">publicateFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * https://cloud-api.yandex.net/v1/disk/resources/publish ? * path=&lt;   &gt; */</span></span> $link = <span class="hljs-string"><span class="hljs-string">'https://cloud-api.yandex.net/v1/disk/resources/publish?path='</span></span>.urlencode(<span class="hljs-string"><span class="hljs-string">'/'</span></span>.trim(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_fileName,<span class="hljs-string"><span class="hljs-string">'/'</span></span>)); $response = file_get_contents($link,<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_context(<span class="hljs-string"><span class="hljs-string">'PUT'</span></span>)); $responseAsArray = json_decode($response,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $publicateFile = file_get_contents($responseAsArray[<span class="hljs-string"><span class="hljs-string">'href'</span></span>],<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_context($responseAsArray[<span class="hljs-string"><span class="hljs-string">'method'</span></span>])); $publicateFileAsArray = json_decode($publicateFile,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $publicateFileAsArray; } <span class="hljs-comment"><span class="hljs-comment">/** * set oauth token * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $key * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> $this */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setToken</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($token)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_token = $token; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * get context for request by file_get_contents * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $method * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> resource */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_context</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($method)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Authorization: OAuth &lt;key&gt; */</span></span> $opts = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'http'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'method'</span></span>=&gt;$method, <span class="hljs-string"><span class="hljs-string">'header'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"Authorization: OAuth "</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_token.<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span> ) ); $context = stream_context_create($opts); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $context; } }</code> </pre><br></div></div><br>  Consider the key methods of this class for requesting api methods, I mainly used file_get_contents, and since I had to use it, I used a method for generating context when requesting many methods: <br><br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * get context for request by file_get_contents * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $method * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> resource */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_context</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($method)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Authorization: OAuth &lt;key&gt; */</span></span> $opts = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'http'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'method'</span></span>=&gt;$method, <span class="hljs-string"><span class="hljs-string">'header'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"Authorization: OAuth "</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_token.<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span> ) ); $context = stream_context_create($opts); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $context; }</code> </pre><br>  It is also quite simple. We create a context with a specific request method and authentication information ... <br><br>  Next, we need to ‚Äúcreate a file on yandex.disk‚Äù we perform this action using the following method: <br><br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * set file path on disk * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $filePath * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> $this */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setFileNameOnDisk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * https://cloud-api.yandex.net/v1/disk/resources/upload ? * path=&lt;,     &gt; */</span></span> $link = <span class="hljs-string"><span class="hljs-string">'https://cloud-api.yandex.net/v1/disk/resources/upload?path='</span></span>.urlencode(<span class="hljs-string"><span class="hljs-string">'/'</span></span>.trim($name,<span class="hljs-string"><span class="hljs-string">'/'</span></span>)); $response = file_get_contents($link,<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_context(<span class="hljs-string"><span class="hljs-string">'GET'</span></span>)); $responseAsArray = json_decode($response,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_href = $responseAsArray[<span class="hljs-string"><span class="hljs-string">'href'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_method = $responseAsArray[<span class="hljs-string"><span class="hljs-string">'method'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_fileName = $name; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; }</code> </pre><br>  As I said earlier, we request api using the file_get_contents function.  After this method completes and all information is requested, the upload method starts: <br><br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * upload file to disk */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">upload</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $ch = curl_init(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_href); curl_setopt($ch,CURLOPT_HTTPHEADER, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'Authorization'</span></span>, <span class="hljs-string"><span class="hljs-string">'OAuth '</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_token ) ); curl_setopt($ch,CURLOPT_INFILE,fopen(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_filePath,<span class="hljs-string"><span class="hljs-string">"r"</span></span>)); curl_setopt($ch,CURLOPT_INFILESIZE,filesize(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_filePath)); curl_setopt($ch,CURLOPT_PUT,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); curl_exec($ch); curl_close($ch); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; }</code> </pre><br>  In this case, it would be possible to use one of the functions `file_get_contents` or` file_put_contents` to send the file, but this is not advisable, because it would have to, in the context of these functions, manually imitate the headers and other problems resulting from this, so it's easier to just use curl for this purpose. <br><br>  And so the file is loaded, it remains only to publish it and get a direct link to view, this is performed by the function publicateFile (): <br><br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * public file and get public url for screenshot * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> mixed */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">publicateFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * https://cloud-api.yandex.net/v1/disk/resources/publish ? * path=&lt;   &gt; */</span></span> $link = <span class="hljs-string"><span class="hljs-string">'https://cloud-api.yandex.net/v1/disk/resources/publish?path='</span></span>.urlencode(<span class="hljs-string"><span class="hljs-string">'/'</span></span>.trim(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_fileName,<span class="hljs-string"><span class="hljs-string">'/'</span></span>)); $response = file_get_contents($link,<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_context(<span class="hljs-string"><span class="hljs-string">'PUT'</span></span>)); $responseAsArray = json_decode($response,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $publicateFile = file_get_contents($responseAsArray[<span class="hljs-string"><span class="hljs-string">'href'</span></span>],<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_context($responseAsArray[<span class="hljs-string"><span class="hljs-string">'method'</span></span>])); $publicateFileAsArray = json_decode($publicateFile,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $publicateFileAsArray; }</code> </pre><br>  In this method, too, everything is quite simple, we request the publication of the file by the PUT method from the api, Yandex returns a link to which we must execute the request to confirm the publication, and the method of the request in the disk.  And in the end, after the second request, we get an array that maintains a link to the public file. <br><br><h3>  Install script </h3><br>  Well, we‚Äôve finished, now we‚Äôll have to figure out, but how will this script work from the console?  How to run it in the "global area"?  The answer to these questions will be a phar archive containing php files and able to run as a separate application, similar to the same jar. <br><br>  we will build phar using the box.phar utility for this we write a simple configuration file box.json: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"files"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"classis/autoload.php"</span></span>, <span class="hljs-string"><span class="hljs-string">"classis/Request.php"</span></span>, <span class="hljs-string"><span class="hljs-string">"screen.php"</span></span> ], <span class="hljs-string"><span class="hljs-string">"main"</span></span>: <span class="hljs-string"><span class="hljs-string">"screen.php"</span></span>, <span class="hljs-string"><span class="hljs-string">"output"</span></span>: <span class="hljs-string"><span class="hljs-string">"srcphp.phar"</span></span>, <span class="hljs-string"><span class="hljs-string">"stub"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> <br>  To build run: <br><br><pre> <code class="bash hljs">$ php box.phar build</code> </pre><br>  And our project is now ready to install the rights to execute the file, and copy it to the / usr / bin / srcphp directory: <br><br><pre> <code class="bash hljs">$ chmod +x srcphp.phar $ cp srcphp.phar /usr/bin/srcphp</code> </pre><br>  Do not forget about the configuration of the file /home/myname/.config/srcphp/config.php: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// copy this file to /home/user/.config/srcphp/config.php return array( 'token' =&gt; 'your token' );</span></span></code> </pre><br>  in the token, you need to enter the token received from oAuth from Yandex, when going through the script generated by launching the script with the --getToken key: <br><br><pre> <code class="bash hljs">$ srcphp --getToken</code> </pre> <br><h3>  findings </h3><br>  The main idea of ‚Äã‚Äãthe article is to consider how to create a console application using php, using the screenshots program as an example. In the following I will raise the topic of using php in various fields of application, and the next article will be devoted to developing a simple usb device driver for linux.  Thank you for your attention and have a nice day. <br><br>  <strong>ps</strong> <a href="https://github.com/lnroma/srcphp/">application source code</a> </div><p>Source: <a href="https://habr.com/ru/post/310694/">https://habr.com/ru/post/310694/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310684/index.html">Freeform real-time speech recognition and call recording recognition</a></li>
<li><a href="../310686/index.html">Launch of Azure Pack Infrastructure cloud from InfoboxCloud</a></li>
<li><a href="../310688/index.html">How we did a search in elasticsearch on vulners.com</a></li>
<li><a href="../310690/index.html">Tarantool: how to save a million dollars on a database on a high-load project</a></li>
<li><a href="../310692/index.html">Review of the best reports from the conference "Around the Cloud"</a></li>
<li><a href="../310696/index.html">On-demand synchronization implementation</a></li>
<li><a href="../310698/index.html">How the server works with a screwdriver in the power supply</a></li>
<li><a href="../310702/index.html">DBMS era of the Internet of things</a></li>
<li><a href="../310704/index.html">Convenient REST for Xamarin Applications</a></li>
<li><a href="../310706/index.html">HTML 5.1 is coming out, HTML 5.2 is being prepared</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>