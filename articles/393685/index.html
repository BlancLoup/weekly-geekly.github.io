<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Homemade scanning laser range finder</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will talk about how I did a homemade laser scanning range finder using the triangulation principle of distance measurement, and abou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Homemade scanning laser range finder</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/getpro/habr/post_images/ec4/80c/d09/ec480cd093da391985a51a4c62c2b3c6.png" alt="image"><br>  In this article I will talk about how I did a homemade laser scanning range finder using the triangulation principle of distance measurement, and about the experience of using it on a robot. </p><a name="habracut"></a><br><h4>  Why do you need a scanning distance? </h4><br><p>  Today there are not so many indoor navigation methods in robotics.  Determining the position of the robot in space using a laser scanner is one of them.  An important advantage of this method is that it does not require the installation of any lighthouses in the room.  Unlike systems that use image recognition from cameras, data processing from a rangefinder is not so resource intensive.  But there is a drawback - the complexity, and accordingly, the price of the rangefinder. <br>  Traditionally, robotics use laser scanners that use the phase or time-of-flight principle to measure the distance to objects.  The implementation of these principles requires a rather complicated circuit design and expensive parts, although the characteristics are decent - using these principles, you can achieve a high scanning speed and long distance measurement. <br>  But for home experiments in robotics such scanners are not very suitable - the price for them starts from $ 1000. <br>  Range finders that use the triangulation principle of measuring distance come to the rescue.  A range finder of this type first appeared in the Neato robotic vacuum cleaners: </p><br><img src="https://habrastorage.org/getpro/geektimes/post_images/2b4/aee/fe2/2b4aeefe2bb2425da44f87ebb5252352.jpg" alt="image"><br><p>  Pretty quickly, amateurs deciphered the protocol of this rangefinder, and began to use it in their projects.  Rangefinders themselves as spare parts appeared on ebay in small quantities for about $ 100.  After a few years, the Chinese company was able to release the RPLIDAR scanning range finder, which was supplied as a complete instrument, not a spare part.  Only the price of these rangefinders was quite high - $ 400. </p><br><h4>  Homemade range finder </h4><br><p>  As soon as I found out about the Neato range finders, I wanted to collect the very same one.  In the end, I succeeded, and I described the assembly process at the <a href="http://roboforum.ru/forum10/topic12095.html">Roboforum</a> . <br>  The first version of the rangefinder: <br> <a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/bdf/cc1/bf8/bdfcc1bf8fd7ec4451ff76730e128e90.jpg" width="300" height="225" title="IMG_2824.JPG" alt="IMG_2824.JPG"></a> </p><br><p>  Later, I made another version of the rangefinder, more suitable for use on a real robot, but its quality of work did not fully suit me.  The time has come for the third version of the rangefinder, and it will be described later. </p><br><h5>  Device for scanning triangulation laser range finder </h5><br><p>  The principle of measuring the distance to an object is based on measuring the angle between a laser beam falling on an object and a rangefinder lens.  Knowing the distance of the laser-lens (h) and the measured angle, you can calculate the distance to the object - the smaller the angle, the greater the distance. <br>  The principle is well illustrated by a picture from the <a href="https://sites.google.com/site/todddanko/home/webcam_laser_ranger">article</a> : </p><br><img src="https://habrastorage.org/getpro/geektimes/post_images/b91/e39/274/b91e3927436e885627e52179a5ed6c70.gif" alt="image"><br><p>  Thus, the key optical components of such a rangefinder are a laser, an objective lens and a photoreceiver bar. <br>  Since the range finder is scanning, then all these parts, as well as the control electronics, are mounted on the rotating head. <br>  There may be a question - why do you need to rotate the optics and electronics, because you can install a rotating mirror?  The problem is that the accuracy of the rangefinder depends on the distance between the lens and the laser (base distance), so it should be quite large.  Accordingly, for a circular scan will need a mirror with a diameter greater than the base distance.  A range finder with such a mirror is quite cumbersome. <br>  Scanning head of a range finder with the help of a bearing is fixed on a fixed base.  It also fixes the engine, rotating the head.  Also in the rangefinder should include an encoder designed to obtain information about the position of the head. <br>  As you can see, the Neato, RPLIDAR range finders and my homemade ones are made according to this scheme. </p><br><p>  The most difficult thing in a homemade range finder is the manufacture of the mechanical part.  It was her work that caused me the most complaints in the early versions of the rangefinder.  The difficulty lies in the manufacture of a scanning head, which must be firmly fixed on the bearing, rotate without a beat and at the same time do not need to transmit electrical signals in any way. <br>  In the second version of the range finder, I solved the first two problems by using parts of the old HDD - the disk itself was used as the base of the scanning head, and the engine on which it was fixed already contained high-quality bearings.  At the same time, a third problem arose - electric lines could only be drawn through a small hole in the engine axis.  I managed to make a homemade brush unit on 3 lines, fixed in this hole, but the resulting design was noisy and unreliable.  In this case, another problem arose: there was no line to forward the encoder signal, and the encoder sensor in such a design must be installed on the head, and the encoder disk with marks on the fixed base.  The encoder disk was not hard, and this often caused problems. <br>  Photo of the second version of the rangefinder: </p><br><img src="https://habrastorage.org/getpro/geektimes/post_images/cb1/932/7e1/cb19327e1a1a8f993924536a72b85cf9.jpg" alt="image"><br><p>  Another disadvantage of the resulting rangefinder is the low scanning speed and a sharp drop in accuracy at distances greater than 3m. <br>  I decided to eliminate these shortcomings in the third version of the rangefinder. </p><br><h4>  Electronics </h4><br><p>  In principle, the electronic part of the triangulation rangefinder is quite simple and contains only two key components - a light sensitive line and a microcontroller.  If there is no problem with choosing a controller, then everything is much more complicated with a ruler.  The photosensitive ruler used in such a rangefinder should simultaneously have a sufficiently high light sensitivity, allow the signal to be read at high speed and have small dimensions.  The various CCD lines used in home scanners are usually quite long.  The rulers used in barcode scanners are also not the shortest and fastest. <br>  In the first and second versions of the rangefinder, I used the TSL1401 line and its analogue iC-LF1401.  These rulers fit well in size, they are cheap, but contain only 128 pixels.  For accurate measurement of distances up to 3 meters this is not enough, and only the possibility of sub-image analysis saves. <br>  In the third version of the range finder, I decided to use the ELIS-1024 line: </p><br><img src="https://habrastorage.org/getpro/geektimes/post_images/e32/aa3/cc3/e32aa3cc33fd94c668c42ba8cca24a41.jpg" alt="image"><br><p> However, it was not easy to buy it.  The main electronics suppliers simply do not have these lines. <br>  The first line I was able to buy on Taobao turned out to be non-working.  The second I bought on Aliexpress (for $ 18), it turned out to be working.  Both rulers looked soldered - both had ironed out contacts and, judging by the markings, were made in 2007.  And even in the photographs of the majority of Chinese sellers of the line are just like that.  It looks like a truly new ELIS-1024 line can only be bought directly from the manufacturer. <br>  The ELIS-1024 photosensitive ruler, as the name suggests, contains 1024 pixels.  It has an analog output, and is rather simply controlled. <br>  The DLIS-2K range has even better characteristics.  With similar sizes, it contains 2048 pixels and has a digital output.  As far as I know, it is used in the Neato rangefinder, and possibly in the RPLIDAR.  However, it is very difficult to find it in free sale, even in Chinese stores it does not appear often and is expensive - more than $ 50. </p><br><p>  Since I decided to use a ruler with an analog output signal, the rangefinder microcontroller should contain a fairly fast ADC.  Therefore, I decided to use a series of controllers - STM32F303, which, at a relatively low cost, have several fast ADCs capable of operating simultaneously. <br>  As a result, I got this scheme: <br> <a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/d4f/541/13c/d4f54113cb1e4c8ca67e33519a825ad8.png" title="IMG_2824.JPG" alt="IMG_2824.JPG"></a> <br>  The signal from the ruler (pin 10) has a fairly high level of the DC component, and it has to be filtered out using a coupling capacitor. <br>  Further, the signal needs to be strengthened - for this, the AD8061 operational amplifier is used.  Far-placed objects give a rather weak signal, so we had to set the gain to 100. <br>  As it turned out as a result of experiments, even in the absence of a signal, at the output of the selected op amp, for some reason, there is always a voltage of about 1.5V, which interferes with the processing of results and degrades the accuracy of measuring the amplitude of the signal.  In order to get rid of this bias, I had to apply additional voltage to the inverting input of the op-amp. </p><br><p>  I made a double-sided board, it is quite difficult to make such a board at home, so I ordered the production of boards in China (I had to order 10 pieces at once): </p><br><img src="https://habrastorage.org/getpro/geektimes/post_images/4ae/7f9/cff/4ae7f9cff0734aa50875c8928be3f8fb.jpg" alt="image"><br><p>  In this rangefinder, I used a cheap M12 threaded lens with a focal length of 16mm.  The lens is mounted on a printed circuit board using a ready-made lens holder (these are used in various cameras). <br>  The laser in this rangefinder is an infrared (780 nm) laser module with a power of 3.5 mW. <br>  Initially, I assumed that the laser radiation would need to be modulated, but later it turned out that there was no point in using the ruler used, and therefore the laser is now turned on all the time. <br>  To test the performance of the electronics, this design was assembled, imitating the scanning head of the rangefinder: </p><br><img src="https://habrastorage.org/getpro/geektimes/post_images/e97/7d4/382/e977d4382b91787773f4901dd254ec05.jpg" alt="image"><br><p>  Already in this form, it was possible to verify the accuracy of the distance measurement that the range finder can provide. <br>  To analyze the signal generated by the ruler, test programs for the microcontroller and PC were written. <br>  An example of the type of signal from the ruler (an object at a distance of 3 m). </p><br><img src="https://habrastorage.org/getpro/geektimes/post_images/d11/d96/41e/d11d9641e9458184b6b554951f76a824.png" alt="image"><br><p>  Initially, the scheme was not quite the same as above.  During the experiments, I had to partially redo the original scheme, so that, as can be seen from the photos, some parts had to be mounted by mounting. </p><br><h4>  Mechanical part </h4><br><p>  After the electronics have been debugged, it is time to make the mechanical part. <br>  This time I did not bother with the mechanics of the HDD, and decided to make the mechanical parts of liquid plastic, poured into silicone mold.  This technology is described in detail on the Internet, including on <a href="https://geektimes.ru/post/255464/">Giktames</a> . <br>  Already after I made the parts, it became clear that it would be easier to make parts on a 3D printer, they could come out harder, and perhaps one piece could be made instead of two.  I do not have access to the 3D printer, so I would have to order the production of parts in any company. <br>  Photo of one of the details of the scanning head of the range finder: </p><br><img src="https://habrastorage.org/getpro/geektimes/post_images/e16/fdd/987/e16fdd98762368127151c2d000763c0e.jpg" alt="image"><br><p>  This part is the basis of the head.  It consists of a sleeve on which the bearing is later put on, and a disk.  The disk is designed for mounting the second part of the tower, in addition, an encoder disk is glued to it from below. <br>  The sleeve and the disk contain a through hole into which a 6-line brush unit is inserted - it can be seen in the photo.  It is the wires that are visible in the photograph that can rotate relative to the body of this node.  To increase the stability of the work, 2 pairs of brush lines are used to transmit GND and UART TX signals.  The remaining 2 lines are used to transmit the supply voltage and the encoder signal. </p><br><p>  Silicone mold for casting this part: </p><br><img src="https://habrastorage.org/getpro/geektimes/post_images/2ce/2b0/d15/2ce2b0d15d6446f4006565445ab3821c.jpg" alt="image"><br><p>  The second part of the scanning head was made in the same way.  It is designed for mounting the circuit board and the laser to the disk.  Unfortunately, I have not survived the photographs of the manufacture of this part, so it can be seen only as part of a rangefinder. </p><br><p>  A ball bearing is used to attach the scanning head to the base of the rangefinder.  I used a cheap Chinese bearing 6806ZZ.  Honestly, I did not like the quality of the bearing - the axis of its inner sleeve could deviate relative to the external axis at a small angle, due to which the rangefinder head also tilts slightly.  Mount the bearing to the part with the disk and the base will be shown below. </p><br><p>  The base I made of transparent plexiglas 5 mm thick.  Bearing, encoder sensor, range finder engine and small printed circuit board are attached to the base.  The base itself is mounted on any suitable surface using racks. <br>  Here is the bottom of the rangefinder base: <br> <a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/749/519/1ab/7495191abec07588984841da4c3177cd.jpg"></a> <br>  The printed circuit board contains an adjustable linear voltage regulator to power the motor, and platforms for connecting the wires of the brush assembly.  This also brings the power rangefinder. <br>  As in other rangefinders, the engine rotates the scanning head using the belt.  In order that he did not fall off the sleeve, it has a special recess. <br>  As can be seen from the photo, the bearing is fixed at the base with three screws.  On the scanning head, the bearing is held by the protrusion on the sleeve and pressed against it by other screws, simultaneously holding the brush assembly. </p><br><p>  The encoder consists of a paper disc with printed risks and an optocoupler with a phototransistor operating in reflection.  The optocoupler is fixed with the help of a stand on the base so that the disk plane is next to it: </p><br><img src="https://habrastorage.org/getpro/geektimes/post_images/246/304/d9c/246304d9c7b20c8fcf48b5f8e210cdff.jpg" alt="image"><br><p>  The signal from the optocoupler through the brush is transmitted to the input of the microcontroller's comparator.  As a source of reference voltage for the comparator is the DAC of the microcontroller. <br>  In order for the range finder to determine the position of the zero angle, a long risk is marked on the encoder disk, which marks the zero position of the head (it is visible on the right in the photo above). </p><br><p>  Here is the assembled rangefinder: <br> <a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/252/0ea/cc8/2520eacc8cb59e0001baf6fe44b0dddf.jpg"></a> <br>  View from above: <br> <a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/0e3/b2b/bea/0e3b2bbeab86d8730d76455dfc861935.jpg"></a> <br>  The connector at the back of the rangefinder is used to flash the microcontroller. <br>  To balance the scanning head, a large nut is installed on the front of it ‚Äî it almost completely eliminates vibration when the head is rotated. </p><br><p>  The assembled rangefinder must be ustyustirovat - set the laser in such a position that the light reflected from the objects hit the photodetector line.  Both plastic parts contain coaxial holes located under the laser groove.  The adjusting screws abutting the laser housing are screwed into the holes.  By turning these screws, you can change the tilt of the laser. <br>  Observing the shape and amplitude of the received signal in a computer program and changing the laser slope, you need to achieve the maximum signal amplitude. <br>  Also, triangulation range finders require calibration, as I <a href="https://habrahabr.ru/post/274879/">wrote earlier</a> : </p><br><blockquote>  In order to use the sensor to measure the distance, it is necessary to calibrate it, i.e.  determine the law relating the result returned by the sensor and the actual distance.  The calibration process itself is a series of measurements, as a result of which a set of distances from the sensor to an object and the corresponding results are formed. </blockquote><p>  In this case, the calibration was a series of measurements of distances to various objects with a homemade range finder and a laser tape measure, after which a regression analysis was performed on the obtained measurement pairs and a mathematical expression was compiled. </p><br><p>  The resulting range finder has a significant drawback - due to the lack of modulation of the laser radiation, it does not work correctly with any strong illumination.  Normal room lighting (even when using a powerful chandelier) does not affect the operation of the rangefinder, but the distance to surfaces directly illuminated by the Sun does not measure the rangefinder correctly.  To solve this problem, the rangefinder must include an interference filter that transmits light only at a specific wavelength - in this case, 780 nm. </p><br><p>  The evolution of homemade range finders: </p><br><img src="https://habrastorage.org/getpro/geektimes/post_images/b9f/572/240/b9f5722400d447f9fa9392c415b34a34.jpg" alt="image"><br><p>  Overall dimensions of the resulting rangefinder: <br>  Size of the basis: 88x110 mm. <br>  The total height of the rangefinder: 65 mm (can be reduced to 55 while reducing the height of the racks). <br>  Scanning head diameter: 80 mm (like a mini-CD disk). </p><br><p>  Like any other triangulation rangefinder, the accuracy of measuring the distance of this rangefinder drops sharply with increasing distance. <br>  When measuring the distance to an object with a reflection coefficient of about 0.7, I had approximately the following accuracy characteristics: </p><br><table><thead><tr><th>  Distance </th><th>  Scatter </th></tr></thead><tbody><tr><td>  1m </td><td>  &lt;1 cm </td></tr><tr><td>  2 m </td><td>  2 cm </td></tr><tr><td>  5 m </td><td>  7 cm </td></tr></tbody></table><br><p>  The cost of manufacturing range finder: </p><br><table><thead><tr><th></th><th>  DIY, $ </th><th>  Opt., $ </th></tr></thead><tbody><tr><td>  <strong>Base</strong> </td><td></td><td></td></tr><tr><td>  Base plate </td><td>  1.00 </td><td>  0.50 </td></tr><tr><td>  Engine </td><td>  0.00 </td><td>  1.00 </td></tr><tr><td>  Bearing </td><td>  1.50 </td><td>  1.00 </td></tr><tr><td>  Brush knot </td><td>  7.50 </td><td>  5.00 </td></tr><tr><td>  Fasteners </td><td>  0.00 </td><td>  2.00 </td></tr><tr><td>  <strong>Scan head</strong> </td><td></td><td></td></tr><tr><td>  STM32F303CBT6 controller </td><td>  5.00 </td><td>  4.00 </td></tr><tr><td>  Photodetector line </td><td>  18.00 </td><td>  12.00 </td></tr><tr><td>  The rest of the electronics </td><td>  4.00 </td><td>  3.00 </td></tr><tr><td>  Pay </td><td>  1.50 </td><td>  0.50 </td></tr><tr><td>  Lens </td><td>  2.00 </td><td>  1.50 </td></tr><tr><td>  Lens holder </td><td>  1.00 </td><td>  0.50 </td></tr><tr><td>  Laser </td><td>  1.00 </td><td>  0.80 </td></tr><tr><td>  Plastic parts </td><td>  3.00 </td><td>  2.00 </td></tr><tr><td>  Fasteners </td><td>  0.00 </td><td>  1.00 </td></tr><tr><td>  <em>Assembly</em> </td><td>  0.00 </td><td>  20.00 </td></tr><tr><td>  <strong>Total:</strong> </td><td>  45.50 </td><td>  54.80 </td></tr></tbody></table><br><p>  In the first column - how much the range finder cost me, in the second - how much it could cost in industrial production (the estimate is <u>very</u> approximate). </p><br><h4>  Rangefinder software </h4><br><p>  Before writing a program, you need to calculate the clock frequency at which the photodetector line will operate. <br>  In older versions of the rangefinder, the scanning frequency was limited to 3 Hz, in the new rangefinder I decided to make it higher - 6Hz (this was taken into account when choosing a ruler).  The range finder makes 360 measurements per revolution, so that at this speed it should be able to perform 2160 measurements per second, that is, one measurement should take less than 460 Œºs.  Each measurement consists of two stages - exposure (accumulation of light with a ruler) and reading data from the ruler.  The faster the signal is read out, the longer the exposure time can be, which means that the greater the amplitude of the signal.  With a clock frequency of 8 MHz, the read time of 1024 pixels will be 128 Œºs, at 6 MHz - 170 Œºs. </p><br><p>  At the clock frequency of the microcontroller of the STM32F303 series at 72 MHz, the maximum sampling rate of the ADC is 6 MSPS (with a conversion bit of 10 bits).  Since I wanted to test the rangefinder at a clock frequency of 8 MHz, I decided to use the ADC mode of operation, in which two ADCs work simultaneously (Dual ADC mode - Interleaved mode).  In this mode, the ADC1 starts up after a signal from an external source, and then, after a configured time, ADC2: </p><br><img src="https://habrastorage.org/getpro/geektimes/post_images/558/87b/0db/55887b0db34d48d690822bf8c94cd12f.png" alt="image"><br><p>  As can be seen from the diagram, the total frequency of ADC samples is two times higher than the trigger frequency (in this case, this is the signal from the TIM1 timer). <br>  At the same time, TIM1 should also generate a clock signal for the photodetector line, synchronous with the ADC samples. <br>  In order to get two signals from one timer with frequencies that differ in two times, you can switch one of the timer channels to TIM_OCMode_Toggle mode, and the second channel should generate a normal PWM signal. </p><br><p>  Block diagram of the rangefinder program: <br> <a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/4a2/f69/345/4a2f693450661d17bd47127f90d2070e.png"></a> </p><br><p>  The key part of the program is to capture data from the ruler and control it.  As can be seen from the diagram, this process goes at the hardware level, due to the joint work of TIM1, ADC1 / 2 and DMA.  To ensure that the exposure time of the ruler is constant, use the timer TIM17, operating in Single Pulse mode. </p><br><p>  Timer TIM3 generates interrupts when the comparator connected to the encoder is triggered.  Due to this, the rotation period of the scanning head of the range finder and its position are calculated.  According to the obtained rotation period, the TIM16 timer period is calculated in such a way that it forms interruptions when the head is turned by 1 degree.  These interruptions are used to start the exposure of the ruler. </p><br><p>  After the DMA transfers all 1024 values ‚Äã‚Äãcaptured by the ADC to the memory of the controller, the program starts analyzing these data: first, the signal maximum position is searched for with a pixel accuracy, then, using the center of gravity search algorithm, with higher accuracy (0.1 pixel ).  The resulting value is stored in an array of results.  After the scanning head makes a complete revolution, at the time of passage of the zero, this array is transmitted to the UART module using another DMA channel. </p><br><h4>  Using a range finder </h4><br><p>  The quality of this rangefinder, as the previous ones, was checked using a self-written program.  Below is an example of the image generated by this program as a result of the work of the rangefinder: <br><img src="https://habrastorage.org/getpro/habr/post_images/314/a3c/ef3/314a3cef39fb208b83d6f0806ac6cba3.png" alt="image"><br>  However, the range finder was not made just to lie on the table - it was installed on the old Roomba 400 vacuum cleaner instead of the second version range finder: <br> <a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/ab8/36f/6d8/ab836f6d846220f44d50d2785dd3cc2b.jpg"></a> <br>  Also, the robot has an Orange Pi PC computer designed to control and communicate with the robot. <br>  As it turned out, due to the large voltage drop on the linear power source of the engine of the rangefinder, the rangefinder requires a supply voltage of 6V to operate at a speed of 6 revolutions per second.  Therefore, the Orange Pi and range finder are powered by separate DC-DC converters. </p><br><p>  I use <a href="http://www.ros.org/">ROS</a> to control the robot and analyze data from the range finder. <br>  The data from the rangefinder are processed by a special ROS driver (based on the Neato rangefinder driver), which receives data from the rangefinder via UART, recalculates them to distances to objects (using calibration data) and publishes them in the standard ROS format. <br>  Here is the information obtained in rviz (ROS data visualization software), the robot is installed on the floor: <br><img src="https://habrastorage.org/getpro/habr/post_images/d1d/c66/8f1/d1dc668f1978eafbfedd170a2c422d01.png" alt="image"><br>  The length of the side of the cage is 1 meter. </p><br><p>  After the data got into ROS, they can be processed using ready-made software packages.  In order to build an apartment map, I used <a href="http://wiki.ros.org/hector_slam">hector_slam</a> .  For reference: SLAM is a method for simultaneously building a map of a terrain and determining the position of a robot on it. <br>  An example of the resulting apartment map (the form is somewhat unusual, because the range finder ‚Äúsees‚Äù furniture, not walls, and not all rooms are shown): <br> <a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/d0d/f90/5a4/d0df905a464449d4ba3076c4df390a4a.png"></a> <br>  ROS allows you to combine several programs ("nodes" in the terminology of ROS) working on different computers into a single system.  Due to this, on Orange Pi you can only run Roomba and rangefinder ROS drivers, and analyze the data and control the robot from another computer.  At the same time, experiments have shown that hector_slam works normally on Orange Pi, acceptably loading the processor, so it‚Äôs quite realistic to organize a completely autonomous operation of the robot. </p><br><p>  The SLAM system, thanks to data from the rangefinder, allows the robot to determine its position in space.  Using data on the position of the robot and the constructed map, you can organize a navigation system that allows you to "send" the robot to a specified point on the map.  ROS contains a software package for this task, but, unfortunately, I could not get it to work properly. </p><br><p>  Video of the rangefinder: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/4vZgepiK1K4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  More detailed video of building a map using hector_slam: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ExPeRsx6MS4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  <a href="https://github.com/iliasam/DIY_laser_lidar">Source code of the controller program</a> </p><br><p>  PS I also have a <a href="https://github.com/iliasam/OpenSimpleLidar">project of a simpler lidar</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/393685/">https://habr.com/ru/post/393685/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../393675/index.html">EchoPixel Augmented Reality allows doctors to examine patients' organs in 3D</a></li>
<li><a href="../393677/index.html">ISP fined for refusing to accept World cards that do not exist</a></li>
<li><a href="../393679/index.html">Gamers to the fun, toad to perdition: ASUS G20CB</a></li>
<li><a href="../393681/index.html">In Russia, developed a "James Bond small suitcase" with a GSM jammer</a></li>
<li><a href="../393683/index.html">Paramount Pictures are suing Klingon defenders from Star Trek</a></li>
<li><a href="../393687/index.html">The work of the Large Hadron Collider had to be suspended because of the ferret</a></li>
<li><a href="../393689/index.html">Video landing SpaceX Falcon 360</a></li>
<li><a href="../393691/index.html">Recommended update KB3133977 disables some Windows 7 x64 computers.</a></li>
<li><a href="../393693/index.html">Google draws up a patent for the introduction of a computer in the eye</a></li>
<li><a href="../393695/index.html">Hybrid nanoantennas - a new platform for superdense recording of information and the creation of next-generation nanodevices</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>