<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Forchun algorithm, implementation details</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For the past few weeks, I've been working on implementing the Forchun algorithm in C ++. This algorithm takes a lot of 2D-points and builds a Voronoi ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Forchun algorithm, implementation details</h1><div class="post__text post__text-html js-mediator-article">  For the past few weeks, I've been working on implementing <a href="https://en.wikipedia.org/wiki/Fortune%2527s_algorithm">the Forchun algorithm</a> in C ++.  This algorithm takes a lot of 2D-points and builds <a href="https://en.wikipedia.org/wiki/Voronoi_diagram">a Voronoi diagram</a> from them.  If you do not know what a Voronoi diagram is, then take a look at the figure: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/50c/df1/56c/50cdf156cb6f5ce5e73ad6308be52dfb.png"></div><br>  For each entry point, which is called a ‚Äúsite‚Äù (site), we need to find a set of points that are closer to this place than to all the others.  Such sets of points form cells, which are shown in the image above. <br><br>  It is noteworthy in the Fortune‚Äôs algorithm that it builds such diagrams over time. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2">O</span><span class="MJXp-mo" id="MJXp-Span-3" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4">n</span><span class="MJXp-mtext" id="MJXp-Span-5">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-6">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-8">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-9">n</span><span class="MJXp-mo" id="MJXp-Span-10" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.89ex" height="2.66ex" viewBox="0 -832 4258 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMATHI-4F" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-28" x="763" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMATHI-6E" x="1153" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMATHI-6C" x="2003" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMATHI-6F" x="2302" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMATHI-67" x="2787" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMATHI-6E" x="3268" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-29" x="3868" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-1"> O (n \ log n) </script>  (which is optimal for the comparison algorithm), where <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-11"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12">n</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.455ex" viewBox="0 -520.7 600.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMATHI-6E" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> n </script>  - this is the number of places. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I am writing this article because I consider the implementation of this algorithm a very difficult task.  At the moment it is the most difficult of the algorithms that I had to implement.  Therefore, I want to share the problems that I encountered and how to solve them. <br><br>  As usual, the code is posted on <a href="https://github.com/pvigier/FortuneAlgorithm">github</a> , and all the references I used are listed at the end of the article. <br><a name="habracut"></a><br><h1>  Fortune's algorithm description </h1><br>  I will not explain how the algorithm works, because other people have already done it well.  I can recommend to study these two articles: <a href="http://blog.ivank.net/fortunes-algorithm-and-implementation.html">here</a> and <a href="https://jacquesheunis.com/post/fortunes-algorithm/">here</a> .  The second one is very curious - the author wrote an interactive Javascript demo, which is useful for understanding the operation of the algorithm.  If you need a more formal approach with all the evidence, I recommend reading Chapter 7 of the book <a href="http://www.cs.uu.nl/geobook/"><em>Computational Geometry, 3rd edition</em></a> . <br><br>  Moreover, I prefer to deal with implementation details that are not well documented.  And they make the implementation of the algorithm so complicated.  In particular, I will focus on the data structures used. <br><br>  I just wrote the pseudo-code of the algorithm so that you get an idea of ‚Äã‚Äãits global structure: <br><br><blockquote><pre>  we add event of place to queue of events for each place
 until the event queue is empty
     extract the top event
     if the event is a place event
         insert a new arc into the coastline
         check for new events of circles
     otherwise
         create a vertex in the diagram
         remove from the coastline constricted arc
         delete invalid events
         check for new events of circles </pre></blockquote><br><h1>  Chart data structure </h1><br>  The first problem I encountered was the choice of how to store the Voronoi diagram. <br><br>  I decided to use a data structure that is widely used in computational geometry, which is called a doubly connected edge list (DCEL). <br><br>  My <code>VoronoiDiagram</code> class uses four containers as fields: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VoronoiDiagram</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-comment"><span class="hljs-comment">// ... private: std::vector&lt;Site&gt; mSites; std::vector&lt;Face&gt; mFaces; std::list&lt;Vertex&gt; mVertices; std::list&lt;HalfEdge&gt; mHalfEdges; }</span></span></code> </pre> <br>  I will tell you in detail about each of them. <br><br>  The <code>Site</code> class describes the entry point.  Each place has an index, which is useful for placing it in the queue, coordinates and a pointer to the cell ( <code>face</code> ): <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Site</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> index; Vector2 point; Face* face; };</code> </pre> <br>  The vertices of the cell are represented by the <code>Vertex</code> class, they have only a coordinate field: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Vertex</span></span></span><span class="hljs-class"> {</span></span> Vector2 point; };</code> </pre> <br>  Here is the implementation of the semi-sorbers <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HalfEdge</span></span></span><span class="hljs-class"> {</span></span> Vertex* origin; Vertex* destination; HalfEdge* twin; Face* incidentFace; HalfEdge* prev; HalfEdge* next; };</code> </pre> <br>  You may be wondering - what is half the floor?  The edge in the Voronoi diagram is common to two adjacent cells.  In the DCEL data structure, we divide these edges into two half-edges, one for each cell, and they are linked by a <code>twin</code> pointer.  Moreover, the half-edge has a starting point and an ending point.  The <code>incidentFace</code> field points to the edge that owns half-edge.  Cells in DCEL are implemented as a cyclic, doubly linked list of semi-edges, in which adjacent semi-links are joined together.  Therefore, the <code>prev</code> and <code>next</code> fields indicate the previous and next semi-contours in the cell. <br><br>  The figure below shows all these fields for the red half-rim: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/459/a46/ac3/459a46ac330ea630a58cb69d083a2a61.svg"></div><br>  Finally, the <code>Face</code> class sets the cell.  It simply contains a pointer to its place and another one to one of its semi-ribs.  It does not matter which of the semi-edges is chosen, because the cell is a closed polygon.  Thus, we get access to all semi-cursors when traversing a cyclic linked list. <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Face</span></span></span><span class="hljs-class"> {</span></span> Site* site; HalfEdge* outerComponent; };</code> </pre> <br><h1>  Event queue </h1><br>  The standard way to implement an event queue is a priority queue.  During the processing of the place and circle events, we may need to remove the circle events from the queue, because they are no longer valid.  But most of the standard implementations of the priority queue do not allow deleting an element that is not on top.  In particular, this also applies to <code>std::priority_queue</code> . <br><br>  This problem can be solved in two ways.  The first, simpler one is to add the <code>valid</code> flag to the events.  Initially <code>valid</code> is <code>true</code> .  Then instead of removing the circle event from the queue, we can simply set its flag to <code>false</code> .  Finally, when processing all events in the main loop, we check if the value of the <code>valid</code> event flag is <code>false</code> , and if so, then just skip it and process the following. <br><br>  The second method that I applied is not to use <code>std::priority_queue</code> .  Instead, I implemented my own priority queue, which supports deleting any element it contains.  The implementation of such a queue is quite simple.  I chose this method because it makes the code of the algorithm cleaner. <br><br><h1>  Coastline </h1><br>  The shoreline data structure is a complex part of the algorithm.  In case of incorrect implementation, there are no guarantees that the algorithm will be executed in <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-13"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14">O</span><span class="MJXp-mo" id="MJXp-Span-15" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-16">n</span><span class="MJXp-mtext" id="MJXp-Span-17">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-18">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-19">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-21">n</span><span class="MJXp-mo" id="MJXp-Span-22" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.89ex" height="2.66ex" viewBox="0 -832 4258 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMATHI-4F" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-28" x="763" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMATHI-6E" x="1153" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMATHI-6C" x="2003" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMATHI-6F" x="2302" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMATHI-67" x="2787" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMATHI-6E" x="3268" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-29" x="3868" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-3"> O (n \ log n) </script>  .  The key to obtaining such a time complexity is the use of a self-balancing tree.  But it is easier said than done! <br><br>  In most of the resources I have studied (the two above-mentioned articles and the book of <em>Computational Geometry</em> ), it is advised to implement the coastline as a tree, in which the internal nodes indicate break points, and the leaves indicate arcs.  But they say nothing about how to balance a tree.  I think that such a model is not the best, and this is why: <br><br><ul><li>  there is redundant information in it: we know that there is a break point between two adjacent arcs, so it‚Äôs not necessary to represent these points as nodes </li><li>  it is inadequate for self-balancing: only a subtree formed by break points can be balanced.  We really cannot balance the entire tree, because otherwise the arcs can become internal knots and leaves of break points.  Writing an algorithm for balancing only a subtree formed by internal nodes seems to me a nightmarish task. </li></ul><br>  Therefore, I decided to present the coastline differently.  In my implementation, the coastline is also a tree, but all nodes denote arcs.  Such a model has none of the listed disadvantages. <br><br>  Here is the definition of arc arc in my implementation: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arc</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Color</span></span></span><span class="hljs-class">{</span></span>RED, BLACK}; <span class="hljs-comment"><span class="hljs-comment">// Hierarchy Arc* parent; Arc* left; Arc* right; // Diagram VoronoiDiagram::Site* site; VoronoiDiagram::HalfEdge* leftHalfEdge; VoronoiDiagram::HalfEdge* rightHalfEdge; Event* event; // Optimizations Arc* prev; Arc* next; // Only for balancing Color color; };</span></span></code> </pre> <br>  The first three fields are used for tree structure.  The <code>leftHalfEdge</code> field indicates a half-edge drawn by the leftmost point of the arc.  And <code>rightHalfEdge</code> - on a half-edge, drawn by the extreme right point.  The two pointers, <code>prev</code> and <code>next</code> are used to get direct access to the previous and next coastline.  In addition, they also allow you to bypass the shoreline as a two-linked list.  Finally, each arc has a color that is used to balance the shoreline. <br><br>  To balance the coastline, I decided to use the <a href="https://en.wikipedia.org/wiki/Red%25E2%2580%2593black_tree">red-black scheme</a> .  When writing code, I was inspired by the book <a href="https://en.wikipedia.org/wiki/Introduction_to_Algorithms">Introduction to Algorithms</a> .  Chapter 13 describes two interesting algorithms, <code>insertFixup</code> and <code>deleteFixup</code> , which balance the tree after it is inserted or deleted. <br><br>  However, I cannot use the <code>insert</code> method described in the book, because keys are used to find the place to insert the node.  There are no keys in the Forchun algorithm, we only know that we need to insert an arc before or after another into the coastline.  To implement this, I created the <code>insertBefore</code> and <code>insertAfter</code> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Beachline::insertBefore(Arc* x, Arc* y) { <span class="hljs-comment"><span class="hljs-comment">// Find the right place if (isNil(x-&gt;left)) { x-&gt;left = y; y-&gt;parent = x; } else { x-&gt;prev-&gt;right = y; y-&gt;parent = x-&gt;prev; } // Set the pointers y-&gt;prev = x-&gt;prev; if (!isNil(y-&gt;prev)) y-&gt;prev-&gt;next = y; y-&gt;next = x; x-&gt;prev = y; // Balance the tree insertFixup(y); }</span></span></code> </pre> <br>  Insert <code>y</code> in front of <code>x</code> in three steps: <br><br><ol><li>  Find a place to insert a new node.  To do this, I used the following observation: the left child element <code>x</code> or the right child element <code>x-&gt;prev</code> is <code>Nil</code> , and the one that is equal to <code>Nil</code> is before <code>x</code> and after <code>x-&gt;prev</code> . </li><li>  Inside the coastline, we maintain the structure of a doubly linked list, so we must update the <code>prev</code> and <code>next</code> pointers of the elements <code>x-&gt;prev</code> , <code>y</code> and <code>x</code> accordingly. </li><li>  Finally, we simply call the <code>insertFixup</code> method described in this book to balance the tree. </li></ol><br>  <code>insertAfter</code> is implemented similarly. <br><br>  The removal method taken from the book can be implemented without changes. <br><br><h1>  Chart Restriction </h1><br>  Here is the output of the Forchun algorithm described above: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed5/c3f/443/ed5c3f4438b59de6c99e1645effe0be6.png"></div><br>  There is a small problem with some edges of cells on the border of the image: they are not drawn, because they are infinite. <br><br>  Worse, the cell may not be one fragment.  For example, if we take three points that are on one straight line, then the middle point will have two infinite half-edges that are not connected together.  This is not very convenient for us, because we will not be able to access one of the semi-edges, because the cell is a linked list of edges. <br><br>  To solve these problems, we will restrict the chart.  By this I mean that we will limit each cell of the diagram so that they no longer have infinite edges and each cell is a closed polygon. <br><br>  Fortunately, the Forchun algorithm allows us to quickly find infinite edges: they correspond to the semi-ridges that are still on the coastline by the end of the algorithm. <br><br>  My restriction algorithm receives a rectangle (box) as input and consists of three steps: <br><br><ol><li>  It provides placement of each vertex of the chart inside the rectangle. </li><li>  Cuts off every infinite edge. </li><li>  Closes the cell. </li></ol><br>  Stage 1 is trivial - we just need to expand the rectangle if it does not contain a vertex. <br><br>  Stage 2 is also quite simple - it consists of calculating the intersections between the rays and the rectangle. <br><br>  Stage 3 is also not very complicated, only requires care.  I do it in two stages.  First, I add the points of the corners of the rectangle to the cells at the vertices of which they should be.  Then I make it so that all the vertices of the cell are connected by semi-spans. <br><br>  I recommend to study the code and ask questions if you need details about this part. <br><br>  Here is the output diagram of the limiting algorithm: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/33f/910/a79/33f910a79c155bd8a395fca1fd590a72.png"></div><br>  Now we see that all edges are drawn.  And if you scale down, you can make sure that all cells are closed: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f08/402/6a6/f084026a6afbf57b142a60e5cbc49edc.png"></div><br><h1>  Intersection with a rectangle </h1><br>  Fine!  But the first image from the beginning of the article is better, right? <br><br>  In many applications it is useful to have an intersection between the Voronoi diagram and the rectangle, as shown in the first image. <br><br>  The good news is that after limiting the diagram, it is much easier to do this.  The bad thing is that although the algorithm is not very complicated, we need to be careful. <br><br>  The idea is as follows: we go around its semi-contour of each cell and check the intersection between the half-rim and the rectangle.  Five cases are possible: <br><br><ol><li>  The semi-edge is completely inside the rectangle: we save that semi-edge </li><li>  The semi-edge is completely outside the rectangle: we drop that semi-edge </li><li>  The semi-cube comes out of the rectangle: we truncate the semi-cube and save it as the <em>last semi-cut that went outside</em> . </li><li>  The semi-edge goes inside the rectangle: we truncate the semi-edge to link it to the <em>last half-edge that went outside</em> (we save it in case of 3 or 5) </li><li>  The semi-cube intersects the rectangle twice: we truncate the semi-cube and add a semi-bent to link it with the <em>last half-brim that went outside</em> , and then save it as a new <em>last semi-brittle that went outside</em> . </li></ol><br>  Yes, there are many cases.  I created a picture to show them all: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/412/368/3f1/4123683f10d59989d879315f2f83ae17.svg"></div><br>  The orange polygon is the source cell, and the red polygon is the truncated cell.  Truncated semi-ribs are marked in red.  Green edges are added to link the semi-ribs that enter the rectangle with the semi-ribs that go outside. <br><br>  Applying this algorithm to the restricted diagram, we get the expected result: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/50c/df1/56c/50cdf156cb6f5ce5e73ad6308be52dfb.png"></div><br><h1>  Conclusion </h1><br>  The article was quite long.  And I am sure that many aspects are still not clear to you.  However, I hope it will be useful to you.  Examine the code to get the details. <br><br>  To summarize and make sure that we did not waste time in vain, I measured on my (cheap) laptop the time to calculate the Voronoi diagram for a different number of places: <br><br><ul><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-23"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24">n</span><span class="MJXp-mo" id="MJXp-Span-25" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-26">1000</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.143ex" height="1.937ex" viewBox="0 -728.2 3936.6 834" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMATHI-6E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-3D" x="878" y="0"></use><g transform="translate(1934,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-30" x="1001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-30" x="1501" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-4"> n = 1000 </script>  : 2 ms </li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-27"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28">n</span><span class="MJXp-mo" id="MJXp-Span-29" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-30"><span class="MJXp-mo" id="MJXp-Span-31" style="margin-left: 0em; margin-right: 0em;">$</span></span><span class="MJXp-mn" id="MJXp-Span-32">10</span><span class="MJXp-mo" id="MJXp-Span-33" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-34">00</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.339ex" height="2.539ex" viewBox="0 -832 4882.2 1093.4" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMATHI-6E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-3D" x="878" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-24" x="1934" y="0"></use><g transform="translate(2435,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-2C" x="3436" y="0"></use><g transform="translate(3881,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-30" x="500" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-5"> n = $ 10,00</script>  : 33 ms </li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-35"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-36">n</span><span class="MJXp-mo" id="MJXp-Span-37" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-38"><span class="MJXp-mo" id="MJXp-Span-39" style="margin-left: 0em; margin-right: 0em;">$</span></span><span class="MJXp-mn" id="MJXp-Span-40">100</span><span class="MJXp-mo" id="MJXp-Span-41" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-42">00</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.502ex" height="2.539ex" viewBox="0 -832 5382.7 1093.4" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMATHI-6E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-3D" x="878" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-24" x="1934" y="0"></use><g transform="translate(2435,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-2C" x="3936" y="0"></use><g transform="translate(4381,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-30" x="500" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-6"> n = $ 100,00</script>  : 450 ms </li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-43"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44">n</span><span class="MJXp-mo" id="MJXp-Span-45" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-46"><span class="MJXp-mo" id="MJXp-Span-47" style="margin-left: 0em; margin-right: 0em;">$</span></span><span class="MJXp-mn" id="MJXp-Span-48">1</span><span class="MJXp-mo" id="MJXp-Span-49" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-50">000</span><span class="MJXp-mo" id="MJXp-Span-51" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-52">00</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="14.698ex" height="2.539ex" viewBox="0 -832 6328.4 1093.4" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMATHI-6E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-3D" x="878" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-24" x="1934" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-31" x="2435" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-2C" x="2935" y="0"></use><g transform="translate(3380,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-2C" x="4882" y="0"></use><g transform="translate(5327,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/430628/&amp;xid=17259,1500003,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhpSncKFa6G3Qwngzk91qMwLCQyAQ#MJMAIN-30" x="500" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-7"> n = $ 1,000,00</script>  : 6600 ms </li></ul><br>  I have nothing to compare these figures with, but it seems that this is incredibly fast! <br><br><h1>  Reference materials </h1><br><ul><li>  <a href="http://www.wias-berlin.de/people/si/course/files/Fortune87-SweepLine-Voronoi.pdf">Original article by Stephen Forchun</a> </li><li>  <a href="http://www.cs.uu.nl/geobook/"><em>Computational Geometry, 3rd Edition</em></a> by Mark de Berg, Otfried Cheong, Marc van Kreveld and Mark Overmars </li><li>  <a href="https://jacquesheunis.com/post/fortunes-algorithm/">Fortunes Algorithm: An intuitive explanation</a> on jacquesheunis.com </li><li>  <a href="http://blog.ivank.net/fortunes-algorithm-and-implementation.html">Fortune's algorithm and implementation</a> on blog.ivank.net </li><li>  H. Cormen, Charles E. Leiserson, Ronald L. Rivest and Clifford Stein </li></ul></div><p>Source: <a href="https://habr.com/ru/post/430628/">https://habr.com/ru/post/430628/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../430616/index.html">Workshop "Testing and Monitoring", November 27, Moscow</a></li>
<li><a href="../430618/index.html">Vue.js SSR & Mobile Safari: Unobvious Problem With Too Smart Software</a></li>
<li><a href="../430620/index.html">Functional thinking. Part 4</a></li>
<li><a href="../430622/index.html">Functional thinking. Part 5</a></li>
<li><a href="../430626/index.html">Announcement of Moscow GraphQL Meetup</a></li>
<li><a href="../430630/index.html">Comparison sneak "Two Balls" from the 60s and 2016. From the sole to the laces</a></li>
<li><a href="../430634/index.html">Creating a software module for the programmer XELTEK SuperPro 6100</a></li>
<li><a href="../430636/index.html">Cerebellum and basal nuclei instead of a crystal ball: how the brain predicts the future</a></li>
<li><a href="../430640/index.html">Red Sea: why Apple and other technology companies are falling</a></li>
<li><a href="../430642/index.html">The direction of "Photonics" at the Olympiad "I am a professional", or how to enter the magistracy without exams</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>