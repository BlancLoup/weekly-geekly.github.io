<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Practice Mikrotik settings for dummies</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="UPD: 01/08/2018 

 There is a task: to configure the device based on RouterOS as a replacement for the SOHO router for a home or small office. This is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Practice Mikrotik settings for dummies</h1><div class="post__text post__text-html js-mediator-article">  <b>UPD: 01/08/2018</b> <br><br>  There is a task: to configure the device based on RouterOS as a replacement for the SOHO router for a home or small office.  This is a HOWTO, because there will be a minimum of technical details, Next-Next-Next-Ok and you get a device ready for operation, so let's get started. <br><a name="habracut"></a><br><h3>  Training </h3><br>  Everything described has been tested on RouterBOARD RB 951G-2HnD, but can serve as an instruction for configuring any device based on RouterOS 6.25 and higher.  To configure the device, you will need a proprietary <a href="">winbox</a> utility (for windows), or mactelnet-client (for linux), of course RouterOS has telnet / http / ssh, but for now let's forget about them. <br><br>  We connect the PC to the fifth port of Mikrotik (in general, you can use any except the first one), turn the device over and see the mac address range on the sticker with the bar code, the latter refers to the fifth port, enter it into the winbox connection window, or use it as a mactelnet argument.  User admin, password is missing. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A suggestion appears: save the base configuration, or reset the device.  Select <b>[Remove Configuration]</b> .  The device will reboot. <br><br><img height="338" src="https://habrastorage.org/getpro/habr/post_images/d3b/feb/ad9/d3bfebad92e297c3cee8bf2e41f7aa32.png" title="Reset" width="462"><br><br><h3>  Add user </h3><br>  First of all, we create a new user and delete the admin, but everybody forgets about it. <br><br>  Moving on: <b>[System] ‚ûô [Users] ‚ûô [+]</b> . <br>  Name: <i>login</i> ; <br>  Group: full (full access); <br>  Password: <i>password</i> ; <br>  Confirm Password: <i>Password again</i> . <br>  Confirm by clicking on <b>[Ok]</b> . <br>  In the table with users, select admin and press <b>[]</b> . <br><br><img height="503" src="https://habrastorage.org/getpro/habr/post_images/b15/48c/8cc/b1548c8cc4eeae791e1ea822eb29797f.png" title="Create user" width="739"><br><br><img height="503" src="https://habrastorage.org/getpro/habr/post_images/3bb/004/1eb/3bb0041ebce0baab6551c6210efe70d4.png" title="Remove admin" width="739"><br><div class="spoiler">  <b class="spoiler_title">Console version</b> <div class="spoiler_text"><pre><code class="hljs pgsql">/<span class="hljs-keyword"><span class="hljs-keyword">user</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>= <span class="hljs-keyword"><span class="hljs-keyword">group</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">full</span></span> <span class="hljs-keyword"><span class="hljs-keyword">password</span></span>= /<span class="hljs-keyword"><span class="hljs-keyword">user</span></span> remove <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span></code> </pre> <br></div></div><br>  Disconnect and go to the device under the new user. <br><br><h3>  Provider setting </h3><br>  The provider will connect to the first port of RouterBOARD, the other four and the wireless interface are assigned to the home subnet 192.168.10.0/24, the router's address in the home subnet is 192.168.10.1, the network clients will receive addresses from the range 192.168.10.100-192.168.10.200. <br><br>  There are various ways to connect to the provider, and if we have Ethernet at the physical level (even if it comes from an xDLS modem), then IPoE (Static or DHCP), PPPoE, L2TP, PPTP or a combination of them (generally PPTP, L2TP without configured IP will not work), in addition to everything, there may be a binding to the mac address.  I will try to consider the most frequent cases. <br><br>  But first, rename the ether1 interface to eth1-wan, for convenience: <b>[Interfaces] ‚ûô [Ether1] ‚ûô [Name: eth1-wan] ‚ûô [OK]</b> . <br><br><img height="517" src="https://habrastorage.org/getpro/habr/post_images/9f4/9cf/fe2/9f49cffe2490f5e9d945a87d8d2d79cc.png" title="Rename ether1 to eth1-wan" width="753"><br><br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs delphi">/<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> ethernet <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether1] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth1-wan</code> </pre><br></div></div><br>  We connect the provider cable to the first port of the device. <br><br><h4>  Mac address spoofing </h4><br>  Not to say that all providers use mac bindings, but they are quite common, especially if you use IPoE to bind IPs and protect against freeloaders. <br><br>  Substitution can only be done through command mode, so click <b>[New Terminal]</b> and enter: <br><pre> <code class="hljs kotlin">/<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ethernet</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">set</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">eth1</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wan</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mac</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">address</span></span></span><span class="hljs-class">=00:</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">11:22:33:44:55</span></span></span></span></code> </pre><br>  where 00: 11: 22: 33: 44: 55 - mac reserved by the provider. <br><br><h4>  Automatically receive settings using DHCP. </h4><br>  The simplest option: <b>[IP] ‚ûô [DHCP Client] ‚ûô [+] ‚ûô [Interface: eth1-wan] ‚ûô [OK]</b> . <br><br><img height="532" src="https://habrastorage.org/getpro/habr/post_images/4e4/2af/6e6/4e42af6e6bb8b8903f221ed4a27c7421.png" title="Configure dhcp client" width="753"><br><br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">/ip dhcp-client <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> interface eth1-wan disabled=<span class="hljs-keyword"><span class="hljs-keyword">no</span></span></code> </pre><br></div></div><br><br><h4>  Static IP Configuration </h4><br>  Also a simple option, but you will need to clarify the following parameters with the provider (the value is indicated as an example): <br>  IP (ip address): 192.0.2.10; <br>  mask: 255.255.255.0 (or / 24); <br>  gateway: 192.0.2.1; <br>  DNS1: 192.0.2.2; <br>  DNS2: 192.0.2.3. <br>  Add IP to the interface: <b>[IP] ‚ûô [Addresses] ‚ûô [+] ‚ûô [Address: 192.0.2.10/255.255.255.0;</b>  <b>Interface: eth1-wan] ‚ûô [OK]</b> ; <br>  Add default route: <b>[IP] ‚ûô [Routes] ‚ûô [+] ‚ûô [Dst.Address: 0.0.0.0/0;</b>  <b>Gateway: 192.0.2.1;</b>  <b>Check gateway: ping;</b>  <b>Distance: 1] ‚ûô [OK]</b> ; <br>  Add DNS: <b>[IP] ‚ûô [DNS] ‚ûô [Servers: 192.0.2.2;</b>  <b>192.0.2.3] ‚ûô [OK]</b> . <br><br><img height="532" src="https://habrastorage.org/getpro/habr/post_images/a5d/e91/901/a5de91901c5e9ca1f1d409ee2cd1cce5.png" title="IP setting" width="752"><br><br><img height="532" src="https://habrastorage.org/getpro/habr/post_images/6d5/149/d86/6d5149d86a68780d179054dc35569689.png" title="Default route setup" width="909"><br><br><img height="532" src="https://habrastorage.org/getpro/habr/post_images/910/e5f/bb3/910e5fbb3a5a5d48718b33b09d664704.png" title="DNS setup" width="806"><br><br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs cs">/ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">192.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span>/<span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth1-wan /ip route <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> dst-address=<span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> gateway=<span class="hljs-number"><span class="hljs-number">192.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> check-gateway=ping distance=<span class="hljs-number"><span class="hljs-number">1</span></span> /ip dns <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> servers=<span class="hljs-number"><span class="hljs-number">192.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>,<span class="hljs-number"><span class="hljs-number">192.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span></code> </pre><br></div></div><br><br><h4>  PPPoE setup </h4><br>  PPPoE is a tunnel protocol that does not require IP preconfiguration.  <i>Of course, the provider may have peering with other networks or access to its network without speed limits that work outside the PPPoE interface and require the addition of a separate route (DualAccess or Russian PPPoE in SOHO routers), but this configuration is beyond the scope of HOWTO for beginners.</i> <br><br>  To configure PPPoE, you will need to know the login and password to connect to the network (usually issued when entering into an agreement). <br><br>  Add a tunnel interface: <b>[PPP] ‚ûô [+] ‚ûô [PPPoE Client]</b> . <br><br>  On the <b>[Genaral]</b> tab, specify the interface name <b>Name = tap1-wan</b> and the interface interface <b>Interface = eth1-wan</b> . <br><br>  On the <b>[Dial Out]</b> tab, we specify the login and password for the connection, the other options on the screenshots. <br><br><img height="532" src="https://habrastorage.org/getpro/habr/post_images/3b6/789/3a0/3b67893a0a395b3d2f96d8431ee8e590.png" title="PPPoE Configuration: Genaral" width="808"><br><br><img height="473" src="https://habrastorage.org/getpro/habr/post_images/f1d/533/0f2/f1d5330f21a0649bf865e651513db8c8.png" title="PPPoE Configuration: Dial Out" width="416"><br><br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">/interface pppoe-client <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> interface=eth1-wan <span class="hljs-type"><span class="hljs-type">name</span></span>=tap1-wan disabled=<span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>= <span class="hljs-keyword"><span class="hljs-keyword">password</span></span>= use-peer-dns=yes <span class="hljs-keyword"><span class="hljs-keyword">add</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-route=yes <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-route-distance=<span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br></div></div><br>  <u>Important: If you are using PPPoE, then in the future, use the tap1-wan interface instead of eth1-wan.</u> <br><br><h4>  Configure L2TP / PPTP </h4><br>  Here we come to the richest pitfalls connection method.  Both protocols are configured in a similar way, but they require IP pre-configuration (using DHCP or statically).  The problem with mikrotik is that by specifying the address of the server with a domain name, it recognizes it into the address once and will only use this address, if the address changes (or the provider uses RoundRobin DNS and the server is overloaded), then it is likely to remain without the Internet.  From the provider side, there can also be funny things, for example, DNS servers available only from the local network, or the need to pre-register a static route to the PPTP / L2TP server, if you are lucky enough to become a client of a yellow-striped provider, you can safely download and study the corresponding <a href="http://routerz.ru/wp-content/uploads/2014/03/%25D0%2598%25D0%25BD%25D1%2581%25D1%2582%25D1%2580%25D1%2583%25D0%25BA%25D1%2586%25D0%25B8%25D1%258F-%25D0%25BF%25D0%25BE-%25D0%25BA%25D0%25BE%25D0%25BD%25D1%2584%25D0%25B8%25D0%25B3%25D1%2583%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258E-Mikrotik-RouterOS-%25D0%25B4%25D0%25BB%25D1%258F-%25D1%2580%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2582%25D1%258B-%25D0%25B2-%25D1%2581%25D0%25B5%25D1%2582%25D0%25B8-%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B5%25D1%2580%25D0%25BD%25D0%25B5%25D1%2582-%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25B9%25D0%25B4%25D0%25B5%25D1%2580%25D0%25B0-%25D0%259A%25D0%25BE%25D1%2580%25D0%25B1%25D0%25B8%25D0%25BD%25D0%25B0-%25D0%25A2%25D0%25B5%25D0%25BB%25D0%25B5%25D0%25BA%25D0%25BE%25D0%25BC-%25D0%2591%25D0%25B8%25D0%25BB%25D0%25B0%25D0%25B9%25D0%25BD-07.07.2011.pdf">instructions</a> .  Option with DualAccess L2TP / PPTP is also possible. <br><br>  But we will assume that everything is fine with you, you received the IP address by means of DHCP, check with your provider: login, password and vpn server, you can proceed to setup. <br><br>  Add PPTP / L2TP interface: <b>[PPP] ‚ûô [+] ‚ûô [PPTP Client or L2TP Client]</b> . <br>  On the <b>[General]</b> tab, specify the name of the connection: <b>Name = tun1-wan</b> . <br>  On the <b>[Dial out]</b> tab, we specify the PPTP or L2TP server, login and password. <br><img src="https://habrastorage.org/getpro/habr/post_images/39e/409/ad7/39e409ad7443916dbf2e50df2b5877c9.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/1f1/9f5/7b5/1f19f57b5dc95d453c5017c15cc3f2ad.png"><br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text">  For l2tp, replace pptp-client with l2tp-client: <br><pre> <code class="hljs pgsql">/interface pptp-client <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>=tun1-wan disabled=<span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>=_vpn <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>= <span class="hljs-keyword"><span class="hljs-keyword">password</span></span>= <span class="hljs-keyword"><span class="hljs-keyword">add</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-route=yes <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-route-distance=<span class="hljs-number"><span class="hljs-number">1</span></span> profile=<span class="hljs-keyword"><span class="hljs-keyword">default</span></span></code> </pre><br></div></div><br>  <u>Important: If you are using L2TP / PPTP, then later use tun1-wan interface instead of eth1-wan.</u> <br><br><h4>  But what about Yota? </h4><br>  And just.  If you get a USB modem, then most likely it will be defined as an ethernet interface in <b>[Interfaces] ‚ûô [LTE]</b> and it is enough to take IP from it using DHCP.  But for the initial activation of the modem will have to connect to the PC.  <i>I don‚Äôt know with all the modem models that way or another I got caught up, but he refused to work on a PC without prior activation.</i> <br><br><h4>  Other 3G / 4G Modems </h4><br>  If the modem is not defined as a network card, but Mikrotik sees it in <b>[System] ‚ûô [Resources] ‚ûô [USB]</b> , then you will need to create a PPP connection for the usb1 interface, in some situations the device must first be switched to modem AT mode with a command (look at the corresponding forums).  In any case, a great many options, one of them is described <a href="https://geektimes.ru/post/188424/">here</a> . <br><br><h3>  LAN Interface Preparation </h3><br><br>  At the moment, the ether2-ether5 and wlan1 interfaces work independently of each other, they need to be combined into a single data transmission medium. <br><br>  Ethernet interfaces can be combined at the hardware level, which will increase the speed of data transmission and reduce the load on the CPU (compared to the software bridge).  As the master port, ether5 will be used, you can assign any, but if another provider appears, then it will be logical to connect it to the second port (and disable the master port on it). <br><br>  <b>For RoS below 6.41:</b> <br>  Rename ether5 to eth5-lan: <b>[Interfaces] ‚ûô [ether5] ‚ûô [Name: eth5-lan] ‚ûô [OK]</b> ; <br>  Rename ether2-ether4 and set master port for them: <b>[Interfaces] ‚ûô [ether2-4] ‚ûô [Name: eth2-4-lan;</b>  <b>Master Port = eth5-lan] ‚ûô [OK]</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b61/066/884/b61066884f49d434efeacdb7d8736c45.png" title="Eth5-lan setup"><br><img src="https://habrastorage.org/getpro/habr/post_images/482/119/4a1/4821194a142383e5f4a563778cb65112.png" title="Setting eth [2-4] -lan"><br><img src="https://habrastorage.org/getpro/habr/post_images/8d4/264/15f/8d426415f197bed9398042d73ba70fd1.png" title="Result"><br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs sql">/interface ethernet <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether5] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth5-lan /<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> ethernet <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether2] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth2-lan <span class="hljs-keyword"><span class="hljs-keyword">master</span></span>-port=eth5-lan /<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> ethernet <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether3] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth3-lan <span class="hljs-keyword"><span class="hljs-keyword">master</span></span>-port=eth5-lan /<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> ethernet <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether4] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth4-lan <span class="hljs-keyword"><span class="hljs-keyword">master</span></span>-port=eth5-lan</code> </pre><br></div></div><br>  <i>An interesting moment.</i>  <i>Means master port can combine the interfaces belonging to one chipset, on older models of chipsets can be several (switch column), the interfaces from different chipsets are combined through software Bridge, well, or patchcords.</i> <br><br>  <u>Now all local Ethernet interfaces are combined under the name eth5-lan.</u> <br><br>  The wireless interface exists separately from Ethernet, for association it is required to resort to the program bridge (bridge). <br><br>  Create a bridge interface: <b>[Bridge] ‚ûô [+] ‚ûô [Name: br1-lan] ‚ûô [OK]</b> ; <br>  Add interfaces: <b>[Bridge] ‚ûô [Ports] ‚ûô [+] ‚ûô [Interface: eth5-lan;</b>  <b>Bridge: br1-lan] ‚ûô [OK]</b> <br>  <b>[Bridge] ‚ûô [Ports] ‚ûô [+] ‚ûô [Interface: wlan1;</b>  <b>Bridge: br1-lan] ‚ûô [OK]</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/38c/dd9/8fd/38cdd98fd996396ba5d6eb6fe96b61f3.png" title="Create br1-lan"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/25f/7b1/994/25f7b199452a493e50d7e469a07ea363.png" title="Add eth5-lan"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/9c1/d4d/0b7/9c1d4d0b7cbce35d49a8487e8936e797.png" title="Adding wlan1"><br><br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs cs">/<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">bridge</span></span> <span class="hljs-title"><span class="hljs-title">add</span></span> <span class="hljs-title"><span class="hljs-title">name</span></span>=br1-lan /<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">bridge</span></span> <span class="hljs-title"><span class="hljs-title">port</span></span> <span class="hljs-title"><span class="hljs-title">add</span></span> <span class="hljs-title"><span class="hljs-title">interface</span></span>=eth5-lan bridge=br1-lan /<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">bridge</span></span> <span class="hljs-title"><span class="hljs-title">port</span></span> <span class="hljs-title"><span class="hljs-title">add</span></span> <span class="hljs-title"><span class="hljs-title">interface</span></span>=wlan1 bridge=br1-lan</code> </pre><br></div></div><br><br>  <b>For RoS 6.41 and up:</b> <br>  In the current version of RouterOS there is no master-port option anymore, now all settings are made inside the bridge interface <br><br>  Create the br1-lan interface: <br><pre> <code class="hljs cs">/<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">bridge</span></span> <span class="hljs-title"><span class="hljs-title">add</span></span> <span class="hljs-title"><span class="hljs-title">name</span></span>=br1-lan</code> </pre><br><br>  Add interfaces to the bridge: <br><pre> <code class="hljs cs">/<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">bridge</span></span> <span class="hljs-title"><span class="hljs-title">port</span></span> <span class="hljs-title"><span class="hljs-title">add</span></span> <span class="hljs-title"><span class="hljs-title">bridge</span></span>=br1-lan <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth2-lan hw=yes <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> bridge=br1-lan <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth3-lan hw=yes <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> bridge=br1-lan <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth4-lan hw=yes <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> bridge=br1-lan <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth5-lan hw=yes <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> bridge=br1-lan <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=wlan1</code> </pre><br><br>  <i>Everything can be done through the GUI, the hw option is called hardware offload.</i> <br><br>  We draw attention to the hw option on wired interfaces, it is she who is now responsible for loading the switch (if possible).  If you have several bridge interfaces and the hw option is enabled everywhere, then the device will independently choose which of the bridges to do with hardware, respectively, disable hw where it is least important independently. <br><br>  <u>Now all local Ethernet and wlan interfaces are united under the name br1-lan.</u> <br><br><h3>  Wireless security </h3><br>  Thing dreary (or rather dreary to describe it), but necessary. <br><br>  Add a security profile and specify the password for the wireless connection: <b>[Wireless] ‚ûô [Security Profiles] ‚ûô [+]</b> <br>  Name - the name of the profile; <br>  WPA / WPA2 Pre-Shared Key - keys for WPA / WPA2 (wi-fi password); <br>  The rest of the screenshot, in the end <b>[OK]</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/388/981/cfe/388981cfee5287a1ca49be33aedc4cd6.png" title="Create a security profile"><br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">/interface wireless <span class="hljs-keyword"><span class="hljs-keyword">security</span></span>-profiles <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>=wpa2-protected mode=dynamic-keys authentication-<span class="hljs-keyword"><span class="hljs-keyword">types</span></span>=wpa-psk,wpa2-psk unicast-chiphers=aes-ccm <span class="hljs-keyword"><span class="hljs-keyword">group</span></span>-chiphers=aes-ccm wpa-pre-shared-key=_wpa wpa2-pre-shared-key=_wpa2</code> </pre><br></div></div><br><br>  Enable and configure the wireless interface: <b>[Wireless] ‚ûô [wlan1] ‚ûô [Enable]</b> . <br>  On the <b>[Wireless]</b> tab: <br>  Mode: ap bridge; <br>  Band: 2gHz-b / g / n.  <i>If your wireless devices were released several years ago, then it is more logical to choose 2gHz-B / G.</i>  ; <br>  Frequency: auto.  <i>In SOHO devices, this parameter is called Channel matching can be viewed <a href="http://www.radio-electronics.com/info/wireless/wi-fi/80211-channels-number-frequencies-bandwidth.php">by reference</a> .</i>  <i>If you are not sure what to choose, leave auto.</i>  ; <br>  SSID: name of the access point; <br>  Wireless Protocol: 802.11; <br>  Securiity Profile: wpa2-protect.  Profile created in the previous step .; <br>  Bridge Mode: enabled; <br>  Default Authenticate: yes; <br>  Default Forward: yes; <br>  Hide SSID: no.  <i>You can hide the access point.</i>  <i>But do not consider this a panacea.</i>  ; <br>  Next tab <b>[Nstreme]</b> . <br>  Disable everything. <br><br>  Once finished, click <b>[Ok]</b> and try to connect (the phone will not receive ip, but the connection should be established). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/84f/301/6a3/84f3016a303cf874c487445848e0fd5c.png" title="Enable wlan1"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/8fb/37b/56d/8fb37b56d4a8acf78952b35100ce430a.png" title="Wireless Interface Configuration"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/bc6/936/3a9/bc69363a976dc4f3f97e3f9a834db75a.png" title="Nstreme disconnect"><br><br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs sql">/interface wireless <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> wlan1 disabled=<span class="hljs-keyword"><span class="hljs-keyword">no</span></span> ssid=MyRouter <span class="hljs-keyword"><span class="hljs-keyword">mode</span></span>=ap-bridge band=<span class="hljs-number"><span class="hljs-number">2</span></span>ghz-b/g/n frequency=<span class="hljs-number"><span class="hljs-number">2412</span></span> bridge-<span class="hljs-keyword"><span class="hljs-keyword">mode</span></span>=enabled wireless-protocol=<span class="hljs-number"><span class="hljs-number">802.11</span></span> <span class="hljs-keyword"><span class="hljs-keyword">security</span></span>-profile=wpa2-protect <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">authentication</span></span>=yes <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-forwarding=yes hide-ssid=<span class="hljs-keyword"><span class="hljs-keyword">no</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> wireless nstreme <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> wlan1 <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span>-nstreme=<span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span>-polling=<span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">disable</span></span>-csma=<span class="hljs-keyword"><span class="hljs-keyword">no</span></span></code> </pre><br></div></div><br><br><h3>  Setting ip, dhcp-server </h3><br>  Add ip to the interface br1-lan: <b>[IP] ‚ûô [Addresses] [+] ‚ûô [Address: 192.168.10.1/24;</b>  <b>Interface: br1-lan] ‚ûô [OK]</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7a7/623/106/7a7623106551eef31bf1d3b46b2227bc.png" title="IP setting"><br><br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs cs">/ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=br1-lan</code> </pre><br></div></div><br><br>  Create an address pool for dhcp: <b>[IP] ‚ûô [Pool] [+] ‚ûô [Name: dhcp-pc;</b>  <b>Addresses: 192.168.10.100-192.168.10.200] ‚ûô [OK]</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2c5/78c/a19/2c578ca199fd8f3d446196e1ca1a89cf.png" title="Creating a pool of IP addresses"><br><br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">/ip pool <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>=dhcp-pc address=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">-192.168</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.200</span></span></code> </pre><br></div></div><br><br>  We enable wiretapping of dhcp requests on the br1-lan interface: <b>[IP] ‚ûô [DHCP Server] ‚ûô [+] ‚ûô [Name: dhcp-pc;</b>  <b>Interface: br1-lan;</b>  <b>Lease Time: 08:00:00;</b>  <b>Address Pool: dhcp-pc] ‚ûô [OK]</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5da/5ef/0c3/5da5ef0c31adeaddcb210368b638121a.png" title="Enable DHCP server"><br><br>  Now we need to decide which parameters will be given via dhcp: <b>[IP] ‚ûô [DHCP Server] ‚ûô [Networks] ‚ûô [+]</b> <br>  Address: 192.168.10.0/24; <br>  Gateway: 192.168.10.1; <br>  Netmask: 24; <br>  DNS Servers: 192.168.10.1. <br>  At the end of <b>[Ok]</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e9d/a46/06b/e9da4606ba4d9a5be11b9ba77428c696.png" title="Setting up the distributed parameters"><br><br>  <i>In the screenshot, the address of the router is specified as the NTP server, but Mikrotik does not know how to distribute the exact time in the base delivery, you can specify any other server from the network, or add and configure the ntp package (described at the end of the HOWTO).</i> <br><br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">/ip dhcp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>=dhcp-pc interface=br1-lan lease-<span class="hljs-type"><span class="hljs-type">time</span></span>=<span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> address-pool=dhcp-pc /ip dhcp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> network <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> dns-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> gateway=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> netmask=<span class="hljs-number"><span class="hljs-number">24</span></span></code> </pre><br></div></div><br><br><h3>  Domain Name Server Setup </h3><br>  <i>If you are not satisfied with the DNS from the provider, you can add your own to the list (you can completely remove the provider DNS by turning off the Use peer DNS option in the corresponding connections).</i> <br><br>  Turn on DNS queries: <b>[IP] ‚ûô [DNS] ‚ûô [Allow Remote Requests: yes] ‚ûô [OK]</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9f0/2ae/667/9f02ae667e583853d5d710912cc2a827.png" title="DNS setup"><br><br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs sql">/ip dns <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">allow</span></span>-remote-requests=yes</code> </pre><br></div></div><br>  Now the local network is working, restarting the network interface (or dhcp-client) to get ip from the router and can be used to connect via winbox / http / ssh / telnet / ftp / scp ip: 192.168.10.1. <br><br>  A connection appeared between devices on the local network, when you try to ping any resource, its address is recognized, but Internet access is still missing.  The time has come for the last major item: packet filter settings. <br><br><h3>  Packet filter </h3><br>  RouterOS is a type of GNU / Linux OS, netfilter is used as a packet filter, I can‚Äôt say the interface works directly with the kernel module or with iptables, but the developers have tried to make the syntax as close as possible to the latter. <br><br>  In order not to describe each command separately, let's understand a little.  The packet filter is configured in <b>[IP] ‚ûô [Firewall]</b> , we will be interested in tabs (tables in iptables terminology) <b>[Filter]</b> , <b>[Nat]</b> and <b>[Mangle]</b> .  A number of rules can be added to each table (as elsewhere with the <b>[+]</b> button), the rules are processed alternately from top to bottom, so order is important.  Each rule consists of Conditions separated into three tabs: <b>General, Advanced, Extra</b> and Actions, <b>Action</b> tab, there are statistics of the rule, but we are not interested in it.  A rule can contain many conditions, the main thing is not to make them contradictory.  If passing by the rules of the package fits all conditions, it is processed by the appropriate action and no longer goes ( <i>in fact, some actions skip the package further, just remember this fact if you plan to deal with netfilter in the future</i> ).  In the variant for beginners, the conditions from the <b>General</b> tab will suffice. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1cb/b87/a0c/1cbb87a0c0b0b84df03f1b926cdcdfc0.png" title="Packet Rule Structure"><br><br>  What will be the settings?  Users from the local network will have access to the Internet.  Access to mikrotik from the local network will be limited to the services used (web, winbox, ssh, dns, ntp), from the external network access will be open via the web, but with the changed port address to 9999. <br><br>  <i>All the necessary rules are described in the form of tables, if you are afraid to make a mistake or just lazy, open <b>[New terminal]</b> and copy the lines from the console version at the end of the section into it.</i> <br><br><h4>  [Filter] tab </h4><br><table border="2"><tbody><tr><th colspan="10">  Conditions </th><th rowspan="2">  Act </th></tr><tr><td>  # </td><td>  Chain </td><td>  Src.  Address </td><td>  Dst.  Address </td><td>  Protocol </td><td>  Dst.Port </td><td>  In.  Interface </td><td>  Out.  Interface </td><td>  Connection mark </td><td>  Connection state </td></tr><tr><td>  0 </td><td>  Input </td><td></td><td></td><td>  icmp </td><td></td><td></td><td></td><td></td><td></td><td>  accept </td></tr><tr><td>  one </td><td>  Input </td><td>  192.168.10.0/24 </td><td></td><td>  tcp </td><td>  80,8291,22 </td><td>  br1-lan </td><td></td><td></td><td>  new </td><td>  accept </td></tr><tr><td><p>  2 </p></td><td><p>  Input </p></td><td></td><td></td><td><p>  tcp </p></td><td><p>  80 </p></td><td><p>  eth1-wan </p></td><td></td><td><p>  allow_in </p></td><td><p>  new </p></td><td><p>  accept </p></td></tr><tr><td>  3 </td><td>  Input </td><td>  192.168.10.0/24 </td><td></td><td>  udp </td><td>  53,123 </td><td>  br1-lan </td><td></td><td></td><td>  new </td><td>  accept </td></tr><tr><td>  four </td><td>  Input </td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>  established, related </td><td>  accept </td></tr><tr><td>  five </td><td>  Output </td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>  [!] Invalid </td><td>  accept </td></tr><tr><td>  6 </td><td>  Forward </td><td>  192.168.10.0/24 </td><td></td><td></td><td></td><td>  br1-lan </td><td>  eth1-wan </td><td></td><td>  new, established </td><td>  accept </td></tr><tr><td>  7 </td><td>  Forward </td><td></td><td>  192.168.10.0/24 </td><td></td><td></td><td>  eth1-wan </td><td>  br1-lan </td><td></td><td>  established, related </td><td>  accept </td></tr><tr><td>  eight </td><td>  Input </td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>  reject </td></tr><tr><td>  9 </td><td>  Output </td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>  reject </td></tr><tr><td>  ten </td><td>  Forward </td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>  reject </td></tr></tbody></table><br><h4>  [NAT] tab </h4><table border="1"><tbody><tr><th colspan="7">  Conditions </th><th rowspan="2">  Act </th></tr><tr><td>  # </td><td>  Chain </td><td>  Src.  Address </td><td>  Protocol </td><td>  Dst.Port </td><td>  In.  Interface </td><td>  Out.  Interface </td></tr><tr><td>  0 </td><td>  srcnat </td><td>  192.168.10.0/24 </td><td></td><td></td><td></td><td>  eth1-wan </td><td>  masquerade </td></tr><tr><td><p>  one </p></td><td><p>  dstnat </p></td><td></td><td><p>  tcp </p></td><td><p>  9999 </p></td><td><p>  eth1-wan </p></td><td></td><td><p>  redirect <br>  To ports: 80 </p></td></tr></tbody></table><br><h4>  [Mangle] tab </h4><table border="1"><tbody><tr><th colspan="6">  Conditions </th><th rowspan="2">  Act </th></tr><tr><td>  # </td><td>  Chain </td><td>  Protocol </td><td>  Dst.Port </td><td>  In.  Interface </td><td>  Connection state </td></tr><tr><td><p>  0 </p></td><td><p>  prerouting </p></td><td><p>  tcp </p></td><td><p>  9999 </p></td><td><p>  eth1-wan </p></td><td><p>  new </p></td><td><p>  mark connection <br>  New Connection Mark: allow_in </p></td></tr></tbody></table><br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">/ip firewall <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> chain=<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> protocol=icmp <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> chain=<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>-state=<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> dst-port=<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">8291</span></span>,<span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>-interface=br1-lan protocol=tcp src-address=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> chain=<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>-mark=allow_in <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>-state=<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> dst-port=<span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>-interface=eth1-wan protocol=tcp <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> chain=<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>-state=<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> dst-port=<span class="hljs-number"><span class="hljs-number">53</span></span>,<span class="hljs-number"><span class="hljs-number">123</span></span> protocol=udp src-address=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> chain=<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>-state=established,related <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> chain=output <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>-state=!invalid <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> chain=forward <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>-state=established,<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>-interface=br1-lan <span class="hljs-keyword"><span class="hljs-keyword">out</span></span>-interface=eth1-wan src-address=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> chain=forward <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>-state=established,related <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>-interface=eth1-wan <span class="hljs-keyword"><span class="hljs-keyword">out</span></span>-interface=br1-lan <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> action=<span class="hljs-keyword"><span class="hljs-keyword">drop</span></span> chain=<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> action=<span class="hljs-keyword"><span class="hljs-keyword">drop</span></span> chain=output <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> action=<span class="hljs-keyword"><span class="hljs-keyword">drop</span></span> chain=forward /ip firewall nat <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> action=masquerade chain=srcnat <span class="hljs-keyword"><span class="hljs-keyword">out</span></span>-interface=eth1-wan src-address=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> action=redirect chain=dstnat dst-port=<span class="hljs-number"><span class="hljs-number">9999</span></span> protocol=tcp <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>-ports=<span class="hljs-number"><span class="hljs-number">80</span></span> /ip firewall mangle <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> action=mark-<span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> chain=prerouting dst-port=<span class="hljs-number"><span class="hljs-number">9999</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>-mark=allow_in protocol=tcp <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>-state=<span class="hljs-built_in"><span class="hljs-built_in">new</span></span></code> </pre><br></div></div><br>  Now the Internet should be available, if that‚Äôs enough for you, then close the HOWTO and use it if you want to learn more. <br><br><h3>  Addition 1. Device name </h3><br>  Give the device a name: <b>[System] ‚ûô [Identity] ‚ûô [Name: MikRouter] ‚ûô [OK]</b> <br>  And we set it in dns: <b>[IP] ‚ûô [DNS] ‚ûô [Static] ‚ûô [+] ‚ûô [Name: mikrouter;</b>  <b>Address: 192.168.10.1] ‚ûô [OK]</b> <br>  Now the device can be accessed by the domain name <b>mikrouter</b> , but only from the local subnet. <br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">/<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> <span class="hljs-keyword"><span class="hljs-keyword">identity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>=MikRouter /ip dns static <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>=mikrouter address=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.12</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span></code> </pre><br></div></div><br><br><h3>  Addition 2. Time setting </h3><br>  Adjust the clock: <b>[System] ‚ûô [Clock] ‚ûô [Time] ‚ûô [Time Zone Name: <i>Time Zone</i> ;</b>  <b>Time: <i>Current time</i> ;</b>  <b>Date: <i>Current Date</i> ] ‚ûô [OK]</b> <br><br><h3>  Addition 3. Update </h3><br>  We update the device and add packages. <br><br>  Go to the <a href="http://www.mikrotik.com/download">site Mikrotik</a> and download the archive with updates (Extra Packages) for your router.  Unpack and leave the following (6.30.2 - the current version at the time of writing, updates are released quite often): <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">advanced-tools-6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.30</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2-mipsbe</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.npk</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dhcp-6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.30</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2-mipsbe</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.npk</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">multicast-6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.30</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2-mipsbe</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.npk</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ntp-6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.30</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2-mipsbe</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.npk</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ppp-6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.30</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2-mipsbe</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.npk</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">routing-6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.30</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2-mipsbe</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.npk</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">security-6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.30</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2-mipsbe</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.npk</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">system-6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.30</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2-mipsbe</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.npk</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">user-manager-6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.30</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2-mipsbe</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.npk</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">wireless-6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.30</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2-mipsbe</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.npk</span></span></code> </pre><br>  In Winbox, open <b>[Files]</b> and drag the selected packages using drag'n'drop (alternatively, you can download via the web interface or via ssh using scp). <br><br>  To update, just restart the device: <b>[System] ‚ûô [Reboot] ‚ûô [Yes]</b> <br><div class="spoiler">  <b class="spoiler_title">Console reboot option</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">/<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> reboot</code> </pre><br></div></div><br>  Further, for updating it is not necessary to download packages: <b>[System] ‚ûô [Packages] ‚ûô [Check for updates] ‚ûô [Channel: current] ‚ûô [Download &amp; Install]</b> <br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs sql">/system package <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> download /<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> <span class="hljs-keyword"><span class="hljs-keyword">install</span></span></code> </pre><br></div></div><br><br><h3>  Appendix 4. Configuring ntp </h3><br>  In previous additions, we set up the clock and added the NTP package, now it needs to be configured. <br><br>  We enable ntp-client and set the server addresses (you can set your favorite ones) of the exact time: <b>[System] ‚ûô [NTP Client] ‚ûô [Enabled: yes;</b>  <b>Primary: 48.8.40.31;</b>  <b>Secondary: 91.206.16.4] ‚ûô [OK]</b> <br>  Enable snooping ntp requests: <b>[System] ‚ûô [NTP Server] ‚ûô [Enabled: yes] ‚ûô [OK]</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ea4/f7a/3ab/ea4f7a3abfddb9fc5ed070522cfd4d3f.png"><br><br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">/<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> ntp client <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> enabled=yes primaty-ntp=<span class="hljs-number"><span class="hljs-number">48.8</span></span><span class="hljs-number"><span class="hljs-number">.40</span></span><span class="hljs-number"><span class="hljs-number">.31</span></span> secondary-ntp=<span class="hljs-number"><span class="hljs-number">91.206</span></span><span class="hljs-number"><span class="hljs-number">.16</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> ntp <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> enabled=yes</code> </pre><br></div></div><br><br><h3>  Addition 5. Disable extra services </h3><br>  Leave the winbox / http / ssh, the rest can be enabled if necessary: <b>[IP] ‚ûô [Services]</b> select as in the screenshot and click <b>[x]</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c8f/513/77a/c8f51377adfe2088d246db0bf276959e.png"><br><br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs sql">/ip service <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> telnet disabled=yes <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ftp</span></span> disabled=yes <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> api disabled=yes <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> api-ssl disabled=yes <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> https disabled=yes <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> www-ssl disabled=<span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> winbox disabled=<span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> www disabled=<span class="hljs-keyword"><span class="hljs-keyword">no</span></span></code> </pre><br></div></div><br><br><h3>  Addition 6. Disable detection and limit access to mactelnet </h3><br>  In winbox, there are means of detecting devices that are in the same physical network with a PC, this is convenient, but why should the neighbors know what device we have? <br><br>  Disable: <b>[IP] ‚ûô [Neighbor] ‚ûô [Discovery Interfaces]</b> .  You can leave the detection for br1-lan (local area network), you can remove your choice.  For new interfaces, detection is enabled by default, do not forget about it. <br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs swift">/ip neighbor discovery :foreach i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>=[<span class="hljs-built_in"><span class="hljs-built_in">find</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> $i discovery=no }</code> </pre> </div></div><br><br>  Now we will restrict access to the mac-address (winbox and mactelnet): <b>[Tools] ‚ûô [MAC Server] ‚ûô [Telnet Interfaces]</b> <br>  Disable ( <b>[x]</b> ) <b>all</b> and add <b>br1-lan</b> . <br>  Go to <b>[Winbox Interfaces]</b> and repeat. <br><br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs cs">/tool mac-server <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [ find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>=yes ] disabled=yes <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=br1-lan /tool mac-server mac-winbox <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [ find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>=yes ] disabled=yes <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=br1-lan</code> </pre> </div></div><br><br><h3>  Addition 7. We include UPnP </h3><br>  Many p2p applications and online games require UPnP (Dynamic Port Opening Service) for normal operation. <br><br>  Enable: <b>[IP] ‚ûô [UPnP] ‚ûô [Enabled: yes]</b> <br>  Adding interfaces: <b>[Interfaces] ‚ûô [+]</b> <br>  External: eth1-wan; <br>  Internal: br1-lan. <br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs cs">/ip upnp <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> enabled=yes /ip upnp interfaces <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth1-wan type=external <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=br1-lan type=<span class="hljs-keyword"><span class="hljs-keyword">internal</span></span></code> </pre> </div></div><br><br><h3>  Addition 8. Overclocking </h3><br>  If the number of devices on the network has increased so much that the router has stopped coping, you can overclock the processor a bit: <b>[System] ‚ûô [RouterBOARD] ‚ûô [Settings] ‚ûô [CPU Frequency: 750 MHz]</b> <br><br>  For RB 951G is the maximum frequency of the CPU. <br><br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">/<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> routerboard settings <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> cpu-frequency=<span class="hljs-number"><span class="hljs-number">750</span></span>MHz</code> </pre><br></div></div><br><h3>  Supplement 9. Backup settings </h3><br>  Backup settings will never be over: [Files] ‚ûô [Backup] <br>  Name: file name (without extension); <br>  Password: password (if you do not specify the user password will be used); <br>  Don't Encrypt: if there is no need to encrypt backup. <br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs sql">/system <span class="hljs-keyword"><span class="hljs-keyword">backup</span></span> <span class="hljs-keyword"><span class="hljs-keyword">save</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=router6<span class="hljs-number"><span class="hljs-number">.30</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> dont-<span class="hljs-keyword"><span class="hljs-keyword">encrypt</span></span>=yes</code> </pre> </div></div><br><br>  To restore, just copy the file to another device (preferably the same series and with the same version of RouterOS). <br>  Go to [Files] ‚ûô [Restore] and select the file. <br><div class="spoiler">  <b class="spoiler_title">Console option</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">/<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> backup <span class="hljs-keyword"><span class="hljs-keyword">load</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>=router6<span class="hljs-number"><span class="hljs-number">.30</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>.backup</code> </pre> </div></div><br><br>  PS I have not raised a hand for 3 years to write something else, if there are interesting ideas for articles on RoS and Mikrotik, write in a personal. </div><p>Source: <a href="https://habr.com/ru/post/265387/">https://habr.com/ru/post/265387/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265375/index.html">Excel Lemmatization, or "Robot Recognizer 3.0"</a></li>
<li><a href="../265377/index.html">The digest of interesting materials from the world of Drupal # 12</a></li>
<li><a href="../265381/index.html">Webix + databoom = rapid application prototyping. Part 2</a></li>
<li><a href="../265383/index.html">To help the analyst: we write our automatic download of Yandex.Metrica reports using AWS for free</a></li>
<li><a href="../265385/index.html">Atlassian JIRA Service Desk: brief information and some tricks for usability (using sil-scripts and sql)</a></li>
<li><a href="../265389/index.html">How to feed cats. Manual for programmers leading other programmers</a></li>
<li><a href="../265391/index.html">Ruby on Rails and interaction with REST Qiwi Shop</a></li>
<li><a href="../265393/index.html">Why do routine work when it can be charged to a car?</a></li>
<li><a href="../265395/index.html">Development of browser online games on meteor</a></li>
<li><a href="../265397/index.html">RailsClub 2015: Interview with Sam Pippen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>