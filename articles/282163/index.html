<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using arduino to automate device testing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Our company "RTL Service" is developing a local positioning system, with which you can accurately determine where a certain person is in the room. In ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using arduino to automate device testing</h1><div class="post__text post__text-html js-mediator-article">  Our company "RTL Service" is developing a local positioning system, with which you can accurately determine where a certain person is in the room.  In addition, our system allows you to contact this person using your own communicators (Figure 1) via a secure communication channel. <a name="habracut"></a><br><br><img src="https://habrastorage.org/getpro/habr/post_images/dab/516/32a/dab51632a2cd6c10dc4a6eba20b43364.jpg"><br>  Fig.  1 - communicator <br><br>  I am a testing department engineer, and it is my responsibility to check that the firmware and stuffing of our communicators faithfully work out various combinations of key presses and key presses.  Previously, this was done manually and it took a lot of time and effort (in the end, the fingers did not want to obey).  Therefore, it was decided to replace human labor with automatic testing with the help of hardware. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The Arduino UNO board was chosen as a tester.  It is quite simple and easy to use, it has a built-in ATMega328 microcontroller, 14 digital I / Os (6 of which can be used as PWM outputs), a 16 MHz crystal oscillator and a USB connector. <br><br>  So let's get started. <br><br>  The button board connects to the communicator circuit board.  In the train there are four lines, three of which are responsible for 3 buttons, and the fourth is responsible for the ground.  For testing, we made our own handkerchief for connecting the connector of the communicator buttons (Fig. 2) to the Arduino.  There is, respectively, a cable for connecting a communication device to the board, 4 wires to the pins of the controller and an optocoupler to untie the buttons from the ground. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bd0/7a6/d07/bd07a6d07d0980aa6f522f9301d7fead.jpg"><br>  Fig.  2 - connection board <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ec4/df1/ed6/ec4df1ed6739cd1a8665b7309a7a69bc.jpg"><br>  Fig.3 - how it all looks <br><br>  Next is the program. <br><br>  The communicator has 3 buttons: the environment / response request button, the channel change button on which the connection will be made, the device on / off button.  Also, for example, simultaneously clamping the lower and upper buttons leads to an increase in the volume of the communicator, and clamping the lower and middle buttons to a decrease. <br><br>  To press any button, you need to send to the corresponding pin 5 V (i.e., transfer the pin to the HIGH state).  Thus, in order to release it, you need to stop feeding 5 V (set to LOW).  For example, the device enable function: <br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">switching</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ Serial.println(<span class="hljs-string"><span class="hljs-string">"ON/OFF"</span></span>); delay(<span class="hljs-number"><span class="hljs-number">70</span></span>); digitalWrite(low_button, HIGH); delay(<span class="hljs-number"><span class="hljs-number">7000</span></span>); digitalWrite(low_button, LOW); delay(<span class="hljs-number"><span class="hljs-number">500</span></span>); };</code> </pre> <br>  In this function, a pin responsible for the bottom button is sent for 7 seconds (corresponds to the on / off time of the communication device) 5 V. After that, 0 V is sent, which means the release of the key. <br><br>  In approximately the same way, it is possible to implement the process of clamping one key and pressing / clamping at this moment another: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buttDelay_Press</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pin_1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pin_2)</span></span></span></span>{ digitalWrite(pin_1, HIGH); delay(<span class="hljs-number"><span class="hljs-number">100</span></span>); buttPress(<span class="hljs-number"><span class="hljs-number">1</span></span>, pin_2,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>);<span class="hljs-comment"><span class="hljs-comment">//press button buttPress(1, pin_2,0,0,60); digitalWrite(pin_2, HIGH); delay(10000); digitalWrite(pin_2, LOW); if (pin_2 == low_button ) { switching(); } digitalWrite(pin_2, HIGH); tDelay(60000); //change pin status to LOW if (pin_2 == low_button ) { switching(); } };</span></span></code> </pre><br>  In this function, the pin_1 button is clamped.  At the same time point, the pin_2 button is pressed 10 and 60 times in a row, after which it is clamped for 10 and 60 seconds.  In addition, there is a check for clamping the bottom button.  It was stated above that when this button is pressed for more than 7 seconds, the communicator turns off / on, therefore, if this happens, the device must be returned to its original state. <br><br>  There are also random keystrokes and keystrokes: <br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// Random pressing void buttRandPress(int ncount){ for (int i = 0; i &lt; ncount; i++) { rbutton = buttons[random(3)]; buttPress(1, rbutton,0,0, 1); } }; // Random holding void buttRandDelay(int ncount, int dtime){ for (int i = 0; i &lt; ncount; i++) { rbutton = buttons[random(3)]; buttDelay(1, rbutton,0,0); tDelay(dtime); } };</span></span></code> </pre><br>  In these functions, one of three buttons is randomly selected, which is pressed or clamped for a random time. <br><br>  The tests also checks the clamping of all keys.  All combinations with different delays between clicks are checked, because this happens in life. <br><br>  An additional advantage of this autotest, unlike manual, is that the device can be left for several days of continuous work, freeing the person for other tasks.  Thus, it is possible to check the stability of the communicator under continuous load. <br><br>  Using the above method, other devices can be tested.  For example, you can simulate an unexpected power failure and see how quickly the device turns on. <br><br>  In the next publication, we plan to talk about the organization of server stress testing, the implementation of external and internal server load, and the metrics we use to test the adequacy of the server‚Äôs work under load. <br><br>  The author: Fedor Talayev </div><p>Source: <a href="https://habr.com/ru/post/282163/">https://habr.com/ru/post/282163/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282153/index.html">INTEL represents the release of the source code for the Arduino 101 firmware</a></li>
<li><a href="../282155/index.html">There is a question: why e-mail topics become longer, and what does it affect</a></li>
<li><a href="../282157/index.html">Network protocol for backing up data in networks with delay and packet loss</a></li>
<li><a href="../282159/index.html">Profiling JS code from functions. Yandex experience</a></li>
<li><a href="../282161/index.html">GTD: write a thesis and stay alive</a></li>
<li><a href="../282165/index.html">The results of the selection for the section Young School</a></li>
<li><a href="../282167/index.html">As I wrote the book 'Python Machine Learning'</a></li>
<li><a href="../282173/index.html">You Telegramma: SPARQL-injections and CSRF via Telegram-messages in the NeoQUEST-2016 task</a></li>
<li><a href="../282175/index.html">ITMO University Digest: # 1 Education and Science</a></li>
<li><a href="../282179/index.html">How I hacked Facebook and found someone else's backdoor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>