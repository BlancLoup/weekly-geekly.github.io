<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using Intel¬Æ C ++ Compiler Advanced Features for Android Applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Intel C ++ Compiler provides many opportunities for optimizing applications for a variety of tasks, including mobile devices. In this article, we ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using Intel¬Æ C ++ Compiler Advanced Features for Android Applications</h1><div class="post__text post__text-html js-mediator-article">  The Intel C ++ Compiler provides many opportunities for optimizing applications for a variety of tasks, including mobile devices.  In this article, we will cover two aspects of optimization: first, let's talk about using the executable Intel Cilk Plus module in Android to implement application multithreading, and second, let's touch on the use of Profile-guided Optimization (PGO) to improve the performance of Android applications.  Links for a more in-depth study of these topics are given at the end of the article. <br><a name="habracut"></a><br><h1>  Using the Intel Cilk Plus executable in Android to implement multi-threading applications </h1><br>  <a href="https://software.intel.com/en-us/intel-cilk-plus">Intel Cilk Plus</a> is an extension of C and C ++ that makes it easy and convenient to use multi-core architecture and vector processing.  The three Intel Cilk Plus keywords provide a simple but surprisingly powerful model for parallel programming, and the runtime module and template libraries form a convenient environment for creating parallel applications. <br>  When using Intel Cilk Plus, linking to the Cilk runtime library (libcilkrts.so) is required to implement multithreading in applications. <br><br><h2>  <font color="#0071c5">Development using the Intel C ++ compiler and the NDK build system (ndk-build)</font> </h2><br>  The NDK build system does not link the C ++ libraries for modules written in C, with the result that the compiler cannot select the correct Intel Cilk Plus library during linking, which can lead to linking errors. <br>  1. Add an empty C ++ file to the project to enable C ++ linking in the NDK build system. <br><br>  2. Specify a compatible C ++ implementation in the Application.mk file. <br>  <i>'APP_STL: = stlport_shared'</i> or <br>  <i>'APP_STL: = gnustl_static'</i> or <br>  <i>'APP_STL: = gnustl_shared'</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      3. Modify the Java code as described in the ‚ÄúPreparing JNI Calls‚Äù section below. <br><br><h2>  <font color="#0071c5">Development using the Intel C ++ compiler without the NDK build system (ndk-build)</font> </h2><br>  If your development environment contains C ++ code, you must explicitly link to the GNU_STL or stlport library. <br>  Perform the following steps. <br>  1. Specify the following flags for compilation and linking for the corresponding C ++ implementation in the NDK. <br>  Compile flags: <br>  <i>-I $ ANDROID_GNU_LIBSTDCPP / include -I $ ANDROID_GNU_LIBSTDCPP / libs / x86 / include</i> <br>  Link flags (gnustl_shared): <br>  <i>-L $ ANDROID_GNU_LIBSTDCPP / libs / x86 -lgnustl_shared -lsupc ++</i> <br>  Link flags (gnustl_static): <br>  <i>-L $ ANDROID_GNU_LIBSTDCPP / libs / x86 -lgnustl_static -lsupc ++</i> <br>  Where <br>  ANDROID_GNU_LIBSTDCPP = $ NDK / sources / cxx-stl / gnu-libstdc ++ / 4.6.  4.6 should be replaced with the version of GCC pointed to by ANDROID_GNU_X86_TOOLCHAIN.  For example, if ANDROID_GNU_X86_TOOLCHAIN ‚Äã‚Äãpoints to $ NDK / toolchains / x86-4.8 / prebuilt / linux-x86, then replace 4.6 with 4.8. <br>  When using Intel Cilk Plus, linking with the library libcilkrts.so is required.  This library is located in the / compiler / lib / ia32 / gnustl folder. <br><br>  2. If you are using the C ++ library stlport_shared (requires NDK r9 or later), add the following flags. <br>  Compile flags: <br>  <i>-I $ ANDROID_STLPORT_LIBSTDCPP / stlport</i> <br>  Link flags: <br>  <i>-L $ ANDROID_STLPORT_LIBSTDCPP / libs / x86 -lstlport_shared</i> <br>  Where <br>  ANDROID_STLPORT_LIBSTDCPP = $ NDK / sources / cxx-stl / stlport. <br>  When using Intel Cilk Plus, the corresponding library is located in the / compiler / lib / ia32 / stlport folder. <br><br><h2>  <font color="#0071c5">JNI call preparation</font> </h2><br>  JNI call preparation is required to use Intel Cilk Plus for all Android versions up to Android 4.3 (Jelly Bean MR2).  The library libcilkrts.so needs to be loaded from Java code using the following API call: <br>  System.loadLibrary ("cilkrts"); <br>  If the application needs a dynamic C ++ implementation, you need to load the appropriate library in addition to libcilkrts.so: <br><br>  <i>System.loadLibrary ("gnustl_shared");</i> <i><br></i>  <i>System.loadLibrary ("cilkrts");</i> <br>  or <br>  <i>System.loadLibrary ("stlport_shared");</i> <i><br></i>  <i>System.loadLibrary ("cilkrts");</i> <br><br><h1>  Use PGO to improve application performance in Android OS </h1><br>  Profile Optimization (Profile-guided Optimization, PGO) improves application performance by reordering the code to eliminate inefficient caching, reduce the amount of code and identify incorrect predictions during branching.  PGO provides the compiler with information on the most frequently executed areas of the application.  Possessing information about these areas, the compiler can optimize application performance. <br>  Using PGO on Android (compared to other OS) requires some additional steps. <br>  1. Add the following parameters to the C flags in the jni / Android.mk file: <br>  <i>LOCAL_CFLAGS: = -prof-gen -prof-dir / sdcard</i> . <br><br>  2. Add the WRITE_EXTERNAL_STORAGE permission to allow the application to write the PGO output to the sdcard folder.  Add the following line to the AndroidManifest.xml file: <br>  <i>&lt;uses-permission android: name = "android.permission.WRITE_EXTERNAL_STORAGE" /&gt;.</i> <br><br>  3. Ensure that profiling data is recorded.  Profiling data is recorded in the default mode only when the application is shut down.  Android * applications do not usually shut down.  Use the following options to force the application to shut down or work around this issue. <br><br>  A. Option 1. Call exit from Java code. <br>  <i>System.exit (0);</i> <br><br>  B. Option 2. Forced output of PGO data dump from native code. <br>  <i>#include &lt;pgouser.h&gt;</i> <i><br></i>  <i>_PGOPTI_Prof_Dump_All ();</i> <br><br>  B. Option 3. Using environment variables to regularly write performance data to sdcard media while the application is running.  To make the environment variables available to all applications, add them to the init.rc file of the Android image: <br>  <i>export INTEL_PROF_DUMP_INTERVAL 5000</i> <i><br></i>  <i>export INTEL_PROF_DUMP_CUMULATIVE 1</i> <br>  Note.  The INTEL_PROF_DUMP_INTERVAL value is measured in microseconds, it should not exceed INT_MAX. <br><br>  4. Copy the created dyn files to the host in the application source folder: <br>  <i>adb pull ...</i> <br><br>  5. Change the C flags in the Android.mk file to use the generated dyn files.  You can use the -prof-dir option to specify a different file location. <br>  <i>LOCAL_CFLAGS: = -prof-use</i> <br><br>  See the <a href="https://software.intel.com/en-us/node/522721">Profile Optimization</a> section of the Intel C ++ XE 15.0 Compiler User Guide and Reference Manual that came with the package for information on using PGO to optimize applications built with the Intel C ++ Compiler on Linux *, Windows *, and OS X *. <br><br><h1>  Other related articles and resources </h1><br>  <a href="https://software.intel.com/ru-ru/articles/intel-system-studio-multicore-programming-with-intel-cilk-plus">Intel System Studio - Multi-core programming with Intel Cilk Plus</a> <br>  <a href="https://software.intel.com/en-us/videos/intel-cilk-plus">Intel Cilk Plus</a> <br>  <a href="https://software.intel.com/en-us/compiler_15.0_ug_c">Intel C ++ 15.0 Compiler User Guide and Reference Manual</a> <br>  <a href="https://software.intel.com/ru-ru/articles/android-ndk-for-intel-architecture">Android * NDK for Intel Architecture</a> <br>  <a href="https://software.intel.com/ru-ru/articles/using-the-android-x86-ndk-with-eclipse-and-porting-an-ndk-sample-app">Using Android * x86 NDK with Eclipse * and an example of porting an NDK application</a> <br><br>  For more information about Intel for Android developers, see the <a href="https://software.intel.com/en-us/android">Intel Developer Zone for Android</a> . </div><p>Source: <a href="https://habr.com/ru/post/253270/">https://habr.com/ru/post/253270/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../253260/index.html">Installing the grub4dos bootloader on a USB flash drive from a linux console</a></li>
<li><a href="../253262/index.html">About making sustainable decisions or a case club on Habr√©</a></li>
<li><a href="../253264/index.html">About highway</a></li>
<li><a href="../253266/index.html">Gson cheat sheet for Map, List and Array</a></li>
<li><a href="../253268/index.html">How we spent 1 year and 3 months to develop a browser game</a></li>
<li><a href="../253272/index.html">Automate Cisco IOU from console</a></li>
<li><a href="../253274/index.html">Future C: OOP</a></li>
<li><a href="../253278/index.html">Meet Envoyer.io (part 2)</a></li>
<li><a href="../253280/index.html">PVS-Studio: 25 suspicious code snippets from CoreCLR</a></li>
<li><a href="../253281/index.html">Unpleasant surprises from Tinypass or not worth chasing a subscription discount</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>