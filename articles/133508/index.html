<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Quick Password Recovery PRO 1.7 security research</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. Today, using the example of Quick Password Recovery Pro 1.7.1, I want to show a study of protection using a couple of interesting techniques an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Quick Password Recovery PRO 1.7 security research</h1><div class="post__text post__text-html js-mediator-article">  Hello.  Today, using the example of Quick Password Recovery Pro 1.7.1, I want to show a study of protection using a couple of interesting techniques and a hash function. <br><a name="habracut"></a><br><br>  <b>Purpose:</b> Quick Password Recovery PRO 1.7.1 (www.passdecrypt.ru) <br>  <b>Protection:</b> HWID + MD5 <br>  <b>Tools:</b> Die 0.65 + KANAL 2.92 plugin, OllyDbg 1.10 (more Olly) + mapimp plugin (available on tport.org), IDR (Interactive Delphi Reconstructor), Keygener Assistant 1.7, Borland Delphi 7 (for writing keygen). <br>  Let's start the "examination of the patient": <br><img src="http://img685.imageshack.us/img685/2990/20111127190629.png" alt="image"><br>  The program is written in Borland Delphi [ver: 2006] |  Object Pascal, so we immediately ship it to IDR to analyze and create a map file for Olly. <br>  The Kanal plugin finds several crypto signatures: <br><img src="http://img830.imageshack.us/img830/9611/20111127190642.png" alt="image"><br>  We start the program, we are greeted by a window with a message that this is an unregistered version and some functions are not available.  In this we can see for yourself: <br><img src="http://img802.imageshack.us/img802/7855/20111127185410.png" alt="image"><br><br><img src="http://img7.imageshack.us/img7/5192/20111127185438.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Press the "Register" button: <br><img src="http://img585.imageshack.us/img585/7228/20111127190128.png" alt="image"><br>  For registration, we need a name and serial number, which certainly depend on the system identifier (further HWID). <br><br>  Enter any registration data, for example: <br>  Name: ds@mail.ru <br>  Serial: abcdefghigklmnop <br><br>  We look at the IDR code, which is executed by clicking on the "Register" button, but we see that in addition to the creation of a pair of entries in the registry, nothing else happens: <br><img src="http://img100.imageshack.us/img100/2897/20111127185722.png" alt="image"><br><br><img src="http://img259.imageshack.us/img259/9710/20111127185729.png" alt="image"><br>  The program offers us to restart it, which means that the check is performed somewhere at the start of the program.  Suppose a check is performed when the main form is created (OnCreate event).  We are looking for a place to call in IDR and put a breakpoint at the beginning of the function in Olly: <br><img src="http://img412.imageshack.us/img412/2267/20111127185756.png" alt="image"><br><br>  We start the program from the debugger and stop here: <br><blockquote><code><a href="http://s-c.me/23959/s"></a> <a href="http://s-c.me/23959/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt;0046EC94 &gt; . 55 PUSH EBP ; Unit1.TForm1.FormCreate &lt;br/&gt;</font></code> </blockquote> <br>  We reach the first interesting call: <br><img src="http://img706.imageshack.us/img706/2079/20111127185947.png" alt="image"><br>  On F7 we enter and trace further, until we reach here: <br><img src="http://img17.imageshack.us/img17/1893/20111127233405.png" alt="image"><br>  I'll run a little bit ahead and say that this is where the HWID generation and subtraction of the first part of the serial are hiding. <br>  Again, we follow F7 and determine that the HWID is generated at 46537F, which is easy to guess by passing the function under the debugger: <br><blockquote> <code><a href="http://s-c.me/23960/s"></a> <a href="http://s-c.me/23960/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt;0046537F |. E8 3CFCFFFF CALL &lt;QuickPas._Unit32.sub_00464FC0&gt; ; &lt;&lt; Get Hwid &lt;br/&gt;</font></code> </blockquote> <br><img src="http://img195.imageshack.us/img195/1317/20111127190838.png" alt="image"><br>  But then we carefully examine the function at the address 00464FC0 and find the code there: <br><blockquote> <code><a href="http://s-c.me/23961/s"></a> <a href="http://s-c.me/23961/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt;00465072 | <font color="#0000ff">&gt;</font> /8B45 FC /MOV EAX,DWORD PTR SS:[EBP-4]&lt;br/&gt;00465075 |. |0FB64418 FF |MOVZX EAX,BYTE PTR DS:[EAX+EBX-1]&lt;br/&gt;0046507A |. |8BD3 |MOV EDX,EBX&lt;br/&gt;0046507C |. |03D2 |ADD EDX,EDX&lt;br/&gt;0046507E |. |03C2 |ADD EAX,EDX&lt;br/&gt;00465080 |. |8D55 DC |LEA EDX,DWORD PTR SS:[EBP-24]&lt;br/&gt;00465083 |. |E8 3441FAFF |CALL <font color="#0000ff">&lt;</font> <font color="#800000">QuickPas.SysUtils.IntToStr</font> <font color="#0000ff">&gt;</font> &lt;br/&gt;00465088 |. |8B55 DC |MOV EDX,DWORD PTR SS:[EBP-24]&lt;br/&gt;0046508B |. |8D45 F4 |LEA EAX,DWORD PTR SS:[EBP-C]&lt;br/&gt;0046508E |. |E8 6D01FAFF |CALL <font color="#0000ff">&lt;</font> <font color="#800000">QuickPas.system.</font> @LStrCat <font color="#0000ff">&gt;</font> &lt;br/&gt;00465093 |. |43 |INC EBX&lt;br/&gt;00465094 |. |83FB 04 |CMP EBX,4&lt;br/&gt;00465097 |.^\75 D9 \JNZ SHORT QuickPas.00465072&lt;br/&gt;00465099 |. 8D45 F8 LEA EAX,DWORD PTR SS:[EBP-8]&lt;br/&gt;0046509C |. E8 93FEF9FF CALL <font color="#0000ff">&lt;</font> <font color="#800000">QuickPas.system.</font> @LStrClr <font color="#0000ff">&gt;</font> &lt;br/&gt;004650A1 |. BB 01000000 MOV EBX,1&lt;br/&gt;004650A6 | <font color="#0000ff">&gt;</font> 8D45 D8 /LEA EAX,DWORD PTR SS:[EBP-28]&lt;br/&gt;004650A9 |. 8B55 F4 |MOV EDX,DWORD PTR SS:[EBP-C]&lt;br/&gt;004650AC |. 0FB6541A FF |MOVZX EDX,BYTE PTR DS:[EDX+EBX-1]&lt;br/&gt;004650B1 |. E8 6600FAFF |CALL <font color="#0000ff">&lt;</font> <font color="#800000">QuickPas.system.</font> @LStrFromChar <font color="#0000ff">&gt;</font> &lt;br/&gt;004650B6 |. 8B55 D8 |MOV EDX,DWORD PTR SS:[EBP-28]&lt;br/&gt;004650B9 |. 8D45 F8 |LEA EAX,DWORD PTR SS:[EBP-8]&lt;br/&gt;004650BC |. E8 3F01FAFF |CALL <font color="#0000ff">&lt;</font> <font color="#800000">QuickPas.system.</font> @LStrCat <font color="#0000ff">&gt;</font> &lt;br/&gt;004650C1 |. 43 |INC EBX&lt;br/&gt;004650C2 |. 83FB 06 |CMP EBX,6&lt;br/&gt;004650C5 |.^ 75 DF \JNZ SHORT QuickPas.004650A6 &lt;br/&gt;</font></code> </blockquote> <br>  Here, the codes of the first 3 characters are taken, + the value of the loop counter multiplied by 2 is glued to a string, and then only the first 5 are taken (the SystemBiosDate parameter, which is considered a hash, can be found in the registry, and more specifically here: HKEY_LOCAL_MACHINE \ HARDWARE \ DESCRIPTION \ System) <br><img src="http://img20.imageshack.us/img20/3131/20111127191035.png" alt="image"><br>  In pascal, it can be written like this: <br><blockquote> <code><a href="http://s-c.me/23962/s"></a> <a href="http://s-c.me/23962/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt;md5_sbd:=md5(  SystemBiosDate)&lt;br/&gt; <font color="#0000ff">for</font> i:=1 <font color="#0000ff">to</font> 3 do&lt;br/&gt; <font color="#0000ff">begin</font> &lt;br/&gt; <font color="#0000ff">result</font> := <font color="#0000ff">result</font> + IntToStr(ord(md5_sbd[i]) + i*2;);&lt;br/&gt; <font color="#0000ff">end</font> ; &lt;br/&gt;</font></code> </blockquote> <br>  After exiting the HWID receiving function, step forward: <br><blockquote> <code><a href="http://s-c.me/23963/s"></a> <a href="http://s-c.me/23963/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt;00465389 |&gt; /8D45 F8 /LEA EAX,DWORD PTR SS:[EBP-8]&lt;br/&gt;0046538C |. |E8 BF00FAFF | <font color="#0000ff">CALL</font> &lt;QuickPas.system.@UniqueStringA&gt;&lt;br/&gt;00465391 |. |BA 06000000 |MOV EDX,6&lt;br/&gt;00465396 |. |2BD3 |SUB EDX,EBX&lt;br/&gt;00465398 |. |8B4D FC |MOV ECX,DWORD PTR SS:[EBP-4]&lt;br/&gt;0046539B |. |0FB64C19 FF |MOVZX ECX,BYTE PTR DS:[ECX+EBX-1]&lt;br/&gt;004653A0 |. |884C10 FF |MOV BYTE PTR DS:[EAX+EDX-1],CL&lt;br/&gt;004653A4 |. |43 |INC EBX&lt;br/&gt;004653A5 |. |83FB 06 |CMP EBX,6&lt;br/&gt;004653A8 |.^\75 DF \JNZ SHORT QuickPas.00465389&lt;br/&gt;004653AA |. BB 01000000 MOV EBX,1&lt;br/&gt;004653AF |&gt; 8D45 F0 /LEA EAX,DWORD PTR SS:[EBP-10]&lt;br/&gt;004653B2 |. 8B55 F8 |MOV EDX,DWORD PTR SS:[EBP-8]&lt;br/&gt;004653B5 |. 0FB6541A FF |MOVZX EDX,BYTE PTR DS:[EDX+EBX-1]&lt;br/&gt;004653BA |. E8 5DFDF9FF | <font color="#0000ff">CALL</font> &lt;QuickPas.system.@LStrFromChar&gt;&lt;br/&gt;004653BF |. 8B45 F0 |MOV EAX,DWORD PTR SS:[EBP-10]&lt;br/&gt;004653C2 |. E8 313FFAFF | <font color="#0000ff">CALL</font> &lt;QuickPas.SysUtils.StrToInt&gt;&lt;br/&gt;004653C7 |. 8BF0 |MOV ESI,EAX&lt;br/&gt;004653C9 |. 33F3 |XOR ESI,EBX&lt;br/&gt;004653CB |. 8D55 F4 |LEA EDX,DWORD PTR SS:[EBP-C]&lt;br/&gt;004653CE |. 8BC6 |MOV EAX,ESI&lt;br/&gt;004653D0 |. E8 E73DFAFF | <font color="#0000ff">CALL</font> &lt;QuickPas.SysUtils.IntToStr&gt;&lt;br/&gt;004653D5 |. 8D45 F8 |LEA EAX,DWORD PTR SS:[EBP-8]&lt;br/&gt;004653D8 |. E8 7300FAFF | <font color="#0000ff">CALL</font> &lt;QuickPas.system.@UniqueStringA&gt;&lt;br/&gt;004653DD |. 8B55 F4 |MOV EDX,DWORD PTR SS:[EBP-C]&lt;br/&gt;004653E0 |. 0FB612 |MOVZX EDX,BYTE PTR DS:[EDX]&lt;br/&gt;004653E3 |. 885418 FF |MOV BYTE PTR DS:[EAX+EBX-1],DL&lt;br/&gt;004653E7 |. 43 |INC EBX&lt;br/&gt;004653E8 |. 83FB 06 |CMP EBX,6&lt;br/&gt;004653EB |.^ 75 C2 \JNZ SHORT QuickPas.004653AF &lt;br/&gt;</font></code> </blockquote> <br>  Here are some transformations, etc.  Again, I present the code section I translated only in Pascal: <br><blockquote> <code><a href="http://s-c.me/23964/s"></a> <a href="http://s-c.me/23964/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt;part_of_serial:=ReverseString(hwid);&lt;br/&gt;tmp:= <font color="#A31515">''</font> ;&lt;br/&gt; <font color="#0000ff">for</font> i:= 1 <font color="#0000ff">to</font> 5 do&lt;br/&gt; <font color="#0000ff">begin</font> &lt;br/&gt;  tmp:=tmp + copy(IntToStr(StrToInt(part_of_serial[i]) xor i),1,1);&lt;br/&gt; <font color="#0000ff">end</font> ;&lt;br/&gt;part_of_serial:=copy(tmp,1,5); &lt;br/&gt;</font></code> </blockquote> <br>  In my case, the result was 41413 <br>  Go ahead, see ... <br><img src="http://img841.imageshack.us/img841/3031/20111127193118.png" alt="image"><br>  Knowing that the md5 hash function is used in the program, we check our assumption: <br>  <b>md5 (41413) = FFA54840A3C240E0725C16C7FA48281C</b> <br><img src="http://img809.imageshack.us/img809/4870/20111127193155.png" alt="image"><br>  This is clearly seen in the stack window: <br><img src="http://img14.imageshack.us/img14/3827/20111127193138.png" alt="image"><br>  We leave the function, continue tracing and see that the md5-hash from the first 5 characters of the entered serial is taken and compared with the previously received (primitive, but at least somehow). <br>  <b>md5 (abcde) = AB56B4D92B40713ACC5AF89985D4B786</b> <br><img src="http://img338.imageshack.us/img338/7721/20111127193543.png" alt="image"><br>  Now we know that the first characters of the correct serial (in my case) should be 41413. <br>  We are trying to register a program with a new serial with the foregoing: <br>  41413abcdefghijklmnop, and the mail is the same as before (ds@mail.ru). <br>  Now we are going to check at: <br><blockquote> <code><a href="http://s-c.me/23965/s"></a> <a href="http://s-c.me/23965/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt;00465563 |. E8 DCFDF9FF <font color="#0000ff">CALL</font> &lt;QuickPas.system.@LStrCmp&gt; &lt;br/&gt;</font></code> </blockquote> <br>  The program runs without prejudice and says in the About window that everything is fine, but when you click on the function buttons in the program we see the Unregistered version. <br><br>  Ok, we continue from the place where we passed the test.  We set breakpoint at 00465563 and trace further. <br>  We see two very simple pieces of code: <br><blockquote> <code><a href="http://s-c.me/23968/s"></a> <a href="http://s-c.me/23968/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt;00465595 |. BB 01000000 MOV EBX,1&lt;br/&gt;0046559A | <font color="#0000ff">&gt;</font> /8B45 EC /MOV EAX,DWORD PTR SS:[EBP-14]&lt;br/&gt;0046559D |. |0FB64418 FF |MOVZX EAX,BYTE PTR DS:[EAX+EBX-1]&lt;br/&gt;004655A2 |. |0145 E4 |ADD DWORD PTR SS:[EBP-1C],EAX&lt;br/&gt;004655A5 |. |43 |INC EBX&lt;br/&gt;004655A6 |. |83FB 06 |CMP EBX,6&lt;br/&gt;004655A9 |.^\75 EF \JNZ SHORT QuickPas.0046559A &lt;br/&gt;</font></code> </blockquote> <br><blockquote> <code><a href="http://s-c.me/23969/s"></a> <a href="http://s-c.me/23969/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt;004655BC |. BB 01000000 MOV EBX,1&lt;br/&gt;004655C1 | <font color="#0000ff">&gt;</font> 8B55 FC /MOV EDX,DWORD PTR SS:[EBP-4]&lt;br/&gt;004655C4 |. 0FB6541A FF |MOVZX EDX,BYTE PTR DS:[EDX+EBX-1]&lt;br/&gt;004655C9 |. 0155 E8 |ADD DWORD PTR SS:[EBP-18],EDX&lt;br/&gt;004655CC |. 43 |INC EBX&lt;br/&gt;004655CD |. 48 |DEC EAX&lt;br/&gt;004655CE |.^ 75 F1 \JNZ SHORT QuickPas.004655C1 &lt;br/&gt;</font></code> </blockquote> <br>  They carry out some calculations (first for characters from the 6th to 10th from the entered serial), and then from the entered e-mail. <br><br>  As a result of all this, the number 1353 and fghijklmnop are being compared, it is logical that this may be the third part of the serial number. <br>  We are trying a new serial number: 41413abcde1353 <br>  It seems everything is fine, but there is one "BUT"! <br>  When you click on the function keys for recovery, we get incomprehensible characters, such as: <br><img src="http://img256.imageshack.us/img256/2875/20111127195915.png" alt="image"><br>  It turns out that somewhere something goes wrong before outputting the results.  Let's look at the IDR event by clicking, for example, on The Bat password recovery and set a breakpoint at the beginning of the procedure. <br><img src="http://img217.imageshack.us/img217/959/20111127201055.png" alt="image"><br>  Then we go to the function at 465250 and carefully look in the stack window, and in parallel we press F8 <br>  It's hard not to notice that the first 5 characters of the serial number and the HWID are stuck together, and then the received string is considered to be an md5 hash. <br><br>  <b>md5 (4141369735) = 3354B017EB74FB4DC20A1B48491D1431</b> <br><br>  And then from the received hash is considered a certain amount: <br><br><blockquote> <code><a href="http://s-c.me/23970/s"></a> <a href="http://s-c.me/23970/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#0000ff">for</font> i:=4 <font color="#0000ff">to</font> 7 do&lt;br/&gt; <font color="#0000ff">begin</font> &lt;br/&gt;    tmp := tmp + IntToStr(ord(part2[i]));&lt;br/&gt; <font color="#0000ff">end</font> ; &lt;br/&gt;</font></code> </blockquote> <br><br>  and the first 5 characters are copied: <br><blockquote> <code><a href="http://s-c.me/23971/s"></a> <a href="http://s-c.me/23971/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#0000ff">some</font> := copy(tmp,1,5); &lt;br/&gt;</font></code> </blockquote> <br>  As a result of calculations, we get 52664 (we will return to this value). <br><br>  Further interesting challenge: <br> <code>CALL 00467A44</code> <br>  For us there is nothing interesting (this is the main function of the program that is trying to recover the password). <br>  Go ahead and look here: <br> <code>00470919 |. E8 FA4DFFFF CALL &lt;QuickPas._Unit32.sub_00465718&gt;</code> <br> <br>  Very interesting block: <br><blockquote> <code><a href="http://s-c.me/23972/s"></a> <a href="http://s-c.me/23972/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt;0046577F |. BB 01000000 MOV EBX,1&lt;br/&gt;00465784 | <font color="#0000ff">&gt;</font> 8D45 FC /LEA EAX,DWORD PTR SS:[EBP-4]&lt;br/&gt;00465787 |. E8 C4FCF9FF |CALL <font color="#0000ff">&lt;</font> <font color="#800000">QuickPas.system.</font> @UniqueStringA <font color="#0000ff">&gt;</font> &lt;br/&gt;0046578C |. 8D4418 FF |LEA EAX,DWORD PTR DS:[EAX+EBX-1]&lt;br/&gt;00465790 |. 50 |PUSH EAX&lt;br/&gt;00465791 |. 8BC3 |MOV EAX,EBX&lt;br/&gt;00465793 |. 99 |CDQ&lt;br/&gt;00465794 |. F7FF |IDIV EDI&lt;br/&gt;00465796 |. 8B45 F8 |MOV EAX,DWORD PTR SS:[EBP-8]&lt;br/&gt;00465799 |. 0FB60410 |MOVZX EAX,BYTE PTR DS:[EAX+EDX]&lt;br/&gt;0046579D |. 0FBE55 F3 |MOVSX EDX,BYTE PTR SS:[EBP-D]&lt;br/&gt;004657A1 |. F7EA |IMUL EDX&lt;br/&gt;004657A3 |. 8B55 FC |MOV EDX,DWORD PTR SS:[EBP-4]&lt;br/&gt;004657A6 |. 0FB6541A FF |MOVZX EDX,BYTE PTR DS:[EDX+EBX-1]&lt;br/&gt;004657AB |. 03C2 |ADD EAX,EDX&lt;br/&gt;004657AD |. 5A |POP EDX&lt;br/&gt;004657AE |. 8802 |MOV BYTE PTR DS:[EDX],AL&lt;br/&gt;004657B0 |. 43 |INC EBX&lt;br/&gt;004657B1 |. 4E |DEC ESI&lt;br/&gt;004657B2 |.^ 75 D0 \JNZ SHORT QuickPas.00465784 &lt;br/&gt;</font></code> </blockquote> <br>  Looking through the dump window, we understand that a primitive encryption is going on before output (although this is too loud and does not reach full-fledged encryption, but there is something in common - this message and the key with which encryption goes, so I will continue to call this block encryption). <br><img src="http://img833.imageshack.us/img833/3292/20111127202320.png" alt="image"><br>  You can explore this code in more detail, but for the final purpose (writing keygens) we don‚Äôt need this. <br><br>  Go ahead and see: <br><br><blockquote> <code><a href="http://s-c.me/23973/s"></a> <a href="http://s-c.me/23973/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt;0047093B |. E8 144DFFFF CALL <font color="#0000ff">&lt;</font> <font color="#800000">QuickPas._Unit32.sub_00465654</font> <font color="#0000ff">&gt;</font> &lt;br/&gt;</font></code> </blockquote> <br><br>  The parameter that is passed to this function is very familiar to us - these are serial number symbols from the 6th to the 10th. <br>  Intuition did not let me down, we see such a piece of code: <br><br><blockquote> <code><a href="http://s-c.me/23974/s"></a> <a href="http://s-c.me/23974/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt;004656AC |. BB 01000000 MOV EBX,1&lt;br/&gt;004656B1 | <font color="#0000ff">&gt;</font> 8D45 FC /LEA EAX,DWORD PTR SS:[EBP-4]&lt;br/&gt;004656B4 |. E8 97FDF9FF |CALL <font color="#0000ff">&lt;</font> <font color="#800000">QuickPas.system.</font> @UniqueStringA <font color="#0000ff">&gt;</font> &lt;br/&gt;004656B9 |. 8D4418 FF |LEA EAX,DWORD PTR DS:[EAX+EBX-1]&lt;br/&gt;004656BD |. 50 |PUSH EAX&lt;br/&gt;004656BE |. 8BC3 |MOV EAX,EBX&lt;br/&gt;004656C0 |. 99 |CDQ&lt;br/&gt;004656C1 |. F7FF |IDIV EDI&lt;br/&gt;004656C3 |. 8B45 F8 |MOV EAX,DWORD PTR SS:[EBP-8]&lt;br/&gt;004656C6 |. 0FB60410 |MOVZX EAX,BYTE PTR DS:[EAX+EDX]&lt;br/&gt;004656CA |. 0FBE55 F3 |MOVSX EDX,BYTE PTR SS:[EBP-D]&lt;br/&gt;004656CE |. F7EA |IMUL EDX&lt;br/&gt;004656D0 |. 8B55 FC |MOV EDX,DWORD PTR SS:[EBP-4]&lt;br/&gt;004656D3 |. 0FB6541A FF |MOVZX EDX,BYTE PTR DS:[EDX+EBX-1]&lt;br/&gt;004656D8 |. 03C2 |ADD EAX,EDX&lt;br/&gt;004656DA |. 5A |POP EDX&lt;br/&gt;004656DB |. 8802 |MOV BYTE PTR DS:[EDX],AL&lt;br/&gt;004656DD |. 43 |INC EBX&lt;br/&gt;004656DE |. 4E |DEC ESI&lt;br/&gt;004656DF |.^ 75 D0 \JNZ SHORT QuickPas.004656B1 &lt;br/&gt;</font></code> </blockquote> <br>  The same code, but in this case, it ‚Äúdecrypts‚Äù the message just before its output. <br>  It is clear that in order to obtain normal data at the output, you need to decrypt with the same key as encrypted. <br><br>  true_key = 52664 <br>  our_key = abcde <br><br>  <b>message = decrypt (crypt (message, true_key), our_key)</b> <br>  It is easy to guess that in order for message = message, true_key should equal our_key. <br><br>  In general, all the data for keygen we have, it remains to put everything in one general procedure. <br>  To facilitate, we divide some calculations into separate functions: <br><br>  1. <b>The function to get the value from the registry:</b> <br><blockquote> <code><a href="http://s-c.me/23975/s"></a> <a href="http://s-c.me/23975/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#0000ff">function</font> RegQueryStr(RootKey: HKEY; Key, Name: <font color="#0000ff">string</font> ;&lt;br/&gt;  Success: PBoolean = nil): <font color="#0000ff">string</font> ;&lt;br/&gt; <font color="#0000ff">var</font> &lt;br/&gt;  Handle: HKEY;&lt;br/&gt;  Res: LongInt;&lt;br/&gt;  DataType, DataSize: DWORD;&lt;br/&gt;begin&lt;br/&gt; <font color="#0000ff">if</font> Assigned(Success) then&lt;br/&gt;    Success^ := False;&lt;br/&gt;  Res := RegOpenKeyEx(RootKey, PChar(Key), <font color="#A31515">0</font> , KEY_QUERY_VALUE, Handle);&lt;br/&gt; <font color="#0000ff">if</font> Res &lt;&gt; ERROR_SUCCESS then&lt;br/&gt;    Exit;&lt;br/&gt;  Res := RegQueryValueEx(Handle, PChar(Name), nil, @DataType, nil, @DataSize);&lt;br/&gt; <font color="#0000ff">if</font> (Res &lt;&gt; ERROR_SUCCESS) or (DataType &lt;&gt; REG_SZ) then&lt;br/&gt;  begin&lt;br/&gt;    RegCloseKey(Handle);&lt;br/&gt;    Exit;&lt;br/&gt;  end;&lt;br/&gt;  SetString(Result, nil, DataSize - <font color="#A31515">1</font> );&lt;br/&gt;  Res := RegQueryValueEx(Handle, PChar(Name), nil, @DataType,&lt;br/&gt;    PByte(@Result[ <font color="#A31515">1</font> ]), @DataSize);&lt;br/&gt; <font color="#0000ff">if</font> Assigned(Success) then&lt;br/&gt;    Success^ := Res = ERROR_SUCCESS;&lt;br/&gt;  RegCloseKey(Handle);&lt;br/&gt;end; &lt;br/&gt;</font></code> </blockquote> <br><br>  2. <b>HWID calculation function:</b> <br><blockquote> <code><a href="http://s-c.me/23976/s"></a> <a href="http://s-c.me/23976/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#0000ff">function</font> GetHWID: string;&lt;br/&gt; <font color="#0000ff">var</font> &lt;br/&gt;SystemBiosDate,md5_sbd:String;&lt;br/&gt;i: <font color="#0000ff">integer</font> ;&lt;br/&gt;digest:pointer;&lt;br/&gt;dwSize:Cardinal;&lt;br/&gt; <font color="#0000ff">begin</font> &lt;br/&gt;  SystemBiosDate := RegQueryStr(HKEY_LOCAL_MACHINE, <font color="#A31515">'HARDWARE\DESCRIPTION\System'</font> , <font color="#A31515">'SystemBiosDate'</font> );&lt;br/&gt;    md5_sbd:=SystemBiosDate;&lt;br/&gt;      dwSize:=length(md5_sbd);&lt;br/&gt;  digest:= GetHash(@md5_sbd[1],dwSize,ALG_MD5);&lt;br/&gt; <font color="#0000ff">if</font> digest &lt;&gt; nil <font color="#0000ff">then</font> &lt;br/&gt;    try&lt;br/&gt;    md5_sbd:=BinToHexStr(digest,dwSize);&lt;br/&gt;    finally&lt;br/&gt;    FreeMem(digest);&lt;br/&gt; <font color="#0000ff">end</font> ;&lt;br/&gt;    md5_sbd:=Uppercase(md5_sbd);&lt;br/&gt; <font color="#0000ff">result</font> := <font color="#A31515">''</font> ;&lt;br/&gt; <font color="#0000ff">for</font> i:=1 <font color="#0000ff">to</font> 3 do&lt;br/&gt; <font color="#0000ff">begin</font> &lt;br/&gt; <font color="#0000ff">result</font> := <font color="#0000ff">result</font> + IntToStr(ord(md5_sbd[i]) + i*2);&lt;br/&gt; <font color="#0000ff">end</font> ;&lt;br/&gt; <font color="#0000ff">result</font> :=copy( <font color="#0000ff">Result</font> ,1,5); &lt;br/&gt; <font color="#0000ff">End</font> ; &lt;br/&gt;</font></code> </blockquote> <br><br>  3. <b>The function of receiving the reverse (reverse line):</b> <br><blockquote> <code><a href="http://s-c.me/23977/s"></a> <a href="http://s-c.me/23977/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#0000ff">function</font> ReverseString( <font color="#0000ff">const</font> s: <font color="#0000ff">string</font> ): <font color="#0000ff">string</font> ;&lt;br/&gt; <font color="#0000ff">var</font> &lt;br/&gt;  i, len: Integer;&lt;br/&gt;begin&lt;br/&gt;  len := Length(s);&lt;br/&gt;  SetLength(Result, len);&lt;br/&gt; <font color="#0000ff">for</font> i := len downto <font color="#A31515">1</font> <font color="#0000ff">do</font> &lt;br/&gt;  begin&lt;br/&gt;    Result[len - i + <font color="#A31515">1</font> ] := s[i];&lt;br/&gt;  end;&lt;br/&gt;end; &lt;br/&gt;</font></code> </blockquote> <br><br>  4. <b>Function to check whether the string is a number (for correctness of the entered data by the user):</b> <br><blockquote> <code><a href="http://s-c.me/23978/s"></a> <a href="http://s-c.me/23978/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#0000ff">function</font> IsStrANumber( <font color="#0000ff">const</font> S: <font color="#0000ff">string</font> ): Boolean;&lt;br/&gt; <font color="#0000ff">var</font> &lt;br/&gt;  P: PChar;&lt;br/&gt;begin&lt;br/&gt;  P := PChar(S);&lt;br/&gt;  Result := False;&lt;br/&gt; <font color="#0000ff">while</font> P^ &lt;&gt; # <font color="#A31515">0</font> <font color="#0000ff">do</font> &lt;br/&gt;  begin&lt;br/&gt; <font color="#0000ff">if</font> not (P^ <font color="#0000ff">in</font> [ <font color="#A31515">'0'</font> .. <font color="#A31515">'9'</font> ]) then Exit;&lt;br/&gt;    Inc(P);&lt;br/&gt;  end;&lt;br/&gt;  Result := True;&lt;br/&gt;end; &lt;br/&gt;</font></code> </blockquote> <br><br>  <b>The basic generation procedure:</b> <br><blockquote> <code><a href="http://s-c.me/23979/s"></a> <a href="http://s-c.me/23979/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt;procedure generate;&lt;br/&gt; <font color="#A31515">var</font> Serial,NameBuf: <font color="#0000ff">String</font> ;&lt;br/&gt;len,len1: <font color="#0000ff">integer</font> ;&lt;br/&gt;Textname,HWID: <font color="#0000ff">PChar</font> ;&lt;br/&gt;hw: <font color="#0000ff">String</font> ;&lt;br/&gt; <font color="#A31515">i</font> ,sum_name,sum_part2: <font color="#0000ff">integer</font> ;&lt;br/&gt;    part1,tmp,part2,part3: <font color="#0000ff">string</font> ;&lt;br/&gt;    digest: <font color="#0000ff">pointer</font> ;&lt;br/&gt;dw <font color="#ff0000">Size</font> : <font color="#0000ff">Cardinal</font> ;&lt;br/&gt;begin&lt;br/&gt;  len := GetWindowTextLengthA( <font color="#008000">TxtNameHwnd</font> );&lt;br/&gt;  len1 := GetWindowTextLengthA( <font color="#008000">txtHWID</font> );&lt;br/&gt;  if len &gt; <font color="#0000ff">1</font> then&lt;br/&gt;  begin&lt;br/&gt;  { Get text from name <font color="#A31515">input</font> }&lt;br/&gt;  GetMem( <font color="#008000">Textname, len</font> );&lt;br/&gt;  GetWindowTextA( <font color="#008000">TxtNameHwnd,PAnsiChar(Textname</font> ),len + <font color="#0000ff">1</font> );&lt;br/&gt;  GetMem( <font color="#008000">HWID, len1</font> );&lt;br/&gt;  GetWindowTextA( <font color="#008000">TxtHWID,PAnsiChar(HWID</font> ),len1 + <font color="#0000ff">1</font> );&lt;br/&gt;  HW:=String( <font color="#008000">HWID</font> );&lt;br/&gt;if ( <font color="#008000">IsStrANumber(hw</font> )) and ( <font color="#008000">length(hw</font> )= <font color="#0000ff">5</font> ) then&lt;br/&gt;  begin&lt;br/&gt;  { Generate Serial }&lt;br/&gt;  NameBuf:=String( <font color="#008000">Textname</font> );&lt;br/&gt;  hw:=string( <font color="#008000">HWID</font> );&lt;br/&gt;hw:=copy( <font color="#008000">hw,1,5</font> );&lt;br/&gt;part1:=ReverseString( <font color="#008000">hw</font> );&lt;br/&gt;tmp:= <font color="#0000ff">''</font> ;&lt;br/&gt;for <font color="#A31515">i</font> := <font color="#0000ff">1</font> to <font color="#0000ff">5</font> do&lt;br/&gt;  begin&lt;br/&gt;  tmp:=tmp + copy( <font color="#008000">IntToStr(StrToInt(part1[i]</font> ) xor <font color="#A31515">i</font> ), <font color="#0000ff">1</font> , <font color="#0000ff">1</font> );&lt;br/&gt;  end;&lt;br/&gt;part1:=copy( <font color="#008000">tmp,1,5</font> );&lt;br/&gt; <font color="#008000">//---------------------</font> &lt;br/&gt;tmp:= <font color="#0000ff">''</font> ;&lt;br/&gt;part2 :=part1+hw;&lt;br/&gt;  dw <font color="#ff0000">Size</font> :=length( <font color="#008000">part2</font> );&lt;br/&gt;  digest:= GetHash( <font color="#008000">@part2[1],dwSize,ALG_MD5</font> );&lt;br/&gt;  if digest &lt;&gt; nil then&lt;br/&gt;    try&lt;br/&gt;    part2:=BinToHexStr( <font color="#008000">digest,dwSize</font> );&lt;br/&gt;    finally&lt;br/&gt;    FreeMem( <font color="#008000">digest</font> );&lt;br/&gt;    end;&lt;br/&gt;part2 := <font color="#0000ff">UpperCase</font> ( <font color="#008000">part2</font> );&lt;br/&gt;for <font color="#A31515">i</font> := <font color="#0000ff">4</font> to <font color="#0000ff">7</font> do&lt;br/&gt;  begin&lt;br/&gt;    tmp := tmp + IntToStr( <font color="#008000">ord(part2[i]</font> ));&lt;br/&gt;  end;&lt;br/&gt;part2 := copy( <font color="#008000">tmp,1,5</font> );;&lt;br/&gt; <font color="#008000">//---------------------</font> &lt;br/&gt;sum_name:= <font color="#0000ff">0</font> ;&lt;br/&gt;sum_part2:= <font color="#0000ff">0</font> ;&lt;br/&gt;for <font color="#A31515">i</font> := <font color="#0000ff">1</font> to length( <font color="#008000">NameBuf</font> )- <font color="#0000ff">1</font> do&lt;br/&gt;  begin&lt;br/&gt;  sum_name:=sum_name + ord( <font color="#008000">NameBuf[i]</font> );&lt;br/&gt;  end;&lt;br/&gt;for <font color="#A31515">i</font> := <font color="#0000ff">1</font> to length( <font color="#008000">part2</font> ) do&lt;br/&gt;  begin&lt;br/&gt;  sum_part2:=sum_part2 + ord( <font color="#008000">part2[i]</font> );&lt;br/&gt;  end;&lt;br/&gt;part3:=IntToStr( <font color="#008000">sum_name+sum_part2</font> );&lt;br/&gt;Serial:=part1 + part2 + part3;&lt;br/&gt;  end&lt;br/&gt;  else <font color="#008000">// if hwid not numeric or &lt;&gt; 5</font> &lt;br/&gt;  Serial:= <font color="#0000ff">'Invalid HWID'</font> ;&lt;br/&gt;  { <font color="#ff0000">Display</font> The Results }&lt;br/&gt;  SetWindowTextA( <font color="#008000">TxtSerialHwnd,PChar(Serial</font> ));&lt;br/&gt;  FreeMem ( <font color="#008000">HWID, len1 + 1</font> );&lt;br/&gt;  FreeMem ( <font color="#008000">Textname, len+1</font> );&lt;br/&gt;  end&lt;br/&gt;  Else&lt;br/&gt;  { <font color="#ff0000">Display</font> Error }&lt;br/&gt;       SetWindowText( <font color="#008000">TxtSerialHwnd,'Not Enough Characters..'</font> );&lt;br/&gt;end; &lt;br/&gt;</font></code> </blockquote> <br><br>  I think everything is very clear here, since all the main points were dismantled earlier. <br>  These sections of code can cause questions: <br><blockquote> <code><a href="http://s-c.me/23980/s"></a> <a href="http://s-c.me/23980/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt;dwSize:=length(part2);&lt;br/&gt;digest:= GetHash(@part2[1],dwSize,ALG_MD5);&lt;br/&gt; <font color="#0000ff">if</font> digest &lt;&gt; nil <font color="#0000ff">then</font> &lt;br/&gt;  try&lt;br/&gt;  part2:=BinToHexStr(digest,dwSize);&lt;br/&gt;  finally&lt;br/&gt;  FreeMem(digest);&lt;br/&gt; <font color="#0000ff">end</font> ; &lt;br/&gt;</font></code> </blockquote> <br>  In short, this is an md5-hash calculation using HashCryptoAPILib, which in turn uses standard Windows tools (CryptoApi).  You can compile the keygen yourself or take it ready on tport.org in the ‚ÄúDownload‚Äù section. <br><br>  We generate a serial on any name and we test.  The program is registered, works correctly, tries to perform its functions and displays messages in a normal form.  That's all. <br><br>  I hope that the above material was interesting and that someone will learn something useful for themselves. </div><p>Source: <a href="https://habr.com/ru/post/133508/">https://habr.com/ru/post/133508/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../133502/index.html">Beta Testing iPhone Applications</a></li>
<li><a href="../133503/index.html">Work with Android string resources</a></li>
<li><a href="../133504/index.html">Work with Vkontakte.ru API in iOS application</a></li>
<li><a href="../133505/index.html">In the US, a scandal about the illegal use of user data</a></li>
<li><a href="../133506/index.html">Development of cartographic and geolocation mobile applications</a></li>
<li><a href="../133509/index.html">New Drawing Library in Google Maps API V3</a></li>
<li><a href="../133511/index.html">FINANCE.UA: a few facts about the leading financial portal of Ukraine</a></li>
<li><a href="../133512/index.html">Work with Doxygen in CMake</a></li>
<li><a href="../133514/index.html">Yandex acquired SPB Software</a></li>
<li><a href="../133515/index.html">The calendar of affairs in the ‚ÄúSimple Business‚Äù system is a convenient and visual representation of your tasks.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>