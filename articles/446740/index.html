<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using Python to generate reports in a single company</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This story happened in a real company, despite the fact that some names and events are fictitious. 

 Slava was an ordinary developer in a small firm ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using Python to generate reports in a single company</h1><div class="post__text post__text-html js-mediator-article">  This story happened in a real company, despite the fact that some names and events are fictitious. <br><br>  Slava was an ordinary developer in a small firm in the city of N. The firm was engaged in providing services to educational organizations.  In the presence of several applications that need to be maintained, modifying gradually, little by little.  But the authorities of Glory did not believe in his efforts and the fact that he eats his bread for a reason.  In addition, the bosses in information technology are not so good, but they wanted to understand what the employees are doing and how efficient the sales department (which must be said was one and a half people). <br><a name="habracut"></a><br>  The administration looked with a sly eye on the sales manager and asked: what did you do today for the Motherland?  The seller answered: he had so many meetings, offered services to so many people.  The management has come to Glory and says: tell me if the employees say the truth or so, the gag is carried.  Need statistics. <br><br>  A dialogue has taken place: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      - Users pay for the service through a third-party service for receiving online payments?  So? <br>  - So. <br>  - Does the management of the company have access to this service? <br>  - There is. <br>  - So, probably, there is an unloading of payments. <br>  - There is. <br>  - But you need to have an additional report? <br>  - Needed. <br>  - Why? <br>  - Because it is more convenient because you have to, because ‚Äúso and so‚Äù. <br><br>  In fairness, I must say that we needed additional data. <br><br>  Without hesitation, Slava executed a simple query and then selected in Excel. <br><br>  The report was a single column data collection on one page.  At first, they approached Slava in a chaotic manner, in the middle of the day and asked.  But give me a report on this organization, and now on this one.  Without hesitation, Slava decided that it was enough to endure this and that it was necessary to do something beautiful and unified that met the needs of the requesters. <br><br>  There was a small script that allowed the mailing of interested people: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> openpyxl, pymysql, os <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> smtplib <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> SMTP_SSL <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> email.mime.multipart <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MIMEMultipart <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> email.mime.base <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MIMEBase <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> email <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> encoders <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime <span class="hljs-comment"><span class="hljs-comment"># Excel Settings today = datetime.date.today().strftime('%d.%m.%Y') excel_file = 'Oplata_polzovateley_' + today + '.xlsx' # SQL settings host = '' user = '' passwd = '' db = '' port=0000 headers = ['id', 'email', '', '', ' ', ' ', '', '- ', ' '] # SMTP Mail settings smtp_server = 'smtp.gmail.com' mail_login = '' mail_passwd = '' receiver = [''] cc = [''] def main(): # Fetch Data from SQL server conn = pymysql.connect(host=host, user=user, passwd=passwd, db=db, port=port) cursor = conn.cursor() cursor.execute('''select * from table''') data = cursor.fetchall() conn.close() # Write Data to Excel file wb = openpyxl.Workbook() contractors = {} for item in data: diff = item[6] - item[5] item = list(item) # print(item) if diff.days &gt; 10: item.append('') else: item.append('') item = tuple(item) if item[0][:30] in contractors: contractors[item[0][:30]] += 1 else: wb.create_sheet(item[0][:30]) contractors[item[0][:30]] = 2 for i in range(1, len(headers) + 1): letter = openpyxl.utils.get_column_letter(i) wb[item[0][:30]][letter + '1'] = headers[i - 1] wb[item[0][:30]]['A' + str(contractors[item[0][:30]])] = contractors[item[0][:30]] - 1 for i in range(2, len(headers) + 1): letter = openpyxl.utils.get_column_letter(i) wb[item[0][:30]][letter + str(contractors[item[0][:30]])] = item[i] wb.save(excel_file) wb.remove(wb['Sheet']) wb.save(excel_file) # Compose attachment part = MIMEBase('application', "octet-stream") part.set_payload(open(excel_file, "rb").read()) encoders.encode_base64(part) part.add_header('Content-Disposition', 'attachment; filename="%s"' % os.path.basename(excel_file)) # Compose message msg = MIMEMultipart() msg['From'] = mail_login msg['To'] = ', '.join(receiver) msg['Cc'] = ', '.join(cc) msg['Subject'] = excel_file msg.attach(part) # Send mail tosend = receiver + cc smtp = SMTP_SSL('smtp.gmail.com') smtp.connect(smtp_server) smtp.login(mail_login, mail_passwd) smtp.sendmail(mail_login, tosend, msg.as_string()) smtp.quit() # Wipe file os.remove(excel_file) if __name__ == '__main__': main()</span></span></code> </pre> <br>  Made, of course, not really thought Glory.  But as the saying goes: ‚ÄúAh, and so it will come down.‚Äù <br><br>  Every morning, Slava came to work, ran the script, and sent a letter to the interested parties. <br>  The next step was to configure automatic sending.  It worked like this: <br><br>  <i>docker build --tag = reports.</i> <i><br></i>  <i>docker run -it --rm reports</i> <br>  And in words in the crown: <br>  <i>0 8 * * * docker run --rm foo</i> <br><br>  Every day at 8 am the letter went away.  The management was pretty and even started to think that Slava came to work every day at exactly 8 am, wrote reports to Excel, and then sent them to the post office.  And he did it on Saturday, and on Sunday, and in the snow, and in the rain, and in the polar night. <br><br>  <a href="https://github.com/KOVCHENKO/ReportMaker">Github</a> <br><br>  For the time being, everything was fine and the management was patient, but not for long.  Once there was a meeting at which a new order was announced.  Listen, listen and do not say that you have not heard.  Sim declare that every employee, every day must report to the higher rank, and that to the higher one.  Well, in general, you understand. <br><br>  ‚ÄúEvery day?‚Äù Glory asked. <br>  - Everyday.  - replied the head of the technical department. <br>  - Maybe not? <br>  - It is necessary Glory, it is necessary. <br><br>  Glory has a few questions about this situation.  The immediate responsibility was to refine the software and its reports should consist of something like this: <br>  <b>feat (Module) Fixed a bug in NoteLineCount ... not seriously ...</b> <b><br></b>  <b>upd (Module2) behind the curtain</b> <b><br></b>  <b>fixed (Module3) I was told, OCD, you see</b> <br>  * Note: the name of the commit messages is <a href="https://whatthecommit.com/">taken from here.</a> <br><br>  Slava decided that he would draw up a report based on them.  A week has passed.  There was a new conversation about this content: <br><br>  - Here you send reports every day, but progress is not visible.  What for example is: ‚Äúa mask was added when entering a phone number on the front end‚Äù. <br>  - Well, look here.  Previously, you had to enter your phone number and check the number of dials and was uncomfortable.  And so - it is convenient. <br>  - Hmm.  Good.  Clear.  And how do you explain this: ‚ÄúRefactoring the code for the Counterparty module.  The function for validation is in a separate method. ‚Äù <br>  - Well, you see.  There is such a thing - version control system, which indicates who did what, when and what.  Look here.  Here are commits, and here is the code that has been changed.  Here is the code added, here is the code deleted. <br>  - Good.  Let us then so.  Make a report on the basis of these your commits, and then we will gather and check how you wrote there. <br><br>  In the end - it turned out this: <br><br>  <a href="https://github.com/KOVCHENKO/ReportMaker/tree/master/git_report"><b>Github</b></a> <br><br>  The script took changes in the repository and sent a letter about what was done and what was not. <br><br>  Earlier, Glory was ashamed to report that those who will check nothing at all do not understand in writing the code.  Maybe the management understands sales, purchases and other stuff and pays money, but there will be certain lines of code in a not very familiar language, to watch how the green and red lines flicker when switching from commit to commit. <br><br>  Yes, Slava is a responsible person and the work worked, but there were these days when the code was being finalized with difficulty or was too lazy.  Anyway, in general, the system worked without failures and did not want to add another 15 layers of abstraction, but reports needed to be sent every day. <br><br>  There was nothing to do how to become a new Mayakovsky and write a gag with a ladder.  But every day I didn‚Äôt want to invent something new.  As a result, Vyacheslav began to develop the first solution, which came to mind and turned out to be a simple code, where, in the absence of any kind of work performed and no changes started, a report was compiled.  It looked like this: <br><br>  <a href="https://github.com/KOVCHENKO/ReportMaker/tree/faker">Github</a> <br><br>  It was necessary to make so that the fake code with the subsequent kommita was formed.  Do I need to do this?  Time will tell. <br><br>  PS: The story of Glory is not over.  There were several other events that influenced his fate, but this is a completely different story.  It is interesting to read in the comments similar life stories and decisions that were created based on them.  It is possible that the project will be further developed on the basis of these comments. </div><p>Source: <a href="https://habr.com/ru/post/446740/">https://habr.com/ru/post/446740/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../446722/index.html">Testing will show: how to prepare for the implementation of Cisco ISE and understand what features of the system you need</a></li>
<li><a href="../446728/index.html">How does the received power from the wireless charging, depending on the location of the phone</a></li>
<li><a href="../446730/index.html">Backend section on DUMP: Serverless, Postgres and Go, .NET Core, GraphQL and more</a></li>
<li><a href="../446732/index.html">Feropods will not help: research and mathematical modeling of ant lion larvae pits</a></li>
<li><a href="../446738/index.html">The basics of natural language processing for text</a></li>
<li><a href="../446742/index.html">Top 3D Expo 2019 Topics: ‚ÄúAnisprinting - a new generation composite construction technology‚Äù, Fedor Antonov</a></li>
<li><a href="../446744/index.html">VR with neural interfaces - total immersion in virtual reality</a></li>
<li><a href="../446746/index.html">A UBS employee overheard a Eurostar neighbor conversation and found out about a $ 15 billion deal. Now he and the bank will be fined</a></li>
<li><a href="../446750/index.html">Lead from the bottom: IT giants began to actively build their own underwater backbone networks</a></li>
<li><a href="../446752/index.html">Tracing Services, OpenTracing and Jaeger</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>