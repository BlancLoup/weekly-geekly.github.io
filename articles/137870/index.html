<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>JavaScript | HTML Preprocessor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear friends! 

 One wonderful day at one wonderful hour there was an urgent need for JS | HTML preprocessor and, as usual, the search for a re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>JavaScript | HTML Preprocessor</h1><div class="post__text post__text-html js-mediator-article"><h4>  Hello, dear friends! <br></h4><br>  One wonderful day at one wonderful hour there was an urgent need for JS | HTML preprocessor and, as usual, the search for a ready-made solution was not crowned with success, something was missing everywhere (there were no global variables, string insertion, string replacement, import, etc.) ).  Well, since I am a severe Yakut guy, there was only one way out - to do everything myself.  Well?  Well, the result of my work, I decided to put on the opinion of the community. <br><a name="habracut"></a><br><h4>  Introduction </h4><br><br>  The preprocessor is designed for js (json) and html (xhtml) files, these files must be with the appropriate extensions.  The preprocessor supports the following range of functions: <br><br><ul><li>  Insertion by condition and without (multi-line support) </li><li>  Replacing string \ strings \ substrings by condition and without (replacing part of string / strings is supported (yes, one control construct can replace parts at once in a set of strings) that satisfies a regular expression) </li><li>  Global variables (defined in a separate file) and local variables defined within the file (have higher priority) are supported. </li><li>  Import file by condition and without, while css files, with appropriate settings in the control structure, are framed with the style tag </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Comments are used to insert control structures; therefore, they do not interfere with the operation of the code prior to processing by the preprocessor. <br><br><h4>  Startup method </h4><br><br>  The preprocessor is a usual groovy script that needs one mandatory argument: <br><br>  <b>project.sourceDir</b> - path to the initial directory in which the replacement will take place. <br><br>  and you can also specify two optional <br><br>  <b>project.confFile</b> - path to the global config file. <br>  <b>project.excludeDir</b> - comma-separated folder names that do not need to be replaced (I‚Äôll say right away that this is the folder name of the lowest level, the path to this folder is not taken into account, but minus, but I will try to finish it). <br><br>  You can also use maven to run past standard tools. <br><br><h4>  Operations </h4><br><br>  <b>Attention attributes in operations should follow a strict order (the order will be described opposite to the command below), but optional attributes (pattern, if, type) can be not used, below I will mark them?</b>  In any operation except define, the last attribute can be if = ^ condition ^, where condition is a condition, if it is written in the key = value format, then the operation will be executed if the value of a global or local variable named key matches value, otherwise the operation will be executed if there is a global or local variable named condition. <br><br>  Next, I will give a complete set of operations and their use in the examples, I will not give examples with <b>if</b> since I described above how to use it. <br><br>  The opening and closing control structures must be on different lines, the text to be inserted / replaced must be between them! <br><br><h5>  Insert (insert? If) </h5><br><h6>  Examples of using: </h6><br><br><h6>  html </h6><br><br><pre><code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!--insert &lt;script type="text/javascript" src="vendors/release/dojo/dojo-mini.js" &gt;&lt;/script&gt; &lt;script type="text/javascript" src="vendors/release/dijit/dijit-mini.js" &gt;&lt;/script&gt; &lt;script type="text/javascript" src="vendors/release/dojox/dojox-mini.js" &gt;&lt;/script&gt; /insert--&gt;</span></span></code> </pre> <br><br><h6>  js </h6><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*insert var mode = 'dev' /insert*/</span></span></code> </pre><br><br><h5>  Replace (replace to? Pattern? If) </h5><br>  <b>to</b> - the string to be replaced (supports placeholders) <br>  <b>pattern</b> - pattern for substring replacement <br><br><h6>  Examples </h6><br><br><h6>  html </h6><br><br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!--replace to=^&lt;script type="text/javascript" src="vendors/release/dojox/dojox-mini.js" &gt;&lt;/script&gt;^--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vendors/release/dojox/dojox-mini.js"</span></span></span><span class="hljs-tag"> &gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--/replace--&gt;</span></span></code> </pre><br><br>  Replaces everything between the control comments with the value of the <b>to</b> attribute. <br><br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!--replace to=^/release/^ pattern=^/dev/^--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vendors/dev/dijit/themes/tundra/tundra.css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vendors/dev/dojox/grid/resources/Grid.css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vendors/dev/dojox/image/resources/Lightbox.css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--/replace--&gt;</span></span></code> </pre><br><br>  Replaces all substrings matching the value of the <b>pattern</b> attribute with the value of the <b>to</b> attribute in each line between comments. <br><br><h6>  js </h6><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.appVersion = <span class="hljs-comment"><span class="hljs-comment">/*replace to=^${project.version}^*/</span></span><span class="hljs-number"><span class="hljs-number">0.6</span></span><span class="hljs-comment"><span class="hljs-comment">/*\replace*/</span></span>;</code> </pre><br><br>  Replaces the line between control comments with the value of the <b>to</b> attribute. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*replace to=^dojo^ pattern=^dijit^*/</span></span> dojo.require(<span class="hljs-string"><span class="hljs-string">"dijit.layout.LayoutContainer"</span></span>); dojo.require(<span class="hljs-string"><span class="hljs-string">"dijit.layout.ContentPane"</span></span>); dojo.require(<span class="hljs-string"><span class="hljs-string">"dijit.form.TextBox"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*/replace*/</span></span></code> </pre><br><br>  Replaces all substrings matching the value of the pattern attribute with the value of the <b>to</b> attribute in each line between comments. <br><br><h5>  Import files (import file? Type? If) </h5><br>  <b>file</b> - the path to the file, it is best to write absolute (supports placeholders) <br>  <b>type</b> - file type, additional processing of the file depends on it (at the moment, the css type is supported, and the contents of the file are packaged in one line and framed with the style tag <br><br><h6>  Examples </h6><br><h6>  html </h6><br><br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!--import file=^path^ type=^css^--&gt;</span></span></code> </pre><br><br><h6>  js </h6><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//import file=^path^ type=^css^</span></span></code> </pre><br><br><h5>  Local Variables (define key = value | key) </h5><br>  Initialization of a local variable (its scope is the current file).  If only a key is specified, an empty variable will be created. <br>  <b>key</b> - variable name <br>  <b>value</b> - value <br><br><h6>  Examples </h6><br><h6>  html </h6><br><br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!--define debug=true--&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--define env=qa--&gt;</span></span></code> </pre><br><br><h6>  js </h6><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//define debug=true //define env=qa</span></span></code> </pre><br><br>  I note that local variables are initialized sequentially from top to bottom in the same file parsing run, that is, if the variable is defined in the middle of the file, then it cannot be used in the control structures above. <br><br><h5>  Global variables </h5><br><br>  The preprocessor can specify a file that contains global variables that can be used in operations. <br><br>  Example of specifying a file with variables using maven (command line arguments can be used) <br><br><pre> <code class="javascript hljs">&lt;project.confPath&gt;${pom.basedir}/configuration/qa.json&lt;<span class="hljs-regexp"><span class="hljs-regexp">/project.confPath&gt;</span></span></code> </pre><br><br><h6>  File format </h6><br><br>  key0: value0 <br>  key1: value1 <br><br><h5>  Use of placeholders </h5><br><br> <code>window.appVersion = /*replace to=^${version}^*/0.6/*/replace*/;</code> <br> <br>  The expression <b>$ {version}</b> will be replaced with the value of the corresponding global or local variable. <br><br>  In addition, there is support for operations on variables, currently only one is implemented - removing quotes from the end and beginning of the variable value: <br>  $ {rootPath: <b>removeQuotes</b> } <br><br><h4>  Conclusion </h4><br>  Well, in principle, and all, if anyone comes in handy, I will be glad, for the found bugs and suggestions I will be grateful. <br><br><h4>  Github </h4><br>  Source and test pages: <a href="https://github.com/iseeyou911/JSPP">github.com/iseeyou911/JSPP</a> <br>  The configuration file tests / qa.json.  To import to index.html you need to fix <br>  in line <br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!--define path=../tests/--&gt;</span></span></code> </pre> <br>  absolute path to this folder. </div><p>Source: <a href="https://habr.com/ru/post/137870/">https://habr.com/ru/post/137870/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137863/index.html">Background Information Update</a></li>
<li><a href="../137864/index.html">Pseudorandom vs. Truly Random</a></li>
<li><a href="../137865/index.html">CISM certification experience</a></li>
<li><a href="../137868/index.html">Determining the dominant tones in the image [v 1.1]</a></li>
<li><a href="../137869/index.html">Windows Phone 7 XNA: we are pixels or not shaders</a></li>
<li><a href="../137871/index.html">Digital October - the lair of crazy ideas and coworking center</a></li>
<li><a href="../137875/index.html">We integrate Copy-Paste-Detection into Xcode, and not only</a></li>
<li><a href="../137876/index.html">Startup - Abstruse Goose</a></li>
<li><a href="../137878/index.html">OMG !!! And they want to compete on the web without supporting Chrome ?!</a></li>
<li><a href="../137879/index.html">Not a single SaaS ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>