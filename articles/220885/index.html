<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Use RestKit 0.22.x to view Marvel heroes.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Web services, in particular using the REST architecture, have already firmly entered our lives. When developing a client application for iOS, one way ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Use RestKit 0.22.x to view Marvel heroes.</h1><div class="post__text post__text-html js-mediator-article">  Web services, in particular using the <b>REST</b> architecture, have already firmly entered our lives.  When developing a client application for iOS, one way or another, it is often necessary to download data from the server and store / display it locally.  At the same time, I want to do this easily and naturally, without resorting to the invention of my own ‚Äúbicycles‚Äù. <br><br>  The latest version of the well-known Objective-C <b>RestKit</b> framework for iOS and OSX greatly simplifies working with the RESTful API.  Undoubtedly, one of its most valuable features is the ability to automatically save objects to a local database using <b>CoreData</b> .  Let's make a journey from receiving data from the server to saving and displaying them on our iOS device.  And so that we would not be bored, as an example, we will work with the API of the world famous company for the production of comics Marvel. <br><br>  The article is a kind of tutorial.  It is assumed that the reader is already familiar with the basic concepts of development in Objective-C, using the iOS SDK, Core Data, and such concepts as blocks. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/5ee/925/75c/5ee92575ca0c780d985b34e2d601c379.jpg"><br><a name="habracut"></a><br><h4>  1. Get Marvel keys and formulate the task </h4><br>  First, let's register as a developer on the <a href="http://developer.marvel.com/">Marvel</a> website. <br>  After trivial registration, go to the <a href="https://developer.marvel.com/account">Account</a> tab and copy our public and private keys. <br><img src="https://habrastorage.org/getpro/habr/post_images/91d/09b/fc6/91d09bfc67503141f8423c184292e360.png"><br>  After that, go to the tab <a href="http://developer.marvel.com/docs">Interactive Documentation</a> and see what data we kindly provide the creators of the API.  We have the opportunity to work with a database of heroes, comics, creators, events and much more.  For us, it‚Äôs enough to ‚Äútouch‚Äù one thing, so the future application will simply load the list of characters, save it, and also display a description of the most popular ones. <br><br><h4>  2. Getting started </h4><br>  Create a new project in Xcode.  We‚Äôll select the iPhone as the device and don‚Äôt forget to leave a tick next to the ‚Äúuse Core Data‚Äù field in the project creation wizard. <br><br>  Now back to the portal and consider the structure of the <a href="http://developer.marvel.com/docs"><code>Character</code></a> object: <br><div class="spoiler">  <b class="spoiler_title">Character object</b> <div class="spoiler_text"><pre> <code class="javascript hljs">Character { id (int, optional): The unique ID <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> the character resource., name (string, optional): The name <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> the character., description (string, optional): A short bio or description <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> the character., modified (<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>, optional): The date the resource was most recently modified., resourceURI (string, optional): The canonical URL identifier <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> resource., urls (<span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>[Url], optional): A set <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> public web site URLs <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the resource., thumbnail (Image, optional): The representative image <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> character., comics (ComicList, optional): A resource list containing comics which feature <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> character., stories (StoryList, optional): A resource list <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> stories <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> which <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> character appears., events (EventList, optional): A resource list <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> events <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> which <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> character appears., series (SeriesList, optional): A resource list <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> series <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> which <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> character appears. }</code> </pre></div></div>  What of this we may need?  Perhaps we confine ourselves to the identifier, name, picture and description.  Let's move on to our * .xcdatamodeld file in XCode and create a <code>Character</code> entity that will logically correspond (albeit partially) to our remote object. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5e3/b98/14a/5e3b9814aecc0f29265859d0bf1062bb.png"><br>  I specifically created two identifiers: the first, the <code>charID</code> , will serve to store the ‚Äúnative Marvel's‚Äù <code>id</code> for the future, the second, the <code>innerID</code> , will be needed for local use.  The <code>charDescription</code> and name attributes correspond to the remote description and name parameters, respectively. <br>  Notice that I also created two <code>thumbnailImageData</code> and <code>thumbnailURLString</code> attributes, although they do not match any parameters of the original structure.  This is because in the JSON response, the <code>thumbnail</code> of the <code>Image</code> type and in reality corresponds to the dictionary.  Here is an example of a <code>thumbnail</code> object from a real answer: <br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"thumbnail"</span></span>: { <span class="hljs-string"><span class="hljs-string">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://i.annihil.us/u/prod/marvel/i/mg/8/c0/4ce5a0e31f109"</span></span>, <span class="hljs-string"><span class="hljs-string">"extension"</span></span>: <span class="hljs-string"><span class="hljs-string">"jpg"</span></span> }</code> </pre><br>  In the following we will show how we will work with this. <br><br>  Now, in order to work correctly with Core Data entities, it is also necessary to create an Objective-C class that will represent it.  Create a <code>Character</code> class that will inherit from <code>NSManagedObject</code> .  Here is his announcement: <br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Character</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSManagedObject</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *_thumbnailDictionary; } <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *name; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSNumber</span></span> *charID; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSNumber</span></span> *innerID; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *charDescription; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSData</span></span> *thumbnailImageData; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *thumbnailURLString; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> <span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *thumbnailDictionary; <span class="hljs-comment"><span class="hljs-comment">//       + (NSInteger)allCharsCountWithContext:(NSManagedObjectContext *)managedObjectContext; //     innerID. + (Character *)charWithManagedObjectContext:(NSManagedObjectContext *)context andInnerID:(NSInteger)charInnerID; @end</span></span></code> </pre><br>  Here, in addition to the obvious correspondences, the property <code>thumbnailDictionary</code> appeared, which I added for more convenient work with the object thumbnail, which I wrote about a little higher.  I also added two auxiliary class methods to not create additional classes in the project. <br><br><h4>  3. Model for working with RestKit </h4><br>  Connect to our project RestKit (hereinafter - RK).  How to do this is described in detail <a href="https://github.com/RestKit/RestKit/wiki/Installing-RestKit-v0.20.x-as-a-Git-Submodule">here</a> (or <a href="https://github.com/RestKit/RestKit/wiki/Installing-RestKit-v0.20.x-via-CocoaPods">here</a> , if you are a CocoaPods lover). <br><br>  The next step is to create a wrapper class <code>GDMarvelRKObjectManager</code> (inherited from <code>NSObject</code> ), which will work with RK, in particular with classes such as <a href="http://restkit.org/api/latest/Classes/RKObjectManager.html"><code>RKObjectManager</code></a> and <a href="http://restkit.org/api/latest/Classes/RKManagedObjectStore.html"><code>RKManagedObjectStore</code></a> .  This class can also not be created, however we will go for it to slightly unload the code in our future main view controller. <br><br>  A little about the classes RK.  <code>RKManagedObjectStore</code> encapsulates all work with Core Data, so that in the future there will be no need to work with <code>NSManagedObjectContext</code> or <code>NSManagedObjectModel</code> directly.  <code>RKObjectManager</code> provides a centralized interface for sending requests and receiving responses using object mapping (matching).  For example, the necessary values ‚Äã‚Äãreceived in the JSON response will be automatically assigned to all properties of our object when the mapping is successful.  Isn't that what we wanted at the beginning of the article? <br>  Do not forget to include the RK <code>#import &lt;RestKit/RestKit.h&gt;</code> in your * .h file. <br>  Our wrapper class will have no properties, but will have two instance variables: <br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GDMarvelRKObjectManager</span></span></span><span class="hljs-class"> </span></span>{ RKObjectManager *objectManager; RKManagedObjectStore *managedObjectStore; }</code> </pre><br>  Let's take a look at what we need to set up so that everything works as it should. <br>  To begin with <code>- (id)init</code> add the initialization of the necessary RK objects to the <code>- (id)init</code> method: <br><pre> <code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">//  AFNetworking HTTPClient NSURL *baseURL = [NSURL URLWithString:@"http://gateway.marvel.com/"]; AFHTTPClient *client = [[AFHTTPClient alloc] initWithBaseURL:baseURL]; // RKObjectManager objectManager = [[RKObjectManager alloc] initWithHTTPClient:client];</span></span></code> </pre><br>  Now our requests will be sent.  What about working with Core Data?  Let's create a method that configures an object of type RKManagedObjectStore. <br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)configureWithManagedObjectModel:(<span class="hljs-built_in"><span class="hljs-built_in">NSManagedObjectModel</span></span> *)managedObjectModel { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!managedObjectModel) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; managedObjectStore = [[RKManagedObjectStore alloc] initWithManagedObjectModel:managedObjectModel]; <span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> *error; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!RKEnsureDirectoryExistsAtPath(RKApplicationDataDirectory(), &amp;error)) RKLogError(<span class="hljs-string"><span class="hljs-string">@"Failed to create Application Data Directory at path '%@': %@"</span></span>, RKApplicationDataDirectory(), error); <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *path = [RKApplicationDataDirectory() stringByAppendingPathComponent:<span class="hljs-string"><span class="hljs-string">@"RKMarvel.sqlite"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (![managedObjectStore addSQLitePersistentStoreAtPath:path fromSeedDatabaseAtPath:<span class="hljs-literal"><span class="hljs-literal">nil</span></span> withConfiguration:<span class="hljs-literal"><span class="hljs-literal">nil</span></span> options:<span class="hljs-literal"><span class="hljs-literal">nil</span></span> error:&amp;error]) RKLogError(<span class="hljs-string"><span class="hljs-string">@"Failed adding persistent store at path '%@': %@"</span></span>, path, error); [managedObjectStore createManagedObjectContexts]; objectManager.managedObjectStore = managedObjectStore; }</code> </pre><br>  The last line is very important.  It connects two of our main RK objects: <code>objectManager</code> and <code>managedObjectStore</code> . <br><br>  So, our further task is to create an interface for two main actions in our <code>GDMarvelRKObjectManager</code> class: adding a mapping (correspondence) between the Core Data entity and a remote object, as well as receiving these objects from a remote server. <br>  The first task is implemented in the following method: <br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)addMappingForEntityForName:(<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *)entityName andAttributeMappingsFromDictionary:(<span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *)attributeMappings andIdentificationAttributes:(<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *)ids andPathPattern:(<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *)pathPattern { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!managedObjectStore) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; RKEntityMapping *objectMapping = [RKEntityMapping mappingForEntityForName:entityName inManagedObjectStore:managedObjectStore]; <span class="hljs-comment"><span class="hljs-comment">// ,    . [objectMapping addAttributeMappingsFromDictionary:attributeMappings]; // ,    .   ,       . objectMapping.identificationAttributes = ids; //   ,           . RKResponseDescriptor *characterResponseDescriptor = [RKResponseDescriptor responseDescriptorWithMapping:objectMapping method:RKRequestMethodGET pathPattern:[NSString stringWithFormat:@"%@%@", MARVEL_API_PATH_PATTERN, pathPattern] keyPath:@"data.results" statusCodes:[NSIndexSet indexSetWithIndex:200]]; [objectManager addResponseDescriptor:characterResponseDescriptor]; }</span></span></code> </pre><br><br>  Here we are interested in several parameters of the <code>responseDescriptorWithMapping:...</code> method <code>responseDescriptorWithMapping:...</code> First, the <code>pathPattern</code> parameter.  It is obtained by concatenating the <code>MARVEL_API_PATH_PATTERN</code> macro (with the value of <code>@"v1/public/"</code> ) and the input parameter <code>pathPattern</code> , which in our example will be equal to <code>@"characters"</code> .  If we want to get not a list of characters, but, say, a list of comics, then we will transmit the string <code>@‚Äùcomics‚Äù</code> , which is already in the body of the method again connected with <code>@"v1/public/"</code> . <br>  The second non-obvious value is the <code>@"data.results"</code> parameter for the <code>keyPath</code> parameter.  Where did it come from?  It's very simple: Marvel wraps all its answers in the same type of wrapper, and everything will fall into place when we look at its structure: <br><div class="spoiler">  <b class="spoiler_title">Characters wrapper</b> <div class="spoiler_text"><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"code"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"status"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"copyright"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"attributionText"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"attributionHTML"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"data"</span></span>: { <span class="hljs-string"><span class="hljs-string">"offset"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"limit"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"total"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"count"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"results"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"modified"</span></span>: <span class="hljs-string"><span class="hljs-string">"Date"</span></span>, <span class="hljs-string"><span class="hljs-string">"resourceURI"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"urls"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"thumbnail"</span></span>: { <span class="hljs-string"><span class="hljs-string">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"extension"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span> }, <span class="hljs-string"><span class="hljs-string">"comics"</span></span>: { <span class="hljs-string"><span class="hljs-string">"available"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"returned"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"collectionURI"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"items"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"resourceURI"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span> } ] }, <span class="hljs-string"><span class="hljs-string">"stories"</span></span>: { <span class="hljs-string"><span class="hljs-string">"available"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"returned"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"collectionURI"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"items"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"resourceURI"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span> } ] }, <span class="hljs-string"><span class="hljs-string">"events"</span></span>: { <span class="hljs-string"><span class="hljs-string">"available"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"returned"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"collectionURI"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"items"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"resourceURI"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span> } ] }, <span class="hljs-string"><span class="hljs-string">"series"</span></span>: { <span class="hljs-string"><span class="hljs-string">"available"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"returned"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"collectionURI"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"items"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"resourceURI"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span> } ] } } ] }, <span class="hljs-string"><span class="hljs-string">"etag"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span> }</code> </pre></div></div><br>  Now it is clear that before reaching the actual list of heroes, RK will have to go through the dictionaries for several levels down to get to the desired structure.  The value of <code>@"data.results"</code> just indicates the path that you need to "go down". <br><br>  The second method of our class for working with an internal RK object is <code>getMarvelObjectsAtPath</code> , which essentially proxies a call to an <code>getObjectsAtPath</code> object of type <code>RKObjectManager</code> .  The name of the method is ‚Äúspeaking‚Äù - you are waiting for it to load remote objects.  Since Marvel <a href="http://developer.marvel.com/documentation/authorization">requires</a> that hash, timestamp and public key be sent to each request, it is convenient to encapsulate the generation of these parameters in our <code>getMarvelObjectsAtPath</code> .  Here he is: <br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)getMarvelObjectsAtPath:(<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *)path parameters:(<span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *)params success:(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^)(RKObjectRequestOperation *operation, RKMappingResult *mappingResult))success failure:(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^)(RKObjectRequestOperation *operation, <span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> *error))failure { <span class="hljs-comment"><span class="hljs-comment">//    NSDateFormatter *formatter = [[NSDateFormatter alloc] init]; [formatter setDateFormat:@"yyyyMMddHHmmss"]; NSString *timeStampString = [formatter stringFromDate:[NSDate date]]; NSString *hash = [[[NSString stringWithFormat:@"%@%@%@", timeStampString, MARVEL_PRIVATE_KEY, MARVEL_PUBLIC_KEY] MD5String] lowercaseString]; NSMutableDictionary *queryParams = [NSMutableDictionary dictionaryWithDictionary:@{@"apikey" : MARVEL_PUBLIC_KEY, @"ts" : timeStampString, @"hash" : hash}]; if (params) [queryParams addEntriesFromDictionary:params]; //      objectManager     [objectManager getObjectsAtPath:[NSString stringWithFormat:@"%@%@", MARVEL_API_PATH_PATTERN, path] parameters:queryParams success:success failure:failure]; }</span></span></code> </pre><br>  Note that the code uses a method from a non-standard category above <code>NSString</code> - <code>MD5String</code> .  How to generate MD5-troku from the line, <a href="http://lmgtfy.com/%3Fq%3DObjective%2BC%2BMD5%2BNSString">look on the Internet</a> . <br>  Our class will still have a simple method <code>- (NSManagedObjectContext *)managedObjectContext</code> , which will return the main context of the <code>managedObjectStore</code> .  This class will also be a singleton with the <code>+ (GDMarvelRKObjectManager *)manager</code> method <code>+ (GDMarvelRKObjectManager *)manager</code> for accessing the instance. <br><br><h4>  4. Main ViewController </h4><br>  To begin with, we will create a basic <code>GDBaseViewController</code> controller, in which we simply embed support for the animation of waiting for a response from the server with the only new method <code>- (void)animateActivityIndicator:(BOOL)animate</code> .  In the <code>viewDidLoad</code> method, <code>viewDidLoad</code> will create this indicator of the <code>UIActivityIndicatorView</code> type, assign the obtained value to the instance variable <code>UIActivityIndicatorView *activityIndicator</code> and add it to <code>self.view</code> . <br>  In the method of turning on / off the animation itself there will be the following code: <br><div class="spoiler">  <b class="spoiler_title">animateActivityIndicator: code</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)animateActivityIndicator:(<span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span>)animate { activityIndicator.hidden = !animate; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (animate) { [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view bringSubviewToFront:activityIndicator]; [activityIndicator startAnimating]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> [activityIndicator stopAnimating]; }</code> </pre></div></div><br>  Now, when we call this method with a <code>YES</code> value for a single parameter, our controller view will look like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/f8f/13d/ea4/f8f13dea4106e51d7002993fd746554c.png"><br><br>  Next, create a <code>GDMainViewController</code> controller <code>GDMainViewController</code> inherited from this class.  Here is his announcement: <br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GDMainViewController</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GDBaseViewController</span></span></span><span class="hljs-class"> &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewDataSource</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewDelegate</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIAlertViewDelegate</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">UITableView</span></span> *table; <span class="hljs-built_in"><span class="hljs-built_in">NSInteger</span></span> numberOfCharacters; AllAroundPullView *bottomPullView; <span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span> noRequestsMade; } <span class="hljs-keyword"><span class="hljs-keyword">@end</span></span></code> </pre><br>  In this view controller, we will display data from the database.  To do this, we will use an instance of <code>UITableView</code> , in which a picture and the name of each of the characters are displayed in each cell.  But they must also be downloaded, since the local database is initially empty.  After the entire initialization process inherent in instantiating the <code>UITableView</code> in the method <code>- (void)viewDidLoad</code> , we first assign our CoreData model to <code>RKManagedObjectStore</code> using our wrapper class <code>GDMarvelRKObjectManager</code> : <br><pre> <code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">NSURL</span></span> *modelURL = [[<span class="hljs-built_in"><span class="hljs-built_in">NSBundle</span></span> mainBundle] URLForResource:<span class="hljs-string"><span class="hljs-string">@"Marvel"</span></span> withExtension:<span class="hljs-string"><span class="hljs-string">@"momd"</span></span>]; [[GDMarvelRKObjectManager manager] configureWithManagedObjectModel:[[<span class="hljs-built_in"><span class="hljs-built_in">NSManagedObjectModel</span></span> alloc] initWithContentsOfURL:modelURL]]; <span class="hljs-comment"><span class="hljs-comment">//        Character: [[GDMarvelRKObjectManager manager] addMappingForEntityForName:@"Character" andAttributeMappingsFromDictionary:@{ @"name" : @"name", @"id" : @"charID", @"thumbnail" : @"thumbnailDictionary", @"description" : @"charDescription" } andIdentificationAttributes:@[@"charID"] andPathPattern:MARVEL_API_CHARACTERS_PATH_PATTERN];</span></span></code> </pre><br>  As you can see, as a parameter <code>andAttributeMappingsFromDictionary:</code> the dictionary is transferred, consisting of the correspondences between the names of the JSON-keys of the remote object and the properties of the class we created.  As the parameter <code>andPathPattern:</code> the string <code>@"characters"</code> is passed (macro <code>MARVEL_API_CHARACTERS_PATH_PATTERN</code> ) - the name of the remote JSON object. <br><br>  After we added the mapping, call the method <code>[self loadCharacters]</code> . <br>  Consider in detail what he does: <br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)loadCharacters { numberOfCharacters = [Character allCharsCountWithContext:[[GDMarvelRKObjectManager manager] managedObjectContext]]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (noRequestsMade &amp;&amp; numberOfCharacters &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { noRequestsMade = <span class="hljs-literal"><span class="hljs-literal">NO</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> animateActivityIndicator:<span class="hljs-literal"><span class="hljs-literal">YES</span></span>]; noRequestsMade = <span class="hljs-literal"><span class="hljs-literal">NO</span></span>; [[GDMarvelRKObjectManager manager] getMarvelObjectsAtPath:MARVEL_API_CHARACTERS_PATH_PATTERN parameters:@{<span class="hljs-string"><span class="hljs-string">@"offset"</span></span> : @(numberOfCharacters)} success:^(RKObjectRequestOperation *operation, RKMappingResult *mappingResult) { [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> animateActivityIndicator:<span class="hljs-literal"><span class="hljs-literal">NO</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">NSInteger</span></span> newInnerID = numberOfCharacters; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Character *curCharacter <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> mappingResult.array) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([curCharacter isKindOfClass:[Character <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>]]) { curCharacter.innerID = @(newInnerID); newInnerID++; <span class="hljs-comment"><span class="hljs-comment">//     (     ),   ,        [self saveToStore]; } } numberOfCharacters = newInnerID; [table reloadData]; bottomPullView.hidden = NO; [bottomPullView finishedLoading]; } failure:^(RKObjectRequestOperation *operation, NSError *error) { [bottomPullView finishedLoading]; [[[UIAlertView alloc] initWithTitle:@"Marvel API Error" message:operation.error.localizedDescription delegate:self cancelButtonTitle:@"Cancel" otherButtonTitles:@"Retry", nil] show]; }]; }</span></span></code> </pre><br>  First we get the total number of characters from the local database; this value will correspond to the number of cells in the main table.  When you first start the application, it will naturally be zero.  We will use the same value as the transmitted parameter offset when accessing the server.  Thus, for each subsequent request, the Marvel server will return only new objects of heroes (by default, the characters return in batches of 20 pieces each). <br>  Next, we produce the same main query using our <code>getMarvelObjectsAtPath</code> wrapper <code>getMarvelObjectsAtPath</code> : <br>  This method has two important parameters for us now: success: and failure :, which are blocks that describe the behavior of the successful and unsuccessful results of the query execution, respectively.  So, if we successfully receive an array of characters, we generate <code>innerID</code> for each of them, save them to a local database and change the value of the total number of heroes.  Then update the display of our table.  The main magic here is that at this stage, the resulting objects were automatically saved in our CoreData storage ‚Äî RK did it for us.  (It should be noted that this applies only to those fields / properties of the object for which the mapping matches are set. Thus, in the code above, the change of the <code>innerID</code> parameter <code>innerID</code> be saved separately by calling <code>[self saveToStore]</code> ). <br>  In the event of an error, we simply output it to the user and do not update the table. <br><br>  The code uses the save to storage method: <br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)saveToStore { <span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> *saveError; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (![[[GDMarvelRKObjectManager manager] managedObjectContext] saveToPersistentStore:&amp;saveError]) XLog(<span class="hljs-string"><span class="hljs-string">@"%@"</span></span>, [saveError localizedDescription]); }</code> </pre><br>  You will also notice a reference to the <code>bottomPullView</code> instance <code>bottomPullView</code> .  This variable stores an object of type <code>AllAroundPullView</code> ( <a href="https://github.com/r-plus/AllAroundPullView">pulled from GitHub</a> ) <a href="https://github.com/r-plus/AllAroundPullView">‚Äîa</a> useful control that helps implement Pull-To-Resfresh behavior from all sides of your <code>UIScrollView</code> .  We will load each successive portion of our characters, reaching the bottom edge of the table and pulling it up. <br>  Earlier in <code>- (void)viewDidLoad</code> this control was initialized and used as follows: <br><pre> <code class="objectivec hljs">bottomPullView = [[AllAroundPullView alloc] initWithScrollView:table position:AllAroundPullViewPositionBottom action:^(AllAroundPullView *view){ [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> loadCharacters]; }]; bottomPullView.hidden = <span class="hljs-literal"><span class="hljs-literal">YES</span></span>; [table addSubview:bottomPullView];</code> </pre><br>  As you can see, in the body of the block passed as an action parameter: we put all the same method of loading new heroes <code>loadCharacters</code> . <br><br>  Well, run the application in the emulator and wait for the first successful response.  If everything went right, and logger RK produced something like <i><code>I restkit.network:RKObjectRequestOperation.m:220 GET 'http://your-url.here' (200 OK / 20 objects)</code></i> , then everything is fine and you can check Whether our objects are preserved in the database. <br>  To do this, go to the emulator folder, find our application and the Documents folder.  There should be a base <code>RKMarvel.sqlite</code> (this is the name we specified as a parameter when calling the <code>addSQLitePersistentStoreAtPath:</code> method <code>addSQLitePersistentStoreAtPath:</code> earlier).  Let's open this database in SQLite-editor and make sure that our characters are saved: <br><img src="https://habrastorage.org/getpro/habr/post_images/154/750/da1/154750da1aab1c647c38d08e0d1f1ebc.png"><br>  Hooray!  Some heroes even have a short description.  It's time to go to the display of all this "good." <br><br><h4>  5. Saving pictures and display. </h4><br>  I know that an impatient reader has long wanted to look at the images of their favorite characters.  For this we need to customize the appearance of our table.  We will not go into the technical details of creating and configuring objects of type <code>UITableView</code> (the author assumes that this is already known to the reader), but go straight to the table delegate method that creates the cells: <br><div class="spoiler">  <b class="spoiler_title">tableView: cellForRowAtIndexPath: code</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-built_in"><span class="hljs-built_in">UITableViewCell</span></span> *)tableView:(<span class="hljs-built_in"><span class="hljs-built_in">UITableView</span></span> *)tableView cellForRowAtIndexPath:(<span class="hljs-built_in"><span class="hljs-built_in">NSIndexPath</span></span> *)indexPath { <span class="hljs-built_in"><span class="hljs-built_in">NSInteger</span></span> row = indexPath.row; <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *reusableIdentifier = [<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> stringWithFormat:<span class="hljs-string"><span class="hljs-string">@"%d"</span></span>, row % <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">UITableViewCell</span></span> *cell = [table dequeueReusableCellWithIdentifier:reusableIdentifier]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell) { cell = [[<span class="hljs-built_in"><span class="hljs-built_in">UITableViewCell</span></span> alloc] initWithStyle:<span class="hljs-built_in"><span class="hljs-built_in">UITableViewCellStyleDefault</span></span> reuseIdentifier:reusableIdentifier]; cell.autoresizingMask = <span class="hljs-built_in"><span class="hljs-built_in">UIViewAutoresizingFlexibleWidth</span></span>; } [[cell.contentView subviews] makeObjectsPerformSelector:<span class="hljs-keyword"><span class="hljs-keyword">@selector</span></span>(removeFromSuperview)]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (numberOfCharacters &gt; row) { Character *curCharacter = [Character charWithManagedObjectContext: [[GDMarvelRKObjectManager manager] managedObjectContext] andInnerID:row]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (curCharacter) { <span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span> charHasDescription = ![curCharacter.charDescription isEqualToString:<span class="hljs-string"><span class="hljs-string">@""</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">UILabel</span></span> *label = [[<span class="hljs-built_in"><span class="hljs-built_in">UILabel</span></span> alloc] initWithFrame:<span class="hljs-built_in"><span class="hljs-built_in">CGRectMake</span></span>(<span class="hljs-number"><span class="hljs-number">70</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">CGRectGetWidth</span></span>(cell.contentView.frame) - <span class="hljs-number"><span class="hljs-number">70</span></span> - (charHasDescription ? <span class="hljs-number"><span class="hljs-number">60</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">60</span></span>)]; label.backgroundColor = [<span class="hljs-built_in"><span class="hljs-built_in">UIColor</span></span> clearColor]; label.text = curCharacter.name; label.autoresizingMask = <span class="hljs-built_in"><span class="hljs-built_in">UIViewAutoresizingFlexibleWidth</span></span>; [cell.contentView addSubview:label]; GDCellThumbnailView *thumbnail = [GDCellThumbnailView thumbnail]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (curCharacter.thumbnailImageData) [thumbnail setImage:[<span class="hljs-built_in"><span class="hljs-built_in">UIImage</span></span> imageWithData:curCharacter.thumbnailImageData]]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> loadThumbnail:thumbnail fromURLString:curCharacter.thumbnailURLString forCharacter:curCharacter]; [cell.contentView addSubview:thumbnail]; cell.accessoryType = charHasDescription ? <span class="hljs-built_in"><span class="hljs-built_in">UITableViewCellAccessoryDetailButton</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">UITableViewCellSelectionStyleNone</span></span>; cell.selectionStyle = charHasDescription ? <span class="hljs-built_in"><span class="hljs-built_in">UITableViewCellSelectionStyleGray</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">UITableViewCellSelectionStyleNone</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell; }</code> </pre></div></div><br>  After creating the next cell, we retrieve the required hero from the base and display its name, we also check whether the expanded information about it is present, and put a button on the cell, by clicking on which we will display this information later.  And most importantly - the image of the character.  I created for this a special class <code>GDCellThumbnailView</code> , instances of which I put on the cell.  He does not do anything special, he just has the opportunity to show us the ‚Äúspinning flower‚Äù of waiting until the thumbnail is loaded. <br><br>  With an empty implementation of the <code>loadThumbnail:fromURLString:forCharacter:</code> our main view controller will now look like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/91d/f28/976/91df289767f79735b7d8fd55dc681258.png"><br><br>  Let's implement the method of loading pictures of the hero.  Since RK already includes the <a href="https://github.com/AFNetworking/AFNetworking"><code>AFNetworking</code></a> framework, we will use it to send an asynchronous request to the Marvel servers to download images: <br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)loadThumbnail:(GDCellThumbnailView *)view fromURLString:(<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *)urlString forCharacter:(Character *)character { XLog(<span class="hljs-string"><span class="hljs-string">@"Loading thumbnail for %@"</span></span>, character.name); AFHTTPRequestOperation *operation = [[AFHTTPRequestOperation alloc] initWithRequest:[<span class="hljs-built_in"><span class="hljs-built_in">NSURLRequest</span></span> requestWithURL:[<span class="hljs-built_in"><span class="hljs-built_in">NSURL</span></span> URLWithString:urlString]]]; [operation setCompletionBlockWithSuccess:^(AFHTTPRequestOperation *operation, <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> responseObject) { character.thumbnailImageData = responseObject; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> saveToStore]; [view setImage:[<span class="hljs-built_in"><span class="hljs-built_in">UIImage</span></span> imageWithData:responseObject]]; } failure:^(AFHTTPRequestOperation *operation, <span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> *error) { XLog(<span class="hljs-string"><span class="hljs-string">@"%@"</span></span>, [error localizedDescription]); }]; [operation start]; }</code> </pre><br>  That's all.  Run our application again.  Already a good result. <br><img src="https://habrastorage.org/getpro/habr/post_images/6f4/ad8/b73/6f4ad8b73ec894b492e8970e257749b2.png"><br><br>  Now it will be hard to stop, and with your permission I use the convenient Pull-To-Refresh control to load more characters.  At the same time we will check how our base now looks. <br><img src="https://habrastorage.org/getpro/habr/post_images/74f/305/349/74f30534950a437ef710a9506ec04e09.png"><img src="https://habrastorage.org/getpro/habr/post_images/768/451/73b/76845173b211b5fc98dc6cd6672ac65f.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now both pictures and information about the heroes (of course, only those that we managed to upload) will be stored locally, regardless of whether we have an Internet connection or not. </font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6. Conclusion. </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RestKit perfectly coped with the task: requests are sent, answers are received, objects are saved automatically. Not everyone can like the principle of loading and display provided in this article: it is possible that it would be wiser to immediately dump the entire database and work with it completely locally. The author believes that to familiarize with the basic features of RK, this functionality is quite enough. The source code of the entire project (along with the missing part in this article with information about a specific character) can be </font></font><a href="https://github.com/coffellas-cto/marvel-characters"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">downloaded on GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Your wishes and comments are welcome as comments on the article, as well as pull requests on GitHub.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finally, I would like to please with another image - this time it is a screenshot of the second view controller, which opens by pressing the ‚Äúinfo‚Äù button next to the name of the hero in the main view controller. </font><font style="vertical-align: inherit;">I've been scrolling my spreadsheet for a long time to finally load it:</font></font><br><img src="https://habrastorage.org/getpro/habr/post_images/87b/f55/131/87bf55131e3ca0636ef844fbad659a6b.png"></div><p>Source: <a href="https://habr.com/ru/post/220885/">https://habr.com/ru/post/220885/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../220873/index.html">Homemade ring LED illuminator for video, photo and macro shooting</a></li>
<li><a href="../220875/index.html">Experience choosing and ordering iBeacon</a></li>
<li><a href="../220877/index.html">Qt 5.2, from desire to google play</a></li>
<li><a href="../220879/index.html">Addon for Overclock`a consciousness or flashback pro</a></li>
<li><a href="../220883/index.html">Practice refactoring. Envious features</a></li>
<li><a href="../220887/index.html">Our journey begins</a></li>
<li><a href="../220889/index.html">YotaPhone, Android and a bit of cryptography</a></li>
<li><a href="../220891/index.html">Running FreeBSD in the Microsoft Azure Cloud</a></li>
<li><a href="../220893/index.html">Iron Budget Habramerka (ZhBH) karma, rating habratopika and other parameters on arduino + openwrt</a></li>
<li><a href="../220897/index.html">TI-84 +</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>