<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with videos in Full Throttle Remastered</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Full Throttle is a point-and-click adventure game released by LucasArts as early as the twentieth century, on April 30, 1995. In addition to the stand...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with videos in Full Throttle Remastered</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img alt="The Full Throttle Remastered logo" src="https://habrastorage.org/getpro/habr/post_images/40f/c00/6dd/40fc006dd06eebb1329bdf47f34f0f3b.png"></div><br><br>  Full Throttle is a point-and-click adventure game released by LucasArts as early as the twentieth century, on April 30, 1995.  In addition to the standard visual gameplay style of point-and-click of those times (the character's sprites move on a static background), the game also features FMV video in non-interactive cutscenes and in interactive gameplay modes.  This FMV technology has further strengthened the plot aspect of the genre, because it allowed the creators to use computer-rendered frame sequences that do not require a heavy load on the processor.  In addition, compressed FMVs took up less space and were placed on the target medium ‚Äî a CD-ROM of approximately 650 megabytes. <br><br>  The classic version of Full Throttle used video technology developed by LucasArts employee Vince Lee under the name INSANE.  INSANE stands for <strong>IN</strong> teractive <strong>S</strong> treaming <strong>AN</strong> imation Engine ("interactive streaming animation engine").  It was first created and used in Star Wars: Rebel Assault.  The technology has been improved and applied also in later games: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <em>Star Wars: Rebel Assault</em> (November 1993) </li><li>  <strong><em>Full Throttle</em></strong> (April 1995) </li><li>  <em>Star Wars: Rebel Assault II</em> (November 1995) </li><li>  <em>The Dig</em> (November 1995) </li><li>  <em>Outlaws</em> (March 1997) </li></ul><a name="habracut"></a><br>  This video playback system allowed the creators to compress large pieces of data into a smaller format that, along with other game data, fit on a CD-ROM.  At that time, the I / O speed of the disk and the increased computational power were sufficient for streaming CD-ROM compressed FMV, unpacking them into video frames and display on the screen.  <em>Full Throttle's FMVs were</em> encoded at 320x200 resolution and 10 frames per second.  In addition, embedded audio video tracks were processed and mixed in real time before being sent to the audio device. <br><br>  A tool called <em>SMUSHFT.EXE</em> (SMUSH for Full Throttle) was used to encode and compress the video into a .SAN file ( <strong>S</strong> mush <strong>AN</strong> imation).  Unlike standard video playback systems with one video track and one audio track, the .SAN file could contain one or several video tracks, as well as several audio tracks for playback to the user, depending on the game state.  The figure below shows <em>SMUSHFT.EXE</em> with the project source file.  You may notice that when scrolling along the timeline, the green bars represent video frames, and the dark yellow bars represent audio files.  Also there are gray bars, which indicate lines of text corresponding to the information of the subtitles. <br><br><div style="text-align:center;"><img alt="An example of SMUSHFT.EXE in timeline" src="https://habrastorage.org/getpro/habr/post_images/43f/9cc/9ee/43f9cc9ee819f17df0083259c60e64c7.gif"></div><br><br>  The most important aspect of our approach to the remastering of classic adventure games of LucasArts was the preservation of the integrity of the original game along with the improvement of the old content.  We wanted the game to be felt and played the same way as in the 90s, but with new graphics, much better sound and support for new, more convenient input methods.  To do this, we first decided to port the original game to modern equipment.  Then, when playing the game for the user, we made a queue of the game states every frame and received a sufficient amount of game state data to provide the user with more modern content.  That is, the game still works exactly the same way it worked then, in 1995. <br><br><div style="text-align:center;"><img alt="An example of a remastered FMV sequence compared to the original" src="https://habrastorage.org/getpro/habr/post_images/6d5/c42/2c1/6d5c422c1026f06a1f06b6099df90a59.gif"></div><br><br>  This means that we have adapted all the technologies used by the game, including the INSANE engine.  To remaster the entire video content, we had to start with the original video files from the 1995 game, and use them as a schema for the updated content.  The end result coincides frame by frame with the original, but with a higher resolution and significantly improved sound. <br><br><h2>  Extract </h2><br>  The first task was to obtain the original video files (.SAN files) and extract all the audio and visual information into a format based on which you can make a "scheme".  We already had the code that was used to decode these files, so we wrote a tool in C # that was the interface to the original decoder through the compiled native DLL.  This tool, called SanExtract, analyzes the .SAN file and separates audio and video content into a convenient directory structure with which to work. <br><br><hr><br><blockquote>  If you have an original game and you can access files on a CD, then try extracting the video yourself!  Here is a link to the SanExtract tool: <a href="">SanExtract.zip</a> <br><br>  MD5 [ac951d858cd8d252222d31fee61b1ce4] <br><br>  SHA-1 [2915295a260306292f979788fe047a208e5f4e3b] <br><br><div style="text-align:center;"><img alt="An example of SanExtract.exe command-line usage" src="https://habrastorage.org/getpro/habr/post_images/25c/55f/58e/25c55f58e84d2bce440bdd008fb3a194.png"></div><br><br>  Just run SanExtract.exe on the command line, using the original files as input (most likely they are in [CD_DRIVE]: / RESOURCE / VIDEO / and in [CD_DRIVE]: / RESOURCE / DATA /). </blockquote><br><hr><br>  The resulting data will be one or more linear video frame streams, as well as all audio files used during playback.  And I was not mistaken: the engine was dynamic enough to enable or disable elements (audio and video) at run time.  I will tell you more about this later.  Extraction was only the beginning of this process.  We needed to know how the original frames were created so that we could recreate a similar workflow for the remastering project.  For example, some frames or sequences contain a combination of several graphics sources.  Look at the animation from the original game: <br><br><div style="text-align:center;"><img alt="An example of a classic frame sequence" src="https://habrastorage.org/getpro/habr/post_images/3b2/4eb/c2c/3b24ebc2c42fc5c3197c8318b25db9b2.gif"></div><br><br>  Maybe you can‚Äôt say that right away, but there are hand-drawn and rendered three-dimensional elements in the frame.  Ben's motorcycle, limousine and Ben's motorcycle shadow falling on a limousine, taken from a rendered in 3D sequence.  Gilded broken decoration on the hood is a separate hand-drawn animation sequence.  The end result is a composition of a 3D render, a drawn animation and a static background image of clouds. <br><br>  Below are shown all the components used to create the finished video.  The leftmost sequence is the hood decoration drawn by hand.  Right - the mask used in the compositing of 3D renders (motorcycle and limousine) with clouds in the background.  And in the center is a sequence of 3D render + background from clouds.  Then hand-drawn and rendered in 3D elements are combined to create the fragment shown above. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d16/bf7/6eb/d16bf76eb68554a63210b36e0c3ee805.gif"></div><br><br>  To preserve the aesthetics level of the original, we could not just take each frame of video (approximately 16,000 frames) and manually draw on them.  We needed to correctly repeat the hard surfaces of motorcycles and cars from the original, including the shadows cast in the scene.  In the end, we need to find the original 3D models and the hand-drawn animation, and then re-master these separate parts to combine them with compositing. <br><br>  So, I mentioned that we need to find the original 3D files and hand-drawn animations.  At first we thought, ‚Äúoh, maybe there are some metadata used to superimpose the original component parts of the video that can be extracted.‚Äù  But in fact, the files were renamed and the information was lost over time.  Metadata does not give anything, and even when searching the archives we find many files with the same names, but with different dates and different contents.  We have no idea which files were originally used to generate the finished frame, so we needed to find a solution to this problem. <br><br><h2>  Archives </h2><br>  Our archive consisted of approximately 67 gigabytes of data, and useful data related to the original FMV were scattered throughout this volume.  After examining the data scheme in the backup, we can conclude that by the end of the project all data files from all computers were copied to the backup folder.  The result was a mess similar to Indiana Jones‚Äôs storage style.  We still have a lot of disks containing copies of all employees' hard drives.  Upon further study it turned out.  that there is no single disk on which all the data we need is collected.  Useful information is scattered across all archives.  Moreover, there are frequent cases of duplication of names of files containing different content, different dates of changes, etc.  To move forward, we needed a way to index all duplicate files and perform a CRC comparison to identify all unique files. <br><br>  We decided to find file extensions that were used in the process of working with FMV and create a manifest for the following file types: .ANM, .CEL, .FLC, .FLI, .GIF, .MAX, .NUT, .OBJ, .PRO.  We wrote a duplicate tracking script in Python to bypass all available archives and create an XML map of each file name with the extensions we need.  As a result, we have a cleaned directory of useful files that were easier to sort out and search.  Here is an example of a node in the xml manifest file: <br><br><pre> &lt;file&gt;
     &lt;name&gt; b_cm1 &lt;/ name&gt;
     &lt;most_recent&gt; C: \ Backup \ Lleslle backup \ THROT-C \ RESTSTOP \ STUFF \ B_CM1.ANM &lt;/ most_recent&gt;
     &lt;unique_files count = "2"&gt;
         &lt;file_item&gt;
             &lt;path&gt; C: \ Backup \ Lleslle backup \ THROT-C \ RESTSTOP \ STUFF \ B_CM1.ANM &lt;/ path&gt;
             &lt;modify_date&gt; 1994/07/30 &lt;/ modify_date&gt;
             &lt;size_bytes&gt; 115829 &lt;/ size_bytes&gt;
             &lt;crc_value&gt; 2D31393738373530333931 &lt;/ crc_value&gt;
         &lt;/ file_item&gt;
         &lt;file_item&gt;
             &lt;path&gt; C: \ Backup \ PC2 \ FUL528_Davi_DV2 \ BEN \ RESTOP \ FLICS \ B_CM1.ANM &lt;/ path&gt;
             &lt;modify_date&gt; 1994/07/13 &lt;/ modify_date&gt;
             &lt;size_bytes&gt; 115829 &lt;/ size_bytes&gt;
             &lt;crc_value&gt; 32303432363131303937 &lt;/ crc_value&gt;
         &lt;/ file_item&gt;
     &lt;/ unique_files&gt;
     &lt;all_files count = "4"&gt;
         &lt;file_item&gt;
             &lt;path&gt; C: \ Backup \ Lleslle backup \ THROT-C \ RESTSTOP \ STUFF \ B_CM1.ANM &lt;/ path&gt;
             &lt;modify_date&gt; 1994/07/30 &lt;/ modify_date&gt;
             &lt;size_bytes&gt; 115829 &lt;/ size_bytes&gt;
             &lt;crc_value&gt; 2D31393738373530333931 &lt;/ crc_value&gt;
         &lt;/ file_item&gt;
         &lt;file_item&gt;
             &lt;path&gt; C: \ Backup \ Lleslle backup \ THROT-C \ RESTSTOP \ STUFF \ B_CM1.ANM &lt;/ path&gt;
             &lt;modify_date&gt; 1994/07/30 &lt;/ modify_date&gt;
             &lt;size_bytes&gt; 115829 &lt;/ size_bytes&gt;
             &lt;crc_value&gt; 2D31393738373530333931 &lt;/ crc_value&gt;
         &lt;/ file_item&gt;
         &lt;file_item&gt;
             &lt;path&gt; C: \ Backup \ cleslie's-backup \ THROT-C \ RESTSTOP \ STUFF \ B_CM1.ANM &lt;/ path&gt;
             &lt;modify_date&gt; 1994/07/30 &lt;/ modify_date&gt;
             &lt;size_bytes&gt; 115829 &lt;/ size_bytes&gt;
             &lt;crc_value&gt; 2D31393738373530333931 &lt;/ crc_value&gt;
         &lt;/ file_item&gt;
         &lt;file_item&gt;
             &lt;path&gt; C: \ Backup \ PC2 \ FUL528_Davi_DV2 \ BEN \ RESTOP \ FLICS \ B_CM1.ANM &lt;/ path&gt;
             &lt;modify_date&gt; 1994/07/13 &lt;/ modify_date&gt;
             &lt;size_bytes&gt; 115829 &lt;/ size_bytes&gt;
             &lt;crc_value&gt; 32303432363131303937 &lt;/ crc_value&gt;
         &lt;/ file_item&gt;
     &lt;/ all_files&gt;
 &lt;/ file&gt; </pre><br>  The above XML fragment shows that two unique files have been found in the archive named <em>b_cm1</em> .  These manifest files allowed us to narrow the search space when studying frame dependencies. <br><br><h2>  Sort dependencies </h2><br>  Even finding all these dependencies in the archives, we could not determine which particular dependencies were used in the finished FMV.  We could make assumptions and use some fuzzy logic, but in the end we decided to create a special tool with which people can interact and sort all necessary resources visually.  This tool, called <em>SanWrangler</em> , allowed us to load the original sequence of frames, and then view all the archived data in search of the intermediate components used to create this frame. <br><br>  Looking at the SanWrangler example below, you can see on the left in paged form a bank of 36 separate streams of image sequences that the user can learn.  This array of sequences represents all the frames found in archives, with the exception of binary duplicates.  To the right of the archive array, at the very top, the original sequence is shown, extracted from the .SAN process described above.  The user can press Shift + Click on streams from the archive array on the left to move them to the right array.  This right-hand array of selected frame sequences is all the threads that contain the parts used to generate the finished frame sequence. <br><br><div style="text-align:center;"><img alt="An example of SanWrangler being used to scrub linear frames" src="https://habrastorage.org/getpro/habr/post_images/948/305/c98/948305c98db5649cd7ce8839f906bc9d.gif"></div><br><br>  SanWrangler allows you to search in the following files from an archive array: <br><br><ul><li>  .ANM - animation files created in LucasArts own tool.  These files contain hand-drawn animation cells.  Later, if necessary, they were connected to other files. </li><li>  .FLC / .FLI - Autodesk Animator and Autodesk Animator Pro files </li><li>  .NUT - they contain sequences of uncompressed linear frames transmitted to SMUSHFT.EXE and later encoded into a compressed format written to the .SAN file </li><li>  .MAX is a 3D mesh source file created in 3D Studio 2.0.  We were able to run the batch process to render the sequences used in SanWrangler so that we can know what is contained in the binary .MAX files.  These frames were critical to understanding which .MAX file was used in a particular FMV sequence. </li></ul><br>  So, we have reached the point where the direct remastering of old files begins.  SanWrangler can save a list of selected file dependencies in a cleaner format.  From this point on, the remastering workflow is divided into three branches: remastering of hand-drawn frames, remastering of 3D models and remastering of sound. <br><br>  Wait for the second part of the article!  In the next part, I will talk about the ways of automation and transformation that we used to reassemble all the content. </div><p>Source: <a href="https://habr.com/ru/post/340564/">https://habr.com/ru/post/340564/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../340552/index.html">How we updated the search tips in Yandex and found the correct metric for them</a></li>
<li><a href="../340554/index.html">Determination of the stability of automatic control systems for industrial robots</a></li>
<li><a href="../340556/index.html">First TypeScript Demo</a></li>
<li><a href="../340558/index.html">Why do you need to stop using git rebase</a></li>
<li><a href="../340562/index.html">We need to go deeper: bypass the script that bypasses the adblock</a></li>
<li><a href="../340566/index.html">Useful scripts when migrating from Oracle to PostgreSQL</a></li>
<li><a href="../340568/index.html">Creating a sky for 3D games</a></li>
<li><a href="../340574/index.html">NLTK parse</a></li>
<li><a href="../340576/index.html">Why IT and Business Network Factory and Cisco SD-Access</a></li>
<li><a href="../340578/index.html">Release DBMS InterSystems Cach√© 2017.2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>