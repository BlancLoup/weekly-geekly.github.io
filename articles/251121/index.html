<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Save electricity or time timer for night tariffs in power grids</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="How often do you have to adjust different timers? The alarm clock on the smartphone, the timer on the bread maker, so that for breakfast there was fre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Save electricity or time timer for night tariffs in power grids</h1><div class="post__text post__text-html js-mediator-article">  How often do you have to adjust different timers?  The alarm clock on the smartphone, the timer on the bread maker, so that for breakfast there was fresh bread, and you never know when you need to start something.  No less important is the task to turn off or complete the action in time. <br><br>  So I was faced with the task of automating the on and off of the appliance.  It would be possible to use a typical socket with a time relay, but you need to turn on an unusual load, so the controller and only the controller. <br><br>  So, the task is to include an electric heating boiler for heating a house at night, when billing is at least a little benign.  What came out of it - see below. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/926/98b/62f/92698b62f1f8b75fcb5cba788cd6247d.jpg" alt="image"><br><a name="habracut"></a><br>  To buy a ready-made time relay for 6-8 thousand rubles (we are not talking about simple devices plugged into the outlet), which will close the necessary contacts by triggering events or by time, just unsportsmanlike.  In addition, a controller with similar functions, and even with a good supply of functionality, will cost 4 times less, not to mention the warm-up for the brain.  It all started in the New Year holidays. <br><br>  The task of working in a strictly allotted time requires knowing the current time and setting the boundaries of the work.  Everything is good, but it is desirable to change the time and sometimes adjust the clock.  In addition, it is more convenient to implement the task in the form of an end device, which will not require a computer to change the parameters.  Also, additional functions will be hung on the controller, but this is in version 2.0, but for now it is a timer. <br><br>  From here, the list of devices needed to complete the task was determined: <br><br>  1. Arduino Nano (the cheaper the module, the better, since the tasks are not resource-intensive); <br>  2. RTC time module; <br>  3. Relay module (2 relays); <br>  4. Power adapter for arduino.  Was chosen DC-DC converter stabilizer 12V-5V; <br>  5. Display 4x20 characters for beauty (there were 4-line and 2-line); <br>  6. I2C adapter for display. <br><br>  So it turned out to be connected in the end: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d20/d35/876/d20d3587626acbdb06b31df7871764be.jpg" alt="image"><br><br>  It was quite simple to collect all this on a breadboard.  Studying Habr, I noticed the work with I2C tire a long time ago and it really hurts me to like the <a href="http://habrahabr.ru/post/219137/">design of the watch of a friend</a> , so I borrowed a part of its code and made the main watch in the same style. <br><br>  Then there was a long process of learning how to work with the EEPROM and the clock module, so that when the power fails, the time timer and the clock itself do not get lost.  At first, the clock was turned off, but a long study of the forums led to the thought that the RTC module contained a Li-ION battery and it just sat down from a long journey from China to Russia.  Support for food for a couple of days allowed us to fill the discharge and more time did not get lost. <br><br>  It remains to connect all the modules stronger, write code and start debugging. <br><br><div class="spoiler">  <b class="spoiler_title">Sketch Timer</b> <div class="spoiler_text"><pre><code class="hljs dos">// <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span> and <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> functions using a DS1307 RTC connected via I2C and Wire lib #include &lt;EEPROM.h&gt; #include &lt;Wire.h&gt; #include &lt;DS1307.h&gt; #include "RTClib.h" #include &lt;LiquidCrystal_I2C.h&gt; #define timePIN <span class="hljs-number"><span class="hljs-number">10</span></span> #define RELE_1 <span class="hljs-number"><span class="hljs-number">12</span></span> //  <span class="hljs-number"><span class="hljs-number">1</span></span>    <span class="hljs-number"><span class="hljs-number">7</span></span> #define RELE_2 <span class="hljs-number"><span class="hljs-number">11</span></span> //  <span class="hljs-number"><span class="hljs-number">2</span></span>    <span class="hljs-number"><span class="hljs-number">8</span></span> //  A4  SDA   SDA  //  A5  SCL   SCL  int FullMinutesTimerOn = EEPROM.read(<span class="hljs-number"><span class="hljs-number">0</span></span>); int FullMinutesTimerOff = EEPROM.read(<span class="hljs-number"><span class="hljs-number">2</span></span>); int rtc[<span class="hljs-number"><span class="hljs-number">7</span></span>]; byte rr[<span class="hljs-number"><span class="hljs-number">7</span></span>]; int ledPin = <span class="hljs-number"><span class="hljs-number">13</span></span>; LiquidCrystal_I2C lcd(<span class="hljs-number"><span class="hljs-number">0</span></span>x27,<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>); // <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> the LCD address to <span class="hljs-number"><span class="hljs-number">0</span></span>x27 <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a <span class="hljs-number"><span class="hljs-number">16</span></span> chars and <span class="hljs-number"><span class="hljs-number">2</span></span> line display int button1 = <span class="hljs-number"><span class="hljs-number">10</span></span>; //   D10 int button2 = <span class="hljs-number"><span class="hljs-number">9</span></span>; //   D9 int button3 = <span class="hljs-number"><span class="hljs-number">8</span></span>; //   D8 int button4 = <span class="hljs-number"><span class="hljs-number">7</span></span>; //   D7 int button5 = <span class="hljs-number"><span class="hljs-number">6</span></span>; //   D6 int led = <span class="hljs-number"><span class="hljs-number">5</span></span>; int rejim=<span class="hljs-number"><span class="hljs-number">0</span></span>; //     int PrevSec=<span class="hljs-number"><span class="hljs-number">0</span></span>; int CurSec=<span class="hljs-number"><span class="hljs-number">0</span></span>; boolean lastButton=LOW; byte LT[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B00111, B01111, B11111, B11111, B11111, B11111, B11111, B11111 }; byte UB[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11111, B11111, B11111, B00000, B00000, B00000, B00000, B00000 }; byte RT[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11100, B11110, B11111, B11111, B11111, B11111, B11111, B11111 }; byte LL[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11111, B11111, B11111, B11111, B11111, B11111, B01111, B00111 }; byte LB[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B00000, B00000, B00000, B00000, B00000, B11111, B11111, B11111 }; byte LR[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11111, B11111, B11111, B11111, B11111, B11111, B11110, B11100 }; byte MB[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11111, B11111, B11111, B00000, B00000, B00000, B11111, B11111 }; byte block[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11111, B11111, B11111, B11111, B11111, B11111, B11111, B11111 }; // loop counter int count = <span class="hljs-number"><span class="hljs-number">0</span></span>; void setup () { DDRC|=_BV(<span class="hljs-number"><span class="hljs-number">2</span></span>) |_BV(<span class="hljs-number"><span class="hljs-number">3</span></span>); // POWER:Vcc Gnd PORTC |=_BV(<span class="hljs-number"><span class="hljs-number">3</span></span>); // VCC PINC3 pinMode(ledPin, OUTPUT); pinMode(timePIN, OUTPUT); pinMode(RELE_1, OUTPUT); //     pinMode(RELE_2, OUTPUT); //     digitalWrite(RELE_1, HIGH); //    digitalWrite(RELE_2, HIGH); //    RTC.get(rtc,true); lcd.init(); // initialize the lcd lcd.backlight(); lcd.home(); lcd.createChar(<span class="hljs-number"><span class="hljs-number">0</span></span>,LT); lcd.createChar(<span class="hljs-number"><span class="hljs-number">1</span></span>,UB); lcd.createChar(<span class="hljs-number"><span class="hljs-number">2</span></span>,RT); lcd.createChar(<span class="hljs-number"><span class="hljs-number">3</span></span>,LL); lcd.createChar(<span class="hljs-number"><span class="hljs-number">4</span></span>,LB); lcd.createChar(<span class="hljs-number"><span class="hljs-number">5</span></span>,LR); lcd.createChar(<span class="hljs-number"><span class="hljs-number">6</span></span>,MB); lcd.createChar(<span class="hljs-number"><span class="hljs-number">7</span></span>,block); // sets the LCD's rows and colums: lcd.clear(); RTC.SetOutput(DS1307_SQW32KHZ); pinMode(led, OUTPUT); pinMode(button1, INPUT); pinMode(button2, INPUT); pinMode(button3, INPUT); } void custom0(int x) { // uses segments to build the number <span class="hljs-number"><span class="hljs-number">0</span></span> lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); // <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> cursor to column <span class="hljs-number"><span class="hljs-number">0</span></span>, line <span class="hljs-number"><span class="hljs-number">0</span></span> (first row) lcd.write(<span class="hljs-number"><span class="hljs-number">0</span></span>); // <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> each segment to create lcd.write(<span class="hljs-number"><span class="hljs-number">1</span></span>); // top half of the number lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); // <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> cursor to colum <span class="hljs-number"><span class="hljs-number">0</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span> (second row) lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); // <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> each segment to create lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); // bottom half of the number lcd.write(<span class="hljs-number"><span class="hljs-number">5</span></span>); } void custom1(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">7</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); } void custom2(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); } void custom3(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">5</span></span>); } void custom4(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">7</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.write(<span class="hljs-number"><span class="hljs-number">7</span></span>); } void custom5(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">5</span></span>); } void custom6(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">5</span></span>); } void custom7(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.write(<span class="hljs-number"><span class="hljs-number">7</span></span>); } void custom8(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">5</span></span>); } void custom9(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.write(<span class="hljs-number"><span class="hljs-number">7</span></span>); } void digitalClockDisplay(){ // digital clock display of the <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> printDigits(rtc[<span class="hljs-number"><span class="hljs-number">2</span></span>]/<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); printDigits(rtc[<span class="hljs-number"><span class="hljs-number">2</span></span>]%<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>); printDigits(rtc[<span class="hljs-number"><span class="hljs-number">1</span></span>]/<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>); printDigits(rtc[<span class="hljs-number"><span class="hljs-number">1</span></span>]%<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">13</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rtc[<span class="hljs-number"><span class="hljs-number">0</span></span>]<span class="hljs-variable"><span class="hljs-variable">%10%</span></span><span class="hljs-number"><span class="hljs-number">2</span></span>==<span class="hljs-number"><span class="hljs-number">0</span></span>){ lcd.setCursor(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+ "); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" +"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" +"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+ "); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); } //  } void printDigits(int digits, int x){ // utility function <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> digital clock display: prints preceding colon and leading <span class="hljs-number"><span class="hljs-number">0</span></span> switch (digits) { case <span class="hljs-number"><span class="hljs-number">0</span></span>: custom0(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">1</span></span>: custom1(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">2</span></span>: custom2(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">3</span></span>: custom3(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">4</span></span>: custom4(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">5</span></span>: custom5(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">6</span></span>: custom6(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">7</span></span>: custom7(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">8</span></span>: custom8(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">9</span></span>: custom9(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; } } void loop () { int hourOn=EEPROM.read(<span class="hljs-number"><span class="hljs-number">110</span></span>); //EEPROM.read(<span class="hljs-number"><span class="hljs-number">110</span></span>) int hourOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">112</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">112</span></span>) int minOn= EEPROM.read(<span class="hljs-number"><span class="hljs-number">111</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">111</span></span>) int minOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">113</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">113</span></span>) int Hour = rtc[<span class="hljs-number"><span class="hljs-number">2</span></span>]; //  int Minute = rtc[<span class="hljs-number"><span class="hljs-number">1</span></span>]; //  int Second = rtc[<span class="hljs-number"><span class="hljs-number">0</span></span>]; //   int FullMinutes = Hour * <span class="hljs-number"><span class="hljs-number">60</span></span> + Minute; //      int FullMinutesTimerOn= hourOn*<span class="hljs-number"><span class="hljs-number">60</span></span>+minOn; //      int FullMinutesTimerOff= hourOff*<span class="hljs-number"><span class="hljs-number">60</span></span>+minOff; //      int sutki=<span class="hljs-number"><span class="hljs-number">0</span></span>; //  ,      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hourOff-hourOn &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) sutki=<span class="hljs-number"><span class="hljs-number">1</span></span>; //     ,    =<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> sutki=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sutki==<span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; (FullMinutes &gt;= FullMinutesTimerOn || FullMinutes &lt;= FullMinutesTimerOff) ) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("VKL1"); digitalWrite(RELE_1, LOW); //   ,      } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sutki==<span class="hljs-number"><span class="hljs-number">1</span></span>) { lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); digitalWrite(RELE_1, HIGH); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sutki == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; (FullMinutes &gt;= FullMinutesTimerOn &amp;&amp; FullMinutes &lt;= FullMinutesTimerOff )) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("VKL0"); digitalWrite(RELE_1, LOW); } //    ,      <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sutki == <span class="hljs-number"><span class="hljs-number">0</span></span>) { lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); digitalWrite(RELE_1, HIGH); } RTC.get(rtc,true); digitalClockDisplay(); //    <span class="hljs-number"><span class="hljs-number">2</span></span>  strokatimera(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">0</span></span>) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("ojidayu komandi"); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">1</span></span>) { setTimerOn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">2</span></span>) { setTimerOff(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">3</span></span>) { setTime(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead (button5) == HIGH) { rejim++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim&gt;<span class="hljs-number"><span class="hljs-number">3</span></span>) rejim=<span class="hljs-number"><span class="hljs-number">0</span></span>; lcd.clear(); //} } } void setTimerOn() { int hourOn= EEPROM.read(<span class="hljs-number"><span class="hljs-number">110</span></span>); int minOn= EEPROM.read(<span class="hljs-number"><span class="hljs-number">111</span></span>); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("nastroika VKL"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button3)==HIGH) //     { hourOn++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hourOn &gt;=<span class="hljs-number"><span class="hljs-number">24</span></span>) hourOn=<span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!digitalRead(button4)) //     { minOn++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (minOn &gt;=<span class="hljs-number"><span class="hljs-number">60</span></span>) { minOn=<span class="hljs-number"><span class="hljs-number">0</span></span>; hourOn++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hourOn &gt;=<span class="hljs-number"><span class="hljs-number">24</span></span>) hourOn=<span class="hljs-number"><span class="hljs-number">0</span></span>; } } strokatimera(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button2) == HIGH) { EEPROM.write(<span class="hljs-number"><span class="hljs-number">110</span></span>, hourOn); EEPROM.write(<span class="hljs-number"><span class="hljs-number">111</span></span>, minOn); lcd.clear(); } } void setTimerOff() { int hourOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">112</span></span>); int minOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">113</span></span>); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("nastroika VIKL"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button3)==HIGH) //     { hourOff++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hourOff &gt;=<span class="hljs-number"><span class="hljs-number">24</span></span>) hourOff=<span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!digitalRead(button4)) //     { minOff++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (minOff &gt;=<span class="hljs-number"><span class="hljs-number">60</span></span>) { minOff=<span class="hljs-number"><span class="hljs-number">0</span></span>; hourOff++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hourOff &gt;=<span class="hljs-number"><span class="hljs-number">24</span></span>) hourOff=<span class="hljs-number"><span class="hljs-number">0</span></span>; } } strokatimera(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button2) == HIGH) { EEPROM.write(<span class="hljs-number"><span class="hljs-number">112</span></span>, hourOff); EEPROM.write(<span class="hljs-number"><span class="hljs-number">113</span></span>, minOff); lcd.clear(); } } void setTime() { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); //lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("nastroika time_test"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("pustaya nastroika"); } void strokatimera() { int hourOn=EEPROM.read(<span class="hljs-number"><span class="hljs-number">110</span></span>); //EEPROM.read(<span class="hljs-number"><span class="hljs-number">110</span></span>) int hourOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">112</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">112</span></span>) int minOn= EEPROM.read(<span class="hljs-number"><span class="hljs-number">111</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">111</span></span>) int minOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">113</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">113</span></span>) lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); //        lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(hourOn); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(":"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(minOn); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("-"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(hourOff); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(":"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(minOff); }</code> </pre> <br></div></div><br>  And this is how it works: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/ChyVpUXgoO0%3Ffeature%3Doembed&amp;xid=17259,15700019,15700186,15700191,15700253&amp;usg=ALkJrhgmvRQ7R5aF0r43hy2GoHG8njqYhQ" frameborder="0" allowfullscreen=""></iframe><br><br>  It remains a mystery to me why the controller does not want to react to pressing individual buttons for changing minutes and hours, but willingly reacts to pressing another button by changing minutes.  Based on this, I finished the code to a working, albeit a Hindu state, since the first release of the timer must be started up, and the rest should be dealt with later.  I sin on overheating when soldering, although the output to these contacts of a standard Blink gives a normal voltage on the pin.  At the moment, pin D6 allows you to enter the change menu, and pin D9 scrolls through the minutes.  Can someone tell me if I came across this? <br><br>  PS Already after writing this article, I was faced with the fact that the tasks assigned to the controller should be expanded.  The fact is that this controller controls the electric boiler in the country house, and as the temperature rises, the humidity rises.  I had to add a channel <a href="http://www.sigma-air.ru/product_1197.html">fan</a> to the ventilation system similar to this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d58/571/eb9/d58571eb997b01802753d7f528f73cb8.jpg" alt="image"><br><br>  ... and hang it up on the second relay.  It was established experimentally that it would be best to turn it on every hour for a given period of time.  At the same time it is switched on only from 9 to 21 hours, and at night the heat from the house is not thrown out.  The on-time adjustment is also made from the buttons, but the operating time is still sewn in the program.  At the moment, the hood is turned on for 10 minutes every hour.  It is reserved to turn on the hood automatically when the lighting in the bathroom or toilet is turned on. <br>  The current code, which has been working confidently for a month, is below: <br><br><div class="spoiler">  <b class="spoiler_title">Valid Code</b> <div class="spoiler_text"><pre> <code class="hljs dos">// <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span> and <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> functions using a DS1307 RTC connected via I2C and Wire lib #include &lt;EEPROM.h&gt; #include &lt;Wire.h&gt; #include &lt;DS1307.h&gt; #include "RTClib.h" #include &lt;LiquidCrystal_I2C.h&gt; //#define timePIN <span class="hljs-number"><span class="hljs-number">10</span></span> #define RELE_1 <span class="hljs-number"><span class="hljs-number">12</span></span> //  <span class="hljs-number"><span class="hljs-number">1</span></span>    <span class="hljs-number"><span class="hljs-number">7</span></span> #define RELE_2 <span class="hljs-number"><span class="hljs-number">11</span></span> //  <span class="hljs-number"><span class="hljs-number">2</span></span>    <span class="hljs-number"><span class="hljs-number">8</span></span> //  A4  SDA   SDA  //  A5  SCL   SCL  int FullMinutesTimerOn = EEPROM.read(<span class="hljs-number"><span class="hljs-number">0</span></span>); int FullMinutesTimerOff = EEPROM.read(<span class="hljs-number"><span class="hljs-number">2</span></span>); int rtc[<span class="hljs-number"><span class="hljs-number">7</span></span>]; byte rr[<span class="hljs-number"><span class="hljs-number">7</span></span>]; int ledPin = <span class="hljs-number"><span class="hljs-number">13</span></span>; LiquidCrystal_I2C lcd(<span class="hljs-number"><span class="hljs-number">0</span></span>x27,<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>); // <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> the LCD address to <span class="hljs-number"><span class="hljs-number">0</span></span>x27 <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a <span class="hljs-number"><span class="hljs-number">16</span></span> chars and <span class="hljs-number"><span class="hljs-number">2</span></span> line display int button1 = <span class="hljs-number"><span class="hljs-number">10</span></span>; //   D10 int button2 = <span class="hljs-number"><span class="hljs-number">9</span></span>; //   D9 int button3 = <span class="hljs-number"><span class="hljs-number">8</span></span>; //   D8 int button4 = <span class="hljs-number"><span class="hljs-number">7</span></span>; //   D7 int button5 = <span class="hljs-number"><span class="hljs-number">6</span></span>; //   D6 int led = <span class="hljs-number"><span class="hljs-number">5</span></span>; int rejim=<span class="hljs-number"><span class="hljs-number">0</span></span>; //     int PrevSec=<span class="hljs-number"><span class="hljs-number">0</span></span>; int CurSec=<span class="hljs-number"><span class="hljs-number">0</span></span>; boolean lastButton=LOW; byte LT[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B00111, B01111, B11111, B11111, B11111, B11111, B11111, B11111 }; byte UB[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11111, B11111, B11111, B00000, B00000, B00000, B00000, B00000 }; byte RT[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11100, B11110, B11111, B11111, B11111, B11111, B11111, B11111 }; byte LL[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11111, B11111, B11111, B11111, B11111, B11111, B01111, B00111 }; byte LB[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B00000, B00000, B00000, B00000, B00000, B11111, B11111, B11111 }; byte LR[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11111, B11111, B11111, B11111, B11111, B11111, B11110, B11100 }; byte MB[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11111, B11111, B11111, B00000, B00000, B00000, B11111, B11111 }; byte block[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11111, B11111, B11111, B11111, B11111, B11111, B11111, B11111 }; // loop counter int count = <span class="hljs-number"><span class="hljs-number">0</span></span>; void setup () { DDRC|=_BV(<span class="hljs-number"><span class="hljs-number">2</span></span>) |_BV(<span class="hljs-number"><span class="hljs-number">3</span></span>); // POWER:Vcc Gnd PORTC |=_BV(<span class="hljs-number"><span class="hljs-number">3</span></span>); // VCC PINC3 pinMode(ledPin, OUTPUT); //pinMode(timePIN, OUTPUT); pinMode(RELE_1, OUTPUT); //     pinMode(RELE_2, OUTPUT); //     digitalWrite(RELE_1, HIGH); //    digitalWrite(RELE_2, HIGH); //    RTC.get(rtc,true); lcd.init(); // initialize the lcd lcd.backlight(); lcd.home(); lcd.createChar(<span class="hljs-number"><span class="hljs-number">0</span></span>,LT); lcd.createChar(<span class="hljs-number"><span class="hljs-number">1</span></span>,UB); lcd.createChar(<span class="hljs-number"><span class="hljs-number">2</span></span>,RT); lcd.createChar(<span class="hljs-number"><span class="hljs-number">3</span></span>,LL); lcd.createChar(<span class="hljs-number"><span class="hljs-number">4</span></span>,LB); lcd.createChar(<span class="hljs-number"><span class="hljs-number">5</span></span>,LR); lcd.createChar(<span class="hljs-number"><span class="hljs-number">6</span></span>,MB); lcd.createChar(<span class="hljs-number"><span class="hljs-number">7</span></span>,block); // sets the LCD's rows and colums: lcd.clear(); RTC.SetOutput(DS1307_SQW32KHZ); pinMode(led, OUTPUT); pinMode(button1, INPUT); pinMode(button2, INPUT); pinMode(button3, INPUT); } void custom0(int x) { // uses segments to build the number <span class="hljs-number"><span class="hljs-number">0</span></span> lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); // <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> cursor to column <span class="hljs-number"><span class="hljs-number">0</span></span>, line <span class="hljs-number"><span class="hljs-number">0</span></span> (first row) lcd.write(<span class="hljs-number"><span class="hljs-number">0</span></span>); // <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> each segment to create lcd.write(<span class="hljs-number"><span class="hljs-number">1</span></span>); // top half of the number lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); // <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> cursor to colum <span class="hljs-number"><span class="hljs-number">0</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span> (second row) lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); // <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> each segment to create lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); // bottom half of the number lcd.write(<span class="hljs-number"><span class="hljs-number">5</span></span>); } void custom1(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">7</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); } void custom2(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); } void custom3(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">5</span></span>); } void custom4(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">7</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.write(<span class="hljs-number"><span class="hljs-number">7</span></span>); } void custom5(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">5</span></span>); } void custom6(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">5</span></span>); } void custom7(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.write(<span class="hljs-number"><span class="hljs-number">7</span></span>); } void custom8(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">5</span></span>); } void custom9(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.write(<span class="hljs-number"><span class="hljs-number">7</span></span>); } void digitalClockDisplay(){ // digital clock display of the <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> printDigits(rtc[<span class="hljs-number"><span class="hljs-number">2</span></span>]/<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); printDigits(rtc[<span class="hljs-number"><span class="hljs-number">2</span></span>]%<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>); printDigits(rtc[<span class="hljs-number"><span class="hljs-number">1</span></span>]/<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>); printDigits(rtc[<span class="hljs-number"><span class="hljs-number">1</span></span>]%<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">13</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rtc[<span class="hljs-number"><span class="hljs-number">0</span></span>]<span class="hljs-variable"><span class="hljs-variable">%10%</span></span><span class="hljs-number"><span class="hljs-number">2</span></span>==<span class="hljs-number"><span class="hljs-number">0</span></span>){ lcd.setCursor(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+ "); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" +"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" +"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+ "); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); } //  } void printDigits(int digits, int x){ // utility function <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> digital clock display: prints preceding colon and leading <span class="hljs-number"><span class="hljs-number">0</span></span> switch (digits) { case <span class="hljs-number"><span class="hljs-number">0</span></span>: custom0(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">1</span></span>: custom1(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">2</span></span>: custom2(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">3</span></span>: custom3(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">4</span></span>: custom4(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">5</span></span>: custom5(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">6</span></span>: custom6(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">7</span></span>: custom7(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">8</span></span>: custom8(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">9</span></span>: custom9(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; } } void loop () { int hourOn=EEPROM.read(<span class="hljs-number"><span class="hljs-number">110</span></span>); //EEPROM.read(<span class="hljs-number"><span class="hljs-number">110</span></span>) int hourOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">112</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">112</span></span>) int minOn= EEPROM.read(<span class="hljs-number"><span class="hljs-number">111</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">111</span></span>) int minOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">113</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">113</span></span>) int minVent= EEPROM.read(<span class="hljs-number"><span class="hljs-number">114</span></span>); //   int Hour = rtc[<span class="hljs-number"><span class="hljs-number">2</span></span>]; //  int Minute = rtc[<span class="hljs-number"><span class="hljs-number">1</span></span>]; //  int Second = rtc[<span class="hljs-number"><span class="hljs-number">0</span></span>]; //   int FullMinutes = Hour * <span class="hljs-number"><span class="hljs-number">60</span></span> + Minute; //      int FullMinutesTimerOn= hourOn*<span class="hljs-number"><span class="hljs-number">60</span></span>+minOn; //      int FullMinutesTimerOff= hourOff*<span class="hljs-number"><span class="hljs-number">60</span></span>+minOff; //      int sutki=<span class="hljs-number"><span class="hljs-number">0</span></span>; //  ,      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hourOff-hourOn &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) sutki=<span class="hljs-number"><span class="hljs-number">1</span></span>; //     ,    =<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> sutki=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sutki==<span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; (FullMinutes &gt;= FullMinutesTimerOn || FullMinutes &lt;= FullMinutesTimerOff) ) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("VKL1"); digitalWrite(RELE_1, LOW); //   ,      } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sutki==<span class="hljs-number"><span class="hljs-number">1</span></span>) { lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); digitalWrite(RELE_1, HIGH); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sutki == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; (FullMinutes &gt;= FullMinutesTimerOn &amp;&amp; FullMinutes &lt;= FullMinutesTimerOff )) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("VKL0"); digitalWrite(RELE_1, LOW); } //    ,      <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sutki == <span class="hljs-number"><span class="hljs-number">0</span></span>) { lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); digitalWrite(RELE_1, HIGH); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((Minute &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; Minute &lt;= minVent) &amp;&amp; (Hour &gt;= <span class="hljs-number"><span class="hljs-number">9</span></span> &amp;&amp; Hour &lt;= <span class="hljs-number"><span class="hljs-number">21</span></span>)) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("VEN"); digitalWrite(RELE_2, LOW); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Minute &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; Minute &gt; minVent) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); digitalWrite(RELE_2, HIGH); } RTC.get(rtc,true); digitalClockDisplay(); //    <span class="hljs-number"><span class="hljs-number">2</span></span>  strokatimera(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">0</span></span>) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("ojidayu komandi"); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">1</span></span>) { setTimerOn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">2</span></span>) { setTimerOff(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">3</span></span>) { setTime(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">4</span></span>) { setVent(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead (button5) == HIGH) { rejim++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim&gt;<span class="hljs-number"><span class="hljs-number">4</span></span>) rejim=<span class="hljs-number"><span class="hljs-number">0</span></span>; lcd.clear(); //} } } void setTimerOn() { int hourOn= EEPROM.read(<span class="hljs-number"><span class="hljs-number">110</span></span>); int minOn= EEPROM.read(<span class="hljs-number"><span class="hljs-number">111</span></span>); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("nastroika VKL"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button3)==HIGH) //     { hourOn++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hourOn &gt;=<span class="hljs-number"><span class="hljs-number">24</span></span>) hourOn=<span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!digitalRead(button4)) //     { minOn++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (minOn &gt;=<span class="hljs-number"><span class="hljs-number">60</span></span>) { minOn=<span class="hljs-number"><span class="hljs-number">0</span></span>; hourOn++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hourOn &gt;=<span class="hljs-number"><span class="hljs-number">24</span></span>) hourOn=<span class="hljs-number"><span class="hljs-number">0</span></span>; } } strokatimera(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button2) == HIGH) { EEPROM.write(<span class="hljs-number"><span class="hljs-number">110</span></span>, hourOn); EEPROM.write(<span class="hljs-number"><span class="hljs-number">111</span></span>, minOn); lcd.clear(); } } void setTimerOff() { int hourOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">112</span></span>); int minOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">113</span></span>); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("nastroika VIKL"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button3)==HIGH) //     { hourOff++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hourOff &gt;=<span class="hljs-number"><span class="hljs-number">24</span></span>) hourOff=<span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!digitalRead(button4)) //     { minOff++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (minOff &gt;=<span class="hljs-number"><span class="hljs-number">60</span></span>) { minOff=<span class="hljs-number"><span class="hljs-number">0</span></span>; hourOff++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hourOff &gt;=<span class="hljs-number"><span class="hljs-number">24</span></span>) hourOff=<span class="hljs-number"><span class="hljs-number">0</span></span>; } } strokatimera(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button2) == HIGH) { EEPROM.write(<span class="hljs-number"><span class="hljs-number">112</span></span>, hourOff); EEPROM.write(<span class="hljs-number"><span class="hljs-number">113</span></span>, minOff); lcd.clear(); } } void setTime() { int Hour = rtc[<span class="hljs-number"><span class="hljs-number">2</span></span>]; //  int Minute = rtc[<span class="hljs-number"><span class="hljs-number">1</span></span>]; //lcd.clear(); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("nastroika <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>"); RTC.get(rtc,true); //lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); //        // lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(Hour); // lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(":"); // lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(Minute); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!digitalRead(button4)) //     { Minute++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Minute &gt;=<span class="hljs-number"><span class="hljs-number">60</span></span>) { Minute=<span class="hljs-number"><span class="hljs-number">0</span></span>; Hour++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Hour &gt;=<span class="hljs-number"><span class="hljs-number">24</span></span>) Hour=<span class="hljs-number"><span class="hljs-number">0</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button2) == HIGH) { RTC.<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DS1307_MIN,Minute); RTC.<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DS1307_HR,Hour); lcd.clear(); } } void strokatimera() { int hourOn=EEPROM.read(<span class="hljs-number"><span class="hljs-number">110</span></span>); //EEPROM.read(<span class="hljs-number"><span class="hljs-number">110</span></span>) int hourOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">112</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">112</span></span>) int minOn= EEPROM.read(<span class="hljs-number"><span class="hljs-number">111</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">111</span></span>) int minOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">113</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">113</span></span>) int minVent= EEPROM.read(<span class="hljs-number"><span class="hljs-number">114</span></span>); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); //        lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(hourOn); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(":"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(minOn); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("-"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(hourOff); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(":"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(minOff); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("VENT:"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(minVent); } void setVent() { int minVent= EEPROM.read(<span class="hljs-number"><span class="hljs-number">114</span></span>); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("nastroika Vent"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!digitalRead(button4)) //     { minVent++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (minVent &gt;=<span class="hljs-number"><span class="hljs-number">60</span></span>) { minVent=<span class="hljs-number"><span class="hljs-number">0</span></span>; } } strokatimera(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button2) == HIGH) { EEPROM.write(<span class="hljs-number"><span class="hljs-number">114</span></span>, minVent); lcd.clear(); } }</code> </pre><br></div></div><br>  In the future, this controller is planned to be connected to OpenHab in order to remotely monitor and control the heating and ventilation system of the house. <br><br>  Version 1.1 of the firmware, which allows you to: <br><ul><li>  control the boiler for a specified time </li><li>  control the boiler by the day of the week (new) </li><li>  manage the ventilation system by time (every hour for a specified number of minutes is activated) </li><li>  Displays the current day and the heating in today (in the upper right corner of the screen the day number and + or - the mode of switching on today </li></ul><br><br><div class="spoiler">  <b class="spoiler_title">Added work by day</b> <div class="spoiler_text"><pre> <code class="hljs dos">// <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span> and <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> functions using a DS1307 RTC connected via I2C and Wire lib #include &lt;EEPROM.h&gt; #include &lt;Wire.h&gt; #include &lt;DS1307.h&gt; #include "RTClib.h" #include &lt;LiquidCrystal_I2C.h&gt; //#define timePIN <span class="hljs-number"><span class="hljs-number">10</span></span> #define RELE_1 <span class="hljs-number"><span class="hljs-number">12</span></span> //  <span class="hljs-number"><span class="hljs-number">1</span></span>    <span class="hljs-number"><span class="hljs-number">7</span></span> #define RELE_2 <span class="hljs-number"><span class="hljs-number">11</span></span> //  <span class="hljs-number"><span class="hljs-number">2</span></span>    <span class="hljs-number"><span class="hljs-number">8</span></span> // //  A4  SDA   SDA  //  A5  SCL   SCL  int FullMinutesTimerOn = EEPROM.read(<span class="hljs-number"><span class="hljs-number">0</span></span>); int FullMinutesTimerOff = EEPROM.read(<span class="hljs-number"><span class="hljs-number">2</span></span>); int rtc[<span class="hljs-number"><span class="hljs-number">7</span></span>]; byte rr[<span class="hljs-number"><span class="hljs-number">7</span></span>]; int ledPin = <span class="hljs-number"><span class="hljs-number">13</span></span>; LiquidCrystal_I2C lcd(<span class="hljs-number"><span class="hljs-number">0</span></span>x27,<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>); // <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> the LCD address to <span class="hljs-number"><span class="hljs-number">0</span></span>x27 <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a <span class="hljs-number"><span class="hljs-number">16</span></span> chars and <span class="hljs-number"><span class="hljs-number">2</span></span> line display int button1 = <span class="hljs-number"><span class="hljs-number">10</span></span>; //   D10 int button2 = <span class="hljs-number"><span class="hljs-number">9</span></span>; //   D9 int button3 = <span class="hljs-number"><span class="hljs-number">8</span></span>; //   D8 int button4 = <span class="hljs-number"><span class="hljs-number">7</span></span>; //   D7 int button5 = <span class="hljs-number"><span class="hljs-number">6</span></span>; //   D6 int led = <span class="hljs-number"><span class="hljs-number">5</span></span>; int rejim=<span class="hljs-number"><span class="hljs-number">0</span></span>; //     int i=<span class="hljs-number"><span class="hljs-number">1</span></span>; //       int PrevSec=<span class="hljs-number"><span class="hljs-number">0</span></span>; int CurSec=<span class="hljs-number"><span class="hljs-number">0</span></span>; int Day=<span class="hljs-number"><span class="hljs-number">0</span></span>; boolean lastButton=LOW; byte LT[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B00111, B01111, B11111, B11111, B11111, B11111, B11111, B11111 }; byte UB[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11111, B11111, B11111, B00000, B00000, B00000, B00000, B00000 }; byte RT[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11100, B11110, B11111, B11111, B11111, B11111, B11111, B11111 }; byte LL[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11111, B11111, B11111, B11111, B11111, B11111, B01111, B00111 }; byte LB[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B00000, B00000, B00000, B00000, B00000, B11111, B11111, B11111 }; byte LR[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11111, B11111, B11111, B11111, B11111, B11111, B11110, B11100 }; byte MB[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11111, B11111, B11111, B00000, B00000, B00000, B11111, B11111 }; byte block[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11111, B11111, B11111, B11111, B11111, B11111, B11111, B11111 }; // loop counter int count = <span class="hljs-number"><span class="hljs-number">0</span></span>; void setup () { DDRC|=_BV(<span class="hljs-number"><span class="hljs-number">2</span></span>) |_BV(<span class="hljs-number"><span class="hljs-number">3</span></span>); // POWER:Vcc Gnd PORTC |=_BV(<span class="hljs-number"><span class="hljs-number">3</span></span>); // VCC PINC3 pinMode(ledPin, OUTPUT); //pinMode(timePIN, OUTPUT); pinMode(RELE_1, OUTPUT); //     pinMode(RELE_2, OUTPUT); //     digitalWrite(RELE_1, HIGH); //    digitalWrite(RELE_2, HIGH); //    RTC.get(rtc,true); lcd.init(); // initialize the lcd lcd.backlight(); lcd.home(); lcd.createChar(<span class="hljs-number"><span class="hljs-number">0</span></span>,LT); lcd.createChar(<span class="hljs-number"><span class="hljs-number">1</span></span>,UB); lcd.createChar(<span class="hljs-number"><span class="hljs-number">2</span></span>,RT); lcd.createChar(<span class="hljs-number"><span class="hljs-number">3</span></span>,LL); lcd.createChar(<span class="hljs-number"><span class="hljs-number">4</span></span>,LB); lcd.createChar(<span class="hljs-number"><span class="hljs-number">5</span></span>,LR); lcd.createChar(<span class="hljs-number"><span class="hljs-number">6</span></span>,MB); lcd.createChar(<span class="hljs-number"><span class="hljs-number">7</span></span>,block); // sets the LCD's rows and colums: lcd.clear(); RTC.SetOutput(DS1307_SQW32KHZ); pinMode(led, OUTPUT); pinMode(button1, INPUT); pinMode(button2, INPUT); pinMode(button3, INPUT); } void custom0(int x) { // uses segments to build the number <span class="hljs-number"><span class="hljs-number">0</span></span> lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); // <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> cursor to column <span class="hljs-number"><span class="hljs-number">0</span></span>, line <span class="hljs-number"><span class="hljs-number">0</span></span> (first row) lcd.write(<span class="hljs-number"><span class="hljs-number">0</span></span>); // <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> each segment to create lcd.write(<span class="hljs-number"><span class="hljs-number">1</span></span>); // top half of the number lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); // <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> cursor to colum <span class="hljs-number"><span class="hljs-number">0</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span> (second row) lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); // <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> each segment to create lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); // bottom half of the number lcd.write(<span class="hljs-number"><span class="hljs-number">5</span></span>); } void custom1(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">7</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); } void custom2(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); } void custom3(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">5</span></span>); } void custom4(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">7</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.write(<span class="hljs-number"><span class="hljs-number">7</span></span>); } void custom5(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">5</span></span>); } void custom6(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">5</span></span>); } void custom7(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.write(<span class="hljs-number"><span class="hljs-number">7</span></span>); } void custom8(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">5</span></span>); } void custom9(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.write(<span class="hljs-number"><span class="hljs-number">7</span></span>); } void digitalClockDisplay(){ // digital clock display of the <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> printDigits(rtc[<span class="hljs-number"><span class="hljs-number">2</span></span>]/<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); printDigits(rtc[<span class="hljs-number"><span class="hljs-number">2</span></span>]%<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>); printDigits(rtc[<span class="hljs-number"><span class="hljs-number">1</span></span>]/<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>); printDigits(rtc[<span class="hljs-number"><span class="hljs-number">1</span></span>]%<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">13</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rtc[<span class="hljs-number"><span class="hljs-number">0</span></span>]<span class="hljs-variable"><span class="hljs-variable">%10%</span></span><span class="hljs-number"><span class="hljs-number">2</span></span>==<span class="hljs-number"><span class="hljs-number">0</span></span>){ lcd.setCursor(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+ "); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" +"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" +"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+ "); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); } //  } void printDigits(int digits, int x){ // utility function <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> digital clock display: prints preceding colon and leading <span class="hljs-number"><span class="hljs-number">0</span></span> switch (digits) { case <span class="hljs-number"><span class="hljs-number">0</span></span>: custom0(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">1</span></span>: custom1(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">2</span></span>: custom2(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">3</span></span>: custom3(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">4</span></span>: custom4(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">5</span></span>: custom5(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">6</span></span>: custom6(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">7</span></span>: custom7(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">8</span></span>: custom8(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">9</span></span>: custom9(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; } } void loop () { int hourOn=EEPROM.read(<span class="hljs-number"><span class="hljs-number">110</span></span>); //EEPROM.read(<span class="hljs-number"><span class="hljs-number">110</span></span>) int hourOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">112</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">112</span></span>) int minOn= EEPROM.read(<span class="hljs-number"><span class="hljs-number">111</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">111</span></span>) int minOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">113</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">113</span></span>) int minVent= EEPROM.read(<span class="hljs-number"><span class="hljs-number">114</span></span>); //   int rejimDay=<span class="hljs-number"><span class="hljs-number">0</span></span>; int Day = rtc[<span class="hljs-number"><span class="hljs-number">3</span></span>]; //  int Hour = rtc[<span class="hljs-number"><span class="hljs-number">2</span></span>]; //  int Minute = rtc[<span class="hljs-number"><span class="hljs-number">1</span></span>]; //  int Second = rtc[<span class="hljs-number"><span class="hljs-number">0</span></span>]; //   int FullMinutes = Hour * <span class="hljs-number"><span class="hljs-number">60</span></span> + Minute; //      int FullMinutesTimerOn= hourOn*<span class="hljs-number"><span class="hljs-number">60</span></span>+minOn; //      int FullMinutesTimerOff= hourOff*<span class="hljs-number"><span class="hljs-number">60</span></span>+minOff; //      int sutki=<span class="hljs-number"><span class="hljs-number">0</span></span>; //  ,      lcd.setCursor(<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(Day); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hourOff-hourOn &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) sutki=<span class="hljs-number"><span class="hljs-number">1</span></span>; //     ,    =<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> sutki=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (EEPROM.read(<span class="hljs-number"><span class="hljs-number">114</span></span>+Day)==<span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; sutki==<span class="hljs-number"><span class="hljs-number">1</span></span>) { rejimDay=<span class="hljs-number"><span class="hljs-number">1</span></span>; lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+"); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { rejimDay=<span class="hljs-number"><span class="hljs-number">0</span></span>; lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("-"); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sutki==<span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; (FullMinutes &gt;= FullMinutesTimerOn || FullMinutes &lt;= FullMinutesTimerOff) ) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("VKL"); digitalWrite(RELE_1, LOW); //   ,      } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sutki==<span class="hljs-number"><span class="hljs-number">1</span></span>) { lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); digitalWrite(RELE_1, HIGH); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sutki == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; (FullMinutes &gt;= FullMinutesTimerOn &amp;&amp; FullMinutes &lt;= FullMinutesTimerOff )) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("VKL"); digitalWrite(RELE_1, LOW); } //    ,      <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sutki == <span class="hljs-number"><span class="hljs-number">0</span></span>) { lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); digitalWrite(RELE_1, HIGH); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((Minute &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; Minute &lt;= minVent) &amp;&amp; (Hour &gt;= <span class="hljs-number"><span class="hljs-number">9</span></span> &amp;&amp; Hour &lt;= <span class="hljs-number"><span class="hljs-number">21</span></span>)) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("VEN"); digitalWrite(RELE_2, LOW); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Minute &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; Minute &gt; minVent) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); digitalWrite(RELE_2, HIGH); } RTC.get(rtc,true); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">0</span></span>) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("ojidayu komandi"); strokatimera(); digitalClockDisplay(); //    <span class="hljs-number"><span class="hljs-number">2</span></span>  } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">1</span></span>) { setTimerOn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">2</span></span>) { setTimerOff(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">3</span></span>) { setTime(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">4</span></span>) { setVent(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">5</span></span>) { setTimerDay1(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead (button5) == HIGH) { rejim++; delay(<span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim&gt;<span class="hljs-number"><span class="hljs-number">5</span></span>) rejim=<span class="hljs-number"><span class="hljs-number">0</span></span>; lcd.clear(); //} } } void setTimerOn() { int hourOn= EEPROM.read(<span class="hljs-number"><span class="hljs-number">110</span></span>); int minOn= EEPROM.read(<span class="hljs-number"><span class="hljs-number">111</span></span>); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("nastroika VKL"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button3)==HIGH) //     { hourOn++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hourOn &gt;=<span class="hljs-number"><span class="hljs-number">24</span></span>) hourOn=<span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button2)==HIGH) //     { minOn++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (minOn &gt;=<span class="hljs-number"><span class="hljs-number">60</span></span>) { minOn=<span class="hljs-number"><span class="hljs-number">0</span></span>; hourOn++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hourOn &gt;=<span class="hljs-number"><span class="hljs-number">24</span></span>) hourOn=<span class="hljs-number"><span class="hljs-number">0</span></span>; } } strokatimera(); digitalClockDisplay(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button2) == HIGH) { EEPROM.write(<span class="hljs-number"><span class="hljs-number">110</span></span>, hourOn); EEPROM.write(<span class="hljs-number"><span class="hljs-number">111</span></span>, minOn); lcd.clear(); } } void setTimerOff() { int hourOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">112</span></span>); int minOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">113</span></span>); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("nastroika VIKL"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button3)==HIGH) //     { hourOff++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hourOff &gt;=<span class="hljs-number"><span class="hljs-number">24</span></span>) hourOff=<span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!digitalRead(button4)) //     { minOff++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (minOff &gt;=<span class="hljs-number"><span class="hljs-number">60</span></span>) { minOff=<span class="hljs-number"><span class="hljs-number">0</span></span>; hourOff++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hourOff &gt;=<span class="hljs-number"><span class="hljs-number">24</span></span>) hourOff=<span class="hljs-number"><span class="hljs-number">0</span></span>; } } strokatimera(); digitalClockDisplay(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button2) == HIGH) { EEPROM.write(<span class="hljs-number"><span class="hljs-number">112</span></span>, hourOff); EEPROM.write(<span class="hljs-number"><span class="hljs-number">113</span></span>, minOff); lcd.clear(); } } void setTime() { int Hour = rtc[<span class="hljs-number"><span class="hljs-number">2</span></span>]; //  int Minute = rtc[<span class="hljs-number"><span class="hljs-number">1</span></span>]; //lcd.clear(); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("nastroika <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>"); RTC.get(rtc,true); digitalClockDisplay(); //lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); //        // lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(Hour); // lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(":"); // lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(Minute); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!digitalRead(button4)) //     { Minute++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Minute &gt;=<span class="hljs-number"><span class="hljs-number">60</span></span>) { Minute=<span class="hljs-number"><span class="hljs-number">0</span></span>; Hour++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Hour &gt;=<span class="hljs-number"><span class="hljs-number">24</span></span>) Hour=<span class="hljs-number"><span class="hljs-number">0</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button2) == HIGH) { RTC.<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DS1307_MIN,Minute); RTC.<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DS1307_HR,Hour); lcd.clear(); } } void strokatimera() { int hourOn=EEPROM.read(<span class="hljs-number"><span class="hljs-number">110</span></span>); //EEPROM.read(<span class="hljs-number"><span class="hljs-number">110</span></span>) int hourOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">112</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">112</span></span>) int minOn= EEPROM.read(<span class="hljs-number"><span class="hljs-number">111</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">111</span></span>) int minOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">113</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">113</span></span>) int minVent= EEPROM.read(<span class="hljs-number"><span class="hljs-number">114</span></span>); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); //        lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(hourOn); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(":"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(minOn); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("-"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(hourOff); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(":"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(minOff); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("VENT:"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(minVent); } void setVent() { strokatimera(); int minVent= EEPROM.read(<span class="hljs-number"><span class="hljs-number">114</span></span>); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("nastroika Vent"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!digitalRead(button4)) //     { minVent++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (minVent &gt;=<span class="hljs-number"><span class="hljs-number">60</span></span>) { minVent=<span class="hljs-number"><span class="hljs-number">0</span></span>; } } digitalClockDisplay(); //    <span class="hljs-number"><span class="hljs-number">2</span></span>  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button2) == HIGH) { EEPROM.write(<span class="hljs-number"><span class="hljs-number">114</span></span>, minVent); lcd.clear(); } } void setTimerDay1() { int z; //lcd.clear(); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("nastroika dney"); //lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.setCursor (<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (EEPROM.read(<span class="hljs-number"><span class="hljs-number">115</span></span>)); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (EEPROM.read(<span class="hljs-number"><span class="hljs-number">116</span></span>)); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (EEPROM.read(<span class="hljs-number"><span class="hljs-number">117</span></span>)); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (EEPROM.read(<span class="hljs-number"><span class="hljs-number">118</span></span>)); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (EEPROM.read(<span class="hljs-number"><span class="hljs-number">119</span></span>)); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (EEPROM.read(<span class="hljs-number"><span class="hljs-number">120</span></span>)); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (EEPROM.read(<span class="hljs-number"><span class="hljs-number">121</span></span>)); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); //lcd.clear(); z=EEPROM.read(<span class="hljs-number"><span class="hljs-number">114</span></span>+i); //     /   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i==<span class="hljs-number"><span class="hljs-number">1</span></span>) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("ponedelnik"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (z); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i==<span class="hljs-number"><span class="hljs-number">2</span></span>) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("vtornik"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (z); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i==<span class="hljs-number"><span class="hljs-number">3</span></span>) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("sreda"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (z); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i==<span class="hljs-number"><span class="hljs-number">4</span></span>) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("chetverg"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (z); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i==<span class="hljs-number"><span class="hljs-number">5</span></span>) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("pyatnica"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (z); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i==<span class="hljs-number"><span class="hljs-number">6</span></span>) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("subbota"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (z); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i==<span class="hljs-number"><span class="hljs-number">7</span></span>) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("voskresen'e"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (z); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button3)==HIGH) //   { lcd.clear(); i++; delay(<span class="hljs-number"><span class="hljs-number">150</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i&gt;<span class="hljs-number"><span class="hljs-number">7</span></span>) {i=<span class="hljs-number"><span class="hljs-number">1</span></span>;} } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button2)==HIGH) { delay(<span class="hljs-number"><span class="hljs-number">150</span></span>); z=!z; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (z!= EEPROM.read(<span class="hljs-number"><span class="hljs-number">114</span></span>+i)) { EEPROM.write(<span class="hljs-number"><span class="hljs-number">114</span></span>+i,z); } } }</code> </pre><br></div></div><br><br>  Faced with the fact that the regular work of the hood noticeably squeezes the house in extreme cold, vybrsyvaya warm air outside the room.  Added in the menu item off the hood.  On the inclusion of lighting in the toilet and bathroom hood always works.  Also corrected some points in the firmware. <br><br><div class="spoiler">  <b class="spoiler_title">Added shutdown hood</b> <div class="spoiler_text"><pre> <code class="hljs dos">// <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span> and <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> functions using a DS1307 RTC connected via I2C and Wire lib #include &lt;EEPROM.h&gt; #include &lt;Wire.h&gt; #include &lt;DS1307.h&gt; #include "RTClib.h" #include &lt;LiquidCrystal_I2C.h&gt; //#define timePIN <span class="hljs-number"><span class="hljs-number">10</span></span> #define RELE_1 <span class="hljs-number"><span class="hljs-number">11</span></span> //      #define RELE_2 <span class="hljs-number"><span class="hljs-number">12</span></span> //  ,   // //  A4  SDA   SDA  //  A5  SCL   SCL  int FullMinutesTimerOn = EEPROM.read(<span class="hljs-number"><span class="hljs-number">0</span></span>); int FullMinutesTimerOff = EEPROM.read(<span class="hljs-number"><span class="hljs-number">2</span></span>); int rtc[<span class="hljs-number"><span class="hljs-number">7</span></span>]; byte rr[<span class="hljs-number"><span class="hljs-number">7</span></span>]; int ledPin = <span class="hljs-number"><span class="hljs-number">13</span></span>; LiquidCrystal_I2C lcd(<span class="hljs-number"><span class="hljs-number">0</span></span>x27,<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>); // <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> the LCD address to <span class="hljs-number"><span class="hljs-number">0</span></span>x27 <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a <span class="hljs-number"><span class="hljs-number">16</span></span> chars and <span class="hljs-number"><span class="hljs-number">2</span></span> line display int button1 = <span class="hljs-number"><span class="hljs-number">10</span></span>; //   D10 int button2 = <span class="hljs-number"><span class="hljs-number">9</span></span>; //   D9 int button3 = <span class="hljs-number"><span class="hljs-number">8</span></span>; //   D8 int button4 = <span class="hljs-number"><span class="hljs-number">7</span></span>; //   D7 int button5 = <span class="hljs-number"><span class="hljs-number">6</span></span>; //   D6 int vanna = <span class="hljs-number"><span class="hljs-number">2</span></span>; //     D2 int led = <span class="hljs-number"><span class="hljs-number">5</span></span>; int rejim=<span class="hljs-number"><span class="hljs-number">0</span></span>; //     int i=<span class="hljs-number"><span class="hljs-number">1</span></span>; //       int PrevSec=<span class="hljs-number"><span class="hljs-number">0</span></span>; int CurSec=<span class="hljs-number"><span class="hljs-number">0</span></span>; int Day=<span class="hljs-number"><span class="hljs-number">0</span></span>; int vannatimer=<span class="hljs-number"><span class="hljs-number">0</span></span>; boolean lastButton=LOW; byte LT[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B00111, B01111, B11111, B11111, B11111, B11111, B11111, B11111 }; byte UB[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11111, B11111, B11111, B00000, B00000, B00000, B00000, B00000 }; byte RT[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11100, B11110, B11111, B11111, B11111, B11111, B11111, B11111 }; byte LL[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11111, B11111, B11111, B11111, B11111, B11111, B01111, B00111 }; byte LB[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B00000, B00000, B00000, B00000, B00000, B11111, B11111, B11111 }; byte LR[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11111, B11111, B11111, B11111, B11111, B11111, B11110, B11100 }; byte MB[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11111, B11111, B11111, B00000, B00000, B00000, B11111, B11111 }; byte block[<span class="hljs-number"><span class="hljs-number">8</span></span>] = { B11111, B11111, B11111, B11111, B11111, B11111, B11111, B11111 }; // loop counter int count = <span class="hljs-number"><span class="hljs-number">0</span></span>; void setup () { DDRC|=_BV(<span class="hljs-number"><span class="hljs-number">2</span></span>) |_BV(<span class="hljs-number"><span class="hljs-number">3</span></span>); // POWER:Vcc Gnd PORTC |=_BV(<span class="hljs-number"><span class="hljs-number">3</span></span>); // VCC PINC3 pinMode(ledPin, OUTPUT); //pinMode(timePIN, OUTPUT); pinMode(RELE_1, OUTPUT); //     pinMode(RELE_2, OUTPUT); //     digitalWrite(RELE_1, HIGH); //    digitalWrite(RELE_2, HIGH); //    RTC.get(rtc,true); lcd.init(); // initialize the lcd lcd.backlight(); lcd.home(); lcd.createChar(<span class="hljs-number"><span class="hljs-number">0</span></span>,LT); lcd.createChar(<span class="hljs-number"><span class="hljs-number">1</span></span>,UB); lcd.createChar(<span class="hljs-number"><span class="hljs-number">2</span></span>,RT); lcd.createChar(<span class="hljs-number"><span class="hljs-number">3</span></span>,LL); lcd.createChar(<span class="hljs-number"><span class="hljs-number">4</span></span>,LB); lcd.createChar(<span class="hljs-number"><span class="hljs-number">5</span></span>,LR); lcd.createChar(<span class="hljs-number"><span class="hljs-number">6</span></span>,MB); lcd.createChar(<span class="hljs-number"><span class="hljs-number">7</span></span>,block); // sets the LCD's rows and colums: lcd.clear(); RTC.SetOutput(DS1307_SQW32KHZ); pinMode(led, OUTPUT); pinMode(button1, INPUT); pinMode(button2, INPUT); pinMode(button3, INPUT); pinMode(vanna, INPUT); //    - } void custom0(int x) { // uses segments to build the number <span class="hljs-number"><span class="hljs-number">0</span></span> lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); // <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> cursor to column <span class="hljs-number"><span class="hljs-number">0</span></span>, line <span class="hljs-number"><span class="hljs-number">0</span></span> (first row) lcd.write(<span class="hljs-number"><span class="hljs-number">0</span></span>); // <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> each segment to create lcd.write(<span class="hljs-number"><span class="hljs-number">1</span></span>); // top half of the number lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); // <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> cursor to colum <span class="hljs-number"><span class="hljs-number">0</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span> (second row) lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); // <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> each segment to create lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); // bottom half of the number lcd.write(<span class="hljs-number"><span class="hljs-number">5</span></span>); } void custom1(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">7</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); } void custom2(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); } void custom3(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">5</span></span>); } void custom4(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">7</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.write(<span class="hljs-number"><span class="hljs-number">7</span></span>); } void custom5(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">5</span></span>); } void custom6(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">5</span></span>); } void custom7(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.write(<span class="hljs-number"><span class="hljs-number">7</span></span>); } void custom8(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">4</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">5</span></span>); } void custom9(int x) { lcd.setCursor(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">6</span></span>); lcd.write(<span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.setCursor(x, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.write(<span class="hljs-number"><span class="hljs-number">7</span></span>); } void digitalClockDisplay(){ // digital clock display of the <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> printDigits(rtc[<span class="hljs-number"><span class="hljs-number">2</span></span>]/<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); printDigits(rtc[<span class="hljs-number"><span class="hljs-number">2</span></span>]%<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>); printDigits(rtc[<span class="hljs-number"><span class="hljs-number">1</span></span>]/<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>); printDigits(rtc[<span class="hljs-number"><span class="hljs-number">1</span></span>]%<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">13</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rtc[<span class="hljs-number"><span class="hljs-number">0</span></span>]<span class="hljs-variable"><span class="hljs-variable">%10%</span></span><span class="hljs-number"><span class="hljs-number">2</span></span>==<span class="hljs-number"><span class="hljs-number">0</span></span>){ lcd.setCursor(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+ "); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" +"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" +"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+ "); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+"); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); } //  } void printDigits(int digits, int x){ // utility function <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> digital clock display: prints preceding colon and leading <span class="hljs-number"><span class="hljs-number">0</span></span> switch (digits) { case <span class="hljs-number"><span class="hljs-number">0</span></span>: custom0(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">1</span></span>: custom1(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">2</span></span>: custom2(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">3</span></span>: custom3(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">4</span></span>: custom4(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">5</span></span>: custom5(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">6</span></span>: custom6(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">7</span></span>: custom7(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">8</span></span>: custom8(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; case <span class="hljs-number"><span class="hljs-number">9</span></span>: custom9(x); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; } } void loop () { int hourOn=EEPROM.read(<span class="hljs-number"><span class="hljs-number">110</span></span>); //EEPROM.read(<span class="hljs-number"><span class="hljs-number">110</span></span>) int hourOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">112</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">112</span></span>) int minOn= EEPROM.read(<span class="hljs-number"><span class="hljs-number">111</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">111</span></span>) int minOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">113</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">113</span></span>) int minVent= EEPROM.read(<span class="hljs-number"><span class="hljs-number">114</span></span>); //   int Vent= EEPROM.read(<span class="hljs-number"><span class="hljs-number">122</span></span>); int rejimDay=<span class="hljs-number"><span class="hljs-number">0</span></span>; int Day = rtc[<span class="hljs-number"><span class="hljs-number">3</span></span>]; //  int Hour = rtc[<span class="hljs-number"><span class="hljs-number">2</span></span>]; //  int Minute = rtc[<span class="hljs-number"><span class="hljs-number">1</span></span>]; //  int Second = rtc[<span class="hljs-number"><span class="hljs-number">0</span></span>]; //   int FullMinutes = Hour * <span class="hljs-number"><span class="hljs-number">60</span></span> + Minute; //      int FullMinutesTimerOn= hourOn*<span class="hljs-number"><span class="hljs-number">60</span></span>+minOn; //      int FullMinutesTimerOff= hourOff*<span class="hljs-number"><span class="hljs-number">60</span></span>+minOff; //      int sutki=<span class="hljs-number"><span class="hljs-number">0</span></span>; //  ,      //<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead (vanna) == HIGH) //           //{ // digitalWrite(RELE_2, LOW); //digitalWrite(ledPin, HIGH); // vannatimer=<span class="hljs-number"><span class="hljs-number">1</span></span>; //} lcd.setCursor(<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(Day); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hourOff-hourOn &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) sutki=<span class="hljs-number"><span class="hljs-number">1</span></span>; //     ,    =<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> sutki=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (EEPROM.read(<span class="hljs-number"><span class="hljs-number">114</span></span>+Day)==<span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; sutki==<span class="hljs-number"><span class="hljs-number">1</span></span>) { rejimDay=<span class="hljs-number"><span class="hljs-number">1</span></span>; lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("+"); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { rejimDay=<span class="hljs-number"><span class="hljs-number">0</span></span>; lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("-"); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((sutki==<span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; rejimDay==<span class="hljs-number"><span class="hljs-number">1</span></span>) &amp;&amp; (FullMinutes &gt;= FullMinutesTimerOn || FullMinutes &lt;= FullMinutesTimerOff) ) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("VKL"); digitalWrite(RELE_1, LOW); //   ,      } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sutki==<span class="hljs-number"><span class="hljs-number">1</span></span>) { lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); digitalWrite(RELE_1, HIGH); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sutki == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; (FullMinutes &gt;= FullMinutesTimerOn &amp;&amp; FullMinutes &lt;= FullMinutesTimerOff )) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("VKL"); digitalWrite(RELE_1, LOW); } //    ,      <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sutki == <span class="hljs-number"><span class="hljs-number">0</span></span>) { lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); digitalWrite(RELE_1, HIGH); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((Minute &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; Minute &lt;= minVent) &amp;&amp; (Hour &gt;= <span class="hljs-number"><span class="hljs-number">9</span></span> &amp;&amp; Hour &lt;= <span class="hljs-number"><span class="hljs-number">21</span></span>))||(digitalRead (vanna) == HIGH)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Vent==<span class="hljs-number"><span class="hljs-number">1</span></span>) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("VEN"); digitalWrite(RELE_2, LOW); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((Minute &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; Minute &gt; minVent || digitalRead (vanna) == LOW)&amp;&amp;(Vent==<span class="hljs-number"><span class="hljs-number">0</span></span>)) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); digitalWrite(RELE_2, HIGH); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead (vanna) == HIGH) digitalWrite(RELE_2, LOW); //          RTC.get(rtc,true); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">0</span></span>) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("ojidayu komandi"); strokatimera(); digitalClockDisplay(); //    <span class="hljs-number"><span class="hljs-number">2</span></span>  } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">1</span></span>) { setTimerOn(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">2</span></span>) { setTimerOff(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">3</span></span>) { setTime(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">4</span></span>) { setVent(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">5</span></span>) { setVentOnOff(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim==<span class="hljs-number"><span class="hljs-number">6</span></span>) { setTimerDay1(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead (button5) == HIGH) { rejim++; delay(<span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rejim&gt;<span class="hljs-number"><span class="hljs-number">6</span></span>) rejim=<span class="hljs-number"><span class="hljs-number">0</span></span>; lcd.clear(); //} } } void setTimerOn() { int hourOn= EEPROM.read(<span class="hljs-number"><span class="hljs-number">110</span></span>); int minOn= EEPROM.read(<span class="hljs-number"><span class="hljs-number">111</span></span>); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("nastroika VKL"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button3)==HIGH) //     { hourOn++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hourOn &gt;=<span class="hljs-number"><span class="hljs-number">24</span></span>) hourOn=<span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button2)==HIGH) //     { minOn++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (minOn &gt;=<span class="hljs-number"><span class="hljs-number">60</span></span>) { minOn=<span class="hljs-number"><span class="hljs-number">0</span></span>; hourOn++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hourOn &gt;=<span class="hljs-number"><span class="hljs-number">24</span></span>) hourOn=<span class="hljs-number"><span class="hljs-number">0</span></span>; } } strokatimera(); digitalClockDisplay(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((digitalRead(button2) == HIGH)||(digitalRead(button3) == HIGH)) { EEPROM.write(<span class="hljs-number"><span class="hljs-number">110</span></span>, hourOn); EEPROM.write(<span class="hljs-number"><span class="hljs-number">111</span></span>, minOn); lcd.clear(); } } void setTimerOff() { int hourOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">112</span></span>); int minOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">113</span></span>); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("nastroika VIKL"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button3)==HIGH) //     { hourOff++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hourOff &gt;=<span class="hljs-number"><span class="hljs-number">24</span></span>) hourOff=<span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button2)==HIGH) //     { minOff++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (minOff &gt;=<span class="hljs-number"><span class="hljs-number">60</span></span>) { minOff=<span class="hljs-number"><span class="hljs-number">0</span></span>; hourOff++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hourOff &gt;=<span class="hljs-number"><span class="hljs-number">24</span></span>) hourOff=<span class="hljs-number"><span class="hljs-number">0</span></span>; } } strokatimera(); digitalClockDisplay(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((digitalRead(button2) == HIGH)||(digitalRead(button3) == HIGH)) { EEPROM.write(<span class="hljs-number"><span class="hljs-number">112</span></span>, hourOff); EEPROM.write(<span class="hljs-number"><span class="hljs-number">113</span></span>, minOff); lcd.clear(); } } void setTime() { int Hour = rtc[<span class="hljs-number"><span class="hljs-number">2</span></span>]; //  int Minute = rtc[<span class="hljs-number"><span class="hljs-number">1</span></span>]; //lcd.clear(); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("nastroika <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>"); RTC.get(rtc,true); digitalClockDisplay(); //lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); //        // lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(Hour); // lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(":"); // lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(Minute); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button2)==HIGH) //     { Minute++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Minute &gt;=<span class="hljs-number"><span class="hljs-number">60</span></span>) { Minute=<span class="hljs-number"><span class="hljs-number">0</span></span>; Hour++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Hour &gt;=<span class="hljs-number"><span class="hljs-number">24</span></span>) Hour=<span class="hljs-number"><span class="hljs-number">0</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button3)==HIGH) //     { Hour++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Hour &gt;=<span class="hljs-number"><span class="hljs-number">24</span></span>) Hour=<span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((digitalRead(button2) == HIGH)||(digitalRead(button3) == HIGH)) { RTC.<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DS1307_MIN,Minute); RTC.<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DS1307_HR,Hour); lcd.clear(); } } void strokatimera() { int hourOn=EEPROM.read(<span class="hljs-number"><span class="hljs-number">110</span></span>); //EEPROM.read(<span class="hljs-number"><span class="hljs-number">110</span></span>) int hourOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">112</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">112</span></span>) int minOn= EEPROM.read(<span class="hljs-number"><span class="hljs-number">111</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">111</span></span>) int minOff= EEPROM.read(<span class="hljs-number"><span class="hljs-number">113</span></span>);; //EEPROM.read(<span class="hljs-number"><span class="hljs-number">113</span></span>) int minVent= EEPROM.read(<span class="hljs-number"><span class="hljs-number">114</span></span>); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); //        lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(hourOn); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(":"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(minOn); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("-"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(hourOff); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(":"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(minOff); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("VENT:"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(minVent); } void setVent() { strokatimera(); int minVent= EEPROM.read(<span class="hljs-number"><span class="hljs-number">114</span></span>); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("nastroika Vent"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!digitalRead(button4)) //     { minVent++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (minVent &gt;=<span class="hljs-number"><span class="hljs-number">60</span></span>) { minVent=<span class="hljs-number"><span class="hljs-number">0</span></span>; } } digitalClockDisplay(); //    <span class="hljs-number"><span class="hljs-number">2</span></span>  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button2) == HIGH) { EEPROM.write(<span class="hljs-number"><span class="hljs-number">114</span></span>, minVent); lcd.clear(); } } void setVentOnOff() { strokatimera(); int Vent= EEPROM.read(<span class="hljs-number"><span class="hljs-number">122</span></span>); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("Vent"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Vent==<span class="hljs-number"><span class="hljs-number">0</span></span>) lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" Off"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Vent==<span class="hljs-number"><span class="hljs-number">1</span></span>) lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(" On"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!digitalRead(button4)) //       { delay(<span class="hljs-number"><span class="hljs-number">100</span></span>); Vent++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Vent &gt;=<span class="hljs-number"><span class="hljs-number">2</span></span>) { Vent=<span class="hljs-number"><span class="hljs-number">0</span></span>; } } digitalClockDisplay(); //    <span class="hljs-number"><span class="hljs-number">2</span></span>  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button2) == HIGH) { EEPROM.write(<span class="hljs-number"><span class="hljs-number">122</span></span>, Vent); lcd.clear(); } } void setTimerDay1() { int z; //lcd.clear(); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("nastroika dney"); //lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.setCursor (<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (EEPROM.read(<span class="hljs-number"><span class="hljs-number">115</span></span>)); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (EEPROM.read(<span class="hljs-number"><span class="hljs-number">116</span></span>)); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (EEPROM.read(<span class="hljs-number"><span class="hljs-number">117</span></span>)); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (EEPROM.read(<span class="hljs-number"><span class="hljs-number">118</span></span>)); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (EEPROM.read(<span class="hljs-number"><span class="hljs-number">119</span></span>)); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (EEPROM.read(<span class="hljs-number"><span class="hljs-number">120</span></span>)); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (EEPROM.read(<span class="hljs-number"><span class="hljs-number">121</span></span>)); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); //lcd.clear(); z=EEPROM.read(<span class="hljs-number"><span class="hljs-number">114</span></span>+i); //     /   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i==<span class="hljs-number"><span class="hljs-number">1</span></span>) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("ponedelnik"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (z); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i==<span class="hljs-number"><span class="hljs-number">2</span></span>) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("vtornik"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (z); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i==<span class="hljs-number"><span class="hljs-number">3</span></span>) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("sreda"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (z); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i==<span class="hljs-number"><span class="hljs-number">4</span></span>) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("chetverg"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (z); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i==<span class="hljs-number"><span class="hljs-number">5</span></span>) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("pyatnica"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (z); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i==<span class="hljs-number"><span class="hljs-number">6</span></span>) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("subbota"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (z); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i==<span class="hljs-number"><span class="hljs-number">7</span></span>) { lcd.setCursor(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> ("voskresen'e"); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (" "); lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (z); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button3)==HIGH) //   { lcd.clear(); i++; delay(<span class="hljs-number"><span class="hljs-number">150</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i&gt;<span class="hljs-number"><span class="hljs-number">7</span></span>) {i=<span class="hljs-number"><span class="hljs-number">1</span></span>;} } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button2)==HIGH) { delay(<span class="hljs-number"><span class="hljs-number">150</span></span>); z=!z; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (z!= EEPROM.read(<span class="hljs-number"><span class="hljs-number">114</span></span>+i)) { EEPROM.write(<span class="hljs-number"><span class="hljs-number">114</span></span>+i,z); } } //EEPROM.write(<span class="hljs-number"><span class="hljs-number">115</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);// //EEPROM.write(<span class="hljs-number"><span class="hljs-number">116</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);// //EEPROM.write(<span class="hljs-number"><span class="hljs-number">117</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>);// //EEPROM.write(<span class="hljs-number"><span class="hljs-number">118</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);// //EEPROM.write(<span class="hljs-number"><span class="hljs-number">119</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>);// //EEPROM.write(<span class="hljs-number"><span class="hljs-number">120</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>);// //EEPROM.write(<span class="hljs-number"><span class="hljs-number">121</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);// //z=EEPROM.read(<span class="hljs-number"><span class="hljs-number">114</span></span>+i); }</code> </pre><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/251121/">https://habr.com/ru/post/251121/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../251101/index.html">Billiard bot: the history of creation</a></li>
<li><a href="../251103/index.html">Part of the team, part of the ship</a></li>
<li><a href="../251107/index.html">API in real life: How to facilitate the task of creating sites for finding and buying auto parts</a></li>
<li><a href="../251111/index.html">SummaryJS Release 2</a></li>
<li><a href="../251117/index.html">Overview of glands for practicing robotics with children</a></li>
<li><a href="../251123/index.html">NAS + SoftetherVPN = Universal VPN Server</a></li>
<li><a href="../251127/index.html">International exhibition "EuroCIS-2015". Live twitter feed</a></li>
<li><a href="../251131/index.html">Java EE, JCA and jNode 2.X announce</a></li>
<li><a href="../251133/index.html">CxxMock - principle of operation</a></li>
<li><a href="../251137/index.html">We write a bot for MMORPG with assembler and draenei. Part 0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>