<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Taking PHP seriously</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Rocket Union, delivered by train to the launch pad. Photos from the public domain NASA. 

 This is a translation of the article Taking PHP Seriously ,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Taking PHP seriously</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/262/bb4/f50/262bb4f506e1cdcfc397149d9a9ef6f7.jpg" alt="image"><br>  <i>Rocket Union, delivered by train to the launch pad.</i>  <i>Photos from the public domain NASA.</i> <br><br>  <i>This is a translation of the article <a href="https://slack.engineering/taking-php-seriously-cf7a60065329">Taking PHP Seriously</a> , the author of which is one of the engineers of the famous Slack application.</i>  <i>He talks about the advantages and disadvantages of PHP, as well as the <a href="http://hacklang.org/">Hack</a> language and the <a href="http://hhvm.com/">HHVM</a> virtual machine, which almost completed the Slack transition.</i> <br><br>  Slack uses PHP for most of its server logic, which is not the most popular choice these days.  Why did we decide to write a new project in this language?  Should you do the same? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Most programmers who have played a little bit with PHP know two things about him: these are bad language that they will never use if they have a choice, and that some of the extremely successful projects in the history of the world use it.  This is not quite a contradiction, but this fact should make you think.  That is, Facebook, Wikipedia, Wordpress, Etsy, Baidu, Box and recently Slack - all of them successfully solve problems, despite the fact that they use PHP?  Would they be more successful if they used Ruby?  Erlang?  Haskell? <br><br>  It is possible that not. <a name="habracut"></a>  The PHP language has many flaws that undoubtedly slowed its development, but the PHP environment has such advantages that more than compensate for these flaws.  And he also has <a href="http://php.net/manual/ru/history.php.php">ways of</a> solving his own language problems, which are <a href="http://hacklang.org/">quite impressive</a> .  According to the final results, PHP provides the best foundation for creating, modifying and operating a successful web project compared to competitive environments.  Today I would like to start a new PHP project, with a couple of reservations, but seeing no reason to apologize for this. <br><br><h1>  Historical excursion </h1><br>  PHP was born in a unique web server environment for modern languages.  His strengths are related to the context of the request on the server. <br><br>  PHP was originally called " <a href="http://php.net/manual/ru/history.php.php">Personal Home Page</a> ".  It was published in 1995.  Rasmus Lerdorf, with a focus on supporting small, simple dynamic web applications, such as guest books and visitor counters, popular at the dawn of the Internet. <br><br><a name="note-1-back"></a>  Since the release of PHP, it has been used in much more complex projects than its authors had originally expected.  He underwent several major changes, each of which brought new mechanisms to curb these complex applications.  Today, in 2016, he is a feature-rich member of the Mixed Paradigm family of Productive Languages ‚Äã‚Äã(MPDPL) <a href="https://habr.com/ru/post/314970/">[1]</a> , which includes JavaScript, Python, Ruby and Lua.  If you tried PHP in the early 2000s, the modern PHP codebase may surprise you with <a href="http://php.net/manual/ru/language.oop5.traits.php">traits</a> , <a href="http://php.net/manual/ru/functions.anonymous.php">closures,</a> and <a href="http://php.net/manual/ru/language.generators.overview.php">generators</a> . <br><br><h1>  PHP virtues </h1><br>  PHP has some very deep and definitely unique features. <br><br>  First, the <b>state</b> .  Each web request begins with a completely clean slate.  Its namespace and global variables are not initialized, with the exception of some standard global variables, functions, and classes that provide primitive functionality and life support.  Starting each request from a known state, we get a sort of isolation from possible errors;  if the request t encounters a software malfunction and fails, this bug has no effect on the execution of the subsequent request t + 1.  In fact, of course, in addition to the software heap, the state of the application is in other places, and it is quite possible to completely spoil the database, memcache or file system.  But PHP shares this weakness with all imaginable environments that allow you to maintain state.  At the same time, the separation of software heaps between requests reduces the cost of most software errors. <br><br>  The second is <b>concurrency</b> .  Individual request works in one PHP thread.  At first glance, this seems like a silly restriction.  But since our application runs in the context of a web server, we have a natural source of concurrency: web requests.  By simply sending asynchronous requests to ourselves, we easily get concurrency with isolated states and copy-restore calls.  In practice, it is safer and more robust against errors than the lock-in and shared state approach used in other general purpose languages. <br><br>  In conclusion, the fact that PHP programs operate at the request level means that the programmer‚Äôs workflow is fast and efficient, and remains fast after the application is modified.  Many productive languages ‚Äã‚Äãpretend to do this, but if they do not clear their state with each request, and the main stream of events separates the program state level between requests, they almost always take some time to start.  For a typical Python application server, a typical debug loop would look something like ‚Äúthink, edit, restart the server, send a few test requests‚Äù.  Even if ‚Äúrestarting the server‚Äù takes only a few seconds from the total number of hours, it takes a large slice from <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D1%2580%25D0%25B0%25D1%2582%25D0%25BA%25D0%25BE%25D0%25B2%25D1%2580%25D0%25B5%25D0%25BC%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25BF%25D0%25B0%25D0%25BC%25D1%258F%25D1%2582%25D1%258C">15-30 seconds of</a> our human brains to the need to keep the most unnecessary part of the current state in our head. <br><br>  <i>I argue that developing ‚Äúthink, edit and reload page‚Äù PHP design makes developers more productive.</i>  In long and complex project development cycles, this gives an even greater increase. <br><br><h1>  Arguments against PHP </h1><br>  If all this is true, why is he <a href="https://habrahabr.ru/post/142140/">so hated</a> ?  When you remove all the colorful hyperboles in the direction that the main complaints about the PHP cluster will be reduced to the following problems: <br><br><ol><li>  <b>Surprises during conversions.</b>  Almost all languages ‚Äã‚Äãtoday allow us to compare, for example, integer and float with the&gt; = operator;  Damn, even C allows.  It is perfectly clear what is meant here.  Comparing strings and numbers with == is less obvious, and different languages ‚Äã‚Äãmade different choices.  The choice of PHP in this situation is most flawed, which leads to surprises and unpleasant errors.  For example, 123 == '123foo' is rated as true (what is he doing there?), But 0123 == '0123foo' is a lie (hmm). <br><br></li><li><a name="note-2-back"></a>  <b>Inconsistency around references and semantic meanings.</b>  PHP 3 had a clear semantics of passing arguments, returning everything by value, creating a logical copy of the data in the request.  The programmer can select reference semantics along with the &amp; <a href="https://habr.com/ru/post/314970/">[2]</a> sign.  This came with the introduction of object-oriented programming tools in PHP 4 and 5. Most PHP OO annotations were borrowed from Java, and Java has semantics in which an object is passed by reference, while primitive types are passed by value.  As a result, the current state of PHP semantics is that objects are passed by reference (choose Java, instead of, say, C ++), primitive types are passed by value (here Java, C ++, and PHP agree), but the old reference semantics and the &amp; sign remained, from time to time interacting with the new world in ambiguous ways. <br><br></li><li>  <b><a href="http://people.csail.mit.edu/rinard/paper/osdi04.pdf">Philosophy of the calculations, ignoring failures</a> .</b>  PHP is trying very, very hard to keep the query running, even if it has already done something completely strange.  So, for example, division by zero does not throw exceptions, does not return INF, and does not complete the fatal query.  By default, it simply warns and sets the value to false.  Since false is silently considered as 0 in numeric contexts, many applications are deployed and run with undiagnosed divisions by zero.  Specifically, this problem was <a href="http://php.net/manual/ru/migration70.incompatible.php">solved in PHP 7</a> , but the impulse in the design to handle ambiguities, even when they can make sense, permeates the libraries as well. <br><br></li><li>  <b>Contradictions in the standard library.</b>  When PHP was young, its audience was most familiar with C, and many APIs used the C standard library design: six-character lowercase names, successful / unsuccessful responses, and returning a real value to the out parameter that was called Further.  As PHP evolved, the C-shny style of splitting namespaces through prefixes with _ became more common: mysql _..., json _..., and so on.  More recently, the camelCase style of naming methods from Java on CamelCase classes has become the most common way of introducing new functionality.  So, in the end, sometimes we see code examples with mixed expressions like DirectoryIterator ($ path) with if (! ($ F = fopen ($ p, 'w +')) ... in confusing logic. </li></ol><br>  In order not to seem like a non-reflective apologist for PHP: these are all serious problems that make it more likely to create defects.  They are unforced errors.  There is no inherent compromise between the Good Parts of PHP and these problems.  It should be possible to create PHP, which will resolve these disadvantages, while maintaining all the good sides. <br><br><a name="note-3-back"></a><h1>  HHVM and Hack </h1><br>  This successor to the PHP system is called <a href="http://hacklang.org/">Hack</a> <a href="https://habr.com/ru/post/314970/">[3]</a> <br><br>  Hack is a programming language that people call phased type system for PHP.  "Type system" means that it allows the programmer to compile automatically verifiable <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D0%25BD%25D0%25B2%25D0%25B0%25D1%2580%25D0%25B8%25D0%25B0%25D0%25BD%25D1%2582">invariants</a> about data that flows through the code: this function takes a string or number and returns a Fribbles sheet, such as in Java or C ++ or Haskell, or in any other statically typed language, which one you choose.  Gradual means that some parts of your codebase may be statically typed, while other parts of it may still be in promiscuous, dynamic PHP.  The ability to combine these approaches allows you to gradually migrate large code bases. <br><br>  Instead of pouring tons of ink here in the description of the Hack type system and how it works, <a href="http://hacklang.org/tutorial.html">just play around with it</a> .  I will be here when you return. <br><br>  This is a neat system, and it is very ambitious in that it allows you to express.  And the possibility of a gradual migration of the project to Hack, in cases where it grows stronger than you originally expected, is a unique advantage of the PHP ecosystem.  Hack type checks preserve the ‚Äúthink, edit, reload page‚Äù workflow, because they run in the background, gradually updating the codebase model when it sees modifications in the file system.  The Hack project provides integration with all popular editors and IDEs, so you can see feedback about type errors when you finish typing the code, just like in a web demo. <br><br>  Let's look at the totality of the real risks that PHP creates in the light of Hack: <br><br><ol><li>  <b>Transformation</b> surprises become errors in Hack files.  The whole class of data problems goes away. </li><li>  <b>The semantics of links and values</b> in Hack are cleared by simply <a href="https://docs.hhvm.com/hack/unsupported/references">denying the use of old-style links</a> , so they are no longer needed in the new code base.  This makes the semantics behavior similar to the style of objects-by-reference-and-everything-else-by-value, as well as in Java or C # </li><li><a name="note-4-back"></a>  PHP-based <b><a href="http://people.csail.mit.edu/rinard/paper/osdi04.pdf">calculations that ignore failures</a></b> are more a property of the runtime environment, and it is more difficult to process them with a semantics analyzer like Hack to implement it directly into these systems.  However, in practice, most forms of calculations that ignore failures require those very surprises in conversions.  For example, problems that arise from getting false after division by zero, will not end up at the intersection of the type <a href="https://habr.com/ru/post/314970/">[4]</a> check border, which fails due to an attempt to convert a boolean to a number.  These boundaries are more common in the Hack codebase.  Together with the simple ability to describe these types, Hack in practice reduces the ‚Äústopping distance‚Äù for many incorrect launches. </li><li>  Finally, the <b>contradictions in the standard library</b> remain.  Most in Hack hope that they can make this problem less painful by wrapping it in safer abstractions. </li></ol><br>  Hack provides an opportunity that other popular members of the MPDPL family do not have: the ability to introduce a type system after the main development, and only partially, in those parts of the system where the value outweighs the price. <br><br><h1>  HHVM </h1><br>  Hack was originally developed as part of the <a href="http://hhvm.com/">HipHop virtual machine</a> , or HHVM, an open source virtual environment for PHP.  HHVM provides another important option for a successful project: the ability to launch your website faster and more economically.  Facebook <a href="https://research.facebook.com/publications/the-hiphop-virtual-machine/">reports</a> a performance gain of 11.6 times on processor efficiency over the PHP interpreter, and Wikipedia <a href="http://hhvm.com/blog/7205/wikipedia-on-hhvm">reports</a> an acceleration of 6 times. <br><br>  Slack recently translated its web environments to HHVM and received significant reductions in latency at all exit points, but we lacked apples-to-apples-style measurements on processor loads at the time of this writing.  We are also in the process of moving our code base to Hack and will report our experience here. <br><br><h1>  Looking forward </h1><br>  We started with the obvious paradox that PHP is a very bad language that is used in many successful projects.  We believe that his reputation as a poor language, in isolation, is quite deserved.  The success of projects using it has much in common with the basic properties of the PHP environment, and the possibility of accelerated development, which also provides PHP.  And the benefits of this environment (reduced number of bugs through error isolation; safe parallelism; high bandwidth of programmers) are more valuable than the problems that arise from the shortcomings of the language. <br><br>  In addition, unlike other members of the MPDPL family, it provides a clear path to migrate to a more productive, secure, and served environment in the form of Hack and HHVM.  Slack is in the final stages of the transition to HHVM, and in the early stages of the transition to Hack, and we are optimistic, as they allow us to produce better software in a faster time. <br><br><hr><br><a name="note-1"></a>  Notes (they are also from the developer‚Äôs blog): <br><br>  [1] I came up with the term MPDPL.  While there are few genetic links between them, these languages ‚Äã‚Äãhave strongly influenced each other.  Looking at the last syntax, you can see that they have much more in common than differences.  In the universe of <a href="https://en.wikibooks.org/wiki/MIPS_Assembly">MIPS</a> , Haskell, C ++, Forth, and Erlang <a href="https://en.wikibooks.org/wiki/MIPS_Assembly">assembly</a> programming languages, it is difficult to deny that MPDPLs form a dense cluster in the space of language designs.  <a href="https://habr.com/ru/post/314970/">[back to text]</a> <br><br><a name="note-2"></a>  [2] Unfortunately, &amp; is indicated in the received, not in the calling value.  So when a programmer announces his desire to get parameters by reference, this is not displayed in any way.  This makes the code difficult to understand and analyze what may change, and makes it difficult to work effectively with PHP.  See Figure 2 in <a href="http://dl.acm.org/citation.cfm%3Fid%3D2660199">dl.acm.org/citation.cfm?id=2660199</a> .  <a href="https://habr.com/ru/post/314970/">[back to text]</a> <br><br><a name="note-3"></a>  [3] Yes, Hack is a virtually non-mobile name for a programming language.  Hacklang is sometimes used when ambiguity is possible.  If Google can call its popular language even more non-Google Go, then why not?  <a href="https://habr.com/ru/post/314970/">[back to text]</a> <br><br><a name="note-4"></a>  [4] These types of checks in the Hack program are also applied at run-time by default, since they operate on the basis of the PHP type hint system.  This increases the security of mixed codebase, where Hack and classic PHP are mixed with each other.  <a href="https://habr.com/ru/post/314970/">[back to text]</a> </div><p>Source: <a href="https://habr.com/ru/post/314970/">https://habr.com/ru/post/314970/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../314960/index.html">Product API from Fetchee: automatic parsing of goods online stores</a></li>
<li><a href="../314962/index.html">Canon Laser Shot LBP-1120 printer and Raspberry Pi-based print server</a></li>
<li><a href="../314964/index.html">Why and how to transfer corporate email security to the cloud. Part 1</a></li>
<li><a href="../314966/index.html">Symfony - combine GridFS files with ORM entities</a></li>
<li><a href="../314968/index.html">Problems that we encountered when updating the PVS-Studio interface</a></li>
<li><a href="../314972/index.html">Is there a future for InfiniBand on Hadoop?</a></li>
<li><a href="../314974/index.html">How IT professionals work. Andrey Domas - the leading system administrator in the social network "Odnoklassniki"</a></li>
<li><a href="../314976/index.html">Competition for ZeroNights 2016 from Mail.Ru Group</a></li>
<li><a href="../314978/index.html">Jasmine vs. Mocha, Chai and Sinon</a></li>
<li><a href="../314980/index.html">Friday format: ‚ÄúYou can‚Äôt just take it and explain it to a non-programmer ...‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>