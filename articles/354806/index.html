<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make friends React and D3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="D3 is one of the most popular javascript libraries for creating dynamic and interactive data visualizations. Today it is used by hundreds of thousands...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make friends React and D3</h1><div class="post__text post__text-html js-mediator-article"><p>  D3 is one of the most popular javascript libraries for creating dynamic and interactive data visualizations.  Today it is used by <a href="https://www.wappalyzer.com/technologies/d3">hundreds of thousands of websites and web applications</a> . </p><br><p>  There are a huge number of <a href="http://bl.ocks.org/">examples</a> on the Internet - from banal line graphs to dynamically updated Voronoi diagrams - created using this library.  It seems that you can find ready-made code for any of the most bizarre visualization and only slightly modify it "for yourself." </p><br><p>  However, integrating D3 into a web-application built on React, in practice, is not the easiest task. </p><br><p><img src="https://habrastorage.org/webt/vs/1u/th/vs1uth2hoyfvnaya7p_1ui30ote.png"></p><a name="habracut"></a><br><p>  The problem is that D3 and React both want to control the DOM.  Does it mean that sharing these libraries is impossible?  Of course no. </p><br><p>  In this article, using the example of creating a histogram, I propose to consider 4 different approaches to solving this problem, as well as discuss their pros and cons. </p><br><p>  Below is the code for creating a histogram on pure D3, which we want to turn into a full-fledged component of React. </p><br><div class="spoiler">  <b class="spoiler_title">Histogram code</b> <div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> d3 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"d3"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> animDuration = <span class="hljs-number"><span class="hljs-number">600</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BarChartVanilla</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(selector, size) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.size = size; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.conatiner = d3.select(selector) .append(<span class="hljs-string"><span class="hljs-string">"svg"</span></span>) .attr(<span class="hljs-string"><span class="hljs-string">"width"</span></span>, size.width) .attr(<span class="hljs-string"><span class="hljs-string">"height"</span></span>, size.height); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleColor = d3.scaleSequential(d3.interpolateViridis); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleHeight = d3.scaleLinear().range([<span class="hljs-number"><span class="hljs-number">0</span></span>, size.height - <span class="hljs-number"><span class="hljs-number">20</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleWidth = d3.scaleBand().range([<span class="hljs-number"><span class="hljs-number">0</span></span>, size.width]).padding(<span class="hljs-number"><span class="hljs-number">0.1</span></span>); } draw(data) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleColor.domain([<span class="hljs-number"><span class="hljs-number">0</span></span>, data.length]); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleWidth.domain(data.map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">) =&gt;</span></span> (d.item))); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleHeight.domain(d3.extent(data, (d) =&gt; <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d.count</span></span></span><span class="hljs-function">))); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bars</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">conatiner</span></span></span><span class="hljs-function"> .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">selectAll</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">".bar"</span></span></span></span></span><span class="hljs-function">) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">function</span></span></span></span><span class="hljs-function"><span class="hljs-params"> key(d</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function"> }); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bars</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">exit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">transition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">duration</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">animDuration</span></span></span><span class="hljs-function">) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">attr</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"y"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.size.height</span></span></span><span class="hljs-function">) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">attr</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"height"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">style</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"fill-opacity"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">remove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bars</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">enter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">append</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"rect"</span></span></span></span></span><span class="hljs-function">) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">attr</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"class"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"bar"</span></span></span></span></span><span class="hljs-function">) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">attr</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"y"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.size.height</span></span></span><span class="hljs-function">) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">attr</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"x"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.size.width </span></span></span><span class="hljs-function">) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">attr</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"rx"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">attr</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"ry"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">merge</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bars</span></span></span><span class="hljs-function">) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">transition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">duration</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">animDuration</span></span></span><span class="hljs-function">) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">attr</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"y"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, (d</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleHeight(d.count) )) .attr(<span class="hljs-string"><span class="hljs-string">"height"</span></span>, (d) =&gt; <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.size.height - </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.scaleHeight(d.count</span></span></span><span class="hljs-function">)) ) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">attr</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"x"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, (d, i</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleWidth(d.item) ) ) .attr(<span class="hljs-string"><span class="hljs-string">"width"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleWidth.bandwidth() ) .style(<span class="hljs-string"><span class="hljs-string">"fill"</span></span>, (d, i) =&gt; ( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleColor(i) )); } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> BarChartVanilla;</code> </pre> </div></div><br><h3 id="podhod-1-react-dlya-struktury-d3-dlya-vizualizacii">  Approach # 1.  React for structure, D3 for visualization </h3><br><p>  In this case, React is used only for rendering the html-container (most often) visualization.  All actual data manipulations and their representation inside the created container remain with D3. <br></p><div class="spoiler">  <b class="spoiler_title">Component code</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PropTypes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"prop-types"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> d3 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"d3"</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BarChartV1</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ scaleColor = d3.scaleSequential(d3.interpolateViridis); scaleHeight = d3.scaleLinear(); scaleWidth = d3.scaleBand().padding(<span class="hljs-number"><span class="hljs-number">0.1</span></span>); componentDidMount() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateChart(); } componentDidUpdate() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateChart(); } updateChart() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateScales(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { data, width, height, animDuration } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bars = d3.select(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.viz) .selectAll(<span class="hljs-string"><span class="hljs-string">".bar"</span></span>) .data(data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">key</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> d.item }); bars.exit() .transition().duration(animDuration) .attr(<span class="hljs-string"><span class="hljs-string">"y"</span></span>, height) .attr(<span class="hljs-string"><span class="hljs-string">"height"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) .style(<span class="hljs-string"><span class="hljs-string">"fill-opacity"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) .remove(); bars.enter() .append(<span class="hljs-string"><span class="hljs-string">"rect"</span></span>) .attr(<span class="hljs-string"><span class="hljs-string">"class"</span></span>, <span class="hljs-string"><span class="hljs-string">"bar"</span></span>) .attr(<span class="hljs-string"><span class="hljs-string">"y"</span></span>, height) .attr(<span class="hljs-string"><span class="hljs-string">"rx"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span> ).attr(<span class="hljs-string"><span class="hljs-string">"ry"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span> ) .merge(bars) .transition().duration(animDuration) .attr(<span class="hljs-string"><span class="hljs-string">"y"</span></span>, (d) =&gt; <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.scaleHeight(d.count</span></span></span><span class="hljs-function">) )) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">attr</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"height"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, (d</span></span></span><span class="hljs-function">) =&gt;</span></span> (height - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleHeight(d.count)) ) .attr(<span class="hljs-string"><span class="hljs-string">"x"</span></span>, (d) =&gt; <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.scaleWidth(d.item</span></span></span><span class="hljs-function">) ) ) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">attr</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"width"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.scaleWidth.bandwidth(</span></span></span><span class="hljs-function">) ) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">style</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"fill"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, (d</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleColor(d.item) )); } updateScales() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { data, width, height } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleColor.domain([<span class="hljs-number"><span class="hljs-number">0</span></span>, data.length]); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleWidth .domain(data.map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">) =&gt;</span></span> (d.item))) .range([<span class="hljs-number"><span class="hljs-number">0</span></span>, width]); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleHeight .domain(d3.extent(data, (d) =&gt; (d.count))) .range([height - <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]); } render() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { width, height } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">viz</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> (this.viz = viz) } width={width} height={height} &gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } } BarChartV1.defaultProps = { <span class="hljs-attr"><span class="hljs-attr">animDuration</span></span>: <span class="hljs-number"><span class="hljs-number">600</span></span> }; BarChartV1.propTypes = { <span class="hljs-attr"><span class="hljs-attr">data</span></span>: PropTypes.array.isRequired, <span class="hljs-attr"><span class="hljs-attr">width</span></span>: PropTypes.number.isRequired, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: PropTypes.number.isRequired, <span class="hljs-attr"><span class="hljs-attr">animDuration</span></span>: PropTypes.number }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> BarChartV1;</code> </pre> </div></div><br><p>  <strong>pros</strong> </p><br><ul><li>  Allows you to use all the features of D3.js within a dedicated part of the DOM. </li><li>  No additional effort is required to integrate previously created components on D3. </li></ul><br><p>  <strong>Minuses</strong> </p><br><ul><li>  He takes advantage of React's optimization optimization features. </li><li>  Complicates testing and maintaining component code. </li></ul><br><h3 id="podhod-2-react-dlya-manipulirovaniya-dom-d3-dlya-vychisleniy">  Approach # 2.  React to manipulate DOM, D3 for calculations </h3><br><p>  D3.js includes several dozen different modules, only a few of which are directly related to the DOM.  Numerous helpers for preliminary data preparation, working with colors and geographic objects, implemented algorithms for calculating curves, building graphs and interpolating data can make life easier for developers, even in the case when rendering and updating all svg elements is implemented within the life cycle of the React component. </p><br><div class="spoiler">  <b class="spoiler_title">Component code</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PropTypes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"prop-types"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> d3 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"d3"</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BarChartV2</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ scaleColor = d3.scaleSequential(d3.interpolateViridis); scaleHeight = d3.scaleLinear(); scaleWidth = d3.scaleBand().padding(<span class="hljs-number"><span class="hljs-number">0.1</span></span>); render() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateScales(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { width, height, data } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bars = data.map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">rect</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{d.item}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.scaleWidth.bandwidth()}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{height</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">this.scaleHeight</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">d.count</span></span></span></span><span class="xml"><span class="hljs-tag">)} </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">this.scaleWidth</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">d.item</span></span></span></span><span class="xml"><span class="hljs-tag">)} </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.scaleHeight(d.count)}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">fill</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.scaleColor(d.item)}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">rx</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ry</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">)); return ( </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{width}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{height}</span></span></span></span><span class="xml"><span class="hljs-tag"> &gt;</span></span></span><span class="xml"> { bars } </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ); } updateScales() { const { data, width, height } = this.props; this.scaleColor.domain([0, data.length]); this.scaleWidth .domain(data.map((d) =&gt; (d.item))) .range([0, width]); this.scaleHeight .domain(d3.extent(data, (d) =&gt; (d.count))) .range([height - 20, 0]); } } BarChartV2.defaultProps = { animDuration: 600 }; BarChartV2.propTypes = { data: PropTypes.array.isRequired, width: PropTypes.number.isRequired, height: PropTypes.number.isRequired, animDuration: PropTypes.number }; export default BarChartV2;</span></span></code> </pre> </div></div><br><p>  <strong>pros</strong> </p><br><ul><li>  Performance Optimization for DOM, fully controlled by React </li><li>  Clear structure and logic of the component even for developers who are not familiar with D3.js </li></ul><br><p>  <strong>Minuses</strong> </p><br><ul><li>  Limited use of D3.js features </li><li>  Additional efforts are required to port code written on pure D3.js </li><li>  The resulting code is strongly tied to the structure of the React component and its life cycle.  Created in such a way it will be difficult to reuse in projects created using other frameworks or libraries (Angualar, VueJS) </li></ul><br><h3 id="podhod-3-react-dlya-sozdaniyaudaleniya-elementov-vizualizacii-d3-dlya-obnovleniya">  Approach # 3.  React to create / delete visualization elements, D3 to update </h3><br><p>  In this case, control over the entire internal structure of the DOM node remains with React.  D3.js only modifies the attributes of already created elements. </p><br><div class="spoiler">  <b class="spoiler_title">Component code</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PropTypes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"prop-types"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> d3 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"d3"</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BarChartV3</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ scaleColor = d3.scaleSequential(d3.interpolateViridis); scaleHeight = d3.scaleLinear(); scaleWidth = d3.scaleBand().padding(<span class="hljs-number"><span class="hljs-number">0.1</span></span>); componentDidMount() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateChart(); } componentDidUpdate() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateChart(); } updateChart() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateScales(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { data, height, animDuration } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bars = d3.select(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.viz) .selectAll(<span class="hljs-string"><span class="hljs-string">".bar"</span></span>) .data(data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> d ? d.item : d3.select(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"item"</span></span>); }); bars .transition().duration(animDuration) .attr(<span class="hljs-string"><span class="hljs-string">"y"</span></span>, (d) =&gt; <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.scaleHeight(d.count</span></span></span><span class="hljs-function">) )) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">attr</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"height"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, (d</span></span></span><span class="hljs-function">) =&gt;</span></span> (height - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleHeight(d.count)) ) .attr(<span class="hljs-string"><span class="hljs-string">"x"</span></span>, (d) =&gt; <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.scaleWidth(d.item</span></span></span><span class="hljs-function">) ) ) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">attr</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"width"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.scaleWidth.bandwidth(</span></span></span><span class="hljs-function">) ) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">style</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"fill"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, (d</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleColor(d.item) )); } updateScales() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { data, width, height } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleColor.domain([<span class="hljs-number"><span class="hljs-number">0</span></span>, data.length]); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleWidth .domain(data.map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">) =&gt;</span></span> (d.item))) .range([<span class="hljs-number"><span class="hljs-number">0</span></span>, width]); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleHeight .domain(d3.extent(data, (d) =&gt; <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d.count</span></span></span><span class="hljs-function">))) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">range</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[height - </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">20</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">]</span></span></span><span class="hljs-function">); } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">render</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">width</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">height</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function"> } = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bars</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">map</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">rect</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{d.item}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">item</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{d.item}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"bar"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{height}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">rx</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ry</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">)); return ( </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">viz</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> (this.viz = viz) } width={width} height={height} &gt; { bars } </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ); } } BarChartV3.defaultProps = { animDuration: 600 }; BarChartV3.propTypes = { data: PropTypes.array.isRequired, width: PropTypes.number.isRequired, height: PropTypes.number.isRequired, animDuration: PropTypes.number }; export default BarChartV3;</span></span></code> </pre> </div></div><br><p>  <strong>pros</strong> </p><br><ul><li>  Wider use of D3 features, including animated transitions between different states of objects </li><li>  Improved performance through the use of React to manipulate the structure of the visualization (add / remove its elements) </li></ul><br><p>  <strong>Minuses</strong> </p><br><ul><li>  Cannot use d3 transactions for deleted items </li><li>  This solution is also quite strongly tied to the structure of the React component (albeit to a lesser extent than option 2) </li></ul><br><h3 id="podhod-4-ispolzovat-feykovyy-dom-dlya-d3">  Approach # 4.  Use fake DOM for D3 </h3><br><p>  This approach involves creating an object similar to DOM, which will be used to work with D3.  This will allow, on the one hand, to use all the D3.js APIs, and on the other hand, to give React full control over the real DOM. </p><br><p>  Oliver Caldwell, who proposed this <a href="https://oli.me.uk/2015/09/09/d3-within-react-the-right-way/">idea</a> , created <a href="https://github.com/Olical/react-faux-dom">react-faux-dom</a> , which automatically saves the created / modified D3 elements in the state component.  And then React determines whether it is necessary to update and to what extent a real DOM. </p><br><div class="spoiler">  <b class="spoiler_title">Component code</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PropTypes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"prop-types"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> d3 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"d3"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { withFauxDOM } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-faux-dom'</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BarChartV4</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ scaleColor = d3.scaleSequential(d3.interpolateViridis); scaleHeight = d3.scaleLinear(); scaleWidth = d3.scaleBand().padding(<span class="hljs-number"><span class="hljs-number">0.1</span></span>); componentDidMount() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateChart(); } componentDidUpdate (prevProps, prevState) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.data !== prevProps.data) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateChart(); } } updateChart() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateScales(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { data, width, height, animDuration } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> faux = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.connectFauxDOM(<span class="hljs-string"><span class="hljs-string">"g"</span></span>, <span class="hljs-string"><span class="hljs-string">"chart"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bars = d3.select(faux) .selectAll(<span class="hljs-string"><span class="hljs-string">".bar"</span></span>) .data(data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">key</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> d.item }); bars.exit() .transition().duration(animDuration) .attr(<span class="hljs-string"><span class="hljs-string">"y"</span></span>, height) .attr(<span class="hljs-string"><span class="hljs-string">"height"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) .style(<span class="hljs-string"><span class="hljs-string">"fill-opacity"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) .remove(); bars.enter() .append(<span class="hljs-string"><span class="hljs-string">"rect"</span></span>) .attr(<span class="hljs-string"><span class="hljs-string">"class"</span></span>, <span class="hljs-string"><span class="hljs-string">"bar"</span></span>) .attr(<span class="hljs-string"><span class="hljs-string">"y"</span></span>, height) .attr(<span class="hljs-string"><span class="hljs-string">"x"</span></span>, width ) .attr(<span class="hljs-string"><span class="hljs-string">"width"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) .attr(<span class="hljs-string"><span class="hljs-string">"height"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) .attr(<span class="hljs-string"><span class="hljs-string">"rx"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span> ).attr(<span class="hljs-string"><span class="hljs-string">"ry"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span> ) .merge(bars) .transition().duration(animDuration) .attr(<span class="hljs-string"><span class="hljs-string">"y"</span></span>, (d) =&gt; <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.scaleHeight(d.count</span></span></span><span class="hljs-function">) )) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">attr</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"height"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, (d</span></span></span><span class="hljs-function">) =&gt;</span></span> (height - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleHeight(d.count)) ) .attr(<span class="hljs-string"><span class="hljs-string">"x"</span></span>, (d, i) =&gt; <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.scaleWidth(d.item</span></span></span><span class="hljs-function">) ) ) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">attr</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"width"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.scaleWidth.bandwidth(</span></span></span><span class="hljs-function">) ) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">style</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"fill"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, (d, i</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleColor(i) )); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.animateFauxDOM(<span class="hljs-number"><span class="hljs-number">800</span></span>); } updateScales() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { data, width, height } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleColor.domain([<span class="hljs-number"><span class="hljs-number">0</span></span>, data.length]); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleWidth .domain(data.map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">) =&gt;</span></span> (d.item))) .range([<span class="hljs-number"><span class="hljs-number">0</span></span>, width]); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scaleHeight .domain(d3.extent(data, (d) =&gt; (d.count))) .range([height - <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]); } render() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { width, height } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{width}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{height}</span></span></span></span><span class="xml"><span class="hljs-tag"> &gt;</span></span></span><span class="xml"> { this.props.chart } </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } } BarChartV4.defaultProps = { <span class="hljs-attr"><span class="hljs-attr">animDuration</span></span>: <span class="hljs-number"><span class="hljs-number">600</span></span> }; BarChartV4.propTypes = { <span class="hljs-attr"><span class="hljs-attr">data</span></span>: PropTypes.array.isRequired, <span class="hljs-attr"><span class="hljs-attr">width</span></span>: PropTypes.number.isRequired, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: PropTypes.number.isRequired, <span class="hljs-attr"><span class="hljs-attr">animDuration</span></span>: PropTypes.number }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> withFauxDOM(BarChartV4);</code> </pre> </div></div><br><p>  <strong>pros</strong> </p><br><ul><li>  The D3 component of the component will be similar to the version written on pure D3.  A means that you can easily integrate code from a vast base of examples and there is no binding to a specific framework. </li><li>  All API D3 supported, including animation and event handling. </li><li>  All standard methods and React built-in optimizations are used to speed up component rendering. </li></ul><br><p>  <strong>Minuses</strong> </p><br><ul><li>  Need to use another third-party library or write your own implementation of a fake DOM object. </li></ul><br><h3 id="zaklyuchenie">  Conclusion </h3><br><p>  Of course, if your application does not go beyond the construction of standard histograms, line graphs or pie charts, it is better to use one of the many libraries for plotting graphs originally created under React. </p><br><p>  However, D3 can be an indispensable tool in creating complex dashboards, infographics and interactive stories.  Therefore, it is worth carefully weighing all the pros and cons when choosing a particular approach.  I note that real projects most often use the last two approaches. </p><br><p>  It is also worth paying attention to such libraries as <a href="https://github.com/emeeks/semiotic/">Semiotic.js</a> and <a href="http://recharts.org/">Recharts</a> , built on the basis of D3 and React. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/354806/">https://habr.com/ru/post/354806/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354796/index.html">I made an API for screenshots of sites, and some guy started mining through it cryptocurrency</a></li>
<li><a href="../354798/index.html">Management Tantrum</a></li>
<li><a href="../354800/index.html">Feature perception filters from your Product Backlog</a></li>
<li><a href="../354802/index.html">Understanding how disk space is used in Linux</a></li>
<li><a href="../354804/index.html">If online stores were chairs</a></li>
<li><a href="../354808/index.html">Static Analysis in the Video Game Industry: Top 10 Software Errors</a></li>
<li><a href="../354810/index.html">The point of testing is in the process, not in the remaining artifacts. Michael Bolton and Rapid Software Testing</a></li>
<li><a href="../354812/index.html">Fintech Digest: online banking security, 70% of bitcoins extracted, business will lose about $ 2 billion due to RKN blocking</a></li>
<li><a href="../354814/index.html">Domain fronting: what is it?</a></li>
<li><a href="../354816/index.html">Blockchain When should it be applied?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>