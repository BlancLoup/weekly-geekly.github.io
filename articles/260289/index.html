<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>LabVIEW Programming Contest. The decision of the winning team</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Computer games about tanks are among the most popular in the game-industry. The history of such games has been around for decades, but their popularit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>LabVIEW Programming Contest. The decision of the winning team</h1><div class="post__text post__text-html js-mediator-article">  Computer games about tanks are among the most popular in the game-industry.  The history of such games has been around for decades, but their popularity has not faded.  The theme of tanks and tank battles is being developed not only in computer games, but is also the subject of a competitive programming process.  For example, in 2012, there were programming competitions <a href="http://2012.russianaicup.ru/p/codeTanks">Russian AI Cup - CodeTanks</a> .  Participants were asked to develop an artificial intelligence control tank.  A few years later, a similar competition repeated.  The organizer was the company National Instruments, which annually holds LabVIEW programming contests among students and young scientists.  Participants in the 2015 Olympiad were asked to develop an algorithm for autonomous control of a tank using LabVIEW tools (you can get an idea of ‚Äã‚Äãthis programming environment at the link: <a href="http://habrahabr.ru/post/57859/">‚ÄúLabVIEW is the first acquaintance‚Äù</a> ).  This article describes the algorithm of the winning tank from the LabVIEWPortal team. <br><a name="habracut"></a><br><h5>  About the team </h5><br>  <i>A team of representatives of the community of like-minded <a href="http://labviewportal.ru/">LabVIEWPotral</a> traditionally takes part in the competition of programmers.</i>  <i>In 2011, the performance was successful - the <a href="http://www.labview.ru/events/past_events/item1549/">team took the 1st place</a> .</i>  <i>In the Olympiad 2015, the team managed to repeat its success.</i>  <i>From the portal was formed a team of three people.</i>  <i>Some difficulty was the territorial distance, because the team members live in different cities and time zones.</i>  <i>But we must look not for problems, but for solutions, with which the team successfully coped.</i> <br><br><h5>  Input data </h5><br>  The players in turn are passed the following parameters: <br>  1. Parameters of the battlefield (dimensions, description of obstacles: coordinates of the extreme points of obstacles and their remaining strength); <br>  2. Parameters of the tank (dimensions, speed of rotation of the hull and turret, movement, speed of shells, etc.); <br>  3. Description of the shells fired at the moment (coordinates of the current position of the projectile, velocity vector and the number of the player who fired the projectile); <br>  4. Description of obstacles (an array of coordinates of the extreme points of obstacles and their remaining strength); <br>  5. The current state of the tanks (the coordinates of the center of the hull, the angles of rotation of the hull and turret, the remaining strength and the remaining recharge time); <br><br>  For a certain time slot, the player must make a decision and indicate the action for the tank hull (movement or rotation), the relative angle of rotation of the tank turret, and also indicate whether a shot is required.  If the decision is not made in the allotted time, the work of the player‚Äôs function is interrupted and the move goes to another player.  The winner is either the one who managed to destroy the enemy tank, or the one who has more safety margin than the enemy after the allotted time per round.  Damage is inflicted exclusively by shells (when tanks collide with each other or with walls, no damage is caused).  Battle mode: one on one, maps for battles are not known in advance. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Strategy development </h5><br>  One of the first tactics of combat was continuous fire and moving along the shortest path to the enemy, bypassing the walls.  But, after analyzing the speed among some popular path finding algorithms (wave algorithm, convex polygon method, A * search algorithm), we came to the conclusion that our tank may not have time to calculate the trajectory of movement with subsequent analysis of the situation.  This tactic had to be abandoned in favor of a simpler option: ‚Äúwait, shoot and maneuver.‚Äù <br><br>  <i>Wait, shoot</i> : from the initial position we shoot at the center of the enemy, regardless of the walls, since they are gradually destroyed by shells.  Each turn adjusts the position of the tower so that it looks exactly in the center of the enemy. <br>  <i>Maneuvers</i> : we place the hull perpendicular to the line of fire.  From this position to avoid enemy shells is easiest.  In this regard, each turn, in the absence of danger, we adjust the angle of rotation of the body.  Accordingly, the evasion maneuver consists in rolling the tank back or forward. The choice of direction depends on the place of intended hit: the front or rear of the tank. <br><br>  However, in the course of preliminary competitions, two significant deficiencies of the strategy were discovered: <br><ul><li>  In some cases, the maneuver from the projectile led to a "ride into the wall." </li><li>  Some walls interfered in general for maneuvering. </li></ul><br>  These deficiencies were eliminated by adding several checks and conditions: <br><ul><li>  <i>Safe mode</i>  If there is more than one wall between a tank and an enemy, then we shoot the nearest wall, which is not necessarily lying in the way.  This is an important point, because it is not known how the body will be turned when the enemy leaves the open line of fire. </li><li>  <i>Dangerous mode</i> .  If there is less than 2 walls between the tank and the enemy, turn the tower to the center of the enemy and continuously shoot. </li><li>  <i>Evasion</i> .  If an enemy projectile flies into the tank, then we calculate the point of impact: the ‚Äúfront / rear‚Äù part.  Next, select the direction of motion and estimate how far you need to move.  If a collision with a wall occurs in the direction of travel, then we move in the opposite direction.  Retreat as long as there is a danger of hitting the projectile.  When checking for shells, walls are counted.  Thus, the projectile, which is guaranteed to fall into the wall - is ignored. </li></ul><br><br>  Regardless of the mode, adjust the angle of the hull so that it is perpendicular to the line of fire (the line connecting the centers of the tanks). <br><br><h5>  Program code and detailed description of the action algorithm </h5><br>  General view of the program code: <br><br><img src="https://habrastorage.org/files/63a/c8b/aa3/63ac8baa3b7f4d6ea579378194ef5be7.png"><br><br>  At the preliminary stage of the analysis of the initial data (before the main cycle is completed), the destroyed walls and their projectiles are screened out.  The following is a choice of strategy.  If you are in a danger zone, then <br><div class="spoiler">  <b class="spoiler_title">no checks are already done</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/797/c5b/cc9/797c5bcc9d194b379d98ce2779a7f612.png"><br></div></div><br><br>  If the enemy has disappeared behind the wall, then we will not return to safe mode, since the rotation of the tower to the nearest wall and back takes time, and an extra waste of time in combat conditions is unacceptable. <br>  If the zone is safe, then we perform two checks: <br>  1. The number of walls between the tank and the enemy; <br>  2. The number of walls between the tank and each of the shells. <br><br><img src="https://habrastorage.org/files/a63/68b/e14/a6368be1435f4cfcaad719d6e4d68fe2.png"><br><br><div class="spoiler">  <b class="spoiler_title">Testing shells must be performed because the enemy can hide behind the wall and shoot the corners of the tank.</b>  <b class="spoiler_title">Waiting for the enemy to leave the wall in this case becomes meaningless.</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/ef5/743/b11/ef5743b1148f4ee9818cddabf5c967fa.png"><br></div></div><br>  One wall is chosen for security reasons: if there are few ‚Äúshields‚Äù left, then you must turn the tower on the enemy in advance to save time.  Checking the walls between the tank and the enemy is shown below and uses the same function as checking the walls between the tank and the projectile (only different ends of the segments). <br><br><img src="https://habrastorage.org/files/572/d85/af8/572d85af81714548bba93ea304d09069.png"><br><br>  The function of searching for the number of ‚Äúshields‚Äù is described below. <br><br>  Projectiles are looped through, but the projectile hazard check is conducted at the point of impact, and not at the center of the hull.  Reason: "tricky" enemy shooting from around the corner. <br><br><img src="https://habrastorage.org/files/c1d/c7c/f75/c1dc7cf75db740018ef9badcade1884a.png"><br><br>  To simplify the calculations, the tank is considered as a circle described around the hull.  The point of contact is taken at the point of intersection of the trajectory line of the projectile and perpendicular from the center of the tank to this line.  In addition, the origin is transferred to the center of the tank. <br><br>  For the straight line Ax + By + C = 0, the point of the perpendicular from the origin is calculated by the formulas: <br>  x0 = - AC / (A ^ 2 + B ^ 2) <br>  y0 = - BC / (A ^ 2 + B ^ 2) <br><br>  Since  the origin of coordinates in the center of the tank, then to check the hit it is necessary to calculate the length of the segment [(0,0) (x0, y0)].  If the length is less than the "radius" of the tank, then the projectile is dangerous. <br><br>  Then calculate the distance that you need to roll back when maneuvering from the projectile (it will be needed later). <br><br>  Next is determined by the area of ‚Äã‚Äãcontact: the front / rear of the tank.  To do this, calculate the angle at which the straight line ((0,0) (x0, y0)) is located relative to the axis 0x.  To simplify calculations (similar angles will be required in the future) are used. <br><br><div class="spoiler">  <b class="spoiler_title">segments dx, dy.</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/124/1f3/31a/1241f331a34e4304a4b985238b9949ea.png"><img src="https://habrastorage.org/files/097/d6d/2ed/097d6d2ed3824d7a806bd177f5de3ec8.png"><br></div></div><br>  If the angle between this straight line and the direction of movement of the tank is less than pi / 2, then hit the front, otherwise - in the rear. <br><br>  The last check that needs to be done is whether the projectile is flying into our tank.  The first version of the tank did not take into account the direction of flight, and the tank tried to escape from the safe projectiles. <br><br>  The check is performed as follows: since the projectile is specified by the beginning and length of the vector (componentwise), this allows to calculate the distance from the beginning of the vector to the center of the tank and from the end of the vector to the center of the tank.  If the end of the vector is closer to the tank, then the projectile is flying in our direction. <br><br><div class="spoiler">  <b class="spoiler_title">The components of the vector are calculated as the difference of the coordinates of two points.</b>  <b class="spoiler_title">The length of the vector is calculated by the Pythagorean theorem.</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/837/539/27b/83753927bfbf447b89b789177f7e05a3.png"><br><img src="https://habrastorage.org/files/440/3f1/262/4403f12625694ca582c5c8cd2378de41.png"><br></div></div><br><br>  Next, it is checked how many wallboards there are.  Verification is carried out on all shells, including safe projectiles. <br>  Each wall is a segment.  Another segment is constructed between the center of the hull or the point of impact and the center of the enemy or projectile.  Further, it is checked whether these segments intersect.  The verification algorithm is taken from the article at the following link: <a href="http://grafika.me/node/237">grafika.me/node/237</a> .  Its essence lies in the analysis of vector products of vectors connecting different ends of segments. <br><br><img src="https://habrastorage.org/files/c97/fd0/cf2/c97fd0cf23cc4e3eb0278d98277cc0d2.png"><br><br><div class="spoiler">  <b class="spoiler_title">Vector product in components</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/ddf/ab1/e99/ddfab1e99d394174a929d0f76d080d33.png"><br></div></div><br>  All walls are checked in a cycle, the first dangerous projectile is considered a breakpoint: since the situation is already dangerous, there is no sense in checking further.  Thus, if less than two walls remain before the enemy, or a shell (not covered by walls) flies into the tank, then it is necessary to attack, otherwise destruction of the nearest walls for future maneuver continues. <br><br><h6>  Wall attack (safe mode) </h6><br><img src="https://habrastorage.org/files/add/a31/84a/adda3184af1341eca99dcb6ec3422981.png"><br><br>  First, the angle of rotation of the body is corrected.  Then the angle of the ‚Äútank-enemy‚Äù straight line is determined with the x axis, using the functions of finding the vector and its angle with the Ox axis already described. <br><br><img src="https://habrastorage.org/files/0a0/e7f/0f2/0a0e7f0f2ee440c0b796344ce3c597b0.png"><br><br>  Determination of the angle of the body turn is as follows: <br><br><img src="https://habrastorage.org/files/1de/d6d/29e/1ded6d29e04a43819ee114854ee9d412.png"><br><br>  From the two corners the smallest one is chosen, since the ‚Äúright-left‚Äù is not important here. <br><br><img src="https://habrastorage.org/files/bd1/c26/6c4/bd1c266c412d4897bf5c95a35a101252.png"><br><br>  It is worth noting that, as in the case of shooting, the system (arbiter program) indicates the desired action: turn at once to the whole angle, make a shot.  Then the system performs the permissible part of the desired: permissible rotation, shot (if the gun was reloaded). <br><br>  In parallel, the distance from the center of the tank to all walls is calculated and the smallest value is selected. <br><br><img src="https://habrastorage.org/files/ca2/0b0/47b/ca20b047b9ab45f88ee7e2d8e6b8b2a9.png"><br><br>  After selecting a wall, its center is determined, where the shooting will take place.  It should be noted that there may be several minima, but the system will issue the first in order.  After the destruction of one wall (green direction), the next nearest one is selected.  In theory, it may be blue (suppose that the distances are equal), but the next in order may be the far wall (red line), and the tower will turn for a long time to it, with several shots going to other walls.  If you wish, you can modify the choice so that the nearest to the cannon is selected from the nearest walls. <br><br><div class="spoiler">  <b class="spoiler_title">closest to the gun</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/671/eb8/313/671eb831354d494d96ce98f2438bd52b.png"><br></div></div><br>  The distance to the wall is the distance from the point (center of the tank) to the segment.  It should be borne in mind that sometimes the nearest point will be the point of intersection of a given segment by a perpendicular, and sometimes one of the ends of the segment. <br>  We use the scalar product of vectors, the sign of which gives information about the directionality of the vectors (the entire algorithm is written in the code commentary). <br><br><img src="https://habrastorage.org/files/b58/395/4ac/b583954ac03c4db5943d1d6ba074bf80.png"><br><br><div class="spoiler">  <b class="spoiler_title">Dot product of vectors</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/b58/395/4ac/b583954ac03c4db5943d1d6ba074bf80.png"><br></div></div><br>  Further, the angle between the axis Ox and the connecting segment is determined (only the others are segments), and then the angle of rotation of the tower is calculated: <br><img src="https://habrastorage.org/files/062/ed6/83b/062ed683bf1d4ca7839d11ccd6924635.png"><br><br>  Further, it is checked where the turn is closer: clockwise or counterclockwise. <br><br><h6>  Enemy tank attack algorithm </h6><br>  The angles of rotation of the hull and the tower are calculated by the previously described methods.  Further, the first dangerous projectile is located and the ‚Äúbest‚Äù side is maneuvered taking into account the point of impact of the projectile.  However, it is necessary to verify that there are no obstacles to the retreat.  If there are no dangerous projectiles, we rotate the body. <br><br><h6>  Check the path of retreat for the presence / absence of obstacles </h6><br>  The distance to travel was calculated when checking the danger of the projectile.  We denote the current position of the tank black, and the final position gray.  Thus, a rectangle is obtained, the side faces of which are the side faces of the tank hull, and the front faces are the current and desired position of the front part of the hull (blue frame).  It is necessary to determine if this rectangle intersects any of the segments that define walls. <br><br><img src="https://habrastorage.org/files/ef6/74c/018/ef674c01844f4b86a5e80b28d9a18091.png"><br><br>  To determine the intersection, the Cohen-Sutherland algorithm is used, the description of which can be found in this link: <a href="https://ru.wikipedia.org/%25D0%2590%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC_%25D0%259A%25D0%25BE%25D1%258D%25D0%25BD%25D0%25B0_">ru.wikipedia.org/</a> Cohen's algorithm_ ‚Äî Sutherland).  To simplify the task, perform the following actions: <br><ul><li>  rotation of the coordinate axis so that the forward motion is along the x axis </li><li>  transfer of the origin to the front of the tank. </li></ul><br>  Thus, the rectangle, the verification of which must be done: <br><ul><li>  horizontal segments y = + - s / 2 (half the width of the tank); </li><li>  vertical: x = 0, x = godist (the distance that you need to go). </li></ul><br>  Next, you need to rotate and move all the segments of the wall when checking.  Each wall is checked separately. <br><br><img src="https://habrastorage.org/files/e6d/778/40d/e6d77840d25b43e598eb4c1da190a684.png"><br><br>  Now the position of the ‚Äúright‚Äù, ‚Äúleft‚Äù, ‚Äúabove‚Äù, ‚Äúbelow‚Äù points relative to the rectangle is determined by comparing the components x and y separately with the borders of the rectangle. <br><br><img src="https://habrastorage.org/files/f16/13a/694/f1613a694ef545e89d26116782b83a13.png"><br><br>  If an intersection has been found, the check is completed and it is impossible to move in this direction, and for exactly the chosen speed sign we give ‚Äúfull throttle‚Äù. <br><br><h5>  Conclusion </h5><br>  The proposed program code does not claim to be optimal due to the fact that the development, testing and debugging process took a short time.  It should also be noted that some of the algorithms were taken from the head, some from the Internet and the team in no way encroaches on the authorship of the algorithms used.  In the process of battles, the tank sometimes behaved not quite according to the algorithm - it ‚Äústuck‚Äù to the wall.  Despite this, the intelligent tank control system from the LabVIEWPortal team proved to be the best and took the first place in the Olympiad.  Playlist with video of the main fights of the tournament can be viewed at: <a href="http://www.youtube.com/playlist%3Flist%3DPLKDkvzW_BvvH36vPdeiGKRvmhcZrjMseD">www.youtube.com/playlist?list=PLKDkvzW_BvvH36vPdeiGKRvmhcZrjMseD</a> <br><br>  Thank you for your interest, we will be glad to hear your feedback. </div><p>Source: <a href="https://habr.com/ru/post/260289/">https://habr.com/ru/post/260289/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260275/index.html">How we made the best release tracker tracker</a></li>
<li><a href="../260277/index.html">That the site did not fall: an economical method</a></li>
<li><a href="../260279/index.html">Do we really need start-ups for large corporations</a></li>
<li><a href="../260285/index.html">Analysis of the tasks of the qualifying round of RCC 2015</a></li>
<li><a href="../260287/index.html">Are you ready to complain?</a></li>
<li><a href="../260291/index.html">Examples of using MongoDB in e-commerce (part 2)</a></li>
<li><a href="../260295/index.html">Jii: Full Query Builder for Node.js with API from Yii 2</a></li>
<li><a href="../260297/index.html">Accelerate MySQL insert / update 5-10 times</a></li>
<li><a href="../260301/index.html">Buying in the online store: work on the bugs</a></li>
<li><a href="../260303/index.html">The hijacking of Telecom Malaysia trunk provider noticeably worsened global routing last Friday.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>