<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Connecting Intel Internet of Things Gateways to AWS and sharing data with the cloud using Node-RED or Python</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We'll talk about how to connect the Intel Gateway for the Internet of Things to Amazon Web Services (AWS) and start building applications designed to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Connecting Intel Internet of Things Gateways to AWS and sharing data with the cloud using Node-RED or Python</h1><div class="post__text post__text-html js-mediator-article">  We'll talk about how to connect the Intel Gateway for the Internet of Things to Amazon Web Services (AWS) and start building applications designed to work with this platform using Node-RED and Python.  As a result, we will come to a solution in which the gateway will transmit data to the cloud using the MQTT protocol. <br><br> <a href="https://habrahabr.ru/company/intel/blog/314282/"><img src="https://habrastorage.org/files/053/9f5/f68/0539f5f686724157b5b729613c21c1cf.jpg"></a> <br><a name="habracut"></a><br>  In order to try out in practice what is being discussed, you will need an Intel gateway for the Internet of things with IDP 3.1 or higher, connected to the Internet, and a computer from which you can organize terminal access to the gateway. <br><br>  If your gateway needs to be configured, refer to <a href="https://software.intel.com/en-us/node/633284">this material</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  <font color="#0071c5">Gateway and AWS Preparation</font> </h2><br>  Let's start with preparing the gateway and AWS for collaboration. <br><br><h3>  <font color="#0071c5">‚ñçInstalling the IoT Cloud Repository on the Gateway</font> </h3><br>  Install the IoT Cloud repository on the gateway. <br><br><ol><li>  Log into the gateway console using either a monitor and a keyboard directly connected to it, or else, and it‚Äôs better to do so via SSH from a remote computer. <br><br></li><li>  Add the GPG key for the cloud repository by typing the following command: <br><br><pre><code class="hljs swift">rpm --<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> http:<span class="hljs-comment"><span class="hljs-comment">//iotdk.intel.com/misc/iot_pub.key</span></span></code> </pre> <br></li><li>  On your computer, open a browser, and by entering the gateway IP address in the address bar, connect to the Intel IoT Gateway Developer Hub.  In order to find out the IP address of the gateway, you can use the <code>ifconfig</code> command. <br><br></li><li>  Log in to IoT Gateway Developer Hub using your account details.  The default username and password is <b>root</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e10/c10/061/e10c100615be75679193da2f7c6e20bc.png"></div><br>  <i><font color="#999999">Login to IoT Gateway Developer Hub</font></i> <br><br></li><li>  Add the IoT Cloud repository to the system. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/354/5e1/e9f/3545e1e9fc8885dea64ceb9475bbb40c.jpg"></div><br>  <i><font color="#999999">Adding IoT Cloud Repository</font></i> <br><br></li><li>  Go to the <b>Packages</b> section and click on the <b>Add Repo +</b> button. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/752/10a/dcf/75210adcf5174f5de6571cd5cc408b7c.jpg"></div><br>  <i><font color="#999999">Repository settings</font></i> <br><br></li><li>  Fill in the fields of the window that appears as follows: <br><br><blockquote>  <b>Name</b> : IoT_Cloud <br>  <b>URL</b> : <a href="http://iotdk.intel.com/repos/iot-cloud/wrlinux7/rcpl13">iotdk.intel.com/repos/iot-cloud/wrlinux7/rcpl13</a> </blockquote><br>  Then click on the <b>Add Repository</b> button. <br><br></li><li>  Finally, click the <b>Update Repositories</b> button to update the package list. </li></ol><br><h3>  <font color="#0071c5">AWWWS Support Tuning on Gateway</font> </h3><br>  Here we look at the steps needed to equip the gateway with Amazon Web Services support. <br><br><ol><li>  Click the <b>Add Packages +</b> button.  This will bring up a list of packages that can be installed. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/206/a2f/4f1/206a2f4f1400e430ac09ce388aefa847.jpg"></div><br>  <i><font color="#999999">Starting the package installation process</font></i> <br><br></li><li>  Search for the <b>cloud-aws keyword</b> by typing it into the field at the top of the add new package window.  Then, when the required package is found, click on the <b>Install</b> button, which is located to the right of the <b>packagegroup-cloud-aws entry</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b83/6f7/ebc/b836f7ebce1ef7cfa520a6a176c7c336.png"></div><br>  <i><font color="#999999">Package installation</font></i> </li></ol><br><h3>  <font color="#0071c5">‚ñçUser Setup in AWS</font> </h3><br>  Configure account settings in Amazon Web Services.  This will need to connect to the cloud. <br><br><ol><li>  In your browser, go to <a href="https://console.aws.amazon.com/">the AWS console</a> address and log in to your Amazon Web Sevices account. <br><br></li><li>  Configure the <b>AWSIoTFullAccess</b> policy. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/59e/92b/31d/59e92b31dc07f34edfd799ac3795ccfa.png"></div><br>  <i><font color="#999999">Setting Permissions for an AWS Account</font></i> <br><br></li><li>  Click the account name in the upper right part of the window and select the <b>Security Credentials</b> command from the drop-down menu. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/096/bd8/ab9/096bd8ab9568848e84318a93cb7b94b6.png"></div><br>  <i><font color="#999999">Security Access Warning Caption</font></i> <br><br>  If you see the pop-up message shown in the image above, click the <b>Continue to Security Credentials</b> button. <br><br></li><li>  On the left side of the window, click the <b>Users</b> link to display a list of users in your AWS account.  If there are no users in the list, click the <b>Create New Users</b> button, enter the name of the new user, and click the <b>Create</b> button.  After that, the record of the created user will appear in the list. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bdb/660/fce/bdb660fcef2b2164aefb8d068363fbf8.png"></div><br>  <i><font color="#999999">Add a new user to your AWS account</font></i> <br><br></li><li>  Click a username to display a page with information about it.  Select the <b>Permissions</b> tab and click the <b>Attach Policy</b> button. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/046/89d/cbf/04689dcbf840df641590cdd4691a8284.png"></div><br>  <i><font color="#999999">Begin assignment of user security policy</font></i> <br><br></li><li>  Find the <b>AWSIoTFullAccess</b> policy in the list.  Check the box next to the policy name and click on the <b>Attach Policy</b> button to assign it to the user. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d6f/7ba/656/d6f7ba65680e4d456c64be316673ef43.png"></div><br>  <i><font color="#999999">Assign user security policy</font></i> <br><br></li><li>  Create a passkey for the device. <br><br></li><li>  Return to the user details screen and click the <b>Create Access Key</b> button on the <b>Security Credentials</b> tab. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/34a/0be/2b9/34a0be2b96e6db4dc5b3bc9659db9e6c.png"></div><br>  <i><font color="#999999">Creating an access key for a device</font></i> <br><br>  After that, a window will appear that contains a key pair that is unique for each user.  The key, which is displayed in the <b>Secret Access Key</b> field, is shown only once, after closing the window it can no longer be seen.  This means that you will need to generate a new key to re-access the system, if the old one, after it was created, you have not saved anywhere. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a72/089/c1d/a72089c1d6ed884fb142d9283d04d811.png"></div><br>  <i><font color="#999999">Creating an access key</font></i> <br><br>  <b>Attention!</b>  Do not close this window until following the steps in the next section. </li></ol><br><h3>  <font color="#0071c5">Set Gateway Configuration</font> </h3><br>  It is recommended to connect to the gateway via SSH or use the command line using the IoT Gateway Developer Hub interface to make it convenient to copy commands.  If you work with the command line by connecting to the gateway directly using the monitor and keyboard, you in the next section will have to manually enter the access key and secret key. <br><br><ol><li>  Add user credentials to the gateway.  To do this, enter the following command: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">aws</span></span> configure</code> </pre> <br>  In response, the system prompts you to enter the following: <br><br><ul><li>  <b>AWS Access Key ID</b> : Just generated Access Key ID, access key. </li><li>  <b>AWS Secret Access Key</b> : Secret Access Key, the secret key that corresponds to the generated access key. </li><li>  <b>Default region</b> : <a href="http://docs.aws.amazon.com/general/latest/gr/rande.html">here</a> you can find a list of regions (for example, eu-west-1) </li><li>  <b>The default output format</b> : the <b>default settings</b> are appropriate, so press <b>Enter</b> . <br></li></ul><br></li><li>  Create the ‚Äúthing‚Äù associated with your AWS instance.  To do this, enter the following commands on the gateway: <br><br><pre> <code class="hljs pgsql">aws iot <span class="hljs-keyword"><span class="hljs-keyword">create</span></span>-thing <span class="hljs-comment"><span class="hljs-comment">--thing-name gateway-test-01</span></span></code> </pre> <br>  If the addition of ‚Äúthings‚Äù was successful, information similar to the ones shown in the figure below will be displayed in the console. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/deb/060/d25/deb060d25c3fbbf8f52a4062f42079f5.png"></div><br>  <i><font color="#999999">Successful creation of "things"</font></i> <br><br></li><li>  Set permissions.  To do this, enter the following commands in the console in order to create a new permission policy for your AWS instance. <br><br><pre> <code class="hljs cmake">aws iot create-<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-name gateway-<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-document '{ <span class="hljs-string"><span class="hljs-string">"Version"</span></span>: <span class="hljs-string"><span class="hljs-string">"2012-10-17"</span></span>, <span class="hljs-string"><span class="hljs-string">"Statement"</span></span>: [{ <span class="hljs-string"><span class="hljs-string">"Effect"</span></span>: <span class="hljs-string"><span class="hljs-string">"Allow"</span></span>, <span class="hljs-string"><span class="hljs-string">"Action"</span></span>:[<span class="hljs-string"><span class="hljs-string">"iot:*"</span></span>], <span class="hljs-string"><span class="hljs-string">"Resource"</span></span>: [<span class="hljs-string"><span class="hljs-string">"*"</span></span>] }] }'</code> </pre> <br>  You can learn about the successful addition of a policy by a message in the console. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a72/dc2/f6f/a72dc2f6fd088487a3acf9dacbad4ffc.png"></div><br>  <i><font color="#999999">Successful Adding Policy</font></i> <br><br></li><li>  Create keys and a certificate for the ‚Äúthing‚Äù.  To do this, enter the following commands, which will create the keys and certificates necessary for organizing interaction with AWS. <br><br><pre> <code class="hljs pgsql">wget -O rootCA.pem https://www.symantec.com/content/en/us/enterprise/verisign/roots/VeriSign-<span class="hljs-keyword"><span class="hljs-keyword">Class</span></span>%<span class="hljs-number"><span class="hljs-number">203</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">Public</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Primary</span></span>-Certification-Authority-G5.pem aws iot <span class="hljs-keyword"><span class="hljs-keyword">create</span></span>-keys-<span class="hljs-keyword"><span class="hljs-keyword">and</span></span>-certificate <span class="hljs-comment"><span class="hljs-comment">--set-as-active --certificate-pem-outfile cert.pem --private-key-outfile privkey.pem</span></span></code> </pre> <br>  If everything goes as it should, messages will appear in the console that resemble those shown below.  They will be followed by a large fragment of JSON data.  In order to continue working, we need only the parameter <b>certificateArn</b> , which is located at the very beginning. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/38e/bb3/4ea/38ebb34ea8550736e7e0fcbf48044b71.jpg"></div><br>  <i><font color="#999999">Successful addition of keys and certificates</font></i> <br><br></li><li>  Now you need to bind policy and certificate.  To do this, use the following command: <br><br><pre> <code class="hljs cmake">aws iot attach-principal-<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-name <span class="hljs-variable"><span class="hljs-variable">${POLICY_NAME}</span></span> ‚Äìprincipal <span class="hljs-variable"><span class="hljs-variable">${CERTIFICATE_ARN}</span></span></code> </pre> <br>  Check that the name of the policy is correct (for example, <b>gateway-policy</b> ) and the value of <b>certificateArn</b> obtained in the previous step.  It all looks like this: <br><br><pre> <code class="hljs cmake">aws iot attach-principal-<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-name gateway-<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> --principal arn:aws:iot:eu-west-<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">681450608718</span></span>:cert/<span class="hljs-number"><span class="hljs-number">122</span></span>c86b84c6e0b919353882c03ca37385855897e16804438a20d44b3f9934cb3</code> </pre> <br></li><li>  Check out the device in the AWS IoT console.  To do this, go to the console home screen by clicking the <b>AWS</b> icon in the upper left of the page.  Then check that in the upper right corner you select the region that was used when setting up the gateway (for example, Ireland).  Now click on the <b>AWS IoT</b> service icon in the list. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f1b/4a6/e12/f1b4a6e1234e01670070ee6c2107523a.png"></div><br>  <i><font color="#999999">AWS Home Screen, transition to AWS IoT</font></i> <br><br>  Now, the newly created ‚Äúthing‚Äù should be visible in the AWS IoT control panel, as well as the policy and certificate that we configured above. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c6e/7e3/8d4/c6e7e38d423f7e77c69478e6b6bea3d9.png"></div><br>  <i><font color="#999999">AWS control panel</font></i> <br></li></ol><br>  At this stage, after setting up the gateway, you can exchange data with AWS.  Now consider two options for interaction between the gateway and the cloud: using Node-RED and Python.  If you are only interested in one of the aforementioned application development platforms, you can read only a section devoted to it. <br><br><h2>  <font color="#0071c5">Interaction with AWS IoT.</font>  <font color="#0071c5">Node-red</font> </h2><br>  In order to start working in the Node-RED environment, you need to make sure that you are using the latest version of the OS.  AWS requires Node-RED 0.14.x. <br><br><h3>  <font color="#0071c5">AWWS Setup</font> </h3><br>  You can monitor the interaction between AWS and the gateway using the AWS console. <br><br><ol><li>  In the AWS IoT console, click the <b>MQTT Client</b> link, which is located in the upper right part of the window. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/363/0e4/77c/3630e477cb0c5c3dbd121be1b6fad40a.png"></div><br>  <i><font color="#999999">MQTT Client Reference</font></i> <br><br></li><li>  In the MQTT Client window, enter the name of the ‚Äúthing‚Äù that was previously assigned (for example, <b>gateway-test-01</b> ) and click the <b>Connect</b> button. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a48/cf5/662/a48cf5662933d7f79385d2a06b1dfec0.png"></div><br>  <i><font color="#999999">Connect to "things"</font></i> <br><br>  If AWS can communicate with the gateway, the connection status message changes to <b>Connected</b> and turns green. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aff/b6b/c41/affb6bc41274cb896039343673a3b610.png"></div><br>  <i><font color="#999999">AWS Gateway Connection Status</font></i> <br><br></li><li>  Click the <b>Subscribe to topic</b> link in the <b>MQTT Client Actions</b> group. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc0/ccc/aeb/bc0cccaeb98da727ea090dd3884374f9.png"></div><br>  <i><font color="#999999">Begin the MQTT Subscription Process</font></i> <br><br></li><li>  In the <b>Subscription topic</b> field, enter <code>sdk/test/nodered</code> and click the <b>Subscribe</b> button. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/da0/bda/3cc/da0bda3cc3f4b489c3afa5dbe5b0957e.png"></div><br>  <i><font color="#999999">Subscribe to a topic</font></i> <br><br>  Now the messages posted by the gateway in the <b>sdk / test / nodered topic</b> will appear in the message window. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/205/eee/031/205eee03182645b08b0f7312647fafb6.png"></div><br>  <i><font color="#999999">View window messages received from the gateway</font></i> </li></ol><br><h3>  <font color="#0071c5">‚ñçDownload interface Node-RED</font> </h3><br>  In order to open the Node-RED window, in the <b>IoT Gateway Developer Hub</b> , go to the <b>Administration</b> section.  Here, under the <b>Node-RED</b> icon, click on the <b>Launch</b> button. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/02d/db2/4c5/02ddb24c50eb2216c6b4978da609c881.png"></div><br>  <i><font color="#999999">Running Node-RED</font></i> <br><br><h3>  <font color="#0071c5">‚ñçSetting an application flowchart</font> </h3><br><ol><li>  Drag the <b>mqtt</b> and <b>inject</b> nodes onto the current sheet from the node panel, which is located on the left.  If the desired node is not visible, scroll the panel. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/df9/c8b/65e/df9c8b65e0aa9eba8bc3c56a37fe3419.png"></div><br>  <i><font color="#999999">Inject and mqtt nodes</font></i> <br><br></li><li>  Position the nodes in the window and connect them as shown in the figure below.  Here there is an <b>inject</b> node, renamed the <b>timestamp</b> , which will, at a specified interval, send information about the current time to the <b>mqtt</b> node.  The <b>mqtt</b> node <b>is</b> responsible for sending the received data to the MQTT broker.  In this case, it will be <b>AWS IoT</b> .  Once the nodes are placed in the flowchart and connected, they must be configured. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ba/4cb/860/9ba4cb86090a95b1074d3ac3689afa6c.png"></div><br>  <i><font color="#999999">Layout and communication of nodes in Node-RED</font></i> <br><br></li><li>  To configure an <b>inject</b> node (which eventually became a <b>timestamp</b> node), you need to double click on it, which will bring up a dialog box.  It must be aligned with the figure below, and click on the <b>Done</b> button.  Thanks to these settings, the node will send data every 5 seconds. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f1f/b80/1a7/f1fb801a7952fac85860708e44b7d75f.png"></div><br>  <i><font color="#999999">Inject node setup</font></i> <br><br></li><li>  To configure the <b>mqtt</b> node, double-click on it, and then, in the settings window, click the edit button <b>next</b> to the <b>Server</b> field. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e67/c0d/cfc/e67c0dcfc7394e90bd91e60c7ecd8cdb.png"></div><br>  <i><font color="#999999">Start configuring the mqtt node</font></i> <br><br></li><li>  Fill in the MQTT connection settings fields as shown in the figure below.  You will need to enter your own server URL.  Now you will learn about where to get it. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b95/253/d2f/b95253d2f3aac299258aabd822ad693c.png"></div><br>  <i><font color="#999999">Configure the mqtt node, enter server information</font></i> <br><br></li><li>  Enter the following command to get the server address for the AWS messaging. <br><br><pre> <code class="hljs sql">aws iot <span class="hljs-keyword"><span class="hljs-keyword">describe</span></span>-endpoint</code> </pre> <br>  In response to it, the address information will be displayed in the console.  Namely, the <b>endpointAddress</b> parameter will contain the address of the server that we need to configure the MQTT connection. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/633/e59/d68/633e59d68ddbcc7df58895e0e2736ca2.png"></div><br>  <i><font color="#999999">Server address in the console</font></i> <br><br>  Copy the URL in quotes and paste it into the <b>Server</b> field.  Note that the <b>Port</b> field must be empty. <br><br>  Now you need to configure the connection security settings.  Before you do this, you need to set the <b>Enable secure</b> flag <b>(SSL / TLS) connection</b> , then click on the <b>Edit</b> icon at the end of the <b>TLS Configuration</b> section. <br><br></li><li>  In the window shown below, you need to configure the parameters.  Namely, in them you need to specify the path to the previously generated key files and certificates. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/345/a7d/707/345a7d70787b8417fcd682d378433f0b.png"></div><br>  <i><font color="#999999">Setting paths to keys and certificates</font></i> <br><br><ul><li>  In the <b>Certificate</b> field, enter the path to the <code>cert.pem</code> file that was generated earlier. <br></li><li>  In the <b>Private Key</b> field - the path to <code>privkey.pem</code> .  This file has also been generated. <br></li><li>  In the <b>CA Certificate</b> field, the path to the <code>rootCA.pem</code> file that should have been loaded. </li></ul><br>  All certificates and keys must be stored in the same directory.  By default, if you change nothing by connecting to the gateway, this is <b>/ root</b> . <br><br>  Here is what the filled fields from our example look like. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4c3/939/6c3/4c39396c30a56212007bf26e541e9827.png"></div><br>  <i><font color="#999999">Filled fields of paths to files of keys and certificates</font></i> <br><br></li><li>  After you complete the configuration, click the <b>Add</b> button to save the TLS configuration.  The setup screen should look something like the one below. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d4e/52a/604/d4e52a60402958cc3862ac5da5fa6e52.png"></div><br>  <i><font color="#999999">Complete setup</font></i> <br><br></li><li>  Now almost everything is ready.  It remains only to enter the name of the topic to which you want to send messages.  The topic entered should correspond to the one we subscribed to earlier, setting up the MQTT client in the AWS control panel, so you need to enter <code>sdk/test/nodered</code> in the <b>Topic</b> field and click the <b>Done</b> button. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/534/204/f51/534204f51c7a6e4b03df3a64dd8338c5.png"></div><br>  <i><font color="#999999">Configuring MQTT Themes</font></i> <br><br>  The Node-RED application is now configured and ready for deployment. </li></ol><br><h3>  <font color="#0071c5">‚ñçDownloading and checking the application</font> </h3><br><ol><li>  Click on the <b>Deploy</b> button in the upper right corner of the Node-RED window.  If a window appears asking you to confirm the deployment, click the <b>Confirm deploy</b> button. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b2a/b9a/dad/b2ab9adad438a11fb0efb80e405a91f6.png"></div><br>  <i><font color="#999999">Deploying the Node-RED application</font></i> <br><br>  If the MQTT node has been successfully configured, below it you can see the green LED labeled <b>connected</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d52/845/593/d52845593c6b592656572ebcb2df54c2.png"></div><br>  <i><font color="#999999">Mqtt node status</font></i> <br><br></li><li>  To finally make sure everything is working correctly, return to the MQTT client message window in the AWS control panel.  There should be new posts. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/39b/eda/4e9/39beda4e9376eefba0e9338fe1e7e954.png"></div><br>  <i><font color="#999999">New messages in the AWS MQTT client window</font></i> </li></ol><br>  Sending data to AWS using Node-RED is fine-tuned.  Let us now organize the same process using Python. <br><br><h2>  <font color="#0071c5">Interaction with AWS IoT.</font>  <font color="#0071c5">Python</font> </h2><br>  After the gateway is configured to interact with AWS, you can prepare it to work with the cloud using Python scripts.  There are many examples of such scripts, they can be used for training purposes and for testing the system. <br><br><h3>  <font color="#0071c5">AWWS Setup</font> </h3><br><ol><li>  In the AWS IoT console, click the <b>MQTT Client</b> link, which is located at the top right of the program window. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/693/258/93d/69325893d9a5c2df1f098a76030671bd.jpg"></div><br>  <i><font color="#999999">MQTT Client Reference</font></i> <br><br></li><li>  In the MQTT Client window, enter the name of the ‚Äúthing‚Äù that was previously assigned to the gateway (for example, <b>gateway-test-01</b> ) and click the <b>Connect</b> button. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/989/41c/184/98941c18429483bd994e9084c1fb31cd.png"></div><br>  <i><font color="#999999">Connect to "things"</font></i> <br><br>  If AWS can communicate with the gateway, the connection status message changes to <b>Connected</b> and turns green. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f0e/842/933/f0e84293336189fb06a25b0eef11a637.png"></div><br>  <i><font color="#999999">AWS Gateway Connection Status</font></i> <br><br></li><li>  In the <b>MQTT Client Actions</b> section, click <b>Subscribe to topic.</b> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/32a/c0c/3e4/32ac0c3e47b5642aab343ece276706ef.png"></div><br>  <i><font color="#999999">Begin Subscribing To MQTT</font></i> <br><br></li><li>  In the <b>Subscription topic</b> field, enter <code>sdk/test/Python</code> and click the <b>Subscribe</b> button. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c9f/727/fe9/c9f727fe9f43319dd39e71efd048c873.png"></div><br>  <i><font color="#999999">Set up a subscription to the MQTT theme</font></i> <br><br>  Messages received from the gateway can be viewed in the message window. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/08a/d5f/c18/08ad5fc182c967f2c5d5b549e233bb89.png"></div><br>  <i><font color="#999999">Message box</font></i> <br></li></ol><br><h3>  <font color="#0071c5">‚ñçSending a message from the gateway</font> </h3><br><ol><li>  In order to find out the server address needed to send MQTT messages from the gateway, run the following command: <br><br><pre> <code class="hljs sql">aws iot <span class="hljs-keyword"><span class="hljs-keyword">describe</span></span>-endpoint</code> </pre> <br>  In response, you will receive the value of the <b>endpointAddress</b> parameter, which contains what we need.  Copy the address bar, placed in quotes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a2/952/903/6a29529038f0015093e2e33a69ba0904.png"></div><br>  <i><font color="#999999">Server address</font></i> <br><br></li><li>  Navigate to the folder that contains AWS examples.  For example, in our case, this required the following command: <br><br><pre> <code class="hljs pgsql">cd /usr/<span class="hljs-keyword"><span class="hljs-keyword">share</span></span>/awsiotsdk/samples/python/</code> </pre> <br></li><li>  Run one of the code examples using the following command: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">python</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">basicPubSub</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.py</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-e</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ENDPOINT]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ROOTCA_PATH]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-c</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[CERT_PATH]</span></span> ‚Äì<span class="hljs-selector-tag"><span class="hljs-selector-tag">k</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[PRIVATE_KEY_PATH]</span></span></code> </pre> <br>  Here's how to set the script call options: <br><br><ul><li>  <b>ENDPOINT</b> : The address of the server that you found out above. </li><li>  <b>ROOTCA_PATH</b> : Path to the previously loaded rootCA.pem file. </li><li>  <b>CERT_PATH</b> : Path to the previously generated cert.pem file. </li><li>  <b>PRIVATE_KEY_PATH</b> : Path to the previously generated privkey.pem file. </li></ul><br>  Certificate and key files must be located in the same directory.  By default, this is <b>/ root</b> or <b>$ HOME</b> , if you have not changed anything by connecting to the gateway. <br><br>  In our case, the above command looked like this: <br><br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">python</span></span> basicPubSub.py -e a1gx5hswnkj6kf.iot.eu-west<span class="hljs-number"><span class="hljs-number">-1.</span></span>amazonaws.com -r $HOME/rootCA.pem -c $HOME/cert.pem -k $HOME/privkey.pem</code> </pre> <br>  If the sample application is working, data will be displayed in the console, such as those shown in the figure below.  This indicates that MQTT messages are sent to the <b>sdk / test / Python</b> subject. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/18a/c64/727/18ac647270d01b8a0e9d20e1b3c23337.png"></div><br>  <i><font color="#999999">Messages from the Python script</font></i> <br><br></li><li>  In order to check whether AWS really receives these messages, you need to return to the messages window on the AWS website.  There should appear new messages. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b78/912/3e0/b789123e073be7db46d2c36d36e29007.png"></div><br>  <i><font color="#999999">New messages sent from the gateway</font></i> <br><br>  As a result, on the gateway connected to AWS IoT, you can run Python scripts that interact with the cloud. </li></ol><br><h2>  <font color="#0071c5">findings</font> </h2><br>  The cloud part plays an important role in a variety of IoT systems.  Now that you have mastered this guide, you can connect Intel IoT gateways to Amazon Web Services and create applications that can work with cloud services in a Node-RED environment or in Python. </div><p>Source: <a href="https://habr.com/ru/post/314282/">https://habr.com/ru/post/314282/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../314264/index.html">Localization of indie games in Unity: implicit costs</a></li>
<li><a href="../314266/index.html">Malefactors use 0day vulnerabilities in cyber attacks on users</a></li>
<li><a href="../314268/index.html">How to run Python through SAS?</a></li>
<li><a href="../314274/index.html">How to pdf (images) convert to text txt file</a></li>
<li><a href="../314276/index.html">Mikhail Grachev: "Information is power in car racing"</a></li>
<li><a href="../314286/index.html">Investing in AI offers more benefits than risks.</a></li>
<li><a href="../314290/index.html">‚ÄúHow much is in the clouds‚Äù - price review on the Ukrainian cloud market</a></li>
<li><a href="../314294/index.html">Donald Knut: about the assembler, the translator and competent programming</a></li>
<li><a href="../314296/index.html">Using FPGA to calculate microtubule depolymerization using Brownian dynamics</a></li>
<li><a href="../314302/index.html">Improving the function of CDF in Excel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>