<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Track devices via passive WiFi listening</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Over the past year I have come across many stories using passive WiFi tracking. Basically, everyone focuses on security and privacy issues, but few te...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Track devices via passive WiFi listening</h1><div class="post__text post__text-html js-mediator-article">  Over the past year I have come across many stories using passive WiFi tracking.  Basically, everyone focuses on security and privacy issues, but few tell us how it works.  I made a whole project of Casual Encounters and I can share information about how the system works, how to avoid surveillance, and how to build it (for research purposes, of course).  Do not try this at home. <br><a name="habracut"></a><br><h4>  Trial requests </h4><br>  When a WiFi client tries to connect with a known network, it has two options.  The first is used by laptops and other devices that are not smartphones.  It includes the search for signal packets (Beacon Frames).  These packets send routers to announce their presence.  The client finds the already known network and connects to it.  The second option, which is usually used by smartphones, includes periodic distribution of trial requests (Probe Requests), containing a unique client MAC-address and sometimes the name of the network that it knows.  The advantage of the second approach is that it works faster.  And besides this, it is much easier to use for their own purposes. <br><br><h4>  Listening Mode (Monitor Mode) </h4><br>  WiFi devices can work in six modes.  To listen to the traffic, the device must switch to the listening mode.  After that, it does not advertise itself, so the presence of such devices is very difficult to install. <br><br><h4>  Protection </h4><br>  Theoretically, it is very easy to protect against these bugs.  If you turn off WiFi on your phone when it is not needed (that is, you are far from places where there are trusted networks), the phone will stop sending requests and you will not be able to track down.  Almost every time to turn off WiFi would be pretty tedious. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For android there are several applications to facilitate the process.  For example, AVG PrivacyFix allows you to configure a list of trusted networks, in the presence of which your WiFi will be enabled.  There are other applications on this topic. <br><br>  In the case of iOS, your choice is limited.  If you do not use jailbroken, the protected mode of the apple will not allow applications to the WiFi switch.  In iOS 7, there was perhaps more convenient access to the WiFi menu, but you still need to do it manually. <br><br><h4>  We build a tracker </h4><br>  You can, of course, just use a laptop - even a MacBook.  Install Wireshark and configure the filter for test requests.  But this is not so interesting, besides, if you want to build a whole network of trackers, it will be quite expensive to use laptops for this. <br><br>  For such non-master purposes, the Raspberry Pi with a wireless adapter, or (which I prefer), TP-LINK MR-3020 router with a special firmware is enough.  These options are small and can be powered by a 5-volt battery. <br><br>  Setting Pi will be quite simple, because  there is already a working file system, but I prefer the MR-3020 router.  It is an inexpensive and standalone solution.  Therefore, I will describe the configuration of the router, and if you want to use Pi, then: <br><br>  - you can skip steps to Listening mode settings <br>  - these two devices have different versions of Linux, so some configuration files may be in different places and they may have different package managers. <br>  - more powerful AWUS036H type radios may require an external powered USB hub <br><br><h4>  Configure the router </h4><br>  You will need: <br><br>  - TP-LINK MR-3020 router ($ 34.99 on Amazon).  Should work and analogues, such as TP-LINK TL-WR703N <br>  - USB flash drive (2-4 GB) <br>  - Ethernet cable <br><br>  The first part of the instructions is taken from <a href="http://daviddarts.com/piratebox-diy-openwrt">the PirateBox project</a> , since the initial configuration of the devices is identical. <br><br>  1. Download a <a href="">copy of OpenWrt</a> for the MR3020 (a modification from Matthias Strubel includes all the necessary kernel modules). <br>  More information: <a href="http://forum.daviddarts.com/read.php%3F2">forum.daviddarts.com/read.php?2</a> , 3974,4009 # msg-4009 <br>  Discussion firmware: <a href="https://forum.openwrt.org/viewtopic.php%3Fpid%3D207769">forum.openwrt.org/viewtopic.php?pid=207769#p207769</a> <br>  Firmware for WR703N: <a href="http://downloads.openwrt.org/attitude_adjustment/12.09-beta2/ar71xx/generic/">downloads.openwrt.org/attitude_adjustment/12.09-beta2/ar71xx/generic</a> <br><br>  2. Switch the switch next to the LAN / WAN port to WISP <br><br>  3. Turn off laptop wifi <br><br>  4. Connect the router via ethernet to the computer and open in the browser <a href="http://192.168.0.254/">192.168.0.254</a> (MR3020) or <a href="http://192.168.1.1/">192.168.1.1</a> (WR703N) <br><br>  5. Enter login / password (admin / admin) <br><br>  6. Go to System Tools&gt; Firmware Upgrade, select OpenWRT firmware. <br><br>  WR703N Chinese firmware text.  For firmware via the web interface, select the last menu on the left, then the third submenu item.  <a href="https://groups.google.com/forum/">More details</a> . <br><br>  7. After the upgrade, the system will restart. <br><br>  8. Go there via telnet <br><br><pre><code class="bash hljs">telnet 192.168.1.1</code> </pre> <br><br>  9. Use the passwd command to set a password.  This will give access to SSH. <br><br><pre> <code class="bash hljs">passwd</code> </pre><br><br>  10. Using vi, edit the network settings.  Suppose your main gateway has an address of 192.168.2.1.  The OpenWrt address must not be the same, but must be on the same subnet. <br><br><pre> <code class="bash hljs"> vi /etc/config/network</code> </pre><br><br>  Change the file to this state: <br><br><pre> <code class="bash hljs"> config interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> config interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.2.111'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.2.1'</span></span> list dns <span class="hljs-string"><span class="hljs-string">'192.168.2.1'</span></span> list dns <span class="hljs-string"><span class="hljs-string">'8.8.8.8'</span></span></code> </pre><br><br>  11. Disconnect the router from the network. <br><br>  12. Turn on wifi on laptop <br><br>  13. Connect the MR3020 (or WR703N) to the gateway router via Ethernet and turn on the configured router in the network.  Wait a minute.  From a computer connected to LAN, try to log into the router. <br><br><pre> <code class="bash hljs"> ssh root@192.168.2.111</code> </pre><br><br>  14. Pingan google to check settings <br><br><pre> <code class="bash hljs"> ping google.com</code> </pre><br><br>  15. Add USB support to OpenWrt (if you did not use the already configured firmware from step 1): <br><br><pre> <code class="bash hljs"> opkg update opkg install kmod-usb-uhci insmod usbcore <span class="hljs-comment"><span class="hljs-comment">## may return: file exists insmod uhci opkg install kmod-usb-ohci ## may return: up to date. insmod usb-ohci</span></span></code> </pre><br><br>  USB setup <br><br>  Format the flash drive into two partitions - the main Ext4 and swap.  swap should be between 256 and 512 MB. <br>  Log in to ssh on the router. <br>  Install packages to support Ext4: <br><br><pre> <code class="bash hljs"> root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># opkg update root@OpenWrt:~# opkg install block-mount kmod-fs-ext4</span></span></code> </pre><br><br>  Insert the flash drive into the router.  Check that it is defined. <br><br><pre> <code class="bash hljs"> root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># ls /dev | grep sda sda sda1 sda2</span></span></code> </pre><br><br>  File system setup <br><br>  Now we will make sda1 the root of the filesystem. <br>  (as described here by <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#openwrt</a> ) <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># mkdir /mnt/sda1 root@OpenWrt:~# mount /dev/sda1 /mnt/sda1</span></span></code> </pre><br><br>  Let's check that everything got out of order (should return / dev / sda1 to / mnt / sda1 type ext4): <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># mount | grep sda1</span></span></code> </pre><br><br>  Copy the files from the router to the flash drive so that all the necessary settings are available when we reboot and USB will be the basis of the file system. <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># tar -C /overlay -cvf - . | tar -C /mnt/sda1 -xf -</span></span></code> </pre><br><br>  Add the automatic connection / dev / sda1 to / etc / config / fstab. <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># vi /etc/config/fstab</span></span></code> </pre><br><br>  Use the following settings: <br><br><pre> <code class="bash hljs">config global automount option from_fstab 1 option anon_mount 1 config global autoswap option from_fstab 1 option anon_swap 0 config mount option target /overlay option device /dev/sda1 option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0 config swap option device /dev/sda2 option enabled 0</code> </pre><br><br>  Reboot the router <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># reboot</span></span></code> </pre><br><br>  When all the lights come on again, go to ssh and check that the flash drive is correctly hooked. <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># mount | grep sda1 /dev/sda1 on /overlay type ext4 (rw,sync,relatime,user_xattr,barrier=1,data=ordered)</span></span></code> </pre><br><br>  If you can not log in via ssh, then copying the files went wrong.  Remove the flash drive, reboot it via power.  When it starts up, you can go there via ssh.  Then reinsert the flash drive and repeat the previous steps. <br><br><h4>  Customize swap </h4><br>  The router has a little memory, long processes can take it all.  To test the memory, enter <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># free</span></span></code> </pre><br><br>  To solve memory problems, you can use the swap partition.  First, check that it works: <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># mkswap /dev/sda2</span></span></code> </pre><br><br>  Now connect it to the swap: <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># swapon /dev/sda2</span></span></code> </pre><br><br>  Run free again to check that it is connected. <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># free total used free shared buffers Mem: 29212 19160 10052 0 1972 -/+ buffers: 17188 12024 Swap: 475644 0 475644</span></span></code> </pre><br><br>  To make this happen automatically it is best to make a separate script.  By the way, at the same time you will learn how to make such scripts. <br><br><h4>  Script to connect Swap at startup </h4><br>  Let's start by creating a script: <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># vi /etc/init.d/swapon</span></span></code> </pre><br><br>  Enter the following into the file: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/ash /etc/rc.common START=109 STOP=151 start() { echo "start swap" swapon /dev/sda2 } stop(){ echo "stop" }</span></span></code> </pre><br><br>  Make it executable: <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># chmod +x /etc/init.d/swapon</span></span></code> </pre><br><br>  Now you need to make a symlink with /etc/rc.d on it: <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># ln -s /etc/init.d/swapon /etc/rc.d/S109swapon</span></span></code> </pre><br><br>  S109 tells the system the priority of the script.  All files in /etc/rc.d begin with S ##.  S109 should place it at the very end, after all the rest are launched. <br><br>  Reboot, log in via ssh and check the swap connection: <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># free total used free shared buffers Mem: 29212 19276 9936 0 2152 -/+ buffers: 17124 12088 Swap: 475644 0 475644</span></span></code> </pre><br><br><h4>  Customize listening mode </h4><br>  Almost everything is ready.  We need to edit the wireless settings: <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># vi /etc/config/wireless</span></span></code> </pre><br><br>  Comment out the wifi ban line: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#option disabled 1</span></span></code> </pre><br><br>  Use the following settings: <br><br><pre> <code class="bash hljs">config wifi-iface option device radio0 option network lan option mode monitor option hidden 1</code> </pre><br><br>  Restart the wifi interface: <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># wifi down; wifi up</span></span></code> </pre><br><br>  Error messages such as those presented below should not affect the operation of wifi: <br><br><pre> <code class="bash hljs">ifconfig: SIOCSIFHWADDR: Invalid argument <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> failed: Device or resource busy (-16)</code> </pre><br><br>  Check that wifi is working and is in monitor mode: <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># iwconfig lo no wireless extensions. wlan0 IEEE 802.11bgn Mode:Monitor Frequency:2.412 GHz Tx-Power=15 dBm RTS thr:off Fragment thr:off Power Management:on eth0 no wireless extensions. br-lan no wireless extensions.</span></span></code> </pre><br><br><h4>  Package installation </h4><br>  Now we will install all the packages required for the scanner: <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># opkg update root@OpenWrt:~# opkg upgrade tar wget root@OpenWrt:~# opkg install python tcpdump unzip root@OpenWrt:~# wget http://www.secdev.org/projects/scapy/files/scapy-latest.tar.gz root@OpenWrt:~# tar -xvf scapy-latest.tar.gz root@OpenWrt:~# cd scapy* root@OpenWrt:~# python setup.py install root@OpenWrt:~# cd ..; rm -rf scapy*</span></span></code> </pre><br><br><h4>  Scan script check </h4><br>  Copy scripts with git (or you can download them as zip) <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># mkdir /overlay/scripts; cd /overlay/scripts root@OpenWrt:/overlay/scripts# wget http://bitbucket.org/edkeeble/wifi-scan/get/e2a08627f05d.zip --no-check-certificate -O wifiscan.zip root@OpenWrt:/overlay/scripts# unzip wifiscan.zip root@OpenWrt:/overlay/scripts# mv edkeeble-wifi-scan-e2a08627f05d wifi-scan</span></span></code> </pre><br><br>  As responsible hackers, we will not intercept all requests.  We will make a white list, which will include only our phones. <br><br><pre> <code class="bash hljs">root@OpenWrt:/overlay/scripts<span class="hljs-comment"><span class="hljs-comment"># cd wifi-scan root@OpenWrt:/overlay/scripts/wifi-scan# vi wifiscan.py WHITELIST = ['00:00:00:00:00:00',] #   - </span></span></code> </pre><br><br>  Check the script: <br><br><pre> <code class="bash hljs">root@OpenWrt:/overlay/scripts/wifi-scan<span class="hljs-comment"><span class="hljs-comment"># python wifiscan.py wlan0</span></span></code> </pre><br><br>  Remove the phone, disconnect from the current network, but do not turn off wifi.  In the terminal, you should start to see the requests sent to them.  You may notice that not all requests will have an SSID.  Non-SSID requests are broadcast and are intended for all access points that are within reach. <br><br>  Ctrl-C will stop the script <br><br><h4>  Results </h4><br>  Well, that's it.  Now you have a router that tracks smartphones passing by.  Of course, our script is not very useful in this form.  For example, it can be edited so that it collects more data, writes them to the log, tracks the movement of smartphones between your various devices, etc. </div><p>Source: <a href="https://habr.com/ru/post/252831/">https://habr.com/ru/post/252831/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../252817/index.html">Automation of financial statements</a></li>
<li><a href="../252819/index.html">How to prepare TCP</a></li>
<li><a href="../252821/index.html">Nginx and https. We get class A +</a></li>
<li><a href="../252823/index.html">Custom SQLite Android functions or its own LOWER_FNC ()</a></li>
<li><a href="../252829/index.html">Sound effects in Windows Phone 8 applications</a></li>
<li><a href="../252833/index.html">Calculation of prescaler parameters for 8250-compatible USART</a></li>
<li><a href="../252837/index.html">Freedom dependent variables</a></li>
<li><a href="../252843/index.html">What is wrong with online courses and how to fix it: HTML Academy experience</a></li>
<li><a href="../252845/index.html">As a mini PBX manager with GSM and call recordings did</a></li>
<li><a href="../252847/index.html">Apple's disappointment, Unity and Epic Games generosity, Paris Hilton game - and other news of the week for a mobile developer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>