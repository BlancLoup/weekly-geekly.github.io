<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Terminal server for AutoCAD</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I was interested in the terminal server for CAD systems for a long time and this article is the result of research on the Internet. In this article we...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Terminal server for AutoCAD</h1><div class="post__text post__text-html js-mediator-article">  I was interested in the terminal server for CAD systems for a long time and this article is the result of research on the Internet.  In this article we will talk specifically about the terminal server for Avtokad. <br><br>  AutoCAD is quite resource-intensive application that requires all the resources of iron: the RAM, the video card, the powerful processor and fast disks.  And the thought immediately arises that freestanding powerful PCs are the best option.  But we tried to deploy a terminal server for this application and put it into practice. <br><br>  So, the configuration of our cool server: <br><a name="habracut"></a><br><ol><li>  Supermicro platform (already nekruto, but still quite bright); </li><li>  2 E5-2260 v4 processors with 28 physical cores, and with hyperthreading feature enabled 56 cores; </li><li>  Hypervisor ‚Äî Citrix Xenserver 7.0 host operating system </li><li>  guest operating system Server 2016 Standart; </li><li>  Raid array 10 - 4 HDD disks of 1 TB with a rotation speed of 10,000 revolutions per minute; </li><li>  Ethernet 1 Gb / sek; </li><li>  The most important component is 2 Tesla m60 16 Gb video accelerators. </li></ol><br>  In fact, the server was designed to create virtual machines on windows 10 and deliver them to the user via Citrix Receiver.  Virtual machines exist, but I wanted to create not many virtual lovers for many users, but one. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I was looking for how to make a terminal server with delivery via citrix receiver - I did not find the VDAforHDX 3dPro agent for the server OS, if anyone knows how and what, please, drop the link in the comments, so I created a server with delivery via RDP. <br><br>  Let's start in order: <br><br><ol><li>  creating a virtual machine in Citrix Xendesctop; </li><li>  installation of the operating system for the Server 2016 Standart virtual machine; </li><li>  installation of updates for the virtual machine OS; </li><li>  Installing Citrix guest services on a virtual machine - after that, the shutdown and restart options will appear in the virtual machine context menu - this will allow you to shut down and restart the virtual machine from Xenserver correctly (before that, only force shutdown and force reboot were available); </li><li>  We send the Teslam60 video card to the virtual machine using the passthrough method. </li></ol><br><img src="https://habrastorage.org/webt/e8/fg/6k/e8fg6kznpzx8fcf6pub1ijc1jfo.png" alt="image"><br><br>  Further, according to the <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/n-series-driver-setup">article, we</a> install both drivers, but, I suppose, only the grid driver could be installed for the virtual machine.  Further drivers do nothing more from this article. <br><br>  Then you need to go to the nvidia control panel and select the default Tesla m60 video card in the 3d settings, by the way, after that, I lost the opportunity to select the default video card and now always appears like this: <br><br><img src="https://habrastorage.org/webt/fz/dz/-f/fzdz-frzva12hcdts_c1qwrblvc.png" alt="image"><br><br>  Next, you need to install the terminal server role and enable the following group policy: <b>Computer Configuration - Administrative Templates - Windows Components - Remote Desktop Services - Remote Desktop Session Host - Remote Session Environment - Use the default hardware graphics adapter</b> <br><br>  Here is the article that helped me do this: <a href="https://unhandled.wordpress.com/2017/05/17/measuring-gpu-utilization-in-remote-desktop-services/">Measuring GPU Utilizationin Remote Desktop Services.</a> <br><br>  Since we are creating a terminal server, as a result of the work of users in any of the applications, temporary files will be created, so in order to minimize the load on the file subsystem, you can install a Ram disk and transfer temporary files to it - <b>In the system settings - Additional system settings - Advanced tab - Environment Variables button</b> : <br><br>  Modify the following variables for both user and system: <br>  Tmp <br>  TEMP <br><br><img src="https://habrastorage.org/webt/ns/k8/yr/nsk8yrs_qx4bgx_csegte_lp34g.png" alt="image"><br><br>  To change these variables to a regular user ‚Äî make him an administrator ‚Äî change the variables, and then take away administrator rights.  In variables, do not specify the root of the Ram disk - some programs will not work because of this, create a folder in the Ram disk - like I have T: \ temp.  Also give this folder full rights for users. <br>  After the reboot, the server is ready for operation and if we start AutoCAD, we will see that <b>hardware acceleration is enabled</b> . <br><br>  All tests were performed using the <b>GridVirtualAPP</b> license - in the Nvidia control panel - in the Licensing section.  To use <b>QuadroDataCenterWorkstation,</b> you must install a license server and purchase the appropriate licenses.  They are bought from us - but still testing was carried out under the licenses of <b>GridVirtualaPP</b> . <br><br>  So go to the test results.  First, according to the already mentioned <a href="https://unhandled.wordpress.com/2017/05/17/measuring-gpu-utilization-in-remote-desktop-services/">article, we</a> included testing of WEbGL - we launched it at ie <a href="http://fishgl.com/">http://fishgl.com</a> . <br><br>  We started on one client and saw joyful 50-70 fps - the video card works. <br>  Launched on three and fps started jumping from 25 to 60 - an average of 35-40 - the quality noticeably subsided began to appear small lags. <br><br>  Here is a graph of gpu utilization, showing the difference in resource consumption between 1 and 3 users - where the load starts to increase - this is the moment of inclusion of fishgl.com in the site, ie two more users. <br><br><img src="https://habrastorage.org/webt/gl/iv/we/glivweipaphdwdj5kypn88uotdg.png" alt="image"><br><br>  After turning on 3 more, everything became even worse. Fps began to sit up to 10 and the processor of the video card was loaded to 100% <br><br><img src="https://habrastorage.org/webt/an/pf/4y/anpf4ygyh9olmtas7zgcbpnomuc.png" alt="image"><br><br>  As a result of the obtained results, we realized that it is better not to launch webgl technologies on a terminal server - and, in general, if it is possible to provide access to the Internet from under a local browser.  First, the user can open in 10 browsers on 100 tabs, and there certainly will not sustain any server.  And, secondly, without the Internet, the terminal server will be more complete. <br><br>  Now let's proceed to the review of testing autocad on our server. <br><br>  First, we went to the terminal server with 16 thin clients and started the AutoCAD, we launched the standard drawings in the AutoCad, we weren't doing drawing. <br><br>  Here are the graphics <br><br>  CPU <br><br><img src="https://habrastorage.org/webt/2q/v2/uu/2qv2uumeao2dibludrq3mbzip7e.png" alt="image"><br><br>  Ethernet <br><br><img src="https://habrastorage.org/webt/k_/ar/_o/k_ar_ol2wzl2oyewxlaobv8zgp0.png" alt="image"><br><br>  GPU <br><br><img src="https://habrastorage.org/webt/s8/tp/kv/s8tpkvfu1qyf-nyh6feb_jkjrrm.png" alt="image"><br><br>  There is no schedule for using RAM, but I‚Äôll say that the server first had 20 GB, but after connecting 13 clients, it consumed 18.2 and AutoCAD started to display errors about the lack of memory.  After that, we added another 10 GB of RAM and errors were gone, and the consumption of RAM did not rise above 22 GB.  From the obtained graphs it can be seen that the use of the server's processor goes up to 50%, the disk subsystem is not particularly involved, the network activity of a maximum of 20 Mbit / s gave out jumps, the average is up to 1 Mbit, oddly enough, but the use of video memory is significant 7.2 GB from 8. From here we can conclude that the maximum number of users is 16, and this is practically without a stock, and at that moment when they do not draw in AutoCAD, they simply opened the drawing. <br><br>  Next, we planted for thin clients of 3rd year students and asked to draw small parts in 3d and 2d.  First, we launched AutoCAD from all thin clients: <br><br><img src="https://habrastorage.org/webt/cf/vc/vv/cfvcvvxebklftrmucu2twlwjvpy.png" alt="image"><br><br>  Video memory just started AutoCAD without opening the drawing consumed 2.9 GB. <br><br>  Next, the jellies began to draw, who was 2d, some 3d, about 50 to 50. There were no special complaints, believed at the time of opening the drawing, and very small delays, which are very rare and the impression of drawing as on a local PC. <br><br>  We can immediately conclude that in this configuration there are not enough 8 CPU cores, it is better to make 10 or 12, the RAM is enough, but it is better to allocate about 2-3 GB per user. <br><br><img src="https://habrastorage.org/webt/h2/ss/kf/h2sskf9jooduuv0k-jczibit_78.png" alt="image"><br><br>  Then they tried to render a drawing at one station - they rendered a 3d-model of 4 walls and immediately got lags in the work of the autocade - some students started complaining that sometimes it became jerky to work.  We asked 5 students to leave and the lags stopped, although a drawing was still being rendered at one station.  Below are the graphics, when 16 students are working and rendering is running - you can just see the moment when the rendering starts. <br><br><img src="https://habrastorage.org/webt/ku/jj/tq/kujjtq1czlbmbjcmmkgzggm1vjs.png" alt="image"><br><br>  In principle, this was enough for us, but we decided to go ahead and started rendering at 3 more places and the auto cad began to slow down everywhere so that the work was clearly not pleasant, but still one student had to be noted, everything worked for him ... but the drawing he was from lines 10 ... <br><br>  From this we can conclude that the Terminal server on a virtual machine with the 1st TeslaM60, which was passthrough's passthrough method, can be used to work in an autocade using the rdp protocol with up to 15 users, preferably about 12-13 per server, and you can draw in 2d and 3d (small), but <b>without rendering</b> . <br><br>  <b>Where to use:</b> when learning to work in auto-caddy - in those disciplines where rendering is <b>not needed</b> (or any other highly demanding technologies), for example, for automatists or technologists who draw only in 2d.  Builders, mechanics and other highly demanding autokadnye personality will complain and spit.  But if you have such a server, and computers with demanding personalities are very outdated, they will gladly honor it on such a server without using rendering, since drawing rendering is the final stage just before passing the test to the discipline, and this time can be distributed in time, for example, run one by one.  But this requires an adequate teacher or laboratory technician who oversees the computer class drawing process. <br>  What makes the terminal server easier: Firstly, the installation time is, on the strength of the installation and configuration day, rather than reinstalling 15 computers, downloading updates and installing updates on each autocad.  Secondly, administration of one server, but not 15 computers. <br><br>  Minuses: Firstly, one server is one point of failure, the server has died, your training process has died.  Therefore, a second such server is needed, but since this is a virtual server, it is better that there are two host servers and backup virtual machines are made, and if one fails, you will quickly start the virtual machine from backup on the second. <br><br>  Secondly, server resources are used by many users at once, and if there is one too clever user who starts a lot of things, then there will be little resources left and can be laid on everyone.  But this is precisely what should be followed by both the server administrator and the teacher of a group of students. <br><br>  Third rdp it and rdp in Africa.  The network will fail, it will be impossible to work and the optimization of the rdp protocol will certainly significantly improve the quality of use, but there are still some complaints about the operation of this technology and not all applications work well with it. <br>  Why chose rdp - because they read <a href="http://www.thecadmasters.com/2013/01/03/autocad-revit-and-microsoft-remote-desktop-protocol-rdp-8-0/">here</a> that autocad supports work through this protocol.  But it is better to use Citrix Receiver, but unfortunately I did not find the manual how to use Citrix XenDesktop for the terminal server, which has CAD applications - all of the search manuals for individual virtual machines with desktop os ‚Äî win7, 8, or 10, in which during installation indicates the type of agent VDA - forHDX 3dpro, but for the server OS there is no such agent, there is only just a VDA.  Agent VDAforHDX 3dPro for virtual machines that have a video card.  If anyone knows how to make the same terminal server using Citrix XenDesktop and if you know where to find VDAforHDX 3dPro for the server OS, please write in the comments. <br><br>  Now let's calculate how much it all costs. <br><br>  Iron server with 2 Tesla M60 cost us 1,500,000 rubles <br>  Hypervisor XenServer7.0 - 125 000r <br>  WindowsServer will cost approximately 60,000 <br>  Terminal license - 1 700 r (one piece) <br>  At most, we can create 4 such terminal servers, because in the hypervisor 2 Tesla M60 video cards are displayed as 4. 4 terminal servers will pull a maximum of 50-60 clients. <br>  When using XenServer as a hypervisor: <br>  <b>If 60 users per server</b> <b><br></b>  <b>1500 000+ 125 000 + 60 000 * 4 + 1700 * 60 = 1967000</b> <b><br></b>  <b>In terms of workplace 32783 p</b> <br><br>  <b>If 50 users per server:</b> <b><br></b>  <b>1500 000 + 125 000 + 60 000 * 4 + 1700 * 50 = 1950000</b> <b><br></b>  <b>In recalculation on a workplace 39000</b> <br><br>  If you take WindowsServer 2016 DataCenter as a hypervisor, you don‚Äôt have to pay for virtual machines OS, and Server 2016 itself costs about 250000 on DataCenter on 28 cores <br>  <b>1500 000 + 250000+ 1700 * 60 = 1852000</b> <b><br></b>  <b>30886 rub for a workplace in recalculation on 60 users</b> <br><br>  Connections can be made, for example, using thin clients that cost up to 20,000 rubles, for example, an hp T620, or nettops, for example, a Lenovo m600, but the best option is to use self-assemblies.  Here is an example of such self-collecting <br><br><ol><li>  Desktop SilverStone Milo ML05 &lt;SST-ML05B&gt; Black Mini-iTX Without BP 1 pc.  <b>3,690</b> </li><li>  Power supply NAVAN &lt;SFX-400W&gt; 400W SFX (24 + 4 pin) 1 pc.  <b>1,378</b> </li><li>  ASRock H110M-ITX (RTL) LGA1151 PCI-E DVI + HDMI GbLAN SATA Mini-ITX 2DDR4 1 pc.  <b>4,305</b> <br>  CPU Intel Core i3-7320 4.1 GHz / 2core / SVGA HD Graphics 630 / 4Mb / LGA1151 1 pc.  <b>10 331</b> <br>  SSD 120 Gb SATA 6Gb / s ADATA Ultimate SU700 &lt;ASU700SS-120GT-C&gt; 2.5 "3D TLC 1 Piece <b>3 813</b> <br>  Crucial DDR4 RDIMM 4Gb &lt;PC4-17000&gt; CL15 ECC Registered 1 pc.  <b>4,428</b> <br>  21.5 "Acer LCD &lt;UM.WV6EE.A09&gt; V226HQL Abmd (LCD, Wide, 1920x1080, D-Sub, DVI) 1 pc. <b>6,703</b> <br>  2Gb &lt;PCI-E&gt; DDR3 MSI GT710 2GD3H LP (RTL) D-Sub + DVI + HDMI 1 pc. <br>  <b>3 321</b> <br><br>  <b>Total: 37 969 rubles.</b>  <b>($ 617.48)</b> <br><br>  Having bought a thin client, you will spend <b>30,000</b> rubles with a monitor and a mouse keyboard, it will have a pre-installed operating system designed only for remote connection anywhere and not quite a working browser.  But having spent a little more and buying self-collecting for <b>40 thousand rubles,</b> you will receive a full-fledged PC with a good processor and a video card.  By installing free Linux on it, for example, Ubuntu or Linux Mint, you will get a full-fledged OS with the ability to install additional software - this can be a variety of applications - from text editors to CAD-applications.  You can even install AutoCAD equivalents on them, for example, BricksCad, but still if your educational institution is taught how to work in Windows applications, you will have to either install it on each Windows workstation or deploy a terminal server. <br><br>  I am at the terminal server if the application allows you to use the launch mode by many users from one server.  At the same time, by increasing the number of users on the server, you will reduce the price of the OS license per user.  This is especially true at the present time when Dream Spark from small-scale software is closed for Russia, and the government decree prohibits the purchase of foreign software for educational institutions without a justification.  In addition, in the new May decrees they plan to transfer the entire state sector to domestic software by the year 24, how it is unclear, and therefore it is necessary to stock up software now. <br><br>  Let's calculate the price for a workstation in several ways. <br><br>  Total in the minimum configuration one workplace will cost: <br>  thin client - 20000 r <br>  monitor - 7000 r <br>  mouse keyboard - 2000 p <br>  Workstation on the terminal server - 30000 r <br>  <b>Total 59 000</b> <br><br>  If you buy self-assembly and Windows: <br>  self-collection with a monitor 38000 p <br>  keyboard mouse - 2000 p <br>  Windows 10 pro - 9000 r <br>  <b>Total 49,000</b> <br><br>  10,000 p is a small overpayment, but choosing the second option increases administration costs: installing windows and drivers takes more time than simply turning on a thin client, or installing Linux mints.  In addition, you need to take care of anti-virus software, and, from experience, I can say that 95 percent of all viruses for Windows. <br><br>  If we choose the third option - a terminal server and self-collection with Linux, we get: <br>  Workstation on the terminal server - 30000 r <br>  self-collecting with a 38000 monitor <br>  keyboard mouse 2000 r <br>  <b>total: 70000 r</b> <br><br>  The price is quite high and for this money you can buy a good self-collection, just for Cad applications, but again, the administration of separate PCs is harder than the administration of the server, especially when it comes to 60 machines.  But the performance will be better than on the terminal server, especially in rendering.  I also want to note that the server is unloaded - when it is used by one user is a good graphic station, which can be given to the use of department scientists for heavy rendering at a time when there are no pairs. <br><br>  In addition, the server can be used by dividing its resources in time, for example, there are two computer classes with old technology, but both need autocad.  Let some use it on the first pair, and the second on the second.  Thus, you can increase the number of workstations in two and the price of one workplace will fall below 30,000. <br><br>  You can allow students to connect to the server from your home or university library, thereby providing all the software necessary for course, practical or thesis. <br><br>  Whether to use such servers in the educational process is a moot point.  But time moves ahead and virtualization is becoming cheaper, more accessible and more stable.  In addition, such a server allows you to increase the speed of creating a computer class at times. <br><br>  One more thing - if you buy a server not with 2 video cards but from 4, then the price for the workplace will fall again. <br><br>  The question is complex and it is necessary to weigh the pros and cons and build on the specific task for what and why. <br><br>  PS Add comments - I would like to know your opinion on this issue. </li></ol></div><p>Source: <a href="https://habr.com/ru/post/358516/">https://habr.com/ru/post/358516/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../358506/index.html">AI, practical course. Project planning</a></li>
<li><a href="../358508/index.html">Check Point. A selection of useful materials from TS Solution</a></li>
<li><a href="../358510/index.html">Task life cycle</a></li>
<li><a href="../358512/index.html">Carrot models, bottlenecks and speech recognition: the absence of dictionaries in the field of artificial intelligence</a></li>
<li><a href="../358514/index.html">Release Rust 1.26</a></li>
<li><a href="../358518/index.html">VimpelCom subscribers will pay 13 rubles per month for the Spring Law</a></li>
<li><a href="../358520/index.html">Java and Linux - features of operation</a></li>
<li><a href="../358522/index.html">Go: we accelerate sampling of large tables from MySQL</a></li>
<li><a href="../358524/index.html">We will again be counted: National biometric platform and ‚Äúpass-through identifier‚Äù</a></li>
<li><a href="../358526/index.html">Number all real numbers on the interval [0,1]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>