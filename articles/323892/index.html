<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Screening on the WebRTC website from Mozilla Firefox browser</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently we wrote an article on how to make a screenshoting extension for Google Chrome browser. As a result, we created our own screenshots extension...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Screening on the WebRTC website from Mozilla Firefox browser</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/b3c/3ce/98e/b3c3ce98ee7e43ea88e1dd740239b856.jpg"></div><br>  Recently we wrote <a href="https://habrahabr.ru/post/323486/">an article</a> on how to make a screenshoting extension for Google Chrome browser.  As a result, we created our own screenshots extension, published it in the Chrome Store and tested the screen broadcast via the Web Call Server in one-to-many mode. <br><br>  In this article we will do the same with the <b>Firefox</b> browser.  The approach remains the same and will again require packaging and publication of the extension, this time in the <b>Mozilla Add-ons</b> .  As a result, we can make screencasts of video streams from FF without installing additional external software. <a name="habracut"></a><br><br><h2>  Extension code preparation for FF </h2><br>  Currently there are two ways to prepare an extension for Firefox. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <a href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Your_first_WebExtension">WebExtension</a> </li><li>  <a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Tutorials/Getting_Started_%2528jpm%2529">JPM XPI</a> </li></ul><br>  The first method allows you to prepare an extension for Firefox browsers, starting with version 45.  The second is to build an xpi file and is suitable for Firefox browsers starting with version 38. <br><br>  Mozilla threatens to declare a way of making JPM obsolete.  Nevertheless, we will describe this method, since  we had the opportunity to test it and it works.  You can also refer to the <a href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Your_first_WebExtension">WebExtension</a> documentation to build your extension in a newer way.  Most likely the process of packaging and publishing will be very similar to the one described in this article. <br><br>  Create an account (if not) on the <a href="https://accounts.firefox.com/signup">Firefox Accounts</a> site and go to <a href="https://addons.mozilla.org/en-US/firefox/">Mozilla Add-ons</a> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/05e/3cc/cb8/05e3cccb8fb54aa292174e6636734fc0.jpg"></div><br>  Download the source code of the extension, which consists of several files of configs and icons. <br><br>  <a href="https://github.com/flashphoner/flashphoner_client/tree/wcs_api-2.0/examples/demo/dependencies/screen-sharing/firefox-extension">FF extension source code</a> <br><br>  Next, open the <b>package.json</b> config and edit it for use with your own domain. <br><br>  The initial config looks like this: <br><br><pre><code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Flashphoner Screen Sharing"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"flashphoner-screen-sharing-extension"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"@flashphoner-screen-sharing-extension"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.0.4"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Enable screen sharing for flashphoner.com"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"main"</span></span>: <span class="hljs-string"><span class="hljs-string">"index.js"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: <span class="hljs-string"><span class="hljs-string">"Flashphoner"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"engines"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"firefox"</span></span>: <span class="hljs-string"><span class="hljs-string">"&gt;=38.0a1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"fennec"</span></span>: <span class="hljs-string"><span class="hljs-string">"&gt;=38.0a1"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"homepage"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://flashphoner.com"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"license"</span></span>: <span class="hljs-string"><span class="hljs-string">"MIT"</span></span> }</code> </pre> <br>  You need to enter your own data here, for example: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"My Screen Sharing Extension"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"my-screen-sharing"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"@my-screen-sharing"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.0.1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Enable screen sharing for mymegacat.com"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"main"</span></span>: <span class="hljs-string"><span class="hljs-string">"index.js"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: <span class="hljs-string"><span class="hljs-string">"Me"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"engines"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"firefox"</span></span>: <span class="hljs-string"><span class="hljs-string">"&gt;=38.0a1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"fennec"</span></span>: <span class="hljs-string"><span class="hljs-string">"&gt;=38.0a1"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"homepage"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://mymegacat.com"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"license"</span></span>: <span class="hljs-string"><span class="hljs-string">"MIT"</span></span> }</code> </pre><br>  Please note that as an example we entered the site mymegacat.com - this is the intended domain of your site, from the pages of which there will be screen broadcasts (screencasts). <br><br><h2>  Screenshots extension pack </h2><br>  Next you need to pack the extension code in the <b>.xpi</b> file.  This will help us <b>JPM</b> .  We will do packaging on Windows. <br><br><ol><li>  Download and install <b>Node.js + npm</b> from <a href="https://nodejs.org/">https://nodejs.org</a> .  Installing Node.js may require a system reboot. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/e85/7d0/e76/e857d0e76d954b378ee039292f090342.jpg"></div><br></li><li>  Make sure that NPM was installed correctly. <br><br><pre> <code class="bash hljs">npm -v</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/files/9f7/4ee/545/9f74ee5458c549d5ba9a8fbc8898a630.jpg"></div><br></li><li>  Install JPM <br><br><pre> <code class="bash hljs">npm install jpm ‚Äìglobal</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/files/8d7/5c7/dac/8d75c7dacf044bc6bc9e85b5bf3596d8.jpg"></div><br></li><li>  Check that JPM is installed <br><br><pre> <code class="bash hljs">jpm</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/files/e38/9de/040/e389de0407a34e38aafcf3a0ade54b6f.jpg"></div><br></li><li>  Create an <b>XPI file</b> using <b>JPM</b> .  To do this, go to the previously downloaded folder firefox-extension and execute the command <br><br><pre> <code class="bash hljs">jpm xpi</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/files/8c5/347/4be/8c53474beaba4a04aaa35f03f4168ff5.jpg"></div></li></ol><br>  Is done. <br><br>  As a result, we received an XPI extension file, ready for publication in the Mozilla Add-ons. <br><br><h2>  Posting extensions to Mozilla Add-ons </h2><br><ol><li>  We start by logging in to the <a href="https://addons.mozilla.org/en-US/firefox/">Mozilla Add-ons</a> and go to the Tools / Submit a New Add-on menu. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/7ed/96f/9ba/7ed96f9bacd649c28d0445dd250561dc.jpg"></div><br></li><li>  Download our XPI file. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/088/780/7dc/0887807dcd7443f79485c14f021e250a.jpg"></div><br></li><li>  After loading your extension will be validated and you can click <b>Continue</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d20/4c5/f8d/d204c5f8d4a34df59ebd62fcd0588937.jpg"></div><br></li><li>  You can manage your extensions from the <b>Tools / Manage My Submissions</b> menu. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/5e0/30e/caa/5e030ecaa33b4a9f9d17b097c4ca6535.jpg"></div></li></ol><br>  More details about the distribution and signature of your extensions can be found <a href="https://developer.mozilla.org/en-US/Add-ons/Distribution">here</a> . <br><br><h2>  Making an HTML page for screening from Firefox </h2><br>  Screencasting in Firefox works on WebRTC technology, as well as in Google Chrome.  As WebRTC, a platform broadcasting video streams captured from the screen, we will use <a href="https://flashphoner.com/">Web Call Server 5</a> and the flashphoner.js script, which represents the API for working with the server and is included in the <a href="https://flashphoner.com/wcs-web-sdk/">Web SDK</a> assembly. <br><br>  The screening code will contain: <br><br><ul><li>  screen-sharing-ff.html </li><li>  screen-sharing-ff.js </li><li>  flashphoner.js </li><li>  flashphoner_screen_sharing-0.0.9-an + fx.xpi </li></ul><br>  You need to use your XPI extension file, which was previously created using JPM. <br><br>  HTML page code is quite simple from 20 lines: <br><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Screen Sharing<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"flashphoner.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"screen-sharing-ff.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"init_page()"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Screen Sharing<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"installExtensionButton"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"installExtension()"</span></span></span><span class="hljs-tag">&gt;</span></span>Install Now <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>Capture<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"localVideo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width:320px;height:240px; border: 1px solid"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>Preview<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"remoteVideo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width:320px;height:240px; border: 1px solid"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"publishBtn"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"connectAndShareScreen()"</span></span></span><span class="hljs-tag">&gt;</span></span>Connect and share screen<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"status"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  The page uses two scripts: <b>screen-sharing-ff.js</b> and <b>flashphoner.js.</b> <br><br>  The initialization function <b>init_page ()</b> is called on the page load. <br><br>  The <b>installExtensionButton</b> button is used to quickly install an extension. <br><br>  Div - block <b>localVideo is</b> used to display video captured from the screen locally. <br><br>  Div - block <b>remoteVideo is</b> used to display the video broadcast that came from the server.  For example, if we want to leave only the player on a separate page, we can use only one Div - block <b>remoteVideo</b> .  In this example, we place the player and streamer on the same page to speed up testing. <br><br>  Finally, the <b>publishBtn</b> button starts broadcasting. <br><br>  Below is the HTML screencasting page in action in the <b>Mozilla Firefox 51.0.1</b> browser <b>.</b> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/27e/085/f4d/27e085f4d0284afb8c3bc125677bc059.png"></div><br>  Now let's turn to the <b>screen-sharing-ff.js script</b> and understand what's going on there. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> SESSION_STATUS = Flashphoner.constants.SESSION_STATUS; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> STREAM_STATUS = Flashphoner.constants.STREAM_STATUS; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> localVideo; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> remoteVideo; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init_page</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//init api try { Flashphoner.init(); } catch (e) { //can't init return; } var interval = setInterval(function() { if (Flashphoner.firefoxScreenSharingExtensionInstalled) { document.getElementById("installExtensionButton").disabled = true; clearInterval(interval); localVideo = document.getElementById("localVideo"); remoteVideo = document.getElementById("remoteVideo"); }else{ document.getElementById("installExtensionButton").disabled = false; } }, 500); } function connectAndShareScreen() { var url = "wss://wcs5-eu.flashphoner.com:8443"; console.log("Create new session with url " + url); Flashphoner.createSession({urlServer: url}).on(SESSION_STATUS.ESTABLISHED, function (session) { //session connected, start streaming startStreaming(session); }).on(SESSION_STATUS.DISCONNECTED, function () { setStatus(SESSION_STATUS.DISCONNECTED); }).on(SESSION_STATUS.FAILED, function () { setStatus(SESSION_STATUS.FAILED); }); } function startStreaming(session) { var streamName = "test123"; var constraints = { video: { width: 320, height: 240, frameRate: 10, type: "screen" } }; session.createStream({ name: streamName, display: localVideo, constraints: constraints }).on(STREAM_STATUS.PUBLISHING, function (publishStream) { setStatus(STREAM_STATUS.PUBLISHING); //play preview session.createStream({ name: streamName, display: remoteVideo }).on(STREAM_STATUS.PLAYING, function (previewStream) { //enable stop button }).on(STREAM_STATUS.STOPPED, function () { publishStream.stop(); }).on(STREAM_STATUS.FAILED, function () { //preview failed, stop publishStream if (publishStream.status() == STREAM_STATUS.PUBLISHING) { setStatus(STREAM_STATUS.FAILED); publishStream.stop(); } }).play(); }).on(STREAM_STATUS.UNPUBLISHED, function () { setStatus(STREAM_STATUS.UNPUBLISHED); //enable start button }).on(STREAM_STATUS.FAILED, function () { setStatus(STREAM_STATUS.FAILED); }).publish(); } //show connection or local stream status function setStatus(status) { var statusField = document.getElementById("status"); statusField.innerHTML = status; } //install extension function installExtension() { var params = { "Flashphoner Screen Sharing": { URL: "../../dependencies/screen-sharing/firefox-extension/flashphoner_screen_sharing-0.0.9-an+fx.xpi", IconURL: "../../dependencies/screen-sharing/firefox-extension/icon.png", Hash: "sha1:96699c6536de455cdc5c7705f5b24fae28931605", toString: function () { return this.URL; } } }; InstallTrigger.install(params); }</span></span></code> </pre><br>  The work of this script is described in detail in a <a href="https://habrahabr.ru/post/323486/">previous article</a> about screencasting from the Google Chrome browser. <br><br>  In this regard, let us focus on the differences that are specific to Firefox, and there are only three of them: <br><br><ol><li>  When we initialize, we don‚Äôt transfer anything, while for Chrome we give the extension ID.  For FF, it will be transmitted elsewhere. <br><br><pre> <code class="javascript hljs">Flashphoner.init();</code> </pre> <br></li><li>  Checking the installed extension is also a little different than in Chrome.  The <b>Flashphoner.firefoxScreenSharingExtensionInstalled</b> flag is checked. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interval = setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Flashphoner.firefoxScreenSharingExtensionInstalled</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"installExtensionButton"</span></span>).disabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; clearInterval(interval); localVideo = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"localVideo"</span></span>); remoteVideo = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"remoteVideo"</span></span>); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"installExtensionButton"</span></span>).disabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }, <span class="hljs-number"><span class="hljs-number">500</span></span>);</code> </pre><br></li><li>  The install extension code for the <b>installExtensionButton</b> button <b>is</b> different from the extension install code in Chrome and uses the XPI extension file directly, while in Chrome we put a link to the Chrome Store.  Please note that instead of <b>Flashphoner Screen Sharing</b> , the name of your extension specified earlier in <b>package.json</b> at the extension packaging stage should be indicated as the name. <br><br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">installExtension</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> params = { <span class="hljs-string"><span class="hljs-string">"Flashphoner Screen Sharing"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">URL</span></span>: <span class="hljs-string"><span class="hljs-string">"../../dependencies/screen-sharing/firefox-extension/flashphoner_screen_sharing-0.0.9-an+fx.xpi"</span></span>, <span class="hljs-attr"><span class="hljs-attr">IconURL</span></span>: <span class="hljs-string"><span class="hljs-string">"../../dependencies/screen-sharing/firefox-extension/icon.png"</span></span>, <span class="hljs-attr"><span class="hljs-attr">Hash</span></span>: <span class="hljs-string"><span class="hljs-string">"sha1:96699c6536de455cdc5c7705f5b24fae28931605"</span></span>, <span class="hljs-attr"><span class="hljs-attr">toString</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.URL; } } }; InstallTrigger.install(params); }</code> </pre></li></ol><br>  As a result, taking into account these three differences, we got a working script <b>screen-sharing-ff.js</b> , which is ready to install the extension and screencast in Firefox. <br><br><h2>  Preparing for testing WebRTC screening in FF </h2><br>  In order to start testing, you will need to upload all the scripts to your web hosting: <br><br><ul><li>  screen-sharing-ff.html </li><li>  screen-sharing-ff.js </li><li>  flashphoner.js </li><li>  flashphoner_screen_sharing-0.0.9-an + fx.xpi </li></ul><br>  Your xpi file must be used in the scripts themselves. <br><br>  Everywhere - your domain should be used on the hosting and in the scripts (remember, we indicated <b>mymegacat.com</b> when packing the extension). <br><br>  Web Call Server 5, which we use as a WebRTC platform for screen broadcasting, accepts connections using the Websockets protocol and can be installed on a separate VPS / VDS or on a single server with a website. <br><br>  To connect to the server, you need a Websocket address as follows: <br><br><pre> <code class="hljs objectivec">wss:<span class="hljs-comment"><span class="hljs-comment">//wcs5-eu.flashphoner.com:8443</span></span></code> </pre> <br>  In the <b>screen-sharing-ff.js script,</b> this address is hard coded.  This is a demo server. <br>  You can <a href="https://flashphoner.com/download">install your server</a> or <a href="https://habrahabr.ru/post/323376/">run a ready image on Amazon EC2</a> . <br><br><h2>  We test screencasting from FF and distribute the stream through the server </h2><br><ol><li>  Open the <b>screen-sharing-ff.html page</b> in Firefox browser and click the <b>Install Now</b> button, which is active until the extension is installed. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/9d3/304/9ec/9d33049ecd0c4beb8e7cf710fd7da4d6.jpg"></div><br></li><li>  Next, we confirm the installation of the extension and receive a message about the successful installation.  After that, the <b>Install Now</b> button goes off, because  our <b>screen-sharing-ff.js script</b> sees that the extension is already installed and the button is no longer necessary. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/0af/f6e/16f/0aff6e16fe01413a885cde7c98688dbf.png"></div><br></li><li>  Click the <b>Connect</b> button <b>and share screen</b> to start testing. </li></ol><br>  Firefox will ask us which window we intend to screencast, then send the video stream to the Web Call Server and display the captured stream in the localVideo block of the HTML page. <br><br>  The status <b>PUBLISHING</b> is displayed under the button - the video is captured from the screen and the video traffic goes to the server. <br><br>  After a couple of seconds, the video received from the server will start playing in the player - the <b>remoteVideo</b> unit.  This is a video that went through the server and returned to playback.  Similarly, you can play live video on other pages, thereby getting one-to-many broadcast or screencasting. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/92a/36c/ca1/92a36cca199d464a90742ab0e57c7067.jpg"></div><br><h2>  Links </h2><br>  <a href="https://habrahabr.ru/post/323486">Screening on the site from Google Chrome browser via WebRTC</a> <br>  <a href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Your_first_WebExtension">WebExtension</a> development and packaging for Firefox <br>  <a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Tutorials/Getting_Started_%2528jpm%2529">Packaging an extension for Firefox using JPM</a> <br>  <a href="https://accounts.firefox.com/signup">Firefox Accounts</a> - get an account <br>  <a href="https://addons.mozilla.org/en-US/firefox/">Mozilla Add-ons</a> - publish your extension <br>  <a href="https://github.com/flashphoner/flashphoner_client/tree/wcs_api-2.0/examples/demo/dependencies/screen-sharing/firefox-extension">JPM Expansion Source Code</a> <br>  <a href="https://nodejs.org/en/">Node.js</a> - quick installation of NPM and JPM <br>  <a href="https://developer.mozilla.org/en-US/Add-ons/Distribution">Information about the distribution and signature of extensions on the Mozilla website</a> <br>  <a href="https://flashphoner.com/">Web Call Server 5</a> - a platform for relaying video streams via WebRTC <br>  <a href="https://flashphoner.com/wcs-web-sdk/">Web SDK</a> - a set of API scripts containing flashphoner.js for working with the server <br>  <a href="https://flashphoner.com/download/">Installing WCS5 on your server</a> <br>  <a href="https://habrahabr.ru/post/323376/">Article about launching a Web Call Server image in the Amazon EC2 cloud</a> <br>  <a href="">Download the source code of the test page</a> screen-sharing-ff.html and screen-sharing-ff.js </div><p>Source: <a href="https://habr.com/ru/post/323892/">https://habr.com/ru/post/323892/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323882/index.html">Cards VS e-Wallets</a></li>
<li><a href="../323884/index.html">Timely optimization</a></li>
<li><a href="../323886/index.html">SEO without happy end</a></li>
<li><a href="../323888/index.html">MBLT17: first speakers, latest early bird tickets</a></li>
<li><a href="../323890/index.html">Open machine learning course. Topic 4. Linear classification and regression models</a></li>
<li><a href="../323896/index.html">Online tools for the simplest Pentest</a></li>
<li><a href="../323898/index.html">Blast-off. From idea to release</a></li>
<li><a href="../323900/index.html">PG Metricus - collecting metrics from plpgsql code or as three lines of code simplified life</a></li>
<li><a href="../323902/index.html">New law on online cash registers: how the service of commercial equipment changes</a></li>
<li><a href="../323904/index.html">Position-independent code (PIC) in shared libraries</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>