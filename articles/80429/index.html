<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What can be expected from Lua 5.2?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The first preview version of Lua 5.2 has been published. 
 Lua is a powerful, fast, easy, extensible and embedded scripting programming language. Luah...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What can be expected from Lua 5.2?</h1><div class="post__text post__text-html js-mediator-article"><h3>  The first preview version of Lua 5.2 has been published. </h3><br>  <a href="http://www.lua.org/">Lua</a> is a powerful, fast, easy, extensible and embedded scripting programming language.  Luah is convenient to use for writing business logic applications. <br><br>  Despite the fact that the source code of Lua is open, the development of new versions of the language is a rather closed, conservative and <a href="http://www.lua.org/versions.html">unhurried</a> process (which, in the case of the programming language, is not so bad).  Every new version of the language in the community is eagerly awaited and relishes the details leaking to the public. <br><br>  What is posted to the public is not even alpha - it's just a snapshot of the working code.  Anything can change to release. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Announcement here: <a href="http://article.gmane.org/gmane.comp.lang.lua.general/61229">http://article.gmane.org/gmane.comp.lang.lua.general/61229</a> <br><br>  Updated list of changes from the authors here: <a href="http://article.gmane.org/gmane.comp.lang.lua.general/61505">http://article.gmane.org/gmane.comp.lang.lua.general/61505</a> <br><br>  Download the source here: <a href="">http://www.lua.org/work/lua-5.2.0-work1.tar.gz</a> <br><br>  Building under Windows is here: <a href="http://article.gmane.org/gmane.comp.lang.lua.general/61528">http://article.gmane.org/gmane.comp.lang.lua.general/61528</a> <br><br>  View the source online, for example, <a href="http://github.com/xx/lua/commit/8672af5b7e90f4a5020b0f174858e1f18da00b86">here</a> . <br><br>  <b>Update:</b> Posted 5.2.0-work2, announcement <a href="http://article.gmane.org/gmane.comp.lang.lua.general/61783">here</a> . <br><a name="habracut"></a><br><h3>  What changed </h3><br>  Official information is not enough.  The list of changes is mainly taken from the analysis of diffs of the user's manual.  Details can be found there.  Changes are given in no particular order.  The list is most likely incomplete and will be updated to the best of power. <br><br><h4>  General changes </h4><ul><li>  ABI and bytecode, as expected, are incompatible with 5.1. </li><li>  Almost all features declared to be more unsupported (deprecated) in 5.1 are removed in the new version. </li><li>  Features declared deprecated in 5.2 in this version are disabled by default.  To enable them, you need to rebuild the interpreter. </li></ul><h4>  Working with Lua environments </h4><br>  This is the most controversial set of changes.  Around him in a mailing list now breaks most of the copies. <br><br><h5>  Lexical environments </h5><br>  Added "lexical environments" (lexical environments), allowing to replace for a certain piece of code a global environment to the specified table. <br><br><h5>  New loadin () function </h5><br>  A new loadin () function has been added that allows you to load code into the specified environment: <br><br><h5>  Setfenv () and getfenv () functions </h5><br>  The setfenv () and getfenv () functions are no longer supported.  Instead, it is proposed to use new lexical environments or a new loadin () function. <br><br>  For the afflicted, debug.setfenv () and debug.getfenv () are left. <br><br><h5>  Corutin no longer has separate environments. </h5><br>  All korutin in steyt have one common fixed environment. <br><br><h4>  New metamethods </h4><br><h5>  Metamethod __len works for tables and rows </h5><br>  The code for working with tables and rows now pays attention to the metamethod __len when determining the length of the data. <br><br><h5>  New metamethods __ipairs and __pairs </h5><br>  Now you can override the object traversal using ipairs and pairs. <br><br><h4>  Debug module </h4><br><h5>  The debug module is no longer loaded by default. </h5><br>  If the code uses it, you need to explicitly call require ("debug"). <br><br><h5>  New features for working with upvalue </h5><br>  Added debug.upvalueid (), debug.upvaluejoin () and their corresponding lua_upvalueid () and lua_upvaluejoin ().  (Some of them have not yet been documented.) <br><br>  Now you can get a unique identifier upvalue (you need to understand whether two upvalues ‚Äã‚Äãpoint to the same object). <br><br>  With upvaluejoin, you can have two different upvalues ‚Äã‚Äãpointing to the same object.  This should allow for serialization of functions with upvalue without patches of the Lua code. <br><br><h5>  Expanded debug information available </h5><br>  In the entry returned by debug.getinfo () and lua_getinfo (), new fields have appeared.  Now about the function in the call stack, you can find out the following: <ul><li>  whether the function was called via tail call; </li><li>  the number of upvalue functions; </li><li>  the number of function parameters; </li><li>  whether a function was declared as a function with a variable number of arguments. </li></ul><h4>  Other changes to the API Lua </h4><br><h5>  Bitlib </h5><br>  Added library for performing binary operations. <br><br><h5>  Improved character escaping in% q </h5><br>  Now string.format ("% q") escapes all control characters. <br><br><h5>  Frontier pattern </h5><br>  The% f search pattern ( <a href="http://lua-users.org/wiki/FrontierPattern">"frontier pattern"</a> ) is now documented. <br><br><h5>  Changed ipairs () behavior </h5><br>  Now, when determining the length of the table, ipairs () follows the general rules (before, the crawl of tables was carried out strictly before the first hole). <br><br><h5>  Negative numbers in select () </h5><br>  Now select () - you can pass a negative number as the number of the first argument of the sample - the corresponding number of arguments will be returned from the end (in direct order). <br><br><h5>  math.log10 () is no longer supported </h5><br>  Now in math.log () you can specify the base of the logarithm. <br><br><h5>  The table.maxn () function is no longer supported. </h5><br>  If you really need it, write it yourself. <br><br><h5>  Functions table.unpack () and table.pack () </h5><br>  The unpack () function has been moved to the table module.  A new table.pack () function has been added to it, which saves the arguments to a new table (the number of arguments is stored in the ‚Äún‚Äù field in this table). <br><br><h5>  Filtering by chunk type in load () </h5><br>  The load () functions can now be prohibited from loading bytecode or text sources. <br><br>  This is useful because, unlike text, loading bytecode from untrusted sources is not recommended.  Lua 5.2 no longer tries to validate the correctness of the bytecode being loaded. <br><br><h5>  package.config is now documented </h5><br>  Now from Lua, the compile-time settings for the module system are officially available: <ul><li>  directory separator in transit; </li><li>  path separator in the search pattern; </li><li>  the symbol to indicate the substitution points in the pattern; </li><li>  the symbol for substituting the path to the executable file in which the script runs (for Windows); </li><li>  the boundary symbol of the meaningful part of the file name for constructing the name of the function luaopen_ * when opening a module. </li></ul><h5>  Added package.searchpath () function </h5><br>  The function used to search for files in a given set of paths.  (Same as used in require.) <br><br><h5>  Arguments in xpcall () </h5><br>  Now in xpcall () you can set the arguments for the called function, similarly to pcall (). <br><br><h5>  Checking arguments in os.date () </h5><br>  The os.date () function now checks the format string passed to it in order to protect itself from falling implementations of strftime (). <br><br><h5>  Improved payp support </h5><br>  If the file was opened using io.popen (), file: close () will return the exit code of the corresponding process. <br><br><h5>  Improved file: write () interface </h5><br>  Now file: write () returns a file, which allows you to make a chain of calls. <br><br><h4>  Garbage collector </h4><br><h5>  Emergency GC </h5><br>  Lua forces full garbage collection if he cannot allocate memory. <br><br><h5>  Ephemeral tables </h5><br>  The garbage collector now correctly handles circular references between keys and values ‚Äã‚Äãin tables with weak keys. <br><br><h5>  Adjusted behavior of incremental garbage collector </h5><br>  Attempting to perform the garbage collection step no longer restarts the garbage collector if it has been stopped. <br><br><h5>  Is GC stopped? </h5><br>  Now you can see if GC is stopped.  In Lua: collectgarbage ("isrunning"), in C: lua_gc (LUA_GCISRUNNING). <br><br><h4>  Other language changes </h4><br><h5>  Working with locale </h5><br>  The definition of the type of the character (ctype) at compilation is now fully carried out according to the internal fixed tables that do not depend on the current locale. <br><br>  Identifiers can use only locale-independent characters. <br><br><h5>  Hex codes in string literals </h5><br>  Now you can write in lines, for example, \ xFF (before - only \ 255). <br><br><h5>  Simplified Constant Folding </h5><br>  In order to avoid problems with floating-point numbers, the compiler no longer does constant folding for division operators and deriving the remainder of division. <br><br><h5>  Improved support for non-string error messages </h5><br>  If an error handler in the interpreter comes instead of a string - an error message is an object, it tries to call the __tostring metamethod before displaying an error on the screen. <br><br><h4>  Working with C API environments </h4><br><h5>  New fields in the registry </h5><br>  In the registry (registry, a special table that is available only to a shared code), there are predefined fields that are available with the following integer keys: <ul><li>  <b>LUA_RIDX_MAINTHREAD</b> - the main cortina of the current state (implicitly created with it); </li><li>  <b>LUA_RIDX_GLOBALS</b> - global environment of the loosh code (table); </li><li>  <b>LUA_RIDX_CPCALL</b> is a cpcall () function to call sish functions that work with Lua without creating closures for them (i.e., for "non-signed functions").  The lua_cpcall () function has been removed from the API. </li></ul><h5>  Removed pseudo-index LUA_GLOBALSINDEX </h5><br>  If the environment of the function has not been changed, you can use LUA_ENVIRONINDEX instead.  Otherwise, you need to get a global environment from the registry. <br><br><h5>  Changed the logic of the macros lua_getglobal (), lua_setglobal (), and lua_register () </h5><br>  They now work with the environment of functions instead of the global environment of the state.  This is more consistent with how Lua works with global variables. <br><br><h4>  Other changes to the Lua C API </h4><br><h5>  Renamed luaL_typerror () function </h5><br>  Now it is called luaL_typeerror (). <br><br><h5>  Added lua_compare () function </h5><br>  It should be used instead of the no longer supported lua_equal () and lua_lessthan (). <br><br><h5>  lua_arith () </h5><br>  The new function lua_arith () allows to perform arithmetic operations with C values ‚Äã‚Äãfrom C according to the rules of Lua (taking into account metamethods, etc.). <br><br><h5>  Determination of object length </h5><br>  The lua_objlen () function has been renamed.  Now it is called lua_rawlen ().  Added function lua_len (), which knows about the metamethod __len in tables. <br><br><h5>  Improved lua_checkstack () function </h5><br>  Now it is guaranteed that it cannot cause a memory allocation error. <br><br><h5>  Improved lua_pushstring () and lua_pushlstring () functions </h5><br>  Now they return a pointer to the internal copy of the string. <br><br><h5>  lua_copy () </h5><br>  The new lua_copy () function allows you to copy values ‚Äã‚Äãon the loash data stack from one slot to another (with the old value in the other slot being replaced with the one being copied). <br><br><h5>  Runtime version check </h5><br>  Now you can check runtime versions of Lua using the new functions lua_version () and luaL_checkversion (). <br><br>  Moreover, since these functions return pointers, you can check that the loash state and the code currently running are in the same address space.  This allows you to catch the <a href="http://lua-users.org/lists/lua-l/2008-01/msg00699.html">situation</a> when Lua several times linked with the application. <br><br>  The luaL_checkversion () function performs this check automatically.  This function is called by luaL_register (), so now runtime compliance will be checked automatically when each module is connected. <br><br><h5>  luaL_testudata () </h5><br>  Added new function luaL_testudata () for the userdata test for belonging to this type.  (Previously, only validation via luaL_checkudata () was available, which caused an error when passing the wrong type of userdata.) <br><br><h5>  luaL_traceback () </h5><br>  The new luaL_traceback () function to make C-frames from C, like debug.traceback () in Lua. <br><br><h5>  luaL_tolstring () </h5><br>  The luaL_tolstring () function is now documented.  It allows you to convert luash values ‚Äã‚Äãsimilarly to the tostring () function in Lua.  Implementing your own print () is now easier than ever! <br><br><h5>  Support for yield across the lua-c border </h5><br>  Added new API methods that allow you to write C code through which you could yield to yield in Lua: <ul><li>  lua_yieldk () </li><li>  lua_callk () </li><li>  lua_pcallk () </li><li>  lua_getctx () </li></ul>  An example of usage can be seen, for example, <a href="">in the new implementation of the table.foreach () function</a> (which for some reason still lives in the source code, although it was declared deprecated in 5.1). <br><br>  These methods are quite widely used in the Lua 5.2 implementation itself, so now it will be possible to make a yield through metamethods, iterators for the for loop, and the functions pcall () and xpcall ()! <br><br><h5>  New error code LUA_ERRGCMM </h5><br>  A new error code, LUA_ERRGCMM, appeared, indicating that an error occurred while executing the metamethod __gc during garbage collection.  (For obvious reasons, it usually does not relate to the code indicated by the glass trace.) <br><br>  For symmetry, the ‚Äúerror‚Äù code LUA_OK has also been added, meaning that the call was made successfully. <br><br><h5>  Improved loading of dynamic libraries under the Nix </h5><br>  Now loadlib works correctly with libraries with global symbols (using RTLD_GLOBAL). <br><br><h4>  Changes in implementation </h4><br><h5>  Increased maximum number of constants per function (chunk) </h5><br>  Now there can be up to 2 <sup>26</sup> constants in one chunk (it used to be up to 2 <sup>18</sup> ).  Exceeding this limit causes the ‚Äúconstant table overflow‚Äù compile time error. <br><br>  Now you can save even more monstrous data in the form of table designers, without worrying about splitting the generated code into separate functions. <br><br><h5>  Parser optimized </h5><br>  The parser now eats away much smaller sishny stack due to the rejection of the use of automatic arrays (auto arrays). <br><br><h5>  New hash function for floating point numbers </h5><br>  Now, hashing is performed correctly regardless of the size of lua_Number (earlier on some 64-bit platforms there were problems if you redefine lua_Number in long double). <br><br><h3>  Known issues in current snapshot </h3><ul><li>  luac is still not working properly, in particular, the bytecode disassembler is broken; </li><li>  the code is not compiled under Windows due to a conflict with the name of the LoadString function and problems with the macro lua_number2uint () (unofficial patches are published in the mailing list); </li><li>  the code is not yet compiled as C ++; </li><li>  in luaconf.h, the default is the old LUA_CPATH with "5.1" in the path; </li><li>  package.searchpath () does not yet know anything about the dots in the module name; </li><li>  the documentation is still in some kind of confusion, so it‚Äôs not clear for all new functions whether they will be official or remain undocumented. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/80429/">https://habr.com/ru/post/80429/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../80421/index.html">Acer recalls 22 thousand netbooks</a></li>
<li><a href="../80422/index.html">Palm Pre Plus and Palm Pixi Plus - another attempt to catch up with the iPhone</a></li>
<li><a href="../80423/index.html">Moscow.pm 2009 => 2010</a></li>
<li><a href="../80425/index.html">Does Google's Nexus One Cost $ 174.15?</a></li>
<li><a href="../80428/index.html">Sennheiser HD 238 Precision Headphones Overview</a></li>
<li><a href="../80430/index.html">Regular expressions. Collection of recipes</a></li>
<li><a href="../80431/index.html">DumPHPer - Advanced PHP var dumper or var_dump replacement</a></li>
<li><a href="../80432/index.html">Magic Tasks - we solve unplanned tasks on a par with planned ones</a></li>
<li><a href="../80434/index.html">Nuances of using the jQuery.LocalScroll plugin in conjunction with the ‚Äú: target‚Äù CSS selector</a></li>
<li><a href="../80436/index.html">Microsoft Slate - the exact opposite of Apple tablet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>