<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Photo Widget DIY</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear habrasoobschestvo. My previous article about the custom unlock screen received few reviews in the form of comments, but nevertheless a hun...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Photo Widget DIY</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/366/85c/c6c/36685cc6c5ac4274896ded48eb2d95cc.png"><br><br>  Hello, dear habrasoobschestvo.  My previous article about the <a href="http://habrahabr.ru/post/220689/">custom unlock screen</a> received few reviews in the form of comments, but nevertheless a hundred people kept it in their favorites, thus inspiring me to write another article on an unpopular topic. <br><br>  Many Xperia smartphone users like the beautiful 3D standard photo widget.  In terms of terminology android, this is not an AppWidget, but a simple View, very similar to a widget.  It can be called a ‚Äúplug-in‚Äù to the standard Xperia Home launcher, so it‚Äôs not in the list of widgets of other launchers.  In this post I will tell you how to make a similar widget. <br><a name="habracut"></a><br><h4>  Introduction </h4><br>  Imagine the situation as if you wrote your own launcher for android with widget support (perhaps in the next article I will briefly describe how to do this).  A three-dimensional photo widget will make your launcher stand out from the rest.  As is the case with the standard Xperia photo widget, our widget is a custom View, launched in the process of our launcher. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Widget base </h4><br>  The first step is to make ours appear in the list of available widgets (remember, not the widget).  Sony Ericsson acted simply - the standard launcher from the list of installed packages in the system chooses those that start with ‚Äúcom.sonyericsson.advancedwidget‚Äù and adds the name and icon to the list of widgets.  This method is simple, but it has a flaw: one apk - one widget.  We will act smarter (I hope) - in the manifesto of our future widget we will write this: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">receiver</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".PhotoWidgetReceiver"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"by.arriva.ADVANCED_WIDGET"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">receiver</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Leave the PhotoWidgetReceiver class empty: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PhotoWidgetReceiver</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BroadcastReceiver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre><br>  Thanks to this trick, our launcher will find all BroadcastRecievers that respond to ‚Äúby.arriva.ADVANCED_WIDGET‚Äù.  The following is a listing of code from the launcher. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> PackageManager manager = getPackageManager(); Intent i = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(<span class="hljs-string"><span class="hljs-string">"by.arriva.ADVANCED_WIDGET"</span></span>); List&lt;ResolveInfo&gt; lri = manager.queryBroadcastReceivers(i, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(ResolveInfo ri : lri){ String packageName = ri.activityInfo.packageName; String className = ri.activityInfo.name; className = className.replace(<span class="hljs-string"><span class="hljs-string">"Receiver"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); AdvancedWidgetInfo awi = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AdvancedWidgetInfo(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, packageName, className); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!awi.isValid) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { WidgetInfo wi = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WidgetInfo(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, awi.label, awi.width+<span class="hljs-string"><span class="hljs-string">" x "</span></span>+awi.height, manager.getResourcesForApplication(packageName).getDrawable(awi.preview), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ComponentName(packageName, className)); widgetsSorted.add(wi); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) {} awi = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } lri.clear();</code> </pre><br>  String className - the name of the class inherited from BroadcastReciever, in this case, PhotoWidgetReceiver.  The launcher looks for the PhotoWidget class in the widget, which contains the widget description.  Here is its content: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PhotoWidget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> View </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span></span>{ WidgetView wv = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WidgetView(context); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> wv; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCellWidth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCellHeight</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLabel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context.getString(R.string.app_name); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIconId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> R.drawable.icon; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPreviewId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> R.drawable.preview; } }</code> </pre><br>  The structure of this class should be strictly constant in all your non-standard (advanced) widgets, since  the same structure of methods and in class launcher AdvancedWidgetInfo. <br><br><h4>  Directly View </h4><br><div class="spoiler">  <b class="spoiler_title">The main class of our widget</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WidgetView</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class"> </span></span>{ ContentObserver observer; GestureDetector gd; Scroller scroller; NinePatchDrawable frame; Bitmap loading; Bitmap broken; Item[] items = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> touchLastY = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> touchDownY = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> touchTap = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> touchScroll = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> loaderId = -<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> getScrollY = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> width = <span class="hljs-number"><span class="hljs-number">160</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> height = <span class="hljs-number"><span class="hljs-number">200</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WidgetView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context); gd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GestureDetector(context, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GestureListener()); scroller = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Scroller(context); observer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ContentObserver(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Handler()){ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> selfChange)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onChange(selfChange); loadThumbnails(); } }; frame = (NinePatchDrawable)getResources().getDrawable(R.drawable.frame); loading = getBmp(R.drawable.loading); broken = getBmp(R.drawable.broken); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAttachedToWindow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onAttachedToWindow(); loadThumbnails(); getContext().getContentResolver().registerContentObserver(MediaStore.Images.Media.EXTERNAL_CONTENT_URI, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, observer); getContext().getContentResolver().registerContentObserver(MediaStore.Video.Media.EXTERNAL_CONTENT_URI, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, observer); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDetachedFromWindow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onDetachedFromWindow(); getContext().getContentResolver().unregisterContentObserver(observer); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDraw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Canvas canvas)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onDraw(canvas); Paint p = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Paint(); p.setDither(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); p.setFilterBitmap(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pos = getSelected(); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> percent = getSelectedPercent(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(items != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(items.length == <span class="hljs-number"><span class="hljs-number">0</span></span>){ Bitmap camera = getBmp(R.drawable.camera); Transformation transform = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Transformation(<span class="hljs-number"><span class="hljs-number">0</span></span>, percent, <span class="hljs-number"><span class="hljs-number">160</span></span>, <span class="hljs-number"><span class="hljs-number">140</span></span>); p.setAlpha(transform.alpha); canvas.drawBitmap(camera, transform.matrix3d, p); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(pos &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(items[pos-<span class="hljs-number"><span class="hljs-number">1</span></span>] != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(items[pos-<span class="hljs-number"><span class="hljs-number">1</span></span>].thumbnail != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ Bitmap thumbnail = items[pos-<span class="hljs-number"><span class="hljs-number">1</span></span>].thumbnail; Transformation transform = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Transformation(-<span class="hljs-number"><span class="hljs-number">1</span></span>, percent, thumbnail.getWidth(), thumbnail.getHeight()); p.setAlpha(transform.alpha); canvas.drawBitmap(thumbnail, transform.matrix3d, p); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Transformation transform = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Transformation(-<span class="hljs-number"><span class="hljs-number">1</span></span>, percent, broken.getWidth(), broken.getHeight()); p.setAlpha(transform.alpha); canvas.drawBitmap(broken, transform.matrix3d, p); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Transformation transform = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Transformation(-<span class="hljs-number"><span class="hljs-number">1</span></span>, percent, loading.getWidth(), loading.getHeight()); p.setAlpha(transform.alpha); canvas.drawBitmap(loading, transform.matrix3d, p); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(items.length-<span class="hljs-number"><span class="hljs-number">1</span></span> &gt;= pos+<span class="hljs-number"><span class="hljs-number">1</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(items[pos+<span class="hljs-number"><span class="hljs-number">1</span></span>] != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(items[pos+<span class="hljs-number"><span class="hljs-number">1</span></span>].thumbnail != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ Bitmap thumbnail = items[pos+<span class="hljs-number"><span class="hljs-number">1</span></span>].thumbnail; Transformation transform = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Transformation(<span class="hljs-number"><span class="hljs-number">1</span></span>, percent, thumbnail.getWidth(), thumbnail.getHeight()); p.setAlpha(transform.alpha); canvas.drawBitmap(thumbnail, transform.matrix3d, p); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Transformation transform = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Transformation(<span class="hljs-number"><span class="hljs-number">1</span></span>, percent, broken.getWidth(), broken.getHeight()); p.setAlpha(transform.alpha); canvas.drawBitmap(broken, transform.matrix3d, p); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Transformation transform = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Transformation(<span class="hljs-number"><span class="hljs-number">1</span></span>, percent, loading.getWidth(), loading.getHeight()); p.setAlpha(transform.alpha); canvas.drawBitmap(loading, transform.matrix3d, p); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(items.length-<span class="hljs-number"><span class="hljs-number">1</span></span> &gt;= pos){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(items[pos] != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(items[pos].thumbnail != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ Bitmap thumbnail = items[pos].thumbnail; Transformation transform = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Transformation(<span class="hljs-number"><span class="hljs-number">0</span></span>, percent, thumbnail.getWidth(), thumbnail.getHeight()); p.setAlpha(transform.alpha); canvas.drawBitmap(thumbnail, transform.matrix3d, p); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Transformation transform = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Transformation(<span class="hljs-number"><span class="hljs-number">0</span></span>, percent, broken.getWidth(), broken.getHeight()); p.setAlpha(transform.alpha); canvas.drawBitmap(broken, transform.matrix3d, p); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Transformation transform = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Transformation(<span class="hljs-number"><span class="hljs-number">0</span></span>, percent, loading.getWidth(), loading.getHeight()); p.setAlpha(transform.alpha); canvas.drawBitmap(loading, transform.matrix3d, p); } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Transformation transform = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Transformation(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, loading.getWidth(), loading.getHeight()); canvas.drawBitmap(loading, transform.matrix3d, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTouchEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MotionEvent me)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(items == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; gd.onTouchEvent(me); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> touchY = me.getY(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(me.getAction() == MotionEvent.ACTION_DOWN){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!scroller.isFinished()){ scroller.abortAnimation(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { touchTap = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; touchScroll = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } touchDownY = touchLastY = touchY; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(me.getAction() == MotionEvent.ACTION_MOVE){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Math.abs(touchY - touchDownY) &gt; ViewConfiguration.getTouchSlop() || touchScroll){ getParent().requestDisallowInterceptTouchEvent(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); touchTap = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; touchScroll = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; getScrollY += -(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(touchY - touchLastY); computeOverscroll(); } touchLastY = touchY; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((me.getAction() == MotionEvent.ACTION_UP || me.getAction() == MotionEvent.ACTION_CANCEL) &amp;&amp; scroller.isFinished()){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(touchTap &amp;&amp; me.getAction() == MotionEvent.ACTION_UP){ tap(); } setSelected(getSelected(), <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); getParent().requestDisallowInterceptTouchEvent(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">computeScroll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(scroller.computeScrollOffset()){ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> oldY = getScrollY; getScrollY = scroller.getCurrY(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(oldY != getScrollY){ onScrollChanged(<span class="hljs-number"><span class="hljs-number">0</span></span>, getScrollY, <span class="hljs-number"><span class="hljs-number">0</span></span>, oldY); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(scroller.getFinalY() == getScrollY){ scroller.abortAnimation(); setSelected(getSelected(), <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } postInvalidate(); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMeasure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> wms, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hms)</span></span></span></span>{ width = MeasureSpec.getSize(wms); height = MeasureSpec.getSize(hms); <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onMeasure(wms, hms); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSizeChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> w, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> h, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> oldw, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> oldh)</span></span></span></span>{ width = w; height = h; <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onSizeChanged(w, h, oldw, oldh); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadThumbnails</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ items = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; getScrollY = <span class="hljs-number"><span class="hljs-number">0</span></span>; invalidate(); Thread loader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thread(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Runnable() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> currentId = Thread.currentThread().getId(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ArrayList&lt;MediaItem&gt; list = mediaList(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(list == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || loaderId != currentId) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; items = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Item[list.size()]; postInvalidate(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;list.size(); i++){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(items == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || loaderId != currentId) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; items[i] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Item(list.get(i).path, getBmp(list.get(i)), list.get(i).type); postInvalidate(); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(Exception e){} } }); loaderId = loader.getId(); loader.start(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSelected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Math.round(getScrollY/<span class="hljs-number"><span class="hljs-number">140f</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSelectedPercent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> f = getScrollY/<span class="hljs-number"><span class="hljs-number">140f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f-getSelected(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setSelected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pos, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> anim)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(anim &amp;&amp; getScrollY!=pos*<span class="hljs-number"><span class="hljs-number">140</span></span>){ scroller.startScroll(<span class="hljs-number"><span class="hljs-number">0</span></span>, getScrollY, <span class="hljs-number"><span class="hljs-number">0</span></span>, pos*<span class="hljs-number"><span class="hljs-number">140</span></span>-getScrollY, <span class="hljs-number"><span class="hljs-number">250</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { getScrollY = pos*<span class="hljs-number"><span class="hljs-number">140</span></span>; } invalidate(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">computeOverscroll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(getScrollY &lt; -<span class="hljs-number"><span class="hljs-number">50</span></span>){ getScrollY = -<span class="hljs-number"><span class="hljs-number">50</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(getScrollY &gt; Math.max(items.length-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)*<span class="hljs-number"><span class="hljs-number">140</span></span>+<span class="hljs-number"><span class="hljs-number">50</span></span>){ getScrollY = Math.max(items.length-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)*<span class="hljs-number"><span class="hljs-number">140</span></span>+<span class="hljs-number"><span class="hljs-number">50</span></span>; } invalidate(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(items != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(items.length == <span class="hljs-number"><span class="hljs-number">0</span></span>){ Intent i = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(<span class="hljs-string"><span class="hljs-string">"android.media.action.IMAGE_CAPTURE"</span></span>); i.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK); getContext().startActivity(i); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(items[getSelected()] == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> type = items[getSelected()].type; String path = items[getSelected()].path; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(type == <span class="hljs-number"><span class="hljs-number">1</span></span>){ Intent view = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(android.content.Intent.ACTION_VIEW); File imageFile = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(path); view.setDataAndType(Uri.fromFile(imageFile), <span class="hljs-string"><span class="hljs-string">"image/*"</span></span>); view.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK); getContext().startActivity(view); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(type == <span class="hljs-number"><span class="hljs-number">2</span></span>){ Intent view = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(android.content.Intent.ACTION_VIEW); File imageFile = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(path); view.setDataAndType(Uri.fromFile(imageFile), <span class="hljs-string"><span class="hljs-string">"video/*"</span></span>); view.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK); getContext().startActivity(view); } } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(Exception e){} } <span class="hljs-function"><span class="hljs-function">ArrayList&lt;MediaItem&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mediaList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ ArrayList&lt;MediaItem&gt; list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;MediaItem&gt;(); Cursor c = getContext().getContentResolver().query(MediaStore.Images.Media.EXTERNAL_CONTENT_URI, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{MediaStore.Images.Media.DATA, MediaStore.Images.Media.DATE_ADDED}, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(c.moveToFirst()){ <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>{ list.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MediaItem(c.getString(c.getColumnIndexOrThrow(MediaStore.Images.Media.DATA)), c.getString(c.getColumnIndexOrThrow(MediaStore.Images.Media.DATE_ADDED)), <span class="hljs-number"><span class="hljs-number">1</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(c.moveToNext()); } c.close(); c = getContext().getContentResolver().query(MediaStore.Video.Media.EXTERNAL_CONTENT_URI, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{MediaStore.Video.Media.DATA, MediaStore.Video.Media.DATE_ADDED}, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(c.moveToFirst()){ <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>{ list.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MediaItem(c.getString(c.getColumnIndexOrThrow(MediaStore.Video.Media.DATA)), c.getString(c.getColumnIndexOrThrow(MediaStore.Video.Media.DATE_ADDED)), <span class="hljs-number"><span class="hljs-number">2</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(c.moveToNext()); } c.close(); Collections.sort(list, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Comparator&lt;MediaItem&gt;(){ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compare</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MediaItem mi1, MediaItem mi2)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mi1.date.compareToIgnoreCase(mi2.date); } }); Collections.reverse(list); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(Exception e){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;MediaItem&gt;(); } } <span class="hljs-function"><span class="hljs-function">Bitmap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBmp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MediaItem mi)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ Paint p = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Paint(); p.setDither(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); p.setFilterBitmap(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(mi.type == <span class="hljs-number"><span class="hljs-number">1</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rot = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ ExifInterface rote = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ExifInterface(mi.path); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> r = rote.getAttributeInt(ExifInterface.TAG_ORIENTATION, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r == <span class="hljs-number"><span class="hljs-number">3</span></span>){ rot = <span class="hljs-number"><span class="hljs-number">180</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r == <span class="hljs-number"><span class="hljs-number">8</span></span>){ rot = <span class="hljs-number"><span class="hljs-number">270</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r == <span class="hljs-number"><span class="hljs-number">6</span></span>){ rot = <span class="hljs-number"><span class="hljs-number">90</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { rot = <span class="hljs-number"><span class="hljs-number">0</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(Exception e){} BitmapFactory.Options bfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BitmapFactory.Options(); bfo.inJustDecodeBounds = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; BitmapFactory.decodeFile(mi.path, bfo); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rot == <span class="hljs-number"><span class="hljs-number">90</span></span> || rot == <span class="hljs-number"><span class="hljs-number">270</span></span>){ bfo.inSampleSize = Math.min(bfo.outWidth/<span class="hljs-number"><span class="hljs-number">140</span></span>, bfo.outHeight/<span class="hljs-number"><span class="hljs-number">120</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { bfo.inSampleSize = Math.max(bfo.outWidth/<span class="hljs-number"><span class="hljs-number">140</span></span>, bfo.outHeight/<span class="hljs-number"><span class="hljs-number">120</span></span>); } bfo.inJustDecodeBounds = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; Bitmap src = BitmapFactory.decodeFile(mi.path, bfo); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rot != <span class="hljs-number"><span class="hljs-number">0</span></span>){ Matrix m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Matrix(); m.postRotate(rot); src = Bitmap.createBitmap(src, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, src.getWidth(), src.getHeight(), m, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> aspect = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)src.getWidth()/src.getHeight(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> image_w = <span class="hljs-number"><span class="hljs-number">160</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> image_h = <span class="hljs-number"><span class="hljs-number">140</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(aspect &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>){ image_h = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)((image_w-<span class="hljs-number"><span class="hljs-number">20</span></span>)/aspect+<span class="hljs-number"><span class="hljs-number">20</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { image_w = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)((image_h-<span class="hljs-number"><span class="hljs-number">20</span></span>)*aspect+<span class="hljs-number"><span class="hljs-number">20</span></span>); } Bitmap result = Bitmap.createBitmap(image_w, image_h, Config.ARGB_8888); Canvas c = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Canvas(result); frame.setBounds(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, image_w, image_h); frame.draw(c); c.drawBitmap(src, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RectF(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, image_w-<span class="hljs-number"><span class="hljs-number">10</span></span>, image_h-<span class="hljs-number"><span class="hljs-number">10</span></span>), p); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(mi.type == <span class="hljs-number"><span class="hljs-number">2</span></span>){ Bitmap src = ThumbnailUtils.createVideoThumbnail(mi.path, MediaStore.Video.Thumbnails.MINI_KIND); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> aspect = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)src.getWidth()/src.getHeight(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> image_w = <span class="hljs-number"><span class="hljs-number">160</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> image_h = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)((image_w-<span class="hljs-number"><span class="hljs-number">20</span></span>)/aspect+<span class="hljs-number"><span class="hljs-number">20</span></span>); Bitmap result = Bitmap.createBitmap(image_w, image_h, Config.ARGB_8888); Canvas c = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Canvas(result); frame.setBounds(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, image_w, image_h); frame.draw(c); c.drawBitmap(src, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RectF(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, image_w-<span class="hljs-number"><span class="hljs-number">10</span></span>, image_h-<span class="hljs-number"><span class="hljs-number">10</span></span>), p); c.drawBitmap(BitmapFactory.decodeResource(getResources(), R.drawable.video), (image_w-<span class="hljs-number"><span class="hljs-number">64</span></span>)/<span class="hljs-number"><span class="hljs-number">2</span></span>, (image_h-<span class="hljs-number"><span class="hljs-number">64</span></span>)/<span class="hljs-number"><span class="hljs-number">2</span></span>, p); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(Exception e){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(OutOfMemoryError e){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-function"><span class="hljs-function">Bitmap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBmp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> res)</span></span></span></span>{ Bitmap bmp = Bitmap.createBitmap(<span class="hljs-number"><span class="hljs-number">160</span></span>, <span class="hljs-number"><span class="hljs-number">140</span></span>, Config.ARGB_8888); Canvas c = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Canvas(bmp); Paint p = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Paint(); p.setDither(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); p.setFilterBitmap(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); frame.setBounds(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">160</span></span>, <span class="hljs-number"><span class="hljs-number">140</span></span>); frame.draw(c); c.drawBitmap(BitmapFactory.decodeResource(getResources(), res), <span class="hljs-number"><span class="hljs-number">48</span></span>, <span class="hljs-number"><span class="hljs-number">38</span></span>, p); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bmp; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MediaItem</span></span></span><span class="hljs-class"> </span></span>{ String path; String date; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> type; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MediaItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str1, String str2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i)</span></span></span></span>{ path = str1; date = str2; type = i; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Item</span></span></span><span class="hljs-class"> </span></span>{ String path; Bitmap thumbnail; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> type; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Item</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str, Bitmap bmp, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i)</span></span></span></span>{ path = str; thumbnail = bmp; type = i; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Transformation</span></span></span><span class="hljs-class"> </span></span>{ Matrix matrix3d; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> alpha; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Transformation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pos, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> percent, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> imageWidth, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> imageHeight)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> centerX = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)width/<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> centerY = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)height/<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> f = -pos + percent; centerY -= (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)Math.sin(f*Math.PI/<span class="hljs-number"><span class="hljs-number">2</span></span>)*<span class="hljs-number"><span class="hljs-number">40</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> f1 = Math.abs(f) - <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(f1 &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) f1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> f2 = Math.abs(f) / <span class="hljs-number"><span class="hljs-number">1.5f</span></span>; alpha = <span class="hljs-number"><span class="hljs-number">255</span></span> - (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(<span class="hljs-number"><span class="hljs-number">255</span></span>*f1); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> scale = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-number"><span class="hljs-number">0.4</span></span>*f2); Camera c = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Camera(); matrix3d = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Matrix(); c.save(); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rotate = percent*<span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(pos == <span class="hljs-number"><span class="hljs-number">0</span></span>) rotate *= -<span class="hljs-number"><span class="hljs-number">1</span></span>; c.rotateX(rotate); c.getMatrix(matrix3d); matrix3d.preTranslate(-imageWidth/<span class="hljs-number"><span class="hljs-number">2</span></span>, -imageHeight/<span class="hljs-number"><span class="hljs-number">2</span></span>); matrix3d.postScale(scale, scale); matrix3d.postTranslate(centerX, centerY); c.restore(); } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GestureListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GestureDetector</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleOnGestureListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onFling</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MotionEvent me1, MotionEvent me2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> vX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> vY)</span></span></span></span>{ scroller.fling(<span class="hljs-number"><span class="hljs-number">0</span></span>, getScrollY, <span class="hljs-number"><span class="hljs-number">0</span></span>, -(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)vY, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, -<span class="hljs-number"><span class="hljs-number">50</span></span>, Math.max(items.length-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)*<span class="hljs-number"><span class="hljs-number">140</span></span>+<span class="hljs-number"><span class="hljs-number">50</span></span>); invalidate(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } }</code> </pre><br></div></div><br>  A bit of explanation: <br><br>  ContentObserver logs all changes in external memory.  For example, when adding a photo, the onChange method (boolean selfChange) is called several times at intervals of a couple of milliseconds.  The loadThumbnails () method loads thumbnails of all photos in a separate stream.  Each time the onChange ContentObserver method is triggered, a new stream is created to create thumbnails.  There is a situation when adding one photo immediately creates several threads at the same time, doing the same actions.  In order to avoid this situation, the loaderId variable stores the id of the last created stream, and all the streams have a comparison of the saved id and id of this stream.  If the numbers are not equal, the stream is destroyed. <br><br>  Paging and throwing gestures do not cause movement of the View canvas, as is customary.  Instead, the variable getScrollY is changed.  Integer getSelected () returns the current position in the thumbnail array, float getSelectedPercent () returns the angle of the thumbnails relative to the viewer.  A value of 0.5 corresponds to 45 degrees.  Perhaps the following picture will clarify the situation: <br><br><img src="https://habrastorage.org/files/4e0/f72/4a4/4e0f724a4a984cd080c393d3ac9f8390.PNG"><br><br>  In the onTouchEvent (MotionEvent me) method, it is important not to forget to call getParent (). RequestDisallowInterceptTouchEvent (true) so that during the thumbnails browsing in the widget, the tables in the launcher do not scroll. <br><br>  Well, at the end a few words about the Transformation class.  It returns a transformation matrix for thumbnails, depending on what the above described getSelected () and getSelectedPercent () return. <br><br>  It should also be noted that the thumbnails of all images and videos are stored in the Item [] array.  This is bad.  Thumbnail caching is a good option. <br><br><h4>  Conclusion </h4><br>  So I briefly explained how you can make a cute photo thumbnail viewer.  I am very surprised that such beautiful three-dimensional effects of paging images do not slow down on my ancient Samsung Galaxy Gio phone.  You can see this in the video: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/flBFCyNCBCs%3Ffeature%3Doembed&amp;xid=25657,15700023,15700186,15700190,15700253&amp;usg=ALkJrhiNiV9QWhc6cXiUj_qWPfizqRO0Fw" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/232477/">https://habr.com/ru/post/232477/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../232463/index.html">Comparison of audio recognition algorithms for Second Screen</a></li>
<li><a href="../232469/index.html">Saxophone first printed on a 3D printer</a></li>
<li><a href="../232471/index.html">Linguistic riddle. We translate from the "dead" language. [¬ß2] Debriefing</a></li>
<li><a href="../232473/index.html">Electric car SunSwift eVe traveled 500 kilometers in 4 hours and 40 minutes</a></li>
<li><a href="../232475/index.html">How i played bank</a></li>
<li><a href="../232479/index.html">Update for Windows Phone 8.1: improved folders, new features and more</a></li>
<li><a href="../232481/index.html">"Cassini" received a picture of "the eyes of Saturn"</a></li>
<li><a href="../232483/index.html">How we made the educational platform: first design, landing page and logo</a></li>
<li><a href="../232485/index.html">5 + 5 ways to increase conversion, using psychological techniques. Part 1</a></li>
<li><a href="../232489/index.html">Virtual reality glasses made of cardboard, acrylic and plastic</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>