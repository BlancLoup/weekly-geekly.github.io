<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Doomsday Button or Hardware Hot Key</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably, each of the readers faced with the fact that he lacks hot keys. The most running and simple combinations are occupied, and the rest require ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Doomsday Button or Hardware Hot Key</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/0e1/f5a/b28/0e1f5ab28aed87fcf376c49ef088fc0b.jpg"><br>  Probably, each of the readers faced with the fact that he lacks hot keys.  The most running and simple combinations are occupied, and the rest require the dexterity of a bayan player.  This is especially true for laptops, where the keys are reduced.  In particular, for the MacBook, where a number of multimedia keys are combined with functional ones. <br>  So for the ‚ÄúMake Project‚Äù action, I wanted to have a separate button.  This idea lived somewhere in the subconscious for quite a long time, until one day the start button of the machine at 660V 10A caught my eye.  Details how it was possible to connect it to a laptop via bluetooth, read under the cut. <a name="habracut"></a><br><br>  First of all, I wanted the device to be wireless and not require the installation of drivers. <br>  After a bit of searching, I took the Bluesmirf HID modem from Sparkfun as a basis. <br><br><img src="https://habrastorage.org/storage2/22c/fa3/7ae/22cfa37aefadaffc823e969a8f809340.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Another option was Bluegiga, but since  On the Sparkfun website one could buy other necessary components, then I stopped at the first one.  This modem is defined as a wireless keyboard and can be controlled via the UART.  As control ‚Äúbrains‚Äù, I decided to use the controller ATTiny2313. <br><br>  A listing of what I needed: <br>  ‚Ä¢ Bluesmirf HID modem <br>  ‚Ä¢ ATTiny2313 + substrate 20 pins <br>  ‚Ä¢ Scarf 11x16 holes <br>  ‚Ä¢ ISP AVR programmer, any suitable, cheap. <br>  ‚Ä¢ FTDI TTL cable.  In fact, this is a normal USB-to-serial cable, but with an output voltage of 5V.  This cable is very necessary for configuring the modem and debugging the controlling controller. <br>  ‚Ä¢ For ease of debugging and assembly, all components are connected via mini connectors, so two more lines will be needed break away male headers, right angle and break away female headers. <br>  ‚Ä¢ Resistors - 10 kŒ© 2 pcs., 200 Ohms 1 pc., Capacitors - 0.1 ¬µF 1 pc., 1 LED. <br>  ‚Ä¢ Connector for ISP programmer <br><br><h4>  Bluesmirf HID modem </h4><br>  In order to use a modem in a circuit, you first need to configure it.  To do this, you need to connect to it via UART and in the command mode set the necessary settings. <br>  First of all, you need to enable the device‚Äôs HID profile so that it becomes defined as a keyboard.  The fact is that the modem has two profiles - SPP, which is essentially a duplication of the UART connection via Bluetooth and HID, when the chip is defined as a HID device - i.e.  keyboard or mouse.  Prior to version 6.10, the default HID profile was loaded, after - SPP. <br><br>  So, we connect the FTDI cable to the chip terminals: <br><pre><code class="hljs objectivec">Modem Pins Cable Pins VCC ------------ VCC GND ------------ GND TX<span class="hljs-number"><span class="hljs-number">-0</span></span> ----------- RX RX<span class="hljs-number"><span class="hljs-number">-1</span></span>------------ TX RTS<span class="hljs-number"><span class="hljs-number">-0</span></span> ----+ | <span class="hljs-built_in"><span class="hljs-built_in">CTS</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span> ----+</code> </pre> <br><br>  Next we connect your favorite terminal-program to the COM port of the cable, I used CoolTerm for this. <br>  On Mac OS X, to get a list of all COM ports, run the command: <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">ls</span></span> /dev/<span class="hljs-regexp"><span class="hljs-regexp">tty.*</span></span></code> </pre><br><br>  My cable was defined as /dev/tty.usbseria-AH019ML6 <br>  The default chip I earned at a speed of 115200, the rest settings - no flow control, data bits - 8, parity - none, stop bits - 1, Enter Key Emulation - CR.  It is advisable to add Local Echo, then the terminal will show the typed characters. <br>  To enter the command mode, you need to type $$$ without a newline at the end.  If the settings are set correctly, the chip will return the CMD - this means that it has switched to the command mode.  Now you can make the necessary settings. <br>  All the commands below need to end with a newline character: <br>  ‚Ä¢ S ~, 6 - switches to HID profile <br>  ‚Ä¢ SU, 96 - change speed to 9600 <br>  ‚Ä¢ SN, Doomsday Button - change the device name to the Doomsday Button <br>  ‚Ä¢ SM, 6 - after this command, the modem will automatically reconnect after losing the connection. <br>  ‚Ä¢ R, 1 - reboot the modem <br><br>  After rebooting the modem, change the speed in the terminal settings. <br>  Now the chip is defined as a keyboard.  If you connect it to a computer and type characters in the terminal, the corresponding keystrokes will be generated in the computer.  In addition to the usual type characters, the modem can generate various key combinations.  Directly in the terminal it did not work out, for this purpose I wrote a script on python that connects to the COM port and starts the key combination with a delay.  The delay is needed in order to have time to switch to another program and make sure that the key combination is correct.  For viewing I used EventViewer of the KeyRemap4MacBook program. <br>  See the github repositories of the <a href="https://github.com/Nepherhotep/doomsday-button">github.com/Nepherhotep/doomsday-button</a> project for scripts. <br><br>  After the modem is configured, proceed to the assembly of the control card. <br><br><h4>  Control module </h4><br>  The module based on ATTiny2313 controls the modem through the same UART. <br>  The scheme is relatively simple, below is its basic scheme, scratched on a piece of paper: <br><br><img src="https://habrastorage.org/storage2/84f/cae/c56/84fcaec5691b2e769f0d0d34ad1fdd24.jpg"><br><br>  As such, there is no layout, because  the circuit was finally formed at the time of assembly. <br><br>  ‚Ä¢ VCC, GND, RX, TX (see datasheet on the controller) connect to the UART plug <br>  ‚Ä¢ MOSI, MISO, GND, VCC, SCK, RST - to connect to the programmer connector, RST through 10 kOhm to VCC. <br>  ‚Ä¢ Connect a debugging LED to pin 12 (PB0) of the controller; let its other output to VCC through a 200 Ohm resistor. <br>  ‚Ä¢ Connect one pin of the button to the pin 6 (INT0) of the controller, the second to put on GND.  To remove the ‚Äúbounce‚Äù of pressing the button, it is desirable to connect a container in parallel with it.  I connected 0.1 microfarad, because it was just such a capacitor that I had available, but it could be more.  Without capacity, when pressed, several successive clicks will be generated.  On leg 6, you also need to connect VCC through a 10 kŒ© resistor. <br><br>  After connecting the ISP and the LED, you can immediately check the performance of the circuit by flashing it with the proto / ledblink project from the repository. <br><br>  To compile the schema, you need to run the command make flash.  For firmware, you need a programmer driver and the avrdude utility.  On the poppy just put the package CrossPack.  You may also have to change some settings in the Makefile, for example, the usbtiny programmer on your model. <br><br>  The performance of the UART can be checked by flashing the controller firmware from here <a href="http://www.getchip.net/posts/078-proverka-modulya-uart-attiny2313-testovaya-proshivka/">www.getchip.net/posts/078-proverka-modulya-uart-attiny2313-testovaya-proshivka</a> <br>  In the github repository, see it in proto / uart_test.  Run the write-fuses.sh script to flash the fuse bits, and then write_flash.sh to flash the firmware.  We connect the board to the FTDI cable: <br><pre> <code class="hljs pgsql">VCC <span class="hljs-comment"><span class="hljs-comment">-- VCC GND -- GND RX -- TX TX -- RX</span></span></code> </pre><br><br>  If everything works as it should, go to the project uart_attiny2313.  The firmware works according to this principle - when a low signal arrives at INT0, an interrupt is created that wakes the controller from sleep, and the fire_keypress function is started.  In this function, a combination of SHIFT + F10 characters is sent to the UART and the LED turns on / off. <br><br>  If pressing the button in the terminal displays the desired combination of characters (in my case it is FE 02 02 42 FE 00, see the modem datasheet), this means that you can connect the board to the modem.  The wiring is the same as when you connect the modem to the cable. <br><br>  Next, connect to the appropriate power connectors and power button. <br><br><img src="https://habrastorage.org/storage2/ae3/c24/fb4/ae3c24fb420d0f658fd3d6b77833a14d.jpg"><br><br><img src="https://habrastorage.org/storage2/fe4/265/d0c/fe4265d0cf70feca298d2be5b786b7cc.jpg"><br><br>  It now remains to place everything in the case. <br><br><img src="https://habrastorage.org/storage2/4c6/881/671/4c6881671ec832479ce68fa5994775aa.jpg"><br><br>  Voila!  Doomsday Button is ready!  Now by clicking on it, events will be created - SHIFT-F10, which corresponds to the project build command in the Idea IDE. <br><br><img src="https://habrastorage.org/storage2/d4a/6ef/8a7/d4a6ef8a7a5fd6178bd41691f8460251.jpg"><br><br>  Finally, the video, how it works. <br><br>  <a href="http://www.youtube.com/watch%3Fv%3DJafRsrstjKw">www.youtube.com/watch?v=JafRsrstjKw</a> </div><p>Source: <a href="https://habr.com/ru/post/151242/">https://habr.com/ru/post/151242/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../151235/index.html">Expert opinions are nothing. Customer reviews - all</a></li>
<li><a href="../151237/index.html">Another widget builder: 2GIS mini on your site in 5 minutes</a></li>
<li><a href="../151238/index.html">Network worms of the last decade are found now</a></li>
<li><a href="../151239/index.html">JsTree - trees are so easy</a></li>
<li><a href="../151241/index.html">Using xslt templates in real projects</a></li>
<li><a href="../151243/index.html">New magazine "TsODy.RF" holds a contest for the best material about the data center</a></li>
<li><a href="../151244/index.html">Apache Flex laid out Falcon sources</a></li>
<li><a href="../151246/index.html">Basketball court patterns: Weak team, Personal float and Minus moral</a></li>
<li><a href="../151247/index.html">Firefox OS demo on ZTE smartphone</a></li>
<li><a href="../151248/index.html">Nokia Case (Summary)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>