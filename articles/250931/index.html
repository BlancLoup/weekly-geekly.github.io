<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Moving to HTTPS on Nginx: cheat sheet</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The second time I come across the task of ‚Äúput https on our server‚Äù from my boss, so I decided to make a cheat sheet for myself, and at the same time ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Moving to HTTPS on Nginx: cheat sheet</h1><div class="post__text post__text-html js-mediator-article">  The second time I come across the task of ‚Äúput https on our server‚Äù from my boss, so I decided to make a cheat sheet for myself, and at the same time for everyone else.  So, the situation is as follows: the boss came to us and said that he needed https.  Under the cut, I will write 5 simple steps, how to do everything literally in an hour.  Let's get started <br><a name="habracut"></a><br>  0. We send the boss to buy us a domain name, if we don‚Äôt have one yet - you cannot deliver https without a domain name.  After the purchase, do not forget to register the NS-records in the control panel of our server, as well as the A-record. <br><br>  1. We send the boss for an SSL certificate on <a href="https://www.nic.ru/dns/service/ssl/all_certificates.html%3Fvalidation%3Ddv">nic.ru</a> and let him buy a thawte 123 certificate there, and in the meantime we will generate a CSR request for him. <br><br>  2. Go over SSH to the server and then write: <pre><code class="bash hljs">openssl genrsa -out private.key 2048</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      3. Create a CSR request here with this line: <pre> <code class="bash hljs">openssl req -new -sha256 -key private.key -out csr.csr</code> </pre>  , and the information (such as company name, email) is taken through the <a href="https://www.nic.ru/whois/">whois</a> service (why ask the boss again all when you can find out everything yourself). <br><br>  4. At this time, the boss reached the stage where he would need the CSR request we just created.  We tell him to get SSH to the server and command <pre> <code class="bash hljs">cat csr.csr</code> </pre>  copied the code and pasted it where necessary. <br><br>  5. Then the boss will ask us to confirm ownership of the domain through the creation of mail type admin@our-domain.com.  To do this, we will use the <a href="https://pdd.yandex.ru/">"mail for domains" service from "Yandex"</a> .  We create mail there and we inform the boss login / password. <br><br>  6. Create a bundled PEM certificate.  The boss will have to send an email from thawte in which our certificate will be in the PEM format.  We have to open the sublime text and paste this certificate there, and also download the <a href="https://search.thawte.com/support/ssl-digital-certificates/index%3Fpage%3Dcontent%26actp%3DCROSSLINK%26id%3DAR1372">intermediate certificate from the thawte website</a> , paste it into the same file and save it in /etc/nginx/certificate_bundled.crt.  <b>Attention!</b>  First comes what the boss sent us, and only then the intermediate certificate that we downloaded from that link. <br><br>  7. Copy the private key to the same command <pre> <code class="bash hljs">mv private.key /etc/nginx/private.key</code> </pre> <br><br>  8. Open the /etc/nginx/nginx.conf config and configure it according to the instructions in the publication <a href="http://habrahabr.ru/post/195808/">‚ÄúSet up an HTTPS server on nginx‚Äù</a> .  In short, we need to prescribe in /etc/nginx/nginx.conf in the http section <pre> <code class="bash hljs"> ssl_session_cache shared:SSL:10m; ssl_session_timeout 5m; ssl_prefer_server_ciphers on; ssl_stapling on; resolver 8.8.8.8;</code> </pre><br>  Then in /etc/nginx/conf.d/example_ssl.conf in the server section: <pre> <code class="bash hljs">server { listen 443 ssl; server_name www.site.ru; root /var/www/html/web/; <span class="hljs-comment"><span class="hljs-comment">#      root,   -     index index.php index.html; set $yii_bootstrap "index.php"; #     yii,      location / { # Define the index index index.html $yii_bootstrap; try_files $uri $uri/ /$yii_bootstrap?$args; } # Any of the protected directories, we will ignore. There is no reason # to share out the protected web spaces location ~ ^/(commands|components|config|controllers|models|vendor|views) { deny all; } #avoid processing of calls to unexisting static files by yii location ~ \.(js|css|png|jpg|gif|swf|ico|pdf|mov|fla|zip|rar)$ { try_files $uri =404; } ....... keepalive_timeout 60; ssl_certificate certificate_bundled.crt; ssl_certificate_key private.key; ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers "RC4:HIGH:!aNULL:!MD5:!kEDH"; add_header Strict-Transport-Security 'max-age=604800'; ....... location ~ \.php$ { ....... fastcgi_param HTTPS on; #  php-fpm ....... } }</span></span></code> </pre><br><br>  9. Disable the password for the private key with the command: <pre> <code class="bash hljs">openssl rsa -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> /etc/nginx/private.key -out /etc/nginx/private.key</code> </pre> <br><br>  10. Reboot nginx command <pre> <code class="bash hljs">nginx -s reload</code> </pre>  and - voila! </div><p>Source: <a href="https://habr.com/ru/post/250931/">https://habr.com/ru/post/250931/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250915/index.html">Wassenaar agreement will limit the indiscriminate sale of exploits</a></li>
<li><a href="../250917/index.html">Implementing a single source DITA technology in a software development company</a></li>
<li><a href="../250921/index.html">Selenium for Python. Chapter 2. First Steps</a></li>
<li><a href="../250927/index.html">Payment to a Yandex.Money account with a VISA / MasterCard card or how to block an arbitrary wallet</a></li>
<li><a href="../250929/index.html">Running two or more MySQL instances on the same Linux server</a></li>
<li><a href="../250933/index.html">Supercomputer in NArFU: the development of the Arctic by numerical methods</a></li>
<li><a href="../250935/index.html">Analysis of audio analysis algorithms</a></li>
<li><a href="../250937/index.html">At the start, attention, DUMP! Yekaterinburg, March 20</a></li>
<li><a href="../250939/index.html">How to make a website and make money on it (for performers)</a></li>
<li><a href="../250941/index.html">Problem solving experience by creating an OLAP cube using C #</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>