<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PostgreSQL 9.3 What's New?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, habracheloveki! Not so long ago, PostgreSQL 9.3 was released and I would like to acquaint you with the most important client-related innovation...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PostgreSQL 9.3 What's New?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage3/f06/661/735/f0666173533dd132950603eb6e245731.jpg"><br>  Hello, habracheloveki!  Not so long ago, <b>PostgreSQL</b> 9.3 was released and I would like to acquaint you with the most important client-related innovations that may be useful to you.  This article covers the following: <br><ul><li>  materialized views </li><li>  updatable views </li><li>  event triggers </li><li>  recursive views </li><li>  lateral attachment </li><li>  changeable external tables </li><li>  functions and operators for working with <b>JSON</b> type </li></ul><br><a name="habracut"></a><br><h4>  <b>Materialized views</b> </h4><br><img src="https://habrastorage.org/storage3/9b5/7b6/3c8/9b57b63c844f2fce04c20d32cff42461.jpeg"><br>  A materialized view is a physical database object containing the results of some query.  Undoubtedly, one of the most anticipated innovations.  Let's see how to work with it in <b>PostgreSQL</b> . <br><br>  Create a reference book of authors and a reference book with a link to the author: <br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> author ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">serial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, first_name <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, last_name <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> pk_author_id PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> ), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> uk_author_name <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> ( first_name, last_name ) ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> book ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">serial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, author_id <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> pk_book_id PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> ), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> fk_book_author_id <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> ( author_id ) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> author ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> ), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> uk_book_name <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> ( author_id, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> ) );</code> </pre> <br><br>  Fill these tables with data - add a couple of authors and generate many, many books: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> author ( first_name, last_name ) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> ( <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> ); <span class="hljs-comment"><span class="hljs-comment">--  id = 1 INSERT INTO author ( first_name, last_name ) VALUES ( '', '' ); --  id = 2 INSERT INTO book ( author_id, name ) VALUES ( 1, '   ( ' || generate_series ( 1, 100000 ) || ')' ); INSERT INTO book ( author_id, name ) VALUES ( 2, ' ' ), ( 2, ' ' );</span></span></code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For comparison, let's create a normal and materialized view (note that it takes a little longer to create the latter to sample and record the result): <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> vw_book <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> book.id, author.first_name || <span class="hljs-string"><span class="hljs-string">' '</span></span> || author.last_name <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> author_name, book.name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> book <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> author <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> author.id = book.author_id; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MATERIALIZED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> mvw_book <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> book.id, author.first_name || <span class="hljs-string"><span class="hljs-string">' '</span></span> || author.last_name <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> author_name, book.name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> book <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> author <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> author.id = book.author_id;</code> </pre><br><br>  Now, let's take a look at the query plan with the condition for the usual and materialized view: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> vw_book <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> author_name = <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-comment"><span class="hljs-comment">-- Hash Join (cost=24.58..2543.83 rows=482 width=119) (actual time=19.389..19.390 rows=2 loops=1) Hash Cond: (book.author_id = author.id) -&gt; Seq Scan on book (cost=0.00..2137.02 rows=100002 width=59) (actual time=0.017..9.231 rows=100002 loops=1) -&gt; Hash (cost=24.53..24.53 rows=4 width=68) (actual time=0.026..0.026 rows=1 loops=1) Buckets: 1024 Batches: 1 Memory Usage: 1kB -&gt; Seq Scan on author (cost=0.00..24.53 rows=4 width=68) (actual time=0.019..0.020 rows=1 loops=1) Filter: (((first_name || ' '::text) || last_name) = ' '::text) Rows Removed by Filter: 1 Total runtime: 19.452 ms EXPLAIN ANALYZE SELECT * FROM mvw_book WHERE author_name = ' '; -- Seq Scan on mvw_book (cost=0.00..2584.03 rows=7 width=77) (actual time=15.869..15.870 rows=2 loops=1) Filter: (author_name = ' '::text) Rows Removed by Filter: 100000 Total runtime: 15.905 ms</span></span></code> </pre><br><br>  The data for the materialized view is heaped and does not have to be collected from different tables.  But this is not all, since it is possible for them to create indexes.  Improving the result: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> idx_book_name <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> mvw_book ( author_name ); <span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> mvw_book <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> author_name = <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-comment"><span class="hljs-comment">-- Index Scan using idx_book_name on mvw_book (cost=0.42..8.54 rows=7 width=77) (actual time=0.051..0.055 rows=2 loops=1) Index Cond: (author_name = ' '::text) Total runtime: 0.099 ms</span></span></code> </pre><br><br>  Not bad, the search is conducted on the index and the search time is significantly reduced. <br><br>  But there is a nuance when using materialized views - after <b>DML</b> operations on the tables that make up the view, the view has to be updated: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> book ( author_id, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> ( <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'  '</span></span> ); REFRESH MATERIALIZED VIEW mvw_book;</code> </pre><br><br>  This can be automated with a trigger: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> mvw_book_refresh ( ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">trigger</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REFRESH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MATERIALIZED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> mvw_book; RETURN NULL; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql VOLATILE; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRIGGER</span></span> tr_book_refresh <span class="hljs-keyword"><span class="hljs-keyword">AFTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> book <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EACH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATEMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> mvw_book_refresh ( ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRIGGER</span></span> tr_author_refresh <span class="hljs-keyword"><span class="hljs-keyword">AFTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> author <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EACH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATEMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> mvw_book_refresh ( );</code> </pre><br><br>  Although the functional simulating materialized views could be done in <b>PostgreSQL 9.2</b> (creating a table, indexes to it and a trigger that would perform a tricky query), but in general this is a convenient innovation. <br><br><h4>  <b>Updateable views</b> </h4><br><img src="https://habrastorage.org/storage3/418/12c/20d/41812c20dd611166097d0b4ed660e677.jpg"><br>  <b>DML</b> operations can be applied to updated views.  The truth is that the requirements for such representations are high: only one entity (table, view) in the <b>FROM</b> list, without the <b>WITH</b> , <b>DISTINCT</b> , <b>GROUP BY</b> , <b>HAVING</b> , <b>LIMIT</b> and <b>OFFSET statements</b> , without operations on sets ( <b>UNION</b> , <b>INTERSECT</b> and <b>EXCEPT</b> ) and to the fields not no functions or operations should be applied. <br><br>  Refreshable views in action: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> employee ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">serial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, fullname <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, birthday <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>, salary <span class="hljs-built_in"><span class="hljs-built_in">numeric</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> pk_employee_id PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> ), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> uk_employee_fullname <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> ( fullname ), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> ch_employee_salary <span class="hljs-keyword"><span class="hljs-keyword">CHECK</span></span> ( salary &gt;= <span class="hljs-number"><span class="hljs-number">0.0</span></span> ) ); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> employee ( fullname, salary ) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> ( <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-number"><span class="hljs-number">800.0</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> employee ( fullname, salary ) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> ( <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-number"><span class="hljs-number">2000.0</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> employee ( fullname, salary ) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> ( <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1500.0</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> vw_employee_top_salary <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> employee.fullname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, employee.salary <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> employee <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> employee.salary &gt;= <span class="hljs-number"><span class="hljs-number">1000.0</span></span>; <span class="hljs-comment"><span class="hljs-comment">--    INSERT INTO vw_employee_top_salary ( name, salary ) VALUES ( ' ', 2500.0 ); UPDATE vw_employee_top_salary SET salary = 2200.0 WHERE name = ' '; DELETE FROM vw_employee_top_salary WHERE name = ''; --   SELECT * FROM vw_employee_top_salary;</span></span></code> </pre><br><br>  Please note that <b>INSERT</b> can be done in the view anyway, and <b>UPDATE</b> and <b>DELETE</b> can be done only when the set from the base table falls under the condition in the view: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> vw_employee_top_salary ( <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, salary ) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> ( <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span> ); <span class="hljs-comment"><span class="hljs-comment">--   UPDATE vw_employee_top_salary SET salary = 3000.0 WHERE name = ''; --   ,   salary  0.0 DELETE FROM vw_employee_top_salary WHERE name = ''; --   ,   salary  0.0</span></span></code> </pre><br><br>  More advanced things can be done using <a href="http://www.postgresql.org/docs/9.3/static/rules-update.html">rules</a> for views. <br><br><h4>  <b>Event Triggers</b> </h4><br><img src="https://habrastorage.org/storage3/1cd/57c/24e/1cd57c24e8f519a0d5ef7bada460419a.jpg"><br>  Also quite an expected innovation.  Allow to intercept <b>DDL</b> commands in the database.  They differ from ordinary triggers primarily because they are global, without reference to a specific table, but you can specify which commands to respond to. <br><br>  They are created as follows: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> event_trigger_begin ( ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> event_trigger <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RAISE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOTICE</span></span> <span class="hljs-string"><span class="hljs-string">'(begin) tg_event = %, tg_tag = %'</span></span>, TG_EVENT, TG_TAG; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>; $BODY$ LANGUAGE plpgsql; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> event_trigger_end ( ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> event_trigger <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RAISE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOTICE</span></span> <span class="hljs-string"><span class="hljs-string">'(end) tg_event = %, tg_tag = %'</span></span>, TG_EVENT, TG_TAG; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>; $BODY$ LANGUAGE plpgsql; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EVENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRIGGER</span></span> tr_event_begin <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ddl_command_start <span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> event_trigger_begin ( ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EVENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRIGGER</span></span> tr_event_end <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ddl_command_end <span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> event_trigger_end ( );</code> </pre><br><br>  We carry out different <b>DDL</b> manipulations with the table: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> article ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SERIAL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> pk_article_id PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> ), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> uk_article_name <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> ) ); <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> article <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> misc <span class="hljs-built_in"><span class="hljs-built_in">numeric</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> article <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> misc <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> article <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> misc; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> article;</code> </pre><br><br>  The output should be: <br><pre> <code class="sql hljs">tg_event = ddl_command_start, tg_tag = <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> tg_event = ddl_command_end, tg_tag = <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> tg_event = ddl_command_start, tg_tag = <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> tg_event = ddl_command_end, tg_tag = <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> tg_event = ddl_command_start, tg_tag = <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> tg_event = ddl_command_end, tg_tag = <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> tg_event = ddl_command_start, tg_tag = <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> tg_event = ddl_command_end, tg_tag = <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> tg_event = ddl_command_start, tg_tag = <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> tg_event = ddl_command_end, tg_tag = <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span></code> </pre><br><br>  Only information about the event ( <i>TG_EVENT</i> ) and, in fact, about the team ( <i>TG_TAG</i> ) is available through plpgsql, but I hope it will be better in the future. <br><br><h4>  <b>Recursive views</b> </h4><br><img src="https://habrastorage.org/storage3/718/9df/e1d/7189dfe1d37a7cab83e6e04ac827e867.jpg"><br>  Allow to simplify the construction <b>WITH RECURSIVE</b> , if you want to build a representation on it. <br><br>  Create a table and fill it with test data: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">directory</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">serial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, parent_id <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> pk_directory_id PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> ), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> fk_directory_parent_id <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> ( parent_id ) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> <span class="hljs-keyword"><span class="hljs-keyword">directory</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> ), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> uk_directory_name <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> ( parent_id, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> ) ); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">directory</span></span> ( parent_id, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> ( <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">'usr'</span></span> ); <span class="hljs-comment"><span class="hljs-comment">--  id = 1 INSERT INTO directory ( parent_id, name ) VALUES ( 1, 'lib' ); INSERT INTO directory ( parent_id, name ) VALUES ( 1, 'include' ); INSERT INTO directory ( parent_id, name ) VALUES ( NULL, 'var' ); --  id = 4 INSERT INTO directory ( parent_id, name ) VALUES ( 4, 'opt' ); --  id = 5 INSERT INTO directory ( parent_id, name ) VALUES ( 5, 'tmp' ); INSERT INTO directory ( parent_id, name ) VALUES ( 4, 'log' ); --  id = 7 INSERT INTO directory ( parent_id, name ) VALUES ( 7, 'samba' ); INSERT INTO directory ( parent_id, name ) VALUES ( 7, 'news' );</span></span></code> </pre><br><br>  Request through WITH RECURSIVE and similar to it, through recursive representation: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RECURSIVE</span></span> vw_directory ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, parent_id, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">path</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, parent_id, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, <span class="hljs-string"><span class="hljs-string">'/'</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">directory</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> parent_id <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> = <span class="hljs-string"><span class="hljs-string">'var'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> ALL <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> d.id, d.parent_id, d.name, t.path || <span class="hljs-string"><span class="hljs-string">'/'</span></span> || d.name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">directory</span></span> d <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> vw_directory t <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> d.parent_id = t.id ) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> vw_directory <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">path</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RECURSIVE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> vw_directory ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, parent_id, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">path</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, parent_id, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, <span class="hljs-string"><span class="hljs-string">'/'</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">directory</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> parent_id <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> = <span class="hljs-string"><span class="hljs-string">'var'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> ALL <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> d.id, d.parent_id, d.name, t.path || <span class="hljs-string"><span class="hljs-string">'/'</span></span> || d.name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">directory</span></span> d <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> vw_directory t <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> d.parent_id = t.id; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> vw_directory <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">path</span></span>;</code> </pre><br><br>  In fact, a recursive view is a wrapper over <b>WITH RECURSIVE</b> , as can be seen by looking at the text of the expanded view: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> vw_directory <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RECURSIVE</span></span> vw_directory(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, parent_id, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">path</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> directory.id, directory.parent_id, directory.name, <span class="hljs-string"><span class="hljs-string">'/'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">text</span></span> || directory.name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">directory</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> directory.parent_id <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> directory.name = <span class="hljs-string"><span class="hljs-string">'var'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> ALL <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> d.id, d.parent_id, d.name, (t.path || <span class="hljs-string"><span class="hljs-string">'/'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">text</span></span>) || d.name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">directory</span></span> d <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> vw_directory t <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> d.parent_id = t.id ) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> vw_directory.id, vw_directory.parent_id, vw_directory.name, vw_directory.path <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> vw_directory;</code> </pre><br><br><h4>  <b>Lateral attachment</b> </h4><br><img src="https://habrastorage.org/storage3/2f9/dbe/d75/2f9dbed7559d5d8b2207320d7396336b.jpg"><br>  It allows you to access entities from an external query from a subquery.  Example of use (counting the number of fields only for entities from the public schema): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> t.table_schema || <span class="hljs-string"><span class="hljs-string">'.'</span></span> || t.table_name, q.columns_count <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> information_schema.tables t, LATERAL ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span> ( <span class="hljs-number"><span class="hljs-number">1</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> columns_count <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> information_schema.columns c <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t.table_schema <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> ( <span class="hljs-string"><span class="hljs-string">'public'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> t.table_schema || <span class="hljs-string"><span class="hljs-string">'.'</span></span> || t.table_name = c.table_schema || <span class="hljs-string"><span class="hljs-string">'.'</span></span> || c.table_name ) q <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br><br><h4>  <b>Variable external tables</b> </h4><br><img src="https://habrastorage.org/storage3/180/c66/611/180c6661114de887a0db4e3d5f686ca2.jpg"><br>  A new <i>postgres_fdw</i> module that allows read / write access to data located in another database.  Previously, such functionality was in <i>dblink</i> , but in <i>postgres_fdw</i> everything is more transparent, standardized syntax and you can get better performance.  Let's see how you can use <i>postgres_fdw</i> . <br><br>  Create a new <i>fdb</i> database and a test table in it (it will be external to the current database): <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> city ( country <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> uk_city_name <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> ( country, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> ) );</code> </pre><br><br>  Let's go back to the current database and configure the external data source: <br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--   CREATE EXTENSION postgres_fdw; --    CREATE SERVER fdb_server FOREIGN DATA WRAPPER postgres_fdw OPTIONS ( host 'localhost', dbname 'fdb' ); --   CREATE USER MAPPING FOR PUBLIC SERVER fdb_server OPTIONS ( password 'pwd' ); --    CREATE FOREIGN TABLE fdb_city ( country text, name text ) SERVER fdb_server OPTIONS ( table_name 'city' );</span></span></code> </pre><br><br>  Now we can work with the external table: <br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--   INSERT INTO fdb_city ( country, name ) VALUES ( 'USA', 'Las Vegas' ); --   UPDATE fdb_city SET name = 'New Vegas' WHERE name = 'New Vegas'; -- ,   SELECT * FROM fdb_city;</span></span></code> </pre><br><br>  In order to make sure that the data actually got to the right place, switch to the fdb database and check: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> city;</code> </pre><br><br><h4>  <b>Functions and operators for working with JSON type</b> </h4><br><img src="https://habrastorage.org/storage3/b75/dec/69b/b75dec69b96af6bec2e00f43c5c2805d.jpg"><br>  The <b>JSON</b> type appeared in <b>PostgreSQL</b> 9.2, but there were only two functions ‚Äî array_to_json (converting an array to <b>JSON</b> ) and row_to_json (converting a record to <b>JSON</b> ).  Now there are more functions and you can work with this type quite well: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span> t_link <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ( <span class="hljs-string"><span class="hljs-string">"from"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, <span class="hljs-string"><span class="hljs-string">"to"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> param ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">serial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">json</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> pk_param_id PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> ), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> uk_param_name <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> ) ); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> param ( <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> ( <span class="hljs-string"><span class="hljs-string">'connection'</span></span>, <span class="hljs-string"><span class="hljs-string">'{ "username" : "Administrator", "login" : "root", "databases" : [ "db0", "db1" ], "enable" : { "day" : 0, "night" : 1 } }'</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">json</span></span> ), ( <span class="hljs-string"><span class="hljs-string">'link'</span></span>, <span class="hljs-string"><span class="hljs-string">'{ "from" : "db0", "to" : "db1" }'</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">json</span></span> ); <span class="hljs-comment"><span class="hljs-comment">--   () SELECT value -&gt;&gt; 'username' FROM param WHERE name = 'connection'; --  Administrator --   (  ) () SELECT value #&gt;&gt; '{databases,0}' FROM param WHERE name = 'connection'; --  db0 --   SETOF ( key, value )   text () SELECT json_each_text ( value ) FROM param; --  (username,Administrator) (login,root) (databases,"[ ""db0"", ""db1"" ]") (enable,"{ ""day"" : 0, ""night"" : 1 }") (from,db0) (to,db1) --   () SELECT json_object_keys ( value ) FROM param; --  username login databases enable from to --     () SELECT * FROM json_populate_record ( null::t_link, ( SELECT value FROM param WHERE name = 'link' ) ); --  db0;db1 --   () SELECT json_array_elements ( value -&gt; 'databases' ) FROM param; --  "db0" "db1"</span></span></code> </pre><br><br>  To summarize, I want to say that I am pleased with the development of <b>PostgreSQL</b> , the project is developing, although there are still raw things. <br><br>  PS Thank you, if you have read to the end. <br><br>  References: <br><ul><li>  <a href="">What's new in PostgreSQL 9.3</a> </li><li>  <a href="http://www.depesz.com/">select * from depesz</a> </li><li>  <a href="http://www.postgresql.org/docs/9.3/static">PostgreSQL Official Documentation</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/195898/">https://habr.com/ru/post/195898/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../195884/index.html">Radiadic floor lamp or another "2 pennies" in the piggy bank of the "smart home"</a></li>
<li><a href="../195888/index.html">Again, pensions and surprises again</a></li>
<li><a href="../195890/index.html">The beta version of the new Yandex.Maps has opened: how and why we made them</a></li>
<li><a href="../195894/index.html">iPhone of all time: performance comparison</a></li>
<li><a href="../195896/index.html">3D printer helps blind children search for objects on the Internet.</a></li>
<li><a href="../195900/index.html">DropBox now supports screenshots</a></li>
<li><a href="../195904/index.html">Infographics: Death to Bullshit or Death of Uselessness</a></li>
<li><a href="../195908/index.html">Common API for JUnit and TestNG</a></li>
<li><a href="../195910/index.html">First images of hydrogen bonds</a></li>
<li><a href="../195912/index.html">Communigate Pro - a platform for the most popular communication services</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>