<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How 45 minutes to lose $ 172 222 per second</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is perhaps the most painful error report I've ever read. He colorfully describes the steps that led to the loss of $ 465 million by Knight Capita...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How 45 minutes to lose $ 172 222 per second</h1><div class="post__text post__text-html js-mediator-article">  This is perhaps the <a href="http://www.sec.gov/litigation/admin/2013/34-70694.pdf">most painful error report</a> I've ever read.  He colorfully describes the steps that led to the loss of $ 465 million by Knight Capital due to a software bug that appeared last year and bankrupt the company. <br><br>  This report contains all the characteristics of technical debt in a huge, support-free and running code base (an error occurred due to the execution of a code that was not used for almost 9 years) and a terrible and sad history of interaction between software developers and IT professionals. <br><a name="habracut"></a><br>  Highlights: <br><blockquote>  To ensure the participation of its customers in the Liquidity Program (PL) on the New York Stock Exchange, which was scheduled to launch on August 1, 2012, Knight made a number of changes to its systems and program code associated with the order processing process.  These changes included the development and deployment of new code in SMARS.  SMARS is an automated, high-speed, algorithmic router that sends orders to the market.  One of the main functions of SMARS is to receive orders from other components of the Knight trading platform (‚Äúparent‚Äù orders), and, as necessary, based on the available liquidity, sending one or several representative (or ‚Äúdaughter‚Äù) orders to external services for execution. <br><br>  13. When deploying a new PL, the code in SMARS should have replaced the unused code in the corresponding part of the router.  This unused code was previously needed for the Power Peg function, which the company has not used for many years.  Despite this, it remained operational and invoked during the deployment of the submarine.  The new PL code used the flag that was previously tied to Power Peg.  Knight wanted to remove the Power Peg code so that when this flag is activated, the new submarine functionality was used, not Power Peg. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      14. Previously, when using Power Peg, the summing function calculated the number of shares in the execution of the child orders and signaled the need to stop placing the child orders after the parent order was completed.  In 2003, Knight stopped using Power Peg.  In 2005, Knight changed the Power Peg code by moving the tracking function of the parent order to an earlier stage of the SMARS code sequence.  Repeated testing of the Power Peg code after the change of Knight was not performed, and that the procedure is still working correctly was not verified. <br><br>  15. Starting July 27, 2012, Knight has deployed a new submarine code in SMARS, placing it on a limited number of servers.  During the deployment of a new code, one of the technicians did not copy the new code to one of the eight SMARS servers.  In Knight, there was no second technician who would conduct a deployment check, and no one understood that the Power Peg code was not removed from the eighth server and the new PL code was not added.  Knight did not have any written procedures that would require such verification. <br><br>  16. On August 1, Knight received orders from brokers-dealers, whose clients could participate in the submarine.  Seven servers processed orders correctly.  But orders sent to server 8 with the launch flag set launched the defective Power Peg code that was still present on that server.  As a result, the server took orders as parent and started sending child orders to the trading centers.  Due to the fact that the function of checking the fulfillment of the parent order was moved to another stage of the process, the server continued to place the child orders non-stop - not paying attention to the fact that the parent order was already completed.  Although some part of the order processing system determined that the parent order was completed, this information did not fall into SMARS. <br><br>  19. On August 1, Knight also received orders that related to the submarines, but were intended to trade before the market opened.  6 SMARS servers processed these orders and, starting at approximately 8:01 am, internal systems generated automatic messages (called ‚ÄúBNET failure‚Äù) that referred to SMARS and described the error as ‚ÄúPower Peg Disconnected‚Äù.  The Knight system sent 97 such messages until 9:30 in the morning when the market opened.  Messages of this type were not regarded by the system as dangerous, and the staff did not read them at all. <br></blockquote><br>  Further more fun: <br><br><blockquote>  27. On 1 August, there were no incident response procedures at Knight.  In other words, the company did not have control procedures for personnel management when serious problems occurred.  On August 1, Knight used the services of his team of technicians to identify and fix problems in SMARS in a live trading environment.  The Knight system continued to send millions of "daughter" orders while the staff tried to identify the source of the problem.  The company even deleted the new PL code from the seven servers on which it was installed correctly.  This aggravated the situation, because the new ‚Äúparent‚Äù orders activated the Power Peg code that was present on these servers, similar to what already happened on the eighth server. </blockquote><br>  Of course, it is worth reading the entire document, it pays great attention to new verification procedures carried out by people in order to avoid such a tragedy.  The mistakes of the developers, of course, were related to the human factor, but such consequences were the result of a bad deployment scenario and ugly monitoring.  What is this office that does not even check the version of the cluster software?  Not to mention the deployment scenarios in which return codes are checked. <br><br>  We can only hope that the ‚Äúwritten verification procedures‚Äù of unused code implied systematic tests, although Wikipedia says that this is not the case. <br><br>  And for sweetness: the fine amounted to another $ 12 million, an audit showed that the system was constantly trying to implement speculative short sales. <br><br></div><p>Source: <a href="https://habr.com/ru/post/198766/">https://habr.com/ru/post/198766/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../198738/index.html">Outdoor facilities for MySQL drivers in Node.js</a></li>
<li><a href="../198740/index.html">Restoring PlexConnect for Apple TV</a></li>
<li><a href="../198750/index.html">Why do startups need a good "felling"?</a></li>
<li><a href="../198762/index.html">Chicken or egg: what before, prototypes or TK?</a></li>
<li><a href="../198764/index.html">A record for the speed of data transmission through lasers to the moon and back</a></li>
<li><a href="../198770/index.html">World View: stratospheric tourism in an air (helium) balloon</a></li>
<li><a href="../198772/index.html">Active authors in social media: a study by age group</a></li>
<li><a href="../198774/index.html">Work with tables in MultiCAD.NET. Part 2. Creating and editing</a></li>
<li><a href="../198776/index.html">JavaFX WebView (HTML / JS) - we use web practices for developing desktop applications</a></li>
<li><a href="../198778/index.html">The story of one Google Chrome extension</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>