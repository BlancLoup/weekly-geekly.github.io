<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We build WAH on Arduino</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Have you ever had such that there is an element with two leads on the type of such ... 



 ... but you do not understand: 


- What is it? 
- Is it w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We build WAH on Arduino</h1><div class="post__text post__text-html js-mediator-article">  Have you ever had such that there is an element with two leads on the type of such ... <br><br><img src="https://habrastorage.org/files/9f4/254/aa2/9f4254aa23cb49e3860b56350af7e915.jpg"><br><br>  ... but you do not understand: <br><ul><li>  What is it? </li><li>  Is it working? </li><li>  What are his options? </li></ul><br>  I've had it, but yesterday a lot happened ... <br><a name="habracut"></a><br>  The idea to build the CVC with the help of the MK appeared a long time ago, and they just came to realize their hands. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  What to do? </h2><br>  I chose Arduino Nano as a controller because: <br><ol><li>  There is a USB and, equally important, you don‚Äôt need to study it; </li><li>  Comfortable, small, not very expensive; </li><li>  There are no speed requirements, so STM32 is not needed; </li><li>  Very easy to program; </li><li>  Output voltage 5 V. </li></ol><br>  Diagram of the measuring part: <br><br><img src="https://habrastorage.org/files/f4b/0d3/32e/f4b0d332e0cc4d959882f3ad5d422523.png"><br><br>  We supply voltage to In1 and In2 and, as a result, we must plot the current through UD (Unknown Device) = (U <sub>Out</sub> - U <sub>Out2</sub> ) / R1 on voltage on it = U <sub>Out1</sub> - U <sub>Out</sub> <br><br>  Since  we have a 5 V circuit, for simplicity, we limit ourselves to the IVC in the range from -5 to 5 V, so as not to complicate the design. <br>  There are no DACs in the bundle, so input signals can be generated either using PWM + low pass filter or using a digital potentiometer / external DAC.  I first made the 1st option. <br><br>  The final scheme was as follows: <br><br><img src="https://habrastorage.org/files/2f9/6ad/c68/2f96adc687474a18995d3f75802a522c.png"><br><br>  The program for Arduino is so small that I will bring it right here: <br><div class="spoiler">  <b class="spoiler_title">Program</b> <div class="spoiler_text"><pre><code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> setup() { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">115200</span></span>); analogReference(<span class="hljs-keyword"><span class="hljs-keyword">EXTERNAL</span></span>); //    Aref  <span class="hljs-number"><span class="hljs-number">5</span></span>  DDRD |= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) | (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">3</span></span>); TCCR2B |= (<span class="hljs-number"><span class="hljs-number">0</span></span> &lt;&lt; CS22)|(<span class="hljs-number"><span class="hljs-number">0</span></span> &lt;&lt; CS21)|(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; CS20); // prescaler = <span class="hljs-number"><span class="hljs-number">1.</span></span>   <span class="hljs-number"><span class="hljs-number">13</span></span>  TIMSK2 |= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; TOIE2)|(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; OCIE2A); //   TCCR2A &amp;= ~(<span class="hljs-number"><span class="hljs-number">3</span></span>); // WGM20 = <span class="hljs-number"><span class="hljs-number">0</span></span>, WGM21 = <span class="hljs-number"><span class="hljs-number">0</span></span> TCCR2B &amp;= ~(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">3</span></span>); // WGM22 = <span class="hljs-number"><span class="hljs-number">0</span></span> OCR2A = <span class="hljs-number"><span class="hljs-number">128</span></span>; sei(); } ISR(TIMER2_OVF_vect) { PORTD |= <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span>; PORTD &amp;= ~(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">3</span></span>); } ISR(TIMER2_COMPA_vect) { PORTD |= <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">3</span></span>; PORTD &amp;= ~(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span>); } <span class="hljs-type"><span class="hljs-type">int</span></span> analogAVG(<span class="hljs-type"><span class="hljs-type">int</span></span> channel){ uint32_t summ; uint16_t count = <span class="hljs-number"><span class="hljs-number">50</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(uint8_t i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; count; i++) summ += analogRead(channel); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> summ / count; } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { OCR2A += <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!OCR2A) //     delay(<span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(OCR2A); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(":"); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(analogAVG(<span class="hljs-number"><span class="hljs-number">0</span></span>)); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(":"); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(analogAVG(<span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(":"); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(analogAVG(<span class="hljs-number"><span class="hljs-number">2</span></span>)); }</code> </pre> <br></div></div><br><br>  <a href="https://github.com/adefikux/VAH">Drawing WAH</a> made in C # partially copying the code from the previous project. <br><br><div class="spoiler">  <b class="spoiler_title">Several WAH obtained using the device</b> <div class="spoiler_text">  Bright vertical lines every 1B, bright horizontal lines every 100 ¬µA. <br>  The brightest vertical and horizontal lines are zeros. <br><br>  Diode 1N4148: <br><br><img src="https://habrastorage.org/files/a79/552/92e/a7955292efd74436a77d28e63000b3e0.png"><br><br>  Diode 1N5817: <br><br><img src="https://habrastorage.org/files/d37/a99/142/d37a991422e34196b0c8f769a950cf66.png"><br><br>  See how at zero voltage the current is positive?  What do you think, why? <br><br><div class="spoiler">  <b class="spoiler_title">Answer</b> <div class="spoiler_text">  PWM gives voltage fluctuations.  When measuring the voltage, they are averaged and it turns out to be 0, and the current is rectified by a diode and after rectification and averaging it turns out to be significantly larger than zero. <br></div></div><br><br>  Unknown LED: <br><br><img src="https://habrastorage.org/files/768/56f/2d8/76856f2d893549eaae44eff15089c6de.png"><br><br>  680 ohm resistor: <br><br><img src="https://habrastorage.org/files/97f/d99/55c/97fd9955cc474e339fdc3c2c095eca4e.png"><br></div></div><br><br><h2>  Total </h2><br>  Without claiming the accuracy of the device from the Arduino Nano, 2 capacitors and 3 resistors allows you to compare the current-voltage characteristics of different two-terminal.  Among the shortcomings can be noted: <br><ol><li>  Low voltage range.  If you expand the range, the number of elements increases significantly. </li><li>  Noise PWM.  It can be eliminated by increasing the capacitance of the capacitors, increasing the values ‚Äã‚Äãof the resistors and installing additional filter cascades or by abandoning the PWM in favor of a separate DAC or digital potentiometer. </li><li>  Not visible small currents, such as reverse currents diodes.  Also disposable disadvantage. </li></ol><br><br>  Photos of the hardware: <br><br> <a href=""><img src="https://habrastorage.org/files/b37/744/88d/b3774488d8c44b3ba087c72fc39d3dc8.JPG"></a> </div><p>Source: <a href="https://habr.com/ru/post/369485/">https://habr.com/ru/post/369485/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../369475/index.html">KINETIC: Intel Edison, Gravity, Health, and Savings</a></li>
<li><a href="../369477/index.html">"Juno" sent the first photos of Jupiter</a></li>
<li><a href="../369479/index.html">Is it possible to develop a successful trading robot alone: ‚Äã‚ÄãOpinions of Quora users</a></li>
<li><a href="../369481/index.html">Bitfury and Lightning proposed a protocol to speed up Bitcoin transactions.</a></li>
<li><a href="../369483/index.html">Operating experience innos D6000 vs. Samsung Galaxy S7: Convenience in the details</a></li>
<li><a href="../369487/index.html">Google deleted the blog of the writer Dennis Cooper and the results of his work for 14 years</a></li>
<li><a href="../369491/index.html">Microsoft removed the built-in backdoor from Windows RT, which allows you to bypass Secure Boot and install Linux</a></li>
<li><a href="../369493/index.html">35 years of the game "Donkey" by Bill Gates</a></li>
<li><a href="../369495/index.html">Beach on the wall of the house?</a></li>
<li><a href="../369497/index.html">Samsung Charm - one of the inconspicuous innovations and the cheapest fitness tracker *</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>