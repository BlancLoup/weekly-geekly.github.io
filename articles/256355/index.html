<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>godebug - cross-platform debugger for Go</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The guys from Mailgun presented a new cross-platform debugger for Go , which uses the original technology, which is completely different from the stan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>godebug - cross-platform debugger for Go</h1><div class="post__text post__text-html js-mediator-article">  The guys from Mailgun presented a new <a href="https://github.com/mailgun/godebug">cross-platform debugger for Go</a> , which uses the original technology, which is completely different from the standard approaches.  Looking ahead - with Gopherjs, this debugger works even in the browser. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8e1/3d5/d48/8e13d5d485ec8f3c937f3852ad1e2d0a.gif" alt="image"><br><a name="habracut"></a><br><h4>  Intro </h4><br><blockquote>  It goes without saying that it will be a good idea. <br><br>  - Rob Pike </blockquote>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Go support has been in the gdb debugger for a long time, but there are still a lot of <a href="https://golang.org/doc/gdb">small but unpleasant problems</a> that prevented it from being fully used.  There is also a <a href="https://github.com/derekparker/delve">delve</a> project, but it is difficult to draw conclusions about its popularity.  In any case, the ‚Äúclassic‚Äù approaches to writing a debugger for Go invariably came up against the difficulty of implementation, especially when it comes to Go-specific things like debuggling Gourutine. <br><br>  Jeremy Schlatter from Mailgun, which uses Go quite actively, chose a completely different approach - he took the same idea as the basis for the go coverage tool, the embedded test system and some others: changing the code on the fly before compiling.  This approach was generally possible due to two main points - a huge compilation speed and simple grammar of the language.  The tools for parsing go-grammar (go / ast and go / parser) built into stdlib make it easy to modify the code of a compiled program on the fly, which opens up a whole new layer of possibilities. <br><br><h4>  Example </h4><br>  For example, take a simple program on Go: <br><pre><code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hello</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { fmt.Println(text) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { fmt.Printf(<span class="hljs-string"><span class="hljs-string">"Hello,"</span></span>) hello(<span class="hljs-string"><span class="hljs-string">"world"</span></span>) }</code> </pre> <br>  And run godebug with the output command to view the generated code: <br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/mailgun/godebug/lib"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> main_go_scope = godebug.EnteringNewScope(main_go_contents) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hello</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { ctx, ok := godebug.EnterFunc(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { hello(text) }) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !ok { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> godebug.ExitFunc(ctx) scope := main_go_scope.EnteringNewChildScope() scope.Declare(<span class="hljs-string"><span class="hljs-string">"text"</span></span>, &amp;text) godebug.Line(ctx, scope, <span class="hljs-number"><span class="hljs-number">6</span></span>) fmt.Println(text) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { ctx, ok := godebug.EnterFunc(main) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !ok { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } godebug.Line(ctx, main_go_scope, <span class="hljs-number"><span class="hljs-number">10</span></span>) fmt.Printf(<span class="hljs-string"><span class="hljs-string">"Hello,"</span></span>) godebug.Line(ctx, main_go_scope, <span class="hljs-number"><span class="hljs-number">11</span></span>) hello(<span class="hljs-string"><span class="hljs-string">"world"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> main_go_contents = <span class="hljs-string"><span class="hljs-string">`package main import "fmt" func hello(text string) { fmt.Println(text) } func main() { fmt.Printf("Hello,") hello("world") } `</span></span></code> </pre><br>  Without going into the details of each function, it is clear that on each line are the functions identifiers of strings, the input and output of functions, the declaration of variables, and so on.  Runtime debugger is already working with these added functions, having full information about the program. <br><br><h4>  Demo </h4><br>  This approach, of course, is not universal and has its limitations and drawbacks, but its relative simplicity and advantages are obvious.  One of the demonstrations of the strengths of this approach is the ability to debug directly in the browser using gopherjs: <a href="https://focused-sprite-91100.appspot.com/playground/blog-post">focused-sprite-91100.appspot.com/playground/blog-post</a> - try it yourself. <br><br> <a href="https://focused-sprite-91100.appspot.com/playground/blog-post"><img src="https://habrastorage.org/files/0c5/905/312/0c590531275e49898b5ef9ce16839f5f.jpg"></a> <br><br>  There are some nuances to the fact that the native line numbering is broken - this can affect, say, loggers / tracers, which will report the line number.  But in general, for most cases, this approach works with a bang. <br><br><h4>  Installation </h4><br>  Installing a debugger is no different than installing any other Go-program: <br><pre> <code class="bash hljs">go install github.com/mailgun/godebug</code> </pre> <br><h4>  Using </h4><br>  Using debugger is very simple: <br><pre> <code class="bash hljs">$ godebug godebug is a tool <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> debugging Go programs. Usage: godebug <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> [arguments] The commands are: run compile, run, and debug a Go program <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> compile, run, and debug Go package tests output generate debug <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> code, but <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> not build or run it Use <span class="hljs-string"><span class="hljs-string">"godebug help [command]"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> more information about a <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>.</code> </pre> <br>  godebug run * .go - compiles with debug support all sources in current directory.  All additional packages used in the code, both their own and external - are compiled natively, without debugging - this is done on purpose so as not to slow down the code where it is not needed.  If you need to debug the code in some included packages, they must be specified using the -instrument flag: <br><br><pre> <code class="bash hljs">godebug run -instrument github.com/go-sql-driver/mysql main.go</code> </pre> <br>  The breakpoints in the program are set as follows: <br><pre> <code class="go hljs">_ = <span class="hljs-string"><span class="hljs-string">"breakpoint"</span></span></code> </pre> <br>  With a normal build, this code does nothing, and godebug will recognize it before compiling and insert a stop instruction. <br><br><h4>  Status </h4><br>  The project is ready for practical use, although only the most basic functions are supported so far: <br><ul><li>  list </li><li>  step </li><li>  next </li><li>  continue </li><li>  print </li></ul><br>  The plans support stop / inspection gorutin and other things that the community deems necessary / useful. <br><br><h4>  References: </h4><br><ul><li>  Detailed article - debugger announcement: <a href="http://blog.mailgun.com/introducing-a-new-cross-platform-debugger-for-go/">blog.mailgun.com/introducing-a-new-cross-platform-debugger-for-go</a> </li><li>  Slides from Jeremy's report on GoSF'15: <a href="https://go-talks.appspot.com/github.com/jeremyschlatter/godebug-talk/godebug.slide">go-talks.appspot.com/github.com/jeremyschlatter/godebug-talk/godebug.slide</a> </li><li>  Video report: <a href="https://www.youtube.com/watch%3Fv%3Dqo4RAPxCTa0">www.youtube.com/watch?v=qo4RAPxCTa0</a> </li><li>  Github: <a href="https://github.com/mailgun/godebug">github.com/mailgun/godebug</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/256355/">https://habr.com/ru/post/256355/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../256345/index.html">Control robots created with LEGO¬Æ Mindstorms¬Æ NXT Brick using the Wolfram Language (Mathematica)</a></li>
<li><a href="../256347/index.html">Checking the Haiku operating system (BeOS family) with PVS-Studio. Part 1</a></li>
<li><a href="../256349/index.html">GSM module control with AVR</a></li>
<li><a href="../256351/index.html">Say a word about poor recursion, or all that you did not know and do not want to know about it</a></li>
<li><a href="../256353/index.html">Using the driver keys of the lower and upper levels of the IR2110 - an explanation and examples of schemes</a></li>
<li><a href="../256357/index.html">IT resources under control</a></li>
<li><a href="../256359/index.html">The correct bonus for your new server</a></li>
<li><a href="../256361/index.html">New spam: How scammers use interactive robots from the cloud</a></li>
<li><a href="../256363/index.html">Google suggests strengthening JSON with Jsonnet</a></li>
<li><a href="../256365/index.html">We implement secure VPN protocol</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>