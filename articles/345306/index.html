<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Working with the in-memory database using Intel Optane</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we are publishing a guest post, written in collaboration with Konstantin Boyandin - a system administrator from Novosibirsk. 

 Konstantin used ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Working with the in-memory database using Intel Optane</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/gw/0q/px/gw0qpxcdwzmg8s3vw4_uqpt9q24.png"><br><br>  Today we are publishing a guest post, written in collaboration with Konstantin Boyandin - a system administrator from Novosibirsk. <br><br>  Konstantin used a server with an Intel Optane SSD to work with the in-memory database (memcached, Redis in the appropriate mode, Apache ignite, and so on).  The Intel Optane SSD DC P4800X storage device used in the tests was connected as an IMDT (using Intel Memory Drive Technology), available to the OS and applications as random access memory. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Another area of ‚Äã‚Äãapplication may be the use of a Memory Drive to maintain a large farm of virtual machines.  It is assumed that a large amount of RAM in this case will significantly simplify and cheapen the procedure for testing software products. <br><br>  NVMe alone is not news.  NVMe in Memory Drive mode is something new.  For one of the projects that Konstantin is involved in, it is important to efficiently process a large amount of data.  Test results are the most encouraging, DRAM-mode using Intel Memory Drive Technology will help to significantly reduce processing resources. <br><br>  We hope that the experience of Constantine will be of interest to our readers. <br><a name="habracut"></a><br><h2>  Task Description </h2><br>  The issue of Intel Optane performance in the IMDT mode was investigated (the Redis and memcached performance tests delivered in the Phoronix testing package were run, as well as the RAM performance test, ramspeed, from the same package).  The same tests worked with Intel Optane in IMDT mode, and, for comparison, with Intel Optane media disconnected, on the same server and the same OS. <br><br>  The testing server is running CentOS 7.4 (64-bit), and on the following hardware components: <br><br><ul><li>  Motherboard: Supermicro X10SRi-F </li><li>  RAM: 64Gb (8x8), 2133MHz </li><li>  Processor: Intel¬Æ Xeon¬Æ E5-1650 v4 (3.60GHz) </li><li>  Drives (SATA): Intel SSD DC S3700 (480Gb) </li><li>  NVMe drive: Intel Optane SSD DC P4800X (375Gb) </li></ul><br>  The first phase of the tests was carried out without rebooting. <br><br>  Briefly about these DBMS: <br><br><ul><li>  <a href="http://memcached.org/" rel="nofollow noopener noreferrer">Memcached is</a> used to store and quickly retrieve data in a key-value format;  originally created to speed up the blog service LiveJournal, in 2003. </li><li>  <a href="https://redis.io//" rel="nofollow noopener noreferrer">Redis</a> (short for ‚Äúremote dictionary server‚Äù, ‚Äúremote vocabulary server‚Äù) is a networked logged data repository focused on high-speed data processing.  In this case, configured to work only in RAM without resetting WAL (change log in case of emergency shutdown) to disk. </li></ul><br>  The purpose of the tests: to compare the performance of the mentioned DBMS using storage in RAM, in the case of using the IMDT mode and without the participation of NVMe in general. <br><br><h2>  Preparation for work </h2><br>  For tests, ramspeed tests (operations in RAM), redis (Redis performance), mcperf (memcached performance), running CentOS 7.4 (64-bit) were selected. <br><br>  In both cases, the OS did not use the upload file (swap), so as not to distort the test results. <br><br>  The Phoronix test suite 7.4 package (and the redis, mcperf included in it) was used, as well as the ramspeed 3.5 package. <br><br>  In the configuration "Intel Optane in IMDT mode" (hereinafter "IMDT"), the OS and applications have 320Gb RAM available. <br><br>  In the configuration with disabled Intel Optane (hereinafter "RAM") OS and applications, 64Gb of RAM is available. <br><br>  In each case, at least three test runs were run, averaged values ‚Äã‚Äãwere used (arithmetic average).  All services to be tested rebooted before each test run. <br><br><h2>  Measurements, practical examples and use cases </h2><br>  For testing the <a href="https://haritibcoblog.com/2016/07/16/simple-utility-to-allocate-memory-on-a-linux-machine/" rel="nofollow noopener noreferrer">memtest</a> program was <a href="https://haritibcoblog.com/2016/07/16/simple-utility-to-allocate-memory-on-a-linux-machine/" rel="nofollow noopener noreferrer">used</a> .  The memory was taken randomly from the range of 50-75% of the area not used by the test. <br><br><h3>  Ramfs sequential entry </h3><br>  The first test was to measure the performance of RAM connected as ramfs (sequential write), the following commands were used: <br><br>  IMDT: <br><pre><code class="python hljs">mkdir -p /mnt/ram mount -t ramfs -o size=<span class="hljs-number"><span class="hljs-number">300</span></span>G ramfs /mnt/ram dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=/dev/zero of=/mnt/ram/<span class="hljs-number"><span class="hljs-number">256</span></span>gb.dat bs=<span class="hljs-number"><span class="hljs-number">4096</span></span> count=<span class="hljs-number"><span class="hljs-number">67108864</span></span></code> </pre> <br>  Total: <br>  274877906944 bytes (275 GB) copied, 184,756 s, 1,5 GB / s <br><br>  RAM: <br><pre> <code class="python hljs">mkdir -p /mnt/ram mount -t ramfs -o size=<span class="hljs-number"><span class="hljs-number">62</span></span>G ramfs /mnt/ram dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=/dev/zero of=/mnt/ram/<span class="hljs-number"><span class="hljs-number">60</span></span>gb.dat bs=<span class="hljs-number"><span class="hljs-number">4096</span></span> count=<span class="hljs-number"><span class="hljs-number">15728640</span></span></code> </pre><br>  Total: <br>  64424509440 bytes (64 GB) copied, 18.0382 s, 3.6 GB / s <br><br>  The ramfs filesystems are unmounted before the rest of the tests are run. <br><br><h3>  Redis test </h3><br>  In testing, it was checked how many DB commands (SADD, LPUSH, SET, GET) were executed per second. <br><br>  The higher the value, the better the performance: <br><br><ul><li>  IMDT - in the Intel Optane configuration, 320Gb of RAM is available for applications; </li><li>  RAM - 64Gb of RAM is available for applications with Intel Optane disabled. </li></ul><br><table><tbody><tr><td>  Redis v3.2.10 </td><td>  <b>IMDT</b> </td><td>  <b>Ram</b> </td></tr><tr><td>  SADD </td><td>  1,748,516.67 </td><td>  1,727,879.00 </td></tr><tr><td>  LPUSH </td><td>  1,343,129.58 </td><td>  1 310 077.82 </td></tr><tr><td>  SET </td><td>  1 562 944.63 </td><td>  1,490,965.52 </td></tr><tr><td>  Get </td><td>  2,026,167.62 </td><td>  2,213,292.12 </td></tr></tbody></table><br><br><img src="https://habrastorage.org/webt/qt/vx/6x/qtvx6xsafrd3de0lz3nodtqg0bo.png"><br><br><h3>  Mcperf test </h3><br>  In testing, it was checked how many commands per second are executed for 1 and 5 simultaneous connections (speed is measured in commands per second for each connection). <br><table><tbody><tr><td rowspan="2">  Memcached v1.4.15 </td><td colspan="2">  <b>IMDT</b> </td><td colspan="2">  <b>Ram</b> </td></tr><tr><td>  one </td><td>  five </td><td>  one </td><td>  five </td></tr><tr><td>  add </td><td>  54 931.2 </td><td>  55 197.2 </td><td>  59 613.9 </td><td>  59 174.8 </td></tr><tr><td>  delete </td><td>  85 361.3 </td><td>  83 259.4 </td><td>  89 181.6 </td><td>  88 235.4 </td></tr><tr><td>  append </td><td>  57 834.2 </td><td>  57 666.1 </td><td>  59 252.8 </td><td>  60 652.4 </td></tr><tr><td>  prepend </td><td>  58 441.9 </td><td>  58 168.5 </td><td>  59 359.3 </td><td>  60 115.8 </td></tr><tr><td>  replace </td><td>  57,231.2 </td><td>  57 046.0 </td><td>  59 223.5 </td><td>  59 233.0 </td></tr><tr><td>  get </td><td>  86 657.0 </td><td>  85 842.8 </td><td>  89 468.9 </td><td>  89 107.4 </td></tr><tr><td>  set </td><td>  54 546.9 </td><td>  55 570.1 </td><td>  58 311.6 </td><td>  57 725.3 </td></tr></tbody></table><br><br><img src="https://habrastorage.org/webt/zz/sf/xs/zzsfxsosgw5qzphd5iy6krpiizy.png"><br><br><h3>  Ramspeed test </h3><br>  Tests were conducted for 4 concurrent threads.  Where it matters, the size of the memory block used is 4096 bytes.  The higher the value (MB per second), the better the performance. <br><table><tbody><tr><td>  <a href="http://alasir.com/software/ramspeed/">Ramspeed v3.5</a> (smp) </td><td>  <b>IMDT</b> </td><td>  <b>Ram</b> </td></tr><tr><td>  Integer &amp; read </td><td>  104 548.28 </td><td>  112,535.63 </td></tr><tr><td>  Integer &amp; write </td><td>  33,238.73 </td><td>  34,085.68 </td></tr><tr><td>  Integer copy </td><td>  30,063.08 </td><td>  30 105.97 </td></tr><tr><td>  Integer scale </td><td>  29,916.03 </td><td>  29 757.79 </td></tr><tr><td>  Integer add </td><td>  33,356.14 </td><td>  33,192.47 </td></tr><tr><td>  Integer triad </td><td>  33,235.32 </td><td>  33,184.95 </td></tr><tr><td>  Floating Point &amp; Reading </td><td>  102,796.84 </td><td>  106 513.01 </td></tr><tr><td>  Floating point &amp; writing </td><td>  33,826.04 </td><td>  34 037.25 </td></tr><tr><td>  Floating point copy </td><td>  30,061.67 </td><td>  30,060.73 </td></tr><tr><td>  Floating point scale </td><td>  30,094.47 </td><td>  29,964.92 </td></tr><tr><td>  Floating point add </td><td>  33,144.85 </td><td>  32 979.58 </td></tr><tr><td>  Floating point triad </td><td>  33,184.84 </td><td>  33,149.31 </td></tr></tbody></table><br><br><img src="https://habrastorage.org/webt/bj/rn/ou/bjrnouqeifa4neen72otmjz-sh4.png"><br><br><h2>  Conclusion </h2><br>  The tests demonstrated that when using Intel Optane in the IMDT mode, despite the noticeable difference in the write speed to the file (using the standard dd command), in general, the performance of the DBMS storing data in memory is comparable. <br><br>  The advantage of NVMe in the IMDT mode is that it is technically impossible for most servers to install the appropriate number of RAM modules in order to get the same amount of available RAM. <br><br>  In terms of cost-performance (for 8Gb Kingston DDR4 2133MHz RAM modules), the equivalent Intel Optane carrier will be twice as cheap (note that the Optane used in these tests is not optimal in terms of cost-performance ratio). <br><br>  For both cases of using Memory Drive (that is, a large amount of RAM) or there is no technical possibility to install as much memory (there are no such motherboards), or the price of this configuration is at least 2 times higher (when calculating the equivalent amount of RAM). <br><br>  It can be assumed that NVME with Memory Drive support will be cheaper (now it is a relative rarity and has a high cost), so a gain in terms of cost-performance may become even more noticeable. <br><br>  Using NMVe in IMDT mode seems promising in cases where a large amount of RAM is required (large databases like Redis / memcached, a large number of virtual machines on one host, and so on). <br><br>  In the above tests, conditional performance was considered sufficient.  Building a simulation of the environment where you can run tests that are close to the design ones took too much time. <br><br><blockquote>  <b>The author of the article</b> <br><br><img src="https://habrastorage.org/webt/sf/hc/4i/sfhc4iwlheofxswbm2m5iv-60a4.jpeg" width="120" height="120" align="left"><br>  Konstantin Boyandin, Provide Labs LLC, Novosibirsk. <br><br>  Engaged in software development and system administration, as well as security issues. </blockquote></div><p>Source: <a href="https://habr.com/ru/post/345306/">https://habr.com/ru/post/345306/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345296/index.html">Ratings of car brands: an example of analyzing variables with multiple response</a></li>
<li><a href="../345298/index.html">Automatic update of LetsEncrypt certificates in MDaemon mail server: step-by-step instructions</a></li>
<li><a href="../345300/index.html">Free Software Developer Self-Financing Guide</a></li>
<li><a href="../345302/index.html">Distributed Team Anatomy - Requirements Preparation Process</a></li>
<li><a href="../345304/index.html">‚ÄúVery handles‚Äù: make Tableau / Qlik from R and ‚Äúblue tape‚Äù</a></li>
<li><a href="../345310/index.html">Predict outflow using neural network</a></li>
<li><a href="../345312/index.html">New Year's post good</a></li>
<li><a href="../345314/index.html">I want to program, let them teach me! Avito educational projects</a></li>
<li><a href="../345316/index.html">Pay attention to people, not technology.</a></li>
<li><a href="../345318/index.html">AI teaches the language: why do you need a hackathon on machine translation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>