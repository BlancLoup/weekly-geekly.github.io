<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Restore D-link DVG-N5204SP via UART</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The theme of the firmware of routers through the UART interface is heavily trashed, cheated, but I could not find information on my router, so I think...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Restore D-link DVG-N5204SP via UART</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/cff/f86/e75/cfff86e75237732eeb63c1547dc1f663.jpg" alt="image"><br><br>  The theme of the firmware of routers through the UART interface is heavily trashed, cheated, but I could not find information on my router, so I think this topic will be useful, especially since there are a few questions on the forums about this, so they remain unanswered. <br><br>  I got into the hands of a sabzheviy router, got for free, because "something did not work." 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Having brought home, I found out that the router refuses to raise the LAN ports, while it pushes the other indicators while booting, and the WAN port picks up.  Resetting with the Reset button did not help, although the lights behaved the same way as when resetting. <br><br>  Well, well, there is a freebie freebie, and I really wanted to use this router to access the Internet via 3G / 4G flash drives in a country house.  Yes, and with the possibility of raising the SIP Megaphone on it for the sake of interest. <br><a name="habracut"></a><br><img src="https://habrastorage.org/getpro/habr/post_images/159/0e7/4ff/1590e74ff97cbaa8b7eb79eaf26984cc.jpg" alt="image"><br><br>  Having read the manuals, I realized that none of the described ways to enter Emergency mode did not work, although when turning on the power and holding the Reset button, the router clearly entered into some mode in which the LAN ports were normally raised, but described in the <b>192.168.80.20</b> network manuals <b>/ 24, 192.168.1.2/24, 192.168.0.2/24, 192.168.8.10/24</b> did not match, no address was answered ( <b>192.168.80.21, 192.168.1.1, 192.168.0.1, 192.168.8.254</b> ). <br><br>  I thought it was time to open this piece of iron to look at the insides: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bfe/4f5/f86/bfe4f5f867bbec7b2dc769e3c76a624a.jpg" alt="image"><br><br>  The already soldered <b>UART</b> was noticed, in the lower left corner, over the <b>WAN</b> LED, it remained only to pick up the adapter and use it. <br><br>  The local store bought a <b>DCU-15</b> cable on PL2303 for 30p, disassembled and soldered to the right pins (do not swear for soldering, everything was done with a Chinese gas soldering iron for 150p, which barely warms, just wanted to give him a chance to live life for good reason): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/96a/b4c/307/96ab4c307764d8d896bb713661b16c3c.jpg" alt="image"><br><br>  The manuals for connecting telephone data cables to the UART ports are complete, so I will not describe it again. <br>  For the connection I used Putty, an adequate transmission started at <b>38400 baud</b> , it must be set in Putty and in the settings of the USB-COM port: <br><br><div class="spoiler">  <b class="spoiler_title">Settings</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/cee/423/37d/cee42337d904e98c4014db4fa5be62a0.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/401/b08/ecb/401b08ecb6119a10e1a52638138e9432.png" alt="image"></div></div><br><br>  When turned on, the router cheerfully issued a list, asking me what I would like to do: <br><br>  DDR DRAM 32 MB @ 195 MHz, SPI FLASH 8 M <br>  --- Octtel (RTL89xxB) at 2011.05.16-13: 42 + 0800 version 1.1.26.0 [16bit] (390MHz) <br>  --- Wireless regDomain --- MAC Address: 84: c9: b2: xx: xx: xx <br><br>  Press 'i' to update system image. <br>  Press 'k' to update kernel image. <br>  Press 'r' to update root fs image. <br>  Press 'l' to update loader. <br>  Press 'c' to change target IP <br>  Press 't' to change TFTP server IP <br>  Press 'z' to change network MAC number config. <br>  Press 'm' to change MAC and SN config. <br>  Press 'y' to change wireless regDomain config. <br><br>  There are many manuals for updating / restoring firmware for D-link DIR-300 and the like in the network, it describes how to restore the firmware directly by downloading from the server tftp, but not a single update item of this router requested the required file (firmware file downloaded from FTP D-link 'a has the .pack extension, and was already waiting for downloading on the tftp server). <br>  I was temporarily disheartened, and I thought, maybe I can get something from the logs of the initial load of the router.  If someone wants to see, I post on a known resource: <br><br>  <a href="http://pastebin.com/hS9zVx5z">http://pastebin.com/hS9zVx5z</a> <br><br>  Spoiler for the log for some reason did not want to work, if someone tells me why, I will be grateful, and I will transfer it to the article. <br><br>  In the logs did not find any mention of the available networks. <br><br>  After the device was fully loaded, it became possible to use command input, which was implemented: <br><br>  # ifconfig <br>  br0 Link encap: Ethernet HWaddr 84: C9: B2: XX: XX: XX <br>  inet addr: 192.168.8.254 Bcast: 192.168.8.255 Mask: 255.255.255.0 <br>  UP BROADCAST RUNNING MULTICAST MTU: 1500 Metric: 1 <br>  RX packets: 0 errors: 0 dropped: 0 overruns: 0 frame: 64 <br>  TX packets: 41 errors: 0 dropped: 0 overruns: 0 carrier: 0 <br>  collisions: 0 txqueuelen: 0 <br>  RX bytes: 23275 (22.7 KiB) TX bytes: 0 (0.0 B) <br><br>  eth0 Link encap: Ethernet HWaddr 84: C9: B2: XX: XX: XX <br>  UP BROADCAST RUNNING MULTICAST MTU: 1500 Metric: 1 <br>  RX packets: 0 errors: 0 dropped: 0 overruns: 0 frame: 0 <br>  TX packets: 41 errors: 0 dropped: 0 overruns: 0 carrier: 0 <br>  collisions: 0 txqueuelen: 128 <br>  RX bytes: 0 (0.0 B) TX bytes: 1722 (1.6 KiB) <br>  Interrupt: 15 <br><br>  <b>eth1</b> Link encap: Ethernet HWaddr 84: C9: B2: XX: XX: XX <br>  inet addr: <b>192.168.8.254 Bcast: 192.168.8.255 Mask: 255.255.255.252</b> <br>  UP BROADCAST RUNNING MULTICAST MTU: 1500 Metric: 1 <br>  RX packets: 6320 errors: 0 dropped: 0 overruns: 0 frame: 0 <br>  TX packets: 1562 errors: 0 dropped: 0 overruns: 0 carrier: 0 <br>  collisions: 0 txqueuelen: 128 <br>  RX bytes: 1176595 (1.1 MiB) TX bytes: 1301150 (1.2 MiB) <br>  Interrupt: 15 <br><br>  lo Link encap: Local Loopback <br>  inet addr: 127.0.0.1 Mask: 255.0.0.0 <br>  UP LOOPBACK RUNNING MTU: 16436 Metric: 1 <br>  RX packets: 14 errors: 0 dropped: 0 overruns: 0 frame: 0 <br>  TX packets: 14 errors: 0 dropped: 0 overruns: 0 carrier: 0 <br>  collisions: 0 txqueuelen: 0 <br>  RX bytes: 1100 (1.0 KiB) TX bytes: 1100 (1.0 KiB) <br><br>  As you can see, the br0 and eth1 interfaces have the same IP, but in the case of eth1, the usual link network \ 30 is configured. <br>  It was decided to connect the cable to the WAN port to test this network.  The router raised the port, and in the console brought out the fun: <br><br>  <b>NCS: Connection WAN established, IP = 192.168.8.254 Subnet Mask = 255.255.255.252</b> <br><br>  With the thoughts ‚Äúwell, now I don‚Äôt hide from me,‚Äù I climbed to the <b>192.168.8.253/30</b> network card <br><br>  All 4 sent packets did not return alive, but the router in the console responded: <br>  <b>NCS: Icmp-Smurf attack detected, SA = 192.168.8.253 DA = 192.168.8.254</b> <b><br></b>  <b>NCS: Icmp-Smurf attack detected, SA = 192.168.8.253 DA = 192.168.8.254</b> <b><br></b>  <b>NCS: Icmp-Smurf attack detected, SA = 192.168.8.253 DA = 192.168.8.254</b> <b><br></b>  <b>NCS: Icmp-Smurf attack detected, SA = 192.168.8.253 DA = 192.168.8.254</b> <br><br>  The next attempt to log in via telnet was a success, immediately climbed into the browser to launch the web-muzzle.  It started !!!  Joy knew no bounds.  Now I had to try to restart it through the interface, these routers agree to upload the firmware via tftp only with <b>IP 192.168.8.56</b> , so at this stage it was too early to think about the firmware. <br><br>  What is strange is the settings of his WAN interface, which he shone: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b7c/d68/55b/b7cd6855ba7187a31e554da8ed281b7b.png" alt="image"><br><br>  After reset via the web, the router ceased to glow via the WAN, and the LAN interfaces did not rise either.  But WLAN has risen. <br><br>  It was decided to let him in the forehead: <br>  <b># ifconfig br0 down</b> <b><br></b>  <b># ifconfig br0 up</b> <br><br>  After connecting the cable to the LAN port, the lightbulb blinked merrily. <br><br>  The router was successfully flashed, connected to the Internet via a 3G modem.  It was raised SIP Megaphone, dreams come true. <br>  Then a lifelong rest in the clean air outside the city awaits him, will guard the site with a webcam. <br><br>  Thanks for attention!  I will be glad to adequate criticism. </div><p>Source: <a href="https://habr.com/ru/post/247995/">https://habr.com/ru/post/247995/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../247979/index.html">Automation of non-cash payments</a></li>
<li><a href="../247981/index.html">Asterisk + FreeSwitch + Skype. Detailed guide</a></li>
<li><a href="../247983/index.html">The basics of CG-drawing examples: draw an oscilloscope, apply 3D</a></li>
<li><a href="../247987/index.html">Backup audio records from a playlist on VKontakte (up to 6000) using Python and the VK API</a></li>
<li><a href="../247989/index.html">Melting Pot: Skyforge Fight</a></li>
<li><a href="../247997/index.html">Something from afar looking like monads</a></li>
<li><a href="../247999/index.html">Mathcad Express is a free math editor that few people know about.</a></li>
<li><a href="../248001/index.html">How I made a game under KolibriOS</a></li>
<li><a href="../248005/index.html">Qucs - open-source CAD for electronic circuit modeling.</a></li>
<li><a href="../248007/index.html">June 30, 2015 will be a second longer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>