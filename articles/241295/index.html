<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to quickly configure Kaspersky Anti-Virus on Juniper SRX gateway</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 It so happened that for the past few years I have been working as an instructor for Juniper Networks equipment in one of the authorized trai...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to quickly configure Kaspersky Anti-Virus on Juniper SRX gateway</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  It so happened that for the past few years I have been working as an instructor for Juniper Networks equipment in one of the authorized training centers in Moscow.  As many know, Juniper is a network equipment company ‚Äî routers, switches, and security devices.  It is not so well known that Juniper SRX security devices make it possible to check the traffic passing through them using a domestic anti-virus module (namely, Kaspersky Lab). <br><br><img src="https://habrastorage.org/files/3ab/967/8a5/3ab9678a5a70436b9b693372241b3499.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This article is designed for those people who already have a Juniper SRX and who want (or want to read) to try a bunch of Juniper-KAV in action. <br><br><a name="habracut"></a><br><br>  Junos Unified Threat Management (UTM) security complex, optionally available in the Juniper SRX line of gateways, includes anti-spam, web filtering, content filtering, as well as the famous Kaspersky Anti-Virus.  When enabled, these services provide effective additional protection for the perimeter of the network.  Despite this, many system administrators, for whatever reason, refuse to adopt UTM.  So, many are not ready to purchase additional licenses, do not want to waste time and effort on additional configuration, and also fear a possible decline in performance. <br><br>  This ‚Äúrecipe‚Äù allows you to easily generate 30-day trial license keys, as well as quickly set up a key element of the UTM complex - Full AV, a full-featured Kaspersky Anti-Virus, to protect the network from malware (viruses, worms, Trojans, polymorphic malware in HTTP). -, FTP and mail traffic).  A trial license will allow you to test the antivirus and, if you consider it appropriate, then purchase it, as well as facilitate familiarity with the antivirus and the procedure for its deployment.  You can activate a trial license once a year on each device with a specific serial number. <br><br>  The examples of commands and configurations given below are suitable for any models of the Juniper SRX branch line (‚Äúbranch‚Äù) with a large (from 1 GB) RAM (branch SRX line includes all models from SRX100 to SRX650).  To check your device model, run the following command: <br><br><pre><code class="tex hljs">pk@inet-gw&gt; show chassis hardware detail | match chassis Chassis XXXXXXXXXX SRX210H</code> </pre> <br><br>  If at the end of the model number you see the letters H or H2, then you can continue to configure the UTM functionality. <br><br>  To configure, you need an Internet connection (standard channel to your provider) and a configured DNS server.  For example, these parameters might look like this: <br><br><pre> <code class="tex hljs">pk@inet-gw&gt; show configuration | display set | match "name-server|0.0.0.0" set system name-server 8.8.8.8 set routing-options static route 0.0.0.0/0 next-hop 192.168.1.254</code> </pre><br><br>  I mean that currently your device does not have a license for Kaspersky Anti-Virus for Juniper, but if in doubt, run the following command: <br><br><pre> <code class="tex hljs">pk@inet-gw&gt; show system license</code> </pre><br><br>  As a result, the system will display all licenses activated for the current device.  Then, to generate test keys, run the command: <br><br><pre> <code class="tex hljs">pk@inet-gw&gt; request system license update trial</code> </pre><br>  (To obtain trial keys, you must have an Internet connection and a correctly configured DNS.) Repeat the show system license command after a few minutes to make sure that the keys are added to the repository.  The system should display something in the spirit of: <br><br><pre> <code class="tex hljs">pk@inet-gw&gt; show system license License usage: Licenses Licenses Licenses Expiry Feature name used installed needed av_key_kaspersky_engine 0 1 0 2014-11-04 00:00:00 UTC .............</code> </pre><br><br>  If the new license does not appear, check the errors in the log file (show log messages command). <br><br>  If the license is successfully obtained, then you need to configure the UTM functionality - in our case, Kaspersky Anti-Virus.  Do not be afraid of the theoretical calculations below - in fact, one team is enough to get started! <br><br>  In general, to configure UTM on the Juniper SRX gateway, you need to configure the following interconnected elements: <br><br><ul><li>  The UTM-functional profile (UTM profile), into which the individual settings of the selected elements are placed (in our case, the antivirus) <br></li><li>  UTM policy (UTM policy) that refers to UTM-functional profiles for different types of traffic (if in simple terms, this guide for the gateway: ‚Äúperform anti-virus scanning of HTTP traffic using settings from the my-profile Ô¨Å-le-1 profile‚Äù) <br></li><li>  A security policy that allows traffic and directs it to the UTM (and refers to the UTM policy). <br></li></ul><br><br>  At first glance, everything looks difficult, but these parameters allow you to flexibly configure the gateway for all sorts of operating scenarios.  And one more good news - in the Junos system, there are initially ready (default) profiles of the UTM functionality and UTM policies for the antivirus (and other UTM elements).  To view them, you need to run the following configuration commands (they refer to the hidden configuration group junos-defaults, which stores the Junos default settings): <br><br><pre> <code class="tex hljs">pk@inet-gw# show groups junos-defaults security utm feature-profile anti-virus kaspersky-lab-engine { pattern-update { url http://update.juniper-updates.net/AV/JSR/; interval 60; } profile junos-av-defaults { fallback-options { default log-and-permit; corrupt-file log-and-permit; password-file log-and-permit; decompress-layer log-and-permit; content-size log-and-permit; engine-not-ready log-and-permit; timeout log-and-permit; out-of-resources log-and-permit; too-many-requests log-and-permit; } scan-options { intelligent-prescreening; scan-mode all; content-size-limit 10000; timeout 180; decompress-layer-limit 2; } notification-options { virus-detection { type message; no-notify-mail-sender; custom-message "VIRUS WARNING"; } fallback-block { type message; no-notify-mail-sender; } } } } pk@inet-gw# show groups junos-defaults security utm utm-policy junos-av-policy anti-virus { http-profile junos-av-defaults; ftp { upload-profile junos-av-defaults; download-profile junos-av-defaults; } smtp-profile junos-av-defaults; pop3-profile junos-av-defaults; imap-profile junos-av-defaults; }</code> </pre><br><br>  As you can see, the system displays the already configured profile junior-av-defaults UTM functionality referenced by junos-av-policy.  The specific settings in the default profile depend on the hardware of the gateway.  You can both work with the default profile and policies, and create individual profiles and policies based on them.  In the first case, in order to successfully start working with UTM, it is enough to add links to UTM policies to the required security policies, indicating that the traffic must be scanned by the antivirus (it is not necessary to scan all traffic with the antivirus). <br><br>  For example, if you have a policy that regulates the transfer of HTTP and FTP traffic from trusted to a non-trusted zone: <br><br><pre> <code class="tex hljs">pk@inet-gw# show security policies from-zone Trust to-zone Untrust policy Trust-to-Untrust { match { source-address any; destination-address any; application [ junos-http junos-ftp ]; } then { permit; } } }</code> </pre><br><br>  then you can activate the antivirus using the following command, and then evaluate the result: <br><br><pre> <code class="tex hljs">pk@inet-gw# set security policies from-zone Trust to-zone Untrust policy Trust-to-Untrust then permit application-services utm-policy junos-av-policy pk@inet-gw# show security policies from-zone Trust to-zone Untrust from-zone Trust to-zone Untrust { policy Trust-to-Untrust { match { source-address any; destination-address any; application [ junos-http junos-ftp ]; } then { permit { application-services { utm-policy junos-av-policy; } } } } }</code> </pre><br><br>  And don't forget to commit. <br><br>  Now, with the help of the following command, make sure that the UTM functionality works and the virus signature database is uploaded to the SRX gateway (by default, it is automatically updated every 60 minutes): <br><br><pre> <code class="tex hljs">pk@inet-gw&gt; show security utm anti-virus status UTM anti-virus status: Anti-virus key expire date: 2014-07-04 00:00:00 Update server: http://update.juniper-updates.net/AV/SRX240/ Interval: 60 minutes Pattern update status: next update in 52 minutes Last result: new database loaded Anti-virus signature version: 06/21/2014 20:24 GMT, virus records: 561261 Anti-virus signature compiler version: N/A Scan engine type: kaspersky-lab-engine Scan engine information: last action result: No error(0x00000000)</code> </pre><br><br>  Now let's test the freshly installed Kaspersky Anti-Virus for Juniper.  To do this, we will try to download the EICAR test file from the server to the final host (this harmless file is specifically designed to test the antivirus; it can be downloaded from <a href="http://www.eicar.org/">http://www.eicar.org</a> ): <br><br><pre> <code class="tex hljs">lab@host&gt; ftp 192.168.1.112 Connected to 192.168.1.112. 220 (vsFTPd 2.0.5) Name (192.168.1.112:lab): lab 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp&gt; get eicar.com local: eicar.com remote: eicar.com 200 PORT command successful. Consider using PASV. 150 Opening BINARY mode data connection for eicar.com (68 bytes). |**********************************************************************************************************************************************************| 100<span class="hljs-comment"><span class="hljs-comment">% 95 --:-- ETA 550 192.168.1.112:21-&gt;10.1.0.15:51306 VIRUS WARNING For eicar.com with virus EICAR-Test-File. 95 bytes received in 0.00 seconds (129.03 KB/s) ftp&gt; bye 221 Goodbye.</span></span></code> </pre><br><br>  As you can see, the antivirus did not allow the file to be downloaded (more precisely, its contents were replaced with a warning about a virus, and the same warning was displayed by an FTP client).  Now you can check the logs and statistics: <br><br><pre> <code class="tex hljs">pk@inet-gw&gt; show log messages | match AV_VIRUS Oct 24 06:18:31 inet-gw RT_UTM: AV_VIRUS_DETECTED_MT: AntiVirus: Virus detected: from 192.168.1.112:20 to 10.1.0.15:14375 source-zone Untrust eicar.com file eicar.com virus EICAR-Test-File URL:http://www.viruslist.com/en/search?VN=EICAR-Test-File username N/A roles N/A pk@inet-gw&gt; show security utm anti-virus statistics UTM Anti Virus statistics: Intelligent-prescreening passed: 0 MIME-whitelist passed: 0 URL-whitelist passed: 0 Scan Mode: scan-all: 1 Scan-extension: 0 Scan Request: Total Clean Threat-found Fallback 1 0 1 0 .....</code> </pre><br><br>  From the output of the command it is clear that at this stage the antivirus is working correctly. <br><br>  In conclusion, I note that using Kaspersky Anti-Virus for the Juniper SRX gateway seems advisable, even if you already have another anti-virus installed on the network end nodes.  The basic configuration of Kaspersky Anti-Virus for Juniper SRX is extremely simple, moreover, you can evaluate its effectiveness at no cost by using a trial license. <br><br>  Additional information about configuring antivirus for Juniper SRX and the available options can be found at the following links: <br>  <a href="http://www.juniper.net/us/en/local/pdf/app-notes/3500158-en.pdf">http://www.juniper.net/us/en/local/pdf/app-notes/3500158-en.pdf</a> <br>  <a href="http://www.juniper.net/us/en/local/pdf/app-notes/3500153-en.pdf">http://www.juniper.net/us/en/local/pdf/app-notes/3500153-en.pdf</a> <br>  The following articles from the Juniper Knowledge Base may also be helpful: <br>  <a href="http://kb.juniper.net/InfoCenter/index%3Fpage%3Dcontent%26id%3DKB16620">http://kb.juniper.net/InfoCenter/index?page=content&amp;id=KB16620</a> <br>  <a href="http://kb.juniper.net/InfoCenter/index%3Fpage%3Dcontent%26id%3DKB17283">http://kb.juniper.net/InfoCenter/index?page=content&amp;id=KB17283</a> <br><br>  Thanks for attention!  Hope this information will be helpful.  I will try to answer your questions. </div><p>Source: <a href="https://habr.com/ru/post/241295/">https://habr.com/ru/post/241295/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../241277/index.html">LinkMeUp. Issue number 20. Xgu.ru and networking technology courses</a></li>
<li><a href="../241281/index.html">Recognition and automatic solution of equations</a></li>
<li><a href="../241283/index.html">Business consultant in small and medium-sized businesses. Who is it and why is it needed?</a></li>
<li><a href="../241289/index.html">VisionMobile Eighth Developer Economics Survey</a></li>
<li><a href="../241293/index.html">SSL3 protocol check in 20 bank clients</a></li>
<li><a href="../241297/index.html">Do you use the mouse while working?</a></li>
<li><a href="../241299/index.html">Resurrect FTDI in pictures</a></li>
<li><a href="../241301/index.html">MindStream. How do we write software under FireMonkey. Part 3. DUnit + FireMonkey</a></li>
<li><a href="../241303/index.html">We use closures in Swift in full</a></li>
<li><a href="../241305/index.html">As we voiced the stadium "Spartak"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>