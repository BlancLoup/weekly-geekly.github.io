<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>IP Tool - IP Address Database</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 


 For a long time I used the SxGeo library from zapimir . And until recently, everything was fine with me. Satisfied until it was neces...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>IP Tool - IP Address Database</h1><div class="post__text post__text-html js-mediator-article"><h1>  Introduction </h1><br><p>  For a long time I used the SxGeo library from <a href="https://habrahabr.ru/users/zapimir/" class="user_link">zapimir</a> .  And until recently, everything was fine with me.  Satisfied until it was necessary to add your data to the database. </p><br><p>  Not finding the data packer from SxGeo on the Internet and not finding the strength to demand the functionality I needed from the developer, it was decided to write my own crutch.  Although this decision was also influenced by 2 more drawbacks of the library used: </p><br><ul><li>  limit on the number of directories; </li><li>  the inability to know the interval of addresses, which includes the desired address; </li><li>  no packagist pack </li></ul><br><p>  Actually, I share with you my <a href="https://github.com/ddrv/iptool">development</a> . </p><a name="habracut"></a><br><p>  Differences between the prototype and my solution: </p><br><ul><li>  IPTool is just a tool for creating a database and searching in it, while the SxGeo project is a project that provides not only the tools, but also the databases themselves; </li><li>  The IPTool database takes up more space (because the first address of the range is stored completely and takes 4 bytes, while in SxGeo only 3 bytes); </li><li>  IPTool has only one mode - reading data from a disk (the mode of loading the base into memory is in the plans); </li><li>  In addition to the data, IPTool returns the range of IP addresses that the search address is for; </li><li>  IPTool provides methods for obtaining data from reference books (all or by ordinal number); </li><li>  The IPTool database provides for the possibility of licensing the database itself; </li><li>  IPTool is easily installed using <a href="https://getcomposer.org/">Composer</a> ; </li></ul><br><h1>  Using </h1><br><h2>  IP Tool Initialization </h2><br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/*     - /path/to/iptool.database */</span></span> $iptool = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Ddrv\Iptool\Iptool(<span class="hljs-string"><span class="hljs-string">'/path/to/iptool.database'</span></span>);</code> </pre> <br><h2>  Retrieving database information </h2><br><pre> <code class="php hljs">print_r($iptool-&gt;about());</code> </pre> <br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [created] =&gt; <span class="hljs-number"><span class="hljs-number">1507199627</span></span> [author] =&gt; Anonymous Author [license] =&gt; MIT [networks] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [count] =&gt; <span class="hljs-number"><span class="hljs-number">276148</span></span> [data] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [country] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [<span class="hljs-number"><span class="hljs-number">0</span></span>] =&gt; code [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; name ) ) ) )</code> </pre> <br><h2>  Search for IP Address Information </h2><br><pre> <code class="php hljs">print_r($iptool-&gt;find(<span class="hljs-string"><span class="hljs-string">'81.32.17.89'</span></span>));</code> </pre> <br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [network] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [<span class="hljs-number"><span class="hljs-number">0</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">81.32</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">81.48</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> ) [data] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [country] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [code] =&gt; es [name] =&gt; Spain ) ) )</code> </pre> <br><h2>  Get all items of the directory </h2><br><pre> <code class="php hljs">print_r($iptool-&gt;getRegister(<span class="hljs-string"><span class="hljs-string">'country'</span></span>));</code> </pre> <br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [code] =&gt; cn [name] =&gt; China ) [<span class="hljs-number"><span class="hljs-number">2</span></span>] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [code] =&gt; es [name] =&gt; Spain ) ... [N] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [code] =&gt; jp [name] =&gt; Japan ) )</code> </pre> <br><h2>  Receiving an item of the directory on its ordinal number </h2><br><pre> <code class="php hljs">print_r($iptool-&gt;getRegister(<span class="hljs-string"><span class="hljs-string">'country'</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>));</code> </pre> <br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [code] =&gt; cn [name] =&gt; China ) )</code> </pre> <br><p>  The process of creating a database is more time consuming, but it is described from the documentation, which is available in the repository and on the GitHub wiki in Russian and broken English. </p><br><h1>  UPD1.  Comparison of IPTool and SxGeo speeds </h1><br><p>  For more reliable results, I created a database for IPTool based on SxGeo data. </p><br><h3 id="podgotovka-k-sravnitelnomu-testu">  Preparing for the comparative test </h3><br><pre> <code class="hljs dos">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /<span class="hljs-built_in"><span class="hljs-built_in">path</span></span>/to/test/<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span> $ <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> csv $ <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> csv/sxgeo $ <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> t</code> </pre> <br><p>  you need to copy the files SxGeo.php and SxGeoCity.dat to the current directory (/ path / to / test / dir) </p><br><h3 id="ustanovka-iptool">  Install IPTool </h3><br><pre> <code class="hljs ruby">$ composer <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> ddrv/<span class="hljs-symbol"><span class="hljs-symbol">iptool:</span></span>~<span class="hljs-number"><span class="hljs-number">1.0</span></span></code> </pre> <br><h3 id="import-bd-sxgeo-v-csv-fayly">  Import SxGeo DB into csv files </h3><br><div class="spoiler">  <b class="spoiler_title">import.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   SxGeo  csv  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include_once</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'SxGeo.php'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExtSxGeo</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SxGeo</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseBase</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $s=<span class="hljs-number"><span class="hljs-number">0</span></span>; $firstIp = <span class="hljs-string"><span class="hljs-string">'0.0.0.0'</span></span>; $seek = <span class="hljs-number"><span class="hljs-number">0</span></span>; $data = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;parseCity($seek,<span class="hljs-number"><span class="hljs-number">1</span></span>); $sxNet = fopen(<span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'csv'</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'sxgeo'</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'sxNet.csv'</span></span>,<span class="hljs-string"><span class="hljs-string">'w'</span></span>); $sxCnt = fopen(<span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'csv'</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'sxgeo'</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'sxCnt.csv'</span></span>,<span class="hljs-string"><span class="hljs-string">'w'</span></span>); $sxRgn = fopen(<span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'csv'</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'sxgeo'</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'sxRgn.csv'</span></span>,<span class="hljs-string"><span class="hljs-string">'w'</span></span>); $sxCts = fopen(<span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'csv'</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'sxgeo'</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'sxCts.csv'</span></span>,<span class="hljs-string"><span class="hljs-string">'w'</span></span>); $ids = [ <span class="hljs-string"><span class="hljs-string">'cnt'</span></span> =&gt; [], <span class="hljs-string"><span class="hljs-string">'rgn'</span></span> =&gt; [], <span class="hljs-string"><span class="hljs-string">'cts'</span></span> =&gt; [], ]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($octet=<span class="hljs-number"><span class="hljs-number">1</span></span>;$octet&lt;=<span class="hljs-number"><span class="hljs-number">223</span></span>;$octet++) { $bip = pack(<span class="hljs-string"><span class="hljs-string">'C'</span></span>,$octet); $min = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;b_idx_arr[$octet<span class="hljs-number"><span class="hljs-number">-1</span></span>]; $max = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;b_idx_arr[$octet]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($b=$min; $b&lt;=$max;$b++) { fseek(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;fh, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db_begin + $b * <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;block_len); $block = fread(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;fh, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;block_len); $i = unpack(<span class="hljs-string"><span class="hljs-string">'C4'</span></span>,$bip.substr($block,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>)); $ip = implode(<span class="hljs-string"><span class="hljs-string">'.'</span></span>,$i); $lastIp = long2ip(ip2long($ip)<span class="hljs-number"><span class="hljs-number">-1</span></span>); $csvNet = [ $firstIp, $lastIp, $data[<span class="hljs-string"><span class="hljs-string">'city'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'region'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'country'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>], ]; fputcsv($sxNet,$csvNet); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($ids[<span class="hljs-string"><span class="hljs-string">'cts'</span></span>][$data[<span class="hljs-string"><span class="hljs-string">'city'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>]])) { $ids[<span class="hljs-string"><span class="hljs-string">'cts'</span></span>][$data[<span class="hljs-string"><span class="hljs-string">'city'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>]] = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; $csvCts = [ $data[<span class="hljs-string"><span class="hljs-string">'city'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'city'</span></span>][<span class="hljs-string"><span class="hljs-string">'lat'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'city'</span></span>][<span class="hljs-string"><span class="hljs-string">'lon'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'city'</span></span>][<span class="hljs-string"><span class="hljs-string">'name_ru'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'city'</span></span>][<span class="hljs-string"><span class="hljs-string">'name_en'</span></span>], ]; fputcsv($sxCts,$csvCts); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($ids[<span class="hljs-string"><span class="hljs-string">'rgn'</span></span>][$data[<span class="hljs-string"><span class="hljs-string">'region'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>]])) { $ids[<span class="hljs-string"><span class="hljs-string">'rgn'</span></span>][$data[<span class="hljs-string"><span class="hljs-string">'region'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>]] = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; $csvRgn = [ $data[<span class="hljs-string"><span class="hljs-string">'region'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'region'</span></span>][<span class="hljs-string"><span class="hljs-string">'iso'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'region'</span></span>][<span class="hljs-string"><span class="hljs-string">'name_ru'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'region'</span></span>][<span class="hljs-string"><span class="hljs-string">'name_en'</span></span>], ]; fputcsv($sxRgn,$csvRgn); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($ids[<span class="hljs-string"><span class="hljs-string">'cnt'</span></span>][$data[<span class="hljs-string"><span class="hljs-string">'country'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>]])) { $ids[<span class="hljs-string"><span class="hljs-string">'cnt'</span></span>][$data[<span class="hljs-string"><span class="hljs-string">'country'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>]] = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; $csvCnt = [ $data[<span class="hljs-string"><span class="hljs-string">'country'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'country'</span></span>][<span class="hljs-string"><span class="hljs-string">'iso'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'country'</span></span>][<span class="hljs-string"><span class="hljs-string">'lat'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'country'</span></span>][<span class="hljs-string"><span class="hljs-string">'lon'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'country'</span></span>][<span class="hljs-string"><span class="hljs-string">'name_ru'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'country'</span></span>][<span class="hljs-string"><span class="hljs-string">'name_en'</span></span>], ]; fputcsv($sxCnt,$csvCnt); } $firstIp = $ip; $seek = hexdec(bin2hex(substr($block, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;block_len - <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;id_len, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;id_len))); $data = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;parseCity($seek,<span class="hljs-number"><span class="hljs-number">1</span></span>); } } $lastIp = <span class="hljs-string"><span class="hljs-string">'255.255.255.255'</span></span>; $csvNet = [ $firstIp, $lastIp, $data[<span class="hljs-string"><span class="hljs-string">'city'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'region'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'country'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>], ]; fputcsv($sxNet,$csvNet); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($ids[<span class="hljs-string"><span class="hljs-string">'cts'</span></span>][$data[<span class="hljs-string"><span class="hljs-string">'city'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>]])) { $ids[<span class="hljs-string"><span class="hljs-string">'cts'</span></span>][$data[<span class="hljs-string"><span class="hljs-string">'city'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>]] = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; $csvCts = [ $data[<span class="hljs-string"><span class="hljs-string">'city'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'city'</span></span>][<span class="hljs-string"><span class="hljs-string">'lat'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'city'</span></span>][<span class="hljs-string"><span class="hljs-string">'lon'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'city'</span></span>][<span class="hljs-string"><span class="hljs-string">'name_ru'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'city'</span></span>][<span class="hljs-string"><span class="hljs-string">'name_en'</span></span>], ]; fputcsv($sxCts,$csvCts); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($ids[<span class="hljs-string"><span class="hljs-string">'rgn'</span></span>][$data[<span class="hljs-string"><span class="hljs-string">'region'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>]])) { $ids[<span class="hljs-string"><span class="hljs-string">'rgn'</span></span>][$data[<span class="hljs-string"><span class="hljs-string">'region'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>]] = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; $csvRgn = [ $data[<span class="hljs-string"><span class="hljs-string">'region'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'region'</span></span>][<span class="hljs-string"><span class="hljs-string">'iso'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'region'</span></span>][<span class="hljs-string"><span class="hljs-string">'name_ru'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'region'</span></span>][<span class="hljs-string"><span class="hljs-string">'name_en'</span></span>], ]; fputcsv($sxRgn,$csvRgn); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($ids[<span class="hljs-string"><span class="hljs-string">'cnt'</span></span>][$data[<span class="hljs-string"><span class="hljs-string">'country'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>]])) { $ids[<span class="hljs-string"><span class="hljs-string">'cnt'</span></span>][$data[<span class="hljs-string"><span class="hljs-string">'country'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>]] = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; $csvCnt = [ $data[<span class="hljs-string"><span class="hljs-string">'country'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'country'</span></span>][<span class="hljs-string"><span class="hljs-string">'iso'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'country'</span></span>][<span class="hljs-string"><span class="hljs-string">'lat'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'country'</span></span>][<span class="hljs-string"><span class="hljs-string">'lon'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'country'</span></span>][<span class="hljs-string"><span class="hljs-string">'name_ru'</span></span>], $data[<span class="hljs-string"><span class="hljs-string">'country'</span></span>][<span class="hljs-string"><span class="hljs-string">'name_en'</span></span>], ]; fputcsv($sxCnt,$csvCnt); } fclose($sxNet); fclose($sxCnt); fclose($sxRgn); fclose($sxCts); } } $sxgeo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ExtSxGeo( <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'SxGeoCity.dat'</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>); $sxgeo-&gt;parseBase();</code> </pre> </div></div><br><p>  Run the script and wait. </p><br><pre> <code class="hljs swift">$ php <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>.php</code> </pre> <br><h3 id="sozdanie-bd-iptool-iz--poluchennyh-csv-faylov">  Creating an IPTool database from received csv files </h3><br><div class="spoiler">  <b class="spoiler_title">convert.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   IPTool   csv  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'vendor'</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'autoload.php'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*      .          . */</span></span> $tmpDir = <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.<span class="hljs-string"><span class="hljs-string">'/t'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*   Converter. */</span></span> $converter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Ddrv\Iptool\Converter($tmpDir); <span class="hljs-comment"><span class="hljs-comment">/*     .        . */</span></span> $dbFile = <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'iptool.sxgeo.city.dat'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*       CSV . */</span></span> $sxNet = <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'csv'</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'sxgeo'</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'sxNet.csv'</span></span>; $sxCnt = <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'csv'</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'sxgeo'</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'sxCnt.csv'</span></span>; $sxRgn = <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'csv'</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'sxgeo'</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'sxRgn.csv'</span></span>; $sxCts = <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'csv'</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'sxgeo'</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'sxCts.csv'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*    . */</span></span> $converter-&gt;setAuthor(<span class="hljs-string"><span class="hljs-string">'Ivan Dudarev'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*  . */</span></span> $converter-&gt;setLicense(<span class="hljs-string"><span class="hljs-string">'MIT'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*     CSV. */</span></span> $converter-&gt;addCSV(<span class="hljs-string"><span class="hljs-string">'sxNet'</span></span>,$sxNet); $converter-&gt;addCSV(<span class="hljs-string"><span class="hljs-string">'sxCnt'</span></span>,$sxCnt); $converter-&gt;addCSV(<span class="hljs-string"><span class="hljs-string">'sxRgn'</span></span>,$sxRgn); $converter-&gt;addCSV(<span class="hljs-string"><span class="hljs-string">'sxCts'</span></span>,$sxCts); <span class="hljs-comment"><span class="hljs-comment">/*   Country. */</span></span> $country = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'int'</span></span>, <span class="hljs-string"><span class="hljs-string">'column'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, ), <span class="hljs-string"><span class="hljs-string">'iso'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'string'</span></span>, <span class="hljs-string"><span class="hljs-string">'column'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'transform'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'low'</span></span>, ), <span class="hljs-string"><span class="hljs-string">'lat'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'double'</span></span>, <span class="hljs-string"><span class="hljs-string">'column'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>, ), <span class="hljs-string"><span class="hljs-string">'lon'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'double'</span></span>, <span class="hljs-string"><span class="hljs-string">'column'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, ), <span class="hljs-string"><span class="hljs-string">'nameRu'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'string'</span></span>, <span class="hljs-string"><span class="hljs-string">'column'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>, ), <span class="hljs-string"><span class="hljs-string">'nameEn'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'string'</span></span>, <span class="hljs-string"><span class="hljs-string">'column'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>, ), ); $converter-&gt;addRegister(<span class="hljs-string"><span class="hljs-string">'country'</span></span>,<span class="hljs-string"><span class="hljs-string">'sxCnt'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>, $country); <span class="hljs-comment"><span class="hljs-comment">/*   Region. */</span></span> $region = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'int'</span></span>, <span class="hljs-string"><span class="hljs-string">'column'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, ), <span class="hljs-string"><span class="hljs-string">'iso'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'string'</span></span>, <span class="hljs-string"><span class="hljs-string">'column'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'transform'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'low'</span></span>, ), <span class="hljs-string"><span class="hljs-string">'nameRu'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'string'</span></span>, <span class="hljs-string"><span class="hljs-string">'column'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>, ), <span class="hljs-string"><span class="hljs-string">'nameEn'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'string'</span></span>, <span class="hljs-string"><span class="hljs-string">'column'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, ), ); $converter-&gt;addRegister(<span class="hljs-string"><span class="hljs-string">'region'</span></span>,<span class="hljs-string"><span class="hljs-string">'sxRgn'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>, $region); <span class="hljs-comment"><span class="hljs-comment">/*   City. */</span></span> $city = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'int'</span></span>, <span class="hljs-string"><span class="hljs-string">'column'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, ), <span class="hljs-string"><span class="hljs-string">'lat'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'double'</span></span>, <span class="hljs-string"><span class="hljs-string">'column'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, ), <span class="hljs-string"><span class="hljs-string">'lon'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'double'</span></span>, <span class="hljs-string"><span class="hljs-string">'column'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>, ), <span class="hljs-string"><span class="hljs-string">'nameRu'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'string'</span></span>, <span class="hljs-string"><span class="hljs-string">'column'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, ), <span class="hljs-string"><span class="hljs-string">'nameEn'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'string'</span></span>, <span class="hljs-string"><span class="hljs-string">'column'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>, ), ); $converter-&gt;addRegister(<span class="hljs-string"><span class="hljs-string">'city'</span></span>,<span class="hljs-string"><span class="hljs-string">'sxCts'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>, $city); <span class="hljs-comment"><span class="hljs-comment">/*  . */</span></span> $data = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'city'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'region'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'country'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>, ); $converter-&gt;addNetworks(<span class="hljs-string"><span class="hljs-string">'sxNet'</span></span>, <span class="hljs-string"><span class="hljs-string">'ip'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, $data); $errors = $converter-&gt;getErrors(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$errors) { $converter-&gt;create($dbFile); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { print_r($errors); }</code> </pre> </div></div><br><p>  Run the script and wait. </p><br><pre> <code class="hljs dos">$ php <span class="hljs-built_in"><span class="hljs-built_in">convert</span></span>.php</code> </pre> <br><h2>  Database size comparison </h2><br><pre> <code class="hljs vbscript">$ ls -l *.dat ... -rw-r--r-- <span class="hljs-number"><span class="hljs-number">1</span></span> www www <span class="hljs-number"><span class="hljs-number">13435116</span></span> Jun <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">46</span></span> SxGeoCity.dat -rw-r--r-- <span class="hljs-number"><span class="hljs-number">1</span></span> www www <span class="hljs-number"><span class="hljs-number">33190825</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Oct</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> iptool.sxgeo.city.dat ...</code> </pre> <br><p>  IPTool base volume is 3 times larger (which is not a plus) </p><br><div class="spoiler">  <b class="spoiler_title">compare.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'Iptool.php'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'SxGeo.php'</span></span>); $dbFile = <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'iptool.sxgeo.city.dat'</span></span>; $iptool = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Ddrv\Iptool\Iptool($dbFile); $sxgeo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SxGeo( <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">'SxGeoCity.dat'</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> $ips = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i=<span class="hljs-number"><span class="hljs-number">0</span></span>;$i&lt;<span class="hljs-number"><span class="hljs-number">100</span></span>;$i++) { $ipa = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($octet = <span class="hljs-number"><span class="hljs-number">0</span></span>;$octet&lt;<span class="hljs-number"><span class="hljs-number">4</span></span>;$octet++) { $ipa[] = rand(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>); } $ip = implode(<span class="hljs-string"><span class="hljs-string">'.'</span></span>,$ipa); $ips[] = $ip; } <span class="hljs-comment"><span class="hljs-comment">/* IPTool */</span></span> $res = []; $t1 = microtime(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($ips <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $ip) { $res[] = $iptool-&gt;find($ip); } $t2 = microtime(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'IP Tool : '</span></span>.($t2-$t1).PHP_EOL; <span class="hljs-comment"><span class="hljs-comment">/* SxGeo */</span></span> $res = []; $t1 = microtime(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($ips <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $ip) { $res[] = $sxgeo-&gt;getCityFull($ip); } $t2 = microtime(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'SxGeo : '</span></span>.($t2-$t1).PHP_EOL;</code> </pre> </div></div><br><h2>  Comparative speed test iptool-1.0.6 and SxGeo-2.2.3 </h2><br><pre> <code class="hljs ruby">$ php compare.php</code> </pre> <br><h3 id="rezultat-tryoh-testov-po-100-adresov">  The result of three tests on 100 addresses </h3><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Tool</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.026905059814453</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SxGeo</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.031632900238037</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Tool</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.025413036346436</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SxGeo</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.023004055023193</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Tool</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.016932010650635</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SxGeo</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.022341012954712</span></span></code> </pre> <br><h3 id="rezultat-tryoh-testov-po-1-adresu">  The result of three tests at 1 address </h3><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Tool</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0013048648834229</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SxGeo</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.00016021728515625</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Tool</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.00047779083251953</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SxGeo</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.00011301040649414</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Tool</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.00046205520629883</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SxGeo</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.00035595893859863</span></span></code> </pre> <br><h1>  UPD2.  In version 1.0.7, the search algorithm is transferred to binary search. </h1><br><h2>  Comparative speed test iptool-1.0.7 and SxGeo-2.2.3 </h2><br><pre> <code class="hljs ruby">$ php compare.php</code> </pre> <br><h3 id="rezultat-tryoh-testov-po-100-adresov-1">  The result of three tests on 100 addresses </h3><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Tool</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.012892961502075</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SxGeo</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.033740043640137</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Tool</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0073931217193604</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SxGeo</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.032436847686768</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Tool</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0043089389801025</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SxGeo</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.028012990951538</span></span></code> </pre> <br><h3 id="rezultat-tryoh-testov-po-1-adresu-1">  The result of three tests at 1 address </h3><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Tool</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0011000633239746</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SxGeo</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0009000301361084</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Tool</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.00040006637573242</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SxGeo</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.00079989433288574</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Tool</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.00030016899108887</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SxGeo</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.00020003318786621</span></span></code> </pre> <br><h2>  Conclusion </h2><br><p>  Need to work on the size of the database; </p><br><ul><li>  to realize the connection between directories, it will noticeably reduce the size of the base ranges; </li><li>  glue the intervals with the same data (although in this database there are none, they are taken from SxGeo as it is); </li><li>  store the starting addresses of the ranges as 3x bytes, as in SxGeo. </li></ul><br><h1>  UPD 3 </h1><br><p>  On some projects, the converter is not needed (the database is generated in one project and duplicated in others), which added an extra dependency to the project (pdo_sqlite).  In this regard, it was decided to divide the libraries into 2 projects.  Well, under the guise of changing the namespace. </p><br><p>  Now the project lives here: </p><br><p>  Creating a base <a href="https://github.com/ipstack/wizard">GitHub</a> <a href="https://packagist.org/packages/ipstack/wizard">Packagist</a> <br>  Search <a href="https://github.com/ipstack/finder">GitHub</a> <a href="https://packagist.org/packages/ipstack/finder">Packagist database</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/339748/">https://habr.com/ru/post/339748/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339738/index.html">What we came up with for the next billion users: a project risk analysis</a></li>
<li><a href="../339740/index.html">Circles of friends, ants clashes and Russian roulette: unusual questions at interviews in financial companies</a></li>
<li><a href="../339742/index.html">How we moved to React 16</a></li>
<li><a href="../339744/index.html">New ways to monetize hacked web resources</a></li>
<li><a href="../339746/index.html">Running containers from Ubuntu to Windows</a></li>
<li><a href="../339752/index.html">The graphs are large and small: an intellectual solution to the problem of choosing a representation</a></li>
<li><a href="../339754/index.html">Educated youth. About patterns and processes</a></li>
<li><a href="../339756/index.html">Non-satellite positioning and navigation systems</a></li>
<li><a href="../339758/index.html">IdM implementation. Part 1: What is IdM and what functionality does it apply to?</a></li>
<li><a href="../339760/index.html">[Translation] How I learned to program AI for the last two months</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>