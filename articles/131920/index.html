<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PhpBB 3 spam protection without captcha</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I think many forum owners on phpBB 3 already know that the standard captcha that comes with the forum does not save much. 

 In general, having come o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PhpBB 3 spam protection without captcha</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/d8a39373/ae20271c/958d20c1/536a4acc.jpg" align="left">  I think many forum owners on phpBB 3 already know that the standard captcha that comes with the forum does not save much. <br><br>  In general, having come once to your forum, I saw that in a matter of hours several hundred spam messages were added, despite the fact that the captcha was turned on, and you can post only the registered ones.  At first I tried to just choose another captcha, but it also did not help.  Then I thought about a different approach. <br><a name="habracut"></a><br><h4>  Protection based on analysis of user actions </h4><br>  In general, the first thing to do was to add scripters to the forum, which wrote all the GET and POST requests to the log file so that they could be analyzed. <br><br>  Immediately I will clarify that the forum is Russian-speaking (Russian is enabled by default), but there is also English. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And so a typical request for registration from the bot looks like this (the method, url, referrer are displayed, and then the info from the POST request, I removed the email): <br><br><pre><code class="php hljs">GET /forum/index.php /forum/index.php GET /forum/ucp.php?mode=register /forum/ucp.php?mode=register POST /forum/ucp.php?mode=register /forum/ucp.php?mode=register <span class="hljs-string"><span class="hljs-string">'agreed'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'    '</span></span>, <span class="hljs-string"><span class="hljs-string">'change_lang'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'creation_time'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1320421149'</span></span>, <span class="hljs-string"><span class="hljs-string">'form_token'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'16d4c035a7de1680c4e19fe0addd242d7edf1822'</span></span>, POST /forum/ucp.php?mode=register /forum/ucp.php?mode=register <span class="hljs-string"><span class="hljs-string">'username'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Shemtrearve'</span></span>, <span class="hljs-string"><span class="hljs-string">'email'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'deassepleadia@....com'</span></span>, <span class="hljs-string"><span class="hljs-string">'email_confirm'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'deassepleadia@....com'</span></span>, <span class="hljs-string"><span class="hljs-string">'new_password'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'q49uh3oYcN'</span></span>, <span class="hljs-string"><span class="hljs-string">'password_confirm'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'q49uh3oYcN'</span></span>, <span class="hljs-string"><span class="hljs-string">'lang'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'en'</span></span>, <span class="hljs-string"><span class="hljs-string">'tz'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-12'</span></span>, <span class="hljs-string"><span class="hljs-string">'agreed'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'true'</span></span>, <span class="hljs-string"><span class="hljs-string">'change_lang'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">'submit'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'creation_time'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1320421154'</span></span>, <span class="hljs-string"><span class="hljs-string">'form_token'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'97471b3af621c1a60f825e50d2b61b3346b48025'</span></span>, GET /forum/ucp.php?mode=login /forum/ucp.php?mode=login</code> </pre> <br><br>  I also removed the sid from the URL, the bots often add them, although they are disabled in my forum.  All requests are made at intervals of 4-5 seconds. <br><br>  Now we are looking for weirdness in the query: <br><ol><li>  Naturally, it is immediately obvious that the bot enters the page from the same page (referrer coincides with the page). </li><li>  In the second POST request, we draw attention to the fact that the bot chose English, while in the previous request it did not change the language, and read the forum rules in Russian, and then chose English. </li><li>  Next, we will indicate that a time zone of -12 has been chosen, although this zone is purely conditional and no one lives there.  And the thing is that phpBB this date stands JavaScript, and the bots, it remains by default. </li><li>  Further, change_lang = 0, while there can be no such value in phpBB, there should be a language code. </li><li>  And finally submit in Russian, with the selected English.  There are still stupid bots that do not understand the Cyrillic alphabet, and question marks are inserted into this field. </li></ol><br>  In general, the conclusion is quite simple, but based on points 2-5, we make a small script that will prevent the registration of bots. <br><br>  The code looks like this <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_POST[<span class="hljs-string"><span class="hljs-string">'password_confirm'</span></span>]) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_POST[<span class="hljs-string"><span class="hljs-string">'tz'</span></span>])){ <span class="hljs-comment"><span class="hljs-comment">//     if( $_POST['tz'] == -12 || //    ($_POST['lang'] == 'en' &amp;&amp; $_POST['change_lang'] != 'en') || //   ,  change_lang     ($_POST['lang'] == 'en' &amp;&amp; $_POST['submit'] == '') //   ,   -  ){ header("HTTP/1.1 404 Not Found"); exit; } }</span></span></code> </pre> <br><br>  The easiest way is to add this code at the end of config.php, in order not to poke around for a long time, not to tear it down when updating the forum, and immediately send bots to the forest.  You can simplify the condition at will, just for clarity painted.  Thanks to this simple code, I eliminated almost all spammers, even though I turned off the captcha. <br><br>  It is clear that over time, the bots will learn to bypass it, but then we will also come up with something new. <br><br>  <b>UPD.</b>  <b>I corrected the code of the example, otherwise there were a couple of typos.</b> </div><p>Source: <a href="https://habr.com/ru/post/131920/">https://habr.com/ru/post/131920/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131915/index.html">Catastrophic backtracking in regular expressions</a></li>
<li><a href="../131916/index.html">Redis, hiredis, libev and multithread. Part 1</a></li>
<li><a href="../131917/index.html">Competition for the creation of HTML5 applications with a prize pool of $ 50,000</a></li>
<li><a href="../131918/index.html">Difficult questions - simple answers or not an ordinary question and answer service</a></li>
<li><a href="../131919/index.html">Macros in Scala, Eugene Burmaco. Screencast, slides and photo with scalaby # 6</a></li>
<li><a href="../131921/index.html">Learn bash scripts, write Quadronix</a></li>
<li><a href="../131922/index.html">DIY preamp in A class. Clone Lehmann BCL</a></li>
<li><a href="../131923/index.html">New version of Kinect for Windows SDK, new website and blog for developers released</a></li>
<li><a href="../131925/index.html">Online UML editor</a></li>
<li><a href="../131926/index.html">Why Agile doesn't suit you</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>