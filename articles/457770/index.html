<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing custom transformer AST on TypeScript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Team TestMace with you again. This time we publish a translation of an article about converting TypeScript code using the capabilities of the compiler...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing custom transformer AST on TypeScript</h1><div class="post__text post__text-html js-mediator-article"><p>  <em>Team <a href="https://client.testmace.com/">TestMace</a> with you again.</em>  <em>This time we publish a translation of an article about converting TypeScript code using the capabilities of the compiler.</em>  <em>Enjoy reading!</em> </p><br><h1 id="vvedenie">  Introduction </h1><br><p>  This is my first post, and in it I would like to show the solution of one problem using <a href="https://github.com/Microsoft/TypeScript/wiki/Using-the-Compiler-API">the</a> TypeScript <a href="https://github.com/Microsoft/TypeScript/wiki/Using-the-Compiler-API">compiler API</a> .  To find this solution, I have been digging through numerous blogs for a long time and digesting the answers to StackOverflow, so in order to save you from the same fate, I will share all that I learned about such a powerful, but poorly documented set of tools. </p><a name="habracut"></a><br><h1 id="klyuchevye-ponyatiya">  Key Concepts </h1><br><p>  Basics of the TypeScript compiler API (parser terminology, transformation API, multi-level architecture), abstract syntax tree (AST), Visitor design pattern, code generation. </p><br><h1 id="nebolshaya-rekomendaciya">  Small recommendation </h1><br><p>  If this is your first time hearing about the concept of AST, I would strongly advise reading <a href="https://medium.com/basecs/leveling-up-ones-parsing-game-with-asts-d7a6fc2400ff">this article</a> from <a href="https://medium.com/%40vaidehijoshi">@Vaidehi Joshi</a> .  Her entire <a href="https://medium.com/basecs">basecs</a> series of articles <a href="https://medium.com/basecs">came</a> out great, you will definitely like it. </p><br><h1 id="opisanie-zadachi">  Task Description </h1><br><p>  In <a href="https://github.com/AveroLLC">Avero,</a> we use GraphQL and would like to add type safety in resolvers.  Once I came across <a href="https://github.com/prisma/graphqlgen">graphqlgen</a> , and with it I managed to solve many problems regarding the concept of <a href="https://oss.prisma.io/graphqlgen/01-configuration.html">models</a> in GraphQL.  I will not go into this question here - for this I plan to write a separate article.  In short, the models describe the return values ‚Äã‚Äãof resolvers, and in graphqlgen, these models are associated with interfaces through a kind of configuration (a YAML or TypeScript file with type declarations). </p><br><p>  While running, we run <a href="https://grpc.io/">gRPC</a> microservices, and GQL for the most part serves as a facade.  We have already published TypeScript interfaces that are in accordance with <a href="https://developers.google.com/protocol-buffers/">proto contracts</a> , and I wanted to use these types as models, but I ran into some problems caused by the <a href="https://github.com/prisma/graphqlgen/issues/282">support for type export</a> and the way the description of our interfaces was implemented (piling up namespaces, a large number of links). </p><br><p>  According to the rules of good open source, my first action was to refine what has already been done in the graphqlgen repository and thus make a meaningful contribution.  To implement the introspection mechanism, graphqlgen uses the <a href="https://github.com/babel/babel/tree/master/packages/babel-parser">@ babel / parser parser</a> to read the file and collect information about interface names and declarations (interface fields). </p><br><p>  Every time I need to do something with AST, I first open <a href="https://astexplorer.net/">astexplorer.net</a> , and then begin to act.  This tool allows you to analyze the AST created by various parsers, including <a href="https://habr.com/ru/users/babel/" class="user_link">babel</a> / parser and TypeScript compiler parser.  Using astexplorer.net, you can visualize the data structures you need to work with and familiarize yourself with the AST node types of each parser. </p><br><p>  Take a look at an example of the source data file and the AST created on its basis using babel-parser: </p><br><div class="spoiler">  <b class="spoiler_title">example.ts</b> <div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { protos } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'my_company_protos'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> type User = protos.user.User;</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">ast.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Program"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-attr"><span class="hljs-attr">"loc"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">36</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"comments"</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">"range"</span></span>: [ <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"sourceType"</span></span>: <span class="hljs-string"><span class="hljs-string">"module"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"body"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ImportDeclaration"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: <span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-attr"><span class="hljs-attr">"loc"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">42</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"specifiers"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ImportSpecifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-attr"><span class="hljs-attr">"loc"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">9</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">15</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"imported"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-attr"><span class="hljs-attr">"loc"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">9</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">15</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"identifierName"</span></span>: <span class="hljs-string"><span class="hljs-string">"protos"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"protos"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"range"</span></span>: [ <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"_babelType"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"importKind"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"local"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-attr"><span class="hljs-attr">"loc"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">9</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">15</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"identifierName"</span></span>: <span class="hljs-string"><span class="hljs-string">"protos"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"protos"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"range"</span></span>: [ <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"_babelType"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"range"</span></span>: [ <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"_babelType"</span></span>: <span class="hljs-string"><span class="hljs-string">"ImportSpecifier"</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"importKind"</span></span>: <span class="hljs-string"><span class="hljs-string">"value"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"source"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Literal"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: <span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-attr"><span class="hljs-attr">"loc"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">23</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">42</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"extra"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"rawValue"</span></span>: <span class="hljs-string"><span class="hljs-string">"my_company_protos"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"raw"</span></span>: <span class="hljs-string"><span class="hljs-string">"'my_company_protos'"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"my_company_protos"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"range"</span></span>: [ <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"_babelType"</span></span>: <span class="hljs-string"><span class="hljs-string">"StringLiteral"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"raw"</span></span>: <span class="hljs-string"><span class="hljs-string">"'my_company_protos'"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"range"</span></span>: [ <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"_babelType"</span></span>: <span class="hljs-string"><span class="hljs-string">"ImportDeclaration"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ExportNamedDeclaration"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-number"><span class="hljs-number">44</span></span>, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-attr"><span class="hljs-attr">"loc"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">36</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"specifiers"</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">"source"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"exportKind"</span></span>: <span class="hljs-string"><span class="hljs-string">"type"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"declaration"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"TypeAlias"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-number"><span class="hljs-number">51</span></span>, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-attr"><span class="hljs-attr">"loc"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">36</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-number"><span class="hljs-number">56</span></span>, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-attr"><span class="hljs-attr">"loc"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">16</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"identifierName"</span></span>: <span class="hljs-string"><span class="hljs-string">"User"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"User"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"range"</span></span>: [ <span class="hljs-number"><span class="hljs-number">56</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"_babelType"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"typeParameters"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"right"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"GenericTypeAnnotation"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-number"><span class="hljs-number">63</span></span>, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: <span class="hljs-number"><span class="hljs-number">79</span></span>, <span class="hljs-attr"><span class="hljs-attr">"loc"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">19</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">35</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"typeParameters"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"QualifiedTypeIdentifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-number"><span class="hljs-number">63</span></span>, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: <span class="hljs-number"><span class="hljs-number">79</span></span>, <span class="hljs-attr"><span class="hljs-attr">"loc"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">19</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">35</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"qualification"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"QualifiedTypeIdentifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-number"><span class="hljs-number">63</span></span>, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: <span class="hljs-number"><span class="hljs-number">74</span></span>, <span class="hljs-attr"><span class="hljs-attr">"loc"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">19</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">30</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"qualification"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-number"><span class="hljs-number">63</span></span>, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: <span class="hljs-number"><span class="hljs-number">69</span></span>, <span class="hljs-attr"><span class="hljs-attr">"loc"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">19</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"end"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">25</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"identifierName"</span></span>: <span class="hljs-string"><span class="hljs-string">"protos"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"protos"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"range"</span></span>: [ <span class="hljs-number"><span class="hljs-number">63</span></span>, <span class="hljs-number"><span class="hljs-number">69</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"_babelType"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"range"</span></span>: [ <span class="hljs-number"><span class="hljs-number">63</span></span>, <span class="hljs-number"><span class="hljs-number">74</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"_babelType"</span></span>: <span class="hljs-string"><span class="hljs-string">"QualifiedTypeIdentifier"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"range"</span></span>: [ <span class="hljs-number"><span class="hljs-number">63</span></span>, <span class="hljs-number"><span class="hljs-number">79</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"_babelType"</span></span>: <span class="hljs-string"><span class="hljs-string">"QualifiedTypeIdentifier"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"range"</span></span>: [ <span class="hljs-number"><span class="hljs-number">63</span></span>, <span class="hljs-number"><span class="hljs-number">79</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"_babelType"</span></span>: <span class="hljs-string"><span class="hljs-string">"GenericTypeAnnotation"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"range"</span></span>: [ <span class="hljs-number"><span class="hljs-number">51</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"_babelType"</span></span>: <span class="hljs-string"><span class="hljs-string">"TypeAlias"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"range"</span></span>: [ <span class="hljs-number"><span class="hljs-number">44</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"_babelType"</span></span>: <span class="hljs-string"><span class="hljs-string">"ExportNamedDeclaration"</span></span> } ] }</code> </pre> </div></div><br><p>  The root of the tree (a node of type <strong>Program</strong> ) contains in its body two operators, <strong>ImportDeclaration</strong> and <strong>ExportNamedDeclaration</strong> . </p><br><p>  In <strong>ImportDeclaration,</strong> we are particularly interested in two properties - <strong>source</strong> and <strong>specifiers</strong> , which contain information about the source text.  For example, in our case, the value of source is <em>my_company_protos</em> .  By this value it is impossible to understand, relative is the path to the file or a link to an external module.  That is what the parser has to do. </p><br><p>  Similarly, information about the source text is also contained in <strong>ExportNamedDeclaration</strong> .  Namespaces only complicate this structure by adding arbitrary nesting to it, with the result that more and more <strong>QualifiedTypeIdentifiers</strong> appear.  This is another task that we have to solve within the framework of the chosen approach with the parser. </p><br><p>  But I have not even reached the resolution of types from imports!  Considering that the parser and the AST by default give a limited amount of information about the source text, in order to add this information to the final tree, it is necessary to parse all the imported files.  But each such file can have its own imports! </p><br><p>  It seems that solving the tasks with the help of the parser, we will get too much code ... Let's take a step back and think again. </p><br><p>  Imports are not important to us, and the file structure is not important either.  We want to be able to resolve all properties of type <code>protos.user.User</code> and embed them instead of using references to imports.  And where to get the necessary information about the types to make a new file? </p><br><h1 id="typechecker">  Typechecker </h1><br><p>  Since we found out that the solution with the parser is not suitable for obtaining information about the types of imported interfaces, let's look at <a href="https://github.com/Microsoft/TypeScript/wiki/Architectural-Overview">the</a> TypeScript <a href="https://github.com/Microsoft/TypeScript/wiki/Architectural-Overview">compilation process</a> and try to find another way out. </p><br><p>  This is what immediately comes to mind: </p><br><blockquote>  TypeChecker is the basis of the TypeScript type system, and it can be created from a Program instance.  He is responsible for the interaction of characters from different files among themselves, specifying the types of characters and conducting semantic verification (for example, error detection). <br>  The first thing TypeChecker does is to collect all the characters from different source files into one representation, and then create a single character table, producing a "merge" of the same characters (for example, namespaces found in several different files). <br>  After initialization of the initial state, TypeChecker is ready to provide answers to any questions about the program.  These questions can be: <br>  Which character corresponds to this node? <br>  What is this character type? <br>  What characters are visible in this part of AST? <br>  What are the signatures available for function declaration? <br>  What errors should be displayed for this file? </blockquote><p>  <strong>TypeChecker</strong> is exactly what we needed!  With access to the symbol table and API, we can answer the first two questions: <em>Which symbol corresponds to a given node?</em>  <em>What is this character type?</em>  Thanks to the merging of all common characters, <strong>TypeChecker</strong> can even solve the problem with the accumulation of namespaces, which was mentioned earlier! </p><br><p>  So how do you get to this API? </p><br><p>  Here is <a href="https://github.com/Microsoft/TypeScript/wiki/Using-the-Compiler-API">one</a> of the examples I could find on the net.  It shows that access to <strong>TypeChecker</strong> can be obtained through the instance method of the Program.  It has two interesting methods - <code>checker.getSymbolAtLocation</code> and <code>checker.getTypeOfSymbolAtLocation</code> , which look very similar to what we are looking for. </p><br><p>  Let's start working on the code. </p><br><div class="spoiler">  <b class="spoiler_title">models.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { protos } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./my_company_protos'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> type User = protos.user.User;</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">my_company_protos.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> namespace protos { <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> namespace user { <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface User { <span class="hljs-attr"><span class="hljs-attr">username</span></span>: string; info: protos.Info.User; } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> namespace Info { <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface User { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: protos.Info.Name; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface Name { <span class="hljs-attr"><span class="hljs-attr">firstName</span></span>: string; lastName: string; } } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">ts-alias.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ts <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"typescript"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// hardcode our input file const filePath = "./src/models.ts"; // create a program instance, which is a collection of source files // in this case we only have one source file const program = ts.createProgram([filePath], {}); // pull off the typechecker instance from our program const checker = program.getTypeChecker(); // get our models.ts source file AST const source = program.getSourceFile(filePath); // create TS printer instance which gives us utilities to pretty print our final AST const printer = ts.createPrinter(); // helper to give us Node string type given kind const syntaxToKind = (kind: ts.Node["kind"]) =&gt; { return ts.SyntaxKind[kind]; }; // visit each node in the root AST and log its kind ts.forEachChild(source, node =&gt; { console.log(syntaxToKind(node.kind)); });</span></span></code> </pre> </div></div><br><pre> <code class="bash hljs">$ ts-node ./src/ts-alias.ts prints ImportDeclaration TypeAliasDeclaration EndOfFileToken</code> </pre> <br><p>  We are only interested in the declaration of the type alias, so we will rewrite the code a bit: </p><br><div class="spoiler">  <b class="spoiler_title">kind-printer.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs">ts.forEachChild(source, node =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ts.isTypeAliasDeclaration(node)) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(node.kind); } }) <span class="hljs-comment"><span class="hljs-comment">// prints TypeAliasDeclaration</span></span></code> </pre> </div></div><br><p>  TypeScript provides protection for each type of node, with which you can find out the exact type of node: </p><br><p><img src="https://habrastorage.org/webt/rb/gk/oa/rbgkoakkvmpvkyiparz1wmuiohi.png"></p><br><p>  Now, back to the two questions that were posed earlier: <em>Which symbol corresponds to a given node?</em>  <em>What is this character type?</em> </p><br><p>  So, we got the names entered by the interface type alias declarations using the <strong>TypeChecker</strong> character table <strong>interaction</strong> .  While we are still at the very beginning, but this is a good starting position in terms of <em>introspection</em> . </p><br><div class="spoiler">  <b class="spoiler_title">checker-example.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs">ts.forEachChild(source, node =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ts.isTypeAliasDeclaration(node)) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> symbol = checker.getSymbolAtLocation(node.name); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> type = checker.getDeclaredTypeOfSymbol(symbol); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> properties = checker.getPropertiesOfType(type); properties.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">declaration</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(declaration.name); <span class="hljs-comment"><span class="hljs-comment">// prints username, info }); } });</span></span></code> </pre> </div></div><br><p>  And now we will think over <em>code generation</em> . </p><br><h1 id="api-transformacii">  Transformation API </h1><br><p>  As indicated earlier, our goal is to parse and introspect the TypeScript source file and create a new file.  <em>AST</em> conversion <em>-&gt; AST is</em> so often used that the TypeScript command even thought about the API to create <a href="https://github.com/Microsoft/TypeScript/pull/13940">custom transformers</a> ! </p><br><p>  Before moving on to the main task, let's try creating a simple transformer.  Special thanks <a href="https://43081j.com/">to James Garbutt</a> for the original <a href="https://43081j.com/2018/08/creating-a-typescript-transform">template</a> for him. </p><br><p>  Let the transformer change the numeric literals to string. </p><br><div class="spoiler">  <b class="spoiler_title">number-transformer.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> source = <span class="hljs-string"><span class="hljs-string">` const two = 2; const four = 4; `</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">numberTransformer</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">extends</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ts</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Node</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ts</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TransformerFactory</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">context</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> visit: ts.Visitor = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">node</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ts.isNumericLiteral(node)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ts.createStringLiteral(node.text); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ts.visitEachChild(node, child =&gt; visit(child), context); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">node</span></span></span><span class="hljs-function"> =&gt;</span></span> ts.visitNode(node, visit); }; } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> result = ts.transpileModule(source, { <span class="hljs-attr"><span class="hljs-attr">compilerOptions</span></span>: { <span class="hljs-attr"><span class="hljs-attr">module</span></span>: ts.ModuleKind.CommonJS }, <span class="hljs-attr"><span class="hljs-attr">transformers</span></span>: { <span class="hljs-attr"><span class="hljs-attr">before</span></span>: [numberTransformer()] } }); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(result.outputText); <span class="hljs-comment"><span class="hljs-comment">/* var two = "2"; var four = "4";</span></span></code> </pre></div></div><br><p>  The most important part of it is the <code>Visitor</code> and <code>VisitorResult</code> : </p><br><pre> <code class="javascript hljs">type Visitor = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">node: Node</span></span></span><span class="hljs-function">) =&gt;</span></span> VisitResult&lt;Node&gt;; type VisitResult&lt;T extends Node&gt; = T | T[] | <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>;</code> </pre> <br><p>  The main goal when creating a transformer is to write <strong>Visitor</strong> .  Logically, you need to implement the recursive passing of each AST node and returning the result of a VisitResult (one, several or zero AST nodes).  You can configure the converter so that only the selected nodes will change. </p><br><div class="spoiler">  <b class="spoiler_title">input-output.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// input export namespace protos { // ModuleDeclaration export namespace user { // ModuleDeclaration // Module Block export interface User { // InterfaceDeclaration username: string; // username: string is PropertySignature info: protos.Info.User; // TypeReference } } export namespace Info { export interface User { name: protos.Info.Name; // TypeReference } export interface Name { firstName: string; lastName: string; } } } // this line is a TypeAliasDeclaration export type User = protos.user.User; // protos.user.User is a TypeReference // output export interface User { username: string; info: { // info: { .. } is a TypeLiteral name: { // name: { .. } is a TypeLiteral firstName: string; lastName: string; } } }</span></span></code> </pre> </div></div><br><p>  <a href="https://astexplorer.net/">Here</a> you can see with which nodes we will work. </p><br><p>  Visitor must perform two basic actions: </p><br><ol><li>  Replacing <strong>TypeAliasDeclarations</strong> with <strong>InterfaceDeclarations</strong> </li><li>  Convert <strong>TypeReferences</strong> to <strong>TypeLiterals</strong> </li></ol><br><h1 id="reshenie">  Decision </h1><br><p>  This is what the Visitor code looks like: </p><br><div class="spoiler">  <b class="spoiler_title">aliasTransformer.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> path <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'path'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ts <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'typescript'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> fs <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'fs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filePath = path.resolve(_.first(process.argv.slice(<span class="hljs-number"><span class="hljs-number">2</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> program = ts.createProgram([filePath], {}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> checker = program.getTypeChecker(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> source = program.getSourceFile(filePath); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> printer = ts.createPrinter(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> typeAliasToInterfaceTransformer: ts.TransformerFactory&lt;ts.SourceFile&gt; = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">context</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> visit: ts.Visitor = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">node</span></span></span><span class="hljs-function"> =&gt;</span></span> { node = ts.visitEachChild(node, visit, context); <span class="hljs-comment"><span class="hljs-comment">/* Convert type references to type literals interface IUser { username: string } type User = IUser &lt;--- IUser is a type reference interface Context { user: User &lt;--- User is a type reference } In both cases we want to convert the type reference to it's primitive literals. We want: interface IUser { username: string } type User = { username: string } interface Context { user: { username: string } } */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ts.isTypeReferenceNode(node)) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> symbol = checker.getSymbolAtLocation(node.typeName); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> type = checker.getDeclaredTypeOfSymbol(symbol); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> declarations = _.flatMap(checker.getPropertiesOfType(type), property =&gt; { <span class="hljs-comment"><span class="hljs-comment">/* Type references declarations may themselves have type references, so we need to resolve those literals as well */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _.map(property.declarations, visit); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ts.createTypeLiteralNode(declarations.filter(ts.isTypeElement)); } <span class="hljs-comment"><span class="hljs-comment">/* Convert type alias to interface declaration interface IUser { username: string } type User = IUser We want to remove all type aliases interface IUser { username: string } interface User { username: string &lt;-- Also need to resolve IUser } */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ts.isTypeAliasDeclaration(node)) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> symbol = checker.getSymbolAtLocation(node.name); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> type = checker.getDeclaredTypeOfSymbol(symbol); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> declarations = _.flatMap(checker.getPropertiesOfType(type), property =&gt; { <span class="hljs-comment"><span class="hljs-comment">// Resolve type alias to it's literals return _.map(property.declarations, visit); }); // Create interface with fully resolved types return ts.createInterfaceDeclaration( [], [ts.createToken(ts.SyntaxKind.ExportKeyword)], node.name.getText(), [], [], declarations.filter(ts.isTypeElement) ); } // Remove all export declarations if (ts.isImportDeclaration(node)) { return null; } return node; }; return node =&gt; ts.visitNode(node, visit); }; // Run source file through our transformer const result = ts.transform(source, [typeAliasToInterfaceTransformer]); // Create our output folder const outputDir = path.resolve(__dirname, '../generated'); if (!fs.existsSync(outputDir)) { fs.mkdirSync(outputDir); } // Write pretty printed transformed typescript to output directory fs.writeFileSync( path.resolve(__dirname, '../generated/models.ts'), printer.printFile(_.first(result.transformed)) );</span></span></code> </pre> </div></div><br><p>  I like the way my decision looks.  It embodies the power of good abstractions, an intelligent compiler, useful development tools (auto-completion of VSCode, AST explorer, etc.) and bits of experience from other skilled developers.  Its full source code with updates can be found <a href="https://github.com/ksaldana1/ts-alias-transformer">here</a> .  Not sure how useful it will be for more general cases, different from my private one.  I just wanted to show the capabilities of the TypeScript compiler toolkit, and also to put my thoughts on the solution of a non-standard problem that had been bothering me for a long time. </p><br><p>  I hope that by my example I will help someone to simplify their lives.  If the topic of AST, compilers and transformations is not completely clear to you, then follow the links to third-party resources and templates that I have provided, they should help you.  I had to spend a lot of time studying this information to finally find a solution.  My first attempts in private Github repositories, including 45 <code>// @ts-ignores</code> and <code>// @ts-ignores</code> , make me blush with shame. </p><br><h1 id="resursy-kotorye-mne-pomogli">  Resources that helped me: </h1><br><p>  <a href="https://github.com/Microsoft/TypeScript/wiki/Using-the-Compiler-API">Microsoft / TypeScript</a> </p><br><p>  <a href="https://43081j.com/2018/08/creating-a-typescript-transform">Creating a TypeScript Transformer</a> </p><br><p>  <a href="https://blog.scottlogic.com/2017/05/02/typescript-compiler-api-revisited.html">TypeScript compiler APIs revisited</a> </p><br><p>  <a href="https://astexplorer.net/">AST explorer</a> </p><br><p>  <em>Our team creates a cool <a href="https://client.testmace.com/">TestMace</a> tool - a powerful IDE for working with APIs.</em>  <em>Create scripts, test endpoints and use all the power of advanced autocompletion and syntax highlighting.</em>  <em>Write to us!</em>  <em>We are here: <a href="https://t.me/testmace">Telegram</a> , <a href="https://testmaceslackin.herokuapp.com/">Slack</a> , <a href="https://www.facebook.com/testmace/">Facebook</a> , <a href="https://vk.com/testmace">Vk</a></em> <em><br></em> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/457770/">https://habr.com/ru/post/457770/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../45776/index.html">What do independent experts think about the USE?</a></li>
<li><a href="../457760/index.html">How to make containers even more isolated: an overview of container sandbox technologies</a></li>
<li><a href="../457764/index.html">10 mistakes of the young PO (part II)</a></li>
<li><a href="../457766/index.html">Generate tile levels and hide squares from the player.</a></li>
<li><a href="../457768/index.html">How I became vulnerable: we scan IT infrastructure with Qualys</a></li>
<li><a href="../457774/index.html">Studying a private pilot in Middle-earth: moving and living in a New Zealand village</a></li>
<li><a href="../45778/index.html">The new version of Ruby is faster up to 5 times</a></li>
<li><a href="../457784/index.html">Custom'a Eye-tracker calibration</a></li>
<li><a href="../457786/index.html">Updated Anet A8 Plus. Large and made of metal</a></li>
<li><a href="../457790/index.html">BuratinoPhone mobile phone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>