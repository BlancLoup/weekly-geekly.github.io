<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tibero and Oracle compatibility issues. Part 1. Conditional PL / SQL Compilation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Conditional PL / SQL compilation allows you to selectively compile portions of the source code depending on the condition, usually associated with the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tibero and Oracle compatibility issues. Part 1. Conditional PL / SQL Compilation</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/hy/vh/bw/hyvhbw4hc1jwuiluukn_66ci4ii.png"></div><br><p>  Conditional PL / SQL compilation allows you to selectively compile portions of the source code depending on the condition, usually associated with the value of the package constant.  This is often used to ensure compatibility of applications with different versions of the DBMS. <br>  In December 2017, this possibility appeared in Tibero, which made it possible to ensure even greater compatibility of applications between Tibero and Oracle. </p><a name="habracut"></a><br><p>  As an example, take a packet to declare and associate exceptions with system error codes.  In Tibero, system error codes are different from Oracle. </p><br><p>  First of all, you need to use standard exceptions from the SYS.STANDARD package, such as NO_DATA_FOUND.  There will be no compatibility issues with them.  For the rest of the exceptions used in your application, it is recommended to create a separate package. <br>  In this package, user exceptions with error codes from -20999 to -20000 are also fine - both in Tibero and in Oracle.  In other cases, if you plan to use this application to work with both Oracle and Tibero, you can use conditional compilation. </p><cut></cut><br><p>  First, we need a packet with a constant to determine which DBMS we work with: </p><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> tmax_ConstPkg <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> c_isTibero <span class="hljs-keyword"><span class="hljs-keyword">constant</span></span> <span class="hljs-built_in"><span class="hljs-built_in">boolean</span></span> := <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> tmax_ConstPkg;</code> </pre> <br><p>  Now you can write the binding of exceptions depending on the DBMS: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> tmax_ErrPkg <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> e_object_not_exists <span class="hljs-keyword"><span class="hljs-keyword">exception</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">pragma</span></span> exception_init(e_object_not_exists, $<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> tmax_Constpkg.c_isTibero $<span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">-7071</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">-4043</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">END</span></span> ); <span class="hljs-comment"><span class="hljs-comment">-- e_compilation_error exception; pragma exception_init(e_compilation_error, $IF tmax_Constpkg.c_isTibero $THEN -15163 $ELSE -06550 $END ); end tmax_ErrPkg;</span></span></code> </pre> <br><p>  If the package for the declaration and binding of exceptions in your application for Oracle is already used, then you need to get (empirically) the corresponding error code in Tibero and add it using conditional compilation. </p><br><p>  In the event that the declaration and binding of exceptions are scattered throughout the code of your application, this is not a reason for panic. </p><br><p>  We decided to use a great opportunity to analyze PL / SQL code using PL / Scope.  It is impractical to <a href="https://github.com/VasiliyFloka/Oracle2Tibero_Tools">list</a> all the utility code here, it is available on <a href="https://github.com/VasiliyFloka/Oracle2Tibero_Tools">Oracle2Tibero_Tools</a> .  The utility consists of several PL / SQL packages, two of which have already been discussed above.  The easiest way to use them is if you install these packages into the schema of your application along with the PL / SQL objects being analyzed. </p><br><p>  Since  PL / Scope is used to analyze the code, it is necessary to compile your PL / SQL objects in the identifier search mode, for example: </p><br><pre> <code class="sql hljs">SQL&gt; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SESSION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> plscope_settings=<span class="hljs-string"><span class="hljs-string">'IDENTIFIERS:ALL'</span></span>; SQL&gt; <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">procedure</span></span> p1 compile;</code> </pre> <br><p>  To recompile <strong>all</strong> PL / SQL objects in the identifier search mode, just run: </p><br><pre> <code class="sql hljs">SQL&gt; exec tmax_check4migrate.recompile4plscope</code> </pre> <br><p>  Now you can run the utility as follows: </p><br><pre> <code class="sql hljs">SQL&gt; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> serveroutput <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span>&gt; exec tmax_check4migrate.run</code> </pre> <br><p>  All problematic exceptions will be displayed, suggesting the use of either standard exceptions or declaration blanks and linking exceptions with Oracle error codes for the Tmax_ErrPkg package: </p><br><pre> <code class="hljs sql">1. Exception LONG_TEXT(PACKAGE BODY HR.TEST line 2528) init <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> code <span class="hljs-number"><span class="hljs-number">-6502</span></span>(line <span class="hljs-number"><span class="hljs-number">2529</span></span>) ...replace it <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> VALUE_ERROR <span class="hljs-keyword"><span class="hljs-keyword">Reference</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">PACKAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span> HR.TEST line(s) <span class="hljs-number"><span class="hljs-number">2570</span></span>,<span class="hljs-number"><span class="hljs-number">2615</span></span> <span class="hljs-number"><span class="hljs-number">3.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> E_MONTH_ERR(<span class="hljs-keyword"><span class="hljs-keyword">PACKAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span> HR.TEST line <span class="hljs-number"><span class="hljs-number">6128</span></span>) init <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> code <span class="hljs-number"><span class="hljs-number">-1843</span></span>(line <span class="hljs-number"><span class="hljs-number">6129</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Reference</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">PACKAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span> HR.TEST line(s) <span class="hljs-number"><span class="hljs-number">6198</span></span> ... ...You need <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> conditional compilation <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">define</span></span> different <span class="hljs-keyword"><span class="hljs-keyword">system</span></span> <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> codes <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Tibero <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Oracle</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Following</span></span> <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> codes did <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> find <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Tmax_ErrPkg <span class="hljs-keyword"><span class="hljs-keyword">package</span></span>, need <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span>: <span class="hljs-comment"><span class="hljs-comment">/* ORA-01843: not a valid month */</span></span> <span class="hljs-comment"><span class="hljs-comment">------------------------------ e_not_a_valid_month exception; pragma exception_init(e_not_a_valid_month, $if tmax_Constpkg.c_isTibero $THEN -????? $ELSE -1843 $END );</span></span></code> </pre> <br><p>  By the way, it will be useful at least to consolidate all the exceptions into one package.  I'll warn you right away that, in addition to checking for exceptions, the utility solves a number of other compatibility issues, which we will discuss in the following sections.  Therefore, at this stage, in the main Run procedure, you can comment out calls to other checks ‚Äî procedures with the prefix Chk_. </p><br><p>  After you add all the exception blanks to the Tmax_ErrPkg package, you can run the utility in fix mode: </p><br><pre> <code class="sql hljs">SQL&gt; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> serveroutput <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span>&gt; exec tmax_check4migrate.run(p_modify =&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>)</code> </pre> <br><p>  Old declarations and bindings will be commented out and instead, the code will use either standard exceptions or exceptions from the Tmax_ErrPkg package. </p><cut></cut><br><p>  Now, as for Tibero.  At the time of this writing, the conditional compilation is not yet included in the standard assembly available on <a href="http://technet.tmaxsoft.com/">technet.tmaxsoft.com</a> .  You can check the conditional compilation support on your Tibero instance or by trying to set the required initialization parameters: </p><br><pre> <code class="hljs">_PSM_PREPROCESS=Y _PSM_PREPROCESS_SELECTION=Y</code> </pre> <br><p>  Or you can check the SQL request that such hidden parameters are: </p><br><pre> <code class="sql hljs">SQL&gt; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sys._vt_parameter <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> <span class="hljs-string"><span class="hljs-string">'_PSM_PREPROCESS%'</span></span>;</code> </pre> <br><p>  You can request a version of Tibero that supports conditional compilation in the Russian office of TmaxSoft. </p><cut></cut><br><p>  In the following publications, we will look at some of the differences between the Tibero and Oracle syntax that you may encounter, as well as how to avoid the associated fixes manually. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/350530/">https://habr.com/ru/post/350530/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350516/index.html">Using the KOMPAS-3D API ‚Üí Lesson 8 ‚Üí More complex methods of writing to the title block</a></li>
<li><a href="../350520/index.html">Google, Qualcomm and cloud gaming services. Integration success?</a></li>
<li><a href="../350524/index.html">Results of MentorHack: chat bot for selecting conversations from dialogues, services for building career paths and teams</a></li>
<li><a href="../350526/index.html">WhiteList vs BlackList: how to implement file extension checks and not become a victim of hackers</a></li>
<li><a href="../350528/index.html">How we did the Olympiad in SQL (end)</a></li>
<li><a href="../350536/index.html">Elegant Patterns of Modern JavaScript: RORO</a></li>
<li><a href="../350538/index.html">Introduction to Gjallarhorn.Bindable.WPF (F #) on the example of the test</a></li>
<li><a href="../350540/index.html">Detective story about RMCP + and OpenSSL, or how Wireshark helped defeat an incorrect argument in OpenIPMI</a></li>
<li><a href="../350542/index.html">Prospects for the development of the video surveillance industry: the capabilities of modern video analytics systems</a></li>
<li><a href="../350544/index.html">Learned helplessness in software development</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>