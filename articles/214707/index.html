<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Another do-it-yourself NAS, part 1: from what was</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="annotation 
 On average, the next post about the NAS appears about once every six months, and talks about how to put the system on the documentation. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Another do-it-yourself NAS, part 1: from what was</h1><div class="post__text post__text-html js-mediator-article"><h4>  annotation </h4><br>  On average, the next post about the NAS appears about once every six months, and talks about how to put the system on the documentation.  We will complicate the task by tying it to a real project and limiting the budget.  In addition, we will also try to spread our straw in places where the young sysadmin has not yet walked, and also destroy several industry myths. <br><br>  This article is not for server storage professionals, gamers and other overclockers.  For you, colleagues, and so the whole industry works.  It is for novice sysadmins, fans of UNIX-systems and free software enthusiasts.  All accumulated old iron.  Everyone needs to store large volumes at home or in the office.  But not everyone has easy access to server technologies. <br><br>  I really hope that you will find some useful ideas for yourself and still learn from the mistakes of others.  Remember: the system does not cost as much as you paid for the iron, but how much time and effort you put into testing and operation. <br>  If you do not want to read - see the links and conclusions at the end;  maybe you change your mind. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  DISCLAIMER </h4><br>  The information is provided by AS-IS without any liability for its use by anyone, anywhere and ever.  All inadvertently mentioned trademarks are the property of their respective owners.  Some of them do not need advertising so much that I make them funny names. <br><br><h4>  Thanks </h4><br>  Respect Andrei Alexandrovich Bakhmetyev, engineer and inventor.  I am proud that Andrei Aleksandrovich taught for me at the institute!  I wish him every success in his projects! <br><br><h4>  Task </h4><br>  So, there is a small business startup that generates about 50GB of files per week, with the need to archive them for several years.  Files are large (about 10‚Äì20 MB each); they are not compressible by conventional algorithms.  The initial data volume is about 2TB.  Very old data can be stored offline, connecting on demand. <br>  It is necessary to meet a very modest <b>initial budget of the decision of 500 euros</b> (in the prices of summer 2013) and a <b>two-week period for <u>assembly and testing</u></b> . <br><br>  For this money, you need to build a system that allows you to work with files on a small group on the same local network from different platforms (Windows, Mac OS).  It requires long-term work without a sysadmin on the site, protection against failures and basic functions of managing access rights. <br><br><h4>  Traditional ways </h4><br>  Of course, you can buy network storage: they are made by <a href="http://www.netapp.com/">NetApp</a> , <a href="http://www.qnap.com/">QNAP</a> , <a href="http://www.synology.com/">Synology</a> and other players, and, moreover, they do well even for small businesses.  But our 500 euros is just the beginning of a conversation for an empty box, without the disks themselves.  If you have 1000-2000 euros, better buy the finished product, and we will try to pay as much as possible with knowledge and minimally with time and money. <br><br>  <b>UPD (spoiler rev. 2 dated 2014-03-08):</b> <br><div class="spoiler">  <b class="spoiler_title">If you collect from new iron, but not from trash</b> <div class="spoiler_text">  From the aggregate of this post and its comments, kindly provided by the habrocomunity, I propose the following algorithm for a simple <b>four-</b> disk system: <br><ol><li>  If the double size of the most capacious of the available disk models is not enough for the stored data, stop reading the spoiler <i>(example: 4TB model, you need to store 7TB of data, then continue; if you want to store 10Tb, then we stop)</i> </li><li>  Choose a product from the MicroServer line of the famous server manufacturer Harlampy-Pankrat;  for example, n36l, n40l, n54l, with four drive bays <i>(the main thing is to support ECC memory)</i> </li><li>  We are surely completing our server <b>with parity</b> memory <b>(ECC)</b> at the rate of 1GB for every 1TB of stored data, but not less than 8GB <i>(as <a href="http://doc.freenas.org/index.php/Hardware_Recommendations">recommended by FreeNAS</a> for disks up to 4Tb, just 8GB is obtained)</i> </li><li>  If we do not have an ECC memory, <b>immediately stop reading this spoiler</b> , read the post to the end </li><li>  Select the <i>manufacturer of the</i> discs using the current overview of failures;  for example, this one: <a href="http://habrahabr.ru/post/209894">http://habrahabr.ru/post/209894</a> </li><li>  Choosing an <i>inexpensive line of</i> SATA disks with the <b>mandatory presence of ERC</b> , and why, read here: <a href="http://habrahabr.ru/post/92701">http://habrahabr.ru/post/92701</a> </li><li>  Select the <i>capacity of the</i> disks (2Tb, 3Tb or 4Tb) on the basis that there will be four of them, and that only half will be available for data (the second half for RAID redundancy) </li><li>  Before purchasing, we carefully and thoroughly check the compatibility of the iron with each other, the number of slots, compartments, strips and other things, but for FreeNAS the most important thing is the support of all the iron with the actual FreeBSD kernel </li><li>  Choosing a good bootable flash drive after reading the continuation of this post (part 2: good memories) </li><li>  We buy, inhale the flavors of new iron, collect, connect, run;  for ZFS, be sure to <b>turn off all hardware RAIDs</b> </li><li> Create a <b>RAIDZ2</b> volume from four disks, always with <b>double redundancy</b> <i>(on a size of about 12TB there is a risk to meet the evil URE, read about it in this post; if we are not afraid of URE and still collect the RAIDZ on four disks, check the size of the physical sector - on modern disks, it is 4Kb, and in this case it will turn out to be a completely ridiculous 43Kb strip, which will also drop us the speed of the array: <a href="http://forums.servethehome.com/hard-drives-solid-state-drives/30-4k-green-5200-7200-questions.html">forums.servethehome.com/hard-drives-solid-state-drives/30-4k-green-5200-7200- questions.html</a> )</i> </li><li>  Salt, sugar, pepper, jail'y, balls, scripts and the like sour cream add to taste </li></ol><br></div></div><br><br>  But what about <b>cloud storage</b> , you ask?  At the time of this writing, popular cloud storage for our volumes look more expensive than we would like.  For example, the cost of storing an unlimited amount of data for 36 months at a well-known service. Drop Boxing will cost you a couple of thousand dollars or more, although you can pay them out gradually.  Of course, there are services like <a href="http://aws.amazon.com/glacier">Amazon Glacier</a> (thank AM for the hint) or Open Window, but, first, they charge not only storage, but also appeal (how to calculate it a priori?), And second, let's not forget that business is sitting on a 10Mbps Internet uplink, and terabytes maneuvers will require not only some effort to manage the processes, but will also be very tedious for users. <br><br>  Usually in such cases, take the old computer, buy more large disks, put Linux (not necessarily, someone contrives and Windows 7), make an array of RAID5.  Fine.  Everything works well for about six months or a year, but one sunny morning, the server suddenly disappears from the network without any warning.  Of course, the sysadmin has been working in another company for a long time (staff turnover), there is no backup copy (the volumes are too large), and the new sysadmin cannot repair the system (and the old sysadmin and Linux YYY dialect stand on the light) ZZZ, then there really would be no problems).  All these stories are repeated a long time and in the same way, only OS versions change and data volumes grow. <br><br><h4>  Industry Myths </h4><br><h5>  RAID5 myth </h5><br>  The most common myth in which I myself believed until recently was that there could not be a second failure in an array in practice according to the theory of probability.  And here can, and how!  Let's simulate a real situation: the server has worked for a couple of years, after which the disk fails in the array.  So far nothing terrible, we put a new disk, and what happens?  Yeah, array reconstruction, i.e.  prolonged maximum load on the already worn discs.  In such a situation, failures are very possible and occur. <br>  But that's not all.  There is still a manufacturer‚Äôs methodical probability of a read error, which, under certain circumstances, now almost guarantees that RAID5 will not build back after a disk failure. <a name="habracut"></a><br><br><h5>  Terabyte myth </h5><br>  You can, of course, assume that all disk manufacturers are novice programmers, but one industry kilobyte has 1000 bytes received, strictly according to the SI system (the other kilobyte has actually been called <a href="http://www.wikipedia.org/wiki/Kibibyte">kibibyte</a> since 1998 and is denoted by KiB).  However, this is not all.  The fact is that all manufactured spindle disks have defects already found at the factory, the number of which is random, and therefore the actual available size ‚Äúwalks‚Äù.  In budget models, he walks even within the same batch of identical products, both in the larger and in the smaller direction.  In my set of four identical disks with a nominal value of 2 TB, two turned out to be about 2 GB less, and the other two - about 400 MB more than the nominal volume.  Those.  kilobytes, like a sine in wartime, ranges from 999 bytes to 6 bits to an honest 1000 bytes, even with a nib at the end.  Either the products are delivered to our market by leaking submarines, or the flood is to blame, but the bits go somewhere. <br><br>  Do not underestimate this factor: if replacing a failed disk in an array turns out to be at least one block shorter than the nominal volume, then the degraded RAID will not theoretically gather to an optimal state, and we will get a headache that could have been easily avoided at first.  Proceeding from this, more does not mean better, the main thing is constancy. <br>  I assume that server hardware manufacturers solve this problem by always making technological reserves and at the same time artificially lowering the amount of available space in the disk firmware, so with a certain product code they always (within the support) get a disk that has the same capacity .  This is probably one of the reasons why the Seagate drive under the well-known server trademark Harlampy-Pankrat and his ‚Äúbrother‚Äù without it is not quite the same product.  But this is just my guess.  Perhaps the leaders of the data storage market have up-to-date trump cards as well. <br><br><h4>  Project risks </h4><br>  In any project it is important to understand the risks, because in the end we are building not for fun, but for the success of the business.  In order to achieve harmony Crepsondo (excuse, business continuity), for the beginning we will build a simplified risk model that should take into account possible failures and their consequences. <br><br><h5>  Hardware </h5><br>  According to the budget, we do not have access to server hardware, therefore we can use only cheap disks and controllers, and this is a territory of spontaneous failures out of the blue.  Hardware risks include: mechanical wear (spindle disks, fans), electrical wear (especially flash memory), errors in the firmware of the disk or controller, poor-quality power supply, poor-quality disks, spilling hardware RAID.  Lack of spare parts of the instrument‚Äôs property in stock due to obsolescence can also be considered as a risk. <br><br><h5>  Software </h5><br>  Software malfunctions include the problems of standard operating systems that tend to self-destruct and are not the best self-healing ability after power failures, requiring regular administration.  Add to this the reconstruction of the software RAID array, errors in the controller drivers, user actions (intentional and unintentional), actions of malicious code. <br><br><h4>  Iron available </h4><br>  At hand was my old computer around 2004.  the release on the motherboard Socket 478 <a href="http://www.gigabyte.com/products/product-page.aspx%3Fpid%3D1648">GA-8IPE1000MK</a> , with a Pentium 4 @ 3 GHz CPU and 1 GB of RAM.  The case says ZEUS, it has as many as six internal 3.5 ‚Äùcompartments (by the standards it is a lot), one 3.5‚Äù for archaic FDD, four 5.25 ‚Äù, two spaces for cooling fans and a 250W power supply.  The ATI RADEON 8500 video card at one time rendered hits such as Soldiers of Anarchy, but its fan on the oil bearing howls for a long time, like the Baskervilles dog (of course, when it turns out to be a rotation at all).  The cooling of the CPU was decided by Zalman <a href="http://www.zalman.com/eng/product/Product_Read.php%3FIdx%3D266">CNPS5700D-Cu</a> , which pulled the heated air from the radiator and blew it through the eccentric duct into the case, from where it had to be blown out again with a second fan. <br><br>  One day I was so sick of this whole airfield that I decided to cut it out literally: I took a power saw and cut a round hole in the case (on the fan grill), having increased the air duct with a piece of plastic bottle from under the Karma Doma mineral water.  Removed the second fan and lowered the first (on the CPU) revolutions rheostat. <br><br>  In such a slightly punk form, all this material part was sad on the shelf until our days. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/230/084/6ae/2300846ae2517eab436fb6a482d02b4c.jpg"><br><br>  Complementing my Kunstkamera hole in the rear panel of the case because of the free interpretation of the manufacturer of the body of standards ATX: it was impossible to drive a blank panel there without a file, and I left these attempts. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e6f/351/26e/e6f35126e6d7f29743ce8031beb1682c.jpg"><br><br>  The motherboard had a RAM controller, which did not allow changing the bracket in STANDBY mode (this is when the computer is turned off with the button, but the power supply is turned on).  There's even a special LED led displayed RAM_LED, whose task was to warn the sysadmin about the presence of voltage in the circuit: <br><blockquote>  When RAM_LED is ON, do not install / remove DIMM from socket </blockquote><br>  Of course, in the end, the controller is covered;  and if you do not move the memory in the slot in a certain shamanic manner, the motherboard did not see it and began to squeak resentfully.  In the <a href="http://www.computerhope.com/beep.htm">reference book,</a> this signal could mean both a RAM problem and a power supply problem, which was completely confusing.  To complete the picture, the BIOS created some kind of particularly wicked environment when booting from flash drives, which is why I categorically did not load all the SYSLINUX derivatives (for reference: this is almost the only CD / flash drive bootloader for a huge number of Linux variants). <br>  So what am I doing all this for? <br><br>  <b>Findings:</b> <br><ol><li>  Such a computer for a server task is completely unsuitable. <br></li><li>  Young sysadmins categorically contraindicated sex with old iron. <br></li></ol><br><br><h4>  Ideas </h4><br><h5>  Iron replacement </h5><br>  Of course, the buggy mother, the worn out mechanics and the old power supply unit do not fit the Crepsondo philosophy at all (oh, sorry business continuity again), and therefore must be replaced first and foremost without any further discussion.  Harmony Crepsondo is more important for us, so say goodbye to the old iron, it fulfilled its historical mission. <br>  The replacement choice for Socket 478 turned out to be small: ASRoc <a href="http://www.asrock.com/mb/overview.asp%3FModel%3DP4i65G">P4i65G</a> .  It seems to be a good mother with onboard graphics, three PCI, two SATA and six USB on board.  Hardware monitoring is based on Winbond W83627 (supported in the <a href="http://www.lm-sensors.org/ticket/1865">lm-sensors</a> package; this later turned out to be useful in calibrating the rheostat of the fan based on the CPU temperature of the operating system). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c4d/690/e47/c4d690e478542e45e727cc97107b3f77.jpg"><br><br>  Now nothing beeps, booting from flash drives works fine, which is already pleasing.  Onboard a hundred megabits for the NAS is not enough, so one PCI slot immediately occupies the budget D-Link <a href="http://www.dlink.com/us/en/home-solutions/connect/adapters/dge-530t-dge-530t-32-bit-10-100-1000-base-t-pci-adapter">DGE-530T</a> , and two more <a href="http://www.dlink.com/us/en/home-solutions/connect/adapters/dge-530t-dge-530t-32-bit-10-100-1000-base-t-pci-adapter">PCIs</a> are left on the disk controllers.  Usually they have up to four ports, which together with two onboard will give us the opportunity to connect ten drives. <br>  I will tell about the new power supply unit later, for the time being I‚Äôll just note that 250W was enough for my Socket 478-based system.  Therefore, having estimated the power of 200W in my mind for the promotion of spindle disks, I immediately agreed to the budget source FSP Group <a href="http://www.fsp-power.ru/product/atx_450pnr">ATX-450PNR</a> with a nominal value of 450W offered to me in the store.  Superficially, I liked the large low-speed 120mm fan - which means noise will be less ( <b>UPD: looking ahead, ATX-450PNR, despite all the tricks, failed to cope with the task, and I do not recommend using it</b> ; see <a href="http://habrahabr.ru/post/218387/">habrahabr.ru/post/218387</a> ). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d4/8b1/fb1/6d48b1fb13c75ce13e0046bf4f0da524.jpg"><br><br>  At the same time, I grabbed a pair of Zalman <a href="http://www.zalman.com/eng/product/Product_Read.php%3FIdx%3D410">ZM-F1-FDB</a> fans on a trendy hydrodynamic bearing: the first one goes to the CPU cooler, the second one to blow the first group of disks. <br>  Actually, it remains to choose the most important. <br><br><h4>  Disk subsystem </h4><br>  For network storage, the most important task is to select an array mode ( <a href="http://www.wikipedia.org/wiki/RAID">RAID</a> ).  Since the budget of the solution does not allow us to use server hardware, we sigh and immediately postpone hardware RAID controllers, SAS and other Fiber Channel aside.  There we lay aside and solid-state drives.  If we have a NAS in the kitchen (sorry for the pun), the thorny path will pass through the magical world of <b>software RAID solutions based on cheap SATA spindle drives</b> .  So much more entertaining, but practice crepsondo will help us. <br><br><h5>  Discs </h5><br>  In my subjective opinion, SATA products (compared to SAS / FC) are still more confused and more mixed with marketing.  In the Seagate spindle drive, I saw two conditional price ranges, which differ by about 40%.  The top one is considered to be a solution for medium-sized businesses, and the bottom one - for home users and small businesses.  What threatens the use of the cheapest discs?  According to the subjective estimates of some experts ( <a href="http://forums.freenas.org/threads/what-number-of-drives-are-allowed-in-a-raidz-config.158/">link</a> ), cheap drives fail significantly more expensive in the first week of operation, and the trend continues for the year.  Carefully citing this table here, I repeat that this is a very approximate subjective assessment of one of the Internet users, without specifying specific products: <br><br><table border="1"><tbody><tr><td>  Technology </td><td>  Bounce in the first week </td><td>  Bounce in the first year </td></tr><tr><td>  Fiber Channel </td><td>  1 of 40 </td><td>  2 of 40 </td></tr><tr><td>  SAS </td><td>  1 of 34 </td><td>  2 of 34 </td></tr><tr><td>  SATA dear </td><td>  1 of 14 </td><td>  2-4 of 14 </td></tr><tr><td>  Sata cheap </td><td>  1 of 8 </td><td>  2-4 of 8 </td></tr></tbody></table><br><br>  According to the observation of the same user, about one or two of a dozen yearling SATA drives fail in the second year of life.  Of course, all SATA significantly behave worse than SAS or Fiber Channel, with this one can hardly argue.  As, however, with a dedicated budget, which leaves us little choice. <br><br>  I chose the manufacturer of Seagate quite intuitively, so I will not describe this process. <br><br>  <b>UPD:</b> <br>  Since the events described took place in the summer of 2013, I did not read this wonderful post: <a href="http://habrahabr.ru/post/209894/">http://habrahabr.ru/post/209894/</a> .  It follows from it that Seagate is not the best choice, but the reader, of course, is now warned and armed.  Thank you, habrokomyuniti, you are the best! <br><br>  Quickly analyzing the offers in stores, I noted that the price of budget disks of large volume 4Tb is almost 90% higher than offers for 2Tb, i.e.  the unit cost of storing a gigabyte grew almost linearly from the volume.  Why is this so important?  The fact is that I could not find a controller for a PCI bus with guaranteed support for 4Tb drives, and it was not possible to experiment.  This posed a difficult choice: either to limit the 2TB disks or to abandon the old hardware and switch to the PCI Express bus (with the purchase of a new computer).  Fortunately, the almost linear dependence of price on capacity has saved difficult decisions, but I recommend the reader to always consider the total cost of the disk subsystem, because in NAS it is decisive, and the benefit from capacious disks can outweigh everything else. <br><br>  I liked its price model <a href="http://www.seagate.com/ru/ru/internal-hard-drives/desktop-hard-drives/barracuda/%3Fsku%3DST2000DM001">ST2000DM001</a> .  It was the most budgetary option in the Seagate line at 2Tb, uses the new sector size of 4Kb and requires proper initialization (formatting) of the file system.  Interestingly, representatives of <a href="http://www.seagate.com/ru/ru/internal-hard-drives/desktop-hard-drives/barracuda/%3Fsku%3DST2000DM001">ST2000DM001</a> come across with both two and three plates (in the picture - an option with two). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a0a/de3/49b/a0ade349bf6059b256d4be9e6c5d8697.jpg"><br><br>  Take four pieces of <a href="http://www.seagate.com/internal-hard-drives/desktop-hard-drives/barracuda/%3Fsku%3DST2000DM001">ST2000DM001</a> at 7200 rpm, enough to start.  Three discs were purchased with two plates (a larger recess on the case and a third letter of the serial number: E), and a fourth with three plates (a smaller recess on the case, the third letter of the serial number: F).  Drive modification 1CH164, firmware version CC26.  Do not forget that we are dealing with cheap SATA-drives, so at least update the firmware to CC29. <br><br>  Of course, a representative of the NAS HDD <a href="http://www.seagate.com/internal-hard-drives/nas-drives/nas-hdd/%3Fsku%3DST2000VN000">ST2000VN000</a> line is more adapted to our task: this model has the most useful for the <a href="http://knowledge.seagate.com/articles/en_US/FAQ/203991en">ERC</a> array and runs at 5900 rpm;  it can be expected that the drive heats up less, lasts longer, and the difference in speed is unlikely to be noticeable in the network storage mode. <br><br>  <b>UPD:</b> <br>  When choosing disks for an array, be sure to ask for an ERC, read about it here: <a href="http://habrahabr.ru/post/92701/">habrahabr.ru/post/92701</a> <br><br>  Initially, the model <a href="http://www.seagate.com/internal-hard-drives/desktop-hard-drives/barracuda/%3Fsku%3DST2000DM001">ST2000DM001 was</a> greatly confused by the Power-On Hours 2400h parameter, but for Seagate this is the number of operating hours per year, not the total lifetime.  Well, let's hope that a third day of work for a small business should be enough.  You can take the spindles to STANDBY on timeout, sacrificing the start-stop mechanics of the device.  Whether such savings are justified, time will tell. <br><br><h5>  Controller </h5><br>  The choice of vintage SATA controllers for the PCI bus turned out to be small.  I bought a budget 4-port STLab A-224 based on Silicon Image SiI3114.  This controller does not officially support disks larger than 2.2TB, although rare forum users claim the opposite. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e41/bc6/ff3/e41bc6ff3d1c94631639e5655dfe139d.jpg"><br><br>  Since we work with low-end hardware, hardware RAID is better not to use.  Why?  Because the industry rests on low-end RAID controllers, leaving insidious bugs in them.  Because the software array is easier to monitor, repair and tyunit.  Because our computer is actually a RAID controller with a network.  But I still wish good luck to any daredevil who does not agree with me. <br><br>  Despite a lot of flaws, archaic iron still has one significant advantage: drivers, most likely, have long been sewn into the kernels of all operating systems in the world, and over the years of operation, almost all the bugs have been shaken out, and from both drivers and firmware controllers themselves.  I hope that this is the case with A-224, because firmware bugs are very, very dangerous.  The seller, give two controllers, until they finally disappeared from sales. <br><br><h5>  Total </h5><br><table border="1"><tbody><tr><td>  <b>Product</b> </td><td>  <b>Price approx., EUR</b> </td><td>  <b>Qty</b> </td><td>  <b>Cost, EUR</b> </td></tr><tr><td>  Mat.  ASRock P4I65G board </td><td>  47 </td><td>  one </td><td>  47 </td></tr><tr><td>  STLab A-224 controller </td><td>  20 </td><td>  2 </td><td>  40 </td></tr><tr><td>  Disk ST2000DM001 </td><td>  76 </td><td>  four </td><td>  304 </td></tr><tr><td>  Network adapter D-Link DGE-530T </td><td>  eight </td><td>  one </td><td>  eight </td></tr><tr><td>  ATX 450PNR power supply </td><td>  32 </td><td>  one </td><td>  32 </td></tr><tr><td>  Zalman ZM-F1-FDB Fan </td><td>  7 </td><td>  2 </td><td>  14 </td></tr><tr><td>  8GB USB flash memory </td><td>  five </td><td>  one </td><td>  five </td></tr><tr><td>  Cables, adapters, thermal grease, etc. </td><td>  ten </td><td>  - </td><td>  ten </td></tr><tr><td>  <b>TOTAL</b> </td><td></td><td></td><td>  460 </td></tr></tbody></table><br><br>  Let's look again at our design.  Simple as a sleeper, the controller in <a href="http://www.wikipedia.org/wiki/JBOD">JBOD</a> mode will not fail.  Four third-generation SATA disks younger than the controller are about ten years old, and they give out 150 Mb / s on average over the plate (this is more than the entire PCI).  Therefore, they will squeeze out all the juice from the controller, but this is unlikely to be much noticeable on the network.  Restoration of a degraded mirror 2Tb will take from 8 hours, which is a lot, but not fatal;  on 4tb it would be 16h.  There is a slow processor, some RAM, several USB ports, a gigabit network, a completely new mechanic, free ports on the controller, free compartments in the case and an electrical power reserve.  In the budget for iron laid out, we will deal with software. <br><br><h4>  Software selection </h4><br>  Of the free storage systems, <a href="http://www.freenas.org/">FreeNAS</a> , <a href="http://www.openmediavault.org/">OpenMediaVault</a> (OMV) and <a href="http://www.openfiler.com/">openfiler</a> are most often mentioned.  Everyone has their own "chips": for example, OMV is very modest in requirements, and openfiler has the function of <a href="http://www.drbd.org/">remote replication</a> . <br><br>  Let's look at the <a href="http://www.freenas.org/">FreeND</a> project based on the <a href="http://www.freebsd.org/">FreeBSD</a> platform.  For those who do not know: ‚Äúfrishka‚Äù (as it is affectionately called) is not <a href="http://www.linux.org/">Linux</a> , but a free classical UNIX named after the University of Berkeley, California.  By the way, the fry can be considered the grandfather (grandmother?) Of modern Mac OS X. <br><br>  Why FreeNAS?<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The main advantage of FreeNAS is that it is a free project of a system with an industrial design, like the famous brand hypervisor Wash Varyu loaded from a small-sized flash drive. What does industrial design mean? FreeNAS mounts the root file system of the flash drive in read-only mode, and writes logs to the repository or to the RAM disk (did not find such a mode in OMV or in openfiler). This not only saves flash memory from wear and tear, but also protects the server from software failures. FreeFreeNAS is realistically implemented as a turnkey box, i.e. box with one button ON. According to the Crepsondo paradigm, this is the ideal solution for business. Recall also the requirements for customer support for Windows and Mac OS workstations. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FreeNAS's great "trick" are frivolous jails ( </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">virtual</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sandbox machines), in which you can raise Linux, and in it almost everything that managed to give birth to Open Source, without rebuilding. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But do not take FreeNAS as a budget solution. The focus of the FreeNAS team is on the development of a modern </font></font><a href="http://www.wikipedia.org/wiki/ZFS"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZFS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file system </font><font style="vertical-align: inherit;">. This is a whole galaxy of technologies, but for us, its RAM voracity is of paramount importance: 8GB of memory and, accordingly, 64-bit architecture is the beginning of a conversation for adequate performance on our amount of stored data ( </font></font><a href="https://wiki.freebsd.org/ZFSTuningGuide"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="http://doc.freenas.org/index.php/Hardware_Recommendations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). I do not argue, ZFS can be started on the i386 architecture, even with 1GB of RAM. But despite my efforts, on the old hardware, even in simple linear read / write operations, ZFS showed such disgusting performance that I can only consider this option as a system layout, but not a solution. In addition to this, on four drives, ZFS recommends using RAIDZ2, i.e. Effective volume will be half (as in RAID1), but at the same time require an exorbitant consumption of CPU and RAM resources. The question is, how much is ZFS justified on all four disks? In theory, the ZFS array is reconstructed faster, but there is one factor that is very unpleasant for us.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The main problem is that the ZFS system is very sensitive to RAM errors. Here is the conclusion of an expert study of ZFS methodological resilience to RAM errors, conducted by Yupu Zhang, Abhishek Rajimwale, Andrea C. Arpaci-Dusseau, Remzi H. Arpaci-Dusseau from the University of Wisconsin-Madison (quoted from </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">End-to-end Data Integrity for File Systems: A ZFS Case Study</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><blockquote> In the last section we showed the robustness of ZFS to disk corruptions. Although ZFS was not specifically designed to tolerate memory corruptions, we still would like to know how ZFS reacts to memory corruptions, ie, whether ZFS can detect and recover from a single bit flip in data and metadata blocks. Our fault injection experiments indicate that ZFS has no precautions for memory corruptions: bad data blocks are returned to the user or written to disk, file system operations fail, and <b>many times the whole system crashes</b> . </blockquote><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wow, how do you get the whole array to fail on a bunch of TB because of a RAM error? </font><font style="vertical-align: inherit;">No, thank you. We are adepts of Crepsondo, we see similar options in advance and through. </font><font style="vertical-align: inherit;">On the new memory bars with error control (ECC RAM) and the new server motherboard (and at the same time: the processor, cooling, chassis, power supply, etc.), our budget is definitely not enough. </font><font style="vertical-align: inherit;">Therefore, without further regret, we put ZFS aside. </font><font style="vertical-align: inherit;">Good technology, but without server hardware - time bomb. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> if you choose an industrial design in the turnkey box style, then this is FreeNAS; </font><font style="vertical-align: inherit;">if you collect on the old trash, then this is not ZFS; </font></font><a href="http://www.wikipedia.org/wiki/Unix_File_System"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UFS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> remains </font><font style="vertical-align: inherit;">on the </font><a href="http://www.wikipedia.org/wiki/GEOM"><font style="vertical-align: inherit;">GEOM</font></a><font style="vertical-align: inherit;"> framework</font></font><a href="http://www.wikipedia.org/wiki/GEOM"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The only problem is that FreeNAS even with UFS recommends at least 2GB of RAM, which we don‚Äôt have. </font><font style="vertical-align: inherit;">This is a risk, but our workload will be quite small.</font></font><br><br><h5>  A bit of history </h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The </font></font><a href="http://www.freebsd.org/cgi/man.cgi%3Fquery%3Dgeom%26amp%3Bsektion%3D4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geom (4)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> frame </font><font style="vertical-align: inherit;">is a modular subsystem for processing disk operations, developed around 2003. Network Associates (McAfee) security lab for the FreeBSD project as part of a contract with DARPA, alma mater of the entire Internet.</font></font> Those.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From a certain angle, GEOM can be considered a kind of disk relative of the Internet itself, ‚Äúwired‚Äù into the UNIX core by the efforts of antivirus programmers. Here is a cocktail. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is worth remembering the fate of the FreeNAS project itself, which has experienced a kind of split personality (more precisely, development, if we consider the mentioned </font></font><a href="http://www.openmediavault.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OMV</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on the Debian platform). Without going into details, at the exit we have two very similar projects: the new FreeNAS and the old one, for legal reasons now called </font></font><a href="http://www.nas4free.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NAS4free</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It seems that the new owners of the FreeNAS project did not spare the energy for a deep refactoring of the code, which was probably due to the rejection of some ‚Äúoutdated‚Äù functions (for example, </font></font><a href="http://www.wikipedia.org/wiki/RAID5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAID5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). In any case, FreeNAS looks like a strong development driver for FreeBSD, and there is a clear interest in the development of ZFS in the ‚Äúfrishny‚Äù core. Well, we wish good luck to colleagues. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If we compare FreeNAS and its NAS4free ancestor branch, then for me subjectively FreeNAS looks stronger, despite the lack of RAID5. There is a certain feeling that is not easy to explain with words: through the graphical interface of NAS4free it smells like a code smell that requires deep refactoring (‚Äúcode with a smell‚Äù). So what is this refactoring? Here is a simple example: unlike NAS4free, even when working with flash drives, FreeNAS can apply configuration changes without a full system reboot. And this is despite the fact that the root system is mounted in read-only mode. For me it was a strong argument. In addition, FreeNAS has moved to the storage configuration in RDBMS</font></font><a href="http://sqlite.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQlite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and NAS4free still uses simple, but not the most reliable XML format.</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RAID5 or non RAID5 </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Although GEOM's UFS and software RAID arrays do not fit to ZFS with RAIDZ (at first glance, it seems that this is a competition of a set of sleepers against a cable-stayed bridge), GEOM does have some popular modes. </font><font style="vertical-align: inherit;">However, modern FreeNAS does not allow creating RAID5 volumes, and only the simplest modes RAID0 (stripe) and RAID1 (mirror) are left for compatibility.</font></font><br><br>  Why is that? <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are probably two reasons for this, let's call them simple: mechanical and mathematical (although they are intertwined in spindle disks like wave-particle duality). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagine a failure / replacement of one disk in an array of 10TB after two years of operation: the reconstruction process during the week (!) Will be tortured by already worn spindles (see above </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAID5 Myth</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">But with such stress, the old disks may not stretch even three days, finally dropping the array, then stress will begin with us, and what kind. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You ask: how is it, why is the week for reconstruction? </font><font style="vertical-align: inherit;">Let's look at the representatives of two generations of Seagate Barracuda (use materials </font></font><a href="http://www.storagereview.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.storagereview.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><br><table border="1"><tbody><tr><td>  Ruler </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Approximate year </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Capacity </font></font></td><td>  Wed<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plate reading speed, MB / s </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Full reading, h </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RAID5 Reconstruction </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7200.9 </font></font></td><td>  2005 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 500GB </font></font></td><td>  50 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ~ 02: 45 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a very long time </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7200.14 </font></font></td><td>  2012 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4TB </font></font></td><td>  150 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ~ 07: 25 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> prohibitively long </font></font></td></tr></tbody></table><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the capacity has grown about 8 times, then the speed is only three times. </font><font style="vertical-align: inherit;">The irony, however, is that, a priori, we can imagine the RAID1 reconstruction speed here, and even such a fast option on our vintage PCI controller will not be so hot. </font><font style="vertical-align: inherit;">In RAID5 arrays, the speed is generally determined by the mathematical abilities of the processor, and according to various estimates it is about a day for each TB of data (alas, I can‚Äôt give you any links, sorry). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But that's not all, dear reader. </font><font style="vertical-align: inherit;">The disks have a parameter called the Unrecoverable Read Error Rate, which on modern low-end SATA models is 1 sector for every one hundred trillion bits.</font></font> Those.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">approximately from each recorded 12TB disk, one time says ‚Äúforgive, master, but it is absolutely impossible to give back the necessary sector; </font><font style="vertical-align: inherit;">read error. </font><font style="vertical-align: inherit;">This is a methodological mistake made by the manufacturer and therefore </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">theoretically guaranteeing the impossibility of reconstructing a RAID5 array with a capacity of more than 12TB on cheap disks</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (in fairness, we note that the URE on SAS disks is at least an order of magnitude smaller, and the critical volume, respectively, is greater). </font><font style="vertical-align: inherit;">RAID5 epitaph was written by Robin Harris in his article </font></font><a href="http://www.zdnet.com/blog/storage/why-raid-5-stops-working-in-2009/162"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why RAID 5 stops working in 2009</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Following the selection of iron, the maximum total capacity of our disks is 20TB (18 </font></font><a href="http://www.wikipedia.org/wiki/Tebibyte"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TiB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), so once again we remind ourselves about the path to business continuity through the crepsondo philosophical practices, let us take a breath and remember RAID5 together. </font></font><br><br><h5>  :   </h5><br>  So, I refuse both hardware RAID (expensive), and ZFS (expensive) and software RAID5 (slow and unreliable).  I choose FreeNAS with UFS volumes based on GEOM technologies: it can be repaired easily, reliably and, if necessary, like a Kalashnikov rifle.  That is necessary. <br>  Add a USB flash drive to boot the system - we will completely allocate the spindle disks for the data.  We don‚Äôt want someone to pull out a bootable flash drive sticking out from the outside, so we‚Äôll choose the budget flash drive with the smallest dimensions (as it turned out, it was a <b>fatal and rash decision:</b> <a href="http://habrahabr.ru/post/214803/">http://habrahabr.ru/post/214803/</a> ). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5d0/2e1/fe4/5d02e1fe411ddadb222902ebc7590d4c.jpg"><br><br>  From options Stripe and Mirror, I choose, of course, Mirror (ie, RAID1).  The final disk system looks like a set of several independent mirror volumes.  Each mirror is assembled from a pair of 2TB disks (controller limitation), initialized and mounted independently.  The maximum amount of online stored data on ten disks will be about 10TB in five independent volumes (more precisely, 9TiB). <br><br>  Although such a design may seem a bit clumsy, it is really justified with our data volumes and the number of disks: otherwise we would get a non-separable monolith with an extreme reconstruction time for failures. <br><br>  Let's add one small touch here: since cheap consumer disks are used, it will be necessary to artificially reduce the volume when creating volumes so that there are no problems with replacing the failed disks with new ones (with a floating capacity of about 2 TB).  Leave at the end of technological "tails" for better sleep. <br><br><h5>  On the carrying capacity of a car loaded with streamer cassettes </h5><br>  From the point of view of archival storage, you should not get upset about capacity at all: we have a collapsible array.  Having exhausted the available amount of stored data on the online server in volumes No. 1-5, we can manually disable the oldest volume No. 1, extract its disks, install two new 2TB disks and initialize the new volume No. 6.  Old disks can then be shod in a USB-constructive and can be connected to the same FreeNAS server at the request of the business without disassembling the entire case.  You can mount them read-only.  With a great desire, you can connect it to both Windows and Mac.  In any case, remember: the old spindle drive is better not to shake for nothing, and then from age magnetic sand from the HDA will fall down. <br><br>  There is another interesting scenario with <a href="http://www.wikipedia.org/wiki/UnionFS">unionfs</a> : transfer the filled volumes to read mode and put them ‚Äúdown‚Äù under the file system of the ‚Äúupper‚Äù volume, then there will be an illusion of continuity of disk space.  True, unionfs is an abstruse piece and therefore dangerous, and the option with read-only is probably the only one that is more or less tested. <br><br>  All, the volume of archival storage is now limited by the volume of the cabinet or case, where the old disks are added.  If this case is also moved in space, then the bandwidth is generally off scale. <br><br><h4>  Case engineering </h4><br>  Let's think a little about primary cooling, because our disks at 7200rpm will be lukewarm.  We find in the case a place for blowing 3.5 ‚Äùcompartments and with almost surgical work we adapt our Zalman ZM-F1-FDB fan on anti-vibration bands that we have to pull through the thin slits of the case.  Damn these consumer corps with their aisles and slots ... <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ebb/16f/7f6/ebb16f7f62cdf83adbe290e78310de5c.jpg"><br><br>  I remembered the old comedy. <br><blockquote>  The soldier is asked: "Why do you see so badly?"  He replies: "Well, there is one eye surgery, but they do it through the anus, and I will not let a single guy in there" ... </blockquote><br>  The eccentric-green plastic bottle from under the Karma House mineral water, protruding from the back of the case, already had an eye on the eyes.  Therefore, we analyze the cooler CNPS5700D-Cu, take the duct with us and go to the grocery store for shopping.  Trying out the different types of mineral water bottles in turn, we are convinced that the diameters of the two-liter Aqua Ping bottle with the round part of the CNPS5700D-Cu duct match perfectly (did they, at one plant, have it?). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/37b/e7c/dd9/37be7cdd9f5fdf282eef97919f841280.jpg"><br><br>  Thank the Stuck School company for such a successful coincidence, and, after spending a couple more hours with various sharp objects, we get a part of an air duct of complex shape made of transparent plastic. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ac/a13/ccc/6aca13ccc8e289fe444e4b748cdaff7f.jpg"><br><br>  We put a new ZM-F1-FDB 80mm fan in the cooler, its hydrodynamic bearings have a comparable resource, but quieter than ringing ball bearings.  At the last moment, of course, it turns out that the hole on the hull is half a centimeter higher than necessary, so we add a petal skirt made of adhesive tape, the idea of ‚Äã‚Äãwhich was suggested by the aircraft designers of fighters with a variable thrust vector. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/20a/1c3/827/20a1c3827999ece539c4d936574f909d.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a20/449/78e/a2044978ec560946ea392d4c7eaca549.jpg"><br><br>  Our product really looks like a deflecting nozzle, but it doesn't look so punk anymore. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b4b/627/267/b4b6272678982ff92789234d5b4d8e7b.jpg"><br><br>  Finally, the time has come to figure out the very place where I failed to unravel the Great Chinese Engineering Plan a decade ago.  Let me remind you that we are talking about the back panel of the ATX connectors, which comes bundled with the motherboard, more precisely, about the impossibility of installing it in this slot: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e6f/351/26e/e6f35126e6d7f29743ce8031beb1682c.jpg"><br><br>  It turns out that the rebus is completely solved by pliers, simply accelerate the profile around the perimeter, centimeter by centimeter.  The socket will perfectly keep its holes on the connectors, and the bumps will go inside the case and do not violate our engineering aesthetics: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/161/a7f/4b5/161a7f4b5b4f25969a8599aefcec73f6.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/757/30b/340/75730b340e2a4f98a21928de91a60116.jpg"><br><br>  In order to avoid the effect of spaghetti, SATA cords are tied to each other with ties, because there is no place for pasta in server housings.  We mark cables using twisted pair markers.  The rheostat of the fan is fixed to the case on an empty leg for the motherboard, which turned out to be very appropriate.  The old disks are still in the case for better airflow calibration, but we will get rid of them soon. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/868/376/0e2/8683760e2bb4fcdcca9a954bea25784a.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d78/3df/7a5/d783df7a53647e1c798a91cf1699e1f4.jpg"><br><br>  Guided again by considerations of thermal efficiency, mirrors-mirrors from disks will be collected through at least one compartment, i.e.  so that the <b>disks of one array are not neighbors in the compartments and do not heat each other</b> , especially on long reconstruction operations.  Disks are also labeled, at least the volume number.  <b>UPD:</b> it is better to place the serial number of the disc by printing it on a thermal thermal tape printer, and in the absence thereof, simply on a strip of paper under a transparent adhesive tape.  When there are more than two disks, it can be very useful during emergency and emergency work. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b51/606/0ed/b516060ed8e6f7f116ab9f8d8b7bd2a2.jpg"><br><br>  It remains only to turn on the power, measure the temperature and calibrate the rheostats of the fans under load. <br><br><h5>  Nutrition </h5><br>  The power unit of the FSP Group <a href="http://www.fsp-power.ru/product/atx_450pnr">ATX-450PNR responds</a> rather positively, but they consider the disadvantage ( <a href="http://www.wasp.kz/articles.php%3Farticle_id%3D465">reference1</a> , <a href="http://article.techlabs.by/print/36_29785.html">reference2</a> ) of the reboiler's efficiency and archaic minimalist design (no power corrector).  The advantage is <s>reliability</s> ( <b>UPD:</b> questions arose in six months to reliability) and a relatively quiet low-speed 120mm fan. <br>  The <a href="http://www.seagate.com/ru/ru/internal-hard-drives/desktop-hard-drives/barracuda/%3Fsku%3DST2000DM001">starting</a> power of four spindles <a href="http://www.seagate.com/ru/ru/internal-hard-drives/desktop-hard-drives/barracuda/%3Fsku%3DST2000DM001">ST2000DM001</a> is expected to be about 2.5A x 4 x 12V = 120W, which, in combination with the cold architecture of the Pentium 4 without graphics, should climb 250W with a margin. <br><br>  It is noteworthy that on the Taiwan website of the <a href="http://www.fsp-group.com.tw/">FSP Group</a> I did not manage to find this power supply unit among the products, but the stores in the Russian Federation clearly did not suffer from them.  There was a suspicion that this is a specially cheaper OEM version for the CIS market, in which everything that is possible due to low efficiency is torn off.  After all, we have long winters and an excess of electricity in the country, which we gladly turn by inefficient appliances into the cozy warmth of homes and offices. <br>  In short, despite the efficiency of the boiler, our unit still produces about 200W more than is required, which is good news.  But there is a nuance about which we will write in the following parts of our history ... <br><br><h4>  findings </h4><br><ol><li>  The disproportionate growth of storage capacities has practically buried the time-tested things like RAID5. </li><li>  In the struggle for the time of the array reconstruction, new, high-tech file systems are winning, but they are realizable only on expensive hardware (due to ECC memory). </li><li>  Building a server on the trash was and remains a risk;  in such a situation, rational simplicity wins, bordering on the primitive (like a collapsible array of mirrors). </li><li>  Archaic hardware - vintage technology, but in a new "industrial design" packaging. </li></ol><br><br><h4>  To be continued </h4><br>  Read in the following parts: about the experience of actual operation, failures, the next turn of the hull engineering and other system tuning. <br><br>  <b>UPD:</b> <br>  All parts of the story about <i>Another NAS do it yourself</i> : <br>  part 1: from what was <br>  <a href="http://habrahabr.ru/post/214803/">Part 2: Good memories (Flash memory for downloading FreeNAS and other embedded OS)</a> <br>  <a href="http://habrahabr.ru/post/218387/">part 3: adventures in the old tower</a> <br>  <a href="http://habrahabr.ru/post/217299/">part 4: the ghost of Chernobyl</a> <br><br><h4>  Links </h4><br>  <b>End-to-End Data Integrity for File Systems: A ZFS Case Study</b> by Yupu Zhang, <br>  Abhishek Rajimwale, Andrea C. Arpaci-Dusseau, Remzi H. Arpaci-Dusseau (Computer <br>  Sciences Department, University of Wisconsin-Madison) <br><br>  <a href="http://www.netapp.com/">www.netapp.com</a> <br>  <a href="http://www.qnap.com/">www.qnap.com</a> <br>  <a href="http://www.synology.com/">www.synology.com</a> <br>  <a href="http://www.openmediavault.org/">www.openmediavault.org</a> <br>  <a href="http://www.openfiler.com/">www.openfiler.com</a> <br>  <a href="http://aws.amazon.com/glacier/">aws.amazon.com/glacier</a> <br>  <a href="http://www.freebsd.org/">www.freebsd.org</a> <br>  <a href="http://www.linux.org/">www.linux.org</a> <br>  <a href="http://sqlite.org/">sqlite.org</a> <br>  <a href="http://www.freenas.org/">www.freenas.org</a> <br>  <a href="http://www.nas4free.org/">www.nas4free.org</a> <br>  <a href="http://forums.freenas.org/threads/what-number-of-drives-are-allowed-in-a-raidz-config.158/">forums.freenas.org/threads/what-number-of-drives-are-allowed-in-a-raidz-config.158/#post-38835</a> <br>  <a href="http://www.zdnet.com/blog/storage/why-raid-5-stops-working-in-2009/162">www.zdnet.com/blog/storage/why-raid-5-stops-working-in-2009/162</a> <br>  <a href="http://www.wikipedia.org/wiki/ZFS">www.wikipedia.org/wiki/ZFS</a> <br>  <a href="http://wiki.freebsd.org/ZFSTuningGuide">wiki.freebsd.org/ZFSTuningGuide</a> <br>  <a href="http://doc.freenas.org/index.php/Hardware_Recommendations">doc.freenas.org/index.php/Hardware_Recommendations</a> <br>  <a href="http://hardforum.com/showthread.php%3Ft%3D1689724">hardforum.com/showthread.php?t=1689724</a> <br>  <a href="http://www.wikipedia.org/wiki/GEOM">www.wikipedia.org/wiki/GEOM</a> <br>  <a href="http://www.freebsd.org/cgi/man.cgi%3Fquery%3Dgeom%26sektion%3D4">www.freebsd.org/cgi/man.cgi?query=geom&amp;sektion=4</a> <br>  <a href="http://www.wikipedia.org/wiki/Unix_File_System">www.wikipedia.org/wiki/Unix_File_System</a> <br>  <a href="http://www.asrock.com/mb/overview.asp%3FModel%3DP4i65G">www.asrock.com/mb/overview.asp?Model=P4i65G</a> <br>  <a href="http://www.lm-sensors.org/ticket/1865">www.lm-sensors.org/ticket/1865</a> <br>  <a href="http://www.fsp-power.ru/product/atx_450pnr">www.fsp-power.ru/product/atx_450pnr</a> <br>  <a href="http://www.fsp-group.com.tw/">www.fsp-group.com.tw</a> <br>  <a href="http://article.techlabs.by/print/36_29785.html">article.techlabs.by/print/36_29785.html</a> <br>  <a href="http://www.wasp.kz/articles.php%3Farticle_id%3D465">www.wasp.kz/articles.php?article_id=465</a> <br>  <a href="http://www.computerhope.com/beep.htm">www.computerhope.com/beep.htm</a> <br>  <a href="http://www.gigabyte.com/products/product-page.aspx%3Fpid%3D1648">www.gigabyte.com/products/product-page.aspx?pid=1648</a> <br>  <a href="http://www.zalman.com/eng/product/Product_Read.php%3FIdx%3D266">www.zalman.com/eng/product/Product_Read.php?Idx=266</a> <br>  <a href="http://www.zalman.com/eng/product/Product_Read.php%3FIdx%3D410">www.zalman.com/eng/product/Product_Read.php?Idx=410</a> <br>  <a href="http://www.dlink.com/us/en/home-solutions/connect/adapters/dge-530t-dge-530t-32-bit-10-100-1000-base-t-pci-adapter">www.dlink.com/us/en/home-solutions/connect/adapters/dge-530t-dge-530t-32-bit-10-100-1000-base-t-pci-adapter</a> </div><p>Source: <a href="https://habr.com/ru/post/214707/">https://habr.com/ru/post/214707/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../214693/index.html">How traffic optimization is done</a></li>
<li><a href="../214695/index.html">Counts - sigmajs</a></li>
<li><a href="../214697/index.html">Forget about storage. Nutanix - a revolution in virtualization</a></li>
<li><a href="../214703/index.html">New free courses of virtual academy Microsoft Virtual Academy, February 2014</a></li>
<li><a href="../214705/index.html">Intel 730 - SSD, overclocked to the limit</a></li>
<li><a href="../214709/index.html">Monitoring system via jabber</a></li>
<li><a href="../214711/index.html">Now in WebStorm there is a multi-persistence, it‚Äôs a multiple selection</a></li>
<li><a href="../214713/index.html">ZoG on steroids</a></li>
<li><a href="../214719/index.html">Evernote Windows Update: Accelerated Sync and Image Editing</a></li>
<li><a href="../214725/index.html">Scala Moscow User Group, meeting on March 14, 2014</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>