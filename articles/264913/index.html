<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Where in the ZX Spectrum System Monitor? Mystery PC Duet</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PC Duet is a Russian clone ZX Spectrum 48k, produced by Lianozovo Electromechanical Plant (LEMZ). This is my very first computer and it is with me so ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Where in the ZX Spectrum System Monitor? Mystery PC Duet</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/8c6/977/2e3/8c69772e368a4c189fde702469dc3b47.jpg" width="200" align="left">  <a href="http://speccy.info/%25D0%2594%25D1%2583%25D1%258D%25D1%2582">PC Duet</a> is a Russian clone ZX Spectrum 48k, produced by Lianozovo Electromechanical Plant (LEMZ).  This is my very first computer and it is with me so far.  From a young age I began to comprehend the basics of programming, microprocessor architectures and the design of digital circuits.  But since then the question has not given me rest: where is the system monitor?  After all, it is mentioned in the documentation.  In the standard ZX Spectrum, I do not recall the presence of any system monitor.  And in the documentation about the system monitor no more words.  There is a Monitor for 48k <a href="">in the ROM version from 1990</a> .  However, after switching on, the PC Duet displays on the screen instead of the standard greeting - <i>"() 1982 sinclair research ltd"</i> another greeting: <i>"() DUET"</i> .  And this means that the ROM is still changed there.  Or maybe there is a hardware monitoring capability?  For example, the <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D1%2580%25D0%25B5%25D0%25BB%25D1%258C_%25D0%2591%25D0%259A-08">Orel</a> clone <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D1%2580%25D0%25B5%25D0%25BB%25D1%258C_%25D0%2591%25D0%259A-08">BK-08</a> has a number of improvements: shadow RAM, NMI button and monitor MZ80.  It would be very interesting, after so many years, to find some hidden possibilities of your piece of iron. <br><br>  Finally, I found the answer to a question that periodically worried me all these years. <br><br><img src="https://habrastorage.org/web/94e/259/0a8/94e2590a8eac42f9bff906fd123b83f0.jpg" alt="image"><br><a name="habracut"></a><br><h1>  Why now? </h1><br>  As you know, Spectrum - almost incurable.  And long periods of remission can be replaced by exacerbations under the influence of external factors: an article, a <a href="https://geektimes.ru/post/288376/">Spectrum jubilee</a> , and here you are again <a href="http://zx-pk.ru/">on the forums</a> , again there are <a href="">Spectra</a> from the shelf on the table (of which <a href="">not one</a> and <a href="">not</a> even <a href="">two</a> ) <a href="">turn on</a> and <a href="">work</a> (or not ).  And then, gradually lets go.  But some questions remain unresolved and they hang somewhere deep in the subconscious and each time they strive to get back.  They are not solved, as a rule, due to the hardware irrelevance of the platform (which is actually debatable).  And what if the resolution of long-standing questions, problems or desires, even if they are no longer relevant now, can please the present?  After all, now it is easier to do.  I think it's worth a try! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Another coming issue of the monitor </h1><br>  For the first time I asked myself a question about the monitor almost immediately after purchase, but I never found the answer.  Already in our time, at the beginning of 2016, I tried to <a href="http://zx-pk.ru/threads/26296-pevm-duet.html">find out on the forum</a> , but the answer was again not found.  The question would have been forgotten, but by chance I came across an advertisement for the sale of a clone of the Spectrum - <a href="http://speccy.info/%25D0%259D%25D0%25B0%25D1%2584%25D0%25B0%25D0%25BD%25D1%258F">‚ÄúNafanya‚Äù</a> , and there was a photo of a documentation page in which it was written: <a href="">‚ÄúThe ROM contains the BASIC interpreter and the system monitor‚Äù</a> .  Well, we decided to still understand and put an end to this issue <br><br><img src="https://habrastorage.org/web/685/e95/185/685e95185c034310be6385e744519ffd.jpg" alt="image"><br><br>  Comrades in the forum gave advice: <br><blockquote>  <i>Most likely, a system monitor is a set of standard ROM routines.</i>  <i>Try:</i> <i><br></i>  <i>1. look at the installed ROMs on the board, it seems that you have 2 pcs of 8K, this is 16K, if there are no additional ROMs, then you need to search among the available 16K.</i> <i><br></i>  <i>2. merge the dump of the ROM and compare with the standard Sinkler, usually only the inscription in the clones changed.</i>  <i>According to the differences, you can estimate whether there is something interesting.</i> </blockquote>  Well, it can not be that everything is so simple!  The study of the <a href="http://sblive.narod.ru/ZX-Spectrum/DUET/DUET.htm">scheme</a> showed that there are no additional ROMs there: two 8KB ROMs (making up the standard 16kB ROM with a basic).  Judging by the <a href="">photograph of the viscera of</a> my specimen, my version is no different from the scheme on the site (in fact, there are minor improvements / changes, about which, perhaps, another time).  Thus, the hardware capabilities for the existence of the monitor is not detected. <br><br><h1>  We verify ROM dumps </h1><br>  In order to merge the dump and verify it with the original, you need to do the following steps: <br><br>  1) Get the data from the ROM on the PC Duet.  Removing the ROM from the board and use the programmer for this is not required.  For the simple reason that the ROM in the 48k version is entirely mapped into the <a href="">address space at 0..16383</a> .  This is the lowest address space.  It can either be read programmatically or saved via the tape output by the <code>SAVE "ROM" CODE 0, 16384</code> BASIC team. <br><br>  2) Convert data from a sound file to a TAP file using a PC utility <br>  3) Extract data from TAP format to binary format <br>  4) Write or find a utility to compare byte-by-byte two binary files - from the Duet and from the original Spectrum. <br><br>  Already at the first stage, I rejected this idea, because the laptop does not have a line input, and the adapter is soldered only in the direction of sound playback on a PC or smartphone via a line output for connecting the PC Duo input.  Because 99% of the time now is downloading data to the Duet, and not vice versa. <br><br>  Therefore, I decided to do exactly the opposite.  Get the original ROM and load it into the Duet's RAM via a tape-in.  Then write a program to verify data in memory cells with the output of information of different cells.  Binary data of the original ROM is in almost every ZX Spectrum emulator.  But to translate them into sound, for later downloading via a tape-in ‚Äã‚Äãinput, I had to tinker a little.  I went through 3-4 programs before I could make a TAP file from a binary file.  Then it's easier - with the help of the utility Tape2WAV received sound files. <br><br>  To load data from a tape recorder in BASIC ZX Spectrum, the LOAD command is used, with parameters that indicate that the code is loaded, and what memory address to load it, respectively, the <code>LOAD "" CODE 40000</code> loaded the data of the original ROM into memory, starting at address 40000 . <br><br><h1>  Writing a program to verify the memory </h1><br>  I happily rub my hands, because I have to remember my school experience and program under the ZX Spectrum, and on it myself!  And, by the way, what is there to remember?  BASIC is impossible to forget, the more so simple.  It is difficult to make a mistake in a set of commands, because each keystroke immediately enters a whole command.  Quick and convenient as T9, only for BASIC!  I also want to say that it is not convenient to use 48k BASIC on the emulator, due to the fact that BASIC commands are not signed on modern computers.  One more plus even of such a small car as 48k: we are immediately ready to work after switching on.  No development environment, no compiler required.  All that is needed for work is in the ROM. <br><br>  BASIC inside the ZX Spectrum is interpreted.  This reduces the speed of the programs.  But to write such a simple and speed-critical program in assembler - I think this is already overkill.  The program is written in 5 minutes.  And even if it works the same, it will suit me.  But it turned out that it took even less than five minutes: <br><br><img src="https://habrastorage.org/web/ff9/c26/ec2/ff9c26ec230b43eab85f09b24704c6e5.jpg" alt="image"><br><br>  In the screenshot, the program I typed in the emulator (just to take a screenshot of the source code).  The same program I typed on the Duet.  On top of the screenshot, I signed data on the differences found in memory cells.  Well, there are not so many changes.  Now you need to understand what touched these changes.  To do this, you need to know what is in the ROM at the addresses found.  Fortunately, all the information is in the book <a href="http://zx-pk.ru/threads/14994-kniga-quot-polnyj-dizassembler-pzu-zx-spectrum-quot-na-russkom.html%3Fp%3D422404%26viewfull%3D1">"Full disassembler ROM ZX-Spectrum" in Russian</a> . <br><br>  Cell 109 - in the original ROM 40d in Duo 32d <br>  006d 32 instead of 40. So 20h (JR nz, *) instead of 28h (JR z, *), and in the book jr nz. <br><br><img src="https://habrastorage.org/web/471/c89/332/471c89332acf476d957dcb140c0567f0.jpg" alt="image"><br><br>  As it turned out, in the original version of the ROM from 82 years old, an error was made in this place.  This is a nonmaskable interrupt handling code.  Without this error, you can set the address of the transition to the processor in the <a href="http://zxpress.ru/book_articles.php%3Fid%3D136">NMIADD</a> variable, for example, the same monitor.  And by the NMI signal (using the NMI button, like on <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D1%2580%25D0%25B5%25D0%25BB%25D1%258C_%25D0%2591%25D0%259A-08">Orel BK-08</a> ), the computer would switch to this handler.  Corrections at this address indicate that in the Duet this error has been corrected and the NMI signal can be fully used.  Well, it's not bad anymore, but judging by the number of remaining changes in the ROM, the monitor code is not sewn into it all the time :( <br><br>  Expected, 4 bytes is ‚ÄúDUET‚Äù instead of (C) 1982 Sinclair Research Ltd <br> <code>1539 (C) <br> 153A  " " <br> 153B 68 "D" <br> 153C 85 "U" <br> 153D 69 "E" <br> 153E 212  . . 212d + 80h = 54h - "T"</code> <br> <br>  (MESSAGES - Each message is issued with an inverted last character (+80, hexadecimal). <br><br><h1>  Monitor not disagree? </h1><br>  Unfortunately, I did not find any system monitor debugger, although I tried very hard.  But I am very glad that I could find out on my own ... But.  But what is a "system monitor"?  Why is it written in the documentation for the Duet and Nathan?  As it was written above, <i>‚ÄúMost likely, a system monitor is a set of standard ROM subroutines‚Äù</i> .  Also, in the book with the complete disassembler of the ZX Spectrum ROM, we can read the following: <br><br> <code>... <br>     ZX SPECTRUM <br> ... <br>  <br>  Spectrum,  16K,        <br> Z80.       : <br> .  /. <br> .  BASIC. <br> .  . <br> ,       ,    <br>    10 .       .</code> <br> <br>  In recent years, when someone writes about the ZX Spectrum, then the contents of the ROM, he will most likely name the OS ZX Spectrum - this is the built-in BASIC.  But in those days, apparently, this concept has not yet been formed.  There were small programs - monitors for viewing and changing the contents of memory cells in HEX form.  Used to debug programs in machine codes.  Compared with them, the Spectrum "monitor" was very cool.  And what we now call the "monitor", then more often called the "display". <br><br>  Thus, there was some change in the meanings of the concepts.  The monitor then and the monitor now are different concepts.  So, we can assume that the monitor is still found :) Or maybe someone has additional information? <br><br>  <b>Links</b> <br>  <a href="http://zxpress.ru/book_articles.php%3Fid%3D1394">ZX Spectrum for users and programmers - system variables</a> - NMIADD <br>  <a href="http://zxpress.ru/book_articles.php%3Fid%3D136">ZX-Review 1991 ‚Ññ1 - Secrets rom</a> - NMIADD and an error in the ROM <br>  <a href="http://zxpress.ru/book_articles.php%3Fid%3D1453">Microprocessor kit Z80.</a>  <a href="http://zxpress.ru/book_articles.php%3Fid%3D1453">Book 1. 6. System interruption.</a>  - about NMI <br>  <a href="http://zx-pk.ru/threads/14994-kniga-quot-polnyj-dizassembler-pzu-zx-spectrum-quot-na-russkom.html%3Fp%3D422404%26viewfull%3D1">"Complete disassembler ROM ZX-Spectrum" in Russian</a> <br>  <a href="http://clrhome.org/table/">Z80 Instruction table</a> </div><p>Source: <a href="https://habr.com/ru/post/264913/">https://habr.com/ru/post/264913/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264901/index.html">Vscale: cloud servers</a></li>
<li><a href="../264905/index.html">Top Story is authorized to state: do not be afraid of mobile development</a></li>
<li><a href="../264907/index.html">Lessons in FluentNHibernate c ASP.NET MVC and SQL Server. Part 1</a></li>
<li><a href="../264909/index.html">Facebook's Fresco Library</a></li>
<li><a href="../264911/index.html">Office as Platform issue 4: Uber, PayPal, Boomerang and Evernote as examples of new type applications</a></li>
<li><a href="../264915/index.html">Feature selection methods</a></li>
<li><a href="../264919/index.html">Java bytecode "Hello world"</a></li>
<li><a href="../264921/index.html">What problems do we face when introducing and operating Microsoft Exchange and how to solve them effectively?</a></li>
<li><a href="../264923/index.html">Joint editing. Part 1</a></li>
<li><a href="../264927/index.html">Automate MS SQL backup configuration using .NET application</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>