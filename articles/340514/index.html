<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Testing React-Redux Applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Reading time: 13 minutes 
 Have you seen a lot of react developers who cover their code with tests? Do you test yours? Indeed, why, if we can predict ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Testing React-Redux Applications</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/187/c34/ad8/187c34ad8da5ff9bd58e5dda182cd76c.jpg" alt="image"><br><br><h4>  Reading time: 13 minutes </h4><br>  Have you seen a lot of react developers who cover their code with tests?  Do you test yours?  Indeed, why, if we can predict the state of the component and the storage?  The answer is quite simple: to avoid errors with changes in the project. <br><br>  All who are interested, I invite under the cat. <br><a name="habracut"></a><br>  Clone the <a href="https://github.com/MerrickGit/reactreduxtest">repository</a> project in which tests will be written or try to write tests for your project. <br><blockquote>  It will be a very simple project. </blockquote>  The application looks like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/xs/_l/5g/xs_l5g2gppayslsxngvj5yqg5f4.png" alt="image"><br><br>  And it can only add and subtract numbers, but with the help of react-redux bundles. <br><br><h3>  Why I and not only choose jest </h3><br>  And who are these not only?  That's what jest blogs write. <br><blockquote>  We feel incredibly humbled that 100+ companies <a href="https://twitter.com/cpojer/status/803965499407290369">have adopted</a> the last six months.  Companies like Twitter, Pinterest, Paypal, nytimes, IBM (Watson), Spotify, eBay, SoundCloud, Intuit, Formidable Labs, Automattic, Javascript. </blockquote><br>  Big companies like the simplicity of jest.  That is why they love him: <br><br><ul><li>  You will need a minimum time to install and configure Jest </li><li>  Ability to run tests in parallel.  (In this example, this is not so important, but in large applications the speed of tests plays a big role) </li><li>  Snapshot testing is a really great feature, thanks to which you can shorten the writing of some tests, as a snapshot is created, and if something changes in the component, an error will be displayed when the snapshot is generated next time. </li><li>  Jest uses jasmine for assertion (mappings) </li><li>  The ability to see the test coverage out of the box </li></ul><br>  When Jest first appeared, it didn‚Äôt work very quickly and was not designed very well, but in 2016 Facebook did a great job at improving Jest and I think it will become quite popular in the near future. <br><br><h3>  Project Setup </h3><br>  Let's see what we need dependencies to run tests. <br><br><ul><li>  jest - I think it is clear why </li><li>  babel-jest - for modern JS transpilation to an older one. </li><li>  enzyme - for more convenient management and rendering of our components.  (library developed by airbnb) </li><li>  react-addons-test-utils - as a dependency for the enzyme </li><li>  react-test-renderer - allows you to render a component in the markup for snapshot </li><li>  redux-mock-store - to create a mock for the store </li></ul><br>  And that's all you need. <br><br><h3>  Running tests </h3><br>  Add to package.json in scripts ‚Äùtest‚Äù: ‚Äújest‚Äù.  And now we can run tests using the yarn test command or npm test. <br><br>  Jest will analyze the __test__ folder and execute all the files in the name of which are .test.js or .spec.js <br><br>  After we write everything, that's what happens. <br><br><img src="https://habrastorage.org/webt/ms/yv/rx/msyvrxucelftgxojaqzd8csoh9w.png" alt="image"><br><br><ul><li>  Home.spec.js - This component has child components and is connected to redux. </li><li>  calculatorActions.spec.js - This is a unit test for action. </li><li>  calculatorReducers.spec.js - This is the unit test for the reducer. </li></ul><br>  Now let's write a couple of tests. <br><br><h3>  Understanding our tests and creating them </h3><br>  There are many unwanted test cases that simply check for the presence of a DOM element.  It is not really necessary, and I just left them to let you know how to do it, if there is such a task for you to cope with this test.  But I would not advise writing such tests. <br><br>  I will focus only on the important tests for each section that you need to know.  You can simply read the rest in the documentation. <br><br><h4>  1. Component / Connected Component (Home.spec.js) </h4><br>  What does the connected component mean?  This is the component that connect is used to communicate with redux.  If you look at the code for the Home component, you will see there are two exports. <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { connect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { addInputs, subtractInputs, async_addInputs } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/calculatorActions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mapStateToProps = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ output }</span></span></span><span class="hljs-function">) =&gt;</span></span> ({ output }); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Home</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span></span>{ render(){ ... } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> connect(mapStateToProps, { addInputs, subtractInputs, async_addInputs })(Home);</code> </pre> <br>  The first export is needed for the so-called 'stupid components' and the export default is needed for the connected / smart component.  And we will test both options to start a component that does not receive values ‚Äã‚Äãfrom the outside. <br><br>  And with the connect component, we will test the react-redux part. <br><blockquote>  Do not use decorators for the code you are going to test. </blockquote><br><pre> <code class="javascript hljs">@connect(mapStateToProps) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Home</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span></span>{ ...</code> </pre><br><h4>  1.1 Stupid component </h4><br>  We import a stupid component (a component without connect). <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Home } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../src/js/components/Home'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { shallow } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'enzyme'</span></span> <span class="hljs-comment"><span class="hljs-comment">//       ********************************* describe('&gt;&gt;&gt;HOME --- Shallow Render REACT COMPONENTS',()=&gt;{ let wrapper const output = 10 beforeEach(()=&gt;{ wrapper = shallow(&lt;Home output={output}/&gt;) }) it('+++ render the DUMB component', () =&gt; { expect(wrapper.length).toEqual(1) }); it('+++ contains output', () =&gt; { expect(wrapper.find('input[placeholder="Output"]').prop('value')).toEqual(output) }); });</span></span></code> </pre><br>  We use a shallow render from the enzyme because we only need to get the react object of the component. <br><br>  We will analyze the following fragment in detail. <br><br><pre> <code class="javascript hljs">beforeEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">=&gt;</span></span>{ wrapper = shallow(<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Home</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">output</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{output}/</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">) })</span></span></code> </pre><br>  It means that before each execution of the it () function we will execute the function that is passed to beforeEach (), thereby receiving an updated component each time, as if it were being rendered for the first time. <br><br>  Notice that in Home.js our output field expects this.props.output, so we need to pass prop during testing. <br><br><pre> <code class="javascript hljs">&lt;div&gt;  : <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"output"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{this.props.output}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/div&gt;</span></span></code> </pre><br><h4>  1.2 Smart components </h4><br>  Now something more interesting, import our smart component to the test.  Now the import looks like this. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ConnectedHome, { Home } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../src/js/components/Home'</span></span></code> </pre><br>  And we will also use redux-mock-store. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> configureStore <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-mock-store'</span></span></code> </pre><br>  Now consider two options for testing smart components.  You will need to choose which one you like best. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  store    //***************************************************************************** describe('&gt;&gt;&gt;HOME --- REACT-REDUX (Shallow + passing the {store} directly)',()=&gt;{ const initialState = { output:100 }; const mockStore = configureStore(); let store,container; beforeEach(()=&gt;{ store = mockStore(initialState); container = shallow(&lt;ConnectedHome store={store} /&gt; ); }) it('+++ render the connected(SMART) component', () =&gt; { expect(container.length).toEqual(1); }); it('+++ check Prop matches with initialState', () =&gt; { expect(container.prop('output')).toEqual(initialState.output); });</span></span></code> </pre><br>  In this test, we check whether the initialState, which is obtained by the component via mapStateToProps, matches. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     Provider     . //***************************************************************************** describe('&gt;&gt;&gt;HOME --- REACT-REDUX (Mount + wrapping in &lt;Provider&gt;)',()=&gt;{ const initialState = { output:10 }; const mockStore = configureStore(); let store,wrapper; beforeEach(()=&gt;{ store = mockStore(initialState); wrapper = mount( &lt;Provider store={store}&gt;&lt;ConnectedHome /&gt;&lt;/Provider&gt; ); }) it('+++ render the connected(SMART) component', () =&gt; { expect(wrapper.find(ConnectedHome).length).toEqual(1); }); it('+++ check Prop matches with initialState', () =&gt; { expect(wrapper.find(Home).prop('output')).toEqual(initialState.output); }); it('+++ check action on dispatching ', () =&gt; { let action; store.dispatch(addInputs(500)); store.dispatch(subtractInputs(100)); action = store.getActions(); expect(action[0].type).toBe("ADD_INPUTS"); expect(action[1].type).toBe("SUBTRACT_INPUTS"); }); });</span></span></code> </pre><br>  If you look at the code, we do the same thing as in the first test, plus I also added a couple of other comparisons, but they can be implemented in the first test. <br>  In the first and second versions, we use the mock store and therefore we cannot commit changes, but we can use the real store, without additional libraries. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//******************************************************************************************************* describe('&gt;&gt;&gt;HOME --- REACT-REDUX (actual Store + reducers) more of Integration Testing',()=&gt;{ const initialState = { output:10 }; let store,wrapper; beforeEach(()=&gt;{ store = createStore(calculatorReducers); wrapper = mount( &lt;Provider store={store}&gt;&lt;ConnectedHome /&gt;&lt;/Provider&gt; ); }) it('+++ check Prop matches with initialState', () =&gt; { store.dispatch(addInputs(500)); expect(wrapper.find(Home).prop('output')).toBe(500); }); });</span></span></code> </pre><br>  But this is not recommended, because it is not part of unit testing. <br><br><h3>  1.3 Snapshots </h3><br>  Another thing I love about Jest is snapshot testing. <br>  When jest compares snapshot for the first time, when there are none, it puts them in the __snapshots__ folder next to your test file.  In order to make a snapshot, we need to first render the component, for this we import the react-test-renderer library. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> renderer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-test-renderer'</span></span> <span class="hljs-comment"><span class="hljs-comment">//    snapshot describe('&gt;&gt;&gt;HOME --- Snapshot',()=&gt;{ it('+++capturing Snapshot of Home', () =&gt; { const renderedValue = renderer.create(&lt;Home output={10}/&gt;).toJSON() expect(renderedValue).toMatchSnapshot(); }); });</span></span></code> </pre><br>  Here's what the snapshot looks like for our Home.js component <br><br><pre> <code class="javascript hljs">exports[<span class="hljs-string"><span class="hljs-string">`&gt;&gt;&gt;HOME --- Snapshot +++capturing Snapshot of Home 1`</span></span>] = <span class="hljs-string"><span class="hljs-string">` &lt;div className="container"&gt; &lt;h2&gt; using React and Redux &lt;/h2&gt; &lt;div&gt; Input 1: &lt;input placeholder="Input 1" type="text" /&gt; &lt;/div&gt; &lt;div&gt; Input 2 : &lt;input placeholder="Input 2" type="text" /&gt; &lt;/div&gt; &lt;div&gt; Output : &lt;input placeholder="Output" readOnly={true} type="text" value={10} /&gt; &lt;/div&gt; &lt;div&gt; &lt;button id="add" onClick={[Function]}&gt; Add &lt;/button&gt; &lt;button id="subtract" onClick={[Function]}&gt; Subtract &lt;/button&gt; &lt;/div&gt; &lt;hr /&gt; &lt;/div&gt; `</span></span>;</code> </pre><br>  And if we change something in the Home.js file and try to run the test, we get an error. <br><br><img src="https://habrastorage.org/webt/n3/a5/lm/n3a5lmuwrd4ej-1gsb1yvsvdzmk.png" alt="image"><br><br>  To update snapshots, you need to run tests with the -u flag <br><br><pre> <code class="javascript hljs">jest test -u || yarn test -u</code> </pre><br>  Because of this, we do not need to spend a lot of time on testing, because if the snapshot does not match, then this means that we will get an error when comparing snapshots.  Snapshot does not contain the props and state of your component, if you need to test them in a component, you will have to create two instances. <br><br>  You can create a snapshot not only for the component, but also for the reducer, which is very convenient. <br>  For example, we write such a test. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> reducer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./recipe'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'With snapshots '</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'+++ reducer with shapshot'</span></span>, () =&gt; { expect(calculatorReducers(<span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'default'</span></span> })).toMatchSnapshot(); }); it(<span class="hljs-string"><span class="hljs-string">'+++ reducer with shapshot'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> action = { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'ADD_INPUTS'</span></span>, <span class="hljs-attr"><span class="hljs-attr">output</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>, }; expect(calculatorReducers(<span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, action)).toMatchSnapshot(); }); });</code> </pre><br>  We get the following: <br><br><img src="https://habrastorage.org/webt/st/7s/xd/st7sxddu4caqipgcmtojp05h36o.png" alt="image"><br><br>  Now you understand why I mentioned this at the beginning. <br><br><h3>  2. ActionCreators (calculatorActions.spec.js) </h3><br>  We simply compare what ActionCreators returns to what should be. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { addInputs,subtractInputs } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../src/js/actions/calculatorActions'</span></span> describe(<span class="hljs-string"><span class="hljs-string">'&gt;&gt;&gt;ACTION --- Test calculatorActions'</span></span>, ()=&gt;{ it(<span class="hljs-string"><span class="hljs-string">'+++ actionCreator addInputs'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> add = addInputs(<span class="hljs-number"><span class="hljs-number">50</span></span>) expect(add).toEqual({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>:<span class="hljs-string"><span class="hljs-string">"ADD_INPUTS"</span></span>, <span class="hljs-attr"><span class="hljs-attr">output</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span> }) }); it(<span class="hljs-string"><span class="hljs-string">'+++ actionCreator subtractInputs'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> subtract = subtractInputs(<span class="hljs-number"><span class="hljs-number">-50</span></span>) expect(subtract).toEqual({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>:<span class="hljs-string"><span class="hljs-string">"SUBTRACT_INPUTS"</span></span>, <span class="hljs-attr"><span class="hljs-attr">output</span></span>:<span class="hljs-number"><span class="hljs-number">-50</span></span> }) }); });</code> </pre><br><h3>  3. Reducers (calculatorReducers.spec.js) </h3><br>  As easy as actionCreators, we test reducers. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> calculatorReducers <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../src/js/reducers/calculatorReducers'</span></span> describe(<span class="hljs-string"><span class="hljs-string">'&gt;&gt;&gt;REDUCER --- Test calculatorReducers'</span></span>,()=&gt;{ it(<span class="hljs-string"><span class="hljs-string">'+++ reducer for ADD_INPUT'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> state = {<span class="hljs-attr"><span class="hljs-attr">output</span></span>:<span class="hljs-number"><span class="hljs-number">100</span></span>} state = calculatorReducers(state,{<span class="hljs-attr"><span class="hljs-attr">type</span></span>:<span class="hljs-string"><span class="hljs-string">"ADD_INPUTS"</span></span>,<span class="hljs-attr"><span class="hljs-attr">output</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>}) expect(state).toEqual({<span class="hljs-attr"><span class="hljs-attr">output</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>}) }); it(<span class="hljs-string"><span class="hljs-string">'+++ reducer for SUBTRACT_INPUT'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> state = {<span class="hljs-attr"><span class="hljs-attr">output</span></span>:<span class="hljs-number"><span class="hljs-number">100</span></span>} state = calculatorReducers(state,{<span class="hljs-attr"><span class="hljs-attr">type</span></span>:<span class="hljs-string"><span class="hljs-string">"SUBTRACT_INPUTS"</span></span>,<span class="hljs-attr"><span class="hljs-attr">output</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>}) expect(state).toEqual({<span class="hljs-attr"><span class="hljs-attr">output</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>}) }); });</code> </pre><br><h3>  Async action </h3><br>  One of the most important is testing asynchronous actions or actions with side effects. <br>  For asynchronous actions, we will use redux-thunk.  Let's see what our asynchronous action looks like. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> async_addInputs = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">output</span></span></span><span class="hljs-function"> =&gt;</span></span> dispatch =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res, rej</span></span></span><span class="hljs-function">) =&gt;</span></span> { setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> res(output), <span class="hljs-number"><span class="hljs-number">3000</span></span>); }).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function"> =&gt;</span></span> dispatch(addInputs(res)));</code> </pre><br>  Now is the time to write a jest test for this.  You need to import everything you need. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { addInputs, subtractInputs, async_addInputs } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../src/js/actions/calculatorActions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> configureMockStore <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-mock-store'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> thunk <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-thunk'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mockStore = configureMockStore([ thunk ]);</code> </pre><br>  Now we write our test. <br><br><pre> <code class="javascript hljs">describe(<span class="hljs-string"><span class="hljs-string">'&gt;&gt;&gt;Async action --- Test calculatorActions'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'+++ thunk async_addInputs'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = mockStore({ <span class="hljs-attr"><span class="hljs-attr">output</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> store.dispatch(async_addInputs(<span class="hljs-number"><span class="hljs-number">50</span></span>)); expect(store.getActions()[<span class="hljs-number"><span class="hljs-number">0</span></span>]).toEqual({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'ADD_INPUTS'</span></span>, <span class="hljs-attr"><span class="hljs-attr">output</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span> }); }); });</code> </pre><br>  Look at the async_addInputs function, we wait for the action to finish and return the answer that we need to test (in this case, successful).  Thus, we can say that only one and only one action was called, and that is: ADD_INPUTS. <br><br>  Go ahead and test the primitive caching system. <br>  (just an example not from the project) <br><br><pre> <code class="javascript hljs">it(<span class="hljs-string"><span class="hljs-string">'does check if we already fetched that id and only calls fetch if necessary'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = mockStore({<span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">1234</span></span>, <span class="hljs-attr"><span class="hljs-attr">isFetching</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }}); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.fetch = jest.fn().mockImplementation(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.resolve()); store.dispatch(fetchData(<span class="hljs-number"><span class="hljs-number">1234</span></span>)); <span class="hljs-comment"><span class="hljs-comment">// Same id expect(window.fetch).not.toBeCalled(); store.dispatch(fetchData(1234 + 1)); // Different id expect(window.fetch).toBeCalled(); });</span></span></code> </pre><br>  As can be seen above, id 1234 is already in the store and we no longer need to receive data with a request for this id. <br><br>  Here we looked at the most basic tests for asynchronous actions.  Also in your application can be with other side effects.  For example, working with the database directly, like firebase or working with other api directly. <br><br><h3>  Code coverage </h3><br>  A test coverage report is maintained out of the box.  In order to see the statistics you need to run tests with the --coverage flag <br><br><pre> <code class="javascript hljs">yarn test -- --coverage || npm test -- --coverage</code> </pre><br>  It will look like this: <br><br><img src="https://habrastorage.org/webt/xz/i1/if/xzi1ifbxkceyjfcxmyscx9o2mr4.png" alt="image"><br><br>  If you check the folder with the project, you will find the folder coverage, where the index.html file is in which the report is to be displayed in the browser. <br><br><img src="https://habrastorage.org/webt/lr/rz/kk/lrrzkkq-mmsonkkojys548qr7g4.png" alt="image"><br><br>  Click on the file and see detailed test coverage statistics. <br><br>  That's all the main points in testing on jest.  After you master this, you can look at everything else in the documentation in order to broaden your horizons in testing. </div><p>Source: <a href="https://habr.com/ru/post/340514/">https://habr.com/ru/post/340514/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../340500/index.html">Interview with Mikhail Trutnev (Ultimate Guitar) about business, team and strategy</a></li>
<li><a href="../340502/index.html">Creating a platformer for a virtual console TIC-80</a></li>
<li><a href="../340504/index.html">Issue price - 10 million. Softline Venture Partners accepts applications in the IT business accelerator</a></li>
<li><a href="../340508/index.html">How JS works: event loop, asynchrony, and five ways to improve code with async / await</a></li>
<li><a href="../340510/index.html">How we created Raiffeisen Online ...</a></li>
<li><a href="../340516/index.html">Search memory leaks in applications on .NET Core under Linux</a></li>
<li><a href="../340518/index.html">Search for documents in network balloons and file dumps</a></li>
<li><a href="../340520/index.html">Five planning observations</a></li>
<li><a href="../340522/index.html">BEM + React: flexible design system architecture</a></li>
<li><a href="../340524/index.html">How to make a Public API to be used</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>