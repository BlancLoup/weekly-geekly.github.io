<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Smart home - cheap and cheerful</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Throughout his adult life, he dreamed of making, if not the whole world, then at least his own dwelling similar to houses from science fiction films. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Smart home - cheap and cheerful</h1><div class="post__text post__text-html js-mediator-article">  Throughout his adult life, he dreamed of making, if not the whole world, then at least his own dwelling similar to houses from science fiction films.  So that, after going home after a hard day's work, I was carefully turned on the light, greeted me politely, reported incidents, and at the exit warned me about the weather overboard and closed the door behind me.  So that I do not have to go, stammering in the dark to the bed, but I could lie down and only then turn off the light from my gadget, which is always at hand. <br><br>  On Habr√© is already full of articles about the implementation of this, what will be different from mine?  I was strangled by a toad.  I did not want to buy the finished device, it is expensive and not interesting, it was decided to do everything myself. <br><br>  At the moment, my smart home is completely finished: the server part, the web interface, the application with Android widgets, controllers, sensors and actuators, algorithms, even my own scripting programming language for them. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But for starters, I would like to tell you about the hardware of the "workhorse" at home - the RC-2 (room controller).  I have been writing firmware for AVR MK for a long time, so the Atmega 8-16PU, which is in all stores of radio components, will be the brain of our controller.  Yes, her older brother is used in the already annoying Arduino Uno, but we will stay away from her. <br><a name="habracut"></a><br><h5>  What do we want? </h5><br>  And now we define the requirements for our horse: the controllers should be in each room and have a connection to the server, work from the supply voltage of 7-40 volts, have the ability to connect temperature and humidity sensors, various sensors and dry contact buttons (reed switches, buttons , motion sensors), the ability to control external devices, the ability to do simple actions without the server (to turn on the light on the button, motion sensor, reed switch). <br><br>  <b>Now let's go through the requirements and choose the means that can meet these requirements:</b> <br><ul><li>  Contact with the server.  Ethernet is difficult and a lot of wires (from the switch to each of the controllers), Bluetooth, WiFi and other wireless ones are difficult and expensive.  Recall the good old RS-485 bus and we will use it. </li><li>  The logic is 5 volts, we need a converter.  We will use a simple and very efficient power supply on the LM2576 switching regulator (the scheme is in the datasheet on the first page) </li><li>  All sorts of sensors?  Atmega8 has everything on board: ADC, discrete inputs, there is even a built-in pull-up resistors.  We implement 1-Wire bus support on one of the legs to communicate with the sensors (the same DHT11). </li><li>  Controlling external devices?  Again, we have discrete outputs and PWMs on the MK. </li></ul><br><h5>  Shut up - for clever you will fall </h5><br>  There should be one master on the RS-485 bus that will interrogate our smart controllers connected to the bus in turn.  At one point in time, one says, the rest are listening.  The controllers respond strictly only to the request of the master, by itself no one says anything, otherwise there will be collisions, and no one will understand anything.  All strictly. <br><br>  The data exchange on the bus is half duplex, that is, at one point in time the device can either transmit or receive data. <br><br>  To work with the bus, we will use the MAX485 chip, plus the Atmega8 UART itself. <br><img src="https://habrastorage.org/getpro/habr/post_images/ca7/6a7/2be/ca76a72bea8b5015c0ecba3ff9a2ea9c.png" alt="image"><br>  Everything is simple with it: on the 2nd and 3rd leg the logical unit is passed, zero is listened.  After switching these modes, it is important to wait until the transients are completed, somewhere in half a millisecond, before transmitting / receiving. <br><br><h5>  What is the result? </h5><br>  The divorced scheme looks like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/021/b3b/f91/021b3bf918e05420ab1dc826c364cf2c.png"><br>  Ready controller: <br><img src="https://habrastorage.org/getpro/habr/post_images/118/8b6/ee9/1188b6ee9f1321d7c7b7c8e6d3edae08.jpg"><br>  In the nearest radio store it all costs: <br><ul><li>  Atmega8-16PU - 130r </li><li>  MAX485 - 60r </li><li>  LM2576 - 60r </li><li>  Powder (textolite, resistors, diodes, capacitors, quartz, terminals) - 150r </li></ul><br>  <b>Total = 400r.</b> <br>  It turned out cheap and cheerful.  Communication protocol device-server binary, with checksum.  The controller pushes the paws at the command of the server, in response to a state request, it sends an array of states of its inputs, outputs, ADCs and what was obtained by 1-Wire.  Without a server, it can turn on the light by a button, switch, motion sensor. <br><br>  If someone wants to see my RC-2, or even use it at home, I will describe in detail the protocol for communicating it with the server and give it the circuits and firmware. </div><p>Source: <a href="https://habr.com/ru/post/222571/">https://habr.com/ru/post/222571/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../222561/index.html">Report from the Silicon Valley Open Doors conference in Silicon Valley - meeting people</a></li>
<li><a href="../222563/index.html">Abnormal Programming in InterSystems Cach√©</a></li>
<li><a href="../222565/index.html">As we query is 100 times faster, or not all hash functions are equally bad</a></li>
<li><a href="../222567/index.html">Visual editing of markup inside an Android application</a></li>
<li><a href="../222569/index.html">Synthesis-2 - domestic clone ZX-Spectrum</a></li>
<li><a href="../222573/index.html">ReactJS in a nutshell. Part 1</a></li>
<li><a href="../222575/index.html">What's new for developers in Concrete5 CMS v5.7</a></li>
<li><a href="../222577/index.html">Algorithm for solving the backpack problem (version 2, revised)</a></li>
<li><a href="../222579/index.html">Spring from the inside. Context Initialization Stages</a></li>
<li><a href="../222581/index.html">Atlassian JIRA: setting up the processing of requests using the JJUPIN plugin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>