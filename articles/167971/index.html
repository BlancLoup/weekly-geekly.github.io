<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>High performance Google Chrome</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="History and cornerstones of Google Chrome. 
 Google Chrome was introduced in the second half of 2008 as a beta version for the Windows platform. The C...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>High performance Google Chrome</h1><div class="post__text post__text-html js-mediator-article"><h4>  History and cornerstones of Google Chrome. </h4><br><img src="http://1-ps.googleusercontent.com/h/www.igvita.com/posts/13/posa/xcomic-chrome.png.pagespeed.ic.viIocNBp3u.jpg" alt="image" align="left">  Google Chrome was introduced in the second half of 2008 as a beta version for the Windows platform.  The Chrome code, authored by Google, was made available under the liberal BSD license - just like the Chromium project.  For most concerned, such a turn of events was a surprise - is the <b>browser war back</b> ?  Can Google really make its product better than others? <br><br><blockquote>  <i>‚ÄúIt was so good that it made me change my mind ..‚Äù - Erich Schmidt, who <a href="http://blogs.wsj.com/digits/2009/07/09/sun-valley-schmidt-didnt-want-to-build-chrome-initially-he-says/">initially did not want</a> to accept the idea of ‚Äã‚ÄãGoogle Chrome.</i> </blockquote><a name="habracut"></a><br>  Yes, he could!  Today, Google Chrome is one of the most popular browsers ( <a href="http://gs.statcounter.com/%3FPHPSESSID%3Doc1i9oue7por39rmhqq2eouoh0">35%</a> market share, StatCounter performance) and is available on Windows, Linux, OS X, Chrome OS, Android and iOS platforms.  Undoubtedly, its advantages and wide functionality found a response in the hearts of users, giving many wonderful ideas to other browsers. <br><br>  The original <a href="http://www.google.com/googlebooks/chrome/">38 page</a> comic book, with explanations of the ideas and principles of Google Chrome offers us a wonderful example of the thinking and design process that resulted in this browser.  However, this is only the beginning.  The main principles that have become the motivators of the first stages of the development of Chrome, have been continued in the rules of continuous improvement of the browser: <br><ul><li>  <b>Speed</b> : make the <b>fastest</b> browser </li><li>  <b>Security</b> : provide the user with the <b>most secure</b> environment for work </li><li>  <b>Stability</b> : provide a <b>flexible and stable</b> platform for web applications </li><li>  <b>Simplicity</b> : sophisticated technology behind a <b>simple interface</b> . </li></ul><br>  As the development team notes, many of the sites we use today are not so much web pages as web applications.  In turn, increasingly large and ambitious applications require speed, security and stability.  Each of these qualities deserves a separate chapter of the book, but since today our topic is performance, we‚Äôll mostly talk about speed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Versatility of performance. </h4><br>  Modern browsers are a platform that in many ways resembles the operating system, and Google Chrome is no exception.  The browsers that preceded Chrome were designed as monolithic programs, with one workflow.  All open pages shared the same address space and worked with the same resources, so an error in the processing of any page or in the browser engine, threatened to crash and crash the entire application. <br><img src="http://1-ps.googleusercontent.com/h/www.igvita.com/posts/13/posa/xcomic-multi-process.png.pagespeed.ic.WG8U1j8zqv.jpg" alt="image" align="left"><br>  In contrast to this approach, <b>Chrome is based on a multi-process architecture</b> that provides each page with its own separate process and memory, creating something like a rigidly isolated <a href="http://dev.chromium.org/developers/design-documents/sandbox">sandbox</a> for each tab.  In a world of ever-increasing multi-core processors, the ability to isolate processes simultaneously with protecting each page from other, error-prone pages, gave Chrome a significant performance advantage over competitors.  It is worth noting that most other browsers followed suit, introducing or starting the implementation of the mentioned architecture. <br><br>  With the separation of processes, the execution of a web application mainly involves three tasks: get all the necessary resources, build the page structure and display it, run JS.  The processes of building a page and executing JS follow a single-threaded, alternating pattern, since it is not possible to perform the simultaneous construction and modification of the same page tree (DOM).  This feature is explained by the fact that JS itself is a single-threaded language.  Therefore, optimizing the co-creation of the page and the execution of scripts in real time is a very important task for both web application developers and browser developers themselves. <br><br>  Chrome uses <a href="http://en.wikipedia.org/wiki/WebKit">WebKit</a> , a fast, open source and standards-compliant engine to display pages.  To perform JS Chrome uses its own, very well optimized <a href="http://en.wikipedia.org/wiki/V8_(JavaScript_engine)">V8 Javascript</a> engine, which, by the way, is an Open Source project, and has found its application in many other popular projects - for example, in node.js.  <b>However, optimizing the execution of V8 scripts, or processing and displaying pages with a webcam, is not so important when the browser is waiting for the resources needed to build the page.</b> <br><br>  The ability of the browser to optimize the order, priority, and manage the possible delays of each necessary resource is one of the most important factors of its work.  You may not even be aware of this, but the Chrome network interface, figuratively speaking, will grow smarter every day, trying to hide or minimize the cost of waiting for each resource to load: it learns like a DNS search, memorizing network topology, performing preliminary requests to those most likely to visit pages and so on.  Externally, it is a simple mechanism for requesting and receiving resources, but its internal structure gives us a fascinating opportunity to learn how to optimize web performance in order to leave the user with only the best impressions. <br><br><h4>  What is a modern web application? </h4><br>  Before turning to the details of optimizing our interaction with the Internet, this section will help us understand the nature of the problem that we are investigating.  In other words <b>, what does a modern web page do, or what does the current web application look like</b> ? <br><br>  The <a href="httparchive.org/">HTTP Archive</a> project preserves the history of the evolution of the web, and it will help us answer this question.  Instead of collecting and analyzing content from the entire network, he periodically visits popular sites to collect and record data about resources used, content types, headers, and other meta-data for each individual site.  Statistics available as of January 2013 may surprise you.  The average page, with a selection among the first 300,000 Internet sites, has the following characteristics: <br><br><div style="text-align:center;"><img src="http://1-ps.googleusercontent.com/h/www.igvita.com/posts/13/posa/xhttparchive-jan2013.png.pagespeed.ic.dBi1KPmYR5.png" alt="image"></div><br><ul><li>  "Weight" - <b>1280</b> KB </li><li>  Consists of <b>88</b> resources (images, css, js) </li><li>  Uses data from <b>more than</b> <b>30</b> third-party sites. </li></ul><br>  Let's look at it in more detail.  Over 1MB of weight on average, consists of 88 resources, and is collected from 30 different proprietary and third-party servers.  Note that each of these indicators <a href="httparchive.org/trends.php">has been growing steadily</a> over the past few years, and there is no reason to predict that this growth will stop.  We are increasingly building increasingly cumbersome and demanding web applications, and this has no end in sight. <br><br>  By making simple mathematical calculations based on the HTTP Archive indicators, you can see that the average page resource has a weight of 12KB (1045KB / 84), which means that <b>most of the Internet connections in the browser are short and impulsive</b> .  This makes life even more difficult for us, since the underlying protocol (TCP) is optimized for large, streaming downloads.  Therefore, it is worth getting to the bottom of things, and consider one of the typical requests for a typical resource. <br><br><h4>  Typical query life </h4><br>  The <a href="http://www.w3.org/TR/navigation-timing/">W3C Navigation Timing</a> specification provides a browser API and the ability to track the hourly limits and performance of each request.  Let's take a closer look at its components, so each of them represents a very important part in the user's overall impression of browser performance. <br><br><div style="text-align:center;"><img src="http://1-ps.googleusercontent.com/h/www.igvita.com/posts/13/posa/xnavtiming.png.pagespeed.ic.BcXT6w65LY.jpg"></div><br><br>  After receiving the URL of the resource on the Internet, the browser begins to check whether it is local, and whether there is data stored in the cache.  If you have previously received data from this resource, and the <a href="https://developers.google.com/speed/docs/best-practices/caching">corresponding</a> browser headers have been set (Expires, Cache-Controle, ...) then you can get all the data from the cache - the <b>fastest request is the request that was not made</b> .  In another case, if we checked the resource and the cache is ‚Äúrotten‚Äù or we have not visited the site, it is the turn to make an expensive network request. <br><br>  Having the site address and the path to the requested resource, Chrome first checks whether there are open connections to this site that can be used again - the sockets are grouped in <code>{scheme, host, port}</code> .  In case you are accessing the Internet through a proxy, or have installed a proxy auto-config (PAC) script, Chrome checks the availability of the necessary connection through the appropriate proxy.  The PAC script allows you to specify multiple proxies based on URLs or other configuration configuration rules, and each of them can have its own set of connections.  Finally, if none of the above conditions came up, the <b>turn came to obtain an IP address for the address we need - DNS Lookup.</b> <br><br>  If we are lucky, and the address is in the cache, the answer will certainly cost us in one quick system request.  If not, the first thing to do is to query the DNS server.  The time it takes to perform it depends on your Internet provider, the popularity of the requested site and the likelihood that the site name is in the intermediate cache, plus the DNS server response time to the request.  In other words, there is a lot of uncertainty here, but the time of a few hundred milliseconds, which will be needed for a query before the DNS, will not be out of the ordinary. <br><img src="http://1-ps.googleusercontent.com/h/www.igvita.com/posts/13/posa/xtcp-handshake.png.pagespeed.ic.41IsyjCjFX.png" alt="image" align="left"><br>  After receiving the IP, Chrome can establish a new TCP connection to the remote server, which means that we have to do the so-called <a href="http://en.wikipedia.org/wiki/Transmission_Control_Protocol">three-way handshake</a> (three-time greeting): SYN&gt; SYN-ACK&gt; ACK.  This exchange of greetings <b>adds a delay to the request-response for each new TCP connection ‚Äî no exceptions</b> .  Depending on the distance between the client and the server, given the choice of the routing path, this can take us a few hundred or even thousands of milliseconds.  Note that this entire robot is executed before even one byte of data of the web application is transmitted! <br><br>  If the TCP connection is established, and we use the secure data transfer protocol (HTTPS), we will additionally need to establish an SSL connection.  This can <b>take up to two additional full-cycle question-answer</b> between the client and the server.  If the SSL session is cached, we can do with only one additional cycle. <br><br>  Finally, after all the procedures, Chrome has the ability to finally send an HTTP request (requestStart in the diagram above).  Upon receiving the request, the server starts processing it, and sends the response back to the client.  This will require at least one cycle, plus time to process the request on the server.  And so, we finally got an answer.  Yes, if this answer is not HTTP redirect!  In this case, we will have to repeat once again the whole procedure described above.  Do you have a couple of not quite necessary redirects on your pages?  Probably should return to them, and change your decision. <br><br>  Did you consider all these delays?  To illustrate the problem, suppose the worst scenario is a typical broadband connection: the local cache is lost, followed by relatively fast DNS lookup (50ms), TCP greeting, SSL negotiation, and relatively fast (100ms) server response, with 80ms for delivering the request and response (average cycle time on continental America): <br><ul><li>  50 ms for DNS </li><li>  80 ms for DNS greeting (one cycle) </li><li>  160 ms for SSL greetings (two cycles) </li><li>  40ms on request to the server </li><li>  100 ms to process the request on the server </li><li>  40 ms to reply from server </li></ul><br>  In sum, this is 470 ms for a single request, which results in more than <b>80% of the time</b> it takes to <b>connect to the server compared to the time it takes the server to process the request</b> .  In fact, even 470 milliseconds can be an optimistic estimate: <br><br><ul><li>  if the server's response does not fit into the initial <a href="http://en.wikipedia.org/wiki/Transmission_Control_Protocol">congestion</a> window (4-15KB), then several more request-response cycles will be required. </li><li>  SSL delay can be even worse if we need to get a lost certificate or perform an <a href="http://en.wikipedia.org/wiki/Online_Certificate_Status_Protocol">online</a> certificate status <a href="http://en.wikipedia.org/wiki/Online_Certificate_Status_Protocol">check</a> , in each case we need to establish a new, independent, TCP connection that can add hundreds of milliseconds or even seconds to the delay. </li></ul><br><br><h4>  What does "fast enough" mean? </h4><br>  Network expenses for DNS, greetings, and messaging are what dominate the total time in previous cases - the server response will require only 20% of the total wait!  But, <b>by and large, do these delays matter</b> ?  If you are reading this, then you probably already know the answer - yes, and very much so. <br><br>  Recent user <a href="http://www.useit.com/papers/responsetime.html">research</a> paints the following picture that users expect from any interface, both online and offline applications: <br><table><tbody><tr><th>  Delay </th><th>  User Response </th></tr><tr><td>  0-100ms </td><td>  instantly </td></tr><tr><td>  100-300 ms </td><td>  small but noticeable delay </td></tr><tr><td>  300-1000ms </td><td>  processing request </td></tr><tr><td>  more than 1s. </td><td>  switching the user's attention to another context </td></tr><tr><td>  more than 10s. </td><td>  I'll be back later </td></tr></tbody></table><br>  The table above also explains the unofficial rule of performance in a web application environment: display your pages, or at least provide a visual response to a user action within 250ms to keep your application interested.  But it's not just speed for speed.  Research in Google, Amazon, Microsoft, and many thousands of other sites show that the additional delay has a direct impact on the success of your site: <b>faster sites bring more views, higher user loyalty and higher conversion.</b> <br><br>  And so, what we have is an optimal latency of about 250ms, but, however, as we saw above, the combination of DNS queries, the installation of TCP and SSL connections, and the delivery of requests takes up to 370ms.  We have passed the limit by more than 50%, and we still have not considered the processing time of the request on the server! <br><br>  For most users and even web developers, DNS, TCP, SSL delays are completely opaque, and are formed on layers of abstraction that only a few of us think about.  However, each of these steps is critical for user interaction as a whole, since each additional network request can add tens or hundreds of milliseconds of delay. <br>  <b>This is the reason why the Chrome network stack has many, many more than just a socket handler.</b> <br><br>  <i>We discussed the problem, it's time to move on to the implementation details.</i> <br><br>  <i>PS translator: since the article is quite large, I decided to break it into theory and practice, the other part is more interesting and much larger.</i>  <i>As it turned out, a lot of time in processing a request for a translation takes a design for Habr, about 40% of the time, and reading in Russian, since for me this is a kind of double translation.</i>  <i>Thanks for attention.</i> </div><p>Source: <a href="https://habr.com/ru/post/167971/">https://habr.com/ru/post/167971/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../167959/index.html">From Iphone plan to make a computer mouse</a></li>
<li><a href="../167961/index.html">"Clean Internet" in the Kostroma region will be only with the consent of users</a></li>
<li><a href="../167965/index.html">Integration of 1C and B2B systems using HTTPS</a></li>
<li><a href="../167967/index.html">How not to become a defendant under article 128.1 of the Criminal Code of the Russian Federation ‚ÄúSlander‚Äù for repost</a></li>
<li><a href="../167969/index.html">Thoughts on the perfect HTPC</a></li>
<li><a href="../167973/index.html">Artificial Intelligence. Simulate a rescue operation</a></li>
<li><a href="../167975/index.html">The digest of interesting news and materials from the world of IT for the last week ‚Ññ42 (January 26 - February 1, 2013)</a></li>
<li><a href="../167977/index.html">Google has laid out the Grand Canyon panoramas</a></li>
<li><a href="../167979/index.html">NASA is testing a robot digger for exploring the moon</a></li>
<li><a href="../167981/index.html">Objective-C as the first programming language</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>