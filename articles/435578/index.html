<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Spacewalk for Christmas</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 

 Shortly before the arrival of Christmas, in the IT department it was decided to study Spacewalk, this is the Red Hat system, a free analo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Spacewalk for Christmas</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr! <br><br>  Shortly before the arrival of Christmas, in the IT department it was decided to study Spacewalk, this is the Red Hat system, a free analogue of the Satellite, for centralized configuration management, system updates, and convenient support for the entire server fleet. <br><br>  In view of the fact that the documentation available on the official website is rather scarce for additional comments of various kinds of troubleshooting, the task was to study the product for the gradual introduction of it first on test servers, and subsequently on products. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The main idea of ‚Äã‚Äãthe introduction of Spacewalk was not only centralization and simplification of control, but also that playful pens no one independently made updates on the servers of the new project, since the precedents already occurred. <br><br>  After two weeks of work, all the knowledge I gained was entered into the internal analogue of Confluence, and a free holiday pushed me to write an article on Habr. <br><a name="habracut"></a><br>  Before I begin, I would like to briefly highlight what was and was not affected, so as not to claim a full manual for working with Spacewalk: <br><br>  + Installation and configuration of server / client <br>  + Setting up the system in the GUI <br>  + Tracking installation / update packages, work with configurations <br>  + Errata (collection of information about critical updates, vulnerabilities, etc.) <br><br>  - Proxy (need disappeared, after rejection of HA) <br>  - Cobbler / kickstart <br>  - OpenSCAP <br><br><h3>  System requirements </h3><br>  Due to the fact that the entire infrastructure is running on VMWare, then the work was carried out on VMs running CentOS 7. The recommended system requirements from the developer are: <br><br><ul><li>  4GB RAM </li><li>  6GB of free space for / var / satellite / </li><li>  12GB for db </li></ul><br>  I used: <br><br><ul><li>  6GB RAM </li><li>  4 CPU (s) </li><li>  40GB HDD </li></ul><br>  I also advise you to disable SELinux and, if not, use firewalld.  Or add http service to exceptions. <br><br>  Note: at the end of the article there will be playbooks for Ansible, both for the client and for the server part, as well as bash scripts.  With their help, you can deploy the entire infrastructure in a couple of minutes. <br><br><h3>  Installation </h3><br>  The installation itself is described both in the official documentation and on several sites, but for the integrity of the article I will allow myself to mention this point here. <br><br>  Spacewalk works with two DBMS: PostgreSQL and Oracle RDBMS.  I have experience with the first, and I will use it now. <br><br>  There are two installation options: via the automatic installer from Spacewalk, which installs and configures itself and the database, however, on the same server, and installs manually, where you can install the DB and the application on different servers.  I will consider both options, start with a separate installation. <br><br><h4>  PostgreSQL </h4><br><pre><code class="bash hljs">yum install -y postgresql-server</code> </pre> <br>  You also need to connect PL / Tcl modules for PG: <br><br><pre> <code class="bash hljs">yum install -y postgresql-pltcl postgresql-setup initdb systemctl start postgresql</code> </pre> <br>  Create a database, user, and connect the module: <br><br><pre> <code class="bash hljs">su - postgres -c <span class="hljs-string"><span class="hljs-string">'PGPASSWORD=verystrong; createdb spcwlkdb ; createlang plpgsql spcwlkdb ; createlang pltclu spcwlkdb ; yes $PGPASSWORD | createuser -P -sDR spcwlkuser'</span></span></code> </pre> <br>  In order to avoid connection problems, you should change <i>/var/lib/pgsql/data/pg_hba.conf</i> , adding the lines BEFORE the all line: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">local</span></span> spcwlkdb spcwlkuser md5 host spcwlkdb spcwlkuser 127.0.0.1/8 md5 <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> spcwlkdb postgres ident</code> </pre> <br>  Restart all: <br><br><pre> <code class="bash hljs">systemctl restart postgresql</code> </pre> <br>  If you are going to install the application and the database on different servers, make sure that the <i>postgresql-contrib</i> package is installed on the database server. <br><br><h4>  Spacewalk </h4><br>  We connect repositories: <br><br><pre> <code class="bash hljs">rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8/epel-7-x86_64/00736372-spacewalk-repo/spacewalk-repo-2.8-11.el7.centos.noarch.rpm</code> </pre> <br>  Also connect epel: <br><br><pre> <code class="bash hljs">rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</code> </pre> <br>  Java: <br><br><pre> <code class="bash hljs">(<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc/yum.repos.d &amp;&amp; curl -O https://copr.fedorainfracloud.org/coprs/g/spacewalkproject/java-packages/repo/epel-7/group_spacewalkproject-java-packages-epel-7.repo)</code> </pre> <br>  Now directly the installer for Spacewalk-postgres: <br><br><pre> <code class="bash hljs">yum -y install spacewalk-setup-postgresql</code> </pre> <br>  Connect to our database: <br><br><pre> <code class="bash hljs">spacewalk-setup-postgresql create --db spcwlkdb --user spcwlkuser --password verystrong</code> </pre> <br>  In that case, if you use the separate database / application method, then you will need to add the <i>--standalone</i> flag and specify the IP address of the database server, also remember to open port 5432. <br><br>  <i>Note: I advise you to tune the database in accordance with your hardware for more productive work of the entire system.</i> <br><br>  Now we will install Spacewalk itself and launch the installation: <br><br><pre> <code class="bash hljs">yum -y install spacewalk-postgresql spacewalk-setup --external-postgresql</code> </pre> <br>  Next will be asked a few questions, both for the SSL certificate and for the database.  You can enter all values ‚Äã‚Äãmanually, or you can use the <i>--answer-file</i> flag, and specify the path to the file with answers to automate the installation in the future: <br><br><pre> <code class="bash hljs">admin-email = root@localhost ssl-set-cnames = spcwlkserver ssl-set-org = Unicorn ssl-set-org-unit = EOH ssl-set-city = Prague ssl-set-state = HMP ssl-set-country = CZ ssl-password = verystrong ssl-set-email = root@localhost ssl-config-sslvhost = Y db-backend=postgresql db-name=spcwlkdb db-user=spcwlkuser db-password=verystrong db-host=localhost db-port=5432 <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-tftp=Y</code> </pre> <br>  To control the application directly, you should use: <br><br><pre> <code class="bash hljs">/usr/sbin/spacewalk-service [stop|start|restart]</code> </pre> <br>  To display all the third-party services that contribute to the application: <br><br><pre> <code class="bash hljs">spacewalk-service status</code> </pre> <br><h4>  Option Two, automatic installation </h4><br>  After connecting the repositories, we put the setup, and run: <br><br><pre> <code class="bash hljs">yum -y install spacewalk-setup-postgresql yum -y install spacewalk-postgresql spacewalk-setup</code> </pre> <br>  Again, questions regarding the database and SSL will be asked, using the <i>--answer-file</i> key and the path to the file with answers. <br><br><h3>  Base &amp; Child Channels, Repos </h3><br>  To manage client stations, Spacewalk uses a system of so-called channels, which can be both primary (Base) and child (Child), each channel is assigned a repository that you need, as well as a key ‚Äî through which the client is paired with server. <br><br>  As a result, the repositories are synchronized with the channels, which, in turn, are connected with the customers, and Spacewalk works in a general way.  It is also worth mentioning the errata, which can be tied to the channels, which simplifies the update and control packages. <br><br>  All clients can be combined into groups according to different signs, and with both the same and different channels or repositories, it is possible to work with a large number of clients at times, which greatly helps to make updates on 100+ servers. <br><br>  A list of all installed packages is available, and after synchronization of repositories and possible ones for installation.  Some items are intuitive, and there is no point in considering each item line by line. <br><br>  All actions in Spacewalk occur on schedule (Schedule), almost any action can be customized to the time that is most convenient for you. <br><br>  After installation, you can go to the address of your server, further configuration is carried out through the graphical interface: <br><br><img src="https://habrastorage.org/webt/bb/iq/co/bbiqcow_kswo_i91vsqceeg6g0s.png"><br><br>  Enter the password, administrator name, organization name (which is also one of the ways to manage clients), and go to the start panel. <br><br>  For now, you can either study the available options on your own, or we‚Äôll proceed to creating channels <br><br>  <i>Channels - Manage Software Channels - Create Channel:</i> <br><br><img src="https://habrastorage.org/webt/5m/6o/f9/5m6of99m6ey7yq0rxbdmenvhcuw.png"><br><br>  I recommend setting the channel names according to the types and type of OS that will be associated with this channel, for example, <i>CentOS_7_x86_64</i> , you can safely choose sha256 as a check, the Channell Summary field is intended for a small description of the channel.  Also, you can optionally provide additional information. <br><br>  Now we will create a child channel and link it to the main one.  We are going in the same way as creating the main channel, only in the Parent Channel field we indicate the channel that has already been created. <br><br>  We tie the repositories to the main and daughter channels. <br>  <i>Channels - Manage Repositories</i> <br><br><img src="https://habrastorage.org/webt/a3/gq/ok/a3gqokxrwd10mlfq4geiw0f1nqy.png"><br><br>  For main channels I use Base Resources, for children I use Updates. <br><br>  After creating the repositories, you need to connect them to the channels. <br>  <i>Channels - Manage Software Channels</i> , open your main channel, open the Repositories section. <br><br><img src="https://habrastorage.org/webt/hw/ro/og/hwroogjvybx0p1z2mslzxf8nunq.png"><br><br>  There will be all created repositories, select the one you need, check, and click on Update Resources. <br><br>  Further open the subsection Sync: <br><br><img src="https://habrastorage.org/webt/ho/j7/4m/hoj74mhjkorduvftwkwbteuxzk4.png"><br><br>  Where you can synchronize the repository and the channel, set up a schedule for synchronization. <br><br>  <i>Note: in my case of playful hands, I had to delete the standard repository from the client system.</i> <br><br><h4>  Client installation, client pairing with the server, key management, configuration channel setup </h4><br>  As I mentioned earlier, Spacewalk uses the key system from Red Hat Network, through which pairing and management takes place. <br><br>  To create a key, go to <i>Systems - Activation Keys - Create Key:</i> <br><br><img src="https://habrastorage.org/webt/ea/df/vf/eadfvfezxpeh1s_lt9blgfox3j8.png"><br><br>  It's all very simple, is it worth mentioning that the key itself you can set yourself, its format will always be <i>1-XXXXX</i> , and also, each key is tied to the channel.  The Universal Default flag causes new systems to pick up key parameters. <br><br>  <b>Client installation</b> <br><br>  We will connect the client repository and install the necessary packages: <br><br><pre> <code class="bash hljs">rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8-client/epel-7-x86_64/00742644-spacewalk-repo/spacewalk-client-repo-2.8-11.el7.centos.noarch.rpm yum -y install rhn-client-tools rhn-check rhn-setup rhnsd m2crypto yum-rhn-plugin rhncfg-actions deltarpm</code> </pre> <br><br>  <i>Note: rhncfg-actions and deltarpm are needed for correct configurations and remote control.</i> <br><br>  Spacewalk uses rhn_check to synchronize a client server that runs every 4 hours.  This value can be reduced to 60 minutes, but for me neither one nor the other options were optimal, therefore there are two options: use osad, which comes with Spacewalk, or simply add a cronjob for rhn_check, for example, for every minute while we we test the system, then the value can be changed as you please. <br><br><pre> <code class="bash hljs">crontab -e * * * * * /usr/sbin/rhn_check</code> </pre> <br>  It would also be useful to add / usr / bin / rhn-actions-control --enable-all to Kron, too, it is used for deploying configurations, and sometimes tupit. <br><br>  Go back to key management, and copy the key ID that we created, and execute: <br><br><pre> <code class="bash hljs">rhnreg_ks --serverUrl=http://your-server-ip/XMLRPC --activationkey=1-YOURKEY --force</code> </pre> <br>  Just do not forget to change the values ‚Äã‚Äãof IP and key on your own.  Again, I advise you to use the <i>--force</i> flag, since I noticed problems without using this flag. <br><br>  We return to <i>Systems - All</i> , satisfied notice our system.  It can now be opened and explored what and how is there, but for now I strongly recommend creating a group for more convenient system management. <br><br>  <i>Systems - System Goups - Create Group</i> , fill in the name and description, save, open the newly created group, go to the <i>Systems</i> section and add the system to the group. <br><br>  Now let's subscribe the system to the channel, <i>Systems - Your system - Software folder - Software Channels subfolder:</i> <br><br><img src="https://habrastorage.org/webt/7f/hp/lu/7fhplurd2imupn4cio2n7ymcz1y.png"><br><br>  Choose your channel and click on confirmation.  It is possible to try to install the package for the sake of interest, <i>Software Packages - Install</i> . <br><br>  <b>Channel configurations</b> <br><br>  To manage configurations between the server client / local machine, as well as remote control, it is necessary to configure the configuration channel and link the system to it. <br>  Go to <i>Configuration - Configuration Channels - Create Config Channel</i> , set the name, description, save, then in <i>Configuration - Manage Configuration Channels - Subscribe to Channels</i> and subscribe the configuration channel to the software channel and to the system. <br><br><img src="https://habrastorage.org/webt/jy/ki/wt/jykiwtrdmame71pab7yyzr40lay.png"><br><br>  Now we can deploy the configuration both from the server and from local machines, and create partitions. <br><br>  <i>Configuration - Add Files - Create File / Upload File:</i> <br><br><img src="https://habrastorage.org/webt/cf/js/ie/cfjsieqwp21zlmem7goijg7cqui.png"><br><br>  We can also send remote commands in the form of a bash script: <br><br><img src="https://habrastorage.org/webt/hy/xw/d-/hyxwd-znezglfc-glf5yhn44wsq.png"><br><br>  I remind you that all actions pass through the schedule (Schedule), a list of all actions applied to this system can be viewed in the Events section: <br><br><img src="https://habrastorage.org/webt/9m/fp/hj/9mfphjmglxmqpxfd_cdqpsf8g2s.png"><br><br>  <b>Errata</b> <br><br>  One of the most important functions in Spacewalk is errata support, which is conveniently tied to channels and allows you to monitor the level of importance of the latest updates.  This is configured directly on the server, in addition to the scripts, you need to download the necessary packages for Perl: <br><br><pre> <code class="bash hljs">yum -y install perl-Frontier-RPC perl-Text-Unidecode wget https://raw.githubusercontent.com/stevemeier/cefs/master/errata-import.pl chmod +x errata-import.pl</code> </pre> <br>  Then we create the main update script and the errata collection, which will be stored in <i>/ etc / rhn /:</i> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash cd /etc/rhn/ wget -N http://cefs.steve-meier.de/errata.latest.xml wget -N https://www.redhat.com/security/data/oval/com.redhat.rhsa-all.xml export SPACEWALK_USER='root' export SPACEWALK_PASS='verystrong' ./errata-import.pl --server YourServerIPAddress --errata errata.latest.xml --rhsa-oval com.redhat.rhsa-all.xml --publish unset SPACEWALK_USER unset SPACEWALK_PASS</span></span></code> </pre> <br>  In the export, enter the name and password of the Spacewalk administrator that you specified at the very beginning. <br><br>  Make the script executable, and add it to Cron: <br><br><pre> <code class="bash hljs">chmod +x spcwlk_errata.sh crontab -e 0 2 * * 7 /usr/bin/sh /etc/rhn/spcwlk_errata.sh</code> </pre> <br>  Run it right now to see the changes in the GUI.  The execution will take some time. <br><br><img src="https://habrastorage.org/webt/5v/yy/v9/5vyyv9a4xpmq7c2lqqglozhdrsk.png"><br><br><h4>  Total </h4><br>  An important point, personally in my opinion, which I missed, is setting up and installing a proxy, as well as raising the entire system as HA.  I had an idea to configure the application via pacemaker, and synchronize on the database.  As a result, it was decided to abandon this idea, in view of the not very large server fleet of client stations.  However, if the system in the next six months shows itself to be extremely useful, you may have to expand the original server. <br><br><h4>  Automation </h4><br>  <b>Server:</b> <br><br><div class="spoiler">  <b class="spoiler_title">Bash script for server deployment (DISABLES firewalld):</b> <div class="spoiler_text"><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8/epel-7-x86_64/00736372-spacewalk-repo/spacewalk-repo-2.8-11.el7.centos.noarch.rpm rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm (cd /etc/yum.repos.d &amp;&amp; curl -O https://copr.fedorainfracloud.org/coprs/g/spacewalkproject/java-packages/repo/epel-7/group_spacewalkproject-java-packages-epel-7.repo) yum -y install spacewalk-setup-postgresql spacewalk-postgresql wget perl-Frontier-RPC perl-Text-Unidecode perl-XML-Simple # mkdir /usr/share/spcwlk-tmp/ echo 'admin-email = root@localhost ssl-set-cnames = spcwlkserver ssl-set-org = Unicorn ssl-set-org-unit = EOH ssl-set-city = Prague ssl-set-state = SCK ssl-set-country = CZ ssl-password = verystrong ssl-set-email = root@localhost ssl-config-sslvhost = Y db-backend=postgresql db-name=spcwlkdb db-user=spcwlkuser db-password=verystrong db-host=localhost db-port=5432 enable-tftp=Y' &gt; /usr/share/spcwlk-tmp/spcwlk_answer spacewalk-setup --answer-file=/usr/share/spcwlk-tmp/spcwlk_answer # systemctl stop firewalld systemctl disable firewalld #</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Bash script to install errata (first set the name and password for the Spacewalk administrator):</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # wget https://raw.githubusercontent.com/stevemeier/cefs/master/errata-import.pl -P /etc/rhn/ echo '#!/bin/bash cd /etc/rhn/ wget -N http://cefs.steve-meier.de/errata.latest.xml wget -N https://www.redhat.com/security/data/oval/com.redhat.rhsa-all.xml export SPACEWALK_USER='gui username' export SPACEWALK_PASS='Password to your gui account' ./errata-import.pl --server YourServerIPAddress --errata errata.latest.xml --rhsa-oval com.redhat.rhsa-all.xml --publish unset SPACEWALK_USER unset SPACEWALK_PASS' &gt; /etc/rhn/spcwlk_errata.sh # chmod +x /etc/rhn/errata-import.pl chmod +x /etc/rhn/spcwlk_errata.sh # echo '#!/bin/bash # /etc/rhn/./spcwlk_errata.sh' &gt; /etc/rhn/spcwlk_errata_cron.sh chmod +x /etc/rhn/spcwlk_errata_cron.sh echo '0 2 * * 7 /usr/bin/sh /etc/rhn/spcwlk_errata_cron.sh' &gt;&gt; /var/spool/cron/root /etc/rhn/./spcwlk_errata.sh #</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Ansible playbook for server deployment (do not forget to add the answer-file):</b> <div class="spoiler_text"><pre> <code class="bash hljs">- hosts: spcwlk-server tasks: - name: Install Spacewalk repo yum: name: https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8/epel-7-x86_64/00736372-spacewalk-repo/spacewalk-repo-2.8-11.el7.centos.noarch.rpm state: present - name: Install epel repo yum: name: https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm state: present - name: Install PostgreSQL packages yum: name: - spacewalk-setup-postgresql - spacewalk-postgresql - wget - perl-Frontier-RPC - perl-Text-Unidecode - perl-XML-Simple - name: Creates directory <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Spacewalk answer file file: path: /usr/share/spcwlk-tmp/ state: directory mode: 0755 - name: Deploy answer file copy: src: /etc/ansible/spcwlk_answer dest: /usr/share/spcwlk-tmp/spcwlk_answer - name: Spacewalk Server Deploy shell: spacewalk-setup --answer-file=/usr/share/spcwlk-tmp/spcwlk_answer - name: Stop firewalld systemd: name: firewalld state: stopped enabled: no</code> </pre> <br></div></div><br>  <b>Customer:</b> <br><br><div class="spoiler">  <b class="spoiler_title">Bash-script for client deployment (do not forget about IP and key):</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8-client/epel-7-x86_64/00742644-spacewalk-repo/spacewalk-client-repo-2.8-11.el7.centos.noarch.rpm yum -y install rhn-client-tools rhn-check rhn-setup rhnsd m2crypto yum-rhn-plugin rhncfg-actions deltarpm wget echo '#!/bin/bash # /usr/sbin/rhn_check' &gt; rhn_check.sh mv rhn_check.sh /etc/cron.hourly/ chmod +x /etc/cron.hourly/rhn_check.sh echo '* * * * * /usr/bin/sh /etc/cron.hourly/rhn_check.sh' &gt;&gt; /var/spool/cron/root /usr/bin/rhn-actions-control --enable-all cd /usr/share/rhn/ wget http://YourServerIPAddress/pub/RHN-ORG-TRUSTED-SSL-CERT rhnreg_ks --serverUrl=http://172.22.64.41/XMLRPC --activationkey=1-xxxxxxxxxxxxxxxxxxxxxxxxxxxx --force</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Anisble Playbook for client deployment:</b> <div class="spoiler_text"><pre> <code class="bash hljs">- hosts: spcwlk-clients tasks: - name: Install spacewalk repo yum: name: https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8-client/epel-7-x86_64/00742644-spacewalk-repo/spacewalk-client-repo-2.8-11.el7.centos.noarch.rpm state: present - name: Install client packages yum: name: - rhn-client-tools - rhn-check - rhn-setup - rhnsd - m2crypto - yum-rhn-plugin - rhncfg-actions - deltarpm - wget - name: Create cronjob <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> rhn_check cron: name: <span class="hljs-string"><span class="hljs-string">"rhn_check"</span></span> minute: <span class="hljs-string"><span class="hljs-string">"*"</span></span> hour: <span class="hljs-string"><span class="hljs-string">"*"</span></span> day: <span class="hljs-string"><span class="hljs-string">"*"</span></span> month: <span class="hljs-string"><span class="hljs-string">"*"</span></span> weekday: <span class="hljs-string"><span class="hljs-string">"*"</span></span> job: <span class="hljs-string"><span class="hljs-string">"/usr/sbin/rhn_check"</span></span> - name: Enable controls <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> config and remote control deployment shell: /usr/bin/rhn-actions-control --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-all - name: Get certificate from server to client get_url: url: http://YourServerIPAddress/pub/RHN-ORG-TRUSTED-SSL-CERT dest: /usr/share/rhn/ - name: Register client to server rhn_register: state: present server_url: http://YourServerIPAddress/XMLRPC activationkey: <span class="hljs-string"><span class="hljs-string">"{{ activation_key }}"</span></span></code> </pre> <br></div></div><br>  Thank you all for reading the article.  Good luck! </div><p>Source: <a href="https://habr.com/ru/post/435578/">https://habr.com/ru/post/435578/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../435564/index.html">Using GtkApplication. Librsvg drawing features</a></li>
<li><a href="../435568/index.html">VyOS OpenSource Router</a></li>
<li><a href="../435572/index.html">Anycubic i3 Mega: a quality remake of Prusa i3</a></li>
<li><a href="../435574/index.html">How does zig work?</a></li>
<li><a href="../435576/index.html">1C, do not hurt</a></li>
<li><a href="../435580/index.html">Java, Spring, Kurento and Media Services</a></li>
<li><a href="../435582/index.html">How to add an index on a loaded system 24/7 without downtime?</a></li>
<li><a href="../435584/index.html">Slush 2018. Day one, day two</a></li>
<li><a href="../435586/index.html">The art of shamanism or custom firmware for Olinuxino. Kernel and Ubuntu Part 3</a></li>
<li><a href="../435588/index.html">Promotion of a mobile application on real experience in numbers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>