<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Disk balancing in Nginx</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will describe an interesting solution based on Nginx for the case when the disk system becomes a bottleneck when distributing conten...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Disk balancing in Nginx</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/312/451/6b4/3124516b41234e80a5399ca7c4ced404.jpg"></div><br>  In this article I will describe an interesting solution based on Nginx for the case when the disk system becomes a bottleneck when distributing content (for example, video). <a name="habracut"></a><br><br><h4>  Formulation of the problem </h4><br>  We have a task: you need to send static files (video) to clients with a total distribution band of tens of gigabits per second. <br><br>  For obvious reasons, such a band cannot be distributed directly from the repository, it is necessary to apply caching.  The amount of content that makes up most of the traffic produced is several orders of magnitude larger than the amount of RAM in one server, so caching in RAM is not possible, and the cache will have to be stored on disks. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Network channels of sufficient capacity are available a priori, otherwise the task would be unsolvable. <br><br><h4>  Choosing a solution </h4><br>  In this situation, disks become a problematic place: in order for the server to produce 20 gigabytes of traffic per second (two optical fibers in the aggregate), it must read ~ 2400 megabytes per second of disks from the disks.  In addition to this, the disks can also be busy writing to the cache. <br>  To scale the performance of the disk system used RAID-arrays with alternating blocks.  The bet is that when reading a file, its blocks will appear on different disks and the speed of sequential reading of the file will be on average equal to the speed of the slowest disk multiplied by the number of alternating disks. <br>  The problem with this approach is that it works efficiently only for the ideal case, when a sufficiently long file is read (the file size is much larger than the size of the interleaving block), which is located inside the file system without fragmentation.  For parallel reading of many small and / or fragmented files, this approach does not even allow to approach the total speed of all disks.  For example, a RAID0 of six ssd disks with 100% load on an I / O queue gave a speed like two disks. <br>  Practice has shown that it is more profitable to divide files between disks entirely using separate file systems.  This ensures that each disk is recycled, because they are independent. <br><br><h4>  Implementation </h4><br>  As mentioned above, we will cache nginx.  The idea is to divide the distributed files between the disks equally.  To do this, in the simplest case, it is enough to hash to display multiple URLs into multiple disks.  Something like this we will do, but first things first. <br>  We define the caching zone by the number of disks.  In my example there are 10 of them. <br>  In the <code>http</code> section: <br><pre> <code class="nginx hljs"> <span class="hljs-attribute"><span class="hljs-attribute">proxy_cache_path</span></span> /var/www/cache1 levels=<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span> keys_zone=cache1:<span class="hljs-number"><span class="hljs-number">100m</span></span> inactive=<span class="hljs-number"><span class="hljs-number">365d</span></span> max_size=<span class="hljs-number"><span class="hljs-number">200g</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_cache_path</span></span> /var/www/cache2 levels=<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span> keys_zone=cache2:<span class="hljs-number"><span class="hljs-number">100m</span></span> inactive=<span class="hljs-number"><span class="hljs-number">365d</span></span> max_size=<span class="hljs-number"><span class="hljs-number">200g</span></span>; ... <span class="hljs-attribute"><span class="hljs-attribute">proxy_cache_path</span></span> /var/www/cache10 levels=<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span> keys_zone=cache10:<span class="hljs-number"><span class="hljs-number">100m</span></span> inactive=<span class="hljs-number"><span class="hljs-number">365d</span></span> max_size=<span class="hljs-number"><span class="hljs-number">200g</span></span>;</code> </pre><br>  A separate disk is mounted in the directory of each cache zone. <br><br>  Sources of content will be three upstream, two servers in each group: <br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">upstream</span></span> src1 { <span class="hljs-attribute"><span class="hljs-attribute">server</span></span> <span class="hljs-number"><span class="hljs-number">192.168.1.10</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server</span></span> <span class="hljs-number"><span class="hljs-number">192.168.1.11</span></span>; } <span class="hljs-attribute"><span class="hljs-attribute">upstream</span></span> src2 { <span class="hljs-attribute"><span class="hljs-attribute">server</span></span> <span class="hljs-number"><span class="hljs-number">192.168.1.12</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server</span></span> <span class="hljs-number"><span class="hljs-number">192.168.1.13</span></span>; } <span class="hljs-attribute"><span class="hljs-attribute">upstream</span></span> src3 { <span class="hljs-attribute"><span class="hljs-attribute">server</span></span> <span class="hljs-number"><span class="hljs-number">192.168.1.14</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server</span></span> <span class="hljs-number"><span class="hljs-number">192.168.1.15</span></span>; }</code> </pre><br>  This is not a fundamental moment, taken for likelihood. <br><br>  <code>server</code> section: <br><br><pre> <code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> default; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> localhost.localdomain; <span class="hljs-attribute"><span class="hljs-attribute">access_log</span></span> /var/log/nginx/video.access.log combined buffer=<span class="hljs-number"><span class="hljs-number">128k</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_cache_key</span></span> <span class="hljs-variable"><span class="hljs-variable">$uri</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">set_by_lua_file</span></span> <span class="hljs-variable"><span class="hljs-variable">$cache_zone</span></span> /etc/nginx/cache_director.lua <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-variable"><span class="hljs-variable">$uri_without_args</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_cache_min_uses</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_cache_valid</span></span> <span class="hljs-number"><span class="hljs-number">1y</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_next_upstream</span></span> <span class="hljs-literal"><span class="hljs-literal">error</span></span> timeout invalid_header http_500 http_502 http_503 http_504 http_404; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> <span class="hljs-regexp"><span class="hljs-regexp">~* ^/site1/.*$</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">set</span></span> <span class="hljs-variable"><span class="hljs-variable">$be</span></span> <span class="hljs-string"><span class="hljs-string">"src1"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">include</span></span> director; } <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> <span class="hljs-regexp"><span class="hljs-regexp">~* ^/site2/.*$</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">set</span></span> <span class="hljs-variable"><span class="hljs-variable">$be</span></span> <span class="hljs-string"><span class="hljs-string">"src2"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">include</span></span> director; } <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> <span class="hljs-regexp"><span class="hljs-regexp">~* ^/site3/.*$</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">set</span></span> <span class="hljs-variable"><span class="hljs-variable">$be</span></span> <span class="hljs-string"><span class="hljs-string">"src3"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">include</span></span> director; } <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> <span class="hljs-variable"><span class="hljs-variable">@cache1</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">bytes</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_temp_path</span></span> /var/www/cache1/tmp <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_cache</span></span> cache1; <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://<span class="hljs-variable"><span class="hljs-variable">$be</span></span>; } <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> <span class="hljs-variable"><span class="hljs-variable">@cache2</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">bytes</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_temp_path</span></span> /var/www/cache2/tmp <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_cache</span></span> cache2; <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://<span class="hljs-variable"><span class="hljs-variable">$be</span></span>; } ... <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> <span class="hljs-variable"><span class="hljs-variable">@cache10</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">bytes</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_temp_path</span></span> /var/www/cache10/tmp <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_cache</span></span> cache10; <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://<span class="hljs-variable"><span class="hljs-variable">$be</span></span>; } }</code> </pre><br>  The set_by_lua_file directive selects the appropriate drive for this URL by hashing.  For the conditional ‚Äúsite‚Äù, the backend is selected and remembered.  Then in the director file there is a redirection to the internal location, which serves the request from the selected backend, saving the response in the cache defined for this URL. <br><br>  Here is the <code>director</code> : <br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">$cache_zone</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-attribute"><span class="hljs-attribute">return</span></span> <span class="hljs-number"><span class="hljs-number">481</span></span>; } <span class="hljs-attribute"><span class="hljs-attribute">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">$cache_zone</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-attribute"><span class="hljs-attribute">return</span></span> <span class="hljs-number"><span class="hljs-number">482</span></span>; } ... <span class="hljs-attribute"><span class="hljs-attribute">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">$cache_zone</span></span> = <span class="hljs-number"><span class="hljs-number">9</span></span>) { <span class="hljs-attribute"><span class="hljs-attribute">return</span></span> <span class="hljs-number"><span class="hljs-number">490</span></span>; } <span class="hljs-attribute"><span class="hljs-attribute">error_page</span></span> <span class="hljs-number"><span class="hljs-number">481</span></span> = <span class="hljs-variable"><span class="hljs-variable">@cache1</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">error_page</span></span> <span class="hljs-number"><span class="hljs-number">482</span></span> = <span class="hljs-variable"><span class="hljs-variable">@cache2</span></span>; ... <span class="hljs-attribute"><span class="hljs-attribute">error_page</span></span> <span class="hljs-number"><span class="hljs-number">490</span></span> = <span class="hljs-variable"><span class="hljs-variable">@cache10</span></span>;</code> </pre><br>  It looks awful, but it is the only way. <br><br>  All configuration salt in URL-&gt; disk hashing, <code>cache_director.lua</code> : <br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shards_vector</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(base, seed)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> result = {} <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> shards = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> shard_n=<span class="hljs-number"><span class="hljs-number">0</span></span>,base<span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-built_in"><span class="hljs-built_in">table</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">insert</span></span>(shards, shard_n) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> b=base,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> choosen = <span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">fmod</span></span>(seed, b)+<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">table</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">insert</span></span>(result, shards[choosen]) <span class="hljs-built_in"><span class="hljs-built_in">table</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">remove</span></span>(shards, choosen) seed = <span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">floor</span></span>(seed / b) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">file_exists</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filename)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file = <span class="hljs-built_in"><span class="hljs-built_in">io</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">open</span></span>(filename) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> file <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">io</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">close</span></span>(file) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> disks = ngx.<span class="hljs-built_in"><span class="hljs-built_in">arg</span></span>[<span class="hljs-number"><span class="hljs-number">1</span></span>] url = ngx.<span class="hljs-built_in"><span class="hljs-built_in">arg</span></span>[<span class="hljs-number"><span class="hljs-number">2</span></span>] sum = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> url:<span class="hljs-built_in"><span class="hljs-built_in">gmatch</span></span><span class="hljs-string"><span class="hljs-string">"."</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> sum = sum + <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span>(c) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> sh_v = shards_vector(disks, sum) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>(sh_v) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> file_exists(<span class="hljs-string"><span class="hljs-string">"/var/www/cache"</span></span> .. (<span class="hljs-built_in"><span class="hljs-built_in">tonumber</span></span>(v)+<span class="hljs-number"><span class="hljs-number">1</span></span>) .. <span class="hljs-string"><span class="hljs-string">"/ready"</span></span>) == <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> v <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  In the <code>set_by_lua_file</code> directive mentioned above, this code gets the number of disks and the URL.  The idea of ‚Äã‚Äãdirectly mapping a URL to a disk is good until at least one disk fails.  Redirection of URLs from a problem disk to a healthy one needs to be performed equally for a specific URL (otherwise there will be no cache hits) and at the same time it must be different for different URLs in order to avoid load imbalance.  Both of these properties should be maintained if replacement of replacement (etc.) also fails.  Therefore, for a system of n disks, I map the URL to the set of various permutations of these n disks and then try to use the corresponding caches in the order of the disks in the order.  The criterion for disk activity (cache) is the presence of a flag file in its directory.  I have to chattr these files so that nginx does not delete them. <br><br><h4>  results </h4><br>  Such a smearing of content on disks really allows you to use the entire speed of disk devices.  A server with 6 inexpensive SSD disks with a workload was able to develop a return of about 1200 MB / s, which corresponds to the total speed of the disks.  The speed of the array ranged around 400 MB / s </div><p>Source: <a href="https://habr.com/ru/post/233525/">https://habr.com/ru/post/233525/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../233511/index.html">Kepler: smart detector for gas and CO leaks</a></li>
<li><a href="../233513/index.html">IXION - a new concept of "transparent" aircraft</a></li>
<li><a href="../233517/index.html">Latest statistics reports on smartphones: in Russia and not only</a></li>
<li><a href="../233521/index.html">Why did Windows RT for tablets never fly up?</a></li>
<li><a href="../233523/index.html">BookTitres.com - learn languages ‚Äã‚Äãfor foreign literature in the original, listening and reading</a></li>
<li><a href="../233527/index.html">3 new JavaScript API that you should know</a></li>
<li><a href="../233531/index.html">We need a blog</a></li>
<li><a href="../233533/index.html">All broken</a></li>
<li><a href="../233535/index.html">Electronic relocation to Shenzhen</a></li>
<li><a href="../233541/index.html">Will solid-state batteries change the world?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>