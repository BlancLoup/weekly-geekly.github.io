<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>minilinux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lyrical part 
 Who among us in childhood didn‚Äôt make out toys to see what was inside. I was no exception. Only a few years passed, and Linux became on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>minilinux</h1><div class="post__text post__text-html js-mediator-article"><h6>  Lyrical part </h6><br>  Who among us in childhood didn‚Äôt make out toys to see what was inside.  I was no exception.  Only a few years passed, and Linux became one of the toys.  From the abstract desire to ‚Äúbreak and see‚Äù it was formalized into several very specific tasks, one of which was to find some starting point - the minimal thing that would load and give the shell.  A couple of times I started collecting lfs, but I still did not get to the end.  I read several articles about the development of embedded, but there everything was too serious and grown-up: after the proposals to build the environment for cross-compilation for various architectures and remote debugging turned off the Internet in a panic.  I reviewed a few mini-livecd, but they all were either megadrevne (kernel 2.4 and below) or necessarily with graphics and DE, which did not fit into my idea of ‚Äã‚Äãthe ideal minidist for experiments. <br>  And not so long ago, I accidentally found out that what I was looking for was called initramfs and was under my nose. <br><a name="habracut"></a><br><h6>  HOWTO part </h6><br>  Let us set ourselves the task of getting a small, cozy and, preferably, useful distribution package with something, without making special efforts.  By and large, we will need a boot loader, a kernel, and an initramfs image.  The easiest way to get them is to pull them out of the ready-made distribution.  In order to make it at least somewhat useful, we put in there a busybox and configure several network services.  I will show how to do this with CentOS, but in principle, any one will do.  So let's get started: <br><br>  Extract the initrd somewhere: <br> <code>mkdir /root/myimage <br> cd /root/myimage <br> gzip -d &lt; /boot/initrd-2.6.18-128.el5 | cpio --extract --verbose --make-directories --no-absolute-filenames</code> <br> <br>  Install and copy busybox to our minilinux (busybox does not link to anything, so feel free to copy) <br> <code>yum install busybox <br> cp -a /sbin/busybox /root/myimage/bin</code> <br> <br>  We leave in init only the most necessary minimum: we create procfs and sysfs, the main device files, load the necessary drivers (for my network I needed to copy them from / lib of the main distribution) and run a couple of services.  Here is: <br><br>  / init 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>#!/bin/nash <br> <br> mount -t proc /proc /proc <br> mount -t sysfs /sys /sys <br> mount -o mode=0755 -t tmpfs /dev /dev <br> mkdir /dev/pts <br> mount -t devpts -o gid=5,mode=620 /dev/pts /dev/pts <br> mkdir /dev/shm <br> mknod /dev/null c 1 3 <br> mknod /dev/zero c 1 5 <br> mknod /dev/systty c 4 0 <br> mknod /dev/tty c 5 0 <br> mknod /dev/console c 5 1 <br> mknod /dev/ptmx c 5 2 <br> mknod /dev/rtc c 10 135 <br> mknod /dev/tty0 c 4 0 <br> mkblkdevs <br> insmod /lib/libphy.ko <br> insmod /lib/tg3.ko <br> mkblkdevs <br> echo WELCOME!!! <br> /bin/busybox ln -s /bin/busybox /bin/ash <br> /bin/busybox ln -s /bin/busybox /bin/telnetd <br> /bin/busybox ifconfig eth0 192.168.1.1 netmask 255.255.255.0 <br> /bin/busybox httpd <br> /bin/busybox inetd /etc/inetd.conf <br> /bin/ash</code> <br> <br>  / etc / passwd <br> <code>root:x:0:0:root:/:/bin/ash</code> <br> <br>  /etc/inetd.conf <br> <code>23 stream tcp nowait root /bin/telnetd telnetd -l /bin/ash</code> <br> <br>  We collect initramfs and return to the place: <br> <code>find . | cpio -H newc --create --verbose | gzip -9 &gt; /boot/initrd-2.6.18-128.el5</code> <br> <br>  Voila  Our minilinux is ready.  You can demolish everything except the / boot directory and reboot.  But for greater reliability, we transfer it to a USB flash drive: <br>  Suppose a flash drive is defined by the kernel as / dev / sdb.  There is only one fat section on it.  With fdisk we will make it bootable. <br> <code>fdisk /dev/sdb</code> <br> <br>  We check if there is an asterisk in the boot column.  If not, press a, and then w. <br>  Mount the flash drive somewhere and copy / boot to it <br> <code>mount /dev/sdb1 /mnt <br> cp -a /boot /mnt <br> umount /dev/sdb1</code> <br> <br>  Using grub, overwrite the boot sector of the flash drive <br> <code>grub <br> &gt;find (hd1,0)/boot/grub/stage2 <br> &gt;root (hd1,0) <br> &gt;setup (hd0) <br> &gt;quit</code> <br> <br>  here I made the assumption that grub "saw" the flash drive as disk 2. If this is not the case, find will give an error (will not find / boot).  See the result of find (hd2,0) ... find (hd3,0) ..., etc., until you find the USB flash drive. <br><br><h6>  Total </h6><br>  Well that's all.  Reboot, turn on the boot from removable media in the BIOS and get the command line prompt of our minilinux.  We are also trying to connect to the 192.168.1.1 telnet client and open it in the browser <a href="http://192.168.1.1/init">192.168.1.1/init.</a> If someone is inspired by the theme of creating their own small distribution kit, here are some directions for further research: <br>  - See utilbox busybox.  There are many useful network services: http, dhcp, tftp, smtp, tod, inetd.  From tar + gzip + ftpput you get a great ‚Äúunattended backup‚Äù.  There is also a lot of utilities for working with FS, which will allow you to create your own rescue cd. <br>  - Identify more devices.  As you probably noticed, I threw out all the disk and fs drivers from the init-script.  ABOUT!!!  And by the way, hotplug and USB drivers are also disabled, so if you have a usb keyboard, first of all, put them back in place. <br>  I hope this article will be useful to someone. </div><p>Source: <a href="https://habr.com/ru/post/59988/">https://habr.com/ru/post/59988/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../59981/index.html">Filter Forge: Turning photos into watercolor painting (lesson)</a></li>
<li><a href="../59982/index.html">phpThread: threads in php? Easily</a></li>
<li><a href="../59984/index.html">Dell Latitude 2100 Notebook for Schoolchildren</a></li>
<li><a href="../59986/index.html">Say a word about Mac clones ... you can use foul language</a></li>
<li><a href="../59987/index.html">Communication program concept</a></li>
<li><a href="../59989/index.html">Thinking about programming and programmers</a></li>
<li><a href="../59990/index.html">Selecting IM - client for Nokia 5800 XM</a></li>
<li><a href="../59992/index.html">Moblin 2.0 Beta: New User Interface</a></li>
<li><a href="../59993/index.html">How to answer the question: "How much does a website cost?"</a></li>
<li><a href="../59996/index.html">Norway</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>