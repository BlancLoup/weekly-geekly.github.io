<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Zabbix 2.2: Monitoring the temperature of the Windows processor of the machine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A little about yourself and the work environment  I work as an engineer in a company of two people, we serve a dozen of municipal and commercial enter...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Zabbix 2.2: Monitoring the temperature of the Windows processor of the machine</h1><div class="post__text post__text-html js-mediator-article"><img align="right" src="https://habrastorage.org/getpro/habr/post_images/448/4c4/b3c/4484c4b3c8858f25cf231cba018c558b.png"><div class="spoiler">  <b class="spoiler_title">A little about yourself and the work environment</b> <div class="spoiler_text">  I work as an engineer in a company of two people, we serve a dozen of municipal and commercial enterprises with a fleet of computers up to 100 pieces of which 99% of windows are machines.  We are engaged in everything from laying a network to setting up information systems.  There is a lot of work and sometimes I really want to make my life a little easier and now, at the next such moment, I ran into the zabbix monitoring system. </div></div>  When I first met zabbix, I was overwhelmed with emotions and fantasies about monitoring everything in the world.  The first was the idea of ‚Äã‚Äãpreventing physical malfunctions by tracking key indicators of iron, such as temperature or voltage, because it seems to me very logical and cost-effective to change the thermal grease or begin to pick up the replacement of tired equipment before the user reports her premature death or terrible brakes. <br>  Zabbix monitoring system is really very powerful and flexible, but unfortunately, not all aspects of tracking are available from standard box templates.  Thus, my fantasy crashed against the wall of the lack of regular temperature monitoring tools in Windows. <br><a name="habracut"></a><br>  The search process on the Internet has put me in front of the fact that iron temperatures can not be pulled out without third-party tools.  When searching for these very means, I <a href="https://www.zabbix.com/forum/showthread.php%3Ft%3D19014">came across</a> a popular utility <a href="http://www.almico.com/speedfan.php">SpeedFan</a> , which can collect data on device temperature, fan speed, voltages.  But getting from her ready-to-process data without installing another utility is not possible.  Plus, they are not open source and require activation of the SNMP protocol component.  Conclusion: it is possible to try on windows server without IMPI, but as a variant of mass distribution in the network it is not suitable.  Further search brought on programs <a href="http://www.cpuid.com/softwares/hwmonitor-pro.html">hwmonitor</a> and <a href="http://www.aida64.com/">aida64</a> - monsters, large and paid. <br><br><h5>  Openhardwaremonitor </h5><br>  Already almost desperate, caught on a <a href="https://www.zabbix.com/forum/showpost.php%3Fp%3D143811%26postcount%3D12">short message</a> on the English-language forum zabbix.  <a href="http://openhardwaremonitor.org/">They</a> recommended a small <a href="http://openhardwaremonitor.org/license/">open source</a> utility <a href="http://openhardwaremonitor.org/">OpenHardwareMonitor</a> - it has a graphical interface and can read the temperature of devices from sensors.  And most importantly, its author, at the <a href="https://code.google.com/p/open-hardware-monitor/issues/detail%3Fid%3D230">request of the workers, wrote a console version</a> (latest version 10/28/2012), outputting information in a form ready for processing. <br><br>  <b>GUI version</b> : 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/237/1f9/7af/2371f97af3fd2ea8dcabd878705932ea.png" alt="GUI version"></div><br><br>  <b>Console version</b> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ff/43e/8d8/9ff43e8d8252fd7949d5368dec2e47db.png" alt="Console version"></div><br><br>  The console version consists of two files, an exe executable file and a dll library. <br><br><ul><li>  OpenHardwareMonitorReport.exe </li><li>  OpenHardwareMonitorLib.dll </li></ul><br>  Where we get the data, we now need to adjust the delivery of Zabbix indicator values ‚Äã‚Äãto the server. <br><br><h5>  Server Tuning </h5><br>  First, add a new item to the server for the host: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/db5/47a/71a/db547a71afb63f242a3f385670547f89.jpg" alt="New item"></div><br><br>  Let's call it: CPU Temperature.  (CPU temperature) <br><br>  Type: Zabbix Agent <br>  Key: Temperature.CPU [0].  (The name does not matter, the main thing is that the agent config matches). <br>  Host interface: ip \ dns.  (The node that will be monitored). <br>  Type of information: Numeric (integer positive) <br>  Data type: Decimal <br><br>  Update interval (in seconds): 3600. (In the screenshot it costs 10 seconds, for a temporary check). <br><br>  On the server finished, go to the client configuration. <br><br><h5>  Client setup </h5><br>  We will send non-standard data via the Zabbix agent in the config (zabbix_agentd.conf) which provides for the so-called user parameters - UserParameters of the form: <br><br><pre><code class="bash hljs">UserParameter=[*],</code> </pre> <br><br>  The command through which we get the value is processed on the client side.  Zabbix server will receive a key with the value assigned to it.  The article means that you already have an agent installed as a service and are friends with the server. <br><br>  At the end of the config file agent add: <br><br><pre> <code class="bash hljs">UserParameter=Temperature.CPU[*], C:\OpenHardwareMonitor\CPUTemperature.bat</code> </pre><br><br>  CPUTemperature.bat - a batch file written by me that pulls out of OpenHardwareMonitor, the average temperature across the processor.  In the program, this line is called CPU Package. <br><br>  In C: \ OpenHardwareMonitor there are 3 files: <br><br><ul><li>  OpenHardwareMonitorReport.exe </li><li>  OpenHardwareMonitorLib.dll </li><li>  CPUTemperature.bat </li></ul><br><br><div class="spoiler">  <b class="spoiler_title">Contents CPUTemperature.bat</b> <div class="spoiler_text"><div class="spoiler">  <b class="spoiler_title">Here is my old code</b> <div class="spoiler_text">  Disabled on crutches. <br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off del /s C:\OpenHardwareMonitor\*.txt &gt;nul 2&gt;null call start /B /<span class="hljs-built_in"><span class="hljs-built_in">wait</span></span> C:\OpenHardwareMonitor\OpenHardwareMonitorReport.exe &gt;&gt; C:\OpenHardwareMonitor\OpenHardwareMonitorReport.txt find <span class="hljs-string"><span class="hljs-string">"CPU Package :"</span></span> C:\OpenHardwareMonitor\OpenHardwareMonitorReport.txt | find <span class="hljs-string"><span class="hljs-string">"temperature"</span></span> &gt;&gt;C:\OpenHardwareMonitor\Result.txt <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> /f <span class="hljs-string"><span class="hljs-string">"tokens=7 delims= "</span></span> %%i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (C:\OpenHardwareMonitor\Result.txt) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> %%i &gt;&gt; C:\OpenHardwareMonitor\temp.txt TYPE C:\OpenHardwareMonitor\temp.txt</code> </pre><br><br>  I appeal to the habra-community for help in transforming this horror into normal program code without crutches from text files. <br>  Nevertheless, the script copes with its task. <br></div></div><br>  <b>Updated:</b> New code from respected <a href="https://habrahabr.ru/users/cawaleb/" class="user_link">cawaleb</a> <br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> /F <span class="hljs-string"><span class="hljs-string">"usebackq tokens=7-10"</span></span> %%a <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (`C:\OpenHardwareMonitor\OpenHardwareMonitorReport.exe`) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> %%b %%c %%d| findstr .*lpc.*\/temperature\/0&gt;nul &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> temper=%%a <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> %temper%</code> </pre><br>  For intel processors, the version with find instead of findstr and a regular expression is also valid: <br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> /F <span class="hljs-string"><span class="hljs-string">"usebackq tokens=7-10"</span></span> %%a <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (`C:\OpenHardwareMonitor\OpenHardwareMonitorReport.exe`) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> %%b %%c %%d| find <span class="hljs-string"><span class="hljs-string">"/intelcpu/0/temperature/0"</span></span>&gt;nul &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> temper=%%a <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> %temper%</code> </pre><br></div></div><br><br>  The script returns the value as a decimal number. <br><br>  After this, change the config file and place all the files and scripts, restart the zabbix agent service. <br><br>  Start getting values ‚Äã‚Äãon the server: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dbf/5af/20d/dbf5af20d10d09c268d8b87967e0af2e.jpg" alt="Schedule"></div><br><br><h5>  Conclusion </h5><br>  Solved the problem of extracting the temperature of the CPU.  According to the same scheme, you can get the temperature of the GPU.  But there are still acute issues related to determining the speed of the fans, voltage at the power supply, as well as whether there is a way to check the state of the north and south bridges. <br><br>  <b>Update:</b> Added code for CPUTemperature.bat proposed by the distinguished <a href="https://habrahabr.ru/users/cawaleb/" class="user_link">Cawaleb</a> .  Do not forget to thank him for having responded to help! </div><p>Source: <a href="https://habr.com/ru/post/228095/">https://habr.com/ru/post/228095/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../228077/index.html">42 yoctonewton</a></li>
<li><a href="../228079/index.html">Function Pointer - forgotten implementation of the Singleton pattern</a></li>
<li><a href="../228083/index.html">LED controller for aircraft model</a></li>
<li><a href="../228085/index.html">How I screwed the speedometer to the tanks</a></li>
<li><a href="../228093/index.html">Beeline TV via Mikrotik in the province</a></li>
<li><a href="../228099/index.html">Inventing a bike or finding a missing ID value in a MySQL table</a></li>
<li><a href="../228101/index.html">Problems and prospects of ensuring the safety of civil aviation</a></li>
<li><a href="../228103/index.html">Web Application Firewall (ModSecurity) in action</a></li>
<li><a href="../228105/index.html">Upshifting for a programmer in Thailand</a></li>
<li><a href="../228107/index.html">EMC XtremIO and VDI. Effective, but still raw stuff</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>