<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Web service performance testing as part of Continuous Integration. Yandex experience</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Almost all new Yandex employees are amazed at the scale of the stress experienced by our products. Thousands of hosts with hundreds of thousands of re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Web service performance testing as part of Continuous Integration. Yandex experience</h1><div class="post__text post__text-html js-mediator-article"><p>  Almost all new Yandex employees are amazed at the scale of the stress experienced by our products.  Thousands of hosts with hundreds of thousands of requests per second.  And this is only one of the services.  In this case, we must respond to requests for a split second.  Even a slight change in the product can have a significant impact on performance, so it is important to test and evaluate the effect of your code on the service. </p><br><p>  In our service of advertising technologies, testing works within the framework of the Continuous Integration methodology, in more detail about the organization of which we will tell on October 25 at the <a href="https://events.yandex.ru/events/meetings/25-oct-2018/%3F_openstat%3Dzxzlbnrzozi1mtaxods7agficg%26utm_source%3Dhabr%26utm_campaign%3Dtesting151018">Yandex</a> event <a href="https://events.yandex.ru/events/meetings/25-oct-2018/%3F_openstat%3Dzxzlbnrzozi1mtaxods7agficg%26utm_source%3Dhabr%26utm_campaign%3Dtesting151018">from the inside</a> , and today we will share with Habr's readers experience in automating the assessment of important product metrics related to service performance.  You will learn how to trust the analysis machine, and not follow them on the charts.  Go! </p><br><img src="https://habrastorage.org/webt/iz/tt/0g/iztt0gctohbgmc0liwkarkwteye.jpeg"><br><p><a name="habracut"></a>  It does not go about how to test the site.  There are many online tools for this.  Today we will talk about a highly loaded internal backend service, which is part of a large system and prepares information for an external service.  In our case, for search results pages and partner sites.  If our component does not have time to respond, then the information from it will simply not be given to the user.  So, the company will lose money.  Therefore, it is very important to respond on time. </p><br><p>  What important server indicators can be distinguished? </p><br><ul><li>  <strong>Request per second (RPS)</strong> .  The happiness of one user is of course important to us.  But what if not one, but thousands of users have come to you?  How many requests per second can your server withstand and not fall? </li><li>  <strong>Time per request</strong> .  The site content should be rendered as quickly as possible so that the user does not get tired of waiting, and he does not go to the store for popcorn.  In our case, he will not see an important piece of information on the page. </li><li>  <strong>Resident set size (RSS)</strong> .  Be sure to monitor how much your program consumes memory.  If the service eats all the memory, you can hardly talk about fault tolerance. </li><li>  <strong>HTTP errors</strong> . </li></ul><br><p>  So let's go in order. </p><br><h3 id="request-per-second">  Request per second </h3><br><p>  Our developer, who has been working on load testing for a long time, likes to talk about a critical system resource.  Let's see what it is. </p><br><p>  Each system has its own configuration characteristics that define the work.  For example, queue length, response timeout, threads-worker pool, etc.  And so it may happen that the capacity of your service rests on some of these resources.  You can conduct an experiment.  Increase each resource in turn.  The resource, the increase of which will increase the capacity of your service, and will be critical for you.  In a well-configured system, in order to raise capacity, it is necessary to increase not one resource, but several.  But this still can be "grope."  It will be great if you can customize your system so that all resources work in full force, and the service fits into the timeframe assigned to it. </p><br><p>  To estimate how many requests your server can handle per second, you need to send a stream of requests to it.  Since we have this process built into the CI system, we use a very simple "gun", with limited functionality.  But from open source software, Yandex.Tank will be perfect for this task.  He has detailed <a href="https://tech.yandex.ru/tank/">documentation</a> .  As a gift to the tank there is a <a href="https://overload.yandex.net/">service</a> for viewing the results. </p><br><p>  <em>Small oftop.</em>  Yandex.Tank has rather rich functionality that is not limited to the automation of shelling by requests.  It will also help to collect the metrics of your service, build graphs and screw the module with the logic you need.  In general, we highly recommend to get to know him. </p><br><p>  Now you need to feed requests to the Tank in order to bombard our service with them.  Requests that you will attack the server can be of the same type, artificially created and multiplied.  However, measurements will be much more accurate if you can collect a real pool of requests from users for a certain period of time. </p><br><p>  Capacity can be measured in two ways. </p><br><p>  <strong>Open load model (stress testing)</strong> </p><br><p>  Make "users", that is, several threads that will send a request to your system.  We will give the load not constant, but to increase or even give it in waves.  Then it will bring us closer to real life.  We increase the RPS and catch the point at which the fired service ‚Äúpunches‚Äù the SLA.  Thus you can find the limits of the system. </p><br><p>  To calculate the number of users, you can use the Little formula (you can read about it <a href="https://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B0%25D0%25BA%25D0%25BE%25D0%25BD_%25D0%259B%25D0%25B8%25D1%2582%25D1%2582%25D0%25BB%25D0%25B0">here</a> ).  Omitting the theory, the formula looks like this: </p><br><p>  RPS = 1000 / T * workers, where </p><br><p>  ‚Ä¢ T is the average request processing time (in milliseconds); <br>  ‚Ä¢ workers - the number of threads; <br>  ‚Ä¢ 1000 / T requests per second - this value will produce a single-stream generator. </p><br><p>  <strong>Closed load model (load testing)</strong> </p><br><p>  We take a fixed number of "users".  You need to configure it so that the input queue corresponding to the configuration of your service is always clogged.  At the same time, it is pointless to make the number of threads more than the queue limit, since we will rest on this number, and the remaining requests will be discarded by the server with a 5xx error.  We look at how many requests per second the construction can issue.  Such a scheme is generally not similar to the real flow of requests, but it will help show the behavior of the system at maximum load and evaluate its throughput at the current moment. </p><br><p>  For the vast majority of systems (where the critical resource is not related to handling connections), the result will be the same.  At the same time, the closed model has less noise, because the system is always in the test area of ‚Äã‚Äãinterest to us. </p><br><p>  We are testing our service using a closed model.  After shooting, the gun gives us how many requests per second our service was able to issue.  Yandex.Tank this indicator is also easy to tell. </p><br><h3 id="time-per-request">  Time per request </h3><br><p>  If you go back to the previous item, it becomes obvious that with such a scheme, it does not make any sense to evaluate the response time to the request.  The more we load the system, the more it will degrade and the longer it will respond.  Therefore, for testing response time, the approach should be different. </p><br><p>  To get the average response time, we use the same Yandex.Tank.  Only now we will set the RPS corresponding to the average of your system in production.  After the shelling, we get the response times of each request.  According to the collected data, you can calculate the percentiles of the times of responses. </p><br><p>  Next you need to understand what percentile we consider important.  For example, we push off from production.  We can leave 1% of requests for errors, non-responses, debit requests that work for a long time, problems with the network, etc.  Therefore, we consider the response time to be meaningful, at which 99% of requests fit. </p><br><h3 id="resident-set-size">  Resident set size </h3><br><p>  Directly our server works with files through <a href="https://ru.wikipedia.org/wiki/Mmap">mmap</a> .  Measuring the RSS rate, we want to know how much memory the program took from the operating system during its operation. </p><br><p>  A file is written in Linux / proc / PID / smaps is an extension based on maps showing the memory consumption for each of the process mappings.  If your process uses tmpfs, then smaps will contain both anonymous and non-anonymous memory.  Non-anonymous memory includes, for example, files loaded into memory.  Here is an example of writing to smaps.  The specific file is specified, and its parameter Anonymous = 0kB. </p><br><pre><code class="hljs go"><span class="hljs-number"><span class="hljs-number">7f</span></span>ea65a60000<span class="hljs-number"><span class="hljs-number">-7f</span></span>ea65a61000 r--s <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">03</span></span> <span class="hljs-number"><span class="hljs-number">79169191</span></span> /place/home/.../some.yabs Size: <span class="hljs-number"><span class="hljs-number">4</span></span> kB Rss: <span class="hljs-number"><span class="hljs-number">4</span></span> kB Pss: <span class="hljs-number"><span class="hljs-number">4</span></span> kB Shared_Clean: <span class="hljs-number"><span class="hljs-number">0</span></span> kB Shared_Dirty: <span class="hljs-number"><span class="hljs-number">0</span></span> kB Private_Clean: <span class="hljs-number"><span class="hljs-number">4</span></span> kB Private_Dirty: <span class="hljs-number"><span class="hljs-number">0</span></span> kB Referenced: <span class="hljs-number"><span class="hljs-number">4</span></span> kB Anonymous: <span class="hljs-number"><span class="hljs-number">0</span></span> kB AnonHugePages: <span class="hljs-number"><span class="hljs-number">0</span></span> kB Swap: <span class="hljs-number"><span class="hljs-number">0</span></span> kB KernelPageSize: <span class="hljs-number"><span class="hljs-number">4</span></span> kB MMUPageSize: <span class="hljs-number"><span class="hljs-number">4</span></span> kB Locked: <span class="hljs-number"><span class="hljs-number">0</span></span> kB VmFlags: rd mr me ms</code> </pre> <br><p>  This is an example of anonymous memory allocation.  When a process (the same mmap) makes a request to the operating system to allocate a certain size of memory, an address is allocated to it.  While the process takes only virtual memory.  At this point, we still do not know which physical piece of memory will be allocated.  We see a nameless entry.  This is an example of allocating anonymous memory.  The system was requested to have a size of 24572 kB, but it was not used and in fact occupied only RSS = 4 kB. </p><br><pre> <code class="hljs go"><span class="hljs-number"><span class="hljs-number">7f</span></span>ea67264000<span class="hljs-number"><span class="hljs-number">-7f</span></span>ea68a63000 rw-p <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> Size: <span class="hljs-number"><span class="hljs-number">24572</span></span> kB Rss: <span class="hljs-number"><span class="hljs-number">4</span></span> kB Pss: <span class="hljs-number"><span class="hljs-number">4</span></span> kB Shared_Clean: <span class="hljs-number"><span class="hljs-number">0</span></span> kB Shared_Dirty: <span class="hljs-number"><span class="hljs-number">0</span></span> kB Private_Clean: <span class="hljs-number"><span class="hljs-number">0</span></span> kB Private_Dirty: <span class="hljs-number"><span class="hljs-number">4</span></span> kB Referenced: <span class="hljs-number"><span class="hljs-number">4</span></span> kB Anonymous: <span class="hljs-number"><span class="hljs-number">4</span></span> kB AnonHugePages: <span class="hljs-number"><span class="hljs-number">0</span></span> kB Swap: <span class="hljs-number"><span class="hljs-number">0</span></span> kB KernelPageSize: <span class="hljs-number"><span class="hljs-number">4</span></span> kB MMUPageSize: <span class="hljs-number"><span class="hljs-number">4</span></span> kB Locked: <span class="hljs-number"><span class="hljs-number">0</span></span> kB VmFlags: rd wr mr mw me ac</code> </pre> <br><p>  Since the allocated non-anonymous memory is not going anywhere after stopping the process, the file will not be deleted, we are not interested in such RSS. </p><br><p>  Before you start shooting on the server, we summarize the RSS from / proc / PID / smaps, allocated for anonymous memory, and memorize it.  We conduct shelling, similar to testing time in request.  After the end we consider RSS again.  The difference between the initial and final state will be the amount of memory that your process used during its work. </p><br><h3 id="http-oshibki">  HTTP errors </h3><br><p>  Do not forget to follow the response codes that the service returns during testing.  If something went wrong in the setup of the test or the environment, and the server returned 5xx and 4x errors to all requests, then there was not much sense in such a test.  We follow the share of bad answers.  If there are many errors, then the test is considered invalid. </p><br><h3 id="nemnogo-o-tochnosti-izmereniy">  A bit about measurement accuracy </h3><br><p>  And now the most important thing.  Let's go back to the previous paragraphs.  The absolute values ‚Äã‚Äãof the metrics we calculated, it turns out, are not so important to us.  No, of course, you can achieve stability indicators, taking into account all the factors, errors and fluctuations.  In parallel, write a scientific paper on this topic (by the way, if someone was looking for one, this could be a good option).  But this is not what interests us. </p><br><p>  The impact of a particular commit on the code relative to the previous state of the system is important for us.  That is, the difference in metrics from commit to commit is important.  And here it is necessary to set up a process that will compare this difference and at the same time ensure the stability of the absolute value at this interval. </p><br><p>  Environment, requests, data, service status - all factors available to us should be recorded.  This system also works for us in the framework of Continuous integration, providing us with information about all kinds of changes that have occurred within the framework of each commit.  Despite this, it will not be possible to fix everything, there will be noise.  We can reduce the noise, obviously, by increasing the sample, that is, we can perform several iterations of shooting.  Further, after the shooting, say, 15 iterations, we can calculate the median of the resulting sample.  In addition, it is necessary to find a balance between the noise and the duration of the shooting.  We, for example, stopped at an error of 1%.  If you want to choose a more complex and accurate statistical method in accordance with your requirements, we recommend the <a href="https://www.amazon.com/100-Statistical-Tests-Gopal-Kanji/dp/141292376X">book</a> , which lists the options with a description of when and what applies. </p><br><h3 id="chto-eschyo-mozhno-sdelat-s-shumom">  What else can be done with noise? </h3><br><p>  Note that an important role in such testing is the environment in which you conduct tests.  The test bench should be reliable, other programs should not be running on it, since they can lead to degradation of your service.  In addition, the results can and will depend on the profile of the load, the environment, the database and on various ‚Äúmagnetic storms‚Äù. </p><br><p>  In the framework of one commit test, we perform several iterations on different hosts.  First, if you use the cloud, anything can happen there.  Even if the cloud is specialized, like ours, service processes still work there.  Therefore, it is impossible to rely on the result from a single host.  And if you have an iron host, where there is not, as in the cloud, the standard mechanism for raising the environment, then you can break it all at once and leave it at random.  And he will lie to you always.  Therefore, we are chasing our tests in the cloud. </p><br><p>  From this, however, arises another question.  If your measurements are made every time on different hosts, then the results may make some noise because of this as well.  Then you can normalize the readings to the host.  That is, according to historical data, collect the ‚Äúhost coefficient‚Äù and take it into account when analyzing the results. </p><br><p>  An analysis of historical data shows that our hardware is different.  The word "iron" here includes the kernel version and the consequences of uptime (apparently, non-relocatable kernel objects in memory). </p><br><p>  Thus, for each "host" (when the host reboots, it "dies" and a "new" appears) we assign an amendment by which we multiply the RPS before the aggregation. </p><br><p>  The amendments consider and update in an extremely clumsy way, suspiciously resembling some version of reinforcement training. </p><br><p>  For a given vector of host corrections, we consider the objective function: </p><br><ul><li>  in each test, we consider the standard deviation of the ‚Äúcorrected‚Äù RPS results obtained </li><li>  we take from them the average with weights equal <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy=&quot;false&quot;>(</mo><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>m</mi><mi>p</mi><mo>&amp;#x2212;</mo><mi>n</mi><mi>o</mi><mi>w</mi><mo stretchy=&quot;false&quot;>)</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mi>t</mi><mi>a</mi><mi>u</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="33.778ex" height="2.66ex" viewBox="0 -832 14543.4 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-65" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-78" x="466" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-70" x="1039" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMAIN-28" x="1542" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMAIN-28" x="1932" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-74" x="2321" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-65" x="2683" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-73" x="3149" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-74" x="3619" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-74" x="3980" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-69" x="4342" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-6D" x="4687" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-65" x="5566" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-73" x="6032" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-74" x="6502" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-61" x="6863" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-6D" x="7393" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-70" x="8271" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMAIN-2212" x="8997" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-6E" x="9997" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-6F" x="10598" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-77" x="11083" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMAIN-29" x="11800" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMAIN-2F" x="12189" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-74" x="12690" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-61" x="13051" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMATHI-75" x="13581" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/425867/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhNr9BermWGqCuAJ_Ny6grHZXqhcQ#MJMAIN-29" x="14153" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>m</mi><mi>p</mi><mo>‚àí</mo><mi>n</mi><mi>o</mi><mi>w</mi><mo stretchy="false">)</mo><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mi>t</mi><mi>a</mi><mi>u</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-1"> exp ((testtimestamp - now) / tau) </script>  , </li><li>  we have tau = 1 week. </li></ul><br><p>  Further, one amendment (for the host, for which the sum of these weights is the greatest) is fixed at 1.0 and we are looking for the values ‚Äã‚Äãof all other corrections that give the minimum of the objective function. </p><br><p>  In order to validate the results on historical data, we consider the corrections on the old data, we consider the corrected result on the fresh ones, compared with the uncorrected. </p><br><p>  Another option for adjusting the results and reducing noise is normalization to "synthetics".  Before launching a trustable service, run a ‚Äúsynthetic program‚Äù on the host, from which you can evaluate the state of the host and calculate the correction factor.  But in our case, we use the amendments on the hosts, but this idea remained the idea.  Perhaps some of you will like it. </p><br><p>  Despite the automation and all its advantages, do not forget about the dynamics of your indicators.  It is important to ensure that the service does not degrade over time.  Small drawdowns can be overlooked, they can accumulate, and over a large time period your indicators can subside.  Here is an example of our graphs for which we look at the RPS.  It shows the relative value on each checked commit, its number and the opportunity to see where the release was allotted. </p><br><img src="https://habrastorage.org/webt/qu/lj/_h/qulj_hvry8sfubkrt285xlzidsq.png"><br><img src="https://habrastorage.org/webt/gp/76/o9/gp76o9rgelvep5u8rrpyoricmfs.png"><br><p>  If you have read the article, it means you‚Äôll be interested to <a href="https://www.youtube.com/watch%3Fv%3Dgws7L3EaeC0">see the</a> report on Yandex.Tank and the analysis of load testing results. </p><br><p>  We also remind that in more detail about the organization of Continuous Integration we will tell on October 25 at the <a href="https://events.yandex.ru/events/meetings/25-oct-2018/%3F_openstat%3Dzxzlbnrzozi1mtaxods7agficg%26utm_source%3Dhabr%26utm_campaign%3Dtesting151018">Yandex</a> event <a href="https://events.yandex.ru/events/meetings/25-oct-2018/%3F_openstat%3Dzxzlbnrzozi1mtaxods7agficg%26utm_source%3Dhabr%26utm_campaign%3Dtesting151018">from the inside</a> .  Come to visit! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/425867/">https://habr.com/ru/post/425867/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../425853/index.html">All conversational AI at the first Conversations conference</a></li>
<li><a href="../425855/index.html">Twitch made me better and helped me survive for the three darkest months in my life</a></li>
<li><a href="../425859/index.html">Regional operators oppose the abolition of roaming</a></li>
<li><a href="../425861/index.html">Check yourself: can you protect the company from cyber attacks?</a></li>
<li><a href="../425863/index.html">Analysis of the quality of educational materials, or as we did not work</a></li>
<li><a href="../425869/index.html">iFixit: Apple has not yet activated blocking of repaired MacBooks</a></li>
<li><a href="../425871/index.html">Ekaterinburg, October 11 - Atlassian meets docker</a></li>
<li><a href="../425873/index.html">[CppCon 2018] Herb Sutter: Towards a simpler and more powerful C ++</a></li>
<li><a href="../425875/index.html">Upgrade the matrix of the TN-> IPS laptop or how to get more advanced from a budget laptop</a></li>
<li><a href="../425877/index.html">The head of Apple said that Chinese spy chips in servers Supermicro - fiction</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>