<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÄúUse the Power of Machine Learning, Luke!‚Äù Or automatic classification of luminaires according to the CIL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúThe power of machine learning among us, its methods surround us and bind. The power around me, everywhere, between me, you, the decisive tree, the la...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>‚ÄúUse the Power of Machine Learning, Luke!‚Äù Or automatic classification of luminaires according to the CIL</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <i>‚ÄúThe power of machine learning among us, its methods surround us and bind.</i>  <i>The power around me, everywhere, between me, you, the decisive tree, the lasso, the crest and the support vector "</i> </blockquote>  So, probably, Yoda would tell me if he taught me the ways of Data Science. <br><br>  Unfortunately, so far among my acquaintances, green-skinned wrinkled personalities are not observed, so we simply continue along with you <b>our joint way of</b> teaching data science from the <b>absolute novice</b> level to ... a <s>real Jedi of</s> what we end up with. <br><br>  In the last two articles, we solved the problem of classifying light sources according to their spectrum (in <a href="https://habrahabr.ru/post/337040/">Python</a> and <a href="https://habrahabr.ru/post/337438/">C #,</a> respectively).  This time we will try to solve the problem of classifying luminaires according to their light intensity curve (according to the spot they shine on the floor). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If you have already comprehended the path of power, you can immediately download the dataset on <a href="https://github.com/bosonbeard/ML_light_sources_classification/tree/master/2nd_class_of_lum_by_LIDC">Github</a> and play around with this task yourself.  But everyone, as I am newbies ask tackle. <br><br>  Fortunately, the task at this time is quite simple and does not take much time. <br><img src="https://habrastorage.org/web/07a/1ea/4f1/07a1ea4f16284806b638ce9c075c7dbd.png"><br><a name="habracut"></a><br><br>  <i>I really wanted to start the table of contents sections of the article from the fourth episode, but its name did not fit the meaning.</i> <br><br><h3>  Episode <a name="I"></a>  I: A hidden threat or what threatens you if you have not read the entire previous cycle of articles. </h3><br>  Well, in principle, nothing threatens, but if you are completely new to Data Science, I advise you to still look at the first articles in the correct chronological order, because this is in some way a valuable experience of looking at Data Science through the eyes of a beginner, if I had to describe my path now, then I would not be able to recall those sensations and some of the problems would have seemed to me quite funny.  Therefore, if you have just started, look at how I suffered (and still suffer) mastering the very basics and you will understand that you are not so alone and all your problems in mastering machine learning and data analysis are completely solvable. <br><br>  So, here is a list of articles in order of appearance (from first to last) <br><br><ul><li>  ‚Äú <a href="https://habrahabr.ru/post/331118/">Catch data big and small!</a>  "- (Overview of Cognitive Class Data Science Courses) </li><li>  " <a href="https://habrahabr.ru/post/331794/">Now he counted you</a> " or Data Science from Scratch </li><li>  ‚Äú <a href="https://habrahabr.ru/post/331992/">Iceberg instead of Oscar!</a>  "Or as I tried to learn the basics of DataScience on kaggle </li><li>  ‚Äú <a href="https://habrahabr.ru/post/335214/">‚Äú A train that could! ‚ÄùOr‚Äú Specialization Machine learning and data analysis ‚Äù, through the eyes of a newbie in Data Science</a> </li><li>  <a href="https://habrahabr.ru/post/337040">‚ÄúRise of Machinery Learning‚Äù or combine a hobby in Data Science and analyzing the spectra of light bulbs</a> </li><li>  ‚Äú <a href="https://habrahabr.ru/post/337438/">‚Äú As per the notes! ‚ÄùOr Machine Learning (Data science) in C # using Accord .NET Framework</a> </li></ul><br>  Also, at the request of the workers in particular, the user <a href="https://habrahabr.ru/users/gadpetrovich/" class="user_link">GadPetrovich</a> starting with this article will make a table of contents for the material. <br><br>  Content: <br>  <a href="https://habr.com/ru/post/338124/">Episode I: The hidden threat or what threatens you if you have not yet read the entire previous series of articles.</a> <br>  <a href="https://habr.com/ru/post/338124/">Episode II: Attack of the Clones or it seems that this task is not much different from the previous one.</a> <br>  <a href="https://habr.com/ru/post/338124/">Episode III: Revenge of the Sith or a little about the difficulties of data mining</a> <br>  <a href="https://habr.com/ru/post/338124/">Episode IV: A New Hope that Everything Is Easily Classified</a> <br>  <a href="https://habr.com/ru/post/338124/">Episode V: The Empire Strikes Back or is Difficult in Preparing Data Easily in a ‚ÄúBattle‚Äù</a> <br>  <a href="https://habr.com/ru/post/338124/">Episode VI: Return of the Jedi or feel the power of models that were written in advance for you!</a> <br>  <a href="https://habr.com/ru/post/338124/">Episode VII: The Force Awakens - Instead of Conclusion</a> <br><br><h3>  Episode <a name="II"></a>  II: Attack of the clones or it seems that this task is not much different from the past. </h3><br>  <i>Hmm, just the second title, and I already think that it will be hard to continue to adhere to the style.</i> <br><br>  So, let me remind you that <a href="https://habrahabr.ru/post/337040/">last time</a> you and I considered the following issues: creating your own data set for machine learning tasks, training models of classifiers of these data using the example of logistic regression and random forest, as well as visualization and classification using PCA, T-SNE and DBSCAN. <br>  This time the task will not be radically different, though the signs will be smaller. <br><br>  Looking a little ahead, I‚Äôll say that in order for the task not to look altogether a clone of the past, this time in the example we will meet the SVC classifier, and also we will clearly see that scaling the source data can be very useful. <br><br><h3>  Episode <a name="III"></a>  III: Revenge of the Sith or a little about the difficulties of data mining. </h3><br>  Let's start with what is the light intensity curve (CIL)? <br>  Well, it's about this: <br><img src="https://habrastorage.org/web/f27/8a9/142/f278a91429cd4a17a9e93fa5800003fb.jpg"><br><br>  What would have been a little clearer imagine that you have a lamp above your head and just such a cone of light falls under your feet if you stand under it (as in a spot of light from a street lamp). <br>  This picture shows the light intensity (values ‚Äã‚Äãon the circles) in different polar angles (imagine that this is a longitudinal section of the incandescent lamp), in the gap of two azimuth angles 0-180 and 90 - 270 (imagine that this is a cross section of the incandescent lamp).  Maybe I didn‚Äôt really, accurately explained, For details on Julian Borisovich Eisenberg in the Lighting Guide p. <a href="http://padaread.com/%3Fbook%3D34001%26pg%3D333">833 and on</a> <br><br>  But back to the original data, do not consider it an advertisement, but all the fixtures that we will classify today will be from one manufacturer, namely, Light Technologies firms.  I am not connected with them in any way and my pockets will not be filled with ‚Äúhard cash‚Äù from their mention <br><br>  Then why are they?  It's very simple, the guys have taken care that we were comfortable. <br>  The necessary pictures from the KCC and .ies files for pulling out the data already collected by them in the corresponding archives could only be <a href="https://www.ltcompany.com/ru/knowledge/libraries/">downloaded</a> , agree that it is much more convenient than to scour the entire network collecting data by grains. <br><br>  Perhaps an attentive reader, already waiting with impatience to ask where is all this, and why is the section called Sith revenge?  <b>Where is the cruel revenge ?!</b> <br><br>  Well, apparently the revenge of the poems was that for many years I did anything other than math, programming, lighting and machine learning, and now I pay for it with nerve cells. <br><br>  Let's start a little from afar ... <br><br>  This is what a simple .ies file looks like. <br><br> <code>IESNA:LM-63-1995 <br> [TEST] SL20695 <br> [MANUFAC] PHILIPS <br> [LUMCAT] <br> [LUMINAIRE] NA <br> [LAMP] 3 Step Switch A60 220-240V9.5W-60W 806lm 150D 3000K-6500K Non Dim <br> [BALLAST] NA <br> [OTHER] B-Angle = 0.00 B-Tilt = 0.00 2015-12-07 <br> TILT=NONE <br> 1 806.00 1 181 1 1 2 -0.060 -0.060 0.120 <br> 1.0 1.0 9.50 <br> 0.00 1.00 2.00 3.00 4.00 5.00 6.00 7.00 8.00 9.00 <br> 10.00 11.00 12.00 13.00 14.00 15.00 16.00 17.00 18.00 19.00 <br> 20.00 21.00 22.00 23.00 24.00 25.00 26.00 27.00 28.00 29.00 <br> 30.00 31.00 32.00 33.00 34.00 35.00 36.00 37.00 38.00 39.00 <br> 40.00 41.00 42.00 43.00 44.00 45.00 46.00 47.00 48.00 49.00 <br> 50.00 51.00 52.00 53.00 54.00 55.00 56.00 57.00 58.00 59.00 <br> 60.00 61.00 62.00 63.00 64.00 65.00 66.00 67.00 68.00 69.00 <br> 70.00 71.00 72.00 73.00 74.00 75.00 76.00 77.00 78.00 79.00 <br> 80.00 81.00 82.00 83.00 84.00 85.00 86.00 87.00 88.00 89.00 <br> 90.00 91.00 92.00 93.00 94.00 95.00 96.00 97.00 98.00 99.00 <br> 100.00 101.00 102.00 103.00 104.00 105.00 106.00 107.00 108.00 109.00 <br> 110.00 111.00 112.00 113.00 114.00 115.00 116.00 117.00 118.00 119.00 <br> 120.00 121.00 122.00 123.00 124.00 125.00 126.00 127.00 128.00 129.00 <br> 130.00 131.00 132.00 133.00 134.00 135.00 136.00 137.00 138.00 139.00 <br> 140.00 141.00 142.00 143.00 144.00 145.00 146.00 147.00 148.00 149.00 <br> 150.00 151.00 152.00 153.00 154.00 155.00 156.00 157.00 158.00 159.00 <br> 160.00 161.00 162.00 163.00 164.00 165.00 166.00 167.00 168.00 169.00 <br> 170.00 171.00 172.00 173.00 174.00 175.00 176.00 177.00 178.00 179.00 <br> 180.00 <br> 0.00 <br> 137.49 137.43 137.41 137.32 137.23 137.10 136.97 <br> 136.77 136.54 136.27 136.01 135.70 135.37 135.01 <br> 134.64 134.27 133.85 133.37 132.93 132.42 131.93 <br> 131.41 130.87 130.27 129.68 129.08 128.44 127.78 <br> 127.11 126.40 125.69 124.92 124.18 123.43 122.63 <br> 121.78 120.89 120.03 119.20 118.26 117.34 116.40 <br> 115.46 114.49 113.53 112.56 111.52 110.46 109.42 <br> 108.40 107.29 106.23 105.13 104.03 102.91 101.78 <br> 100.64 99.49 98.35 97.15 95.98 94.80 93.65 <br> 92.43 91.23 89.99 88.79 87.61 86.42 85.17 <br> 83.96 82.76 81.49 80.31 79.13 77.91 76.66 <br> 75.46 74.29 73.07 71.87 70.67 69.49 68.33 <br> 67.22 66.00 64.89 63.76 62.61 61.46 60.36 <br> 59.33 58.19 57.11 56.04 54.98 53.92 52.90 <br> 51.84 50.83 49.82 48.81 47.89 46.88 45.92 <br> 44.99 44.03 43.11 42.18 41.28 40.39 39.51 <br> 38.62 37.74 36.93 36.09 35.25 34.39 33.58 <br> 32.79 32.03 31.25 30.46 29.70 28.95 28.23 <br> 27.48 26.79 26.11 25.36 24.71 24.06 23.40 <br> 22.73 22.08 21.43 20.84 20.26 19.65 19.04 <br> 18.45 17.90 17.34 16.83 16.32 15.78 15.28 <br> 14.73 14.25 13.71 13.12 12.56 11.94 11.72 <br> 11.19 10.51 9.77 8.66 6.96 4.13 0.91 <br> 0.20 0.17 0.16 0.19 0.19 0.20 0.16 <br> 0.20 0.18 0.20 0.20 0.21 0.20 0.16 <br> 0.20 0.17 0.19 0.20 0.19 0.18</code> <br> <br>  Inside, data on the manufacturer and the laboratory of the meter are protected, as well as data on the luminaire directly, including the luminous intensity depending on the polar and azimuth angles, the data about which we need. <br><br>  In total, I selected 193 files for you, and it is unlikely that I would even try to process them manually. <br><br>  On the one hand, everything is just a <a href="http://docs.cntd.ru/document/1200107495">GOST</a> in which the structure of the .ies file is described in detail. On the other hand, it became more difficult to automatically recognize and remove the necessary data than I thought, it cost me a couple of disturbing and sleepless nights. <br>  But for you, as in the best traditions of the cinema, all the complex and tedious things will remain "behind the scenes."  Therefore, we proceed to the direct description of the data. <br><br><h3>  Episode <a name="IV"></a>  IV: A new hope ... that everything is classified easily and simply. </h3><br>  So, having penetrated into the key issues with the help of the literature to which I referred above, we will come to the conclusion that in order to classify the lamps in our teaching and demonstration example, we have enough of a complete cut of data for any one azimuth angle in this case equal to zero and in the range of polar angles from 0 to 180, with a step of 10 (a step less does not make sense to take on quality, this will not affect much). <br>  That is, in our case, the data will not look like on the graph on the left, but as on the graph on the right. <br><img src="https://habrastorage.org/web/53f/0da/f67/53f0daf6764a46478d8eb823c4a0b67d.jpg"><br><br>  <i>By the way, if anyone did not know, then using the radar chart in MS Excel, you can conveniently construct KCC charts.</i> <br><br>  Since in the archive of Light Technologies, lamps with different KCCs are unevenly distributed, we will analyze with you 4 types that are most in the original data set. <br><br>  So, we have the following KCC: <br>  Concentrated (K), deep (G), cosine (D) and semi-wide (L). <br>  Their zones of directions of maximum luminous intensity are in the following corners, respectively: <br>  K = 0 ¬∞ -15 ¬∞;  G = 0 ¬∞ -30 ¬∞;  D = 0 ¬∞ -35 ¬∞;  L = 35 ¬∞ -55 ¬∞; <br>  Labels for them in the data set are assigned to <br>  K 1;  G = 2;  D = 3;  L = 4;  (I had to start from scratch, but now I‚Äôm too lazy to redo it) <br><br>  In fact, not being an expert in the field of lighting, it is difficult to classify lamps, for example, I would attribute the lamp in the figure above to a lamp from a deep CIL, but I am not 100% sure. <br><br>  <i>In principle, I tried to avoid controversial issues, look at GOST and examples, but I could well <b>be mistaken</b> somewhere, if you find inaccuracies in the assignment of class labels, write, correct as much as possible</i> <br><br><h3>  Episode <a name="V"></a>  V: The Empire Strikes Back or is Difficult in Preparing Data Easily in a ‚ÄúBattle‚Äù </h3><br>  Well, it seems that two people can play this game. If it was difficult to prepare the data, then it is just the opposite to analyze.  Let's start slowly. <br>  Once again I remind you that the file with all the source code below in .ipynb format (Jupyter) can be downloaded from <a href="https://github.com/bosonbeard/ML_light_sources_classification/tree/master/2nd_class_of_lum_by_LIDC">GitHub</a> <br><br>  So, to start importing libraries: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#import libraries import warnings warnings.filterwarnings('ignore') import pandas as pd import numpy as np import matplotlib.pyplot as plt import matplotlib.patches as mpatches from sklearn.model_selection import train_test_split from sklearn . svm import SVC from sklearn.metrics import f1_score from sklearn.ensemble import RandomForestClassifier from scipy.stats import uniform as sp_rand from sklearn.model_selection import StratifiedKFold from sklearn.preprocessing import MinMaxScaler from sklearn.manifold import TSNE from IPython.display import display from sklearn.metrics import accuracy_score from sklearn.model_selection import train_test_split %matplotlib inline    &lt;source lang="python"&gt; #reading data train_df=pd.read_csv('lidc_data\\train.csv',sep='\t',index_col=None) test_df=pd.read_csv('lidc_data\\test.csv',sep='\t',index_col=None) print('train shape {0}, test shape {1}]'. format(train_df.shape, test_df.shape)) display('train:',train_df.head(4),'test:',test_df.head(4)) #divide the data and labels X_train=np.array(train_df.iloc[:,1:-1]) X_test=np.array(test_df.iloc[:,1:-1]) y_train=np.array(train_df['label']) y_test=np.array(test_df['label'])</span></span></code> </pre><br>  If you have read previous articles or are familiar with machine learning in python, then all the code presented here will not be difficult for you. <br>  But just in case, at the beginning we considered the data on training and test samples in the tables, and then we cut out arrays containing signs (luminous intensity in polar angles) and class marks, and of course, for clarity, we printed the first 4 lines from the table , that's what happened: <br><br><img src="https://habrastorage.org/web/03c/729/3d5/03c7293d57d94f36b12e93be6d3018b6.jpg"><br><br>  You can take my word for it, the data is less balanced with the exception of class 4 (curve L) and, in general, for the first three classes, we have a ratio of 40 samples in the training sample and 12 in the control, for class L - 28 in the training and 9 in the control as a whole, the ratio close to ¬º between the training and the control sample is preserved. <br>  Well, if you are accustomed to not believing anyone, then run the code: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#draw classdistributions test_n_max=test_df.label.value_counts().max() train_n_max=train_df.label.value_counts().max() fig, axes = plt.subplots(nrows=1, ncols=2, figsize=(12,5)) train_df.label.plot.hist(ax=axes[0],title='train data class distribution', bins=7,yticks=np.arange(0,train_n_max+2,2), xticks=np.unique(train_df.label.values)) test_df.label.plot.hist(ax=axes[1],ti</span></span></code> </pre><br>  And you will see the following: <br><br><img src="https://habrastorage.org/web/45b/402/fd1/45b402fd19b6496287deb6ebba72d551.jpg"><br><br>  Let's go back to our signs, as you understand, on the one hand, they all reflect one and the same value, that is, roughly speaking, we do not correlate the number of bicycles and atmospheric pressure, on the other hand, unlike <a href="https://habrahabr.ru/post/337040">last time</a> , when we had about one sign level of values, this time the amplitude of values ‚Äã‚Äãcan reach tens of thousands of units. <br><br>  Therefore, it is reasonable to scale the signs.  However, all scikit-learn scaling models seem to be scaled by columns (or I didn't figure it out), and it makes no sense for us to scale by columns in this case, it does not equal the ‚Äúrich‚Äù and ‚Äúpoor‚Äù lamps, which will lead to <s>class</s> classification tension, so to speak. ! <br><br>  We will instead scale the data by samples (by rows) in order to preserve the character of the distribution of the light intensity over the corners, but at the same time drive the entire spread into the range between 0 and 1. <br><br>  In a good way, in the books that I read, they give advice on scaling the training sample and the control one model (trained in the training sample), but in our case, this will not happen because of a mismatch in the number of features (in the test sample there are fewer rows and the transposed matrix will have fewer columns), so we equalize each sample in its own way. <br><br>  <i>Looking ahead to this task, in the process of classification, I did not find anything wrong with that.</i> <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#scaled all data for final prediction scl=MinMaxScaler() X_train_scl=scl.fit_transform(X_train.T).T X_test_scl=scl.fit_transform(X_test.T).T #scaled part of data for test X_train_part, X_test_part, y_train_part, y_test_part = train_test_split(X_train, y_train, test_size=0.20, stratify=y_train, random_state=42) scl=MinMaxScaler() X_train_part_scl=scl.fit_transform(X_train_part.T).T X_test_part_scl=scl.fit_transform(X_test_part.T).T</span></span></code> </pre><br>  Even if you are completely new, during the article you will notice that all models from the scikit-learn set have a similar interface, we train the model by passing the data to the fit method, if we need to transform the data, we call the transform method (in our case we use the 2 in 1), and if it is necessary to predict the data later, we call the method predict and feed it our new (control) samples. <br><br>  Well, one more small moment, let's imagine that we have no labels for the control sample, for example, we solve the problem on the kagle, how can we then assess the quality of the prediction model? <br><br>  I think for our case, where the solution of business problems is not required, one of the easiest ways would be to divide the training sample into another training (but smaller) and test (from the training), this will come in handy for us a little later.  In the meantime, let's go back to scaling and see how it helped us, the upper picture without scaling features, the bottom one with scaling. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#not scaled x=np.arange(0,190,10) plt.figure(figsize=(17,10)) plt.plot(x,X_train[13]) plt.plot(x,X_train[109]) plt.plot(x,X_train[68]) plt.plot(x,X_train[127]) c1 = mpatches.Patch( color='blue', label='class 1') c2 = mpatches.Patch( color='green', label='class 2') c3 = mpatches.Patch(color='orange', label='class 3') c4 = mpatches.Patch( color='red',label='class 4') plt.legend(handles=[c1,c2,c3,c4]) plt.xlabel('  (polar angle)') plt.ylabel('  (luminous intensity)') plt.title('   ')</span></span></code> </pre><br>  ‚ÄúScore‚Äù it in different cells (well, or make a subplot) <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#scaled x=np.arange(0,190,10) plt.figure(figsize=(17,10)) plt.legend() plt.plot(x,X_train_scl[13],color='blue') plt.plot(x,X_train_scl[109],color='green') plt.plot(x,X_train_scl[68], color='orange') plt.plot(x,X_train_scl[127], color='red') c1 = mpatches.Patch( color='blue', label='class 1') c2 = mpatches.Patch( color='green', label='class 2') c3 = mpatches.Patch(color='orange', label='class 3') c4 = mpatches.Patch( color='red',label='class 4') plt.legend(handles=[c1,c2,c3,c4]) plt.xlabel('  (polar angle)') plt.ylabel('  (luminous intensity)') plt.title('    ()')</span></span></code> </pre><br><img src="https://habrastorage.org/web/322/0e3/a59/3220e3a592854af7b151b2d30b010268.jpg"><br><br>  The graphs show one sample from each class, and as we can see, it will be easier for us and the computer to understand something on the scaled graphics, because on the top some graphs simply merge with zero due to the difference in scale. <br><br>  In order to finally make sure that we are right, let's try to reduce the dimension of the signs to two-dimensional, to display our data on two-dimensional graphs and see how much our data is separable (we will use t-SNE for this) <br>  Left unscaled with scaling right <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#T-SNE colors = ["#190aff", "#0fff0f", "#ff641e" , "#ff3232"] tsne = TSNE(random_state=42) d_tsne = tsne.fit_transform(X_train) plt.figure(figsize=(10, 10)) plt.xlim(d_tsne[:, 0].min(), d_tsne[:, 0].max() + 10) plt.ylim(d_tsne[:, 1].min(), d_tsne[:, 1].max() + 10) for i in range(len(X_train)): #  ,       plt.text(d_tsne[i, 0], d_tsne[i, 1], str(y_train[i]), color = colors[y_train[i]-1], fontdict={'weight': 'bold', 'size': 10}) plt.xlabel("t-SNE feature 0") plt.ylabel("t-SNE feature 1")</span></span></code> </pre><br>  ‚ÄúScore‚Äù it in different cells (well, or make a subplot) <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#T-SNE for scaled data d_tsne = tsne.fit_transform(X_train_scl) plt.figure(figsize=(10, 10)) plt.xlim(d_tsne[:, 0].min(), d_tsne[:, 0].max() + 10) plt.ylim(d_tsne[:, 1].min(), d_tsne[:, 1].max() + 10) for i in range(len(X_train_scl)): #  ,       plt.text(d_tsne[i, 0], d_tsne[i, 1], str(y_train[i]), color = colors[y_train[i]-1], fontdict={'weight': 'bold', 'size': 10}) plt.xlabel("t-SNE feature 0") plt.ylabel("t-SNE feature 1")</span></span></code> </pre><br>  <i>Subtract one, because I started counting tags not from scratch.</i> <br><br><img src="https://habrastorage.org/web/dfa/7b4/fc1/dfa7b4fc1d8b410fbc98385238862e31.jpg"><br><br>  The figures show that on the scaled data, classes 1, 3, 4 are less well distinguished, and class 2 is spread between classes 1 and 3 (if you download and see KCC fixtures, you will understand that it should be so) <br><br><h3>  Episode <a name="VI"></a>  VI: Return of the Jedi, or feel the power of models pre-written by someone for you! </h3><br>  Well, it's time to proceed to the direct classification. <br>  First, let's teach SVC on our ‚Äútruncated data‚Äù <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#predict part of full data (test labels the part of X_train) #not scaled svm = SVC(kernel= 'rbf', random_state=42 , gamma=2, C=1.1) svm.fit (X_train_part, y_train_part) pred=svm.predict(X_test_part) print("\n not scaled: \n results (pred, real): \n",list(zip(pred,y_test_part))) print('not scaled: accuracy = {}, f1-score= {}'.format( accuracy_score(y_test_part,pred), f1_score(y_test_part,pred, average='macro'))) #scaled svm = SVC(kernel= 'rbf', random_state=42 , gamma=2, C=1.1) svm.fit (X_train_part_scl, y_train_part) pred=svm.predict(X_test_part_scl) print("\n scaled: \n results (pred, real): \n",list(zip(pred,y_test_part))) print('scaled: accuracy = {}, f1-score= {}'.format( accuracy_score(y_test_part,pred), f1_score(y_test_part,pred, average='macro')))</span></span></code> </pre><br>  We get the following conclusion <br><br>  Not scaled <br> <code>not scaled: <br> results (pred, real): <br> [(2, 3), (2, 3), (2, 2), (3, 3), (2, 1), (2, 3), (2, 3), (2, 2), (2, 1), (2, 2), (1, 1), (3, 3), (2, 2), (2, 1), (2, 4), (3, 3), (2, 2), (2, 4), (2, 1), (2, 2), (4, 4), (2, 2), (4, 4), (2, 4), (2, 3), (2, 1), (2, 1), (2, 1), (2, 2)] <br> not scaled: accuracy = 0.4827586206896552, f1-score= 0.46380859284085096</code> <br> <br>  Scaled <br> <code>scaled: <br> results (pred, real): <br> [(3, 3), (3, 3), (2, 2), (3, 3), (1, 1), (3, 3), (3, 3), (2, 2), (1, 1), (2, 2), (1, 1), (3, 3), (2, 2), (1, 1), (4, 4), (3, 3), (2, 2), (4, 4), (1, 1), (2, 2), (4, 4), (2, 2), (4, 4), (4, 4), (3, 3), (1, 1), (1, 1), (1, 1), (2, 2)] <br> scaled: accuracy = 1.0, f1-score= 1.0</code> <br> <br>  As you can see, the difference is more than significant, if in the first case we managed to achieve <br>  the results are only slightly better than the random prediction, then in the second case we received a 100% hit. <br><br>  We will train our model on the complete data set and make sure that there will be a 100% result <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#final predict full data svm.fit (X_train_scl, y_train) pred=svm.predict(X_test_scl) print("\n results (pred, real): \n",list(zip(pred,y_test))) print('scaled: accuracy = {}, f1-score= {}'.format( accuracy_score(y_test,pred), f1_score(y_test,pred, average='macro')))</span></span></code> </pre><br>  Let's look at the conclusion <br><br> <code>results (pred, real): <br> [(1, 1), (1, 1), (1, 1), (1, 1), (1, 1), (1, 1), (1, 1), (1, 1), (1, 1), (1, 1), (1, 1), (1, 1), (1, 1), (2, 2), (2, 2), (2, 2), (2, 2), (2, 2), (2, 2), (2, 2), (2, 2), (2, 2), (2, 2), (2, 2), (2, 2), (2, 2), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (4, 4), (4, 4), (4, 4), (4, 4), (4, 4), (4, 4), (4, 4), (4, 4), (4, 4)] <br> scaled: accuracy = 1.0, f1-score= 1.0</code> <br> <br>  Perfect!  It should be noted that, along with the accuracy metric, I decided to use the f1-score, which would have been useful to us if our classes had a significantly greater imbalance, but in our case there is almost no difference between the metrics (but we did see this clearly) <br><br>  Well, the last thing we will check is the RandomForest classifier that is already familiar to us. <br>  In books and other materials, I read that the scaling of features is not critical for RandomForest, let's see if this is so. <br><br><pre> <code class="python hljs">rfc=RandomForestClassifier(random_state=<span class="hljs-number"><span class="hljs-number">42</span></span>,n_jobs=<span class="hljs-number"><span class="hljs-number">-1</span></span>, n_estimators=<span class="hljs-number"><span class="hljs-number">100</span></span>) rfc=rfc.fit(X_train, y_train) rpred=rfc.predict(X_test) print(<span class="hljs-string"><span class="hljs-string">"\n not scaled: \n results (pred, real): \n"</span></span>,list(zip(rpred,y_test))) print(<span class="hljs-string"><span class="hljs-string">'not scaled: accuracy = {}, f1-score= {}'</span></span>.format( accuracy_score(y_test,rpred), f1_score(y_test,rpred, average=<span class="hljs-string"><span class="hljs-string">'macro'</span></span>))) rfc=rfc.fit(X_train_scl, y_train) rpred=rfc.predict(X_test_scl) print(<span class="hljs-string"><span class="hljs-string">"\n scaled: \n results (pred, real): \n"</span></span>,list(zip(rpred,y_test))) print(<span class="hljs-string"><span class="hljs-string">'scaled: accuracy = {}, f1-score= {}'</span></span>.format( accuracy_score(y_test,rpred), f1_score(y_test,rpred, average=<span class="hljs-string"><span class="hljs-string">'macro'</span></span>)))</code> </pre><br>  We get the following output: <br> <code>not scaled: <br> results (pred, real): <br> [(1, 1), (1, 1), (2, 1), (1, 1), (1, 1), (2, 1), (1, 1), (1, 1), (1, 1), (1, 1), (1, 1), (1, 1), (1, 1), (2, 2), (2, 2), (2, 2), (1, 2), (2, 2), (2, 2), (2, 2), (2, 2), (3, 2), (2, 2), (3, 2), (2, 2), (4, 2), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (4, 3), (3, 3), (3, 3), (4, 4), (4, 4), (4, 4), (4, 4), (4, 4), (4, 4), (4, 4), (4, 4), (4, 4)] <br> not scaled: accuracy = 0.8541666666666666, f1-score= 0.8547222222222222 <br> <br> scaled: <br> results (pred, real): <br> [(1, 1), (1, 1), (2, 1), (1, 1), (1, 1), (1, 1), (1, 1), (1, 1), (1, 1), (1, 1), (1, 1), (1, 1), (1, 1), (2, 2), (2, 2), (2, 2), (2, 2), (2, 2), (2, 2), (2, 2), (2, 2), (2, 2), (2, 2), (2, 2), (2, 2), (2, 2), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (3, 3), (4, 4), (4, 4), (4, 4), (4, 4), (4, 4), (4, 4), (4, 4), (4, 4), (4, 4)] <br> scaled: accuracy = 0.9791666666666666, f1-score= 0.9807407407407408</code> <br> <br>  So, we can make 2 conclusions: <br>  1. Sometimes it is useful to scale the attributes even for decision trees. <br>  2. SVC showed better accuracy. <br><br>  It should be noted that this time I selected the parameters manually and if for scv I picked up the right option from the second attempt, I didn‚Äôt pick up Random from the 10th time, I spat and left it by default (except for the number of trees).  Perhaps there are parameters that will bring the accuracy to 100%, try to pick up and be sure to tell in the comments. <br><br>  Well, almost everything seems to be, but I think that Star Wars fans will not forgive me for not mentioning the seventh film of the saga, therefore ... <br><br><h3>  Episode <a name="VII"></a>  VII: Awakening of power - instead of conclusion. </h3><br>  Machine learning turned out to be a damn fascinating thing, I still advise everyone to try to invent and solve a problem close to you. <br>  Well, if something does not work right away, then do not hang your nose as in the picture below. <br><br><img src="https://habrastorage.org/web/6e0/b14/0e7/6e0b140e78d24fc7ac6d99795b62e6ea.jpg"><br><br>  <i>Yes Yes!</i>  <i>So that you don‚Äôt think it is ‚Äúhang your nose‚Äù and no other hidden thoughts;)</i> <br><br>  And may the force be with you! </div><p>Source: <a href="https://habr.com/ru/post/338124/">https://habr.com/ru/post/338124/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338114/index.html">The digest of interesting materials for the mobile developer # 221 (September 11-17)</a></li>
<li><a href="../338116/index.html">Reverse engineering of the first smart watch Seiko UC-2000</a></li>
<li><a href="../338118/index.html">How to write your first Linux device driver. Part 2</a></li>
<li><a href="../338120/index.html">Metrics in the software development process: GQM model</a></li>
<li><a href="../338122/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ280 (September 11 - 17, 2017)</a></li>
<li><a href="../338126/index.html">Travis CI: automatic loading of collected modules on GitHub</a></li>
<li><a href="../338128/index.html">Where to go after ‚ÄúKickstarter‚Äù: difficulties of promotion of manufacturers of niche electronics</a></li>
<li><a href="../338130/index.html">It's a (focus) Trap</a></li>
<li><a href="../338132/index.html">Introduction to kube-spawn - a utility for creating local Kubernetes-clusters</a></li>
<li><a href="../338134/index.html">How to assemble Ceylon in a container if your container ship is blocked</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>