<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The right way to become a safe person: from lamer to practical exploit</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I welcome, you% habrauzer%. I read here an article on the Habr√© "Exam for future" Russian hackers "at the Moscow Polytech . " And my brain went into a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The right way to become a safe person: from lamer to practical exploit</h1><div class="post__text post__text-html js-mediator-article">  I welcome, you% habrauzer%.  I read here an article on the Habr√© <a href="https://habrahabr.ru/post/320210/">"Exam for future" Russian hackers "at the Moscow Polytech</a> . <a href="https://habrahabr.ru/post/320210/">"</a>  And my brain went into an endless cycle of misunderstanding of what was happening.  Whether I now glanced on "hackers" school forum, or really on habr.  Excuse me, with this approach, the current generation of Wites will simply not be replaced. <br><br>  In this article, I would like to write how, in my humble opinion (previously a baghunter on the side of black metal), it would be really worth starting the road.  And in no case with Kali linux (as it turns out they teach at the polytechnic of the capital. <br><br>  If you are interested in part and my way, welcome under cat. <br><a name="habracut"></a><br>  Many steps at users of a habr are already executed, therefore can safely pass to the level.  Basically, the post will deal with Windows, since this OS is my specialty, as the most common.  I will look at the code here on the example of the buffer overflow vulnerability, but I‚Äôll not get to the finished exploit, this is a separate and very extensive topic. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Step 0. From lamer to noob </h3><br>  First of all, you should study the operating system in which you work.  No matter how trite it may sound, but OS knowledge sometimes presents things that are not reversed. <br><br>  <i>For example, the UAC bypass in Windows 10 was discovered thanks to one procmon that worked while using eventvwr.</i>  <i>It's funny, but the fact of raising the rights was that eventvwr first looked for the registry key in one branch, but did not find it in another.</i>  <i>In fact, in the first place, usually nothing was ever found, in the end it was enough to just write down the path to your file and run the eventvwr as soon as the application was started with elevated permissions.</i> <br><br>  There was not a single byte, but the researchers found a UAC bypass. <br><br>  So the first is to learn the operating system.  Thoroughly.  Read different books on its device.  Specifically, on Windows, I can advise Mark Russinovich "Internal Windows".  A book from the author of such popular utilities as autoruns and procmon <br><br>  For Windows: play around with programs like RegMon and FileMon.  They allow you to make OS "before" and "after" and compare.  See what changes make different settings like changing OS settings and the like. <br><br>  Put the virtual machine and try to ‚Äúkill‚Äù the OS in the most perverted ways, and then fix it. <br><br>  After that, you can go back to RegMon and FileMon and start running various samples of Malvari.  After that, you will already be able to find almost any malware simply by the symptoms. <br><br>  Malware can be obtained from here: <br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  <b>Attention!</b>  <b>Sites containing links to malicious files</b> <br>  <b>Go at your own risk</b> <br>  <b>Many malware written by ours does not start on the RU machines, put the ENG-machines without the Russian layout on the virtual machine</b> <br>  malwareblacklist.com <br>  malwr.com (registration required) <br>  kernelmode.info (usually well known malware) <br></div></div><br>  After you study the operating system in which you work, you can proceed further. <br><br><h3>  Step 1. From noob to developer </h3><br>  At this stage, learn some programming language.  For example, python - it‚Äôs pretty good for a newbie and will come in handy for you in writing exploits and fuzzing (which we will look at next). <br><br>  After that, study C, he will give an understanding of working with memory, teach you to think about performance, and also be useful as a native language. <br><br>  Further, the assembly language, at least in general principles.  What are registers, what is a stack, basic instructions.  It is useful when reversing, especially no special knowledge is required for reading. <br><br>  In this order: python, C / C ++, assembler <br><br><h3>  Step 2. From the developer to the good developer </h3><br>  At this stage, you must learn to distinguish between bad code and good code.  Learn to see the errors, and also know the assembler. <br><br>  How to check whether you have passed this step?  Just tell me what the following code may cause: <br><br><pre><code class="hljs lua">#define _CRT_SECURE_NO_WARNINGS #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.h&gt; void Encr(<span class="hljs-built_in"><span class="hljs-built_in">char</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> *out, int key) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; strlen(<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>); i++) out[i] = <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>[i] + key; } int main(int argc, <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> *argv[]) { <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> EncryptedStr[<span class="hljs-number"><span class="hljs-number">10</span></span>] = { <span class="hljs-number"><span class="hljs-number">0</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (argc &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { Encr(argv[<span class="hljs-number"><span class="hljs-number">1</span></span>], EncryptedStr, <span class="hljs-number"><span class="hljs-number">5</span></span>); printf(<span class="hljs-string"><span class="hljs-string">"Encrypted: %s\n"</span></span>, EncryptedStr); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  This program receives a string in its arguments and encrypts it with a Caesar algorithm with key 5, storing the result in EncryptedStr. <br><br>  What is wrong with this code and what can it lead to? <br><br>  Answer: <br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  This program can lead to a buffer overflow if you pass a string longer than 9 (the 10th character is zero).  That will overwrite the return address from the function in the stack and allow to execute arbitrary code in the process memory.  If this were in the server software - this could lead to the fact that an unauthorized user could execute any code on the server <br></div></div><br>  But this code is from the 2000s.  At the moment, it is difficult to exploit the hole, because such techniques as DEP, ASLR, Security Cookies have appeared.  However, this also costs.  You can read for example, for example, ret2libc <br><br><h3>  Step 3. From a good developer to a reverse </h3><br>  Let's look at the previous example in assembler listing using IDA Pro <br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/0a6/0f0/689/0a60f06897ee4336afdf44a343dc972e.PNG"><br></div></div><br>  No matter how well you rummage, it is difficult even to find me here RCE.  But life examples are much more complicated.  Therefore, there are special tools - fuzzers. <br><br>  What is fuzzer?  This is a <s>laser from maser-type films, a</s> special software that floods the application with incorrect data in order to find non-standard behavior.  That is, we can write such a script, which in all places where input data is received will send random data and see the result.  If the result led to a fall, then we found a vulnerability. <br><br>  For example, for our application, the simplest fuzzer looks like this: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#/usr/bin/python import subprocess i = 0; while True: i += 1 if subprocess.call('test1.exe {0}'.format("A" * i), shell=True) != 0: print 'Crashed with arguments: {0}'.format("A" * i) break print "Finished"</span></span></code> </pre><br>  And here is the result: <br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/808/ff6/28b/808ff628b5ae42168c338805f0aff61e.PNG"><br></div></div><br>  Read more about phasers <a href="https://xakep.ru/2010/07/19/52726/">here.</a> <br><br>  Thus, having no source code or disassembling skills can be found vulnerability.  You can write fuzzers that generate any kind of input data. <br><br><h3>  From reverser to exploiter </h3><br>  After that you can start writing exploits. <br><br>  For example, for our application, the simplest exploit will look something like this in the pseudocode. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#/usr/bin/python import subprocess subprocess.call('test1.exe '.format("A" * 10 + address + there_shellcode), shell=True);</span></span></code> </pre><br>  Where address is the address of the rewritable buffer in memory, and there_shellcode is the shellcode that is executed when the buffer overflows. <br><br>  How exactly is this found in Google, I just gave a farewell. <br><br><h3>  Instead of conclusion </h3><br>  My version unlike the article given before the cut is much more extensive and practical.  However, more difficult. <br><br>  Follow what path - by means of the scriptkiddies, or by exploiting - only you choose. </div><p>Source: <a href="https://habr.com/ru/post/320286/">https://habr.com/ru/post/320286/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320270/index.html">Internet intelligence in action: who is Mr./Ms. Habraman?</a></li>
<li><a href="../320278/index.html">Hard parting with Net-Tools</a></li>
<li><a href="../320280/index.html">Javascript Video Refactoring</a></li>
<li><a href="../320282/index.html">Hijacking Whatsapp accounts using the web version</a></li>
<li><a href="../320284/index.html">Qt 5.8 framework release</a></li>
<li><a href="../320288/index.html">Python: collections, part 4/4: All about expression-generators, list generators, sets and dictionaries</a></li>
<li><a href="../320290/index.html">This is not ransomware, but in any case can ‚Äúseize‚Äù your server.</a></li>
<li><a href="../320292/index.html">How I created a SaaS service that brings me $ 1000 a month</a></li>
<li><a href="../320294/index.html">Migrant workers from Siberia. Or how we built a quest in Slovakia in 4.5 days</a></li>
<li><a href="../320296/index.html">How designers manage luck in games</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>