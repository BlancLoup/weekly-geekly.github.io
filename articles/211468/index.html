<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>VLC stereo player</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It all started with the fact that I bought a new monitor with support for ASUS VG23AH 3D and at some point I wanted to take the opportunity to watch a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>VLC stereo player</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/3da/421/b22/3da421b226120a9f7048825e7f068f36.png" alt="image" align="left">  It all started with the fact that I bought a new monitor with support for ASUS VG23AH 3D and at some point I wanted to take the opportunity to watch a 3D movie on it.  Podugul free form of players for Mac OS, it turned out they are not so many - all the more often came across the player <a href="http://bino3d.org/">Bino</a> .  I downloaded this Bino, but it didn‚Äôt look normal, i.e.  There are no complaints to the player, the picture was 3D, but the video was terribly slow, the picture was twitching.  I used the advice on improving the performance of this program - it says there - check how this film plays in the <a href="http://www.videolan.org/">VLC</a> player, if it slows down, it means your computer‚Äôs capacity is insufficient / replace the computer.  In VLC, everything showed up perfectly without brakes but, of course, in mono mode.  Since VLC is a opensource project, I decided to tweak it a bit so that it could show stereo movies, it turned out to be quite simple. <br><a name="habracut"></a><br>  For a start, I made a fork of <a href="https://github.com/videolan/vlc">this</a> repository and started reading documents and howto.  I didn‚Äôt manage to build the project right away, there were conflicts with my mac ports installed, I had to demolish it.  Then I had to do an up-merge for the extras / tools / ragel / aapl components, then everything was assembled according to the <a href="http://wiki.videolan.org/OSXCompile">instructions</a> . <br>  Then the first thing that struck me was that it was possible to add plug-ins to VLC (these are modules that allow post-processing of decoded frames).  Well, well, I thought that would be enough to convert a stereo image. <br><br>  <i><b>Retreat: the</b> source file that I wanted to play had 2 angles in each video frame (on the left is a picture for the left eye, on the right - for the right) in general, a fairly standard format for a stereo film.</i> <br><br>  The processing came down to the fact that I formed the output video buffer line by line from the left and right half-frame, respectively.  It was expected that the left eye would see odd lines, the right one - even. <br>  It was easy to implement this filter (I read the <a href="http://wiki.videolan.org/Documentation:Hacker%2527s_Guide/Video_Filters">instructions and</a> took one of the existing ones as a basis).  But, of course, it did not lead to success.  On the screen, the picture looked striped, but the lines were not synchronized with the pixels of the screen, so the 3D effect in the glasses was not observed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i><b>Retreat:</b> I want to explain how 3D mode works on passive 3D monitors.</i>  <i>I am not an expert in this technology, so I will describe as an amateur.</i> <i><br></i>  <i>In monitors of my type, FPR (Film-type Patterned Retarder) technology is used to separate the angles of the video stream.</i>  <i>I imagine it as if every line of pixels on the monitor is closed by a polarizing filter, it is conditionally possible to imagine that the odd lines are closed by the filter with vertical polarization, and even with horizontally, the same filters are wearing glasses, as a result one eye sees only odd lines, second even.</i> <br><br>  Having understood this, I realized that I need to do post-processing directly in the render so that I can guarantee pixel-by-pixel location of the output video frame. <br><br>  I looked at how the render is implemented in VLC for Mac.  It turned out pretty simple.  Each decoded video frame is loaded as a texture, which is subsequently displayed on the screen by means of open GL.  Converting a graphic format from YUV to RBG occurs directly in the pixel shader.  This immediately gave me an idea - what needs to be done.  Since it is known that the pixel shader just forms a color for each pixel of the screen, I just have to correct this shader so that it takes data from the desired part of the texture for even and odd lines when forming the color. <br><br>  Here is a sample code (written schematically, a working example can be found <a href="https://github.com/mikhail-angelov/vlc">here</a> ): <br><br><pre><code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> main(<span class="hljs-type"><span class="hljs-type">void</span></span>) { vec4 x,y,z,result; vec4 tc = TexCoord0; + <span class="hljs-type"><span class="hljs-type">float</span></span> d = mod((floor(height*(tc.y+<span class="hljs-number"><span class="hljs-number">1.0</span></span>))),<span class="hljs-number"><span class="hljs-number">2.0</span></span>); //odd <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> even, height - <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> uniform <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> viewport height + <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(d&gt;<span class="hljs-number"><span class="hljs-number">0.1</span></span>) tc.x += <span class="hljs-number"><span class="hljs-number">0.5</span></span>; //shift texture x = texture2D(Texture0, tc.st); y = texture2D(Texture1, tc.st); z = texture2D(Texture2, tc.st); result = x * Coefficient[<span class="hljs-number"><span class="hljs-number">0</span></span>] + Coefficient[<span class="hljs-number"><span class="hljs-number">3</span></span>]; //Coefficient - const coefficients <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> convert YUV <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> RGB result = (y * Coefficient[<span class="hljs-number"><span class="hljs-number">1</span></span>]) + result; result = (z * Coefficient[<span class="hljs-number"><span class="hljs-number">2</span></span>]) + result; + <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(TexCoord0.x &gt; <span class="hljs-number"><span class="hljs-number">0.5</span></span>) result = vec4(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); //cut <span class="hljs-keyword"><span class="hljs-keyword">off</span></span> right side gl_FragColor = result; };</code> </pre> <br><br>  If to compare with the source code, then I added only the lines marked +. <br><br>  After that, I got the correct stereo image on the left side of the screen. <br>  In the future, it remains only to correct the size of the image, and cut off the right side, and that‚Äôs all - the stereo player is ready. <br>  Anyone who is interested - you can see the <a href="https://github.com/mikhail-angelov/vlc">code on github</a> . <br><br>  In fact, in order to get a stereo player from VLC in total, I had to write about 30 lines of code, it struck me a lot, and was the reason for writing this article. <br><br>  <i><b>PS:</b> Later, when my version was made, I found an excellent opensource stereo player - <a href="http://sview.ru/">sview.ru</a> , on MacOS it works well.</i> </div><p>Source: <a href="https://habr.com/ru/post/211468/">https://habr.com/ru/post/211468/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../211458/index.html">Instrument measuring temperature and humidity PI-TV-2</a></li>
<li><a href="../211460/index.html">Satya Nadella: Microsoft's new CEO</a></li>
<li><a href="../211462/index.html">FlightCar: peer-to-peer car exchange and the fight against bureaucrats</a></li>
<li><a href="../211464/index.html">Testing Digium phones with Asterisk and setting up Smart BLF</a></li>
<li><a href="../211466/index.html">A simple Python script to learn English words or why I don‚Äôt use flashcards</a></li>
<li><a href="../211470/index.html">How to run a program without an operating system: part 5. Accessing the BIOS from the OS</a></li>
<li><a href="../211472/index.html">Basics of creating a 2D character in Unity 3D 4.3. Part 1: character preparation and animation of rest</a></li>
<li><a href="../211474/index.html">The easiest cross-platform server with ssl support</a></li>
<li><a href="../211476/index.html">About liberties in the links or the simplest messaging</a></li>
<li><a href="../211478/index.html">Experience of implementing caching in a small project with a strong social component</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>