<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Scripts for managing virtual hosts on a Debian web server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to share a small experience that simplifies the administration of a web sever running a debian-like operating system. Immediately make a reserv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Scripts for managing virtual hosts on a Debian web server</h1><div class="post__text post__text-html js-mediator-article">  I want to share a small experience that simplifies the administration of a web sever running a debian-like operating system.  Immediately make a reservation, I'm not a guru in this area, just at some point I needed to raise vsftpd, nginx, PHP-FPM and PostgreSQL.  It's no secret that when adding virtual hosts, setting up PHP-FPM pools and creating databases, you have to perform the same actions.  Deleting virtual hosts with everything connected with them, as well as creating backup copies, is also very monotonous.  Therefore, it would be nice to get scripts that automate all these things. <br><a name="habracut"></a><br>  To be honest, at the time of writing the scripts, I was not bothering to search for existing solutions, it was just interesting for me to do everything myself.  And, although <a href="https://bitbucket.org/sayonara-sama/debian-web-server-tools">the Bitbucket repository</a> came along with the first version of the scripts, thoughts of their possible usefulness for someone else came to mind a little later. <br><br>  And yet, for a start, it is worth considering the existing solutions.  One of them is described in the <a href="http://habrahabr.ru/post/96933/">article</a> .  It provides an example script for FreeBSD that creates a virtual host.  Another solution is provided in the <a href="http://habrahabr.ru/post/93695/">article</a> , and a similar script is considered there, but for Debian. <br><br>  After reading the materials of the articles, we can conclude that none of them presented the complete solution of the problem.  It also grieves the lack of a flexible system of parameters, that is, you cannot influence the behavior of scripts without changing their code.  And, in the meantime, we may need to create a virtual host without PHP support or, for example, not to create a database.  In addition, all configs are located right inside the scripts, which is also not very good. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  To business </h4><br>  So, there are several scripts: <br><ul><li>  siteadd.sh - to create a virtual host; </li><li>  passwd.sh - to change the password; </li><li>  backup.sh - to create a backup; </li><li>  sitedel.sh - to remove a virtual host. </li></ul><br>  How to work with them is described on the <a href="https://bitbucket.org/sayonara-sama/debian-web-server-tools/wiki/Home">wiki</a> , but the general idea is that, for example, when <b>creating a</b> virtual host test.ru, the script asks which password to assign to the user test.ru, creates this user in the system, then creates the / var / www folder /data/test.ru/public_html with the stub file index.html and gives all the necessary rights to the user test.ru. <br><br>  Next, the script creates a nginx configuration file with a template with the necessary parameters and similarly configures the PHP-FPM pool. In PostgreSQL, it creates a test_ru database and a test_ru user, which it assigns as its owner. <br><br>  If the <b>--no-php</b> parameter is specified when invoking the script, the PHP-FPM pool is not configured, and the template without PHP support is used when creating the nginx configuration file.  With the <b>--no-pgsql</b> option, PostgreSQL does not create a database and user. <br><br>  When <b>changing the password</b> for the virtual host test.ru, the script asks for a new password and assigns it both to the test.ru user in the system and to the test_ru user in PostgreSQL. <br><br>  When <b>creating a backup</b> for the virtual host test.ru, the script creates: <br><ul><li>  archive files /var/www/backup/test.ru/YY-mm-dd_HH:ii:ss.tar.gz; </li><li>  base dump /var/www/backup/test.ru/YY-mm-dd_HH:ii:ss.sql. </li></ul><br>  When you <b>delete the</b> virtual host test.ru, the script deletes the database and the user test_ru from PostgreSQL, deletes the folder /var/www/data/test.ru and the user test.ru from the system.  Backups are not deleted. <br><br>  It should be noted that there are two versions of scripts: <br><ul><li>  the normal version, which lies in the default branch; </li><li>  version with support for the transfer of parameters in JSON format, which lies in the json branch. </li></ul><br>  The regular version does not require any special tools.  A JSON-enabled version requires a JSON processor in the system called jq, which is available through standard Debian repositories.  And although someone will not like this condition, this version is now more flexible, but not for long. <br><br><h4>  What's next? </h4><br>  From time to time I return to my server to play.  As a result, scripts are being developed, and this is what I would like to modify first: <br><ul><li>  increase the number of parameters of the regular version, which will make it more flexible, including adding a parameter for deploying a backup; </li><li>  add configuration templates, because  there are some settings missing; </li><li>  write a script for cleaning outdated backups; </li><li>  provide support for apache and mysql. </li></ul><br>  That's all for now.  I remind you that the scripts can be downloaded <a href="https://bitbucket.org/sayonara-sama/debian-web-server-tools">here</a> .  I will be glad comments and suggestions.  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/202348/">https://habr.com/ru/post/202348/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../202328/index.html">Could there be too much automation on the plane?</a></li>
<li><a href="../202332/index.html">25th anniversary of the Buran flight</a></li>
<li><a href="../202334/index.html">The monitoring system in the car for him on the Raspberry Pi. Part 2</a></li>
<li><a href="../202340/index.html">Google rolled out a replacement Javascript - Dart language</a></li>
<li><a href="../202344/index.html">MVC 5 Owin authorization on the example of Vkontakte</a></li>
<li><a href="../202350/index.html">The history of the startup and its subsequent transformation into an outsourcing office</a></li>
<li><a href="../202354/index.html">How to assess the quality of user experience in data transfer?</a></li>
<li><a href="../202358/index.html">Hardware accelerated rendering in Chrome browser</a></li>
<li><a href="../202360/index.html">Sony PlayStation 4 Full review</a></li>
<li><a href="../202362/index.html">Comet ISON broke out, time to get binoculars</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>