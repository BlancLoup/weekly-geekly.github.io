<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Recover data from internal memory on Android for dummies</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Now more and more smartphones go without a slot for sd-card, and the information has to be stored on the built-in memory with access to it via MTP. Th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Recover data from internal memory on Android for dummies</h1><div class="post__text post__text-html js-mediator-article">  Now more and more smartphones go without a slot for sd-card, and the information has to be stored on the built-in memory with access to it via MTP.  This connection mode does not allow the standard tools to recover phone data after a wipe or accidental deletion. <br><br>  Today, using the example of Xiaomi Mi2s and Windows 8.1 bundles, I will try to tell you how to recover lost data, who is interested, welcome to Cat. <br><a name="habracut"></a><br>  It should be noted that if you mistakenly formatted the internal memory of the smartphone / tablet / smartpad, then you should not be upset, and most importantly, in no case should you record anything in the device‚Äôs memory, so you will be able to recover more data. <br><br>  The MTP protocol does not allow the computer to recognize the connected device as a USB drive and recovery programs cannot scan such a device and save data, so we will need to copy the entire internal memory section as an image of the system. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Preparing Android Device </h4><br>  You will need root and USB debugging enabled. <br><br><h4>  PC preparation </h4><br>  In order to copy the system section, we need: <br><br><ul><li>  <a href="http://code.msdn.microsoft.com/vhdtool">VHDtool</a> ; </li><li>  Drivers for your device (in case of problems <a href="http://habrahabr.ru/post/205572/">habrahabr.ru/post/205572</a> ); </li><li>  ADB ( <a href="http://adbdriver.com/downloads/">adbdriver.com</a> or <a href="http://developer.android.com/sdk/win-usb.html">developer.android.com</a> ); </li><li>  <a href="https://filezilla-project.org/download.php%3Ftype%3Dserver">FileZilla</a> server. </li></ul><br>  First install the USB drivers for your device and ADB.  After that, I advise you to restart the PC. <br><br><h5>  VHDtool </h5><br>  Create a folder with the address C: \ cygwin64 \ 000 (the name does not matter, do not just use letters other than Latin), here will be our image.  Copy to the folder VHDtool.exe. <br><br><h5>  Filezilla </h5><br>  During the installation, we agree to all standard installations. <br>  After installation, FileZilla will start automatically, but you must exit the program and run it as <strong>Administrator</strong> . <br>  When you start FileZilla ask the name of the server, leave everything as is. <br><br><img src="https://habrastorage.org/files/090/b23/29e/090b2329e87b439da846262d71e4e3f6.PNG"><br><br>  Next, go to Edit - Settings and make the following settings: <br><br>  listen on those ports 40 <br>  timeout settings - the default is 120, 60, 60, and we put 0 everywhere and click OK. <br>  Go to edit - users.  In the users window create a new user.  In my case, this user qwer. <br>  Click Add - write the name - password pass - click OK. <br><br>  Next, in the same Users menu, on the left, select the Shared folders tab.  We go there and add a folder in which our block will be uploaded.  Click Add and add the folder C: \ cygwin64 \ 000.  The path to this folder appears in the window.  If to the left of the inscription C: \ cygwin64 \ 000 there is no letter H, then you need to click Set as home dir.  Then, highlighting the line C: \ cygwin64 \ 000, you need to check Read and Write rights with check marks.  Then click OK. <br><br><img src="https://habrastorage.org/files/b31/eda/727/b31eda72737a4a3e8446ebaecbb8ed5c.PNG"><img src="https://habrastorage.org/files/4c8/331/19a/4c833119a26d4ae28e3975f74a400a8e.PNG"><br><br><h5>  Adb </h5><br>  We will need the following files: <br><ul><li>  adb.exe </li><li>  AdbWinApi.dll </li><li>  adb-windows.exe </li><li>  AdbWinUsbApi.dll </li><li>  fastboot.exe </li></ul><br><br>  You can download them <a href="https://mega.co.nz/">here</a> . <br>  Or pull out from the Android SDK distribution. <br><br>  Copy them to the folder C: \ cygwin64 \ bin <br><h5>  ADB operation check </h5><br>  Run the console from the folder C: \ cygwin64 \ bin, for this it is enough to enter cmd in the address bar of the explorer <br><img src="https://habrastorage.org/files/8b3/c27/1f9/8b3c271f95e349b9b56df2b567c71ee4.PNG"><br><br>  Enter the command: <br><br><pre><code class="dos hljs">adb devices</code> </pre> <br><br>  The list of connected devices should not be empty, if after the line List of devices attached is empty, then you did not install the USB drivers or enable USB debugging. <br><br>  When everything goes well, the console looks like this: <br><br><img src="https://habrastorage.org/files/84e/419/2aa/84e4192aa2c446d7aa705772672eae6d.png"><br><br>  20352f2c - my Xiaomi Mi2s <br><br><h4>  USB modem mode </h4><br>  We will need to connect the device via USB to your PC and turn on the modem mode via USB.  I use CyanogenMod 11 and I have this mode along the path: Settings&gt; Wireless networks&gt; More ...&gt; Modem mode&gt; USB modem <br><div class="spoiler">  <b class="spoiler_title">Screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/0d6/862/f8e/0d6862f8ecb6423c84404bfc64e58ec2.png"></div></div><br>  Now we need to find out what IPv4 address your computer received. <br>  Use the command line ipconfig <br>  or <br>  Going along the path: Control Panel \ Network and Internet \ Network and Sharing Center <br><br><img src="https://habrastorage.org/files/d64/8a6/6f9/d648a66f91414e50bd7b459df9d61aec.PNG"><br><br>  Click on the 'Local Area Connection' text below Information and copy the IPv4 address. <br><br><img src="https://habrastorage.org/files/a0b/be2/890/a0bbe289002041ff8220b8200ad66033.PNG"><br><br>  In my case it is 192.168.42.79 <br><br>  <b>Important!</b>  <b>Each time the USB cable is reconnected and the modem mode is turned on / off, the IPv4 modem will change.</b> <br><br><h4>  What memory block do we need? </h4><br>  All memory in your device is divided into logical blocks, we do not need to download everything, it is enough to understand which section contains erased information. <br><br>  Now we need to look at the list of memory blocks, for this we enter the following commands line by line: <br><br><pre> <code class="dos hljs">adb shell su <span class="hljs-built_in"><span class="hljs-built_in">find</span></span> /dev/block/platform/ -name 'mmc*' -exec fdisk -l {} \; &gt; /sdcard/list_of_partitions.txt</code> </pre><br>  <i>Hint: if you are too lazy to manually rewrite commands or you are afraid to make a mistake, you can use copying, but inserting the line into the console in the usual way will not work, so you need to right-click on the console window, then select edit&gt; paste.</i> <br><br><img src="https://habrastorage.org/files/076/921/417/076921417f0c4e39a691f96717a1ff1f.png"><br><br>  After that, the list_of_partitions.txt file will appear in the internal memory, which we need to copy to the PC and study. <br>  You can copy it to our 000 folder using a simple command (it should be executed in a separate command window): <br><pre> <code class="dos hljs">adb pull /sdcard/list_of_partitions.txt C:/cygwin64/<span class="hljs-number"><span class="hljs-number">000</span></span></code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">My file is</b> <div class="spoiler_text"><pre> <code class="dos hljs">Disk /dev/block/platform/msm_sdcc.<span class="hljs-number"><span class="hljs-number">1</span></span>/mmcblk0p27: <span class="hljs-number"><span class="hljs-number">25</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span> GB, <span class="hljs-number"><span class="hljs-number">25698483712</span></span> bytes <span class="hljs-number"><span class="hljs-number">4</span></span> heads, <span class="hljs-number"><span class="hljs-number">16</span></span> sectors/track, <span class="hljs-number"><span class="hljs-number">784255</span></span> cylinders Units = cylinders of <span class="hljs-number"><span class="hljs-number">64</span></span> * <span class="hljs-number"><span class="hljs-number">512</span></span> = <span class="hljs-number"><span class="hljs-number">32768</span></span> bytes Disk /dev/block/platform/msm_sdcc.<span class="hljs-number"><span class="hljs-number">1</span></span>/mmcblk0p27 doesn't contain a valid partition table Disk /dev/block/platform/msm_sdcc.<span class="hljs-number"><span class="hljs-number">1</span></span>/mmcblk0p26: <span class="hljs-number"><span class="hljs-number">3758</span></span> MB, <span class="hljs-number"><span class="hljs-number">3758096384</span></span> bytes <span class="hljs-number"><span class="hljs-number">4</span></span> heads, <span class="hljs-number"><span class="hljs-number">16</span></span> sectors/track, <span class="hljs-number"><span class="hljs-number">114688</span></span> cylinders Units = cylinders of <span class="hljs-number"><span class="hljs-number">64</span></span> * <span class="hljs-number"><span class="hljs-number">512</span></span> = <span class="hljs-number"><span class="hljs-number">32768</span></span> bytes Disk /dev/block/platform/msm_sdcc.<span class="hljs-number"><span class="hljs-number">1</span></span>/mmcblk0p26 doesn't contain a valid partition table Disk /dev/block/platform/msm_sdcc.<span class="hljs-number"><span class="hljs-number">1</span></span>/mmcblk0p25: <span class="hljs-number"><span class="hljs-number">402</span></span> MB, <span class="hljs-number"><span class="hljs-number">402653184</span></span> bytes <span class="hljs-number"><span class="hljs-number">4</span></span> heads, <span class="hljs-number"><span class="hljs-number">16</span></span> sectors/track, <span class="hljs-number"><span class="hljs-number">12288</span></span> cylinders Units = cylinders of <span class="hljs-number"><span class="hljs-number">64</span></span> * <span class="hljs-number"><span class="hljs-number">512</span></span> = <span class="hljs-number"><span class="hljs-number">32768</span></span> bytes Disk /dev/block/platform/msm_sdcc.<span class="hljs-number"><span class="hljs-number">1</span></span>/mmcblk0p25 doesn't contain a valid partition table ‚Ä¶</code> </pre></div></div><br><br>  The internal memory in my device is 32 GB.  Therefore, I am looking for the largest partition, in my case it is mmcblk0p27 with a size of 25.6 GB, you most likely will have a different name, or will not have any postscript p **.  Of course, no one guarantees that the largest section will be the one on which your photos, videos, documents, etc. have recently been laid, but in 90% of cases this turns out to be exactly the section of memory we need.  Otherwise, you will have to copy all the images and check each of them in order. <br><br><h4>  Copy the memory section on the PC. </h4><br><br>  If you have already closed the cmd window, then run it again. <br><br>  Enter commands line by line: <br><br><pre> <code class="dos hljs">adb shell su mkfifo /cache/myfifo ftpput -v -u qwer -p pass -P <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">42</span></span>.<span class="hljs-number"><span class="hljs-number">79</span></span> mmcblk0p27.raw /cache/myfifo</code> </pre><br>  <i>Do not forget to make the appropriate adjustments to the code!</i> <br><br>  We decipher what is written: <br><br>  qwer - FileZilla account name (if you have your own) <br>  pass - password for the FileZilla account (if you have changed yours) <br>  40 - FileZilla server port <br>  192.168.42.79 - FileZilla server address (you have your own) <br>  mmcblk0p27.raw - a copied memory block (you have your own) <br><br><img src="https://habrastorage.org/files/fa0/3b5/184/fa03b51844f148e18e59d3b0a726e79c.PNG"><br><br>  Open the second command window and enter the commands: <br><br><pre> <code class="dos hljs">adb shell su dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=/dev/block/mmcblk0p27 of=/cache/myfifo</code> </pre><br>  <i>Do not forget to fix mmcblk0p27 on the number of your block!</i> <br><br>  We look into the FileZilla window and see that the download of mmcblk0p27.raw to the C: \ cygwin64 \ 000 folder has started, now you can close the cygwin windows and take a tea break. <br><br><img src="https://habrastorage.org/files/f3a/742/9bb/f3a7429bbd7a40ea9c40c35a88607e4e.PNG"><br><br><h4>  Convert and restore </h4><br>  Are you back?  File downloaded?  Fine.  Turn off the phone, connect the Internet.  Run Cygwin.bat and enter the following commands. <br><br><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> C:/cygwin64/<span class="hljs-number"><span class="hljs-number">000</span></span>/ VhdTool.exe /<span class="hljs-built_in"><span class="hljs-built_in">convert</span></span> mmcblk0p27.raw</code> </pre><br>  <i>Do not forget to fix mmcblk0p27 on the number of your block!</i> <br><br>  My conversion took a couple of seconds.  At the output, we get all the same mmcblk0p27.raw file in the C: \ cygwin64 \ 000 folder, but a bit different.  This converted file can be mounted as a virtual disk, or, for example through R-studio, you can restore data directly from our image.  I did that. <br><br><img src="https://habrastorage.org/files/39f/99a/c83/39f99ac83e844951baac356ef4724d25.PNG"><br>  <i>Hint: important points marked yellow.</i> <br><br><h4>  Results </h4><br>  My goal was to use a popular language to explain how to copy the system partition from an android device to a PC, maybe some people would blame me for the difficulties associated with a USB modem and ftp, and they would say that it was probably easier to get the image out.  My answer is this: I tried it in other ways, described on w3bsit3-dns.com and xda-developers, it didn‚Äôt work for me, but I didn‚Äôt get to ftp from the second attempt, and when I wrote this article, everything went like clockwork. <br><br>  I managed to restore all the lost photos without loss in quality and even what I did not think to restore.  In the course of the recovery, photographs appeared that were taken in August last year, when I just bought the phone and tested the camera. <br><br>  In conclusion, I would also like to mention another small utility that recovers data - <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.defianttech.diskdigger">DiskDigger undelete</a> .  It is free, good functionality, but unfortunately, after 40% it fell out with me with an error. <br><br>  <i>PS Now I will do backup more often ...</i> <i><br></i>  <i>PPS Many thanks to <a href="https://habrahabr.ru/users/bakatrouble/" class="user_link">bakatrouble</a> for a visual experiment in the comments and help in optimizing the process.</i> </div><p>Source: <a href="https://habr.com/ru/post/232399/">https://habr.com/ru/post/232399/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../232387/index.html">Professional 3d hand scanners</a></li>
<li><a href="../232391/index.html">Real-time cyber attacks</a></li>
<li><a href="../232393/index.html">The release of the cloud hosting Infobox Jelastic 2. Announcement for developers</a></li>
<li><a href="../232395/index.html">Navdy: Projection Notification System for Gesture Driven Cars</a></li>
<li><a href="../232397/index.html">readyto.travel - how to save 30% or more when buying air tickets</a></li>
<li><a href="../232401/index.html">Remote control of VLC player using Arduino and Python</a></li>
<li><a href="../232403/index.html">New free courses virtual academy Microsoft Virtual Academy, August 2014</a></li>
<li><a href="../232405/index.html">To help colleagues "outrage"</a></li>
<li><a href="../232407/index.html">Amazon is trying to force publishers to reduce the price of e-books and increase the proportion of authors</a></li>
<li><a href="../232411/index.html">Mirror updates ESET Nod32 (all versions)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>