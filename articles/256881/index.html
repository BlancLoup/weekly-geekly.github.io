<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Autopayment from the inside: Part 1. How recurrences work</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habrahabr! 

 Relatively recently, we launched the recurrent payment service and want to share their internal device with you. Essentially, recurr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Autopayment from the inside: Part 1. How recurrences work</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/ef4/9cd/9fa/ef49cd9fafa047619201c3a1de608b9d.jpg"><br><br>  Hi, Habrahabr! <br><br>  Relatively recently, we launched the recurrent payment service and want to share their internal device with you.  Essentially, recurrences are a series of recurring payments.  The principle of their work is simple: during the first (parent) payment, a recurrent pattern is registered in the database, which is assigned a unique identifier.  All repeated charges are made using this template - the merchant gives a command to his service provider, indicating the recurrent identifier and the amount of payment, and the service provider initiates writing off funds from the user's card. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The user himself only needs to accept the offer once, where it is indicated for what and how often the funds will be written off. <br><br>  In general, the whole process can be divided into two stages - <b>registration of a</b> recurring payment <b>template</b> and <b>re-cancellation of a</b> regular payment.  Let us show by the example of using <b>Payler Gate API</b> : <br><a name="habracut"></a><br><h5>  1. Registration template </h5><br>  In the <b>StartSession</b> payment initialization request, <b>you</b> need to set the value of the optional <b>recurrent</b> parameter to <b>true</b> : <br><img src="https://habrastorage.org/files/e8a/ab0/58b/e8aab058b06446cd8bef1c338d30d3d1.jpg"><br><br>  In response to the successful execution of the transaction, the identifier of the recurrent payment template created is <b>recurrent_template_id</b> .  You can also get it by running a <b>GetStatus</b> request, specifying the <b>key</b> (merchant ID) and <b>order_id parameters</b> .  Example response for a successful query: <br><img src="https://habrastorage.org/files/b73/523/729/b7352372947a4270800c3aab0d39d1b4.jpg"><br><br><h5>  2. Re-write off </h5><br>  After successful registration of the template, you can re-write off without the participation of the cardholder.  To do this, run the <b>RepeatPay</b> request, specifying the following parameters: <br><br>  <b>key</b> - merchant identifier <br>  <b>order_id</b> - order identifier in the merchant system <br>  <b>amount</b> - payment amount in kopecks (may differ from the amount of the first payment) <br>  <b>recurrent_template_id</b> - recurrent payment template ID <br><br>  An example of a response to a successful request: <br><img src="https://habrastorage.org/files/410/f10/afe/410f10afe4b7492c8134f3ac836bd431.jpg"><br><br>  There are several templates that can be registered, and information on each of them can be obtained via a <b>GetTemplate</b> request (it is necessary with the indication of the template identifier, otherwise information about all templates existing in the merchant will come back).  If the request is successful, the merchant will receive a response containing the following parameters: <br><br>  <b>recurrent_template_id</b> - unchanged string <br>  <b>created</b> - the date and time of registration template <br>  <b>card_holder</b> - the name of the cardholder to which the template is attached <br>  <b>card_number</b> - masked card number <br>  <b>expiry</b> - card expiration date (by default, it is created for the entire card validity period) <br>  <b>active</b> - template activity (with true or false values) <br><br>  And an example of a response to a successful query: <br><img src="https://habrastorage.org/files/ad3/f95/5aa/ad3f955aae8a4c279c94555845ccc653.jpg"><br><br>  By the way, an ActivateTemplate request will help activate or deactivate a template, in which you need to specify only three parameters - key, recurrent_template_id and active, with a value of true if the template is to be activated, or false - if deactivated. <br><br>  As you can see, everything is very simple.  A little later, we will continue to reveal the topic of auto payments and write another post. <br><br>  We want to note that the recurrence service is free for our merchants.  At this stage, the service is provided by Russian Standard Bank and Alfa Bank, but very soon Promsvyazbank and Surgutneftgazbank will join them. <br><br>  We will be glad to your questions and comments! <br><br>  <i>Wishing you a great weekend,</i> <i><br></i>  <i>Your payler</i> <br>  <a href="https://www.facebook.com/payler">Come to us on facebook</a> </div><p>Source: <a href="https://habr.com/ru/post/256881/">https://habr.com/ru/post/256881/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../256871/index.html">Using Direct3D with High-Level VCL / LCL Component Libraries</a></li>
<li><a href="../256873/index.html">SMART life</a></li>
<li><a href="../256875/index.html">Half a ruble! 50 agents around the world will monitor your sites</a></li>
<li><a href="../256877/index.html">Java programmer cheat sheet 3. Java collections (standard, guava, apache, trove, gs-collections, and others)</a></li>
<li><a href="../256879/index.html">2D Platformer from Qt 5.2 to Qt 5.4</a></li>
<li><a href="../256883/index.html">Open video course "Multicore programming in Java" in Russian (30 + 30 hours)</a></li>
<li><a href="../256885/index.html">How to connect to support the whole team</a></li>
<li><a href="../256887/index.html">A million lines of bad code</a></li>
<li><a href="../256889/index.html">The first acquaintance with the architecture of the collectible card game "Last Argument"</a></li>
<li><a href="../256893/index.html">Work with date and time in Perl6</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>