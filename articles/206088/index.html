<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RWT / RAP + Jetty + JAX-WS Integration</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When developing RAP / RCP applications, I had a problem: how to make custom error-pages and integrate them into embedded jetty. There are many tutoria...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RWT / RAP + Jetty + JAX-WS Integration</h1><div class="post__text post__text-html js-mediator-article">  When developing RAP / RCP applications, I had a problem: how to make custom error-pages and integrate them into embedded jetty.  There are many tutorials on the Internet on how to do this if you build Jetty into your application.  But with RWT everything is more complicated.  RWT itself runs the Jetty and starts it as a managed service.  At the same time, the Jetty interface itself is hidden from other bundles and it will not work directly with it. <br>  I went a little further and decided to extend the functionality to the execution of any servlets, thereby Jetty, which is embedded in the RWT application.  And, most importantly, integrate JAX-WS web services in the same place.  Sympathetic, welcome under cat. <br><br><a name="habracut"></a><br><br>  It is assumed that the application is launched from OSGi platform, I have it Equinox. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To begin with, it is known from the documentation that it is possible to make some Jetty customizer and, passing the name of the system property, to get some customization.  So let's do it: when launching the entire application, we will pass <br><br>  <i>-Dorg.eclipse.equinox.http.jetty.customizer.class = en.futurelink.jetty.customizer.MyJettyCustomizer</i> <br><br>  Customizer code: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyJettyCustomizer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JettyCustomizer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">customizeContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object context, Dictionary&lt;String, ?&gt; settings)</span></span></span><span class="hljs-function"> </span></span>{ ServletContextHandler c = (ServletContextHandler) context; <span class="hljs-comment"><span class="hljs-comment">// ,   c.getServletHandler().addServletWithMapping( MyFileServlet.class, "/files/*"); // ,  - JAX-WS // import com.sun.xml.ws.transport.http.servlet.WSServlet; c.getServletHandler().addServletWithMapping( WSServlet.class, "/service/mobile"); // -   ErrorHandler errorHandler = new MyJettyErrorHandler(); errorHandler.setShowStacks(true); c.setErrorHandler(errorHandler); //  - JAX-WS (  ) c.getServletContext().getContextHandler(). addEventListener(new MyServletContextListener()); return c; } }</span></span></code> </pre> <br>  Here we do the following: <br>  1) Mapim some servlets, for certain urla, now they will be available there, everything is simple. <br>  2) Install custom process for erroneous pages. <br>  3) Add JAX-WS web services maintenance - more on this in the end, this is interesting;) <br><br>  If everything is clear and simple with the first item - we write the servlet, map it to the URL and voila, it is available, then the second requires an example of the handler code, here it is: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyJettyErrorHandler</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ErrorHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleErrorPage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpServletRequest request, Writer writer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> code, String message)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (code == <span class="hljs-number"><span class="hljs-number">404</span></span>) { writer.write(<span class="hljs-string"><span class="hljs-string">"No,no,no!!! This page does not exist!"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.handleErrorPage(request, writer, code, message); } }</code> </pre><br>  Now we can handle any HTTP response code in the way we want. <br><br>  Now the most interesting, we integrate JAX-WS into our RWT application.  The difficulty here arises in the implementation of the web service itself.  We need to make an XML description that is placed in <i>WEB-INF / sun-jaxws.xml</i> . <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">endpoints</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://java.sun.com/xml/ns/jax-ws/ri/runtime"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">endpoint</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ClientService"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">implementation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ru.futurelink.mo.mobile.server.ClientService"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">url-pattern</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/service/mobile"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">endpoints</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  But our application does not want to see this file description and create these same endpoints.  And the standard solution proposed for JAX-WS for creating endpoints in runtime is not suitable, since it generates another <b>com.sun.net.httpserver</b> web server.  We need to hang it on a separate port, and indeed, somehow it is clumsy.  We need another solution that will use the already existing Jetty to process requests for web services. <br><br>  We have already added the servlet itself, which will process requests to the web service, now we need to earn endpoints.  However, since our project works in the OSGi framework, the file description that we just created is not seen by JAX-WS.  The thing is that JAX-WS is not a compatible OSGi bundle, although we repacked it (I hope so?) Into a bundle from a simple JAR and added a manifest to it.  It is necessary to force him to eat this file, while doing everything correctly in the style of OSGi. <br><br>  We pack all our customizer in a <b>fragment</b> to the host <b>org.eclipse.equinox.http.jetty</b> .  It is necessary, as is known, the fragment extends the classpath, thereby allowing the host to find and load some custom parts from the classpath fragment, as if from its own.  We will make JAX-WS use jetty as an HTTP transport, instead of the usual default com.sun.net.httpserver. <br><br>  Next, we take several classes from JAX-WS (unfortunately, the architecture of this package does not allow to inherit correctly and we will have to override everything), from <b>com / sun / xml / ws / transport / http / servlet</b> .  Here is an example: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WSServletContextListener</span></span></span><span class="hljs-class"> </span></span>{‚Ä¶}</code> </pre><br>  I don‚Äôt know why they did it like this ... now we‚Äôll have to rewrite a piece of JAX-WS into our fragment.  Overwritten files can be found in github: <a href="https://github.com/futurelink/habrahabr">github.com/futurelink/habrahabr</a> <br><br>  In total, we need 4 classes: <br>  WSServletContextListener - MyServletContextListener, <br>  ServletResourceLoader - MyServletResourceLoader, <br>  ServletContainer - MyServletContainer, <br>  DeploymentDescriptorParser - MyDeploymentDescriptorParser <br><br>  All this we needed was to change a single line of code in the WSServletContextListener: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String JAXWS_RI_RUNTIME = <span class="hljs-string"><span class="hljs-string">"/WEB-INF/sun-jaxws.xml"</span></span>;</code> </pre><br>  replaced by: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String JAXWS_RI_RUNTIME = <span class="hljs-string"><span class="hljs-string">"/META-INF/sun-jaxws.xml"</span></span>;</code> </pre><br>  The problem is that now, with the unwrapping of the new version of JAX-WS, it is necessary to monitor this fragment so that it works normally.  But I found no other way to integrate into Jetty.  If someone wants to go this way from the beginning, it will be interesting to read another solution. </div><p>Source: <a href="https://habr.com/ru/post/206088/">https://habr.com/ru/post/206088/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../206074/index.html">Making Christmas toys from LED strips</a></li>
<li><a href="../206076/index.html">The digest of interesting materials from the world of web development and IT for the last week No. 87 (December 7 - 14, 2013)</a></li>
<li><a href="../206078/index.html">Chinese lunar rover successfully sunk</a></li>
<li><a href="../206082/index.html">Statics in C #</a></li>
<li><a href="../206086/index.html">Development of one game - new approach, P2</a></li>
<li><a href="../206090/index.html">Legality of translation</a></li>
<li><a href="../206092/index.html">Feathers.js - a reactive JavaScript framework on top of Express</a></li>
<li><a href="../206096/index.html">CSS variables in Firefox 29</a></li>
<li><a href="../206098/index.html">Install SteamOS on a virtual machine</a></li>
<li><a href="../206100/index.html">3G Internet at 33 km</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>