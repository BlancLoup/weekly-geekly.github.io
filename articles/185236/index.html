<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Getting to know Yii 2 through creating a simple blog.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear users! 

 As you already understood from the title, this article will discuss the new version of Yii. I will try briefly, on a live exampl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Getting to know Yii 2 through creating a simple blog.</h1><div class="post__text post__text-html js-mediator-article">  Hello, dear users! <br><br>  As you already understood from the title, this article will discuss the new version of Yii.  I will try briefly, on a live example, to introduce you to the wonderful Yii 2. <br><br>  Writing a complete instructions for creating a blog probably does not make sense, since many steps are similar to the first version, but I will write exactly about the nuances that are different, and I will focus on the Yii2 updates that I noticed during the creation of the application.  All the rest, you can quickly see in the <a href="https://github.com/vova07/yii2-start">demo application</a> , which probably will be more effective than just written text. <br><a name="habracut"></a><br><h4>  Highlights </h4><br>  In Yii2, as you have already noticed, everything is built on the namespace, this is probably the main highlight of the new version. <br>  Also a very important point: the ‚ÄúC‚Äù prefix from the file names has been removed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Install and create the first application </h4><br>  We will use the basic application as a basis. <br>  How to install it is very well described on <a href="https://github.com/yiisoft/yii2/tree/master/apps/basic">Github</a> on this immediately go to the following points. <br><br><h4>  Application structure </h4><br>  For example, I chose a modular structure.  This will allow us to learn and understand the principle of the modules in Yii2. <br>  So, in order to implement such a structure, we, as in the first version, need to create the main folder of all modules ‚Äúmodules‚Äù, in which we will create separate folders for individual modules.  It's all like in the first version. <br><br>  The only thing that has changed in the modules is the name of the main class of the module.  As I understand it, it is no longer necessary to write the ‚ÄúModule‚Äù suffix, so our main files will have clear names without a suffix. <br><br>  <b>Example:</b> <br>  Site.php, Users.php, Blogs.php, etc. <br>  You can look at the structure already on the finished example, and it does not make sense to dwell on this anymore. <br><br><h4>  Application Setup: config / main.php </h4><br>  As in Yii 1.0, the application is configured through the main.php file, and many elements remain unchanged, but there are still many parameters that have been renamed, which should be remembered if the application does not work after configuration. <br><br>  <b>Some examples of such changes and features:</b> <br><ul><li>  The module prikrutka now contains the required ‚Äúclass‚Äù parameter, which stores the name of the main class of the module, and without which the module cannot be connected. <br><pre><code class="php hljs"><span class="hljs-string"><span class="hljs-string">'modules'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( ... <span class="hljs-string"><span class="hljs-string">'users'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'app\modules\users\Users'</span></span> ), ... ),</code> </pre> <br></li><li>  The ‚ÄúdefaultController‚Äù parameter was removed, and ‚ÄúdefaultRoute‚Äù is used instead. </li><li>  When setting up paths to directories, you can use the specified aliases " <code>@app, @www, @wwwroot</code> ", which is very convenient. </li><li>  UrlManager also renamed several parameters.  Now ‚ÄúurlFormat‚Äù was replaced by ‚ÄúenablePrettyUrl‚Äù, ‚ÄúuseStrictParsing‚Äù by ‚ÄúenableStrictParsing‚Äù. </li><li>  In the component "db" renamed "connectionString" to "dsn". </li></ul><br>  In case of inoperability of any parameters, you can easily peep everything in the source code of the frame. <br>  As soon as we set up our application and connected our modules, we can start writing our ‚ÄúCRUD‚Äù. <br><br><h4>  CRUD </h4><br>  A detailed example is in the demo code, but, to be honest, there is no strong difference from the first version.  The only thing that has appeared is the controller method: populate (), which was recently transferred to the model and renamed to load (). <br><br>  <b>Example:</b> <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $model = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Blog(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($model-&gt;load($_POST) &amp;&amp; $model-&gt;save()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Yii::$app-&gt;response-&gt;redirect(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'view'</span></span>, <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; $model-&gt;id)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;render(<span class="hljs-string"><span class="hljs-string">'create'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'model'</span></span> =&gt; $model)); } }</code> </pre><br><pre> <code class="php hljs">$model-&gt;load($_POST) <span class="hljs-comment"><span class="hljs-comment">//    if (isset($_POST['Blog'])) { $model-&gt;attributes = $_POST['Blog']; }</span></span></code> </pre><br>  There are no other special differences in working with CRUD. <br><br><h4>  Model </h4><br>  The main innovation is the ‚Äúscenarios ()‚Äù method by which you can set up model validators depending on the specified scenario. <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scenarios</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'backend'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'email'</span></span>, <span class="hljs-string"><span class="hljs-string">'role'</span></span>), <span class="hljs-string"><span class="hljs-string">'frontend'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'email'</span></span>, <span class="hljs-string"><span class="hljs-string">'!name'</span></span>), ); }</code> </pre><br>  The model binding is done by the formName () function which ultimately returns the name of the Model Class to which the form belongs. <br>  Also an important point - model () was removed, and now the work with the model is happening, as well as with another regular class: <br><pre> <code class="php hljs"> MyModel::getAuthor();</code> </pre><br><h4>  ActiveRecord </h4><br>  Everything has been rewritten, now in Yii2 a new AR, which really pleases. <br><br>  <b>Examples of several innovations:</b> <br>  "Scopes ()" were replaced by the usual methods of the AR model, which now look like this: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">active</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($query)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $query-&gt;andWhere(<span class="hljs-string"><span class="hljs-string">'status = '</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::STATUS_ACTIVE); }</code> </pre><br>  Also, ‚Äúrelations ()‚Äù were radically changed, which are now defined as heterologues, which is more correct.  Two types of relations are available: ‚ÄúhasOne ()‚Äù, ‚ÄúhasMany ()‚Äù. <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAuthor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;hasOne(<span class="hljs-string"><span class="hljs-string">'app\modules\users\models\User'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'author_id'</span></span>)); <span class="hljs-comment"><span class="hljs-comment">//   ‚Äì     ,     . //          PK  (id)  FK     (author_id),     }</span></span></code> </pre><br>  Also, the functions of sampling from the database were rewritten, and added with new ones. <br><pre> <code class="php hljs">$customers = Customer::find() -&gt;where(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'status'</span></span> =&gt; $active)) -&gt;orderBy(<span class="hljs-string"><span class="hljs-string">'id'</span></span>) -&gt;all(); <span class="hljs-comment"><span class="hljs-comment">// return the customer whose PK is 1 $customer = Customer::find(1); $customers = Customer::find(array('status'=&gt;$active)); $customers = Customer::find()-&gt;asArray()-&gt;all(); $customers = Customer::find()-&gt;active()-&gt;asArray()-&gt;all();</span></span></code> </pre><br>  Finally, AR now automatically binds the model to the database, due to the ‚ÄútableName ()‚Äù function, which by default returns such a value ‚Äútbl_MODEL_NAME‚Äù.  For example, the ‚ÄúUser‚Äù model will be tied to the ‚Äútbl_user‚Äù table.  If the table name is different, you can simply override the function. <br><br><h4>  Developments </h4><br>  In the new version, working with events has become as simple as possible.  In the demo application, I gave an example of my own event - when adding a new user, the event is called in afterSave (), although there you can use standard events that are available in Yii, such as ‚ÄúEVENT_AFTER_INSERT‚Äù. <br><br>  In order to define an event, it is enough to call the ‚Äútrigger ()‚Äù function in the right place, and only then in the right place to set an event handler for the event. <br><br>  <b>Example:</b> <br><pre> <code class="php hljs"> app\modules\users\models\User ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">afterSave</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($insert)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   $event = new ModelEvent; $this-&gt;trigger(self::EVENT_NEW_USER, $event); parent::afterSave($insert); } ...  app\modules\users\controllers\DefaultController ... public function actionSignup() { $model = new User(); $model-&gt;scenario = 'signup'; if ($model-&gt;load($_POST)) { if (!$this-&gt;module-&gt;activeAfterRegistration) //    ,   [[EVENT_NEW_USER]] $model-&gt;on($model::EVENT_NEW_USER, array($this-&gt;module, 'onNewUser')); if ($model-&gt;save()) { Yii::$app-&gt;session-&gt;setFlash('success'); return Yii::$app-&gt;response-&gt;refresh(); } } else { echo $this-&gt;render('signup', array('model' =&gt; $model)); } } ...</span></span></code> </pre><br>  <b>There are several ways to bind a handler:</b> <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($event)</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-comment"><span class="hljs-comment">//   array($object, 'handleClick') // $object-&gt;handleClick() array('Page', 'handleClick') // Page::handleClick() 'handleClick' //   handleClick()</span></span></code> </pre><br><h4>  View </h4><br>  In Yii2, a new class has emerged that is responsible for all the views of the application, and which performs the output directly. <br>  Now in the view files, the variable "$ this" refers not to the controller, but to the new class "yii \ base \ View". <br>  In order to call a specific function of the controller or widget to which the view belongs, you need to refer to the method: "context". <br><br>  <b>Example:</b> <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//  app\modules\blogs\views\default\index // $this-&gt;context    app\modules\blogs\controllers\DefaultController //    ,       echo $this-&gt;context-&gt;module-&gt;recordsPerPage; //  10 // app\modules\comments\widgets\comments\views\index // $this-&gt;context    app\modules\comments\widgets\comments\Comments if ($this-&gt;context-&gt;model['id'] == 10 ) {...}</span></span></code> </pre><br><h4>  Widgets </h4><br>  Widgets have been supplemented with new methods, plus now they should be directly output via ‚Äúecho‚Äù. <br><br>  <b>Example:</b> <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// Note that you have to "echo" the result to display it echo \yii\widgets\Menu::widget(array('items' =&gt; $items)); // Passing an array to initialize the object properties $form = \yii\widgets\ActiveForm::begin(array( 'options' =&gt; array('class' =&gt; 'form-horizontal'), 'fieldConfig' =&gt; array('inputOptions' =&gt; array('class' =&gt; 'input-xlarge')), )); ... form inputs here ... \yii\widgets\ActiveForm::end();</span></span></code> </pre><br><h4>  Action filters </h4><br>  In the new version, the controller filters are implemented as ‚Äúbehaviors‚Äù. <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">behaviors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'access'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; \yii\web\AccessControl::className(), <span class="hljs-string"><span class="hljs-string">'rules'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-comment"><span class="hljs-comment">// allow authenticated users array( 'allow' =&gt; true, 'actions' =&gt; array('login', 'signup', 'activation'), 'roles' =&gt; array('?') ), array( 'allow' =&gt; true, 'actions' =&gt; array('logout'), 'roles' =&gt; array('@') ), array( 'allow' =&gt; true, 'actions' =&gt; array('index', 'view'), 'roles' =&gt; array('guest') ), array( 'allow' =&gt; true, 'actions' =&gt; array('edit', 'delete'), 'roles' =&gt; array('@') ), // deny all -   ,      array( 'allow' =&gt; false ) ) ) ); }</span></span></code> </pre><br>  Small nuance - only 2 roles left out of the box: <br><ul><li>  @ - authorized </li><li>  ?  - guests </li><li>  * - was deleted. </li></ul><br><h4>  Static helpers </h4><br>  Many new helpers have been added to Yii2.  For example, like the same SecurityHelper, which speeds up work with passwords and generated codes, ArrayHelper, Html, and others, which again pleases. <br><br><h4>  Activeform </h4><br>  Forms are now created even faster and more conveniently, due to the ActiveField class, which simplifies the style of writing code, which is good news. <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $form = ActiveForm::begin(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'form-horizontal'</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $form-&gt;field($model, <span class="hljs-string"><span class="hljs-string">'username'</span></span>)-&gt;textInput($model-&gt;isNewRecord ? <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>() : <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'readonly'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $form-&gt;field($model, <span class="hljs-string"><span class="hljs-string">'email'</span></span>)-&gt;textInput(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$model-&gt;isNewRecord) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Yii::$app-&gt;user-&gt;checkAccess(<span class="hljs-string"><span class="hljs-string">'editProfile'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $form-&gt;field($model, <span class="hljs-string"><span class="hljs-string">'status'</span></span>)-&gt;dropDownList(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( User::STATUS_ACTIVE =&gt; <span class="hljs-string"><span class="hljs-string">'Active'</span></span>, User::STATUS_INACTIVE =&gt; <span class="hljs-string"><span class="hljs-string">'Inactive'</span></span>, User::STATUS_DELETED =&gt; <span class="hljs-string"><span class="hljs-string">'Deleted'</span></span> )); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $form-&gt;field($model, <span class="hljs-string"><span class="hljs-string">'role'</span></span>)-&gt;dropDownList(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( User::ROLE_USER =&gt; <span class="hljs-string"><span class="hljs-string">'User'</span></span>, User::ROLE_ADMIN =&gt; <span class="hljs-string"><span class="hljs-string">'Admin'</span></span> )); } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $form-&gt;field($model, <span class="hljs-string"><span class="hljs-string">'oldpassword'</span></span>)-&gt;passwordInput(); } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $form-&gt;field($model, <span class="hljs-string"><span class="hljs-string">'password'</span></span>)-&gt;passwordInput(); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $form-&gt;field($model, <span class="hljs-string"><span class="hljs-string">'repassword'</span></span>)-&gt;passwordInput(); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;div <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">actions</span></span></span><span class="hljs-class">"&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Html</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">submitButton</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">isNewRecord</span></span></span><span class="hljs-class"> ? '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Register</span></span></span><span class="hljs-class">' : '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Update</span></span></span><span class="hljs-class">', </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">array</span></span></span><span class="hljs-class">('</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">' =&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">btn</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">btn</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">primary</span></span></span><span class="hljs-class">')); ?&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActiveForm</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class">(); ?&gt;</span></span></code> </pre><br><h4>  User and Identity </h4><br>  The user robots are now implemented through the ‚Äúyii \ web \ User‚Äù class and the ‚Äúyii \ web \ Identity‚Äù interface, which is more flexible to use. <br>  Because of these changes, user attributes can be obtained through the user‚Äôs ‚Äúidentity‚Äù method. <br><br>  <b>Example:</b> <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> Yii::$app-&gt;user-&gt;identity-&gt;username;</code> </pre><br><h4>  URL Management </h4><br>  There are slightly modified styles of writing rules. <br><br>  <b>Example:</b> <br><pre> <code class="php hljs">... <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'dashboard'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'site/index'</span></span>, <span class="hljs-string"><span class="hljs-string">'PUT post/&lt;id:\d+&gt;'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'post/update'</span></span>, <span class="hljs-string"><span class="hljs-string">'POST,PUT post/index'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'post/create'</span></span>, <span class="hljs-string"><span class="hljs-string">'POST &lt;controller:\w+&gt;s'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'&lt;controller&gt;/create'</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;controller:\w+&gt;s'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'&lt;controller&gt;/index'</span></span>, <span class="hljs-string"><span class="hljs-string">'PUT &lt;controller:\w+&gt;/&lt;id:\d+&gt;'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'&lt;controller&gt;/update'</span></span>, <span class="hljs-string"><span class="hljs-string">'DELETE &lt;controller:\w+&gt;/&lt;id:\d+&gt;'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'&lt;controller&gt;/delete'</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;controller:\w+&gt;/&lt;id:\d+&gt;'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'&lt;controller&gt;/view'</span></span>, ); ...</code> </pre><br><h4>  RBAC </h4><br>  Working with user rights is now available initially from the box without adding your code, as, for example, in the case of using the file variant in the first version. <br>  <b>Below I will write a short instruction on RBAC and a description of the roles in the file.</b> <br><br>  First we need to create our own class, which will be inherited from "\ yii \ rbac \ PhpManager". <br>  In our example, it is located in the ‚Äúrbac‚Äù module in the ‚Äúcomponents‚Äù folder called ‚ÄúPhpManager.php‚Äù. <br>  The code in it is simple.  We simply set the path to our file with the described roles, and bind the user to the desired role. <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">modules</span></span>\<span class="hljs-title"><span class="hljs-title">rbac</span></span>\<span class="hljs-title"><span class="hljs-title">components</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Yii</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PhpManager</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">yii</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rbac</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PhpManager</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;authFile === <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;authFile = Yii::getAlias(<span class="hljs-string"><span class="hljs-string">'@app/modules/rbac/components/rbac'</span></span>) . <span class="hljs-string"><span class="hljs-string">'.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::init(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Yii::$app-&gt;user-&gt;isGuest) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assign(Yii::$app-&gt;user-&gt;identity-&gt;id, Yii::$app-&gt;user-&gt;identity-&gt;role); } }</code> </pre><br>  After that, in the same folder we create the file ‚Äúrbac.php‚Äù where we describe the roles we need.  (The code can be seen in the demo application in the folder: <code>@app/modules/rbac/components/rbac</code> ) <br><br>  And finally, we just need to configure the ‚ÄúauthManager‚Äù in the configuration file: <br><pre> <code class="php hljs">... <span class="hljs-string"><span class="hljs-string">'authManager'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'app\modules\rbac\components\PhpManager'</span></span>, <span class="hljs-string"><span class="hljs-string">'defaultRoles'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'guest'</span></span>), ), ...</code> </pre><br>  After that, in the right place for us, we can safely do checks of the user for the necessary rights: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Yii::$app-&gt;user-&gt;checkAccess(<span class="hljs-string"><span class="hljs-string">'editOwnBlog'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'blog'</span></span> =&gt; $model)) || Yii::$app-&gt;user-&gt;checkAccess(<span class="hljs-string"><span class="hljs-string">'editBlog'</span></span>)) { ... }</code> </pre><br>  This is all that I managed to find out, but I am sure that there was still a lot of things that did not happen. <br><br>  At the moment, I did not have time to deal with ajax requests in Yii 2, namely, how to correctly create the necessary answer during model validation.  In 1.0, it is done like this: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> CActiveForm::validate($model);</code> </pre><br>  if anyone already knows, write, sure many will be interested. <br><br><h4>  Total </h4><br>  Despite the still unfinished look, Yii 2 already looks very good.  I am sure that only the best is waiting for us. <br><br>  Yii 2 himself really liked.  To be honest, there is already a great desire to start writing working projects on the new version, although this is still very early. <br><br>  The article turned out great, but in another way just do not know how. <br><br>  Thank you all for your attention.  Good luck! <br><br>  <a href="https://github.com/vova07/yii2-start">Demo blog on github.</a>  Installation instructions present. <br>  <a href="http://yii2-start.find-freelancer.pro/">Working example of a blog.</a> </div><p>Source: <a href="https://habr.com/ru/post/185236/">https://habr.com/ru/post/185236/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../185226/index.html">Process memory organization</a></li>
<li><a href="../185228/index.html">TechEd Europe 2013: The Future Comes Today</a></li>
<li><a href="../185230/index.html">Mikrotik - Pros and Cons</a></li>
<li><a href="../185232/index.html">Acquaintance with UnrealEngine. Part 1</a></li>
<li><a href="../185234/index.html">Android development automation</a></li>
<li><a href="../185238/index.html">Javascript: tests, compilation and MVVM</a></li>
<li><a href="../185240/index.html">Transfer of the KVM virtual machine installed on the LVM partition to another server using lvmsync</a></li>
<li><a href="../185242/index.html">Comparison of services for monitoring client sites or insurance for SEO paranoia</a></li>
<li><a href="../185244/index.html">Checkbox "Enable JavaScript" removed from the settings of Firefox 23</a></li>
<li><a href="../185246/index.html">Course lectures "Startup". Peter Thiel. Stanford 2012. Session 15</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>