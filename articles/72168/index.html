<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Webcasting - working with encodings</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Having connected to Corbin (no, this is not an advertisement), and for the sake of interest, while browsing their website, I came across a large numbe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Webcasting - working with encodings</h1><div class="post__text post__text-html js-mediator-article">  Having connected to Corbin (no, this is not an advertisement), and for the sake of interest, while browsing their website, I came across a large number of Internet radio stations, whom I immediately tried to get addicted to. <a name="habracut"></a>  My disappointment was great.  I did not find a single player that would work normally with the encoding of the tags of the stream.  The last hope was VLC, but it turned out to be the worst of all - it received only general information about the stream, but did not receive the information about the current composition transmitted by the server. <br>  Mplayer gave me the following to the console: <br><blockquote><code><a href="http://85.21.79.5/"></a> <a href="http://85.21.79.5/"></a> <a href="http://85.21.79.5/"></a> <a href="http://www.101.ru/"></a> torkvemada@inquisitia-nout ~ $ mplayer 85.21.79.5:8185/listen.pls <br> MPlayer 1.0rc2-4.3.3 (C) 2000-2007 MPlayer Team <br> CPU: Intel(R) Atom(TM) CPU N270 @ 1.60GHz (Family: 6, Model: 28, Stepping: 2) <br> CPUflags: MMX: 1 MMX2: 1 3DNow: 0 3DNow2: 0 SSE: 1 SSE2: 1 <br> Compiled with runtime CPU detection. <br> mplayer: could not connect to socket <br> mplayer: No such file or directory <br> Failed to open LIRC support. You will not be able to use your remote control. <br> <br> Playing 85.21.79.5:8185/listen.pls. <br> Resolving 85.21.79.5 for AF_INET6... <br> Couldn't resolve name for AF_INET6: 85.21.79.5 <br> Connecting to server 85.21.79.5[85.21.79.5]: 8185... <br> Cache size set to 320 KBytes <br> <br> Playing 85.21.79.5:8185/. <br> Resolving 85.21.79.5 for AF_INET6... <br> Couldn't resolve name for AF_INET6: 85.21.79.5 <br> Connecting to server 85.21.79.5[85.21.79.5]: 8185... <br> Name : 101.ru: Aquarium BG <br> Genre : N/A <br> Website: www.101.ru <br> Public : yes <br> Bitrate: 0kbit/s <br> Cache size set to 320 KBytes <br> Cache fill: 0.00% (0 bytes) <br> <b>ICY Info: StreamTitle='√Ä√ä√Ç√Ä√ê√à√ì√å - √ç√†√≥√™√® √û√≠√Æ√∏√•√© - 0:00';StreamUrl='';</b> <br> Cache fill: 15.00% (49152 bytes) <br> Audio file file format detected. <br> ========================================================================== <br> Forced audio codec: mad <br> Opening audio decoder: [libmad] libmad mpeg audio decoder <br> AUDIO: 44100 Hz, 2 ch, s16le, 96.0 kbit/6.80% (ratio: 12000-&gt;176400) <br> Selected audio codec: [mad] afm: libmad (libMAD MPEG layer 1-2-3) <br> ========================================================================== <br> AO: [pulse] 44100Hz 2ch s16le (2 bytes per sample) <br> Video: no video <br> Starting playback... <br> A: 27.8 (27.8) of -0.0 (unknown) 3.7% 45% <br> <b>ICY Info: StreamTitle='√Ä√ä√Ç√Ä√ê√à√ì√å - √Ç√•√´√®√™√®√© √Ñ√¢√Æ√∞√≠√®√™ - 0:00';StreamUrl='';</b> <br> A: 212.2 (03:32.2) of -0.0 (unknown) 3.7% 45% <br> <b>ICY Info: StreamTitle='ADVBEGIN - ADVBEGIN - 0:00';StreamUrl='';</b> <br> A: 213.5 (03:33.5) of -0.0 (unknown) 3.7% 45% <br> <b>ICY Info: StreamTitle='ADV_0001 - 0:00';StreamUrl='';</b> <br> A: 243.6 (04:03.5) of -0.0 (unknown) 3.7% 45% <br> <b>ICY Info: StreamTitle='ADVENG - ADVENG - 0:00';StreamUrl='';</b> <br> A: 247.7 (04:07.6) of -0.0 (unknown) 3.7% 45% <br> <b>ICY Info: StreamTitle='√Ä√ä√Ç√Ä√ê√à√ì√å - √Å√´√æ√ß √è√∞√Æ√±√≤√Æ√£√Æ √ó√•√´√Æ√¢√•√™√† - 0:00';StreamUrl='';</b> <br> A: 348.7 (05:48.7) of -0.0 (unknown) 3.6% 45% <br> Exiting... (Quit)</code> </blockquote> <br>  As you can see, all the information is obtained, but it turned out to be unable to recognize the cp1251 mplayer encoding.  Like all other players.  A similar situation, by the way, with a high probability would be repeated in Windows, it would be enough just to find a stream with UTF-8.  But we, fortunately, have the opportunity to rectify the situation.  In an hour of digging into mplayer source and a couple of recompilations (alas, my atom leaves much to be desired in terms of compilation speed), I sketched a small patch that allows the command line parameter to indicate in which encoding the stream comes to us and displays the information in the correct encoding.  The patch uses iconv, so if desired, it can be adapted to absolutely any player, to display both id3 tags and stream information in your linux system. <br>  All further guidance relates to APT systems (Ubuntu, Debian, possibly AltLinux etc.), but it is easy to repeat it on an arbitrary system. <br>  Run ` <b>apt-get source mplayer`</b> to get the mplayer source. <br>  Go to the resulting directory (mine is <b>mplayer-1.0 ~ rc2</b> ) and edit the files: <br><ul><li>  cfg-common.h: <br>  Add somewhere on the 90th row <br><blockquote><ol><li>  <font color="#339933">#ifdef USE_ICONV</font> </li><li>  <font color="#009900">{</font> <font color="#ff0000">"tagcp"</font> <font color="#339933">,</font> <font color="#339933">&amp;</font> tag_cp <font color="#339933">,</font> CONF_TYPE_STRING <font color="#339933">,</font> <font color="#0000dd">0</font> <font color="#339933">,</font> <font color="#0000dd">0</font> <font color="#339933">,</font> <font color="#0000dd">0</font> <font color="#339933">,</font> <font color="#000000"><b>NULL</b></font> <font color="#009900">}</font> <font color="#339933">,</font> </li><li>  <font color="#339933">#endif</font> </li></ol></blockquote></li><li>  libass / ass_mp.c: <br>  Add on line 36: <br><blockquote><ol><li>  <font color="#339933">#ifdef USE_ICONV</font> </li><li>  <font color="#000000"><b>extern</b></font> <font color="#993333">char</font> <font color="#339933">*</font> tag_cp <font color="#339933">;</font> </li><li>  <font color="#339933">#else</font> </li><li>  <font color="#993333">static</font> <font color="#993333">char</font> <font color="#339933">*</font> tag_cp <font color="#339933">=</font> <font color="#0000dd">0</font> <font color="#339933">;</font> </li><li>  <font color="#339933">#endif</font> </li></ol></blockquote></li><li>  stream / stream.h: <br>  Add to line 302: <br><blockquote><ol><li>  <font color="#000000"><b>extern</b></font> <font color="#993333">char</font> <font color="#339933">*</font> tag_cp <font color="#339933">;</font> </li></ol></blockquote></li><li>  stream / http.c: <br>  Add on line 30: <br><blockquote><ol><li>  <font color="#339933">#ifdef USE_ICONV</font> </li><li>  <font color="#339933">#include &lt;iconv.h&gt;</font> </li><li>  <font color="#993333">char</font> <font color="#339933">*</font> tag_cp <font color="#339933">=</font> <font color="#0000dd">0</font> <font color="#339933">;</font> </li><li>  <font color="#339933">#endif</font> </li></ol></blockquote><br>  And on line 121 (after the line " <b>info [len] = 0;</b> "): <br><blockquote><ol><li>  <font color="#339933">#ifdef USE_ICONV</font> </li><li>  iconv_t iconv_converter <font color="#339933">=</font> <font color="#009900">(</font> iconv_t <font color="#009900">)</font> <font color="#009900">(</font> <font color="#339933">-</font> <font color="#0000dd">1</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#993333">char</font> <font color="#339933">*</font> outcp <font color="#339933">=</font> <font color="#ff0000">"UTF-8"</font> <font color="#339933">;</font> </li><li>  <font color="#993333">char</font> <font color="#339933">*</font> incp <font color="#339933">=</font> tag_cp <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> tag_cp <font color="#339933">&amp;&amp;</font> <font color="#009900">(</font> iconv_converter <font color="#339933">==</font> <font color="#009900">(</font> iconv_t <font color="#009900">)</font> <font color="#009900">(</font> <font color="#339933">-</font> <font color="#0000dd">1</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#009900">(</font> iconv_converter <font color="#339933">=</font> iconv_open <font color="#009900">(</font> outcp <font color="#339933">,</font> incp <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">==</font> <font color="#009900">(</font> iconv_t <font color="#009900">)</font> <font color="#009900">(</font> <font color="#339933">-</font> <font color="#0000dd">1</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  mp_msg <font color="#009900">(</font> MSGT_DEMUXER <font color="#339933">,</font> MSGL_ERR <font color="#339933">,</font> <font color="#ff0000">"ICY: can't open iconv.</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> iconv_converter <font color="#339933">! =</font> <font color="#009900">(</font> iconv_t <font color="#009900">)</font> <font color="#009900">(</font> <font color="#339933">-</font> <font color="#0000dd">1</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  size_t tmp_conv_len <font color="#339933">=</font> nlen <font color="#339933">*</font> <font color="#0000dd">4</font> <font color="#339933">;</font> </li><li>  size_t conv_len <font color="#339933">=</font> tmp_conv_len <font color="#339933">;</font> </li><li>  size_t tmp_len <font color="#339933">=</font> nlen <font color="#339933">;</font> </li><li>  <font color="#993333">char</font> <font color="#339933">*</font> tmp_info <font color="#339933">=</font> info <font color="#339933">;</font> </li><li>  <font color="#993333">char</font> <font color="#339933">*</font> converted_info <font color="#339933">=</font> <font color="#009900">(</font> <font color="#993333">char</font> <font color="#339933">*</font> <font color="#009900">)</font> malloc <font color="#009900">(</font> conv_len <font color="#339933">+</font> <font color="#0000dd">1</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> converted_info <font color="#009900">)</font> </li><li>  mp_msg <font color="#009900">(</font> MSGT_DEMUXER <font color="#339933">,</font> MSGL_ERR <font color="#339933">,</font> <font color="#ff0000">"ICY: can't allocate memory.</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#993333">char</font> <font color="#339933">*</font> tmp_conv_info <font color="#339933">=</font> converted_info <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#009900">(</font> conv_len <font color="#339933">=</font> iconv <font color="#009900">(</font> iconv_converter <font color="#339933">,</font> <font color="#339933">&amp;</font> tmp_info <font color="#339933">,</font> <font color="#339933">&amp;</font> tmp_len <font color="#339933">,</font> <font color="#339933">&amp;</font> tmp_conv_info <font color="#339933">,</font> <font color="#339933">&amp;</font> tmp_conv_len <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">==</font> <font color="#009900">(</font> size_t <font color="#009900">)</font> <font color="#009900">(</font> <font color="#339933">-</font> <font color="#0000dd">1</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  mp_msg <font color="#009900">(</font> MSGT_DEMUXER <font color="#339933">,</font> MSGL_WARN <font color="#339933">,</font> <font color="#ff0000">"ICY: error while iconving info.</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  free <font color="#009900">(</font> converted_info <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">(</font> <font color="#993333">void</font> <font color="#009900">)</font> iconv_close <font color="#009900">(</font> iconv_converter <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#b1b100">else</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#339933">*</font> tmp_conv_info <font color="#339933">=</font> <font color="#ff0000">'\ 0'</font> <font color="#339933">;</font> </li><li>  free <font color="#009900">(</font> info <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  info <font color="#339933">=</font> converted_info <font color="#339933">;</font> </li><li>  <font color="#009900">(</font> <font color="#993333">void</font> <font color="#009900">)</font> iconv_close <font color="#009900">(</font> iconv_converter <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  iconv_converter <font color="#339933">=</font> <font color="#009900">(</font> iconv_t <font color="#009900">)</font> <font color="#009900">(</font> <font color="#339933">-</font> <font color="#0000dd">1</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#339933">#endif / * USE_ICONV * /</font> </li></ol></blockquote><br></li></ul><br>  It now remains to assemble and install.  We type ` <b>debuild`</b> and either get scolded for missing packages (install them and run debuild again), or after a while we have several assembled deb packages.  Install: ` <b>sudo dpkg -i ../mplayer_1.0~rc2-0ubuntu19+medibuntu1_i386.deb`</b> and fix so that the package manager does not even think about reinstalling the package from the repository: ` <b>sudo aptitude hold mplayer`</b> . <br>  Lazy can download: <br><ul><li>  <a href="http://pastebin.com/f3ddf67cc">patching diff file</a> </li><li>  <a href="http://narod.ru/disk/14050073000/mplayer-src-package.tar.gz.html">rebuild src package</a> </li><li>  <a href="http://narod.ru/disk/14051087000/mplayer-deb-packages.tar.gz.html">ready mplayer packages</a> </li></ul><br>  Now we specify the parameter `tagcp` and enjoy: <br><blockquote> <code><a href="http://85.21.79.5/"></a> <a href="http://85.21.79.5/"></a> <a href="http://85.21.79.5/"></a> <a href="http://www.101.ru/"></a> torkvemada@inquisitia-nout ~ $ mplayer <b>-tagcp cp1251</b> 85.21.79.5:8185/listen.pls <br> MPlayer 1.0rc2-4.3.3 (C) 2000-2007 MPlayer Team <br> CPU: Intel(R) Atom(TM) CPU N270 @ 1.60GHz (Family: 6, Model: 28, Stepping: 2) <br> CPUflags: MMX: 1 MMX2: 1 3DNow: 0 3DNow2: 0 SSE: 1 SSE2: 1 <br> Compiled with runtime CPU detection. <br> mplayer: could not connect to socket <br> mplayer: No such file or directory <br> Failed to open LIRC support. You will not be able to use your remote control. <br> <br> Playing 85.21.79.5:8185/listen.pls. <br> Resolving 85.21.79.5 for AF_INET6... <br> Couldn't resolve name for AF_INET6: 85.21.79.5 <br> Connecting to server 85.21.79.5[85.21.79.5]: 8185... <br> Cache size set to 320 KBytes <br> <br> Playing 85.21.79.5:8185/. <br> Resolving 85.21.79.5 for AF_INET6... <br> Couldn't resolve name for AF_INET6: 85.21.79.5 <br> Connecting to server 85.21.79.5[85.21.79.5]: 8185... <br> Name : 101.ru: Aquarium BG <br> Genre : N/A <br> Website: www.101.ru <br> Public : yes <br> Bitrate: 0kbit/s <br> Cache size set to 320 KBytes <br> Cache fill: 0.00% (0 bytes) <br> <b>ICY Info: StreamTitle=' -   - 0:00';StreamUrl='';</b> <br> Cache fill: 15.00% (49152 bytes) <br> Audio file file format detected. <br> ========================================================================== <br> Forced audio codec: mad <br> Opening audio decoder: [libmad] libmad mpeg audio decoder <br> AUDIO: 44100 Hz, 2 ch, s16le, 96.0 kbit/6.80% (ratio: 12000-&gt;176400) <br> Selected audio codec: [mad] afm: libmad (libMAD MPEG layer 1-2-3) <br> ========================================================================== <br> AO: [pulse] 44100Hz 2ch s16le (2 bytes per sample) <br> Video: no video <br> Starting playback... <br> A: 14.9 (14.8) of -0.0 (unknown) 6.6% 45% <br> <b>ICY Info: StreamTitle=' -  ‚Ññ2 - 0:00';StreamUrl='';</b> <br> A: 19.8 (19.8) of -0.0 (unknown) 6.5% 46% <br> Exiting... (Quit) <br></code> </blockquote></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/72168/">https://habr.com/ru/post/72168/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../72158/index.html">Wi-Fi access point with WPA based on EEE 701</a></li>
<li><a href="../7216/index.html">The modern worldview system is based on the fallacies of the past.</a></li>
<li><a href="../72162/index.html">Tea drinking with Intel</a></li>
<li><a href="../72163/index.html">BSkyB launches rival iTunes and Spotify</a></li>
<li><a href="../72167/index.html">A simple bash script to run the editor.</a></li>
<li><a href="../72172/index.html">Vulnerabilities of five thousand sites</a></li>
<li><a href="../72175/index.html">VS wizard: PHP extension</a></li>
<li><a href="../72176/index.html">Your questions Ann Wyler (Microsoft Office products)</a></li>
<li><a href="../72178/index.html">US scouts against the closure of social networks</a></li>
<li><a href="../72179/index.html">Home reliable system for active backups</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>