<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Features of dependency injection in Unity3D</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 

 When I got acquainted with the development under Unity3D, for me, who came from the world of Java and PHP, the approach to the implementa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Features of dependency injection in Unity3D</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr! <br><br>  When I got acquainted with the development under Unity3D, for me, who came from the world of Java and PHP, the approach to the implementation of dependencies on this platform became quite unusual.  Basically, of course, this is due to the inaccessibility of the MonoBehaviour and ScriptableObject constructors, creation of objects beyond developer access, and the presence of an editor in which you can configure each object individually or with whole prefabs (while leaving one of the instances of the prefab to change at its discretion in the create a scene). <br><a name="habracut"></a><br><h3>  Constructor injection </h3><br>  Constructors are fine, but smoothly until you start using MonoBehaviour or ScriptableObject, instances of which can be created only through ready-made factories, implying the use of a constructor without parameters. <br><br>  For the first case, the factory will be the GameObject.AddComponent (T) method, where T is the type of component being created.  There is no successor to MonoBehaviour, apart from a specific game object.  For him, injection of dependence through the constructor or its analog is impossible.  What we, naturally, do not want to do.  So, here we will introduce dependencies in other ways. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For ScriptableObject, the factory is the method ScriptableObject.CreateInstance (T), where T is, again, the type of the object.  But the situation is not fundamentally different from MonoBehaviour - you cannot use your own constructor. <br><br>  But, since the heirs of this class are independent entities and quietly exist without being tied to a specific game object, sometimes to bypass the ScriptableObject constructor, an initialization method is used, to which all necessary parameters are passed.  For convenience, the CreateInstance method is overridden for each successor of a ScriptableObject with indication of the parameters of the constructor in order not to knock on each instance in Init.  But, as you and I understand, this greatly complicates the implementation and use of the class: it requires checking (wherever possible) for initialization, and in-out there is a risk that somewhere an instance will be created without initialization, through the standard CreateInstance .  For these two reasons, I try to avoid this use of the Init method. <br><br><h3>  Property Injection </h3><br>  But injection of dependencies through the public properties of an object is already in the Unity3D style.  This is how the inspector works with setting parameters for prefab components and scene objects.  For scalar parameters, everything is quite simple - just write the values ‚Äã‚Äãof each property of the object in the corresponding field of the inspector form.  But with links to objects all less clear. <br><br><h4>  Link to prefab or own component </h4><br>  A small disclaimer: by "own", I mean a component hung on the same game object as the script in which we inject the dependency. <br><br>  The peculiarity of this option is that the reference to your own component or prefab can be saved to the prefab of an object and easily used in the future.  For example, we can create N generators (spawners) of monsters, specifying each monster that it must generate, and then save these generators to prefabs and reuse as many times as needed without any difficulty whatsoever.  Changing the dependency (i.e. the selected monster) is easy - in any generator used on the stage, we replace the reference to the monster object, save the prefab and everything, at all levels it is changed.  Here they are, the delights of dependency injection! <br><br><h4>  External component reference </h4><br>  Here the difficulty lies in the fact that in the prefab of an object it is impossible to save a link to an object located on the stage, which is quite logical, since the prefab is an entity independent of the scene.  And there are several solutions to this problem: <br><ul><li>  Manual implementation; </li><li>  "Baking" dependencies; </li><li>  Global access; </li><li>  Introduction through the generating object; </li><li>  Globally accessible event creation; </li><li>  IoC containers. </li></ul><br><br><h5>  Manual implementation </h5><br>  As in the case with the creation of prefabs, we simply point out the dependencies of each object in the inspector.  This option works if we have few such objects with dependencies.  But when there are many (or a large number of scenes), then this option is unlikely to suit us.  And when changing dependencies, we‚Äôll have to redo everything anew, so it‚Äôs rather an anti-pattern, against which even a singleton looks even more beautiful. <br><br><h5>  "Baking" dependencies </h5><br>  This option, as in the case of manual implementation, works only with the dependencies of objects already created on the scene.  We need to add an editor script that will go through all the objects of the scene of a certain type and slip the specified component into the public property.  That is, bake dependencies in objects (small addition - all component fields that have been modified in the editor in this way should be marked dirty (blank?) Using the EditorUtility.SetDirty method, otherwise they will be reset to their original value when the game starts) . <br><br><h5>  Global access </h5><br>  For global access, I think it‚Äôs not necessary to paint in detail (we all did that when we started programming) - the object used as a dependency is accessed via a public static property or method to get a reference to an object instance.  Call it the proud words of "addiction" can be a stretch, but sometimes, in practice, it is necessary to use anti-patterns, is not it? <br><br><h5>  Generating object </h5><br>  If our objects are the result of the work of a certain generating entity (and one way or another it is present, if game objects are created during the life of the application - you call GameObject.Instantiate somewhere), then it is through this object that you can transfer the dependencies of all the "children".  That is, the dependency is indicated in the public field of the generating object and is transmitted to the generated entities.  The only catch is that if he creates different objects, then this dependency must either be specified in the abstract class of generated objects, or, if the dependency is individual, one will have to additionally describe the initialization rules for one or another object. <br><br><h5>  Global object creation event </h5><br>  C # is beautiful with such a simple but cool thing as events.  Which, in particular, can be made static, that is, output to the global scope (the degree of globalization can be limited to one namespace using the access modifier internal). <br><br>  To implement this method of dependency injection, we need to select a static event raised in the Awake method and to which a certain listener will subscribe to the objects it implements.  And then ask these objects certain parameters.  This method is very, very controversial (in general, like any globally accessible objects), since the programmer will have to monitor the presence of the listener.  Fortunately, Unity3D informs the developer about the empty public property of MonoBehaviour via a message in the console, but you will not have to rely on the IDE here.  Yes, and follow all these initializers will be difficult.  Writes this item to dirty anti-patterns. <br><br><h5>  IoC containers </h5><br>  In my practice, this method is in all languages ‚Äã‚Äãknown to me, perhaps the most popular. <br><br>  What is a container?  This is a list of matches between the interface and the specific object that implements this interface.  However, since we work with objects created by the platform itself, and not by us, in the container configurator you will have to implement a search for specific components on the scene or, again, specify them through the inspector (that is, the container must be a component of some object on the scene).  Further, in scripts where dependency injection is used, a reference to the required object is pulled out of the container. <br><br>  The main difficulty here - Unity3D is not friendly with interfaces (in the UnityEngine namespace, for example, the interface is just the one and the one for serialization).  And he cannot search for components by interfaces.  Just as it does not know how to show fields in the inspector, whose types are specified by interfaces.  This is understandable, since there is expected to be a successor of the Component class, and there is no interface that would imply it.  But on the Internet there are many examples of how to implement a search for components on the interface, so if we are ready to sacrifice the opportunity to use the inspector (or are ready to write an extension for it), you can use IoC containers. <br><br>  A simple but due to this clear example of an IoC container can be viewed <a href="http://www.codeproject.com/Articles/774606/Simple-IoC-Container-for-Unity-d">here</a> (the implementation is not mine).  Unfortunately, it does not include an example of searching objects by interfaces. <br><br><h2>  Afterword </h2><br>  The implementation of dependencies in Unity3D is somewhat non-standard due to the peculiarities of the platform.  By the way, while writing this article, I monitored the Internet a lot about ready-made solutions on the topic and came to the conclusion that it is worth finding a free moment in the near future and be confused with writing a small library for the same IoC containers with a full configurator adapted for Unity3D, There are not many ready-made solutions.  I hope that soon the code will be publicly available on GitHub, and another article from me will appear on Habrahabr. <br><br>  Thanks for attention :) <br><br>  PS: I will be very grateful for pointing out errors in the text in a personal. </div><p>Source: <a href="https://habr.com/ru/post/245589/">https://habr.com/ru/post/245589/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245575/index.html">Situation: Shares of Russian technology companies are getting cheaper again</a></li>
<li><a href="../245579/index.html">Implementation of HSR</a></li>
<li><a href="../245581/index.html">Alan Cooper on the interface</a></li>
<li><a href="../245583/index.html">Evil Icons: how we invented SVG icons</a></li>
<li><a href="../245587/index.html">Targeting and monitoring activities based on the Eisenhower matrix</a></li>
<li><a href="../245593/index.html">Trilateration with iBeacon</a></li>
<li><a href="../245595/index.html">We help the user to confirm Email</a></li>
<li><a href="../245597/index.html">The first P2P browser from the creators of BitTorrent</a></li>
<li><a href="../245599/index.html">In the world of mathematical paradoxes</a></li>
<li><a href="../245601/index.html">Opera 12.17 tries to upgrade to 25</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>