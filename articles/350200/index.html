<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Monitoring system organization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Monitoring is the main thing that the admin has. Admins are needed for monitoring, and monitoring is needed for admins. 





 Over the past few years...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Monitoring system organization</h1><div class="post__text post__text-html js-mediator-article"><p>  Monitoring is the main thing that the admin has.  Admins are needed for monitoring, and monitoring is needed for admins. </p><br><p><img src="https://habrastorage.org/webt/2e/ur/27/2eur27_pskz6wev1ly4n_yz3dnu.png"></p><br><p>  Over the past few years, the monitoring paradigm itself has changed.  A new era has already arrived, and if now you are monitoring the infrastructure as a set of servers, you are not monitoring almost anything.  Because now ‚Äúinfrastructure‚Äù is a multi-layered architecture, and there are tools for monitoring each level. </p><br><p>  In addition to problems like "server fell", "you need to replace the screw in the raid", now you need to understand the problems of the application level and business level: "interaction with microservice is so slowed down", "there are too few messages in the queue for the current time", "execution time requests to the database in the application grows, requests - such and such. " </p><br><p>  We support about five thousand servers in a variety of configurations: from systems of three servers with custom Docker networks, to large projects with hundreds of servers in Kubernetes.  And we need to somehow monitor all of this, understand in time that something has broken and quickly repaired.  To do this, we need to understand what monitoring is, how it is built in modern realities, how to design it and what it should do.  About this and I would like to tell. </p><a name="habracut"></a><br><h3 id="kak-bylo-ranshe">  As it was before </h3><br><p>  Ten years ago monitoring was much easier than now.  However, the applications were simpler. </p><br><p>  Mainly monitored system indicators: CPU, memory, disks, network.  This was quite enough, because there was one application spinning on php, and nothing else was used.  The problem is that according to such indicators there is usually little that can be said.  Either working or not.  What exactly happens to the application itself is difficult to understand above the level of system indicators. </p><br><p>  If the problem was at the application level (not just ‚Äúthe site is not working‚Äù, but ‚Äúthe site is working, but something is wrong‚Äù), then the client himself wrote or called, informed that there was such a problem, we went and understood, because we ourselves could not notice such problems. </p><br><p><img src="https://habrastorage.org/webt/l7/vu/1b/l7vu1bfaoaqw83wsu8ecpqfwyri.png"></p><br><h3 id="kak-seychas">  Like now </h3><br><p>  Now there are completely different systems: with scaling, autoscaling, microservices, dockers.  Systems have become dynamic.  Often, no one really knows exactly how everything works, on how many servers, how exactly it is deployed.  It lives its own life.  Sometimes it is even unknown what and where is running (if it is Kubernetes, for example). </p><br><p>  The increasing complexity of the systems themselves, of course, entailed a greater number of possible problems.  Appeared application metrics, the number of threads running in a Java application, the frequency of garbage collector pauses, the number of events in the queue.  It is very important that monitoring also monitors system scaling.  Suppose you have Kubernetes HPA.  It is necessary to understand how many pods are launched, and from each pod launched there should be metrics to the application monitoring system, to apm. </p><br><p>  All this needs to be monitored, because all this is reflected in the operation of the system. <br>  And the problems themselves became less obvious. </p><br><p>  Conventionally, the problems can be divided into two large groups: <br>  Problems of the first kind - the basic, ‚Äúuser functionality‚Äù does not work. <br>  Problems of the second kind - something does not work as it should, and can lead somewhere not there. </p><br><p>  That is, now it is necessary to monitor not only the discrete ‚Äúworks / does not work‚Äù, but much more gradations.  Which, in turn, allows you to catch the problem before everything collapses. </p><br><p>  In addition, it is now necessary to monitor the business performance.  The business wanted to have charts about money, how often orders go, how much time has passed since the last order, and so on - this is now also the task of monitoring. </p><br><h3 id="pravilnyy-monitoring">  Proper monitoring </h3><br><h4 id="proektirovanie-i-voobsche">  Design and generally </h4><br><p>  The idea of ‚Äã‚Äãwhat exactly needs to be monitored should be laid at the time of developing the application and architecture, and it‚Äôs not so much about the server architecture as about the architecture of the application as a whole. </p><br><p>  Developers / architects should understand which parts of the system are critical for the operation of the project and business, and think in advance that their performance should be checked. </p><br><p>  Monitoring should be convenient for the admin, and give an idea of ‚Äã‚Äãwhat is happening.  The purpose of monitoring is to receive an alert in time, quickly understand from schedules what is happening and what needs to be repaired. </p><br><h4 id="metriki-i-opovescheniya-alerty">  Metrics and alerts (alerts) </h4><br><p>  Alerts should be as clear as possible: the administrator, having received an alert, even if he is not familiar with the system, must understand what this alert is about, what documentation to look at, or at least whom to call.  There should be clear instructions on what to do and how to solve the problem. </p><br><p>  When a problem occurs, I really want to understand what caused it.  Receiving an alert that the application does not work for you, you would very much like to know what other related systems behave differently, what other deviations from the norm there are.  There should be clear graphics collected in dashboards, from which you will immediately see where the deviation is. </p><br><p>  To do this, you need to understand exactly what is normal and what is not normal.  That is, there must be sufficient historical information about the state of the system.  The task is to cover all possible deviations from the norm with alerts. </p><br><p>  When an admin receives an alert, he either needs to know what to do with it, or who to ask.  There should be an instruction on how exactly to react, and it should be regularly updated.  If everything works for you through the orchestration system, then probably you are fine, if all changes occur only through it, including monitoring.  The orchestration system allows you to adequately monitor the relevance of monitoring. </p><br><p>  Monitoring should be expanded after each accident - if suddenly there is some problem that has slipped past monitoring, then obviously it is necessary to monitor this situation so that the next time the problem is not sudden. </p><br><h4 id="biznes-pokazateli">  Business performance </h4><br><p>  It is useful to monitor the time from the last sale, the number of sales for the period.  If you posted a release, then what has changed: is there a drawdown on business indicators?  This is answered, of course, by A / B testing, but I would also like to have graphics.  And it is necessary to monitor the actions of the end user: write scripts on phantomjs, which repeat the purchase, go through all stages of the main business process. </p><br><p>  Also, you are probably interested to know whether the logistics service is working, or whether IpGeoBase has failed once again.  (Editor's comment: IpGeoBase is a service that uses a large number of online stores on 1C-Bitrix to determine the user's location. Most often, this is done directly in the page load code, and when IpGeoBase falls, dozens of websites stop responding. Someone please , tell the programmers that this needs to be processed and timed out, and someone - please ask IpGeoBase not to fall). </p><br><p>  It is necessary to understand whether the drawdown of business indicators depends on your system, or on the external one. </p><br><h4 id="monitoring-monitoringa">  Monitoring monitoring </h4><br><p>  The monitoring itself should also be monitored somehow.  There should be some external custom script that will check that monitoring is working properly.  No one wants to wake up from the call, because your monitoring system has dropped along with the entire data center, and nobody has told you about it. <br><img src="https://habrastorage.org/webt/5v/h8/mv/5vh8mvmi-skmfmu0jiubdp7k9bq.png"></p><br><h3 id="osnovnye-instrumenty">  Basic tools </h3><br><p>  In modern systems that scale, you probably use Prometheus, because there are no analogues in principle.  In order to view convenient graphics from Prometheus, Grafana is needed, because in Prometheus, graphics are so-so.  We also need some kind of APM.  Either this is a self-written system on Open Trace, jaeger, or something like that.  But it rarely does.  Mostly used is either New Relic, or specific systems for stacks, such as Dripstat.  If you have more than one monitoring system, not one Zabbix, you still need to understand how to collect these metrics and how to distribute alerts;  whom to notify, whom to raise, in what order, to whom what alert belongs, and what to do with it in general. </p><br><p>  Now in order. </p><br><p>  Zabbix is ‚Äã‚Äãnot the most convenient system.  There are problems with custom metrics, especially if the system is scaled, and you need to define roles.  And although you can build very custom charts, alerts and dashboards, all this is not very inconvenient and non-dynamic.  This is a static monitoring system. </p><br><p><img src="https://habrastorage.org/webt/w3/w7/gr/w3w7gro9qe2yrkvs5cydeecz-qu.png"></p><br><p>  Prometheus is a great solution for building a huge number of metrics.  He has about the same opportunities as Zabbix for custom alerts.  You can display graphs and build alerts for any wild combinations of several parameters.  And all this is very cool, but very uncomfortable to watch, so Grafana is added to it.  Grafana is very beautiful.  But by itself, it does not really help to monitor systems.  But on it is convenient to read everything.  Better charts, probably not. </p><br><p><img src="https://habrastorage.org/webt/lz/p9/qz/lzp9qztpupy0vfodsxifl3vwvms.png"></p><br><p>  ELK and Graylog - to collect logs for events in the application.  It may be useful for developers, but for detailed analytics is usually not enough. </p><br><p><img src="https://habrastorage.org/webt/kj/lx/ow/kjlxowlwgicbur37_dysnndevrw.png"></p><br><p>  New Relic - APM, also useful for developers.  It is possible to understand when something is wrong in your application right now.  It is clear which of the external services do not work very well, or which of the bases is slowly responding, or which system interaction is squandering. </p><br><p><img src="https://habrastorage.org/webt/-p/uy/7j/-puy7jk7kcnskasu75qongfgy8a.png"></p><br><p>  Your APM - if you wrote your system on Open Tracing, zipkin or jaeger, then you probably know exactly how this should work, and what exactly, and in which part of the code goes wrong.  New Relic also allows you to understand this, but it is not always convenient. </p><br><h3 id="zaklyuchenie">  Conclusion </h3><br><p>  It is better to think about what indicators should be monitored during the system design, to think in advance about which parts of the system are critical for its work and how to check their work. <br>  Alerts should not be too many, alerts should be relevant.  It should be immediately clear what was broken and how to fix it. <br>  In order to properly monitor business indicators, you need to understand how business processes are organized, what your analysts need, whether there are enough tools to measure the necessary indicators, and how quickly you can find out if something goes wrong. </p><br><p>  In the next post we will describe how to properly plan the monitoring of modern infrastructure, at all levels: at the system, application and business levels. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/350200/">https://habr.com/ru/post/350200/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350186/index.html">What I miss from Rust in C</a></li>
<li><a href="../350188/index.html">ASP.NET Core: Attack Prevention Mechanisms 2.0</a></li>
<li><a href="../350192/index.html">Deep learning in the cloud: optical computers will replace the GPU</a></li>
<li><a href="../350194/index.html">Antivirus usability on the phone</a></li>
<li><a href="../350198/index.html">Basics of cryptography. Part 0</a></li>
<li><a href="../350202/index.html">Ensuring automation of domain ownership verification based on ACME DNS records [translation]</a></li>
<li><a href="../350204/index.html">March 15, QIWI will bring back-end developers to QIWI SERVER PARTY 2.0</a></li>
<li><a href="../350206/index.html">Development of a biometric speech identification system</a></li>
<li><a href="../350208/index.html">Programming Languages ‚Äã‚Äãfor a Quantum Computer</a></li>
<li><a href="../350210/index.html">Play with ormats</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>