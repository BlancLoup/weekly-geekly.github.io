<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RoboGuice or "Android hooked on injections"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="RoboGuice is a library that allows you to enjoy all the benefits of Contexts and Dependency Injection when developing applications on Android. 
 As yo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RoboGuice or "Android hooked on injections"</h1><div class="post__text post__text-html js-mediator-article"><img src="http://code.google.com/p/roboguice/logo" alt="image" align="left">  <a href="http://code.google.com/p/roboguice/">RoboGuice</a> is a library that allows you to enjoy all the benefits of Contexts and Dependency Injection when developing applications on Android. <br>  As you can guess, RoboGuice is based on <a href="http://code.google.com/p/google-guice/">Google Guice</a> . <br>  At once I will make a reservation that as a translation of the word ‚Äúinjection‚Äù I will use the word ‚Äúinjection‚Äù. <br><br><h4>  Why prick? </h4><br>  I think that many readers will immediately have a question: ‚ÄúWhy are these difficulties with CDI on a mobile platform?  Surely this all takes up a lot of space and works slowly. ‚Äù <br>  I will try to convince such readers of the opposite, namely that CDI on a mobile platform is very viable and makes life much easier for developers. <br><a name="habracut"></a><br><img src="https://habrastorage.org/getpro/habr/post_images/e73/071/72c/e7307172c3b2c63b9dbbe0a6887ebb78.png" alt="RoboGuice" align="right"><br><h5>  Lyrical digression </h5><br>  After the epoch of fascination and the widespread use of XML, there was a sobering up when everyone was tired of the "wrinkles" of XML files.  Began the search for new approaches that would reduce the amount of configuration code and speed up development.  One of these outputs was CDI, based on annotations.  The second can be called the approach " <i>programming under agreements</i> " ( <i>Convention over configuration</i> or <i>coding by convention</i> ).  Developers liked it, ideas developed, several CDI implementations appeared, many large libraries began to use CDI through annotations. <br>  As a result, CDI was standardized for Java in the form of <a href="http://jcp.org/en/jsr/detail%3Fid%3D330">JSR-330</a> , as well as ( <a href="http://jcp.org/en/jsr/detail%3Fid%3D299">JSR-299</a> ), officially included in Java EE 6. <br>  Personally, I first saw the CDI in the Seam library.  And I was pleasantly surprised by the simplicity and elegance of the approach.  Saving development time, simplifying configuration, reducing the total volume and, accordingly, possible errors. <br>  Over time, annotations have penetrated almost everywhere.  After the XML mania, the era of annotations has arrived.  And it would be very strange if they did not get to Android. <br><br><h5>  So why is it on a mobile platform? </h5><br>  The answer is simple: to make development faster and easier, and the code is cleaner and more reliable. <br>  Not to be unfounded, let's take an example from <a href="http://code.google.com/p/roboguice/wiki/SimpleExample">Roboguice Get Started</a> . <br>  This is what an ordinary Activity class looks like: <br><pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AndroidWay</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span></span>{ TextView name; ImageView thumbnail; LocationManager loc; Drawable icon; String myName; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.main); name = (TextView) findViewById(R.id.name); thumbnail = (ImageView) findViewById(R.id.thumbnail); loc = (LocationManager) getSystemService(Activity.LOCATION_SERVICE); icon = getResources().getDrawable(R.drawable.icon); myName = getString(R.string.app_name); name.setText( <span class="hljs-string"><span class="hljs-string">"Hello, "</span></span> + myName ); } }</code> </pre> <br>  Here are 19 lines of code.  5 lines of code in the <code>onCreate()</code> method is a trivial initialization of class fields, and only one, the last line carries the meaning: name.setText ().  More complex implementations of the Activity classes can contain even more code for initializing objects. <br>  Now compare with what RoboGuice allows: <br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RoboWay</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RoboActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@InjectView</span></span>(R.id.name) TextView name; <span class="hljs-meta"><span class="hljs-meta">@InjectView</span></span>(R.id.thumbnail) ImageView thumbnail; <span class="hljs-meta"><span class="hljs-meta">@InjectResource</span></span>(R.drawable.icon) Drawable icon; <span class="hljs-meta"><span class="hljs-meta">@InjectResource</span></span>(R.string.app_name) String myName; <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> LocationManager loc; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.main); name.setText( <span class="hljs-string"><span class="hljs-string">"Hello, "</span></span> + myName ); } }</code> </pre><br>  Now <code>onCreate()</code> much more concise and easier to <code>onCreate()</code> ;  minimum template code, maximum code relating to the application logic. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  First shot </h4><br>  To make the ‚Äúfirst shot‚Äù more vital, I will give a good familiar example from <a href="http://developer.android.com/index.html">developer.android.com</a> on injections: <a href="http://developer.android.com/resources/tutorials/notepad/index.html">Notepad Tutorial</a> .  It is perfectly disassembled on the shelves, its source codes are available and it will be quite enough to modify and implement the ideas of CDI. <br>  To start using RoboGuice in a project, you need to add two libraries to the classpath: <a href="http://code.google.com/p/roboguice/wiki/Downloads">RoboGuice</a> and <a href="http://code.google.com/p/google-guice/downloads/list">guice-2.0-no_aop.jar</a> (but not guice-3.0). <br>  You can also add as a dependency in maven (yes, the Andoird project and Maven are quite compatible, but this is a topic for a separate article): <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.roboguice<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>roboguice<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Then you need to create a class that inherits from <code>RoboApplication</code> : <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotepadApplication</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RoboApplication</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre><br>  and register it in <code>AndroidManifest.xml</code> : <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.android.demo.notepad3.NotepadApplication"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Now we will rewrite a little <code>NoteEdit</code> class.  Add resource injections and <code>NotesDbAdapter</code> , inherit from <code>RoboActivity</code> . <br>  It was: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NoteEdit</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RoboActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> NotesDbAdapter mDbHelper; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> EditText mTitleText; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> EditText mBodyText; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long mRowId; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.note_edit); setTitle(R.string.edit_note); mDbHelper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotesDbAdapter(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); mDbHelper.open(); mTitleText = (EditText) findViewById(R.id.title); mBodyText = (EditText) findViewById(R.id.body); Button confirmButton = (Button) findViewById(R.id.confirm); ... } ... }</code> </pre><br>  It became: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NoteEdit</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RoboActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> NotesDbAdapter mDbHelper; <span class="hljs-meta"><span class="hljs-meta">@InjectView</span></span>(R.id.title) EditText mTitleText; <span class="hljs-meta"><span class="hljs-meta">@InjectView</span></span>(R.id.title) EditText mBodyText; <span class="hljs-meta"><span class="hljs-meta">@InjectView</span></span>(R.id.confirm) Button confirmButton; <span class="hljs-meta"><span class="hljs-meta">@InjectResource</span></span>(R.string.edit_note) String title; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long mRowId; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.note_edit); setTitle(title); mDbHelper.open(); ... } ... }</code> </pre><br>  Approximately also modify <code>Notepadv3</code> .  Inherit from <code>RoboListActivity</code> , add an injection for the <code>NotesDbAdapter</code> and remove the initialization of this <code>NotesDbAdapter</code> from <code>onCreate()</code> . <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Notepadv3</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RoboListActivity</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> NotesDbAdapter mDbHelper; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.notes_list); mDbHelper.open(); fillData(); registerForContextMenu(getListView()); } ... }</code> </pre><br>  And we update the <code>NotesDbAdapter</code> constructor <code>NotesDbAdapter</code> that the <code>Context</code> automatically substituted with RoboGuice. <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NotesDbAdapter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context ctx)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mCtx = ctx; }</code> </pre><br>  We start, we check - it works! <br>  The code became less, functionality remained, readability increased. <br>  It is worth noting that RoboGuice can make injections not only of the <code>Context</code> class, but also of many other service objects of Android, including  <code>Application</code> , <code>Activity</code> and various services.  A full list is available <a href="http://code.google.com/p/roboguice/wiki/ProvidedInjections">here</a> . <br><br><h4>  We increase the dose </h4><br>  To further demonstrate the capabilities of RoboGuice, we will refactor the <code>NotesDbAdapter</code> class.  In my opinion, it is heavily overloaded and requires the decomposition of the <code>DatabaseHelper</code> and the <code>NotesDbAdapter</code> itself.  As the project grows, <code>DatabaseHelper</code> will definitely be used by several classes.  For example, a <code>TasksDbAdapter</code> appears.  Moreover, I personally do not like the violent challenge <code>mDbHelper.open();</code>  .  This method should be called in two places.  It is tempting to forget to make this call and get an error.  So let's get started. <br>  Let's start with <code>NotesDbAdapter</code> .  Here are a bunch of extra fields: <br><ul><li>  <code>Context mCtx</code> , which is used only to initialize <code>DatabaseHelper</code> </li><li>  <code>DatabaseHelper mDbHelper</code> , because only <code>SQLiteDatabase mDb</code> actually used </li><li>  Static fields: <code>DATABASE_CREATE, DATABASE_VERSION, DATABASE_NAME</code> , which have little to do with the logic of saving and receiving notes to / from the database. </li></ul><br>  In fact, I would like to leave only <code>SQLiteDatabase mDb</code> .  The rest is removed.  In addition, we will make <code>NotesDbAdapter</code> ‚Äúsingleton‚Äù. <br>  Total we have the following goal: <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Singleton</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotesDbAdapter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String KEY_TITLE = <span class="hljs-string"><span class="hljs-string">"title"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String KEY_BODY = <span class="hljs-string"><span class="hljs-string">"body"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String KEY_ROWID = <span class="hljs-string"><span class="hljs-string">"_id"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String TAG = <span class="hljs-string"><span class="hljs-string">"NotesDbAdapter"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String DATABASE_TABLE = <span class="hljs-string"><span class="hljs-string">"notes"</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SQLiteDatabase mDb; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NotesDbAdapter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } ... }</code> </pre><br>  <code>KEY_TITLE, KEY_BODY, KEY_ROWID, DATABASE_TABLE, TAG</code> left, because  they are most relevant to the <code>NotesDbAdapter</code> . <br>  There is no <code>open()</code> method in the new class.  Let's transfer logic of this method to <code>DatabaseHelper</code> . <br>  Now we need to get <code>SQLiteDatabase mDb</code> .  Obviously, <code>DatabaseHelper</code> should do this.  To teach him to do this, we implement the <code>com.google.inject.Provider</code> interface, which, using the <code>get()</code> method, returns one or another created object. <br>  In addition, we inject the application context into the constructor. <br>  As a result, the <code>DatabaseHelper</code> class will look like this: <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Singleton</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DatabaseHelper</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SQLiteOpenHelper</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Provider</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SQLiteDatabase</span></span></span><span class="hljs-class">&gt;</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String TAG = <span class="hljs-string"><span class="hljs-string">"DatabaseHelper"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String DATABASE_CREATE = <span class="hljs-string"><span class="hljs-string">"create table notes (_id integer primary key autoincrement, "</span></span> + <span class="hljs-string"><span class="hljs-string">"title text not null, body text not null);"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String DATABASE_NAME = <span class="hljs-string"><span class="hljs-string">"data"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> DATABASE_VERSION = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SQLiteDatabase mDb; <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DatabaseHelper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context, DATABASE_NAME, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, DATABASE_VERSION); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SQLiteDatabase </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mDb == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || !mDb.isOpen()) { mDb = getWritableDatabase(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mDb; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SQLiteDatabase db)</span></span></span><span class="hljs-function"> </span></span>{ db.execSQL(DATABASE_CREATE); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onUpgrade</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SQLiteDatabase db, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> oldVersion, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newVersion)</span></span></span><span class="hljs-function"> </span></span>{ ... } }</code> </pre><br>  Now let's point out RoboGuice that the <code>SQLiteDatabase</code> class <code>SQLiteDatabase</code> provided by the provider class <code>DatabaseHelper</code> .  To do this, create a configuration class, the so-called.  module, and register it in the system (in <code>NotepadApplication</code> ) <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotepadModule</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractAndroidModule</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ bind(SQLiteDatabase.class).toProvider(DatabaseHelper.class); } }</code> </pre><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotepadApplication</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RoboApplication</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addApplicationModules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;Module&gt; modules)</span></span></span><span class="hljs-function"> </span></span>{ modules.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotepadModule()); } }</code> </pre><br>  We start, we try - it works! <br><br>  The <code>NotepadModule.configure()</code> method can be extended to bind other types, for example, substitutions for specific interface implementations: <br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ bind(SQLiteDatabase.class).toProvider(DatabaseHelper.class); bind(FilterDao.class).to(FilterDaoHttp.class); bind(ItemDao.class).annotatedWith(Http.class).to(ItemDaoHttp.class); }</code> </pre><br>  In other words, all <a href="http://code.google.com/p/google-guice/wiki/Bindings">types of binding</a> are available <a href="http://code.google.com/p/google-guice/wiki/Bindings">from Google Guice</a> . <br><br>  It is worth adding a few words and tests.  RoboGuice contains several classes to facilitate and speed up unit-testing.  <code>RoboUnitTestCase</code> provides testing for classes that are not dependent on the Android ecosystem.  <code>RoboActivityUnitTestCase</code> allows <code>RoboActivityUnitTestCase</code> to run unit tests for Activities.  In the future I would like to write a separate article about testing under Android, with a comparison of different approaches and libraries.  Testing under Android is still not as well disassembled on Habr√© as the development itself. <br><br><h4>  Final diagnosis </h4><br>  So, we make the final diagnosis about the benefits of injections: <br>  + Reducing the code responsible for initializing objects and managing the life cycle <br>  + More code responsible for business logic. <br>  + Reduced object connectivity <br>  + Minimum space for dependency configuration and object initialization <br>  + Ease of use and substitution of system objects and resources (Context, Apllication, SharedPreferences, Resources, etc.) <br>  + As a result, accelerating development and reducing errors <br><br>  - Additional library increases the size of the application. <br>  Controversial minus.  The size of <code>guice-2.0-no_aop.jar</code> and <code>roboguice-1.1.1.jar</code> together is about 545 Kb, which is quite a lot for simple applications, but it is quite acceptable for large and complex applications. <br>  - Decreased performance <br>  Also controversial.  Undoubtedly, injections require some time.  However, the time spent on this is small and mostly falls at the time of launching the application.  If you do not use injections in cycles and animations, the user will not notice the change in performance.  Moreover, the performance of smartphones and DalvikVM is constantly growing. <br><br>  My personal diagnosis: RoboGuice should be used in their projects.  The pros definitely outweigh the cons. </div><p>Source: <a href="https://habr.com/ru/post/116945/">https://habr.com/ru/post/116945/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../116938/index.html">There are no startups in Thailand!</a></li>
<li><a href="../116940/index.html">New MVC extension for drawing graphs</a></li>
<li><a href="../116941/index.html">eChina Tour 2011</a></li>
<li><a href="../116942/index.html">Skype 2.2 beta for Linux</a></li>
<li><a href="../116943/index.html">Site with a large number of protocols visualization</a></li>
<li><a href="../116946/index.html">"Rating Runet" published a list of TOP-100 SEO-companies in 2010</a></li>
<li><a href="../116948/index.html">A quick overview of IBM Power Systems</a></li>
<li><a href="../116949/index.html">How the idea transformed in the first year of the project‚Äôs life</a></li>
<li><a href="../116950/index.html">Wordpress 3.1.1 released</a></li>
<li><a href="../116951/index.html">Multiple desktops in the monitor or multiple monitors on the desktop?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>