<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using TileMill</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the last post I talked about the cartographic design studio TileMill . He scored some positive reviews, and I decided to continue. 

 In this post ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using TileMill</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/a66e1c26/3103fad6/baed5086/24bb3426.png"><br><br>  In the last post I talked about the cartographic design studio <a href="http://habrahabr.ru/blogs/open_source/120676/">TileMill</a> .  He scored some positive reviews, and I decided to continue. <br><br>  In this post will be considered: <ul><li>  Data preparation, reprojection in Web Mercator </li><li>  Improving the speed of processing shape files </li><li>  Creating a project and importing data into the studio </li><li>  Creation of a point layer of earthquakes </li><li>  Standard selectors and attribute table </li></ul><br>  Interesting?  I invite under the cat. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Data preparation, reprojection in Web Mercator </h5><br><br>  As I said before, maps in TileMill are always projected into Web Mercator.  This projection is used by Microsoft Bing Maps, Google Maps and ESRI ArcGIS Online.  In order to simplify further work, we reproject our spatial data.  This will increase the speed of displaying data in Mapnik.  In addition, it is a good practice to verify the correctness of the source data. <br><br>  To do this, I will use the utility <strong><a href="http://www.gdal.org/ogr/">OGR</a></strong> , which is part of the <a href="http://www.gdal.org/index_ru.html">GDAL</a> library. <br><br> <code>ogr2ogr reprojected.shp source.shp -t_srs EPSG:900913</code> <br> <br>  Where source.shp is the source file.  This command will create a new reprojected.shp file reprojected in Web Mercator (its EPSG code is 900913). <br><br>  <strong>Important.</strong>  If you reproject a layer from WGS84, you may encounter incorrect display of polygons on certain parallels.  Usually, it is enough to use the trim function in OGR. <br><br> <code>ogr2ogr fixed.shp source.shp -t_srs EPSG:900913 -clipsrc -180 -90 180 90</code> <br> <br>  <strong>Note</strong> : OGR version must be at least 1.7.  A detailed solution to this problem can be found <a href="http://trac.mapnik.org/wiki/Troubleshooting">here</a> . <br><br><h5>  Improving the speed of processing shape files </h5><br><br>  When the shape layer of a file contains many objects, its processing speed may take a long time.  As you remember, TileMill works on the basis of the <a href="http://mapnik.org/">Mapnik</a> library.  This library includes a utility for indexing shape files - <strong>shapeindex</strong> .  Indexing can significantly increase the speed of processing spatial data.  This utility creates an index file based on your spatial data.  The Mapnik index file format uses the .index extension.  The index file describes the elements included in the shape file, allowing the handler to quickly find out where the data necessary for visualization is located, instead of performing a slow search over the entire file. <br><br>  Using shapeindex is very simple: <br><br> <code>shapeindex shapefile.shp</code> <br> <br>  This utility will create a new index file called shapefile.index, which needs to be stored along with the rest of the shape collection's data (* .shp, * .shx, * .dbf, etc.). <br><br>  When testing, it is noticeable that the processing of a layer containing about 100,000 points and 12 levels of representation takes about 24 hours.  While processing the same layer containing the index file takes about an hour. <br><br>  Now that everything is ready, let's load the data into the studio.  All we need is to pack our collection of shape files into a zip archive and upload it to the files / data directory, inside TileMill. <br><br><br><h5>  Creating a project and importing data into the studio </h5><br><br>  So, the data are prepared, we will start the creation of the first project.  The project name can contain only Latin letters, numbers, dashes and underscores. <br><br><img src="https://habrastorage.org/storage/3562adff/d5a792b3/87205bf2/8beb7ca2.png"><br><br>  New earthquakes project created.  New project window. <br><br><img src="https://habrastorage.org/storage/06a0e135/b4b808d9/eb93d8dd/516248b3.png"><br><br>  Add a layer.  ID is a unique identifier for a layer in a project.  Datasource - zip archive with a collection of shape files. <br><br><img src="https://habrastorage.org/storage/a5d58653/e011dabe/8669b893/a6ca5738.png"><br><br>  You can quickly check the correctness of a layer with points using the marker-height property (or marker-width). <br><br><img src="https://habrastorage.org/storage/304663fa/1182f7d4/3879d19e/73b73666.png"><br><br>  The attribute table of the layer can be viewed by clicking the icon with the image of a magnifying glass, in the section with the active layers. <br><br><img src="https://habrastorage.org/storage/401762fd/47eb8b5d/901b7282/2ab2776d.png"><br><br>  Fields from the attribute table can be used as selectors.  As you can see, there is an earthquake magnitude in the layer attribute table (MLH field).  Let's specify a different color and size for points with different magnitudes.  I will give only a part of the code so that the general principle is clear. <br><br><pre> <code class="hljs markdown">[<span class="hljs-string"><span class="hljs-string">MLH&gt;=0</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">MLH&lt;1</span></span>] { marker-fill: #ffff00; marker-width: 1; } [<span class="hljs-string"><span class="hljs-string">MLH&gt;=1</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">MLH&lt;2</span></span>] { marker-fill: #ffdd00; marker-width: 2; } [<span class="hljs-string"><span class="hljs-string">MLH&gt;=2</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">MLH&lt;3</span></span>] { marker-fill: #ffbb00; marker-width: 3; }</code> </pre><br><br>  In addition, there is a set of standard selectors that are used in TileMill. <br>  <code>* { }</code> - for all layers <br>  <code>.red { }</code> - all layers with class 'red' <br>  <code>.blue[zoom&gt;8] { }</code> - layers with a 'blue' class, with a presentation level above 8 <br>  <code>#countries[NAME='USA'] { }</code> - all elements of the layer with the identifier 'countries', for which the attribute 'NAME' is equal to the value 'USA' <br><br><br>  In addition, let's make the markers and their borders a bit transparent: <br><br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">marker</span></span>-opacity: <span class="hljs-number"><span class="hljs-number">.8</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">marker</span></span>-line-opacity: <span class="hljs-number"><span class="hljs-number">.8</span></span>;</code> </pre><br><br>  Here's what we get in the end. <br><br><img src="https://habrastorage.org/storage/b7e5cc6e/557f104e/8e8a4284/eb74a8ae.png"><br><br>  That's all.  Our first project is ready. <br><br>  In the next post I will talk about how to add interactivity to the project, how to create a legend and how to use it all.  Thanks for attention. <br><br>  <strong>UPDATE</strong> : <a href="http://habrahabr.ru/blogs/open_source/122376/">continued</a> . </div><p>Source: <a href="https://habr.com/ru/post/121126/">https://habr.com/ru/post/121126/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../121114/index.html">Workshop Zend Framework. Part One: Authentication and Acl</a></li>
<li><a href="../121117/index.html">Powerful database server for a little over $ 2000</a></li>
<li><a href="../121118/index.html">VNC monitor from Playboy / Vogue player ‚Äúfor dummies‚Äù</a></li>
<li><a href="../121120/index.html">Script backup vps servers</a></li>
<li><a href="../121125/index.html">About today's ICQ crash</a></li>
<li><a href="../121128/index.html">Google charges its employees for free</a></li>
<li><a href="../121129/index.html">ALTER very large tables in MySQL</a></li>
<li><a href="../121130/index.html">First impressions of Sony Ericsson Xperia mini 2011</a></li>
<li><a href="../121131/index.html">Panasonic has updated its "not killed" Toughbook CF-19</a></li>
<li><a href="../121132/index.html">Code-first in Entity Framework</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>