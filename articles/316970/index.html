<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Above-the-Fold CSS - how to speed up site loading without slowing down the development</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the good old days, we with Google PageSpeed ‚Äã‚ÄãInsights were on a short leg. I riveted cheap templates, Google put a high mark on the speed of their...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Above-the-Fold CSS - how to speed up site loading without slowing down the development</h1><div class="post__text post__text-html js-mediator-article">  In the good old days, we with Google PageSpeed ‚Äã‚ÄãInsights were on a short leg.  I riveted cheap templates, Google put a high mark on the speed of their loading.  However, over time, much has changed, and even though I still rivet cheap templates, Google began to stick my wheels in me. <br><br>  I think many have seen the following comments in the Google PageSpeed ‚Äã‚ÄãInsights reports: <br><br><ul><li>  Shorten CSS (HTML, JavaScript) </li><li>  Use browser cache </li><li>  Enable compression </li><li>  Remove the JavaScript and CSS code that blocks the display of the top of the page. </li></ul><br>  And if, as a rule, there are no problems with the first three points, the last point baffled me. <br><a name="habracut"></a><br><h2>  Automatic generation of critical CSS </h2><br>  The Internet has already accumulated enough information on this topic.  In a nutshell, Google declares that I <b>should</b> postpone the loading of styles that do not affect the display of the top of my page, which falls into the viewport immediately after the page loads, and insert the necessary styles directly into the html code. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I decided to select the necessary styles manually as an impossible task, so I started searching for a tool to automate this process.  To date, I have found only three tools created to generate the necessary styles: <br><br><ol><li>  <a href="https://github.com/filamentgroup/criticalcss">Critical CSS</a> </li><li>  <a href="https://github.com/addyosmani/critical">Critical</a> </li><li>  <a href="https://github.com/pocketjoso/penthouse">Penthouse</a> <br></li></ol><br>  And if with the first two I somehow didn‚Äôt work, Penthouse turned out to be exactly the tool I was looking for.  Since I use Gulp to build projects, the code for gulpfile.js will be presented below. <br><br>  <b>1.</b> Install the necessary modules: <br><br><pre><code class="hljs cmake">$ npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> --save-dev penthouse $ npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> --save-dev gulp-inject-<span class="hljs-keyword"><span class="hljs-keyword">string</span></span></code> </pre> <br>  <b>2.</b> Open gulpfile.js and connect them: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> penthouse = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'penthouse'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inject = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-inject-string'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//        html</span></span></code> </pre> <br>  <b>3.</b> Next, you need to specify the path to your page and styles: <br><br><pre> <code class="javascript hljs">gulp.task(<span class="hljs-string"><span class="hljs-string">'penthouse'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ penthouse({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'src/index.html'</span></span>, <span class="hljs-comment"><span class="hljs-comment">//    css: 'src/css/styles.css', //    width: 1280, height: 800 }, function (err, criticalCss) { gulp.src('src/index.html') .pipe(inject.after('&lt;!-- Critical CSS --&gt;', '\n&lt;style&gt;\n' + criticalCss + '\n&lt;/style&gt;')) .pipe(gulp.dest('dist')) }); });</span></span></code> </pre><br>  In this example, the styles will be inserted immediately after the Critical CSS comment into the index.html file. <br><br>  Done!  Now, Google PageSpeed ‚Äã‚ÄãInsights will stop swearing at this point, and move it to the "Fulfilled Rules" tab. <br><br><h2>  How to connect the remaining files with styles? </h2><br>  Many people advise connecting them asynchronously using JavaScript, but for myself I found a fairly simple way out - connect them at the end of the html code before the closing body tag, but before JavaScript.  Someone will say that it is not <a href="https://www.w3.org/TR/html5/document-metadata.html">valid</a> to make elements with the rel attribute beyond the head limits, but <a href="https://www.w3.org/TR/html5/document-metadata.html">HTML5.0</a> has faded into oblivion since October, and <a href="https://www.w3.org/TR/html52/links.html">the WHATWG specification</a> does not prohibit it. </div><p>Source: <a href="https://habr.com/ru/post/316970/">https://habr.com/ru/post/316970/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../316956/index.html">Atlassian User Group is visiting 1C</a></li>
<li><a href="../316958/index.html">As I continued the business of DotA League</a></li>
<li><a href="../316960/index.html">Google fixed Android vulnerabilities</a></li>
<li><a href="../316962/index.html">All our problems with work because no one knows who he wants to be in 5 years</a></li>
<li><a href="../316966/index.html">Yii2-advanced: alternative folder layout for multiple applications</a></li>
<li><a href="../316972/index.html">Interview with Luis Cataldi (Epic Games) about the Unreal Engine</a></li>
<li><a href="../316974/index.html">Firebug development tool closes: ‚ÄúUse Firefox DevTools‚Äù</a></li>
<li><a href="../316976/index.html">Database of countries, regions and cities</a></li>
<li><a href="../316978/index.html">Dear javascript</a></li>
<li><a href="../316980/index.html">Formula of trust</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>