<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ProgressBar - Javascript Canvas2d</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. Recently, I often deal with JavaScript-canvas, especially writing all sorts of toys that are demanding for traffic due to the need to load a lo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ProgressBar - Javascript Canvas2d</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/b66/0c3/72d/b660c372d7c91ec7087352ce4f882282.png"><br>  Hello.  Recently, I often deal with JavaScript-canvas, especially writing all sorts of toys that are demanding for traffic due to the need to load a lot of pictures. <br>  Usually, about 50-100kb of compressed JavaScript is loaded first, after which - a certain number of pictures (for example, 500kb, 2mb, 10mb, etc.) and only after that the game starts.  You can, of course, download along the way, but the lack of texture is unlikely to please the player. <br>  Therefore, I decided that it was necessary to make some decent, cute, easily-customizable (in order to quickly change from project to project) progress bar, but without having to use pictures.  Under the source code under the LGPL license, a small instruction on how to do this and at the bottom of the article is a link to the result. <br><a name="habracut"></a><br>  At once I will say that I do not pretend to any special admiration for the uniqueness and genius of the code.  The code is simple and without particularly tricky techniques, but I think beginners can easily find something interesting for themselves. <br><br><h2>  Intrument </h2><br>  While working with Canvas, there is practically no need to work with the DOM, because the standard powerful JS frameworks, a la Jquery (which I like very much) are unnecessary and, at the same time, do not cover the necessary needs.  I use my own mini-framework, which provides a lightweight wrapper over the DOM, extensions to standard primitives and something else;) The file utils.js. <br>  I also have a CanvasExpander.js file, which slightly extends the initial <code><font color="#0000BB">context</font> <font color="#007700">.</font> <font color="#0000BB">getContext</font> <font color="#007700">(</font> <font color="#DD0000">'2d'</font> <font color="#007700">);</font></code> <code><font color="#0000BB">context</font> <font color="#007700">.</font> <font color="#0000BB">getContext</font> <font color="#007700">(</font> <font color="#DD0000">'2d'</font> <font color="#007700">);</font></code>  .  Some functions we need ... <br><br>  I want to draw attention to the <b>utils / Trace</b> class.  I needed the output of objects, since firebug does not work in Firefox3.7a.  And he, in contrast to Firebag, allows you to display information in the same block, which is quite useful for, for example, outputting the number of FPS.  It is disconnected by a single or, sometimes, double click on a block. <br><blockquote> <code><font color="#007700">var</font> <font color="#0000BB">tr</font> <font color="#007700">= new</font> <font color="#0000BB">Trace</font> <font color="#007700">(); <br></font> <font color="#0000BB">setInterval</font> <font color="#007700">(function () { <br></font> <font color="#0000BB">tr</font> <font color="#007700">.</font> <font color="#0000BB">trace</font> <font color="#007700">(</font> <font color="#0000BB">fps</font> <font color="#007700">); <br> },</font> <font color="#0000BB">20</font> <font color="#007700">); <br></font></code> </blockquote><br>  On its basis the class FpsMeter is made.  Just every time before the frame starts, we call the frame () method of the object and it will highlight us the average fps for the last n frames (passed by the parameter when creating it, see the code for an example) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Interface </h2><br>  First let's define the interface.  As usual, I have a picture download: <br><blockquote> <code><font color="#000000"><font color="#007700">var</font> <font color="#0000BB">id</font> <font color="#007700">= new</font> <font color="#0000BB">ImageDownloader</font> <font color="#007700">({ <br></font> <font color="#0000BB">wallBrick</font> <font color="#007700">:</font> <font color="#DD0000">"/images/walls/brick-512px.png"</font> <font color="#007700">, <br></font> <font color="#0000BB">wallWood</font> <font color="#007700">:</font> <font color="#DD0000">"/images/walls/wood-256px.png"</font> <font color="#007700">, <br></font> <font color="#0000BB">sectoid</font> <font color="#007700">:</font> <font color="#DD0000">"/images/aliens/grey-64-256px.png" <br></font> <font color="#FF8000">// And So On <br></font> <font color="#007700">}); <br></font> <font color="#0000BB">setInterval</font> <font color="#007700">(function () { <br> if (</font> <font color="#0000BB">id</font> <font color="#007700">.</font> <font color="#0000BB">ready</font> <font color="#007700">) { <br></font> <font color="#0000BB">outputMainData</font> <font color="#007700">(</font> <font color="#0000BB">id</font> <font color="#007700">.</font> <font color="#0000BB">getImages</font> <font color="#007700">()); <br> } <br> },</font> <font color="#0000BB">20</font> <font color="#007700">);</font></font></code> </blockquote> <br><br>  This allows me to not conceive of urles, and in the code to use only the name of the picture.  For example, <code><font color="#000000"><font color="#0000BB">Images</font> <font color="#007700">[</font> <font color="#DD0000">'wallBrick'</font> <font color="#007700">]</font></font></code> .  But since we want to add progressBar, we need to slightly expand the interface by adding the public property progress (it would be more correct through the getter, of course, but this is not so important now) <br><blockquote> <code><font color="#000000"><font color="#0000BB">setInterval</font> <font color="#007700">(function () { <br> if (</font> <font color="#0000BB">id</font> <font color="#007700">.</font> <font color="#0000BB">ready</font> <font color="#007700">) { <br></font> <font color="#0000BB">outputMainData</font> <font color="#007700">(</font> <font color="#0000BB">id</font> <font color="#007700">.</font> <font color="#0000BB">getImages</font> <font color="#007700">()); <br> } else { <br></font> <font color="#0000BB">progBar</font> <font color="#007700">.</font> <font color="#0000BB">setProgress</font> <font color="#007700">(</font> <font color="#0000BB">id</font> <font color="#007700">.</font> <font color="#0000BB">progress</font> <font color="#007700">).</font> <font color="#0000BB">draw</font> <font color="#007700">(); <br> } <br> },</font> <font color="#0000BB">20</font> <font color="#007700">);</font></font></code> </blockquote> <br><br>  The source codes of ImageDownloader are not particularly interesting for us, because I personally wrote a stub that smoothly raises progress from zero to 100% in 3.4 seconds. <br><br><h2>  Create a progressBar </h2><br>  What do we write in the draw () method? <br>  Calling our class, the programmer does not know what is going on inside, because he expects that nothing will happen to his settings and <code><font color="#0000BB">context</font> <font color="#007700">.</font> <font color="#0000BB">fillColor</font></code>  <code><font color="#0000BB"><font color="#0000BB">context</font> <font color="#007700">.</font> fillColor</font></code> or <code><font color="#0000BB"><font color="#0000BB">context</font> <font color="#007700">.</font> fillColor</font></code> . stays the same.  To do this, we will save the fields using <code><font color="#0000BB">context</font> <font color="#007700">.</font> <font color="#0000BB">saveValues</font> <font color="#007700">();</font></code> <code><font color="#0000BB">context</font> <font color="#007700">.</font> <font color="#0000BB">saveValues</font> <font color="#007700">();</font></code>  , and after rendering, restore the original values ‚Äã‚Äãusing <code><font color="#0000BB">context</font> <font color="#007700">.</font> <font color="#0000BB">loadValues</font> <font color="#007700">();</font></code> <code><font color="#0000BB">context</font> <font color="#007700">.</font> <font color="#0000BB">loadValues</font> <font color="#007700">();</font></code>  (CanvasExpander.js). <br> <code><font color="#0000BB">this</font> <font color="#007700">.</font> <font color="#0000BB">drawBorder</font> <font color="#007700">();</font></code>  will draw a wrapper for our progress bar: <br><img src="https://habrastorage.org/getpro/habr/post_images/474/b71/f7d/474b71f7ddf2102267f0cb678bd4f145.png"><br>  Now the line itself.  Let's say the pictures will load in 5 seconds.  And our canvas is redrawn every 0.02 seconds (50 fps).  Thus, the line is regenerated from scratch during this time 250 times.  It is much more profitable to create a separate buffer, where to generate this line, and then simply display the corresponding part on the screen.  We will create another Canvas element into which we will draw it, and then take it ( <code><font color="#0000BB">ProgressBar</font> <font color="#007700">.</font> <font color="#0000BB">createBuffer</font> <font color="#007700">();</font></code> method), we can see the result if we uncomment the body attachment line in the method) <br>  Now, when we drew it, you can use it every frame without serious consequences: <br><blockquote> <code><font color="#000000"><font color="#0000BB">ctx</font> <font color="#007700">.</font> <font color="#0000BB">drawImage</font> <font color="#007700">(</font> <font color="#0000BB">line</font> <font color="#007700">,</font> <font color="#0000BB">0</font> <font color="#007700">,</font> <font color="#0000BB">0</font> <font color="#007700">,</font> <font color="#0000BB">width</font> <font color="#007700">*</font> <font color="#0000BB">prog</font> <font color="#007700">,</font> <font color="#0000BB">height</font> <font color="#007700">, <br></font> <font color="#0000BB">c</font> <font color="#007700">.</font> <font color="#0000BB">x</font> <font color="#007700">+</font> <font color="#0000BB">1</font> <font color="#007700">,</font> <font color="#0000BB">c</font> <font color="#007700">.</font> <font color="#0000BB">y</font> <font color="#007700">+</font> <font color="#0000BB">1</font> <font color="#007700">,</font> <font color="#0000BB">width</font> <font color="#007700">*</font> <font color="#0000BB">prog</font> <font color="#007700">,</font> <font color="#0000BB">height</font> <font color="#007700">);</font></font></code> </blockquote> <br>  Where line is the canvas html element. <br><img src="https://habrastorage.org/getpro/habr/post_images/fa8/df3/0cf/fa8df30cfbb3f119ad26cc4ef7e7518c.png"><br><br><h2>  Recalculation of styles </h2><br>  Every time the style of our progressBar changes, the countSizes method is called, which considers all numbers less than zero as percentages.  This will make our progress look the same, no matter how large the Canvas element is.  First, the width in pixels is calculated.  Suppose Canvas width is 800 pixels and style ['width'] = 0.8.  Then the width of the progress bar will be 640 pixels.  All other values ‚Äã‚Äãdepend either on the width of the progressBar or on the height ('blendHeight', 'blendVAlign', 'textSize', 'textVAlign').  This will allow you to masturbate with the element, without changing proportions. <br><br><h2>  <b><a href="http://freecr.ru/progress/">Proper script</a></b> </h2><br>  All sources are inside, not obfuscated, license: LGPL. </div><p>Source: <a href="https://habr.com/ru/post/88113/">https://habr.com/ru/post/88113/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../88100/index.html">The sum of the measurements in rrdtool</a></li>
<li><a href="../88101/index.html">Greetings from the libc free world! (Part 1)</a></li>
<li><a href="../88106/index.html">Simkl launches Promo Manager - a tool for promotion of startups and online stores</a></li>
<li><a href="../88109/index.html">Inside the clouds</a></li>
<li><a href="../88110/index.html">Windows Phone 7 emulator unlocked to access all features</a></li>
<li><a href="../88114/index.html">RSS new torrents with rutracker.org</a></li>
<li><a href="../88115/index.html">Chronology of Google in China</a></li>
<li><a href="../88117/index.html">4th Innovators Club Meeting in St. Petersburg</a></li>
<li><a href="../88118/index.html">New type of spam - spam from antispammers</a></li>
<li><a href="../88119/index.html">Difficulty administering proxies in large companies (Part 2)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>