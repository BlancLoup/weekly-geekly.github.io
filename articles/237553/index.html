<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We manage the outlet by SMS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to present you a very simple way to remotely manage power. 
 We will use ready-made radio-controlled sockets, so we do not need to solder anyth...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We manage the outlet by SMS</h1><div class="post__text post__text-html js-mediator-article">  I want to present you a very simple way to remotely manage power. <br>  We will use ready-made radio-controlled sockets, so we do not need to solder anything.  This is very cool, because it‚Äôs better not to touch 220V (beginners). <br><br><img src="https://habrastorage.org/files/c83/ef6/6ab/c83ef66abf0f4af99b93adf41a35ba49.png" alt="   -   " title="Topic without picture - money to the wind"><br><br>  PS Yesterday was a similar <a href="http://habrahabr.ru/post/238907/">topic</a> , but was used Raspberry Pi, managed through chat.  Our version is somewhat simpler and more universal, because it does not need the Internet and a smartphone, and instead of Raspberry it will be the usual Arduino. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  We will need </h3><br><h4>  Iron </h4><ul><li>  <b>Arduino UNO</b> or equivalent.  In principle, you can and Mega. </li><li>  <b>GSM / GPRS Shield.</b>  Any suitable.  I used the shield from the Chinese <a href="http://www.seeedstudio.com/depot/GPRS-Shield-V20-p-1379.html%3FcPath%3D19_20">Seeedstudio</a> , because  its easiest to buy from Russia. </li><li>  <b>Transmitter 443MHz</b> - on AliExpress a pair of receiver-transmitter costs almost 20 rubles.  Mine is called FS1000A / XY-FST, where FS1000A is the transmitter. </li><li>  <b>Controlled outlet (s) 443MHz</b> .  I took a <a href="http://www.pollin.de/shop/dt/MzMzOTQ0OTk-/Haustechnik/Funkschaltsysteme/Funksteckdosen_Set_mit_3_Steckdosen.html">set of AB440S</a> of three outlet adapters with remote control in a German online store.  Now, it seems, it is possible to find something similar with us - I saw it recently at Chip-i-Dip. </li></ul><br><h4>  Soft </h4><ul><li>  Library to manage the GSM shield.  Download the code from the manufacturer's website.  There was no such code for my shield, so I downloaded the universal library for SIM900 <a href="http://www.gsmlib.org/download.html">GSMSHIELD</a> </li><li>  <a href="https://code.google.com/p/rc-switch/">The rc-switch library</a> for controlling sockets. </li></ul><br><br><h3>  Principle of operation </h3><br>  In the 433MHz range, low-power radios and remote control devices can operate without a license.  On sale you can find ready-made dimmers, switches, cartridges and sockets, controlled by the remote on the radio in this frequency range.  For our purposes, "intermediate" sockets-adapters are best suited: a radio-controlled device is inserted into an ordinary outlet, and the device itself is already inserted into it. <br><br>  So that such sockets can be distinguished among themselves, they have an address given by DIP- or rotary switches.  Due to this, you can control multiple outlets independently.  Or vice versa - set them the same address so that they turn on and off at the same time. <br><br>  Our scheme is elementary: Arduino receives an SMS with the command, then sends a ‚Äúturn on‚Äù or ‚Äúturn off‚Äù signal to the sockets using the radio module.  SMS will be of the form A1B0C0, where A, B, C ... are the names of the sockets, 0 is off, 1 is on. <br><br><br><h3>  We assemble device </h3><br><ol><li>  We insert the sim card into the GSM-shield, and the shield into the arduin. </li><li>  Connect the transmitter's feet: GND ‚Üí GND, VCC ‚Üí 5V, DATA ‚Üí to one of the pins, for example, 12. </li><li>  I also soldered the 15 cm postings to ANT in the corner of the transmitter handkerchiefs.  But it seems to me that this is optional. </li></ol><br><img src="https://habrastorage.org/files/95c/6f0/c24/95c6f0c244da48eebbbba745cf8e72ed.png"><br><br><h3>  We check the GSM module </h3><br>  If you have not worked with GSM-shield before, I recommend to first fill in the test code (taken <a href="">from here</a> ) and check its operation. <br>  The code sends all data from the Serial to the SoftwareSerial and back, so by connecting the shield to the SoftwareSerial, we can send commands to the modem via the Serial Monitor in the Arduino IDE. <br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//Serial Relay - Arduino will patch a //serial link between the computer and the GPRS Shield //at 19200 bps 8-N-1 //Computer is connected to Hardware UART //GPRS Shield is connected to the Software UART #include &lt;SoftwareSerial.h&gt; SoftwareSerial GPRS(7, 8); unsigned char buffer[64]; // buffer array for data recieve over serial port int count=0; // counter for buffer array void setup() { GPRS.begin(19200); // the GPRS baud rate Serial.begin(19200); // the Serial port of Arduino baud rate. } void loop() { if (GPRS.available()) // if date is comming from softwareserial port ==&gt; data is comming from gprs shield { while(GPRS.available()) // reading data into char array { buffer[count++]=GPRS.read(); // writing data into array if(count == 64)break; } Serial.write(buffer,count); // if no data transmission ends, write buffer to hardware serial port clearBufferArray(); // call clearBufferArray function to clear the storaged data from the array count = 0; // set counter of while loop to zero } if (Serial.available()) // if data is available on hardwareserial port ==&gt; data is comming from PC or notebook GPRS.write(Serial.read()); // write it to the GPRS shield } void clearBufferArray() // function to clear buffer array { for (int i=0; i&lt;count;i++) { buffer[i]=NULL;} // clear all index of array with command NULL }</span></span></code> </pre> <br>  Fill the code in Arduino, open the Serial monitor.  Enter the <i><b>AT</b></i> command - the answer should be OK.  If there is no answer, then something is wrong.  Perhaps you need to change the transfer rate? <br><br>  Then you can check that we registered on the network: <br>  <i><b>AT + COPS?</b></i> <br> <code>+COPS: 0,0,"MTS-RUS"</code> <br> <code>OK</code> <br> <br><br>  I recommend lowering the speed of the UART modem.  I don‚Äôt know for sure about SMS, but GPRS works exactly more reliably at low speeds - Arduinka has a small buffer and some of the information may be lost.  Set the speed to 2400 baud. <br> <code>AT+IPR=2400</code> <br> <code>OK</code> <br> <br>  If you also want to play around with the modem, I recommend using a ready <a href="http://m2msupport.net/m2msupport/module-tester/">java applet</a> for the browser.  Well, you can read the <a href="http://www.seeedstudio.com/wiki/File:SIM900_AT_Command_Manual_V1.03.pdf">manual</a> commands. <br><br><br><h3>  We look / change the addresses of the sockets </h3><br>  Outlets have a two-part hardware address.  The first 5 bits are the same for the whole set and coincide with the address of the console.  The last 5 bits are individual.  The address can be changed by unscrewing the cap.  On other models, the address setting may be different - see <a href="https://code.google.com/p/rc-switch/wiki/HowTo_OperateLowCostOutlets">the rc-switch website</a> . <br><br><img src="//habrastorage.org/files/2c2/0e2/ae5/2c20e2ae505a40398b81ed9fd40911a3.png"><br><br><h3>  Code </h3><br>  If you are not using GSMSHIELD, but some other library, then the code will of course be different, but the principle will be the same.  At certain time intervals, we check if we have unread SMS, parse them, and if a valid command came from an authorized number, we send a radio signal <code>mySwitch.switchOff</code> or <code>mySwitch.switchOn</code> , giving them the address of the outlet. <br>  <i>Note</i>  <i>In my case, for Seeedstudio‚Äôs Shield, it was necessary to get into GSM.cpp and change the given pins to 7 and 8.</i> <pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* Arduino GSM-switch example code Switch on/off radio controlled controlled outlets Author: Vladislav Ross, 2014 Contact: vladislav.ross@gmail.com You need to download: 1. rc-switch https://code.google.com/p/rc-switch/ 2. GSMSHIELD http://www.gsmlib.org/ For GSMSHIELD: * To change pins for Software Serial, use the two lines in GSM.cpp. * If you are using Mega, uncomment "#define MEGA" line in HWSerial.h * You can enable debug messages on serial port by defining DEBUG_ON */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SIM900.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SoftwareSerial.h&gt; #include "sms.h" #include "call.h" #include &lt;RCSwitch.h&gt; // 433MHz transmitter pin const byte RCpin = 12; char groupAddress[6] = "11111"; char smsLetters[] = "ABC"; char* deviceAddresses[] = { "10000", //A "01000", //B "00100" //C }; char adminNumber[] = "+74991356235"; //your phone number CallGSM call; SMSGSM sms; RCSwitch mySwitch = RCSwitch(); char number[20]; byte stat=0; char smsText[11]; byte position; int deviceLetterIdx = -1; byte i,j; void setup() { gsm.begin(2400); delay(10000); for(i = 1; i &lt;= 21; i++) { sms.DeleteSMS(i); } mySwitch.enableTransmit(RCpin); }; void loop() { //hang up all incoming calls /*stat=call.CallStatus(); if(stat==CALL_INCOM_VOICE) { call.HangUp(); }*/ position = sms.IsSMSPresent(SMS_UNREAD); //get new SMS if (position) { sms.GetSMS(position, number, smsText, 10); sms.DeleteSMS(position); if(strcmp(number, adminNumber) == 0) //accept SMS only from defined number { for (i = 0; i &lt; sizeof(smsText) - 1; i++) { if(deviceLetterIdx != -1) { //got letter, now expecting 0 or 1 if(smsText[i] == '0') { mySwitch.switchOff(groupAddress, deviceAddresses[deviceLetterIdx]); delay(500); } if(smsText[i] == '1') { mySwitch.switchOn(groupAddress, deviceAddresses[deviceLetterIdx]); delay(500); } deviceLetterIdx = -1; } else { //waiting for letter A,B,C... for(j = 0; j &lt; sizeof(smsLetters) - 1; j++) { if(smsLetters[j] == smsText[i]) { deviceLetterIdx = j; break; } } } } } } delay(10000); };</span></span></span></span></code> </pre>  <a href="https://github.com/rossvs/Arduino-SMS-switch">Github</a> <br><br><br><h3>  Problems? </h3><br>  If the sockets do not want to switch to any, you can try <a href="https://code.google.com/p/rc-switch/wiki/HowTo_Receive">to receive a</a> signal from the native console to the receiver.  Rc-switch has sample code. <br><br><img src="//habrastorage.org/files/437/803/94e/43780394ebb04668b1efcd2c1eddb88b.png"><br><br><h3>  What's next? </h3><br>  How can you further develop this project: <br>  Firstly, we still have a lot of pins on the Arduino itself and on the GSM-shield.  You can connect to them some sensors or devices.  For example, do remote temperature monitoring or watering flowers. <br>  Secondly, we used only SMS, and the module is able to transmit voice and GPRS.  GPRS can transfer much more data.  In addition, you can not hang up when you call, but, for example, take a call and give to listen to what is happening on the spot. <br>  It is also possible that you will want to receive control SMS not from one number, but from several.  In this case, I would recommend storing numbers in the address book &amp; mash;  The library has corresponding functions. </div><p>Source: <a href="https://habr.com/ru/post/237553/">https://habr.com/ru/post/237553/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../237541/index.html">Running Android apps on Windows, OS X, Linux on Chrome</a></li>
<li><a href="../237543/index.html">Three-channel UART ADC on ATtiny13</a></li>
<li><a href="../237545/index.html">Swiss physicists turned Nokia N9 into a quantum random number generator</a></li>
<li><a href="../237549/index.html">Elon Musk: before the advent of robots cars on the roads another 5-6 years</a></li>
<li><a href="../237551/index.html">Ice Bucket Challenge as the atonement of sins</a></li>
<li><a href="../237559/index.html">Reactive Extensions: client for conditional api with Cache-Aside & Refresh-Ahead strategy</a></li>
<li><a href="../237561/index.html">Startup Guide, Part 2: When a Venture Investor Says No</a></li>
<li><a href="../237563/index.html">Supermassive black hole in the center of a small galaxy</a></li>
<li><a href="../237565/index.html">A gift from VmWare or how to block your server on hosting</a></li>
<li><a href="../237569/index.html">Cross-browser beautiful input type = "number"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>