<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Where "soap" in WPF comes from and how to deal with it</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This guide is for WPF developers looking to get the most out of the picture in their applications. Graphic system WPF to the bone is vector, but the e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Where "soap" in WPF comes from and how to deal with it</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/d6a/ef1/44d/d6aef144d1735196321321daa459bd8c.png"><br><br>  This guide is for WPF developers looking to get the most out of the picture in their applications.  Graphic system WPF to the bone is vector, but the end result of its work is still a raster.  If you do not pay due attention to this fact, you can encounter various sorts of "soap" - parasitic artifacts of rasterization.  In such a situation, it is important not to lose the presence of mind, the reasons for their occurrence are quite rational, and the methods of control are fairly simple and effective. <br><a name="habracut"></a><br><h4>  Table of contents </h4><br>  <a href="https://habr.com/ru/post/216833/">Introduction</a> <br>  <a href="https://habr.com/ru/post/216833/">1. Scaling bitmaps</a> <br>  <a href="https://habr.com/ru/post/216833/">2. Coordinates not multiples of pixel size.</a> <br>  <a href="https://habr.com/ru/post/216833/">3. Native resolution of raster images</a> <br>  <a href="https://habr.com/ru/post/216833/">4. Rasterization of vector images</a> <br>  <a href="https://habr.com/ru/post/216833/">5. Moving text vertically</a> <br>  <a href="https://habr.com/ru/post/216833/">6. Using the SnapsToDevicePixels property</a> <br>  <a href="https://habr.com/ru/post/216833/">7. Independent drawing of controls</a> <br>  <a href="https://habr.com/ru/post/216833/">Conclusion</a> <br>  <a href="https://habr.com/ru/post/216833/">Links</a> <br><br><a name="intro"></a><h4>  Introduction </h4><br>  The cunning of rasterization artifacts is that they do not catch the eye.  Many developers simply do not notice defects of a size of one to two pixels.  However, these little things affect the user's feelings from working with the application. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A small test of attentiveness: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/187/fea/5a0/187fea5a0d36750407ce3997d05d9757.png"></div><br>  <i>Next, we will discuss the factors that distinguish the top image from the bottom, and how to eliminate them.</i>  <i>If there are no such problems in your applications, try turning on the mode of increasing the text and interface elements in the Windows settings - most likely problems will appear.</i>  <i>Owners of small screens with high resolution or just people with poor eyesight often use this feature.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/db0/483/61d/db048361d664803021194dcd5e960a79.png"></div><br>  It is not necessary to read everything completely, you can restrict yourself to viewing illustrations.  Perhaps you will remember them, and you will return to this guide when you really need to fight for the clarity of the graphical output of your application. <br><br>  Each section of the manual is equipped with a demonstration application illustrating the problem under consideration and methods for solving it.  You can download everything <a href="">as a single archive (104 Kb)</a> containing the combined modules and their source code (VS2010 project format). <br><br>  So where does WPF come from and how to deal with it? <br><br><a name="part1"></a><h4>  1. Scaling bitmaps </h4><br>  When working with raster images, the most common cause of ‚Äúblurring‚Äù is scaling on output.  Set the <i>Image</i> element dimensions that do not match the physical size of the image, and the result will no longer be similar to the source.  Automatic adjustment of the size of the image to the size of the container often leads to a similar result.  In this case, the reason for the appearance of artifacts is the need to transfer the image from one raster grid to another. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/107/0f7/5cc/1070f75ccb3f9a930ef20b19937c49cd.png"></div><br><br><h5>  Opposition </h5><br>  If the image in the scaling container was in error, then you need to get it from there.  If the image sizes are wrong, you need to adjust them.  It's simple.  But only as long as you are testing your application with standard settings.  If you enable the mode of enlarged fonts and interface elements in Windows, the resolution of the output of the WPF application will change, the virtual unit of measure will become larger than the pixel size, and your bitmap image will be hopelessly corrupted by stretching. <br><br>  If your plans do not include image scaling for users with enlarged fonts, you will have to make corrections on the fly.  First you need to know the current output resolution and its relation to the standard one.  For example: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Render</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Render</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> flags = BindingFlags.NonPublic | BindingFlags.Static; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dpiProperty = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(SystemParameters).GetProperty(<span class="hljs-string"><span class="hljs-string">"Dpi"</span></span>, flags); Dpi = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)dpiProperty.GetValue(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); PixelSize = <span class="hljs-number"><span class="hljs-number">96.0</span></span> / Dpi; } <span class="hljs-comment"><span class="hljs-comment">//      public static double PixelSize { get; private set; } //  public static int Dpi { get; private set; } }</span></span></code> </pre> <br>  Then you can, in the heir to the standard <i>Image,</i> independently set the dimensions of the image depending on the current output resolution.  In XAML, such a picture should be placed without specifying specific sizes. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">StaticImage</span></span> : <span class="hljs-title"><span class="hljs-title">Image</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StaticImage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    Image.SourceProperty.OverrideMetadata( typeof(StaticImage), new FrameworkPropertyMetadata(SourceChanged)); } private static void SourceChanged( DependencyObject obj, DependencyPropertyChangedEventArgs e) { var image = obj as StaticImage; if (image == null) return; //      image.Width = image.Source.Width * Render.PixelSize; image.Height = image.Source.Height * Render.PixelSize; } }</span></span></code> </pre><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a6/4cf/f03/6a64cff034ba520665108ffaeba440b4.png"></div><br>  If scaling is unavoidable, then all you have to do is fight for reducing the degree of distortion by choosing the appropriate output algorithm for your case using the <i>RenderOptions.BitmapScalingMode</i> property. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/783/0c0/28a/7830c028af9d65445b7278d804c458d0.png"></div><br><br><a name="part2"></a><h4>  2. Coordinates not multiples of pixel size. </h4><br>  A fairly simple way to get an unplanned blur is to center the <i>Image</i> in a container (also works for the <i>Rectangle</i> and the other heirs of the <i>Shape</i> ).  In half of the cases, the width of the container is not divided completely in half. <br><br>  However, you can do without centering.  A container <i>grid</i> , for example, allows you to divide yourself into parts in arbitrary proportions.  Here is a characteristic case, when everything is fine in the upper left cell, fog in the lower right cell, and in the rest - something in between: <br><br><pre> <code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!--      --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"117"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"117"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.ColumnDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ColumnDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ColumnDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.ColumnDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--    --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.Resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Style</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">TargetType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Image"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Setter</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Property</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Width"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Setter</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Property</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Height"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Setter</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Property</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Margin"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Setter</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Property</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"VerticalAlignment"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Top"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Setter</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Property</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"HorizontalAlignment"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Left"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Setter</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Property</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Source"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"CookingPot.png"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.Resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Image</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Image</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Image</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Image</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/83c/780/47b/83c78047b663dd767e20900d1c96da4f.png"></div><br>  Equally effectively helps to blur the picture task in <i>Canvas</i> indents or positions that are not multiples of the pixel size. <br><br>  In all these cases, you will receive a ‚Äúsoap‚Äù, even if no scaling occurs during the output.  The boundaries of the pixels of the image no longer fall within the boundaries of the pixels of the screen, and smears them during rasterization. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0b8/384/e43/0b8384e438236d6875d256a21286efea.png"></div><br><h5>  Opposition </h5><br>  Everything is simple with containers; setting the <i>UseLayoutRounding</i> property to <i>True</i> causes the container ( <i>Window</i> including) to automatically round the position of the child elements to the nearest integer pixel value.  In other cases, it is necessary, one way or another, to explicitly bind coordinates to the boundaries of pixels. <br><br>  Note that the expression ‚Äúinteger coordinates‚Äù means ‚Äúcoordinates that are divided by pixel size completely‚Äù only in the standard resolution of 96 dpi, in all other <i>Math.Round</i> does not help you.  In the general case, the coordinate can be rounded to the nearest pixel border as follows: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SnapToPixels</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> += PixelSize / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  DPI    WPF- . //  1000  -   //     double //2.4 / 0.4 = 5.9999999999999991 //240.0 / 40.0 = 6.0 var div = (value * 1000) / (PixelSize * 1000); return (int)div * PixelSize; }</span></span></code> </pre><br><br><a name="part3"></a><h4>  3. Native resolution of raster images </h4><br>  When you first encounter the problem of scaling bitmaps, you will most likely try to google the fact that <i>Image has a</i> magic output mode without scaling.  There is such a mode, it is <i>Stretch = "None"</i> , but it is worth hoping for it and removing the explicit assignment of output sizes, as you find yourself in the risk group.  Raster images have their own resolution, it is indicated in the metadata, and WPF takes it into account when forming the dimensions of the image.  If you do not know what it is, then, with luck, you will be able to believe in black magic: some of the images you have will be drawn as expected, and completely similar to them to swell or shrink under the same conditions. <br><br>  Download these three images for experiments (each one has a different resolution): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5f0/915/c3c/5f0915c3c7d924efb53a2c52a47ff390.png"><img src="https://habrastorage.org/getpro/habr/post_images/1cc/cf5/486/1cccf548621675b5e640ec2ec962156f.png"><img src="https://habrastorage.org/getpro/habr/post_images/7ab/14c/7ec/7ab14c7ec5f3cc34406a536653045e0d.png"><br><br>  If the resolution of the image does not coincide with the resolution of the output, then when it is loaded, its dimensions are multiplied by the ratio of permissions, and when drawn in the ‚Äúoriginal‚Äù size, you suddenly get scaled.  By the way, the <i>StaticImage</i> class shown in the first method is also not protected from these distortions, since it relies on the <i>Source.Width</i> and <i>Source.Height properties</i> . <br><br>  None of the graphic editors or viewers will be waving image resolution controls in front of you.  Moreover, some of these programs do not show at all and do not allow this parameter to be changed.  However, it is important. <br><br><pre> <code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!--    ,   --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.ColumnDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ColumnDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Auto"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ColumnDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Auto"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ColumnDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Auto"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.ColumnDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Image</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Source</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Man1.png"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Stretch</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"None"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Image</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Source</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Man2.png"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Stretch</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"None"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Image</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Source</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Man3.png"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Stretch</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"None"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b75/d9b/044/b75d9b0447dd761a58e6722cbfcc20fd.png"></div><br><br><h5>  Opposition </h5><br>  In order for the dimensions of the image in virtual units to match its size in pixels, you need to set the resolution in the graphical editor to 96 dpi.  With the image itself, nothing will happen when the resolution is changed, only the metadata will change. <br><br>  Standard Paint will not work for this, you will need something more serious.  In the popular free viewer <a href="http://www.irfanview.com/">IrfanView,</a> you can set the resolution in the image properties display dialog (hotkey I): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4c2/d9b/f1f/4c2d9bf1f2b57f6ccff69dd4e50690d7.png"></div><br>  In the at least free <a href="http://paintnet.ru/">Paint.NET</a> editor, the same effect can be achieved by going to the ‚ÄúImage‚Äù menu, then ‚ÄúCanvas size ...‚Äù (hot key Ctrl + Shit + R). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2f0/668/4f2/2f06684f2421a1d0053a29d2de4854d8.png"></div><br>  If you do not want or can not work with the resolution in the graphical editor (for example, your application works with loaded custom images), you can change the resolution of the loaded image programmatically.  Here is an example of the load function for 32-bit images: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Image.Source    96 dpi BitmapSource ConvertBitmapTo96DPI(string path) { var uri = new Uri(path); var bitmapImage = new BitmapImage(uri); int width = bitmapImage.PixelWidth; int height = bitmapImage.PixelHeight; int stride = width * 4; // 4    var pixelData = new byte[stride * height]; bitmapImage.CopyPixels(pixelData, stride, 0); return BitmapSource.Create( width, height, 96, 96, PixelFormats.Bgra32, bitmapImage.Palette, pixelData, stride); }</span></span></code> </pre><br><br><a name="part4"></a><h4>  4. Rasterization of vector images </h4><br>  From the description of the first three reasons for the emergence of "soap" you may have the well-founded opinion that there are some problems with raster images in WPF.  Indeed, it is much more natural to use vector images to work in a vector environment.  In the first experiments, the transformation of SVG to XAML seems to be a panacea, allowing you to no longer think about sizes and pixels.  Alas, it is not.  Exactly at midnight, the carriage turns into a pumpkin, and the vector image is rasterized for display on the screen. <br><br>  The smaller the output pixels, the more artifacts.  On images with a size of 48 pixels or less (this is almost 80% of all graphics in desktop applications), the situation degenerates into the following: the vector image is correctly rasterized in only one resolution, which is optimized, in the others already because.  Display the vector icon is not in the amount for which it was prepared, and the inexorable anti-aliasing will not take long. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/68c/377/c75/68c377c755d8495079a04dbe75a843e4.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/596/bfa/7ac/596bfa7accadf26a0f8abbfd6f57143d.png"></div><br><h5>  Opposition </h5><br>  In some cases, you can do a simple increase in image size.  For example, for buttons on the toolbar, use pictures with the size of 32x32 pixels, and for the context menu icons 25x25.  However, if you really care how the vector icon will be rasterized, then you need to optimize it for a specific resolution - the necessary image details should coincide with the borders of the pixels of the output raster. <br><br><a name="part5"></a><h4>  5. Moving text vertically </h4><br>  When displaying text, WPF uses some kind of sharpening technique.  While the text is static, it looks as clear as possible for its position and the selected rasterization mode (.NET Framework 4.0 and higher).  When moving along the vertical, at some values ‚Äã‚Äãof the shift, the ‚Äúsharpilka‚Äù turns off abruptly and then smoothly turns back on. <br><br>  Here is an example of a parasitic blur effect on a button with text animation when pressed: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">VerticalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Top"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button.Template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ControlTemplate</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">TargetType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Button"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Border</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"255"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"40"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BorderThickness</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1 0 1 1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">CornerRadius</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0 0 10 10"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BorderBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FF202020"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FFF7941D"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Panel"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Horizontal"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"     "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Foreground</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FF202020"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">VerticalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Center"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20 0 0 0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Padding</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Border</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ControlTemplate.Triggers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Trigger</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Property</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"IsPressed"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Setter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">TargetName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Panel"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Property</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3 1 -3 -1"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Trigger</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ControlTemplate.Triggers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ControlTemplate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button.Template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/132/ab1/755/132ab175543292d9fcd0830e67272312.gif"></div><br>  The blur conditions in this example are rather mysterious.  Apparently, the combination of the absence of the upper border, nesting of the text in the <i>StackPanel</i> (in the real situation in the button there was another picture) and a sharp shift of the text down by one or two pixels works. <br><br><h5>  Opposition </h5><br>  In the .NET Framework 4.0 and higher, using the <i>TextOptions</i> attribute <i>,</i> you can choose from two text rasterization modes: <i>Ideal</i> and <i>Display</i> .  This will slightly reduce the unpleasant blur effect.  In previous versions of the framework, the rasterization mode corresponds to the <i>Ideal</i> mode - as the letter on the pixel grid falls, it will rasterize.  In <i>Display</i> mode, intermediate processing is used: the text horizontally is always clearly tied to the pixels, and the same letters are rasterized in the same way.  For more information about the modes of text output can be read <a href="http://10rem.net/blog/2010/06/06/wpf-and-silverlight-choose-your-fonts-and-text-rendering-options-wisely">here</a> and <a href="http://blogs.msdn.com/b/text/archive/2009/08/24/wpf-4-0-text-stack-improvements.aspx">here</a> . <br><br>  The blur effect of sharp text movement is easy to reproduce in the lab.  It is enough to move it vertically to positions that are not multiples of the pixel size.  Below is an example of parallel movement of three blocks of text.  The two upper blocks with the same output mode blur differently.  Obviously, it is not the amount of shift that matters, but the position of the text relative to the raster grid. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/385/f6e/402/385f6e402ddbf33ec790a992af8395ea.gif"></div><br>  The mere fact of moving text does not necessarily lead to a ‚Äúdynamic blur‚Äù.  If this effect occurs, it affects the entire line.  Alas, the developer does not provide the means to control this effect.  In some cases, its occurrence can be avoided if the block coordinates are aligned with the pixel boundaries or the shift value is chosen experimentally. <br><br><a name="part6"></a><h4>  6. Using the SnapsToDevicePixels property </h4><br>  If you use such basic visual elements as <i>Rectangle</i> , <i>Ellipse</i> , <i>Line</i> , <i>Path</i> , <i>Border</i> , etc., then when displayed in coordinates that are not multiples of the pixel size, they will surely show you the blurring of vertical and horizontal lines.  Here is an example of an image constructed using the indicated elements: <br><br><pre> <code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!--      --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HorizontalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Center"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">VerticalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Center"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.ColumnDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ColumnDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"25"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ColumnDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"6"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.ColumnDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  (  ,  ) --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Ellipse</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.RowSpan</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Fill</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Black"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">VerticalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Top"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"15 5 0 0"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Line</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.RowSpan</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">X1</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">X2</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Y1</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Y2</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"11"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Stroke</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Black"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Line</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.ColumnSpan</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.RowSpan</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">X1</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"30"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">X2</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Y1</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Y2</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"11"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Stroke</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Black"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--    (   ) --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Border</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.ColumnSpan</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FFF7941D"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Rectangle</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Fill</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"White"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">RadiusX</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">RadiusY</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2.5"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  (  1,    ) --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Line</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StrokeThickness</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Stroke</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Black"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">X1</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">X2</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Y1</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Y2</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Line</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StrokeThickness</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Stroke</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Black"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">X1</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">X2</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Y1</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Y2</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Line</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StrokeThickness</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Stroke</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Black"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">X1</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">X2</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Y1</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"7"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Y2</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"7"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5c2/fcf/ec1/5c2fcfec1d4437d534d820c4e83e884c.png"></div><br>  In the illustrations below, the control with a demo picture moves in 0.2 pixel steps.  First, he does it separately along each of the axes, then along an arc of a circle.  Depending on the phase of the movement, the local coordinate grid of the control is superimposed on the physical raster grid in different ways. <br><img align="left" src="https://habrastorage.org/getpro/habr/post_images/e5c/de5/811/e5cde5811e39c187c791e8938d0a659d.gif"><br><img src="https://habrastorage.org/getpro/habr/post_images/085/001/f65/085001f657b3cee4f6f2d03fc35abaaf.gif"><img src="https://habrastorage.org/getpro/habr/post_images/085/001/f65/085001f657b3cee4f6f2d03fc35abaaf.gif"><img src="https://habrastorage.org/getpro/habr/post_images/085/001/f65/085001f657b3cee4f6f2d03fc35abaaf.gif"><img src="https://habrastorage.org/getpro/habr/post_images/085/001/f65/085001f657b3cee4f6f2d03fc35abaaf.gif"><img src="https://habrastorage.org/getpro/habr/post_images/085/001/f65/085001f657b3cee4f6f2d03fc35abaaf.gif"><br><br>  Sometimes it‚Äôs clear the outer edges of the TV, sometimes the borders of its screen, but it never happens at the same time.  The buttons are clear either horizontally or vertically, and more often blurred along both axes.  The antenna in any combination is slightly smoothed and does not complex about this. <br clear="all"><br clear="all"><h5>  Opposition </h5><br>  You can turn on pixel <i>snapping</i> in controls by setting the <i>SnapsToDevicePixels</i> property to <i>True</i> (to do this, simply set this attribute on the root grid).  The result will be more stable: <br><img align="left" src="https://habrastorage.org/getpro/habr/post_images/1da/511/809/1da51180985e74398f07bff3475e0eb5.gif"><br><img src="https://habrastorage.org/getpro/habr/post_images/7f9/c85/698/7f9c85698cdab0a4960939d3d8921e20.gif"><img src="https://habrastorage.org/getpro/habr/post_images/7f9/c85/698/7f9c85698cdab0a4960939d3d8921e20.gif"><img src="https://habrastorage.org/getpro/habr/post_images/7f9/c85/698/7f9c85698cdab0a4960939d3d8921e20.gif"><img src="https://habrastorage.org/getpro/habr/post_images/7f9/c85/698/7f9c85698cdab0a4960939d3d8921e20.gif"><img src="https://habrastorage.org/getpro/habr/post_images/7f9/c85/698/7f9c85698cdab0a4960939d3d8921e20.gif"><br><br>  However, the picture is neither immutable when moving, nor ideally attached to pixels.  The TV screen shakes within one pixel along both axes, and its buttons are always blurred. <br><br>  Setting the <i>SnapsToDevicePixels</i> property to <i>True</i> recommends that the visual element, when drawn, be within the borders of pixels on the screen with its borders.  Each control will strive to do this with different zeal and in different ways.  For example, <i>Image</i> , <i>Label</i> and <i>TextBlock</i> are completely indifferent to this attribute.  <i>Line</i> will fall into pixels only if the original geometry is successful.  <i>Rectangle</i> , on the contrary, will jump out of his pants and always fall into pixels. <br><br>  For a more stable pixel binding, you need to adjust the original image: <br><ol><li>  add 0.5 to all Y-coordinates of the lines depicting the buttons so that their edges coincide with the pixel grid in the control space; </li><li>  indent the TV screen as an integer, for example 2, so that it does not wind by binding to the nearest pixel boundaries. </li></ol><img align="left" src="https://habrastorage.org/getpro/habr/post_images/a52/3fa/ba1/a523faba160c112ab44bca70fb57c58b.gif"><br><img src="https://habrastorage.org/getpro/habr/post_images/dcb/ad6/7a4/dcbad67a40aa6a5e68b1e48505e980f3.gif"><img src="https://habrastorage.org/getpro/habr/post_images/dcb/ad6/7a4/dcbad67a40aa6a5e68b1e48505e980f3.gif"><img src="https://habrastorage.org/getpro/habr/post_images/dcb/ad6/7a4/dcbad67a40aa6a5e68b1e48505e980f3.gif"><img src="https://habrastorage.org/getpro/habr/post_images/dcb/ad6/7a4/dcbad67a40aa6a5e68b1e48505e980f3.gif"><img src="https://habrastorage.org/getpro/habr/post_images/dcb/ad6/7a4/dcbad67a40aa6a5e68b1e48505e980f3.gif"><br><br>  By the way, these actions will help to get a clear and stable output only in the standard resolution of 96 dpi, in the rest there will be confusion and vacillation.  To hit the pixels in any resolution you should refer to the recommendations of the section ‚ÄúIndependent drawing of controls‚Äù (the dimensions of the controls will have to be adjusted on the go, based on the physical pixel size). <br clear="all"><br clear="all"><a name="part7"></a><h4>  7. Independent drawing of controls </h4><br>  If you overlap <i>OnRender</i> in your visual element and draw it yourself using the <i>DrawingContext</i> , then you have exactly the same rasterization problems as the heirs of the <i>Shape</i> from the previous method, but you must implement the <i>SnapsToDevicePixels</i> functionality yourself.  If, of course, you want.  You can not bother and do something like this: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Washer</span></span> : <span class="hljs-title"><span class="hljs-title">FrameworkElement</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Washer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _brush = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SolidColorBrush(Color.FromRgb(<span class="hljs-number"><span class="hljs-number">247</span></span>, <span class="hljs-number"><span class="hljs-number">148</span></span>, <span class="hljs-number"><span class="hljs-number">29</span></span>)); _brush.Freeze(); _pen = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pen(Brushes.Black, <span class="hljs-number"><span class="hljs-number">1</span></span>); _pen.Freeze(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnRender</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DrawingContext dc</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// dc.DrawLine(_pen, new Point(1, 21), new Point(4, 21)); dc.DrawLine(_pen, new Point(12, 21), new Point(15, 21)); // var rect = new Rect(0, 0, 16, 21); dc.DrawRectangle(_brush, null, rect); // dc.DrawLine(_pen, new Point(12, 1), new Point(12, 4)); dc.DrawLine(_pen, new Point(14, 1), new Point(14, 4)); // dc.DrawEllipse(Brushes.White, _pen, new Point(8, 11), 5, 5); //   rect = new Rect(10, 10, 4, 2); dc.DrawRectangle(Brushes.White, _pen, rect); } private Pen _pen; private Brush _brush; }</span></span></code> </pre><br>  Despite the fact that all the specified coordinates are integer, the imposition on the pixel grid in the control space will occur as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/588/630/780/58863078006560ffe9a915639e9c7a22.png"></div><br><img align="left" src="https://habrastorage.org/getpro/habr/post_images/724/954/d7a/724954d7ac2cd7a2f61102d64c925389.gif">  The width of the pen is counted in both directions from the given coordinates of the line.  If the half of the pen is not divided by the width of the pixel completely, then the edges of the line do not fall into the borders of the pixels, even if the given coordinates fit them exactly.  If the image is complex, then it may turn out that the image is not shifted, but it‚Äôs impossible to ensure that all its components are clear.  The illustration shows the movement of the image in increments of 0.2 pixels. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a5c/a69/d99/a5ca69d99a6408ef8efa3276f0dd3ef9.gif"><img src="https://habrastorage.org/getpro/habr/post_images/a5c/a69/d99/a5ca69d99a6408ef8efa3276f0dd3ef9.gif"><img src="https://habrastorage.org/getpro/habr/post_images/a5c/a69/d99/a5ca69d99a6408ef8efa3276f0dd3ef9.gif"><img src="https://habrastorage.org/getpro/habr/post_images/a5c/a69/d99/a5ca69d99a6408ef8efa3276f0dd3ef9.gif"><img src="https://habrastorage.org/getpro/habr/post_images/a5c/a69/d99/a5ca69d99a6408ef8efa3276f0dd3ef9.gif"><br clear="all"><br clear="all"><h5>  Opposition </h5><br>  WPF provides special pixel-binding facilities - <a href="http://msdn.microsoft.com/en-us/library/aa348553%2528v%3Dvs.85%2529.aspx">guidelines</a> .  At the stage of forming a chain of actions for drawing a control (this is exactly what the <i>OnRender</i> method <i>does</i> ) you can specify the vertical and horizontal coordinates in the control space, which, when output, should fall exactly within the pixel boundaries. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ec/b5d/609/7ecb5d609b8234d73ff03a3602619a5c.png"></div><br>  In code, it looks like this ( <i>OnRender</i> method <i>only</i> ): <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnRender</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DrawingContext dc</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> halfPen = _pen.Thickness / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-comment"><span class="hljs-comment">// var snapX = new double[] { 1, 12 }; var snapY = new double[] { 21 + halfPen }; dc.PushGuidelineSet(new GuidelineSet(snapX, snapY)); dc.DrawLine(_pen, new Point(1, 21), new Point(4, 21)); dc.DrawLine(_pen, new Point(12, 21), new Point(15, 21)); dc.Pop(); // snapX = new double[] { 0, }; snapY = new double[] { 21 }; dc.PushGuidelineSet(new GuidelineSet(snapX, snapY)); var rect = new Rect(0, 0, 16, 21); dc.DrawRectangle(_brush, null, rect); dc.Pop(); // snapX = new double[] { 12 - halfPen }; snapY = new double[] { 1 }; dc.PushGuidelineSet(new GuidelineSet(snapX, snapY)); dc.DrawLine(_pen, new Point(12, 1), new Point(12, 4)); dc.DrawLine(_pen, new Point(14, 1), new Point(14, 4)); dc.Pop(); // snapX = new double[] { 3 - halfPen }; snapY = new double[] { 6 - halfPen }; dc.PushGuidelineSet(new GuidelineSet(snapX, snapY)); dc.DrawEllipse(Brushes.White, _pen, new Point(8, 11), 5, 5); dc.Pop(); //   snapX = new double[] { 10 - halfPen }; snapY = new double[] { 10 - halfPen }; dc.PushGuidelineSet(new GuidelineSet(snapX, snapY)); rect = new Rect(10, 10, 4, 2); dc.DrawRectangle(Brushes.White, _pen, rect); dc.Pop(); }</span></span></code> </pre><br><img align="left" src="https://habrastorage.org/getpro/habr/post_images/7f2/d69/a62/7f2d69a62c83480d7dfdc17e04e8b24f.gif">  To work with guides, you do not need to know the current output resolution.  It is enough to arrange them properly in local coordinates of the control.  The above example works correctly only in the standard resolution of 96 dpi, in which the pen width is the same as the pixel size.  To achieve clear line boundaries in other resolutions, you will have to assign a guide to each of its sides. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5d5/bc3/cf8/5d5bc3cf856c25052edcdcb805773ba1.gif"><img src="https://habrastorage.org/getpro/habr/post_images/5d5/bc3/cf8/5d5bc3cf856c25052edcdcb805773ba1.gif"><img src="https://habrastorage.org/getpro/habr/post_images/5d5/bc3/cf8/5d5bc3cf856c25052edcdcb805773ba1.gif"><img src="https://habrastorage.org/getpro/habr/post_images/5d5/bc3/cf8/5d5bc3cf856c25052edcdcb805773ba1.gif"><img src="https://habrastorage.org/getpro/habr/post_images/5d5/bc3/cf8/5d5bc3cf856c25052edcdcb805773ba1.gif"><br><br>  An important nuance is that with the <i>DrawingContext the</i> guides interact through the stack and at the same time affect the entire current output, and not only the shapes, within the boundaries of which they fall.  That is why in the example for alignment of two parallel lines only one guideline for each axis is used.  If you collect all the used guides and at once push into the stack, then the result will be deplorable.  Because of the conflict, only some of them will work, the rest will be ignored. <br><br>  Alignment to the pixel boundaries along the guides is carried out in both directions, so in different situations different parts of the image can be moved in different directions.  When the picture is moved, parts of the washing machine dangle relative to each other, and in some situations the legs disappear.  You can change the image by optimizing for stable output at a specific resolution, as was done in the previous section, but you will not be able to achieve stable output at any resolution.  Below, an alternative method of snapping to pixels, devoid of this disadvantage, is considered. <br><br><h5>  Alternative opposition </h5><br>  It is not necessary to use guides to bind to pixels when drawing controls independently.  Cycling lovers can fall within the pixel boundaries by manually correcting the primitives drawn.  It is not as difficult as it may seem.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The following conditions will be required: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the coordinates of the source data should fall within the pixel boundaries. </font><font style="vertical-align: inherit;">For 96 dpi, you can use </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Math.Round</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , for the general case you will have to round it to a specific pixel size;</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the width of the pens used must be a multiple of the pixel size; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in cases where the width of the pen contains an odd number of pixels, the coordinates of the displayed primitive must be shifted by half the width of the pixel; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">when displaying a control, it is necessary to make a correction for the shift of its coordinates relative to the raster grid and restart </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OnRender</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for any of its movements.</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The first two points can be implemented using such a static class (its fragments were given in the first two sections): </font></font><br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//           public static class Render { static Render() { var flags = BindingFlags.NonPublic | BindingFlags.Static; var dpiProperty = typeof(SystemParameters).GetProperty("Dpi", flags); Dpi = (int)dpiProperty.GetValue(null, null); PixelSize = 96.0 / Dpi; HalfPixelSize = PixelSize / 2; } //      public static double PixelSize { get; private set; } //  public static int Dpi { get; private set; } //    static public double SnapToPixels(double value) { value += HalfPixelSize; //  DPI    WPF- . //  1000  -   //     double //2.4 / 0.4 = 5.9999999999999991 //2400.0 / 400.0 = 6.0 var div = (value * 1000) / (PixelSize * 1000); return (int)div * PixelSize; } private static readonly double HalfPixelSize; }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If any value (for example, the pen width or screen coordinate) needs to be tightly bound to the pixel size, then it is enough to set it as </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Render.PixelSize * n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . If you need to round it to a multiple of the pixel size, then you need to use the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Render.SnapToPixels</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is convenient to implement the third and fourth conditions (correction for subpixel shifts of controls and odd sizes of feathers) as a base class for self-drawn controls:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SelfDrawingControlBase</span></span> : <span class="hljs-title"><span class="hljs-title">FrameworkElement</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SelfDrawingControlBase</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Snap = <span class="hljs-number"><span class="hljs-number">0.5</span></span> * Render.PixelSize; SubpixelOffset = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); LayoutUpdated += OnLayoutUpdated; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnLayoutUpdated</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span> { FixSubpixelOffset(); InvalidateVisual(); } <span class="hljs-comment"><span class="hljs-comment">//         protected void SnapLine(Pen pen, ref Point begin, ref Point end) { var snapX = -SubpixelOffset.X; var snapY = -SubpixelOffset.Y; if (IsOdd(pen.Thickness)) { if (begin.X == end.X) snapX += Snap; if (begin.Y == end.Y) snapY += Snap; } begin.X += snapX; begin.Y += snapY; end.X += snapX; end.Y += snapY; } //         protected void SnapRectangle(Pen pen, ref Rect rect) { var snapX = -SubpixelOffset.X; var snapY = -SubpixelOffset.Y; if (pen != null &amp;&amp; IsOdd(pen.Thickness)) { snapX += Snap; snapY += Snap; } rect.Location = new Point(rect.Left + snapX, rect.Top + snapY); } //         protected void SnapEllipse(Pen pen, ref Point center) { var snapX = -SubpixelOffset.X; var snapY = -SubpixelOffset.Y; if (pen != null &amp;&amp; IsOdd(pen.Thickness)) { snapX += Snap; snapY += Snap; } center.X += snapX; center.Y += snapY; } //       protected double Snap { get; private set; } //      protected Point SubpixelOffset { get; private set; } //      //        private void FixSubpixelOffset() { var offset = TranslatePoint(new Point(0, 0), Application.Current.MainWindow); SubpixelOffset = new Point( ModByPixel(offset.X), ModByPixel(offset.Y)); } //     private static bool IsOdd(double value) { //  DPI    WPF- . //  1000  -   //     double //1.0 % 0.1 = 0.09999999999999995 //1000.0 % 100.0 = 0.0 return (value * 1000) % (Render.PixelSize * 2 * 1000) != 0; } //      private static double ModByPixel(double value) { return ((value * 1000) % (Render.PixelSize * 1000)) / 1000; } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The main functionality of this class is to correct the coordinates of graphic primitives before their output. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SnapXXX</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> methods </font><font style="vertical-align: inherit;">change the source data so that the drawing result falls exactly within the pixel boundaries. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rectangles and ellipses can only be shifted entirely by half a pixel with feathers of odd width. For horizontal lines, you need to adjust the Y coordinate and not touch the X coordinate, for the vertical lines - on the contrary. When adjusting the coordinates, the shift of the control relative to the pixel grid is also taken into account. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Snap to pixels in the washing machine example:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Washer</span></span> : <span class="hljs-title"><span class="hljs-title">SelfDrawingControlBase</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Washer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _brush = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SolidColorBrush(Color.FromRgb(<span class="hljs-number"><span class="hljs-number">247</span></span>, <span class="hljs-number"><span class="hljs-number">148</span></span>, <span class="hljs-number"><span class="hljs-number">29</span></span>)); _brush.Freeze(); _pen = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pen(Brushes.Black, <span class="hljs-number"><span class="hljs-number">1</span></span>); _pen.Freeze(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnRender</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DrawingContext dc</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Point start = new Point(1, 21); Point end = new Point(4, 21); SnapLine(_pen, ref start, ref end); dc.DrawLine(_pen, start, end); start = new Point(12, 21); end = new Point(15, 21); SnapLine(_pen, ref start, ref end); dc.DrawLine(_pen, start, end); // var rect = new Rect(0, 0,16, 21); SnapRectangle(null, ref rect); dc.DrawRectangle(_brush, null, rect); // start = new Point(12, 1); end = new Point(12, 4); SnapLine(_pen, ref start, ref end); dc.DrawLine(_pen, start, end); start = new Point(14, 1); end = new Point(14, 4); SnapLine(_pen, ref start, ref end); dc.DrawLine(_pen, start, end); // var center = new Point(8, 11); SnapEllipse(_pen, ref center); dc.DrawEllipse( Brushes.White, _pen, center, 5, 5); //   rect = new Rect(10, 10, 4, 2); SnapRectangle(_pen, ref rect); dc.DrawRectangle(Brushes.White, _pen, rect); } private Pen _pen; private Brush _brush; }</span></span></code> </pre><br><img align="left" src="https://habrastorage.org/getpro/habr/post_images/1e6/6c2/88e/1e66c288effc38d370c9eb6f9c0abe63.gif"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The result is obtained in a similar way with guides, but at the same time stable with respect to movements of the control. This is due to the fact that the correction of coordinates is carried out only in one direction. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/90a/258/f95/90a258f95579a5188b6531b7918aa094.gif"><img src="https://habrastorage.org/getpro/habr/post_images/90a/258/f95/90a258f95579a5188b6531b7918aa094.gif"><img src="https://habrastorage.org/getpro/habr/post_images/90a/258/f95/90a258f95579a5188b6531b7918aa094.gif"><img src="https://habrastorage.org/getpro/habr/post_images/90a/258/f95/90a258f95579a5188b6531b7918aa094.gif"><img src="https://habrastorage.org/getpro/habr/post_images/90a/258/f95/90a258f95579a5188b6531b7918aa094.gif"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The above solution of the example works only in the standard resolution of 96 dpi - pen sizes and primitive coordinates are inserted into the code with specific numbers for clarity. If you need the image to be correctly attached to pixels in any resolutions, then before transferring data to </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SnapXXX</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> methods </font><font style="vertical-align: inherit;">, you need to round them to the pixel boundaries using the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Render.SnapToPixels</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">. </font></font><br clear="all"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here, for example, the control that draws a rectangle, which is adequately scaled when the resolution is changed and thus falls within the boundaries of pixels:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CrossDpiBrick</span></span> : <span class="hljs-title"><span class="hljs-title">SelfDrawingControlBase</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CrossDpiBrick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _brush = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SolidColorBrush(Color.FromRgb(<span class="hljs-number"><span class="hljs-number">247</span></span>, <span class="hljs-number"><span class="hljs-number">148</span></span>, <span class="hljs-number"><span class="hljs-number">29</span></span>)); _brush.Freeze(); _pen = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pen(Brushes.Black, Render.SnapToPixels(<span class="hljs-number"><span class="hljs-number">7</span></span>)); _pen.Freeze(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnRender</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DrawingContext dc</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rect(Render.SnapToPixels(<span class="hljs-number"><span class="hljs-number">10</span></span>), Render.SnapToPixels(<span class="hljs-number"><span class="hljs-number">10</span></span>), Render.SnapToPixels(<span class="hljs-number"><span class="hljs-number">120</span></span>), Render.SnapToPixels(<span class="hljs-number"><span class="hljs-number">40</span></span>)); SnapRectangle(_pen, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> rect); dc.DrawRoundedRectangle(_brush, _pen, rect, Render.SnapToPixels(<span class="hljs-number"><span class="hljs-number">10</span></span>), Render.SnapToPixels(<span class="hljs-number"><span class="hljs-number">10</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Pen _pen; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Brush _brush; }</code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/840/fa4/17c/840fa417cc4866be9653edae2a5d9ca0.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8d2/938/aaa/8d2938aaaa82ceb8cd2f9115b59ec15a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manual snapping to pixels requires a little more intervention in the drawing process than when working with the built-in WPF tools, but it allows you to more flexibly control this process and to achieve stable output at any output resolution.</font></font><br><br><a name="outro"></a><h4>  Conclusion </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WPF provides the developer with all the necessary set of tools to bind to screen pixels. In the standard library of controls, these tools are used by default, and in most cases you can not sabotage yourself with subpixel shifts. However, to achieve a clear conclusion when working with vector and raster graphics, as well as when drawing controls independently, the developer is forced to use pixel snapping tools explicitly. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For this, first of all, it is necessary to notice the arising rasterization problems. It is not so easy. Even the products from Microsoft can not always boast the perfect picture. For example, the elements of the integrated vector graphics editor in Microsoft Word 2010:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d3a/0d8/a54/d3a0d8a54915eb767c055b3851d6654d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Familiar artifacts? </font><font style="vertical-align: inherit;">If now for you the elimination of such detected problems is a matter of technology, the goal of this manual is achieved.</font></font> Thanks for attention! <br><br><a name="links"></a><h4>  Links </h4><br> <a href="http://msdn.microsoft.com/en-us/library/aa970908%2528v%3Dvs.85%2529.aspx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The MSDN - Pixel Snapping in the Applications a WPF </font></font></a> <br> <a href="http://msdn.microsoft.com/en-us/library/system.windows.uielement.uselayoutrounding%2528v%3Dvs.95%2529.aspx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the MSDN - UIElement.UseLayoutRounding the Property </font></font></a> <br> <a href="http://10rem.net/blog/2010/06/06/wpf-and-silverlight-choose-your-fonts-and-text-rendering-options-wisely"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pete Brown is - your Fonts-in Choose the Text and the Rendering the Options Wisely </font></font></a> <br> <a href="http://blogs.msdn.com/b/text/archive/2009/08/24/wpf-4-0-text-stack-improvements.aspx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the MSDN Blogs - a WPF 4.0 the Text the Stack Improvements </font></font></a> <br> <a href="http://msdn.microsoft.com/en-us/library/aa348553%2528v%3Dvs.85%2529.aspx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the MSDN - How to: the Apply a GuidelineSet to a the Drawing </font></font></a> <br> <a href="http://msdn.microsoft.com/en-us/library/system.windows.uielement.snapstodevicepixels%2528v%3Dvs.110%2529.aspx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the MSDN - UIElement.SnapsToDevicePixels the Property</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Source demo code: </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">download (104 Kb)</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Thanks for the illustrations: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/732/528/7d8/7325287d86af271889d67acfcd7ce0bb.png"> <a href="http://romson.livejournal.com/tag/my_pixels"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">romson </font></font></a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/de7/0cd/c82/de70cdc82288543e700c64a00f7507b5.png"> <a href="http://habrahabr.ru/users/melkopuz/" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">melkopuz </font></font></a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d7b/a2b/c85/d7ba2bc85f5f319ba8d2125f4d5580c6.png"> <a href="http://gamin.ru/users/sevendot"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sevendot</font></font></a> </div><p>Source: <a href="https://habr.com/ru/post/216833/">https://habr.com/ru/post/216833/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../216817/index.html">Payment from the account of a corporate or personal phone as from a bank account</a></li>
<li><a href="../216825/index.html">The logic of thinking. Part 16. Batch presentation of information</a></li>
<li><a href="../216827/index.html">CPU Load: when to start worrying?</a></li>
<li><a href="../216829/index.html">10 slideshows with AgileDays 2014</a></li>
<li><a href="../216831/index.html">VK Friendly Link Analysis with Wolfram Mathematica</a></li>
<li><a href="../216837/index.html">Devise: login and registration in modal windows</a></li>
<li><a href="../216839/index.html">The colors and the difference between them in LESS / Sass</a></li>
<li><a href="../216843/index.html">We start to study Cortex-M on the example of STM32</a></li>
<li><a href="../216845/index.html">Search for solutions for games with words. Boron application</a></li>
<li><a href="../216849/index.html">Setting up the development environment for OpenStack</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>