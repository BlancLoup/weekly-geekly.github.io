<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Setting up your own GIT / SVN / Mercurial server based on SCM Manager for Tomcat under Debian</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The other day, the team was faced with the fact that Bitbucket became small for us, and focusing on the similarity of corporate security, in any case,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Setting up your own GIT / SVN / Mercurial server based on SCM Manager for Tomcat under Debian</h1><div class="post__text post__text-html js-mediator-article">  The other day, the team was faced with the fact that Bitbucket became small for us, and focusing on the similarity of corporate security, in any case, sooner or later will require moving from private repositories outside the company to their own infrastructure.  After surfing the Internet, it was decided to stop at the ready solution SCM - manager for a number of reasons <br><br><ul><li>  Easy installation </li><li>  Easy administration via web interface </li><li>  GIT and SVN support (not least because both are used) </li></ul><br><br>  Installation OS: Debian7 <br>  It is worth noting that no one has come across this before and the article is the result of several hours of throwing through the Internet and manuals. <br>  SCM was put on Tomcat, because Redmine is spinning on it <br>  The installation and configuration under the cut: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><h4>  Setup service software </h4><br><ol><li>  We put JRE (necessary for Apache Tomcat) <br><pre><code class="bash hljs">su apt-get install openjdk-6-jre</code> </pre> </li><li>  Downloading the latest version of Apache Tomcat <a href="http://tomcat.apache.org/download-70.cgi">from here</a> (Required for the SCM-manager services) <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /tmp wget file http://www.sai.msu.su/apache/tomcat/tomcat-7/v7.0.41/bin/apache-tomcat-7.0.41.tar.gz</code> </pre></li><li>  Unpack it, remove the garbage and drop the folder with Tomkat in / etc <br><pre> <code class="bash hljs">tar xzf apache-tomcat-7.0.41.tar.gz mv apache-tomcat-7.0.41 tomcat7 rm apache-tomcat-7.0.41.tar.gz mv /tmp/tomcat7/ /etc</code> </pre></li><li>  Create a group, user for Tomkat and assign permissions to the directory <br><pre> <code class="bash hljs">groupadd tomcat7 useradd -g tomcat7 -d /etc/tomcat7 tomcat7 usermod -G www-data tomcat7 chown -R tomcat7:tomcat7 /etc/tomcat7</code> </pre></li><li>  Let's add Tomkat to autoload (Note the JAVA_HOME variable in the script - you may not have amd64, - it depends on the server architecture) <br><pre> <code class="bash hljs">nano /etc/init.d/tomcat</code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash CATALINA_HOME=/etc/tomcat7; export CATALINA_HOME JAVA_HOME=/usr/lib/jvm/java-6-openjdk-amd64; export JAVA_HOME TOMCAT_OWNER=tomcat7; export TOMCAT_OWNER JAVA_OPTS="-Xms128M -Xmx128M"; export JAVA_OPTS start() { echo -n "Starting Tomcat: " su $TOMCAT_OWNER -c $CATALINA_HOME/bin/startup.sh } stop() { echo -n "Stopping Tomcat: " su $TOMCAT_OWNER -c $CATALINA_HOME/bin/shutdown.sh } case "$1" in start) start ;; stop) stop ;; restart) stop start ;; *) echo $"Usage: tomcat {start|stop|restart}" exit esac</span></span></code> </pre><br><pre> <code class="bash hljs">chmod +x /etc/tomcat7/bin/*.sh chmod +x /etc/init.d/tomcat</code> </pre></li><li>  We start and check the server <br><pre> <code class="bash hljs">/etc/init.d/tomcat start</code> </pre><br>  http: //***.***.***.178: 8080 </li><li>  To access Tomkat's interface to a file <br><pre> <code class="bash hljs">nano /etc/tomcat7/conf/tomcat-users.xml</code> </pre><br>  add a line inside the &lt;tomcat-users&gt; tag <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"admin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">password</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">roles</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"manager-gui,manager-status,manager-script,manager-jmx"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre></li><li>  We throw Tomkata service on port 80 <br><div class="spoiler">  <b class="spoiler_title">Right but difficult</b> <div class="spoiler_text"><pre> <code class="bash hljs">nano /etc/tomcat7/conf/server.xml</code> </pre><br>  Change the lines <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Connector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">port</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"80"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">protocol</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HTTP/1.1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">connectionTimeout</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">redirectPort</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"8443"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  We put authbind in order to transfer it to ports below 1024 <br><pre> <code class="bash hljs"> apt-get install authbind</code> </pre><br><pre> <code class="bash hljs">touch /etc/authbind/byport/80 chmod 500 /etc/authbind/byport/80 chown tomcat7 /etc/authbind/byport/80</code> </pre><br>  To file <br><pre> <code class="bash hljs">nano /etc/tomcat7/bin/setenv.sh</code> </pre><br>  write down <br><pre> <code class="bash hljs">CATALINA_OPTS=<span class="hljs-string"><span class="hljs-string">"-Djava.net.preferIPv4Stack=true"</span></span></code> </pre><br>  and change the last line in the file <br><pre> <code class="bash hljs">nano /etc/tomcat7/bin/startup.sh</code> </pre><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> authbind --deep <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$PRGDIR</span></span></span><span class="hljs-string">"</span></span>/<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$EXECUTABLE</span></span></span><span class="hljs-string">"</span></span> start <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$@</span></span></span><span class="hljs-string">"</span></span></code> </pre><br></div></div></li><li><div class="spoiler">  <b class="spoiler_title">Not quite right</b> <div class="spoiler_text"><pre> <code class="bash hljs">/sbin/iptables -t nat -I PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 8080 /sbin/service iptables save</code> </pre> <br></div></div></li><li>  Restart Tomkat <br><pre> <code class="bash hljs">/etc/init.d/tomcat restart</code> </pre></li></ol><br><br><h4>  SCM installation </h4><br><ul><li>  Download SCM-manager <a href="https://bitbucket.org/sdorra/scm-manager/wiki/download">from here</a> <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /tmp wget file http://maven.scm-manager.org/nexus/content/repositories/releases/sonia/scm/scm-webapp/1.32/scm-webapp-1.32.war</code> </pre></li><li>  We transfer it to Tomkat's daddy webapps <br><pre> <code class="bash hljs">mv scm-webapp-1.32.war scm.war mv scm.war /etc/tomcat7/webapps</code> </pre></li><li>  We are waiting for the application to unfold, check it http: //***.***.***.178/scm/ </li></ul><br>  Login Details: scmadmin / scmadmin <br><img src="https://habrastorage.org/getpro/habr/post_images/358/b9c/112/358b9c112ea6166d4db144f6e09e620f.png"><br>  In the section Users add your own <br><img src="https://habrastorage.org/getpro/habr/post_images/592/17b/479/59217b4790e87342463e9fcbc4ed055d.png"><br>  Create your own repository <br><img src="https://habrastorage.org/getpro/habr/post_images/1ef/2f9/110/1ef2f9110bab0ec766103ee76f81817f.png"><br>  Further it is available by reference. <br>  http: //***.***.***.178/scm/git/tglync, to which we clone further. <br><br>  Repositories can be easily imported, and there are also many ready-made plugins, using which you can customize SCM for yourself, for example, add notifications.  Plugins are also connected via a web interface. <br>  If desired, the SCM web client can also be customized externally. <br><br>  Thank you all, I hope it was not useless. </div><p>Source: <a href="https://habr.com/ru/post/184964/">https://habr.com/ru/post/184964/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../184954/index.html">Windows 8.1 (aka Blue) Preview available for download</a></li>
<li><a href="../184956/index.html">Parsing a CSV file with bash and awk</a></li>
<li><a href="../184958/index.html">Drawings in SVG format. Part 1 - Draft Standard</a></li>
<li><a href="../184960/index.html">Self build cURL for iOS and Android</a></li>
<li><a href="../184962/index.html">Travel book tester</a></li>
<li><a href="../184966/index.html">Home mini climate control do-it-yourself</a></li>
<li><a href="../184968/index.html">Rovnix bootkit update. Article translation</a></li>
<li><a href="../184970/index.html">Driver for PostgreSQL on Node.js</a></li>
<li><a href="../184972/index.html">Instead of passwords tattoo and ... pills</a></li>
<li><a href="../184974/index.html">Please support the symbol of domestic currency</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>