<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tarantool 1.6 - let's get started</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago on Habr√© was published an article about the NoSQL database - "Tarantool 1.6 in the first person" . I am sure this database is well kno...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tarantool 1.6 - let's get started</h1><div class="post__text post__text-html js-mediator-article">  Not so long ago on Habr√© was published an article about the NoSQL database - <a href="http://habrahabr.ru/company/mailru/blog/252065/">"Tarantool 1.6 in the first person"</a> .  I am sure this database is well known in its circles and is already gaining popularity.  I am also sure that there are those <s>beginners,</s> <s>they did not reach the hands</s> , who would like to try Tarantool in action.  For those who wish, I will give a few simple examples to help you begin to get acquainted with this interesting product.  As is clear from the title of the article - this is a version of Tarantool 1.6. <br><a name="habracut"></a><br><h4>  Install </h4><br>  The <a href="http://tarantool.org/">project site</a> describes in detail installation options for different systems.  For Ubuntu it looks like this: <br><br><pre><code class="bash hljs">wget http://tarantool.org/dist/public.key sudo apt-key add ./public.key release=`lsb_release -c -s` cat &gt; /etc/apt/sources.list.d/tarantool.list &lt;&lt;- EOF deb http://tarantool.org/dist/master/ubuntu/ <span class="hljs-variable"><span class="hljs-variable">$release</span></span> main deb-src http://tarantool.org/dist/master/ubuntu/ <span class="hljs-variable"><span class="hljs-variable">$release</span></span> main EOF sudo apt-get update sudo apt-get install tarantool</code> </pre> <br><h4>  Hello world! </h4><br>  Tarantool uses Lua as an embedded language (Lua 5.1 based on on LuaJIT 2.0).  The lua language is not difficult, you can quickly get acquainted with its basics <a href="https://zserge.wordpress.com/2012/02/23/lua-%25D0%25B7%25D0%25B0-60-%25D0%25BC%25D0%25B8%25D0%25BD%25D1%2583%25D1%2582/">here</a> or on Habr√© in the publication <a href="http://habrahabr.ru/post/184538/">‚ÄúLua in 15 minutes‚Äù</a> .  You can use Tarantool as a Lua interpreter. <br><br><pre> <code class="bash hljs">$ /usr/bin/tarantool /usr/bin/tarantool: version 1.6.4-509-ga4af00e <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'help'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> interactive <span class="hljs-built_in"><span class="hljs-built_in">help</span></span> tarantool&gt; 2 + 3 --- - 5 ... tarantool&gt; <span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (<span class="hljs-string"><span class="hljs-string">'Ola lua!'</span></span>) Ola lua! --- ...</code> </pre><br>  You can also write your logic using Lua scripts.  Let's write the starting init.lua to run Tarantool and output the 'Hello world'. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      One of the main tarantool libraries is <a href="http://tarantool.org/doc/book/box/index.html">box</a> .  Using box.cfg (in lua {...} is a table) we create a launch configuration: <br><br><pre> <code class="lua hljs">box.cfg { listen = <span class="hljs-number"><span class="hljs-number">3311</span></span>, logger = <span class="hljs-string"><span class="hljs-string">'tarantool.log'</span></span>, }</code> </pre><br>  Tarantool will be launched on port 3311 and will store logs in tarantool.log: <br><br>  Create the hello () function <br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hello</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span> (<span class="hljs-string"><span class="hljs-string">'Hello world!) end hello()</span></span></code> </pre><br>  Run and see: <br><br><pre> <code class="lua hljs">$ tarantool init.lua Hello world!</code> </pre><br><h4>  Data base </h4><br>  In tarantool, tuples are stored in spaces (space) - some kind of analogue of a table. <br><br>  Create a test space and a primary (primary) index in it (you can also build a secondary for all record fields), using the tree to store the indices: <br><br><pre> <code class="lua hljs">s = box.schema.space.<span class="hljs-built_in"><span class="hljs-built_in">create</span></span>(<span class="hljs-string"><span class="hljs-string">'test'</span></span>) p = s:create_index(<span class="hljs-string"><span class="hljs-string">'primary'</span></span>, {<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> = <span class="hljs-string"><span class="hljs-string">'tree'</span></span>, parts = {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'NUM'</span></span>}})</code> </pre><br>  Fill test records of the form {key, number}: <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> s:<span class="hljs-built_in"><span class="hljs-built_in">insert</span></span>({i, i}) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  In this case, the object s is a reference to the box.space.test object.  Accordingly, it was possible to write: <br><br><pre> <code class="lua hljs">box.space.test:<span class="hljs-built_in"><span class="hljs-built_in">insert</span></span>({i, i})</code> </pre><br>  By the way, you may encounter such an error when you restart tarantool: <br><br><pre> <code class="bash hljs">$ tarantool init.lua Hello world! main/101/init.lua F&gt; Space <span class="hljs-string"><span class="hljs-string">'test'</span></span> already exists</code> </pre><br>  Tarantool stores all its data in RAM.  For their safety Tarantool takes snapshots (snapshot) and binary logs (xlog).  The error occurs due to the fact that at startup Tarantool loads data from the last use using the .snap files (snapshots) and .xlog files (by default in the working directory).  Accordingly, your test space is already present in the database.  You can delete .snap and .xlog each time you start it, or you can add a check for the existence of space. <br><br><pre> <code class="lua hljs">s = box.space.test <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> s <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> s = box.schema.space.<span class="hljs-built_in"><span class="hljs-built_in">create</span></span>(<span class="hljs-string"><span class="hljs-string">'test'</span></span>) p = s:create_index(<span class="hljs-string"><span class="hljs-string">'primary'</span></span>, {<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> = <span class="hljs-string"><span class="hljs-string">'tree'</span></span>, parts = {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'NUM'</span></span>}}) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> s:<span class="hljs-built_in"><span class="hljs-built_in">insert</span></span>({i, i}) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  It would be very nice to check if our data is saved, our configuration in the running Tarantool.  For this, a console for the administrator is provided.  In general, in lua, the implementation of connecting various modules, embedded packages, other files with code occurs through the require mechanism. <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> console = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'console'</span></span>) console.listen(<span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">3312</span></span>)</code> </pre><br>  After launching Tarantool, you can connect to the admin console on port 3312 using the nc / telnet and rlwrap utilities (for ease of operation).  Once connected, you can work directly with Tarantool.  Let's see, for example, the data of our test space: <br><br><pre> <code class="bash hljs">$ rlwrap nc 0 3312 Tarantool 1.6.4-509-ga4af00e (Lua console) <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'help'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> interactive <span class="hljs-built_in"><span class="hljs-built_in">help</span></span> box.space.test:select() --- - - [1, 1] - [2, 2] - [3, 3] - [4, 4] - [5, 5] - [6, 6] - [7, 7] - [8, 8] - [9, 9] - [10, 10] ... box.space.test:get(6) --- - [6, 6] ...</code> </pre><br>  Let's look at the configuration parameters of our Tarantool: <br><br><div class="spoiler">  <b class="spoiler_title">box.cfg</b> <div class="spoiler_text"><pre> <code class="bash hljs">box.cfg --- - snapshot_count: 6 too_long_threshold: 0.5 slab_alloc_factor: 2 slab_alloc_maximal: 1048576 background: <span class="hljs-literal"><span class="hljs-literal">false</span></span> logger: tarantool.log slab_alloc_arena: 1 sophia: page_size: 131072 threads: 5 node_size: 134217728 memory_limit: 0 listen: <span class="hljs-string"><span class="hljs-string">'3311'</span></span> logger_nonblock: <span class="hljs-literal"><span class="hljs-literal">true</span></span> snap_dir: . coredump: <span class="hljs-literal"><span class="hljs-literal">false</span></span> sophia_dir: . wal_mode: write slab_alloc_minimal: 64 panic_on_snap_error: <span class="hljs-literal"><span class="hljs-literal">true</span></span> panic_on_wal_error: <span class="hljs-literal"><span class="hljs-literal">true</span></span> rows_per_wal: 500000 wal_dir: . log_level: 5 readahead: 16320 snapshot_period: 0 wal_dir_rescan_delay: 0.1 ...</code> </pre><br></div></div><br>  So, having created the space, we will perform the following task: in the records with the key&gt; 5, we increase the value of the stored number by 10. <br>  For the necessary sample we will use the <a href="http://tarantool.org/doc/book/box/box_index.html">box.index</a> library. <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k,v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> box.space.test.index.primary:<span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>(<span class="hljs-number"><span class="hljs-number">5</span></span>, {iterator = box.index.GT}) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> s:update(v[<span class="hljs-number"><span class="hljs-number">1</span></span>], {{<span class="hljs-string"><span class="hljs-string">'='</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, v[<span class="hljs-number"><span class="hljs-number">2</span></span>] + <span class="hljs-number"><span class="hljs-number">10</span></span>}}) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  box.space.index.primary - means working with the test space and its primary index. <br>  pairs () is an iteration function that returns an iterator (variable k in a loop) and a table of values ‚Äã‚Äã(consists of a set of records v), accepts the key value (5) ‚Äîthe start of the iteration and the type of iterator. <br>  iterator = box.index.GT - the GT (greater) iterator returns records with keys greater than the specified one. <br>  update () - update of the record in the database, takes the value of the record key (v [1]), <br>  {'=', 2, v [2] + 10} - indicates the update ('=') of the second value on v [2] + 10. <br><br>  Let's see, using the admin console, the values ‚Äã‚Äãof our space: <br><br><pre> <code class="bash hljs">box.space.test:select() --- - - [1, 1] - [2, 2] - [3, 3] - [4, 4] - [5, 5] - [6, 16] - [7, 17] - [8, 18] - [9, 19] - [10, 20] ...</code> </pre><br><div class="spoiler">  <b class="spoiler_title">The general code of our init.lua script:</b> <div class="spoiler_text"><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">--  init c  tarantool --       --     local console = require('console') --    console.listen('127.0.0.1:3312') --  tarantool box.cfg { listen = 3311, logger = 'tarantool.log', } local function hello() print ('Hello world!') end --   hello hello() --     space,    s = box.space.test if not s then s = box.schema.space.create('test') --   p = s:create_index('primary', {type = 'tree', parts = {1, 'NUM'}}) for i = 1, 10 do s:insert({i, i}) end end --      ,     5 for k,v in box.space.test.index.primary:pairs(5, {iterator = box.index.GT}) do s:update(v[1], {{'=', 2, v[2] + 10}}) end</span></span></code> </pre><br></div></div><br>  Of course, to fully master Tarantool, to know its subtleties, you need to read the documentation on the project website.  After all, apart from everything, Tarantool is not only a database, but also a lua application server.  For example, there is an <a href="http">http server</a> and <a href="https://github.com/tarantool/queue">queues</a> .  But the first step has been taken - you wrote your little script for Tarantool. <br><br>  You can also read about Tarantool (in the examples there are older versions of the project) in other articles on Habr√©: <br>  <a href="http://habrahabr.ru/company/mailru/blog/192076/">"We study Tarantool + Lua"</a> , <br>  <a href="http://habrahabr.ru/post/133435/">"Unique features Tarantool</a> . <a href="http://habrahabr.ru/post/133435/">"</a> <br><br>  Also, without any installation, you can try Tarantool on <a href="http://try.tarantool.org/">try.tarantool.org</a> . </div><p>Source: <a href="https://habr.com/ru/post/254533/">https://habr.com/ru/post/254533/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../254523/index.html">Designer interactive exercises for online learning</a></li>
<li><a href="../254525/index.html">I want from API a line, and a point, and a point</a></li>
<li><a href="../254527/index.html">Android - Custom View or ToggleButton 4x4</a></li>
<li><a href="../254529/index.html">Comparison of online consultants for the site: flour choice</a></li>
<li><a href="../254531/index.html">Programming Philosophy 6 - Product and Project</a></li>
<li><a href="../254537/index.html">Document generator docx and xlsx</a></li>
<li><a href="../254541/index.html">We work with Compound File</a></li>
<li><a href="../254543/index.html">Research on IT leadership factors</a></li>
<li><a href="../254545/index.html">Damage to the stack in one of the NSString methods</a></li>
<li><a href="../254549/index.html">Coub goes to strike</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>