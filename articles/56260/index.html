<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GRUB2 and Xen kernels</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Yesterday I wrote a little obzorchik of the new loader GRUB 2. And one unpleasant thing caught my attention. After all, if nothing works, you don‚Äôt pa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GRUB2 and Xen kernels</h1><div class="post__text post__text-html js-mediator-article">  Yesterday I wrote a <a href="http://boh.habrahabr.ru/blog/56216/">little obzorchik of the</a> new loader GRUB 2. And one unpleasant thing caught my attention.  After all, if nothing works, you don‚Äôt pay attention to it.  So, I decided to try Xen-based virtualization.  She demanded to install a modified kernel.  Of course, the developers have not yet thought about such subtleties, so the newly added menu item did not work.  Obviously, we have two choices.  We need either a script that correctly finds the kernel and correctly composes the menu item, or we have to manually enter the menu item with handles in / boot / grub/grub.cfg. <br>  Naturally, I didn‚Äôt really understand what the right menu item should look like, so I went to Google.  He prompted me to note <a href="http://daniel.mateos.cc/wordpress/2008/02/07/xen-with-grub2-on-debian-etch/">‚Äúxen with grub2 on debian etch‚Äù</a> in a blog of a simple Australian guy named Daniel Mateos.  The article helped me and everything would be fine if Daniel didn‚Äôt take down his blog :) More precisely, he was tired of Wordpress, and he, with his hand somewhere out of place, created a new site on django.  That's why I decided to write what was considered in his article here.  For greater safety. <br><a name="habracut"></a><br>  GRUB2 attracted Australian admins supporting GPT / EFI partitions, with which you can use disks larger than 2TB (they needed 5TB).  Like any person who has run a gossip on the topic of documentation on GRUB2, the guys are very upset.  She is not.  Therefore, they hoped that the following will benefit you. <br><br><h4>  0. Prepare GRUB </h4><br>  Open and edit /etc/kernel-img.conf, bringing it to this form: <br> <code>do_symlinks = yes <br> relative_links = yes <br> do_bootloader = no <br> do_bootfloppy = no <br> do_initrd = yes <br> link_in_boot = no <br> postinst_hook = update-grub <br> postrm_hook = update-grub</code> <br>  All lines are intuitive.  The config defines how the system will behave when installing a new kernel from a deb package.  More details in <a href="http://www.tin.org/bin/man.cgi%3Fsection%3D5%26topic%3Dkernel-img.conf">man kernel-img.conf</a> <br><br>  Next steps: <br> <code># mount /dev/sda1 /boot <br> # apt-get install grub-pc <br> # grub-install /dev/sda <br> # apt-get install linux-image-2.6.18-5-amd64</code> <br> <br>  Line by line decoding: <br>  1. Mount the necessary section in the appropriate directory.  It is absolutely not necessary. <br>  2. Install, in fact, GRUB 2. It is strange if you are not worth it. <br>  3. Register the bootloader in the boot sector of the hard disk.  This may take some time. <br>  4. Install the kernel.  After this, GRUB will add it to the menu itself.  The kernel is normal, not Xen-ovsky, so problems should not arise. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  1. Installing Xen Items <br></h4><br> <code># apt-get install xen-hypervisor-3.2-1-amd64 <br> # apt-get install xen-docs-3.2 xen-utils-3.2-1 xen-tools <br> # apt-get install libc6-xen <br> # apt-get install linux-image-2.6.18-5-xen-amd64 <br> # apt-get install xen-linux-system-2.6.18-5-xen-amd64 <br> # apt-get install xen-linux-system-2.6.18-5-xen-vserver-amd64</code> <br> <br>  I note that the author installs a specific kernel version (2.6.18-5) for a specific architecture (amd64).  No need to stupidly copy-paste these commands.  Adjust them according to your system and preferences. <br><br><h4>  2.1.  Manually adding entries to the menu </h4><br>  Just to remind you: this is not the right way to edit the menu.  According to the rules, we need to write a script that would make such entries for Xen automatically.  But if time is more precious to you than system reliability, you can do that.  Everything will work until the next update of the bootloader. <br>  Add a similar entry to the end of grub.cfg: <br><br> <code>menuentry ‚ÄúXen 3.2‚Ä≥ { <br> multiboot (hd0,1)/xen-3.2-1-amd64.gz dom0_mem=256M <br> module (hd0,1)/vmlinuz-2.6.18-5-xen-amd64 root=/dev/sda2 ro <br> module (hd0,1)/initrd.img-2.6.18-5-xen-amd64 <br> }</code> <br> <br>  Now, after rebooting, you should be in the dom0 kernel running inside the Xen hypervisor. <br><br><h4>  2.2 Script to solve the problem correctly </h4><br>  This script is provided in a comment to a post by a man named Roger Smith.  Of course, he needs to be improved, but the basis has been laid and from here one can understand the logic of the script's actions. <br><br> <code>#!/bin/bash <br> set -e <br> <br> kernels=`ls /boot/vmlinuz-*-xen-*|sed s/‚Äù.*vmlinuz-‚Äù//` 2&gt;/dev/null <br> initrds=`ls /boot/vmlinuz-*-xen-*|sed s/‚Äù.*initrd.img-‚Äù//` 2&gt;/dev/null <br> xenimgs=`ls /boot/xen-*|sed s/‚Äù.*xen-‚Äù//|sed s/‚Äù.gz‚Äù//` 2&gt;/dev/null <br> MODULE=‚Äù}‚Äù <br> for i in $xenimgs; do <br> for j in $kernels; do <br> echo ‚ÄúFound xen kernel and image: $j ‚Äì&gt; $i‚Äù &gt;&amp;2 <br> echo ‚Äú$initrds‚Äù | grep $j &gt; /dev/null 2&gt;&amp;1 <br> if [ $? -eq 0 ]; then <br> MODULE=‚Äùmodule ${GRUB_DRIVE_BOOT}/initrd.img-$j <br> }‚Äù <br> else <br> MODULE=‚Äù}‚Äù <br> fi <br> <br> cat &lt;&lt; EOF <br> menuentry ‚ÄúXen ${i} kernel $j‚Äù { <br> multiboot ${GRUB_DRIVE_BOOT}/xen-$i.gz dom0_mem=256M <br> module ${GRUB_DRIVE_BOOT}/vmlinuz-$j root=/dev/sda2 ro console=tty0 <br> ${MODULE} <br> EOF <br> echo ‚Äú‚Äù <br> done <br> done</code> <br> <br>  <b>Necessary actions:</b> <br>  1. Create a file for the script <br> <code>#touch /etc/grub.d/10_xen</code> <br> <br>  2. Set access rights to it: <br> <code>#chmod 755 /etc/grub.d/10_xen</code> <br> <br>  3. Add the above script to /etc/grub.d/10_xen <br><br>  That's all.  Good luck! </div><p>Source: <a href="https://habr.com/ru/post/56260/">https://habr.com/ru/post/56260/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../56251/index.html">Yota for business - commercial launch</a></li>
<li><a href="../56254/index.html">Amazon launches new cloud service Elastic MapReduce</a></li>
<li><a href="../56255/index.html">PyGame. Introduction</a></li>
<li><a href="../56257/index.html">"Admin" is different</a></li>
<li><a href="../56258/index.html">QIP has ceased to be quiet and started advertising.</a></li>
<li><a href="../56261/index.html">Prr-rivet from Novosibirsk!</a></li>
<li><a href="../56262/index.html">IE dropped to a record low</a></li>
<li><a href="../56264/index.html">Overriding standard types in C ++</a></li>
<li><a href="../56265/index.html">The idea of ‚Äã‚Äãsocial service. Help advice</a></li>
<li><a href="../56266/index.html">Robots will help develop the success of Google Street View</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>