<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a simple Chrome application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the past topic, I tried to tell what the Chrome app is, and why write them. In this, as promised, I will describe the process of creating a simple ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a simple Chrome application</h1><div class="post__text post__text-html js-mediator-article">  In the <a href="http://habrahabr.ru/company/google/blog/211346/">past topic,</a> I tried to tell what the Chrome app is, and why write them.  In this, as promised, I will describe the process of creating a simple Chrome application.  The text editor will be used as an example.  First, it can be written very shortly, so that almost all the code fits into the article.  Second, the text editor will use several Chrome-specific (and other Chromium-based browsers) software interfaces.  Third, yes, I already wrote a <a href="https://github.com/GoogleChrome/text-app/">text editor for Chrome</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bcc/78f/8e0/bcc78f8e067f4e574e445f97b104cfee.png" width="640"><br><br>  The full editor code <a href="https://github.com/eterevsky/simple-text">is available on github</a> .  Ready editor can be <a href="https://chrome.google.com/webstore/detail/eemaijgmlecljjagojapeeaohllhobke">installed from the Chrome app store</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><h4>  Training </h4><br>  To test the application you are developing, you will need to add it to your browser.  To do this, on the <code>chrome://extensions</code> page, check the ‚ÄúDeveloper mode‚Äù checkbox.  After this, it will be possible to add your extension or application. <br><br><h4>  manifest.json </h4><br>  The code of any application for Chrome, as well as any extension, begins with the <a href="http://developer.chrome.com/apps/manifest.html">file manifest.json</a> .  It describes all the meta-information of the application.  Let me give you the entire <a href="">manifesto editor</a> : <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Simple Text"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"An extremely simple text editor (sample Chrome app)"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"icons"</span></span>: { <span class="hljs-string"><span class="hljs-string">"48"</span></span>: <span class="hljs-string"><span class="hljs-string">"icon/48.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"128"</span></span>: <span class="hljs-string"><span class="hljs-string">"icon/128.png"</span></span> }, <span class="hljs-string"><span class="hljs-string">"manifest_version"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"minimum_chrome_version"</span></span>: <span class="hljs-string"><span class="hljs-string">"31.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"offline_enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"app"</span></span>: { <span class="hljs-string"><span class="hljs-string">"background"</span></span>: { <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: [<span class="hljs-string"><span class="hljs-string">"js/background.js"</span></span>] } }, <span class="hljs-string"><span class="hljs-string">"permissions"</span></span>: [ {<span class="hljs-string"><span class="hljs-string">"fileSystem"</span></span>: [<span class="hljs-string"><span class="hljs-string">"write"</span></span>]} ], <span class="hljs-string"><span class="hljs-string">"file_handlers"</span></span>: { <span class="hljs-string"><span class="hljs-string">"text"</span></span>: { <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Simple Text"</span></span>, <span class="hljs-string"><span class="hljs-string">"types"</span></span>: [<span class="hljs-string"><span class="hljs-string">"application/javascript"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/json"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/xml"</span></span>, <span class="hljs-string"><span class="hljs-string">"text/*"</span></span>], <span class="hljs-string"><span class="hljs-string">"extensions"</span></span>: [<span class="hljs-string"><span class="hljs-string">"c"</span></span>, <span class="hljs-string"><span class="hljs-string">"cc"</span></span>, <span class="hljs-string"><span class="hljs-string">"cpp"</span></span>, <span class="hljs-string"><span class="hljs-string">"css"</span></span>, <span class="hljs-string"><span class="hljs-string">"h"</span></span>, <span class="hljs-string"><span class="hljs-string">"hs"</span></span>, <span class="hljs-string"><span class="hljs-string">"html"</span></span>, <span class="hljs-string"><span class="hljs-string">"js"</span></span>, <span class="hljs-string"><span class="hljs-string">"json"</span></span>, <span class="hljs-string"><span class="hljs-string">"md"</span></span>, <span class="hljs-string"><span class="hljs-string">"py"</span></span>, <span class="hljs-string"><span class="hljs-string">"textile"</span></span>, <span class="hljs-string"><span class="hljs-string">"txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"xml"</span></span>, <span class="hljs-string"><span class="hljs-string">"yaml"</span></span>] } } }</code> </pre><br><br>  Let's sort out the fields that met here.  With the name and description everything is clear.  Version is a required field - Chrome Web Store will require it to change when you download an update for your app. <br><br>  The standard sizes of the <a href="http://developer.chrome.com/apps/manifest/icons.html">icons</a> required for the application are 48 √ó 48 and 128 √ó 128 pixels.  Also in some cases, a 16 √ó 16 icon is used.  In addition, other icon sizes may be required in cases where it will be displayed on high-resolution displays, like on a Chromebook Pixel and the new MacbookPro. <br><br>  <code>"manifest_version"</code> is the version of the manifest file format.  At this point, you should use the value 2. <br><br>  <code>"offline_enabled"</code> - as you might expect, this flag is set for applications that work regardless of the availability of Internet access. <br><br>  The following construction is the main one in the file: <br><br><pre> <code class="javascript hljs"> <span class="hljs-string"><span class="hljs-string">"app"</span></span>: { <span class="hljs-string"><span class="hljs-string">"background"</span></span>: { <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: [<span class="hljs-string"><span class="hljs-string">"js/background.js"</span></span>] } },</code> </pre><br><br>  Here the browser is told how to run the application.  Unlike extensions for which the background page is an optional attribute, it is always in the application.  The logic of work is as follows: when you start the application, the background page code is first loaded.  It can register handlers of certain events, in particular, <code>onLaunched</code> events, which then starts when the user opens the application in one way or another. <br><br>  The <code>"permissions"</code> section describes the access settings for the application.  In our case, the ability to save files has been added. <br><br>  Finally, in the <code>"file_handlers"</code> section <code>"file_handlers"</code> types opened by the application are described.  For different types of files in the file manager, Chrome OS may show different lines in the menu.  For example, for some files, an item in the menu may look like ‚ÄúWatch an image in the SuperProgram‚Äù, and for others - ‚ÄúEdit text in the SuperProgram‚Äù. <br><br>  The purpose of a Chrome application to open one type of file or another works so far only on Chrome OS. <br><br><h4>  Background page </h4><br>  All code implementing background page is in the <a href="">js / background.js</a> file.  Here he is: <br><br><pre> <code class="hljs markdown">var entryToLoad = null; function init(launchData) { var fileEntry = null if (launchData &amp;&amp; launchData[<span class="hljs-string"><span class="hljs-string">'items'</span></span>] &amp;&amp; launchData[<span class="hljs-string"><span class="hljs-string">'items'</span></span>].length &gt; 0) { entryToLoad = launchData[<span class="hljs-string"><span class="hljs-string">'items'</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">0</span></span>][<span class="hljs-string"><span class="hljs-string">'entry'</span></span>] } var options = { frame: 'chrome', minWidth: 400, minHeight: 400, width: 700, height: 700 }; chrome.app.window.create('index.html', options); } chrome.app.runtime.onLaunched.addListener(init);</code> </pre><br><br>  The background page runs in the background, independent of the application windows.  Most of the time it is not loaded into memory.  When you start the system, its code is executed and can install handlers for certain events, the most common of which is onLaunched.  When handlers are set, the background page is usually unloaded from memory and is only started back if one of the events to which it is subscribed occurred. <br><br>  When a user clicks on an application icon, or opens a file in it, the <a href="https://developer.chrome.com/apps/app_runtime.html">onLaunched</a> event is <a href="https://developer.chrome.com/apps/app_runtime.html">fired</a> on the background page.  The call parameters, in particular, the file (s) that the application should open are transferred to it.  The <code>entryToLoad = launchData['items'][0]['entry']</code> code saves the file transferred to the application in a local variable, from which it will then be taken by the editor code.  The onLaunched event can also come when the application is already open.  In this case, the code in the background page can decide whether to open a new window, or perform some actions in an already open window. <br><br>  The <a href="http://developer.chrome.com/apps/app_window.html">chrome.app.window.create</a> method creates a new application window.  The first parameter is the path to the html file opened in it (relative to the application directory).  The second is the window settings.  I will dwell on one of them.  <code>frame: 'chrome'</code> creates a window with the usual design for the current operating system.  Another option here is <code>frame: 'none'</code> .  In this case, the application starts in the "bare" window, and the developer will have to take care of adding buttons to close, minimize and maximize the window, as well as the area for which the window can be dragged across the screen. <br><br><h4>  index.html </h4><br>  There is nothing specific in the HTML and CSS files that make up Chrome apps.  The only feature that can be noted is the absence of the need to take care of inter-browser compatibility. <br><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Simple Text<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"main.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/jquery-2.1.0.min.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/main.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">header</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"open"</span></span></span><span class="hljs-tag">&gt;</span></span>Open<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"save"</span></span></span><span class="hljs-tag">&gt;</span></span>Save<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"saveas"</span></span></span><span class="hljs-tag">&gt;</span></span>Save as<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">header</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  We will use <a href="http://jquery.com/">jQuery</a> to simplify the code a bit.  For editing, we will use the <code>&lt;textarea&gt;</code> field.  In this editor, instead, it will be used more intelligent editing module.  The most common options are <a href="http://codemirror.net/">CodeMirror</a> and <a href="http://ace.c9.io/">Ace</a> . <br><br>  For completeness, here is the CSS: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">body</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">header</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: <span class="hljs-number"><span class="hljs-number">#CCC</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-bottom</span></span>: <span class="hljs-number"><span class="hljs-number">1px</span></span> solid <span class="hljs-number"><span class="hljs-number">#777</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">-webkit-box-align</span></span>: center; <span class="hljs-attribute"><span class="hljs-attribute">-webkit-box-orient</span></span>: horizontal; <span class="hljs-attribute"><span class="hljs-attribute">-webkit-box-pack</span></span>: left; <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: -webkit-box; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">48px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">0px</span></span> <span class="hljs-number"><span class="hljs-number">12px</span></span> <span class="hljs-number"><span class="hljs-number">0px</span></span> <span class="hljs-number"><span class="hljs-number">12px</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">button</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">8px</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">textarea</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">border</span></span>: none; <span class="hljs-attribute"><span class="hljs-attribute">-webkit-box-sizing</span></span>: border-box; <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: monospace; <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">4px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>: absolute; <span class="hljs-attribute"><span class="hljs-attribute">top</span></span>: <span class="hljs-number"><span class="hljs-number">48px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">bottom</span></span>: <span class="hljs-number"><span class="hljs-number">0px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">left</span></span>: <span class="hljs-number"><span class="hljs-number">0px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">right</span></span>: <span class="hljs-number"><span class="hljs-number">0px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">textarea</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:focus</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">outline</span></span>: none <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; }</code> </pre><br><br><h4>  Main code: work with files </h4><br>  Since in our example, for simplicity, we limit ourselves to the minimum set of features, the main editor code will be devoted almost exclusively to working with files.  Several APIs are used for this, some of which are already on the path to W3C standardization.  The File API and related interfaces are a great topic that deserves a separate article.  As a good introduction, I recommend <a href="http://www.html5rocks.com/en/tutorials/file/filesystem/">this article on html5rocks.com</a> . <br><br>  So, let's sort the code in <code>js/main.js</code>  I will give it fragments, the full code is <a href="">on Github</a> . <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entry</span></span></span><span class="hljs-function">) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#open'</span></span>).click(open); $(<span class="hljs-string"><span class="hljs-string">'#save'</span></span>).click(save); $(<span class="hljs-string"><span class="hljs-string">'#saveas'</span></span>).click(saveAs); chrome.runtime.getBackgroundPage(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bg</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bg.entryToLoad) loadEntry(bg.entryToLoad); }); } $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(init);</code> </pre><br><br>  The task of the initialization function is to add handlers to the buttons and get the file to open from the background page.  The background page context is derived from the main window asynchronously using <a href="https://developer.chrome.com/apps/runtime.html">chrome.runtime.getBackgroundPage</a> . <br><br>  Button handlers: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentEntry = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ chrome.fileSystem.chooseEntry({<span class="hljs-string"><span class="hljs-string">'type'</span></span>: <span class="hljs-string"><span class="hljs-string">'openWritableFile'</span></span>}, loadEntry); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentEntry) { saveToEntry(currentEntry); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { saveAs(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveAs</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ chrome.fileSystem.chooseEntry({<span class="hljs-string"><span class="hljs-string">'type'</span></span>: <span class="hljs-string"><span class="hljs-string">'saveFile'</span></span>}, saveToEntry); }</code> </pre><br><br>  We will store the current FileEntry in the global variable currentEntry. <br><br>  The only specific feature in the above code is the <a href="http://developer.chrome.com/apps/fileSystem.html">chrome.fileSystem.chooseEntry</a> method.  Using this method, the file selection window opens (its own on each system).  Like all other functions for working with the file system, this method is asynchronous and gets a callback to continue working (in our case, the loadEntry and saveToEntry functions described below). <br><br>  Reading file: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setTitle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ chrome.fileSystem.getDisplayPath( currentEntry, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">path</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = path + <span class="hljs-string"><span class="hljs-string">' - Simple Text'</span></span>; }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadEntry</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entry</span></span></span><span class="hljs-function">) </span></span>{ currentEntry = entry; setTitle(); entry.file(readFile); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">file</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> reader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileReader(); reader.onloadend = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.result); }; reader.readAsText(file); }</code> </pre><br><br>  In the <code>setTitle()</code> function, we change the window title to show the path to the current file.  How this header is displayed depends on the system.  On Chrome OS, it is not shown at all.  <a href="http://developer.chrome.com/apps/fileSystem.html">chrome.fileSystem.getDisplayPath</a> is the most correct way to get the path of a file suitable to show it to the user.  Another path representation is available through <code>entry.fullPath</code> . <br><br>  In the File API, there are two different objects that describe the file: FileEntry and File.  Roughly speaking, FileEntry represents the path to the file, and File - the data contained in it.  Therefore, in order to read the file, you need to get a File object from Entry.  This is achieved using the asynchronous <code>entry.file()</code> method. <br><br>  <a href="https://developer.mozilla.org/en-US/docs/Web/API/FileReader">FileReader</a> is a separate object for reading files.  It allows you to quite flexibly manage the reading process, but in this case we just need to read the entire contents of the file from it. <br><br>  Writing a file, like reading, does not contain Chrome-specific code: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveToEntry</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entry</span></span></span><span class="hljs-function">) </span></span>{ currentEntry = entry; setTitle(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> blob = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Blob([$(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).val()], {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>}); entry.createWriter(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">writer</span></span></span><span class="hljs-function">) </span></span>{ writer.onwrite = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ writer.onwrite = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; writer.write(blob); } writer.truncate(blob.size); }); }</code> </pre><br><br>  Before writing data, it is necessary to bring them to <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob">Blob</a> .  One additional step that we will need when writing is to cut the file in case it already exists and is long.  If we were sure that this is a new file, the code of the record would be simplified to: <br><br><pre> <code class="javascript hljs"> entry.createWriter(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">writer</span></span></span><span class="hljs-function">) </span></span>{ writer.write(blob); });</code> </pre><br><br><h4>  Conclusion </h4><br>  This completes the code of our application.  Unfortunately, managing files in JavaScript is somewhat unintuitive, and is probably the most difficult part of the application.  But, as I wrote above, these APIs are not specific to Chrome, but implemented <a href="http://www.html5rocks.com/en/features/file_access">in all modern browsers</a> . <br><br>  The code for this example is made as short as possible to fit into the format of the article.  If you want to look at more detailed examples of how these or other features of the Chrome API are used, a <a href="https://github.com/GoogleChrome/chrome-app-samples">large set of examples of Chrome apps has</a> been published on GitHub.  The official documentation for all software interfaces is <a href="http://developer.chrome.com/apps/about_apps.html">on developer.chrome.com</a> .  The main place where you can get answers to specific questions about programming Chrome applications is the <a href="http://stackoverflow.com/tags/google-chrome-app/info">google-chrome-app tag on StackOverflow</a> . </div><p>Source: <a href="https://habr.com/ru/post/212107/">https://habr.com/ru/post/212107/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../212097/index.html">Electronics manufacturing in China - what to expect?</a></li>
<li><a href="../212099/index.html">Player from Playboy magazine (continuation of the epic)</a></li>
<li><a href="../212101/index.html">Cross-platform https server with non-blocking sockets. Part 3</a></li>
<li><a href="../212103/index.html">Web Analytics Popularity</a></li>
<li><a href="../212105/index.html">Tim Berners-Lee: we need to decentralize the Internet again</a></li>
<li><a href="../212109/index.html">Godot game engine put into public use</a></li>
<li><a href="../212111/index.html">How to write your component for iOS</a></li>
<li><a href="../212113/index.html">Date.prototype.getTimezoneOffset - the difference in return values ‚Äã‚Äãin different browsers</a></li>
<li><a href="../212115/index.html">C ++ IDE from JetBrains: when?</a></li>
<li><a href="../212117/index.html">Bitcoin protocol feature that led to delays in Mtgox pinouts and general commotion</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>