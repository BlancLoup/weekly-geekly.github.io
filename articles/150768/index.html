<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About shooting gigapixel panorama of Yekaterinburg</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will discuss the creation of a panorama of Yekaterinburg. 
 Habre publication: habrahabr.ru/post/150591 Panorama itself: ekburg.artstudio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About shooting gigapixel panorama of Yekaterinburg</h1><div class="post__text post__text-html js-mediator-article">  This article will discuss the creation of a panorama of Yekaterinburg. <br>  <a href="http://ekburg.artstudio-3d.ru/">Habre</a> publication: <a href="http://habrahabr.ru/post/150591/">habrahabr.ru/post/150591</a> Panorama itself: <a href="http://ekburg.artstudio-3d.ru/">ekburg.artstudio-3d.ru</a> <br><br>  Initially, a more detailed version of the article was sent to the ‚Äúsandbox‚Äù, but the UFO did not find it worthy of an invite.  Below, I will omit the background with tenders and other "lyrics", and try to dwell only on the technical part. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/c6b/9aa/08e/c6b9aa08ecc5969881d0a82a2df9f0ec.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  In March of this year, a <a href="http://zakupki.gov.ru/pgz/public/action/orders/info/common_info/show%3FnotificationId%3D2884112">tender</a> was published for "the production of a panorama of the city of Yekaterinburg with an ultra-high (gigapixel) resolution."  About a day I was thinking about ‚Äúcan I do this job if I win?‚Äù.  After a positive answer to this question, a quotation application was submitted.  The girls in DHL were very surprised and wished good luck. <br>  Tender <a href="http://zakupki.gov.ru/pgz/public/action/protocol/info/orders/show%3Fprotocol_id%3D4576762">won</a> .  (I will not go into details in this article, although I already have some experience in the photo on the system of tenders. Maybe I will write another article. 3 tenders have been won at the moment.) <br><br><h4>  What should have been removed? </h4><br>  The cylindrical panorama of the city view from the local high-rise. <br>  Resolution of at least 10Gpx.  As well as the usual panoramas 360x180 objects on the ground. <br><br>  In general, the imputed TK, although not without delusional requirements.  ‚Äú5000 original frames‚Äù are redundant for 10Gpx (if we are talking about differently different ones, and not just bracketing). <br><br>  Remove a lot more, and then resize down?  Bad option.  The greater the focal length (smaller viewing angle), the more frames, and, respectively, and the joints between them.  This, in turn, will increase the number of "ghosts" (halves of people and cars and other blending artifacts).  And still take longer to shoot, i.e.  higher risk of changes in light, and the shadows can sometimes just do not converge. <br><br>  Remove at 50Gpx and get another soap Dubai (talking about the old panorama, which became famous for the "record" in detail and meaningless content), where the detail does not deteriorate from a decrease of 10 times the size of the panorama?  Also no. <br><br>  Add.  The agreement to the contract stated that the objects became more than 10. <br>  <a href="http://maps.yandex.ru/%3Fum%3D7ex6f0BBr3V5kN2rz4M5Sz4xXA31fncS%26amp%3Bl%3Dpmap">"Ekaterinburg - objects" on Yandex.Maps</a> <br><br><h4>  Calculations </h4><br>  As I wrote above, before sending a request, you had to make sure that the project was real.  And just to understand "how to do it?".  By the time I did not shoot a panorama of such a plan.  Only when shooting interiors used this approach. <br><br>  I could not google the ready-made ‚Äúcalculators‚Äù, although I didn‚Äôt try too hard - it was important to understand everything myself. <br><br>  Since only 70-200 / 4L IS is available from tele-lenses, it was first calculated for it. <br>  The following cameras were considered as cameras: 5D m2, as ff, and 600D (60D) as the most dense pixel cropping (from the actual at the time of the calculation of the canons). <br><br>  <i><b>Attention!</b></i>  <i><b>The calculation below does not claim to be 100% correct in terms of terminology.</b></i>  <i><b>Measuring the ‚Äúring height‚Äù in degrees can damage your psyche.</b></i>  <i><b>Please look at the essence, not the terms.</b></i>  <i><b>I have not done such calculations for 10 years.</b></i> <br><br><blockquote>  70-200 has an angle of 12 <sup>o</sup> diagonally (ff, 200mm), so  angles for ff and crop: <br>  <b>FF:</b> 9.99 <sup>o</sup> on the long side (3x) and 6.66 <sup>o</sup> on the short (2x); <br>  <b>Crop:</b> 6.24 <sup>o</sup> on the long side (3x) and 4.16 <sup>o</sup> on the short side (2x); <br><br>  <b>To close to 360 <sup>o</sup></b> (ring without overlap) in theory you need: <br>  <b>ff:</b> 36 frames (360: 9.99), with a ring height of 6.66 <sup>o</sup> - i.e.  1 \ 27 from 180 <sup>about</sup> ; <br>  <b>Crop:</b> 58 frames (360: 6.24), with a ring height of 4.16 <sup>o</sup> - i.e.  1 \ 44 from 180 <sup>o</sup> . <br><br>  <b>For the full sphere (360 <sup></sup> 180 <sup></sup> )</b> in theory: <br>  <b>FF:</b> 27 rows of 36 frames ( <b>972 frames</b> ); <br>  <b>Crop:</b> 44 rows of 58 frames ( <b>2552 frames</b> ). <br><br>  And <b>in megapixels</b> it is: <br>  <b>ff:</b> 27 x 36 x 21mp = <b>20 412mp</b> ; <br>  <b>Crop</b> : 44 x 58 x 18mp = <b>45 936mp</b> . <br></blockquote><br><blockquote>  <b>Let us turn to the reality with overlap</b> (25%) on the stitching. <br>  Roughly reduce the viewing angles, and will continue to be considered as if without overlap: <br>  <b>FF:</b> 7.5 <sup>o</sup> (9.99 <sup>o</sup> x0.75) in long and 5 <sup>o</sup> (6.66 <sup>o</sup> x0.75) in short; <br>  <b>Crop:</b> 4.7 <sup>o</sup> (6.24 <sup>o</sup> x0.75) in long and 3.1 <sup>o</sup> (4.16 <sup>o</sup> x0.75) in short. <br><br>  <b>To close to 360</b> <sup>o</sup> you need: <br>  <b>ff:</b> 48 frames (360: 7.5), with a ring height of 5 <sup>o</sup> - i.e.  1 \ 36 from 180 <sup>about</sup> ; <br>  <b>Crop:</b> 77 frames (360: 4.7), with a ring height of 3.1 <sup>o</sup> - i.e.  1 \ 58 from 180 <sup>about</sup> ; <br></blockquote><br><blockquote>  Total <b>for the full sphere (360 <sup></sup> 180 <sup></sup> )</b> , with an overlap of 25%: <br>  <b>FF:</b> 36 rows of 48 frames = 1728 frames; <br>  <b>crop:</b> 58 rows 77 frames = 4466 frames. <br><br>  Apotheosis: <br>  Let each frame be taken up to 1 sec.  (same day), and 3 seconds.  goes to repositioning the head: <br>  ff: 1728x4 = 1.9 hours (approximately 39Gb of RAW-files); <br>  Crop: 4466x4 = 4.9 hours (approximately 98Gb of RAW-files); <br><br>  But this is a complete sphere, which is meaningless (why do we need the sky and the roof of the building from which to shoot?). <br>  Let the height be not 180 <sup>o</sup> , but 60 <sup>o</sup> : <br>  <b>ff: 576 frames, 0.65 hours, 6.8Gpx;</b> <b><br></b>  <b>Crop: 1448 frames, 1.6 hours, 15.3Gpx.</b> <br></blockquote><br>  Conclusion?  You can calmly shoot at 200mm and 18mp crop camera. <br><br>  Looking ahead, I will say that the calculations were fairly well confirmed by practice. <br>  After calibration of the tripod head ‚Äúon the spot‚Äù, the discrepancies by theory were 0.1-0.2 <sup>o</sup> per frame. <br><br><h4>  What to work? </h4><br>  Already decided that to shoot on a crop camera about 18mp and 200mm lens. <br>  Under the terms of the contract, the survey should be carried out using a ‚Äúrobotic tripod head‚Äù. <br>  Although it is possible to shoot 1,450 frames in manual mode, the choice fell on the <a href="http://gigapan.com/cms/support/tech-specs">Gigapan EPIC Pro</a> . <br><img src="http://artstudio-3d.ru/_public/gigapan.jpg" alt="image"><br><br>  Well, with ground spherical panoramas everything is simple: 5D m2 + 15mm.  According to the scheme "2 rows of 8 frames."  This gives a large overlap that will help get rid of the ghosts and halves of buses. <br><br>  If I already got used to the usual spherical panoramas (to stitch ‚Äúlater, at home‚Äù), then the gigapixel view should be checked directly in Yekaterinburg.  For this, the netbook of the following configuration was purchased: i7-2670QM / 16Gb RAM / 128Gb SSD / 640Gb HDD. <br><br><h4>  In Ekaterinburg </h4><br>  Probably not really to write about it here.  Leave a LJ.  Total spent 5 days in the city.  The day was spent on tests and targeting on the roof of a skyscraper, a day on shooting, and another 3 days on urban views "on the ground." <br><br>  The panorama was filmed on May 16th, 2012. <br><br><h4>  On the roof </h4><br>  What you need to consider first? <br><ul><li>  Weather and its forecast for the near future.  Sudden change in illumination is unacceptable.  Undesirable clouds - there will be porridge. </li><li>  Humidity - the higher it is higher, the stronger will be the moire and worse visibility. </li><li>  The height of the sun above the horizon - the higher the better. </li><li>  Shooting time - you need to shoot as quickly as possible, otherwise the shadows will crawl away and will not sew. </li><li>  The wind was gusty, I had to remove the hood from the lens, to reduce the area of ‚Äã‚Äãthe sail. </li></ul><br><br><img src="http://artstudio-3d.ru/_public/gigapan2.jpg" alt="image"><br>  <i>Photographers also remove phones.</i>  <i>The first day, tests.</i> <br><br>  How to shoot? <br><ul><li>  Rows from top to bottom.  This reduces the number of "ghosts" that occur when stitched. </li><li>  Focus - hands, with refocus every few rows.  Sometimes it gave failures (there are soap areas), but what to do. </li><li>  Mode - Av.  M, when shooting such a number of frames, does not make sense.  The run-up illumination will not fit into any matrix of DD. </li><li>  Tests have shown that exposure compensation, in general, is not needed, but expiration is desirable. </li><li>  Needless to say in RAW.  Changing flash drives and immediately looking at the material. </li></ul><br><br><h4>  Material processing </h4><br>  I will describe the process of working on a large panorama. <br><br>  It is necessary to select frames, pre-convert. <br>  Then assemble a test panorama, check it for correct stitching. <br><br>  Then the most tedious begins - you need to handle specific frames and groups of frames.  That there were no bands and differences of brightness and color.  Substitute frames and look at the result.  In the ranks of the frames "sky" - a lot of substitutions.  And so many times around. <br><br>  After the color was aligned, I began to fight with the "ghosts" (people without heads, halves of cars, two-wheeled buses).  This is done by masks in PTGui, and sometimes by retouching in Photoshop.  These operations also repeated many times. <br><br>  If we talk about the time of stitching and cutting of images into tiles ( <a href="http://krpano.com/">KRPano</a> ), then the figures, on average for each sector, are: <br><br><blockquote>  placement of control points (automatic) - 30-40 minutes; <br>  panorama stitching - 2-2.5 hours; <br>  cutting into tiles - 1.5 hours; <br></blockquote><br>  The last two points were repeated many times.  The final edits were made after the preliminary publication of the panorama and its discussion by the audience.  And even after that - at least a couple of ghosts remained.  In total, it took about 3-4 weeks. <br><br>  The most unpleasant was to apply the curves to two of the three panoramas (sectors).  For files of 5-7 gigapixels and 20 gigabytes of the operation ‚Äúopen, apply curves, increase contrast, save, close‚Äù took 2-3 hours each. <br><br><h4>  Shooting statistics </h4><br>  3 panoramas were taken: <br><blockquote>  1. 19 rows of 36 frames - a total of 684 unique (excluding bracketing); <br>  capture time: 34 minutes; <br>  angular dimensions: 160 <sup>o</sup> on the horizon and approximately 55 <sup>o</sup> on the vertical; <br>  cross-linked sheet size: 127,800 x 54,850 px, approximately 7 Gpx. <br><br>  2. 15 rows of 36 frames - or 540 pieces; <br>  shooting time: 31 minutes; <br>  angular dimensions: 160 <sup>o</sup> on the horizon and approximately 40 <sup>o</sup> on the vertical; <br>  cross-linked sheet size: 131,175 x 37,922 px, approximately 5 Gpx. <br><br>  3. 16 rows of 34 frames - or 544 pieces; <br>  shooting time: 31 minutes; <br>  angular dimensions: 155 <sup>o</sup> on the horizon and approximately 47 <sup>o</sup> on the vertical; <br>  cross-linked sheet size: 122,400 x 43,800 px, approximately 5.4 Gpx. <br></blockquote><br>  In general, very close to the calculations. <br><br>  Why 3 sectors, but not a single cylinder? <br>  Does not allow roof configuration.  With such a relatively small height (43 floors?), The survey points are too far apart.  Parallax is great.  There was an attempt to collect, if not in a single cylinder, then at least in 2 sectors.  Did not work.  In the "border areas" it came to the point that in the same small building I saw, as it were, a left wall in one panorama, and almost a right one in another. <br><br><h4>  Acknowledgments </h4><br>  I want to say thanks to the people who helped me in the implementation of this project: <br>  Alexey Krylov, Moscow; <br>  Anton Fadeev, Yekaterinburg; <br>  Vladimir Bardanos, Novokuznetsk; <br>  Rodion Galanev, Moscow. <br><br><h4>  What is the result? </h4><br>  Experience an interesting job. <br>  Pretty good visualization of Ekaterinburg. <br><br>  About the very same panorama to judge you: <br><br> <a href="http://ekburg.artstudio-3d.ru/"><img src="https://habrastorage.org/getpro/geektimes/post_images/c6b/9aa/08e/c6b9aa08ecc5969881d0a82a2df9f0ec.jpg" alt="image"></a> <br>  <i>Ekaterinburg: gigapixel panorama and virtual tour (clickable)</i> <br><br>  Constructive criticism is welcome. <br>  When you change the review in the address bar of the browser data is changed, so  You can give links to specific species. <br><br>  <b>UPD:</b> <br>  Retouched most of the specified in the comments. <br>  Files updated. <br>  A copy of the administration of the customer handed. </div><p>Source: <a href="https://habr.com/ru/post/150768/">https://habr.com/ru/post/150768/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../150762/index.html">Zend Framework, subjective impressions</a></li>
<li><a href="../150763/index.html">Work in the style of Smart - or why we really love to work</a></li>
<li><a href="../150765/index.html">New data sources for Teiid, part 1: use DDL</a></li>
<li><a href="../150766/index.html">Experience creating frameworks</a></li>
<li><a href="../150767/index.html">Recovery of unevenly lit images</a></li>
<li><a href="../150769/index.html">Unmanned vehicles are going to legalize in California and another 4 US states</a></li>
<li><a href="../150770/index.html">Methods of dealing with loneliness on the example of DS112 +</a></li>
<li><a href="../150772/index.html">New data sources for Teiid, part 1: use DDL</a></li>
<li><a href="../150773/index.html">Competition: CROC Company organizes a competition of flying robots. Prize - million rubles</a></li>
<li><a href="../150774/index.html">Creating a cloud site in PHP and MySQL and deploying it with Git</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>