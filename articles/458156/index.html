<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PostgreSQL benchmarking on FreeBSD, CentOS, Ubuntu Debian and openSUSE</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! I present to you the translation of the original PostgreSQL benchmark on FreeBSD, CentOS, Ubuntu Debian and openSUSE by Martin Kov√°ƒçik. It e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PostgreSQL benchmarking on FreeBSD, CentOS, Ubuntu Debian and openSUSE</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/29e/dac/902/29edac902beac8c11b5a6355f66d0564.png" alt="image" align="left">  Hi, Habr!  I present to you the translation of the original <a href="https://redbyte.eu/en/blog/postgresql-benchmark-freebsd-centos-ubuntu-debian-opensuse/">PostgreSQL benchmark on FreeBSD, CentOS, Ubuntu Debian and openSUSE</a> by Martin Kov√°ƒçik.  It examines PostgreSQL 10.1 DBMS tests in real-world environments on different unix systems. <br><br><h3>  Transfer </h3><br>  In this post, I'm going to show the test results of the recently released PostgreSQL 10.1.  I checked the database on these OS (all 64-bit): <br><br><ul><li>  <b>Ubuntu 16.04</b> , kernel 4.10.0-38-generic </li><li>  <b>openSUSE 42.3,</b> kernel 4.4.87-25-default </li><li>  <b>CentOS 7.4</b> , kernel 3.10.0-693.2.2.el7.x86_64 </li><li>  <b>Debian 9.2</b> , kernel 4.9.0-4-amd64 </li><li>  <b>FreeBSD 11.1</b> </li></ul><a name="habracut"></a><br><h3>  Testing Methodology </h3><br>  The purpose of the test was to measure PostgreSQL performance under conditions similar to (typical) production deployments: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  clients connect through the connection pool to ensure that there is no constant reconnection to the database (I did not use the connection pool, instead I did not use the -C pgbench flag) </li><li>  clients connect over the network, not through a unix socket </li><li>  The PostgreSQL data directory is on a RAID 1 mirror. </li></ul><br>  For each of the tested OSs, a control database of ~ 74 GB was created: <br><br><pre><code class="bash hljs">pgbench -i -s 5000 pgbench</code> </pre> <br>  The test infrastructure consisted of two dedicated servers connected to a 1 Gbps network: <br><br><ul><li>  EX41-SSD: Intel i7-6700, 4 cores, 8 threads, 32 GB RAM DDR4, used to generate SQL queries using pgbench </li><li>  PX121-SSD: Intel Xeon E5-1650 v3, 6 cores, 12 streams, 256 GB RAM DDR4 ECC, 2 x 480 GB SATA 6 Gb / s, data center SSD series, used as PostgreSQL server </li></ul><br>  I was interested in these test combinations: <br><br><ul><li>  <b>32 GB read only</b> : read only test (only samples with no data changes), the dataset does not fit into the PostgreSQL cache </li><li>  <b>200 GB read only</b> : read only test, data set is placed into PostgreSQL cache </li><li>  <b>32 GB TCP-B</b> : read-write dataset does not fit into the PostgreSQL cache </li><li>  <b>TCP-B 200 GB</b> : read, write, set of data is placed in the PostgreSQL cache </li></ul><br><h3>  pgbench setup </h3><br>  The pgbench version 10.1 program running on a separate FreeBSD 11.1 computer was used to generate the load.  The test script consisted of three parts: vacuum + warming up, test only reading and test reading and writing.  Before each test, the pgbench read-write tables were cleared (the -v flag was used).  During the test, I gradually increased the number of clients accessing the database. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh THREADS=8 DURATION=1800 PGIP=192.168.1.120 # warmup pgbench -h ${PGIP} -U pgbench -j ${THREADS} -c 10 -T ${DURATION} -S -v pgbench for clients in 1 10 20 30 40 50 60 70 80 90 100 110 120 do echo "RO ${clients}" pgbench -h ${PGIP} -U pgbench -j ${THREADS} -c ${clients} -T ${DURATION} -S pgbench &gt; pgbench_ro_${clients}.log done for clients in 1 10 20 30 40 50 60 70 80 90 100 110 120 do echo "RW ${clients}" pgbench -h ${PGIP} -U pgbench -j ${THREADS} -c ${clients} -T ${DURATION} -v pgbench &gt; pgbench_rw_${clients}.log done</span></span></code> </pre> <br><h3>  PostgreSQL server settings </h3><br>  For Linux distributions, PostgreSQL was installed in the ext4 file system in the RAID1 configuration (software RAID using mdraid) on two SSDs with <i>atime</i> disabled.  In the case of FreeBSD, the OpenZFS file system was used on two SSDs when configuring RAID1.  A ZFS dataset with PostgreSQL data was created with the following parameters: <br><br><pre> <code class="plaintext hljs">zfs get recordsize,logbias,primarycache,atime,compression zroot/var/db/postgres NAME PROPERTY VALUE SOURCE zroot/var/db/postgres recordsize 8K local zroot/var/db/postgres logbias throughput local zroot/var/db/postgres primarycache all default zroot/var/db/postgres atime off inherited from zroot zroot/var/db/postgres compression lz4 local</code> </pre> <br>  The PostgreSQL server configuration was the same on all operating systems except for file paths (each OS uses its own directory structure).  The contents of the <i>postgresql.conf</i> file (basic settings) for a 32 GB instance: <br><br><pre> <code class="plaintext hljs">autovacuum = off default_statistics_target = 100 maintenance_work_mem = 1GB checkpoint_completion_target = 0.9 effective_cache_size = 24GB work_mem = 104MB wal_buffers = 16MB shared_buffers = 8GB max_connections = 300</code> </pre> <br>  The contents of the <i>postgresql.conf</i> file for a 200 GB instance: <br><br><pre> <code class="plaintext hljs">autovacuum = off default_statistics_target = 100 maintenance_work_mem = 2GB checkpoint_completion_target = 0.9 effective_cache_size = 144GB work_mem = 640MB wal_buffers = 16MB shared_buffers = 48GB max_connections = 300</code> </pre> <br><h3>  Comparative Testing </h3><br>  I tested PostgreSQL on five different operating systems in two modes - read only and TCP-B (read-write) with two different memory profiles.  Each OS test took about 30 hours (not counting the time required to configure the OS).  The results of each pgbench run were saved for later evaluation. <br><br><h3>  Results - Read Only </h3><br> <a href="http://www.picshare.ru/view/10112011/"><img src="https://habrastorage.org/getpro/habr/post_images/824/093/baf/824093baf0425d13d761f0c901355647.jpg" width="600" height="259" title="Image hosting PicShare.ru"></a> <br><br> <a href="http://www.picshare.ru/view/10112004/"><img src="https://habrastorage.org/getpro/habr/post_images/397/b43/ac1/397b43ac1ef442bebefcf9aab1ddd5be.jpg" width="600" height="252" title="Image hosting PicShare.ru"></a> <br><br> <a href="http://www.picshare.ru/view/10112005/"><img src="https://habrastorage.org/getpro/habr/post_images/3d9/3f7/fde/3d93f7fde6f666aabf8d4e48e7c28bd7.jpg" width="600" height="250" title="Image hosting PicShare.ru"></a> <br><br> <a href="http://www.picshare.ru/view/10112006/"><img src="https://habrastorage.org/getpro/habr/post_images/ef8/5d3/99a/ef85d399a427083671324d38331279ee.jpg" width="600" height="244" title="Image hosting PicShare.ru"></a> <br><br><h3>  Results - TCP-B </h3><br> <a href="http://www.picshare.ru/view/10112007/"><img src="https://habrastorage.org/getpro/habr/post_images/e26/652/1ce/e266521ce29563daaa26991c14ce0cc8.jpg" width="600" height="261" title="Image hosting PicShare.ru"></a> <br><br> <a href="http://www.picshare.ru/view/10112008/"><img src="https://habrastorage.org/getpro/habr/post_images/675/e47/7e7/675e477e7089abb997b36d77b7810343.jpg" width="600" height="260" title="Image hosting PicShare.ru"></a> <br><br> <a href="http://www.picshare.ru/view/10112009/"><img src="https://habrastorage.org/getpro/habr/post_images/75a/d68/eb3/75ad68eb35fa35230db8e446a09565ad.jpg" width="600" height="257" title="Image hosting PicShare.ru"></a> <br><br> <a href="http://www.picshare.ru/view/10112010/"><img src="https://habrastorage.org/getpro/habr/post_images/d3b/0e7/b9e/d3b0e7b9ea92d20bd1231379b71b4b14.jpg" width="600" height="248" title="Image hosting PicShare.ru"></a> <br><br><h3>  Results </h3><br>  The test showed that the difference between different distributions of GNU / Linux is not very significant.  The best operating system in the read-only test was openSUSE 42.3, while FreeBSD worked about 40% slower.  Unfortunately, I did not find out what caused this mediocre performance of FreeBSD. <br><br>  A more realistic picture of PostgreSQL performance was obtained in a read-write test (TCP-B).  Among the GNU / Linux distributions, Centos 7.4 was the fastest, and Debian 9.2 was the slowest.  I was pleasantly surprised by FreeBSD 11.1, which worked more than twice as fast as the best Linux, despite the fact that FreeBSD used ZFS, which is the copy-on-write file system.  I assumed that this difference was caused by the cost of software RAID in Linux, so I did three more TCP-B tests for 100 concurrent clients, this time without software RAID: <br><br><ul><li>  <b>FreeBSD 11.1 + UFS</b> : 5623.86 TPS </li><li>  <b>FreeBSD 11.1 + ZFS</b> : 8331.85 TPS </li><li>  <b>CentOS 7.4 + ext4</b> : 8987.65 TPS </li></ul><br>  The results show the inefficiency of Linux SW RAID (or the effectiveness of ZFS RAID).  The performance of CentOS 7.4 without SW RAID is only slightly higher than that of FreeBSD 11.1 with ZFS RAID (for TCP-B and 100 simultaneous clients). </div><p>Source: <a href="https://habr.com/ru/post/458156/">https://habr.com/ru/post/458156/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../458144/index.html">News of the week: Raspberry Pi 4 on sale, Internet on the Unified State Exam, Roskomnadzor and VPN services, neural network strips people</a></li>
<li><a href="../458146/index.html">Open-source accounting application in the region</a></li>
<li><a href="../458148/index.html">Retro electronics. Smart watches from the 80s</a></li>
<li><a href="../45815/index.html">Facebook lost user settings</a></li>
<li><a href="../458154/index.html">Incredible history of the origin of USB - port that changed everything</a></li>
<li><a href="../458158/index.html">Looking for asteroids - the project "Hubble Asteroid Hunter"</a></li>
<li><a href="../458160/index.html">Lock with priorities in .NET</a></li>
<li><a href="../458164/index.html">Artificial Intelligence - a question will be asked for each answer.</a></li>
<li><a href="../458166/index.html">Bringing in a convenient for work type of micro-computer UKNTS Electronics MS 0511 architecture PDP-11</a></li>
<li><a href="../458168/index.html">Digest of machine learning and artificial intelligence news for June</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>