<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Saving BSOD protected computers under Windows XP from WannaCry infection</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A new report from Kryptos Logic summed up the spread of the WannaCry worm cryptographer (WannaCrypt) two weeks after the start of the epidemic. By the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Saving BSOD protected computers under Windows XP from WannaCry infection</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/geektimes/post_images/fca/f19/8e9/fcaf198e971d99d11d3936faf55dc9e6.jpg"><br><br>  A new <a href="https://blog.kryptoslogic.com/malware/2017/05/29/two-weeks-later.html">report</a> from Kryptos Logic summed up the spread of the WannaCry worm cryptographer (WannaCrypt) two weeks after the start of the epidemic.  By the way, it is in Kryptos Logic that the hacker MalwareTech works, who noticed a new botnet in the <a href="https://www.kryptoslogic.com/kryptos_vantage.html">Kryptos Vantage</a> early detection system, immediately registered the domain with which WannaCry was associated, and thus <a href="https://geektimes.ru/post/289143/">accidentally stopped the spread of the virus</a> . <br><br>  One of the interesting conclusions of the experts: it turns out that the Windows XP operating system was reinforced concrete from the virus, as many thought.  It turned out that when infected with the most common version of WannaCry, computers running Windows XP SP3 just hung up and showed a ‚Äúblue screen of death‚Äù followed by a reboot.  No files were encrypted.  Cryptographer could not function in such conditions. <br><a name="habracut"></a><br>  In the first days after the start of WannaCry distribution, many media outlets <a href="https://www.nytimes.com/2017/05/12/world/europe/nhs-cyberattack-warnings.html">spread the</a> <a href="https://www.wired.com/2017/05/still-use-windows-xp-prepare-worst/">information</a> that the main blame for the infection lies on Windows XP.  The likely reason for this misconception was the massive infection of computers by the UK Public Health Service.  It is said that many ancient PCs with old operating systems work in this organization.  The health service <a href="https://digital.nhs.uk/article/1493/UPDATED-Statement-on-reported-NHS-cyber-attack-13-May-">decisively denied the charges</a> : it stated that at the time of the attack, only 5% of their computers were running under Windows XP. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At the same time, Microsoft was criticized, and it stopped releasing security updates under Windows XP back in 2014.  Microsoft experts did not argue and promptly released the necessary patch for older systems. <br><br>  Two weeks of testing in the Kryptos Logic labs showed that WannaCry could really infect unpatched computers running Windows XP, but then trying to load the <a href="https://en.wikipedia.org/wiki/DoublePulsar">DoublePulsar</a> payload <a href="https://en.wikipedia.org/wiki/DoublePulsar">then</a> caused the system to hang. <br><br>  At first, testing took place in a mode close to real, when the distribution of DoublePulsar load was checked through the <a href="https://en.wikipedia.org/wiki/EternalBlue">EternalBlue</a> exploit.  In the second stage, DoublePulsar was manually installed on computers.  It turned out that the cryptor was successfully launched on Windows 7 64-bit, SP1 machines, but the machines with Windows XP continuously crashed into the BSOD, so no infection occurred. <br><br>  The researchers conclude that the machines under Windows XP could not become the main means of spreading the infection, because ‚Äúthe implementation of the exploit in WannaCry could not reliably launch DoublePulsar and achieve the correct RCE‚Äù.  Accordingly, such a computer did not have the ability to distribute malicious code further across the network, using a vulnerability in SMB.  These findings are consistent with those that <a href="https://twitter.com/craiu/status/865562842149392384">Kaspersky Lab experts arrived</a> at in the first days.  They found that 98% of all infections occur on computers with Windows 7, and the proportion infected with Windows XP is ‚Äúinsignificant.‚Äù <br><br>  ‚ÄúIn the worst case, which is most likely,‚Äù Kryptos said, ‚ÄúWannaCry caused a lot of unexpected crashes with a blue screen of death.‚Äù <br><br>  Probably for the first time in the history of BSOD, he did something useful and useful - he protected computers. <br><br>  At the same time, computers under Windows 7 have suffered quite seriously.  Based on the data from the Kryptos Vantage system, experts estimate the number of infections at 14-16 million. The total number of systems where the cryptor has triggered and encrypted user files before the stop crane is triggered is estimated at several hundred thousand. <br><br>  In total, WannaCry struck networks of more than 9,500 IP-bands of Internet providers and / or organizations in 8900 cities of 90 countries.  The most affected were China, the United States and Russia. <br><br><img src="https://habrastorage.org/web/1e9/34d/644/1e934d644b5d40569a7927fa4fbc3e58.png"><br><br>  Kryptos sinkhole servers are still registering a large number of calls to the crane, including from new IP addresses.  This suggests that the worm continues to spread (mainly in China).  That is, millions of users have not yet installed patches, have not closed a vulnerability in Windows, and have not installed antiviruses on them.  This fact can be used by newer versions of the worm - and a new infection can occur. <br><br>  Kryptos considered the hacker Neil Meta‚Äôs <a href="https://twitter.com/neelmehta/status/864164081116225536">suggestion</a> (if you remember, he discovered Heartbleed) that the authors of WannaCry are associated with <a href="https://en.wikipedia.org/wiki/Lazarus_Group">the Lazarus group</a> , which conducted the famous attack on Sony Pictures in 2014, and two years later stole a part of the gold reserves of Bangladesh (101 million through the SWIFT).  This group is associated with North Korea. <br><br>  Neil Mehta pointed to the same piece of code in WannaCry and the Lazarus malware. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> ciphersuites[] = { <span class="hljs-number"><span class="hljs-number">0x0003</span></span>,<span class="hljs-number"><span class="hljs-number">0x0004</span></span>,<span class="hljs-number"><span class="hljs-number">0x0005</span></span>,<span class="hljs-number"><span class="hljs-number">0x0006</span></span>,<span class="hljs-number"><span class="hljs-number">0x0008</span></span>,<span class="hljs-number"><span class="hljs-number">0x0009</span></span>,<span class="hljs-number"><span class="hljs-number">0x000A</span></span>,<span class="hljs-number"><span class="hljs-number">0x000D</span></span>, <span class="hljs-number"><span class="hljs-number">0x0010</span></span>,<span class="hljs-number"><span class="hljs-number">0x0011</span></span>,<span class="hljs-number"><span class="hljs-number">0x0012</span></span>,<span class="hljs-number"><span class="hljs-number">0x0013</span></span>,<span class="hljs-number"><span class="hljs-number">0x0014</span></span>,<span class="hljs-number"><span class="hljs-number">0x0015</span></span>,<span class="hljs-number"><span class="hljs-number">0x0016</span></span>,<span class="hljs-number"><span class="hljs-number">0x002F</span></span>, <span class="hljs-number"><span class="hljs-number">0x0030</span></span>,<span class="hljs-number"><span class="hljs-number">0x0031</span></span>,<span class="hljs-number"><span class="hljs-number">0x0032</span></span>,<span class="hljs-number"><span class="hljs-number">0x0033</span></span>,<span class="hljs-number"><span class="hljs-number">0x0034</span></span>,<span class="hljs-number"><span class="hljs-number">0x0035</span></span>,<span class="hljs-number"><span class="hljs-number">0x0036</span></span>,<span class="hljs-number"><span class="hljs-number">0x0037</span></span>, <span class="hljs-number"><span class="hljs-number">0x0038</span></span>,<span class="hljs-number"><span class="hljs-number">0x0039</span></span>,<span class="hljs-number"><span class="hljs-number">0x003C</span></span>,<span class="hljs-number"><span class="hljs-number">0x003D</span></span>,<span class="hljs-number"><span class="hljs-number">0x003E</span></span>,<span class="hljs-number"><span class="hljs-number">0x003F</span></span>,<span class="hljs-number"><span class="hljs-number">0x0040</span></span>,<span class="hljs-number"><span class="hljs-number">0x0041</span></span>, <span class="hljs-number"><span class="hljs-number">0x0044</span></span>,<span class="hljs-number"><span class="hljs-number">0x0045</span></span>,<span class="hljs-number"><span class="hljs-number">0x0046</span></span>,<span class="hljs-number"><span class="hljs-number">0x0062</span></span>,<span class="hljs-number"><span class="hljs-number">0x0063</span></span>,<span class="hljs-number"><span class="hljs-number">0x0064</span></span>,<span class="hljs-number"><span class="hljs-number">0x0066</span></span>,<span class="hljs-number"><span class="hljs-number">0x0067</span></span>, <span class="hljs-number"><span class="hljs-number">0x0068</span></span>,<span class="hljs-number"><span class="hljs-number">0x0069</span></span>,<span class="hljs-number"><span class="hljs-number">0x006A</span></span>,<span class="hljs-number"><span class="hljs-number">0x006B</span></span>,<span class="hljs-number"><span class="hljs-number">0x0084</span></span>,<span class="hljs-number"><span class="hljs-number">0x0087</span></span>,<span class="hljs-number"><span class="hljs-number">0x0088</span></span>,<span class="hljs-number"><span class="hljs-number">0x0096</span></span>, <span class="hljs-number"><span class="hljs-number">0x00FF</span></span>,<span class="hljs-number"><span class="hljs-number">0xC001</span></span>,<span class="hljs-number"><span class="hljs-number">0xC002</span></span>,<span class="hljs-number"><span class="hljs-number">0xC003</span></span>,<span class="hljs-number"><span class="hljs-number">0xC004</span></span>,<span class="hljs-number"><span class="hljs-number">0xC005</span></span>,<span class="hljs-number"><span class="hljs-number">0xC006</span></span>,<span class="hljs-number"><span class="hljs-number">0xC007</span></span>, <span class="hljs-number"><span class="hljs-number">0xC008</span></span>,<span class="hljs-number"><span class="hljs-number">0xC009</span></span>,<span class="hljs-number"><span class="hljs-number">0xC00A</span></span>,<span class="hljs-number"><span class="hljs-number">0xC00B</span></span>,<span class="hljs-number"><span class="hljs-number">0xC00C</span></span>,<span class="hljs-number"><span class="hljs-number">0xC00D</span></span>,<span class="hljs-number"><span class="hljs-number">0xC00E</span></span>,<span class="hljs-number"><span class="hljs-number">0xC00F</span></span>, <span class="hljs-number"><span class="hljs-number">0xC010</span></span>,<span class="hljs-number"><span class="hljs-number">0xC011</span></span>,<span class="hljs-number"><span class="hljs-number">0xC012</span></span>,<span class="hljs-number"><span class="hljs-number">0xC013</span></span>,<span class="hljs-number"><span class="hljs-number">0xC014</span></span>,<span class="hljs-number"><span class="hljs-number">0xC023</span></span>,<span class="hljs-number"><span class="hljs-number">0xC024</span></span>,<span class="hljs-number"><span class="hljs-number">0xC027</span></span>, <span class="hljs-number"><span class="hljs-number">0xC02B</span></span>,<span class="hljs-number"><span class="hljs-number">0xC02C</span></span>,<span class="hljs-number"><span class="hljs-number">0xFEFF</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">store_be</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * p, T x)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// store T in p, in big-endian byte order } template&lt;typename T&gt; void store_le(void * p, T x) { // store T in p, in little-endian byte order } bool find(const unsigned char * list, size_t n, uint16_t x) { for(size_t i = 0; i &lt; n; ++i) { uint16_t t = (list[2*i + 0] &lt;&lt; 8) | packet[2*i + 1]; if(t == x) return true; } return false; } void make_client_hello(unsigned char * packet) { uint32_t timestamp = time(NULL); packet[ 0] = 0x01; // handshake type: CLIENT_HELLO packet[ 4] = 0x03; // TLS v1.0 packet[ 5] = 0x01; // TLS v1.0 random_bytes(&amp;packet[6], 32); // random_bytes store_be(&amp;packet[6], timestamp); // gmt_unix_time packet[38] = 0x00; // session id length const size_t cipher_num = 6*(2 + rand() % 5); store_be(&amp;packet[39], cipher_num * 2); // ciphersuite length for(size_t i = 0; i &lt; cipher_num;) { const size_t index = rand() % 75; // Avoid collisions if(find(&amp;packet[41], i, ciphersuites[index])) { continue; } else { store_be(&amp;packet[41 + 2*i], ciphersuites[index]); i += 1; } } store_be(&amp;packet[41 + cipher_num * 2], 0x01); // compression_method_len store_be(&amp;packet[42 + cipher_num * 2], 0x00); // compression_method store_le(&amp;packet[0], 0x01 | ((43 + cipher_num * 2) &lt;&lt; 8)); // handshake size }</span></span></code> </pre> <br>  This is a bogus implementation of TLS 1.0 to disguise traffic under TLS.  Indeed, some features of this implementation are such that they just could not repeat them by chance.  This is either the same hacker group or someone else who carefully analyzed the <a href="https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-Report.pdf">conclusions of the analytical report (pdf) on the attack on Sony</a> - and decided to try exactly the same method of masking traffic.  Actually, it could be anyone. <br><br>  The facts are such that nowadays absolutely anyone from any country in the world can conduct such attacks, even alone - thanks to leaks from the NSA and the CIA and other sources in the hands of any hacker now there are powerful tools for conducting a good quality attack on a global scale. </div><p>Source: <a href="https://habr.com/ru/post/357354/">https://habr.com/ru/post/357354/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../357344/index.html">Kaspersky Lab: WannaCry malware was actively spreading through the network due to a vulnerability in Windows 7</a></li>
<li><a href="../357346/index.html">Tsarka Kazakhstan team won at Positive Hack Days 2017 international forum on practical security</a></li>
<li><a href="../357348/index.html">Close-up of the notorious group of hackers APT32 in action</a></li>
<li><a href="../357350/index.html">Block surveillance by Windows 10 is very difficult, says a security specialist</a></li>
<li><a href="../357352/index.html">How Sberbank Online Merges User Data</a></li>
<li><a href="../357356/index.html">Cybersecurity experts believe British nuclear warhead submarines are poorly protected from hacking</a></li>
<li><a href="../357358/index.html">Vulnerability in the system of blocking sites Roskomnadzor allows you to close access to any site in the Russian Federation</a></li>
<li><a href="../357360/index.html">Exposed organizers of raffle tickets on behalf of the airlines in social networks</a></li>
<li><a href="../357362/index.html">20% of Russian IT systems have been subjected to cyber attacks due to the lack of software updates</a></li>
<li><a href="../357364/index.html">The leaked Apple entry tells how companies are fighting leaks.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>