<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Real development experience at Meteor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a story about my experience in developing a live project on the Meteor framework. The framework is very interesting, the development approach ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Real development experience at Meteor</h1><div class="post__text post__text-html js-mediator-article">  This is a story about my experience in developing a live project on the <a href="http://meteor.com/">Meteor</a> framework.  The framework is very interesting, the development approach is conceptually different from most existing PHP / JS frameworks.  In fact, Meteor has to re-learn web development. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1ff/45b/77d/1ff45b77dfa0765eb93a4cf98650aa2b.png"><br><a name="habracut"></a><br>  First, a few words about the project.  This is a promo page for one local dating site.  The task was to create a separate page with a competition for the best photo among the participants.  Only 8 participants.  Anyone can vote, no registration or authorization is required.  On the page there will be a countdown to the end of the competition. <br><br>  Meteor was a good choice for this project.  Or the project turned out to be good as my first job at Meteor, equivalently.  The main feature of Meteor is the so-called.  reactivity ( <a href="http://docs.meteor.com/">Reactivity</a> ).  The idea is that the programmer declaratively describes the logic, without thinking about the communication protocol between the client and the server.  Data update on the client occurs automatically as soon as the data has changed on the server.  This means no more AJAX requests in the project code. <br>  Input data on Meteor do not want to duplicate.  There are some good videos on the site <a href="http://www.meteor.com/">www.meteor.com</a> , as well as several articles on Habr√©. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Next will be a technical description of the project.  The main development approaches used in Meteor using this project will also be explained.  The project structure is as follows: <br><br><ul><li>  client / - data available to the client of Meteor </li><li>  client / client.js - the main script of the client part </li><li>  client / views / - html file storage used by Meteor </li><li>  public / - static files that are accessible by URL </li><li>  server / server.js - the main server-side script </li><li>  model.js - common script for server and client parts </li></ul><br><br><h4>  Collections </h4><br>  MongoDB is used as a database.  The client part has access to the database data in the same way as the server one.  Even the access interface is the same - to simulate database requests on the client side, Minimongo is used.  The client through Minimongo operates JavaScript arrays, unlike the server that makes direct requests to the MongoDB database. <br><br>  file: model.js <br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//       Members = new Meteor.Collection('members');</span></span></code> </pre> <br><br>  In the example above, the members collection is declared.  Since this file is accessible to both the client and server parts of the project, access to the Members variable is on both the client and the server.  This can be verified simply by opening the console in the browser and executing typeof Members or Members.find (). Fetch ().  The only difference is in the implementation, because on the server the Members methods will operate on MongoDB directly, and on the client with JavaScript arrays via Minimongo a wrapper. <br><br>  These collections are managed by Meteor itself - it decides when the data needs to be updated on the client.  The programmer can limit the amount of data that will be presented to the Members variable on the client.  This will be a subset of the data from the server.  This is done with the help of Meteor.publish () and Meteor.subscribe (). <br><br>  file: client / client.js <br><pre> <code class="javascript hljs">Meteor.subscribe(<span class="hljs-string"><span class="hljs-string">'members'</span></span>);</code> </pre><br>  In this case, all participants with all their data should be accessible to the client, so no artificial restrictions are imposed. <br><br>  file: server / server.js <br><pre> <code class="javascript hljs">Meteor.publish(<span class="hljs-string"><span class="hljs-string">'members'</span></span>); Meteor.startup(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Members.find().count() === <span class="hljs-number"><span class="hljs-number">0</span></span>) { Members.insert({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'http://mariels.ru/member/profile_alexandra_igorevna.html'</span></span>, <span class="hljs-attr"><span class="hljs-attr">photo</span></span>: <span class="hljs-string"><span class="hljs-string">'images/member/ .jpg'</span></span>, <span class="hljs-attr"><span class="hljs-attr">thumb</span></span>: <span class="hljs-string"><span class="hljs-string">'http://mariels.ru/$userfiles/thumb_450_1136_94.jpg'</span></span>, <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }); Members.insert({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'http://mariels.ru/member/profile_Alionushka.html'</span></span>, <span class="hljs-attr"><span class="hljs-attr">photo</span></span>: <span class="hljs-string"><span class="hljs-string">'images/member/ .jpg'</span></span>, <span class="hljs-attr"><span class="hljs-attr">thumb</span></span>: <span class="hljs-string"><span class="hljs-string">'http://mariels.ru/$userfiles/thumb_444_1120_90.jpg'</span></span>, <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }); <span class="hljs-comment"><span class="hljs-comment">//   ... } });</span></span></code> </pre><br><br>  In the above code, the standard way to initialize the collection in Meteor.  Since the code is in the file server / server.js, it is executed only on the server. <br><br><h4>  HTML Templates and Reactivity </h4><br>  There is data, now they need to be displayed in the browser.  Meteor uses the JavaScript <a href="http://handlebarsjs.com/">Handlebars</a> JavaScript Template by default.  In fact, a template curve is pretty straightforward and to perform a simple task like ‚Äúaccessing an array index in a foreach loop‚Äù, you have to write a new tag handler.  But, having got used, it is possible to work with it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/830/b52/7b8/830b527b8a9a84fbd9d92fdd34fed619.png"><br><br>  file: client / view / members.html <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"members"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"members"</span></span></span><span class="hljs-tag">&gt;</span></span> {{#render_members members}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"member span6"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"info-cont"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"shadow"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{member.url}}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"account"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{member.thumb}}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"avatar"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span>{{member.name}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{member.photo}}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"image"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rate-cont"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"shadow"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn {{#if voted}}btn-info{{else}}btn-warning{{/if}} pull-center btn-large"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{member._id}}"</span></span></span><span class="hljs-tag"> {{#</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">voted</span></span></span><span class="hljs-tag">}}</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span><span class="hljs-tag">{{/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span><span class="hljs-tag">}}&gt;</span></span> {{#if voted}}    {{else}}   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span>{{member.title}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> {{/if}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> {{/render_members}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  The render_members tag was created only to divide the output into lines (display &lt;div class = "row"&gt; every two entries), but in general this is the usual foreach loop.  There is only one variable accessible to the template - an array of members.  In the body of render_members, all the fields of each object from the members array are available.  If to be absolutely accurate, then members are not an array, but a cursor, but this is not the point. <br><br>  file: client / client.js <br><pre> <code class="javascript hljs">Template.members.members = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Members.find({}, { <span class="hljs-attr"><span class="hljs-attr">sort</span></span>: { <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: <span class="hljs-number"><span class="hljs-number">-1</span></span> }}); }</code> </pre><br><br>  Members.find () returns a cursor, whereas Members.find (). Fetch () is a simple JavaScript array.  Using the cursor as the member variable and wrapping it in function () {} we activate the reactivity of Meteor on this variable template.  This means that as soon as the data of the Members collection on the server changes and the updates are transferred to the client, the template will be automatically redrawn using the new data.  And for this you do not need any additional code on the client! <br><br><h4>  Server methods </h4><br>  file: server / server.js <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     Votes = new Meteor.Collection('votes');</span></span></code> </pre><br><br>  All votes will be stored in the Votes collection and it can grow to several thousand records.  We cannot allow such a huge amount of data to run between the server and the client for obvious reasons.  In addition, on the client, we absolutely do not need to know the data of each voice, such as IP and date.  For these reasons, the variable is declared only in the code running on the server, and Meteor.publish () / Meteor.subscribe () is not called. <br><br>  file: server / server.js <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   IP     var CanVote = Match.Where(function(ip) { check(ip, String); if (ip.length &gt; 0) { var yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1); //       return Votes.find({ ip: ip, date: { $gt: yesterday } }).count() == 0; } return false; }); //  ,   Meteor.methods({ //  true      false    canVote: function() { return Match.test(headers.get('x-forwarded-for'), CanVote); }, //    vote: function(memberId) { check(memberId, String); check(headers.get('x-forwarded-for'), CanVote); var voteId = Votes.insert({ memberId: memberId, ip: headers.get('x-forwarded-for'), date: new Date() }); //  SQL JOIN Members.update(memberId, { $set: { vote: Votes.find({ memberId: memberId }).count() } }); return voteId; }, //      getMemberVotes: function(memberId) { check(memberId, String); return Votes.find({memberId:memberId}).count(); }, //      getTotalVotes: function() { return Votes.find().count(); } });</span></span></code> </pre><br><br>  Using Meteor.methods (), a communication interface between the client and the server is declared within the project.  Since the Votes collection is not available on the client, here methods are declared to obtain the necessary data about this collection, such as the number of votes per participant and the total number of votes. <br><br>  A new entry is added to the voting function in the Votes collection, and the number of votes of the corresponding entry in the Members collection is updated.  The latter is needed to use reactivity in the output of the list of participants (sorted by votes) and the rating graph. <br><br>  In general, Meteor.methods () can be defined in model.js, then the client side will create wrappers for these methods and, when called, the data on the client will be updated instantly, and then corrected if the server behaves differently.  This is called <a href="http://docs.meteor.com/">Latency Compensation</a> .  But in this case, the Votes collection is not available on the client, which means there is no point in this.  You still have to wait for a response from the server. <br><br><h4>  More Reactivity </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/6ba/7e3/b4d/6ba7e3b4dcccd8cccfb6e88ae9bf0138.png"><br><br>  file: client / views / ratings.html <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ratings"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ratings"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"well"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"heading uppercase"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"chart"</span></span></span><span class="hljs-tag">&gt;</span></span> {{#each_with_index members}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rating num{{index}}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{data.thumb}}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"avatar"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> {{/each_with_index}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"pull-center pull-center-1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"votes"</span></span></span><span class="hljs-tag">&gt;</span></span>{{votes}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  file: client / client.js <br><pre> <code class="javascript hljs">Session.setDefault(<span class="hljs-string"><span class="hljs-string">'totalVotes'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); Meteor.startup(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   totalVotes  Deps.autorun(function() { var total = 0; Members.find().forEach(function(m) { total += m.vote; }); Session.set('totalVotes', total); }); //    -5 Deps.autorun(function() { var top = Members.findOne({}, { sort: { vote: -1 }}); //    // update ratings chart Members.find({}, { sort: { vote: -1 }, limit: 5 }).forEach(function(m, i) { var height = top ? Math.floor((m.vote / top.vote) * 190) + 100 : 100; $('.rating.num'+(i+1)).css('height', height); }); }); }); Template.ratings.members = function() { return Members.find({}, {limit: 5, sort: { vote: -1 }}); }; Template.ratings.votes = function() { return Session.get('totalVotes'); };</span></span></code> </pre><br><br>  <a href="http://docs.meteor.com/">Session</a> exists only on the client and it is not persistent, that is, it is reset when the page is updated.  The Session object as well as the collections cursor activates reactivity, so if you change the value of totalVotes in the session, the ratings template will be redrawn. <br><br>  Deps.autorun () is executed each time the reactive data in the function changes.  In this case, this is the Members.find () cursor.  The idea is that as soon as the server updates the votes of any participant, the totalVotes session value of all clients will be updated, and this will lead to a redrawing of the rating block.  Deps.autorun () is used to add a callback to change data on the client.  There are ways to subscribe to specific events of collections such as added, changed, removed more <a href="http://docs.meteor.com/">here</a> . <br>  Thus, if someone voted while the visitor sees the rating block, the rating bars will change their height, and the counter will increase. <br><br>  Also here you can notice the use of jQuery.  It can be mixed with Meteor client code with almost no restrictions.  By the way, Meteor.startup (function {}) and jQuery (function () {}) are identical. <br><br>  file: client / client.js <br><pre> <code class="javascript hljs">Session.setDefault(<span class="hljs-string"><span class="hljs-string">'voted'</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-comment"><span class="hljs-comment">//       Template.members.voted = function() { return Session.get('voted'); } Template.members.events = { 'click button': function(event) { var $btn = $(event.currentTarget); //  ,   Latency Compensation   //         DOM Session.set('voted', true); //     Meteor.call('vote', $btn.data('id'), function(error, vote) { if (error) { Session.set('voted', false); } }); } }</span></span></code> </pre><br><br>  A simple example of calling a server method.  The call occurs asynchronously, so while waiting for the response we mark the session value voted as true.  When analyzing the answer, we can already roll it back if an error has occurred.  The answer of the server is basically not important for us here, I only wonder if there was an error in voting or a vote was counted. <br><br>  This code also has an example of using DOM events.  In principle, you can use jQuery.on (), but I decided to go the canonical way. <br><br>  file: client / views / index.html <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  meta   ..  SEO   --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheets/project.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">media</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"screen"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- ...   CSS --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/flipclock/flipclock.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   JavaScript --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>  2013<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"page-header-bg"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> {{&gt;header}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container-fluid"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"page-header"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"header-gradient"</span></span></span><span class="hljs-tag">&gt;</span></span>  2013<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> {{&gt;page}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"page"</span></span></span><span class="hljs-tag">&gt;</span></span> {{#if contestInProgress}} {{&gt;countdown}} {{&gt;members}} {{&gt;social}} {{&gt;ratings}} {{&gt;terms}} {{&gt;footer}} {{else}} {{&gt;winner}} {{&gt;social}} {{&gt;footer}} {{/if}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Meteor processes all JavaScript, HTML, CSS files found in the project and combines them according to certain rules.  However, files in the public folder are considered static, accessible as is, and not processed by Meteor.  The styles could be brought under the control of Meteor, but it was decided to use the standard approach - to include links to static files in the HTML header. <br><br>  Some third-party JavaScript libraries are also included as static files, although they could be transferred to the client folder and also used from their client-side JavaScript code.  The fact is that not all libraries are written in such a way that they can be used in Meteor, in such cases you can always return to the standard inclusion in the HTML header.  If there is a difference in the way a third-party library is enabled, using Meteor in client code is equally natural. <br><br>  file: client / client.js <br><pre> <code class="javascript hljs">contestEndDate = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(<span class="hljs-string"><span class="hljs-string">'01/30/2014 12:00'</span></span>); Session.set(<span class="hljs-string"><span class="hljs-string">'inProgress'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>() &lt; contestEndDate); Template.header.contestInProgress = Template.page.contestInProgress = Template.footer.contestInProgress = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Session.get(<span class="hljs-string"><span class="hljs-string">'inProgress'</span></span>); } Meteor.startup(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   var targetDate = contestEndDate; var currentDate = new Date(); var offsetSeconds = (targetDate.getTime() - currentDate.getTime()) / 1000; offsetSeconds = Math.max(0, offsetSeconds); var clock = $('#countdown').FlipClock(offsetSeconds, { clockFace: 'DailyCounter', defaultClockFace: 'DailyCounter', countdown: true, callbacks: { stop: function() { Session.set('inProgress', false); } } }); });</span></span></code> </pre><br><br>  In index.html you can see another application of reactivity.  The variable contestInProgress indicates the status of the competition - in progress or already completed.  The appearance of the page changes completely depending on this status.  The status is set when the page is initialized, and also changes by the client when the stop event of the FlipClock counter occurs. <br><br>  The variable contestInProgress is in three templates and its value is the same.  Templates are independent of each other and are redrawn separately. <br><br>  From the code it is clear that the value of the Meteor client session changes from an event handler triggered by a third-party FlipClock library.  And this is despite the fact that the FlipClock library is loaded by the client‚Äôs browser when the page loads. <br>  Here opens the unobvious advantage of Meteor.  Since it is so easy to redraw the page at the end of the countdown, <u>so why not do it</u> ?  This is just one line of code, but it will look spectacular if someone at this point will view the page. <br>  If the project was developed in PHP + AJAX, this would be a separate task.  Simple, but considering that this event will happen only once for the entire existence of the project, it is possible that the programmer simply doesn‚Äôt get around to updating the page status.  And why waste time on it if a couple of people see it?  The rest will simply get the page with the winner.  This is the beauty of Meteor - the programmer does not need to think about the communication protocol and he can concentrate on those little things that would have been put off in the long box. <br><br><h4>  Climax </h4><br>  Well, in the end I will summarize a certain result.  The project was successful and, I think, Meteor reactivity played a significant role here.  Development of such a small web project on Meteor is a pleasure, although sometimes it takes a long time to look for a solution to trivial tasks.  I would definitely not make a page with so many interactive elements if I used PHP. <br><br><h6>  Advantages: </h6><br><ol><li>  No need to think about the communication protocol between the client and the server </li><li>  Server and client code is written in the same language. </li><li>  Conveniently debug code directly from the browser </li><li>  You can quickly demonstrate the status of a project to a client using meteor deploy </li><li>  Active community, including on stackoverflow </li></ol><br><br><h6>  Disadvantages: </h6><br><ol><li>  Still in the preview stage, <b>not suitable for large projects.</b> </li><li>  In the code, some trivial tasks have to be solved with cumbersome constructions. </li><li>  Installation on the combat server requires a node.js server, and if there is already an http server, then the proxy settings from port 80 </li><li>  <b>Not at all suitable for mobile devices</b> due to the large amount of javascript </li><li>  All content in the browser is generated using javascript, this may adversely affect SEO </li></ol><br><br>  The contest itself has already ended, and you can poke the test version here <a href="http://promo.meteor.com/">promo.meteor.com</a> <br>  Project sources <a href="https://github.com/imajus/promo">github.com/imajus/promo</a> </div><p>Source: <a href="https://habr.com/ru/post/204262/">https://habr.com/ru/post/204262/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../204250/index.html">Service robot Tod. First steps with ROS</a></li>
<li><a href="../204252/index.html">10 months of free clouds on DigitalOcean</a></li>
<li><a href="../204254/index.html">Gnuplot vs. 2MASS</a></li>
<li><a href="../204258/index.html">Generating functions back and forth</a></li>
<li><a href="../204260/index.html">SSAO on OpenGL ES 3.0</a></li>
<li><a href="../204264/index.html">STM32 + Visual Studio</a></li>
<li><a href="../204266/index.html">Methods of anonymity online. Part 4. Tor & VPN. Whonix</a></li>
<li><a href="../204274/index.html">Wireshark - taming a shark</a></li>
<li><a href="../204276/index.html">How to use pirates to your advantage</a></li>
<li><a href="../204278/index.html">Errors in the certification of the application in the Windows Store</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>