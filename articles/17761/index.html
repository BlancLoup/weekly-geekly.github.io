<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What should we build a user card?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Few weeks? I read back on Habr√© about integration with google maps. Unfortunately I did not find the link, but the point in the article was about the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What should we build a user card?</h1><div class="post__text post__text-html js-mediator-article"> Few weeks?  I read back on Habr√© about integration with google maps.  Unfortunately I did not find the link, but the point in the article was about the city site to which users could independently add objects to the map.  The idea looked quite sexy, but in the comments the author admitted that he had been writing this functionality for several months (( <br><br>  This fact plunged me into a hard gloom ( <br>  Script analysis on pretty gmaps integrated sites like this <br>  <a href="http://dom.ru/">dom</a> showed impressive miles of code ... And so I would continue to sit in depression, until I accidentally wandered onto a site with a help from <a href="http://code.google.com/apis/maps/documentation/">Google itself</a> . <br><br>  And as it turned out - all the information about the timing and scope of this task is at least sabotage and provocation!  So, we build a user map based on <a href="http://code.google.com/apis/maps/documentation/">Google maps</a> service <a href="http://code.google.com/apis/maps/documentation/">.</a> <br>  Something like this: <br><img src="https://habrastorage.org/getpro/habr/olpictures/76b/848/287/76b8482875cb9e901ef83e7101257d59.png" width="450" height="276" hspace="10" vspace="10">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  Uff, well, try.  <s>The right</s> Programmers always start learning the documentation by examining the examples.  Unfortunately, I usually finish at this stage) Anyway, the examples are written in <a href="http://code.google.com/apis/maps/documentation/examples/index.html">full</a> <br>  And they are pretty good.  Oh, these are some other examples, well, let them be, but in general I <a href="http://code.google.com/support/bin/topic.py%3Ftopic%3D11364">learned</a> from <a href="http://code.google.com/support/bin/topic.py%3Ftopic%3D11364">these</a> . <br><br>  So, for the preparation of a primitive user card, we need: <br>  - One table <br>  - 1-2 html <br>  - a couple of PHP <br>  - a couple of scripts <br>  - <a href="http://code.google.com/apis/maps/signup.html">Maps API Key</a> <br>  One head and at least one finger.  Total 3-4 screen code, we succeed. <br><br>  Since Habr is not friendly to syntax highlighting of source codes - I will give links to them and briefly describe what is there. <br><br>  The table we need: <br> <code>CREATE TABLE `prefix_markers` ( <br> `id` int(11) NOT NULL auto_increment, <br> `name` varchar(180) default NULL, <br> `hello` varchar(180) default NULL, <br> `lat` float(10,6) NOT NULL default '0.000000', <br> `lng` float(10,6) NOT NULL default '0.000000', <br> `sex` varchar(4) NOT NULL default '', <br> `login` varchar(32) NOT NULL default '', <br> PRIMARY KEY (`id`) <br> ) <br></code> <br><br>  Now it is necessary to fill in the record.  This requires html where we show the map, we write in html, in the area of ‚Äã‚Äãthe hider, something like this: <br> <code><br> &lt;? $loadmaps = "" ?&gt; <br> &lt;? if (strstr($_SERVER["REQUEST_URI"],'maps')) {?&gt; <br> &lt;script src="http://maps.google.com/maps?file=api&amp;v=2.x&amp;key=  API" <br> type="text/javascript"&gt;</code> <br>  &lt;?  if (strstr ($ _ SERVER ["REQUEST_URI"], 'add')) {?&gt; <br><br>  &lt;?  $ loadmaps = "onload = 'initialize ()' onunload = 'GUnload ()'"?&gt; <br>  &lt;?}?&gt; <br>  &lt;?  if (strstr ($ _ SERVER ["REQUEST_URI"], 'show')) {?&gt; <br><br>  &lt;?  $ loadmaps = "onload = 'load ()' onunload = 'GUnload ()'"?&gt; <br>  &lt;?}?&gt; <br>  &lt;?}?&gt; <br><br><br><br>  Sorry, but if everything is ugly formatted there - I'm not guilty) <br>  There, depending on the url variable loadmaps is filled <br>  which is then output here: <code>&lt;body &lt;?=$loadmaps?&gt;</code> <br>  Such a perversion - because I have one site header, but depending on what is needed - ‚Äúshow‚Äù or ‚Äúadd‚Äù to the map - different scripts are connected.  I promise it will be easier further.  Maybe) <br><br>  Accordingly, inside the html body that is responsible for the display on the map, we write: <br> <code><br></code> <br>  And which is for adding: <br> <code>/&gt; <br> /&gt; <br> <br> <br> <br></code> <br><br>  Uff, with htmlkami sorted out.  Now we have 2 htmlki with empty cards.  It remains to make the first people add, and the second - the display) <br><br>  Add script - <a href="">here it is, the villain</a> <br><br>  It seems everything is clear.  In initialize - the marker is created, when clicked, the fields are shown where we enter the solemn "Preved" <br>  ShowAddress shows a map centered on the address entered by the user. <br>  In saveData, data is saved by calling a URL with parameters via AYAX <br> <code>new Ajax(urlinsert, {method: "post"}).request(); <br></code> <br>  This library's <a href="http://mootools.net/">mootools</a> syntax, it must also be connected to the hider as) <br><br>  And, even there, the escape function is used everywhere, this is an incorrect function, because my website is also incorrect.  In the wrong code page 1251. You do not need it.  Maybe.  In any case, judging by the comments on the habr of the wrong sites on the Internet do not exist, everything is only in the correct UTF-8.  Well, except for the actual Habra and a couple more sites. <br><br>  Taaks, then this script causes us to have a file insert.php. Everything is boring there, generally tin, just the records are inserted: <br> <code>// Selects rows in the markers table 4 current user <br> $query = "SELECT id FROM prefix_markers WHERE login='".$login."'"; <br> $result = mysql_query($query); <br> $row = @mysql_fetch_assoc($result); <br> //$hello = mb_convert_encoding($hello,"Windows-1251","UTF-8"); <br> <br> if ($row['id']&gt;0){ <br> //update row with user data <br> $query = "UPDATE prefix_markers SET " . <br> " name='".urldecode($name)."', hello='".$hello."', lat='".$lat."', lng='".$lng."', sex='".$sex."' ". <br> "WHERE id = '".$row['id']."'"; <br> $result = mysql_query($query); <br> $res = $row["id"]; <br> }else{ <br> // Insert new row with user data <br> $query = "INSERT INTO prefix_markers " . <br> " (id, name, hello, lat, lng, sex, login ) " . <br> " VALUES (NULL, '".$name."', '".$hello."', '".$lat."', '".$lng."', '".$sex."', '".$login."')"; <br> $result = mysql_query($query); <br> $res = "Insert"; <br> } <br></code> <br><br>  Boredom ... <br>  But after the request is fulfilled, we immediately open show.php <br> <code>newurl = currurl.substring(0,currurl.length-4 ) + "/show"; <br> .. <br> new Ajax(urlinsert, {method: "post"}).request(); <br> self.location.href=newurl; <br></code> <br><br>  Here it is.  But it is empty) It stupidly opens the html show <br> <code>$template = "themes/".$config['theme']."/templates/".$config['templates']['user_maps_show']; <br> viewTemplate($template); <br></code> <br><br>  Doot.  Now the <a href="">show</a> script comes onto the scene. <br>  There everything is clear.  A blue (not blue!) Icon is created for boys, red for girls, markers are created, boring.  The only suspicious moment is the urlxml = baseurl + "/ user / maps_xml.php" call; <br><br>  Here he is: <br> <code>function parseToXML($htmlStr) <br> { <br> $xmlStr=str_replace('&lt;','&lt;',$htmlStr); <br> $xmlStr=str_replace('&gt;','&gt;',$xmlStr); <br> $xmlStr=str_replace('"','"',$xmlStr); <br> $xmlStr=str_replace("'",''',$xmlStr); <br> $xmlStr=str_replace("&amp;",'&amp;',$xmlStr); <br> return $xmlStr; <br> } <br> <br> $query="SELECT *, (SELECT id FROM prefix_user as usr WHERE usr.login = markers.login) AS usrid FROM prefix_markers as markers"; <br> $result = mysql_query($query); <br> //$result = mysql_query($query); <br> if (!$result) { <br> die('Invalid query: ' . mysql_error()); <br> } <br> <br> //header("Content-type: text/xml"); <br> <br> // Start XML file, echo parent node <br> echo ''; <br> <br> // Iterate through the rows, printing XML nodes for each <br> while ($row = @mysql_fetch_assoc($result)){ <br> // ADD TO XML DOCUMENT NODE <br> echo '&lt;marker '; <br> echo 'name="' . parseToXML($row['name']) . '" '; <br> echo 'hello="' . $row['hello'] . '" '; <br> echo 'lat="' . $row['lat'] . '" '; <br> echo 'lng="' . $row['lng'] . '" '; <br> echo 'sex="' . $row['sex'] . '" '; <br> echo 'login="' . $row['login'] . '" '; <br> echo 'usrid="' . $row['usrid'] . '" '; <br> echo '/&gt;'; <br> } <br> <br> // End XML file <br> echo ''; <br> <br> exit(); <br></code> <br><br>  Hurray !!!  (Tortured to write) Oh yes.  According to the mind - it should be a static file, not a script cat.  in xml from database unloads on the fly ... <br><br>  Vooot.  In general, all this is just pieces of code with examples of Google combined in one piece.  Surely you can mix them in a different sequence with other pieces and you will get a completely different result) Much better - 100% <br><br>  See what should happen in the end after all these dances with a tambourine - you can <a href="http://msexy.ru/">here (carefully, the site contains erotic materials)</a> <br>  Button "map".  Without registration - it does not work because ... - but they themselves have just seen all the sources) Therefore it does not work) <br><br>  PS: Some terrible article turned out.  And in style and availability.  One hope that can help someone) If everything is bad and incomprehensible - write plz in the comments I will try to refine. </div><p>Source: <a href="https://habr.com/ru/post/17761/">https://habr.com/ru/post/17761/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../177597/index.html">Take part in the contest "Northern Lights"</a></li>
<li><a href="../177603/index.html">Leap Motion support appeared in Google Earth</a></li>
<li><a href="../177605/index.html">The crib on the graphic design of Android applications</a></li>
<li><a href="../177607/index.html">Advanced file navigation</a></li>
<li><a href="../177609/index.html">Working with FTP and uploading data to xlsx (Cach√© Object Script)</a></li>
<li><a href="../177611/index.html">Connecting the LCD panel from iPad to personal computer</a></li>
<li><a href="../177615/index.html">Information system based on Semantic MediaWiki</a></li>
<li><a href="../177617/index.html">How we made a movie for Shadow Fight 2</a></li>
<li><a href="../177619/index.html">How to get into the "golden billion" or sobering statistics</a></li>
<li><a href="../17762/index.html">Internet Explorer 8 passed Acid2 test</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>