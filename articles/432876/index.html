<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Quick setup of storage Aerodisk Engine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue to acquaint you with the Russian data storage systems AERODISK ENGINE N-series. The previous introductory article is here . Also, the guys...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Quick setup of storage Aerodisk Engine</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/bh/7s/7d/bh7s7dtgbbghpfuthj-cl4jylse.png"><br><br>  We continue to acquaint you with the Russian data storage systems AERODISK ENGINE N-series.  The previous introductory article is <a href="https://habr.com/company/tssolution/blog/425309/">here</a> .  Also, the guys got their own <a href="https://www.youtube.com/channel/UCOnFSximR_IIBQVhAc6909g/videos">YouTube</a> channel with training videos on setting up and working with the system.  And even before the new year, Aerodisk launched a <a href="https://aerodisk.promo/%3Futm_source%3Dts%26utm_medium%3Dhabr">promotional program</a> in which you can buy storage systems at a discount of up to 60%!  The offer, in our opinion, is excellent. <br><br>  This time, Aerodisk provided us with the ENGINE N2 storage system in All-flash configuration for self-study and configuration, and we will share this experience. <br>  In the framework of our acquaintance with ENGINE, we will make a cycle of 3 articles: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  Basic setting </li><li>  Crash tests </li><li>  Load tests </li></ol><br>  In this article, we will perform the basic configuration of the storage system: we will present the LUNs and file balls to the host, as well as evaluate the usability of the control interface.  Before that, we had a one-day training course on how to work with the system and read the documentation. <a name="habracut"></a><br><br>  So, what we have: <br><br><ul><li>  Dual-Controller Storage AERODISK ENGINE N2 with FC-8G and Ethernet 10G Adapters </li><li>  16 SSD disks </li><li>  8 HDD drives </li><li>  Physical server with Windows 2012, which is connected via SAN switches (FC and Ethernet) to the storage system </li><li>  Working documentation for storage systems, as well as bright heads and direct hands of our engineers. </li></ul><br>  The reasonable question is, why are there HDDs, because now in the All-Flash trend?  The fact is that tasks for hybrid storage (SSD + HDD) both arose and continue to arise, so we asked Aerodisk to add a minimum number of HDD disks to the olflash storage to check the functionality of the hybrid groups.  Now we will configure the storage system, and in the next article we will do a big performance test. <br><br><h3>  Unpacking </h3><br>  In the hands of us was this box.  According to the manufacturer, it has 40 TB with a capacity of 300,000 IOPS.  It sounds intriguing, we will check. <br><br><img src="https://habrastorage.org/webt/xh/lf/6t/xhlf6ts7ac6xphdsyckawjba-cs.jpeg" alt="image"><br><br>  Unpack and see the following: <br><br><img src="https://habrastorage.org/webt/cy/bo/wl/cybowl9x0llqqhbauz5j--york0.jpeg" alt="image"><br><br>  In our opinion, everything is done comfortably, on the case there are tips in English and Russian: how you can and how not to do it.  The presence of the Russian language, of course, pleases. <br><br><img src="https://habrastorage.org/webt/gi/ii/ty/giiityb7jg6aljirepace5vbuxo.jpeg" alt="image"><br><br>  In front we see slots for 24 disks, behind - modular controllers and power supplies.  The controllers are equipped with FC ports, Ethernet ports (regular RJ-45 and 10 Gigabit on optics), as well as SAS ports for connecting disk shelves.  The fact that all types of popular I / O ports are in one box is a definite plus.  Everything has been duplicated, which means it can change to hot, and therefore there should not be any problems with working in non-stop mode.  But we will check. <br><br><img src="https://habrastorage.org/webt/f2/do/b7/f2dob7-m9yj0jrqpmh16nsifc34.jpeg"><br><br><img src="https://habrastorage.org/webt/gj/18/5h/gj185hrqzmnuvjmvrwni_gbrbdc.jpeg"><br><br>  Included with the storage are more rails and a technical passport, which, among other things, indicates the IP for connecting to the storage controllers, as well as the administrator password. <br><br>  We mount the storage system in the rack, connect it to the server via switches (both FC and Ethernet), turn on the storage system and start the configuration.  We can connect via the command line via SSH or Web.  We'll deal with the command line later, immediately go to the web interface: <br><br><img src="https://habrastorage.org/webt/la/yi/fc/layifcwzbklrb8qbxfjwfmebnds.png"><br><br>  On the dashboard we see the total current load on the two controllers, the state of the cluster and sensors.  At the left - the main menu, in the upper right - the logon menu, in the same place we set the time and change the password.  At the top left, a useful information panel, which displays the ‚Äúhealth‚Äù status of various storage components.  If something is wrong, you can immediately click on the problem, and the system will send you to the desired menu.  Bottom log, which displays the latest operations. <br>  In general, everything is convenient and logical.  We proceed to configure the storage. <br><br><h3>  Configuring Storage Groups </h3><br>  According to documentation, ENGINE can be given out according to the following protocols: <br><br><ul><li>  FC and iSCSI (block) </li><li>  NFSv4 and SMBv3 (files) </li></ul><br>  There are, of course, FTP and AFP, but this is, in our opinion, exotic, and in the framework of this article it will not be considered (but if you really need, write, try, tell). <br><br>  We have two types of disk groups: RDG, which can give blocks and files, and DDP, which can give only blocks (and is specially tuned for it).  In our last article on <a href="https://habr.com/company/tssolution/blog/425309/">Aerodisk</a> , a detailed description and scenarios of using RDG and DDP were given.  Since the RDG is more stuffed with useful features, we will customize it.  We will return to DDP in the next article, when it will be necessary to test various performance scenarios. <br><br><h4>  Create RDG Storage Group </h4><br>  We make a hybrid group of 4 SSD drives (2 under the cache, 2 under the tearing with a RAID-10 level and 7 HDD drives with a RAID-6P level (triple parity). As a result, we get a fast "upper" level on the SSD and a slow, but very reliable "lower" level of HDD. <br><br>  The process of creating a group of questions has not caused us, it consists of two stages, at the beginning the main ‚Äúlower‚Äù is created, and then the ‚Äúupper‚Äù levels are thrown over it.  In the course of creation, you can enable deduplication and compression (included).  We are also immediately warned about how many disks of autochange we will have for emergency situations.  We reserve one disk for autochange to test this mechanism. <br><br><img src="https://habrastorage.org/webt/u8/t-/0q/u8t-0qgkcjwdizcxerfjc28j2im.png"><br><br>  After creation, we see the ‚Äúskeleton‚Äù of our raid group.  It looks visually and conveniently: <br><br><img src="https://habrastorage.org/webt/0g/_v/x1/0g_vx1w_ubtow81majakssdgto8.png"><br><br>  Also, after creating a group, you can add disks to any of the levels in a special menu: <br><br><img src="https://habrastorage.org/webt/tu/_5/dv/tu_5dvlb8r_mcwt--opq45slvtg.png"><br><br>  The group is created.  In the properties of the group itself there are tabs with LUNs and balls: <br><br><img src="https://habrastorage.org/webt/nb/nh/la/nbnhlangkqoerfuqjpcopdnko-q.png"><br><br>  From there they went to create LUN.  In the process of creating a LUN, we are offered various options.  Among the obviously useful ones, we can note the possibility of creating a ‚Äúthin‚Äù LUN, its block size for a specific LUN (very useful for various types of load) and the ability to enable or disable deduplication and compression for each LUN separately.  We make ‚Äúthin‚Äù LUN with dedup and compression.  LUN created: <br><br><img src="https://habrastorage.org/webt/fu/sc/fz/fuscfz96vwnhpbsvspnfrcxi0wo.png"><br><br>  With the LUN created, you can do a lot of different operations.  After we give the LUN to the server, we check them. <br><br><img src="https://habrastorage.org/webt/am/v6/kx/amv6kxckwtdbyy2uy1c0ar1auc0.png"><br><br>  Now create file resources.  The process of creating NFS and SMB is not much different from creating a LUN, you can also choose an individual unit, ‚Äúthinness‚Äù or ‚Äúthickness‚Äù, but there is a difference.  It is impossible to set individual activation of deduplication and compression to a file share, that is, the setting will be taken from the parent object.  Thus, if we want deduplication to work on file balls and compression, this must be enabled at the RDG level.  In principle, this is OK, but less flexible than with LUNs. <br><br>  Also, a separate topic is setting access to file resources.  For NFS, access control (for reading and / or writing) by IP addresses and / or users is provided. <br><br><img src="https://habrastorage.org/webt/n0/yl/ks/n0ylksoo5xud7wkk3fz4flva0xw.png"><br><br>  For SMB, local users can be created and integrated with Active Directory.  To use AD, when creating a file share, you can enable authorization from AD and enable the ball in the domain.  In this case, the rights to the file share will be managed through Active Directory. <br><br><img src="https://habrastorage.org/webt/l6/4w/1_/l64w1_k5xsujvd4yfis0tblq2ve.png"><br><br>  So, created two file resources: NFS and SMB. <br><br><img src="https://habrastorage.org/webt/ek/1g/xn/ek1gxnzgnlsajsum01b5xuo3usu.png"><br><br><img src="https://habrastorage.org/webt/lf/fm/td/lffmtdqiqbidbrvtsnb9wvvki-8.png"><br><br>  After creating, we look at what operations we can perform.  In principle, everything is the same as with LUNs: resizing, snapshots, access type, etc.  Now the task is to give these created resources to the host. <br><br><h4>  Let's start with LUN </h4><br>  LUN we can give on iSCSI and / or FC.  This is not a typo, judging by the Aerodisk documentation, indeed, it is possible to give one LUN at the same time on both FC and iSCSI.  Why this is needed is not very clear, but the vendor says that this function can be useful for diagnostics.  Well, let's say so.  In any case, we will do it ‚Äúin the old manner‚Äù and give one LUN by FC and the other by iSCSI.  To recreate nothing, let's make a clone of the existing LUN. <br>  We will not describe the process of configuring SAN switches; it is no different from the configuration for other storage systems.  Note that on the Aerodisk support portal in the knowledge base there are examples of setting up various options for SAN switches, which is certainly a plus to vendor karma. <br><br><h4>  We do LUN mapping for FC </h4><br>  We go to the initiators, we see that WWN initiators arrived from the host.  We create a target for the storage system, link the targets and initiators to the device group. <br><br><img src="https://habrastorage.org/webt/3f/ds/vn/3fdsvnh-kwrz72xzrciwqpt4vje.png"><br><br>  Select the desired LUN and do the mapping through the created device group. <br><br><img src="https://habrastorage.org/webt/je/ak/qy/jeakqym5v_st8pxtm0xfphu4t6w.png"><br><br>  In the application of the administrator‚Äôs guide there is a separate guide on how to properly present storage resources for each of the protocols with settings for popular OSs.  The presentation of LUN for FC did not cause any special questions.  On CentOS, the device-mapper-multipath package must first be installed.  The host server eventually saw the block device, I realized that this is AERODISK. <br><br><img src="https://habrastorage.org/webt/ns/fj/xe/nsfjxejgzbxhdpnyzrrmsjttj6i.png"><br><br>  By the way, in the process of mapping found a useful thing.  You can set your hands LUN ID.  By default, this ID is assigned in order automatically, but sometimes there are situations when you need to point it by hand.  For example, for a SAN boot (booting the OS from the LUN of the storage system), as well as in large data centers, where there are many different storage systems, and even more LUNs from them.  There LUN ID is used for correct accounting and quick search.  In our opinion, the function - Masthev and Mastuz. <br><br>  Now we check - we see that the LUN is accessible from two active controllers (the second as a non-optimal path is the classic ALUA). <br><br><img src="https://habrastorage.org/webt/oz/h6/84/ozh684yu6veg1ttww-2gl5kemdm.png"><br><br>  Formatting the LUN in NTFS, we get the disk "D". <br><br><h4>  Go to iSCSI </h4><br>  Create another LUN on the same disk group.  With the presentation on iSCSI had to work.  The fact is that for iSCSI, besides the target, the initiator and their connection, there is one more additional entity - the HA resource.  The HA resource is a virtual interface on which a virtual IP (VIP) is hung, which simultaneously looks at two (or more) physical Ethernet interfaces on two different controllers and serves for fault tolerance.  Schematically it looks like this: <br><br><img src="https://habrastorage.org/webt/ua/e8/jl/uae8jlqwk9pxhvmqgytqky3cphm.png"><br><br>  The HA resource is bound to a specific RDG.  On the same group, you can bind another HA-resource and give it a VIP to another subnet (it can be useful in life). <br><br>  As a result, figured out.  We created a HA resource, set the iSCSI initiator to Windows, copied the initiator name (IQN) of Windows.  Next, create an iSCSI target for storage and associated the target with the initiator. <br><br><img src="https://habrastorage.org/webt/bw/-k/mz/bw-kmzid3mugf4zkwtdwphdbxly.png"><br><br>  Connect LUN to Windows.  Formatted, created disk D. <br><br><h4>  We connect file resources </h4><br>  This process is as simple as SMB and NFS.  The only time on Windows is to install a regular NFS client.  All these nuances are described in the documentation.  File access also requires a HA resource.  We created it in the previous step, so we will use the same one. <br>  Both of our file balls are connected with in Windows using a network drive, respectively, G and E. <br><br><img src="https://habrastorage.org/webt/wf/wq/sk/wfwqskpqik7ujo3uygfjptb2nhq.png"><br><br><h4>  Conclusion </h4><br>  At this point, we can say that the basic configuration of the storage system has been completed, further tests of the reliability of the storage system will go.  If we take the total time we spent on the basic setup, periodically peeping into the documentation, it turned out about 30-35 minutes, 10 of which were carried with iSCSI.  In our experience, this is very short-lived (on some storage systems of famous vendors, similar operations took several hours), so we can say that the system is quite simple to learn, logical and convenient for the administrator. </div><p>Source: <a href="https://habr.com/ru/post/432876/">https://habr.com/ru/post/432876/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../432860/index.html">PlayStation Classic hacked, now games can be run from a flash drive</a></li>
<li><a href="../432862/index.html">The prototype of the citizen‚Äôs digital profile platform will be launched in Russia by the end of 2019</a></li>
<li><a href="../432866/index.html">Made a redesign - lost a billion</a></li>
<li><a href="../432870/index.html">How browsers work - an introduction to web application security</a></li>
<li><a href="../432872/index.html">Microsoft's new Edge browser will support Chrome extensions.</a></li>
<li><a href="../432878/index.html">Telepathic payments, writing to an elephant wash and other test tasks for UX editors</a></li>
<li><a href="../432880/index.html">What do you know about electricity wholesale and retail?</a></li>
<li><a href="../432882/index.html">Do-it-yourself StarWars snowflakes (upd. 2018)</a></li>
<li><a href="../432886/index.html">How to pump a product team: culture, experiments and structure</a></li>
<li><a href="../432888/index.html">How Heisenbug works</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>