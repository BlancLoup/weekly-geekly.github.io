<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Authorization on the site using phpBB / XenForo</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About a year ago I needed to enable users registered on the forum (phpBB) to log in to the site (modX). At that time, the forum was already working an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Authorization on the site using phpBB / XenForo</h1><div class="post__text post__text-html js-mediator-article">  About a year ago I needed to enable users registered on the forum (phpBB) to log in to the site (modX).  At that time, the forum was already working and users were actively communicating.  <a href="http://i--gu.ru/phpbb-i-modxbb">MODxBB</a> solutions were not there yet and had to <a name="habracut"></a>  to fantasize. <br><br>  <strong>The result was something like this.</strong> <br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $modx, $phpbb_root_path, $phpEx, $user, $db, $config, $cache, $template, $auth; $phpbb_root_path = $modx-&gt;config[<span class="hljs-string"><span class="hljs-string">'base_path'</span></span>] . <span class="hljs-string"><span class="hljs-string">'forum/'</span></span>; define(<span class="hljs-string"><span class="hljs-string">'IN_PHPBB'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $phpEx = <span class="hljs-string"><span class="hljs-string">"php"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>($phpbb_root_path . <span class="hljs-string"><span class="hljs-string">'includes/functions_install.'</span></span> . $phpEx); <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>($phpbb_root_path . <span class="hljs-string"><span class="hljs-string">'includes/functions_display.'</span></span> . $phpEx); <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>($phpbb_root_path . <span class="hljs-string"><span class="hljs-string">'common.'</span></span> . $phpEx); <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>($phpbb_root_path . <span class="hljs-string"><span class="hljs-string">'includes/captcha/captcha_factory.'</span></span> . $phpEx); $user-&gt;session_begin(); $auth-&gt;acl($user-&gt;data); $user-&gt;setup(<span class="hljs-string"><span class="hljs-string">'ucp'</span></span>); $login = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_POST[<span class="hljs-string"><span class="hljs-string">'logoutForum'</span></span>]) &amp;&amp; $user-&gt;data[<span class="hljs-string"><span class="hljs-string">'user_id'</span></span>] != ANONYMOUS) $user-&gt;session_kill(); <span class="hljs-comment"><span class="hljs-comment">//  if(isset($_POST['login']) &amp;&amp; $user-&gt;data['user_id'] == ANONYMOUS){ $username = request_var('username', '', true); $password = request_var('password', '', true); $autologin = (!empty($_POST['autologin'])) ? true : false; $viewonline = (!empty($_POST['viewonline'])) ? false : true; $login = $auth-&gt;login($username, $password, $autologin, $viewonline); } header('Content-type: text/html; charset=UTF-8'); header('Cache-Control: private, no-cache="set-cookie"'); header('Expires: 0'); header('Pragma: no-cache'); if((!empty($login) &amp;&amp; $login['status'] == LOGIN_SUCCESS) || $user-&gt;data['user_id'] != ANONYMOUS){ if(!empty($login)) $auth-&gt;acl($user-&gt;data); $modx-&gt;setPlaceholder('UserName',get_username_string('full', $user-&gt;data['user_id'], $user-&gt;data['username'], $user-&gt;data['user_colour'])); echo $modx-&gt;getChunk('ExitBlock'); /* Hello [+UserName+] &lt;form method="post" action="/[~[*id*]~]"&gt;&lt;input type="submit" name="logoutForum" value="" /&gt;&lt;/form&gt; */ } else{ if(isset($login['error_msg']) &amp;&amp; $login['error_msg']){ //  $err = $user-&gt;lang[$login['error_msg']]; if ($login['error_msg'] == 'LOGIN_ERROR_USERNAME' || $login['error_msg'] == 'LOGIN_ERROR_PASSWORD'){ $err = (!$config['board_contact']) ? sprintf($user-&gt;lang[$login['error_msg']], '', '') : sprintf($user-&gt;lang[$login['error_msg']], '&lt;a hrf="mailt:' . htmlspecialchars($config['board_contact']) . '"&gt;', '&lt;/a&gt;'); } if($login['error_msg']=='LOGIN_ERROR_ATTEMPTS'){ //? $captcha = &amp; phpbb_captcha_factory::get_instance($config['captcha_plugin']); $captcha-&gt;init(CONFIRM_LOGIN); $template-&gt;assign_vars(array('CAPTCHA_TEMPLATE' =&gt; $captcha-&gt;get_template())); $err = $user-&gt;lang[$login['error_msg']]; $err.='&lt;br /&gt;&lt;img sr="/forum/ucp.php?mode=confirm&amp;confirm_id='.$template-&gt;_rootref['CONFIRM_IMAGE_LINK'].'" alt=" " /&gt;&lt;br /&gt;   : &lt;input type="text" name="confirm_code" id="confirm_code" size="8" maxlength="8" title=" " /&gt;&lt;input type="hidden" name="confirm_id" id="confirm_id" value="'.$template-&gt;_rootref['CONFIRM_ID'].'" title=" " /&gt;&lt;br /&gt;'; } $modx-&gt;setPlaceholder('ErrorMsg',$err); } echo $modx-&gt;getChunk('forumLoginForm'); /* &lt;form method="post" action=""&gt; [+ErrorMsg+]&lt;BR&gt; : &lt;input type="text" name="username" id="username" size="10" title="login" /&gt;&lt;br /&gt; : &lt;input type="password" name="password" id="password" size="10" title="password" /&gt;&lt;br /&gt; &lt;input type="submit" name="login" value="" /&gt; &lt;/form&gt; */ } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br><br>  The code is certainly not perfect, but it worked flawlessly. <br>  The topic would have ended on this if one day it had not occurred to me to change the forum engine.  After wandering on the Internet, it was decided to put XenForo.  Determining factors were such items as: <br><ol><li>  Social buns out of the box </li><li>  The ability to import users, topics and messages from the forum phpBB 3.0 </li><li>  Comfort code </li><li>  Active <a href="http://www.xf-russia.ru/">community</a> </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <strong>Download, Install, Import ...</strong> Moreover, the import was done with the preservation of ID-Schnik, so that you can easily redirect the user who has come to the site by the link of the old forum to a new page. <br>  Now it was necessary to restore the functionality of the authorization form on the site itself.  As it turned out, this is not so difficult, because the XenForo code is very clear. <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $noauth=<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($noauth)? $noauth : <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    ? $fileDir=$modx-&gt;config['base_path'].'forum/'; $startTime = microtime(true); require ($fileDir . '/library/XenForo/Autoloader.php'); XenForo_Autoloader::getInstance()-&gt;setupAutoloader($fileDir . '/library'); XenForo_Application::modxParserActive(); // XenForo,       XenForo_Application::initialize($fileDir . '/library', $fileDir); XenForo_Application::set('page_start_time', $startTime); XenForo_Session::startPublicSession(); $xfUser = XenForo_Visitor::getInstance(); $data=array(); if($xfUser-&gt;get('user_id')=='0'){ $data['back']=isset($_SERVER['REQUEST_URI'])?$_SERVER['REQUEST_URI']:'/'; $data['linkauth']='forum/login/login'; $data['noauth']=$modx-&gt;getChunk($noauth); //   echo $modx-&gt;parseChunk('forumLoginForm', $data,'[+','+]'); /*[+noauth+]&lt;BR&gt; &lt;form action="/[+linkauth+]" mthod="post" lass="xenForm " id="login" style="display: block"&gt; &lt;&gt;/e-mail: &lt;inut type="text" name="login" id="LoginControl" class="textCtrl" tabindex="101"&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;:&lt;inut type="password" name="password" class="textCtrl" id="ctrl_password" tabindex="102"&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;inut type="submit" class="button primary" value="" tabindex="104"&gt;&lt;/&gt; &lt;inut type="hidden" name="remember" value="1" id="ctrl_remember"&gt; &lt;inut type="hidden" name="cookie_check" value="1"&gt; &lt;inut type="hidden" name="redirect" value="[+back+]"&gt; &lt;inut type="hidden" name="_xfToken" value=""&gt; &lt;/frm&gt;*/ }else{ $data['UserName']=$xfUser-&gt;get('username'); echo $modx-&gt;parseChunk('ExitBlock', $data,'[+','+]'); } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br><br>  And now the most interesting thing begins: I will explain what the mysterious function modxParserActive is. <br><br>  Open the Application.php file from the library / XenForo / folder and add the definition of a new variable to the XenForo_Application class. <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $_modxParser = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>;</code> </pre> <br>  Then we define new features. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">modxParserActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$_modxParser = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetModxParser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$_modxParser; }</code> </pre> <br>  And the final touch.  In the beginApplication function we wrap the code. <br><pre> <code class="php hljs">@ini_set(<span class="hljs-string"><span class="hljs-string">'output_buffering'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-comment"><span class="hljs-comment">// see http://bugs.php.net/bug.php?id=36514 if (!@ini_get('output_handler')) while (@ob_end_clean()); error_reporting(E_ALL | E_STRICT &amp; ~8192); set_error_handler(array('XenForo_Application', 'handlePhpError')); set_exception_handler(array('XenForo_Application', 'handleException'));</span></span></code> </pre> <br><br>  in the next condition <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::GetModxParser()){ ‚Ä¶... }</code> </pre> <br><br>  Yes, I know that it‚Äôs not the best idea to climb the engine code, but that‚Äôs what it was all about.  This post.  So far this is the only way I have been able to circumvent the compatibility conflict modx and XenForo.  The fact is that modx parses chunks, snippets using exactly ob_end_clean;  And since this function was called earlier, modx gets an empty buffer with all the ensuing consequences. </div><p>Source: <a href="https://habr.com/ru/post/136833/">https://habr.com/ru/post/136833/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136827/index.html">Amazon EC2 Autoscale Load Balancer</a></li>
<li><a href="../136828/index.html">Implementing Iterators in C # (Part 1)</a></li>
<li><a href="../136829/index.html">Types of instance in amazon ec2</a></li>
<li><a href="../136830/index.html">Imaginary personalities. How to create your twins for the good</a></li>
<li><a href="../136831/index.html">Every fifth American now has a tablet</a></li>
<li><a href="../136834/index.html">Request Life Cycle in the MVC 3 Framework Application</a></li>
<li><a href="../136835/index.html">Underwater stone in foreach ($ items as & $ item)</a></li>
<li><a href="../136836/index.html">Electronic signature technologies</a></li>
<li><a href="../136840/index.html">CyanogenMod developers create alternative to Android Market</a></li>
<li><a href="../136841/index.html">Induc still a threat to delphi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>