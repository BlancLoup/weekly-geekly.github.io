<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using P / Invoke: hiding the Start button and the taskbar in Windows</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On Habr√© already there were several articles telling about use of the P / Invoke mechanism in projects on C #. Basically, the articles had a strong bi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using P / Invoke: hiding the Start button and the taskbar in Windows</h1><div class="post__text post__text-html js-mediator-article">  On Habr√© already there were several articles telling about use of the P / Invoke mechanism in projects on C #.  Basically, the articles had a strong bias towards the theory and gave small illustrative examples. <br>  I want to show a more illustrative example showing the possibilities of unmanaged code - we will hide the Start button and the taskbar. <br><a name="habracut"></a><br>  For the first time, I learned about the ability to use the Windows system functions in my programs when learning Visual Basic.  This topic so captured me that I began to collect examples of using the Windows API functions in the collection.  First, I collected examples of everything.  Then he began to approach the matter more legibly and began to select those functions and examples that he used in his projects.  For several years, I scored more than 500 functions, and all the examples to them for convenience, designed in the form of a CHM-file.  The demo version of the reference book can still be downloaded from <a href="http://rusproject.narod.ru/guide.htm">http://rusproject.narod.ru/guide.htm</a> . <br>  When the .NET Framework and the C # and Visual Basic .NET languages ‚Äã‚Äãappeared, it migrated smoothly to these languages.  And this is where my Windows API reference book came in handy.  As written in many smart books, the C # language has incorporated the best of Java, C ++, Visual Basic.  Regarding P / Invoke, it can be said that the technology of invoking unmanaged code from managed code was taken from Visual Basic.  If in C ++ the call of system functions is transparent to the programmer, then for C # the required function must be declared (analogue of the Declare in VB 6.0).  From my collection of examples, I decided to show a project that allows you to hide the Start button and the taskbar in Windows XP / Vista / 7. <br><br>  In fact, the example does not have any practical value (in any case, I was not able to find a worthwhile use for it).  The only thing that comes to mind is the creation of a comic program that on April 1 will hide the usual interface elements on the table of an unprepared user.  But, on the other hand, the example gives some idea about the Windows device, is effective in the eyes of novice programmers and gives a more complete picture of the functions used. <br>  So let's start with the theory.  First, the Start button, the taskbar, the notification area and the clock area are all windows.  So, getting access to this window, you can change the usual behavior of the interface element.  The second is that all these windows belong to certain classes.  And, precisely, by the name of the classes, you can find the descriptors of the windows we need to do experiments on them.  Here are the class names: <br><ul><li>  Shell_TrayWnd - taskbar </li><li>  Button - Start Button </li><li>  TrayNotifyWnd - notification area with icons and clock </li><li>  TrayClockWClass - watch </li></ul><br>  Now go to the functions.  For our purposes, we need the FindWindows, FindWindowEx, and ShowWindow functions.  I will not give here descriptions of functions - you can independently learn about them on the Internet or in my directory.  I will give only their declarations and a couple of related constants: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">//    ,    ,</font> <br> <font color="#008000">//   ,   ,   </font> <br> [DllImport( <font color="#A31515">"user32.dll"</font> )] <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">extern</font> <font color="#2B91AF">IntPtr</font> FindWindow( <font color="#0000ff">string</font> ClassName, <font color="#0000ff">string</font> WindowName); <br> <br> [DllImport( <font color="#A31515">"user32.dll"</font> )] <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">extern</font> <font color="#2B91AF">IntPtr</font> FindWindowEx( <br> <font color="#2B91AF">IntPtr</font> hwndParent, <font color="#2B91AF">IntPtr</font> hwndChildAfter, <br> <font color="#0000ff">string</font> className, <font color="#0000ff">string</font> windowName); <br> <br> [DllImport( <font color="#A31515">"user32.dll"</font> )] <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">extern</font> <font color="#0000ff">bool</font> ShowWindow( <font color="#2B91AF">IntPtr</font> hWnd, <font color="#0000ff">int</font> nCmdShow); <br> <br> <font color="#0000ff">const</font> <font color="#0000ff">int</font> SW_HIDE = 0; <br> <font color="#0000ff">const</font> <font color="#0000ff">int</font> SW_SHOW = 5;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  And then everything is very simple.  The FindWindow and FindWindowEx functions use the class name to find the necessary descriptors, which are then used in the ShowWindow function to hide or show the desired element. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">bool</font> show = <font color="#0000ff">false</font> ; <br> <br> <font color="#008000">//      </font> <br> <font color="#0000ff">private</font> <font color="#0000ff">void</font> butHideTaskbar_Click( <font color="#0000ff">object</font> sender, <font color="#2B91AF">EventArgs</font> e) <br> { <br> <font color="#008000">//    </font> <br> <font color="#2B91AF">IntPtr</font> taskBarWnd = FindWindow( <font color="#A31515">"Shell_TrayWnd"</font> , <font color="#0000ff">null</font> ); <br> <font color="#008000">//    </font> <br> <font color="#2B91AF">IntPtr</font> startWnd = FindWindow( <font color="#A31515">"Button"</font> , <font color="#0000ff">null</font> ); <br> <br> <font color="#008000">// /  </font> <br> <font color="#0000ff">if</font> (taskBarWnd != <font color="#2B91AF">IntPtr</font> .Zero) <br> { <br> ShowWindow(taskBarWnd, show ? SW_SHOW : SW_HIDE); <br> } <br> <br> <font color="#008000">// /  </font> <br> <font color="#0000ff">if</font> (startWnd != <font color="#2B91AF">IntPtr</font> .Zero) <br> { <br> ShowWindow(startWnd, show ? SW_SHOW : SW_HIDE); <br> } <br> show = !show; <br> } <br> <br> <font color="#008000">//     </font> <br> <font color="#0000ff">private</font> <font color="#0000ff">void</font> butHide_Click( <font color="#0000ff">object</font> sender, <font color="#2B91AF">EventArgs</font> e) <br> { <br> <font color="#008000">//   </font> <br> <font color="#2B91AF">IntPtr</font> taskBarWnd = FindWindow( <font color="#A31515">"Shell_TrayWnd"</font> , <font color="#0000ff">null</font> ); <br> <font color="#008000">//ShowWindow(taskBarWnd, SW_HIDE);</font> <br> <br> <font color="#008000">//   </font> <br> <font color="#2B91AF">IntPtr</font> tray = FindWindowEx(taskBarWnd, <font color="#2B91AF">IntPtr</font> .Zero, <font color="#A31515">"TrayNotifyWnd"</font> , <font color="#0000ff">null</font> ); <br> <br> <font color="#008000">//   </font> <br> <font color="#008000">// ShowWindow(tray, SW_HIDE);</font> <br> <br> <font color="#008000">//   </font> <br> <font color="#2B91AF">IntPtr</font> trayclock = FindWindowEx(tray, <font color="#2B91AF">IntPtr</font> .Zero, <font color="#A31515">"TrayClockWClass"</font> , <font color="#0000ff">null</font> ); <br> <font color="#008000">//   </font> <br> ShowWindow(trayclock, SW_HIDE); <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  For example, I placed two buttons on the form.  When you click on the first button, the taskbar and the Start button simultaneously disappear.  If you wish, you can comment out individual lines of code and hide only the taskbar or just the Start button.  Pressing the button again will allow you to see your favorite Start button and taskbar again. <br><br>  Upd.  An important addition: in Windows XP and below, the Start button is a child window of the taskbar, and you need to use the code to get its handle. <br><pre>  &lt;code&gt;
 IntPtr startWnd = FindWindowEx (taskBarWnd, IntPtr.Zero, "BUTTON", null);
 &lt;/ code&gt; </pre><br><br>  When you click on the second button, you can hide certain elements of the taskbar - I commented out part of the code, leaving only the hiding area with the clock.  Be careful ‚Äî an example is written for educational purposes.  If you hide the clock, then they themselves will not appear.  You will have to restart your computer to return everything as it was.  Therefore, independently modify the example in order to be able to show hidden elements. <br><br>  Without screenshots, probably not enough.  Here I hid the taskbar, but left the Start button <br><img src="http://i025.radikal.ru/0909/5e/277459a07f63.jpg"><br>  And here I hid only the area of ‚Äã‚Äãthe clock. <br><img src="https://habrastorage.org/getpro/habr/post_images/206/777/643/2067776437d2681b6afdb531a72b9534.jpg"><br><br>  A few words about the Start button.  In Windows 98 / XP it was possible to hide the button without any problems (see the note above).  In Windows Vista, instead of a rectangular button, a round button appeared and its behavior changed.  It is no longer a child window of the taskbar.  And the code given here works in half.  You can hide both the taskbar and Start, or just the taskbar.  And hide Start, but leave the taskbar does not work.  The button does not disappear, but it shrinks.  Looking for a solution to the problem, I came across a couple of articles on CodeProject ( <a href="http://www.codeproject.com/KB/miscctrl/Hide_Vista_Start_Orb_Simp.aspx">http://www.codeproject.com/KB/miscctrl/Hide_Vista_Start_Orb_Simp.aspx</a> and <a href="http://www.codeproject.com/KB/miscctrl/hide_vista_start_orb.aspx">http://www.codeproject.com/KB/miscctrl/hide_vista_start_orb.aspx</a> . But, Unfortunately, these examples did not work for me. They are intended for American Windows 7, there is no effect on Russian Windows (there was no success in changing Start code to Start). <br><br>  This and other examples with Windows API functions in the .NET Framework can be found in my reference book at <a href="http://developer.alexanderklimov.ru/guide.php">http://developer.alexanderklimov.ru/guide.php</a> .  The reference book itself is paid, but if you have free time, you can find examples of any function on the Internet (Google will help you).  And also I can advise a very useful resource in English <a href="http://pinvoke.net/">pinvoke.net: the interop wiki!</a>  on which, on the Wikipedia principle, enthusiasts add examples related to P / Invoke. <br>  Happy programming! <br><br></div><p>Source: <a href="https://habr.com/ru/post/68613/">https://habr.com/ru/post/68613/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../68596/index.html">body parts</a></li>
<li><a href="../68597/index.html">Russian SharePoint User Group</a></li>
<li><a href="../68598/index.html">Invites to Peers.FM and Animuxia</a></li>
<li><a href="../68602/index.html">Nokia 5800 and N97 tricks</a></li>
<li><a href="../68608/index.html">10 tricks to work with YouTube</a></li>
<li><a href="../68615/index.html">More about syncing Windows Mobile with Evolution</a></li>
<li><a href="../68616/index.html">Creating an installer using WiX</a></li>
<li><a href="../68617/index.html">Software RAID1 (mirroring) on ‚Äã‚ÄãXenServer 5.5</a></li>
<li><a href="../68618/index.html">Clone Twitter from Yahoo !: Yahoo Meme</a></li>
<li><a href="../68619/index.html">AMD six-core dragon in 2010</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>