<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Expansion of network capabilities of a programmable relay using WI-FI</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="How it all began 
 It all began with the development of algorithms for the PR200 programmable relay, and often required visualization or information i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Expansion of network capabilities of a programmable relay using WI-FI</h1><div class="post__text post__text-html js-mediator-article"><h2>  How it all began </h2><br>  It all began with the development of algorithms for the PR200 programmable relay, and often required visualization or information input from a computer, for this it is necessary to use operator panels or SCADA systems, but this is not always convenient, and is it necessary for simple systems.  The solution was found quickly, and over time I tried to improve and facilitate my work in this direction as much as possible, what came out of it read further. <br>  It's about the WI-FI network card and its capabilities. <br><br><img src="https://habrastorage.org/webt/z7/0j/nn/z70jnnmuwed2qwcdyhbqjhni0-w.jpeg" alt="image"><br><a name="habracut"></a><br>  Since this board is used for debugging various projects, the interaction interface is constantly modified for more convenient and quick setup.  The first modification was a simple RS-485 to TCP converter with output to WEB, with ready-made firmware known in the ESP8266 community.  Since then, more than 2 years have passed, and it took archives to analyze the processes stretched in time, and since I wanted to combine all this in one device without additional equipment, it was decided to build in support for microSD, which greatly simplified the process analysis with the ability to quickly access archives.  The second modification of the board had a slot, with the ability to remove the microSD card for saving recorded files on the computer.  It seemed to me not very convenient, and a version appeared with the ability to download files via WI-FI.  Sometimes downloading does not happen to the end and a repeated download operation is required, but considering that at this time the equipment remains in operation and archiving can also work, I think this is not a very big problem.  Also, a version with a 16 mB memory chip was tested instead of a microSD card.  Faster downloading, but there is no possibility to save a lot of files, the recording goes sequentially until the entire memory is full. <br><br><h2>  Purpose and capabilities of the interface card </h2><br>  The board is designed to expand access to the internal variables of the logic of the programmable relay PR200, and provides access to both read and write variables. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Thanks to the wireless WI-FI interface, access to the device is provided without the need to connect additional equipment.  First of all, the solution is focused on projects of simple home automation in places with the presence of WI-FI networks.  These include automation solutions for lighting both internal and external, management and monitoring of pumping stations, greenhouses, etc. Due to the built-in WEB server in the board, there is no need to purchase additional equipment for those cases when access to the system is needed infrequently.  Basic input output is carried out using a smartphone / tablet or PC located in the same network. <br><br>  The interface board can operate in various modes.  When connected to a router with Internet access, it allows you to remotely monitor the status of variables in the logic of the PR200, as well as control the algorithm through network variables in formats supported by the PR200 in the Slave mode. <br><br>  Communication with the programmed algorithm in the device is carried out through network variables, while the interface board can act as a Master or Slave.  The standard speeds and settings of the PR200 network interface are supported.  The exchange via the Modbus TCP protocol is supported; for this, a memory area of ‚Äã‚Äã100 cells is allocated, which can be accessed from both the WEB interface and the Modbus RTU protocol from the PR200. <br><br>  The choice of the network card mode is similar to the choice when working with graphic panels; working in the Master mode allows you to more flexibly control the exchange of variables; for registers whose value is to be received more often than the others, it is possible to set the polling period less.  The following commands are available for the Modbus protocol: <br><br>  03 (0x03) Read Holding Registers Reading. <br><br>  04 (0x04) Read Input Registers Read <br><br>  06 (0x06) Preset Single Register Record <br><br>  16 (0x10) Preset Multiple Registers Record <br><br>  Variables obtained from the relay are available for writing to a file (archive), which is placed on a micro SD card, recording is carried out in text format.  After downloading, you can view on a computer in a simple text editor.  The values ‚Äã‚Äãrecorded in the file can be displayed on a historical chart.  Using the options of scaling and selecting a specific period on the timeline, as well as the individual showing / hiding lines of the graph, the analysis of historical data is carried out. <br><br>  Files created by the archiver remain on the microSD card and can be downloaded to a computer, only one file can be accessed at any time, it can record archived data, read information to build a historical graph, or read information to save on a PC . <br><br>  For archiving, variables from the address space of the network board are available, in which you need to record data received via Modbus RTU from the PR200 or Modbus TCP from other devices supporting the Modbus TCP protocol in the master mode. <br><br>  The interface board can be configured both in the access point mode (Access Point) and in the client mode - the workstation (Station), and maybe in both modes at the same time.  Most often, the access point has Internet access and works as a bridge between the device and the network. <br><br>  A wireless connection can be password protected, there is also the option to hide the access point. <br><br>  Variables received via the RS485 interface from the PR200 can be analyzed by presenting them graphically; in this mode, the values ‚Äã‚Äãwill be displayed in real time with a period of ~ 1 sec. <br><br>  There are 10 variables available for plotting in integer format, floating point or in bitwise representation of 16/32 bits.  The number, type, addresses of variables and output format are taken from the archive settings. <br><br>  For quick and convenient work, it was decided to repeat the form of the device‚Äôs ‚Äúnative‚Äù network board. <br><br><img src="https://habrastorage.org/webt/qv/vg/4j/qvvg4jbi6kbwq0i700vlhi9ftne.jpeg" alt="image"><br>  <i>The board is installed in the device.</i> <br><br><div class="spoiler">  <b class="spoiler_title">Network card can be installed in the first or second slot</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/j_/qy/pq/j_qypqdkzcf7j3a9jujeeqq5fza.jpeg" alt="image"><br></div></div><br>  The board has two switches, one serves to reset the network board (does not affect the operation of the program in the PR200), the second switch can be programmed to enable archiving (selected via settings from the board's WEB interface).  There are also 2 informational LEDs: <br><br>  1-blue briefly lights up when exchanging data over the RS-485 interface with the PR200 <br>  2-red briefly lights up when data is written to the micro SD card, and it is turned on constantly if there is no card or it is impossible to read data on the card. <br><br>  The following are the main menus when working in different modes: <br><br><img src="https://habrastorage.org/webt/to/ny/-9/tony-98orqrhf1luvbjsjgunzum.png" alt="image"><br>  <i>Basic network settings for connecting via WEB.</i> <br><br><img src="https://habrastorage.org/webt/mh/cm/f8/mhcmf8an5ct55x2o3xaoaatw6ps.png" alt="image"><br>  <i>Settings for connection to the PR200 network interface and settings for Modbus TCP connection via WI-FI</i> <br><br><img src="https://habrastorage.org/webt/_6/xm/cz/_6xmcznmcjb3mtvepazjeqwh75c.png" alt="image"><br>  <i>Map of internal registers common to Web, Modbus RTU and Modbus TCP</i> <br><br><div class="spoiler">  <b class="spoiler_title">A test WEB page for controlling and monitoring the I / O states of the PR200 with the PRM-1 expansion module connected.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/nd/tu/fk/ndtufkepntezf8hbwxjdaxozxdi.png" alt="image"><br><br><img src="https://habrastorage.org/webt/qp/td/yx/qptdyx2xpp1ttfzucdh6iprrac4.png" alt="image"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Pages for input / output of values ‚Äã‚Äãfrom the PR200 and data transfer to the control outputs of the device.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/sw/c8/yb/swc8ybmb1radp2jcf027mi_be0s.png" alt="image"></div></div><br>  When connecting a network card to a router with Internet access and port forwarding, remote work with the card through a browser is possible. <br><br><h2>  How it works </h2><br>  Below are screenshots of PR200 operation on a real project, with data archiving.  A project is loaded into the PR200, which reads the values ‚Äã‚Äãof 4 analog channels to which NTC sensors are connected and converts these values ‚Äã‚Äãto temperature via a second network interface configured in Master mode, and the PR200 polls the MB1-8-8A module to which 2 PTS PTS 1000 are connected.  Thus, data are collected on 4 resistance values ‚Äã‚Äãfrom the analog inputs of the PR200, 4 temperature values ‚Äã‚Äãobtained using the NTC macro, and 2 temperature values ‚Äã‚Äãreceived from the MB110-8A module via RS-485.  All 10 registers in the float format on the first network interface configured in the Master mode are read for writing to the archive and WEB visualization. <br><br><img src="https://habrastorage.org/webt/ov/kb/ue/ovkbuegmxtn4pkqkubbbkmfnxxs.png" alt="image"><br>  <i>The menu for working with the SD card, with archiving turned off, displays a list of files on the card, while archiving is enabled, displays a log of the recording on the card.</i> <i><br></i> <br><br><div class="spoiler">  <b class="spoiler_title">Archive management menu.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/mx/jq/7y/mxjq7y7yqfezmgaflitikmg2qrg.png" alt="image"></div></div><br><img src="https://habrastorage.org/webt/w4/45/1j/w4451jdprj0bwuvdt6ytzfem27c.png" alt="image"><br>  The time stamps for archiving are read from the real-time clock registers of the PR200; in this example, the clock is not synchronized with real time. <br><br><div class="spoiler">  <b class="spoiler_title">Archive file downloaded via WI-FI with micro SD installed on the board and opened with a text editor.</b>  <b class="spoiler_title">Ready for plotting.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/vd/r8/zo/vdr8zoxuhegu_i0nu1cnqkepln4.png" alt="image"></div></div><br><div class="spoiler">  <b class="spoiler_title">A page opened in the browser for plotting a graph from a downloaded file.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/9z/8z/s6/9z8zs6cxqt_ogdniz-qwc6evtqq.png" alt="image"></div></div><br><img src="https://habrastorage.org/webt/ml/84/2m/ml842mxpwvm1xnth6o54qhbbntq.png" alt="image"><br>  <i>Formed graph according to data from the archive file.</i> <br><br><img src="https://habrastorage.org/webt/vt/of/t3/vtoft3tx0zwvwgzzz3gzituvhhk.png" alt="image"><br>  <i>Manage the visibility of graphs through the legend</i> <br><br><img src="https://habrastorage.org/webt/gm/wz/9f/gmwz9fhbq3b8d7nqirlqsqaka2u.png" alt="image"><br>  <i>Detailing the necessary areas on the chart.</i> <br><br><h2>  Access to registers via Modbus TCP (WI-FI) </h2><br>  If the WEB capabilities are not enough to build visualization, then using access via Modbus TCP, you can organize communication with SCADA systems and quickly create the necessary visualization from ready-made blocks.  Using various network monitors, you can monitor the status of the internal registers of both the network card and the embedded registers of the PR200.  An example of a survey using the program Modbus Poll. <br><br><img src="https://habrastorage.org/webt/jn/vl/es/jnvlesf0u-zjwdw7ykpea0vlgn0.png" alt="image"><br>  <i>Connection via ModBus TCP using Modbus Poll.</i> <br><br><img src="https://habrastorage.org/webt/vj/h1/nv/vjh1nvjwlnxmo8mxpzfmdf8d6n8.png" alt="image"><br>  <i>Reading registers, and presenting them in various formats.</i> <br><br><h2>  findings </h2><br>  After installing the network board in the device, additional features and tools appear in the work with the programmable relay PR200.  There are various usage scenarios both individually and in combination mode. <br><br>  One example is the recording of archive events in the PR200, currently there are various macros for recording archive events in the device, but they occupy a lot of resources in the device and have limited capabilities both in information output and in depth of archiving using an external drive. more flexibility to configure and record the desired events.  To facilitate the analysis, the register recording mode in bit mode was added, thus, 16 or 32 bit number decomposed into bits is added to the archive.  Various modes of starting archiving are supported, through a switch on the board, a WEB interface, a ModBus register.  Using the ModBus register, the device itself determines the moment of recording, writing a number different from ‚Äú0‚Äù in the cell, the setpoint is exceeded, we write to the register ‚Äú1‚Äù and the logs are written until the value is written to the register ‚Äú0‚Äù, similarly to the triggering of the input signals.  Separately, you can select a record with a certain period of different data on temperature, pressure, humidity for subsequent analysis in a graphical representation.  To convert data into a graphical form embedded web page in the device. <br><br>  The second scenario is remote control, or monitoring of the state of internal variables, change of operating modes.  This option can be divided into local, within the internal network, and through the Internet. <br><br>  The remaining options are auxiliary, debugging, outputting variables of interest to the current visualization, viewing network variables, etc. <br><br>  It is interesting to hear the opinion of the community on this topic, who in what ways solves similar problems? </div><p>Source: <a href="https://habr.com/ru/post/424791/">https://habr.com/ru/post/424791/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../424777/index.html">Using Consul to scale stateful services</a></li>
<li><a href="../424779/index.html">Multi-page SPA on Python</a></li>
<li><a href="../424781/index.html">Learning and testing neural networks on PyTorch using Ignite</a></li>
<li><a href="../424787/index.html">Interview with Aaron Patterson, speaker of the RubyRussia 2018 conference</a></li>
<li><a href="../424789/index.html">How to deploy a Ruby on Rails application with HAProxy Ingress, unicorn / puma, and web sockets</a></li>
<li><a href="../424793/index.html">How to print an electric motor</a></li>
<li><a href="../424795/index.html">How big can a solar-powered drone be?</a></li>
<li><a href="../424799/index.html">Two-way analytics of partner iframe widget using Google Tag Manager</a></li>
<li><a href="../424801/index.html">Zeppelin OS - another step towards secure smart contracts</a></li>
<li><a href="../424803/index.html">Taiwan hacker was going to crack Mark Zuckerberg's Facebook page online, but later abandoned his threats</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>