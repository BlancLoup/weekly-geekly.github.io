<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating animation transitions between Activity in Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Starting with Android 4.4, an additional animation tool for creating animations appeared in the arsenal of developers - Transitions Framework. Initial...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating animation transitions between Activity in Android</h1><div class="post__text post__text-html js-mediator-article">  Starting with Android 4.4, an additional animation tool for creating animations appeared in the arsenal of developers - Transitions Framework.  Initially, it was intended to create animations for changing the state of an application by manipulating multiple View.  With the release of Android 5.0, the set of available animations has been expanded to fit the Material Design concept presented at the same time. <br><br>  Transitions Framework allows you to quickly and easily create a variety of animations.  Therefore, in the process of working on iFunny, it was impossible to pass by this toolkit.  The readers are invited to a special case of using the Transitions API - creating an animation of the transition between the Activity with the effect of "seamlessness". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fo/hz/ct/fohzcts-n18xiuwszdlqzoprtro.jpeg" alt="image"></div><a name="habracut"></a><br>  From a visual point of view, the animations of transitions between the Activity presented in the Transitions Framework can be divided into two types: ordinary animations and animations with a common element.  The concept of animation with a common element is demonstrated on an <s>honestly stolen from <a href="https://developer.android.com/">developer.android.com</a></s> pic.  1. On it in the role of common elements are the avatar and the name of the contact. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/webt/yp/ht/s4/yphts4zvqem2_ibf1zizm9ds7tq.gif" alt="image"></div><br>  <i>Fig.</i>  <i>1. Animation of the transition between the Activity with common elements</i> <br><br>  But no one likes long introductions, so let's go straight to the story of how this type of animation was created in the iFunny application.  As a first example, consider the animation shown in Fig.  2. To use it, we need Android version 5.0 and higher. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yr/jq/xr/yrjqxrwmx8eu9pn0gmn3xjtysuq.gif" alt="image" width="384" height="640"></div><br>  <i>Fig.</i>  <i>2. Animate the transition between the Activity on the user authentication screen</i> <br><br>  From the user's point of view, there is nothing unusual here: one screen, a simple animation.  But, as you might have guessed, ‚Äúunder the hood‚Äù is a transition between two screens with one common element. <br><br>  The first step to creating such a transition is, oddly enough, the choice of this element itself and the determination of its location in the layout of both Activity.  After that, in the description of each View displaying the selected element, you need to add the android: transitionName attribute, and also assign them android: id, if it is absent. <br><br>  In our case, these are ordinary ImageViews of the following form: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ImageView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"40dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"40dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:transitionName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/email_auth_transition"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:srcCompat</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/ic_ifunny_logo"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  It is worth noting two important points.  First, in both ImageView you need to set the same transitionName, which is logical.  Secondly, since we use ImageView, then the content should be the same, since using two different resources can lead to unexpected consequences (at least to a blinking animated View at the beginning and end of the animation). <br><br>  In the second step, you need to add options for the launching (second) Activity, indicating that when it starts, the animation should be launched. <br><br>  <i>Note.</i>  By ‚Äúsecond‚Äù is meant a triggered Activity, the transition to which must be made, and by ‚Äúfirst‚Äù - a triggering Activity. <br><br>  This is done as follows: <br><br><pre> <code class="java hljs">Bundle bundle = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (android.os.Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP_MR1) { View v = activity.findViewById(R.id.auth_logo); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (v != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { ActivityOptions options = ActivityOptions.makeSceneTransitionAnimation(activity, v, activity.getString(R.string.email_auth_transition)); bundle = options.toBundle(); } } Intent intent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(activity, SecondActivity.class); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bundle == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { activity.startActivity(intent); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { activity.startActivity(intent, bundle); }</code> </pre><br>  In the listing below: <br><br><ul><li>  R.id.auth_logo - ImageView from the first Activity used in the animation; </li><li>  activity - the first Activity; </li><li>  R.string.email_auth_transition - a label previously left in the layout of both ImageView; </li><li>  SecondActivity.class is the second Activity. </li></ul><br>  And now the attentive reader may be perplexed: the introduction dealt with the use of API level 19, in the example API level 21 appeared, and in the listing above there is a restriction on API level 22. Unfortunately, while writing the code, it turned out that the transition animation with a common element may behave incorrectly on phones with API level 21. This manifests itself in the form of animation slowdowns in general and artifacts on the animated View in particular.  If you are already familiar with the topic, know the reasons for such behavior and / or ways to solve the described problem - tell us about it in the comments. <br><br>  In the third step, it is necessary to describe the transition animation, i.e.  specify the path traversed by the animated View, and the transformation of the View itself.  To do this, create a separate projectName / src / main / res / transitions / email_auth_transition.xml file with the following contents: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transitionSet</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:transitionOrdering</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"together"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">changeBounds</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">changeImageTransform</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transitionSet</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  A bit of theory.  The transitionSet tag is intended to describe several transformations applied to the animated View at once.  The transitionOrdering parameter is responsible for the order in which these transformations are applied.  In our case, they are applied simultaneously.  There are several types of ready-made transformations presented in the Transitions Framework.  The full list can be found on <a href="https://developer.android.com/reference/android/transition/package-summary.html">this page</a> .  We will focus on two specific ones: changeBounds and changeImageTransform. <br><br>  The first is intended to transform the size of the View.  The second works only with ImageView and in conjunction with the first allows you to change not only the size, but also the shape of the ImageView.  Using the transformation data, we obtain at the output the image resizing animation shown in Fig.  2. If you do not specify the type of motion of the animated View, then it will move along the shortest path.  A more interesting way to get around is in the second example. <br><br>  The final step in creating an animation is its announcement in the themes of both Activity.  To do this, edit the description with the following: (or create new ones in the projectName / src / main / res / values-v22 / theme.xml folder): <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Theme.FirstActivity"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">parent</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Theme.AppCompat.Light.NoActionBar"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">item</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"android:windowActivityTransitions"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">true</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">item</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Theme.SecondActivity"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">parent</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Theme.AppCompat.Light.NoActionBar"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">item</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"android:windowActivityTransitions"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">true</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">item</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">item</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"android:windowSharedElementEnterTransition"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> @transition/email_auth_transition </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">item</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">item</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"android:windowSharedElementExitTransition"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> @transition/email_auth_transition </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">item</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Here: <br><br><ul><li>  android: windowActivityTransitions allows animation of the transition; </li><li>  android: windowSharedElementEnterTransition points to a file describing the transition animation from the first to the second Activity; </li><li>  android: windowSharedElementExitTransition points to a file describing the transition animation when returning from the second Activity to the first one. </li></ul><br>  It should be noted that for OS versions below 5.1 it is necessary to create themes with identical styles in order to avoid quite expected consequences in the form of an application crash.  For example, put them in the projectName / src / main / res / values ‚Äã‚Äã/ theme.xml file: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Theme.FirstActivity"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">parent</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Theme.NoActionBar.Translucent"</span></span></span><span class="hljs-tag">/&gt;</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">style</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Theme.SecondActivity"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">parent</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Theme.TransparentActionBar"</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="undefined"></span></span><span class="xml"><span class="undefined"></span></span></code> </pre><br>  So, to create an animation of the transition from Activity to Activity, you need: <br><br><ol><li>  Describe animations (in our case in the xml-file); </li><li>  Add these animations to the xml-description of the topic Activity; </li><li>  Mark an animated common element (View) in the markup; </li><li>  When launching the second Activity, specify in the launch parameters that it is necessary to enable transition animation for it. </li></ol><br>  As you can see, creating such animations is not at all difficult, except for some of the limitations mentioned in the first example.  Now consider the second, more complex example.  Here we are interested in the transition from the comments section to the user profile (Fig. 3). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ji/s4/cf/jis4cfdeiw-82bv1n3kag3xgus4.gif" alt="image" width="384" height="543"></div><br>  <i>Fig.</i>  <i>3. Animation of the transition from the comments to the user profile</i> <br><br>  All the steps to create a transition, discussed above, are also suitable for this animation.  But the transformation of the common element is implemented a little differently.  The listing below describes the movement of the common element ‚Äúin an arc‚Äù along with a change in its size. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transitionSet</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">changeBounds</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arcMotion</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:maximumAngle</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"90"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:minimumHorizontalAngle</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"90"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:minimumVerticalAngle</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">changeBounds</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transitionSet</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  What is the complexity of the second example?  In the first case, an image was used from the resources of the application itself, and here the image is downloaded from the network.  In addition, for comments, the user's avatar image is taken at a lower resolution than for the profile.  Therefore, it is necessary not only to give the second Activity access to the image used in the first one, but upon completion of the animation, load the required image in higher quality.  So there are two problems. <br><br>  To solve the first one, it would be possible to manually cache the image on a disk or transfer its address in the parameter of the second Activity.  However, the solution to this problem was shifted to the library used in the application for downloading images - Glide.  When loading an image, simply add the diskCacheStrategy parameter (DiskCacheStrategy.SOURCE), and it will be cached by the library itself (relevant for Glide version 3.x).  Therefore, when re-accessing this resource from the second Activity, the cached file will be used, which will help us to avoid the blinking of the animated ImageView. <br><br>  The second problem is also solved quite simply.  While the transition is being animated, the user profile along with the avatar in higher resolution are downloaded from the network and await its completion.  As soon as both conditions are fulfilled (completion of the animation and completion of the download), the user's avatar is updated.  You can achieve this behavior by using a special Listener, which implements callbacks that are called when the animation status changes.  To do this, in the Fragment, which belongs to the second Activity, we define this Listener: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onViewCreated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view, @Nullable Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onViewCreated(view, savedInstanceState); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (android.os.Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP_MR1) { getActivity().getWindow().getSharedElementEnterTransition() .addListener(mEnterTransitionListener); } setAvatar(); }</code> </pre><br>  Here the following happens: <br><br><ol><li>  Using getSharedElementEnterTransition (). AddListener () sets the Listener to animate the appearance of the Activity; </li><li>  In the setAvatar () method, an attempt is made to download and install an avatar (which is already in the cache). </li></ol><br>  Consider exactly how the Listener is implemented: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Transition.TransitionListener mEnterTransitionListener = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Transition.TransitionListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTransitionStart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Transition transition)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTransitionEnd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Transition transition)</span></span></span><span class="hljs-function"> </span></span>{ onProfileUpdated(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTransitionCancel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Transition transition)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTransitionPause</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Transition transition)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTransitionResume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Transition transition)</span></span></span><span class="hljs-function"> </span></span>{ } };</code> </pre><br>  In the onProfileUpdated () method, we update the profile content, incl.  and avatar. <br><br>  It is worth mentioning separately the case when the common element goes off the screen.  Its peculiarity is that, contrary to (and maybe according to) logic, the transition animation will still be completed and will look quite funny (Fig. 4). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1e/ce/cn/1ececnhsfcznnwh9jbgq77b6em8.gif" alt="image" width="384" height="541"></div><br>  <i>Fig.</i>  <i>4. Animation of the return from the profile in the comments</i> <br><br>  To avoid such behavior, it is enough to expose it to a view that is different from View.VISIBLE when the common element leaves the screen. <br><br>  In general, we can say that the Transitions Framework is a simple and powerful tool for creating animations.  It is not limited to animations of the transition between the Activity - the article was considered only a special case of its use.  It is also worth noting that in addition to the provided transformations, there is an opportunity to create your own, but this is a completely different story, worthy of a separate post. <br><br>  PS And how you came up with animations for iFunny, you can read <a href="https://habrahabr.ru/company/funcorp/blog/350106/">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/350662/">https://habr.com/ru/post/350662/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350648/index.html">Creating and hosting a telegram bot. From A to Z</a></li>
<li><a href="../350654/index.html">Interview on Data Science: what is expected of you</a></li>
<li><a href="../350656/index.html">ASC scenario as the basis of timeliness and harmony in business</a></li>
<li><a href="../350658/index.html">CSS weirdness to know about</a></li>
<li><a href="../350660/index.html">GitLab 10.5 released: integration with Let's Encrypt, Gemnasium dependency checks and external CI / CD files</a></li>
<li><a href="../350664/index.html">About the book "Ensuring the safety of automated process control systems in accordance with modern standards"</a></li>
<li><a href="../350666/index.html">MathOps or math in monitoring</a></li>
<li><a href="../350668/index.html">R means regression</a></li>
<li><a href="../350670/index.html">The second wave: who will have to go to the online box office this summer</a></li>
<li><a href="../350672/index.html">9 best books about IT and programming that you might have missed</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>