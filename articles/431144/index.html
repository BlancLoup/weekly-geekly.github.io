<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Far Fields mic (Mic array) - the inconspicuous hero in the smart column</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I want to talk about my long-time passion - to study and work with far fields mic (mic array) - arrays of microphones. 


 The article...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Far Fields mic (Mic array) - the inconspicuous hero in the smart column</h1><div class="post__text post__text-html js-mediator-article"><p>  In this article I want to talk about my long-time passion - to study and work with far fields mic (mic array) - arrays of microphones. </p><br><p>  The article will be interesting to the keen construction of their voice assistants, she will answer some questions for people who perceive engineering as an art, and also for those who want to try themselves in the role of Q ( <a href="https://ru.wikipedia.org/wiki/Q_(%25D0%25B1%25D0%25BE%25D0%25BD%25D0%25B4%25D0%25B8%25D0%25B0%25D0%25BD%25D0%25B0)">This is from Bond</a> ).  My humble story, I hope, may help you to understand why a clever speaker-assistant, made strictly according to the tutorial, works well only if there is a complete absence of noise.  And so bad where they are, for example in the kitchen. </p><a name="habracut"></a><br><p>  Many years ago I became interested in programming, I started writing code simply because wise teachers only allowed me to play games written by myself.  It was in the year 87 and it was the Yamaha MSX.  On this topic at the same time was the first startup.  Everything is strictly according to wisdom: ‚ÄúChoose a job you like, and you will not have to work a single day in your life‚Äù (Confucius). </p><br><p>  And so years have passed, and I'm still writing code.  Even a hobby with a code - well, except for roller skating, to warm up the brain and "I will not forget matane" is working with Far Fields mic (Mic array).  In vain that the teachers spent time with me. </p><br><h2 id="chto-eto-takoe-i-gde-primenyaetsya">  What it is and where it applies </h2><br><p>  In the voice assistant that listens to you, there is usually an array of microphones.  We also find them in video conferencing systems.  With collective communication, the lion's share of attention is paid to speech, we naturally, not constantly when we communicate, look at the speaker, and speaking exactly into a microphone or a headset, it is embarrassing and inconvenient. </p><br><p>  Practically everyone, a cell phone manufacturer who respects a client, uses 2 or more microphones in his creations (yes, yes, behind these holes are microphones above, below, behind).  For example, in the iPhone 3G / 3GS it was the only one, in the fourth generation of iPhones there were two, and in the fifth there were already three microphones.  In general, this is also an array of microphones.  And all this for better hearing of sound. </p><br><p>  But back to our voice assistants. </p><br><h3 id="kak-zhe-uvelichit-dalnost-slyshaniya">  How to increase the range of hearing? </h3><br><h4 id="nuzhny-bolshie-ushi">  "need big ears" </h4><br><p>  A simple idea: if in order to hear someone nearby, one microphone is enough, then in order to hear from afar, you need to use a more expensive microphone with a reflector, similar to the ears of chanterelles: </p><br><img src="https://habrastorage.org/webt/n4/6c/i4/n46ci4cfgtfn1sus-m_m_6qt6ws.png"><br><p>  (Wikipedia) </p><br><img src="https://habrastorage.org/webt/du/zt/mb/duztmby8-dps1vjtpflkaochefe.png"><br><img src="https://habrastorage.org/webt/f3/fl/eq/f3fleqvl5gtri_ljmnoclyynrse.png"><br><p><img src="https://habrastorage.org/webt/x-/pu/nt/x-puntqkk_bmovz1vqlfotnee84.png">  In fact, this is not part of the furry suite, but a serious device for hunters and scouts. </p><br><img src="https://habrastorage.org/webt/sk/jp/fd/skjpfdxya5tgyfli1zxvslf3z4q.png"><br><p>  The same, only on resonator tubes </p><br><img src="https://habrastorage.org/webt/aj/xr/xf/ajxrxfklujnfm8wdob8ugkywqb0.png"><br><p>  In the habitat. </p><br><p>  (Taken from <a href="https://forum.guns.ru/forum_light_message/14/698118.html">https://forum.guns.ru</a> ) </p><br><img src="https://habrastorage.org/webt/vi/ej/bb/viejbbq5sja2nm_zzgfzuwung6c.png"><br><p>  Diameter of a mirror is from 200 mm to 1,5m </p><br><p>  (for more, see <a href="http://elektronicspy.narod.ru/next.html">http://elektronicspy.narod.ru/next.html</a> ) </p><br><h4 id="nuzhno-bolshe-mikrofonov">  <strong>"Need more microphones"</strong> </h4><br><p>  Or maybe, if you put a lot of cheap microphones, then the quantity goes into quality and everything will work out?  <a href="http://lurkmore.to/Zerg_rush">Zerg-rush</a> microphones only. </p><br><p>  Strange, but it works in real life.  True with a lot of matane, but it works.  And we will tell about it in the next section. </p><br><h3 id="a-kak-nauchitsya-slyshat-dalshe-bez-krasivyh-ruporov">  And how to learn to hear on without beautiful horns? </h3><br><p><img src="https://habrastorage.org/webt/yp/_l/q4/yp_lq4rmzabti3m2heatymgf8ae.gif"></p><br><p>  One of the problems of the horn systems is that it is well heard that is in focus.  But if you need to hear something from another direction, then you need to make "feint ears" and physically retarget the system in another direction. </p><br><p>  And about the signal-to-noise ratio of systems with microphone arrays is somehow better compared to a conventional microphone. </p><br><p>  In arrays of microphones, as in their closest relatives - HEADLIGHTS (phased antenna arrays), nothing needs to be turned.  Read more in the Beamforming section.  Easy to see: </p><br><p><img src="https://habrastorage.org/webt/nm/ly/sa/nmlysaxcgc3jb5-t7nfauhkpfmo.png"></p><br><p>  Unfocused microphone (left picture) records all sounds from all directions, and not just what you need. </p><br><p>  Where does the long range come from?  In the right picture, the microphone attentively listens to only one source.  As if focusing, it receives a signal only from the chosen source, and not porridge from possible sources of noise, and simply amplify the clean signal (turn it up) without using complicated noise reduction techniques.  Approximately like a shout, but on a matan-colored joint. </p><br><h3 id="chto-zhe-ne-tak-s-shumopodavleniem">  What is wrong with noise cancellation? </h3><br><p>  The use of complex noise cancellation of a lot of flaws means that a part of the signal will leave, along with a part of the signal the sound will change, and to the ear it looks like a characteristic coloring of the sound with a noise and as a result promiscuity.  This promiscuity is visible to Russian-speaking people who want to hear from the interlocutor these sizzling ones.  Well, and additionally - as a result of noise cancellation, the listener does not hear any identifying signals at all connecting him with the interlocutor (breathing, sniffling and other noises accompanying live speech).  This creates some problems, because in colloquial speech this is all audible, and just helps to assess the state and attitude of the interlocutor to you.  The absence of them (noise) while we hear the voice causes discomfort and reduces the level of perception, understanding and identification.  Well, if you are listening to the voice assistant - noise reduction makes it difficult to recognize both the key phrase and the speech after.  True, there is a life hack - the discriminator needs to be trained on a sample recorded with account of the distortions from the noise reduction used. </p><br><p>  Those who are familiar with the words cocktail party problem can still go for a coffee or a cocktail, and conduct a field experiment, those who read the mood, continue on. </p><br><p><img src="https://habrastorage.org/webt/sa/hd/ly/sahdly7apjsfjajfn5bohw-t6sa.gif"></p><br><h3 id="kratko-o-matane-na-kotorom-ono-rabotaet">  Briefly about matane, on which it works: </h3><br><h3 id="doa-estimation-opredelenie-napravleniya-na-istochnik-zvuka-i-formirovanie-lucha-beamforming">  DOA Estimation (determining the direction to the sound source) and beam forming (beamforming) </h3><br><p>  DOA (determining the direction, and if possible, and localization to the source): <br>  I will be brief, because the topic is very extensive, it is done with the help of white, gray or dark magic (depending on the preferred topic in the IDE) and matan. <del>  main </del>  A frequent way to play DOA is to analyze correlations and other differences between pairs of microphones (usually opposite in diameter). <br>  Layfkhak: for research it is better to choose an array with a circular arrangement of microphones.  Benefit - it is easy to collect statistics from pairs with different distances between microphones - maximum diameter, and to minimum between microphones - if you take pairs along the chords, and with different azimuths (directions) to the source. </p><br><p>  Beam Formation- The easiest and easiest to understand way is Delay &amp; Sum (DAS and FDAS) ‚Äîbeam based on delay and summation. </p><br><p>  For visuals: </p><br><p><img src="https://habrastorage.org/webt/w2/fm/lb/w2fmlbbo7folyf-aa4kstft20i4.png"></p><br><p>  (Taken from <a href="http://www.labbookpages.co.uk/audio/beamforming/delaySum.html">http://www.labbookpages.co.uk/audio/beamforming/delaySum.html</a> ) </p><br><p>  Life hacking: Do not forget about the different wavelengths and for each frequency we calculate our phase difference tn </p><br><p>  An approximate radiation pattern will look something like this. </p><br><p><img src="https://habrastorage.org/webt/-1/ac/kw/-1ackwkldx2wblh5boqbilogdda.png"></p><br><p>  <a href="http://www.labbookpages.co.uk/audio/beamforming/delaySum.html">More and with formulas</a> </p><br><p>  Those who have not forgotten how to smoke matan can take part in JIO-RLS (Joint Iterative Subspace Adaptive Reduced-rank least squares).  Much like the taste of gradient descent, you know. </p><br><p><img src="https://habrastorage.org/webt/cr/bz/ym/crbzym7aqwwaf_ccmi_mslwzat4.gif"></p><br><p>  So we summarize: using conventional methods, it is difficult to achieve quality comparable to a matrix microphone.  After applying the definition of direction to the source, and as a result of this, we hear only the source that is needed, we get rid of the noise and reverberation of the medium, even that which is poorly audible (Haas effect). </p><br><h2 id="golosovoy-pomoschnik----kak-eto-vyglyadit-iznutri">  Voice Assistant - how it looks from the inside </h2><br><p>  So, what does the sound processing circuitry look like for the experienced voice assistant: </p><br><p><img src="https://habrastorage.org/webt/9l/fl/wu/9lflwu-ld6wv_qpnoyzducttxpg.png"></p><br><p>  The signal from the microphone array goes to the device in which we form a beam to the sound source (beamforming), thereby removing the interference.  Then we begin to recognize the sound of this beam, usually it is not enough for the qualitative recognition of the device‚Äôs resources, and most often the signal goes to the cloud for recognition (Microsoft, Google, Amazon). </p><br><p>  <em>Attentive reader will note: And in the picture with the description there is some kind of square Word not, and why did not immediately recognize it, as promised?</em> </p><br><p><img src="https://habrastorage.org/webt/eu/ie/v6/euiev6llmuxnvcrokz6fhlqij9w.png"></p><br><p>  Why on the diagram this one is probably an extra square? </p><br><p>  And because constantly broadcast the signal from all sources of noise to the Internet for <del>  listening </del>  Recognition of any resources is not enough.  Therefore, we begin to recognize only when we realized that they really wanted this from us - and for this they said a special spell - ok Google, Siri or Alex, well, or they called Kortan.  A classifier Music Word - most often neuronka and works directly on the device.  In the construction of the classifier there are also many interesting things, but today is not about that. </p><br><p>  And in fact, the scheme looks like this: </p><br><p><img src="https://habrastorage.org/webt/g8/wd/8-/g8wd8-hpfrrorfovk8srldmxiay.png"><br>  (my doodles) </p><br><p>  Several rays can be formed at different signal sources, and we are looking for a special word in each of them.  But we will process further the one who said the right word. </p><br><p>  The next stage is recognition in the cloud, it has been repeatedly covered on the Internet, there are many tutorials on it. </p><br><h2 id="kak-vy-mozhete-priobschitsya-k-etomu-prazdniku-matana">  How can you join this holiday Matana </h2><br><p>  The easiest way to buy a dev board.  Overview of existing devbord: one of the most complete - <a href="https://developer.amazon.com/alexa-voice-service/dev-kits">by reference</a> . </p><br><p>  Most friendly for beginners: </p><br><p>  <a href="https://www.seeedstudio.com/ReSpeaker-4-Mic-Array-for-Raspberry-Pi-p-2941.html">https://www.seeedstudio.com/ReSpeaker-4-Mic-Array-for-Raspberry-Pi-p-2941.html</a> </p><br><p>  <a href="https://www.seeedstudio.com/ReSpeaker-Mic-Array-v2-0-p-3053.html">https://www.seeedstudio.com/ReSpeaker-Mic-Array-v2-0-p-3053.html</a> </p><br><p>  based on XMOS XVF-3000. </p><br><p>  <a href="https://www.matrix.one/products/voice">I apply myself</a> </p><br><p>  Made as I like it - an open interface FPGA controls the microphones of the matrix, communicating with it via SDA. </p><br><h2 id="moi-podvigi-po-skreschivaniyu-android-things--i-mic-array">  My feats of crossing the Android Things and Mic Array: </h2><br><p>  Of course, there are quite a few examples for this board (Voice), but it‚Äôs just convenient for me to use it under Things. </p><br><p>  Arguments for Things: </p><br><p>  You can build a flexible and powerful tool: </p><br><ul><li>  convenient that you can use the screen as a separate device </li><li>  can be used as a headless device, i.e. make a transfer over the network (create api for transfer to another device) </li><li>  convenient debugging </li><li>  many libraries, including for transmission over the network; </li><li>  tools for analysis - a lot. </li><li>  and if it seemed a little, it is possible to connect the Sishny libraries </li></ul><br><p>  For example, I use: </p><br><ul><li>  sound file analysis </li><li>  HRTF, </li><li>  Training \ building classifiers. </li></ul><br><p>  And then if you have to port / rewrite the code to some embed, then how easy it is to do it with Java code. </p><br><p>  Unfortunately, the example from the authors of the board for Things was a bit inoperative, so I made <a href="https://github.com/NickZt/MATRIX-Voice-with-Android-Things">my demo project</a> (of course, I can). </p><br><p>  In short, what is there - all the black magic on quick interrogation of microphones, FFT do in C ++, and visualization, analysis, network interaction - in Java. </p><br><h3 id="plany-na-buduschee-razvitie">  Future development plans </h3><br><p>  The source of the plans and at the same time inspiration: <a href="https://github.com/introlab/odas">ODAS</a> . </p><br><p><img src="https://habrastorage.org/webt/hz/sb/tt/hzsbttxtachko2zc7lnoq8ezqm0.png"></p><br><p>  I just want to do the same, only on Things and without glitches. </p><br><ul><li>  Because ODAS is a little awkward to use. </li><li>  I need a normal tool for work </li><li>  Because I can and I like this topic. </li><li>  Used hardware and software meet the complexity of the problem. </li></ul><br><p>  My plans <a href="https://github.com/NickZt/MATRIX-Voice-with-Android-Things">are based on this (my) repository</a> . </p><br><p>  And remind </p><br><p>  "If you have something to supplement or criticize, feel free to write about it in the comments, because one head is worse than two, two are worse than three, and n-1 is worse than n" <a href="https://habr.com/users/nikitasius/">nikitasius</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/431144/">https://habr.com/ru/post/431144/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../431134/index.html">SIP phone on STM32F7-Discovery</a></li>
<li><a href="../431136/index.html">Is a weightless terabyte in your pocket - is the future already here? Exploring HyperX SAVAGE EXO</a></li>
<li><a href="../431138/index.html">Biometrics with Rostelecom Key: how for the first time the FSB launched Russian cryptography into application stores</a></li>
<li><a href="../431140/index.html">Report from the ‚ÄúGo in production‚Äù mitap: video, photo, presentation</a></li>
<li><a href="../431142/index.html">How to run SQL Profiler Trace at night, at a specific time?</a></li>
<li><a href="../431146/index.html">1. Check Point Log Analysis: The Official Check Point App for Splunk</a></li>
<li><a href="../431148/index.html">The New iOS Mobile Enterprise. Part # 1: Resource Code Generation</a></li>
<li><a href="../431152/index.html">Metro 4 - a path length of 6 years. A brief history of Metro UI CSS</a></li>
<li><a href="../431154/index.html">Flaws in the Fallout 76 quests allowed players to arrange a nuclear hell</a></li>
<li><a href="../431156/index.html">SHOCK! New phishing software wins second factor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>