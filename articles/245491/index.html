<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Python Memory and Numbers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, All. 

 Previously, I worked with C-like languages, but now I had to sit down at Python. The syntax was easy, and the turn came tricky questions. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Python Memory and Numbers</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/1db/618/216/1db618216e1e4813bdb50e4e10d15d07.png" align="left" height="100">  Hi, All. <br><br>  Previously, I worked with C-like languages, but now I had to sit down at Python.  The syntax was easy, and the turn came tricky questions.  Under the cut - an article about how in Python data storage in memory is implemented.  I do not pretend to be true, but I try to figure it out. <br><a name="habracut"></a><br><h4>  We look at the links </h4><br>  Let's start with the simplest.  Any data in Python is an object, any variable is a reference to an object.  There is no data that is not an object.  To begin with, we need to learn how to determine whether two ‚Äúidentical‚Äù objects are the same.  This requires getting an address, which is easily done by the built-in function id ().  We try: <br><br><pre><code class="python hljs">print(id(<span class="hljs-number"><span class="hljs-number">0</span></span>))</code> </pre> <br>  As expected, something unintelligible is displayed.  A large number, probably an address.  But if each number used throughout to store in memory, then no memory, of course, is not enough.  A short experiment is being conducted: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="python hljs">print(id(<span class="hljs-number"><span class="hljs-number">0</span></span>)) print(id(<span class="hljs-number"><span class="hljs-number">0</span></span>))</code> </pre><br>  Two absolutely identical numbers.  Therefore, all constant numbers are actually stored in memory without duplication.  It is logical - Python has so low performance, such a trick allows you to save its last remnants.  OK, let's try to fill all the memory with a huge array of zeros. <br><br><pre> <code class="python hljs">a = [<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: a += [<span class="hljs-number"><span class="hljs-number">0</span></span>]</code> </pre><br>  The infinite loop, as expected, runs infinitely, but practically does not require memory.  Another experiment: <br><br><pre> <code class="python hljs">a = [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] print(id(a[<span class="hljs-number"><span class="hljs-number">0</span></span>])) print(id(a[<span class="hljs-number"><span class="hljs-number">1</span></span>]))</code> </pre><br>  Well, yes, the same number.  Rather, to confirm I conduct the same check with two different variables - the same number, and yes even equal to id (0).  That is, an algorithm, apparently this: when we change the value of a variable, we check if there is the same in the memory, and, if there is, redirect the link to it.  This behavior is required, obviously, because the object occupies quite a lot of space in memory, and to be more compact, Python makes the most of existing objects.  In order not to overload the article with code, I will say that for strings (including those obtained through a slice), logical objects and even arrays it works the same way.  Let's make a second attempt to take all memory with Python: <br><br><pre> <code class="python hljs">i = <span class="hljs-number"><span class="hljs-number">0</span></span> a = [<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: a += [a[i]] i += <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  Success!  Memory consumption is constantly increasing.  We make the first conclusion: <br>  1. Any data in Python is objects. <br>  2. If objects are "the same", then they are stored at the same address in memory.  In other words, a == b and id (a) == id (b) are equivalent statements. <br>  3. More complex optimization is not used - a rather simple dependence in the array is no longer optimized in any way (only the rule ‚Äúa [i] = i‚Äù).  However, I would be surprised if I was used: rather complex lexical analysis is already required, which Python with its step-by-step interpretation cannot afford. <br><h4>  We consider links </h4><br>  Disclaimer: We will now work in Python's interactive mode.  In order to count object references there is a function sys.getrefcount ().  Import sys: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys</code> </pre><br>  And for a start, we need to determine how real the data it gives is: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>sys.getrefcount(<span class="hljs-string"><span class="hljs-string">'There is no this string in Python'</span></span>) <span class="hljs-number"><span class="hljs-number">3</span></span> &gt;&gt;&gt; sys.getrefcount(<span class="hljs-string"><span class="hljs-string">'9695c3716e3b801367b7eca6a3281ac9'</span></span>) <span class="hljs-comment"><span class="hljs-comment">#md5- 512    /dev/urandom. 3 &gt;&gt;&gt; a = 'More random for the random god!' &gt;&gt;&gt; sys.getrefcount(a) 2 &gt;&gt;&gt; a = 0 &gt;&gt;&gt; sys.getrefcount(a) 434 &gt;&gt;&gt; sys.getrefcount(0) 436</span></span></code> </pre><br>  This tells us about one funny thing: considering the links, getrefcount () creates them himself.  As we see, for constants it creates two of them (really two, I tried on large amounts of input data that I don‚Äôt publish here as unnecessary), so we can just subtract 2. Actually, apparently for variables, he also creates two , but does not take into account the variable itself.  Well, the deviations of the results from reality, we figured out.  Now a few examples: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>sys.getrefcount(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">754</span></span> &gt;&gt;&gt; sys.getrefcount(<span class="hljs-number"><span class="hljs-number">65</span></span>) <span class="hljs-number"><span class="hljs-number">13</span></span> &gt;&gt;&gt; sys.getrefcount(<span class="hljs-number"><span class="hljs-number">67</span></span>) <span class="hljs-number"><span class="hljs-number">11</span></span> &gt;&gt;&gt; sys.getrefcount(<span class="hljs-string"><span class="hljs-string">'A'</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> &gt;&gt;&gt; sys.getrefcount(<span class="hljs-string"><span class="hljs-string">'a'</span></span>) <span class="hljs-number"><span class="hljs-number">6</span></span> &gt;&gt;&gt; sys.getrefcount(<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) <span class="hljs-number"><span class="hljs-number">100</span></span> &gt;&gt;&gt; sys.getrefcount(<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-number"><span class="hljs-number">101</span></span> <span class="hljs-comment"><span class="hljs-comment">#  !</span></span></code> </pre><br>  Why do pointers suddenly appear out of the blue (a total of 751 pieces for a unit)?  Because this function considers C-shny pointers, that is, includes those that are used in the code of Python itself.  In fact, we brazenly break into that part of Python that developers are trying to hide from us. <br><br>  Well, here's a backstage for Python.  If my hands reach and I can manage, I will write about what happens if I try to change these objects manually through OllyDbg, for example. </div><p>Source: <a href="https://habr.com/ru/post/245491/">https://habr.com/ru/post/245491/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245477/index.html">Keeping independent time on android device</a></li>
<li><a href="../245481/index.html">Development of interactive systems on OpenFrameworks: Interactive Sound</a></li>
<li><a href="../245485/index.html">Microsoft and Adobe released a set of updates, December 2014</a></li>
<li><a href="../245487/index.html">Simple event system - non-standard approach</a></li>
<li><a href="../245489/index.html">Occlusion Culling and LOD for Unity Indie</a></li>
<li><a href="../245493/index.html">SED: There are contraindications</a></li>
<li><a href="../245497/index.html">Algorithm TILT or non-standard use of the rank of the matrix</a></li>
<li><a href="../245503/index.html">Concurrent programming with CUDA. Part 1: Introduction</a></li>
<li><a href="../245505/index.html">How to independently register Ltd.</a></li>
<li><a href="../245507/index.html">ASH Viewer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>