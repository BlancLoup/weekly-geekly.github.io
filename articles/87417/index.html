<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP5. "Secure Templates"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Historically, I do not use external template engines such as Smarty or others. I use the main ‚Äúactive‚Äù template, i.e. just a PHP file in which data fo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHP5. "Secure Templates"</h1><div class="post__text post__text-html js-mediator-article">  Historically, I do not use external template engines such as Smarty or others.  I use the main ‚Äúactive‚Äù template, i.e.  just a PHP file in which data for content zones are called and inserted as plain HTML (how it is generated in this case does not matter).  In the previous version of CMS, which was not ‚Äúboxed‚Äù and in which there was virtually no separation of user rights, this aspect did not particularly strain - access to the template was either ‚Äúdirect‚Äù (ftp, etc.) or through the administrator interface for the administrator.  But, accordingly, a person with access to the admin panel could cram any php code inside this file.  In the new version of CMS this is unacceptable, because  this is actually a detour of rights.  Therefore, it was decided to abandon such "unsafe" patterns. <br><a name="habracut"></a><br>  In search of the simplest and most elegant way out, using minimal ‚Äúexternal‚Äù solutions, I remembered one remarkable feature of the PHP XSLT processor ( <a href="http://ru2.php.net/manual/en/class.xsltprocessor.php">XSLTProcessor</a> ).  Namely, the use of PHP functions in transformations, while you can limit the list of these functions.  And this is exactly what is needed. <br><br>  Let us turn to examples. <br><br>  The standard ‚Äúactive‚Äù pattern looked like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;?</font> <font color="#800000">php</font> &lt;br&gt;$ <font color="#ff0000">main_ctx</font> = <font color="#ff0000">CMSContentObj::getInstance</font> () <font color="#ff0000">-</font> <font color="#0000ff">&gt;</font> getData("main_ctx");&lt;br&gt;$title = CMSContentObj::getInstance()- <font color="#0000ff">&gt;</font> getTitle();&lt;br&gt;//    &lt;br&gt;? <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">head</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">meta</font> <font color="#ff0000">content</font> <font color="#0000ff">="text/html; charset=utf-8"</font> <font color="#ff0000">http-equiv</font> <font color="#0000ff">="Content-Type"</font> <font color="#0000ff">/&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">title</font> <font color="#0000ff">&gt;&lt;?</font> =$title;? <font color="#0000ff">&gt;</font> - mysite.ru <font color="#0000ff">&lt;/</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">link</font> <font color="#ff0000">href</font> <font color="#0000ff">="/_css/main.css"</font> <font color="#ff0000">rel</font> <font color="#0000ff">="stylesheet"</font> <font color="#ff0000">type</font> <font color="#0000ff">="text/css"</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">script</font> <font color="#ff0000">type</font> <font color="#0000ff">="text/javascript"</font> <font color="#ff0000">src</font> <font color="#0000ff">="/_js/jquery.js"</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">script</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">head</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> &lt;br&gt;‚Ä¶&lt;br&gt; <font color="#0000ff">&lt;?</font> =$main_ctx;? <font color="#0000ff">&gt;</font> &lt;br&gt;‚Ä¶&lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font> &lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Those.  just the HTML data is pulled from the content and inserted into the HTML code. <br><br>  In the case of XSL, the template looks like this: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;?</font> <font color="#800000">xml</font> <font color="#ff0000">version</font> <font color="#0000ff">="1.0"</font> <font color="#ff0000">encoding</font> <font color="#0000ff">="utf-8"</font> ? <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">xsl:stylesheet</font> <font color="#ff0000">version</font> <font color="#0000ff">="1.0"</font> <font color="#ff0000">xmlns:xsl</font> <font color="#0000ff">="http://www.w3.org/1999/XSL/Transform"</font> <font color="#ff0000">xmlns:php</font> <font color="#0000ff">="http://php.net/xsl"</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">xsl:output</font> <font color="#ff0000">encoding</font> <font color="#0000ff">="utf-8"</font> <font color="#ff0000">indent</font> <font color="#0000ff">="yes"</font> <font color="#ff0000">method</font> <font color="#0000ff">="html"</font> <font color="#0000ff">/&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">xsl:template</font> <font color="#ff0000">match</font> <font color="#0000ff">="/page"</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font>&lt;!--</font> &lt;br&gt; <font>Variables</font> &lt;br&gt; <font>--&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">xsl:variable</font> <font color="#ff0000">name</font> <font color="#0000ff">="title"</font> <font color="#ff0000">select</font> <font color="#0000ff">="php:function('CMSStaticContent::getTitle')"</font> <font color="#0000ff">/&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">xsl:variable</font> <font color="#ff0000">name</font> <font color="#0000ff">="main_ctx"</font> <font color="#ff0000">select</font> <font color="#0000ff">="php:function('CMSStaticContent::getData','main_ctx')"</font> <font color="#0000ff">/&gt;</font> &lt;br&gt; <font>&lt;!--</font> &lt;br&gt; <font>/ Variables</font> &lt;br&gt; <font>--&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">head</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">meta</font> <font color="#ff0000">content</font> <font color="#0000ff">="text/html; charset=utf-8"</font> <font color="#ff0000">http-equiv</font> <font color="#0000ff">="Content-Type"</font> <font color="#0000ff">/&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">title</font> <font color="#0000ff">&gt;&lt;</font> <font color="#800000">xsl:value-of</font> <font color="#ff0000">disable-output-escaping</font> <font color="#0000ff">="yes"</font> <font color="#ff0000">select</font> <font color="#0000ff">="$title"</font> <font color="#0000ff">/&gt;</font> - mysite.ru <font color="#0000ff">&lt;/</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">link</font> <font color="#ff0000">href</font> <font color="#0000ff">="/_css/main.css"</font> <font color="#ff0000">rel</font> <font color="#0000ff">="stylesheet"</font> <font color="#ff0000">type</font> <font color="#0000ff">="text/css"</font> <font color="#0000ff">/&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">script</font> <font color="#ff0000">type</font> <font color="#0000ff">="text/javascript"</font> <font color="#ff0000">src</font> <font color="#0000ff">="/_js/jquery.js"</font> <font color="#0000ff">/&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">head</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> &lt;br&gt;        ‚Ä¶&lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">xsl:value-of</font> <font color="#ff0000">disable-output-escaping</font> <font color="#0000ff">="yes"</font> <font color="#ff0000">select</font> <font color="#0000ff">="$main_ctx"</font> <font color="#0000ff">/&gt;</font> &lt;br&gt;        ‚Ä¶&lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">xsl:template</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">xsl:stylesheet</font> <font color="#0000ff">&gt;</font> &lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Isn't it true? <br><br>  LS: For some reason, I could not use constructions like CMSContentObj :: getInstance () -&gt; getTitle (), so I had to create an intermediate class CMSStaticContent ‚Äúon my lap‚Äù: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">class</font> CMSStaticContent {&lt;br&gt; <font color="#0000ff">public</font> <font color="#0000ff">static</font> function __callStatic($name, $arguments) {&lt;br&gt;    $cms = CMSContentObj::getInstance();&lt;br&gt; <font color="#0000ff">if</font> (method_exists($cms, $name)) {&lt;br&gt; <font color="#0000ff">return</font> call_user_func_array(array($cms, $name), $arguments);&lt;br&gt;    } <font color="#0000ff">else</font> {&lt;br&gt; <font color="#0000ff">throw</font> <font color="#0000ff">new</font> Exception();&lt;br&gt;    }&lt;br&gt;  }&lt;br&gt;}&lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Well, now it just remains to create an empty XML, register the functions and make the conversion, like this: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">$doc = <font color="#0000ff">new</font> DOMDocument();&lt;br&gt;$doc-&gt;loadXML( <font color="#A31515">'&lt;page/&gt;'</font> );&lt;br&gt;$xsl = <font color="#0000ff">new</font> DOMDocument();&lt;br&gt;$xsl-&gt;load($xsl_template);&lt;br&gt;$proc = <font color="#0000ff">new</font> XSLTProcessor();&lt;br&gt;$proc-&gt;registerPHPFunctions(array('CMSStaticContent::getData', 'CMSStaticContent::getTitle'));&lt;br&gt;$proc-&gt;importStyleSheet($xsl);&lt;br&gt;echo $proc-&gt;transformToXML($doc);&lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Well, actually, that's all.  We have limited PHP functions that can be performed during conversion, and through such a template it is impossible to have access to the system. <br><br>  PS: And no external template engines. </div><p>Source: <a href="https://habr.com/ru/post/87417/">https://habr.com/ru/post/87417/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../87409/index.html">Hello world</a></li>
<li><a href="../87411/index.html">Attention,% username%, MTS raised the price of GPRS traffic on archival rates!</a></li>
<li><a href="../87412/index.html">Eldorado has gained 1.6 billion rubles</a></li>
<li><a href="../87413/index.html">A way to view HTML5 videos from Firefox</a></li>
<li><a href="../87414/index.html">E-government chimera</a></li>
<li><a href="../87418/index.html">-What is the strength in, brother? Power - in the blog!</a></li>
<li><a href="../87419/index.html">Minor update for T-Mobile G1 - DMD64</a></li>
<li><a href="../87421/index.html">HOW-TO pptpd + freeradius2 + mysql + abills 0.50b for a small office or small provider on Ubuntu 9.10 / 10.04</a></li>
<li><a href="../87424/index.html">ANDNA - Netsukuku Host Naming Service</a></li>
<li><a href="../87425/index.html">Andrey Ternovsky travels across the States</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>