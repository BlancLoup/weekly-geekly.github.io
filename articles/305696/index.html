<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Host an Azure cloud service on regular vds</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I am writing web projects in visual studio, and with each new version of the studio, it seems to be sharpened to work with Windows Azure. I like Azura...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Host an Azure cloud service on regular vds</h1><div class="post__text post__text-html js-mediator-article">  I am writing web projects in visual studio, and with each new version of the studio, it seems to be sharpened to work with Windows Azure.  I like Azura, although I only use a small set of options.  The main thing for me is Cloud service.  The cloud service is great for deploying a distributed server. <br><a name="habracut"></a><br>  So, I create a cloud service, in which I add one web role (IIS virtual machine), one worker (virtual machine without IIS) and a shared class library.  After publishing, my roles are assigned an ip-address and different ports.  That is, immediately there is a tcp network, manual settings are minimal and can be done in the studio itself.  You can, for example, make a public access point for a worker, but I do not need it.  My worker will be hidden from outside eyes and a wcf server will hang on it, and my roles will communicate over a fast local network. <br><br>  I bring general classes to the library (which I connect to all roles), for example, the interface and communication channel: <br><br><pre><code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ServiceContract</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IwcfChat</span></span> { [OperationContract] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendMessage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> userId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> userName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> text</span></span></span><span class="hljs-function">)</span></span>; [OperationContract] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetMessages</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> userId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> userName</span></span></span><span class="hljs-function">)</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//================ public sealed class wcfChat:IDisposable { IwcfChat _channel; ChannelFactory&lt;IwcfChat&gt; factory = null; public wcfChat() { NetTcpBinding b = new NetTcpBinding(); b.Security.Mode = SecurityMode.None; b.Security.Message.ClientCredentialType = MessageCredentialType.None; #if(DEBUG) EndpointAddress address = new EndpointAddress("net.tcp://127.255.0.1:9003/wcfChat"); #else EndpointAddress address = new EndpointAddress("net.tcp://"+spr.wcfIP+":9003/wcfChat"); #endif factory = new ChannelFactory&lt;IwcfChat&gt;(b, address); factory.Faulted += OnChannelFaulted; factory.Open(); } public IwcfChat channel { get { if (factory != null &amp;&amp; factory.State == CommunicationState.Opened) { if(_channel==null) _channel = factory.CreateChannel(); return _channel; } return null; } } void OnChannelFaulted(object sender, EventArgs e) { factory.Abort(); } public void Dispose() { factory.Close(); } }</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I call the methods in the web role like this: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> chat = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> wcfChat()) { res = chat.channel.SendMessage(id, name, text); }</code> </pre><br><br>  Accordingly, in the worker I have the implementation of methods from the interface (SendMessage, GetMessage), I will not paint them, as well as in the worker at startup, the code that makes it the host for wcf is executed: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//      ServicePointManager.DefaultConnectionLimit = 12; // Create the host ServiceHost host = new ServiceHost(typeof(wcfChat)); // Read config parameters string hostName = RoleEnvironment.CurrentRoleInstance.InstanceEndpoints["port"].IPEndpoint.Address.ToString(); // Create Metadata ServiceMetadataBehavior metadatabehavior = new ServiceMetadataBehavior(); host.Description.Behaviors.Add(metadatabehavior); Binding mexBinding = MetadataExchangeBindings.CreateMexTcpBinding(); string mexendpointurl = string.Format("net.tcp://{0}:{1}/wcfChatMetadata", hostName, 8003); host.AddServiceEndpoint(typeof(IMetadataExchange), mexBinding, mexendpointurl, new Uri(mexendpointurl)); // Create end point string endpointurl = string.Format("net.tcp://{0}:{1}/wcfChat", hostName, 9003); host.AddServiceEndpoint(typeof(IwcfChat), new NetTcpBinding(SecurityMode.None), endpointurl, new Uri(endpointurl)); // Open the host host.Open(); // Trace output Trace.WriteLine("WCF Listening At: " + endpointurl); Trace.WriteLine("WCF MetaData Listening At: " + mexendpointurl); return base.OnStart(); }</span></span></code> </pre><br>  Here I showed the methods of the string type, but the type of the return value can be absolutely any, for example, a complex class, which is described in my common library.  Everything, I have no other settings in web configuration, no packages in xml or SOAP.  There are no automatically generated contract files.  When I tried to do this, when searching for information about wcf on the Internet, the setting under http always pops up with all these packages / unpackings.  Yes, wcf technology was originally invented to connect heterogeneous systems where it is necessary to serialize and transmit as a string.  But if we have one programming language, and the client and wcf server are all our development, then there is no need to make a garden, everything works fine. <br><br>  Thus, I have a distributed server, for costly operations I do a separate worker, for example, chat is shown here.  All chat functions are moved to a separate virtual machine, and I can increase the performance of both the site (web role) and the chat itself. <br><br>  This architecture seems to me correct and can withstand a stronger load than a monolithic project.  All this is also being developed and debugged as one project in the studio, that is, when I call the wcf method, I can go deeper into the code in debugging, without messages like ‚ÄúI cannot debug inside, I don‚Äôt know what‚Äôs happening there, this is the result‚Äù . <br><br>  With Azurov tools it is done easily and simply, I run the entire project with one button and debug it using it as a single project.  I remember once a long time ago, on one of the projects there was a similar architecture, but I was young, and it was very difficult for me there: some facades, and if the parameters of the method changed, I made changes in four places. <br><br>  I need to do something similar on regular servers.  Not on their physical servers, but on vds / vps virtuals from some <u>necessarily Russian</u> hoster.  I found a fun technology from one of the hosters ( <a href="http://www.1gb.ru/dbb1190dcxvn">1gb.ru</a> ), called <a href="https://www.1gb.ru/services_wap.php">Windows Azure Pack / COSN resource</a> .  According to the description, this is a shortened version of Azura and everything would have to "fly up."  Of course, they have a trial period, I looked.  In the browser, the control is as if from the old version of the Azura portal (if anyone remembers). <br><img src="https://habrastorage.org/getpro/habr/comment_images/7a0/23d/45a/7a023d45aa0d7e23400e0b33e95d143c.png" alt="image"><br>  Of the possibilities there is only the creation of virtual machines, their integration into the network (manually), there is a service bus - that's all.  It is also not possible to download this subscription in the studio, and this is a lot of convenience.  Plus there is no possibility of creating a cloud service.  The description says that this ‚Äúprivate cloud‚Äù will be refined and complemented by features from the original Azura, but support said that everything has long been frozen, and in general, these are incompatible technologies (‚Äúthis Azure Pack is completely incompatible with this Azure. There that is, that is, and there is not enough. There are common ideas, but the implementation is completely different, the API is different, and so on. "(c)). <br>  In short - it does not fit. <br><br>  Looking further.  I run over screw hosts, looking for the possibility of renting regular vps / vds but with the ability to organize a local network between them.  Many simply do not have such an opportunity.  Yes, you can rent a virtual machine, pick up on it a VPN and another virtual machine to hook on to this network.  But such a ‚Äúlocal‚Äù network stretches over http, which is why it is obviously slower.  I already thought that I would not succeed, but at the <a href="https://1cloud.ru/ref/17233">1cloud</a> hoster <a href="https://1cloud.ru/ref/17233">I</a> see what I‚Äôm looking for: ‚ÄúJust in a couple of clicks, connect your virtual machines to a private network for free with 1 Gbit / s bandwidth.‚Äù in Moscow.  Support says that local networks with a bandwidth of 10 Gbit / s are deployed on the Moscow infrastructure. <br><br>  Great, we‚Äôll try to do the same as above, just for regular hosting. <br><br>  In the studio, we create a solution, I called it sharedTest, to which we add: <br>  1. MVC application with the same name. <br>  2. The windows class library, I just called Lib <br>  3. Console application windows, I called it worker <br><img src="https://habrastorage.org/getpro/habr/post_images/752/af9/85f/752af985f1ab5a17460f30f5908f1af1.png" alt="image"><br><br>  Next, you need to tie these projects together, for this we right-click on our solution and go to the properties <br><img src="https://habrastorage.org/getpro/habr/post_images/f41/eb8/2c1/f41eb82c11673aa2a38832165204eaa9.png" alt="image"><br>  Here it is necessary to select the item in the project being launched, that I have several ones being launched and my Worker to raise higher than the site. <br>  Immediately following property - the dependence of projects.  The library does not depend on anyone.  The sharedTest site depends on both the library and the worker.  A worker only depends on the library. <br><br>  Do not forget in the properties of the worker (also with the right button and properties) specify the object to be launched, so that the worker will start first and wait for no one. <br><img src="https://habrastorage.org/getpro/habr/post_images/b66/2a5/d9f/b662a5d9f8ba078d3ddb811ffca2aa4a.png" alt="image"><br><br>  The next step is adding dependencies.  In the Lib library, right-click links (Reference) -&gt; add a link ... and we will need the System.ServiceModel package.  We need the same package in the worker.  In the same way in the website and the worker we add a link to our library from the Lib project. <br><br>  The library is placed (conveniently with separate files) public interface IwcfChat and public sealed class wcfChat: IDisposable (my first listing is at the top).  Also there is a directory with general settings or structures, there I only have an ip address (from where I got it will be a little later). <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">spr</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> wcfIP = <span class="hljs-string"><span class="hljs-string">"10.0.0.6"</span></span>; }</code> </pre><br><br>  Let's make our worker a service host (similar to the top listing, just transferred to the Main function, since I have a console application) <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//      ServicePointManager.DefaultConnectionLimit = 12; // Create the host ServiceHost host = new ServiceHost(typeof(wcfChat)); // Read config parameters #if (DEBUG) string hostName = "127.255.0.1"; #else string hostName = spr.wcfIP; #endif // Create Metadata ServiceMetadataBehavior metadatabehavior = new ServiceMetadataBehavior(); host.Description.Behaviors.Add(metadatabehavior); Binding mexBinding = MetadataExchangeBindings.CreateMexTcpBinding(); string mexendpointurl = string.Format("net.tcp://{0}:{1}/wcfChatMetadata", hostName, 8003); host.AddServiceEndpoint(typeof(IMetadataExchange), mexBinding, mexendpointurl, new Uri(mexendpointurl)); // Create end point string endpointurl = string.Format("net.tcp://{0}:{1}/wcfChat", hostName, 9003); host.AddServiceEndpoint(typeof(IwcfChat), new NetTcpBinding(SecurityMode.None), endpointurl, new Uri(endpointurl)); // Open the host host.Open(); Console.WriteLine("Host opened on "+hostName); Console.ReadLine(); } }</span></span></code> </pre><br><br>  Ports 8003 and 9003 I took from my head, as long as they were not standard and were not busy. <br><br>  We add wcfChat class to the worker - implementation of our interface <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Lib; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Worker</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">wcfChat</span></span> : <span class="hljs-title"><span class="hljs-title">IwcfChat</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendMessage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> userId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> userName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> text</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Sending message...."</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetMessages</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> userId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> userName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Get messages"</span></span>; } } }</code> </pre><br><br>  There was nothing to paint here, but the values ‚Äã‚Äãcome.  It's time to try - we modify our Home controller and its presentation. <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isGet = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> res = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> chat = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> wcfChat()) { res = isGet ? chat.channel.GetMessages(<span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>) : chat.channel.SendMessage(<span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>, <span class="hljs-string"><span class="hljs-string">"text"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View((<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>)res); }</code> </pre><br><pre> <code class="html hljs xml">@model string @{ ViewBag.Title = "Home Page"; } <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>@Model<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  We start and see that everything works: <br><img src="https://habrastorage.org/getpro/habr/post_images/09f/494/bd9/09f494bd9f440d797990caad8f06f7ab.png" alt="image"><br><br>  Great, it remains quite a bit - put the project at the host, I remind you, I work with <a href="https://1cloud.ru/ref/17233">1cloud</a> .  We register, through the control panel we create two virtual machines of the configuration we need (I took the minimum ones in the Petersburg data center, but this doesn‚Äôt matter).  They have a test period of several hours, support extended to me upon request, and in general well done, they go forward. <br><img src="https://habrastorage.org/getpro/habr/post_images/be4/298/ca1/be4298ca11719fa67bbf38740f1c26a7.png" alt="image"><br><br>  Next, create a local network, also a couple of clicks, the second item from the control panel, I called it testLocal.  By the way, I turned off the dynamic IPs checkbox (DHCP), since my service depends on a static IP address, because of this I will have to tinker a bit more. <br><img src="https://habrastorage.org/getpro/habr/post_images/bee/1a9/337/bee1a933760deffedba400114d20af60.png" alt="image"><br><br>  After creation, everything is still in the control panel, we go to each server, go to the Settings tab, find the Private networks and check the box that we use the newly created network.  This flag will add us a new adapter and a new network inside the virtual machine.  In the same place, we get an internal IP address, I had it 10.0.0.5 and 10.0.0.6 for the site and the worker.  In order for the network to work, we climb over the remote desktop (RDP) to our virtual machines and manually drive these values ‚Äã‚Äãinto the network settings.  Instructions for those who do not understand, are there <a href="https://panel.1cloud.ru/help/Nastrojka_setevogo_adaptera_Windows">next</a> . <br><br>  I want to warn you that it did not work right away.  I indicated the networks as publicly available, so I had to redo them into private ones <a href="http://netmate.ru/blogs/moskalev/izmenenie-tipa-seti-v-windows-server-2012-i-windows-8.php">like this</a> .  And you also need to add my used ports to the firewall exceptions.  For this, I called the launch of the Win + R key and typed netsh.exe there <br>  after which the command line typed command <br><pre> <code class="bash hljs">firewall <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> portopening protocol = TCP port = 9003 name = myService mode = ENABLE scope = SUBNET profile = CURRENT</code> </pre><br><br>  Now I will tell about the publication.  I configured IIS for <a href="https://technet.microsoft.com/ru-ru/library/hh831475(v%3Dws.11).aspx">this manual</a> .  You can check the performance from the browser by external IP address.  Picture from IIS tells us that everything works. <br><img src="https://habrastorage.org/getpro/habr/post_images/512/ac8/207/512ac82077d986f2e4bd51e3b0b41e2e.png" alt="image"><br><br>  I did not do anything with ftp, nor, especially, with setting up publishing from a version control system, this is a topic for another article.  I corrected the aypishnik to the issued one, published my web application to the file system and threw my daddy C: \ inetpub \ wwwroot on the server into pens.  I updated the page and saw the expected error at Home / Index, as there was no service yet. <br><br>  Actually, I also published my worker to the file system, the installer turned out.  Here the only thing you need to not get confused with DEBUG / RELEASE.  I dragged the whole daddy to the desktop of the second virtual machine, installed it with the left mouse button and started it.  My black window came out, which said that the service was working.  We update the site, we see that everything was successful. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ddb/6d4/af0/ddb6d4af06861bceac06d0fbc204d117.png" alt="image"><br><br>  So I got a workable distributed server.  I gave the chat as an example, although in the comments they say that you need to beat your hands for it) In general, I use this technology in a browser game, where the functions for calculating the duel are placed on a separate server.  One of the advantages is that I can improve the performance of only one specific server, if I need to.  In the same way, you can do it for two websites, for example, the first server will process the photos, and the second server on the subdomain will be used to store the images (the image will be sent once, and the second will only display). <br>  Naturally, the implementation is not perfect, it is only a frame point.  It is necessary to set up a correct and convenient publication.  In addition, there is a hard link 1 to 1, and if you need several workers, you will need a load balancer.  Also, in a good way, you need to get rid of static internal aypishnikov.  Well, in general, for speed, you will need to replace the wcf connection with the implementation directly via tcp sockets. </div><p>Source: <a href="https://habr.com/ru/post/305696/">https://habr.com/ru/post/305696/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../305682/index.html">How to write a SQL query on Slick and not open the portal to hell</a></li>
<li><a href="../305686/index.html">Typical mistakes novice technical director in IT - expert opinion</a></li>
<li><a href="../305688/index.html">PhpStorm 2016.2 released</a></li>
<li><a href="../305692/index.html">The best packages for machine learning in R, part 1</a></li>
<li><a href="../305694/index.html">SMS Authentication Organization by Telegram / Viber / WhatsApp Example</a></li>
<li><a href="../305698/index.html">Password Change Notification System [Windows]</a></li>
<li><a href="../305700/index.html">Waiting for advertising: about future innovations on the App Store</a></li>
<li><a href="../305702/index.html">React in browsers and mobile platforms</a></li>
<li><a href="../305704/index.html">Why break even secure CMS on a secure hosting</a></li>
<li><a href="../305706/index.html">Add an arbitrary phone in the personal account of the mobile operator Kyivstar (Ukraine)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>