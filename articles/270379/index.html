<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Half a Century to "Universal Machine Languages" (1966‚Äì2016): Past, Present, Future</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Past 
 The story can start in 1962, when work began at the University of Cambridge on the CPL ("Cambridge Programming Language") - an "improved versio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Half a Century to "Universal Machine Languages" (1966‚Äì2016): Past, Present, Future</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://xkcd.com/927/"><img src="https://habrastorage.org/getpro/habr/comment_images/e1e/960/02b/e1e96002b5abca7c2355bb45a7b51f40.png" alt="KDPV"></a> <br><br><h2>  <font color="#888">Past</font> </h2><br>  The story can start in 1962, when work began at the University of Cambridge on the <a href="https://ru.wikipedia.org/wiki/CPL_%2528%25D1%258F%25D0%25B7%25D1%258B%25D0%25BA_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F%2529">CPL</a> ("Cambridge Programming Language") - an "improved version" of ALGOL-60.  Postgraduate student Martin Richards joined the work on the language;  the main difficulty in the implementation of the new PL seemed to him the need to manually port the compiler for different computer platforms.  In particular, when Cambridge <a href="https://ru.wikipedia.org/wiki/EDSAC">EDSAC-2 was</a> replaced with <a href="https://ru.wikipedia.org/wiki/Atlas_%2528%25D0%25BA%25D0%25BE%25D0%25BC%25D0%25BF%25D1%258C%25D1%258E%25D1%2582%25D0%25B5%25D1%2580%2529">Atlas-2</a> , the CPL developers spent a lot of time porting their compiler to the new platform. <br><br>  Martin's dissertation was devoted to the ‚Äúself-compiled‚Äù CPL: the compiler developed by Martin was written in a strongly simplified version of CPL, the compiler of which was not hard to write on the macro-assembler at that time.  Transferring the CPL to the new platform can now be performed in two steps: <ol><li>  Manually writing a ‚Äúsimplified CPL‚Äù compiler; </li><li>  Compile them with the ‚Äúfull CPL‚Äù compiler. </li></ol><br>  Martin didn‚Äôt stop there, and he developed <a href="https://ru.wikipedia.org/wiki/BCPL">BCPL</a> , a system for developing portable compilers.  The BCPL compiler generated <i>pseudocode</i> , called Martin <a href="https://en.wikipedia.org/wiki/O-code">"OCODE"</a> . <br><div class="spoiler">  <b class="spoiler_title">OCODE looked like this:</b> <div class="spoiler_text"><table><tbody><tr><th>  OCODE </th><th>  "Decoding" ("procode") </th><th></th></tr><tr><td><pre> 94 5 L1 83 73 69 86 69
 95 4
 42 0
 42 0 40 2 14
 83
 42 0 42 1 40 2 14 83
 42 2
 40 3 42 1 15
 92
 85 L5
 90 L6
 42 1 40 4 40 2 14 83
 40 4 42 1 14 80 4 
 90 5 40 4 40 5 88 L6
 91 4
 42 2 40 3 42 1 15 92
 85 L7
 90 L8 40 4 40 2 14
 8 87 L9
 40 4 42 2 11 92
 85 L11
 90 L10
 42 0 40 6 40 2 14 83
 40 4 40 6 14 80 6
 90 L11
 40 6 40 3 22 86 L10
 91 6 90 L9
 40 4 42 1 14 80 4
 90 L7 40 4 40 5 88 L8
 91 4 97 103 0
</pre></td><td><pre> ENTRY 5 L1 'S' 'I' 'E' 'V' 'E'
 SAVE 4
 Ln 0
 LN 0 LP 2 PLUS
 STIND
 LN 0 LN 1 LP 2 PLUS STIND
 Ln 2
 LP 3 LN 1 MINUS
 STORE
 JUMP L5
 LAB L6
 LN 1 LP 4 LP 2 PLUS STIND
 LP 4 LN 1 PLUS SP 4
 LAB L5 LP 4 LP 5 ENDFOR L6
 STACK 4
 LN 2 LP 3 LN 1 MINUS STORE
 JUMP L7
 LAB L8 LP 4 LP 2 PLUS
 RV JF L9
 LP 4 LN 2 MULT STORE
 JUMP L11
 LAB L10
 LN 0 LP 6 LP 2 PLUS STIND
 LP 4 LP 6 PLUS SP 6
 LAB L11
 LP 6 LP 3 LS JT L10
 STACK 6 LAB L9
 LP 4 LN 1 PLUS SP 4
 LAB L7 LP 4 LP 5 ENDFOR L8
 STACK 4 RTRN ENDPROC 0
</pre></td><td>  <nobr>;</nobr>  <nobr>procedure header</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>stack frame (two parameters and two local variables)</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>put number 0 on the stack</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>put another 0, add the 2nd stack item to it</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>write to the array at the top of the stack value below it</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>all the same for the 1st element of the array</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>put number 2 on the stack</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>subtract one from the value of the 3rd stack item</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>write the result to a local variable</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>go to label L5</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>L6 tag ad</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>take the 4th element of the stack, write to the array at this index 1</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>add to the 4th element of stack 1, write the result back</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>L5: go to label L6, if the 4th element of the stack &lt;= 5th</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>announcement that there are four elements on the stack</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>subtract one from the value of the 3rd stack item</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>go to label L7</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>L8: add 4th and 2nd stack elements</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>read the value at this address;</nobr>  <nobr>if it is 0, go to L9</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>multiply the 4th element by two</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>go to label L11</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>L10 tag ad</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>take the 6th element of the stack, write to the array at this index 0</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>add the 4th element to the 6th element of the stack, write the result back</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>L11 tag ad</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>go to label L10, if the 7th element of the stack is less than the 4th</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>there are six elements on the stack;</nobr>  <nobr>L9 tag ad</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>add to the 4th element of stack 1, write the result back</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>L10: go to L8 if the 4th element of the stack &lt;= 5th</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>four elements on the stack;</nobr>  <nobr>end of procedure</nobr> <nobr><br></nobr> </td></tr></tbody></table>  (To save space, command sequences are written in one line. Martin does the same thing in his BCPL manual.) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      BCPL Source Code: <br><blockquote><pre> LET sieve (workvec, vecsize) BE
 {
   workvec! 0: = 0
   workvec! 1: = 0
   FOR i = 2 TO vecsize-1 DO workvec! I: = 1
   FOR i = 2 TO vecsize-1 DO
     IF workvec! I DO
     {LET j = 2 * i
       WHILE j &lt;vecsize DO
       {workvec! j: = 0
         j: = j + i
       }
     }
 }
</pre></blockquote> In newer versions of OCODE, support for floating-point numbers has been added (respectively, the set of supported opcodes has almost doubled), and the <code>ENDFOR</code> opcode has also been removed - a <code>LE JT</code> pair is generated instead. <br><br>  Among the ‚Äúuniversal machine languages‚Äù, OCODE is unique in that the labels in it are determined by special instructions ‚Äî that is,  To interpret the program, you must first load it all into memory, and find labels in it. </div></div>  - and a separate program, a <i>code generator</i> , turned the file with such pseudo-code into an executable program for the final processor.  OCODE was saved as a text file of decimal numbers separated by spaces and line breaks: while OCODE was developed, binding the file format to a specific byte size would limit the portability of such a file. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/747/478/77c/74747877cccb0b9083061836347ccd70.jpg" width="200" align="right" title="Trinity College, Cambridge">  The BCPL <sup>(1)</sup> compiler was supplied as OCODE, and to transfer it to a new platform, it was necessary: <ol><li>  Manually write the pseudocode interpreter <sup>(2)</sup> (in any language, even in BASIC); </li><li>  Adapt a code generator, <sup>(3)</sup> written in BCPL, for its platform; </li><li>  Launch the BCPL compiler (1) under the interpreter (2), feed the code generator (3) to it, and get the executable code generator file <sup>(4)</sup> at the output; <ul><li>  Interpreter (2) is no longer needed from this moment on. </li></ul></li><li>  Run the compiler pseudocode (1) through the code generator (4), and get the executable file of the compiler at the output. </li></ol><br><br>  This approach meant that to transfer the compiler to a new platform, only the minimum of low-level programming is required;  and indeed, the implementation of BCPL was completed by 1967 ‚Äî earlier than the CPL implementation started a few years earlier! <br><br>  The merits of BCPL as applied to system programming inspired Ken Thompson to create the <a href="https://ru.wikipedia.org/wiki/%25D0%2591%25D0%25B8_%2528%25D1%258F%25D0%25B7%25D1%258B%25D0%25BA_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F%2529">Bee</a> language, and he inspired Ken's colleague, Dennis Ritchie, to create C.  It was from BCPL that the tradition of denoting <code>{</code> curly brackets <code>}</code> program blocks followed, and it was on BCPL <a href="http://www.catb.org/jargon/html/B/BCPL.html">that the</a> first program <a href="">‚ÄúHello, World!‚Äù</a> <a href="http://www.catb.org/jargon/html/B/BCPL.html">Was</a> <a href="http://stackoverflow.com/questions/602237/where-does-hello-world-come-from">written</a> . <br><blockquote><pre> GET "libhdr"<font></font>
<font></font>
 LET start () = VALOF
 {writef ("Hello * n")
   RESULTIS 0
 }
</pre></blockquote>  A more important reason for us is that BCPL went down in history: OCODE is the first <i>universal <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D1%2580%25D1%2585%25D0%25B8%25D1%2582%25D0%25B5%25D0%25BA%25D1%2582%25D1%2583%25D1%2580%25D0%25B0_%25D0%25BD%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2580%25D0%25B0_%25D0%25BA%25D0%25BE%25D0%25BC%25D0%25B0%25D0%25BD%25D0%25B4">‚Äúinstruction set architecture‚Äù</a> (ISA)</i> , i.e.  "Virtual machine", not tied to any specific hardware platform with its features.  BCPL, thus, is the first programming language corresponding to the <a href="https://en.wikipedia.org/wiki/Write_once,_run_anywhere">‚ÄúWrite once, run anywhere‚Äù</a> <i>paradigm</i> ( <i>WORA</i> ): a BCPL program can be distributed in a compiled form, and it can be run on any platform for which an OCODE code generator exists. <a name="habracut"></a><br><br>  BCPL and its OCODE never gained popularity outside of the United Kingdom, but the idea of <i>WORA</i> caught on.  In 1974, already on the Continent, at <a href="https://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B2%25D0%25B5%25D0%25B9%25D1%2586%25D0%25B0%25D1%2580%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F_%25D0%25B2%25D1%258B%25D1%2581%25D1%2588%25D0%25B0%25D1%258F_%25D1%2582%25D0%25B5%25D1%2585%25D0%25BD%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F_%25D1%2588%25D0%25BA%25D0%25BE%25D0%25BB%25D0%25B0_%25D0%25A6%25D1%258E%25D1%2580%25D0%25B8%25D1%2585%25D0%25B0">ETH Z√ºrich</a> , under the leadership of Niklaus Virta, Pascal-P was developed with compilation into an intermediate p-code, and then compiling this p-code into executable code for a specific hardware platform .  On the basis of Pascal-P, on the other side of the ocean, in <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D0%25BB%25D0%25B8%25D1%2584%25D0%25BE%25D1%2580%25D0%25BD%25D0%25B8%25D0%25B9%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9_%25D1%2583%25D0%25BD%25D0%25B8%25D0%25B2%25D0%25B5%25D1%2580%25D1%2581%25D0%25B8%25D1%2582%25D0%25B5%25D1%2582_%25D0%25B2_%25D0%25A1%25D0%25B0%25D0%25BD-%25D0%2594%25D0%25B8%25D0%25B5%25D0%25B3%25D0%25BE">UCSD</a> , the <a href="https://ru.wikipedia.org/wiki/UCSD_p-System">p-System</a> OS (1978) was created, where there was no code generator at all: the Pascal p-code <i>itself was the</i> target compiler platform, and the OS kernel was actually a p-code interpreter, working on bare metal.  All system utilities of p-System were supplied as cross-platform p-code, and to adapt p-System to a new hardware platform, it was enough to write an interpreter of p-code for it - there is nothing to recompile! <br><br><div class="spoiler">  <b class="spoiler_title">P-code example</b> <div class="spoiler_text"><table><tbody><tr><td><pre> 0000: D8 p2_0: SLDL 1
 0001: 00 SLDC 0
 0002: 9A STO
 0003: 02 SLDC 2
 0004: CC 03 STL 3
 0006: DA p2_2: SLDL 3
 0007: 31 SLDC 49
 0008: C8 LEQI
 0009: A1 12 FJP p2_5
 000B: D8 SLDL 1
 000C: DA SLDL 3
 000D: 01 SLDC 1
 000E: 32 SLDC 50
 000F: 88 CHK
 0010: 01 SLDC 1
 0011: 95 SBI
 0012: A4 01 IXA 1
 0014: 01 SLDC 1
 0015: 9A STO
 0016: DA SLDL 3
 0017: 01 SLDC 1
 0018: 82 ADI
 0019: CC 03 STL 3
 001B: B9 F6 UJP p2_2
 001D: 02 p2_5: SLDC 2
 001E: CC 03 STL 3
 0020: DA p2_4: SLDL 3
 0021: 31 SLDC 49
 0022: C8 LEQI
 0023: A1 2F FJP p2_1
 0025: D8 SLDL 1
 0026: DA SLDL 3
 0027: 01 SLDC 1
 0028: 32 SLDC 50
 0029: 88 CHK
 002A: 01 SLDC 1
 002B: 95 SBI
 002C: A4 01 IXA 1
 002E: F8 SIND 0
 002F: A1 1C FJP p2_6
 0031: 02 SLDC 2
 0032: DA SLDL 3
 0033: 8F MPI
 0034: CC 02 STL 2
 0036: D9 p2_3: SLDL 2
 0037: 32 SLDC 50
 0038: C9 LESI
 0039: A1 12 FJP p2_6
 003B: D8 SLDL 1
 003C: D9 SLDL 2
 003D: 01 SLDC 1
 003E: 32 SLDC 50
 003F: 88 CHK
 0040: 01 SLDC 1
 0041: 95 SBI
 0042: A4 01 IXA 1
 0044: 00 SLDC 0
 0045: 9A STO
 0046: D9 SLDL 2
 0047: DA SLDL 3
 0048: 82 ADI
 0049: CC 02 STL 2
 004B: B9 F4 UJP p2_3
 004D: DA p2_6: SLDL 3
 004E: 01 SLDC 1
 004F: 82 ADI
 0050: CC 03 STL 3
 0052: B9 F2 UJP p2_4
 0054: AD 00 p2_1: RNP 0
</pre></td><td>  <nobr>;</nobr>  <nobr>put the first parameter on the stack</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>put number 0 on the stack</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>write the value at the top of the stack to the address below it</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>put number 2 on the stack</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>write the value at the top of the stack to the stack frame (in a local variable)</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>push local variable to stack</nobr> <nobr><br><br></nobr>  <nobr>;</nobr>  <nobr>less than or equal to 49?</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>if not, go to p2_5</nobr> <nobr><br><br><br><br><br></nobr>  <nobr>;</nobr>  <nobr>check array bounds: local variable # 3 should be between 1 and 50</nobr> <nobr><br><br></nobr>  <nobr>;</nobr>  <nobr>subtract 1 from the value at the top of the stack, i.e.</nobr>  <nobr>from local variable number 3</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>calculate the pointer to the array element: the index is the previous result of the subtraction,</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>base - the first parameter, the size of the element - one word</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>write unit by the calculated pointer</nobr> <nobr><br><br><br></nobr>  <nobr>;</nobr>  <nobr>add one to local variable number 3</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>write the result back to the stack frame</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>unconditional jump to p2_2</nobr> <nobr><br><br></nobr>  <nobr>;</nobr>  <nobr>write a two in the local variable number 3</nobr> <nobr><br><br><br></nobr>  <nobr>;</nobr>  <nobr>Is this variable less than or equal to 49?</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>if not, go to p2_1</nobr> <nobr><br><br><br><br><br></nobr>  <nobr>;</nobr>  <nobr>check array bounds: local variable # 3 should be between 1 and 50</nobr> <nobr><br><br><br></nobr>  <nobr>;</nobr>  <nobr>calculate pointer to array element, exactly as above</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>read word at offset 0 from computed pointer</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>if read zero, go to p2_5</nobr> <nobr><br><br><br></nobr>  <nobr>;</nobr>  <nobr>multiply the value of local variable ‚Ññ3 by two</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>write the result inside the stack frame</nobr> <nobr><br><br><br></nobr>  <nobr>;</nobr>  <nobr>Is this value less than 50?</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>if not, go to p2_6</nobr> <nobr><br><br><br><br><br></nobr>  <nobr>;</nobr>  <nobr>check array bounds: local variable # 2 should be between 1 and 50</nobr> <nobr><br><br><br></nobr>  <nobr>;</nobr>  <nobr>calculate pointer to array element: index one less</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>local variable number 2, base and size - as above</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>write zero on the calculated pointer</nobr> <nobr><br><br><br></nobr>  <nobr>;</nobr>  <nobr>add to local variable # 2 the value of variable # 3</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>write the result back to the stack frame</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>unconditional jump to p2_3</nobr> <nobr><br><br><br></nobr>  <nobr>;</nobr>  <nobr>add one to local variable number 3</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>write the result back to the stack frame</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>unconditional jump to p2_4</nobr> <nobr><br></nobr>  <nobr>;</nobr>  <nobr>return to caller 0 values ‚Äã‚Äãfrom stack</nobr> <nobr><br></nobr> </td></tr></tbody></table><br>  Pascal source code: <br><blockquote><pre> const data_size = 50;
 type data_array = array [1..data_size] of boolean;<font></font>
<font></font>
 procedure sieve (var workvec: data_array);
 var i, j: integer;
 begin
   workvec [1]: = false;
   for i: = 2 to data_size-1 do workvec [i]: = true;
   for i: = 2 to data_size-1 do
     if workvec [i] then begin
       j: = 2 * i;
       while j &lt;data_size do begin
         workvec [j]: = false;
         j: = j + i;
       end
     end
 end;
</pre></blockquote>  Compared to OCODE, which only supported work with integers and floating numbers the size of a machine word, Pascal‚Äôs p-code supports much more diverse data types ‚Äî strings, arrays, ‚Äúpacked arrays‚Äù (with an element size of less than one word), records, sets, etc .;  as well as dynamic memory allocation.  Another significant difference is that the ‚Äúworking stack‚Äù of the procedure and the ‚Äústack frame‚Äù with parameters and local variables are now separated. <br><br>  For the compactness of the p-code, many instructions have ‚Äúabbreviated opcodes‚Äù for small, frequently used argument values. <br></div></div><br>  The p-System turned out to be quite popular: several Apple II models and several IBM computers, including the original IBM PC (1981), were <a href="http://ia902601.us.archive.org/BookReader/BookReaderImages.php%3Fzip%3D/27/items/byte-magazine-1981-10/1981_10_BYTE_06-10_Local_Networks_jp2.zip%26file%3D1981_10_BYTE_06-10_Local_Networks_jp2/1981_10_BYTE_06-10_Local_Networks_0029.jp2">offered</a> with the p-System as the OS;  and since 1979, Western Digital has released <a href="https://en.wikipedia.org/wiki/Pascal_MicroEngine">Pascal MicroEngine</a> minicomputers, in which the implementation of the p-code was implemented in hardware.  Thus, the p-code from the abstract "universal machine language" has become a real machine language of a real computer. <br><br>  Although by the nineties the p-System had already disappeared from the market, it managed to inspire James Gosling to create a <a href="https://ru.wikipedia.org/wiki/Java_Virtual_Machine">Java virtual machine</a> in 1996.  <i>‚ÄúWrite once, run anywhere!‚Äù</i> Turned into an advertised advertising slogan, and implementations of the ‚Äúuniversal machine language‚Äù ( <a href="https://ru.wikipedia.org/wiki/%25D0%2591%25D0%25B0%25D0%25B9%25D1%2582-%25D0%25BA%25D0%25BE%25D0%25B4_Java">‚Äúbytecode‚Äù</a> ) developed in parallel in two directions: <ul><li>  Acceleration of software implementation ( <a href="https://ru.wikipedia.org/wiki/JIT-%25D0%25BA%25D0%25BE%25D0%25BC%25D0%25BF%25D0%25B8%25D0%25BB%25D1%258F%25D1%2586%25D0%25B8%25D1%258F">JIT compilation</a> in JDK 1.1, 1997) </li><li>  Attempts to hardware implementation: <ul><li>  <a href="http://www.cpushack.com/CIC/announce/1997/SunmicroJava701CPU.html">Sun microJava701</a> (1998) </li><li>  <a href="http://www.eetimes.com/document.asp%3Fdoc_id%3D1140565">Sun MAJC 5200</a> (1999) </li><li>  <a href="http://www.ic72.com/pdf_file/a/71784.pdf">aJile aJ-100</a> (2000) </li><li>  <a href="http://java.epicentertech.com/Archive_Embedded/Imsys%2520Technologies/Cjip_Techref.pdf">Imsys Cjip</a> (2000) </li><li>  <a href="https://www.arm.com/about/newsroom/9621.php">ARM Jazelle</a> (2001) </li></ul></li></ul><br><br>  It is not surprising that none of the ‚Äúbytecode processors‚Äù - neither for p-code, nor for Java - has become commercially successful.  (This also includes the much earlier <a href="https://ru.wikipedia.org/wiki/IAPX_432">Intel iAPX 432</a> (1981) processor ‚Äî a hardware implementation of Ada's bytecode.) Java bytecode, like Virta's p-code, like OCODE - all of them are <i>stack-oriented</i> , because just such an intermediate code the easiest to generate and easiest to interpret.  The ‚Äúvirtual machine‚Äù stack is unlimited;  the ‚Äúiron‚Äù processor, on the contrary, has a fixed number of registers, and one of the most important tasks of the compiler is to distribute the data among the registers so that memory accesses are performed as rarely as possible.  In order to ‚Äúin hardware‚Äù monitor the dependencies between the data, distribute them to the ‚Äúiron‚Äù registers, and rearrange references to them in order to meet the ‚Äúiron‚Äù restrictions - very complex mechanisms are required.  It turns out that with the same level of semiconductor technology, it is more efficient to create a processor for a simple ISA, and to implement bytecode translation on it - than to perform the same bytecode "in hardware".  Again and again, dreamy IT-entrepreneurs were convinced that turning a ‚Äúuniversal machine language‚Äù into a real one ‚Äî albeit technically possible, but commercially unpromising. <br><br><div class="spoiler">  <b class="spoiler_title">Java bytecode example</b> <div class="spoiler_text"><table><tbody><tr><td><pre><font></font>
<font></font>
 2a
 be
 3c
 2a
 03
 03
 54
 2a
 04
 03
 54
 05
 3d
 1c
 1b
 a2 00 0d
 2a
 1c
 04
 54
 84 02 01
 a7 ff f4
 05
 3d
 1c
 1b
 a2 00 23
 2a
 1c
 33
 99 00 17
 05
 1c
 68
 3e
 1d
 1b
 a2 00 0e
 2a
 1d
 03
 54
 1d
 1c
 60
 3e
 a7 ff f3
 84 02 01
 a7 ff de
 b1
</pre></td><td><pre> private static void sieve (boolean []);
  Code:
     0: aload_0 // put a link taken from the stack frame at index 0, i.e.  parameter
     1: arraylength // push stack the length of the transferred array
     2: istore_1 // save to the stack frame at index 1 integer from the stack
     3: aload_0       
     4: iconst_0 // put an integer on the stack - constant 0
     5: iconst_0      
     6: bastore // write to byte or boolean array zero at zero index
     7: aload_0       
     8: iconst_1      
     9: iconst_0
    10: bastore // write to the same array zero by index 1
    11: iconst_2      
    12: istore_2 // save to stack frame at index 2 integer value 2
    13: iload_2 // put the newly saved value onto the stack
    14: iload_1 // push local variable # 1 onto the stack
    15: if_icmpge 28 // compare two integers;  if value = variable, go to instruction 28
    18: aload_0       
    19: iload_2       
    20: iconst_1      
    21: bastore // write to a byte or boolean array unit by index from a local variable
    22: iinc 2, 1 // increase local variable No. 2 by one
    25: goto 13 // go to instruction 13
    28: iconst_2      
    29: istore_2 // write integer value 2 to local variable ‚Ññ2
    30: iload_2       
    31: iload_1
    32: if_icmpge 67 // if variable # 2 is greater than or equal to variable # 1, go to instruction 67
    35: aload_0       
    36: iload_2       
    37: baload // read byte or boolean array element by index from this variable
    38: ifeq 61 // if the element read is zero, go to instruction 61
    41: iconst_2      
    42: iload_2       
    43: imul // multiply the value of local variable ‚Ññ2 by two
    44: istore_3 // save the result to the stack frame at index 3
    45: iload_3       
    46: iload_1       
    47: if_icmpge 61 // if local variable # 3&gt; = variable # 1, go to instruction 61
    50: aload_0       
    51: iload_3       
    52: iconst_0      
    53: bastore // write to byte or boolean array zero by index from variable # 3
    54: iload_3       
    55: iload_2       
    56: iadd // add variable # 2 to the value of local variable # 3
    57: istore_3 // write the result back to the stack frame
    58: goto 45 // go to instruction 45
    61: iinc 2, 1 // increase local variable No. 2 by one
    64: goto 30 // go to instruction 30
    67: return // return from the procedure
</pre></td></tr></tbody></table><br>  Source: <br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sieve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] workvec)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vecsize = workvec.length; workvec[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; workvec[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i&lt;vecsize; i++) workvec[i] = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i&lt;vecsize; i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(workvec[i]) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">2</span></span> * i; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(j &lt; vecsize) { workvec[j] = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; j = j + i; } } }</code> </pre><br>  The bytecode, even more than the Virta p-code, is designed to be compact: for example, <code>iflt</code> (comparison with zero and conditional transition) corresponds to the three <code>SLDC 0; GEQI; FJP</code> instructions <code>SLDC 0; GEQI; FJP</code> <code>SLDC 0; GEQI; FJP</code>  <code>SLDC 0; GEQI; FJP</code> , and <code>iinc</code> replaces four <code>SLDL; SLDC; ADI; STL</code> instructions <code>SLDL; SLDC; ADI; STL</code> <code>SLDL; SLDC; ADI; STL</code>  <code>SLDL; SLDC; ADI; STL</code> . <br></div></div><br>  There is, however, an opposite example.  It is much more profitable for a processor manufacturer to implement a popular ISA so that existing programs can run on a new processor ‚Äî rather than creating a new ISA, compilers for it, and waiting for the required minimum of software for the new platform to appear.  For a long time, <a href="https://ru.wikipedia.org/wiki/IA-32">IA-32</a> remained such a ‚Äúuniversal machine language‚Äù: the volume of existing software outweighed the possible benefits of switching to a new ISA, and starting with <a href="https://ru.wikipedia.org/wiki/Pentium_Pro">Pentium Pro</a> (1995), Intel processors, in fact, implemented the ‚Äúhardware emulation‚Äù of the old ISA.  Instructions IA-32, operating on eight ‚Äúclassical‚Äù registers, are transmitted by the processor to internal <a href="https://ru.wikipedia.org/wiki/RISC">RISC</a> microcommands, operating on 40 ‚Äúiron‚Äù registers;  and pipelines inside the processor perform these RISC microcommands in several streams ‚Äî arbitrarily rearranging microcommands, if this does not break the dependencies between the data.  In the <a href="https://ru.wikipedia.org/wiki/Crusoe">Transmeta Crusoe processor</a> (2000), whose development group included Linus Torvalds, the idea of ‚Äã‚ÄãISA hardware emulation was further developed: out of the box, he supported IA-32, but it could be reprogrammed to work with any other ISA - to demonstrate this Transmeta had a Crusoe ‚Äúadvertising sample‚Äù with Java bytecode hardware support. <br><br><div class="spoiler">  <b class="spoiler_title">Sample IA-32 Machine Code</b> <div class="spoiler_text"><table><tbody><tr><th>  Machine code </th><th>  Assembler </th></tr><tr><td><pre><font></font>
<font></font>
<font></font>
 55
 89 e5
 56
 66 c7 01 00 00
 b8 02 00 00 00
 be 02 00 00 00
 eb 05<font></font>
<font></font>
 c6 04 31 01
 46<font></font>
<font></font>
 39 d6
 7c f7
 eb 01<font></font>
<font></font>
 40<font></font>
<font></font>
 39 d0
 7d 17<font></font>
<font></font>
 80 3c 01 00
 74 f5<font></font>
<font></font>
 8d 34 00
 eb 06<font></font>
<font></font>
 c6 04 31 00
 01 c6<font></font>
<font></font>
 39 d6
 7c f6
 eb e4<font></font>
<font></font>
 5e
 5d
 c3
</pre></td><td><pre>	 .type _ZL5sievePbi, @ function
 _ZL5sievePbi: # pointer to the array is passed to ecx, array length is to edx
 #% entry
	 pushl% ebp # save previous ebp value
	 movl% esp,% ebp # now ebp points to the current stack frame
	 pushl% esi # save previous esi value
	 movw $ 0, (% ecx) # write the zero word at ecx
	 movl $ 2,% eax # (i.e., two array elements zeroed by one instruction)
	 movl $ 2,% esi # save deuce to eax and to esi
	 jmp .LBB1_1 # go to label .LBB1_1
 .LBB1_2: #% for.body
	 movb $ 1, (% ecx,% esi) # write a single byte at ecx + esi
	 incl% esi # increase esi by one
 .LBB1_1: #% for.cond
	 cmpl% edx,% esi # compare esi and edx
	 jl .LBB1_2 # if edx &lt;esi, go to the label .LBB1_2
	 jmp .LBB1_4 # otherwise go to the label .LBB1_4
 .LBB1_3: #% for.inc.11
	 incl% eax # increase eax by one
 .LBB1_4: #% for.cond.4
	 cmpl% edx,% eax # compare eax and edx
	 jge .LBB1_9 # if edx&gt; = esi, go to the label .LBB1_9
 #% for.body.7
	 cmpb $ 0, (% ecx,% eax) # compare with zero byte at ecx + esi
	 je .LBB1_3 # if zero, go to .LBB1_3
 #% if.then
	 leal (% eax,% eax),% esi # write to esi twice the value of eax
	 jmp .LBB1_7 # go to label .LBB1_7
 .LBB1_8: #% while.body
	 movb $ 0, (% ecx,% esi) # write zero byte at ecx + esi
	 addl% eax,% esi # add eax to esi
 .LBB1_7: #% while.cond
	 cmpl% edx,% esi # compare esi and edx
	 jl .LBB1_8 # if edx &lt;esi, go to the label .LBB1_8
	 jmp .LBB1_3 # otherwise go to the label .LBB1_3
 .LBB1_9: #% for.cond.cleanup.6
	 popl% esi # restore old esi value
	 popl% ebp # restore old ebp value
	 retl # return from the procedure
</pre></td></tr></tbody></table>  Notice how compact the code is than in any of the preceding examples. </div></div><br>  It is hardly coincidental that in the only successful examples of the hardware implementation of the ‚Äúuniversal machine language‚Äù, the implemented ISA was not a stack, but a registered one.  Martin Richards to replace his OCODE he developed a new register uni-ISA called <a href="http://www.gtoal.com/languages/bcpl/amiga/bcpl/booting.txt">INTCODE</a> (1972).  INTCODE is extremely simple: six registers, eight operations, and several addressing modes are supported;  instructions, depending on the addressing mode, occupy either one or two words.  In 1980, Martin developed a version of this uni-ISA, designed for 16-bit microcomputers.  The new uni-ISA ‚Äî still with six registers, but with a more complex and less orthogonal instruction set ‚Äî was named Cintcode, and was extremely compact: advertising brochures <a href="http://chrisacorns.computinghistory.org.uk/docs/Acorn/Misc/Acornsoft_MorefromthemicrowithBCPL.pdf">stated</a> that Cintcode programs usually take up to three times less memory than when compiled into machine codes <a href="https://ru.wikipedia.org/wiki/MOS_Technology_6502">6502</a> .  For <a href="https://ru.wikipedia.org/wiki/BBC_Micro">BBC Micro</a> and <a href="https://ru.wikipedia.org/wiki/Amiga">Amiga</a> computers, OSs were popular, supporting Cintcode execution along with machine code. <br><br><div class="spoiler">  <b class="spoiler_title">Cintcode Example</b> <div class="spoiler_text">  Register <code>P</code> - stack pointer;  at the entrance to the function <code>P[3]</code> contains a pointer to the array, <code>P[4]</code> - its length. <br><br><pre>  0: 10 L0;  A: = 0
  1: DB ST0P3;  P [3] [0]: = A (zero the zero element of the array)
  2: DD ST1P3;  P [3] [1]: = A (zero the first element of the array)
  3: 0F LM1;  A: = -1
  4: C4 AP4;  A: = A + P [4] (one less than the length of the array)
  5: A6 SP6;  P [6]: = A (save to local variable)
  6: 12 L2;  B: = A;  A: = 2
  7: A5 SP5;  P [5]: = A
  8: 5C0A JLS 10;  IF B &lt;A GOTO 19
 10: 11 L1;  A: = 1
 11: 83 LP3;  B: = A;  A: = P [3]
 12: 9A STP5;  P [5] [A]: = B (write unit by index from P [5])
 13: B5 XCH;  A: = B
 14: C5 AP5;  A: = A + P [5]
 15: A5 SP5;  P [5]: = A (increase the value of P [5] by one)
 16: 86 LP6;  B: = A;  A: = P [6]
 17: 9CF8 JLE -8;  IF B &lt;= A GOTO 10
 19: 0F LM1;  A: = -1
 20: C4 AP4;  A: = A + P [4]
 21: A6 SP6;  P [6]: = A (the same upper bound of the cycle)
 22: 12 L2;  B: = A;  A: = 2
 23: A5 SP5;  P [5]: = A
 24: 5C1B JLS 27;  IF B &lt;A GOTO 52
 26: 83 LP3;  A: = P [3]
 27: D8 RVP5;  A: = P [5] [A] (read element by index from P [5])
 28: 1E11 JEQ0 17;  IF A = ‚Äã‚Äã0 GOTO 46
 30: 85 LP5;  A: = P [5]
 31: 12 L2;  B: = A;  A: = 2
 32: 34 MUL;  A: = A * B (double the value of P [5])
 33: A7 SP7;  P [7]: = A
 34: 84 LP4;  B: = A;  A: = P [4] (in A, the length of the array)
 35: BC0A JGE 10;  IF B&gt; = A GOTO 46
 37: 10 L0;  A: = 0
 38: 87 LP7;  B: = A;  A: = P [7]
 39: 98 STP3;  P [3] [A]: = B (write zero at index from P [7])
 40: 87 LP7;  A: = P [7]
 41: C5 AP5;  A: = A + P [5]
 42: A7 SP7;  P [7]: = A (increase the value of P [7] by P [5])
 43: 84 LP4;  B: = A;  A: = P [4] (in A, the length of the array)
 44: 5CF8 JLS -8;  IF B &lt;A GOTO 37
 46: 11 L1;  A: = 1
 47: C5 AP5;  A: = A + P [5]
 48: A5 SP5;  P [5]: = A (increase the value of P [5] by one)
 49: 86 LP6;  B: = A;  A: = P [6] (A is 1 less than the length of the array)
 50: 9CE7 JLE -25;  IF B &lt;= A GOTO 26
 52: 7B RTN
</pre><br>  This code was obtained using the <a href="http://www.cl.cam.ac.uk/~mr10/BCPL/cintcode/">latest (2014) version of BCPL Cintcode System</a> from the above implementation on BCPL.  The compactness of such a code is promoted by the presence in Cintcode of double assignment instructions (registers A and B immediately) and double dereferencing (the address given is obtained by adding the register A and the values ‚Äã‚Äãin the stack). </div></div><br><br>  <a href="https://ru.wikipedia.org/wiki/Common_Intermediate_Language">MSIL</a> (2001; officially called CIL) was the pinnacle of stack uni-isa development - or, if you look at it from the other side, a dead end in their development.  MSIL is very similar to Java bytecode, but adds a number of <a href="http://stackoverflow.com/questions/95163/differences-between-msil-and-java-bytecode">additional features</a> .  Attempts to implement MSIL hardware, as far as I know, have not been undertaken;  Microsoft did not even try to offer an alternative to Java to create cross-platform, full-featured web applications.  MSIL remained the ‚Äúmachine language of the Microsoft platforms, and no others. <br><br><div class="spoiler">  <b class="spoiler_title">MSIL Example</b> <div class="spoiler_text"><pre> .method private hidebysig static
         void sieve (bool [] workvec) cil managed
 {
   .maxstack 3
   .locals init ([0] int32 vecsize,
                 [1] int32 i,
                 [2] int32 V_2,
                 [3] int32 j)
   IL_0000: / * 02 |  * / ldarg.0 // put parameter # 0 (unique) onto the stack
   IL_0001: / * 8E |  * / ldlen // calculate array length (unsigned integer)
   IL_0002: / * 69 |  * / conv.i4 // convert it to int32 (signed integer)
   IL_0003: / * 0A |  * / stloc.0 // save result to local variable # 0
   IL_0004: / * 02 |  * / ldarg.0 // push parameter to stack
   IL_0005: / * 16 |  * / ldc.i4.0 // put the constant 0 (signed integer) on the stack
   IL_0006: / * 16 |  * / ldc.i4.0
   IL_0007: / * 9C |  * / stelem.i1 // write zero into zero byte array into byte array
   IL_0008: / * 02 |  * / ldarg.0
   IL_0009: / * 17 | */ ldc.i4.1 //     1 (  )<font></font>
  IL_000a: /* 16 | */ ldc.i4.0<font></font>
  IL_000b: /* 9C | */ stelem.i1 //     (int8)    1<font></font>
  IL_000c: /* 18 | */ ldc.i4.2<font></font>
  IL_000d: /* 0B | */ stloc.1 //      ‚Ññ1<font></font>
  IL_000e: /* 2B | 08 */ br.s IL_0018 //      IL_0019<font></font>
  IL_0010: /* 02 | */ ldarg.0<font></font>
  IL_0011: /* 07 | */ ldloc.1 //      <font></font>
  IL_0012: /* 17 | */ ldc.i4.1<font></font>
  IL_0013: /* 9C | */ stelem.i1 //        <font></font>
  IL_0014: /* 07 | */ ldloc.1<font></font>
  IL_0015: /* 17 | */ ldc.i4.1<font></font>
  IL_0016: /* 58 | */ add //      <font></font>
  IL_0017: /* 0B | */ stloc.1 //     <font></font>
  IL_0018: /* 07 | */ ldloc.1<font></font>
  IL_0019: /* 06 | */ ldloc.0 //      ‚Ññ0<font></font>
  IL_001a: /* 32 | F4 */ blt.s IL_0010 //   ‚Ññ1 &lt;  ‚Ññ0,   IL_0010<font></font>
  IL_001c: /* 18 | */ ldc.i4.2<font></font>
  IL_001d: /* 0C | */ stloc.2 //      ‚Ññ2<font></font>
  IL_001e: /* 2B | 1B */ br.s IL_003b //      IL_003b<font></font>
  IL_0020: /* 02 | */ ldarg.0<font></font>
  IL_0021: /* 08 | */ ldloc.2<font></font>
  IL_0022: /* 90 | */ ldelem.i1 //       <font></font>
  IL_0023: /* 2C | 12 */ brfalse.s IL_0037 //    ,   IL_0037<font></font>
  IL_0025: /* 18 | */ ldc.i4.2<font></font>
  IL_0026: /* 08 | */ ldloc.2<font></font>
  IL_0027: /* 5A | */ mul //     ‚Ññ2  <font></font>
  IL_0028: /* 0D | */ stloc.3 //      ‚Ññ3<font></font>
  IL_0029: /* 2B | 08 */ br.s IL_0033 //      IL_0033<font></font>
  IL_002b: /* 02 | */ ldarg.0<font></font>
  IL_002c: /* 09 | */ ldloc.3<font></font>
  IL_002d: /* 16 | */ ldc.i4.0<font></font>
  IL_002e: /* 9C | */ stelem.i1 //  0       ‚Ññ3<font></font>
  IL_002f: /* 09 | */ ldloc.3<font></font>
  IL_0030: /* 08 | */ ldloc.2<font></font>
  IL_0031: /* 58 | */ add //     ‚Ññ2  ‚Ññ2<font></font>
  IL_0032: /* 0D | */ stloc.3 //     ‚Ññ2<font></font>
  IL_0033: /* 09 | */ ldloc.3<font></font>
  IL_0034: /* 06 | */ ldloc.0<font></font>
  IL_0035: /* 32 | F4 */ blt.s IL_002b //   ‚Ññ3 &lt;  ‚Ññ0,   IL_002b<font></font>
  IL_0037: /* 08 | */ ldloc.2<font></font>
  IL_0038: /* 17 | */ ldc.i4.1<font></font>
  IL_0039: /* 58 | */ add //      ‚Ññ2<font></font>
  IL_003a: /* 0C | */ stloc.2 //     <font></font>
  IL_003b: /* 08 | */ ldloc.2<font></font>
  IL_003c: /* 08 | */ ldloc.0<font></font>
  IL_003d: /* 32 | E1 */ blt.s IL_0020 //   ‚Ññ2 &lt;  ‚Ññ0,   IL_0020<font></font>
  IL_003f: /* 2A | */ ret //   <font></font>
 }
</pre><br>    C#       Java   <code>boolean</code> ‚Üí <code>bool</code> .   Java-  MSIL   : -,           ,  . -,         (/   , ,      ..),    MSIL,  <code>add</code> , ¬´¬ª, ..         ;          (,   ‚Äî   int32)     .       ,  MSIL      JIT-,     MSIL-   . <br><br>   ,  MSIL  ¬´¬ª,  <code>iflt</code>  <code>iinc</code> . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> There were no more stack contenders for ‚Äúuniversal machine languages‚Äù in this millennium. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/3a0/08a/f06/3a008af065db0a8f3de75cf3dcbb78ce.jpg" align="right" width="240" title="C ++"><h2> <font color="#888"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The present</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In 2000, Chris Lattner, an undergraduate student at </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D0%25BB%25D0%25BB%25D0%25B8%25D0%25BD%25D0%25BE%25D0%25B9%25D1%2581%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9_%25D1%2583%25D0%25BD%25D0%25B8%25D0%25B2%25D0%25B5%25D1%2580%25D1%2581%25D0%25B8%25D1%2582%25D0%25B5%25D1%2582_%25D0%25B2_%25D0%25A3%25D1%2580%25D0%25B1%25D0%25B0%25D0%25BD%25D0%25B5-%25D0%25A8%25D0%25B0%25D0%25BC%25D0%25BF%25D0%25B5%25D0%25B9%25D0%25BD%25D0%25B5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIUC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , as a graduation project began developing the ‚Äúuniversal compiler‚Äù of the </font></font><a href="https://ru.wikipedia.org/wiki/Low_Level_Virtual_Machine"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LLVM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , consisting of completely independent ‚Äúfrontends‚Äù that translate the code into HLW into a universal ‚Äúintermediate representation‚Äù </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(intermediate representation, IR)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - and ‚Äú backends, which translate IR into executable code for specific ISA. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As an intermediate representation, LLVM-IR, a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">single assignment form</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> was selected </font><font style="vertical-align: inherit;">( </font></font><a href="https://ru.wikipedia.org/wiki/SSA"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúSSA-form‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">): each variable is assigned a value once, and during program operation it does not change. </font><font style="vertical-align: inherit;">This form makes it easier to keep track of dependencies between data, makes it easy to rearrange and replace individual instructions, find and delete duplicate or </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D1%2591%25D1%2580%25D1%2582%25D0%25B2%25D1%258B%25D0%25B9_%25D0%25BA%25D0%25BE%25D0%25B4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúdead‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> instructions, and so on.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LLVM-IR Example</font></font></b> <div class="spoiler_text">    <a href="https://ru.wikipedia.org/wiki/%25D0%2591%25D0%25B0%25D0%25B7%25D0%25BE%25D0%25B2%25D1%258B%25D0%25B9_%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BA"> </a> (BB),           (  ).   BB     .  ‚Äî       .        BB   <i></i> , ..  BB,     . <br><br><pre> ; Function Attrs: minsize noinline nounwind optsize<font></font>
define internal fastcc void @_ZL5sievePbi(i8* nocapture %workvec, i32 %vecsize) #0 {<font></font>
 ; #0 --     (  )<font></font>
entry:<font></font>
  store i8 0, i8* %workvec, align 1, !tbaa !1 ;      <font></font>
  %arrayidx1 = getelementptr inbounds i8, i8* %workvec, i32 1 ;      <font></font>
  store i8 0, i8* %arrayidx1, align 1, !tbaa !1 ;      <font></font>
  br label %for.cond ;     BB<font></font>
<font></font>
for.cond: ; preds = %for.body, %entry<font></font>
  %i.0 = phi i32 [ 2, %entry ], [ %inc, %for.body ]<font></font>
 ; %i.0   2,    BB   %entry,   %inc,    %for.body<font></font>
  %cmp = icmp slt i32 %i.0, %vecsize<font></font>
 ;  %i.0  %vecsize   ,    %cmp  1  0<font></font>
  br i1 %cmp, label %for.body, label %for.cond.4 ;    %for.body  %for.cond.4<font></font>
<font></font>
for.body: ; preds = %for.cond<font></font>
  %arrayidx2 = getelementptr inbounds i8, i8* %workvec, i32 %i.0 ;    %i.0-  <font></font>
  store i8 1, i8* %arrayidx2, align 1, !tbaa !1 ;      <font></font>
  %inc = add nuw nsw i32 %i.0, 1 ;  %inc  %i.0  <font></font>
 ; nuw  nsw ,     (  ),    <font></font>
  br label %for.cond ;     BB<font></font>
<font></font>
for.cond.4: ; preds = %for.cond, %for.inc.11<font></font>
  %i3.0 = phi i32 [ %inc12, %for.inc.11 ], [ 2, %for.cond ]<font></font>
 ; %i3.0   2,    BB   %for.body,   %inc12,   %for.inc.11<font></font>
  %cmp5 = icmp slt i32 %i3.0, %vecsize ;  %i3.0  %vecsize   <font></font>
  br i1 %cmp5, label %for.body.7, label %for.cond.cleanup.6 ;  ,  %i3.0  %vecsize<font></font>
<font></font>
for.cond.cleanup.6: ; preds = %for.cond.4<font></font>
  ret void ;   ,   <font></font>
<font></font>
for.body.7: ; preds = %for.cond.4<font></font>
  %arrayidx8 = getelementptr inbounds i8, i8* %workvec, i32 %i3.0<font></font>
  %0 = load i8, i8* %arrayidx8, align 1, !tbaa !1, !range !5 ;       %i3.0<font></font>
  %tobool = icmp eq i8 %0, 0 ;      <font></font>
  br i1 %tobool, label %for.inc.11, label %if.then<font></font>
<font></font>
if.then: ; preds = %for.body.7<font></font>
  %mul = shl nsw i32 %i3.0, 1 ;  %mul   %i3.0<font></font>
  br label %while.cond ;     BB<font></font>
<font></font>
while.cond: ; preds = %while.body, %if.then<font></font>
  %j.0 = phi i32 [ %mul, %if.then ], [ %add, %while.body ]<font></font>
  %cmp9 = icmp slt i32 %j.0, %vecsize ;  %j.0  %vecsize   <font></font>
  br i1 %cmp9, label %while.body, label %for.inc.11 ;  %j.0 &lt; %vecsize,   %while.body<font></font>
<font></font>
while.body: ; preds = %while.cond<font></font>
  %arrayidx10 = getelementptr inbounds i8, i8* %workvec, i32 %j.0<font></font>
  store i8 0, i8* %arrayidx10, align 1, !tbaa !1 ;    %j.0-  <font></font>
  %add = add nsw i32 %j.0, %i3.0 ;  %add  %j.0  %i3.0<font></font>
  br label %while.cond ;     BB<font></font>
<font></font>
for.inc.11: ; preds = %while.cond, %for.body.7<font></font>
  %inc12 = add nuw nsw i32 %i3.0, 1 ;  %inc12  %i3.0  <font></font>
  br label %for.cond.4<font></font>
 }
</pre><br>      IA-32    LLVM     IR ‚Äî ,  ,      ,   BB  . <br><br> <code>!tbaa !1</code> ‚Äî        <a href="https://en.wikipedia.org/wiki/Alias_analysis">alias analysis</a> ; <code>!range !5</code> ‚Äî          ( <code>bool</code> ‚Äî 0  1). <br><br>   ,            ‚Äî  ¬´¬ª   MSIL. <br><br>    C++: <br><pre> <code class="hljs matlab">static void sieve(bool workvec[], int vecsize) { workvec[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-built_in"><span class="hljs-built_in">false</span></span>; workvec[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-built_in"><span class="hljs-built_in">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(int <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>&lt;vecsize; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>++) workvec[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>] = <span class="hljs-built_in"><span class="hljs-built_in">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(int <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>&lt;vecsize; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(workvec[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>]) { int <span class="hljs-built_in"><span class="hljs-built_in">j</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">j</span></span> &lt; vecsize) { workvec[<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>] = <span class="hljs-built_in"><span class="hljs-built_in">false</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">j</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">j</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>; } } }</code> </pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since LLVM-IR was developed primarily as an effective way of transferring code from the frontend to the backend, and not as a uni-ISA, there are a </font><a href="http://lists.cs.uiuc.edu/pipermail/llvmdev/2011-October/043719.html"><font style="vertical-align: inherit;">number of disadvantages</font></a><font style="vertical-align: inherit;"> in the role of un-ISA</font></font><a href="http://lists.cs.uiuc.edu/pipermail/llvmdev/2011-October/043719.html"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. First, the features of the target platform can affect the generation of LLVM-IR: a program for a 32-bit system will be compiled into a different LLVM-IR program than a program for a 64-bit one; and the program for Windows will be compiled into another LLVM-IR than the program for Linux. Secondly, LLVM-IR is unstable: any LLVM developer can add new instructions or change the value of existing ones, if this allows for more efficient compilation of important PLs on its important platforms. This means that LLVM-IR, generated by some specific version of the frontend, can be used only with the corresponding version of the backend, and with no other. Third, LLVM-IR allows you to present a code with </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B5%25D0%25BE%25D0%25BF%25D1%2580%25D0%25B5%25D0%25B4%25D0%25B5%25D0%25BB%25D1%2591%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BF%25D0%25BE%25D0%25B2%25D0%25B5%25D0%25B4%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"undefined behavior"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Each backend has the right to transmit such code in any convenient manner in order to ‚Äúsqueeze‚Äù the maximum performance out of the program. Code with undefined C or C ++ behavior is usually compiled into code with undefined behavior on LLVM-IR ‚Äî i.e. in fact, the semantics of such a code are not determined by the frontend, but by the backend, in an optimal way for a particular platform. Naturally, code with undefined behavior contradicts the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúWrite once, run anywhere‚Äù</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> paradigm </font><font style="vertical-align: inherit;">, under which uni-ISA is promoted. Nevertheless, Google, being one of the active developers of LLVM, considered LLVM-IR as an adequate format for the distribution of cross-platform applications written in any of the many PLs supported in LLVM. Starting from version 31 (2013), Google Chrome </font></font><a href="http://habrahabr.ru/post/180117/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">includes support for PNaCl</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- LLVM-IR subsets with stable instruction semantics and without platform dependent constructions and optimizations.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It would seem: why are PNaCl applications better than Java applets that were invented fifteen years earlier for the exact same purpose ‚Äî creating cross-platform, full-featured web applications? (KDPV at the beginning of this topic is just a topic.) I know two advantages of PNaCl: first, LLVM-IR, compared to Java bytecode, simplifies code optimization when a browser translates a PNaCl application into the machine code of a specific target platform. The second and, as far as I understand, the main argument is the openness and licensed purity of LLVM: its owners (Sun and then Oracle) were suing everybody they met, including Google. LLVM and its IR, by contrast, are fully open; and, on the one hand, Google receives in its PNaCl compilers for free all sorts of buns and new optimizations implemented by other LLVM members;On the other hand, any other developers have the right to add support for PNaCl applications to their browsers and not be afraid of lawsuits.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So far, there are no people willing to follow Google‚Äôs example and implement PNaCl support. On the contrary: Mozilla for the same purpose - creating cross-platform, full-featured web applications - has developed its own un-ISA called </font></font><a href="http://habrahabr.ru/post/174175/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asm.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (2013). The generation of asm.js was implemented as a </font></font><a href="http://kripken.github.io/emscripten-site/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">new backend for LLVM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Work on asm.js and PNaCl went almost simultaneously, and in Google Chrome support for asm.js appeared even earlier than support for PNaCl - from version 28 (2013).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asm.js implements a very elegant idea: the program on it is the correct code on (heavily trimmed) JavaScript, and accordingly, such a program should work in any browser that supports JavaScript. </font><font style="vertical-align: inherit;">On the other hand, browsers capable of recognizing asm.js constructs and compiling them into machine code for the target platform ‚Äúon the fly‚Äù will execute such a program many times faster than browsers running JavaScript head-on. </font><font style="vertical-align: inherit;">Thus, both old browsers are able to execute new code on asm.js, and new browsers are able to execute old code on ‚Äúclassic‚Äù JavaScript: if the script does not have a prologue </font></font><code>"use asm";</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, it is executed in the old-fashioned way.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Asm.js example</font></font></b> <div class="spoiler_text">      C++,   ,     Emscripten: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__ZL5sievePbi</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$workvec,$vecsize</span></span></span><span class="hljs-function">) </span></span>{ $workvec = $workvec|<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      |0 $vecsize = $vecsize|0; var $0 = 0, $1 = 0, $10 = 0, $11 = 0, $12 = 0, $13 = 0, $14 = 0, $15 = 0, $16 = 0, $17 = 0, $18 = 0, $19 = 0, $2 = 0, $20 = 0, $21 = 0, $22 = 0, $23 = 0, $24 = 0, $25 = 0, $26 = 0; var $27 = 0, $28 = 0, $29 = 0, $3 = 0, $30 = 0, $31 = 0, $32 = 0, $33 = 0, $4 = 0, $5 = 0, $6 = 0, $7 = 0, $8 = 0, $9 = 0, $i = 0, $i1 = 0, $j = 0, label = 0, sp = 0; sp = STACKTOP; STACKTOP = STACKTOP + 32|0; if ((STACKTOP|0) &gt;= (STACK_MAX|0)) abort(); $0 = $workvec; $1 = $vecsize; $2 = $0; HEAP8[$2&gt;&gt;0] = 0; //       &gt;&gt;0 $3 = $0; $4 = ((($3)) + 1|0); //      HEAP8[$4&gt;&gt;0] = 0; $i = 2; while(1) { $5 = $i; $6 = $1; $7 = ($5|0)&lt;($6|0); //     if (!($7)) { break; } $8 = $i; $9 = $0; $10 = (($9) + ($8)|0); HEAP8[$10&gt;&gt;0] = 1; $11 = $i; $12 = (($11) + 1)|0; $i = $12; } $i1 = 2; while(1) { $13 = $i1; $14 = $1; $15 = ($13|0)&lt;($14|0); if (!($15)) { break; } $16 = $i1; $17 = $0; $18 = (($17) + ($16)|0); $19 = HEAP8[$18&gt;&gt;0]|0; //     $20 = $19&amp;1; L8: do { if ($20) { $21 = $i1; $22 = $21&lt;&lt;1; $j = $22; while(1) { $23 = $j; $24 = $1; $25 = ($23|0)&lt;($24|0); if (!($25)) { break L8; } $26 = $j; $27 = $0; $28 = (($27) + ($26)|0); HEAP8[$28&gt;&gt;0] = 0; $29 = $j; $30 = $i1; $31 = (($29) + ($30))|0; $j = $31; } } } while(0); $32 = $i1; $33 = (($32) + 1)|0; $i1 = $33; } STACKTOP = sp;return; }</span></span></code> </pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interestingly, when asm.js in its development ‚Äústuck‚Äù into the limitations of JavaScript (lack of support for 64-bit numbers, multithreading, SIMD instructions, etc.), then the missing constructions were added to the JavaScript standard. Thus, the compatibility of asm.js with standard JavaScript is the result of the efforts of not only the developers of asm.js, but also the developers of the standard of the language. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition to the reasons already mentioned, to use instead of Java applets a new technology based on LLVM, supporters of asm.js </font></font><a href="http://habrahabr.ru/post/261205/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">give the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> following argument:</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúJavaScript has a built-in virtual machine, so adding another will result in a second set of API connections to give the virtual machine access to DOM, networks, sensors, input devices, etc. For this you have to sacrifice something. For example, how will the processes in a virtual machine distribute the available resources among themselves? It is more difficult to answer this question than it seems. ‚Äù </font></font></i> <font color="#888"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Original spelling)</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In particular, this means that new engine features are simultaneously available from asm.js and from‚Äú classical ‚ÄùJavaScript; they do not need to be implemented twice.</font></font><br><br><h2>  <font color="#888">Future</font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compared to the ‚Äúraw‚Äù LLVM-IR, on which Google and Apple were made, asm.js has a lot of advantages; but there are drawbacks. First, the code on asm.js is incredibly increasing in size - the addition of two integers takes more than twenty bytes! Secondly, to execute code on asm.js, it is necessary to re-execute its syntactic parsing. It would be much more efficient to save the compilation result as an </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25B1%25D1%2581%25D1%2582%25D1%2580%25D0%25B0%25D0%25BA%25D1%2582%25D0%25BD%25D0%25BE%25D0%25B5_%25D1%2581%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B0%25D0%25BA%25D1%2581%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B5_%25D0%25B4%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B2%25D0%25BE"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , rather than generate a JavaScript code from it, and then restore the AST using this code. So in the summer of 2015, a new "universal machine language" called </font></font><a href="http://habrahabr.ru/post/260667/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebAssembly appeared</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">who retained some of the strengths of asm.js (for example, integration with the JavaScript engine), eliminated the two disadvantages mentioned, and refused to be directly compatible with the old JavaScript engines (as </font></font><a href="https://habrahabr.ru/users/vsb/" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vsb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> commented </font><font style="vertical-align: inherit;">, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Or, the game in the browser did not start at all, or it started with 1 fps - there is no difference, in any case, it will not be able to play it. "</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) Instead, the developers of WebAssembly implemented a </font></font><a href="https://en.wikipedia.org/wiki/Polyfill"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" putty "</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - a JavaScript library that reads the code on WebAssembly and" on the fly "generates code from it classic ¬ªasm.js; </font><font style="vertical-align: inherit;">and its old browser versions are already able to perform.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebAssembly example</font></font></b> <div class="spoiler_text">      C++,   ,   WebAssembly     LLVM: <br><br><pre>_Z5sievePbi:<font></font>
	.param i32 #    $0  $1<font></font>
	.param i32<font></font>
	.local i32, i32, i32, i32 #    $2, $3, $4, $5<font></font>
# %entry<font></font>
	block BB0_9 #       --   <font></font>
	i32.const $2, 0 #     <font></font>
	i32.store8 $0, $2 #     <font></font>
	i32.const $3, 1<font></font>
	i32.add $push0, $0, $3 #    --  <font></font>
	i32.store8 $pop0, $2 #     <font></font>
	i32.const $4, 2<font></font>
	set_local $5, $4<font></font>
BB0_1: # %for.cond<font></font>
	loop BB0_3<font></font>
	i32.ge_s $push1, $5, $1 #    -- <font></font>
	br_if $pop1, BB0_3<font></font>
# %for.body<font></font>
	i32.add $push7, $0, $5 # $pushN  $popN -- ""  <font></font>
	i32.store8 $pop7, $3 #    ( )<font></font>
	i32.add $5, $5, $3 #     <font></font>
	br BB0_1<font></font>
BB0_3: # %for.cond.4<font></font>
	loop BB0_9<font></font>
	block BB0_8<font></font>
	block BB0_4<font></font>
	block BB0_3 #    ,   (? ?)<font></font>
	i32.lt_s $push2, $4, $1<font></font>
	br_if $pop2, BB0_4<font></font>
	br BB0_9<font></font>
BB0_4: # %for.body.7<font></font>
	i32.add $push3, $0, $4<font></font>
	i32.load8_u $5, $pop3 #       $4<font></font>
	i32.eq $push4, $5, $2 #    <font></font>
	br_if $pop4, BB0_8<font></font>
# %if.then<font></font>
	i32.shl $5, $4, $3 #  $4   , .. <font></font>
BB0_6: # %while.cond<font></font>
	loop BB0_8<font></font>
	i32.ge_s $push5, $5, $1<font></font>
	br_if $pop5, BB0_8<font></font>
# %while.body<font></font>
	i32.add $push6, $0, $5<font></font>
	i32.store8 $pop6, $2<font></font>
	i32.add $5, $5, $4<font></font>
	br BB0_6<font></font>
BB0_8: # %for.inc.11<font></font>
	i32.add $4, $4, $3<font></font>
	br BB0_3<font></font>
BB0_9: # %for.cond.cleanup.6<font></font>
	 return
</pre><br>      LLVM-IR    IA-32,      ;    WebAssembly    ,   . <br><br>   ,  ,  <a href="https://habrahabr.ru/users/veg/" class="user_link">VEG</a>   - ‚Äî <i>¬´  WebAssembly      .¬ª</i> ‚Äî  . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One of the main developers of WebAssembly was Google - they say that the entire experience gained during the development of PNaCl will be taken into account in the new ‚Äúuniversal machine language‚Äù based on LLVM. PNaCl itself, they are no longer going to develop. Another major developer, Mozilla, emphasizes that WebAssembly, in contrast to asm.js, is not tied - either at the syntactic or semantic level - to any particular PL; it may be that, in a dozen or two years, JavaScript will disappear into non-existence, and browsers will no longer support scripts in the source code ‚Äî instead, WebAssembly will become the ‚Äúnative‚Äù format of web applications for browsers. PC programs made this ‚Äúqualitative leap‚Äù in the 1980s, when software developers moved from spreading multipage listings in BASIC and Pascal to distributing executable code - and, finally,it became possible to use a PC without knowing any programming language at least at the level of ‚Äúhow can I compile and run all this?‚Äù</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Most users of web applications already have no idea about JavaScript; Well, what's the point of distributing web applications as source code?</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/01f/3c1/704/01f3c17047a4c2d06defe457b06bf42b.jpg" align="right" width="270" title="Mobile computing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manufacturers of processors for mobile devices quickened. If you implement ‚Äúin hardware‚Äù, the execution of code in the new ‚Äúuniversal machine language‚Äù, then the performance of web applications ‚Äî for the sake of which mobile devices are acquired and acquired ‚Äî can grow many times! WebAssembly, though a high-level machine language, but not stack; therefore, there is a chance that its hardware implementation could become more successful than previous attempts to implement uni-ISA stacks. The most important thing is that a single machine language for all mobile applications could transform the entire ecosystem - just as x86 at one time transformed the PC world. Prior to the ‚Äúhegemony‚Äù of x86, software for PC came out in a dozen more or less compatible versions for various platforms - for example, Prince of Persia had separate official versions for Amiga, Amstrad, Apple II, Atari, PCFM Towns, IBM PC, Macintosh Quadra, NEC PC-9801, SAM Coup√©, and Sharp X68000; but at some point the phrase ‚Äúprogram for PC‚Äù began to denote the ‚Äúprogram for x86‚Äù. Similarly, a ‚Äúsingle mobile ISA‚Äù would untie software developers, device manufacturers (OEMs), and processor manufacturers from each other: OEMs could choose processors from any manufacturers for their devices, or even use different processors in devices of the same line. manufacturers; and developers would no longer need to spend money on the transfer of applications between different platforms. Ultimately, the user wins if any of the programs he needs is launched on any of his devices.Similarly, a ‚Äúsingle mobile ISA‚Äù would untie software developers, device manufacturers (OEMs), and processor manufacturers from each other: OEMs could choose processors from any manufacturers for their devices, or even use different processors in devices of the same line. manufacturers; and developers would no longer need to spend money on the transfer of applications between different platforms. Ultimately, the user wins if any of the programs he needs is launched on any of his devices.Similarly, a ‚Äúsingle mobile ISA‚Äù would untie software developers, device manufacturers (OEMs), and processor manufacturers from each other: OEMs could choose processors from any manufacturers for their devices, or even use different processors in devices of the same line. manufacturers; and developers would no longer need to spend money on the transfer of applications between different platforms. Ultimately, the user wins if any of the programs he needs is launched on any of his devices.and developers would no longer need to spend money on the transfer of applications between different platforms. Ultimately, the user wins if any of the programs he needs is launched on any of his devices.and developers would no longer need to spend money on the transfer of applications between different platforms. Ultimately, the user wins if any of the programs he needs is launched on any of his devices.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On the other hand, a single machine language imposes a rigid framework on processor manufacturers: you cannot add a new feature to a new processor until it is accepted into the ‚Äúsingle ISA‚Äù and implemented by other manufacturers. Further, as a single machine language develops, situations are inevitable when one of the manufacturers will try to push into the language such features that are specifically beneficial for him. For example, the integer division instruction in Intel processors generates an exception when dividing by zero; in ARM processors, returns zero as a result: ARM engineers considered that it is better to pass the divider check to the compiler, and thereby speed up the division in cases where the divider is obviously non-zero. Thirdly, what about graphics support? WebAssembly </font></font><a href="https://github.com/WebAssembly/design/issues/273"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is not even trying</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to offer a single ISA for graphics processors ‚Äî there are even greater differences between the preferences of different manufacturers than between Intel and ARM command systems. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, all these arguments rely on the fact that WebAssembly will take root, and will not be abandoned in a couple of years, like PNaCl, and will not become isolated in a separate niche, like Java and MSIL.</font></font><br><br>  We'll see. </div><p>Source: <a href="https://habr.com/ru/post/270379/">https://habr.com/ru/post/270379/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270367/index.html">How I won the Beeline BigData Contest</a></li>
<li><a href="../270369/index.html">Using websocket in Extjs applications</a></li>
<li><a href="../270371/index.html">Error Handling in Rust</a></li>
<li><a href="../270373/index.html">Impact analysis on the example of corporate data warehouse infrastructure</a></li>
<li><a href="../270377/index.html">Magento 2.0 Release Candidate Released</a></li>
<li><a href="../270381/index.html">TvOS application development</a></li>
<li><a href="../270383/index.html">Java Programmer Cheat Sheet 4. Java Stream API</a></li>
<li><a href="../270387/index.html">NSA recognized the possibility of using zero-day exploits for cyber attacks</a></li>
<li><a href="../270389/index.html">Font Lato: Sketch vs Android Studio</a></li>
<li><a href="../270391/index.html">Increase system fault tolerance by nodejs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>