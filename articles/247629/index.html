<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Get to know Docker containers for a Django developer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The development of such a project as kubish.ru implies the use of various services that are not typical for an ordinary laptop, even if it is a develo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Get to know Docker containers for a Django developer</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/d73/a11/846/d73a11846376466483828187c197deaa.png"><br><br>  The development of such a project as <a href="http://kubish.ru/%3Futm_source%3Dhabr%26utm_medium%3Dlink%26utm_term%3Ddocker%26utm_content%3Dlink%26utm_campaign%3Dpost">kubish.ru</a> implies the use of various services that are not typical for an ordinary laptop, even if it is a developer‚Äôs laptop.  Postgresql, Redis, Celery and so on.  The desire to create a comfortable development and testing environment has led us to the need to use some kind of virtualization / isolation system.  As an option, Vagrant was used for some time, but this is still ovrerhead and our search for the best way led, at the moment, to Docker. <br><br>  <a href="https://www.docker.com/">Docker</a> is a platform for running applications in isolated containers.  Using containers in Linux allows software to be isolated from the base system.  Unlike Virtualbox, system overheads necessary for hardware virtualization are excluded.  Docker can help develop and deploy web applications and services.  Let's see how this happens. <br><a name="habracut"></a><br>  <b>Why do I need a docker?</b> <br>  Docker can be used in various ways.  It can provide services in the background, for example, PostgreSQL of a given version.  A dockerizing application can be placed in a docker and in this way we can use images of such containers to deploy our application to production. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For python developers, Docker can be described as a virtualenv for any application.  It can be either a Python interpreter or some other server.  This is very convenient when you want to test new versions or want to run outdated applications on your server. <br><br>  <b>Docker installation</b> <br>  Docker is available in repositories in various Linux distributions.  OSX and MS Windows users can use VirtualBox, on which the Linux system is installed, in order to run Docker. <br><br>  To install the latest version I use <a href="http://www.ubuntuupdates.org/ppa/docker">PPA</a> for Ubuntu.  When Docker is installed, you can add yourself to the ‚Äúdocker‚Äù group so that you don‚Äôt need to use sudo in the future. <br><br>  <b>First containers</b> <br>  When the Docker is ready, we can run a lot of containers from <a href="https://registry.hub.docker.com/">registry.hub.docker.com</a> , for example, Python.  To run this container, simply run: <br><pre><code class="python hljs">docker run -it --rm python:<span class="hljs-number"><span class="hljs-number">3.4</span></span></code> </pre> <br><br>  For starters, a running Docker will download several files.  When the process is complete, we get the default console of the Python interpreter.  The <b>-it</b> command runs the container interactively and binds it to the console for interaction.  <b>--rm</b> will delete the current container after exiting.  ‚ÄúPython‚Äù is the name of the source for the container.  After the ‚Äú:‚Äù we see a tag that usually shows the version ‚Äî in this case, the Python version in the container. <br><br>  We can also change the standard behavior of the container, for example, run our own script.  To use the command from the command line, simply add the following: <br><pre> <code class="python hljs">docker run -it --rm python:<span class="hljs-number"><span class="hljs-number">3.4</span></span> ls</code> </pre><br><br>  When our container is launched, the ‚Äúls‚Äù command will start inside it, which will show all the files and filters in the main directory. <br><br>  <b>Dockerfile</b> <br>  The <b>Dockerfile</b> file contains the ‚Äúcooking recipe‚Äù of our container.  If we want to run a Python script, here‚Äôs what we need to write: <br><pre> <code class="python hljs">FROM python:<span class="hljs-number"><span class="hljs-number">3.4</span></span> ADD ./test.py / RUN ls -al CMD python test.py</code> </pre><br><br>  <b>FROM</b> points to the base container, in this case the Python 3.4 image.  Then we can use the <b>ADD</b> , RUN, ENV commands to configure the container.  <b>The RUN</b> command will perform tasks when the container is built.  The <b>CMD</b> command will run at the beginning of the container start.  The image building operations are cached and skip the next versions (the RUN command from the example starts the first build, but not the second build). <br><br>  In the terminal we can write the following: <br><pre> <code class="python hljs">docker build --tag=foo . docker run -it --rm foo</code> </pre><br><br>  <b>Dockerfile on Django</b> <br>  <a href="https://github.com/django-ckeditor/django-ckeditor">django-ckeditor</a> contains a demo application that can be launched through <b>manage.py</b> and runserver.  Let's try to make a dockfile that will create an image of this application: <br><pre> <code class="python hljs">FROM python:<span class="hljs-number"><span class="hljs-number">3.4</span></span> MAINTAINER Piotr Mali≈Ñski &lt;riklaunim@gmail.com&gt; ADD . /ckeditor ENV DJANGO_SETTINGS_MODULE ckeditor_demo.settings RUN pip install -r /ckeditor/ckeditor_demo_requirements.txt RUN pip install /ckeditor RUN python /ckeditor/manage.py validate RUN python /ckeditor/manage.py collectstatic --noinput CMD python /ckeditor/manage.py runserver <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>:<span class="hljs-number"><span class="hljs-number">8080</span></span></code> </pre><br><br>  I use here Python 3.4.  All code from the repository will be added to the ‚Äúckeditor‚Äù folder of the container.  I also set the DJANGO_SETTINGS_MODULE environment variable, add dependencies and the editor itself.  Further validation, static collection and at the end of the CMD to start the server.  It is also convenient to make the server available outside the container, for this we run it on 0.0.0.0 IP <br><pre> <code class="python hljs">dockebuild --tag=django-ckeditor . dockerun -it --rm --publish=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.110</span></span>:<span class="hljs-number"><span class="hljs-number">8080</span></span>:<span class="hljs-number"><span class="hljs-number">8080</span></span> django-ckeditor</code> </pre><br><br>  The <b>--publish</b> option allows <b>you</b> to map (mapping) the public IP / Port address from a running local container to a local one.  In this example, 192.168.0.110 is the port of the host.  The public port can be accessed through 8080 from my localhost.  Without the publish option, the server will be accessible only from the running IP address of the container. <br>  The configuration of Dockerfile, which I showed is not perfect and will only work with SQLite database.  Docker allows you to run different services in different containers.  For example, let's try, use the PostgreSQL database in the second container. <br>  So let's run an instance of PostgreSQL: <br><pre> <code class="python hljs">docker run -d postgres:<span class="hljs-number"><span class="hljs-number">9.4</span></span></code> </pre><br><br>  The Konetiner will start in the background and we can check its status and name with the <b>docker ps command</b> .  Default names are random, for example ‚Äúclever_ptolemy‚Äù.  We have now created a database on this server, but first we need an IP address.  We can get it from <b>docker inspect INSTANCE_NAME</b> , which will show a list of variables in the container, including the IP address.  Next we can create a database: <br><pre> <code class="python hljs">createdb -h IP_ADDRESS DATABASE_NAME -U postgres</code> </pre><br><br>  The database has been created and now we can configure it in the application container.  Docker allows you to do this using environment variables.  For Django, you can use <b>dj_database_url</b> : <br>  from os import environ <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> dj_database_url DATABASES = {<span class="hljs-string"><span class="hljs-string">'default'</span></span>: dj_database_url.parse(environ.get(<span class="hljs-string"><span class="hljs-string">'DATABASE'</span></span>, <span class="hljs-string"><span class="hljs-string">'postgres:///'</span></span>))}</code> </pre><br><br>  Now we have to transfer the env variable with the database name to the container to make it work.  It can be done like this: <br><pre> <code class="python hljs">docker run -it --rm --link=POSTGRES_INSTANCE_NAME:OUR_NAME -e DATABASE=postgres://postgres@OUR_NAME/DATABASE_NAME --publish=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.110</span></span>:<span class="hljs-number"><span class="hljs-number">8080</span></span>:<span class="hljs-number"><span class="hljs-number">8080</span></span> django-ckeditor</code> </pre><br><br>  We can get the database instance name by running the ‚Äúdocker ps‚Äù command in the console.  ‚ÄúOUR_NAME‚Äù is a label that we can use later in the -e value.  In my case, it looked like this: <br><pre> <code class="python hljs">docker run -it --rm --link=clever_ptolemy:db -e DATABASE=postgres://postgres@db/ckeditor --publish=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.110</span></span>:<span class="hljs-number"><span class="hljs-number">8080</span></span>:<span class="hljs-number"><span class="hljs-number">8080</span></span> django-ckeditor python /ckeditor/manage.py syncdb docker run -it --rm --link=clever_ptolemy:db -e DATABASE=postgres://postgres@db/ckeditor --publish=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.110</span></span>:<span class="hljs-number"><span class="hljs-number">8080</span></span>:<span class="hljs-number"><span class="hljs-number">8080</span></span> django-ckeditor</code> </pre><br><br>  The syncdb command is executed first, it will create tables in the database.  Next, start the development server. <br><br>  <b>Tool Fig</b> <br>  The above simple example requires a lot of names and links.  In order to make the process easier, there are several tools like fig.  In the YAML (fig.yml) file, we can specify all the steps and links that are needed: <br><pre> <code class="python hljs">ckeditor: build: . command: python /ckeditor/manage.py runserver <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>:<span class="hljs-number"><span class="hljs-number">8080</span></span> links: - db ports: - <span class="hljs-string"><span class="hljs-string">"8080:8080"</span></span> db: image: postgres:<span class="hljs-number"><span class="hljs-number">9.4</span></span></code> </pre><br><br>  Next, we can build the <b>fig build command</b> and run c <b>fig up</b> , which will show the operation of the application.  We have several labels and we can run syncdb and use <b>fig run NAME COMMAND</b> for help, where Name is the instance name of fig.yml.  When fig is launched, you can check the list of containers with ‚Äúdocker ps‚Äù <br><br>  You can read more about <a href="http://www.fig.sh/yml.html">fig.yml syntax</a> on the application page.  There is also a <a href="http://www.fig.sh/django.html">Django tutorial</a> in which another way to configure Postgres is provided. </div><p>Source: <a href="https://habr.com/ru/post/247629/">https://habr.com/ru/post/247629/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../247615/index.html">Packaging, Compression and Assembly Protection</a></li>
<li><a href="../247617/index.html">Is life possible without a template engine?</a></li>
<li><a href="../247619/index.html">Programming Philosophy 3 - Chichikov and Programmer</a></li>
<li><a href="../247621/index.html">Heartbleed and his friends in 2015: how an advertising network endangers site visitors</a></li>
<li><a href="../247625/index.html">Practical safety: trends and forecasts-2015</a></li>
<li><a href="../247631/index.html">NetApp FAS and VMware ESXi: Swap</a></li>
<li><a href="../247635/index.html">Divide by zero is the norm. Part 1</a></li>
<li><a href="../247637/index.html">Say a word for a test plan</a></li>
<li><a href="../247639/index.html">Arduino, Nokia 5110 LCD module and any image</a></li>
<li><a href="../247641/index.html">‚ÄúI have a cool game idea‚Äù or common mistakes of young game developers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>