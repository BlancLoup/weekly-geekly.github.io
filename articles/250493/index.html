<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Containerize it! What Fuel is and what it uses for Docker</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="While patent wars remain a hidden threat to the OpenStack ecosystem, let's talk about the technology that allows you to deploy OpenStack in almost one...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Containerize it! What Fuel is and what it uses for Docker</h1><div class="post__text post__text-html js-mediator-article">  While <a href="http://habrahabr.ru/company/mirantis_openstack/blog/248777/">patent wars remain a hidden threat</a> to the OpenStack ecosystem, let's talk about the technology that allows you to deploy OpenStack in almost one click.  The name of this project was repeatedly met in the posts of our blog, but there was not a single text dedicated to <a href="https://wiki.openstack.org/wiki/Fuel">Fuel</a> .  Meanwhile, it was this project that significantly simplified the deployment procedure of OpenStack and made the process of further cloud management less time consuming.  Of course, you can act in the old manner.  Using Fuel is not required to work with OpenStack.  However, we believe that if the theater starts with a hanger, then OpenStack starts with Fuel.  At least - Mirantis OpenStack (MOS). <a name="habracut"></a><br><br><h4>  Some common words about Fuel </h4><br>  Fuel is a tool for deploying OpenStack and then managing the cloud.  It is difficult to name a project that would give more informational reasons.  Right now we are telling you that Fuel now uses Docker containers, but we already know about the launch of support for plugins.  And nevertheless at first we will talk about containers.  On the eve of the <a href="http://www.meetup.com/Docker-Moscow/events/219495042/">first Russian Docker-mitap,</a> such a conversation is more than justified. <br><br>  Those of you who have already tried OpenStack (we are not just telling you what it is, but we hope to convince you to spend time experimenting with technology that two years ago attracted our attention and does not let it go until now) we could make sure that manual installation is a laborious, complicated and, most importantly, fraught with a large number of errors.  Fuel is our answer to manual deployment problems.  This is an intuitive tool equipped with a web-based user interface, which, in essence, is a control panel for deploying a cloud with a few clicks and further work with it.  It is important to note that Fuel simplifies large-scale (to date, tested on the environment of 100 nodes) deployment, testing and support of OpenStack configurations.  As one of the OpenStack ecosystem projects, the Fuel project is not related to any particular brand (even ours). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We will return to this development more than once.  And now let's talk about Docker. <br><br><h4>  Docker: saving time and effort </h4><br>  Starting with MOS 5.0, Mirantis staked on Docker in order to implement a simple and reliable transactional update. Fuel: we raise new containers, check, and if something goes wrong, we return the old ones. The speed has come along with the simplicity.  Tell about how it was. <br><br><h4>  Retrospective </h4><br><h5>  MOS 5.0 </h5><br>  The changes we made allowed the user to re-deploy Fuel in less than 30 seconds without using scripts to return the environment to its original state.  Now it is possible to make changes, test them promptly and, if necessary, ‚Äúroll back‚Äù repeatedly. <br><br>  The speed of change was the result of the use of ‚Äúcontainers‚Äù, the scope of which is, in fact, very wide.  The corresponding environment can be created on a laptop with Mac OS X or Windows (using boot2docker), on QA servers under Ubuntu in the cloud, and also on virtual machines in real data centers based on Red Hat Enterprise Linux. <br><br>  To update the Fuel application in Docker, simply remove the old containers and start new ones, saving 1-2 hours you would need to re-assemble Fuel ISO and test the changes made. <br><br><h5>  MOS 5.1 </h5><br>  In Mirantis OpenStack 5.1, we reduced the time required to install Fuel on the master node.  With a virtualized deployment on an SSD disk, the loading time of the images was reduced twice - from 18 minutes to 9 minutes, and containers - from 9 to 8 minutes.  When deployed in the lab (on physical servers), the image loading time in version 5.1 has decreased by 20%. <br><br>  There was an idea to use temporary file storage (tmpfs) on the master node to reduce installation time, but we revealed its unreliability in environments with insufficient RAM, which slowed down the process.  While our main task is to gain time. <br><br>  But the stability of Fuel in version 5.1 was improved thanks to the dockerctl utility, which tracks the activity of settings for Fuel during the Docker update process, in which hundreds of parameters in 13 containers are transferred.  The dockerctl utility is especially important in light of the fact that a large number of matches are established for applications that require 5-6 parameters from our configuration file (astute.yaml) for each container in order to deploy an application. <br><br>  Instead of etcd or other tools requiring systemd, we used astute.yaml parameters, left a local YAML file, and launched Puppet inside containers to deploy applications on the Fuel master node.  We will not necessarily do this in the future, but this method was simpler and less destructive than using other available means.  However, the local YAML file format and Puppet had several flaws, for example, they contributed to establishing a large number of connections in Docker, which resulted in large disk resources for each container due to the installation of Puppet and dependent modules.  But even so, we use in our work some of the most compact full-featured OS images of Docker.  The size of the Ubuntu-based Docker image is huge, whereas the size of our CentOS-based image with Puppet installed is compressed to 39MB. <br><br><h5>  Status quo: MOS 6.0 </h5><br>  We have eliminated errors in the settings of Fuel and implemented a rotation of logs to free up disk space.  In addition, when setting system requirements for 6.0, we took into account the problem with the logrotate utility, which by default saves the last five archives (this requires a disproportionate disk space, despite the fact that Docker itself needs disk space for log files that can fill all free space and crash the file system).  This problem does not have an automatic solution, so even with the log storage improvements made by Mirantis, you still need to monitor the disk capacity, since we cannot predict how much logs you will generate.  Despite the fact that logrotate updates the logs every hour, it does not track the free disk space, and the setting that would increase the size of the folder with Docker logs is missing.  In fact, the logrotate settings limit the size of a single log file, after which it is archived.  Therefore, even with increased parameters, you should allocate 30GB exclusively for logs (when deployed to 20 nodes).  But if you turn on debug mode (Debug), large files will be rotated every 10 minutes, not every hour. <br><br>  Other innovations for Fuel based on Docker in Mirantis OpenStack 6.0 include using CentOS 6.5 as the operating system for the master node. <br>  Since CentOS 6.5 does not have a systemd initialization daemon that would constantly start services, Mirantis uses the <a href="http://supervisord.org/">Supervisor</a> management utility to launch and monitor Docker containers, as well as launch web applications.  ‚ÄúTwo in one‚Äù, as advertisers like to say. <br><br>  In addition, we use a simple ‚Äútry-or-fail‚Äù scheme to solve <br>  problems with stopping Docker containers that have no inherited dependency tracking tools.  In our solution, if the Docker containers try to start and then stop due to the fact that PostgreSQL or RabbitMQ is not yet running, Supervisor waits for a few seconds and tries to restart the container, which failed to start up, until all the containers will be running.  This method is much easier to maintain than a complex sequence of putting containers into action based on priorities or <br>  dependencies.  And, while dockerctl has the proper sequence when running all containers, this sequence only applies during initial deployment. <br><br>  Once again, pay attention to the fact that Fuel is a project of the entire OpenStack ecosystem, so you can use this tool to deploy, test and support your OpenStack platform.  Although, of course, we believe that the easiest way is to get it as part of <a href="https://software.mirantis.com/">the Mirantis OpenStack distribution</a> .  Still, we are responsible for our distribution and we can guarantee that its use will not damage the reputation of the ecosystem as a whole. <br><br><h4>  <b>First Docker-event in Moscow</b> </h4><br>  Since we ourselves were convinced that <a href="https://www.docker.com/">Docker</a> is a useful tool, we want to share this knowledge.  On February 26, from 6:00 pm to 9:00 pm, Mirantis participates in the first Docker meeting in Moscow and invites those who wish to join.  Participation is free.  More information about the event can be found on the website of the <a href="http://openstack.ru/os_events/pervyiy-mitap-po-docker-v-moskve/">Russian community OpenStack</a> , and you can register <a href="http%253A%252F%252Fwww.meetup.com%252FDocker-Moscow%252Fjoin%252F%253Fgj%253D%2526eventId%253D%2526a%253D%26gj%3D%26eventId%3D%26c%3D16117912%26urlkey%3D%26a%3D%26number%3D">here</a> .  For those who wish to participate in the meeting - registration is required. <br><br>  <a href="https://www.facebook.com/fsoppelsa">Fabrizio Soppelsa</a> , an engineer at our <a href="http://docs.mirantis.com/openstack/fuel/fuel-6.0/">Fuel</a> support <a href="http://docs.mirantis.com/openstack/fuel/fuel-6.0/">team</a> , author of the Linux Journal and just an OpenStack enthusiast, will start the meeting.  He will formulate a brief description of the Docker technology, describe the advantages of using this powerful platform and what makes it popular among developers. <br><br>  Next, <a href="https://www.facebook.com/mmosesohn">Matthew Mosesohn</a> is a senior developer at Mirantis.  Matthew will talk about the deployment of Docker ‚ÄúOff the Grid‚Äù.  By the way, it was on his post in our corporate blog <a href="http://habrahabr.ru/company/mirantis_openstack/blog/248777/">dedicated to the transition of Fuel to Docker</a> that we relied in the preparation of this material. <br><br>  <a href="https://events.yandex.ru/lib/people/21674/">Denis Zaitsev</a> , head of the cloud platform and CDN operations team at Yandex, will tell you about the Docker Registry scaling;  about launching Docker applications in the OpenStack-cloud with the help of <a href="https://wiki.openstack.org/wiki/Murano">Murano</a> - <a href="https://www.facebook.com/serg.melikyan">Sergey Melikyan</a> , senior developer at Mirantis. <br><br>  <a href="https://www.facebook.com/andrey.wagin">Andrei Vagin</a> , a developer on Parallels‚Äôs Linux Kernel team, will complete the mitap.  Its theme is ‚ÄúLibcontainer: joining forces under one roof.‚Äù  Andrei will make a description of the plans and the current status of this task. <br><br>  You probably have (or appeared) questions.  The event is the right place to ask.  But if you for some reason do not get to the meeting, then write questions in the comments - we will try to call our experts to answer. </div><p>Source: <a href="https://habr.com/ru/post/250493/">https://habr.com/ru/post/250493/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250481/index.html">JavaScript Garden: Objects</a></li>
<li><a href="../250485/index.html">Productive fault tolerant geographically distributed cluster operating in Active-Active scheme on IBM zEnterprise EC 12 mainframe</a></li>
<li><a href="../250487/index.html">Manage unmanaged and critical monitoring</a></li>
<li><a href="../250489/index.html">Effective code review: 9 tips from a reformed skeptic</a></li>
<li><a href="../250491/index.html">Reduce the number of errors using the Code Review checklist</a></li>
<li><a href="../250495/index.html">Security links for email newsletters</a></li>
<li><a href="../250497/index.html">[Moscow, 02.19.2015] Dmitry Lenev - Lock Managers in MySQL</a></li>
<li><a href="../250499/index.html">How SSD caching by means of a hypervisor in the VMware cloud works</a></li>
<li><a href="../250501/index.html">Application Insights - we collect telemetry of Windows Phone and Windows applications</a></li>
<li><a href="../250505/index.html">Convenient use of WPS in Mikrotik</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>