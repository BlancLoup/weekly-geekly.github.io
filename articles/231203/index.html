<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We draw a ruble sign in the Android application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, developers have increasingly been asked to use the ruble symbol in the text. However, the ruble symbol was approved relatively recently , th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We draw a ruble sign in the Android application</h1><div class="post__text post__text-html js-mediator-article">  Recently, developers have increasingly been asked to use the ruble symbol in the text.  However, the ruble symbol <a href="http://ru.wikinews.org/wiki/%25D0%2591%25D0%25B0%25D0%25BD%25D0%25BA_%25D0%25A0%25D0%25BE%25D1%2581%25D1%2581%25D0%25B8%25D0%25B8_%25D1%2583%25D1%2582%25D0%25B2%25D0%25B5%25D1%2580%25D0%25B4%25D0%25B8%25D0%25BB_%25D1%2581%25D0%25B8%25D0%25BC%25D0%25B2%25D0%25BE%25D0%25BB_%25D1%2580%25D1%2583%25D0%25B1%25D0%25BB%25D1%258F">was approved relatively recently</a> , the symbol received <a href="https://twitter.com/ken_lunde/status/430761051290759168">its code in the Unicode standard even later</a> .  Naturally, the Roboto headset on current platforms does not yet contain a ruble sign. <br><a name="habracut"></a><br><h5>  Idea </h5><br>  Create a headset consisting of one ruble symbol with code <a href="http://www.fileformat.info/info/unicode/char/20bd/index.htm">U + 20BD</a> , and when drawing text for ruble symbols use this headset. <br><br><h5>  A little bit about Span </h5><br>  In Android, there is a mechanism for marking strings with special objects that affect the rendering of TextView text.  For example, there are objects to override the <a href="http://developer.android.com/reference/android/text/style/ForegroundColorSpan.html">fill</a> color / <a href="http://developer.android.com/reference/android/text/style/BackgroundColorSpan.html">background</a> , <a href="http://developer.android.com/reference/android/text/style/StyleSpan.html">style,</a> or <a href="http://developer.android.com/reference/android/text/style/TextAppearanceSpan.html">all at once</a> (a <a href="http://developer.android.com/reference/android/text/style/package-summary.html">complete list of</a> markers embedded in Android).  About this mechanism already wrote on Habr√© <a href="http://habrahabr.ru/post/166351/">here</a> and <a href="http://habrahabr.ru/post/167343/">here</a> . <br><br><h5>  Creating the desired headset </h5><br>  For the basis of the future headset, I took a ready-made solution from Artemy Lebedev, whom I <a href="http://habrahabr.ru/post/48084/">wrote about</a> some time ago on Habr√©.  This headset consists of different styles of the ruble symbol assigned to the Latin alphabet characters (from lowercase <i>a</i> to <i>s</i> ). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/850/d44/51d/850d4451db3fd79abd2009fb7ac8960d.png" alt="List of all glyphs"><br><br>  I chose the glyph that is assigned to the letter i ( <img src="https://habrastorage.org/getpro/habr/post_images/bd3/f8b/8da/bd3f8b8da04aebe1e8e5734bb46e1f6d.png" alt="Ruble symbol">  ).  As it seems to me, it is most suitable for use with the Roboto headset. <br>  To edit the headset, I used the wonderful <a href="http://www.glyphsapp.com/">Glyphs</a> app.  I deleted all the glyphs from the headset and left only the selected one.  I assigned him the code U + 20BD.  The next step is exporting to ttf. <br>  In the end, I did <a href="">it</a> . <br>  Of course, it would be possible to edit the glyph of the capital P, having drawn the wand, however, I do not feel confident in this matter.  It hurts a lot of nuances.  If someone can do this, I will gladly accept your pull request. <br><br><h5>  Implementation </h5><br>  To begin, create a project from a template.  I used the Blank Activity template from the Android Studio suite, an activity called MainActivity. <br>  The markup for MainActivity looks like this: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:tools</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/tools"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_horizontal_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingRight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_horizontal_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_vertical_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_vertical_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".MainActivity"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EditText</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/main_price_input"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:inputType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"numberDecimal"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:hint</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/main_price_hint"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Everything is simple, we create LinearLayout with one descendant of EditText.  We set the hint property of EditText with the namespace <code>tools</code> , so that the tooltip is displayed only in the preview.  In the program we will set the hint programmatically. <br><br>  In <code>MainActivity#onCreate</code> we need to make a <a href="http://developer.android.com/reference/android/text/Spanned.html">spanned</a> string, in which all the ruble signs will be labeled <a href="http://developer.android.com/reference/android/text/style/TypefaceSpan.html">TypefaceSpan</a> , which allows you to change the headset to draw the specified characters.  Here we have a little trouble: TypefaceSpan can be created only with the font-family - the name of the font from the system set.  Fortunately, judging by the <a href="">TypefaceSpan source code</a> , this approach is not due to the technical capabilities of the text rendering system, which allows us to create our own version of TypefaceSpan, which supports setting the headset directly with a <a href="https://developer.android.com/reference/android/graphics/Typeface.html">Typeface</a> object. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> me.pepyakin.roublesign; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.graphics.Paint; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.graphics.Typeface; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.text.TextPaint; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.text.style.MetricAffectingSpan; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TypefaceSpan2</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MetricAffectingSpan</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Typeface mTypeface; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TypefaceSpan2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Typeface typeface)</span></span></span><span class="hljs-function"> </span></span>{ mTypeface = typeface; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateDrawState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TextPaint ds)</span></span></span><span class="hljs-function"> </span></span>{ apply(ds, mTypeface); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateMeasureState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TextPaint paint)</span></span></span><span class="hljs-function"> </span></span>{ apply(paint, mTypeface); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Paint paint, Typeface tf)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> oldStyle; Typeface old = paint.getTypeface(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (old == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { oldStyle = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { oldStyle = old.getStyle(); } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fake = oldStyle &amp; ~tf.getStyle(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((fake &amp; Typeface.BOLD) != <span class="hljs-number"><span class="hljs-number">0</span></span>) { paint.setFakeBoldText(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((fake &amp; Typeface.ITALIC) != <span class="hljs-number"><span class="hljs-number">0</span></span>) { paint.setTextSkewX(-<span class="hljs-number"><span class="hljs-number">0.25f</span></span>); } paint.setTypeface(tf); } }</code> </pre><br><br>  It remains only to make the marking of the text using the TypefaceSpan2 announced above, with the headset we need. <br><br><pre> <code class="java hljs">String priceHint = getString(R.string.main_price_hint); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Typeface roubleSupportedTypeface = Typeface.createFromAsset(getAssets(), <span class="hljs-string"><span class="hljs-string">"fonts/rouble2.ttf"</span></span>); SpannableStringBuilder resultSpan = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpannableStringBuilder(priceHint); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; resultSpan.length(); i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resultSpan.charAt(i) == <span class="hljs-string"><span class="hljs-string">'\u20BD'</span></span>) { TypefaceSpan2 roubleTypefaceSpan = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TypefaceSpan2(roubleSupportedTypeface); resultSpan.setSpan(roubleTypefaceSpan, i, i + <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } }</code> </pre><br><br>  Here we load the template of our string containing the ruble symbol and a headset with the ruble glyph. <br>  Then we create a <a href="https://developer.android.com/reference/android/text/SpannableStringBuilder.html">SpannableStringBuilder</a> based on the template and with the help of <a href="https://developer.android.com/reference/android/text/SpannableStringBuilder.html">setSpan we</a> arrange markers for changing the headset. <br><br>  Assign hint, <br><br><pre> <code class="java hljs">priceInput.setHint(resultSpan);</code> </pre><br>  and ready! <br><img src="http://habrastorage.org/files/75d/5ff/e95/75d5ffe95076406e89d3dca7b0535449.gif" alt="Finished result"><br><br>  <a href="https://github.com/pepyakin/roublesign">Link to source</a> </div><p>Source: <a href="https://habr.com/ru/post/231203/">https://habr.com/ru/post/231203/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../231191/index.html">Summer FSH innovative projects "Creating the Future": how it was</a></li>
<li><a href="../231193/index.html">Online translation Odessa StartUp Day</a></li>
<li><a href="../231195/index.html">Useful materials for mobile developer # 63 (July 21-27)</a></li>
<li><a href="../231197/index.html">RTG: prosaic heat and electricity for spacecraft</a></li>
<li><a href="../231201/index.html">Modern Tornado Part 2: Blocking Operations</a></li>
<li><a href="../231207/index.html">How to send a message that is understandable after 10,000 years</a></li>
<li><a href="../231209/index.html">System / 360 - hardware</a></li>
<li><a href="../231211/index.html">This is Science: Putting triboelectricity at the service of humanity</a></li>
<li><a href="../231213/index.html">Why you should never use MongoDB</a></li>
<li><a href="../231215/index.html">Dronie and Cyber-Hand from Navigator Campus on Seliger</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>