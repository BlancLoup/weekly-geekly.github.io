<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Accelerate the loading of Windows for fun and profit</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Perhaps, to begin with, if you reboot 15 times a year, then any ‚Äútuning‚Äù of the boot process takes more time than will be won on reboots for the entir...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Accelerate the loading of Windows for fun and profit</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/8f1/20c/0a0/8f120c0a0a339ed3c18a5874e82090b9.gif" align="left" alt="image">  Perhaps, to begin with, if you reboot 15 times a year, then any ‚Äútuning‚Äù of the boot process takes more time than will be won on reboots for the entire lifetime of the system.  However, sports interest takes its toll, especially since <a href="http://habrahabr.ru/qa/1493/">people are interested in the</a> process of speed optimization.  And the download turned out to be the most obvious candidate for examples of how, in my opinion, this very process should look.  I‚Äôll say right away that we‚Äôll boot from the 5400 rpm screw, we‚Äôll boot into the ‚Äúworking‚Äù system: in addition to the unfinished Vendor krapwari, there is still a lot of any kind of visual studio, antivirus, Skype, Steam, Google ... <br><br>  About why disabling the pagefile is more harmful than useful - some other time, but for now ... <br><a name="habracut"></a><br>  Specific and generally applicable tips to optimize the OS can not be just as there can be no specific tips to speed up any random program.  Just as in individual programs, the work of the entire system can be seriously slowed down due to one or two seemingly insignificant places.  To find such "bottlenecks" in the programs, there are tools called <a href="http://en.wikipedia.org/wiki/Profiler_(computer_science)">profilers</a> .  There is nothing strange that we will also use a <a href="http://msdn.microsoft.com/en-us/performance/cc825801.aspx">profiler</a> to find the ‚Äúbottlenecks‚Äù in the operating system (no quotes are really profilers, at the same time sampled and instrumented).  Recently, WPA Tools are distributed as part of the <a href="http://go.microsoft.com/fwlink/%3FLinkID%3D191420">Windows SDK</a> .  Installing the full SDK is completely optional.  You can install only the "Windows Performance Toolkit": <br><br><img src="https://habrastorage.org/storage/29aa10f4/cf8e5245/022a901d/b05dc8bc.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We will collect traces using xbootmgr.  Of magic, only the <a href="http://msdn.microsoft.com/en-us/library/aa363687(VS.85).aspx">autologger is used</a> , which includes collecting <a href="http://msdn.microsoft.com/en-us/library/bb968803(v%3DVS.85).aspx">ETW traces</a> starting from the winload itself.  To call for help, you can enter <b>xbootmgr -help</b> - I will not bring it here.  For those who want to assess the scale, you can enter <b>xperf -providers</b> (or <b>logman providers</b> ).  Each provider has several ‚Äúkeywords‚Äù (keywords), each ‚Äúkeyword‚Äù enables / disables several types of events (event). <br><br>  So, let's begin.  Caution, the following command automatically reboots the computer: <b>xbootmgr -trace boot</b> <br><br>  After rebooting, the folder in which this command was executed will remain the file ‚Äúboot_BASE + CSWITCH_1.etl‚Äù (BASE + CSWITCH are those ‚Äúkeywords‚Äù): <b>xperf boot_BASE + CSWITCH_1.etl</b> <br><br>  And you can start browsing.  What he sees brings sadness: <br><br><img src="https://habrastorage.org/storage/a810256d/506db969/64305966/0844490a.png"><br><br>  Explorer is ready for the 36th second, but due to 100% loading of a single (not very fast) disk, the system will not be very responsive for another 2 minutes (the start menu will open instantly, but you will have to wait for the programs to start).  ReadyBoot tries to do something and at first it even turns out (orange and green), but gradually accumulating deviations from the bootplan reduce its attempts to nothing. <br>  What is even sadder is that instead of actually reading the data, the disk spends most of its 100% employment in throwing the head to the center of the disk and back: <br><br><img src="https://habrastorage.org/storage/f34aa314/984dd0b3/e17e4103/36f29454.png"><br><br><blockquote>  A little help: ReadyBoot collects a disk usage profile on every boot, and then SysMain builds a bootplan based on the last five downloads.  Accordingly, the more often you boot, the better the bootplan will be ‚Äúguessed‚Äù for the next boot and the faster it will be.  In addition, the prefetcher collects statistics about which files and in which order were used at boot time and adds this information to% SystemRoot% \ Prefetch \ Layout.ini <br><br>  This information is used by the built-in defragmenter to make decisions about the location of files. </blockquote><br><br>  Accordingly, the first ‚Äúoptimization‚Äù will be a multiple reboot and defragmentation.  Very convenient that xbootmgr can do it for us. <br><br>  <b>xbootmgr -trace boot -prepSystem</b> <br>  The default is six reboots: <br><br><img src="https://habrastorage.org/storage/918c34e6/775bcab0/5d9b6523/8689ee03.png"><br><br>  After the second begins defragmentation: <br><br><img src="https://habrastorage.org/storage/0f097a31/f0ac522a/459316cc/61eee137.png"><br><br>  When everything is finished, in the directory from which xbootmgr was launched there will be 6 files with traces of each of the preparatory reboots as well as the same boot_BASE + CSWITCH_1.etl <br><br>  See if something has changed.  And everything changed quite noticeably: <br><br><img src="https://habrastorage.org/storage/41503f2a/525b6c64/5dba557a/715e44b9.png"><br><br>  ReadyBoot does its job much better and as a result, the explorer is ready one-third faster, and the drive activity time has been almost halved. <br><br><img src="https://habrastorage.org/storage/67ed1f73/20688ac5/8177ee50/cdf8fbe0.png"><br><br>  We still go to the center of the disk and we will deal with it later, but disk seek is already noticeably smaller, and this is no longer any, but a success.  In the meantime, pay attention to this schedule: <br><br><img src="https://habrastorage.org/storage/d03aa0cf/2ada5ca6/aa59b330/15209ce7.png"><br><br>  This is a disgrace.  While someone is laid out 100%, some rest.  We will fix it.  How do you usually spend process time for readable data?  That's right, compression.  We will fix it by compressing the Windows folders and both Program Files.  An attempt to do this from a loaded system cannot be called successful - some files are being packed, some are not.  In general, you can not live like this: <br><br><img src="https://habrastorage.org/storage/347c84fa/6071ef09/f753d8e7/16a9d3a3.png"><br><br>  Reboot into System Recovery and run from there <b>compact / c / a / i / s: directory</b> for our three directories.  There will be no screenshots, since I was too lazy to take a screenshot for WinPE - I‚Äôll have to take my word for it (and it‚Äôs better to double-check experimentally).  prepSystem will have to spend again, since the layout of the disk after compression has changed a lot. <br><br>  Well, check what happened with us: <br><br><img src="https://habrastorage.org/storage/1e73983e/62b44915/2a44c813/086650cb.png"><br><br>  The explorer is ready by the 20th second, a little less than a minute there is disk activity, but already a little less than 100%. <br><br>  And yes, we still go to the center of the disk: <br><br><img src="https://habrastorage.org/storage/1a9ba2f2/aaf955ce/28cce3a2/8b204bab.png"><br><br>  The tooltips tell us the culprit.  Rechecked <br><br><img src="https://habrastorage.org/storage/38e65adf/a592c94b/b51471f1/e4121b56.png"><br><br>  At the same time under the distribution get Skype and Steam.  And rightly so - they have nothing to do at startup with such appetites.  They can always be run from the superbar / start menu. <br><br>  Finishing touches: <br><br>  Completely insane loading time of one service: <br><br><img src="https://habrastorage.org/storage/8c146c09/8afc5168/00ff34ca/b79a9389.png"><br><br>  And the second: <br><br><img src="https://habrastorage.org/storage/0ea2eece/701e1e03/fa5e4f59/566b23d6.png"><br><br>  We agreed not to abandon the functionality, even if it didn‚Äôt rest on our figs.  Therefore, we will not disable services.  We simply switch them to ‚ÄúAutomatic (Delayed start)‚Äù: <br><br><img src="https://habrastorage.org/storage/65dd8028/55b77bf2/189ff474/49424fa2.png"><br><br>  In the case of Microsoft Antimalware, this is somewhat more complicated: <br><br><img src="https://habrastorage.org/storage/60a7e029/bbfc407e/4eec3432/8df65b35.png"><br><br>  Quickly we find out that the fact is that the service belongs to the ‚ÄúCOM Infrastructure‚Äù group and cannot be loaded later than this group.  We go to the registry and pull it out of this group, and then calmly finish the job: <br><br><img src="https://habrastorage.org/storage/1c34c7b9/055da972/4301e65e/4f770a26.png"><br><br>  Just in case one more prepSystem and here is the final: <br><br><img src="https://habrastorage.org/storage/db9ef80e/4473f1de/0bc9e317/506ad540.png"><br><br>  The explorer was loaded at the 17th second, at the 18th disk activity actually stops. <br><br>  You can admire a strictly ordered disk access: <br><br><img src="https://habrastorage.org/storage/453a89c0/50939203/d8cbc873/470d5cbd.png"><br><br>  A fast SSD and / or total cut-out functionality could reduce the boot time to ten seconds or less. <br><br>  And the conclusion from all this is this: <b>before anything is ‚Äúoptimized‚Äù, it is worthwhile to determine those minimal changes that make the most of the results</b> . </div><p>Source: <a href="https://habr.com/ru/post/106684/">https://habr.com/ru/post/106684/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../106671/index.html">Effective conversion enhancement: a look from the West</a></li>
<li><a href="../106673/index.html">Ukraine - Free Internet for Kindle 3G</a></li>
<li><a href="../106674/index.html">Microsoft will launch online computer games store on November 15</a></li>
<li><a href="../106675/index.html">My experience of 4 sales in the online store</a></li>
<li><a href="../106676/index.html">Bada is looking for talents: Ukraine</a></li>
<li><a href="../106685/index.html">HP Slate officially introduced</a></li>
<li><a href="../106686/index.html">The Chinese have created their own map service.</a></li>
<li><a href="../106688/index.html">What can Mac App Store create for users and developers?</a></li>
<li><a href="../106689/index.html">About Toshiba in Moscow</a></li>
<li><a href="../106695/index.html">Ukraine - registration of the phone purchased in the online store in the IMEI database</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>