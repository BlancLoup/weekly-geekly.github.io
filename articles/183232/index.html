<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Customization captcha in Zend Framework 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Zend \ Captcha component can take various forms, including asking logical questions, generating distorted fonts, and transferring multiple images ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Customization captcha in Zend Framework 2</h1><div class="post__text post__text-html js-mediator-article">  The <i>Zend \ Captcha</i> component can take various forms, including asking logical questions, generating distorted fonts, and transferring multiple images by establishing a connection between them.  <i>Zend \ Captcha</i> aims to provide a variety of server solutions that can be used either offline or in combination with the <i>Zend \ Form</i> component. <br><br>  The Captcha element has more than one field that is rendered one after another.  The built-in captch image generator ( <i>Zend \ Captcha \ Image.php</i> ) uses its own helper ( <i>Zend \ Form \ View \ Helper \ Captcha \ Image.php</i> ) to create an image.  Also, in <i>Zend \ Captcha \ Image.php</i> is the 'getHelperName' method.  This method sends the name of the helper for rendering the captcha image.  By default, 'getHelperName' sends 'captcha / image' - an instance of the class <i>Zend \ Form \ View \ Helper \ Captcha \ Image.php</i> .  If you go deep with the debugger, you can see that in the instance property of <i>phpRenderer :: __ helpers</i> , in <i>invokablesClasses</i> is the helper 'captchaimage'.  This is the <i>Zend \ Form \ View \ Helper \ Captcha \ Image.php</i> mentioned earlier.  Roughly speaking, you simply create an image, and the renderer does the rest for you using a helper, although not everyone is happy with this state of affairs. <br><a name="habracut"></a><br>  When you create a Captcha form element ( <i>Zend \ Form \ Element \ Captcha.php</i> ), you transfer a captcha image ( <i>Zend \ Captcha \ Image.php</i> ) to this element.  The Captcha form element, in turn, also has its own helper ( <i>Zend \ Form \ View \ Helper \ FormCaptcha.php</i> ).  In the render method of this helper, you will see that the captcha image ( <i>Zend \ Captcha \ Image.php</i> ) is loaded using the ElementInterface: <br><br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//Zend\Form\View\Helper\FormCaptcha.php public function render(ElementInterface $element) { $captcha = $element-&gt;getCaptcha();</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      after which the helper is called via the 'getHelperName' method: <br><br><pre> <code class="php hljs">$helper = $captcha-&gt;getHelperName();</code> </pre><br><br>  As a result, we get an instance of the helper class using the PhpRenderer instance and return the view: <br><br><pre> <code class="php hljs">$helper = $renderer-&gt;plugin($helper); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $helper($element);</code> </pre><br><br>  We need to clearly understand the difference between the 'Captcha form element and its helper' and the 'Captcha image also with its helper'.  We will pass the 'captcha image' to the Captcha form element, which already has an associated helper.  The render method of the Captcha form element will embed an instance of the Captcha image that we passed using the helper to generate the image and return the view.  All that needs to be done is to transfer the new helper to the Captcha image, which will display the presentation in the way we are satisfied and rewrite <i>Zend \ Captcha \ Image.php</i> to get our new helper, and not our default. <br><br>  Before we begin, let's pay attention to a few details: <br>  <i>Zend \ Form \ View \ Helper \ Captcha \ Image.php helper</i> for captcha defines the pattern as% s% s% s: <br><br><pre> <code class="php hljs">$pattern = <span class="hljs-string"><span class="hljs-string">'%s%s%s'</span></span>;</code> </pre><br><br>  Thus, the first thing that is needed is our custom helper with its own pattern.  Let's create it in the Application module: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//module\Application\src\Application\View\Helper\Form\Captcha\ViewHelperCaptcha.php </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> namespace Application\View\Helper\Form\Captcha; use Zend\Form\View\Helper\Captcha\AbstractWord; use Application\View\Helper\Form\Captcha\CustomCaptcha as CaptchaAdapter; use Zend\Form\ElementInterface; use Zend\Form\Exception; class ViewHelperCaptcha extends AbstractWord { /** * Override * * Render the captcha * * @param ElementInterface $element * @throws Exception\DomainException * @return string */ public function render(ElementInterface $element) { //         . $this-&gt;setSeparator('') $captcha = $element-&gt;getCaptcha(); if ($captcha === null || !$captcha instanceof CaptchaAdapter) { throw new Exception\DomainException(sprintf( '%s requires that the element has a "captcha" attribute of type Zend\Captcha\Image; none found', __METHOD__ )); } //     (  600). $captcha-&gt;setExpiration(10); //    (  10).        . $captcha-&gt;setGcFreq(1); $captcha-&gt;generate(); $imgAttributes = array( 'width' =&gt; $captcha-&gt;getWidth(), 'height' =&gt; $captcha-&gt;getHeight(), 'alt' =&gt; $captcha-&gt;getImgAlt(), 'src' =&gt; $captcha-&gt;getImgUrl() . $captcha-&gt;getId() . $captcha-&gt;getSuffix(), ); $closingBracket = $this-&gt;getInlineClosingBracket(); $img = sprintf( '&lt;img %s%s', $this-&gt;createAttributesString($imgAttributes), $closingBracket ); $position = $this-&gt;getCaptchaPosition(); $separator = $this-&gt;getSeparator(); $captchaInput = $this-&gt;renderCaptchaInputs($element); //   $pattern = '&lt;div class="captcha_image"&gt; %s&lt;/div&gt; %s&lt;div class="captcha_input"&gt; %s&lt;/div&gt;' if ($position == self::CAPTCHA_PREPEND) { return sprintf($pattern, $captchaInput, $separator, $img); } return sprintf($pattern, $img, $separator, $captchaInput); } }</span></span></code> </pre><br><br>  The class of our helper duplicates the class <i>Zend \ Form \ View \ Helper \ Captcha \ Image.php</i> with a few changes.  Our helper does not use <i>Zend \ Captcha \ Image.php</i> to generate an image, unlike the original one.  Remember that <i>Zend \ Captcha \ Image.php</i> provides the 'getHelperName' method that returns the hard-coded helper name 'captcha / image', so when the form generates an image, it will not receive its default helper, but the newly created us.  What else is needed is to pass our custom helper to phpRenderer and generate a new captcha image that will extend the original <i>Zend \ Captcha \ Image.php class</i> and rewrite the 'getHelperName' method by setting the name of the helper we created. <br><br>  So let's add our class to the phpRenderer invokables helper configuration.  We implement this in module.config.php: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//module\Application\config\module.config.php ... 'view_helpers' =&gt; array( 'invokables' =&gt; array( 'viewhelpercaptcha' =&gt; 'Application\View\Helper\Form\Captcha\ViewHelperCaptcha', ), ),</span></span></code> </pre><br><br>  The next step is to create a captcha image that will return our helper added to the module configuration as the phpRenderer invokables class.  There is no need to redefine the whole <i>Zend \ Captcha \ Image.php class</i> , it is enough to point our custom helper class as a parameter to the 'getHelperName' method.  To do this, create a class and name it, for example, <i>CustomCaptcha.php</i> in the <i>module \ Application \ src \ Application \ View \ Helper \ Form \ Captcha</i> folder.  We are going to extend the original <i>Zend \ Captcha \ Image.php class</i> and override the 'getHelperName' method so that it returns our helper 'viewhelpercaptcha'.  It does not hurt to override the error messages in the $ messageTemplates property.  At your discretion. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//module\Application\src\Application\View\Helper\Form\Captcha\CustomCaptcha.php </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> namespace Application\View\Helper\Form\Captcha; // ,   . use Zend\Captcha\Image as CaptchaImage; //  ,      . class CustomCaptcha extends CaptchaImage { protected $messageTemplates = array( self::MISSING_VALUE =&gt; ' ', self::MISSING_ID =&gt; ' ID ', self::BAD_CAPTCHA =&gt; '  ', public function getHelperName() { return 'viewhelpercaptcha'; } }</span></span></code> </pre><br><br>  The last thing we need to do is use our CustomCaptcha image in shape.  To do this, create two folders: one for the font (zf2folder / data / fonts), which you will need to generate captcha words, and another, for storing the captch image files (zf2folder / public / img / captcha).  Naturally, copy the * .ttf font to the fonts folder, for example arial.ttf. <br><br>  For example, you can take the form from the official tutorial: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Album</span></span>\<span class="hljs-title"><span class="hljs-title">Form</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Zend</span></span>\<span class="hljs-title"><span class="hljs-title">Form</span></span>\<span class="hljs-title"><span class="hljs-title">Form</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Application</span></span>\<span class="hljs-title"><span class="hljs-title">Form</span></span>\<span class="hljs-title"><span class="hljs-title">View</span></span>\<span class="hljs-title"><span class="hljs-title">Helper</span></span>\<span class="hljs-title"><span class="hljs-title">Captcha</span></span>\<span class="hljs-title"><span class="hljs-title">CustomCaptcha</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AlbumForm</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    parent::__construct('album'); $this-&gt;setAttribute('method', 'post'); //    ... //    Captcha $dirdata = './data'; //  CustomCaptcha  $captchaImage = new CustomCaptcha(array( 'font' =&gt; $dirdata . '/fonts/arial.ttf', 'width' =&gt; 120, 'height' =&gt; 60, 'fsize' =&gt; 20, 'wordLen' =&gt; 5, 'dotNoiseLevel' =&gt; 25, 'lineNoiseLevel' =&gt; 2 )); //     $captchaImage-&gt;setImgDir('public/img/captcha/'); //      $captchaImage-&gt;setImgUrl('/img/captcha/'); $captchaImage-&gt;setImgAlt('   ?'); //   Captcha    CustomCaptcha,   $this-&gt;add(array( 'type' =&gt; 'Zend\Form\Element\Captcha', 'name' =&gt; 'captcha', 'options' =&gt; array( 'captcha' =&gt; $captchaImage, ), 'attributes' =&gt; array( 'class' =&gt; 'some_class', ) )); $this-&gt;add(array( 'name' =&gt; 'submit', 'attributes' =&gt; array( 'type' =&gt; 'submit', 'value' =&gt; 'Go', 'id' =&gt; 'submitbutton', ), )); } }</span></span></code> </pre><br><br>  Add a captcha element to the view file <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;formRow($form-&gt;get(<span class="hljs-string"><span class="hljs-string">'captcha'</span></span>)) . PHP_EOL;</code> </pre><br><br>  After examining the structure of the html document that is output, you will see that now the image and the captcha input field are wrapped in divs.  We got a more orderly design. <br><br>  Used sources: <br>  <a href="http://framework.zend.com/manual/2.2/en/modules/zend.captcha.intro.html">framework.zend.com/manual/2.2/en/modules/zend.captcha.intro.html</a> <br>  <a href="http://framework.zend.com/manual/2.2/en/modules/zend.captcha.operation.html">framework.zend.com/manual/2.2/en/modules/zend.captcha.operation.html</a> <br>  <a href="http://framework.zend.com/manual/2.2/en/modules/zend.captcha.adapters.html">framework.zend.com/manual/2.2/en/modules/zend.captcha.adapters.html</a> <br>  <a href="http://framework.zend.com/manual/2.2/en/user-guide/forms-and-actions.html">framework.zend.com/manual/2.2/en/user-guide/forms-and-actions.html</a> <br>  <a href="http://zendtemple.blogspot.com/2012/12/zend-framework-2-zf2-creating-view.html">zendtemple.blogspot.com/2012/12/zend-framework-2-zf2-creating-view.html</a> <br>  <a href="http://samsonasik.wordpress.com/2012/09/12/zend-framework-2-using-captcha-image-in-zend-form/">samsonasik.wordpress.com/2012/09/12/zend-framework-2-using-captcha-image-in-zend-form</a> <br><habracut></habracut></div><p>Source: <a href="https://habr.com/ru/post/183232/">https://habr.com/ru/post/183232/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../183222/index.html">Setup of support of Russian in GVim (windows)</a></li>
<li><a href="../183224/index.html">Against teachers who read on paper</a></li>
<li><a href="../183226/index.html">Coloring images</a></li>
<li><a href="../183228/index.html">Terminals - RDP client with connection manager and tabs</a></li>
<li><a href="../183230/index.html">As I wrote LZ4 compression plugin for Reiser4</a></li>
<li><a href="../183234/index.html">Edward Snowden claims that the NSA hacked hundreds of cars in China</a></li>
<li><a href="../183236/index.html">New versions of Flask and Werkzeug with Python 3.3 support</a></li>
<li><a href="../183238/index.html">Photoshop color picker on jQuery</a></li>
<li><a href="../183242/index.html">Large video review iOS 7 beta 1</a></li>
<li><a href="../183244/index.html">Is programming a craft?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>