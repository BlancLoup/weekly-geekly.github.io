<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A simple rotary encoder driver for Qt4 Embedded under Linux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It so happened that in Qt4 Embedded , which we use on our Bercut-MMT device, there is no support for input devices such as an encoder. Those. If you a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A simple rotary encoder driver for Qt4 Embedded under Linux</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/bbc/fbe/dcc/bbcfbedccc2c4c2d93908068aa5072bc.jpg" align="left"><br><br>  It so happened that in <b>Qt4 Embedded</b> , which we use on our <a href="http://metrotek.spb.ru/b45.html">Bercut-MMT</a> device, there is no support for input devices such as an encoder.  Those.  If you attach a mouse to the device, the coordinates will be processed while moving, but the scroll wheel will not.  Because the <b>linuxinput</b> driver <b>does</b> not handle events with the <b>REL_WHEEL</b> type, which is generated by the encoder, but only <b>REL_X</b> and <b>REL_Y</b> , which are responsible for changing the coordinates. <br><br>  Who cares how to solve this problem - welcome under cat. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here is a piece of <b>linuxinput</b> driver code that handles events from the <b>input to</b> the Linux kernel subsystem: <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; n; ++i) { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> :</span></span>:input_event *data = &amp;buffer[i]; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> unknown = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data-&gt;type == EV_ABS) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data-&gt;code == ABS_X) { m_x = data-&gt;value; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data-&gt;code == ABS_Y) { m_y = data-&gt;value; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { unknown = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data-&gt;type == EV_REL) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data-&gt;code == REL_X) { m_x += data-&gt;value; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data-&gt;code == REL_Y) { m_y += data-&gt;value; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { unknown = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data-&gt;type == EV_KEY &amp;&amp; data-&gt;code == BTN_TOUCH) { m_buttons = data-&gt;value ? Qt::LeftButton : <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data-&gt;type == EV_KEY) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> button = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (data-&gt;code) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BTN_LEFT: button = Qt::LeftButton; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BTN_MIDDLE: button = Qt::MidButton; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BTN_RIGHT: button = Qt::RightButton; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data-&gt;value) m_buttons |= button; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> m_buttons &amp;= ~button; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data-&gt;type == EV_SYN &amp;&amp; data-&gt;code == SYN_REPORT) { QPoint pos(m_x, m_y); pos = m_handler-&gt;transform(pos); m_handler-&gt;limitToScreen(pos); m_handler-&gt;mouseChanged(pos, m_buttons); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data-&gt;type == EV_MSC &amp;&amp; data-&gt;code == MSC_SCAN) { <span class="hljs-comment"><span class="hljs-comment">// kernel encountered an unmapped key - just ignore it continue; } else { unknown = true; } if (unknown) { qWarning("unknown mouse event type=%x, code=%x, value=%x", data-&gt;type, data-&gt;code, data-&gt;value); } }</span></span></code> </pre> <br><br><h4>  <b>Solve problems</b> </h4><br>  We have three options: <br><br><ul><li>  modify <b>linuxinput</b> driver </li></ul><br><ul><li>  modify the kernel driver so that it generates events that are understandable to the driver l <b>inuxinput</b> </li></ul><br><ul><li>  write your input device driver for <b>Qt4</b> </li></ul><br><br>  The third option is the most correct one.  We will consider it. <br><br><h4>  <b>We write driver</b> </h4><br>  To create your driver, you need to write two classes - a <b>QWSMouseHandler</b> successor and a <b>QWSMousePlugin</b> successor.  The task of the first is to work directly with the input device, the task of the second is to explain the <b>QMouseDriverFactory</b> that the driver with the name <b>% drivername%</b> should use our implementation of the <b>QWSMouseHandler</b> successor. <br><br>  Let's start with the descendant class <b>QWSMouseHandler</b> : <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RotaryEncoderHandler</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> QObject, <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> QWSMouseHandler { Q_OBJECT <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: RotaryEncoderHandler( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString &amp;device = QString(<span class="hljs-string"><span class="hljs-string">"/dev/input/rotary_encoder"</span></span> ) ); ~RotaryEncoderHandler( ); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">suspend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( )</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resume</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( )</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: QSocketNotifier *m_notify; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> deviceFd; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> m_wheel; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> slots: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readMouseData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( )</span></span></span></span>; };</code> </pre><br><br>  As can be seen from the header file - we need to implement as many as three functions: <b>suspend ()</b> , <b>resume ()</b> , <b>readMouseData ()</b> .  Well, the designer with the destructor. <br><br>  Constructor - as an argument, the device name comes to us - <b>/ dev / input / event3</b> , for example.  Further, our task is to open the file descriptor of the device with the specified name and transfer it to the mercy in <b>QSocketNotifier</b> .  <b>QSocketNotifier</b> is such a beast that listens to the file descriptor and emits the <b>activated (int)</b> signal to any of its gestures. <br><br><pre> <code class="cpp hljs">RotaryEncoderHandler::RotaryEncoderHandler( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString &amp;device ): QWSMouseHandler( device ) ,deviceFd( <span class="hljs-number"><span class="hljs-number">0</span></span> ) ,m_wheel( <span class="hljs-number"><span class="hljs-number">0</span></span> ) { setObjectName(<span class="hljs-string"><span class="hljs-string">"Rotary Encoder Handler"</span></span>); deviceFd = ::open(device.toLocal8Bit().constData(), O_RDONLY | O_NDELAY); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( deviceFd &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ){ qDebug() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Opened"</span></span> &lt;&lt; device &lt;&lt; <span class="hljs-string"><span class="hljs-string">"as rotary encoder device"</span></span>; m_notify = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QSocketNotifier( deviceFd, QSocketNotifier::Read, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); connect( m_notify, SIGNAL( activated(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, SLOT( readMouseData())); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { qWarning(<span class="hljs-string"><span class="hljs-string">"Cannot open %s: %s"</span></span>, device.toLocal8Bit().constData(), strerror( errno ) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } }</code> </pre><br><br>  Those.  we opened the input device handle, attached a <b>QSocketNotifier</b> to it <b>,</b> and with its <b>activated (int)</b> signal hung our handler. <br><br>  The destructor of this class is quite simple - its task is to check whether the handle of the input device is open and, if so, close it. <br><br>  The <b>suspend () / resume ()</b> methods should stop / start processing data from the input device.  This is done by simply calling the <b>setEnabled (bool)</b> <b>method of QSocketNotifier</b> . <br><br>  So we got to the data handler directly. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> RotaryEncoderHandler::readMouseData( ) { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> :</span></span>:input_event buffer[<span class="hljs-number"><span class="hljs-number">32</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n = <span class="hljs-number"><span class="hljs-number">0</span></span>; forever { n = ::read(deviceFd, <span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>(buffer) + n, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(buffer) - n); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == <span class="hljs-number"><span class="hljs-number">0</span></span>) { qWarning(<span class="hljs-string"><span class="hljs-string">"Got EOF from the input device."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; (errno != EINTR &amp;&amp; errno != EAGAIN)) { qWarning(<span class="hljs-string"><span class="hljs-string">"Could not read from input device: %s"</span></span>, strerror(errno)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n % <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(buffer[<span class="hljs-number"><span class="hljs-number">0</span></span>]) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } n /= <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(buffer[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; n; ++i) { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> :</span></span>:input_event *data = &amp;buffer[i]; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> unknown = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data-&gt;type == EV_REL) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data-&gt;code == REL_WHEEL) { m_wheel = data-&gt;value; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { unknown = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data-&gt;type == EV_SYN &amp;&amp; data-&gt;code == SYN_REPORT) { mouseChanged(pos(), Qt::NoButton, m_wheel); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data-&gt;type == EV_MSC &amp;&amp; data-&gt;code == MSC_SCAN) { <span class="hljs-comment"><span class="hljs-comment">// kernel encountered an unmapped key - just ignore it continue; } else { unknown = true; } if (unknown) { qWarning("unknown mouse event type=%x, code=%x, value=%x", data-&gt;type, data-&gt;code, data-&gt;value); } } }</span></span></code> </pre><br><br>  It strongly resembles a similar method from the <b>linuxinput</b> driver, but unlike it, it transmits only events with changes in the encoder status.  Those.  this driver cannot be used as it is for the mouse, as it lacks the processing of changes in the coordinates of the mouse itself - nothing but the scroll wheel will not work. <br><br>  Now let's see what the driver class is: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RotaryEncoderDriverPlugin</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> QMouseDriverPlugin { Q_OBJECT <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: RotaryEncoderDriverPlugin( QObject *parent = <span class="hljs-number"><span class="hljs-number">0</span></span> ); ~RotaryEncoderDriverPlugin(); <span class="hljs-function"><span class="hljs-function">QWSMouseHandler* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QString&amp; driver)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">QWSMouseHandler* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QString&amp; driver, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QString&amp; device)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">QStringList </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">keys</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; };</code> </pre><br><br>  Not very big, right?  Here is its implementation: <br><br><pre> <code class="cpp hljs">Q_EXPORT_PLUGIN2(rotaryencoderdriver, RotaryEncoderDriverPlugin) RotaryEncoderDriverPlugin::RotaryEncoderDriverPlugin( QObject *parent ): QMouseDriverPlugin( parent ) { } RotaryEncoderDriverPlugin::~RotaryEncoderDriverPlugin() { } QStringList RotaryEncoderDriverPlugin::keys() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QStringList() &lt;&lt;<span class="hljs-string"><span class="hljs-string">"rotaryencoderdriver"</span></span>; } QWSMouseHandler* RotaryEncoderDriverPlugin::create( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString&amp; driver, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString&amp; device ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( driver.toLower() == <span class="hljs-string"><span class="hljs-string">"rotaryencoderdriver"</span></span> ){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RotaryEncoderHandler( device ); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } QWSMouseHandler* RotaryEncoderDriverPlugin::create( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString&amp; driver ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( driver.toLower() == <span class="hljs-string"><span class="hljs-string">"rotaryencoderdriver"</span></span> ){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RotaryEncoderHandler( ); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br><br>  As you can see from the code, the whole task of the driver is to inform the <b>QMouseDriverFactory</b> class that this is a driver with the name <b>rotaryencoderdriver</b> .  Well, <b>create ()</b> methods, of course. <br><br><h4>  <b>Battle check</b> </h4><br>  Now that we have a driver, we need to somehow explain the <b>Qt4</b> library what it should use for a particular device.  For this there is a special environment variable - <b>QWS_MOUSE_PROTO</b> .  It serves to tell <b>Qt4</b> what driver and from which device to take data on mouse movement.  Suppose that our encoder is <b>/ dev / input / rotary0</b> , therefore in order for it to work, you need to set the variable as <b>QWS_MOUSE_PROTO = "rotaryencoderdriver: / dev / input / rotary0"</b> . <br><br><h4>  <b>We catch events from the encoder</b> </h4><br>  To work with encoder events, we need to implement an event filter in our application: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ClassName::eventFilter(QObject *o, QEvent *e) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( o ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( e-&gt;type() == QEvent::Wheel) { QWheelEvent* we = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt; QWheelEvent* &gt;( e ); <span class="hljs-comment"><span class="hljs-comment">/*       */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/*     Object*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QObject::eventFilter( o, e ); }</code> </pre><br><br><h4>  <b>useful links</b> </h4><br><ul><li>  <a href="http://qt-project.org/doc/qt-4.8/qt-embedded-pointer.html">Qt for Embedded Linux Pointer Handling</a> </li></ul><br><br>  <b>Update:</b> video added for clarity <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Pu4DC-WITiM%3Ffeature%3Doembed&amp;xid=17259,15700023,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjE90KQW5YJqHJ0ny7Y3zF95uTaYg" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/266075/">https://habr.com/ru/post/266075/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../266061/index.html">Dangerous world of malicious extensions and protection from them. Experience Yandex Browser</a></li>
<li><a href="../266065/index.html">Tehnokniga, Part 2: Literature on DBMS, Frontend Development, Interface Design and In-depth Java Programming</a></li>
<li><a href="../266067/index.html">The action "Good deed" - eliminating digital inequality</a></li>
<li><a href="../266069/index.html">Why CIOs must ‚Äúwork in the field‚Äù</a></li>
<li><a href="../266073/index.html">Emacs: we train the cursor (continuation)</a></li>
<li><a href="../266077/index.html">Analysis of one of the VaultCrypt encryption modifications</a></li>
<li><a href="../266079/index.html">‚ÄúFortran - Alive and Alive‚Äù or ‚ÄúWhat‚Äôs new ifort‚Äôs grandfather‚Äù</a></li>
<li><a href="../266081/index.html">In the footsteps of Meteor, or cycling reactivity</a></li>
<li><a href="../266083/index.html">Restriction of memory available to the program</a></li>
<li><a href="../266085/index.html">We build real-time web applications with RethinkDB</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>