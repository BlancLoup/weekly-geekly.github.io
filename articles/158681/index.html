<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementing background file uploads to a Cach√© server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Web application developers on Cach√© and Ensemble often have the task of ‚Äúfile upload‚Äù - downloading files from a browser. Recently, the Cach√© forum on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementing background file uploads to a Cach√© server</h1><div class="post__text post__text-html js-mediator-article"> Web application developers on Cach√© and Ensemble often have the task of ‚Äúfile upload‚Äù - downloading files from a browser.  Recently, the Cach√© forum on <a href="http://www.sql.ru/forum/actualtopics.aspx%3Fbid%3D56">SQL.ru</a> again raised several questions about how to do background file downloads.  I decided to describe how this can be done using CSP and ZEN technologies. <br><a name="habracut"></a><br>  There are a lot of options for ready-made available components for the implementation of this task.  All of them differ in the available breadth of functionality, as well as support for browsers and technologies.  Most of them mainly use the HTML element <code>/&gt;</code> .  There are those in which the download occurs using Flash.  With the beginning of support for FileAPI from HTML5 browsers, it became possible to find ready-made JavaScript components and with the support of this technology. <br><br>  To implement the example, one of the ready-made scripts found on the Internet for downloading files to the server, <a href="http://fineuploader.com/">FineUploader, was chosen</a> .  For the visual design, the <a href="http://twitter.github.com/bootstrap/">Bootstrap</a> framework was chosen.  In the component chosen by me, there is support for loading several Drag-n-Drop files, but there is no support for FileAPI.  When downloading multiple files, progress is displayed, with the status of each downloaded file. <br>  Download FineUploader and Bootstrap, unpack to the root of the folder of our CSP-application.  For example, for the <code>USER</code> domain, the CSP application will be <code>/csp/user</code> by default, when installing Cach√©, the default path will be <code>C:\InterSystems\Cache\CSP\user</code> . <br><div class="spoiler">  <b class="spoiler_title">Implementation example on CSP.</b> <div class="spoiler_text">  <font color="#000080">Class habr.CSPFileUpload Extends% CSP.Page</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">OnPage ()</font> <font color="#000080">As% Status</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#008000">#;</font>  <font color="#008000">The file has been transmitted, so we will respond to the browser that we have received the file and how</font> <font color="#008000"><br></font>  <font color="#0000ff">if $ d</font> <font color="#000000">(</font> <font color="#800000">% request</font> <font color="#000000">.</font> <font color="#0000ff">Data</font> <font color="#000000">(</font> <font color="#008000">"loadFile"</font> <font color="#000000">))</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">if $ lv</font> <font color="#000000">(</font> <font color="#800000">% loadFileSuccess</font> <font color="#000000">),</font> <font color="#0000ff">$ lg</font> <font color="#000000">(</font> <font color="#800000">% loadFileSuccess</font> <font color="#000000">, 1)</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#008000">#;</font>  <font color="#008000">The file was received successfully, we will answer about the successful reception and send the name of the file and its size.</font> <font color="#008000"><br></font>  <font color="#0000ff">w</font> <font color="#008000">"{" "success" ": true,"</font> <font color="#000000">,</font> <font color="#000000"><br></font>  <font color="#008000">"" "fileName" ":" ""</font> <font color="#000000">_</font> <font color="#0000ff">$ lg</font> <font color="#000000">(</font> <font color="#800000">% loadFileSuccess</font> <font color="#000000">, 2) _</font> <font color="#008000">"" ","</font> <font color="#000000">,</font> <font color="#000000"><br></font>  <font color="#008000">"" "fileSize" ":" ""</font> <font color="#000000">_</font> <font color="#0000ff">$ lg</font> <font color="#000000">(</font> <font color="#800000">% loadFileSuccess</font> <font color="#000000">, 3) _</font> <font color="#008000">"" "}"</font> <font color="#008000"><br></font>  <font color="#800080">}</font> <font color="#0000ff">else</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#008000">#;</font>  <font color="#008000">An error occurred while receiving the file</font> <font color="#008000"><br></font>  <font color="#0000ff">w</font> <font color="#008000">"{" "error" ":" "Error load file" "}"</font> <font color="#008000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">q $$$ OK</font> <font color="#0000ff"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#008000">#;</font>  <font color="#008000">HTML form for sending files</font> <font color="#008000"><br></font>  <font color="#800080">&amp; html &lt;&lt;</font> <font color="#000000">! DOCTYPE HTML&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#ff0000">html</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;! -</font> <font color="#008000">Connect the Fine Uploader style</font> <font color="#000000">-&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#ff0000">link</font> <font color="#000080">href</font> <font color="#000000">=</font> <font color="#800080">"fileuploader.css"</font> <font color="#000080">rel</font> <font color="#000000">=</font> <font color="#800080">"stylesheet"</font> <font color="#000080">type</font> <font color="#000000">=</font> <font color="#800080">"text / css"</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;! -</font> <font color="#008000">Bootstrap styles, for visual design</font> <font color="#000000">-&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#ff0000">link</font> <font color="#000080">href</font> <font color="#000000">=</font> <font color="#800080">"bootstrap / css / bootstrap.min.css"</font> <font color="#000080">rel</font> <font color="#000000">=</font> <font color="#800080">"stylesheet"</font> <font color="#000080">type</font> <font color="#000000">=</font> <font color="#800080">"text / css"</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#ff0000">link</font> <font color="#000080">href</font> <font color="#000000">=</font> <font color="#800080">"bootstrap / css / bootstrap-responsive.min.css"</font> <font color="#000080">rel</font> <font color="#000000">=</font> <font color="#800080">"stylesheet"</font> <font color="#000080">type</font> <font color="#000000">=</font> <font color="#800080">"text / css"</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#ff0000">body</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;! -</font> <font color="#008000">This will be the field for the file</font> <font color="#000000">-&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#ff0000">div</font> <font color="#000080">id</font> <font color="#000000">=</font> <font color="#800080">"thumbnail-fine-uploader"</font> <font color="#000080">style</font> <font color="#000000">=</font> <font color="#800080">'width: 400px'</font> <font color="#000000">&gt; &lt;/</font> <font color="#ff0000">div</font> <font color="#000000">&gt;</font> <font color="#000000">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </font>  <font color="#000000">&lt;! -</font> <font color="#008000">jQuery</font> <font color="#000000">-&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#ff0000">script</font> <font color="#000080">type</font> <font color="#000000">=</font> <font color="#800080">"text / javascript"</font> <font color="#000080">src</font> <font color="#000000">=</font> <font color="#800080">"jquery.js"</font> <font color="#000000">&gt; &lt;/</font> <font color="#ff0000">script</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;! -</font> <font color="#008000">script Fine Uploader</font> <font color="#000000">-&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#ff0000">script</font> <font color="#000080">type</font> <font color="#000000">=</font> <font color="#800080">"text / javascript"</font> <font color="#000080">src</font> <font color="#000000">=</font> <font color="#800080">"fileuploader.js"</font> <font color="#000000">&gt; &lt;/</font> <font color="#ff0000">script</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;! -</font> <font color="#008000">Bootstrap script</font> <font color="#000000">-&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#ff0000">script</font> <font color="#000080">type</font> <font color="#000000">=</font> <font color="#800080">"text / javascript"</font> <font color="#000080">src</font> <font color="#000000">=</font> <font color="#800080">"bootstrap / js / bootstrap.min.js"</font> <font color="#000000">&gt; &lt;/</font> <font color="#ff0000">script</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#ff0000">script</font> <font color="#000080">type</font> <font color="#000000">=</font> <font color="#800080">"text / javascript"</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#008000">// Run Fine Uploader</font> <font color="#008000"><br></font>  <font color="#000000">$ (document) .ready (</font> <font color="#008080">function</font> <font color="#000000">() {</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">thumbnailuploader</font> <font color="#000080">=</font> <font color="#800000">new</font> <font color="#000000">qq.FileUploader ({</font> <font color="#000000"><br></font>  <font color="#000000">element: $ (</font> <font color="#800000">'# thumbnail-fine-uploader'</font> <font color="#000000">) [</font> <font color="#000080">0</font> <font color="#000000">],</font> <font color="#008000">// our element</font> <font color="#008000"><br></font>  <font color="#008000">// here, we specify the URL of the file uploader page, in this case it is the current class</font> <font color="#008000"><br></font>  <font color="#000000">action:</font> <font color="#800000">'# (</font> <font color="#000000">..</font> <font color="#0000ff">% ClassName</font> <font color="#000000">(1) _</font> <font color="#008000">".cls"</font> <font color="#800000">) #'</font> <font color="#000000">,</font> <font color="#000000"><br></font>  <font color="#008000">// Additional parameters passed with the file</font> <font color="#008000"><br></font>  <font color="#000000">params: {</font> <font color="#000000"><br></font>  <font color="#000000">loadFile:</font> <font color="#000080">1</font> <font color="#000080"><br></font>  <font color="#000000">},</font> <font color="#000000"><br></font>  <font color="#008000">// Allow downloading multiple files</font> <font color="#008000"><br></font>  <font color="#000000">multiple: true</font> <font color="#000000"><br></font>  <font color="#008000">// Valid file types</font> <font color="#008000"><br></font>  <font color="#000000">allowedExtensions: [</font> <font color="#800000">'jpeg'</font> <font color="#000000">,</font> <font color="#800000">'jpg'</font> <font color="#000000">,</font> <font color="#800000">'gif'</font> <font color="#000000">,</font> <font color="#800000">'png'</font> <font color="#000000">],</font> <font color="#000000"><br></font>  <font color="#008000">// File size limit</font> <font color="#008000"><br></font>  <font color="#000000">sizeLimit:</font> <font color="#000080">5120000</font> <font color="#000000">,</font> <font color="#000000"><br></font>  <font color="#000000">onComplete:</font> <font color="#008080">function</font> <font color="#000000">(id, fileName, responseJSON) {</font> <font color="#000000"><br></font>  <font color="#008000">if</font> <font color="#000000">(responseJSON.success) {</font> <font color="#000000"><br></font>  <font color="#008000">// File successfully sent, add information</font> <font color="#008000"><br></font>  <font color="#000000">$ (</font> <font color="#800000">'# thumbnail-fine-uploader'</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">.append (</font> <font color="#800000">'&lt;div&gt; &lt;span&gt; Loaded File:'</font> <font color="#000080">+</font> <font color="#000000">responseJSON.fileName</font> <font color="#000080">+</font> <font color="#800000">'&lt;/ span&gt;'</font> <font color="#000080">+</font> <font color="#000080"><br></font>  <font color="#800000">'&lt;span&gt; File size:'</font> <font color="#000080">+</font> <font color="#000000">responseJSON.fileSize</font> <font color="#000080">+</font> <font color="#800000">'&lt;/ span&gt; &lt;/ div&gt;'</font> <font color="#000000">);</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">});</font> <font color="#000000"><br></font>  <font color="#000000">});</font> <font color="#000000"><br></font>  <font color="#000000">&lt;/</font> <font color="#ff0000">script</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;/</font> <font color="#ff0000">body</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;/</font> <font color="#ff0000">html</font> <font color="#800080">&gt;&gt;</font> <font color="#800080"><br></font>  <font color="#0000ff">Quit $$$ OK</font> <font color="#0000ff"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">OnPreHTTP ()</font> <font color="#000080">As% Boolean</font> <font color="#000000">[</font> <font color="#000080">ServerOnly</font> <font color="#000000">= 1]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#008000">#;</font>  <font color="#008000">File transferred</font> <font color="#008000"><br></font>  <font color="#0000ff">if $ d</font> <font color="#000000">(</font> <font color="#800000">% request</font> <font color="#000000">.</font> <font color="#0000ff">Data</font> <font color="#000000">(</font> <font color="#008000">"loadFile"</font> <font color="#000000">))</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">s</font> <font color="#800000">% loadFileSuccess</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#008000">#;</font>  <font color="#008000">file field</font> <font color="#008000"><br></font>  <font color="#0000ff">s</font> <font color="#800000">FieldName</font> <font color="#000000">=</font> <font color="#008000">"qqfile"</font> <font color="#008000"><br></font>  <font color="#008000">#;</font>  <font color="#008000">get the file contents</font> <font color="#008000"><br></font>  <font color="#0000ff">i</font> <font color="#800000">% request</font> <font color="#000000">.</font>  <font color="#0000ff">IsDefinedMimeData</font> <font color="#000000">(</font> <font color="#800000">FieldName</font> <font color="#000000">, 1)</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">s</font> <font color="#800000">ContentType</font> <font color="#000000">=</font> <font color="#800000">% request</font> <font color="#000000">.</font>  <font color="#0000ff">MimeData</font> <font color="#000000">(</font> <font color="#800000">FieldName</font> <font color="#000000">, 1).</font>  <font color="#0000ff">ContentType</font> <font color="#0000ff"><br></font>  <font color="#0000ff">s</font> <font color="#800000">Content</font> <font color="#000000">=</font> <font color="#800000">% request</font> <font color="#000000">.</font>  <font color="#0000ff">MimeData</font> <font color="#000000">(</font> <font color="#800000">FieldName</font> <font color="#000000">, 1)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#0000ff">else</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">s</font> <font color="#800000">ContentType</font> <font color="#000000">=</font> <font color="#800000">% request</font> <font color="#000000">.</font>  <font color="#0000ff">ContentType</font> <font color="#0000ff"><br></font>  <font color="#0000ff">s</font> <font color="#800000">Content</font> <font color="#000000">=</font> <font color="#800000">% request</font> <font color="#000000">.</font>  <font color="#0000ff">Content</font> <font color="#0000ff"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">s</font> <font color="#000000">:</font> <font color="#800000">FieldName</font> <font color="#000000">'=</font> <font color="#008000">""</font> <font color="#800000">fileName</font> <font color="#000000">=</font> <font color="#0000ff">$ g</font> <font color="#000000">(</font> <font color="#800000">% request</font> <font color="#000000">.</font> <font color="#0000ff">Data</font> <font color="#000000">(</font> <font color="#800000">FieldName</font> <font color="#000000">, 1))</font> <font color="#000000"><br></font>  <font color="#008000">#;</font>  <font color="#008000">If the file is received, and it is not of zero size, we will collect information on it.</font> <font color="#008000"><br></font>  <font color="#0000ff">i $ isobject</font> <font color="#000000">(</font> <font color="#800000">Content</font> <font color="#000000">),</font> <font color="#800000">Content</font> <font color="#000000">.</font>  <font color="#0000ff">Size</font> <font color="#000000">&gt; 0</font> <font color="#0000ff">s</font> <font color="#800000">% loadFileSuccess</font> <font color="#000000">=</font> <font color="#0000ff">$ lb</font> <font color="#000000">(1,</font> <font color="#0000ff">$ g</font> <font color="#000000">(</font> <font color="#800000">fileName</font> <font color="#000000">),</font> <font color="#800000">Content</font> <font color="#000000">.</font> <font color="#0000ff">Size</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">q</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">q</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000000">}</font> </div></div><br><br>  Below is an example using ZEN technology.  The example uses only one page for displaying the file upload form, and for uploading the file to the server itself and returning the status. <br><div class="spoiler">  <b class="spoiler_title">ZEN example</b> <div class="spoiler_text">  <font color="#000080">/// Created using the page template: Default</font> <font color="#000080"><br></font>  <font color="#000080">Class habr.ZENFileUpload Extends% ZEN.Component.page</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br><br></font>  <font color="#000080">/// Display name for the new application.</font> <font color="#000080"><br></font>  <font color="#000080">Parameter</font> <font color="#000000">PAGENAME =</font> <font color="#800080">"Test FileUploader"</font> <font color="#000000">;</font> <font color="#000000"><br><br></font>  <font color="#000080">/// Styles</font> <font color="#000080"><br></font>  <font color="#000080">Parameter</font> <font color="#000000">CSSINCLUDES</font> <font color="#000080">As</font> <font color="#000000">STRING =</font> <font color="#800080">"fileuploader.css, bootstrap / css / bootstrap.min.css, bootstrap / css / bootstrap-responsive.min.css"</font> <font color="#000000">;</font> <font color="#000000"><br><br></font>  <font color="#000080">/// JS files</font> <font color="#000080"><br></font>  <font color="#000080">Parameter</font> <font color="#000000">JSINCLUDES</font> <font color="#000080">As</font> <font color="#000000">STRING =</font> <font color="#800080">"jquery.js, fileuploader.js, bootstrap / js / bootstrap.min.js"</font> <font color="#000000">;</font> <font color="#000000"><br><br></font>  <font color="#000080">/// This XML block describes the content of this page.</font> <font color="#000080"><br></font>  <font color="#000080">XData</font> <font color="#000000">Contents [</font> <font color="#000080">XMLNamespace</font> <font color="#000000">=</font> <font color="#800080">" <a href="http://www.intersystems.com/zen%2522%25C2%25A0">www.intersystems.com/zen"</a></font> <font color="#000000">]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">page</font> <font color="#800000">xmlns</font> <font color="#000000">=</font> <font color="#008000">" <a href="http://www.intersystems.com/zen%2522%25C2%25A0">www.intersystems.com/zen"</a></font> <font color="#800000">title</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#808000">&lt;! - Block to display file upload field -&gt;</font> <font color="#808000"><br></font>  <font color="#000000">&lt;</font> <font color="#000080">pane</font> <font color="#800000">id</font> <font color="#000000">=</font> <font color="#008000">"thumbnail-fine-uploader"</font> <font color="#800000">width</font> <font color="#000000">=</font> <font color="#008000">"400px"</font> <font color="#000000">/&gt;</font> <font color="#000000"><br></font>  <font color="#000000">&lt;/</font> <font color="#000080">page</font> <font color="#000000">&gt;</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">/// After loading the page, run the component</font> <font color="#000080"><br></font>  <font color="#000080">ClientMethod</font> <font color="#000000">onloadHandler () [</font> <font color="#000080">Language</font> <font color="#000000">= javascript]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#008080">var</font> <font color="#000000">thumbnailuploader</font> <font color="#000080">=</font> <font color="#800000">new</font> <font color="#000000">qq.FileUploader ({</font> <font color="#000000"><br></font>  <font color="#000000">element: $ (</font> <font color="#800000">'# thumbnail-fine-uploader'</font> <font color="#000000">) [</font> <font color="#000080">0</font> <font color="#000000">],</font> <font color="#008000">// our element</font> <font color="#008000"><br></font>  <font color="#008000">// here, we specify the URL of the file uploader page, in this case it is the current class</font> <font color="#008000"><br></font>  <font color="#000000">action:</font> <font color="#800000">'?'</font>  <font color="#000000">,</font> <font color="#000000"><br></font>  <font color="#008000">// Additional parameters passed with the file</font> <font color="#008000"><br></font>  <font color="#000000">params: {</font> <font color="#000000"><br></font>  <font color="#000000">loadFile:</font> <font color="#000080">1</font> <font color="#000080"><br></font>  <font color="#000000">},</font> <font color="#000000"><br></font>  <font color="#008000">// Allow downloading multiple files</font> <font color="#008000"><br></font>  <font color="#000000">multiple: true</font> <font color="#000000"><br></font>  <font color="#008000">// Valid file types</font> <font color="#008000"><br></font>  <font color="#000000">allowedExtensions: [</font> <font color="#800000">'jpeg'</font> <font color="#000000">,</font> <font color="#800000">'jpg'</font> <font color="#000000">,</font> <font color="#800000">'gif'</font> <font color="#000000">,</font> <font color="#800000">'png'</font> <font color="#000000">],</font> <font color="#000000"><br></font>  <font color="#008000">// File size limit</font> <font color="#008000"><br></font>  <font color="#000000">sizeLimit:</font> <font color="#000080">5120000</font> <font color="#000000">,</font> <font color="#000000"><br></font>  <font color="#000000">onComplete:</font> <font color="#008080">function</font> <font color="#000000">(id, fileName, responseJSON) {</font> <font color="#000000"><br></font>  <font color="#008000">if</font> <font color="#000000">(responseJSON.success) {</font> <font color="#000000"><br></font>  <font color="#008000">// File successfully sent, add information</font> <font color="#008000"><br></font>  <font color="#000000">$ (</font> <font color="#800000">'# thumbnail-fine-uploader'</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">.append (</font> <font color="#800000">'&lt;div&gt; &lt;span&gt; Loaded File:'</font> <font color="#000080">+</font> <font color="#000000">responseJSON.fileName</font> <font color="#000080">+</font> <font color="#800000">'&lt;/ span&gt;'</font> <font color="#000080">+</font> <font color="#000080"><br></font>  <font color="#800000">'&lt;span&gt; File size:'</font> <font color="#000080">+</font> <font color="#000000">responseJSON.fileSize</font> <font color="#000080">+</font> <font color="#800000">'&lt;/ span&gt; &lt;/ div&gt;'</font> <font color="#000000">);</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">});</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">/// Zen page notification of an HTTP request.</font>  <font color="#000080">This method can be overwritten</font> <font color="#000080"><br></font>  <font color="#000080">/// by subclasses. &lt;br/&gt;</font> <font color="#000080"><br></font>  <font color="#000080">/// This is the standard Zen pre-HTTP processing occurs.</font> <font color="#000080"><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">% OnPreHTTP ()</font> <font color="#000080">As% Boolean</font> <font color="#000000">[</font> <font color="#000080">ServerOnly</font> <font color="#000000">= 1]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#008000">#;</font>  <font color="#008000">File transferred</font> <font color="#008000"><br></font>  <font color="#0000ff">if $ d</font> <font color="#000000">(</font> <font color="#800000">% request</font> <font color="#000000">.</font> <font color="#0000ff">Data</font> <font color="#000000">(</font> <font color="#008000">"loadFile"</font> <font color="#000000">))</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">s</font> <font color="#800000">% loadFileSuccess</font> <font color="#000000">= 0</font> <font color="#000000"><br></font>  <font color="#008000">#;</font>  <font color="#008000">file field</font> <font color="#008000"><br></font>  <font color="#0000ff">s</font> <font color="#800000">FieldName</font> <font color="#000000">=</font> <font color="#008000">"qqfile"</font> <font color="#008000"><br></font>  <font color="#008000">#;</font>  <font color="#008000">get the file contents</font> <font color="#008000"><br></font>  <font color="#0000ff">i</font> <font color="#800000">% request</font> <font color="#000000">.</font>  <font color="#0000ff">IsDefinedMimeData</font> <font color="#000000">(</font> <font color="#800000">FieldName</font> <font color="#000000">, 1)</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">s</font> <font color="#800000">ContentType</font> <font color="#000000">=</font> <font color="#800000">% request</font> <font color="#000000">.</font>  <font color="#0000ff">MimeData</font> <font color="#000000">(</font> <font color="#800000">FieldName</font> <font color="#000000">, 1).</font>  <font color="#0000ff">ContentType</font> <font color="#0000ff"><br></font>  <font color="#0000ff">s</font> <font color="#800000">Content</font> <font color="#000000">=</font> <font color="#800000">% request</font> <font color="#000000">.</font>  <font color="#0000ff">MimeData</font> <font color="#000000">(</font> <font color="#800000">FieldName</font> <font color="#000000">, 1)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#0000ff">else</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">s</font> <font color="#800000">ContentType</font> <font color="#000000">=</font> <font color="#800000">% request</font> <font color="#000000">.</font>  <font color="#0000ff">ContentType</font> <font color="#0000ff"><br></font>  <font color="#0000ff">s</font> <font color="#800000">Content</font> <font color="#000000">=</font> <font color="#800000">% request</font> <font color="#000000">.</font>  <font color="#0000ff">Content</font> <font color="#0000ff"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">s</font> <font color="#000000">:</font> <font color="#800000">FieldName</font> <font color="#000000">'=</font> <font color="#008000">""</font> <font color="#800000">fileName</font> <font color="#000000">=</font> <font color="#0000ff">$ g</font> <font color="#000000">(</font> <font color="#800000">% request</font> <font color="#000000">.</font> <font color="#0000ff">Data</font> <font color="#000000">(</font> <font color="#800000">FieldName</font> <font color="#000000">, 1))</font> <font color="#000000"><br></font>  <font color="#008000">#;</font>  <font color="#008000">If the file is received, and it is not of zero size, we will collect information on it.</font> <font color="#008000"><br></font>  <font color="#0000ff">i $ isobject</font> <font color="#000000">(</font> <font color="#800000">Content</font> <font color="#000000">),</font> <font color="#800000">Content</font> <font color="#000000">.</font>  <font color="#0000ff">Size</font> <font color="#000000">&gt; 0</font> <font color="#0000ff">s</font> <font color="#800000">% loadFileSuccess</font> <font color="#000000">=</font> <font color="#0000ff">$ lb</font> <font color="#000000">(1,</font> <font color="#0000ff">$ g</font> <font color="#000000">(</font> <font color="#800000">fileName</font> <font color="#000000">),</font> <font color="#800000">Content</font> <font color="#000000">.</font> <font color="#0000ff">Size</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">q</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">q</font> <font color="#000000">1</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">/// To process the file download, override the paint drawing method.</font> <font color="#000080"><br></font>  <font color="#000080">Method</font> <font color="#000000">% DrawHTMLPage ()</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#008000">#;</font>  <font color="#008000">If there was a file upload to the server, we‚Äôll return the upload status in JSON format</font> <font color="#008000"><br></font>  <font color="#0000ff">if $ d</font> <font color="#000000">(</font> <font color="#800000">% request</font> <font color="#000000">.</font> <font color="#0000ff">Data</font> <font color="#000000">(</font> <font color="#008000">"loadFile"</font> <font color="#000000">))</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">if $ lv</font> <font color="#000000">(</font> <font color="#800000">% loadFileSuccess</font> <font color="#000000">),</font> <font color="#0000ff">$ lg</font> <font color="#000000">(</font> <font color="#800000">% loadFileSuccess</font> <font color="#000000">, 1)</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#008000">#;</font>  <font color="#008000">The file was received successfully, we will answer about the successful reception and send the name of the file and its size.</font> <font color="#008000"><br></font>  <font color="#0000ff">w</font> <font color="#008000">"{" "success" ": true,"</font> <font color="#000000">,</font> <font color="#000000"><br></font>  <font color="#008000">"" "fileName" ":" ""</font> <font color="#000000">_</font> <font color="#0000ff">$ lg</font> <font color="#000000">(</font> <font color="#800000">% loadFileSuccess</font> <font color="#000000">, 2) _</font> <font color="#008000">"" ","</font> <font color="#000000">,</font> <font color="#000000"><br></font>  <font color="#008000">"" "fileSize" ":" ""</font> <font color="#000000">_</font> <font color="#0000ff">$ lg</font> <font color="#000000">(</font> <font color="#800000">% loadFileSuccess</font> <font color="#000000">, 3) _</font> <font color="#008000">"" "}"</font> <font color="#008000"><br></font>  <font color="#800080">}</font> <font color="#0000ff">else</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#008000">#;</font>  <font color="#008000">An error occurred while receiving the file</font> <font color="#008000"><br></font>  <font color="#0000ff">w</font> <font color="#008000">"{" "error" ":" "Error load file" "}"</font> <font color="#008000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">q</font> <font color="#0000ff"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#008000">#;</font>  <font color="#008000">Otherwise, draw the default page</font> <font color="#008000"><br></font>  <font color="#0000ff">d</font> <font color="#000080">## super</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br><br></font>  <font color="#000080">/// Disable the output of the page formation time at the end</font> <font color="#000080"><br></font>  <font color="#000080">Parameter</font> <font color="#000000">SHOWSTATS</font> <font color="#000080">As</font> <font color="#000000">BOOLEAN =</font> <font color="#000080">0</font> <font color="#000000">;</font> <font color="#000000"><br><br></font>  <font color="#000000">}</font> </div></div><br>  Examples of use are perfectly presented on the <a href="http://fineuploader.com/fine-uploader-demo.html">FineUploader</a> website - there is both an example of downloading a single file, and working with several files, Drag &amp; Drop, outputting download progress. <br>  <a href="https://gist.github.com/f7077e6a1c775de931b2">Sources for the</a> proposed examples without the Bootstrap and Fine Uplaoder files </div><p>Source: <a href="https://habr.com/ru/post/158681/">https://habr.com/ru/post/158681/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../158665/index.html">Can an economist become a professional MMOG player in a short time?</a></li>
<li><a href="../158669/index.html">Logic is a compact selection of the latest gaming and IT industry news.</a></li>
<li><a href="../158673/index.html">Robots driven by thought power</a></li>
<li><a href="../158675/index.html">Unity3D 4.0 release</a></li>
<li><a href="../158679/index.html">Windows 8 and touchscreen without tacha</a></li>
<li><a href="../158683/index.html">Haiku R1 Alpha 4 released</a></li>
<li><a href="../158687/index.html">TradeMac.ru Makes Apple More Affordable</a></li>
<li><a href="../158689/index.html">Samsung did not raise the price of processors and is not going to enter into an alliance with Apple following the example of HTC</a></li>
<li><a href="../158691/index.html">Flash GAMM Kyiv 2012: flash, social, mobile game development conference</a></li>
<li><a href="../158693/index.html">ReSharper 7.1 released</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>