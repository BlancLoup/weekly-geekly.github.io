<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing Your OS: Release 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This series of articles is devoted to low-level programming, that is, computer architecture, device operating systems, programming in assembly languag...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing Your OS: Release 1</h1><div class="post__text post__text-html js-mediator-article">  This series of articles is devoted to low-level programming, that is, computer architecture, device operating systems, programming in assembly language and related areas.  So far, two habrausers, <a href="https://habr.com/ru/users/iley/" class="user_link">iley</a> and <a href="https://habr.com/ru/users/pehat/" class="user_link">pehat,</a> are engaged in writing.  For many high school students, students, and professional programmers, these topics are very difficult to learn.  There is a lot of literature and courses on low-level programming, but it‚Äôs difficult to make a complete and comprehensive picture.  Having read one or two books on assembler and operating systems, it is difficult, at least in general terms, to imagine how this complex system of iron, silicon and many programs - a computer - actually works. <br><br>  Everyone solves the problem of learning in their own way.  Someone reads a lot of literature, someone tries to quickly go to practice and understand along the way, someone tries to explain to friends everything that he learns.  And we decided to combine these approaches.  So, in this course of articles, we will demonstrate step by step how to write a simple operating system.  The articles will be of an overview nature, that is, they will not have comprehensive theoretical information, but we will always try to provide links to good theoretical materials and answer all the questions that arise.  We do not have a clear plan, so many important decisions will be made along the way, taking into account your feedback. <br><a name="habracut"></a><br>  Perhaps, we will deliberately start the development process into a dead end in order to allow you and yourself to fully understand all the consequences of a wrong decision, and also to hone some technical skills on it.  So do not take our decisions as the only true and blindly believe us.  We emphasize once again that we expect readers to be active in the discussion of articles, which should greatly influence the overall process of developing and writing subsequent articles.  Ideally, I would like some readers to join the system over time. <br><br>  We will assume that the reader is already familiar with the fundamentals of assembler and C languages, as well as the basic concepts of computer architecture.  That is, we will not explain what a register is or, say, RAM.  If you do not have enough knowledge, you can always refer to additional literature.  A short list of references and links to sites with good articles are at the end of the article.  It is also advisable to be able to use Linux, since all compilation instructions will be provided specifically for this system. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And now - more to the point.  In the rest of the article we will write the classic program ‚ÄúHello World‚Äù.  Our Halloween world will be a little bit specific.  It will not run from any operating system, but directly, so to speak, ‚Äúon bare metal.‚Äù  Before proceeding directly to writing the code, let's see how specifically we are trying to do it.  And for this you need to consider the process of booting the computer. <br><br>  So, take your favorite computer and press the biggest button on the system unit.  We see a funny screensaver, the system unit happily squeals with the speaker and after some time the operating system loads.  As you understand, the operating system is stored on the hard disk, and here the question arises: how did the operating system magically boot into RAM and start to run? <br><br>  You should know: the system that exists on any computer is responsible for this, and the name to it is not, not Windows, that you use the language - it is called the BIOS.  Its name is deciphered as the Basic Input-Output System, that is, the basic input-output system.  The BIOS is on a small microcircuit on the motherboard and starts immediately after pressing the large ON button.  BIOS has three main tasks: <ol><li>  Detect all connected devices (processor, keyboard, monitor, RAM, video card, head, hands, wings, legs and tails ...) and check them for operability.  The POST (Power On Self Test) program is responsible for this.  If vital iron is not detected, then no software can help, and at this point the system speaker squeaks something ominous and it won't get to the OS at all.  Let's not talk about the sad, suppose that we have a fully working computer, rejoice and proceed to consider the second function of the BIOS: </li><li>  Providing the operating system with a basic set of functions for working with hardware.  For example, through the functions of the BIOS, you can display text on the screen or read data from the keyboard.  Therefore, it is called the basic input-output system.  Typically, the operating system accesses these functions through interrupts. </li><li>  Run the operating system loader.  In this case, as a rule, the boot sector is read - the first sector of the storage medium (floppy disk, hard disk, compact disk, flash drive).  Media polling order can be set in BIOS SETUP.  The boot sector contains a program, sometimes called the primary loader.  Roughly speaking, the task of the bootloader is to start the operating system.  The process of loading the operating system can be very specific and strongly depends on its features.  Therefore, the primary bootloader is written directly by the OS developers and, during installation, is written to the boot sector.  When the boot loader starts, the processor is in real mode. </li></ol><br>  The sad news: the size of the initial loader should be only 512 bytes.  Why so little?  To do this, we need to become familiar with the device floppy.  Here is an informative picture: <br><div style="text-align:center;"><img src="https://habrastorage.org/storage/habraeffect/7e/09/7e094e59caf8c77207fe50d13936a69f.png"></div><br>  The picture shows the surface of the disk drive.  Floppy has 2 surfaces.  On each surface there are ring-shaped tracks (tracks).  Each track is divided into small arched pieces, called sectors.  So, historically, the floppy sector has a size of 512 bytes.  The very first sector on the disk, the boot sector, is read by the BIOS in the zero memory segment at offset 0x7C00, and then control is transferred to this address.  The bootloader usually loads into memory not the OS itself, but another bootloader program stored on the disk, but for some reason (most likely, this reason is the size) does not fit into one sector.  And since, for the time being, the role of our OS is fulfilled by the banal Halloween world, our main goal is to make the computer believe in the existence of our OS, even if it is in one sector, and run it. <br><br>  How does the boot sector?  On a PC, the only requirement for the boot sector is the content in its last two bytes of the values ‚Äã‚Äã0x55 and 0xAA - the signatures of the boot sector.  So, it is more or less clear what we need to do.  Let's write the code!  The code above is written for the <a href="http://www.tortall.net/projects/yasm/">yasm</a> assembler. <br><br><pre><code class="plaintext">section .text
     use16
     org  0x7C00  ;      0x7C00
start:
     mov  ax, cs
     mov  ds, ax  ;   
 
     mov  si, message
     cld              ;    
     mov  ah, 0x0E    ;   BIOS
     mov  bh, 0x00    ;  
puts_loop:
     lodsb            ;     al
     test al, al      ;     
     jz   puts_loop_exit
     int  0x10        ;   BIOS
     jmp  puts_loop
puts_loop_exit:
     jmp  $           ;  
 
message:
     db   'Hello World!', 0
finish:
     times 0x1FE-finish+start db 0
     db   0x55, 0xAA  ;   
</code></pre><br>
<br>
      .  <code>org 0x7C00</code>   ,   (   ,   )        (<code>puts_loop, puts_loop_exit, message</code>).     ,         0x7C00.<br>
 <br>
<pre><code class="plaintext">    mov         ax, cs
    mov         ds, ax
</code></pre><br>
    (<code>ds</code>)    (<code>cs</code>),      ,      . <br>
<br>
      ¬´Hello World!¬ª.     <code>0x0E</code>  <code>0x10</code>.    :<br>
<code>AH = 0x0E</code> ( )<br>
<code>BH = </code>  (  ,  0)<br>
<code>AL = </code>ASCII- <br>
<br>
  ¬´<code>jmp $</code>¬ª  .  ,     .     ,  .<br>
<br>
  ¬´<code>times 0x1FE-finish+start db 0</code>¬ª      (    ) .    ,            .<br>
<br>
    ,      .    ,  ,  ‚Äî   <a href="http://www.tortall.net/projects/yasm/">yasm</a>.      Linux.     :<br>
<br>
<pre><code class="plaintext">$ yasm -f bin -o hello.bin hello.asm</code></pre><br>
<br>
  hello.bin      .     (,  fd     ).<br>
<br>
<pre><code class="plaintext">$ dd if=hello.bin of=/dev/fd</code></pre><br>
<br>
        ,    , , <a href="http://wiki.qemu.org/Main_Page">qemu</a>  <a href="http://virtualbox.org/">VirtualBox</a>.              ¬´ ¬ª.<br>
      :<br>
<br>
<pre><code class="plaintext">$ dd if=/dev/zero of=disk.img bs=1024 count=1440</code></pre><br>
<br>
      :<br>
<pre><code class="plaintext">$ dd if=hello.bin of=disk.img conv=notrunc</code></pre><br>
<br>
    qemu:<br>
<pre><code class="plaintext">$ qemu -fda disk.img -boot a</code></pre><br>
<br>
      qemu    ¬´Hello World!¬ª.     .       .<br>
<br>
<b></b><ol>
<li>  :<ul>
<li> . . ¬´Assembler  DOS, Windows  Unix¬ª</li>
<li><a href="http://wasm.ru/article.php%3Farticle%3D1022001">   </a></li>
<li><a href="http://wasm.ru/article.php%3Farticle%3D1022003">    DOS</a></li>
</ul></li>
<li>  :<ul>
<li> .,  . ¬´  C¬ª</li>
<li> . ¬´   C¬ª</li>
</ul></li>
<li>   :<ul>
<li> . ¬´  ¬ª</li>
<li> . ¬´ :   ¬ª</li>
<li> .,  . ¬´  ¬ª</li>
<li><a href="http://osdev.org/">http://osdev.org</a></li>
</ul></li>
<li>  :<ul>
<li> . ¬´ ¬ª</li>
<li> . ¬´  IBM PC. ¬ª</li>
<li> . ¬´.   ¬ª</li>
</ul></li>
<li> <ul>
<li><a href="http://webpages.charter.net/danrollins/techhelp/index.htm">Dan Rollins‚Äôs TechHelp</a></li>
<li><a href="http://www.intel.com/products/processor/manuals/">Intel Software Developer Manual</a></li>
</ul></li>
</ol></div><p>Source: <a href="https://habr.com/ru/post/101810/">https://habr.com/ru/post/101810/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../101798/index.html">We buy a used SLR</a></li>
<li><a href="../101805/index.html">To live in the App Store is good. Shop of programs "At Stevie" eyes of the developer</a></li>
<li><a href="../101806/index.html">ABBYY Lingvo for Mac Review</a></li>
<li><a href="../101808/index.html">How I won the trial in Makhost</a></li>
<li><a href="../101809/index.html">A childless family of millionaires built an "intelligent" robot</a></li>
<li><a href="../101815/index.html">StarCraft 2 Review</a></li>
<li><a href="../101817/index.html">Prevent hidden Nmap scanning in Linux</a></li>
<li><a href="../101818/index.html">Cartesian wood: Part 1. Description, operations, applications</a></li>
<li><a href="../101819/index.html">Accounting for Internet traffic tenants (netflow)</a></li>
<li><a href="../101821/index.html">Where are you going, software developer?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>