<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Yii2 and multilingual organization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The long-awaited release of Yii 2.0 Beta gave an impetus to many developers using Yii to switch to the second version of the framework. The developers...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Yii2 and multilingual organization</h1><div class="post__text post__text-html js-mediator-article">  The long-awaited release of Yii 2.0 Beta gave an impetus to many developers using Yii to switch to the second version of the framework.  The developers of the framework indicated that they would try not to touch backward compatibility and would mostly concentrate on correcting errors and complete the documentation.  This gives even greater impetus to the use of Yii2 in real projects. <br><br>  We decided to keep up with the innovations and chose the second version of the wonderful framework Yii.  When developing the project, it became necessary to organize multilingualism on the site. <br><a name="habracut"></a><br><h4>  Formulation of the problem </h4><br>  1. The number of languages ‚Äã‚Äãis unlimited. <br>  2. Website URLs are presented as CNC and SEO optimized.  View links: <br>  <a href="http://example.com/en/mypage">example.com/en/mypage</a> <br>  <a href="http://example.com/ru/mypage">example.com/ru/mypage</a> <br>  <a href="http://example.com/de/mypage">example.com/de/mypage</a> <br>  3. Minimal changes in the work with the framework.  The resource for the link <a href="http://example.com/mypage">example.com/mypage</a> should be given in the default language.  Routing rules should not change depending on the number of languages. <br><br><h4>  Language storage </h4><br>  Assuming that the number of languages ‚Äã‚Äãis unlimited and the default language must be indicated, it was decided to store this list in a separate database table.  Create a lang table with the following fields: <br>  id - language identifier <br>  url - the letter identifier of the language to display in the URL (ru, en, de, ...) <br>  local - user language (locale) <br>  name - name (English, Russian, ...) <br>  default - flag indicating the default language (1 - default language) <br>  date_update - update date (in unixtimestamp) <br>  date_create - creation date (in unixtimestamp) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`lang`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`url`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`local`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`default`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">smallint</span></span>(<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">`date_update`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`date_create`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8 AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span> ;</code> </pre> <br><br>  And we add two languages ‚Äã‚Äãto the table, considering that one must be from the value default = 1: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`lang`</span></span> (<span class="hljs-string"><span class="hljs-string">`url`</span></span>, <span class="hljs-string"><span class="hljs-string">`local`</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span>, <span class="hljs-string"><span class="hljs-string">`default`</span></span>, <span class="hljs-string"><span class="hljs-string">`date_update`</span></span>, <span class="hljs-string"><span class="hljs-string">`date_create`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">'en'</span></span>, <span class="hljs-string"><span class="hljs-string">'en-EN'</span></span>, <span class="hljs-string"><span class="hljs-string">'English'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">UNIX_TIMESTAMP</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">UNIX_TIMESTAMP</span></span>()), (<span class="hljs-string"><span class="hljs-string">'ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'ru-RU'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">UNIX_TIMESTAMP</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">UNIX_TIMESTAMP</span></span>());</code> </pre><br><br>  Or create a migration by running the php command yii migrate / create lang.  Insert into the created file: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safeUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $tableOptions = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;driverName === <span class="hljs-string"><span class="hljs-string">'mysql'</span></span>) { $tableOptions = <span class="hljs-string"><span class="hljs-string">'CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE=InnoDB'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createTable(<span class="hljs-string"><span class="hljs-string">'{{%lang}}'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; Schema::TYPE_PK, <span class="hljs-string"><span class="hljs-string">'url'</span></span> =&gt; Schema::TYPE_STRING . <span class="hljs-string"><span class="hljs-string">'(255) NOT NULL'</span></span>, <span class="hljs-string"><span class="hljs-string">'local'</span></span> =&gt; Schema::TYPE_STRING . <span class="hljs-string"><span class="hljs-string">'(255) NOT NULL'</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; Schema::TYPE_STRING . <span class="hljs-string"><span class="hljs-string">'(255) NOT NULL'</span></span>, <span class="hljs-string"><span class="hljs-string">'default'</span></span> =&gt; Schema::TYPE_SMALLINT . <span class="hljs-string"><span class="hljs-string">' NOT NULL DEFAULT 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'date_update'</span></span> =&gt; Schema::TYPE_INTEGER . <span class="hljs-string"><span class="hljs-string">' NOT NULL'</span></span>, <span class="hljs-string"><span class="hljs-string">'date_create'</span></span> =&gt; Schema::TYPE_INTEGER . <span class="hljs-string"><span class="hljs-string">' NOT NULL'</span></span>, ], $tableOptions); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;batchInsert(<span class="hljs-string"><span class="hljs-string">'lang'</span></span>, [<span class="hljs-string"><span class="hljs-string">'url'</span></span>, <span class="hljs-string"><span class="hljs-string">'local'</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'default'</span></span>, <span class="hljs-string"><span class="hljs-string">'date_update'</span></span>, <span class="hljs-string"><span class="hljs-string">'date_create'</span></span>], [ [<span class="hljs-string"><span class="hljs-string">'en'</span></span>, <span class="hljs-string"><span class="hljs-string">'en-EN'</span></span>, <span class="hljs-string"><span class="hljs-string">'English'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, time(), time()], [<span class="hljs-string"><span class="hljs-string">'ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'ru-RU'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, time(), time()], ]); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safeDown</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;dropTable(<span class="hljs-string"><span class="hljs-string">'{{%lang}}'</span></span>); }</code> </pre><br><br>  Apply migration with the php yii migrate command. <br><br><h4>  Language model </h4><br>  Using <a href="http://www.yiiframework.com/doc-2.0/guide-start-gii.html">gii,</a> create a Lang model and generate a CRUD. <br>  We add behavior to the model to automatically update the date when editing and creating an entry in the lang table: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">behaviors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'timestamp'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'yii\behaviors\TimestampBehavior'</span></span>, <span class="hljs-string"><span class="hljs-string">'attributes'</span></span> =&gt; [ \yii\db\ActiveRecord::EVENT_BEFORE_INSERT =&gt; [<span class="hljs-string"><span class="hljs-string">'date_create'</span></span>, <span class="hljs-string"><span class="hljs-string">'date_update'</span></span>], \yii\db\ActiveRecord::EVENT_BEFORE_UPDATE =&gt; [<span class="hljs-string"><span class="hljs-string">'date_update'</span></span>], ], ], ]; }</code> </pre><br><br>  Also add helper methods for working with a language object in the Lang model: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//,      static $current = null; //    static function getCurrent() { if( self::$current === null ){ self::$current = self::getDefaultLang(); } return self::$current; } //       static function setCurrent($url = null) { $language = self::getLangByUrl($url); self::$current = ($language === null) ? self::getDefaultLang() : $language; Yii::$app-&gt;language = self::$current-&gt;local; } //     static function getDefaultLang() { return Lang::find()-&gt;where('`default` = :default', [':default' =&gt; 1])-&gt;one(); } //      static function getLangByUrl($url = null) { if ($url === null) { return null; } else { $language = Lang::find()-&gt;where('url = :url', [':url' =&gt; $url])-&gt;one(); if ( $language === null ) { return null; }else{ return $language; } } }</span></span></code> </pre><br><br><h4>  URL Formation </h4><br>  <a href="http://www.yiiframework.com/doc-2.0/guide-runtime-url-handling.html">URL Manager (urlManager)</a> is an embedded component of the application for creating URLs.  Through this component all URLs are created in the application.  To add a prefix of the alphabetic language identifier to the URL, simply override the <a href="http://www.yiiframework.com/doc-2.0/yii-web-urlmanager.html">createUrl</a> method of the <a href="http://www.yiiframework.com/doc-2.0/yii-web-urlmanager.html">UrlManager</a> class and specify the URL manager to be used in the application configuration. <br><br>  In the components block of the config / main.php configuration file, add: <br><br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">'urlManager'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'enablePrettyUrl'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'showScriptName'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-string"><span class="hljs-string">'class'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'frontend\components\LangUrlManager'</span></span>, <span class="hljs-string"><span class="hljs-string">'rules'</span></span>=&gt;[ <span class="hljs-string"><span class="hljs-string">'/'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'site/index'</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;controller:\w+&gt;/&lt;action:\w+&gt;/*'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'&lt;controller&gt;/&lt;action&gt;'</span></span>, ] ],</code> </pre><br><br>  Create the components / LangUrlManager.php file and override createUrl: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">frontend</span></span>\<span class="hljs-title"><span class="hljs-title">components</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">web</span></span>\<span class="hljs-title"><span class="hljs-title">UrlManager</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">frontend</span></span>\<span class="hljs-title"><span class="hljs-title">models</span></span>\<span class="hljs-title"><span class="hljs-title">Lang</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LangUrlManager</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UrlManager</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($params)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($params[<span class="hljs-string"><span class="hljs-string">'lang_id'</span></span>]) ){ <span class="hljs-comment"><span class="hljs-comment">//   ,       , //      $lang = Lang::findOne($params['lang_id']); if( $lang === null ){ $lang = Lang::getDefaultLang(); } unset($params['lang_id']); } else { //    ,      $lang = Lang::getCurrent(); } $url = parent::createUrl($params); return $url == '/' ? '/'.$lang-&gt;url : '/'.$lang-&gt;url.$url; } }</span></span></code> </pre><br><br><h4>  Language definitions </h4><br>  Information about the language identifier is stored only in the URL.  Accordingly, the current language can only be determined by parsing the URL.  To do this, override the method <a href="http://www.yiiframework.com/doc-2.0/yii-web-request.html">RequestPathInfo's</a> class and specify in the application's configuration file we specify the request component used.  Method resolvePathInfo - returns part of the URL ($ pathInfo) to the "?"  and after the login script. <br><br>  Not to rewrite the rules in UrlManager, taking into account the alphabetic identifier of the language, its (alphabetic identifier) ‚Äã‚Äãcan be removed from $ pathInfo, set the current language via Lang :: setCurrent and return $ pathInfo, but without the language prefix. <br><br>  Create the components / LangRequest.php file and override the resolvePathInfo: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">frontend</span></span>\<span class="hljs-title"><span class="hljs-title">components</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Yii</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">web</span></span>\<span class="hljs-title"><span class="hljs-title">Request</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">frontend</span></span>\<span class="hljs-title"><span class="hljs-title">models</span></span>\<span class="hljs-title"><span class="hljs-title">Lang</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LangRequest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Request</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_lang_url; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLangUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_lang_url === <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_lang_url = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getUrl(); $url_list = explode(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_lang_url); $lang_url = <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($url_list[<span class="hljs-number"><span class="hljs-number">1</span></span>]) ? $url_list[<span class="hljs-number"><span class="hljs-number">1</span></span>] : <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; Lang::setCurrent($lang_url); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( $lang_url !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; $lang_url === Lang::getCurrent()-&gt;url &amp;&amp; strpos(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_lang_url, Lang::getCurrent()-&gt;url) === <span class="hljs-number"><span class="hljs-number">1</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_lang_url = substr(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_lang_url, strlen(Lang::getCurrent()-&gt;url)+<span class="hljs-number"><span class="hljs-number">1</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_lang_url; } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolvePathInfo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $pathInfo = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLangUrl(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (($pos = strpos($pathInfo, <span class="hljs-string"><span class="hljs-string">'?'</span></span>)) !== <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) { $pathInfo = substr($pathInfo, <span class="hljs-number"><span class="hljs-number">0</span></span>, $pos); } $pathInfo = urldecode($pathInfo); <span class="hljs-comment"><span class="hljs-comment">// try to encode in UTF8 if not so // http://w3.org/International/questions/qa-forms-utf-8.html if (!preg_match('%^(?: [\x09\x0A\x0D\x20-\x7E] # ASCII | [\xC2-\xDF][\x80-\xBF] # non-overlong 2-byte | \xE0[\xA0-\xBF][\x80-\xBF] # excluding overlongs | [\xE1-\xEC\xEE\xEF][\x80-\xBF]{2} # straight 3-byte | \xED[\x80-\x9F][\x80-\xBF] # excluding surrogates | \xF0[\x90-\xBF][\x80-\xBF]{2} # planes 1-3 | [\xF1-\xF3][\x80-\xBF]{3} # planes 4-15 | \xF4[\x80-\x8F][\x80-\xBF]{2} # plane 16 )*$%xs', $pathInfo) ) { $pathInfo = utf8_encode($pathInfo); } $scriptUrl = $this-&gt;getScriptUrl(); $baseUrl = $this-&gt;getBaseUrl(); if (strpos($pathInfo, $scriptUrl) === 0) { $pathInfo = substr($pathInfo, strlen($scriptUrl)); } elseif ($baseUrl === '' || strpos($pathInfo, $baseUrl) === 0) { $pathInfo = substr($pathInfo, strlen($baseUrl)); } elseif (isset($_SERVER['PHP_SELF']) &amp;&amp; strpos($_SERVER['PHP_SELF'], $scriptUrl) === 0) { $pathInfo = substr($_SERVER['PHP_SELF'], strlen($scriptUrl)); } else { throw new InvalidConfigException('Unable to determine the path info of the current request.'); } if (isset($pathInfo[0]) &amp;&amp; $pathInfo[0] === '/') { $pathInfo = substr($pathInfo, 1); } return (string) $pathInfo; } }</span></span></code> </pre><br><br>  In the components block of the config / main.php configuration file, add: <br><br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">'request'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'frontend\components\LangRequest'</span></span> ],</code> </pre><br><br><h4>  Application internationalization </h4><br>  Two languages ‚Äã‚Äãare involved in the translation of the application: <br>  <a href="http://www.yiiframework.com/doc-2.0/yii-base-application.html">application language ($ language)</a> - the language of the user who works with the application; <br>  <a href="http://www.yiiframework.com/doc-2.0/yii-base-application.html">the source language of the application ($ sourceLanguage)</a> is the language used in the source code of the application.  By default, $ sourceLanguage = 'en'. <br><br>  Messages are translated using the <a href="http://www.yiiframework.com/doc-2.0/yii-baseyii.html">Yii :: t</a> method <a href="http://www.yiiframework.com/doc-2.0/yii-baseyii.html">($ category, $ message, $ params = [], $ language = null)</a> . <br><br>  Set the default values ‚Äã‚Äã$ sourceLanguage = 'en' and $ language = 'ru-RU' in the configuration file.  The value of $ language is set again (the Lang :: setCurrent method, the line Yii :: $ app-&gt; language = self :: $ current-&gt; local;) when determining $ pathInfo in LangRequest :: resolvePathInfo, that is, on each HTTP request. <br><br>  Translations of messages will be stored in the messages directory.  Each language has its own directory (message / ru and message / en), which stores translations by category. <br><br>  In the components block of the config / main.php configuration file, add: <br><br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">'language'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'ru-RU'</span></span>, <span class="hljs-string"><span class="hljs-string">'i18n'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'translations'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'*'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'yii\i18n\PhpMessageSource'</span></span>, <span class="hljs-string"><span class="hljs-string">'basePath'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'@frontend/messages'</span></span>, <span class="hljs-string"><span class="hljs-string">'sourceLanguage'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'en'</span></span>, <span class="hljs-string"><span class="hljs-string">'fileMap'</span></span> =&gt; [ <span class="hljs-comment"><span class="hljs-comment">//'main' =&gt; 'main.php', ], ], ], ],</span></span></code> </pre><br><br>  More information can be found <a href="http://www.yiiframework.com/doc-2.0/guide-tutorial-i18n.html">here</a> . <br><br><h4>  Language Switching Widget </h4><br>  Create frontend / widgets / Lang.php: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">frontend</span></span>\<span class="hljs-title"><span class="hljs-title">widgets</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">frontend</span></span>\<span class="hljs-title"><span class="hljs-title">models</span></span>\<span class="hljs-title"><span class="hljs-title">Lang</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WLang</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">yii</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bootstrap</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Widget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;render(<span class="hljs-string"><span class="hljs-string">'lang/view'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'current'</span></span> =&gt; Lang::getCurrent(), <span class="hljs-string"><span class="hljs-string">'langs'</span></span> =&gt; Lang::find()-&gt;where(<span class="hljs-string"><span class="hljs-string">'id != :current_id'</span></span>, [<span class="hljs-string"><span class="hljs-string">':current_id'</span></span> =&gt; Lang::getCurrent()-&gt;id])-&gt;all(), ]); } }</code> </pre><br><br>  And the frontend / widgets / views / lang / view.php display: <br><br><pre> <code class="html hljs xml"><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">use</span></span></span><span class="php"> </span><span class="hljs-title"><span class="php"><span class="hljs-title">yii</span></span></span><span class="php">\</span><span class="hljs-title"><span class="php"><span class="hljs-title">helpers</span></span></span><span class="php">\</span><span class="hljs-title"><span class="php"><span class="hljs-title">Html</span></span></span><span class="php">; </span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"lang"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"current-lang"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?</span></span></span><span class="php">= $current-&gt;name;</span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"show-more-lang"</span></span></span><span class="hljs-tag">&gt;</span></span>‚ñº<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"langs"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">foreach</span></span></span><span class="php"> ($langs </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">as</span></span></span><span class="php"> $lang):</span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"item-lang"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?</span></span></span><span class="php">= Html::a($lang-&gt;name, </span><span class="hljs-string"><span class="php"><span class="hljs-string">'/'</span></span></span><span class="php">.$lang-&gt;url.Yii::$app-&gt;getRequest()-&gt;getLangUrl()) </span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">endforeach</span></span></span><span class="php">;</span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Widget output: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">frontend</span></span>\<span class="hljs-title"><span class="hljs-title">widgets</span></span>\<span class="hljs-title"><span class="hljs-title">WLang</span></span>; <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> ... <span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span>= WLang::widget();<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/226931/">https://habr.com/ru/post/226931/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../226909/index.html">Osmo: kids project for iPad with analogue Leap Motion</a></li>
<li><a href="../226911/index.html">Mini-course "Web Performance Optimization"</a></li>
<li><a href="../226921/index.html">Turkey as a market for Russian high-tech companies</a></li>
<li><a href="../226925/index.html">What is Cisco UCS Director?</a></li>
<li><a href="../226927/index.html">The interplanetary station Rosetta performed the third key maneuver and photographed the comet Churyumova-Gerasimenko</a></li>
<li><a href="../226933/index.html">Review iconBIT NetTAB SKY HD 3G: budget tablet version 2014</a></li>
<li><a href="../226935/index.html">Solving a linear regression problem using the fast Hough transform</a></li>
<li><a href="../226939/index.html">Errors when developing games for mobile platforms</a></li>
<li><a href="../226941/index.html">Localization of Cocoa applications. What awaits a lone translator?</a></li>
<li><a href="../226943/index.html">IT guy on vacation: a little practice of amateur astrophotography</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>