<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Scala WAT: Collections</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last time we dealt with the processing of optional values, it turned out that using the elegant means of the Scala library incorrectly, we can continu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Scala WAT: Collections</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/d81/f1f/806/d81f1f8063b866532eff03e3d8c1dfc8.jpg" align="right">  <a href="http://habrahabr.ru/company/tcsbank/blog/166145/">Last time</a> we dealt with the processing of optional values, it turned out that using the elegant means of the Scala library incorrectly, we can continue to shoot our legs. <br><br>  This time we will move on to the collections.  The standard library for collections in Scala is so rich that it can offer ready-made methods for even the most demanding developers.  In what cases to use what methods are usually not described and everything is learned through experience.  Usually, at the beginning everyone will recognize <code>filter</code> and <code>map</code> , this can be the limit, because with a certain imagination one can implement a lot of algorithms only on these functions.  However, these methods may not be optimal or produce results that are impossible for the domain, which, however, will have to be processed. <br><br>  Below we will discuss which functions of the standard library are often used incorrectly and what can be improved. <br><a name="habracut"></a><br><h4>  foreach and for (val i = 0; i &lt;n; i ++) </h4><br>  When switching to Scala, many people experience a breakdown due to the lack of <code>for(;;)</code> .  Someone, especially those who wrote in C, thinks that without such a cycle you cannot write programs at all, the more advanced ones try to write analogs for <code>while</code> with the removal of the initial conditions and the cycle step into external code, for example: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">//  var! while(i &lt; n) { //  - ,   i i = i+1 }</span></span></code> </pre><br>  In fact, the most accurate analogue of <code>for(val i = 0; i&lt; n; i++)</code> is <code>for(i &lt;- 0 until n)</code> , <br>  so everything here was on the surface, although on the move it is not always visible.  To write correctly you need to know the work of the Range class and see examples of its use on blogs, such as <a href="http://www.codecommit.com/blog/scala/scala-for-java-refugees-part-1">Code Commit</a> . <br><br><h4>  Iterator </h4><br>  Often, when working with old Java code, there are classes that can not be iterated.  As an example, take <code>java.sql.ResultSet</code> ( <code>Enumeration</code> also rolls).  It is not Iterable, that is, there is no transparent conversion to <code>JavaConversions</code> , and you have to work with it only in imperative form or copy it into the contents into an intermediate mutable collection, alternatively, build immutable through the builder.  Fearfully. <br><br>  For this case, the standard Scala library has an <a href="http://www.scala-lang.org/api/current/index.html">Iterator</a> class, which allows you to make an edible <code>Iterator</code> from a <code>ResultSet</code> , which is at least <code>Traversable</code> : <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> resultSetIterator = <span class="hljs-type"><span class="hljs-type">Iterator</span></span>.continually(resultSet).takeWhile(_.next())</code> </pre><br><h4>  Simple replacements and binary logic </h4><br>  We start with simple substitution rules, when a chain of calls can be replaced by a simpler one or even one simple method.  The simplest methods that can help you are <code>exists</code> , <code>exists</code> , <code>forall</code> and <code>find</code> .  I often watched: <br><br><pre> <code class="scala hljs">option.map(myValueIsGoodEnough).getOrElse(<span class="hljs-literal"><span class="hljs-literal">false</span></span>)</code> </pre><br>  instead of <br><pre> <code class="scala hljs">option.exists(goodEnoughValue) <span class="hljs-comment"><span class="hljs-comment">//   `option exists goodEnoughValue`</span></span></code> </pre><br>  then <br><pre> <code class="scala hljs">iterable.filter(goodEnough).headOption</code> </pre><br>  instead of <br><pre> <code class="scala hljs">iterable.find(goodEnough)</code> </pre><br>  even it was like this (admittedly, right in our code!) <br><pre> <code class="scala hljs">iterable.foldLeft(<span class="hljs-literal"><span class="hljs-literal">true</span></span>)(_ &amp;&amp; goodEnough)</code> </pre><br>  instead <br><pre> <code class="scala hljs">iterable.forall(goodEnough)</code> </pre><br>  Needless to say, simpler options are not only simpler for perception, but also implemented more efficiently, due to the fact that <code>map</code> , <code>filter</code> and <code>foldLeft</code> will check the entire collection, no matter how long it is, while <code>exists</code> , <code>find</code> and <code>forall</code> will end as soon as they find a suitable (or inappropriate) element and will not generate an additional intermediate collection. <br><br>  There were also several useful features <a href="https://www.coursera.org/course/progfun">on the Scala course on Coursera.com</a> : <code>span</code> , <code>dropWhile</code> and <code>takeWhile</code> .  Using them may also not be obvious in practice, because the <code>filter</code> works successfully for these cases, too, really less efficiently, because it does not know that, at some point, it is no longer necessary to check the elements: they all fit or don‚Äôt fit.  For example, I myself until recently, removed the beginning and end of a sequence of exchange rates that are not included in the interval, through <code>filter</code> , and not through <code>dropWhile</code> and <code>takeWhile</code> . <br><br><h4>  Aggregates </h4><br>  The methods <code>fold</code> , <code>foldLeft</code> and <code>foldRight</code> very powerful and they can be used to solve completely different tasks. <br>  Let's stop, for example, on <code>foldLeft</code> , with its help you can get the sum of the elements of the collection: <br><br><pre> <code class="scala hljs">iterable.foldLeft(<span class="hljs-number"><span class="hljs-number">0</span></span>) { (accum, elem) =&gt; accum + elem }</code> </pre><br>  The canonical spelling for this code is: <br><br><pre> <code class="scala hljs">iterable.foldLeft(<span class="hljs-number"><span class="hljs-number">0</span></span>) { _ + _ }</code> </pre><br>  Martin Odersky for this showed an interesting version on Scala Days: <br><br><pre> <code class="scala hljs">(<span class="hljs-number"><span class="hljs-number">0</span></span> /: iterable)(_ + _)</code> </pre><br>  says, as if dominoes are falling from left to right :) More pluses are described <a href="http://rickyclarkson.blogspot.ru/2008/01/in-defence-of-0l-in-scala.html">here</a> , but I‚Äôm still skeptical about symbol operators, if they are not well-known for the domain. <br><br>  In any case, in this situation you should not write this code, because there is a special method for a collection with elements from the Typeclass <code>Numeric</code> , you can write more simply: <br><br><pre> <code class="scala hljs">iterable.sum</code> </pre><br>  The <code>min</code> and <code>max</code> functions are also available (special craftsmen like to sort the collection and take the head / tail, well, we haven't seen anything like this). <br><br>  Methods for folding are better reserved for applying one after the other steps of the high-level algorithm, for example, in chain-of-responsibility, or make reduce in your map-reduce. <br><br>  Sometimes, when processing graphs and, in general, information distributed in time, you have to process elements in pairs (current and previous), in this case you might really want, I wanted to use <code>for(;;)</code> and play with indices, <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i &lt;- <span class="hljs-number"><span class="hljs-number">1</span></span> until seq.size) { result ++= combine(seq(i<span class="hljs-number"><span class="hljs-number">-1</span></span>), seq(i)) }</code> </pre><br>  in Scala, you can sew a sequence with itself, shifted by one element and then use the function that processes both elements: <br><br><pre> <code class="scala hljs">seq.zip(seq.drop(<span class="hljs-number"><span class="hljs-number">1</span></span>)).map(combine) <span class="hljs-comment"><span class="hljs-comment">//    list.zip(list.tail).map(combine) // ,    </span></span></code> </pre><br>  Just remember to check that the sheet is not empty! <br><br>  The same code is more correct to write as <br><br><pre> <code class="scala hljs">seq.sliding(<span class="hljs-number"><span class="hljs-number">2</span></span>).map(calculateDelta)</code> </pre><br><br>  And now the good news, JavaOne turned out to portray many of these simplifications to the <a href="http://habrahabr.ru/users/Alefas/">guys from IntelliJ</a> , and by the Scala Days they managed to implement them and <a href="http://youtrack.jetbrains.com/issue/SCL-5613">many more</a> <br><br><img src="http://habrastorage.org/storage2/44c/ba8/1f2/44cba81f2e2aa55fd9cca8ad731633ed.jpg"><br><br>  The guys now have a special person engaged in Scala inspections, so if you have some interesting thoughts on simplification - <a href="http://youtrack.jetbrains.com/issues/SCL">create tickets</a> , everything will be there! <br><br>  Write a good code and be happy. </div><p>Source: <a href="https://habr.com/ru/post/184310/">https://habr.com/ru/post/184310/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../184294/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ62 (June 15 - 23, 2013)</a></li>
<li><a href="../184298/index.html">Raspberry Pi based handheld game console</a></li>
<li><a href="../184302/index.html">Http requests - we all do it wrong</a></li>
<li><a href="../184304/index.html">7 operating systems that you can run on the Raspberry Pi</a></li>
<li><a href="../184308/index.html">Quest as a graduation project</a></li>
<li><a href="../184312/index.html">To hit the target, you need to aim for a start.</a></li>
<li><a href="../184316/index.html">Test "from extreme to extreme"</a></li>
<li><a href="../184318/index.html">Reflections of the founder of MySQL on the development of the project under the wing of Oracle and the economics of open products</a></li>
<li><a href="../184320/index.html">Impressions of the 2013 DevOpsDays Mountain View Conference</a></li>
<li><a href="../184324/index.html">Half-Life 3 to be!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>