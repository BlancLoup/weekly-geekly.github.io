<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kali Linux: filtering traffic using netfilter</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚Üí Part 1. Kali Linux: security policy, protecting computers and network services 
 ‚Üí Part 2. Kali Linux: filtering traffic using netfilter 
 ‚Üí Part 3....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kali Linux: filtering traffic using netfilter</h1><div class="post__text post__text-html js-mediator-article">  ‚Üí Part 1. <a href="https://habrahabr.ru/company/ruvds/blog/338338/">Kali Linux: security policy, protecting computers and network services</a> <br>  ‚Üí Part 2. <a href="https://habrahabr.ru/company/ruvds/blog/338480/">Kali Linux: filtering traffic using netfilter</a> <br>  ‚Üí Part 3. <a href="https://habrahabr.ru/company/ruvds/blog/338668/">Kali Linux: monitoring and logging</a> <br>  ‚Üí Part 4. <a href="https://habrahabr.ru/company/ruvds/blog/338712/">Kali Linux: system protection and monitoring exercises</a> <br><br>  We present to your attention the continuation of the translation of Chapter 7 of the book ‚Äú <a href="https://kali.training/introduction/kali-linux-revealed-book/">Kali Linux Revealed</a> ‚Äù.  Last time it was about security policies and the protection of computers and network services.  This material includes a translation of Section 7.4, which deals with firewall and packet filtering. <br><br> <a href="https://habrahabr.ru/company/ruvds/blog/338480/"><img src="https://habrastorage.org/getpro/habr/post_images/6fd/e7c/3c6/6fde7c3c6ee385a5fa8e65dad2bc5f8e.jpg" alt="image"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">7.4.</font>  <font color="#3AC1EF">Firewall or packet filtering</font> </h2><br>  A firewall is a computer hardware that can be represented as a software, hardware, or software / hardware complex.  The firewall processes incoming and outgoing network packets (arriving at the local network or leaving it) and only passes those that comply with certain predefined rules. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A filtering network gateway is a type of firewall that protects the entire network.  It is usually installed on a dedicated computer configured as a gateway for the network.  As a result, this computer can handle all packets that cross the border between the network and the outside world.  Alternatively, a local firewall is a software service that runs on a specific machine in order to restrict access to certain services on that machine, or perhaps to prevent outbound connections initiated by unwanted software that a computer user may intentionally or accidentally , install. <br><br>  The Linux kernel has a built-in <code>netfilter</code> firewall.  The requirements of different networks and users are not the same, so there is no standard approach to setting up a firewall that allows you to get a ready-made solution for all occasions.  You can manage the <code>netfilter</code> firewall from user space using the <code>iptables</code> and <code>ip6tables</code> commands.  The difference between the two teams is that the first is for IPv4 networks, the second is for IPv6 networks.  Since both protocol stacks are likely to run for many more years, both tools should be used together.  In addition, you can use the excellent <code>fwbuilder</code> program, which provides graphical tools for building and presenting traffic filtering rules. <br><br>  No matter how you decide to configure <code>netfilter ‚Äî</code> this <code>netfilter ‚Äî</code> a standard Linux firewall, so let's take a closer look at how it works. <br><br><h2>  <font color="#3AC1EF">7.4.1.</font>  <font color="#3AC1EF">How netfilter works</font> </h2><br>  Netfilter uses four tables that store rules that govern three types of package operations: <br><br><ul><li>  <code>filter</code> : refers to the filtering rules (accept, reject, or ignore the packet); <br></li><li>  <code>nat</code> (Network Address Translation): refers to the translation of the source, destination, or ports of a packet; <br></li><li>  <code>mangle</code> : applies to other IP packet changes (including ToS fields and Type of Service parameters); <br></li><li>  <code>raw</code> : allows you to manually modify the packages before they reach the connection tracking system. <br></li></ul><br>  Each table contains lists of rules called chains.  The firewall uses standard chaining to process packets based on predefined conditions.  The administrator can create other chains that will be used only in cases when one of the standard chains refers directly or indirectly to them. <br><br>  The <code>filter</code> table contains three standard chains: <br><br><ul><li>  <code>INPUT</code> : for packets whose destination is the firewall itself; <br></li><li>  <code>OUTPUT</code> : for packets that the firewall sends; <br></li><li>  <code>FORWARD</code> : for packets that pass through a firewall (which is neither their source nor their destination). <br></li></ul><br>  The <code>nat</code> table also contains three standard chains: <br><ul><li>  <code>PREROUTING</code> : to modify inbound packets; <br></li><li>  <code>POSTROUTING</code> : to modify packages when they are ready to go to their destination; <br></li><li>  <code>OUTPUT</code> : for modifying packets generated by the firewall itself. <br></li></ul><br>  The chains described above are shown in the figure below. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/12b/bd6/56a/12bbd656ae1bababccc7584cffd90607.png"><br>  <i><font color="#999999">Fig.</font></i>  <i><font color="#999999">7.1.</font></i>  <i><font color="#999999">Netfilter chains</font></i> <br><br>  Each chain is a list of rules.  Each rule is a set of conditions and actions that must be carried out under appropriate conditions.  During the processing of a packet, the firewall scans the appropriate chain, rule by rule, and when conditions for a certain rule are fulfilled, it ‚Äújumps‚Äù (hence the <code>-j ‚Äî</code> option from the word ‚Äújump‚Äù) to the specified action to continue processing the packet. <br><br>  The most common patterns of behavior are standardized, for them there are selected actions.  Execution of one of these standard actions interrupts the passage in the chain, since the fate of the packet is already predetermined (this does not apply to the exceptions mentioned below).  Here is a list of <code>netfilter</code> actions: <br><br><ul><li>  <code>ACCEPT</code> : allows the package to follow its own path. <br></li><li>  <code>REJECT</code> : rejects a packet, generating an ICMP (Internet Control Message Protocol) error packet.  The <code>iptables --reject-with type</code> option allows you to specify the type of error to be <code>iptables --reject-with type</code> . <br></li><li>  <code>DROP</code> : remove (ignore) package. <br></li><li>  <code>LOG</code> : write a message to the system log (via <code>syslogd</code> ) with the package description.  Note that this action does not interrupt the packet processing, the execution of the chain continues with the following rule.  That is why logging rejected packets requires the <code>LOG</code> and <code>REJECT/DROP</code> rules.  Among the commonly used parameters related to logging, the following can be noted: <br></li><li>  <code>ULOG</code> : logs messages using <code>ulogd</code> .  This approach may be more efficient than <code>syslogd</code> when processing a large number of messages.  Note that this action, like <code>LOG</code> , does not interrupt packet processing. <br></li><li>  <code>chain_name</code> : go to the specified chain and process its rules. <br></li><li>  <code>RETURN</code> : interrupts the processing of the current chain and returns to the calling chain.  In the event that the current chain is one of the standard ones, there is no calling chain, so instead, a default action (specified using the <code>-P</code> option of the <code>iptables</code> command) is performed instead. <br></li><li>  <code>SNAT</code> ( <code>nat</code> table only): applies the Source Network Address Translation (SNAT).  Additional options describe exactly what changes need to be made, including the option - <code>-to-source address:port</code> , which allows you to specify a new source IP address of the packet, and, if necessary, the port. <br></li><li>  <code>DNAT</code> ( <code>nat</code> table only): Applies the Destination Network Address Translation (DNAT).  Additional options describe exactly what changes need to be made, including the option <code>--to-destination address:port</code> , which allows you to specify a new IP-address of the destination, and, if necessary, the port. <br></li><li>  <code>MASQUERADE</code> (only in table <code>nat</code> ): performs the so-called masquerading (a special case of Source NAT). <br></li><li>  <code>REDIRECT</code> (only in the <code>nat</code> table): transparently redirects the packet to the specified port of the firewall itself.  This action can be used to install a transparent web proxy, which works without additional settings on the client, since the client believes that it is connected to the recipient, while the data exchange actually goes through the proxy.  The <code>--to-ports port(s)</code> option allows you to specify a port or range of ports to which packets should be redirected. <br></li></ul><br>  Describing other actions, in particular those related to the <code>mangle</code> table, is outside the scope of this material.  Help on them can be found on the <code>man</code> pages of <code>iptables(8)</code> and <code>ip6tables(8)</code> . <br><br><blockquote><h3>  <font color="#3AC1EF">‚ñçWhat is ICMP?</font> </h3><br>  ICMP (Internet Control Message Protocol) is used to transfer additional information about network connections.  It allows you to check network connections using the <code>ping</code> command, which sends ICMP echo requests to which the recipient‚Äôs response is expected as ICMP echo replies.  This protocol is used to report on packets rejected by the firewall, to indicate an overflow in the receive buffer, to suggest the best route for the next packet in the connection, and so on.  This protocol is defined by several RFC documents.  The first were <a href="http://www.faqs.org/rfcs/rfc777.html">RFC777</a> and <a href="http://www.faqs.org/rfcs/rfc792.html">RFC792</a> , however, many other documents expand or revise the protocol. <br><br>  For example, a receive buffer is a small area of ‚Äã‚Äãmemory intended for storing data after receiving it from the network and before processing by the kernel.  If this memory is full, new data cannot be received and ICMP signals a problem.  As a result, the source can reduce the data transfer rate (which, after some time, should ideally reach a level that provides a balance between the source and the receiver). <br><br>  Note that while the IPv4 network can work without ICMP, ICMP v6 support is absolutely necessary for IPv6 networks, since this protocol combines several functions that, on IPv4 networks, were distributed between ICMPv4, the Internet Group Membership Protocol (IGMP) ), and Address Resolution Protocol (ARP).  ICMPv6 is dedicated to the <a href="http://www.faqs.org/rfcs/rfc4443.html">RFC4443</a> standard. </blockquote><br><h2>  <font color="#3AC1EF">7.4.2.</font>  <font color="#3AC1EF">Syntax of iptables and ip6tables commands</font> </h2><br>  The <code>iptables</code> and <code>ip6tables</code> commands are used to work with tables, chains and rules.  Their option - <code>t table</code> allows you to specify the table with which you plan to work (by default, this is the <code>filter</code> table). <br><br><h3>  <font color="#3AC1EF">‚ñç7.4.2.1.</font>  <font color="#3AC1EF">Teams</font> </h3><br>  Here are the main options for working with chains: <br><br><ul><li>  <code>-L chain</code> : prints the rules in the chain.  Usually this option is used with the <code>-n</code> option to disable name resolution (for example, the command <code>iptables -n -L INPUT</code> will print out the rules for incoming packets). <br></li><li>  <code>-N chain</code> : creates a new chain.  New chains create, pursuing a variety of goals, including - to test new network services and to prevent network attacks. <br></li><li>  <code>-X chain</code> : removes an empty or unused chain (for example, <code>iptables -X ddos-attack</code> ). <br></li><li>  <code>-A chain rule</code> : add a rule to the specified chain.  Remember that rules are processed starting at the head of the chain, consider this by adding new rules to the chains. <br></li><li>  <code>-I chain rule_num rule</code> : inserts a rule in front of the rule specified using the <code>rule_num</code> argument.  As with the <code>-A</code> option, remember how to process the rules by adding a new rule to the chain. <br></li><li>  <code>-D chain rule_num</code> (or <code>-D chain rule</code> ): removes the rule from the chain.  The first use case identifies the rule to be deleted by its number (the <code>iptables -L --line-numbers</code> command allows you to output these numbers).  The second option allows you to identify the rule by its content. <br></li><li>  <code>-F chain</code> : resets the chain (removes all rules from it).  For example, to remove all rules related to outgoing packets, you can use the command <code>iptables -F OUTPUT</code> .  If you do not specify specific chains when using this option, all rules in the table will be deleted. <br></li><li>  <code>-P chain action</code> : allows you to set a default action, or "policy" for a given chain.  Note that only standard chains can have a policy.  For example, to default all incoming traffic, you can use the command <code>iptables -P INPUT DROP</code> . <br></li></ul><br><h3>  <font color="#3AC1EF">‚ñç7.4.2.2.</font>  <font color="#3AC1EF">rules</font> </h3><br>  Each rule is expressed in the form <code>conditions -j action action_options</code> .  If several conditions are described in the same rule, then the final criterion is the combination of these conditions (according to the rules of logical AND).  The result of combining, at a minimum, imposes on the rule the same restrictions as each individual condition. <br><br>  The <code>-p protocol</code> condition corresponds to the IP packet <code>-p protocol</code> field.  The most commonly used values ‚Äã‚Äãfor this condition are <code>tcp</code> , <code>udp</code> , <code>icmp</code> , and <code>icmpv6</code> .  This condition can be supplemented with conditions concerning TCP ports using expressions like <code>--source-port port</code> and <code>--destination-port port</code> . <br><br><blockquote><h3>  <font color="#3AC1EF">‚ñçLogic negation of conditions</font> </h3><br>  If you put an exclamation mark before the condition, it will transform it into the opposite condition.  For example, an exclamation mark in the condition of the <code>-p</code> option allows you to construct an expression of the following form: ‚Äúany packet with a protocol that differs from the specified one‚Äù.  This mechanism of logical negation can be applied to any other conditions. </blockquote><br>  A condition like <code>-s address</code> or <code>-s network/mask</code> allows you to filter packets by their source address.  Accordingly, the <code>-d address</code> or <code>-d network/mask</code> conditions allow the system to respond to packet destination addresses. <br><br>  A condition like <code>-i interface</code> responds to packets that come from the specified network interface.  The <code>-o interface</code> condition allows the selection of packets that go to a given interface. <br><br>  The <code>--state state</code> filter filters packets based on their status in the connection (applying this condition requires the <code>ipt_conntrack</code> kernel <code>ipt_conntrack</code> to track connections).  Thus, the <code>NEW</code> state describes a packet requesting a new connection, <code>ESTABLISHED ‚Äî</code> packet belonging to an existing connection, <code>RELATED</code> ‚Äî describes a packet initiating a new connection that is part of an already existing connection (analyzing this state is useful for <code>ftp-data</code> connections in the ‚Äúactive‚Äù FTP protocol mode ). <br><br>  The <code>iptables</code> and <code>ip6tables</code> teams have many options, mastering them requires a serious approach to their study and experience.  However, one of the options you will use most often is the one that is designed to block unwanted network traffic from a certain host or range of hosts.  For example, in order to ‚Äúsilently‚Äù block incoming traffic from the IP address 10.0.1.5 and class C subnet 31.13.74.0/24, you need to do the following: <br><br><pre> <code class="hljs pgsql"># iptables -A <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span> -s <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span> -j <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> # iptables -A <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span> -s <span class="hljs-number"><span class="hljs-number">31.13</span></span><span class="hljs-number"><span class="hljs-number">.74</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> -j <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> # iptables -n -L <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span> Chain <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> ACCEPT) target     prot opt source               destination <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">all</span></span>  <span class="hljs-comment"><span class="hljs-comment">--  10.0.1.5             0.0.0.0/0 DROP       all  --  31.13.74.0/24        0.0.0.0/0</span></span></code> </pre> <br>  Another commonly used command, <code>iptables</code> designed to allow network traffic from a service or port.  For example, in order to allow users to connect via SSH, HTTP and IMAP, you can use the following commands: <br><br><pre> <code class="hljs vbscript"># iptables -A INPUT -m state --state <span class="hljs-keyword"><span class="hljs-keyword">NEW</span></span> -p tcp --dport <span class="hljs-number"><span class="hljs-number">22</span></span> -j ACCEPT # iptables -A INPUT -m state --state <span class="hljs-keyword"><span class="hljs-keyword">NEW</span></span> -p tcp --dport <span class="hljs-number"><span class="hljs-number">80</span></span> -j ACCEPT # iptables -A INPUT -m state --state <span class="hljs-keyword"><span class="hljs-keyword">NEW</span></span> -p tcp --dport <span class="hljs-number"><span class="hljs-number">143</span></span> -j ACCEPT # iptables -n -L INPUT Chain INPUT (policy ACCEPT) target     prot opt source               destination DROP       all  --  <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span>             <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> DROP       all  --  <span class="hljs-number"><span class="hljs-number">31.13</span></span><span class="hljs-number"><span class="hljs-number">.74</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>        <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> ACCEPT     tcp  --  <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>            <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>            state <span class="hljs-keyword"><span class="hljs-keyword">NEW</span></span> tcp dpt:<span class="hljs-number"><span class="hljs-number">22</span></span> ACCEPT     tcp  --  <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>            <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>            state <span class="hljs-keyword"><span class="hljs-keyword">NEW</span></span> tcp dpt:<span class="hljs-number"><span class="hljs-number">80</span></span> ACCEPT     tcp  --  <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>            <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>            state <span class="hljs-keyword"><span class="hljs-keyword">NEW</span></span> tcp dpt:<span class="hljs-number"><span class="hljs-number">143</span></span></code> </pre> <br>  It is considered useful, to maintain a healthy atmosphere in the system, to remove old or unused rules.  The easiest way to remove <code>iptables</code> rules is to access rules by line number, which can be obtained using the <code>--line-numbers</code> option.  However, you should be careful here, since deleting a rule will lead to a change in the numbers of all the rules located below it in the chain: <br><br><pre> <code class="hljs vbscript"># iptables -n -L INPUT --line-numbers Chain INPUT (policy ACCEPT) num  target     prot opt source               destination <span class="hljs-number"><span class="hljs-number">1</span></span>    DROP       all  --  <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span>             <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>    DROP       all  --  <span class="hljs-number"><span class="hljs-number">31.13</span></span><span class="hljs-number"><span class="hljs-number">.74</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>        <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>    ACCEPT     tcp  --  <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>            <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>            state <span class="hljs-keyword"><span class="hljs-keyword">NEW</span></span> tcp dpt:<span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>    ACCEPT     tcp  --  <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>            <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>            state <span class="hljs-keyword"><span class="hljs-keyword">NEW</span></span> tcp dpt:<span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>    ACCEPT     tcp  --  <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>            <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>            state <span class="hljs-keyword"><span class="hljs-keyword">NEW</span></span> tcp dpt:<span class="hljs-number"><span class="hljs-number">143</span></span> # iptables -D INPUT <span class="hljs-number"><span class="hljs-number">2</span></span> # iptables -D INPUT <span class="hljs-number"><span class="hljs-number">1</span></span> # iptables -n -L INPUT --line-numbers Chain INPUT (policy ACCEPT) num  target     prot opt source               destination <span class="hljs-number"><span class="hljs-number">1</span></span>    ACCEPT     tcp  --  <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>            <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>            state <span class="hljs-keyword"><span class="hljs-keyword">NEW</span></span> tcp dpt:<span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>    ACCEPT     tcp  --  <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>            <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>            state <span class="hljs-keyword"><span class="hljs-keyword">NEW</span></span> tcp dpt:<span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>    ACCEPT     tcp  --  <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>            <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>            state <span class="hljs-keyword"><span class="hljs-keyword">NEW</span></span> tcp dpt:<span class="hljs-number"><span class="hljs-number">143</span></span></code> </pre> <br>  There are more specific conditions depending on the general conditions described above.  More details about this can be found in <code>man</code> ( <code>iptables(8)</code> and <code>ip6tables(8)</code> ). <br><br><h2>  <font color="#3AC1EF">7.4.3.</font>  <font color="#3AC1EF">Creating rules</font> </h2><br>  Each rule creation operation requires one <code>iptables</code> or <code>ip6tables</code> command.  Entering these commands manually can be a time consuming task, so usually these commands are written in the form of scripts that allow you to automatically configure the system as needed, each time the computer boots.  Such scripts can be written by hand, but there is a more advanced way, which is to use the <code>fwbuilder</code> program.  To install it, use this command: <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># apt install fwbuilder</span></span></code> </pre> <br>  Principles of creating rules in the program are simple.  First describe all the elements of the system to which the rules you want to create will be distributed.  Among these elements are the following: <br><br><ul><li>  The firewall itself with its network interfaces. <br></li><li>  Network and its corresponding IP address ranges. <br></li><li>  Servers. <br></li><li>  Ports owned by services running on servers. <br></li></ul><br>  Next, create rules using a graphical interface and dragging the corresponding elements with the mouse.  Context menus can be used to change conditions (for example, to form conditions that are inverse of given).  Then you need to select and configure actions. <br><br>  Since IPv6 is taken into account, you can either create two separate sets of rules for IPv4 and IPv6, or create only one set and allow <code>fwbuilder</code> translate the rules according to the addresses assigned to objects. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fbf/0e5/bb1/fbf0e5bb14a351629992e68e73aefd46.png"><br>  <i><font color="#999999">Fig.</font></i>  <i><font color="#999999">7.2.</font></i>  <i><font color="#999999">Fwbuilder main window</font></i> <br><br>  The result of working with <code>fwbuilder</code> will be the firewall setup script generated by the program in accordance with the specified rules.  The modular architecture of the program allows you to create scripts designed for various systems, including <code>iptables</code> for Linux, <code>ipf</code> for FreeBSD, and <code>pf</code> for OpenBSD. <br><br><h2>  <font color="#3AC1EF">7.4.4.</font>  <font color="#3AC1EF">Apply rules every time the system boots</font> </h2><br>  In order to apply the firewall rules every time the system boots up, you need to register the configuration script in the <code>up</code> directive of the <code>/etc/network/interfaces</code> file.  In the following example, the script is stored at <code>/usr/local/etc/arrakis.fw</code> . <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">auto</span></span> eth0 iface eth0 inet static   address <span class="hljs-number"><span class="hljs-number">192.168.0.1</span></span>   network <span class="hljs-number"><span class="hljs-number">192.168.0.0</span></span>   netmask <span class="hljs-number"><span class="hljs-number">255.255.255.0</span></span>   broadcast <span class="hljs-number"><span class="hljs-number">192.168.0.255</span></span>   up /usr/local/etc/arrakis.fw</code> </pre> <br>  This example assumes that you are using <code>ifupdown</code> to configure network interfaces.  If you use other tools (such as <code>NetworkManager</code> or <code>systemd-networkd</code> ), refer to their documentation to find out how to run the script after enabling the interface. <br><br><h2>  <font color="#3AC1EF">Results</font> </h2><br>  Today we talked about working with the <code>netfilter</code> firewall built into the Linux kernel, discussed the features of managing IPv4 and IPv6 traffic using the <code>iptables</code> and <code>ip6tables</code> commands.  We looked at a graphical tool for creating <code>fwbuilder</code> rules and showed how to automatically set rules when the system boots.  Next time we will share with you the translation of section 7.5, which is dedicated to monitoring Kali Linux. <br><br>  Dear readers!  How do you solve traffic filtering problems in Linux? </div><p>Source: <a href="https://habr.com/ru/post/338480/">https://habr.com/ru/post/338480/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338462/index.html">JavaScript scope and closures</a></li>
<li><a href="../338468/index.html">Do you need financial data?</a></li>
<li><a href="../338470/index.html">Recommendations on Avito</a></li>
<li><a href="../338472/index.html">How we transferred 400 stores to electronic cash registers</a></li>
<li><a href="../338478/index.html">"Invisible design": we design together with cars</a></li>
<li><a href="../338482/index.html">Comodo Group reports a fourfold increase in the number of cyber threats</a></li>
<li><a href="../338484/index.html">Fujitsu will build a supercomputer for the study of artificial intelligence</a></li>
<li><a href="../338488/index.html">IT Championship "Racing Heroes", or the first project LANIT on the military ground "Alabino"</a></li>
<li><a href="../338490/index.html">The first version of SignalR for ASP.Net Core 2.0 has been released.</a></li>
<li><a href="../338492/index.html">How I wrote my CMS, and why I do not recommend you do the same.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>