<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Alcatel Lucent Service Router as an Access Domain Gateway</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For many, the first acquaintance with the Alcatel Lucent service routers (now Nokia) is not very pleasant due to the particular vendor look at the ser...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Alcatel Lucent Service Router as an Access Domain Gateway</h1><div class="post__text post__text-html js-mediator-article">  For many, the first acquaintance with the Alcatel Lucent service routers (now Nokia) is not very pleasant due to the particular vendor look at the service delivery model.  Unlike Cisco equipment, it is not always obvious how to make such a device work in a simple scenario: a router for several access switches (usually such switches are connected in a ring).  Those who are disappointed, not finding the command spanning-tree in configuration mode, is dedicated. <br><a name="habracut"></a><br>  Imagine a simple topology: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b5d/ef0/a2f/b5def0a2f66148a587cc1c7bcace9c5a.png" alt="image"></div><br>  Two access switches connected in a ring with a router, a device with TimOS on board (in this case the SR7750 emulator) and an external DHCP server serving several IP networks.  In this situation, the 7750 has several alter egos: <br><br>  1) Default gateway.  PC1 and PC2 quite naturally want to communicate with external networks, so you need to provide them with an IP address where you can send all unwanted packets. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      2) DHCP realy.  As a message, discover is sent by Broadcast; it must be sent to the external server by a unicast message. <br><br>  3) RSTP root bridge.  It is hardly rational to allow the access switch to become root. <br><br>  Immediately make a reservation that the SR7750 is a router.  It is not intended for switching traffic between two interfaces; it does not support SVI in the classical form with all that it implies.  To use the device in such a topology, it is necessary to create an improvised and very simple VPLS (although, of course, in the case of two interfaces, a pseudowire would also be suitable).  In order to configure VPLS in our case, it is not necessary to understand the principles of MPLS operation. <br><br>  So let's get started. <br><br><div class="spoiler">  <b class="spoiler_title">Do not forget to configure the card in the emulator.</b> <div class="spoiler_text"><pre><code class="hljs pgsql">card <span class="hljs-number"><span class="hljs-number">1</span></span> card-<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> iom3-xp-b mda <span class="hljs-number"><span class="hljs-number">1</span></span> mda-<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> m5<span class="hljs-number"><span class="hljs-number">-1</span></span>gb-sfp-b <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> shutdown <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> shutdown</code> </pre> <br>  If you do not use an emulator, the types of cards and modules can be determined by simple commands: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">show</span></span> card <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> mda</code> </pre><br></div></div><br>  0. Our preliminary step will be user configuration.  VPLS from the point of view of SR is a service, and any service must belong to the user. <br><br><pre> <code class="hljs pgsql"> customer <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> description "Access ring 1" <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span></code> </pre><br>  1. Configure interfaces 1/1/1 and 1/1/2. <br><br><pre> <code class="hljs pgsql"> port <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> ethernet mode <span class="hljs-keyword"><span class="hljs-keyword">access</span></span> encap-<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> dot1q <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> shutdown <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> port <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span> ethernet mode <span class="hljs-keyword"><span class="hljs-keyword">access</span></span> encap-<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> dot1q <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> shutdown <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span></code> </pre><br>  After that, using the <code>show port</code> command you can verify that the settings are correct.  Note that the MTU has become 1518 = 1500 for IP + 14 Ethernet + 4 dot1q vlan.  It is quite natural that in the QinQ configuration, the device itself will determine the frame size in 1522. <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler</b> <div class="spoiler_text"> <code>=============================================================================== <br> Ports on Slot 1 <br> =============================================================================== <br> Port Admin Link Port Cfg Oper LAG/ Port Port Port C/QS/S/XFP/ <br> Id State State MTU MTU Bndl Mode Encp Type MDIMDX <br> ------------------------------------------------------------------------------- <br> 1/1/1 Up Yes Up 1518 1518 - accs dotq xcme GIGE-LX 10KM <br> 1/1/2 Up Yes Up 1518 1518 - accs dotq xcme GIGE-LX 10KM <br></code> <br></div></div><br>  2. Configure the VPLS service. <br><br><pre> <code class="hljs sql">service vpls 5 customer 5 <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">allow</span></span>-ip-<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>-binding stp <span class="hljs-keyword"><span class="hljs-keyword">priority</span></span> <span class="hljs-number"><span class="hljs-number">4096</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">shutdown</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> service-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-string"><span class="hljs-string">"Access-ring-1"</span></span> sap <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> sap <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">shutdown</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span></code> </pre><br>  <b>SAP</b> (Service access point) is an attachment circuit in slightly better known terminology.  The point to which the subscriber device is connected.  In our case, the access switch.  The number after the colon is the vlan number. <br><br>  This is where we enable STP.  The default mode is RSTP, and our SAP will be point-to-point interfaces from an STP perspective.  Priority 4096 set with the intent to turn our pseudo-switch into a root bridge. <br><br>  <code>allow-ip-int-binding</code> required in order to allow IP interface binding (read SVI) to our VPLS.  This interface will be bound using our service name. <br><br>  Basic verification can be done using <code>show service id 5 base</code> <br><div class="spoiler">  <b class="spoiler_title">Spoiler</b> <div class="spoiler_text"> <code>=============================================================================== <br> Service Basic Information <br> =============================================================================== <br> Service Id : 5 Vpn Id : 0 <br> Service Type : VPLS <br> Name : Access-ring-1 <br> Description : (Not Specified) <br> Customer Id : 5 Creation Origin : manual <br> Last Status Change: 12/06/2016 21:37:01 <br> Last Mgmt Change : 12/06/2016 21:37:01 <br> Etree Mode : Disabled <br> Admin State : Up Oper State : Up <br> MTU : 1514 Def. Mesh VC Id : 5 <br> SAP Count : 2 SDP Bind Count : 0 <br> Snd Flush on Fail : Disabled Host Conn Verify : Disabled <br> Propagate MacFlush: Disabled Per Svc Hashing : Disabled <br> Allow IP Intf Bind: Enabled <br> Def. Gateway IP : None <br> Def. Gateway MAC : None <br> Temp Flood Time : Disabled Temp Flood : Inactive <br> Temp Flood Chg Cnt: 0 <br> VSD Domain : none <br> <br> ------------------------------------------------------------------------------- <br> Service Access &amp; Destination Points <br> ------------------------------------------------------------------------------- <br> Identifier Type AdmMTU OprMTU Adm Opr <br> ------------------------------------------------------------------------------- <br> sap:1/1/1:5 q-tag 1518 1518 Up Up <br> sap:1/1/2:5 q-tag 1518 1518 Up Up <br> =============================================================================== <br></code> <br></div></div><br>  3. So, the interface. <br><br><pre> <code class="hljs sql">service ies 15 customer 5 <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-string"><span class="hljs-string">"DGW-1"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> address <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.6</span></span>/<span class="hljs-number"><span class="hljs-number">29</span></span> dhcp <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-number"><span class="hljs-number">10.10</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span> relay-unicast-msg <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">shutdown</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> vpls <span class="hljs-string"><span class="hljs-string">"Access-ring-1"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">shutdown</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span></code> </pre><br>  As you can see, here we killed two birds with one stone: the default gateway was configured, and DHCP clients were provided with DHCP Relay.  Note that IES and VPLS are different services, with different id. <br><br>  Verify that the UP interface is available using <code>show service id 15 interface</code> <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler</b> <div class="spoiler_text"> <code>=============================================================================== <br> Interface Table <br> =============================================================================== <br> Interface-Name Adm Opr(v4/v6) Type Port/SapId <br> IP-Address PfxState <br> ------------------------------------------------------------------------------- <br> DGW-1 Up Up/-- IES rvpls <br> 10.0.0.6/29 n/a <br> ------------------------------------------------------------------------------- <br> Interfaces : 1 <br> =============================================================================== <br></code> <br></div></div><br>  4. Configure the interface in the direction of the kernel where the DHCP server is located.  For simplicity, we will achieve connectivity with the server by a static route.  Do not forget about the value of MTU from the core. <br><br>  Enable the interface: <br><br><pre> <code class="hljs perl"> port <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> ethernet <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">shutdown</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span></code> </pre><br>  Configuring the IP part: <br><br><pre> <code class="hljs perl">router interface <span class="hljs-string"><span class="hljs-string">"To-CORE"</span></span> address <span class="hljs-number"><span class="hljs-number">172.16</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">31</span></span> port <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">shutdown</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> interface <span class="hljs-string"><span class="hljs-string">"system"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">shutdown</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> static-route <span class="hljs-number"><span class="hljs-number">10.10</span></span>.<span class="hljs-number"><span class="hljs-number">10.10</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-keyword"><span class="hljs-keyword">next</span></span>-hop <span class="hljs-number"><span class="hljs-number">172.16</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  The routing table can be viewed using <code>show router route-table</code> <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler</b> <div class="spoiler_text"> <code>=============================================================================== <br> Route Table (Router: Base) <br> =============================================================================== <br> Dest Prefix[Flags] Type Proto Age Pref <br> Next Hop[Interface Name] Metric <br> ------------------------------------------------------------------------------- <br> 10.0.0.0/29 Local Local 00h17m25s 0 <br> DGW-1 0 <br> 10.10.10.10/32 Remote Static 00h05m05s 5 <br> 172.16.0.1 1 <br> 172.16.0.0/31 Local Local 00h05m05s 0 <br> To-CORE 0 <br> ------------------------------------------------------------------------------- <br> No. of Routes: 3 <br> Flags: n = Number of times nexthop is repeated <br> B = BGP backup route available <br> L = LFA nexthop available <br> S = Sticky ECMP requested <br> =============================================================================== <br></code> <br></div></div><br>  This is a simple, but slightly unusual setting Alcatel completed.  At first glance, VRRP is not enough here, but in an amicable way, to enable VRRP, you need to add an MPLS interface between two routers.  In addition to SAP, SDP will be added to our VPLS.  But that's another story. <br><br>  Software Version: TiMOS-B-12.0.R6. <br>  Picture and console: <a href="http://www.unetlab.com/">UNL</a> <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/317138/">https://habr.com/ru/post/317138/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../317128/index.html">Why hold a hackathon in a strip club?</a></li>
<li><a href="../317130/index.html">‚ÄúWhat has the progRess come to?‚Äù Replacing "mental" labor by a mechanical process based on R</a></li>
<li><a href="../317132/index.html">Failover Evolution in PostgreSQL</a></li>
<li><a href="../317134/index.html">How to order Internet marketing with reference to the result?</a></li>
<li><a href="../317136/index.html">How to get maximum revenue from advertising systems on your site</a></li>
<li><a href="../317140/index.html">An inside look at OpenBMC for OpenPOWER systems</a></li>
<li><a href="../317142/index.html">[St. Petersburg, Announcement] CodeFreeze meeting with Alexander Chepurny about the blockchain for developers</a></li>
<li><a href="../317144/index.html">When Russian service is better than American, or the battle of humanities with evil calculators</a></li>
<li><a href="../317150/index.html">How to avoid jumps in response time and memory consumption when taking state snapshots in a DBMS in RAM</a></li>
<li><a href="../317152/index.html">A critical vulnerability was found in the AirDroid application that allows for MitM attacks.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>