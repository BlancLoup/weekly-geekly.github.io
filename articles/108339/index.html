<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Android Calendar API</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will focus on using the undocumented API to work with the standard Android calendar. I did not find any articles in Russian on this topic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Android Calendar API</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/902fb097/6ffd64be/4b30b7e8/99a0ab83.jpg"><br>  This article will focus on using the undocumented API to work with the standard Android calendar.  I did not find any articles in Russian on this topic, and in English there are only a few posts with outdated data.  Who is interested - under cat. <br><a name="habracut"></a><br><h4>  What for!? </h4><br>  I was faced with such a task when I wrote an application for drawing up my university timetable.  It is convenient to have your schedule separately, and even the standard calendar does not support the repetition of events after one week, which is necessary for a two-week (even / odd) schedule. <br>  The fix idea was a function of the application that will allow you to ‚Äúfill in‚Äù the calendar entered by the Android schedule.  The advantages are obvious: synchronization with Google Calendar from google (sorry for the tautology), built-in calendar widgets (this widget from HTC Sense is very good) and a mountain of third-party widgets that even show the next event, even the week load, etc.  This is where you need to work with the Android calendar. <br><br><h4>  Using an undocumented API is BAD!  Pnyatnenko? </h4><br><img align="left" src="https://habrastorage.org/storage/5c2d2d85/202852ca/fe017dce/41d70e60.jpg"><br>  Is it really necessary to use an undocumented API to solve this obvious problem?  The answer is no.  The most correct method is to use <a href="http://code.google.com/apis/calendar/data/2.0/developers_guide.html">the Google Calendar API</a> , which I advise you to do in your workings out. <br><br>  But the ‚Äúright‚Äù method imposes a number of restrictions: <br>  ‚Ä¢ Do not use in the absence of an Internet connection; <br>  ‚Ä¢ Synchronization is required after filling in the calendar; <br>  ‚Ä¢ The data (and there are quite a few of them when filling in the whole year) go to the server and then go back in synchronization, which obviously increases traffic twice. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In my opinion, it is much more convenient to use the offline version of the calendar, which, at any opportunity, can be synchronized with Google Calendar.  Unfortunately google did not take care of the developers for Android and did not publish the official API, but to our joy, the Android source codes are open and smart people have long found the magic URI content providers. <br><br><h4>  We ask the user for permission to work with the calendar. </h4><br><br>  Paradox.  There is no API, but there are permissions in the documentation.  All you have to do is add them to your <b>AndroidManifest.xml</b> . <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.READ_CALENDAR"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.WRITE_CALENDAR"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h4>  Uniform Resource Identifier or in Russian - URI </h4><br>  To use the Android calendar, we must contact its content provider at a specific URI.  To our chagrin, this URI is different in different versions of the OS and may well change in the following (the cost of using an undocumented API).  But the problem is solved. <br>  For Froyo [2.2] and most likely for the next versions - <b>content: //com.android.calendar/calendars</b> . <br>  For versions &lt;2.2 - <b>content: // calendar / calendars</b> . <br>  As you can see, everything is not so bad.  You can determine the system version and use the corresponding URI, but I went the other way.  See if there is any URI for &lt;2.2 and if there is no one there, then I use the rest. <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Calendar URI before 2.2 Uri calendars = Uri.parse("content://calendar/calendars"); Cursor managedCursor = this.managedQuery(calendars, new String[] { "_id", "name" }, null, null, null); if(managedCursor == null || managedCursor.getCount() == 0) { // 2.2 (Froyo) } else { // &lt; 2.2 }</span></span></code> </pre> <br>  We assume that the received URI. <br><br><h4>  We receive the list of calendars </h4><br>  For users of Google Calendar is not necessary to explain, but for the rest I will explain.  A shared calendar consists of one or more smaller calendars, which can vary in color markers.  Usually it is something like ‚Äúpersonal‚Äù, ‚Äúwork‚Äù, ‚Äústudy‚Äù, etc.  You can create such calendars only on the Googlekalander website, in the Android itself, this cannot be done using standard tools. <br>  To add events we need to know the calendar ID.  To perform this task, we use the construction from the previous paragraph. <br><br><pre> <code class="java hljs">String[] projection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[] { <span class="hljs-string"><span class="hljs-string">"_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span> }; Cursor managedCursor = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.managedQuery(URI, projection, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (managedCursor != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; managedCursor.moveToFirst()) { String calName; String calID; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nameColumn = managedCursor.getColumnIndex(<span class="hljs-string"><span class="hljs-string">"name"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> idColumn = managedCursor.getColumnIndex(<span class="hljs-string"><span class="hljs-string">"_id"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { calName = managedCursor.getString(nameColumn); calID = managedCursor.getString(idColumn); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (calName != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶ UI } while (managedCursor.moveToNext()); managedCursor.close(); }</span></span></code> </pre><br>  Now the resulting set of names can be displayed in the interface and allow the user to select. <br><br><h4>  Add an event </h4><br>  Here work with a calendar occurs, as well as with any other content provider.  This can be read in the <a href="http://developer.android.com/guide/topics/providers/content-providers.html">documentation</a> . <br><br><pre> <code class="java hljs">ContentValues event = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ContentValues(); event.put(<span class="hljs-string"><span class="hljs-string">"calendar_id"</span></span>, calID); <span class="hljs-comment"><span class="hljs-comment">// ID     event.put("title", title); //   event.put("description", desc); //   event.put("eventLocation", loc); //   event.put("dtstart", start); //   event.put("dtend", end); //   eventsURI=Uri.parse(URI + ‚Äú/events"); this.getContentResolver().insert(eventsURI, event);</span></span></code> </pre><br>  Let's talk about the event fields.  I advise you to use the description field to indicate the event.  Using this field, then it will be possible to delete in a crowd all events created by your program.  Fields of the name, description and location are string.  We should also mention the time fields.  These fields have the type long, and the values ‚Äã‚Äãof these fields can be generated, for example, by the following function. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pickDate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> year, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> month, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> day, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hour, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> minute)</span></span></span><span class="hljs-function"> </span></span>{ Calendar rightNow = Calendar.getInstance(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> timeShift = rightNow.get(Calendar.ZONE_OFFSET); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Date.UTC(year - <span class="hljs-number"><span class="hljs-number">1900</span></span>, month, day, hour - (timeShift / <span class="hljs-number"><span class="hljs-number">3600000</span></span>), minute, <span class="hljs-number"><span class="hljs-number">0</span></span>); }</code> </pre><br>  With it, I think, you will understand yourself, I will only note that it takes into account the current time zone. <br><br><h4>  Remove event </h4><br>  To delete a message by ID, add it to the URI. <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//eventsURI = URI + events/ uri = ContentUris.withAppendedId(eventsURI, EVENT_ID); this.getContentResolver().delete(uri, null, null);</span></span></code> </pre><br>  To delete by other fields, you can use the cursor to pull out all the events, as we did with the calendars, and then selectively delete them by ID. <br><br><h4>  Conclusion </h4><br>  In conclusion, once again I remind you that you use it at your own peril and risk.  During the development, I once wrote a wrong URI and my phone every time I started syncing started to generate an error (corrected deleting information from the calendar at all). <br>  Another nuisance is that there is no calendar in the emulator, so the above cannot be repeated on it. <br>  And quite in conclusion.  I can not use the opportunity to promote my application, which was discussed in the article.  You can find it in the market called <b>uTimetable</b> . <br><img align="left" src="https://habrastorage.org/storage/651d1731/6c419718/0503bc14/83c86706.png"><img align="left" src="https://habrastorage.org/storage/ba453ec1/bb74ef14/1ef98fc7/8e233af0.png"><img align="left" src="https://habrastorage.org/storage/9d8b66b1/0eeb5a13/04e0eb6f/dcde0eca.png"><br><br><img src="https://habrastorage.org/storage/69101187/d0b8dc59/69ecb8ec/eda2a75e.png"><br><br>  And absolutely at the end I would like to ask the habbeast students: What format do you have at the university (one / two weeks) and how are these weeks called if they are two - even / odd or otherwise?  Also interested in foreign universities. </div><p>Source: <a href="https://habr.com/ru/post/108339/">https://habr.com/ru/post/108339/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../108321/index.html">Computer Telephony "Yeastar" for receiving / transmitting faxes</a></li>
<li><a href="../108323/index.html">GlacialTech Alaska - a breath of cold air</a></li>
<li><a href="../108324/index.html">Game Connection, Lyon 2010</a></li>
<li><a href="../108334/index.html">Cartoon Gypsy: Turkey Ilo. Wings, legs, tail ...</a></li>
<li><a href="../108337/index.html">WebMoney quietly and quietly increased protection. Perhaps some will have payment gaps.</a></li>
<li><a href="../108340/index.html">Google Docs update for Android and iOS (now editing)</a></li>
<li><a href="../108342/index.html">ASUS PRIDE Contest</a></li>
<li><a href="../108343/index.html">Post of Russia. Endgame</a></li>
<li><a href="../108345/index.html">Fully robotic farm</a></li>
<li><a href="../108346/index.html">The transition of Node.js under the wing of Joyent, the release of versions v0.2.5 and v0.3.1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>