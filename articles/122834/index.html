<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OAuth VKontakte: mercenary use</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are many ways to spread malicious spam in VKontakte. But the pests are not asleep, more and more interesting ideas are coming to their heads. An...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OAuth VKontakte: mercenary use</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/284de6eb/4dfdbbb9/f6ba27e7/e587ceaf.gif" alt="image" align="right"><br>  There are many ways to spread malicious spam in VKontakte.  But the pests are not asleep, more and more interesting ideas are coming to their heads.  And <a href="http://habrahabr.ru/blogs/social_networks/117211/">support for the OAuth 2.0 Vkontakte platform</a> was somehow the way.  Scammers have learned to use it to crawl the warning page about malicious sites. <br><a name="habracut"></a><br>  And it all started with the fact that once a message appeared on my wall: <br><img src="https://habrastorage.org/storage1/326d1dfc/691abeae/3d2de20c/c3a1ae12.gif"><br>  Out of curiosity, I clicked the link and got to the next phishing site.  But the link itself seemed strange to me; it looked like (half of the characters in ASCII): <br>  <a href="http://vkontakte.ru/away.php">vkontakte.ru/away.php</a> ?  <b>to</b> = http% 3A% 2F% 2FApi.vKontakte.Ru% 2F% 2Fo% 2561u% 2574% ... <br><br>  <b>Consider the link in detail:</b> <br><ul><li>  vkontakte.ru/away.php - a page with a warning about clicking on a link; </li><li>  The parameter <b>to</b> the link itself.  In recoded form, it looked like this: <br>  Api.vKontakte.Ru/oauth/authorize?client_id=2376***&amp;cgpopcvkqdjut4&amp;redirect_uri=vgostivk.dyndns**&amp;display=popup?390852 </li></ul><br><h6>  This is where the most interesting begins ... </h6><br>  <b>Let's sort the second link in parts:</b> <br><ul><li>  Api.vKontakte.Ru/oauth/authorize - access to the VK API, authorization through OAuth 2.0; </li><li>  client_id = 2376 *** &amp; cgpopcvkqdjut4 &amp; redirect_uri = vgostivk.dyndns ** &amp; display = popup? 390852 - authorization parameters. </li></ul><br>  <b>What does each of the parameters mean:</b> <br><ul><li>  client_id - ID of the application that requires authorization; </li><li>  redirect_uri - the address to which the access_token will be transmitted (via redirect); </li><li>  display - view authorization window (page, popup, touch and wap). </li></ul><br>  Actually redirect_uri contained the address of the phishing site.  Since an error was made in the display parameter (garbage "? 390852" was sent to it), the authorization window was not displayed, but a redirect was immediately redirected to the phishing site with parameters: error = invalid_request &amp; error_description = Invalid + display + passed <br><br>  This is the whole point of bypassing the blacklist of malicious sites on VKontakte.  Only an alert about switching to api.vk.com appears.  And as a result of the transition, we directly go to the phishing site that is on the black list.  When you click on the link vkontakte.ru/away.php?to=vgostivk.dyndns**: <br><img src="https://habrastorage.org/storage1/a5c2989f/a10acc7b/817153fe/0163d28b.gif">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As it turned out, the application allegedly requiring authorization hung on a hacked user: <br><img src="https://habrastorage.org/storage1/655b2936/54d58d71/bf691189/2ce36a03.gif"><br><br>  Yes, and the phishing site was arranged quite interesting.  Design according to the custom was contact and offered to log in.  I passed authorization through random mail and password, fake perfectly swallowed.  Then it was even more interesting, on the main there was news from "Pavel Durov": <br><img src="https://habrastorage.org/getpro/habr/post_images/f67/b75/78e/f67b7578e47c326c3c2d54a5b4f0bb87.jpg" alt="image"><br><br>  After clicking on the button "Create a personal counter," followed by a wonderful progress bar.  Then it was proposed to indicate your number and send sms: <br><img src="https://habrastorage.org/getpro/habr/post_images/997/595/629/99759562969a3e9d8b75c3563ec2b57d.jpg" alt="image"><br><br>  In theory, after a successful "activation" was supposed to be transferred to the activ.php page, but I could not get there.  Excerpts from JS scripts phishing site: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">... <br> <font color="#0000ff">if</font> (req.status == 200) { <br> <font color="#008000">//   200 () -   </font> <br> <font color="#0000ff">if</font> (req.responseText == <font color="#A31515">'ok'</font> ) { <br> <font color="#008000">//statusElem.innerHTML = ' !';</font> <br> get_activation(); <br> } <br> <font color="#0000ff">if</font> (req.responseText == <font color="#A31515">'not'</font> ) {statusElem.innerHTML = <font color="#A31515">"  "</font> ;} <br> <font color="#008000">//statusElem.innerHTML = " : "+req.responseText;</font> <br> ... <br> <font color="#0000ff">function</font> get_activation() { <br> <font color="#0000ff">document</font> .location= <font color="#A31515">"activ.php"</font> ; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  <b>Bottom line</b> : Fraudsters use warning bypass through OAuth 2.0, get a password and user email, and even try to send SMS messages (most likely using a subscription system). </div><p>Source: <a href="https://habr.com/ru/post/122834/">https://habr.com/ru/post/122834/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../122828/index.html">comScore: The network is "shrinking" because of Facebook</a></li>
<li><a href="../122829/index.html">Data binding in JavaScript applications: auto-authoring events</a></li>
<li><a href="../122830/index.html">Checkout right</a></li>
<li><a href="../122831/index.html">Qt. Creating a console widget for a graphics application</a></li>
<li><a href="../122832/index.html">Conference site DevCon'11 published conference materials</a></li>
<li><a href="../122835/index.html">Transparent proxying in I2P and Tor</a></li>
<li><a href="../122836/index.html">Check for monopoly</a></li>
<li><a href="../122839/index.html">The game "Terraria" and its "good" profile encryption system</a></li>
<li><a href="../122840/index.html">Implementation of the backend in multiplayer online games</a></li>
<li><a href="../122842/index.html">Home bookkeeping using Google Docs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>