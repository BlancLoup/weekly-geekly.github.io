<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>libuniset2 is a library for creating ACS. It is better to see once ... Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once upon a time ... I wrote an article ‚ÄúIntroduction to libuniset - a library for creating an automated control system‚Äù , there were plans to write a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>libuniset2 is a library for creating ACS. It is better to see once ... Part 1</h1><div class="post__text post__text-html js-mediator-article">  Once upon a time ... I wrote an article <a href="http://habrahabr.ru/post/171711/">‚ÄúIntroduction to libuniset - a library for creating an automated control system‚Äù</a> , there were plans to write a sequel, but it didn‚Äôt work out.  Since then, the library has significantly ‚Äúgrown up‚Äù and even version 2.0 has already been released, in which many new features have appeared: remote viewing of logs and program variables, support for various useful and not-so-useful protocols and databases, there is even a ‚Äútime machine‚Äù if this comes to that ... <br><br>  In general, I gathered my strength and decided that it was better to ‚Äúsee it once‚Äù with a specific example. <br><br>  Therefore, who else is interested, please. <br><a name="habracut"></a><br>  Several articles are planned on the stages of work: <br><ul><li>  Part 1. Configuring the project and creating a simulator </li><li>  <a href="http://habrahabr.ru/post/278537/">Part 2. Running the simulator</a> </li><li>  <a href="http://habrahabr.ru/post/278565/">Part 3. Creating the management process</a> </li><li>  <a href="http://habrahabr.ru/post/278589/">Part 4. Debugging and tools used for this.</a> </li><li>  <a href="http://habrahabr.ru/post/278607/">Part 5. Functional testing (using <i>uniset2-testsuite</i> )</a> </li><li>  <a href="http://habrahabr.ru/post/278697/">Part 6. Final (remaining ‚Äúoff-screen‚Äù)</a> </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Unfortunately, it is difficult to create an example of a real multi-site network project (at least you will need a network of virtual machines, installation of packages, deployment, etc.).  Therefore, I will consider a simple example that can be compiled and run locally and show the work of the basic uniset-concepts on it. <br><br>  As an example, take the following "spherical" puzzle: <br>  It is necessary to write a level management process in the ‚Äútank‚Äù <br><br>  <i>The process fills the tank (turns on the pump), and as soon as the level reaches the specified upper threshold (95%), it gives a command to the pump ‚Äúemptying‚Äù the tank.</i>  <i>As soon as the level reaches the lower threshold (5%), it starts filling again.</i>  <i>And so in a circle.</i> <i><br><br></i>  <i>Work must begin after the arrival of (1) the special command ‚ÄúStart work‚Äù and end when the ‚ÄúStart work‚Äù command is removed (0).</i> <br>  Since  I myself mainly work with <a href="https://www.altlinux.org/">ALTLinux</a> , then all the examples will be considered under this OS. <br>  I <i>'m sitting</i> on <a href="http://www.altlinux.org/%25D0%25A7%25D1%2582%25D0%25BE_%25D1%2582%25D0%25B0%25D0%25BA%25D0%25BE%25D0%25B5_Sisyphus%253F">Sisyphus</a> , but examples will work on the <a href="http://www.altlinux.org/P7">P7 Platform</a> <br>  <i>So...</i> <br><br><h3>  Preparatory step - creating a project, installing packages </h3><br>  Install the necessary packages into the system <br><pre><code class="bash hljs">apt-get install libuniset2-devel libuniset2-extensions-devel libuniset2-utils libomniORB-names git gitk git-gui etersoft-build-utils ccache</code> </pre> <br>  Now you can lay our project ... <br><br>  <b><i>Important:</i></b> libuniset2 requires a compiler with C ++ 11 support. <br><br>  In order not to suffer too much, I have prepared a ‚Äúframework‚Äù, just download the <a href="">http://github.com/Etersoft/uniset2-example</a> master branch. <br><br>  So we have the following directory structure (of course it can be any, this structure is just a ‚Äúhabit‚Äù) <br><br>  / Utilities - various helper utilities (scripts) that the project usually acquires <br>  / conf - project configuration files <br>  / docs - documentation (and how without it in a good project) <br>  / include - place for common project header files <br>  / src - source code itself <br>  / lib - location for the common project library (common functions code) <br>  configure.ac is the project build file itself (yes, I use autotools) <br>  autogen.sh - helper script to generate Makefile.in <br><br>  and other files, which of course should be in the "beautiful" project. <br><br>  Run <pre> <code class="bash hljs">autogen.sh &amp;&amp; configure &amp;&amp; make</code> </pre><br>  By the way, I used to use <b>jmake</b> - this is such a wrapper over make from the <a href="https://www.altlinux.org/Etersoft-build-utils">etersoft-build-utils</a> package, which takes into account the presence of ccache in the system and the number of processors. <br><br>  If everything compiles, then you can follow further ... In general, we still have nothing and nothing. <br><br><h3>  Step One - Configuring a Uniset Project </h3><br><br>  In uniset projects, the entire system configuration is stored (usually in a single) xml file.  Again, out of habit, it is called configure.xml and put in ‚Äúconf /‚Äù.  I will not paint the format of this file, the goal is <i>‚Äúto launch something as soon as possible and see the work,‚Äù</i> but there is a description in the <a href="http://wiki.etersoft.ru/UniSet2/docs/page__concept.html">documentation</a> ... <br><br>  To begin to fill the configuration file, we need to understand from the description of the task which ‚Äúsensors‚Äù we need in our project.  In general, the following list is obtained: <br><ul><li>  ‚ÄúGET STARTED‚Äù command - DI sensor </li><li>  current level in the tank - AI sensor </li><li>  command to turn on the ‚Äúfilling pump‚Äù - DO sensor </li><li>  command to turn on the ‚Äúpump of emptying‚Äù - DO sensor </li></ul><br>  All this is entered into the <b>sensors</b> section (we assign an id as we want, just to be unique). <br>  The result will be something like this: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensors</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Sensors"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"OnControl_S"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">iotype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DI"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">textname</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  (1 - , 0 -  )"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"101"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Level_AS"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">iotype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AI"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">textname</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"   "</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"102"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CmdLoad_C"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">iotype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DO"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">textname</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"    ''"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"103"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CmdUnload_C"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">iotype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DO"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">textname</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"    ''"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensors</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  You can see that when you add sensors, we each set a unique identifier ( <b>id</b> ), a unique name ( <b>name</b> ) and still have <b>textname</b> = ".." - this text can be used later for GUI or other applications. <br>  Each sensor has one of four types ( <b>iotype</b> ).  Here is the <a href="http://wiki.etersoft.ru/UniSet2/docs/page__concept.html">link</a> to the documentation. <br><ul><li>  <b>DI</b> - Digital Input </li><li>  <b>DO</b> - Digital Output </li><li>  <b>AI</b> - Analog Input </li><li>  <b>AO</b> - Analog Output </li></ul><br>  <i>In general, the division into such types is a bit conditional, as long as there is no work with real I / O.</i>  <i>But the types themselves determine what a particular sensor is from the point of view of the designed system.</i>  <i>‚ÄúInputs‚Äù is what ‚Äúenters the system‚Äù, ‚Äúexits‚Äù - this is what ‚Äúleaves‚Äù (that is, what the system forms).</i> <br><br>  With the sensors previously figured out ... <br><br><h3>  Step two - create a simulator </h3><br><br>  In fact, in order for us to debug the work of our management process, we need to also write a small imitator.  In essence, the same management process, only imitating the ‚Äúnecessary equipment‚Äù.  Therefore, we start with it, as a simpler process ( <s>with a stretch, we assume that we are TDD fans</s> ). <br>  As a result, we have two more directories in the project. <br><br>  <i>src / Algorithms / Controller</i> - process control (solving the task) <br>  <i>src / Algorithms / Imitator</i> - simulator for adjusting the control process <br><br>  Since there are still a couple of service directories (which will be discussed later), I select the processes in a separate subdirectory <i>"Algorithms"</i> . <br><br>  So, the simulator task (the simplest "stupid" option): <br><ul><li>  Upon the command ‚Äúfill‚Äù imitate the filling of the tank (increase in the value of the analog level sensor in the tank). </li><li>  At the command "empty" imitate the emptying of the tank (reducing the value of the analog level sensor in the tank). </li></ul><br><h4>  Creating an xml file describing the simulator </h4><br>  It is time to talk about one auxiliary, but very important uniset-utility: <i><b><a href="http://wiki.etersoft.ru/UniSet2/docs/page__codegen.html">uniset2-codegen</a></b></i> . <br>  With the help of it, on the basis of a special xml-description, a "skeleton" of the process is generated, containing the entire "routine part" of work.  Then, "inheriting" from the generated class (skeleton), it is enough just to implement the necessary functionality (by redefining the virtual functions). <br><br>  The xml-description file is a simple xml file which describes the ‚Äúinputs‚Äù and ‚Äúoutputs‚Äù <br>  for this process (if we consider it a ‚Äúblack box‚Äù).  It is important to understand that: <br><ul><li>  ‚ÄúInputs‚Äù and ‚Äúoutputs‚Äù are essentially sensors that your process ‚Äúreceives‚Äù (inputs) or ‚Äúexposes‚Äù (outputs) </li><li>  what is the ‚Äúentrance‚Äù for one process, it may well be the ‚Äúexit‚Äù for another. </li><li>  Inputs / outputs are not the sensors themselves, but simply class fields, which later (during the start) are tied to specific sensors. </li></ul><br>  To realize all this, let's get right to the point.  For the simulator we have: <br>  <b>Two entrances</b> are commands to fill / empty and <b>one exit</b> is the level actually simulated in the tank.  Then its part of the xml file describing the inputs / outputs will look like this: <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">smap</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Level_s"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vartype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"out"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">iotype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AI"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">comment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"   "</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cmdLoad_c"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vartype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"in"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">iotype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DO"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">comment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  "</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cmdUload_c"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vartype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"in"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">iotype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DO"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">comment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  ¬´¬ª"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">smap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  <b>name</b> - sets the name of the ‚Äúvariable‚Äù (in the class skeleton);  From this name will be generated class fields containing (id of the sensor to which the input / output is attached), as well as a variable containing the current value. <br>  <b>vartype</b> - defines the type of the "input" or "output" variable.  The input is that which is ‚Äúread‚Äù, ‚Äúoutput‚Äù - that which is ‚Äúwritten‚Äù. <br>  <b>comment</b> - turns into a comment in <a href="http://www.doxygen.org/">doxygen</a> style (/ *! &lt; * /) <br><br>  Accordingly, in general, we can subsequently launch several simulators, each of which will be tied to its sensors ... <br><br>  For those who are interested in more .. <div class="spoiler">  <b class="spoiler_title">The full version of the description file looks like this:</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- name -   msgcount -       sleep_msec -       type ==== in -  (  ) out -  () --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Imitator</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">settings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">set</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"class-name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Imitator"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">set</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"msg-count"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"30"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">set</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sleep-msec"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"150"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">settings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">variables</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stepVal"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"long"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">const</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">default</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"6"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">comment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  ()"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stepTime"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"long"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">const</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">default</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"500"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">comment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"   , "</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">variables</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">smap</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Level_s"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vartype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"out"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">iotype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AI"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">comment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"   "</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cmdLoad_c"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vartype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"in"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">iotype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DO"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">comment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  "</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cmdUload_c"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vartype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"in"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">iotype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DO"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">comment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  ''"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">smap</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">msgmap</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">msgmap</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Imitator</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><h4>  Writing simulator code </h4><br>  Having formed the <i>inputs / outputs,</i> we can now generate a skeleton.  Without going into details, this is done with the command: <br><pre> <code class="bash hljs">uniset2-codegen -n Imitator --ask --no-main imitator.src.xml</code> </pre><br>  the <b>--ask</b> parameter says to generate a process based on change notifications (ordering sensors) <br>  <b>--no-main</b> parameter - says not to generate main.cc  we will write our own. <br>  The <b>-n</b> parameter is the name of the class for which the skeleton is being generated. <br>  In general, this command is added to <div class="spoiler">  <b class="spoiler_title">Makefile.am</b> <div class="spoiler_text"><pre> <code class="bash hljs">bin_PROGRAMS = imitator BUILT_SOURCES = Imitator_SK.h Imitator_SK.h imitator_LDADD = $(top_builddir)/lib/libUniSetExample.la <span class="hljs-comment"><span class="hljs-comment">#imitator_CPPFLAGS = imitator_SOURCES = Imitator_SK.cc Imitator.cc imitator-main.cc Imitator_SK.h Imitator_SK.cc: imitator.src.xml @UNISET_CODEGEN@ -n Imitator --topdir $(top_builddir)/ --ask --no-main imitator.src.xml clean-local: rm -rf *_SK.cc *_SK.h *.log</span></span></code> </pre><br></div></div><br>  As a result, two files will be generated: <br>  <b>Imitator_SK.h</b> - header <br>  <b>Imitator_SK.cc</b> - implementation <br><br>  These are very interesting files, for studying what is being done there, but so far we are not up to them ... <br>  So we are laying our own implementation.  We create two files in which our work logic will be implemented. <br>  <b>Imitator.h</b> <br>  <b>Imitator.cc</b> <br><br>  Let's look at <b>Imitator.h</b> for details. <br><div class="spoiler">  <b class="spoiler_title">Imitator.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> Imitator_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> Imitator_H_ </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// ----------------------------------------------------------------------------- #include &lt;string&gt; #include "Imitator_SK.h" // ----------------------------------------------------------------------------- /*! \page_Imitator     (   ) - \ref sec_imitator_Common \section sec_loadproc_Common      ""(cmdLoad_c)     ( ).   ""(cmdUnload_c)     ( ). */ class Imitator: public Imitator_SK { public: Imitator( UniSetTypes::ObjectId id, xmlNode* cnode, const std::string&amp; prefix = "" ); virtual ~Imitator(); enum Timers { tmStep }; protected: virtual void sensorInfo( const UniSetTypes::SensorMessage* sm ) override; virtual void timerInfo( const UniSetTypes::TimerMessage* tm ) override; private: }; // ----------------------------------------------------------------------------- #endif // Imitator_H_</span></span></span></span></code> </pre><br></div></div><br>  In a uniset system, every object that wants to receive notifications about sensors and generally interact with the outside world in some way must have a unique identifier within the system.  In addition, our process requires inputs / outputs to be associated with specific sensors, for this in configure.xml each process has its own configuration section. <br>  As a result ... in the constructor, we pass the object identifier, as well as a pointer to a specific xml-node with the settings of this process.  In addition, there is still prefix (this is for processing command line arguments, it will be shown later how to use it). <br><br>  Based on the simulator description, we need processing of commands (inputs) and a timer to implement filling / emptying in time.  To do this, define (redefine) only two functions: <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">//     : virtual void sensorInfo( const UniSetTypes::SensorMessage* sm ) override; //   : virtual void timerInfo( const UniSetTypes::TimerMessage* tm ) override;</span></span></code> </pre><br>  First, let's take a closer look at the implementation of sensorInfo () <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Imitator::sensorInfo( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> UniSetTypes::SensorMessage* sm ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( sm-&gt;id == cmdLoad_c ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( sm-&gt;value ) { myinfo &lt;&lt; myname &lt;&lt; <span class="hljs-string"><span class="hljs-string">"(sensorInfo):   ''..."</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; askTimer(tmStep,stepTime); <span class="hljs-comment"><span class="hljs-comment">//     } } else if( sm-&gt;id == cmdUnload_c ) { if( sm-&gt;value ) { myinfo &lt;&lt; myname &lt;&lt; "(sensorInfo):   ''..." &lt;&lt; endl; askTimer(tmStep,stepTime); //     } } }</span></span></code> </pre><br>  Everything is simple here ... the ‚Äúfill‚Äù command came (cmdLoad_c = 1) - we start the timer ... (you never slept). <br>  The ‚Äúempty‚Äù command came (cmdUnload_c = 1) - we also start the timer.  All logic is contained in the timer. <br>  (of course, you can implement this all in a different way ... I just need to somehow demonstrate how to work with timers :)) <br><br>  Let's see the implementation of timerInfo (). <br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Imitator::timerInfo( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> UniSetTypes::TimerMessage* tm ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( tm-&gt;id == tmStep ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( in_cmdLoad_c ) <span class="hljs-comment"><span class="hljs-comment">//  .. { out_Level_s += stepVal; if( out_Level_s &gt;= maxLevel ) { out_Level_s = maxLevel; askTimer(tmStep,0); //   ( ) } return; } if( in_cmdUnload_c ) //   { out_Level_s -= stepVal; if( out_Level_s &lt;= minLevel ) { out_Level_s = minLevel; askTimer(tmStep,0); //   ( ) } return; } } }</span></span></code> </pre><br>  When the timer <i>tmStep is triggered</i> (we can have as many timers as possible).  We see which team we are holding now, if we fill ( <i>in_cmdLoad_c = 1</i> ), then we increase <i>out_Level_s</i> by an increment step ( <i>stepVal</i> ), if we empty out, we decrease <i>out_Level_s</i> by a step <i>stepVal</i> .  At the same time, check max and min. <br><br>  <i>And now a small analysis of the whole kitchen ...</i> <br><br><h5>  <b>"From" in the class appeared fields in_cmdLoad_c, in_cmdUnload_c, out_Level_s.</b> </h5><br>  They are actually generated in the skeleton. <br><br>  For all the "inputs" ( <i>vartype</i> = "in", see the xml-description file), the following fields are generated in the skeleton <br>  <b>name</b> - the field containing the ID of the sensor with which this "input" is associated <br>  <b>in_name</b> - field containing the current sensor value <br><br>  For all the "outputs" ( <i>vartype</i> = "out", see the xml-description file), the following fields are generated in the skeleton <br>  <b>name</b> - the field containing the identifier of the sensor with which this "output" is associated <br>  <b>out_name</b> - field for setting the sensor. <br><br><h5>  <b>how does the timer work</b> </h5><br>  In the same skeleton there is a special function <i><b>askTimer (timerId, msec, count)</b></i> <br>  <b>timerId</b> - timer identifier (this is some kind of your number so that you can distinguish between timers) <br>  <b>msec</b> is the time for which the timer is set in milliseconds.  If set to 0, the timer is disabled. <br>  <b>count</b> - optional parameter how many times the timer will work (by default it will come every msec milliseconds until it is stopped). <br><br>  When the timer is ‚Äústarted‚Äù, the <i>timerInfo</i> function <i>(const UniSetTypes :: TimerMessage * tm)</i> is called every <i>msec</i> milliseconds to which the <i><a href="https://wiki.etersoft.ru/UniSet2/docs/classuniset_1_1_timer_message.html">TimerMessage</a></i> structure containing the identifier of the activated timer is transmitted. <br><br>  <b>It is important</b> : <br><ol><li>  it's still not realtime and therefore the timers guarantee only that they will not work ‚Äúearlier‚Äù than the specified time. </li><li>  Timers are not asynchronous (!)  processing of messages is carried out sequentially, if you get stuck somewhere in the handler ( <i>sensorInfo</i> for example) by calling there some <i>sleep (xxx)</i> then the timer will ‚Äúlinger‚Äù for this time. </li><li>  timers must be a multiple of the minimum ‚Äúquantum‚Äù (step) of the time specified in the xml file in the parameter <pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">set</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sleep-msec"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"150"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre>  Those.  if 150 ms is indicated here, then the 50 ms timer will still work after 150 ms. </li></ol><br>  While I propose not to pay attention to these details, about them later ... <br><br><h5>  <b>how sensorInfo works</b> </h5><br>  The <b>sensorInfo ()</b> function is called whenever the value of an ‚Äúinput‚Äù changes.  In fact, notification of a change in a particular sensor comes from <i>SharedMemory</i> (if the process works on notifications). <br><br>  <i>So with the logic decided.</i>  <i>It remains to write the actual main ().</i> <br>  Just show the code, and then comment on ... <br><br><h5>  <b>main () function</b> </h5><br><br><div class="spoiler">  <b class="spoiler_title">main.cc</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;UniSetActivator.h&gt; #include "UniSetExampleConfiguration.h" #include "Imitator.h" // ----------------------------------------------------------------------------- using namespace UniSetTypes; using namespace std; // ----------------------------------------------------------------------------- int main( int argc, const char** argv ) { try { auto conf = uniset_init(argc, argv); auto act = UniSetActivator::Instance(); auto im = UniSetExample::make_object&lt;Imitator&gt;("Imitator1", "Imitator"); act-&gt;add(im); SystemMessage sm(SystemMessage::StartUp); act-&gt;broadcast( sm.transport_msg() ); act-&gt;run(false); return 0; } catch( const Exception&amp; ex ) { cerr &lt;&lt; "(imitator): " &lt;&lt; ex &lt;&lt; endl; } catch( const std::exception&amp; ex ) { cerr &lt;&lt; "(imitator): " &lt;&lt; ex.what() &lt;&lt; endl; } catch(...) { cerr &lt;&lt; "(imitator): catch(...)" &lt;&lt; endl; } return 1; } // -----------------------------------------------------------------------------</span></span></span></span></code> </pre><br></div></div><br>  First you need to download the same project configuration and initialize everything you need to work libuniset.  All this is done in the function <i>uniset_init (argc, argv)</i> , which returns a global pointer (shared_ptr) conf (configuration), for all needs.  You can also get it anywhere in the program. <pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> conf = uniset_conf();</code> </pre><br>  In this example, we are not using it (explicitly, but actually using <b>make_object</b> ). <br>  In <i>uniset_init ()</i> , the configure.xml file is downloaded (the file with this name is the default download attempt).  It can be overridden either by passing the third argument to <pre> <code class="cpp hljs">uniset_init(argc,argc,<span class="hljs-string"><span class="hljs-string">"myconfigure.xml"</span></span>)</code> </pre>  , or in the command line by setting the parameter <i>--confile myconfile.xml</i> . <br><br>  All uniset objects must be "activated", after which they will be able to receive notifications and generally interact with the outside world.  For this, there is a <i>UniSetActivator</i> in the system (as can be seen from the code, this is <i>singleton</i> ).  The activation process is simple: <i>create an object and add it to the activator</i> (more precisely, shared_ptr to the object). <br><br>  To create an object of our class <i>Imitator</i> , as described above, we need to pass it its unique identifier and pointer to the xml-node with the settings.  For convenience and clarity, the <i>UniSetExampleConfiguration</i> declared the template function <b>make_object &lt;&gt;</b> which transmits the text name of the object (name in the section from configure.xml) and the configuration node <b>&lt;XXXNodeName name = ‚ÄúObectName /&gt;</b> for this object in <i>configure.xml</i> .  In the make_object &lt;&gt; function, all the ‚Äúmagic‚Äù of getting an <b>ObjectId</b> object by these parameters and finding xmlNode * in <i>configure.xml</i> is already hidden.  From the example it can be seen that the object (identifier) ‚Äã‚Äãwith the name <i>"Imitator1"</i> and the configuration section <b>&lt;Imitator name = "Imitator1"</b> must exist in <i>configure.xml</i> <b>... /&gt;</b> <br><br>  Here‚Äôs what it looks like in configure.xml <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">objects</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Objects"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">section</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Objects"</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20001"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Imitator1"</span></span></span><span class="hljs-tag">/&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">objects</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  And the setup section is usually created in the <b>settings</b> section. <br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">settings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Imitator</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Imitator1"</span></span></span><span class="hljs-tag">/&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">settings</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  At this coding simulator ended. <br><br><h3>  Simulator Configuration </h3><br>  The configuration process itself is to populate the <i>configure.xml</i> and bind the sensors to the inputs and outputs of the process.  To help in this matter, there is a special utility <b>uniset-linkeditor</b> .  This is the bindings editor, which allows you to graphically make bindings, as well as edit some other parameters declared in the xml-description file.  <i>Uniset-linkeditor itself is</i> written in python.  It is installed as a separate package.  So we need to install it first. <br><pre> <code class="bash hljs">apt-get install uniset-configurator</code> </pre><br>  In the <i>src / Algorithms / Imitator directory there</i> is a special script <i>edit_imitator.sh that</i> launches the binding editor.  Actually, we need to connect our teams ( <i>inputs</i> ) with the <b>CmdLoad_C</b> and <b>CmdUnload_C</b> sensors <b>,</b> and <b>tie the</b> level in the tank ( <i>output of our simulator</i> ) to the <b>Level_AS</b> sensor.  This can be done manually, there is nothing difficult in it ... As a result, the configuration section for our simulator (in the <i>configure.xml</i> project file) should take the form <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Imitator</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Imitator1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Level_s</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Level_AS"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cmdLoad_c</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CmdLoad_C"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cmdUnload_c</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CmdUnload_C"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  As you can see, the bindings are easy to create.  Each input or output should be installed in accordance with the sensor in the system. <br><br><h3>  Subtotal </h3><br>  Despite the fact that there were ‚Äúmany letters‚Äù, in fact we did quite a bit <br><ul><li>  Created (filled) the project file <b>configure.xml</b> </li><li>  We created a file describing our simulator <b>imitator.src.xml</b> and generated a ‚Äúskeleton‚Äù of the class </li><li>  <b>Wrote the</b> implementation of our logic ( <b>only two functions</b> ) </li><li>  Wrote ( <i>almost stereotyped</i> ) <b>main ()</b> </li><li>  Configured our simulator ( <i>tied specific sensors</i> ) </li></ul><br>  And that's all ... <br><br>  It remains now to try to run. <br>  This will be in the <i><a href="http://habrahabr.ru/post/278537/">next part ...</a></i> <br><br>  For those who are interested: <br><ul><li>  <a href="http://github.com/Etersoft/uniset2">Project libuniset2 on github</a> </li><li>  <a href="http://github.com/Etersoft/uniset2-example">Example Sources</a> </li><li>  <a href="http://bugs.etersoft.ru/enter_bug.cgi%3Fproduct%3DUniSet">Project bugsilla</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/278535/">https://habr.com/ru/post/278535/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278519/index.html">March 8, moms and programming</a></li>
<li><a href="../278521/index.html">Informational messages in 1C. How can I do that</a></li>
<li><a href="../278523/index.html">The threshold for entry into Angular 2 - theory and practice</a></li>
<li><a href="../278527/index.html">Correct work with date and time</a></li>
<li><a href="../278533/index.html">(La) TeX on Habrahabr</a></li>
<li><a href="../278537/index.html">libuniset2 is a library for creating ACS. It is better to see once ... Part 2 (Running the simulator)</a></li>
<li><a href="../278539/index.html">Preparing for the CISA exam. Business Continuity Practices</a></li>
<li><a href="../278541/index.html">We invite you to a round table on gaming industry trends.</a></li>
<li><a href="../278545/index.html">Complex hardware nodes, simultaneous parallel execution and kernel / system runtime</a></li>
<li><a href="../278547/index.html">6 secrets of Bitbucket</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>