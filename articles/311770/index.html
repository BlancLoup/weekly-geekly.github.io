<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>JSOC availability: metrics and measurement</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue the series on Security Operations Center materials, and present to you the second edition. 

 Today's article is devoted to the ‚Äúmagic nin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>JSOC availability: metrics and measurement</h1><div class="post__text post__text-html js-mediator-article">  We continue the series on Security Operations Center materials, and present to you the second edition. <br><br>  Today's article is devoted to the ‚Äúmagic nines‚Äù of the availability and readiness of services.  We will tell you what the service indicators of cloud SOC are made up from the point of view of hardware and software, by what means they are controlled in Solar JSOC. <br><a name="habracut"></a><br>  The main goal of the Solar JSOC service is to identify and quickly analyze information security incidents with customers.  This creates five basic conditions for its availability <sup><a href="https://habr.com/ru/company/solarsecurity/blog/311770/">[1]</a></sup> : <br><br><ol><li>  The platform for collecting and processing information, collecting collectors at the sites, data transmission channels should be accessible and operational with the highest possible rate.  If information about events and incidents has nothing to collect and process, if it has no place to go, it is out of the question to identify incidents. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </li><li>  Information from the sources of information security events should be as complete as possible: we need to receive all the required audit events, on the basis of which the scenarios to identify incidents are built.  Completeness should reflect both the necessary list of event types (start / end of the connection, authentication, etc.), and the fields within the single event (addressing, zones, processes, event parameters) required for investigation. <br><br></li><li>  At the time of recording the incident by technical means, the process of collecting and analyzing information should be as quick as possible. <br><br></li><li>  Trouble-free registration in the case management system and a guaranteed route for the delivery of alerts to the desired customer. <br><br></li><li>  Round-the-clock seamless incident analysis as part of a guaranteed SLA. </li></ol><br>  It was these five postulates that formed the basis of our monitoring system used by us, which uses a similar number of levels. <br><br><h3>  Level 1. Solar JSOC infrastructure </h3><br>  Here I would like to give the typical customer wiring diagram that I used in the first article: <br><br><img src="https://habrastorage.org/files/9e8/6e1/225/9e86e12254ec4408acb8158c3e4c9137.jpg"><br><br>  Using this scheme divides the access control process into the following subsystems: <br><br><ol><li>  Network availability component: <br><br><ul><li>  availability of the SIEM-system core for the ability to work with the system of monitoring engineers; </li><li>  channel performance between the Solar JSOC kernel sites and the client: the presence of network connectivity between the connector servers and the system kernel; </li><li>  communication between connector servers and key client sources that are connected to collect events; </li><li>  availability of access from the SIEM-system core to additional servers for event processing and analysis, as well as the case management system. <br><br></li></ul></li><li>  Analysis of the state of network components: <br><br><ul><li>  the number of packet processing errors on network equipment; </li><li>  information on the quality of site-2-site tunnel operation between sites (session status, percentage of losses, etc.); </li><li>  utilization of network interfaces on all intermediate equipment; </li><li>  load on the Internet channel created by the transfer of traffic. <br><br></li></ul></li><li>  Performance levels of hardware and OS: <br><br><ul><li>  processor load and performance; </li><li>  use and distribution of RAM; </li><li>  availability of free space in the file partitions (system, productive and partition for backup); </li><li>  general performance of the disk subsystem. <br><br></li></ul></li><li>  Monitoring the status of key system and application services at the OS level: </li><li>  Monitoring for system log errors: <br><br><ul><li>  network equipment and firewalls; </li><li>  virtualization tools; </li><li>  OS on kernel components and connector servers. <br><br></li></ul></li><li>  Monitor connector logs and the ArcSight core for errors. </li><li>  Monitor the performance of the ArcSight database (read / write options). </li></ol><br>  Monitoring of these indicators is fully carried out either through Zabbix, or by internal means of ArcSight.  For each indicator, statistics are collected and the triggers are set to the specified threshold values: warning - 20% of the maximum value, critical - 2-5% of the maximum value.  In general, everything is fairly standard, so we will not waste time on a detailed description and move on. <br><br>  Using this model provides an opportunity to quickly receive information about external and internal problems in the service and potentially "narrow" places in terms of infrastructure.  But the above parameters do not give us an idea of ‚Äã‚Äãthe completeness of the information we have, the necessary types of events collected from the customer's infrastructure, and the confidence that we see everything that is required to identify and respond to an incident. <br><br><h3>  Level 2. Completeness of information from sources </h3><br>  This leads us to the second task - the need to control the parameters of information coming to us from source systems: completeness, relevance, correctness of its parsing.  In the case of a SIEM system, the following parameters acquire criticality: <br><br><ul><li>  control not only the state of sources, but also incoming types of events; </li><li>  detection and prevention of parsing errors: a clear understanding of the correct event handling is necessary for the successful operation of the correlation rules; </li><li>  the desire to receive events in real-time mode with minimal losses. </li></ul><br>  Obviously, the task to control the incoming data and analyze them for completeness and integrity is, first of all, the task of the SIEM itself.  Unfortunately, out of the box it is not always possible to get acceptable results.  There are certain limitations: <br><br><ol><li>  <b>"Out of the box" does not take into account the ability to connect to one SIEM-system of several customers.</b> <br><br>  Therefore, although ArcSight has a sufficiently high-quality mechanism for determining the state of connected systems (in case of connectors falling, problems with availability of end sources or cache presence on the connector, the built-in correlation rules + visualization work), all ‚Äúboxed‚Äù rules and dashboards are not suitable for cloud SOC tasks. <br><br></li><li>  <b>Limited functionality to determine the absence of information from the source of events according to the principle ‚Äúthere has not been a single event in the last N hours.‚Äù</b> <br><br>  The first difficulty (or a feature, whichever one you like more) is that the control goes over the whole source (Microsoft Windows, Websense Proxy, McAfee ePolicy) and various types of events are not taken into account.  The second difficulty is that the out-of-the-box solution does not allow for monitoring events based on their normal number and deviation from the profile. <br><br>  As an example, consider gathering events from a Cisco ASA firewall with the required audit level.  One of the most important tasks in monitoring this equipment is to identify and process remote access VPN sessions that are terminated by a firewall.  At the same time, in the general flow of events they make up less than 1%.  Their absence (for example, due to changes in audit settings) in the total volume of events may simply go unnoticed. </li></ol><br>  But against the background of the above limitations, ArcSight has high-quality mechanisms for controlling the content itself: <br><br><ol><li>  <b>The presence of a built-in mechanism for parsing events and assessing the success of its normalization.</b> <br><br>  This mechanism signals that the received event was not successfully parsed by the connector due to a format mismatch. <br><br>  This event is called the ‚ÄúUnparsed Event‚Äù, and notification of it can be delivered either by mail or by creating a case directly in the ArcSight console.  This mechanism helps to successfully solve the problem number 2 - to form an idea of ‚Äã‚Äãthe completeness of the information received. <br><br></li><li>  <b>A mechanism to control the time stamps of incoming events and ArcSight time.</b> <br><br>  Together with the definition of caching of events on the connector, this is almost a ready-made solution to the problem of promptly collecting and analyzing information.  In addition, along the way, there are facts of incorrect time settings on the devices. <br></li></ol><br>  But, as noted in the previous article, HP ArcSight is, first of all, a framework.  And we, creating Solar JSOC, modified our model of control of incoming information. <br><br>  First, we changed the source definition logic.  For each type of source, we identified categories of important events for us and identified the most frequent ones from them, the presence of which can be taken as a basis. <br><br>  For example, for Windows, you can write this "mapping": <br><br><blockquote>  <i>4624, Logon / Logoff: Logon</i> <i><br></i>  <i>4768, Account Logon: Kerberos Ticket Events</i> <i><br></i>  <i>4663, Object Access: File System</i> <i><br></i>  <i>4688, Detailed Tracking: Process Creation</i> <i><br></i>  <i>4689, Detailed Tracking: Process Termination</i> <i><br></i>  <i>4672, Logon / Logoff: Special Logon</i> <i><br></i>  <i>5140, Object Access: File Share</i> <i><br></i>  <i>etc.</i> <br><br>  For Cisco ASA, this is: <br><br>  <i>602303,602304,713228,713050, VPN Connection</i> <i><br></i>  <i>302013-302016, SessionStatistic</i> <i><br></i>  <i>106023, AccessDenied</i> <i><br></i>  <i>etc.</i> </blockquote><br>  ArcSight allows you to simply make such a mapping through configuration files. <br>  Previously, the source status event looked like this (on the example of Windows): <br><table border="1"><tbody><tr><td>  <b>Timestamp</b> </td><td>  <b>CustomerName</b> </td><td>  <b>ConnectorName</b> </td><td>  <b>Eventname</b> </td><td>  <b>DeviceName</b> </td><td>  <b>Event count</b> </td><td>  <b>DeviceVendor</b> </td><td>  <b>DeviceProduct</b> </td></tr><tr><td>  28 Jun 2016 15:23:36 MSK </td><td>  Solar security </td><td>  Solar_Windows Srv Connector </td><td>  Status - OK </td><td>  ex-hub1 - 10.199. *. * </td><td>  164152 </td><td>  Microsoft </td><td>  Microsoft Windows </td></tr></tbody></table><br>  Now, in JSOC, each of our categories of events has its own status: <br><table border="1"><tbody><tr><td>  <b>Timestamp</b> </td><td>  <b>CustomerName</b> </td><td>  <b>ConnectorName</b> </td><td>  <b>Eventname</b> </td><td>  <b>DeviceName</b> </td><td>  <b>Event count</b> </td><td>  <b>DeviceVendor</b> </td><td>  <b>DeviceProduct</b> </td></tr><tr><td>  28 Jun 2016 15:23:36 MSK </td><td>  Solar security </td><td>  Solar_Windows Srv Connector </td><td>  Status - OK </td><td>  ex-hub1 - 10.199. *. * </td><td>  35423 </td><td>  Microsoft </td><td>  Object Access: File Share </td></tr><tr><td>  28 Jun 2016 15:23:36 MSK </td><td>  Solar security </td><td>  Solar_Windows Srv Connector </td><td>  Status - OK </td><td>  ex-hub1 - 10.199. *. * </td><td>  7576 </td><td>  Microsoft </td><td>  Logon / Logoff: Logon </td></tr><tr><td>  28 Jun 2016 15:23:36 MSK </td><td>  Solar security </td><td>  Solar_Windows Srv Connector </td><td>  Status - OK </td><td>  ex-hub1 - 10.199. *. * </td><td>  1530 </td><td>  Microsoft </td><td>  Detailed Tracking: Process Creation </td></tr></tbody></table><br>  For each new source, long-term dynamic profiling is carried out in terms of the volume and number of events coming from it to ArcSight.  As a rule, the profile measurement unit is 1 hour, the profiling duration is 1 month.  The main purpose of profiling is to determine the average and maximum values ‚Äã‚Äãof the number of events from sources at different time intervals (working day, night, weekend, etc.). <br><br>  Once the profile is built, you can evaluate the completeness of the incoming information.  For example, using the following rules: <br><br><ul><li>  The absence of events is determined not by a given interval, but by comparison with a profile that takes into account whether there should be events from a given source during this period of time. <br><br></li><li>  If the number of events in the last hour is 20% less / more than the baseline at similar intervals in our profile, this is considered a deviation and, therefore, the reason for more detailed understanding of the situation. <br><br></li><li>  If there are new types of events from new sources, we automatically determine this by the absence of a filled profile.  This may occur if the customer, for example, changed the level of audit settings at the source, or ‚Äúwrapped‚Äù a new piece of hardware to UDP Syslog in the direction of the connector server. </li></ul><br>  Thus, the implemented ‚Äúlong‚Äù dynamic profiling allows us to quickly track problems in data transfer and monitor the integrity of the information coming to us. <br><br>  Secondly, we have refined the standard rules and dashboards for monitoring sources.  Added information about customers and two separate status tracking profiles for connectors and connected devices.  As a result, all the rules are entered into a single structure for generating incidents, and a case is created for each of them (as well as when monitoring system components). <br><br>  It turned out about the following: there are two dashboards near the same ESM (one is standard, the other is ours).  There is no problem with standard monitoring.  And our version reflects problems with connecting the connector to sources, the absence of events of a certain category and the increased flow of events from one of the devices. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/2f7/988/cbb/2f7988cbbcf54c419f865e4c0b95ddff.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/384/186/835/384186835c0f41f69d6ff3a001c80c25.png"></div><br>  One small but important problem remains: a part of audit events on target systems is very rare.  For example, adding a user to a domain administrators group in Active Directory or events to change the configuration of a network device (collected through Cisco ACS tacacs-server), etc.  At the same time, the very fact of the occurrence of such an event is often already an information security incident even without the additional construction of complex chains of event correlation. <br><br>  In this case, we have to resort to the scripting equipment: in agreement with the customer, we emulate a test event on the target system with a certain frequency and thus make sure that random errors in working with the audit will not cause an incident not to be detected. <br><br>  It is worth noting that, despite the high level of control over events, built in the framework of the model described above, we, nevertheless, regularly conduct combat tests of the audit system and our incident handling team.  The methodology is as follows: the customer independently (or with our help) performs a set of actions on the sources connected to Solar JSOC, triggering various scenarios (brute-force on the system, changing the ACL to a ME, starting a remote administration session, scanning the network, etc.).  First, we fix the fact of receiving all the initial information in Solar JSOC, secondly, we once again confirm the correctness of the correlation rules, well, and finally, we check the reaction and the level of incident analysis with the first line of the Solar JSOC team. <br><br><h3>  Level 3. Speed </h3><br>  An equally important indicator of the service is the performance of the SLA.  Therefore, it is very important to ensure maximum system performance when building reports, channels, reports when an incident is analyzed by a monitoring engineer or analyst. <br><br>  In this case, as a rule, it is sufficient to determine the set of operations and reports necessary for investigating the most critical or frequency incidents, and to measure their execution time on the customer‚Äôs weighted average case.  Information about the speed of execution we take from two sources at once. <br><br>  The first one is reports and operations that are performed on a schedule and show us ‚Äúreference‚Äù performance indicators.  In this case, we made two types of reports that run according to a schedule: a report on a deliberately empty filter and a report on typical events (the same monitoring of sources) with summation over the fields.  Based on the results of the work of these reports, we collect statistics and look at the dynamics of changes: <br><br><img src="https://habrastorage.org/files/0eb/887/018/0eb88701819f4504b8948fe929b6a199.png"><br><br>  The second is information on the time of execution of current reports by employees. <br><br>  Within the framework of the compensating measure, most of the information necessary for the analysis of the incident (information about the host, user, statistics on proxies, domain operations, recent authentication, sessions), we brought to the lists, the use of which greatly accelerates the work of the first line of case analysis.  In our experience, it is rarely necessary to build channels with a search depth of more than three days. <br><br><h3>  Level 4. Case management and customer notification </h3><br>  In the presence of a large number of customers and several installations of a SIEM system, it becomes necessary to work with a single window when analyzing incidents.  ArcSight's standard case management did not satisfy all of our wishes, so it was decided to switch to an external ticket system, and we chose Kayako. <br><br>  Due to this transition, the number of errors due to incorrect delivery of notifications has disappeared.  All routes of notifications and escalations are built automatically; the first-line engineer and analyst have access to the application for editing at the same time. <br><br>  It was also possible to avoid problems with confusion in installations, when there were more than 4 of them: inside each case in Kayako there is immediately a hyperlink to the desired ArcSight ESM. <br><br>  More information about the case management scheme, the features we came to, will be discussed in one of the following articles. <br><br>  In the meantime, back to accessibility issues. <br><br><h3>  Level 5. People and SLA </h3><br>  One of the most important moments in the provision of service is the timely analysis of incoming cases, regardless of their number and time of day. <br><br>  As part of the JSOC, we have developed the following mechanisms to address these issues: <br><br><ol><li>  With the introduction of the round-the-clock shift, there is a buffer zone in the morning and evening ‚Äî a shift from 9 to 10 in the morning and from 8 to 9 in the evening.  This is the stage when night and day shifts intersect.  The previous shift closes those cases that arose before the shift change, transmits relevant information to the customer, indicates important points that occurred in their shift (for example, an attack on the customer, the need for regular monitoring of certain hosts, etc.).  New shift is included in the work and begins to disassemble the cases that come in shift change. <br><br></li><li>  For emergency situations with a large number of incidents, there are reserves.  During the day this is the second line of monitoring and analytics.  At night, there is one monitoring engineer in the shift, and the second is always waiting ‚Äúat a low start‚Äù, ready to join the case study for 15 minutes.  In addition, there is a duty analyst who owns information on all customers and is connected to the analysis in the event of an escalation of criticality, expertise, or number of incidents.  Or around at the same time. </li></ol><br>  These methods allowed us to comply with the SLA metrics and quickly analyze any number of incidents registered with our customers. <br><br>  This concludes the second article in the series.  The next will be devoted to the case management system that we use in providing services. <br><br><hr><br><ol><li>  <a href="https://habr.com/ru/company/solarsecurity/blog/311770/">‚Üë</a> Then I will use this term, although many will probably accuse me of misusing established terms.  From the point of view of GOST R 53480-2009, there is the concept of ‚Äúreadiness‚Äù, the concept of ‚Äúaccessibility‚Äù is absent.  There is also the IEC 60050, which uses several concepts: accessibility, availability, capability.  But within this article, for simplicity and time saving, I will use only one ‚Äúwell-established‚Äù term - accessibility.  It may not be entirely technically correct, but, in my opinion, it best reflects the objectives of the business. </li></ol></div><p>Source: <a href="https://habr.com/ru/post/311770/">https://habr.com/ru/post/311770/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../311760/index.html">Network monitoring with FlapMyPort</a></li>
<li><a href="../311762/index.html">Pitfalls Bash</a></li>
<li><a href="../311764/index.html">Analytics for the theater industry - a new niche for startups</a></li>
<li><a href="../311766/index.html">The evolution of mobile slang: when will graphics replace words?</a></li>
<li><a href="../311768/index.html">A selection of useful materials on the development of Xamarin</a></li>
<li><a href="../311772/index.html">Patent hysteria: how to stop being afraid of journalistic prejudices</a></li>
<li><a href="../311774/index.html">Unofficial supplement to the article about MegaFon's bank card</a></li>
<li><a href="../311778/index.html">The best vacancies on My Circle for the week, September 19-25</a></li>
<li><a href="../311780/index.html">RDP Disable system, function keys. Windows 2008R2</a></li>
<li><a href="../311782/index.html">Numbers grow: attack at 620 Gbps registered</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>