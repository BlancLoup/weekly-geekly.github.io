<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Why Doctrine ORM is Bad for PHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article is a translation of the note Why Doctrine ORM is not suited for PHP by Lucas Corbeaux. 

 I know that the title of this article is like tr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Why Doctrine ORM is Bad for PHP</h1><div class="post__text post__text-html js-mediator-article">  <i>The article is a translation of the note <a href="http://blog.bemycto.com/software-architecture/2015-05-17/doctrine-orm-not-suited-php/">Why Doctrine ORM is not suited for PHP</a> by Lucas Corbeaux.</i> <br><br>  I know that the title of this article is like trolling.  But it is not, it is just a statement of fact.  I'm not trying to say that Doctrine is a bad library or that it should not be used.  I'm just saying that it is bad for PHP, and if you do not take this moment into account and use it incorrectly, you can face serious problems. <br><a name="habracut"></a><br><h2>  Doctrine inspired by Hibernate ORM </h2><br>  Let's go back to the 2000s.  Java is very popular and one of the most frequently used Java libraries is ORM Hibernate.  It came with its own HQL query language and was beloved by the Java community.  Hibernate helped Java objects and relational tables coexist. <br><br>  Doctrine was inspired by the concepts of Hibernate and wanted to bring them into the world of PHP. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Differences between Java and PHP </h2><br>  But PHP is not Java, and one very important conclusion can be drawn from this.  A Java application lives much longer than a PHP request. <br><br>  The ORM must consider data integrity between all users.  For a long time, every change in the database should be reflected for all objects.  This is one of the reasons why ORM is so complex. <br><br>  And that is why the ORM patterns are mostly not needed by PHP.  Since HTTP is a stateless protocol, you don‚Äôt need to maintain data consistency between all calls. <br><br><h2>  Problem sessions </h2><br>  Of course, you can tell me that this is not true.  You can use sessions to store objects between requests, and then you need a way to maintain their integrity.  This is a reasonable argument.  That's just the serialization of entities in Doctrine is pretty tricky and can lead to serious problems. <br><br><h2>  Identity Map is useless in a stateless environment. </h2><br>  Identity Map is part of Doctrine that supports entity uniqueness.  If you, for example, request an entity with ID 4 twice, then you will get the same object both times. <br><br>  At first glance it looks like a great idea.  But what is the essence of isolated execution? <br><br><ul><li>  If your code is well structured, then you will not need to request the same entity twice.  Instead, you use Dependency Injection; </li><li>  If you change the data, it is because you received a POST request.  When receiving a POST request, it is considered good practice to immediately perform a redirect.  There is no need to "update" objects. </li></ul><br><br>  It seems to me that the doctrine Identity Map is useful only in case of a bad design.  Or in a very rare and special case. <br><br><h2>  UnitOfWork too complicated </h2><br>  UnitOfWork is one of the main parts of the Doctrine ORM.  I do not say that it is useless, but it is too complicated.  I have already talked about sessions and the problem of serialization.  Entity management is a complex thing, and I can accept the complexity of implementation.  This moment is quite difficult to realize. <br><br>  But what I cannot reconcile with is the fact that most of the difficulties arose due to the ‚Äúlazy‚Äù loading and change tracking policies. <br><br><h2>  ‚ÄúLazy‚Äù loading is meaningless </h2><br>  In a stateless environment, lazy loading is bad practice.  I have nothing to add to this.  It may be possible to find instances when this slightly increased productivity, but this happens very rarely.  So why then is this one of the central concepts in Doctrine ORM? <br><br>  Almost every time I talk to a team using Doctrine, they admit that they had problems due to autoloading abuse.  And this happens, even with experienced developers. <br><br>  For one of my clients, I even wrote a logger specifically to detect and delete using lazy downloads.  This is just a glaring example of uselessness. <br><br><h2>  Change Tracking Policies </h2><br>  Why do we need such a complex system to ensure data integrity?  We are surrounded by "without saving the state"!  If our application has a good architecture, then the data does not change in random places.  Except in rare cases (logging, updating the last connection time, etc.), we just need to change the data on the POST request.  After that we immediately redirect the user to another page. <br><br>  So why do we need such a complex system?  To hide a poorly designed application? <br><br><h2>  EntityManager too much magic </h2><br>  The global EntityManager behaves like a Facade pattern that works with other ORM objects.  This is a very powerful tool that can be called anywhere in the code. <br><br>  However, I firmly believe that in a well-designed application, EntityManager should be used only in three cases: <br><br><ul><li>  When loading for configuration </li><li>  In your "factories", Service Manager or Dependency Injector to initialize the necessary objects. </li><li>  In some repositories, if you need to create a SQL query </li></ul><br><br>  In other places it is not necessary to use it. <br><br><h2>  Still an interesting and powerful library </h2><br>  For clarity, I will repeat the second time: I am not saying that Doctrine ORM is useless or that you should not use it.  What worries me most is that the library imposes bad habits. <br><br><ul><li>  Entity Map allows developers to be careless with the injection of dependencies and, accordingly, instances of entities. </li><li>  Lazy loading works too magically and hides performance problems until it is too late.  This is especially true for developers with a bit of experience.  But experienced developers sometimes also fall into this trap, because sometimes it is so tempting not to bother using fetch-join. </li><li>  EntityManager allows you to do anything, anywhere.  Convenient, but very far from good practices. </li></ul><br><br><h2>  What's next? </h2><br>  <i>The author of the original article has material for a few more articles about Doctrine.</i>  <i>For example, about the ODM extension or about generators.</i>  <i>In addition, it accepts applications in the <a href="http://blog.bemycto.com/software-architecture/2015-05-17/doctrine-orm-not-suited-php/">comments</a> .</i> </div><p>Source: <a href="https://habr.com/ru/post/259523/">https://habr.com/ru/post/259523/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259513/index.html">One day in the village. Skolkovo Startup Village</a></li>
<li><a href="../259515/index.html">Salt and Ansible - Python configuration management systems - video from DevConf 2014</a></li>
<li><a href="../259517/index.html">How to programmer to make money on the stock market, thinking only about the code: StockSharp and ITinvest competition</a></li>
<li><a href="../259519/index.html">Short note: 2 zabbix servers one client</a></li>
<li><a href="../259521/index.html">WPAD: instruction manual</a></li>
<li><a href="../259527/index.html">"Boss, write an application for us." Requires software developer and hardware for DJI drones</a></li>
<li><a href="../259529/index.html">Real Associative Arrays in JavaScript</a></li>
<li><a href="../259531/index.html">What you need to know when migrating from MySQL to PostgreSQL?</a></li>
<li><a href="../259533/index.html">Automated QA System: a headache pill for testers using the Star Crusade game as an example</a></li>
<li><a href="../259535/index.html">The tale of a single mistake, never got into the release of the Linux kernel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>