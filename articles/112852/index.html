<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kohana 3: module ‚Äúkohana-static-files‚Äù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When meeting with the framework, I first of all look not at its capabilities, but at the ready-made solutions that it provides. In particular, it is p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kohana 3: module ‚Äúkohana-static-files‚Äù</h1><div class="post__text post__text-html js-mediator-article"> <a title="Habraffe.ru" href=""><img align="right" src="https://habrastorage.org/storage/habraeffect/30/f0/30f0f3c35c3be5b26d537a265495c6cc.png"></a> <br>  When meeting with the framework, I first of all look not at its capabilities, but at the ready-made solutions that it provides.  In particular, it is possible to conveniently assemble JS / CSS files in parts and ‚Äúgive away‚Äù according to the recommendations for client optimization (YSlow / Google PageSpeed).  I did not see any of the implementations I looked at, I didn‚Äôt see, even in Django (which, in fact, was inspired), so I decided to make my decision in the form of a module ready for use for Kohana v.3. <br><br>  <b>So, we will describe the basic needs / wishes that were put before the development of the module:</b> <br>  1) Build inline CSS / JS bit by bit <br>  2) The ability to give claim 1 by inserting into the page code, or by generating and writing a file with a unique name on the disk. <br>  3) Ability to build external CSS / JS files in one build <br>  4) The ability to specify the condition under which this or that build from item 3 is connected, as well as any other external file ( <pre>  &lt;! - [if IE 7]&gt; </pre>  ). <br>  5) The ability to make static to another domain, the main thing that he was on the same physical server. <br>  6) Use CDN <br>  7) Minimize CSS / JS. <br>  8) The most important thing: A METHOD that allows including static (and usually not only CSS / JS, but also, for example, images) in the distributed modules.  Since the current method is when the module functionality itself is transferred and connected, and the static is either copied to an arbitrary place DOCUMENT_ROOT, or it is imperative that the modules be in DOCUMENT_ROOT. <br>  9) The ability to easily change URLs with statics so that it doesn‚Äôt conflict with the routing, for example, it‚Äôs not good if you want to have a section on CSS for the URL / css / when you have done this with a really existing directory with style files. <br><br>  Those.  you need to come up with and comply with further agreements. <br>  Much of what was planned was embodied in a really working module. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To show the work of the module, and not just give a link to it, I will try to set an easy task before it: <br>  1) to base <a href="http://css-framework.ru/">css-framework.ru</a> <br>  2) try to implement an example <a href="http://css-framework.ru/demo/css-framework-layout.html">css-framework.ru/demo/css-framework-layout.html</a> based on the module ‚Äúkohana-static-files‚Äù. <br><br>  Since I am interested in the largest number of those who have tried it, I will paint a way to deploy the module from scratch, may the experienced Cohanovods forgive me. <br><br>  To do this, download the latest version of Kohana v.3. <br>  We transfer the system, application, modules directories above DOCUMENT_ROOT and, accordingly, change the paths in index.php: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;?</font> php <br> $application = '../application'; <br> $modules = '../modules'; <br> $system = '../system'; <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Next, pick up the latest version from <a href="https://github.com/aberdnikov/kohana-static-files">github.com/aberdnikov/kohana-static-files</a> , copy the contents into modules. <br>  In the file application / bootstrapper.php we connect the module <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;?</font> <font color="#800000">php</font> <br> <font color="#ff0000">Kohana::modules</font> ( <font color="#ff0000">array</font> ( <br> // <font color="#0000ff">'auth'</font> = <font color="#0000ff">&gt;</font> MODPATH.'auth',    // Basic authentication <br> // 'cache'   = <font color="#0000ff">&gt;</font> MODPATH.'cache',   // Caching with multiple backends <br> // 'codebench' = <font color="#0000ff">&gt;</font> MODPATH.'codebench', // Benchmarking tool <br> // 'database'  = <font color="#0000ff">&gt;</font> MODPATH.'database',  // Database access <br> // 'image'   = <font color="#0000ff">&gt;</font> MODPATH.'image',   // Image manipulation <br> // 'orm'    = <font color="#0000ff">&gt;</font> MODPATH.'orm',    // Object Relationship Mapping <br> // 'oauth'   = <font color="#0000ff">&gt;</font> MODPATH.'oauth',   // OAuth authentication <br> // 'pagination' = <font color="#0000ff">&gt;</font> MODPATH.'pagination', // Paging of results <br> // 'unittest'  = <font color="#0000ff">&gt;</font> MODPATH.'unittest',  // Unit testing <br> // 'userguide' = <font color="#0000ff">&gt;</font> MODPATH.'userguide', // User guide and API documentation <br> ' kohana-static-files' = <font color="#0000ff">&gt;</font> MODPATH.' kohana-static-files ', // Static Files (JS/CSS/pictures) <br> )); <br> ? <font color="#0000ff">&gt;</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  In the initialization file of the module ‚Äúkohana-static-files‚Äù we prescribe the module routing, which we will find when we first access ‚Äú/!/static/style.css‚Äù according to the logic Kohana :: find_file () <br>  - first in application / static-files / style.css <br>  - then in modules / {module_name} /static-files/style.css (where {module_name} is enumeration of the connected modules in the order of connection in bootstrapper.php) <br>  - and only then in system / static-files / style.css. <br><br>  Accordingly, you noticed that next to the native directories: classes, views, config, etc ... a new kind of ‚Äústatic-files‚Äù directory appeared, this is where we will add the static.  We recall about paragraph 9 of the women at the beginning of the topic.  After all, we have no idea which static directory will be chosen by a particular owner of a specific site using the described module. <br><br>  <b>Agreement ‚Ññ1</b> <br>  Therefore, in the file ‚Äúcssf-base.css‚Äù we search for strings with URLs and make edits, replace absolute and relative URLs, or rather, start them with a substring for ‚Äú{staticfiles_url}‚Äù autochange, and from the type line <br>  .corners-2 em.tl, .corners-2 em.tr, .corners-2 em.bl, .corners-2 em.br {width: 4px;  height: 4px;  background-image: url (../ i / corners / corners-2.png);  } <br>  We have to get <br>  .corners-2 em.tl, .corners-2 em.tr, .corners-2 em.bl, .corners-2 em.br {width: 4px;  height: 4px;  background-image: url ({staticfiles_url} i / corners / corners-2.png);  } <br>  Afterwards <br>  url ({staticfiles_url} i / corners / corners-2.png); <br>  will become something like <br>  url (http://static.site.ru/!/static/i/corners/corners-2.png); <br><br>  <b>Agreement number 2</b> <br>  To avoid collisions of static file names, place them according to the following principle: <br>  1) for modules, they should be placed in a directory with the same name as the module, respectively, the final URL for the news module styles file will be: {staticfiles_url} news / style.css <br>  Accordingly, this file in the file system will be located for example here: <br>  MODDIR.'news / static-files / style.css' <br>  2) for the themes of the current site design, the static should be placed without subdirectories, for example, the main style file for the site design will have a URL <br>  {staticfiles_url} /style.css <br>  and the path to it may be: <br>  APPDIR. '  static-files / style.css' <br><br>  Moving on: <br>  We modify the base Conrtoller_Welcome controller, which we inherit from the Controller_Template, in order to be able to use Cohanov views. <br><br>  Instead of dummy <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">public function action_index() <br> { <br> $this- <font color="#0000ff">&gt;</font> request- <font color="#0000ff">&gt;</font> response = 'hello, world!'; <br> } <br> <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  We add everything that is needed to solve the problem, the code is clear without explanation: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">public function action_index() { <br> StaticCss::instance()- <font color="#0000ff">&gt;</font> addCss(Kohana::config('staticfiles.url').'news/style.css'); <br> StaticCss::instance()- <font color="#0000ff">&gt;</font> addCssStatic('news/style.css'); <br> StaticCss::instance()- <font color="#0000ff">&gt;</font> addCssStatic('css/cssf-base.css'); <br> StaticCss::instance()- <font color="#0000ff">&gt;</font> addCssStatic('css/cssf-ie6.css', 'lte IE 6'); <br> StaticCss::instance()- <font color="#0000ff">&gt;</font> addCssStatic('css/cssf-ie7.css', 'IE 7'); <br> StaticJs::instance()- <font color="#0000ff">&gt;</font> addJsStatic('js/common.js'); <br> StaticCss::instance()- <font color="#0000ff">&gt;</font> addCssInline(' <br> .lb-1 .corners { background: #818181; } <br> .lb-2 .corners { background: #9a9a9a; } <br> .lb-3 .corners { background: #b4b4b4; } <br> .lb-4 .corners { background: #dadada; } <br> '); <br> StaticJs::instance()- <font color="#0000ff">&gt;</font> addJsInline('CornersInit();'); <br> StaticJs::instance()- <font color="#0000ff">&gt;</font> addJsOnload('alert(123)'); <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  It is only necessary to clarify the difference between the methods of the form addJsStatic and addJs <br>  They are essentially the same, just the first method contains a wrapper inside itself, adding a prefix from the config to the beginning of the URL.  In the example with the style sheet for news {staticfiles_url} news / style.css <br>  You can do either: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">StaticCss::instance()- <font color="#0000ff">&gt;</font> addCss(Kohana::config('staticfiles.url').'news/style.css');</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  either more simply <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">StaticCss::instance()- <font color="#0000ff">&gt;</font> addCssStatic('news/style.css');</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  I would also like to draw attention to the assembly in parts of the script, which should be executed at the onload event.  Since jQuery is adopted by the main JS framework in the module, when calling <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">StaticJs::instance()- <font color="#0000ff">&gt;</font> addJsOnload('alert(123)');</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  the following construction will be generated: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">script</font> <font color="#ff0000">language</font> <font color="#0000ff">="JavaScript"</font> <font color="#ff0000">type</font> <font color="#0000ff">="text/javascript"</font> <font color="#0000ff">&gt;</font> <br> jQuery( <font color="#0000ff">document</font> ).ready( <br> <font color="#0000ff">function</font> (){ <br> alert(123) <br> } <br> ); <br> <font color="#0000ff">&lt;/</font> <font color="#800000">script</font> <font color="#0000ff">&gt;</font> <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Those.  you will not have to bother with creating a wrapper (‚ÄújQuery (document) .ready‚Äù), or connecting jQuery, by default the first time you call addJsOnload will connect jQuery, for this there is a special needJquery () method in the Kohana_StaticJs class.  Naturally, if you use the module on an intranet without going online, then simply redefine the needJquery () method in StaticJs by connecting the file from the disk. <br><br>  Now let's turn our attention to the module configuration in parts. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">'js' = <font color="#0000ff">&gt;</font> array( <br> //  <br> 'min' = <font color="#0000ff">&gt;</font> true, <br> //      (external, inline, onload) <br> 'build' = <font color="#0000ff">&gt;</font> false, <br> ), <br> 'css' = <font color="#0000ff">&gt;</font> array( <br> //  <br> 'min' = <font color="#0000ff">&gt;</font> true, <br> //      (external, inline) <br> 'build' = <font color="#0000ff">&gt;</font> true, <br> ), <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  At this point you have the ability to manage the need for smart assembly into one file by content type (JS / CSS), type (external, inline, onload), conditions ( <pre>  &lt;! - [if IE 7]&gt; </pre>  ), <br>  minimization (removal of comments, extra spaces and line breaks). <br><br>  <b>Agreement number 3</b> <br>  If there is a substring ‚Äú.min.‚Äù In the url before the file to be connected, it is considered to be already compressed, even if the compression option is enabled, this file will be ignored, and if the build option is turned on, build.  That will be added accordingly in the ‚Äúas is‚Äù build. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">'path' = <font color="#0000ff">&gt;</font> realpath(DOCROOT),</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  This is the DOCUMENT_ROOT directory for the static domain, by default it is the same domain. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">//            <br> 'url' = <font color="#0000ff">&gt;</font> '/!/static/', <br> //        <br> 'cache' = <font color="#0000ff">&gt;</font> '/!/cache/', <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Here I would like to comment on the presence of an exclamation mark: this is exactly the case in point 9 of the "hotelok" about conflicts and the fight against them. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">'host' = <font color="#0000ff">&gt;</font> 'http://'.$_SERVER['HTTP_HOST'],</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  This is actually the domain from which the static will be distributed, the use cases: <br>  1) "" - the links will look like: "/pic.jpg" <br>  2) ‚Äú <a href="http://ya.ru/">ya.ru</a> ‚Äù - the links will look like: ‚Äú <a href="">ya.ru/pic.jpg</a> ‚Äù <br>  * To use Coral CDN <br>  * add suffix ".nyud.net" in the current domain name with static <br>  * for example, for the google.com domain, set google.com.nyud.net <br>  * More information here: <a href="http://habrahabr.ru/blogs/i_recommend/82739/">habrahabr.ru/blogs/i_recommend/82739</a> 3) ‚Äú <a href="http://ya.ru.nyud.net/">ya.ru.nyud.net</a> ‚Äù - the links will look like: ‚Äú <a href="">ya.ru.nyud.net/pic.jpg</a> ‚Äù <br><br>  To be able to use AutoCorrect in the already generated response, we slightly change the after method of the controller: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">public function after() { <br> parent::after(); <br> $this- <font color="#0000ff">&gt;</font> request- <font color="#0000ff">&gt;</font> response = str_replace('{statifiles_url}', <br> STATICFILES_URL, <br> $this- <font color="#0000ff">&gt;</font> request- <font color="#0000ff">&gt;</font> response); <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  And finally, it remains to tell about the view device (View) <br>  According to the recommendations of YSlow / GooglePageSpeed ‚Äã‚Äãin the head section we insert CSS <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;!</font> <font color="#800000">DOCTYPE</font> <font color="#ff0000">html</font> <font color="#ff0000">PUBLIC</font> <font color="#0000ff">"-//W3C//DTD XHTML 1.0 Transitional//EN"</font> <font color="#0000ff">"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">html</font> <font color="#ff0000">xmlns</font> <font color="#0000ff">="http://www.w3.org/1999/xhtml"</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">head</font> <font color="#ff0000">profile</font> <font color="#0000ff">="http://gmpg.org/xfn/11"</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> css-framework / layout-box <font color="#0000ff">&lt;/</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">meta</font> <font color="#ff0000">http-equiv</font> <font color="#0000ff">="Content-Type"</font> <font color="#ff0000">content</font> <font color="#0000ff">="text/html; charset=UTF-8"</font> <font color="#0000ff">/&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">meta</font> <font color="#ff0000">http-equiv</font> <font color="#0000ff">="imagetoolbar"</font> <font color="#ff0000">content</font> <font color="#0000ff">="no"</font> <font color="#0000ff">/&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">link</font> <font color="#ff0000">rel</font> <font color="#0000ff">="icon"</font> <font color="#ff0000">href</font> <font color="#0000ff">="{statifiles_url}favicon.ico"</font> <font color="#ff0000">type</font> <font color="#0000ff">="image/x-icon"</font> <font color="#0000ff">/&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">link</font> <font color="#ff0000">rel</font> <font color="#0000ff">="shortcut icon"</font> <font color="#ff0000">href</font> <font color="#0000ff">="{statifiles_url}favicon.ico"</font> <font color="#ff0000">type</font> <font color="#0000ff">="image/x-icon"</font> <font color="#0000ff">/&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;?</font> <font color="#800000">php</font> <font color="#ff0000">echo</font> <font color="#ff0000">StaticCss::instance</font> () <font color="#ff0000">-</font> <font color="#0000ff">&gt;</font> getCssAll(); ? <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">head</font> <font color="#0000ff">&gt;</font> &lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  and before closing we call JS inserts <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;?</font> <font color="#800000">php</font> <font color="#ff0000">echo</font> <font color="#ff0000">StaticJs::instance</font> () <font color="#ff0000">-</font> <font color="#0000ff">&gt;</font> getJsAll(); ? <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font></font> &lt;br&gt;&lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  With the tasks, in my opinion, the module managed: <br>  - reduced the number of HTTP requests; <br>  - CDN is optionally connected; <br>  - CSS is inserted at the top of the page; <br>  - JS is inserted at the end of the page; <br>  - ONLY the necessary files are connected (one by one or build) (there is also a small drawback - separate builds will be created for all use cases); <br>  - inline styles and scripts can be rendered in include files; <br>  - duplicate script and style connections are excluded. <br><br>  Now we just have to call on nginx for help, so that he puts the correct headers for the statics returned (gzip, ETags, Expires). <br><br>  Let me remind you once again that the module itself can be picked up / forked here: <br>  <a href="https://github.com/aberdnikov/kohana-static-files">github.com/aberdnikov/kohana-static-files</a> <br><br>  Just in case, I‚Äôll show you what happened as a result of the module‚Äôs operation (I manually added line breaks to display HTML without horizontal scrolling) <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;!</font> <font color="#800000">DOCTYPE</font> <font color="#ff0000">html</font> <font color="#ff0000">PUBLIC</font> <font color="#0000ff">"-//W3C//DTD XHTML 1.0 Transitional//EN"</font> <font color="#0000ff">"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">html</font> <font color="#ff0000">xmlns</font> <font color="#0000ff">="http://www.w3.org/1999/xhtml"</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">head</font> <font color="#ff0000">profile</font> <font color="#0000ff">="http://gmpg.org/xfn/11"</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> css-framework / layout-box <font color="#0000ff">&lt;/</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">meta</font> <font color="#ff0000">http-equiv</font> <font color="#0000ff">="Content-Type"</font> <font color="#ff0000">content</font> <font color="#0000ff">="text/html; charset=UTF-8"</font> <font color="#0000ff">/&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">meta</font> <font color="#ff0000">http-equiv</font> <font color="#0000ff">="imagetoolbar"</font> <font color="#ff0000">content</font> <font color="#0000ff">="no"</font> <font color="#0000ff">/&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">link</font> <font color="#ff0000">rel</font> <font color="#0000ff">="icon"</font> <font color="#ff0000">href</font> <font color="#0000ff">="http://static.site.ru/!/static/favicon.ico"</font> <font color="#ff0000">type</font> <font color="#0000ff">="image/x-icon"</font> <font color="#0000ff">/&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">link</font> <font color="#ff0000">rel</font> <font color="#0000ff">="shortcut icon"</font> &lt;br&gt; <font color="#ff0000">href</font> <font color="#0000ff">="http://static.site.ru/!/static/favicon.ico"</font> &lt;br&gt; <font color="#ff0000">type</font> <font color="#0000ff">="image/x-icon"</font> <font color="#0000ff">/&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">link</font> <font color="#ff0000">rel</font> <font color="#0000ff">="stylesheet"</font> &lt;br&gt; <font color="#ff0000">href</font> <font color="#0000ff">="http://static.site.ru/!/cache/css/3/7/3741c0ac0c2f8409beea116d6f4d6922.css"</font> &lt;br&gt; <font color="#ff0000">media</font> <font color="#0000ff">="all"</font> <font color="#ff0000">type</font> <font color="#0000ff">="text/css"</font> <font color="#0000ff">/&gt;</font> &lt;br&gt; <font>&lt;!--[lte IE 6]&gt;&lt;link rel="stylesheet"</font> &lt;br&gt; <font>href="http://static.site.ru/!/cache/css/lte-ie-6/1/6/161456642f5cfc18e731472d29293b28.css"</font> &lt;br&gt; <font>media="all" type="text/css" /&gt;&lt;![endif]--&gt;</font> &lt;br&gt; <font>&lt;!--[IE 7]&gt;&lt;link rel="stylesheet"</font> &lt;br&gt; <font>href="http://static.site.ru/!/cache/css/ie-7/c/b/cb4a089038b23dd1bfc5d0dfbfd35a68.css"</font> &lt;br&gt; <font>media="all" type="text/css" /&gt;&lt;![endif]--&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">link</font> <font color="#ff0000">rel</font> <font color="#0000ff">="stylesheet"</font> &lt;br&gt; <font color="#ff0000">href</font> <font color="#0000ff">="http://static.site.ru/!/cache/css/inline/e/c/ec905aaa7ee63d90a646593b7e665936.css"</font> &lt;br&gt; <font color="#ff0000">media</font> <font color="#0000ff">="all"</font> <font color="#ff0000">type</font> <font color="#0000ff">="text/css"</font> <font color="#0000ff">/&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">head</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> &lt;br&gt;        ... [skip html code] ...&lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">script</font> <font color="#ff0000">language</font> <font color="#0000ff">="JavaScript"</font> &lt;br&gt; <font color="#ff0000">type</font> <font color="#0000ff">="text/javascript"</font> &lt;br&gt; <font color="#ff0000">src</font> <font color="#0000ff">="http://static.site.ru/!/cache/js/8/e/8e022d3b6bcba59dcba5c586d408f7b2.js"</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">script</font> <font color="#0000ff">&gt;</font> &lt;br&gt;        &lt;script language= <font color="#A31515">"JavaScript"</font> &lt;br&gt;                type= <font color="#A31515">"text/javascript"</font> &lt;br&gt;                src= <font color="#A31515">"http://static.site.ru/!/cache/js/inline/b/2/b2044b150de0ef43233d3491d060a5f6.js"</font> &gt;&lt;/script&gt;&lt;br&gt;        &lt;script language= <font color="#A31515">"JavaScript"</font> &lt;br&gt;                type= <font color="#A31515">"text/javascript"</font> &lt;br&gt;                src= <font color="#A31515">"http://static.site.ru/!/cache/js/onload/1/5/15fb097828dd52d44bf36e77a96144b6.js"</font> &gt; <font color="#0000ff">&lt;/</font> <font color="#800000">script</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font> &lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  PS: the main difference from the idea from the userguide module for the distribution of statics is that complex builds are generated upon the first request immediately BEFORE being called from the page code by a separate request, and simple statics are copied to the directory accessible via HTTP on the first request, and then it is given by the web server, and not via PHP. <br>  Those.  deploy is performed at the first request. <br>  Among the shortcomings, I see only the impossibility of automatically detecting changes to the file from which the build was created, since the name of the build is obtained from the names of the included files (otherwise it will greatly affect the speed of the module), it is only in the case of inline styles / scripts that the build name is obtained based on the content. <br><br>  <b>Therefore, when updating, just kill the /! / Directory with builds and caches.</b> <br><br>  There are plans to add methods for automatically deploying statics (one that does not require assembly) + advice to warm up the cache before a large load, driving through the site, for example, siege, which will create most of the necessary caches. </div><p>Source: <a href="https://habr.com/ru/post/112852/">https://habr.com/ru/post/112852/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../112847/index.html">Revolutionary Facebook with integrated browser</a></li>
<li><a href="../112848/index.html">Will every line of Linux code and every edit in Wikipedia need to be registered with Rospatent?</a></li>
<li><a href="../112849/index.html">Turn iPod Touch into iPhone</a></li>
<li><a href="../112850/index.html">Installing and configuring Linux Ubuntu 10.04 LTS under Hyper-V in Windows Server 2008 R2</a></li>
<li><a href="../112851/index.html">Tests for tests</a></li>
<li><a href="../112853/index.html">Mail.ru plans to integrate ICQ and Mail.ru Agent, as well as My World and Odnoklassniki</a></li>
<li><a href="../112854/index.html">Our workflow</a></li>
<li><a href="../112855/index.html">Web - P2P - Web</a></li>
<li><a href="../112856/index.html">Bada Web-based application: C ++ and Javascript interactions</a></li>
<li><a href="../112860/index.html">Anonymous networks and timing attacks: Introduction</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>