<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Backbone.js for dummies</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometime in the late evening I had the idea to study Backbone.js and bind it to the service already written on jQuery. The service has already serious...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Backbone.js for dummies</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/85c47c24/a602bfb6/574d07b2/eb3c1cea.png" alt="Backbone.js for dummies" align="left"><br>  Sometime in the late evening I had the idea to study Backbone.js and bind it to the service already written on jQuery.  The service has already seriously expanded, and this piling up of click handlers, queries and logic handlers has sufficed me.  Therefore, I, as a diligent student, climbed into the official documentation.  But either I'm stupid, or my English let me down, or both of them together, but I didn't understand a damn thing.  I read it a second time, carefully, and used google translate for especially talented places.  I also read the ToDo List example.  Everything seemed clear, exactly until I started writing.  After that, I took everything I found on this library, both in English and <a href="http://habrahabr.ru/blogs/javascript/118782/">translations</a> .  After reading a pile of documentation, I decided that now I thought I understood everything.  I tensed, but ... A stone flower did not come out from master Danila, i.e.  it turned out, but it was clearly not a flower, and the stone somehow smelled wrong.  Then, as a diligent student, I decided to write ‚ÄúHello, <s>Kitty</s> World‚Äù from scratch.  Along the way, commenting and saving the steps in hg, I got an introduction to the backbone.js framework for people like me, especially gifted. <br><a name="habracut"></a><br><h4>  Task. </h4><br>  Choose a simple task.  Write Hello, World?  Too easy, as well as writing Hello, &lt;name&gt;.  Can we write a GTD client with authorization and offline storage?  This is already there and it does not help to understand our ‚Äúspinal bone‚Äù.  Let's make it easier.  Create a page with 3 states.  In the first state, the person enters the user name, in the second state he is congratulated if the entered name is found, in the third state they are upset if the name is not found.  In my opinion, this task is easier and easier to learn, and in general it will allow you to look and check almost everything in the backbone. <br><br>  We will save all steps through <a href="http://mercurial.selenic.com/">mercurial</a> .  Therefore, reading any step, you can unpack the <a href="http://narod.ru/disk/22868808001/backbone%2520%25D0%25B4%25D0%25BB%25D1%258F%2520%25D1%2587%25D0%25B0%25D0%25B9%25D0%25BD%25D0%25B8%25D0%25BA%25D0%25BE%25D0%25B2.zip.html">zip archive</a> (+ <a href="">dropbox</a> , if you <a href="">delete</a> it on people), go to the directory and go to the desired revision using the command <br><pre><code class="bash hljs">hg update --rev &lt; &gt;</code> </pre> <br>  Then look at the code and understand what you do not understand :) <br><br><h4>  Step 0. Structure and pattern (rev 0) </h4><br><img src="https://habrastorage.org/storage1/6245f468/ddd316cc/33f58597/209ec559.png" alt="structure" align="left"><br>  We will use an academic structure, such as in the picture.  I confess, I do not know who the author of this sacred bullet, from whom I licked this cow, but I use in all the blanks.  Single index.html file.  There are styles in the css folder, pictures in the i folder, scripts in js.  At the same time, let's throw in jquery, underscore and backbone scripts. <br>  The html template is a blank page.  Those.  A page with an empty body and connected scripts and style. <br>  Those.  As you can see, unlike some modern javascript mvc framework, the project does not require special preparation, so an existing project can be ‚Äúrewritten‚Äù to the backbone. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Step 1. Initial layout (rev 1) </h4><br><br>  Our page, in accordance with the task, should have 3 states: the input of the user name, the state when successful comparison, the state when the comparison failed.  To begin with we make 3 divas, each state in its place. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"start"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"block"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"userplace"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"username"</span></span></span><span class="hljs-tag">&gt;</span></span> : <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"username"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"buttonplace"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"error"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"block"</span></span></span><span class="hljs-tag">&gt;</span></span>     . <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"success"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"block"</span></span></span><span class="hljs-tag">&gt;</span></span>  . <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  We will hide the #error and #success blocks from our eyes away with CSS. <br><br><pre> <code class="css hljs"><span class="hljs-selector-id"><span class="hljs-selector-id">#error</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#success</span></span> { ... <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: none; }</code> </pre><br><br>  In this step, we have fully prepared everything for the introduction of the backbone.  These steps are identical for many single-page site implementations. <br><br><h4>  Step 2. Implement Router (rev 2) </h4><br><br>  Before 0.5.0, this class was called Controller.  Its purpose is to handle hash navigation in the application.  Those.  It has never been fully understood by the controller, just the hash navigation is the application controller.  It can be seen the logic of the developers took over and now we have the class Router. <br>  What is location.hash for what it is used, and how to use it correctly, you can read at Habr√© ( <a href="http://habrahabr.ru/blogs/javascript/123106/">here</a> , <a href="http://habrahabr.ru/blogs/AJAX/114911/">here</a> or <a href="http://habrahabr.ru/search/%3Fq%3Dlocation.hash%26target_type%3Dposts">here</a> ). <br><br>  First, let's create an impromptu menu at index.html <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"menu"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#!/"</span></span></span><span class="hljs-tag">&gt;</span></span>Start<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#!/success"</span></span></span><span class="hljs-tag">&gt;</span></span>Success<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#!/error"</span></span></span><span class="hljs-tag">&gt;</span></span>Error<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  And then with a flick of the wrist we add the work of routing to the example: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Controller = Backbone.Router.extend({ <span class="hljs-attr"><span class="hljs-attr">routes</span></span>: { <span class="hljs-string"><span class="hljs-string">""</span></span>: <span class="hljs-string"><span class="hljs-string">"start"</span></span>, <span class="hljs-comment"><span class="hljs-comment">//  hash- "!/": "start", //   "!/success": "success", //   "!/error": "error" //   }, start: function () { $(".block").hide(); //    $("#start").show(); //   }, success: function () { $(".block").hide(); $("#success").show(); }, error: function () { $(".block").hide(); $("#error").show(); } }); var controller = new Controller(); //   Backbone.history.start(); //  HTML5 History push</span></span></code> </pre><br><br>  With such simple code we created a simplest tab-oriented site with the ability to bookmark pages. <br><br><h4>  Step 3. The simplest View (rev 3) </h4><br>  View in backbone is a mix of controller and View from a standard MVC model.  It‚Äôs easier to say, View here is widget / component on a page that can display itself, react to events and create events.  We'll fill up with what the creators will think about and rename View to Widget (or component), as they previously did with Router. <br>  We have a generated username verification widget, this is the start block.  Let's make it so that if the name ‚Äútest‚Äù is entered, then we move on to the hash tag #! / Success, which will show the success block.  And if something else is entered, then go to the hash tag #! / Error, which will show, respectively, the error block.  By the way, we'll remove the menu in one go, we won't need it anymore. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Start = Backbone.View.extend({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">"#start"</span></span>), <span class="hljs-comment"><span class="hljs-comment">// DOM  widget' events: { "click input:button": "check" //     "" }, check: function () { if (this.el.find("input:text").val() == "test") //   controller.navigate("success", true); //    success else controller.navigate("error", true); //    error } }); var start = new Start();</span></span></code> </pre><br><br>  By the way, did you notice that after you went to the result page, you can safely go back by pressing the Backspace button?  This is the magic of hash navigation. <br><br><h4>  Remark.  JQuery way (rev 4) </h4><br>  Have you noticed how much code we have already written?  I think so, many of those who have read it before <s>will get cognac</s> exclaimed: ‚ÄúOn jQuery this is done faster and easier.‚Äù  I do not argue.  The code that should be written on the initial layout is very simple: <br><pre> <code class="javascript hljs"> $(<span class="hljs-string"><span class="hljs-string">"#start input:button"</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    var username = $("#username").val(); //     $("#start").hide(); //    if (username == "test") $("#success").show(); //   else $("#error").show(); //   });</span></span></code> </pre><br>  But ... This code does not support hash navigation, poorly expands and is very poorly supported. <br>  It's no secret that the programmer in his work is creating new applications only 20% of the time.  80% of his time, he will dock the modules, fix errors and expand the functionality of already created projects.  And jQuery noodle support can be very expensive.  The obvious way to avoid hemorrhoids on the fingers is to do a decomposition of projects, for which most bicycles are invented.  Backbone is a finished bike.  Why invent something new when a good uncle did it for you? <br><br><h4>  Step 4. Working with View via Template (rev 5) </h4><br>  View would not be a View, but a controller if it did not know how to display itself.  The backbone has no mechanism for this.  Funny  Not at all ... Its purpose is not to give a tool for creating an application, but to give a template, using which one could create the most supported system.  Therefore, in the backbone, you can use different template engines.  For example, the John Resig engine embedded in underscore.js.  Or connect Microsoft Template.  And if it‚Äôs smartly to dodge, you can implement everything through Knockout.js (although its dump of logic and templates strains me) <br>  We will not strain and just use the _.template from underscore.js to implement our ideas.  To do this, create one empty block on the page, and put all the ‚Äúfillers‚Äù into templates.  The page styles will change accordingly. <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"block"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"block"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--     --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/template"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"start"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> &lt;div </span><span class="hljs-class"><span class="hljs-keyword"><span class="javascript"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span></span><span class="javascript">=</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"start"</span></span></span><span class="javascript">&gt; </span><span class="xml"><span class="hljs-tag"><span class="javascript"><span class="xml"><span class="hljs-tag">&lt;</span></span></span><span class="hljs-name"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag"> </span></span></span><span class="hljs-attr"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag">=</span></span></span><span class="hljs-string"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"userplace"</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="javascript"><span class="xml"> </span></span><span class="hljs-tag"><span class="javascript"><span class="xml"><span class="hljs-tag">&lt;</span></span></span><span class="hljs-name"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-name">label</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag"> </span></span></span><span class="hljs-attr"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag">=</span></span></span><span class="hljs-string"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"username"</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="javascript"><span class="xml"> : </span></span><span class="hljs-tag"><span class="javascript"><span class="xml"><span class="hljs-tag">&lt;/</span></span></span><span class="hljs-name"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-name">label</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="javascript"><span class="xml"> </span></span><span class="hljs-tag"><span class="javascript"><span class="xml"><span class="hljs-tag">&lt;</span></span></span><span class="hljs-name"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag"> </span></span></span><span class="hljs-attr"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag">=</span></span></span><span class="hljs-string"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag"> </span></span></span><span class="hljs-attr"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag">=</span></span></span><span class="hljs-string"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"username"</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span></span><span class="javascript"><span class="xml"> </span></span><span class="hljs-tag"><span class="javascript"><span class="xml"><span class="hljs-tag">&lt;/</span></span></span><span class="hljs-name"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="javascript"><span class="xml"> </span></span><span class="hljs-tag"><span class="javascript"><span class="xml"><span class="hljs-tag">&lt;</span></span></span><span class="hljs-name"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag"> </span></span></span><span class="hljs-attr"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag">=</span></span></span><span class="hljs-string"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"buttonplace"</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="javascript"><span class="xml"> </span></span><span class="hljs-tag"><span class="javascript"><span class="xml"><span class="hljs-tag">&lt;</span></span></span><span class="hljs-name"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag"> </span></span></span><span class="hljs-attr"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag">=</span></span></span><span class="hljs-string"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag"> </span></span></span><span class="hljs-attr"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag">=</span></span></span><span class="hljs-string"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-string">""</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span></span><span class="javascript"><span class="xml"> </span></span><span class="hljs-tag"><span class="javascript"><span class="xml"><span class="hljs-tag">&lt;/</span></span></span><span class="hljs-name"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="javascript"><span class="xml"> </span></span><span class="hljs-tag"><span class="javascript"><span class="xml"><span class="hljs-tag">&lt;/</span></span></span><span class="hljs-name"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="javascript"><span class="xml"> </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/template"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"error"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"error"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> .  </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">username</span></span></span></span><span class="xml"><span class="hljs-tag"> %&gt;</span></span></span><span class="xml">  . </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"#!/"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Go back</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/template"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"success"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"success"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">  </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">username</span></span></span></span><span class="xml"><span class="hljs-tag"> %&gt;</span></span></span><span class="xml"> . </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"#!/"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Go back</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  In order to show the dynamics, we added the username to the result templates. <br>  Store the user name and pass it to the template, we will be in the variable AppState <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> AppState = { <span class="hljs-attr"><span class="hljs-attr">username</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre><br><br>  Write a View for each template. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Views = { }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Start = Backbone.View.extend({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">"#block"</span></span>), <span class="hljs-comment"><span class="hljs-comment">// DOM  widget' template: _.template($('#start').html()), events: { "click input:button": "check" //     "" }, check: function () { AppState.username = this.el.find("input:text").val(); //    if (AppState.username == "test") //    controller.navigate("success", true); //    success else controller.navigate("error", true); //    error }, render: function () { $(this.el).html(this.template()); } }); var Success = Backbone.View.extend({ el: $("#block"), // DOM  widget' template: _.template($('#success').html()), render: function () { $(this.el).html(this.template(AppState)); } }); var Error = Backbone.View.extend({ el: $("#block"), // DOM  widget' template: _.template($('#error').html()), render: function () { $(this.el).html(this.template(AppState)); } }); Views = { start: new Start(), success: new Success(), error: new Error() };</span></span></code> </pre><br>  <i><b>Comment.</b></i>  <i>We have 3 views referenced to the same DOM element.</i>  <i>In reality, this should not be.</i>  <i>Logically, this should be a single widget.</i>  <i>I deliberately incorrectly designed this step in order to show the possibility of working with several View.</i>  <i>Later I will show how to avoid this puncture.</i> <br><br>  The controller will also undergo minor changes. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Controller = Backbone.Router.extend({ <span class="hljs-attr"><span class="hljs-attr">routes</span></span>: { <span class="hljs-string"><span class="hljs-string">""</span></span>: <span class="hljs-string"><span class="hljs-string">"start"</span></span>, <span class="hljs-comment"><span class="hljs-comment">//  hash- "!/": "start", //   "!/success": "success", //   "!/error": "error" //   }, start: function () { if (Views.start != null) { Views.start.render(); } }, success: function () { if (Views.success != null) { Views.success.render(); } }, error: function () { if (Views.error != null) { Views.error.render(); } } });</span></span></code> </pre> <br>  This is how we added dynamics to our application. <br><br><h4>  Step 5. Check for multiple users (rev 6) </h4><br>  The easiest way to check not only for test, but also for other users, is to check for finding the name in the array of users. <br>  Create an array of Family, in which we fill in all the names. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Family = [<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//  </span></span></code> </pre><br>  And we will do the check in the Start view code.  Because  underscore is already included in the application, let's do it through _.detect <br><pre> <code class="javascript hljs">... if (_.detect(Family, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">elem</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> elem == AppState.username })) <span class="hljs-comment"><span class="hljs-comment">//    ...</span></span></code> </pre><br>  What problems does this solution have?  The main problem is that if tomorrow we need to change the physical location of the array of users (server, localstore, etc.), then we will have to change the logic of View.  Those.  View is so tied to the data access method that you have to change its code at the slightest sneeze. <br><br><h4>  Remark 2. jQuery way.  Continued (rev 7) </h4><br>  But how much code did we have to add to jQuery code to support multiple users?  Very little: <br><pre> <code class="javascript hljs">$(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Family = [<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>]; $(<span class="hljs-string"><span class="hljs-string">"#start input:button"</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    var username = $("#username").val(); //     $("span.username").text(username); $("#start").hide(); //    $("#" + ($.inArray(username, Family) != -1 ? "success" : "error")).show(); }); $("#error a, #success a").click(function () { $(".block").hide(); $("#start").show(); }); });</span></span></code> </pre><br>  Well and accordingly to correct layout layout: <br><pre> <code class="html hljs xml"> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"error"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"block"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   --&gt;</span></span> .  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"username"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span>  . <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript:void(0);"</span></span></span><span class="hljs-tag">&gt;</span></span>Go back<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"success"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"block"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   --&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"username"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> . <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript:void(0);"</span></span></span><span class="hljs-tag">&gt;</span></span>Go back<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ...</code> </pre><br>  Remember I said something about support, 80/20% and other dregs?  So here.  Forget it.  There is nothing shameful for this application to write jQuery way code.  You will spend time 10-20 times less than writing it all through Backbone.  And the size of the code allows you to maintain this application at least after half a liter.  There is nothing shameful to write in this way and earn your $ 5.  Who does not agree, let his opinion stick in the comment. <br>  I like to repeat the phrase that all the frameworks serve 2 goals, to make a billion project, a project for a million, and a project for $ 100 - a project for a couple of millions.  Use the fact that saves you time and money more effectively. <br><br><h4>  Step 6. Application controller via Model (rev 8) </h4><br>  Backbone's great feature is the ability to link a model and a view.  If you create a view with the model parameter, then in the initialize method of the view you can subscribe to the occurrence of a model change event.  After that, View will receive messages with each change of the model or its part.  And already on this message to attach a certain behavior of the provision, for example, its full or partial redrawing. <br>  Remember I said that it is ugly when the same block is processed by several View.  Let's try to get rid of this dominance handlers. <br>  To begin with, from the AppState object, create a model that will contain the user name and application state: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> AppState = Backbone.Model.extend({ <span class="hljs-attr"><span class="hljs-attr">defaults</span></span>: { <span class="hljs-attr"><span class="hljs-attr">username</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">state</span></span>: <span class="hljs-string"><span class="hljs-string">"start"</span></span> } }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> appState = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AppState();</code> </pre><br>  The second step is to remove the Success and Error views, and rename the view Start to Block, since  it will handle several states, not just the start state.  In the remaining view, rename the template field to templates in which all templates for different states will be stored. <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Block = Backbone.View.extend({ <span class="hljs-attr"><span class="hljs-attr">templates</span></span>: { <span class="hljs-comment"><span class="hljs-comment">//     "start": _.template($('#start').html()), "success": _.template($('#success').html()), "error": _.template($('#error').html()) },</span></span></code> </pre><br>  In the view initializer, we subscribe to the model change event.  On this event, hang the block redraw. <br><pre> <code class="javascript hljs"> initialize: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     this.model.bind('change', this.render, this); },</span></span></code> </pre><br>  The redraw function (render) will ‚Äúdraw‚Äù our main model with an appropriate template, depending on the state field of the model: <br><pre> <code class="javascript hljs"> render: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.model.get(<span class="hljs-string"><span class="hljs-string">"state"</span></span>); $(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el).html(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.templates[state](<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.model.toJSON())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }</code> </pre><br>  The check function will also change.  It will set the appropriate model fields: <br><pre> <code class="javascript hljs"> check: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> username = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.find(<span class="hljs-string"><span class="hljs-string">"input:text"</span></span>).val(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> find = (_.detect(Family, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">elem</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> elem == username })); <span class="hljs-comment"><span class="hljs-comment">//    appState.set({ //      "state": find ? "success" : "error", "username": username }); },</span></span></code> </pre><br>  By the way, after all these cases, we will not see anything, because  The model was created before we described the View.  Therefore, we will fire the change event after we create the View: <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> block = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Block({ <span class="hljs-attr"><span class="hljs-attr">model</span></span>: appState }); appState.trigger(<span class="hljs-string"><span class="hljs-string">"change"</span></span>);</code> </pre><br><br>  If we didn‚Äôt have a navigation hash, I‚Äôd finish this step.  But we flew navigation.  Restore it.  To do this, we will rewrite the router code. <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Controller = Backbone.Router.extend({ <span class="hljs-attr"><span class="hljs-attr">routes</span></span>: { <span class="hljs-string"><span class="hljs-string">""</span></span>: <span class="hljs-string"><span class="hljs-string">"start"</span></span>, <span class="hljs-comment"><span class="hljs-comment">//  hash- "!/": "start", //   "!/success": "success", //   "!/error": "error" //   }, start: function () { appState.set({ state: "start" }); }, success: function () { appState.set({ state: "success" }); }, error: function () { appState.set({ state: "error" }); } });</span></span></code> </pre><br>  Manual navigation is working, but when you click on the Check button, the page hash of the address does not change.  Fix this annoying flaw by subscribing to the event of changing the state field of the model: <br><pre> <code class="javascript hljs"> appState.bind(<span class="hljs-string"><span class="hljs-string">"change:state"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       var state = this.get("state"); if (state == "start") controller.navigate("!/", false); // false ,     //    Router else controller.navigate("!/" + state, false); });</span></span></code> </pre><br>  Events is a separate song in the backbone.  The simplest events, DOM events, and model or collection change events can be intertwined with the events described by the user, forming a wonderful vintage of object-oriented and event-oriented programming.  I advise you to study them before you start using Backbone.js in your project. <br><br>  That's all with the biggest refactoring in this small project.  And for the future, start designing the system with models, and not with View as I did, and your hair will, just will. <br><br><h4>  Step 7. Check for multiple users through the collection (rev 9) </h4><br>  What we implemented in step 5 has its drawback.  We have mixed the display logic with the data management logic.  We can not just now, without rearranging the logic of the View, to replace our array with the appeal to the service.  For these purposes, collections are used in Backbone. <br>  The collection in this framework is a sorted set of models that can handle, filter, or sort these models.  Also collections are able out of the box to work with services on the REST interface.  In fact, this is a layer between the widget and the database access methods. <br>  Let's return from reasoning to our problem.  Create a UserNameModel model.  The only required field of this model will be the Name field, which by default has an empty value. <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> UserNameModel = Backbone.Model.extend({ <span class="hljs-comment"><span class="hljs-comment">//   defaults: { "Name": "" } });</span></span></code> </pre><br>  Create a Family collection of UserNameModel models <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Family = Backbone.Collection.extend({ <span class="hljs-comment"><span class="hljs-comment">//   model: UserNameModel, });</span></span></code> </pre><br>  Add to the collection a method for checking if a user has the specified name in this collection. <br><pre> <code class="javascript hljs"> checkUser: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">username</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   var findResult = this.find(function (user) { return user.get("Name") == username }) return findResult != null; }</span></span></code> </pre><br>  Create an instance of the Family collection. <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> MyFamily = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Family([ <span class="hljs-comment"><span class="hljs-comment">//   { Name: "" }, { Name: "" }, { Name: "" } ]);</span></span></code> </pre><br>  After that, the user check in View is reduced to calling the check method in the MyFamily instance <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> find = MyFamily.checkUser(username); <span class="hljs-comment"><span class="hljs-comment">//   </span></span></code> </pre><br><br><h4>  Conclusion </h4><br>  In the course of the article, we created an educational project that does not do a fig, but which does not fully cover my framework of this framework.  The resulting file contains approximately 200 lines of code.  This is more than the jQuery version, but these are good, easily extensible strings.  Objects know about each other the necessary minimum and not more than that. <br>  Backbone surprisingly turned out to be a good product that allows you to build a ridge for your service.  It provides a platform for creating one-page services and various large dynamic applications.  As already shown in the notes, it is sometimes unprofitable to use it sometimes, on small projects.  But as soon as we grow, and the complexity of supporting our application grows exponentially, using the backbone can significantly reduce the labor costs for support, leaving time for the development of new functionality. </div><p>Source: <a href="https://habr.com/ru/post/127049/">https://habr.com/ru/post/127049/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../127041/index.html">Second Moscow JavaScript Meetup</a></li>
<li><a href="../127043/index.html">ETC Conference Results: Our Acquisitions, Developer Competition Winners, and Twitter Trend</a></li>
<li><a href="../127045/index.html">Icon Ambulance - First Iconic Assistance</a></li>
<li><a href="../127047/index.html">Getting Started with Netbeans and Wicket</a></li>
<li><a href="../127048/index.html">Apps4Bitrix Contest - HTC Desire S for Apps!</a></li>
<li><a href="../127050/index.html">Microsoft plans to block sales of some Motorola Android phones</a></li>
<li><a href="../127052/index.html">How to make yii-user and rights extensions work together?</a></li>
<li><a href="../127053/index.html">The most interesting advertising letters</a></li>
<li><a href="../127055/index.html">We look into the clouds</a></li>
<li><a href="../127056/index.html">20 years of Linux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>