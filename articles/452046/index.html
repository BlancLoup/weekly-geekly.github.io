<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Remote control with low quiescent current on the ATmega328P</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="By KDPV can be seen that the author is not indifferent to the vintage audio equipment Sony. Here and MD Walkman, and the recent acquisition - small-si...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Remote control with low quiescent current on the ATmega328P</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/zb/b9/cu/zbb9cu0hagsbdt-mrasezcad7ok.jpeg"></div><br>  By KDPV can be seen that the author is not indifferent to the vintage audio equipment Sony.  Here and MD Walkman, and the recent acquisition - small-sized music center with a vertical CD- "transport".  It was sold without a remote control, to the self-made analogue of which the author presented a demand: the same small quiescent current as that of ready-made remote controls on specialized microcircuits. <a name="habracut"></a><br><br>  At first, the author wanted to write the firmware from scratch, because earlier he had already implemented the software protocol used in Sony remote controls.  But then I decided to use the <a href="https://github.com/z3t0/Arduino-IRremote">existing library</a> .  It supports various protocols, devices, and also has additional.  features that facilitate development and debugging. <br><br>  With this library, it is enough to connect the IR diode to the leg of the microcontroller and start searching for Sony remote control codes.  Making homemade remote earn very quickly.  But what's the point if the battery in it is discharged in one or two days, even if you don‚Äôt use it at all? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In general, the task was to put the ATmega328P into sleep mode so that it practically did not consume current until some key was pressed.  Libraries for managing the sleep mode also exist, but the author decided that since he took a ready-made library for transmitting commands, then at least this part of the firmware will be written independently.  According to the datasheet, putting the microcontroller into sleep mode turned out to be a multistage process. <br><br>  Therefore, in the sketch, everything is commented on in sufficient detail so that by reading the code and datasheet at the same time, you can understand what happens during the execution of each line.  The microcontroller ‚Äúsleeps‚Äù almost all the time, and when one of the inputs changes, it ‚Äúwakes up‚Äù, determines which button is pressed, transmits a command, and ‚Äúfalls asleep‚Äù again. <br><br>  With a 16 MHz quartz microcontroller, when it is not ‚Äúsleeping‚Äù, will consume more current than when operating from an internal 8 MHz clock generator.  To reconfigure the corresponding "fyyuz", I had to use an in-circuit programmer.  Sleep mode is selected such that it disables everything except interrupts.  The author did not immediately realize that it was necessary to turn off the ADC, which for a long time could not find the reason why the microcontroller consumed almost one milliamper in sleep mode.  The watchdog timer also had to be turned off, and here is the result: about 2 ¬µA in sleep mode and 3.5 mA when the command is transmitted.  <a href="https://oregonembedded.com/batterycalc.htm">This calculator</a> showed that in ideal conditions, if you press the buttons 5 times per hour, the element in this mode is enough for 4.82 years.  Even one or two years is already great, and even more so. <br><br>  Pay author developed in Eagle.  Files for repetition: <a href="">sketch</a> , <a href="">scheme</a> , <a href="">"gerberas"</a> , <a href="">source board</a> . <br><br><img src="https://habrastorage.org/webt/md/bi/_p/mdbi_p2swwd6_gm4krklxtazjr8.png"><br><br><img src="https://habrastorage.org/webt/du/b1/ra/dub1raly7z8hoyefd6awcs_wwmm.png"><br><br>  Video where it is shown incl.  current measurement: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/I3V3gMDKogU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  The process of improving the design continues, first of all it is necessary to make earn a couple of buttons for which the codes found on the network were wrong.  Further, the author cites a simplified analogue of CC-BY from one phrase: ‚ÄúIf you want, use the code and board in other homemade products, just do not forget to indicate who developed all this for you.‚Äù  Since the source library is not under the GPL, but under the LGPL, you can do that. </div><p>Source: <a href="https://habr.com/ru/post/452046/">https://habr.com/ru/post/452046/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../452034/index.html">Self-control of time for self-education and time for reading books</a></li>
<li><a href="../452036/index.html">Software Defined Radio - how does it work? Part 2</a></li>
<li><a href="../452038/index.html">Dangerous trade</a></li>
<li><a href="../452040/index.html">Tunguska meteorite and his younger brothers</a></li>
<li><a href="../452042/index.html">Cryptography in simple language: parse symmetric and asymmetric encryption on the example of the Star Wars plot (Updated)</a></li>
<li><a href="../45205/index.html">Secret IP addresses of German intelligence</a></li>
<li><a href="../452052/index.html">How we halved the cost of an introductory lesson by looking at a solution with airlines</a></li>
<li><a href="../452054/index.html">Why WhatsApp will never be safe</a></li>
<li><a href="../452056/index.html">Golang DevDay: May 31, Novosibirsk + broadcast</a></li>
<li><a href="../45206/index.html">We had no money, so we had to think</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>