<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Running external processes in Scala</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 In one of my home projects, I had to write a small external process manager. The application should have been able to start an external...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Running external processes in Scala</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  In one of my home projects, I had to write a small external process manager.  The application should have been able to start an external daemon, periodically monitor its state when it is necessary to turn off, turn on, change settings, etc.  The existing functionality in Java for such tasks is very poor, and since I was also dealing with Scala at the same time, I decided to see how it deals with this.  And I was pleasantly surprised: Scala offers in my opinion a good API for working with external processes. <br>  In this article I would like to tell about it in more detail. <br><a name="habracut"></a><br><h4>  Running processes </h4><br>  At the heart of working with processes are two traits: this is <a href="http://www.scala-lang.org/archives/downloads/distrib/files/nightly/docs/library/index.html">scala.sys.process.Process</a> and <a href="http://www.scala-lang.org/archives/downloads/distrib/files/nightly/docs/library/index.html">scala.sys.process.ProcessBuilder</a> . <br>  Process allows you to work with an already running process, and ProcessBuilder allows you to configure startup parameters. <br>  These entities are located in the <a href="http://www.scala-lang.org/api/current/index.html">scala.sys.process</a> package.  To run a simple example, run the code: <br><pre><code class="scala hljs">scala&gt; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> scala.sys.process._ scala&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> process: <span class="hljs-type"><span class="hljs-type">Process</span></span> = <span class="hljs-type"><span class="hljs-type">Process</span></span>(<span class="hljs-string"><span class="hljs-string">"echo Hello World"</span></span>).run() scala&gt; println(process.exitValue())</code> </pre> <br>  The run method is the main method for starting a process, whose declaration is located in the processBuilder <a href="http://www.scala-lang.org/archives/downloads/distrib/files/nightly/docs/library/index.html">track</a> .  Returns a reference to an object of type <a href="http://www.scala-lang.org/archives/downloads/distrib/files/nightly/docs/library/index.html">Process</a> .  The running process runs in the background, data is output in the console.  There are two methods declared in <a href="http://www.scala-lang.org/archives/downloads/distrib/files/nightly/docs/library/index.html">Process</a> : <br><ul><li>  <code>exitValue()</code> - waits for the completion of the process and returns a completion code; </li><li>  <code>destroy()</code> - destroys the running process. </li></ul><br>  This trait is very similar to the standard Java class java.lang.Process. <br>  There are more specialized methods for running processes in the ProcessBuilder process.  I will give a brief description of the main ones: <br><ul><li> <code>!</code>  - starts the process, waits for completion of the execution, displays the data to the console, and returns the exit code of the process as a result; </li><li> <code>!!</code>  - starts the process, waits for completion of the execution, displays data in the console, if the completion code is different from zero - throws an exception, as a result returns the output of the process as a string; </li><li>  <code>lines</code> - starts the process, returns <a href="http://www.scala-lang.org/api/current/index.html">Stream</a> [String].  This thread allows parallel execution of the process to read the process data.  If the information is not available, the Stream is blocked and will wait until the information reappears, or the process completes execution.  If the exit code of the process is non-zero, the method will raise an exception.  To avoid an exception, call lines_ !; </li><li>  <code>run</code> - starts the process and returns a link to <a href="http://www.scala-lang.org/archives/downloads/distrib/files/nightly/docs/library/index.html">Process</a> . </li></ul><br>  In my project, I did not need to store references to external processes, so I almost did not use the run method.  But the method <code>!</code>  just fit for me. <br>  The previous example can be rewritten as: <br><pre> <code class="scala hljs">scala&gt; <span class="hljs-type"><span class="hljs-type">Process</span></span>(<span class="hljs-string"><span class="hljs-string">"echo Hello World!"</span></span>).! <span class="hljs-type"><span class="hljs-type">Hello</span></span> <span class="hljs-type"><span class="hljs-type">World</span></span>! res1: <span class="hljs-type"><span class="hljs-type">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> scala&gt; <span class="hljs-type"><span class="hljs-type">Process</span></span>(<span class="hljs-string"><span class="hljs-string">"echo Hello World!"</span></span>).!! res2: <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span> scala&gt; <span class="hljs-type"><span class="hljs-type">Process</span></span>(<span class="hljs-string"><span class="hljs-string">"echo Hello World!"</span></span>).lines res3: <span class="hljs-type"><span class="hljs-type">Stream</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] = <span class="hljs-type"><span class="hljs-type">Stream</span></span>(<span class="hljs-type"><span class="hljs-type">Hello</span></span> <span class="hljs-type"><span class="hljs-type">World</span></span>!, ?)</code> </pre><br><br><h4>  Implicit type conversion </h4><br>  There are methods for implicitly converting strings ( <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html">java.lang.String</a> ) and sequences ( <a href="http://www.scala-lang.org/api/current/index.html">scala.collection.Seq</a> ) to the ProcessBuilder <a href="http://www.scala-lang.org/archives/downloads/distrib/files/nightly/docs/library/index.html">treyt</a> . <br>  We can write our code like this: <br><pre> <code class="scala hljs">scala&gt; <span class="hljs-string"><span class="hljs-string">"echo Hello World!"</span></span>.! <span class="hljs-type"><span class="hljs-type">Hello</span></span> <span class="hljs-type"><span class="hljs-type">World</span></span>! res2: <span class="hljs-type"><span class="hljs-type">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  or so: <br><pre> <code class="scala hljs">scala&gt; <span class="hljs-type"><span class="hljs-type">Seq</span></span>(<span class="hljs-string"><span class="hljs-string">"echo"</span></span>, <span class="hljs-string"><span class="hljs-string">"Hello"</span></span>, <span class="hljs-string"><span class="hljs-string">"World!"</span></span>).! <span class="hljs-type"><span class="hljs-type">Hello</span></span> <span class="hljs-type"><span class="hljs-type">World</span></span>! res3: <span class="hljs-type"><span class="hljs-type">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  To a large extent, this reduces and simplifies writing, and the code becomes more understandable. <br>  And this in turn reduces the number of errors in the future. <br><br><h4>  Process Combining (Pipe) </h4><br>  Process calls can be combined in chains, similar to command chains in linux. <br><pre> <code class="scala hljs">scala&gt; <span class="hljs-string"><span class="hljs-string">"ls"</span></span>.! <span class="hljs-number"><span class="hljs-number">11.</span></span>txt <span class="hljs-number"><span class="hljs-number">1.</span></span>txt <span class="hljs-number"><span class="hljs-number">2.</span></span>txt <span class="hljs-number"><span class="hljs-number">3.</span></span>txt res2: <span class="hljs-type"><span class="hljs-type">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> scala&gt; (<span class="hljs-string"><span class="hljs-string">"ls"</span></span> #| <span class="hljs-string"><span class="hljs-string">"grep 1"</span></span>).! <span class="hljs-number"><span class="hljs-number">11.</span></span>txt <span class="hljs-number"><span class="hljs-number">1.</span></span>txt res6: <span class="hljs-type"><span class="hljs-type">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  The output from the ls command was sent to the grep input.  Grep filtered the received information on entry 1. <br>  You can perform conditional operations, for example: <br><pre> <code class="scala hljs">scala&gt; (<span class="hljs-string"><span class="hljs-string">"find . -name *.txt -exec grep 0 {} ;"</span></span> #| <span class="hljs-string"><span class="hljs-string">"xargs test -z"</span></span> #&amp;&amp; <span class="hljs-string"><span class="hljs-string">"echo 0-free"</span></span> #|| <span class="hljs-string"><span class="hljs-string">"echo 0-exists"</span></span>).! <span class="hljs-number"><span class="hljs-number">0</span></span>-exists res23: <span class="hljs-type"><span class="hljs-type">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  Here, if there are files with the extension * .txt in the directory and in some of them, there is 0 in the text - it will output 0-exists to the console, otherwise 0-free. <br>  <code>#&amp;&amp;</code> - executes the following command, if the previous one was executed correctly; <br> <code>#||</code>  - executes the following command, if the prediction is executed with errors. <br>  I like this functionality most of all; it allows you to use linux-like pipe inside Scala and write small sh scripts right inside your code. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Override I / O streams </h4><br>  All our code is inconvenient and useless without the functionality of redefining the input / output of external processes. <br>  It is often necessary to monitor the output of information in order, for example, to decipher the error that has occurred, or to make sure that everything works correctly. <br>  In each processBuilder method, in each of the methods run,!, !!, lines, you can pass an instance of a treyt <a href="http://www.scala-lang.org/api/current/index.html">ProcessLogger</a> , which allows you to redirect the program's output streams to a file or line. <br>  Here's how using <a href="http://www.scala-lang.org/api/current/index.html">ProcessLogger</a> you can calculate the number of lines printed by the process: <br><pre> <code class="scala hljs">scala&gt; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> normalLines = <span class="hljs-number"><span class="hljs-number">0</span></span> normalLines: <span class="hljs-type"><span class="hljs-type">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> scala&gt; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> errorLines = <span class="hljs-number"><span class="hljs-number">0</span></span> errorLines: <span class="hljs-type"><span class="hljs-type">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> scala&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> countLogger = <span class="hljs-type"><span class="hljs-type">ProcessLogger</span></span>(line =&gt; normalLines += <span class="hljs-number"><span class="hljs-number">1</span></span>, | line =&gt; errorLines +=<span class="hljs-number"><span class="hljs-number">1</span></span>) countLogger: scala.sys.process.<span class="hljs-type"><span class="hljs-type">ProcessLogger</span></span> = scala.sys.process.<span class="hljs-type"><span class="hljs-type">ProcessLogger</span></span>$$anon$<span class="hljs-number"><span class="hljs-number">1</span></span>@<span class="hljs-number"><span class="hljs-number">459</span></span>c8859 scala&gt; <span class="hljs-string"><span class="hljs-string">"ls"</span></span> ! countLogger res0: <span class="hljs-type"><span class="hljs-type">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> scala&gt; println(<span class="hljs-string"><span class="hljs-string">"normalLines: "</span></span> + normalLines + <span class="hljs-string"><span class="hljs-string">", errorLines: "</span></span> + errorLines) normalLines: <span class="hljs-number"><span class="hljs-number">4</span></span>, errorLines: <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  <a href="http://www.scala-lang.org/api/current/index.html">ProcessLogger</a> allows you to override output streams.  To override both input and output, the class <a href="http://www.scala-lang.org/api/current/index.html">scala.sys.process.ProcessIO</a> is also used. <br>  A small example: <br><pre> <code class="scala hljs"><span class="hljs-type"><span class="hljs-type">Seq</span></span>(<span class="hljs-string"><span class="hljs-string">"grep"</span></span>, <span class="hljs-string"><span class="hljs-string">"1"</span></span>) run <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">ProcessIO</span></span>((output: java.io.<span class="hljs-type"><span class="hljs-type">OutputStream</span></span>) =&gt; { output.write(<span class="hljs-string"><span class="hljs-string">"1.txt\n2.txt\n3.txt\n11.txt"</span></span>.getBytes) output.close() }, (input: java.io.<span class="hljs-type"><span class="hljs-type">InputStream</span></span>) =&gt; { println(<span class="hljs-type"><span class="hljs-type">Source</span></span>.fromInputStream(input).mkString) input.close() }, _.close())</code> </pre><br>  The first parameter is the input stream to the process: here we write the initial data. <br>  The second parameter is standard output, and the last is output for errors. <br>  Parameters are functions that process the necessary threads. <br>  I said earlier that the execution of external commands can be combined, in addition, using the same recording form, you can transfer data to the process, or read them from there. <br>  You can transfer data from a file to a process using the <code>#&lt;</code> method, and write it down using the <code>#&gt;</code> method: <br><pre> <code class="scala hljs">scala&gt; (<span class="hljs-string"><span class="hljs-string">"echo -e 1.txt\\n2.txt\\n3.txt"</span></span> #&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> java.io.<span class="hljs-type"><span class="hljs-type">File</span></span>(<span class="hljs-string"><span class="hljs-string">"1.txt"</span></span>)).! res21: <span class="hljs-type"><span class="hljs-type">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> scala&gt; (<span class="hljs-string"><span class="hljs-string">"grep 1"</span></span> #&lt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> java.io.<span class="hljs-type"><span class="hljs-type">File</span></span>(<span class="hljs-string"><span class="hljs-string">"1.txt"</span></span>)).!! res22: <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-string"><span class="hljs-string">"1.txt"</span></span></code> </pre><br>  In the same way, for example, you can copy information from one file to another: <br><pre> <code class="scala hljs">scala&gt; (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> java.io.<span class="hljs-type"><span class="hljs-type">File</span></span>(<span class="hljs-string"><span class="hljs-string">"1.txt"</span></span>) #&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> java.io.<span class="hljs-type"><span class="hljs-type">File</span></span>(<span class="hljs-string"><span class="hljs-string">"2.txt"</span></span>)).! res23: <span class="hljs-type"><span class="hljs-type">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> scala&gt; <span class="hljs-string"><span class="hljs-string">"cat 2.txt"</span></span>.! <span class="hljs-number"><span class="hljs-number">1.</span></span>txt <span class="hljs-number"><span class="hljs-number">2.</span></span>txt <span class="hljs-number"><span class="hljs-number">3.</span></span>txt res24: <span class="hljs-type"><span class="hljs-type">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br><h4>  Conclusion </h4><br>  In the article, I talked about the basics of working with external processes in Scala.  In Java, to implement this, I would have to write a bunch of wrappers, and in the end, I still would not be able to come close to such simplicity.  You can read more about the API at <a href="http://www.scala-lang.org/api/current/index.html">http://www.scala-lang.org</a> or delve into the source code (which I did, for example, took some examples from there). In jdk1.7, we slightly expanded the <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/ProcessBuilder.html">java.lang.ProcessBuilder</a> class, and Java has become easier to run and execute external commands.  But the simplicity of Scala, jdk is far away. </div><p>Source: <a href="https://habr.com/ru/post/184412/">https://habr.com/ru/post/184412/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../184400/index.html">Notepad ++ has a spelling highlighting error</a></li>
<li><a href="../184402/index.html">OCZ Silencer Mk III Power Supply Overview</a></li>
<li><a href="../184404/index.html">Found a way to install exclusive Nokia applications on any smartphone with WP</a></li>
<li><a href="../184406/index.html">Overview of new features in Qt Quick</a></li>
<li><a href="../184410/index.html">Organization of a single folder for cloud services</a></li>
<li><a href="../184414/index.html">Time management: experience using Excel spreadsheets</a></li>
<li><a href="../184416/index.html">Model-View in QML. Part One: Predefined Component Views</a></li>
<li><a href="../184420/index.html">Why I comment on Ruby / Rails application code again</a></li>
<li><a href="../184422/index.html">Armikrog danger! Will the project on the kickstarter collect the required amount? Collected</a></li>
<li><a href="../184426/index.html">Playstation 4 will work on a modified version of FreeBSD 9.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>