<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tales of incompatible applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="These are excerpts from the free chapter from the paper book The Old New Thing. They are not trying to teach anything; these are just short funny epis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tales of incompatible applications</h1><div class="post__text post__text-html js-mediator-article">  These are excerpts from the free chapter from the paper book The Old New Thing.  They are not trying to teach anything;  these are just short funny episodes from everyday fighters for compatibility of new versions of Windows with old applications. <br><br><h3>  Change the version number of Windows </h3><br>  Changing the version number that Windows communicates to programs is not as easy as it sounds.  For example, some programs check the version number like this: <pre> UINT Ver = GetVersion ();
 UINT MajorVersion = LOBYTE (uVer);
 UINT MinorVersion = HIBYTE (uVer);
 if (MajorVersion &lt;3 || MinorVersion &lt;10) {
     Error ("This program requires Windows 3.1");
 }
</pre><br>  Imagine how this code will work on Windows 95, which has a version number of 4.0.  The second check is triggered because 0 is less than 10. <br>  And okay, the program would just display an error message and complete.  Many collapsed: it was obvious that their behavior on "unsupported" versions of Windows was never tested. <br><br>  There were so many such programs that we stopped correcting them one by one, and simply changed the version number returned from 4.0 to 3.95. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Programs for MS-DOS, too, not all responded smoothly to changing OS versions.  This is surprising because by that time, MS-DOS already had dozens of released versions and sub-versions, and it would be time for developers to learn to check the version number.  But for example, one software package used the DOS version number as an index in the function table: by its own function for each version released.  There were five functions in the table: from MS-DOS 1.x to 5.x.  When the program was run under MS-DOS 6.0, it caused an address outside the table, and crashed. <br><br>  Changing the version number that Windows reports to programs is a necessary, but very difficult step.  A couple of keystrokes, and fall hundreds of applications that have worked well so far;  now the compatibility department will have to spend an extra thousand man-hours on catching other people's bugs. <br><br><a name="habracut"></a><h3>  We inform the developers about the bug in their program </h3><br>  Specifically, this conversation is fictional, but similar in fact conversations happened more than once. <br><br>  -Hello? <br>  ‚ÄîHello, this is such and such, from the Microsoft Windows compatibility department.  We found a bug in your program that prevented it from working.  We had to add code in Windows 95 to bypass this bug in order for your program to continue working. <br>  ‚ÄîGreatly, thank you so much!  Goodbye.  ( <i>Short beeps.</i> ) <br>  <i>(Dial the number again.)</i> <br>  -Hello? <br>  ‚ÄúHello, uh ... you don't even want to know what the bug was?‚Äù <br>  -What's the difference?  You fixed it all.  Thank!  What would we do without you! <br>  ‚ÄîBut, uh, the code around the bug will only work with the current version of your program.  When you release the next version, it will not work. <br>  ‚ÄúThat's how it is? .. Well, wait, I will connect you with our programmers.‚Äù <br><br>  The developers absolutely do not pay attention to you until you mention that their program will stop working. <br><br>  When I was engaged in backward compatibility with MS-DOS programs (mostly they were games), it often happened that I called to inform the developers that their program did not work under Windows 95. Many developers simply answered ‚ÄúThat's right, we don‚Äôt work with Windows. " <br><br><h3>  We remind users to act strictly according to the instructions. </h3><br>  A neighbor of one of our developers bought a program that crashed immediately upon launch.  The developer and his colleagues started with a standard procedure - they changed drivers, started them on another computer - but nothing helped.  Desperate to cope with the problem on their own, they called the developers. <br><br>  In technical support, they were told that if during installation all three fields ‚Äî name, organization and serial number ‚Äî were not filled in, then the installation is successful, but the program will crash on launch.  And this is not a sophisticated copy protection, but a documented bug. <br><br><h3>  Put the cart before the horse </h3><br>  Sometimes such terrible bugs are found in programs that it is not clear how they work at all. <br><br>  The installer of one popular program tries to replace the system file with its own version.  It replaces the file, even if this own version is older than the one already installed in the system: the installer does not bother checking versions. <br>  Great, the Windows file protection system is closely monitoring such programs, and it will restore the correct version as soon as the installation is complete.  This is not the problem. <br><br>  If the system file that the installer is trying to replace is busy, the installer overwrites it with the <code>MOVEFILE_DELAY_UNTIL_REBOOT</code> option - so that the busy file is replaced when the system is rebooted: <pre> // Code simplified for clarity
 MoveFileEx ("sysfile.new", "sysfile.dll", MOVEFILE_DELAY_UNTIL_REBOOT);
 CopyFile ("D: \\ CDROM \\ INSTALL \\ sysfile.dll", "sysfile.new");
</pre><br>  So it is - the program is trying to copy a file that does not exist yet! <br>  This code actually worked on Windows NT, because there the function <code>MoveFileEx</code> , when it was called with <code>MOVEFILE_DELAY_UNTIL_REBOOT</code> , did not check if the file to be copied exists.  In the beta version of Windows 2000, we added a more rigorous parameter check;  now <code>MoveFileEx</code> returned an error.  The installer considered this error fatal, and stopped the installation. <br><br>  In Windows 2000, I had to allow copying of nonexistent files with the <code>MOVEFILE_DELAY_UNTIL_REBOOT</code> option.  <code>MoveFileEx</code> reports on success - in the hope that by the time of the reload the file being copied will actually appear. <br><br><h3>  The strangest way to check the success of a call </h3><br>  I have no idea what the developers of a multimedia program thought, which, checking the success of calling multimedia functions, did not compare <code>MMRESULT</code> returned with <code>MMSYSERR_NOERROR</code> , but received a text description for the error number, and then compared this line with ‚ÄúThe specified command complete successfully. " <br>  In fact, she compared only the first sixteen characters with ‚ÄúThe specified co‚Äù - probably, someone was looking through the code and decided to optimize this place. <br>  In one of the versions of Windows, when we rephrased this message a little, the program stopped working.  Needless to say, it never worked on non-English versions of Windows. <br><br><h3>  A stranger than the strangest way to check the success of a call </h3><br>  What would you think?  There is an even stranger way.  At a minimum, the past program worked with the return error code.  Another program that used MCI to play videos completely ignored the value returned by a call to <code>MCIWndOpen</code> .  Instead, she read the title of the MCI window, and compared it with the ‚ÄúNo Device‚Äù line to determine if the file was opened successfully. <br><br>  In Windows 95, the MCI window header when opening a file was installed with a slight delay.  Now that program could not open the videos: she checked the window title too early. <br><br><h3>  How to make a mistake in the function from one line </h3><br>  One day an employee came to my office and asked: ‚ÄúHey, do you want a sound card?‚Äù I did not have my sound card, so I agreed. <br><br>  It turned out that he gave me this card for a reason: he could not make it work under Windows 95. Now it was not he, but I was a loser with a broken sound.  Soon I understood why he so wanted to get rid of her: from time to time she destroyed the entire system.  A debug version of Windows was installed on my machine, so I was able to figure out the cause of the crashes. <br><br>  The developers of the driver for this sound card took a function from a single line, a sample of which is given in the DDK, and they managed to make a mistake in it. <br>  Here is a sample of the function in the DDK: <br><pre> void FAR PASCAL midiCallback (NPPORTALLOC pPortAlloc, WORD msg,
                              DWORD dwParam1, DWORD dwParm2) {
   if (pPostAlloc-&gt; dwCallback)
     DriverCallBack (pPortalloc-&gt; dwCallback, HIWORD (pPortalloc-&gt; dwFlags),
                    pPortalloc-&gt; hMidi, msg, dwParam1, dwParam2);
 }
</pre>  It is called by the system during a hardware interrupt. <br><br>  This is how this function looked in that driver: <br><pre> void FAR PASCAL midiCallback (NPPORTALLOC pPortAlloc, WORD msg,
                              DWORD dwParam1, DWORD dwParm2) {
   char szBuf [80];
   if (pPostAlloc-&gt; dwCallback) {
     wsprintf (szBuf, "Dc (hMidi =% X, wMsg =% X)", pPortalloc-&gt; hMidi, msg);
 #ifdef DEBUG
     OutputDebugString (szBuf);
 #endif
     DriverCallBack (pPortalloc-&gt; dwCallback, HIWORD (pPortalloc-&gt; dwFlags),
                    pPortalloc-&gt; hMidi, msg, dwParam1, dwParam2);
   }
 }
</pre><br>  They not only left in the final version of the driver remnants of the debugging code;  during a hardware interrupt, they call a function that cannot be called at that moment.  If <code>wsprintf</code> unloaded from memory, then the system receives a new ‚Äúmissing segment‚Äù interrupt during a hardware interrupt, and that‚Äôs the end.  Even if lucky, and <code>wsprintf</code> is in memory - this function changes the upper word of 32-bit registers, and the hardware interrupt handler stores only the lower word.  This means that the interrupted code is waiting for a very rude awakening when the interrupt processing is complete. <br><br>  Despite all this, the sound card won an award from a popular computer magazine. <br>  But injustice was not limited to this: the card manufacturer wanted a new version of their driver to be included in Windows 95.  And what did we see in the new version?  The same bug that destroys the system is the same one that we showed them to the programmers several months ago.  As you can guess, the new version of the driver in Windows 95 is not included. <br><br><h3>  Sound editor and annoying parasite </h3><br>  We caught one tutorial that parasitized on the standard Sound Editor, and grabbed it so deeply that the further we studied it, the more amazed. <br><br>  The first problem was banal: the program started the Sound Editor by the name of its 16-bit version, <code>SOUNDREC.EXE</code> .  In Windows 95, the sound editor was 32-bit, and was called <code>SNDREC32.EXE</code> - the same as in Windows NT.  We renamed the file back to a 16-bit name, and believed that the program would work now. <br><br>  But she did not earn.  Successfully launching the editor, the program searches for its window by title.  First she tries to find an English headline, then Italian (the program was developed for Italians).  Not so bad: many developers have not thought at all about supporting localized releases of Windows.  True, Italians living, say, in France, will not be able to use this program;  but this is not our concern. <br>  In Windows 95, the header of the Sound Editor has changed: we added the name of the open file there.  Now the program could not find the window of the editor that launched. <br><br>  Then we changed the title of the 16-bit Sound Editor to match exactly the title used in Windows 3.1.  Finally, the program has started.  We followed her, and found that she never uses a running editor!  Why did she run it? <br><br>  It turned out that under certain conditions she really enjoys it.  Usually it plays sounds with a special component ( <i>apparently, it was VBX</i> ), which supports asynchronous sound card drivers, but does not support the <code>SPEAKER.DRV</code> synchronous driver, which allowed to play sounds through <code>SPEAKER.DRV</code> without a sound card. <br>  The developers were looking for something that could work with this synchronous driver - and found the Sound Editor.  Imitate keystrokes in his window - and a cheap replacement for the player component is ready. <br><br>  But if you pay attention at the time of launching the program, you will notice how the Sound Editor window flashes and immediately disappears, leaving only a strip on the left of the screen.  Programmers did not want the editor window to be visible.  But they did not know how to make the window invisible, so they did everything they could: they ‚Äúdragged‚Äù the window off the screen.  Well, almost out of bounds.  They could not even move the window programmatically, so they simulated clicks and mouse movements, as if dragging a window by the title.  When only a narrow strip remains on the screen, which the mouse can no longer drag further left, programmers consider their task accomplished: ‚ÄúWe have removed the window behind the screen ‚Äî probably no one will notice it.‚Äù <br><br><hr><br>  <i>I advise you to look at my past translation at the same time - <a href="http://habrahabr.ru/blogs/atnikvariat/102203/">Favorite "iron" bug</a></i> </div><p>Source: <a href="https://habr.com/ru/post/103598/">https://habr.com/ru/post/103598/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../103589/index.html">Video Galaxy Tab</a></li>
<li><a href="../103591/index.html">Updates on 42goals: API, time tracking, tabs, goals archive</a></li>
<li><a href="../103592/index.html">Chinese Android tablet Apad iRobot</a></li>
<li><a href="../103594/index.html">Is it possible to use Java applet on the page if JS and Flash do not have the necessary functionality?</a></li>
<li><a href="../103597/index.html">How to make money on the support of Internet projects?</a></li>
<li><a href="../103600/index.html">Getting started with Drupal: a complete practical guide (part 1)</a></li>
<li><a href="../103601/index.html">How to buy t-shirts with prints on the Internet to be satisfied and not to be deceived (part 3)</a></li>
<li><a href="../103603/index.html">Getting started with Drupal: a complete practical guide (part 2)</a></li>
<li><a href="../103604/index.html">Are your IPs already aligned with the requirements of 152-–§–ó "About personal data"?</a></li>
<li><a href="../103605/index.html">Skype user identification service is preparing to launch.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>