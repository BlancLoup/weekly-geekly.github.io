<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Objective-c blocks and c ++ lambdas</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I hope that the post will be useful to people who are familiar with C ++ lambdas, but want to learn Objective-C blocks and vice versa. 
 Here I tried ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Objective-c blocks and c ++ lambdas</h1><div class="post__text post__text-html js-mediator-article">  I hope that the post will be useful to people who are familiar with C ++ lambdas, but want to learn Objective-C blocks and vice versa. <br>  Here I tried to describe the syntax of closures, context capture mechanisms, memory management, and the interaction of lambdas and blocks with each other. <br>  All examples used Apple LLVM Compiler 4.2 (Clang).  For the given Obj-C code, ARC is not used, because I hold the opinion that it is necessary to know how non-ARC code works in order to understand how ARC works. <br><a name="habracut"></a><br><h4>  Sections: </h4><br><ol><li>  <a href="https://habr.com/ru/post/204356/">Syntax</a> </li><li>  <a href="https://habr.com/ru/post/204356/">Context capture</a> </li><li>  <a href="https://habr.com/ru/post/204356/">Memory management</a> </li><li>  <a href="https://habr.com/ru/post/204356/">Objective-C ++</a> </li></ol><br>  <b>Blocks in Objective-C</b> is the implementation of <a href="http://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B0%25D0%25BC%25D1%258B%25D0%25BA%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_(%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5)">closures [2]</a> .  Blocks are anonymous functions that can capture a context (current stack variables and member variables of classes).  Blocks at run time are represented by objects; they are analogous to lambda expressions in C ++. <br><br>  <b>Lambda in C ++</b> are also implementations of closures and are unnamed local functions. <br><a name="Syntacs"></a><br><h4>  Syntax </h4><br><br><h5>  Obj-c blocks </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/22b/d0a/eec/22bd0aeec29ae16ba5a6bf46bdc7389e.png">  <a href="https://developer.apple.com/library/ios/documentation/cocoa/Conceptual/Blocks/Articles/bxGettingStarted.html">[3]</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">In text form</b> <div class="spoiler_text"><pre><code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> multiplier = <span class="hljs-number"><span class="hljs-number">7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> (^myBlock)(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) = ^(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> num) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> num * multiplier;}; <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(@‚Äù%d‚Äù, myBlock(<span class="hljs-number"><span class="hljs-number">4</span></span>)); <span class="hljs-comment"><span class="hljs-comment">//  28</span></span></code> </pre> <br><ul><li>  ^ - this symbol tells the compiler that the variable is a block </li><li>  int - the block takes one parameter of type int, and returns a parameter of type int </li><li>  multiplier - a variable that comes to us from the context (more on this in the section ‚ÄúCapture Context‚Äù) </li></ul><br></div></div><br>  Blocks have pointer semantics. <br>  Blocks in Objective-C have already firmly found their application both in standard frameworks (Foundation, UIKit) and in third-party libraries ( <a href="https://github.com/AFNetworking/AFNetworking">AFNetworking</a> , <a href="https://github.com/zwaldowski/BlocksKit">BlocksKit</a> ). <br>  Let's give an example in the form of a <a href="https://developer.apple.com/library/ios/documentation/cocoa/conceptual/ProgrammingWithObjectiveC/CustomizingExistingClasses/CustomizingExistingClasses.html">category</a> class <a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSArray_Class/NSArray.html">NSArray</a> <br><br><div class="spoiler">  <b class="spoiler_title">An example of using a block in NSArray</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">//   @implementation NSArray (Blocks) //   ,     - (NSArray*)subarrayWithPredicate:(BOOL(^)(id object, NSUInteger idx, BOOL *stop))predicte { NSMutableArray *resultArray = [NSMutableArray array]; BOOL shouldStop = NO; for (id object in self) { if (predicte(object, [self indexOfObjectIdenticalTo:object], &amp;shouldStop)) { [resultArray addObject:object]; } if (shouldStop) { break; } } return [[resultArray copy] autorelease]; } @end // -    NSArray *numbers = @[@(5), @(3), @(8), @(9), @(2)]; NSUInteger divisor = 3; NSArray *divisibleArray = [numbers subarrayWithPredicate:^BOOL(id object, NSUInteger idx, BOOL *stop) { BOOL shouldAdd = NO; //     3 NSAssert([object isKindOfClass:[NSNumber class]], @"object != number"); //  ,   divisor     if ([(NSNumber *)object intValue] % divisor == 0) { shouldAdd = YES; } return shouldAdd; }]; NSLog(@"%@", divisibleArray); //  3, 9</span></span></code> </pre><br></div></div><br>  First of all, they are great for asynchronous operations, this can be seen using AFNetworking, and working with them in <a href="https://developer.apple.com/library/mac/documentation/Performance/Reference/GCD_libdispatch_Ref/Reference/reference.html">GCD</a> is a pleasure. <br>  We can define our block types, for example: <br><br><div class="spoiler">  <b class="spoiler_title">Block type declaration</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> (^MyBlockType)(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> number, <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> object);</code> </pre><br></div></div><br><h5>  C ++ lambda </h5><br>  The same code is in the form of lambda <br><img src="https://habrastorage.org/getpro/habr/post_images/7e2/435/a0c/7e2435a0ce1da69e48b6ce54f0165594.png">  <a href="http://msdn.microsoft.com/en-us/library/vstudio/dd293603.aspx">[eleven]</a> <br><div class="spoiler">  <b class="spoiler_title">In text form</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> multiplier = <span class="hljs-number"><span class="hljs-number">7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> lambda = [&amp;multiplier](<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> num) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>() -&gt; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> multiplier * num; }; lambda(<span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  28</span></span></code> </pre><br><ul><li>  <code>[]</code> - the beginning of the declaration of lambda, inside - capture context </li><li>  <code>&amp;multiplier</code> - the captured variable ( <code>&amp;</code> means it is captured by reference) </li><li>  <code>int</code> - input parameter </li><li>  <code>mutable</code> - a keyword that allows you to modify variables captured by value </li><li>  <code>throw()</code> - means that lambda does not throw any exceptions out </li></ul><br></div></div><br>  Let's give a similar example of selecting a subset for a lambda. <br><br><div class="spoiler">  <b class="spoiler_title">Retrieving a Subset from the Predicate Collection</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InputCollection</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UnaryPredicate</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subset</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InputCollection</span></span></span><span class="hljs-class">&amp; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">inputCollection</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InputCollection</span></span></span><span class="hljs-class">&amp; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">outputCollection</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UnaryPredicate</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">predicate</span></span></span><span class="hljs-class">) {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> InputCollection::iterator iterator = inputCollection.begin(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (;iterator != inputCollection.end(); ++iterator) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (predicate(*iterator)) { outputCollection.push_back(*iterator); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * argv[])</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> divisor = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; inputVector = {<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; outputVector; subset(inputVector, outputVector, [divisor](<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> number){<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> number % divisor == <span class="hljs-number"><span class="hljs-number">0</span></span>;}); <span class="hljs-comment"><span class="hljs-comment">//     std::for_each( outputVector.begin(), outputVector.end(), [](const int&amp; number){std::cout &lt;&lt; number &lt;&lt; std::endl;} ); }</span></span></code> </pre><br></div></div><br><a name="Context"></a><br><h4>  Context capture </h4><br><h5>  Obj-c blocks </h5><br>  We can automatically use the values ‚Äã‚Äãof stack variables in blocks, if we do not change them.  For example, in the example above, we did not indicate in the block declaration that we wanted to capture the <code>multiplier</code> variable (unlike lambda, in lambda we could specify <code>[&amp;]</code> to capture the entire context by reference, or <code>[=]</code> to capture the entire context by value). <br>  We simply took its value by the name declared in the function body.  If we wanted to change its value in the body of the block, we would have to mark the variable with the <code>__block</code> modifier <br><br><div class="spoiler">  <b class="spoiler_title">An example of changing the value of a variable from the context</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">__block <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> first = <span class="hljs-number"><span class="hljs-number">7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^myBlock2)(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) = ^(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> second) { first += second;}; myBlock2(<span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"%d"</span></span>, first); <span class="hljs-comment"><span class="hljs-comment">//  11</span></span></code> </pre><br></div></div><br>  In order to send messages to the object, the pointer to which we pass to the block, there is no need to mark the pointer as <code>__block</code> .  After all, in fact, when we send a message to an object, we do not change its pointer. <br><br><div class="spoiler">  <b class="spoiler_title">Example of sending a message to an object from the context</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">NSMutableArray</span></span> *array = [<span class="hljs-built_in"><span class="hljs-built_in">NSMutableArray</span></span> array]; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^myBlock3)() = ^() { [array addObject:<span class="hljs-string"><span class="hljs-string">@"someString"</span></span>];}; myBlock3(); <span class="hljs-comment"><span class="hljs-comment">//  someString  array</span></span></code> </pre><br></div></div><br>  But sometimes, nevertheless, it is necessary to mark a pointer to an object using <code>__block</code> to avoid memory leaks.  (More on this in the ‚ÄúMemory Management‚Äù section) <br><br><h5>  C ++ lambda </h5><br>  Captured variables are specified in a specific place <a href="http://ru.cppreference.com/w/cpp/language/lambda">[5]</a> , namely inside the square brackets [] <br><ul><li>  <code>[&amp;]</code> - means that we capture all the characters by reference. </li><li>  <code>[=]</code> - all characters by value </li><li>  <code>[a, &amp;b]</code> - <code>a</code> captured by value, <code>b</code> captured by reference </li><li>  <code>[]</code> - nothing is captured </li></ul><br>  The context specifier is related to the <code>mutable</code> specifier, it says <br>  that you can change copies of variables passed by value.  More in the next section. <br><br><a name="MemoryManagement"></a><br><h4>  Memory management </h4><br><h5>  Obj-c blocks </h5><br>  Blocks are objects, they are created on the stack (afterwards they can be transferred to a heap) <br>  Blocks can exist as 3 implementations <a href="http://www.youtube.com/watch%3Fv%3DSKot4tfsV24%26feature%3Dem-uploademail">[7]</a> . <br><br><ol><li>  When we do not use variables from the context (from the stack) inside the block, an <code>NSGlobalBlock</code> is created, which is implemented as a singleton. </li><li>  If we use context variables, then <code>NSStackBlock</code> is created, which is no longer a singleton but resides on the stack. </li><li>  If we use the <code>Block_copy</code> function, or we want our block to be saved inside some object located in the heap, for example, as a property of the object: <code>@property (nonatomic, copy) MyBlockType myBlock;</code>  then an object of class <code>NSMallocBlock</code> is created that captures and captures (takes possession of == sends a <code>retain</code> message) objects passed in context.  This is a very important property, because it can lead to memory leaks if you are not careful about it.  Blocks can create cycles of ownership (retain cycle).  It is also important to note that if we use the value of a <code>property</code> in <code>NSMallocBlock</code> , the property itself does not retain, but the object to which the property belongs. </li></ol><br><br>  Here is an example of the ownership cycle: <br>  Suppose you want to create a class that makes an <code>HTTP</code> request with the asynchronous <code>API PKHTTPReuquest</code> <br><br><div class="spoiler">  <b class="spoiler_title">Implementing PKHTTPReuquest</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^PKHTTPRequestCompletionSuccessBlock)(<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *responseString); <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^PKHTTPRequestCompletionFailBlock)(<span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span>* error); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKRequest</span></span></span><span class="hljs-class"> &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class">&gt; - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">startRequest</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKHTTPRequest</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class"> &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKRequest</span></span></span><span class="hljs-class">&gt; // </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">designated</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initializer</span></span></span><span class="hljs-class"> - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initWithURL</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSURL</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">url</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">successBlock</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKHTTPRequestCompletionSuccessBlock</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">success</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">failBlock</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKHTTPRequestCompletionFailBlock</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fail</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKHTTPRequest</span></span></span><span class="hljs-class"> () &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSURLConnectionDelegate</span></span></span><span class="hljs-class">&gt; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">copy</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKHTTPRequestCompletionSuccessBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">succesBlock</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">copy</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKHTTPRequestCompletionFailBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">failBlock</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">retain</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSURL</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">url</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">retain</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSURLConnection</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">connection</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">retain</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSMutableData</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKHTTPRequest</span></span></span><span class="hljs-class"> #</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pragma</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mark</span></span></span><span class="hljs-class"> - </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialization</span></span></span><span class="hljs-class"> / </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">deallocation</span></span></span><span class="hljs-class"> // </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">designated</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initializer</span></span></span><span class="hljs-class"> - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initWithURL</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSURL</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">url</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">successBlock</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKHTTPRequestCompletionSuccessBlock</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">success</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">failBlock</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKHTTPRequestCompletionFailBlock</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fail</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> = [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> init]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> != <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.succesBlock = success; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.failBlock = fail; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.url = url; <span class="hljs-built_in"><span class="hljs-built_in">NSURLRequest</span></span> *request = [<span class="hljs-built_in"><span class="hljs-built_in">NSURLRequest</span></span> requestWithURL:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.url]; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.connection = [[[<span class="hljs-built_in"><span class="hljs-built_in">NSURLConnection</span></span> alloc] initWithRequest:request delegate:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> startImmediately:<span class="hljs-literal"><span class="hljs-literal">NO</span></span>] autorelease]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; } - (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)init { <span class="hljs-built_in"><span class="hljs-built_in">NSAssert</span></span>(<span class="hljs-literal"><span class="hljs-literal">NO</span></span>, <span class="hljs-string"><span class="hljs-string">@"Use desiganted initializer"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; } - (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)dealloc { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.succesBlock = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.failBlock = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.url = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.connection = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.data = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> dealloc]; } <span class="hljs-meta"><span class="hljs-meta">#pragma mark - public methods - (void)startRequest { self.data = [NSMutableData data]; [self.connection start]; } #pragma mark - NSURLConnectionDelegate implementation - (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data { [self.data appendData:data]; } - (void)connection:(NSURLConnection *)connection didFailWithError:(NSError *)error { self.failBlock(error); self.data = nil; } - (void)connectionDidFinishLoading:(NSURLConnection *)connection { self.succesBlock([NSString stringWithUTF8String:self.data.bytes]); self.data = nil; } @end</span></span></code> </pre><br><br></div></div><br>  And then you want to create a specific request for a specific API of your server <code>PKGetUserNameRequest</code> that works with <code>PKHTTPReuquest</code> <br><br><div class="spoiler">  <b class="spoiler_title">Implementing PKGetUserNameRequest</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^PKGetUserNameRequestCompletionSuccessBlock)(<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *userName); <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^PKGetUserNameRequestCompletionFailBlock)(<span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span>* error); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKGetUserNameRequest</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class"> &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKRequest</span></span></span><span class="hljs-class">&gt; - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initWithUserID</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">userID</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">successBlock</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKGetUserNameRequestCompletionSuccessBlock</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">success</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">failBlock</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKGetUserNameRequestCompletionFailBlock</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fail</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br><br><pre> <code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *kApiHost = <span class="hljs-string"><span class="hljs-string">@"http://someApiHost.com"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *kUserNameApiKey = <span class="hljs-string"><span class="hljs-string">@"username"</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKGetUserNameRequest</span></span></span><span class="hljs-class"> () @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">retain</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKHTTPRequest</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">httpRequest</span></span></span><span class="hljs-class">; - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">parseResponse</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">response</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKGetUserNameRequest</span></span></span><span class="hljs-class"> #</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pragma</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mark</span></span></span><span class="hljs-class"> - </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialization</span></span></span><span class="hljs-class"> / </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">deallocation</span></span></span><span class="hljs-class"> - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initWithUserID</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">userID</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">successBlock</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKGetUserNameRequestCompletionSuccessBlock</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">success</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">failBlock</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKGetUserNameRequestCompletionFailBlock</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fail</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> = [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> init]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> != <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *requestString = [kApiHost stringByAppendingFormat:<span class="hljs-string"><span class="hljs-string">@"?%@=%@"</span></span>, kUserNameApiKey, userID]; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.httpRequest = [[[PKHTTPRequest alloc] initWithURL:[<span class="hljs-built_in"><span class="hljs-built_in">NSURL</span></span> URLWithString:requestString] successBlock:^(<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *responseString) { <span class="hljs-comment"><span class="hljs-comment">//   -   self NSString *userName = [self parseResponse:responseString]; success(userName); } failBlock:^(NSError *error) { fail(error); } ] autorelease]; } return self; } - (id)init { NSAssert(NO, @"Use desiganted initializer"); return nil; } - (void)dealloc { self.httpRequest = nil; [super dealloc]; } #pragma mark - public methods - (void)startRequest { [self.httpRequest startRequest]; } #pragma mark - private methods - (NSString *)parseResponse:(NSString *)response { /* ...... */ return userName; } @end</span></span></code> </pre><br></div></div><br><br>  Error in this line <code>NSString *userName = [self parseResponse:responseString];</code>  - when we call something on self in the Malloc block, self retains, the following cycle is formed in the ownership graph: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c3/36b/9a32c336b6fb4bcc8d3170b17f547a9e.png"><br><br>  This could be avoided by creating on the stack an intermediate pointer to self with the __block modifier, like this: <br><br><div class="spoiler">  <b class="spoiler_title">An example of a break in the ownership cycle</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">//    __block PKGetUserNameRequest *selfRequest = self; self.httpRequest = [[[PKHTTPRequest alloc] initWithURL:[NSURL URLWithString:requestString] successBlock:^(NSString *responseString) { NSString *userName = [selfRequest parseResponse:responseString]; success(userName); } failBlock:^(NSError *error) { fail(error); } ] autorelease];</span></span></code> </pre><br></div></div><br>  Alternatively, it was possible to transfer blocks from the initialization method signature to the <code>startRequest</code> method, <br>  <code>startRequestwithCompaltion:fail:</code> and re-run blocks only for the duration of the request.  Then it would be possible to do without the <code>__block</code> modifier.  This would solve another problem: in the example above, there is a danger that by the time the block is called (by the time the request is completed) the PKGetUserNameRequest object will no longer exist (the dealloc method will be called), since the block provides a weak link.  And according to the <code>selfRequest</code> pointer, <code>selfRequest</code> will hang, which will cause a crash. <br><br>  Let's give another example of incorrect memory management with blocks, an example is taken from the <a href="http://www.youtube.com/watch%3Fv%3DSKot4tfsV24%26feature%3Dem-uploademail">lecture video [7]</a> <br><br><div class="spoiler">  <b class="spoiler_title">Error with NSStackBlock</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> addBlockToArray(<span class="hljs-built_in"><span class="hljs-built_in">NSMutableArray</span></span>* array) { <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *string = <span class="hljs-string"><span class="hljs-string">@"example string"</span></span>; [array addObject:^{ printf(<span class="hljs-string"><span class="hljs-string">"%@\n"</span></span>, string); }]; } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> example() { <span class="hljs-built_in"><span class="hljs-built_in">NSMutableArray</span></span> *array = [<span class="hljs-built_in"><span class="hljs-built_in">NSMutableArray</span></span> array]; addBlockToArray(array); <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^block)() = [array objectAtIndex:<span class="hljs-number"><span class="hljs-number">0</span></span>]; block(); }</code> </pre><br></div></div><br>  If we copied the block into a heap and passed it up the stack, there would be no error. <br>  Also, this example will not cause errors in the ARC code. <br><br><h5>  C ++ lambda </h5><br>  Implementation lambd in runtime, can be specific in different compilers.  They say that memory management for lambda is not very described in the standard.  <a href="http://stackoverflow.com/questions/20313847/c-lambda-implementation-in-runtime">[9]</a> <br>  Consider the common implementation. <br>  Lambda in C ++ are objects of unknown type created on the stack. <br>  Lambdas that capture no context can be cast to a function pointer, but this does not mean that they themselves are simply function pointers.  Lambda is a normal object, with a constructor and destructor, standing out on the stack. <br><br>  Let's give some examples of moving lambda in heap <br><div class="spoiler">  <b class="spoiler_title">Example of moving lambda in heap</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  ‚Ññ1 auto lamb = []() {return 5;}; auto func_lamb_ptr = new std::function&lt;int()&gt;(lamb); //  ‚Ññ2: auto lamb = []() {return 5;}; auto* p = new decltype(lamb)(lamb); //  ‚Ññ3: template &lt;typename T&gt; T* heap_alloc(T const&amp; value) { return new T(value); } auto* p = heap_alloc([]() {return 5;}); //  ‚Ññ4: std::vector&lt;decltype(lamb)&gt; v; v.push_back(lamb);</span></span></code> </pre><br></div></div><br>  Now you can pass the function to a member variable of an object. <br><br>  <b>mutable</b> after declaring lambda arguments says that you can change the values ‚Äã‚Äãof copies of variables captured by value (The value of the original variable will not change).  For example, if we defined a lambda like this: <code>auto lambda = [multiplier](int num) throw() mutable</code> we could change the value of the <code>multiplier</code> inside the lambda, but the multipler declared in the function would not change.  Moreover, the modified <code>multiplier</code> value is retained from the call to the call of this instance of lambda.  You can think of it this way: in the lambda instance (in the object), variable members are created corresponding to the passed parameters.  Here you need to be careful, because if we copy a copy of the lambda and call it, then these member variables will not change in the original lambda, they will change only in the copied one.  Sometimes you need to pass the lambda wrapped in <a href="http://en.cppreference.com/w/cpp/utility/functional/ref"><code>std::ref</code></a> .  Obj-C blocks do not provide such an opportunity out of the box. <br><br><a name="ObjCpp"></a><br><h4>  Objective-C ++ </h4><br>  Since Objecitve-C ++ combines both Objective-C and C ++, you can use lambda and blocks in it at the same time.  How do lambda and blocks relate to each other? <br><br><ol><li>  We can assign lambda to the block. <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^block_example)(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>); auto lambda_example = [](<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> number){number++; <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"%d"</span></span>, number);}; block_example = lambda_example; block_example(<span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-comment"><span class="hljs-comment">// log 11</span></span></code> </pre><br></div></div><br></li><li>  We can assign block std :: function <br><br>  Here it is worth noting that Objective-C and C ++ have different memory management policies, and storing a block in <code>std::function</code> can lead to hanging links. <br><br></li><li>  We can not assign a lambda block. <br><br>  The lambda has no copy-assignment operator defined.  Therefore, we can not assign her a block or even herself. <br><div class="spoiler">  <b class="spoiler_title">Assignment error</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> lambda1 = []() -&gt; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"Lambda 1!\n"</span></span>); }; lambda1 = lambda1; <span class="hljs-comment"><span class="hljs-comment">// error: use of deleted function 'main()::&lt;lambda()&gt;&amp; main()::&lt;lambda()&gt;::operator=(const main()::&lt;lambda()&gt;&amp;)' return 0; }</span></span></code> </pre><br></div></div><br></li></ol><br>  It should be said that the operations between lambdas and blocks are quite exotic, for example, I have never met such assignments in projects. <br><br><h4>  Related Links </h4><br><ol><li>  <a href="http://habrahabr.ru/post/66021/">About lambdas C ++</a> <br></li><li>  <a href="http://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B0%25D0%25BC%25D1%258B%25D0%25BA%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_(%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5)">Closures</a> <br></li><li>  <a href="https://developer.apple.com/library/ios/documentation/cocoa/Conceptual/Blocks/Articles/00_Introduction.html">About Apple Blocks</a> <br></li><li>  <a href="http://www.mikeash.com/pyblog/friday-qa-2011-06-03-objective-c-blocks-vs-c0x-lambdas-fight.html">Comparison of lambda and blocks in English</a> <br></li><li>  <a href="http://ru.cppreference.com/w/cpp/language/lambda">Docks C ++ lambda</a> <br></li><li>  <a href="http://habrahabr.ru/post/119877/">About blocks</a> <br></li><li>  <a href="http://www.youtube.com/watch%3Fv%3DSKot4tfsV24%26feature%3Dem-uploademail">Great video about blocks</a> <br></li><li>  <a href="http://stackoverflow.com/questions/12202656/c11-lambda-implementation-and-memory-model%3Frq%3D1">Question about organizing C ++ lambda memory on stackoverflow.com</a> <br></li><li>  <a href="http://stackoverflow.com/questions/20313847/c-lambda-implementation-in-runtime">Question about C ++ lambda implementation at runtime</a> <br></li><li>  <a href="http://stackoverflow.com/questions/11669292/objective-c-11-why-cant-we-assign-a-block-to-a-lambda">On the interaction of lambda and blocks</a> <br></li><li>  <a href="http://msdn.microsoft.com/en-us/library/vstudio/dd293603.aspx">Lambda syntax</a> <br></li><li>  <a href="http://touchdev.ru/documents/963">About Objective-C and C ++ Interaction</a> <br></li><li>  <a href="http://habrahabr.ru/post/137469/">Ways to embed C ++ in Objective-C projects</a> <br></li></ol></div><p>Source: <a href="https://habr.com/ru/post/204356/">https://habr.com/ru/post/204356/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../204330/index.html">Half a kilometer rechargeable lantern</a></li>
<li><a href="../204338/index.html">We program under Pebble. Lesson One: Stupid Watches</a></li>
<li><a href="../204342/index.html">How are we trying to sell PVS-Studio to Google or the next mistakes in Chromium?</a></li>
<li><a href="../204344/index.html">The digest of news from the world of mobile development for the last week No. 32 (November 25 ‚Äî December 1, 2013)</a></li>
<li><a href="../204350/index.html">Infinite scrolling in web applications with examples on AngularJS</a></li>
<li><a href="../204362/index.html">Microsoft warns of operating CVE-2013-5065 ITW</a></li>
<li><a href="../204364/index.html">Thinkspace: Zuckerberg Factory</a></li>
<li><a href="../204368/index.html">Tube Linux-like terminal in Windows</a></li>
<li><a href="../204370/index.html">LTE in Moscow</a></li>
<li><a href="../204372/index.html">Yandex Linguistics API for .NET</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>