<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We built RecyclerView in CardView</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After reading the post on Habr√© about new widgets ¬´RecyclerView and CardView. New Widgets in Android L , I decided to try using. There are many exampl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We built RecyclerView in CardView</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/88f/95f/875/88f95f8754a84515b51207651b02944e.gif"><br><br>  After reading the post on Habr√© about new widgets <a href="http://habrahabr.ru/post/237101/">¬´RecyclerView and CardView.</a>  <a href="http://habrahabr.ru/post/237101/">New Widgets in Android L</a> , I decided to try using.  There are many examples on the web where CardView is embedded in RecyclerView.  It was interesting to integrate the RecyclerView into CardView.  To even this design was a fragment. <br><a name="habracut"></a><br>  I downloaded an example from the article.  Immediately there was a problem when deleting several items.  Having looked at the code, I put the check: <br><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Record record)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> position = records.indexOf(record); Log.i(<span class="hljs-string"><span class="hljs-string">"&gt;"</span></span> , <span class="hljs-string"><span class="hljs-string">"position="</span></span> + position); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( position != -<span class="hljs-number"><span class="hljs-number">1</span></span> ) { records.remove(position); notifyItemRemoved(position); } }</code> </pre> <br>  This was only the beginning ... After adding the fragment, another problem emerged.  CardView cannot correctly ‚Äúwrap‚Äù a list of RecyclerViews in height.  wrap_content does not help.  It turned out that many have already encountered and there are solutions: <a href="http://stackoverflow.com/questions/26649406/nested-recycler-view-height-doesnt-wrap-its-content">"Nested Recycler view height doesn't wrap its content</a> . <a href="http://stackoverflow.com/questions/26649406/nested-recycler-view-height-doesnt-wrap-its-content">"</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First, looking at <a href="https://www.grokkingandroid.com/first-glance-androids-recyclerview/">A First Glance at Android's RecyclerView</a> thought of using the methods layoutManager.getDecoratedMeasuredHeight () ... and the like, but that did not help.  Sizes returned 0. <br>  I had to rewrite onMeasure in LinearLayoutManager.  Taken from stackoverflow: <br><br><div class="spoiler">  <b class="spoiler_title">MyLinearLayoutManager</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyLinearLayoutManager</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LinearLayoutManager</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyLinearLayoutManager</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> orientation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reverseLayout)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context, orientation, reverseLayout); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyLinearLayoutManager</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] mMeasuredDimension = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[<span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMeasure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.Recycler recycler, RecyclerView.State state, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> widthSpec, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> heightSpec)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> widthMode = View.MeasureSpec.getMode(widthSpec); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> heightMode = View.MeasureSpec.getMode(heightSpec); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> widthSize = View.MeasureSpec.getSize(widthSpec); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> heightSize = View.MeasureSpec.getSize(heightSpec); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> width = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> height = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; getItemCount(); i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getOrientation() == HORIZONTAL) { measureScrapChild(recycler, i, View.MeasureSpec.makeMeasureSpec(i, View.MeasureSpec.UNSPECIFIED), heightSpec, mMeasuredDimension); width = width + mMeasuredDimension[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i == <span class="hljs-number"><span class="hljs-number">0</span></span>) { height = mMeasuredDimension[<span class="hljs-number"><span class="hljs-number">1</span></span>]; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { measureScrapChild(recycler, i, widthSpec, View.MeasureSpec.makeMeasureSpec(i, View.MeasureSpec.UNSPECIFIED), mMeasuredDimension); height = height + mMeasuredDimension[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i == <span class="hljs-number"><span class="hljs-number">0</span></span>) { width = mMeasuredDimension[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } } } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (widthMode) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> View.MeasureSpec.EXACTLY: width = widthSize; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> View.MeasureSpec.AT_MOST: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> View.MeasureSpec.UNSPECIFIED: } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (heightMode) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> View.MeasureSpec.EXACTLY: height = heightSize; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> View.MeasureSpec.AT_MOST: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> View.MeasureSpec.UNSPECIFIED: } setMeasuredDimension(width, height); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">measureScrapChild</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.Recycler recycler, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> widthSpec, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> heightSpec, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] measuredDimension)</span></span></span><span class="hljs-function"> </span></span>{ View view = recycler.getViewForPosition(position); recycler.bindViewToPosition(view, position); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (view != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { RecyclerView.LayoutParams p = (RecyclerView.LayoutParams) view.getLayoutParams(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> childWidthSpec = ViewGroup.getChildMeasureSpec(widthSpec, getPaddingLeft() + getPaddingRight(), p.width); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> childHeightSpec = ViewGroup.getChildMeasureSpec(heightSpec, getPaddingTop() + getPaddingBottom(), p.height); view.measure(childWidthSpec, childHeightSpec); measuredDimension[<span class="hljs-number"><span class="hljs-number">0</span></span>] = view.getMeasuredWidth() + p.leftMargin + p.rightMargin; measuredDimension[<span class="hljs-number"><span class="hljs-number">1</span></span>] = view.getMeasuredHeight() + p.bottomMargin + p.topMargin; recycler.recycleView(view); } } }</code> </pre><br></div></div><br><br>  It worked.  Removal became possible only from the end.  Deletion from the middle or from the beginning of the list resulted in an exception: <br><br><pre> <code class="xml hljs">java.lang.IndexOutOfBoundsException: Inconsistency detected. Invalid item position 3(offset:-1).state:5</code> </pre><br>  Strange.  Googling a bit more, I came across similar problems for the people <a href="https://github.com/lucasr/twoway-view/issues/134">IndexOutOfBoundsException Invalid item position XX (XX).</a>  <a href="https://github.com/lucasr/twoway-view/issues/134">Item count: XX # 134</a> .  After watching the whole topic read: <br><br>  It is indeed a bug. <br><br>  For more information check: <br>  <a href="https://code.google.com/p/android/issues/detail%3Fid%3D77846">code.google.com/p/android/issues/detail?id=77846</a> <br>  <a href="https://code.google.com/p/android/issues/detail%3Fid%3D77232">code.google.com/p/android/issues/detail?id=77232</a> <br><br>  And the line above was just the solution: <br><br>  <i>Now i am doing some dirty workaround like</i> <i><br></i>  <i>if (index == 0) {notifydatasetchange ();} else {notifyItemRemoved (index)}</i> <br><br>  More precisely, looking at how items are deleted, I realized that I need to replace notifyItemRemoved (index) with notifydatasetchange ().  With the addition of the same.  The solution is not optimal, but working and in the current implementation of the widget is probably the only one. <br><br>  Such a decision completely killed the animation.  There would be to finish the research ... <br><br>  As a result, the crash location was found in the overridden onMeasure () <br><pre> <code class="xml hljs">IndexOutOfBoundsException = java.lang.IndexOutOfBoundsException: Inconsistency detected. Invalid item position 0(offset:-1).state:7</code> </pre><br>  Further investigation of the RecyclerView code to somehow intercept the situation or request the offset in advance was unsuccessful.  Made a hard hack!  Do not judge strictly) <br><pre> <code class="java hljs">View view = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { view = recycler.getViewForPosition(position); }<span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IndexOutOfBoundsException ex){ Log.i(<span class="hljs-string"><span class="hljs-string">"&gt;"</span></span>, <span class="hljs-string"><span class="hljs-string">"IndexOutOfBoundsException = "</span></span> + ex + <span class="hljs-string"><span class="hljs-string">"position : "</span></span> + position); }</code> </pre><br><br>  Now the animation has appeared, but after the first addition (initialization) the list did not appear.  Although the elements were added and everything appeared after the next operation.  Made another hack in the method of adding items.  I hope it is clear what he is doing. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( adapter.getItemCount() == <span class="hljs-number"><span class="hljs-number">1</span></span> ) { adapter.notifyDataSetChanged(); }</code> </pre><br>  The article <a href="http://wiresareobsolete.com/2014/09/building-a-recyclerview-layoutmanager-part-1/">Building a RecyclerView LayoutManager - Part 1</a> has a solution to the seemingly whole problem, but it did not work for me.  Maybe the support library version needed to be updated or the SDK.  I do not know. <br>  <i>Overlay to get your LayoutManager to compile.</i>  <i>It is a straightforward implementation of the Recycler.</i>  <i>They get from getViewForPosition ()</i> <i><br></i> <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RecyclerView.<span class="hljs-function"><span class="hljs-function">LayoutParams </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateDefaultLayoutParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RecyclerView.LayoutParams( RecyclerView.LayoutParams.WRAP_CONTENT, RecyclerView.LayoutParams.WRAP_CONTENT); }</code> </pre><br><br>  As a result, we have a ‚Äúhacking‚Äù approach, which is worth using ... <br><br>  Although this PopUp widget can be useful for displaying messages from the program.  Instead of progress windows.  By timer, you can delete the top message after a certain time or by clicking on it immediately <br><br>  The result was a rounded list with a shadow and animation.  Correctly processed screen rotation.  Easily embedded in the application.  The only little thing.  After reordering the stack of fragments, when the user worked with the application, the window did not always appear.  Perhaps some kind of callback is not in the UI Thread ... The solution is to access the fragment through the Handler. <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Handler(Looper.getMainLooper()).post(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Runnable() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mOverlayMessageFragment.addMessage(text); } });</code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Communicating with the UI Thread</b> <div class="spoiler_text">  UI objects such as View objects;  this thread is called the UI thread.  Only objects are running.  Because you aren‚Äôt running, you don‚Äôt have access to objects.  To use the UI thread, it is running on the UI thread. <br>  <a href="https://developer.android.com/training/multiple-threads/communicate-ui.html">developer.android.com/training/multiple-threads/communicate-ui.html</a> <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Communicating with Other Fragments</b> <div class="spoiler_text">  For example, you will want to use it.  All Fragment-to-Fragment communication is done through the associated Activity.  Two Fragments should never communicate directly. <br>  <a href="http://developer.android.com/training/basics/fragments/communicating.html">developer.android.com/training/basics/fragments/communicating.html</a> <br></div></div><br><br>  And another useful feature for the fragment: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); <span class="hljs-comment"><span class="hljs-comment">// keep the fragment and all its data across screen rotation setRetainInstance(true); }</span></span></code> </pre><br>  Code changes are listed below: <br><br><div class="spoiler">  <b class="spoiler_title">PopUpFragment.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> net.appz.iconfounder.popupwidget.fragment; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.Activity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Handler; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Message; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.support.v4.app.Fragment; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.support.v7.widget.CardView; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.support.v7.widget.DefaultItemAnimator; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.support.v7.widget.LinearLayoutManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.support.v7.widget.RecyclerView; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Log; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.LayoutInflater; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.ViewGroup; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> net.appz.iconfounder.R; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> net.appz.iconfounder.popupwidget.adapter.RecyclerViewAdapter; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> net.appz.iconfounder.popupwidget.model.Record; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.ArrayList; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.List; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PopUpFragment</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Fragment</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String ARG_TIMER_INTERVAL = <span class="hljs-string"><span class="hljs-string">"timer_interval"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> OnFragmentInteractionListener mListener; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> HandlerPopUpMessages messageHandler; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TIMER_INTERVAL_DEFAULT = <span class="hljs-number"><span class="hljs-number">2000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> timer_interval; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> RecyclerViewAdapter adapter; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CardView cardView; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> RecyclerView recyclerView; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Record&gt; records = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;Record&gt;(); <span class="hljs-comment"><span class="hljs-comment">/** * Use this factory method to create a new instance of * this fragment using the provided parameters. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> timer_interval . * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> A new instance of fragment PopUpFragment. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> PopUpFragment </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newInstance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> timer_interval)</span></span></span><span class="hljs-function"> </span></span>{ PopUpFragment fragment = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PopUpFragment(); Bundle args = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bundle(); args.putInt(ARG_TIMER_INTERVAL, timer_interval); fragment.setArguments(args); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fragment; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> PopUpFragment </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newInstance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ PopUpFragment fragment = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PopUpFragment(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fragment; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PopUpFragment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Required empty public constructor } @Override public void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); if (getArguments() != null) { timer_interval = getArguments().getInt(ARG_TIMER_INTERVAL); } else { timer_interval = TIMER_INTERVAL_DEFAULT; } // keep the fragment and all its data across screen rotation //setRetainInstance(true); messageHandler = new HandlerPopUpMessages(this); if (savedInstanceState != null) { records = savedInstanceState.getParcelableArrayList(PopUpFragment.class.getSimpleName()); } } @Override public void onSaveInstanceState(Bundle outState) { outState.putParcelableArrayList( PopUpFragment.class.getSimpleName(), (java.util.ArrayList&lt;? extends android.os.Parcelable&gt;) records); super.onSaveInstanceState(outState); } Handler timerHandler = new Handler(); Runnable timerRunnable = new Runnable() { @Override public void run() { if (adapter.getItemCount() &gt; 0) { Record record = adapter.getRecords().get(0); long ts = record.getTimestamp(); if (ts &lt; System.currentTimeMillis() - timer_interval){ if (adapter.getItemCount() &gt; 1){ record = adapter.getRecords().get(1); record.setTimestamp(System.currentTimeMillis()); } removeMessagePopUp(); } } timerHandler.postDelayed(this, timer_interval); } }; @Override public void onPause() { super.onPause(); timerHandler.removeCallbacks(timerRunnable); } @Override public void onResume() { super.onResume(); timerHandler.postDelayed(timerRunnable, timer_interval); if ( adapter.getItemCount() == 0 ) { cardView.setVisibility(View.GONE); mListener.onHidePopUpFrugment(); } } @Override public void onStart() { super.onStart(); mListener.onPopUpFragmentStart(); } @Override public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) { // Inflate the layout for this fragment View view = inflater.inflate(R.layout.fragment_popup, container, false); recyclerView = (RecyclerView)view.findViewById(R.id.recyclerView); // recyclerView.setHasFixedSize(true); adapter = new RecyclerViewAdapter(records); LinearLayoutManager layoutManager = new MyLinearLayoutManager(getActivity()); RecyclerView.ItemAnimator itemAnimator = new DefaultItemAnimator(); recyclerView.setAdapter(adapter); recyclerView.setLayoutManager(layoutManager); recyclerView.setItemAnimator(itemAnimator); cardView = (CardView)view.findViewById(R.id.cardView); return view; } public void addMessage0ToPopUp(int type, String text){ Bundle msgBundle = new Bundle(); msgBundle.putInt(HandlerPopUpMessages.ICON_ARG, type); msgBundle.putString(HandlerPopUpMessages.TEXT_ARG, text); Message msg = new Message(); msg.what = HandlerPopUpMessages.ADD_MESSAGE; msg.setData(msgBundle); messageHandler.sendMessage(msg); } public void removeMessagePopUp() { Bundle msgBundle = new Bundle(); Message msg = new Message(); msg.what = HandlerPopUpMessages.REMOVE_MESSAGE_0; msg.setData(msgBundle); messageHandler.sendMessage(msg); } private void addMessageInternal(int type, String text) { Record record = new Record(); record.setName(text); record.setType(Record.Type.values()[type]); record.setTimestamp(System.currentTimeMillis()); adapter.getRecords().add(record); adapter.notifyItemInserted(adapter.getItemCount()-1); //adapter.notifyDataSetChanged(); // Bellow there is hack. First show RecyclerView if ( adapter.getItemCount() == 1 ) { adapter.notifyDataSetChanged(); } if ( adapter.getItemCount() &gt; 0 ) { cardView.setVisibility(View.VISIBLE); mListener.onShowPopUpFrugment(); } } private void removeMessage0Internal(){ if ( adapter.getItemCount() &gt; 0 ) { adapter.getRecords().remove(0); adapter.notifyItemRemoved(0); //adapter.notifyDataSetChanged(); } if ( adapter.getItemCount() == 0 ) { cardView.setVisibility(View.GONE); mListener.onHidePopUpFrugment(); } } @Override public void onAttach(Activity activity) { super.onAttach(activity); try { mListener = (OnFragmentInteractionListener) activity; } catch (ClassCastException e) { throw new ClassCastException(activity.toString() + " must implement OnFragmentInteractionListener"); } } @Override public void onDetach() { super.onDetach(); mListener = null; messageHandler.removeCallbacksAndMessages(null); } /** * This interface must be implemented by activities that contain this * fragment to allow an interaction in this fragment to be communicated * to the activity and potentially other fragments contained in that * activity. * &lt;p/&gt; * See the Android Training lesson &lt;a href= * "http://developer.android.com/training/basics/fragments/communicating.html" * &gt;Communicating with Other Fragments&lt;/a&gt; for more information. */ public interface OnFragmentInteractionListener { void onPopUpFragmentStart(); void onHidePopUpFrugment(); void onShowPopUpFrugment(); } public class MyLinearLayoutManager extends LinearLayoutManager { public MyLinearLayoutManager(Context context) { super(context); } // Not worked @Override public RecyclerView.LayoutParams generateDefaultLayoutParams() { return new RecyclerView.LayoutParams( RecyclerView.LayoutParams.WRAP_CONTENT, RecyclerView.LayoutParams.WRAP_CONTENT); } // Not worked @Override public boolean canScrollVertically() { //We do allow scrolling return true; } private int[] mMeasuredDimension = new int[2]; @Override public void onMeasure(RecyclerView.Recycler recycler, RecyclerView.State state, int widthSpec, int heightSpec) { Log.i("&gt;", "state " + state.toString()); //if ( state.isPreLayout() ) { // super.onMeasure(recycler, state, widthSpec, heightSpec); //} else { final int widthMode = View.MeasureSpec.getMode(widthSpec); final int heightMode = View.MeasureSpec.getMode(heightSpec); final int widthSize = View.MeasureSpec.getSize(widthSpec); final int heightSize = View.MeasureSpec.getSize(heightSpec); int width = 0; int height = 0; for (int i = 0; i &lt; getItemCount(); i++) { if (getOrientation() == HORIZONTAL) { measureScrapChild(recycler, i, View.MeasureSpec.makeMeasureSpec(i, View.MeasureSpec.UNSPECIFIED), heightSpec, mMeasuredDimension); width = width + mMeasuredDimension[0]; if (i == 0) { height = mMeasuredDimension[1]; } } else { measureScrapChild(recycler, i, widthSpec, View.MeasureSpec.makeMeasureSpec(i, View.MeasureSpec.UNSPECIFIED), mMeasuredDimension); height = height + mMeasuredDimension[1]; if (i == 0) { width = mMeasuredDimension[0]; } } } switch (widthMode) { case View.MeasureSpec.EXACTLY: width = widthSize; case View.MeasureSpec.AT_MOST: case View.MeasureSpec.UNSPECIFIED: } switch (heightMode) { case View.MeasureSpec.EXACTLY: height = heightSize; case View.MeasureSpec.AT_MOST: case View.MeasureSpec.UNSPECIFIED: } setMeasuredDimension(width, height); } } private void measureScrapChild(RecyclerView.Recycler recycler, int position, int widthSpec, int heightSpec, int[] measuredDimension) { View view = null; // Bellow there is strong hack! try { view = recycler.getViewForPosition(position); }catch (IndexOutOfBoundsException ex){ Log.i("&gt;", "IndexOutOfBoundsException = " + ex + "position : " + position); } if (view != null) { // For adding Item Decor Insets to view //super.measureChildWithMargins(view, 0, 0); //recycler.bindViewToPosition(view, position); RecyclerView.LayoutParams p = (RecyclerView.LayoutParams) view.getLayoutParams(); int childWidthSpec = ViewGroup.getChildMeasureSpec(widthSpec, getPaddingLeft() + getPaddingRight(), p.width); int childHeightSpec = ViewGroup.getChildMeasureSpec(heightSpec, getPaddingTop() + getPaddingBottom(), p.height); view.measure(childWidthSpec, childHeightSpec); measuredDimension[0] = view.getMeasuredWidth() + p.leftMargin + p.rightMargin; measuredDimension[1] = view.getMeasuredHeight() + p.bottomMargin + p.topMargin; recycler.recycleView(view); } } } private class HandlerPopUpMessages &lt;T&gt; extends Handler { public static final int ADD_MESSAGE = 100; public static final int REMOVE_MESSAGE_0 = 101; public static final String TEXT_ARG = "text"; public static final String ICON_ARG = "icon"; private final T fragment; public HandlerPopUpMessages(T fragment ){ this.fragment = fragment; } @Override public void handleMessage(Message message){ if (this.fragment != null){ Bundle b = message.getData(); switch (message.what){ case ADD_MESSAGE: if(b == null) new IllegalArgumentException("Message should be have params !"); String text = b.getString(TEXT_ARG); int type = b.getInt(ICON_ARG); ((PopUpFragment)fragment).addMessageInternal(type, text); break; case REMOVE_MESSAGE_0: ((PopUpFragment)fragment).removeMessage0Internal(); break; } } } } }</span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Layout</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:tools</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/tools"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:card_view</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".PopUpFragment"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.v7.widget.CardView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/cardView"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">card_view:cardCornerRadius</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"6dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">card_view:cardBackgroundColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#84ffff"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.v7.widget.RecyclerView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"400dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/recyclerView"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.v7.widget.CardView</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">MainActivity.java</b> <div class="spoiler_text"><pre> <code class="java hljs">... mPopupWidget = (PopUpFragment) getSupportFragmentManager().findFragmentById(R.id.popup); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (DEBUG) Log.d(TAG, <span class="hljs-string"><span class="hljs-string">"onCreate() : mPopupWidget = "</span></span> + mPopupWidget); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( mPopupWidget == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ){ getSupportFragmentManager().beginTransaction() .replace(R.id.popup, PopUpFragment.newInstance(), PopUpFragment.class.getSimpleName()) .commit(); } ...</code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">RecyclerViewAdapter</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.renal128.demo.recyclerviewdemo.adapter; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.support.v7.widget.RecyclerView; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Log; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.LayoutInflater; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.ViewGroup; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Button; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.ImageView; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.TextView; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.renal128.demo.recyclerviewdemo.R; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.renal128.demo.recyclerviewdemo.model.Record; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.List; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerViewAdapter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Adapter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerViewAdapter</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Record&gt; records; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RecyclerViewAdapter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;Record&gt; records)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.records = records; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Record&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRecords</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> records; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewGroup viewGroup, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i)</span></span></span><span class="hljs-function"> </span></span>{ View v = LayoutInflater.from(viewGroup.getContext()).inflate(R.layout.recyclerview_item, viewGroup, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewHolder(v); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewHolder viewHolder, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i)</span></span></span><span class="hljs-function"> </span></span>{ Record record = records.get(i); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> iconResourceId = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (record.getType()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> GREEN: iconResourceId = R.drawable.green_circle; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RED: iconResourceId = R.drawable.red_circle; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> YELLOW: iconResourceId = R.drawable.yellow_circle; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } viewHolder.icon.setImageResource(iconResourceId); viewHolder.name.setText(record.getName()); viewHolder.deleteButtonListener.setRecord(record); viewHolder.copyButtonListener.setRecord(record); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItemCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> records.size(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Record record)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> position = records.indexOf(record); Record copy = record.copy(); records.add(position + <span class="hljs-number"><span class="hljs-number">1</span></span>, copy); <span class="hljs-comment"><span class="hljs-comment">//notifyItemInserted(position + 1); notifyDataSetChanged(); } private void delete(Record record) { int position = records.indexOf(record); Log.i("&gt;" , "position=" + position); if( position != -1 ) { records.remove(position); //notifyItemRemoved(position); notifyDataSetChanged(); } } class ViewHolder extends RecyclerView.ViewHolder { private TextView name; private ImageView icon; private Button deleteButton; private Button copyButton; private DeleteButtonListener deleteButtonListener; private CopyButtonListener copyButtonListener; public ViewHolder(View itemView) { super(itemView); name = (TextView) itemView.findViewById(R.id.recyclerViewItemName); icon = (ImageView) itemView.findViewById(R.id.recyclerViewItemIcon); deleteButton = (Button) itemView.findViewById(R.id.recyclerViewItemDeleteButton); copyButton = (Button) itemView.findViewById(R.id.recyclerViewItemCopyButton); deleteButtonListener = new DeleteButtonListener(); copyButtonListener = new CopyButtonListener(); deleteButton.setOnClickListener(deleteButtonListener); copyButton.setOnClickListener(copyButtonListener); } } private class CopyButtonListener implements View.OnClickListener { private Record record; @Override public void onClick(View v) { copy(record); } public void setRecord(Record record) { this.record = record; } } private class DeleteButtonListener implements View.OnClickListener { private Record record; @Override public void onClick(View v) { delete(record); } public void setRecord(Record record) { this.record = record; } } }</span></span></code> </pre><br></div></div><br>  The original code was taken here: <a href="https://github.com/renal128/RecyclerViewDemo">github.com/renal128/RecyclerViewDemo</a> <br><br>  Implementing with Handler's and Timer's: <a href="https://github.com/app-z/PopUpWidget">github.com/app-z/PopUpWidget</a> <br><br>  See how it works from Google Play: <a href="https://play.google.com/store/apps/details%3Fid%3Dnet.appz.iconfounder">play.google.com/store/apps/details?id=net.appz.iconfounder</a> </div><p>Source: <a href="https://habr.com/ru/post/255397/">https://habr.com/ru/post/255397/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255383/index.html">ThinkPHP Conference Announcement</a></li>
<li><a href="../255387/index.html">Application of parallel algorithms in the 1C Enterprise environment</a></li>
<li><a href="../255389/index.html">Exploring JavaScript Symbols. Use of symbols</a></li>
<li><a href="../255391/index.html">Ubiquiti EdgeRouter X</a></li>
<li><a href="../255393/index.html">We invite students to Imagine Day: April 18 in Moscow</a></li>
<li><a href="../255399/index.html">Binary serialization in Unity3d</a></li>
<li><a href="../255403/index.html">Version Control for Designers</a></li>
<li><a href="../255405/index.html">ThinkServer RD650: Anatomy of a New Generation Server from Lenovo</a></li>
<li><a href="../255407/index.html">Real-world tasks: how in practice do systems consider reliability (reliability, MTTF, failure rate)?</a></li>
<li><a href="../255409/index.html">Backup and Restore Virtualized Microsoft Exchange Using Veeam Backup & Replication</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>