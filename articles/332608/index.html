<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to create a vegetation billboard texture in Unreal Engine 4</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article we will talk about how to create a billboard texture of vegetation in the Unreal Engine 4. Such vegetation is a simple multiply multip...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to create a vegetation billboard texture in Unreal Engine 4</h1><div class="post__text post__text-html js-mediator-article">  In this article we will talk about how to create a billboard texture of vegetation in the Unreal Engine 4. Such vegetation is a simple multiply multiplied quadrangle, all copies of which are always turned towards the camera.  I will try to argue in favor of this approach, talk about potential shortcomings and separately address the issue of performance. <br><br><img src="https://habrastorage.org/web/8c8/02b/8ca/8c802b8ca3c74d6aa0291747b053501b.jpg"><br><a name="habracut"></a><br><h3>  Vegetation in the Unreal Engine 4 </h3><br>  In Unreal Engine 4, by default, there is a built-in tool for working with vegetation called the Foliage tool.  It adds cloned static meshes (more generally, skeleton-free models).  Each asset with vegetation can be added to the map thousands of times with different settings of rotation, location, etc. for all instances. <br><br>  With relatively small (up to 10,000 copies) and simple (less than 100 polygons) assets, everything will work fine even with shade and good lighting of plants.  But you need to intelligently adjust the clipping distance so that the graphics hardware does not attempt to display all 10,000 copies at once. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      However, for relatively large clusters of vegetation (for example, whole forests) this can be a problem. <br><br>  Consider an example from my game.  In the north of the map is a large forest, the player can enter it from the south.  All that is outside the southern side of the forest is a non-game zone.  But it still needs to be rendered to give the player the impression of a vast and immense forest. <br><br>  If we decided to render the whole forest, even using low poly models of trees, this would lower the performance on weak computers. <br><br>  In this case billboards come to the rescue. <br><br><h3>  Is billboard advertising? </h3><br>  Unreal Engine 4 in the basic configuration supports the <a href="https://docs.unrealengine.com/latest/INT/Engine/Components/Rendering/index.html">Billboard Material Component</a> .  It is well suited for working with single or few meshes in a level, as shown in the example above.  Unfortunately, it cannot be used for the Foliage tool, which only supports the placement of static meshes.  To use the Billboard Component, it must be inside the Actor class, which is not supported by this tool. <br><br>  You need to make your own Billboard Material.  How to do this can be found in the documentation link <a href="https://docs.unrealengine.com/latest/INT/Resources/Showcases/Stylized/Materials/index.html">here</a> in the section on stylized rendering (some do not immediately find the necessary information, therefore I recommend reading it more carefully). <br><br>  I will not retell this document.  In return, I will add a screenshot of my material created from the documentation and tell you how to use it in the game. <br><br>  To get started, import simple 2D textures that will act as a sprite with a billboard.  To this end, I made screenshots of the tree model on a transparent background.  When viewed from a certain distance, they are very similar to high-poly models. <br><br>  It is important to leave a little variety: I created 4 variants of one tree so that the models did not look the same. <br><br><img src="https://habrastorage.org/web/4ab/d10/264/4abd102647d64e28b5a9df1c114cf719.png"><br><h3>  Material preparation </h3><br>  The next step is to create a material that will be responsible for ensuring that the vertices of the static mesh are always facing the camera.  As a static mesh, take a quadrilateral formed by two triangles (more on that later). <br><br>  Go to the Content Browser panel, right-click and create a new Material. <br><br>  Select the following settings: <br><br><ul><li>  Blend Mode: Masked; </li><li>  Shading Model: Unlit; </li><li>  a checkmark in front of the Two Sided parameter. </li></ul><br><img src="https://habrastorage.org/web/037/67f/c45/03767fc4509e40489362e75c30af7cd9.png"><br><br>  You can then place the nodes on the graphic panel of the material.  Let's make some important clarifications.  The material adjusts the position of the vertices so that they are turned toward the camera.  Due to the nodes attached to the World Position Offset, the material adjusts the position of its vertices so that they are turned towards the camera. <br><br>  The 'Custom' node contains a special HLSL code inside the section responsible for billboard effects.  It is needed to calculate the correct rotation of the quadrilateral.  The parameters of this node look like this: opposite to 'Inputs', you need to select one value and name it 'In', and opposite to 'Output Type' CMOT Float 2. The documentation describes this differently, but there are incorrect names of the parameters: <br><br><pre><code class="hljs lua">float2 <span class="hljs-built_in"><span class="hljs-built_in">output</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">atan2</span></span> (In.y,In.x); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">output</span></span>);</code> </pre> <br>  The nodes attached to the PivotPosition are responsible for ensuring that the rectangle is transferred to three-dimensional space in accordance with the coordinates and rotates around the original point. <br><br>  But this material is not intended for direct use.  The texture has been converted to a Material Parameter that instances of the material will use. <br><br>  After saving the material, right-click on it in the Content Browser panel and make several copies.  Each of them must use the correct texture of your billboard.  So the code will not be duplicated, and resources will be spent more efficiently. <br><br><img src="https://habrastorage.org/web/89e/76f/414/89e76f4145e9462780b5c6e7d7321b0a.png"><br><br>  Having defined the material, we load a simple rectangle into the Unreal Engine 4 that will be used as a static mesh for the Foliage tool. <br><br><h3>  Creating and loading a mesh </h3><br>  For a billboard model, only a rectangle consisting of two triangles is needed.  Create such an asset using the Blender program or download the one that I used.  It is available for download <a href="https://docs.google.com/document/d/1TaYTYvzu6uyv_kMLNxkSXCbqJQyifpzcTGNgxW0IcZg/edit">at the link,</a> feel free to use it in any projects. <br><br>  When importing a triangle, you may have to adjust its translation and rotation so that it initially faces the camera and lies on the surface.  If this is not done, the material will turn sideways to the camera or turn upside down (or both at once) and it will be wrong to transfer its position to three-dimensional space.  As a result, the material will always be turned in the wrong direction. <br><br>  I used the following settings for the quad: <br><br><ul><li>  Roll: 270 degrees. </li><li>  Pitch: 180 degrees. </li><li>  Yaw: 0 degrees. </li><li>  Import Uniform Scale: Adjust according to the size of your map, the quadrilateral itself is large enough. </li><li>  Import translation, Z axis: Adjust according to the landscape.  I put on 190 units. </li></ul><br>  When the import is complete, give the quadrilateral a name (I called mine TreeBillboard_Quad_1) and assign the quadrilateral to the billboard material. <br><br>  Theoretically, we could already place a quad on a map and make sure that when the camera moves, it always turns towards the viewer.  But it would be wiser to drag this static mesh into the Foliage tool and work on its placement: <br><br><img src="https://habrastorage.org/web/c3d/cdb/5b7/c3dcdb5b79c7483396f827e56b05e25e.png"><br><br>  When adding a mesh to the Foliage tool, make sure that the Align to Normal and Random Yaw options are disabled: they rotate the mesh and violate the effect of the material. <br><br>  This mesh should always be located outside the playing area, where the player will not be able to approach or bypass it, otherwise the whole illusion will be broken and it will look, to put it mildly, bad. <br><br>  When you add a few thousand of these trees, you get a forest.  The quality of the result depends on the quality of the original textures: <br><br><img src="https://habrastorage.org/web/a39/241/a1b/a39241a1b7f7438386df4bdd5525ed98.png"><br><br><h3>  Appearance </h3><br>  Please note: in my game I use the low quality tree model - only this could be found in the public domain on the OpenGameArt website.  Again, the result depends on the quality and detail of the mesh used for creating images, as well as on the resolution of these images. <br><br>  Below are for comparison trees with shadows and lighting and simple unlit billboards: <br><br><img src="https://habrastorage.org/web/7a6/820/d38/7a6820d3828341cfa83e59f002c2782c.png"><br><br>  And then it shows what these trees look like in the resolution and size that is best suited for display.  The image shows both meshes (closer) and billboards (further).  At first glance, they are difficult to distinguish, and with better mesh and images, it will look even more impressive: <br><br><img src="https://habrastorage.org/web/819/495/08c/81949508c91e44e286965ab85d063be8.png"><br><br><h3>  Performance </h3><br>  Since we draw only 2 triangles for each tree, the performance with this approach is more than acceptable for modern computers.  I managed to fill the entire map with trees without noticeable performance degradation of the average video card (AMD R9 270X).  The method is also great for working with cane, grass or other small plants.  The player will not notice that they are flat, even if they come closer. <br><br>  It is not easy to apply lighting or shadow to billboards, so they do not have a shadow in my game. <br>  The player is unlikely to notice this from a long distance, but if he comes close enough, the lack will be revealed. <br><br>  True, the performance in this case is not ideal.  The 'Custom' node that we use for the material does not allow the engine to optimize the shader.  Now it does not matter, but you may be different.  If in doubt, use a profiler. <br><br><h3>  Alternatives </h3><br>  Another approach is to use low poly LOD chains, which are generated using tools like <a href="https://www.simplygon.com/">Simplygon</a> or <a href="http://www.meshlab.net/">Meshlab</a> .  Imposters can also <a href="https://answers.unrealengine.com/questions/179998/imposter-uvs-for-foliage.html">be used</a> as vegetation.  It is even better to combine 3 approaches using a high-poly tree model (for example, with speedtree.com) and the least detailed model in your LOD chain.  So you save resources.  When a tree is far away, it does not differ from a flat sprite in terms of detail and shadows.  Therefore, it is not necessary to draw it completely. <br><br><h3>  Conclusion </h3><br>  I hope this article will benefit your game and will allow you not to spend a fortune on expensive video cards.  There are many ways to render vegetation, and this is only one of them. </div><p>Source: <a href="https://habr.com/ru/post/332608/">https://habr.com/ru/post/332608/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../332596/index.html">We remove and deposit cash at an ATM using a smartphone. World's first</a></li>
<li><a href="../332598/index.html">What I learned by converting a project to Kotlin using Android Studio</a></li>
<li><a href="../332600/index.html">Tuning typical roles of Windows. Part One: Files and Printing</a></li>
<li><a href="../332602/index.html">Why mobile apps take up more space</a></li>
<li><a href="../332604/index.html">How to build a database for mailings and do not turn into a spammer?</a></li>
<li><a href="../332612/index.html">Seminar "Clouds and reality: cases, rakes, good news", July 13, St. Petersburg</a></li>
<li><a href="../332614/index.html">Backup LVM2 volumes with IO overload protection using SIGSTOP, SIGCONT signals</a></li>
<li><a href="../332616/index.html">Node.js platform will bypass Java for a year</a></li>
<li><a href="../332618/index.html">The method of recovering data from a disk encrypted with NotPetya using the Salsa20 algorithm</a></li>
<li><a href="../332620/index.html">Will Python save from execution?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>