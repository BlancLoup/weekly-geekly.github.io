<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Street magic in scripts or what connects Groovy, Ivy and Maven?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After suffering with debugging complex MVEL scripts + MavenClassloader, I discovered that the mechanism for dynamic dependency resolution is in Groovy...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Street magic in scripts or what connects Groovy, Ivy and Maven?</h1><div class="post__text post__text-html js-mediator-article">  After suffering with debugging complex MVEL scripts + MavenClassloader, I discovered that the mechanism for dynamic dependency resolution is in Groovy.  In addition, debugging Groovy scripts is possible in both Idea and Eclipse. <br><br><img src="https://habrastorage.org/files/3f0/ecd/0db/3f0ecd0dbafe402caa35b2a1a88ca7d3.jpg"><br><br>  You ask why you need dynamic dependency resolution?  Some things are easier to do, and some are only possible. <div class="spoiler">  <b class="spoiler_title">About it told and showed on examples in a cycle of publications on Habr√©</b> <div class="spoiler_text"><ul><li>  <a href="http://habrahabr.ru/post/268393/">We diagnose the cause, survive in JAR hell: do not breathe sulfur and do not cook in the boiler</a> </li><li>  <a href="http://habrahabr.ru/post/267009/">Publishing logs in Elasticsearch - life without regular expressions and without logstash</a> </li><li>  <a href="http://habrahabr.ru/post/266781/">Logging JDBC requests and their parameters in an existing application</a> </li><li>  <a href="http://habrahabr.ru/post/265741/">Habr shell: we build a cross-platform ssh server in java application</a> </li><li>  <a href="http://habrahabr.ru/post/264415/">Implementation of web consoles in the jvm process using the SonarQube example</a> </li><li>  <a href="http://habrahabr.ru/post/267223/">Report: "Aspect-oriented programming in distributed systems for java developers and QA"</a> </li><li>  <a href="http://habrahabr.ru/post/254571/">Files are different or the story about the "file" for java programs</a> </li></ul></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the post you will find a working solution for Groovy in the form of a single jar file and a class loader from the maven repositories for a Java application.  Learn about the features of the work of Grape "out of the box"  Not to be unfounded and the possibilities of the <a href="http://docs.groovy-lang.org/latest/html/documentation/grape.html">Grape</a> were clear ... <br><a name="habracut"></a><br>  I will give an example from the official manual: <br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Grapes</span></span>([ <span class="hljs-meta"><span class="hljs-meta">@Grab</span></span>(group=<span class="hljs-string"><span class="hljs-string">'org.eclipse.jetty.aggregate'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>=<span class="hljs-string"><span class="hljs-string">'jetty-server'</span></span>, version=<span class="hljs-string"><span class="hljs-string">'8.1.7.v20120910'</span></span>), <span class="hljs-meta"><span class="hljs-meta">@Grab</span></span>(group=<span class="hljs-string"><span class="hljs-string">'org.eclipse.jetty.aggregate'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>=<span class="hljs-string"><span class="hljs-string">'jetty-servlet'</span></span>, version=<span class="hljs-string"><span class="hljs-string">'8.1.7.v20120910'</span></span>), <span class="hljs-meta"><span class="hljs-meta">@Grab</span></span>(group=<span class="hljs-string"><span class="hljs-string">'javax.servlet'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>=<span class="hljs-string"><span class="hljs-string">'javax.servlet-api'</span></span>, version=<span class="hljs-string"><span class="hljs-string">'3.0.1'</span></span>)]) <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.jetty.server.Server <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.jetty.servlet.* <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.servlet.* <span class="hljs-function"><span class="hljs-function">def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runServer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(duration)</span></span></span><span class="hljs-function"> </span></span>{ def server = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Server(<span class="hljs-number"><span class="hljs-number">8080</span></span>) def context = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServletContextHandler(server, <span class="hljs-string"><span class="hljs-string">"/"</span></span>, ServletContextHandler.SESSIONS); context.resourceBase = <span class="hljs-string"><span class="hljs-string">"."</span></span> context.addServlet(TemplateServlet, <span class="hljs-string"><span class="hljs-string">"*.gsp"</span></span>) server.start() sleep duration server.stop() } runServer(<span class="hljs-number"><span class="hljs-number">10000</span></span>)</code> </pre> <br>  This script loads the artifacts of the jetty server from the remote repository, adds them to the classpath of the script, creates an instance of the http class of the server, adds a gsp page handler (this is a powerful template mechanism that is in the root), starts the server, waits 10 seconds and stops it.  Those.  at the time of writing the script, these dependencies are not needed, only access to the repositories is needed and the next time the dependencies are started, the jetty dependencies are already in the local file system and there is no need to download them from the network. <br><br>  For me, so ingenious mechanism built into the language itself !!! <br><br>  To run a script with a jetty server, you only need groovy and classes ivy provider in the classpath.  Classes runtime loads from the maven repository using ivy. <br><br>  In the wilds of the grove, a configuration is hidden that says dependencies must first be searched in the local file system $ {user.home} /. Groovy / grapes, then in $ {user.home} /. M2 / repository /, well, then try to find first in jcenter, then in ibiblio, and lastly search in java.net2 repositories <br><div class="spoiler">  <b class="spoiler_title">That same configuration</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ivysettings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">settings</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defaultResolver</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"downloadGrapes"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resolvers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">chain</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"downloadGrapes"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">returnFirst</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filesystem</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cachedGrapes"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ivy</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pattern</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${user.home}/.groovy/grapes/[organisation]/[module]/ivy-[revision].xml"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifact</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pattern</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${user.home}/.groovy/grapes/[organisation]/[module]/[type]s/[artifact]-[revision](-[classifier]).[ext]"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filesystem</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ibiblio</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"localm2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">root</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file:${user.home}/.m2/repository/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">checkmodified</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">changingPattern</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">changingMatcher</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"regexp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">m2compatible</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- todo add 'endorsed groovy extensions' resolver here --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ibiblio</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"jcenter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">root</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://jcenter.bintray.com/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">m2compatible</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ibiblio</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ibiblio"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">m2compatible</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ibiblio</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"java.net2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">root</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://download.java.net/maven/2/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">m2compatible</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">chain</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resolvers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ivysettings</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><br>  But there is one nuance that hinders the wide use of Grape - it is the implementation of its dependency resolution mechanism on Ivy and the absence of provider classes in one jar from the groove.  That's what I'm talking about: <br><blockquote>  igor @ igor-comp: ~ / dev / projects / groovy-grape-aether $ java -jar /home/igor/.m2/repository/org/codehaus/groovy/groovy-all/2.4.5/groovy-all-2.4 .5.jar ~ / dev / projects / jetty.groovy <br>  Caught: java.lang.NoClassDefFoundError: org / apache / ivy / Ivy <br>  java.lang.NoClassDefFoundError: org / apache / ivy / Ivy <br>  Caused by: java.lang.ClassNotFoundException: org.apache.ivy.Ivy </blockquote><br><br>  Those who tried to use Ivy with complex transitive dependencies, ranges of versions, or snapshot versions from the maven repositories didn‚Äôt get a big shot. <br><br>  In the <a href="">Grape.java</a> source <a href="">code</a> of the groovy project there are such lines <br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">// by default use GrapeIvy //TODO META-INF/services resolver? instance = (GrapeEngine) Class.forName("groovy.grape.GrapeIvy").newInstance();</span></span></code> </pre><br><br>  The search led to the Spring boot project, which uses Grape under the hood, but at the expense of the maven provider implemented on Aether.  <a href="http://www.eclipse.org/aether/">Aether</a> is a single library for accessing repositories and publishing artifacts.  It is used in maven, nexus, m2eclipse.  It is unlikely that Ivy will be able to contend with her on the same battlefield.  It would be great to use aether in grape! <br><br>  <a href="">GrapeEngineInstaller</a> does almost what the groovy authors thought when they wrote a TODO comment - assigns the AetherGrapeEngine provider to the Grape.instance field instead of the hard-coded GrapeIvy. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GrapeEngineInstaller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">install</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GrapeEngine engine)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">synchronized</span></span> (Grape.class) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Field field = Grape.class.getDeclaredField(<span class="hljs-string"><span class="hljs-string">"instance"</span></span>); field.setAccessible(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); field.set(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, engine);</code> </pre><br>  And it doesn't matter that the ‚Äúdirty hack‚Äù is implemented in the boot using reflection) The authors' idea of ‚Äã‚Äãthe ‚ÄúTODO META-INF / services resolver?‚Äù Is also not the best, especially when the application is modularized and such a resolver will definitely be a pain in the OSGI environment. <br><br>  For complete happiness, I need AetherGrapeEngine without all the boot and spring classes, and with all the Aether classes necessary for its work. <br><br>  This led me to the spring boot surgery and isolation surgery, combining AetherGrapeEngine and the <a href="https://github.com/igor-suhorukov/mvn-classloader">mvn-</a> classloader class <a href="https://github.com/igor-suhorukov/mvn-classloader">loaders</a> into a separate <a href="">artifact</a> of only 3 MB in size.  These 3 megabytes will help both the Gruve language and my <a href="https://github.com/igor-suhorukov/aspectj-scripting">AspectJ-Scripting</a> project!  I am pleased to share the results, I hope that the project will be useful to you. <br><br>  After combining mvn-classloader and groovy-all, an artifact of 9.8 MB is obtained, which replaces groovy-all and allows you to use the Grape mechanism in your Groovy application using the AetherGrapeEngine dependency resolver. <br><br>  Download from the central repository <a href="">groovy-grape-aether-2.4.5.1.jar</a> .  It was assembled on the basis of the <a href="https://github.com/igor-suhorukov/groovy-grape-aether">groovy-grape-aether</a> project. <br><br>  Initialize ssh server in carash.groovy script: <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Grab</span></span>(group=<span class="hljs-string"><span class="hljs-string">'org.crashub'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>=<span class="hljs-string"><span class="hljs-string">'crash.connectors.ssh'</span></span>, version=<span class="hljs-string"><span class="hljs-string">'1.3.1'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.crsh.standalone.Bootstrap <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.crsh.vfs.FS.Builder <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.crsh.vfs.spi.url.ClassPathMountFactory def classLoader = Bootstrap.getClassLoader(); def classpathDriver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClassPathMountFactory(classLoader); def cmdFS = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Builder().register(<span class="hljs-string"><span class="hljs-string">"classpath"</span></span>, classpathDriver).mount(<span class="hljs-string"><span class="hljs-string">"classpath:/crash/commands/"</span></span>).build(); def confFS = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Builder().register(<span class="hljs-string"><span class="hljs-string">"classpath"</span></span>, classpathDriver).mount(<span class="hljs-string"><span class="hljs-string">"classpath:/crash/"</span></span>).build(); def bootstrap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bootstrap(classLoader, confFS, cmdFS); def config = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> java.util.Properties(); config.put(<span class="hljs-string"><span class="hljs-string">"crash.ssh.port"</span></span>, <span class="hljs-string"><span class="hljs-string">"2000"</span></span>); config.put(<span class="hljs-string"><span class="hljs-string">"crash.ssh.auth_timeout"</span></span>, <span class="hljs-string"><span class="hljs-string">"300000"</span></span>); config.put(<span class="hljs-string"><span class="hljs-string">"crash.ssh.idle_timeout"</span></span>, <span class="hljs-string"><span class="hljs-string">"300000"</span></span>); config.put(<span class="hljs-string"><span class="hljs-string">"crash.auth"</span></span>, <span class="hljs-string"><span class="hljs-string">"simple"</span></span>); config.put(<span class="hljs-string"><span class="hljs-string">"crash.auth.simple.username"</span></span>, <span class="hljs-string"><span class="hljs-string">"admin"</span></span>); config.put(<span class="hljs-string"><span class="hljs-string">"crash.auth.simple.password"</span></span>, <span class="hljs-string"><span class="hljs-string">"admin"</span></span>); bootstrap.setConfig(config); bootstrap.bootstrap(); sleep <span class="hljs-number"><span class="hljs-number">60000</span></span> bootstrap.shutdown();</code> </pre><br><br>  Run this script with the <b>java -jar groovy-grape-aether-2.4.5.1.jar carash.groovy command.</b> <br><div class="spoiler">  <b class="spoiler_title">And we see in the console how the script finds the dependency in the repository and works</b> <div class="spoiler_text"><blockquote>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.PluginLifeCycle configureProperty <br>  INFO: Configuring property vfs.refresh_period = 1 from properties <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.ServiceLoaderDiscovery getPlugins <br>  INFO: Loaded plugin Plugin [type = SSHPlugin, interface = SSHPlugin] <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.ServiceLoaderDiscovery getPlugins <br>  INFO: Loaded plugin Plugin [type = SSHInlinePlugin, interface = CommandPlugin] <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.ServiceLoaderDiscovery getPlugins <br>  INFO: Loaded plugin Plugin [type = KeyAuthenticationPlugin, interface = KeyAuthenticationPlugin] <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.ServiceLoaderDiscovery getPlugins <br>  INFO: Loaded plugin Plugin [type = CRaSHShellFactory, interface = ShellFactory] <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.ServiceLoaderDiscovery getPlugins <br>  INFO: Loaded plugin Plugin [type = GroovyLanguageProxy, interface = Language] <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.ServiceLoaderDiscovery getPlugins <br>  INFO: Loaded plugin Plugin [type = JavaLanguage, interface = Language] <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.ServiceLoaderDiscovery getPlugins <br>  INFO: Loaded plugin Plugin [type = ScriptLanguage, interface = Language] <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.ServiceLoaderDiscovery getPlugins <br>  INFO: Loaded plugin Plugin [type = JaasAuthenticationPlugin, interface = AuthenticationPlugin] <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.ServiceLoaderDiscovery getPlugins <br>  INFO: Loaded plugin Plugin [type = SimpleAuthenticationPlugin, interface = AuthenticationPlugin] <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.PluginLifeCycle configureProperty <br>  INFO: Configuring property ssh.port = 2000 from properties <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.PluginLifeCycle configureProperty <br>  INFO: Configuring property ssh.auth_timeout = 300000 from properties <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.PluginLifeCycle configureProperty <br>  INFO: Configuring property ssh.idle_timeout = 300000 from properties <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.PluginLifeCycle configureProperty <br>  INFO: Configuring property ssh.default_encoding = UTF-8 from properties <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.PluginLifeCycle configureProperty <br>  INFO: Configuring property auth = simple from properties <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.PluginLifeCycle configureProperty <br>  INFO: Configuring property auth.simple.username = admin from properties <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.PluginLifeCycle configureProperty <br>  INFO: Configuring property auth.simple.password = admin from properties <br>  SLF4J: Failed to load class "org.slf4j.impl.StaticLoggerBinder". <br>  SLF4J: Defaulting to no-operation (NOP) logger implementation <br>  SLF4J: See <a href="http://www.slf4j.org/codes.html">www.slf4j.org/codes.html#StaticLoggerBinder</a> for further details. <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.PluginManager getPlugins <br>  INFO: Initialized plugin Plugin [type = KeyAuthenticationPlugin, interface = KeyAuthenticationPlugin] <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.PluginManager getPlugins <br>  INFO: Initialized plugin Plugin [type = JaasAuthenticationPlugin, interface = AuthenticationPlugin] <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.PluginManager getPlugins <br>  INFO: Initialized plugin Plugin [type = SimpleAuthenticationPlugin, interface = AuthenticationPlugin] <br>  Nov 05, 2015 1:01:50 AM org.crsh.ssh.SSHPlugin init <br>  INFO: Booting SSHD <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.PluginManager getPlugins <br>  INFO: Initialized plugin Plugin [type = GroovyLanguageProxy, interface = Language] <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.PluginManager getPlugins <br>  INFO: Initialized plugin Plugin [type = JavaLanguage, interface = Language] <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.PluginManager getPlugins <br>  INFO: Initialized plugin Plugin [type = ScriptLanguage, interface = Language] <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.PluginManager getPlugins <br>  INFO: Initialized plugin Plugin [type = CRaSHShellFactory, interface = ShellFactory] <br>  Nov 05, 2015 1:01:50 AM org.crsh.ssh.term.SSHLifeCycle init <br>  INFO: About to start CRaSSHD <br>  Nov 05, 2015 1:01:50 AM org.crsh.ssh.term.SSHLifeCycle init <br>  INFO: CRaSSHD started on port 2000 <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.PluginManager getPlugins <br>  INFO: Initialized plugin Plugin [type = SSHPlugin, interface = SSHPlugin] <br>  Nov 05, 2015 1:01:50 AM org.crsh.plugin.PluginManager getPlugins <br>  INFO: Initialized plugin Plugin [type = SSHInlinePlugin, interface = CommandPlugin] <br>  Nov 05, 2015 1:01:56 AM org.crsh.ssh.SSHPlugin destroy <br>  INFO: Shutting down SSHD <br></blockquote><br><br>  You can verify this by connecting to this server: ssh admin@127.0.0.1 -p 2000 <br><img src="https://habrastorage.org/files/857/2f4/79e/8572f479e1db410a99d1c084db5b0111.png"><br></div></div><br><br>  So, we can now use dependencies from the maven repositories in our groovy scripts.  All you need is groovy-all-2.4.5 combined with AetherGrapeEngine in the artifact <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.github.igor-suhorukov<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>groovy-grape-aether<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.4.5.1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  In the same artifact there is a class loader com.github.igorsuhorukov.smreed.dropship.MavenClassLoader for a java program.  So if you can‚Äôt use Groovy in a project, then similar functionality with dynamic class loading is also available in the java project.  But only for this it will still be more convenient to use <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.github.igor-suhorukov<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>mvn-classloader<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  I will give an example of java code to get the org.crsh.standalone.Bootstrap class from the maven repository: <br><pre> <code class="java hljs">URLClassLoader sshServerClassloader= MavenClassLoader.forMavenCoordinates(<span class="hljs-string"><span class="hljs-string">"org.crashub:crash.connectors.ssh:1.3.1"</span></span>); Class&lt;?&gt; bootstrapClass = sshServerClassloader.loadClass(<span class="hljs-string"><span class="hljs-string">"org.crsh.standalone.Bootstrap"</span></span>);</code> </pre><br><br>  To summarize what was said in the article: Grape is a built-in mechanism for dynamic dependency loading from maven repositories.  I managed to extract from the spring boot only the part necessary for the GrapeEngine provider, and combine it with Aether and the minimum necessary set of dependencies.  Ivy provider with his problems is no longer needed.  I will most likely move from MVEL to Groovy in my project.  And I wish you successful experiments with Grape and a new degree of freedom and convenience in programming on Groovy. <br><br>  We found out that Groovy, Ivy, and Maven bind a part of the Grape groove language, a technology for dynamically connecting dependencies, and found out how Grape can be used in your scripts. </div><p>Source: <a href="https://habr.com/ru/post/270145/">https://habr.com/ru/post/270145/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270131/index.html">Kaggle competition for analyzing population survey data</a></li>
<li><a href="../270133/index.html">Cocos2d-x - simple game development</a></li>
<li><a href="../270137/index.html">Start using Rust</a></li>
<li><a href="../270141/index.html">Online compilation on a static site, a recipe for beginners</a></li>
<li><a href="../270143/index.html">Pirate metrics: how to create an email campaign based on the AARRR principle. Part 3</a></li>
<li><a href="../270147/index.html">PHP html generation</a></li>
<li><a href="../270149/index.html">Microsoft raises prices for its software in the Russian Federation</a></li>
<li><a href="../270151/index.html">Top 10 articles on user eXperience for beginners to understand in an hour what it is</a></li>
<li><a href="../270153/index.html">XVB - Virtual PBX: Customization</a></li>
<li><a href="../270155/index.html">We write the simplest plugin for ReSharper</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>