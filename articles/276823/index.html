<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Overview of WhatsApp Toolkit</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In March 2014, the chief engineer of WhatsApp, Rick Reed, talked about optimizing the company's infrastructure, which was required due to the growing ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Overview of WhatsApp Toolkit</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habrahabr.ru/company/1cloud/blog/276823/"><img src="https://habrastorage.org/files/bf6/894/add/bf6894add182446c81d283dff88a636e.jpg" width="700"></a> <br><br>  In March 2014, the chief engineer of WhatsApp, Rick Reed, talked about optimizing the company's infrastructure, which was required due to the growing number of users.  We studied Rick's materials, other presentations on the topic and publications prepared on the basis of conversations with company representatives, and gave a brief overview of the main tools of WhatsApp. <a name="habracut"></a><br><br>  You can also familiarize yourself with the <a href="http://lanyrd.com/2014/erlangfactory/scwqrt/">recording</a> of Rick‚Äôs speech and <a href="http://www.erlang-factory.com/static/upload/media/1394350183453526efsf2014whatsappscaling.pdf">slides</a> from his presentation. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/c12cYAUTXXs%3Ffeature%3Doembed&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhji5xZXEv3Luk837xWxFj9vS73Hyw" frameborder="0" allowfullscreen=""></iframe><br><br>  Before turning to the description of the WhatsApp architecture, let us try to understand why Facebook paid $ 19 billion for a regular instant messenger.  The main thing that Facebook needed was that nearly billions of active users of WhatsApp, which still continues to grow. <br><br>  Analyst Benedict Evans (Benedict Evans), talking about the trillionth market of mobile applications, gives the following fact: "Users of mobile devices around the world send more than 20 billion SMS messages every day, which is comparable to the <a href="https://twitter.com/WhatsApp/status/451198381856014337">number of</a> messages passing through the WhatsApp application."  At the moment <a href="https://lenta.ru/news/2016/02/02/whatsapp1billion/">,</a> more than 1 billion people are actively <a href="https://lenta.ru/news/2016/02/02/whatsapp1billion/">using the</a> messenger, provided that only a few dozen developers are working in the company. <br><br>  WhatsApp employees do not particularly cover technical solutions, but in September 2015 in San Jose, California, the developer of the company Jamshid Mahdavi gave an interview, during which he briefly spoke about the technologies used.  Part of the secret is that the company builds its service using the Erlang programming language. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/57Ch2j8U0lk%3Ffeature%3Doembed&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhhe3058Hrsdl8Lfi9jlzubAzo-dQ" frameborder="0" allowfullscreen=""></iframe><br><br>  Erlang originates in the 80s of the last century.  Engineers from Ericsson, a hardware and software company for telecommunications companies, have developed a language that is suitable for high-speed telephone networks. <br><br><blockquote>  ‚ÄúInstead of creating a language and then deciding what to do with it, they immediately identified a specific task for which it was intended,‚Äù said Francesco Cesarini, the guru of the Erlang language.  - He solved the problem of scalability and reliability.  At that time, telephone networks were the only system that should have these two properties. ‚Äù </blockquote><br>  Moreover, Erlang offers a <a href="https://medium.com/%40kansi/hot-code-loading-with-erlang-and-rebar3-8252af16605b">hot-</a> code replacement, when the application can run both the old and the new version of the code at the same time.  It turns out that the software on Erlang can be upgraded without downtime. <br><br>  WhatsApp <a href="https://www.quora.com/What-is-the-technology-behind-the-web-based-version-of-WhatsApp">uses a</a> modified messaging and presence protocol for XMPP (formerly known as Jabber) with SSL and TLS encryption to send messages.  SSL and TLS are widely used cryptographic protocols that provide secure data transmission over the Internet.  In addition to WhatsApp protocol is used in web browsers and when working with e-mail. <br><br><img src="https://habrastorage.org/files/06f/edc/c89/06fedcc89d094b11be19981cff5a7c9e.gif" width="500"><br><br>  <a href="http://www.slideshare.net/VirginiaSgargi/whatsapp-project-work">XMPP architecture</a> <br><br>  Until the user launches the application, all incoming messages are lined up and stored in the server‚Äôs memory.  As soon as the message gets to the user's device, it is erased from the server‚Äôs memory, and the sender receives confirmation of its receipt.  One of the StackOverflow participants <a href="http://stackoverflow.com/questions/19640703/what-is-the-technology-behind-wechat-whatsapp-and-other-messenger-apps">described</a> the messaging process: <br><br><blockquote>  <i>‚ÄúAlice decides to send a message to Bob.</i>  <i>Alice's smartphone establishes a connection to the WhatsApp server, which, in turn, determines whose device it is.</i>  <i>Then Alice sends a TCP message: "For Bob: A giant monster attacks the Golden Gate Bridge."</i>  <i>One of the WhatsApp frontend servers deserializes this message and delivers it to the actor Alice.</i> <i><br><br></i>  <i>Actor Alice decides to serialize the message and save it in a file called Alice's Sent Messages.</i>  <i>Then the actor Alice decides to transfer it to the actor Bob in the following form: "Message1 from Alice: A giant monster attacks the Golden Gate Bridge."</i>  <i>Actor Alice sends a message and waits for delivery confirmation from actor Bob.</i> <i><br><br></i>  <i>Actor Bob, having received the message, saves it to a file called ‚ÄúInbox for Bob‚Äù and sends a notification of receipt of the letter.</i>  <i>He then checks if Bob's smartphone is connected to the server.</i>  <i>If so, then actor Bob sends a message over TCP.</i> <i><br><br></i>  <i>Bob, seeing the message, decides to answer: "For Alice: Let's build giant robots and fight with him."</i>  <i>Now this message is received by the actor Bob and repeats all the steps described above, so that the idea of ‚Äã‚Äãsaving humanity comes to Alice. ‚Äù</i> </blockquote><br>  The multi-user distributed system Mnesia DB, which <a href="http://highscalability.com/blog/2014/3/31/how-whatsapp-grew-to-nearly-500-million-users-11000-cores-an.html">uses</a> about 2 TB of RAM and stores about 18 billion records, is <a href="http://highscalability.com/blog/2014/3/31/how-whatsapp-grew-to-nearly-500-million-users-11000-cores-an.html">used</a> as a DBMS.  It is written in Erlang.  From the point of view of request processing speed, a rather efficient integration is obtained.  Photos, audio and video attached to the message are uploaded to the YAWS web server, and links to them are sent to the recipient. <br><br>  Using Erlang brought incredible scalability.  The initial WhatsApp load was 200,000 simultaneous connections to the server.  A little later, this figure increased significantly and reached 2.8 million compounds.  All this magnificence is <a href="http://highscalability.com/blog/2014/3/31/how-whatsapp-grew-to-nearly-500-million-users-11000-cores-an.html">processed by</a> approximately 550 servers, of which 150 are chat servers supporting up to 1 million smartphones.  About 250 more machines are multimedia servers.  The nodes responsible for the operation of the databases have 512 GB of RAM, and the usual computing nodes have 64 GB.  You can learn more about the subtleties and characteristics of the scaling process from High Scalability from <a href="http://highscalability.com/blog/2014/2/26/the-whatsapp-architecture-facebook-bought-for-19-billion.html">this</a> post. <br><br>  In January 2015, WhatsApp launched the web version of its popular mobile app.  This is quite an interesting point, because the company has never stored user messages on its server - all information was stored on smartphones.  Let's see what tools the developers used. <br><br>  Biplav Saraf (Biplav Saraf) <a href="httpswebwhatsappcom.html">writes</a> in his blog that the main frameworks were <a href="http://facebook.github.io/react/">React.js</a> - a framework for creating interfaces from Facebook, <a href="http://underscorejs.org/">Underscore.js</a> - a JavaScript library that implements additional functionality for working with arrays, objects and functions, and <a href="http://julian.com/research/velocity/">Velocity.js</a> - engine for working with animation. <br><br>  WhatsApp Web is an add-on to a WhatsApp account on your phone, and therefore it connects to a mobile device to synchronize messages.  It turns out that to use the web client, the phone must be turned on, because it is directly involved in the transfer of messages. <br><br>  Biplav wrote a plugin for Chrome to see what happens when you open the web client and see the QR code. <br><br><img src="https://habrastorage.org/files/6d4/a5a/6fd/6d4a5a6fd8344e68b2663d8170ac5886.png" width="900"><br><br>  He found out that the information about the current client, OS and browser is sent first and the session ID is transmitted.  Biplav believes that the third frame in the list is a TTL frame.  When you scan a QR code, the mobile client connects to the specified channel using the WebSocket protocol.  WebSocket is a full-duplex protocol over TCP connection designed for real-time messaging between a browser and a web server.  The web client receives the following frames: <br><br><img src="https://habrastorage.org/files/41d/34e/ed0/41d34eed080148eeb196f3a53ebf2fc3.png" width="900"><br><br>  The selected frame is of the most interest because it contains data transmitted by the mobile client to the web client.  It turns out that it even <a href="httpswebwhatsappcom.html">contains</a> information about the battery status of the smartphone and whether the mobile device is charging. <br><br><h4>  findings </h4><br>  WhatsApp has proven that the size of the company does not matter.  A team of several dozen developers was able to create a popular instant messenger using inexpensive hardware and open source software.  Of course, a certain role was played by the fact that the company was in the right place at the right time and offered its product to the right customer, but you shouldn‚Äôt disregard the fact that developers set realistic goals for themselves and achieved their realization. <br><br>  When Mahdavi was asked about how the company managed to achieve such a resounding success, he replies that you just need to concentrate on your goal.  ‚ÄúDo not be distracted by third-party tasks, other technologies or unnecessary office activities, such as meetings,‚Äù Mahdavi said.  WhatsApp employees almost never hold meetings.  Of course, there are only a few dozen workers, but they achieved everything in just this quantity. <br><br>  <i>PS Of course, we also share our own experience - most recently we <a href="https://habrahabr.ru/company/1cloud/blog/277155/">talked</a> about how we upgraded the project site in 1cloud and developed some user functions.</i> </div><p>Source: <a href="https://habr.com/ru/post/276823/">https://habr.com/ru/post/276823/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../276809/index.html">Corporate Cloud: Connection Options</a></li>
<li><a href="../276811/index.html">Antivirus again at gunpoint: Malwarebytes found critical vulnerabilities</a></li>
<li><a href="../276813/index.html">Software special computer. ‚ÄúYauza-6‚Äù, ‚ÄúTemp‚Äù, ‚ÄúRuza‚Äù</a></li>
<li><a href="../276815/index.html">What's New in Veeam Backup & Replication 9.0: Increase Efficiency in Creating and Storing Backup Files</a></li>
<li><a href="../276821/index.html">The use of machine learning in the field of fintech</a></li>
<li><a href="../276825/index.html">Using VS Code for Web Development</a></li>
<li><a href="../276827/index.html">Windows Phone as an experimental platform</a></li>
<li><a href="../276831/index.html">Shodan collected the IPv6 addresses of NTP clients and scanned them in response</a></li>
<li><a href="../276835/index.html">Work on hardware errors on the SQL server side and the benefits of load tests</a></li>
<li><a href="../276837/index.html">New 2GIS for Android - we begin public testing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>