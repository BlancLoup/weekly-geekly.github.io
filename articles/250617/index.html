<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Survey: how do you solve the problem of synchronizing parallel PHP queries?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For a long time, I have been trying to understand how much space is devoted to issues of parallelism and competitiveness of code execution in the dail...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Survey: how do you solve the problem of synchronizing parallel PHP queries?</h1><div class="post__text post__text-html js-mediator-article">  For a long time, I have been trying to understand how much space is devoted to issues of parallelism and competitiveness of code execution in the daily practice of an average PHP programmer.  On the one hand, when developing a server application, the programmer automatically writes code that will be executed in parallel.  On the other hand, in practice in PHP all the problems of this area were solved by the tools that everyone used - a web server, a session and a DBMS. <br><br>  Do your projects pay attention to the synchronization problems of parallel HTTP requests being processed?  They are solved through transactions, blocking?  What methods of blocking do you use?  Anyway, do you need to bathe about it, or is the topic useless?  We learn the opinion of the audience.  This post does not provide answers to questions.  There is exploration. <br><a name="habracut"></a><br><br>  *** 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the PHP world, it has historically been decided not to pay much attention to the parallel execution of code.  Under multithreading, PHP itself is not sharpened (there is no thread safety inside the engine).  I have never met projects or programmers who used <a href="http://php.net/manual/en/book.pthreads.php">pthreads</a> (did you meet? Then tell us about it in the commands).  And it‚Äôs not really that multithreading is needed in practice in web applications where you need to execute requests in parallel and not separate parts of the code within a single request.  And since the parallel execution of incoming requests in separate processes is organized by the application server (php-fpm or apache), the programmer does not need to think about it - everything works out of the box. <br><br>  In PHP, there is a session mechanism that is used overwhelmingly.  A session with default settings blocks parallel execution of requests within a single session.  This ‚Äúcovers‚Äù some holes and leads to the fact that in practice you can never face obvious problems.  Those.  until the user starts hacking, working, for example, in two browsers at the same time, nothing breaks due to the absence of locks and transactions. <br><br>  In addition, the probability of collisions due to parallelism is very small for sites with a peak number of requests less than 2 per second (assuming that the response generation time does not exceed a second). <br><br>  And finally, if some problems of parallelism still emerge, then the easiest way to solve them is a transaction in a database with a sufficient <a href="http://habrahabr.ru/post/238513/">level of isolation</a> .  Since almost all sites that are developed in PHP use transactional DBMS as a repository, it is enough just to start using transactions to solve the problems of concurrent query execution that lead to inconsistency of data.  Even without delving deeply into the topic of process synchronization, simply using transactions, the problem can be solved. <br><br>  All this leads to the fact that in practice the average PHP programmer almost never encounters problems of parallel code execution.  Most people know very little about parallel programming, synchronization and locking.  This is clearly seen in the interviews.  And how much it is in demand, I want to know in this survey. <br><br>  In part, this is all well and good - the low threshold of entry, which is one of the main advantages of PHP.  Rapid development by saving time to work through all the bottlenecks.  But sooner or later, many begin to face the problem of synchronizing processes face to face.  And the development of reliable, and not designed for the circumstances, applications requires a certain level of study of this issue. <br><br>  The simplest example when a transaction does not help is to warm up the cache.  In order for data that is cached not to be generated in parallel, competitive requests need to be blocked, allowing the cache to fill in the request that started it first.  Without blocking is not enough.  Moreover, if there are several servers, the lock should be centralized.  Another example is file hosting.  The user has limited the number of files that he can upload.  When adding a file, you need to compare the number of uploaded files with the limit and accept the file if the limit is not reached.  Although you can make a feint with your ears and do without locks, it will be easiest to block before checking for the user, check the counter, take a slot for the file, release the lock, and then take the file body itself. <br><br>  And using transactions also has its problems.  At a minimum, they need to be restarted several times if race-condition is present and the transaction is rolled back due to a collision.  There are questions when working with external resources for the database - files, cache, requests to the remote API. <br><br>  *** <br><br>  In fact, all PHP programmers write code that works in a competitive environment.  Often, even in a very competitive.  And access to shared resources from parallel-running processes has to be synchronized.  I think that many, like me, will be interested to know how colleagues in the workshop are looking at this problem.  How do your projects solve the problem of synchronization of access to shared resources? <br><br><div class="spoiler">  <b class="spoiler_title">How is this problem solved by us?</b> <div class="spoiler_text">  We use tranzatskiy and blocking.  Transactions help preserve the consistency of the data, if the task is reduced to a series of queries in the database.  When it is necessary to synchronize the code that works not only with the database, or does not work with it at all, we use locks through my <a href="https://github.com/feedbee/lock-manager">abstraction library on the locking method</a> .  If the backend is running on the same server, it‚Äôs enough to use the driver for flock (), if you need to block remotely, then you can use the drivers for Redis or Memcache. <br></div></div><br><br>  If you have <b>good</b> materials on this topic, share links in the comments. <br><br>  PS To fans of other programming languages: if you want to tell how the problem is successfully solved in your language / framework, you are welcome.  Otherwise, pay attention to the hub in which the publication is placed. </div><p>Source: <a href="https://habr.com/ru/post/250617/">https://habr.com/ru/post/250617/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250603/index.html">Hibernate: lazy loading, inheritance and instanceof</a></li>
<li><a href="../250605/index.html">The UX Reader: MailChimp UX Team Book [Part 1]</a></li>
<li><a href="../250607/index.html">The digest of interesting materials for the mobile # 90 developer (February 9-15)</a></li>
<li><a href="../250611/index.html">Return the original menu pages in Phoenix SCT UEFI</a></li>
<li><a href="../250613/index.html">Review of the most interesting materials on data analysis and machine learning ‚Ññ35 (February 9 - 15, 2015)</a></li>
<li><a href="../250621/index.html">300 amazing free services</a></li>
<li><a href="../250623/index.html">Flourishing neocartography</a></li>
<li><a href="../250625/index.html">How does the brain work?</a></li>
<li><a href="../250627/index.html">Technical report on the activities of a criminal group engaged in targeted attacks - Anunak</a></li>
<li><a href="../250629/index.html">The second version of the glove to determine the position of the hand</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>