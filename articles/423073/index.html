<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Interplanetary File System - Trivial Hash (Identity), DAG Block, and Protocol Buffers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I added support for a trivial (identity) hash in IPFS. In my article I will tell about it and show how it can be used. 
 Let me remind you: ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Interplanetary File System - Trivial Hash (Identity), DAG Block, and Protocol Buffers</h1><div class="post__text post__text-html js-mediator-article"><p>  Recently, I added support for a <a href="https://github.com/ipfs/go-ipfs/issues/4697">trivial (identity) hash</a> in IPFS.  In my article I will tell about it and show how it can be used. </p><br><blockquote>  Let me remind you: InterPlanetary File System is a new decentralized file sharing network (HTTP-server, <a href="https://ru.wikipedia.org/wiki/Content_Delivery_Network">Content Delivery Network</a> ).  About her, I began the story in the article <a href="https://habr.com/post/314768/">"Interplanetary File System IPFS"</a> . </blockquote><p>  Usually, when hashing passes through the <a href="https://ru.wikipedia.org/wiki/%25D0%25A5%25D0%25B5%25D1%2588%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">hash function, the</a> data is irreversibly ‚Äúcompressed‚Äù and as a result a short identifier is obtained.  This identifier allows you to find the data on the network and check its integrity. </p><br><p>  <a href="https://en.wikipedia.org/wiki/Hash_function">The trivial hash</a> is the data itself.  The data does not change at all and, accordingly, the size of the "hash" is equal to the size of the data. </p><br><p>  The trivial hash performs the same function as the <a href="https://ru.wikipedia.org/wiki/Data:_URL">Data: URL</a> .  The content identifier in this case contains the data itself instead of the hash.  This allows you to nest child blocks in the parent making them available immediately after receiving the parent.  You can also include site data directly in the DNS record. </p><br><p>  For example, encode the text string ‚ÄúHello world‚Äù into <a href="https://github.com/ipld/cid">a content identifier</a> (CID) with a trivial hash. <br> <a href="https://habrahabr.ru/post/423073/"><img src="https://habrastorage.org/getpro/habr/post_images/fd3/316/1e3/fd33161e38ad164adb32a3e384cd2f5d.svg" alt="image"></a> </p><a name="habracut"></a><br><p>  <u>ID structure:</u> </p><br><pre><code class="hljs markdown">[<span class="hljs-string"><span class="hljs-string"> </span></span>][<span class="hljs-symbol"><span class="hljs-symbol">varint  CID</span></span>][<span class="hljs-string"><span class="hljs-string">varint  </span></span>][<span class="hljs-symbol"><span class="hljs-symbol">varint ID </span></span>][<span class="hljs-string"><span class="hljs-string">varint  </span></span>][<span class="hljs-symbol"><span class="hljs-symbol"></span></span>]</code> </pre> <br><p>  Let's start from the end. </p><br><h3 id="hesh">  [hash] </h3><br><p>  The trivial hash in our case is the string itself.  Translate it to <a href="https://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B5%25D1%2581%25D1%2582%25D0%25BD%25D0%25B0%25D0%25B4%25D1%2586%25D0%25B0%25D1%2582%25D0%25B5%25D1%2580%25D0%25B8%25D1%2587%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2581%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2581%25D1%2587%25D0%25B8%25D1%2581%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F">HEX</a> . </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">" "</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>x<span class="hljs-string"><span class="hljs-string">"D09F D180 D0B8 D0B2 D0B5 D182 20 D0BC D0B8 D180"</span></span></code> </pre> <br><p>  This is the HEX of this line in <a href="https://ru.wikipedia.org/wiki/UTF-8">utf-8</a> encoding.  But so that the browser knows for sure that this utf-8 line is added to it at the beginning: <code>0xEFBBBF</code> .  This is <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B0%25D1%2580%25D0%25BA%25D0%25B5%25D1%2580_%25D0%25BF%25D0%25BE%25D1%2581%25D0%25BB%25D0%25B5%25D0%25B4%25D0%25BE%25D0%25B2%25D0%25B0%25D1%2582%25D0%25B5%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D0%25B8_%25D0%25B1%25D0%25B0%25D0%25B9%25D1%2582%25D0%25BE%25D0%25B2">a byte sequence marker</a> (BOM). </p><br><pre> <code class="hljs objectivec"><span class="hljs-number"><span class="hljs-number">0</span></span>x<span class="hljs-string"><span class="hljs-string">"EFBBBF D09F D180 D0B8 D0B2 D0B5 D182 20 D0BC D0B8 D180"</span></span></code> </pre> <br><h3 id="varint-dlinna-hesha">  [varint is long hash] </h3><br><p>  Now we can calculate the length of the hash.  Every two HEX characters is one byte.  Accordingly, the resulting string is 22 bytes long.  In HEX it will be <code>0x16</code> . </p><br><p>  Add <code>0x16</code> to the beginning of the line. </p><br><pre> <code class="hljs objectivec"><span class="hljs-number"><span class="hljs-number">0</span></span>x<span class="hljs-string"><span class="hljs-string">"16 EFBBBF D09F D180 D0B8 D0B2 D0B5 D182 20 D0BC D0B8 D180"</span></span></code> </pre> <br><h3 id="varint-id-hesha">  [varint ID hash] </h3><br><p>  Now we need a hash identifier.  The trivial hash or identity in <a href="">the hash table</a> has the identifier <code>0x00</code> . </p><br><p>  Add <code>0x00</code> to the beginning of the line. </p><br><pre> <code class="hljs objectivec"><span class="hljs-number"><span class="hljs-number">0</span></span>x<span class="hljs-string"><span class="hljs-string">"00 16 EFBBBF D09F D180 D0B8 D0B2 D0B5 D182 20 D0BC D0B8 D180"</span></span></code> </pre> <br><p>  This is already a <a href="https://github.com/multiformats/multihash">multi-cache</a> part of the identifier. You can recode HEX into Base58 and the multi-cache is ready.  But ipfs does not recognize it outside the content identifier (CID). </p><br><p>  Go ahead. </p><br><h3 id="varint-tip-kontenta">  [varint content type] </h3><br><p>  Now let's look at the <a href="">multicodec</a> table to get the content type.  In our case, this is the raw data and the identifier, respectively, <code>0x55</code> . </p><br><p>  Add <code>0x55</code> to the beginning of the line. </p><br><pre> <code class="hljs objectivec"><span class="hljs-number"><span class="hljs-number">0</span></span>x<span class="hljs-string"><span class="hljs-string">"55 00 16 EFBBBF D09F D180 D0B8 D0B2 D0B5 D182 20 D0BC D0B8 D180"</span></span></code> </pre> <br><h3 id="varint-versiya-cid">  [varint version CID] </h3><br><p>  We code to the format of the <a href="https://github.com/ipld/cid">first version of the content identifier</a> .  Therefore we add 0x01. </p><br><p>  Add <code>0x01</code> to the beginning of the line. </p><br><pre> <code class="hljs objectivec"><span class="hljs-number"><span class="hljs-number">0</span></span>x<span class="hljs-string"><span class="hljs-string">"01 55 00 16 EFBBBF D09F D180 D0B8 D0B2 D0B5 D182 20 D0BC D0B8 D180"</span></span></code> </pre> <br><p>  And so we are already at the finish line. </p><br><h3 id="prefiks-osnovaniya">  [base prefix] </h3><br><p>  It indicates which variant of encoding binary data to text is used. </p><br><h4 id="hex-f">  HEX (F) </h4><br><p>  We can directly use the HEX term by appending at the beginning the prefix of the base HEX character "F" </p><br><pre> <code class="hljs">F01550016EFBBBFD09FD180D0B8D0B2D0B5D18220D0BCD0B8D180</code> </pre> <br><p>  We got a HEX content identifier which contains utf-8 line: "Hello world" </p><br><p>  <a href="https://ipfs.io/ipfs/F01550016EFBBBFD09FD180D0B8D0B2D0B5D18220D0BCD0B8D180">We are testing</a> : <a href="https://ipfs.io/ipfs/F01550016EFBBBFD09FD180D0B8D0B2D0B5D18220D0BCD0B8D180">/ ipfs / F01550016EFBBBFD09FD180D0B8D0B2D0B5D18220D0BCD0B8D180</a> </p><br><h4 id="base58btc-z">  Base58btc (z) </h4><br><p>  Base58btc will be shorter therefore </p><br><p>  We translate our HEX string to base58btc.  You can use the <a href="http://lenschulwitz.com/base58">online converter</a> . </p><br><pre> <code class="hljs lisp"><span class="hljs-number"><span class="hljs-number">0</span></span>x<span class="hljs-string"><span class="hljs-string">"01 55 00 16 EFBBBF D09F D180 D0B8 D0B2 D0B5 D182 20 D0BC D0B8 D180"</span></span> = <span class="hljs-string"><span class="hljs-string">"3NDGAEgXCxbPucFFCQc9s5ScqZjqVFNr56P"</span></span> (<span class="hljs-name"><span class="hljs-name">base58btc</span></span>)</code> </pre> <br><p>  At the beginning of the resulting string, add the base prefix symbol base58btc "z" </p><br><pre> <code class="hljs">z3NDGAEgXCxbPucFFCQc9s5ScqZjqVFNr56P</code> </pre> <br><p>  We received the base58btc content identifier which contains the utf-8 line: "Hello world" </p><br><p>  <a href="https://ipfs.io/ipfs/z3NDGAEgXCxbPucFFCQc9s5ScqZjqVFNr56P">We test</a> : <a href="https://ipfs.io/ipfs/z3NDGAEgXCxbPucFFCQc9s5ScqZjqVFNr56P">/ ipfs / z3NDGAEgXCxbPucFFCQc9s5ScqZjqVFNr56P</a> </p><br><h3 id="dag-blok">  DAG block </h3><br><p>  The text is good, but in order to encode the HTML page we need to attach its data to the DAG directory block. </p><br><p>  Here is our HTML: </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">u</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">u</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Similarly, according to the instructions above, we get the content ID in base58btc for this text: </p><br><pre> <code class="hljs">zeExnPvBXdTRwCBhfkJ1fHFDaXpdW4ghvQjfaCRHYxtQnd3H4w1MPbLczSqyCqVo</code> </pre> <br><p>  Now we write the JSON file: </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"links"</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">"Cid"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"/"</span></span>: <span class="hljs-string"><span class="hljs-string">"zeExnPvBXdTRwCBhfkJ1fHFDaXpdW4ghvQjfaCRHYxtQnd3H4w1MPbLczSqyCqVo"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"index.html"</span></span> }], <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: <span class="hljs-string"><span class="hljs-string">"CAE="</span></span> }</code> </pre> <br><ol><li>  In "data" the type of DAG of the block is specified - directory. </li><li>  "links" is an array of links to files. </li><li>  "Name" is the corresponding file name. </li><li>  "Cid" contains the content identifier </li></ol><br><p>  <code>ipfs dag put -f"protobuf"</code> convert JSON to DAG block via IPFS. </p><br><p>  I received a multi-cache: <code>QmXXixn4rCzGguhxQPjXQ8Mr5rdqwZfJTKkeB6DfZLt8EZ</code> </p><br><p>  At this stage, we got a block in which a directory with one file inscribed in the block. </p><br><p>  Next, using this multi-cache, unload the finished block. </p><br><pre> <code class="hljs vhdl">ipfs <span class="hljs-keyword"><span class="hljs-keyword">block</span></span> get QmXXixn4rCzGguhxQPjXQ8Mr5rdqwZfJTKkeB6DfZLt8EZ &gt; <span class="hljs-keyword"><span class="hljs-keyword">block</span></span>.dag</code> </pre> <br><p>  We translate the contents of block.dag to HEX: </p><br><pre> <code class="hljs objectivec"><span class="hljs-number"><span class="hljs-number">0</span></span>x<span class="hljs-string"><span class="hljs-string">"123F0A2F0155002BEFBBBF3C623E3C693E3C753ED09FD180D0B8D0B2D0B5D18220D0BCD0B8D1803C2F753E3C2F693E3C2F623E120A696E6465782E68746D6C18000A020801"</span></span></code> </pre> <br><p>  Add: </p><br><ol><li>  CID version (0x01) </li><li>  DAG Content Type (0x70) </li><li>  trivial hash (0x00) </li><li>  data size 69 bytes (0x45) </li></ol><br><pre> <code class="hljs objectivec"><span class="hljs-number"><span class="hljs-number">0</span></span>x<span class="hljs-string"><span class="hljs-string">"01 70 00 45 123F0A2F0155002BEFBBBF3C623E3C693E3C753ED09FD180D0B8D0B2D0B5D18220D0BCD0B8D1803C2F753E3C2F693E3C2F623E120A696E6465782E68746D6C18000A020801"</span></span></code> </pre> <br><p>  Convert to Base58btc and add the prefix "z" </p><br><pre> <code class="hljs">z6S3Z3W1zuRxio8AJC41jRTdyU9pZWnU6sNbvyGyypEdD8JVNdW42ZmGYWKWGbVDELLvJNWcMspaZMUPZKt7JQmhdyXCqq7j37GL</code> </pre> <br><p>  Thus, we received a content identifier with a directory in which the html index.html page with the text "Hello world". </p><br><p>  <a href="https://ipfs.io/ipfs/z6S3Z3W1zuRxio8AJC41jRTdyU9pZWnU6sNbvyGyypEdD8JVNdW42ZmGYWKWGbVDELLvJNWcMspaZMUPZKt7JQmhdyXCqq7j37GL/">We are testing</a> : <a href="https://ipfs.io/ipfs/z6S3Z3W1zuRxio8AJC41jRTdyU9pZWnU6sNbvyGyypEdD8JVNdW42ZmGYWKWGbVDELLvJNWcMspaZMUPZKt7JQmhdyXCqq7j37GL/">/ ipfs / z6S3Z3W1zuRxio8AJC41jRTdyU9pZWnU6sNbvyGyypEdD8JVNdW42ZmGYWKWGbVDELLvJNWcMspaZMUPZKt7JQmhdyXCqQy4j4j4j4j4jmJJWCMspaZMUPZKt7JQmhYXCqj4j4j4j4j4j4jmjjpcdcdp4dvdbjp3d3d3d3d3d3c3d3d3d3d3c3d3d3d3d3d3c3d3d3d3d3c3d3d3d3d3c3d3dc</a> </p><br><p>  Further, this hash can also be attached to another block or written to the DNS dnslink record.  So in one block you can fit a small simple site. </p><br><h3 id="dag-blok-i-protocol-buffers">  DAG block and Protocol Buffers </h3><br><p>  DAG unit can also be assembled manually.  A DAG block is data in the <a href="https://developers.google.com/protocol-buffers/docs/encoding">Protocol Buffers</a> format.  The top layer is <a href="https://github.com/ipfs/go-merkledag/blob/2a2b14cb9dbd033a684335ad27af638c30178bd3/pb/merkledag.proto">merkledag.proto</a> which has <a href="https://github.com/ipfs/go-unixfs/blob/08716b95ba554c9494d01212fabe6bf9da678f6b/pb/unixfs.proto">unixfs.proto</a> in Data. </p><br><h4 id="protocol-buffers">  Protocol buffers </h4><br><p>  Any protobuffer starts with a varint field id.  Often the identifier occupies one byte because its total value is less than 0x80.  In our case, the first byte is 0x12.  The lower 3 bits of this field are type.  The rest of the ID specified in the proto file. </p><br><h5 id="length-delimited">  Length-delimited </h5><br><p>  Decrypt the identifier: </p><br><pre> <code class="hljs lisp"><span class="hljs-number"><span class="hljs-number">0</span></span>x12 &amp; <span class="hljs-number"><span class="hljs-number">0</span></span>x07 = <span class="hljs-number"><span class="hljs-number">2</span></span> (: Length-delimited) <span class="hljs-number"><span class="hljs-number">0</span></span>x12 &gt;&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-name"><span class="hljs-name">ID</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> <br><p>  Length-delimited means that the varint size of the field in bytes and its contents immediately follows.  This type is used for various nested structures as well as raw data (string, bytes, embedded messages, packed repeated fields).  What it defines already proto file. </p><br><h5 id="varint">  Varint </h5><br><p>  We decipher the identifier of another type: </p><br><pre> <code class="hljs lisp"><span class="hljs-number"><span class="hljs-number">0</span></span>x18 &amp; <span class="hljs-number"><span class="hljs-number">0</span></span>x07 = <span class="hljs-number"><span class="hljs-number">0</span></span> (: Varint) <span class="hljs-number"><span class="hljs-number">0</span></span>x12 &gt;&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> = <span class="hljs-number"><span class="hljs-number">3</span></span> (<span class="hljs-name"><span class="hljs-name">ID</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>)</code> </pre> <br><p>  Varint means that the next value immediately in the varint.  This container is used to record many types of values ‚Äã‚Äã(int32, int64, uint32, uint64, sint32, sint64, bool, enum).  That it also defines the proto file. </p><br><h4 id="razberyom-blockdag-kotoryy-my-pereveli-v-hex-vyshe">  Let's sort the block.dag that we translated to HEX above </h4><br><p>  To parse a block, you can use a <a href="https://protogen.marcgravell.com/decode">site that will automatically parse any Protocol Buffer</a> without using proto files. </p><br><pre> <code class="hljs objectivec"><span class="hljs-number"><span class="hljs-number">0</span></span>x<span class="hljs-string"><span class="hljs-string">"123F0A2F0155002BEFBBBF3C623E3C693E3C753ED09FD180D0B8D0B2D0B5D18220D0BCD0B8D1803C2F753E3C2F693E3C2F623E120A696E6465782E68746D6C18000A020801"</span></span></code> </pre> <br><p>  Parse the block and match the identifiers from the proto files. </p><br><div class="spoiler">  <b class="spoiler_title">merkledag.proto</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">// An IPFS MerkleDAG Link message PBLink { // multihash <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> the target <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> optional bytes Hash = <span class="hljs-number"><span class="hljs-number">1</span></span>; // utf string <span class="hljs-type"><span class="hljs-type">name</span></span>. should be <span class="hljs-keyword"><span class="hljs-keyword">unique</span></span> per <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> optional string <span class="hljs-type"><span class="hljs-type">Name</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span>; // cumulative size <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> target <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> optional uint64 Tsize = <span class="hljs-number"><span class="hljs-number">3</span></span>; } // An IPFS MerkleDAG Node message PBNode { // refs <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> other objects repeated PBLink Links = <span class="hljs-number"><span class="hljs-number">2</span></span>; // <span class="hljs-type"><span class="hljs-type">opaque</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> data optional bytes Data = <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">unixfs.proto</b> <div class="spoiler_text"><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">message</span></span> Data { <span class="hljs-attribute"><span class="hljs-attribute">enum</span></span> DataType { <span class="hljs-attribute"><span class="hljs-attribute">Raw</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">Directory</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">File</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">Metadata</span></span> = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">Symlink</span></span> = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">HAMTShard</span></span> = <span class="hljs-number"><span class="hljs-number">5</span></span>; } <span class="hljs-attribute"><span class="hljs-attribute">required</span></span> DataType Type = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">optional</span></span> bytes Data = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">optional</span></span> uint64 filesize = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">repeated</span></span> uint64 blocksizes = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">optional</span></span> uint64 hashType = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">optional</span></span> uint64 fanout = <span class="hljs-number"><span class="hljs-number">6</span></span>; }</code> </pre> </div></div><br><pre> <code class="hljs lisp"><span class="hljs-number"><span class="hljs-number">12</span></span> (: <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-name"><span class="hljs-name">Length-delimited</span></span>). ID: <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-name"><span class="hljs-name">PBLink</span></span> PBNode.Links (<span class="hljs-name"><span class="hljs-name">merkledag</span></span>.proto))) <span class="hljs-number"><span class="hljs-number">3</span></span>F (: <span class="hljs-number"><span class="hljs-number">63</span></span> ) <span class="hljs-number"><span class="hljs-number">0</span></span>A (: <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-name"><span class="hljs-name">Length-delimited</span></span>). ID: <span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">PBLink</span></span>.Hash)) <span class="hljs-number"><span class="hljs-number">2</span></span>F (: <span class="hljs-number"><span class="hljs-number">47</span></span> ) <span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">55</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>B (<span class="hljs-name"><span class="hljs-name">CIDv1</span></span> Raw Identity <span class="hljs-number"><span class="hljs-number">43</span></span> ) EFBBBF3C623E3C693E3C753ED09FD180D0B8D0B2D0B5D18220D0BCD0B8D1803C2F753E3C2F693E3C2F623E = <span class="hljs-string"><span class="hljs-string">"Ôªø&lt;b&gt;&lt;i&gt;&lt;u&gt; &lt;/u&gt;&lt;/i&gt;&lt;/b&gt;"</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> (: <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-name"><span class="hljs-name">Length-delimited</span></span>). ID: <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-name"><span class="hljs-name">PBLink</span></span>.Name)) <span class="hljs-number"><span class="hljs-number">0</span></span>A (: <span class="hljs-number"><span class="hljs-number">10</span></span> ) <span class="hljs-number"><span class="hljs-number">696E6465782</span></span>E68746D6C = <span class="hljs-string"><span class="hljs-string">"index.html"</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> (: <span class="hljs-number"><span class="hljs-number">0</span></span> (<span class="hljs-name"><span class="hljs-name">Varint</span></span>). ID: <span class="hljs-number"><span class="hljs-number">3</span></span> (<span class="hljs-name"><span class="hljs-name">PBLink</span></span>.Size)) <span class="hljs-number"><span class="hljs-number">00</span></span> (: <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">0</span></span>A (: <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-name"><span class="hljs-name">Length-delimited</span></span>). ID: <span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">PBNode</span></span>.Data = Data (<span class="hljs-name"><span class="hljs-name">unixfs</span></span>.proto))) <span class="hljs-number"><span class="hljs-number">02</span></span> (: <span class="hljs-number"><span class="hljs-number">2</span></span> ) <span class="hljs-number"><span class="hljs-number">08</span></span> (: <span class="hljs-number"><span class="hljs-number">0</span></span> (<span class="hljs-name"><span class="hljs-name">Varint</span></span>). ID: <span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">Data</span></span>.Type)) <span class="hljs-number"><span class="hljs-number">01</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span> == Data.DataType.Directory)</code> </pre> <br><p>  Accordingly, a block with two files will look like this: </p><br><pre> <code class="hljs lisp"><span class="hljs-number"><span class="hljs-number">12</span></span> (: <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-name"><span class="hljs-name">Length-delimited</span></span>). ID: <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-name"><span class="hljs-name">PBLink</span></span> PBNode.Links (<span class="hljs-name"><span class="hljs-name">merkledag</span></span>.proto))) <span class="hljs-number"><span class="hljs-number">3</span></span>B (: <span class="hljs-number"><span class="hljs-number">59</span></span> ) <span class="hljs-number"><span class="hljs-number">0</span></span>A (: <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-name"><span class="hljs-name">Length-delimited</span></span>). ID: <span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">PBLink</span></span>.Hash)) <span class="hljs-number"><span class="hljs-number">2</span></span>F (: <span class="hljs-number"><span class="hljs-number">47</span></span> ) <span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">55</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>B (<span class="hljs-name"><span class="hljs-name">CIDv1</span></span> Raw Identity <span class="hljs-number"><span class="hljs-number">43</span></span> ) EFBBBF3C623E3C693E3C753ED09FD180D0B8D0B2D0B5D18220D0BCD0B8D1803C2F753E3C2F693E3C2F623E = <span class="hljs-string"><span class="hljs-string">"Ôªø&lt;b&gt;&lt;i&gt;&lt;u&gt; &lt;/u&gt;&lt;/i&gt;&lt;/b&gt;"</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> (: <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-name"><span class="hljs-name">Length-delimited</span></span>). ID: <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-name"><span class="hljs-name">PBLink</span></span>.Name)) <span class="hljs-number"><span class="hljs-number">06</span></span> (: <span class="hljs-number"><span class="hljs-number">6</span></span> ) <span class="hljs-number"><span class="hljs-number">312E68746</span></span>D6C = <span class="hljs-string"><span class="hljs-string">"1.html"</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> (: <span class="hljs-number"><span class="hljs-number">0</span></span> (<span class="hljs-name"><span class="hljs-name">Varint</span></span>). ID: <span class="hljs-number"><span class="hljs-number">3</span></span> (<span class="hljs-name"><span class="hljs-name">PBLink</span></span>.Size)) <span class="hljs-number"><span class="hljs-number">00</span></span> (: <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">12</span></span> (: <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-name"><span class="hljs-name">Length-delimited</span></span>). ID: <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-name"><span class="hljs-name">PBLink</span></span> PBNode.Links)) <span class="hljs-number"><span class="hljs-number">3</span></span>B (: <span class="hljs-number"><span class="hljs-number">59</span></span> ) <span class="hljs-number"><span class="hljs-number">0</span></span>A (: <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-name"><span class="hljs-name">Length-delimited</span></span>). ID: <span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">PBLink</span></span>.Hash)) <span class="hljs-number"><span class="hljs-number">2</span></span>F (: <span class="hljs-number"><span class="hljs-number">47</span></span> ) <span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">55</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>B (<span class="hljs-name"><span class="hljs-name">CIDv1</span></span> Raw Identity <span class="hljs-number"><span class="hljs-number">43</span></span> ) EFBBBF3C623E3C693E3C753ED09FD180D0B8D0B2D0B5D18220D0BCD0B8D1803C2F753E3C2F693E3C2F623E = <span class="hljs-string"><span class="hljs-string">"Ôªø&lt;b&gt;&lt;i&gt;&lt;u&gt; &lt;/u&gt;&lt;/i&gt;&lt;/b&gt;"</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> (: <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-name"><span class="hljs-name">Length-delimited</span></span>). ID: <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-name"><span class="hljs-name">PBLink</span></span>.Name)) <span class="hljs-number"><span class="hljs-number">06</span></span> (: <span class="hljs-number"><span class="hljs-number">6</span></span> ) <span class="hljs-number"><span class="hljs-number">322E68746</span></span>D6C = <span class="hljs-string"><span class="hljs-string">"2.html"</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> (: <span class="hljs-number"><span class="hljs-number">0</span></span> (<span class="hljs-name"><span class="hljs-name">Varint</span></span>). ID: <span class="hljs-number"><span class="hljs-number">3</span></span> (<span class="hljs-name"><span class="hljs-name">PBLink</span></span>.Size)) <span class="hljs-number"><span class="hljs-number">00</span></span> (: <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">0</span></span>A (: <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-name"><span class="hljs-name">Length-delimited</span></span>). ID: <span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">PBNode</span></span>.Data = Data(<span class="hljs-name"><span class="hljs-name">unixfs</span></span>.proto))) <span class="hljs-number"><span class="hljs-number">02</span></span> (: <span class="hljs-number"><span class="hljs-number">2</span></span> ) <span class="hljs-number"><span class="hljs-number">08</span></span> (: <span class="hljs-number"><span class="hljs-number">0</span></span> (<span class="hljs-name"><span class="hljs-name">Varint</span></span>). ID: <span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">Data</span></span>.Type)) <span class="hljs-number"><span class="hljs-number">01</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span> == Data.DataType.Directory)</code> </pre> <br><p>  That is, the PBNode.Links (0x12) field is repeated as many times as the number of files should be placed in the block. </p><br><p>  To check, add at the beginning of "F 01 70 00" (HEX CIDv1 DAG Identity) and the DAG size of the block "7E" (126 bytes) </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">F</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">70</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> 7E <span class="hljs-number"><span class="hljs-number">12</span></span> 3B 0A 2F <span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">55</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> 2B EFBBBF3C623E3C693E3C753ED09FD180D0B8D0B2D0B5D18220D0BCD0B8D1803C2F753E3C2F693E3C2F623E <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">06</span></span> 312E68746D6C <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> 3B 0A 2F <span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">55</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> 2B EFBBBF3C623E3C693E3C753ED09FD180D0B8D0B2D0B5D18220D0BCD0B8D1803C2F753E3C2F693E3C2F623E <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">06</span></span> 322E68746D6C <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> 0A <span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span></code> </pre> <br><p>  Check: <a href="https://ipfs.io/ipfs/F0170007E123B0A2F0155002BEFBBBF3C623E3C693E3C753ED09FD180D0B8D0B2D0B5D18220D0BCD0B8D1803C2F753E3C2F693E3C2F623E1206312E68746D6C1800123B0A2F0155002BEFBBBF3C623E3C693E3C753ED09FD180D0B8D0B2D0B5D18220D0BCD0B8D1803C2F753E3C2F693E3C2F623E1206322E68746D6C18000A020801">/ ipfs / F0170007E123B0A2F0155002BEFBBBF3C623E3C693E3C753ED09FD180D0B8D0B2D0B5D18220D0BCD0B8D1803C2F753E3C2F693E3C2F623E1206312E68746D6C1800123B0A2F0155002BEFBBBF3C623E3C693E3C753ED09FD180D0B8D0B2D0B5D18220D0BCD0B8D1803C2F753E3C2F693E3C2F623E1206322E68746D6C18000A020801</a> </p><br><h3 id="zaklyuchenie">  Conclusion </h3><br><p>  I hope I gave enough information in order to be able to implement the creation of blocks and identifiers. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/423073/">https://habr.com/ru/post/423073/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../423063/index.html">Epson WorkForce Pro: chronicles of how an office inkjet "overtighted a blanket" from a laser and what it came to today</a></li>
<li><a href="../423065/index.html">The expert Positive Technologies has discovered the possibility of disclosure of encryption keys in Intel ME</a></li>
<li><a href="../423067/index.html">Python Developer Tools from Microsoft. Beginning of work</a></li>
<li><a href="../423069/index.html">Apple Special Event, September 2018 [text archive]</a></li>
<li><a href="../423071/index.html">I'm not afraid of your NDA</a></li>
<li><a href="../423075/index.html">Why are CFOs so eager to translate IT capital expenditures into operational ones?</a></li>
<li><a href="../423077/index.html">X86 assembler guide for beginners</a></li>
<li><a href="../423079/index.html">The main theses of the interview with Ilona Mask Joe Rogan</a></li>
<li><a href="../423083/index.html">How I became a developer at ABBYY</a></li>
<li><a href="../423085/index.html">Fine-tuning load balancing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>