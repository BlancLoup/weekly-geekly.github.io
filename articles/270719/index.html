<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The study of variables Mikrotik. Script update Dynamic DNS records FreeDNS.afraid.org</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I use Mikrotik as a home and office router, and in general I like the system very much. RouterOS has extensive capabilities that cover 90% of my tasks...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The study of variables Mikrotik. Script update Dynamic DNS records FreeDNS.afraid.org</h1><div class="post__text post__text-html js-mediator-article">  I use Mikrotik as a home and office router, and in general I like the system very much.  RouterOS has extensive capabilities that cover 90% of my tasks, if something is missing, then you can add functionality using internal scripts.  But when you start writing a more or less sane script, or you try to understand and apply someone else's recipe, the outlines of the underwater part of the iceberg become noticeable, strange features of the language come up. <br><a name="habracut"></a><br>  I did a little research on the variables in the Mikrotik scripts, reviewed the declaration and initialization under a magnifying glass. <br>  It turned out, in my opinion, a worthy topic for writing an article.  So let's get started. <br><br>  What does Manual: Scripting tell us about variables in scripts?  And he tells us that variables come in two scopes: local and global, that they are declared by commands - <br><br>  <b>: local &lt;name&gt; &lt;value&gt;</b> <br>  and <br>  <b>: global &lt;name&gt; &lt;value&gt;</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I propose to immediately focus on global variables, since they are easier to explore due to their better ‚Äúobservability‚Äù, and most of the conclusions, I think, can be easily transferred to local. <br><br>  Before we declare the first global variable, let's take a look at the features of some built-in data types and character constructs that can be used as variable values ‚Äã‚Äãor arguments of comparison operators. <br><br>  Manual: Scripting tells us that there are about a dozen types, of which we consider only a few that are important for understanding variables.  So, explicit and logical types: numeric <b>num</b> , string <b>str,</b> and <b>array</b> .  Further the type is mentioned (it is the value of the variable) <b>nil</b> , about which it is written that the variable will have it by default if nothing is assigned to it.  Believe it. <br><br>  If you work with the command console in WinBox, you will notice that there is another strange keyword, <b>nothing</b> , which is unclear what some ‚Äúnothing‚Äù means. <br><br><pre><code class="bash hljs">[admin@MikroTik] &gt; :global var0 [admin@MikroTik] &gt; :put [:typeof <span class="hljs-variable"><span class="hljs-variable">$var0</span></span>] nothing [admin@MikroTik] &gt; /environment <span class="hljs-built_in"><span class="hljs-built_in">print</span></span> var0=[:nothing]</code> </pre> <br>  Well, where is <b>nil</b> ?  But full of <b>nothing</b> . <br><br><h1>  Study nil </h1><br>  In general, to deal with these special types and values, we apply a systematic approach, analyze the issuance of the same type of requests, but with different sets of source data.  And at the beginning we will have different ‚Äústrange‚Äù constants and expressions as input data.  The result is the following table: <br><table><tbody><tr><th>  No </th><th>  What is it? </th><th>  &lt;value&gt; </th><th>  &lt;value2&gt; </th><th>  : if (&lt;value&gt; = &lt;value2&gt;) do = {: put TRUE} else = {: put FALSE} </th><th>  : put [: typeof &lt;value&gt;] </th><th>  : put [: typeof <font color="blue">[</font> &lt;value&gt; <font color="blue">]</font> ] </th><th>  : put [: len &lt;value&gt;] </th><th>  : put [: len <font color="blue">[</font> &lt;value&gt; <font color="blue">]</font> ] </th></tr><tr><td>  one </td><td>  <b>Nothing</b> in command wrapper </td><td>  [] / [: nothing] / or even so [:] </td><td>  [] </td><td>  TRUE </td><td>  nil </td><td>  nil </td><td>  0 </td><td>  0 </td></tr><tr><td>  2 </td><td>  Empty line </td><td>  "" </td><td>  "" / <font color="red">{}</font> </td><td>  TRUE </td><td>  str </td><td>  expected command name </td><td>  0 </td><td>  0 </td></tr><tr><td>  3 </td><td>  <b>Nothing</b> inside an expression </td><td>  (: nothing) / or even like this (:) </td><td>  [] / "" / {} </td><td>  FALSE </td><td>  nothing </td><td>  nil </td><td>  0 </td><td>  0 </td></tr><tr><td>  four </td><td>  Array of <b>nothing</b> </td><td>  {: nothing} / {:} </td><td>  {} / <font color="red">"</font> </td><td>  TRUE </td><td>  array </td><td>  nil </td><td>  one </td><td>  one </td></tr><tr><td>  five </td><td>  Array element <b>nothing</b> </td><td>  ({: nothing} -&gt; 0) </td><td>  [] / "" / {} </td><td>  FALSE </td><td>  nothing </td><td>  nil </td><td>  0 </td><td>  0 </td></tr></tbody></table><br>  Here are the results of comparing the various constants of expressions and commands over the constants among themselves.  Understanding the properties of constants will help when writing the right-hand parts of comparison operators. <br><br>  At the expense of the table fields.  In the Mikrotik script language, square brackets denote embedding the result of a command into a general expression, therefore in the general sense of value! = [Value], this is important. <br><br>  I will comment line by line: <br><br>  Line 1: all options for writing the <b>value</b> field are synonymous!  In the future, I suggest using concise <b>[]</b> .  I repeat that square brackets denote embedding the result of a command into a general expression.  As you can see, this is one of the ways to ‚Äúgenerate‚Äù <b>nil</b> not in its pure form, but as the result of an empty command in square brackets, which is exactly equal to <b>nil</b> . <br><br>  Line 2: <br>  It's simple.  An empty string is an obvious thing.  The only moment is that it turns out to be an array of nothing, but I suggest not paying special attention to it.  And you can not use an empty string as a command in square brackets, this is the only place where the terminal has not swallowed the syntax on the source data of the table, it is logical. <br><br>  Line 3: <br>  Parentheses carry an expression, inside you can also put <b>nothing</b> , and the result of such an expression will also be <b>nothing</b> , in fact it is almost pure <b>nothing</b> .  It can be seen that the type of the result of the expression <b>(: nothing)</b> gives <b>nothing</b> , and the type from the wrapper from the command brackets <b>[]</b> gives <b>nil</b> , by analogy with line 1. In general, after reconsidering what was written, I realized that this is speculation, since  anything can be put inside <b>()</b> , any meaningless set of characters, the main thing is that the result <b>(...)</b> gives <b>nothing</b> . <br><br>  Line 4: <br>  An array that contains nothing actually contains 1 element.  The type, as expected, <b>array</b> , the result type of the command wrapper also gives <b>nil</b> <br><br>  Line 5: <br>  We get to the array element from nothing, there is a complete analogy of output with line 3. In general, such an element is also a pure <b>nothing</b> . <br><br>  What general conclusions can be drawn from this strange brainfuck.  <b>nothing</b> really exists, they can be operated on, rare expressions can return it, but the commands in <b>[]</b> never return <b>nothing</b> , only <b>nil</b> .  Another more important conclusion is that the operator of the length of a value or number of array elements <b>: len</b> behaves very stable and generates a predictable result, so I can definitely recommend it for use in scripts when you need to check the values ‚Äã‚Äãreturned by expressions and commands.  And that <b>[] = [: nothing] = nil</b> . <br><br>  The table gives an idea of ‚Äã‚Äãwhat different commands and expressions of the Mikrotik language can return. <br><br><h1>  Study variable declarations </h1><br>  We now turn to a more practical declaration of variables. <br><table><tbody><tr><th>  No </th><th>  What is it? </th><th>  Announcement </th><th>  &lt;val&gt; </th><th>  &lt;val2&gt; </th><th>  : put &lt;val&gt; </th><th>  : if (&lt;val&gt; = &lt;val2&gt;) do = {: put TRUE} else = {: put FALSE} </th><th>  : put [: typeof &lt;val&gt;] </th><th>  : put [: typeof <font color="blue">[</font> &lt;val&gt; <font color="blue">]</font> ] </th><th>  : put [: len &lt;val&gt;] is the same: put [: len <font color="blue">[</font> &lt;val&gt; <font color="blue">]</font> ] </th><th>  / environment print </th></tr><tr><td>  one </td><td>  No assignment </td><td>  : global var1 </td><td>  $ var1 </td><td>  [] / (:) </td><td></td><td>  FALSE / TRUE </td><td>  nothing </td><td>  nil </td><td>  0 </td><td>  var1 = [: nothing] </td></tr><tr><td>  2 </td><td>  Assignment deleting variable </td><td>  : global var2 (: nothing) </td><td>  $ var2 </td><td>  (:) </td><td></td><td>  TRUE </td><td>  nothing </td><td>  nil </td><td>  0 </td><td>  - </td></tr><tr><td>  3 </td><td>  Nil assignment </td><td>  : global var3 [] </td><td>  $ var3 </td><td>  [] </td><td></td><td>  TRUE </td><td>  nil </td><td>  nil </td><td>  0 </td><td>  var3 = [] </td></tr><tr><td>  four </td><td>  Assigning an empty string </td><td>  : global var4 "" </td><td>  $ var4 </td><td>  "" / <font color="red">{}</font> </td><td></td><td>  TRUE / <font color="red">TRUE</font> </td><td>  str </td><td>  str </td><td>  0 </td><td>  var4 = "" </td></tr><tr><td>  5 (3) </td><td>  Strange <b>nil</b> , analog 3 </td><td>  : global var5 [{}] </td><td>  $ var5 </td><td>  [{}] / [] </td><td></td><td>  TRUE / TRUE </td><td>  nil </td><td>  nil </td><td>  0 </td><td>  var5 = [] </td></tr><tr><td>  6 </td><td>  Array of <b>nothing</b> </td><td>  : global var6 {:} </td><td>  $ var6 </td><td>  "" / {""} / {} </td><td></td><td>  TRUE / TRUE / TRUE </td><td>  array </td><td>  array </td><td>  one </td><td>  var6 = {[: nothing]} </td></tr><tr><td>  7 (6, 8) </td><td>  Empty string array </td><td>  : global var7 {""} </td><td>  $ var7 </td><td>  "" / {""} / {} </td><td></td><td>  TRUE / TRUE / TRUE </td><td>  array </td><td>  array </td><td>  one </td><td>  var7 = {""} </td></tr><tr><td>  8 (6, 7) </td><td>  Nil array </td><td>  : global var8 {[]} </td><td>  $ var8 </td><td>  "" / {""} / {} </td><td></td><td>  TRUE / TRUE / TRUE </td><td>  array </td><td>  array </td><td>  one </td><td>  var8 = {[]} </td></tr><tr><th>  No </th><th>  What is it? </th><th>  Announcement </th><th>  &lt;val&gt; </th><th>  &lt;val2&gt; </th><th>  : put &lt;val&gt; </th><th>  : if (&lt;val&gt; = &lt;val2&gt;) do = {: put TRUE} else = {: put FALSE} </th><th>  : put [: typeof &lt;val&gt;] </th><th>  : put [: typeof <font color="blue">[</font> &lt;val&gt; <font color="blue">]</font> ] </th><th>  : put [: len &lt;val&gt;] is the same: put [: len <font color="blue">[</font> &lt;val&gt; <font color="blue">]</font> ] </th><th>  / environment print </th></tr><tr><td>  9 </td><td>  Assignment number </td><td>  : global var9 123 </td><td>  $ var9 </td><td>  n / a </td><td>  123 </td><td>  n. / p. </td><td>  num </td><td>  num </td><td>  3 </td><td>  var9 = 123 </td></tr><tr><td>  ten </td><td>  Assign string </td><td>  : global var10 "987" </td><td>  $ var10 </td><td>  n / a </td><td>  987 </td><td>  n. / p. </td><td>  str </td><td>  str </td><td>  3 </td><td>  var10 = "987" </td></tr><tr><td>  eleven </td><td>  Array of one number </td><td>  : global var11 {555} /: global var11 {555;} </td><td>  $ var11 </td><td>  n / a </td><td>  555 </td><td>  n. / p. </td><td>  array </td><td>  array </td><td>  one </td><td>  var11 = {555} </td></tr><tr><td>  12 </td><td>  Array of disparate elements </td><td>  : global var12 {33; "test123"} </td><td>  $ var12 </td><td>  n / a </td><td>  33; test123 </td><td>  n. / p. </td><td>  array </td><td>  array </td><td>  2 </td><td>  var12 = {33;  "test123"} </td></tr><tr><td>  13 </td><td>  Array element </td><td>  - // - </td><td>  ($ var12-&gt; 0) </td><td>  n / a </td><td>  33 </td><td>  n. / p. </td><td>  num </td><td>  num </td><td>  2 </td><td>  - // - </td></tr><tr><td>  14 </td><td>  Array element </td><td>  - // - </td><td>  ($ var12-&gt; 1) </td><td>  n / a </td><td>  test123 </td><td>  n. / p. </td><td>  str </td><td>  str </td><td>  7 </td><td>  - // - </td></tr><tr><td>  15 </td><td>  Array with <b>nothing</b> element </td><td>  : global var13 {33; (:)} </td><td>  $ var13 </td><td>  n / a </td><td>  33; </td><td>  n. / p. </td><td>  array </td><td>  array </td><td>  2 </td><td>  var13 = {33;  [: nothing]} </td></tr><tr><td>  sixteen </td><td>  Array element </td><td>  - // - </td><td>  ($ var13-&gt; 0) </td><td>  n / a </td><td>  33 </td><td>  n. / p. </td><td>  num </td><td>  num </td><td>  2 </td><td>  - // - </td></tr><tr><td>  17 </td><td>  Array element </td><td>  - // - </td><td>  ($ var13-&gt; 1) </td><td>  n / a </td><td></td><td>  n. / p. </td><td>  nothing </td><td>  nil </td><td>  0 </td><td>  - // - </td></tr><tr><td>  18 </td><td>  Array with <b>nil</b> element </td><td>  : global var14 {1012; []} </td><td>  $ var14 </td><td>  n / a </td><td>  1012; </td><td>  n. / p. </td><td>  array </td><td>  array </td><td>  2 </td><td>  var14 = {1012;  []} </td></tr><tr><td>  nineteen </td><td>  Array element </td><td>  - // - </td><td>  ($ var14-&gt; 1) </td><td>  n / a </td><td></td><td>  n. / p. </td><td>  nil </td><td>  nil </td><td>  0 </td><td>  - // - </td></tr></tbody></table><br>  n / a  - not used;  n. / p.  - not applicable <br><br>  Line comments to the table: <br><br>  1. The variable is created, but nothing is assigned to it.  The variable contains <b>nothing</b> . <br>  2. If we assign such an expression to a variable, this will lead to the removal of the global variable from the environment variables. <br>  3. The standard way to create empty variables.  The variable contains <b>nil</b> . <br>  4. Assigning an empty string.  It's all obvious. <br>  5. It turns out that such an expression is similar to <b>[]</b> simple assignment of <b>nil</b> , as in 3. I think this is because inside <b>[] a</b> non-existent command and the result of this command gives <b>nil</b> <br>  6, 7, 8. Assigning curly brackets makes an array of variables, albeit empty.  Note that the records have the same results in the table, but this does not apply to the properties of the elements of these arrays.  Properties of array elements are discussed below. <br>  9, 10. Simple data types.  It's pretty obvious. <br>  11. Array of one element, note that {555;} results equals {555} <br>  12, 13, 14. The array may include elements of different data types.  The study of the properties of the elements of the array gives predictable results. <br>  15, 16, 17. One of the elements of the <b>nothing</b> array.  The elements of the array have the same properties as the simple variables and constants of these types and values.  There is an analogy with paragraph 2. <br>  18, 19. An analogy with paragraph 3. <br><br>  The study, in my opinion, turned out a little controversial, but I really hope it will bring more order to your understanding of Mikrotik than chaos.  As an additional compensation, I publish a script for working with the dynamic DNS of the wonderful service FreeDNS.afraid.org. <br><br><h1>  Script for FreeDNS.afraid.org </h1><br>  I saw several similar scripts, but I didn‚Äôt like them due to different restrictions, so I decided to assemble my own bike, which would completely suit me. <br><br>  I took the script from <a href="http://forum.mikrotik.com/viewtopic.php%3Ff%3D13%26t%3D83744%26p%3D444954">LESHIYODESSA</a> as a <a href="http://forum.mikrotik.com/viewtopic.php%3Ff%3D13%26t%3D83744%26p%3D444954">basis</a> .  I didn‚Äôt like his algorithm, which used the file to store the current addresses of Dynamic DNS records and periodically parsed it, besides, the script does not support updating different records, it is suggested to duplicate the script for this, but this does not remove the problem of updating the record by the specified IP address  Therefore, in fact, I wrote my own script in which I replaced the work with files with a more reliable periodic update mechanism (with an hourly interval) and a forced update to change the monitored IP addresses of interfaces obtained via DHCP, independent of several entries. <br><br>  We declare arrays of the names of the subdomains of FreeDNS.afraid.org and their hashes, the names of WAN interfaces, with which we will be tracking IP addresses.  And also we set the number of records (Quant) by the size of the array either manually: <br><br><pre> <code class="bash hljs">:<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> SubdomainHashes {<span class="hljs-string"><span class="hljs-string">"U3dWVE5V01TWxPcjluEo0bEtJQWjg5DUz="</span></span>;<span class="hljs-string"><span class="hljs-string">"U3pWV5VFTWxPcjlOEo0EtJpOE1MAyDc="</span></span>} :global DNSDomains {<span class="hljs-string"><span class="hljs-string">"aaa.xyz.pu"</span></span>;<span class="hljs-string"><span class="hljs-string">"bbb.xyz.pu"</span></span>} :global WANInterfaces {<span class="hljs-string"><span class="hljs-string">"ether4-WAN-Inet"</span></span>;<span class="hljs-string"><span class="hljs-string">"ether3-WAN-Beeline"</span></span>} :global Quant [:len <span class="hljs-variable"><span class="hljs-variable">$DNSDomains</span></span>]</code> </pre><br>  We declare auxiliary variables: <br><br>  SkipCounters - an array of checks of monitored interfaces <br>  LastIPs is an array of IP addresses that have already been sent to FreeDNS. <br><br>  An array of counters will allow you to update Dynamic DNS records independently of each other. <br><br>  First, I make an empty variable declaration <b>: global SkipCounters</b> , such a declaration allows you to either create a new global variable, or use the environment that already exists in the environment variables and its value without overwriting it. <br><br>  The following constructions work for the newly created variables, check the data type, if it is not an array, then the type changes to an array, and the values ‚Äã‚Äãof the variables are assigned.  Thus, at the output, we have array variables initialized by necessary values. <br><br><pre> <code class="bash hljs">:global SkipCounters :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([:typeof <span class="hljs-variable"><span class="hljs-variable">$SkipCounters</span></span>] != <span class="hljs-string"><span class="hljs-string">"array"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> SkipCounters {<span class="hljs-string"><span class="hljs-string">""</span></span>} :<span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i from=0 to=(<span class="hljs-variable"><span class="hljs-variable">$Quant</span></span>-1) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={:<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> (<span class="hljs-variable"><span class="hljs-variable">$SkipCounters</span></span>-&gt;<span class="hljs-variable"><span class="hljs-variable">$i</span></span>) 1} } :global LastIPs :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([:typeof <span class="hljs-variable"><span class="hljs-variable">$LastIPs</span></span>] != <span class="hljs-string"><span class="hljs-string">"array"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> LastIPs {<span class="hljs-string"><span class="hljs-string">""</span></span>} :<span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i from=0 to=(<span class="hljs-variable"><span class="hljs-variable">$Quant</span></span>-1) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={:<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> (<span class="hljs-variable"><span class="hljs-variable">$LastIPs</span></span>-&gt;<span class="hljs-variable"><span class="hljs-variable">$i</span></span>) <span class="hljs-string"><span class="hljs-string">""</span></span>} }</code> </pre><br>  Nor the actual tracking-update algorithm itself. <br><br>  We get the current IP address from dhcp-client.  Next is the most interesting. <br><br>  The <b>[/ ip dhcp-client get [find where interface = ($ WANInterfaces -&gt; $ i)] address] command</b> can generally return anything other than the line containing the IP address, so it will normally update the value of the CurrentIP variable.  The return value can be either a string with IP, or nil, or there will be a runtime error and the command will not update CurrentIP.  Therefore, I enter the explicit declaration in the line above <b>: local CurrentIP ""</b> .  And after executing the command in CurrentIP, it will be either "", or nil, or an IP address. <br><br>  As I wrote above, the operator: len has the greatest stability, so we use it further to check the adequacy of the data <b>[: len $ CurrentIP]&gt; 0</b> .  We also track the value of the counter, and if it is&gt; = 60, we forcefully send the request to FreeDNS.  This increases the stability of the algorithm to communication problems.  I run the script in the scheduler once a minute, so the mandatory update period is about 1 hour, which does not burden the FreeDNS service. <br><br>  What else you should pay attention.  The URL of the update request contains the parameter "&amp; address =". $ CurrentIP, this parameter allows you to explicitly specify the IP address for the subdomain instead of the automatic one (on the interface from which the request left). <br><br><pre> <code class="bash hljs">:<span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i from=0 to=(<span class="hljs-variable"><span class="hljs-variable">$Quant</span></span>-1) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> CurrentIP <span class="hljs-string"><span class="hljs-string">""</span></span> :<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> CurrentIP [/ip dhcp-client get [find <span class="hljs-built_in"><span class="hljs-built_in">where</span></span> interface=(<span class="hljs-variable"><span class="hljs-variable">$WANInterfaces</span></span>-&gt;<span class="hljs-variable"><span class="hljs-variable">$i</span></span>)] address] :<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> CurrentIP [:pick <span class="hljs-variable"><span class="hljs-variable">$CurrentIP</span></span> 0 ([:len <span class="hljs-variable"><span class="hljs-variable">$CurrentIP</span></span>]-3)] <span class="hljs-comment"><span class="hljs-comment"># :log info ("Current SkipCounter$i: ".($SkipCounters-&gt;$i)) :if ([:len $CurrentIP] &gt; 0 and ($CurrentIP != ($LastIPs-&gt;$i) or ($SkipCounters-&gt;$i) &gt; 59)) do={ :if ($CurrentIP != ($LastIPs-&gt;$i)) do={ :log info ("Service Dynamic DNS: Renew IP: ".($LastIPs-&gt;$i)." for ".($DNSDomains-&gt;$i)." to $CurrentIP") } /tool fetch url=("http://freedns.afraid.org/dynamic/update.php\?".($SubdomainHashes-&gt;$i)."&amp;address=".$CurrentIP) keep-result=no :set ($LastIPs-&gt;$i) $CurrentIP :set ($SkipCounters-&gt;$i) 1 } else={ :set ($SkipCounters-&gt;$i) (($SkipCounters-&gt;$i) + 1) } }</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">The entire MultiFreeDNS script</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># MultiFreeDNS :local SubdomainHashes {"U3dWVE5V01TWxPcjluEo0bEtJQWjg5DUz=";"U3pWV5VFTWxPcjlOEo0EtJpOE1MAyDc="} :global DNSDomains {"aaa.xyz.pu";"bbb.xyz.pu"} :global WANInterfaces {"ether4-WAN-Inet";"ether3-WAN-Beeline"} :global Quant [:len $DNSDomains] :global SkipCounters :if ([:typeof $SkipCounters] != "array") do={ :set SkipCounters {""} :for i from=0 to=($Quant-1) do={:set ($SkipCounters-&gt;$i) 1} } :global LastIPs :if ([:typeof $LastIPs] != "array") do={ :set LastIPs {""} :for i from=0 to=($Quant-1) do={:set ($LastIPs-&gt;$i) ""} } :for i from=0 to=($Quant-1) do={ :local CurrentIP "" :set CurrentIP [/ip dhcp-client get [find where interface=($WANInterfaces-&gt;$i)] address] :set CurrentIP [:pick $CurrentIP 0 ([:len $CurrentIP]-3)] # :log info ("Current SkipCounter$i: ".($SkipCounters-&gt;$i)) :if ([:len $CurrentIP] &gt; 0 and ($CurrentIP != ($LastIPs-&gt;$i) or ($SkipCounters-&gt;$i) &gt; 59)) do={ :if ($CurrentIP != ($LastIPs-&gt;$i)) do={ :log info ("Service Dynamic DNS: Renew IP: ".($LastIPs-&gt;$i)." for ".($DNSDomains-&gt;$i)." to $CurrentIP") } /tool fetch url=("http://freedns.afraid.org/dynamic/update.php\?".($SubdomainHashes-&gt;$i)."&amp;address=".$CurrentIP) keep-result=no :set ($LastIPs-&gt;$i) $CurrentIP :set ($SkipCounters-&gt;$i) 1 } else={ :set ($SkipCounters-&gt;$i) (($SkipCounters-&gt;$i) + 1) } }</span></span></code> </pre><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/270719/">https://habr.com/ru/post/270719/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270699/index.html">Instant File Initialization</a></li>
<li><a href="../270705/index.html">Top 50 CSS and JavaScript Development Tools</a></li>
<li><a href="../270707/index.html">Language selection (Haskell vs Go)</a></li>
<li><a href="../270711/index.html">The best reports of the DotNext 2015 Piter conference. Part 1 (Video inside)</a></li>
<li><a href="../270713/index.html">Introduction to the Storage Performance Development Kit</a></li>
<li><a href="../270723/index.html">Participate in the Russian application week - Russian AppFest</a></li>
<li><a href="../270725/index.html">Programming smart indicator LaMetric</a></li>
<li><a href="../270729/index.html">Stop talking, it's time to break.</a></li>
<li><a href="../270731/index.html">Experience of using the cloud in managing access control to databases in a software project</a></li>
<li><a href="../270733/index.html">Video transmission at frequencies up to 100 MHz in PC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>