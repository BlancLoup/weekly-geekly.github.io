<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Architecture and Programming RCA Studio II</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúFinally, we‚Äôve come to the instruction!‚Äù 
 / from CDP1802 microprocessor article / 


 In the early 1970s, simple electronic games like Pong were ver...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Architecture and Programming RCA Studio II</h1><div class="post__text post__text-html js-mediator-article"><p>  <i>‚ÄúFinally, we‚Äôve come to the instruction!‚Äù</i> <i><br></i>  <i>/ from CDP1802 microprocessor article /</i> </p><br><img src="https://habrastorage.org/webt/mk/gh/7j/mkgh7jq8ovzjr98qgrw3zfx3bow.jpeg"><br><br>  In the early 1970s, <a href="https://en.wikipedia.org/wiki/First_generation_of_video_game_consoles">simple electronic games</a> like <a href="https://en.wikipedia.org/wiki/Pong">Pong</a> were very popular in the United States (in the USSR, their <a href="https://ru.wikibooks.org/wiki/%25D0%25A1%25D0%25BE%25D0%25B2%25D0%25B5%25D1%2582%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B5_%25D1%2582%25D0%25B5%25D0%25BB%25D0%25B5%25D0%25B2%25D0%25B8%25D0%25B7%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B5_%25D0%25B8%25D0%25B3%25D1%2580%25D0%25BE%25D0%25B2%25D1%258B%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25B8%25D1%2581%25D1%2582%25D0%25B0%25D0%25B2%25D0%25BA%25D0%25B8/%25D0%25A4%25D0%25B0%25D0%25B1%25D1%2580%25D0%25B8%25D1%2587%25D0%25BD%25D1%258B%25D0%25B5_%25D1%2582%25D0%25B5%25D0%25BB%25D0%25B5%25D0%25B8%25D0%25B3%25D1%2580%25D1%258B">counterparts</a> went on sale in 5-10 years).  As a rule, such games did not have a microprocessor and memory in the modern sense of these words, but were built on rigid logic.  Accordingly, replaceable cartridges did not make much sense, and where they were - <a href="https://en.wikipedia.org/wiki/Magnavox_Odyssey">it was</a> just a set of jumpers that included the desired game. <br><br>  In 1977, two consoles were released almost simultaneously: the <a href="https://en.wikipedia.org/wiki/Fairchild_Channel_F">Fairchild Channel F</a> and <a href="https://en.wikipedia.org/wiki/RCA_Studio_II">RCA Studio II</a> .  These were the first game consoles in the form of full-fledged computers - with a microprocessor and programs on replaceable cartridges. The RCA Studio II prefix, which we are talking about, is a development not only of <a href="https://en.wikipedia.org/wiki/RCA">RCA</a> , but of a specific person - <a href="http://www.cosmacelf.com/history/joseph-weisbecker.html">Joseph A. Weisbecker</a> . <br><a name="habracut"></a>  The first such device, <a href="http://www.cosmacelf.com/gallery/system-00.html">System 00</a> , also known as COSMAC FRED (1971) was a prototype and was not mass-produced. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/webt/9r/tg/he/9rtghexs8miwoxqkq3vjejk_xyu.jpeg"></div><br>  The processor in it was implemented on the usual logic (in <a href="http://www.retrotechnology.com/memship/cosmac_fred2.html">FRED2</a> - on two chips under the name CDP1801 R and U, which appeared in 1973).  RAM was in the region of 256 bytes - 4 kb, in addition to FRED2 was built-in tape. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gq/bl/zh/gqblzh1bed2y3zcuiev8apbtpjm.jpeg"></div><br>  The first commercial implementation of the COSMAC architecture was the <a href="https://en.wikipedia.org/wiki/COSMAC_ELF">COSMAC ELF</a> device.  In 1976, ELF was positioned as a computer for radio amateurs (a series of articles was <a href="http://www.exemark.com/Microcontrollers/PopularElecwebc.pdf">published</a> in Popular Electronics) and was a small board with toggle switches, indicators, a microprocessor CDP1802 (the same 1801, but already in one chip) and 256 bytes of RAM.  For it, there were additional expansion cards that allowed displaying graphics on a monitor (using a CDP1861 chip), an external keyboard and a tape recorder were connected.  ELF II and VIP appeared on the basis of ELF with extensions.  In the COSMACs ROM, there was a virtual machine called CHIP-8, sharpened for primitive games (commands for outputting and moving software sprites, generating random numbers, etc.) There were other primitive computers and terminals based on this architecture. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vq/si/wo/vqsiwo3wbrmq0xda5uaj5wzerxu.jpeg"></div><br>  All these devices were direct predecessors of RCA Studio II and have an extremely close both hardware and software architecture. <br><br>  RCA Studio II was released in 1977 and was then sold at a price of $ 150 ($ 600 for current money).  As is often the case, the first on the market is not necessarily the most successful.  In 2008, PC World magazine <a href="https://www.pcworld.com/article/168348/software-games/worst-game-consoles.html">recognized</a> this console as the worst gaming console of all time (which, in principle, not far from the truth). A black and white image of squares, no joysticks (two fields of 10 buttons instead) and a dozen games - to put it mildly pleased customers. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/-j/d-/nu/-jd-nu-kdtmskwkfi1sfiw7n8ag.jpeg"></div><br>  In addition, all the games (both embedded and sold on cartridges) were written in the pseudocode of the ST2 virtual machine (the same idea as with CHIP-8 in COSMACs), which is why it was very slow. <br><br>  RCA managed to release about 64 thousand units of RCA Studio II, not counting the clones that appeared later (Toshiba Visicom, Conic M-1200, etc.). With the appearance of <a href="https://en.wikipedia.org/wiki/Atari_2600">Atari VCS</a> , the outdated RCA Studio II and Fairchild Channel F instantly dropped out of the fight. <br><br><h1>  CPU </h1><br>  As a chip maker, RCA chose its own product as a set-top box processor ‚Äî the <a href="https://en.wikipedia.org/wiki/RCA_1802">RCA</a> microprocessor <a href="https://en.wikipedia.org/wiki/RCA_1802">CDP1802</a> , operating at 1.78 MHz and manufactured using CMOS technology. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ll/4n/zl/ll4nzlkx0bxu1aodzw4lbbotne8.jpeg"></div><br>  Its predecessor was the CDP1801 two-chip processor (fully compatible with 1802): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uf/bn/uc/ufbnuczc-cjvw9iclwf_zjrpd8i.jpeg"></div><br>  CDP1802 is known for its radiation-resistant version (silicon on sapphire), in which it was used, for example, at the <a href="https://history.nasa.gov/computers/Ch6-3.html">Galileo</a> interplanetary station, flying to Jupiter in the 1990s (there were 6 such processors), as well as in <a href="http://www.retrotechnology.com/memship/magsat_command.pdf">MAGSAT</a> . <br><br>  The processor has a rather tricky register usage pattern.  It has one 8-bit battery D and sixteen 16-bit registers - R0..RF (R0-R15), each of which can become a command pointer, depending on the contents of the 4-bit register P (pointing to one of R), changeable team sep rn.  In other words - there is no single PC in the processor! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bj/fh/ft/bjfhfttd1jg8bozbot-goad9xt8.png"></div><br>  In addition, any of R0 ... R15 can become an index (address).  The selection is determined based on the value in the 4-bit register X (modified by the command SEX Rn), after which the selected R is considered to be index for some commands. <br><br>  R0 is always used as an address register for DMA.  Inside the interrupt, the instruction counter is R1. <br><br>  There is an 8-bit T register, which is used to automatically save the X and P registers in it when an interrupt occurs.  Interrupts are enabled by setting the Interrupt Enable (IE) interrupt flag via the RET or DIS commands. <br><br>  The 4-bit registers I and N contain the instruction currently executed by the processor. <br><br>  There is a register of flags - DF.  More precisely, one flag, since it is single-bit and contains only the carry flag. <br><br>  In addition, the processor has a one-bit Q output port, the state of which is changed by the SEQ and REQ commands. <br><br>  As in many processors of that generation, the stack in the usual sense is absent here (there are no PUSH, POP commands, or a stack pointer) and, if necessary, is implemented by the existing instructions. <br><br>  There are no traditional instructions for calling subroutines either.  The transition to the subroutine is carried out using the instruction SEP Rn which, I recall, makes the specified Rn register the instruction counter.  For the return, the same SEP instruction is used, but with the register that was the instruction counter before the call.  Or (in a more universal, but slower version) is used MARK and RET. <br><br>  In addition to traditional conditional and unconditional jumps (by the way - they are all absolute), there are several SKIP instructions that, if the condition is met, skip the instruction following the SKIP (two bytes).  Provided and unconditional SKIP. <br><br>  The 1802 processor is often mentioned as one of the first RISC processors.  However, in the same context, for example, 6502 is mentioned, as well as some others.  It is certain that the architecture is not quite ordinary and, from the point of view of programming, causes mixed feelings.  On the one hand, there are already sixteen 16-bit registers.  On the other hand, their content itself can only be reduced and increased by one.  For example, putting a constant in Rn looks like this: <br><br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">ldi</span></span> <span class="hljs-variable"><span class="hljs-variable">$01</span></span> ; <span class="hljs-attribute"><span class="hljs-attribute">const</span></span> -&gt; D plo r6 ; <span class="hljs-attribute"><span class="hljs-attribute">D</span></span> -&gt; R6.<span class="hljs-number"><span class="hljs-number">0</span></span> ldi <span class="hljs-variable"><span class="hljs-variable">$02</span></span> ; <span class="hljs-attribute"><span class="hljs-attribute">const</span></span> -&gt; D phi r6 ; <span class="hljs-attribute"><span class="hljs-attribute">D</span></span> -&gt; R6.<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  Therefore, the lion's share of the code is moving the bytes back and forth. <br><br>  From the transitions by the condition there is, in practice, only a transition by zero (only the situation when 0 is in the battery D is considered) and the transfer flag.  Typical cycles are as follows: <br><br><pre> <code class="hljs rust"><span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>: ... dec r7 ; R7-- glo r7 ; R7 -&gt; D bnz <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>: ... adi <span class="hljs-number"><span class="hljs-number">2</span></span> ; D = D + <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> xri $<span class="hljs-number"><span class="hljs-number">07</span></span> ; compare using XOR. (D == <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>) -&gt; D bnz <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span></code> </pre><br>  All arithmetic and logical instructions work only with battery D. <br><br>  In addition to the one-bit port controlled by SEQ / REQ, there is also a four-bit one that is controlled by OUT / INP commands.  Unfortunately, it is not used in RCA Studio II. <br><br><h1>  MEMORY </h1><br>  Available: 2 kB of ROM (BIOS + five built-in games) 512 bytes of RAM (half allocated for video) <br>  Memory card <br><br><pre> <code class="hljs pgsql"><span class="hljs-number"><span class="hljs-number">000</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>FF ROM RCA <span class="hljs-keyword"><span class="hljs-keyword">System</span></span> ROM :   SP2 <span class="hljs-number"><span class="hljs-number">300</span></span><span class="hljs-number"><span class="hljs-number">-3</span></span>FF ROM RCA <span class="hljs-keyword"><span class="hljs-keyword">System</span></span> ROM : BIOS <span class="hljs-number"><span class="hljs-number">400</span></span><span class="hljs-number"><span class="hljs-number">-7</span></span>FF ROM   (    ) <span class="hljs-number"><span class="hljs-number">400</span></span><span class="hljs-number"><span class="hljs-number">-7</span></span>FF ROM  ( ) <span class="hljs-number"><span class="hljs-number">1024</span></span> <span class="hljs-number"><span class="hljs-number">800</span></span><span class="hljs-number"><span class="hljs-number">-8</span></span>FF RAM   (<span class="hljs-number"><span class="hljs-number">256</span></span> ) <span class="hljs-number"><span class="hljs-number">900</span></span><span class="hljs-number"><span class="hljs-number">-9</span></span>FF RAM  (<span class="hljs-number"><span class="hljs-number">256</span></span> ) A00-BFF ROM  ( ) C00-DFF <span class="hljs-comment"><span class="hljs-comment">---  ,  800-9FF E00-FFF ROM  (  )</span></span></code> </pre><br>  It is necessary to specifically stipulate that for games and programs on cartridges only part of the BIOS is available - the one that contains SP2 (unnecessary, by and large), images of numbers from 0 to 9 and the standard interrupt handler for video. <br><br><h1>  VIDEO </h1><br>  For graphics, use the <a href="https://en.wikipedia.org/wiki/RCA_CDP1861">RCA</a> chip <a href="https://en.wikipedia.org/wiki/RCA_CDP1861">CDP1861</a> - the so-called "Pixie". <br><br>  The standard RCA Studio II only has a regular antenna output (RF), however, people <a href="http://rcastudio2.blogspot.com/2016/01/av-modding-rca-studio-ii-with-other.html">convert</a> it into a composite one so that the quality is better (I almost wrote - ‚Äúfor better color rendering‚Äù :)) <br><br>  Technically, the video controller provides a maximum resolution of 64x128 with two colors (black and white).  However, this requires 1024 bytes of video memory, and in Studio II the total amount of RAM is 512 bytes.  Therefore, the resolution is 64x32 (which requires 256 bytes). The horizontal resolution (64) is fixed.  In one line of 64 pixels, 8 bytes is always displayed, and this happens within 14 processor cycles. <br><br>  To display the memory ($ 900- $ 9ff) on the screen, use the BIOS interrupt handler.  The interrupt is initiated by the video controller and occurs 60 times per second (NTSC). The BIOS handler performs all the necessary operations ‚Äî the executable program only needs to change the video memory in which each bit directly corresponds to a black or white dot (from left to right, top to bottom). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v7/je/o0/v7jeo04e-mjct0istz6nibhwhb8.jpeg"></div><br>  However, nothing prevents you from writing your handler.  The simplest case is the resolution of 64x128, since it is natural for the video controller.  For it, in the handler, it is enough to only write the address of video memory to R0 (where the data will be taken for display) and the bytes will start to be displayed via DMA themselves filling the frame. Vertical resolutions other than 128 are more complicated. There you will have to enter delays and duplicate data, changing R0 (see description of cdp1861 and BIOS sources). <br><br>  In principle, you can even make a variable vertical resolution, not output anything to a part of the screen, and also specify ROM as a video memory, not RAM (or partially ROM, and partially RAM). You can also implement vertical scrolling by changing the initial address from which data starts to be issued to the controller. <br><br>  Note that at the INT output of the video controller, the unit appears two lines before the beam reaches the visible area.  Therefore, the interrupt handler usually starts with a delay that allows you to start mapping memory on time. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ki/iz/61/kiiz61bjveeghnz-kszzgkbk7sq.jpeg"></div><br>  The video controller also has an EFX output, on which 0 appears over 4 lines before the beam appears in the visible area and then throughout the 4 last lines of this area.  The EFX output is connected to the EF1 of the processor and its status can be checked with command B1 (BN1). <br><br>  Typical waiting for the return path on the frame is implemented as follows: <br><br><pre> <code class="hljs bash">... delay: bn1 delay ; <span class="hljs-built_in"><span class="hljs-built_in">wait</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> EFX <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> video chip ...</code> </pre><br>  As already noted above, in the ROM there are no images of letters and characters.  However, there are still numbers (after all, in built-in games you need to somehow show points and player numbers).  However, even here they managed to save: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gh/4i/n7/gh4in7xalq8tj644tsvuzw37l2s.jpeg"></div><br>  As you can see, the figures are molded so that the remaining ones are made from several adjacent ones. <br><br><h1>  SOUND </h1><br>  Let's just say - there is sound.  But not more.  The NE555 is attached to a single single-bit output port of the CDP1802 with a harness, and then it is all connected to the speaker built into the console. When a unit is fed to the RST NE555 (command of the SEQ processor), it starts squeaking at 625 Hz.  When zero (command REQ) - squeaks.  Actually that's all.  However, there is still a capacitor due to which, at the beginning of a squeak, the frequency within 0.4 seconds smoothly decreases twice (i.e., some additional screeching is obtained). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/u5/zc/ru/u5zcruby6bg3hbe5b-kwfrzauvy.jpeg"></div><br>  In the standard BIOS interrupt handler, in addition to the part responsible for the video, there is a piece that checks the contents of a specific memory cell and, if there is not zero, turns on the squeak and starts cyclically decreasing the contents of the $ 08CD cell (when zero is reached, the squeak turns off).  Thus, you can not bother with self-recording in the port, but simply set the duration of the squeak and it will occur in the background, without stopping the program: <br><br><pre> <code class="hljs perl"> ldi $8cd &amp; $ff plo rf ldi <span class="hljs-number"><span class="hljs-number">250</span></span> ;   str rf ...</code> </pre><br>  The same can be done manually (after turning off the interrupts): <br><br><pre> <code class="hljs pgsql">;   sex r3 ; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> X <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> R3 dis ; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> X <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> R5, P <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> R3, <span class="hljs-number"><span class="hljs-number">0</span></span>-IE, R3=R3+<span class="hljs-number"><span class="hljs-number">1</span></span> db <span class="hljs-number"><span class="hljs-number">53</span></span>h ; forces X=<span class="hljs-number"><span class="hljs-number">5</span></span> P=<span class="hljs-number"><span class="hljs-number">3</span></span> - which <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> change ;   seq ;   ldi <span class="hljs-number"><span class="hljs-number">250</span></span> ; delay plo r6 delay: <span class="hljs-type"><span class="hljs-type">dec</span></span> r6 glo r6 bnz delay ;   req ;    sex r3 ; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> X <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> R3 ret ; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> X <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> R5, P <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> R3, <span class="hljs-number"><span class="hljs-number">1</span></span>-IE, R3=R3+<span class="hljs-number"><span class="hljs-number">1</span></span> db <span class="hljs-number"><span class="hljs-number">53</span></span>h ; forces X=<span class="hljs-number"><span class="hljs-number">5</span></span> P=<span class="hljs-number"><span class="hljs-number">3</span></span> - which <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> change</code> </pre><br><br><h1>  PROGRAMS </h1><br>  In the 1970s, a little more than a dozen games and several other programs were written (mostly by RCA itself).  Almost all of them were written not in assembler, but in <a href="http://bitsavers.org/components/rca/cosmac/Programming_Manual_for_STUDIO_III_Sep77.pdf">pseudocode</a> - a special interpreter-virtual machine ST2 is in the ROM of the device.  It is difficult to say exactly what motivated this decision.  Most likely, the idea was to save memory - the games really turn out to be significantly less in volume.  In general, ST2 ears grow from a similar VM called <a href="https://en.wikipedia.org/wiki/CHIP-8">CHIP-8</a> , used in COSMACs.  Although both VMs are incompatible with each other, already in the 2000s a CHIP-8 interpreter for RCA Studio II was written.  Given the extreme similarity of the architectures, it is not surprising that, as the interpreter's author writes, games with COSMACs that did not require a lot of memory were launched without problems on RCA Studio II. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/9hdkirBlUIg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Alas, the VM on such an architecture works very slowly, which leaves an indelible imprint on the games themselves.  Later, in 2013, Paul Robson wrote about a dozen more games - already in assembler and <a href="https://github.com/paulscottrobson/studio2-games">distributed</a> them with source code. <br><br><h1>  DEVELOPMENT </h1><br>  Initially, according to witnesses, the development for RCA Studio II was carried out even without an assembler - on COSMAC ELF and FRED2. <br><br>  At present, there is no need to suffer this way.  There is a decent emulator under Windows - <a href="https://www.emma02.hobby-site.com/studio.html">Emma</a> , with a good debugger (by the way, it emulates not only RCA Studio II, but all COSMACs as well). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xe/oc/k7/xeock7zoxghone2p9pevv3hlzbm.jpeg"></div><br>  As an assembler, I first tried to use <a href="http://www.retrotechnology.com/memship/a18.html">a18 a cross-assembler,</a> but for several reasons, I ended up with <a href="http://www.retrotechnology.com/memship/asmx.html">asmx</a> , which also has Python <a href="https://github.com/paulscottrobson/studio2-games/tree/master/Games">scripts</a> for generating the finished image of the cartridge (it has the .st2 extension). <br><br>  A brief introduction to the 1802 assembler can be found <a href="http://www.ittybittycomputers.com/IttyBitty/ShortCor.htm">here</a> .  The simplest test.asm for RCA Studio II with an infinite loop will look like this: <br><br><pre> <code class="hljs pgsql"> .<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "1802.inc" .org <span class="hljs-number"><span class="hljs-number">400</span></span>h .db <span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span> ; SYS <span class="hljs-meta"><span class="hljs-meta">$402</span></span> <span class="hljs-keyword"><span class="hljs-keyword">start</span></span>: br <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">some</span></span> code .<span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Pay attention to the instruction ".db 4,2".  This is the address of the first instruction to be executed, i.e.  ".db&gt; (start), &lt;(start)". <br><br>  Implementing a simple loop: <br><br><pre> <code class="hljs pgsql"> ldi <span class="hljs-number"><span class="hljs-number">50</span></span> ;    D   plo r6 ;    D     r6 <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>: <span class="hljs-type"><span class="hljs-type">dec</span></span> r6 ; r6 = r6 <span class="hljs-number"><span class="hljs-number">-1</span></span> glo r6 ;     r6   D bnz <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> ;    <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>    D  </code> </pre><br>  Using SKIP instructions: <br><br><pre> <code class="hljs rust">; q = <span class="hljs-number"><span class="hljs-number">0</span></span>   $FF00 ,  q=<span class="hljs-number"><span class="hljs-number">1</span></span>   $FF  <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>: ghi r1 ; hi(r1) -&gt; D lsz ;   <span class="hljs-number"><span class="hljs-number">2</span></span> ,   D  (..   seq) req ; <span class="hljs-number"><span class="hljs-number">0</span></span> -&gt; Q skp ;   <span class="hljs-number"><span class="hljs-number">1</span></span>     (..   inc r1) seq ; <span class="hljs-number"><span class="hljs-number">1</span></span> -&gt; Q inc r1 ; r1 = r1 + <span class="hljs-number"><span class="hljs-number">1</span></span> br <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> ;  ...</code> </pre><br>  To practice in the pure CDP1802 assembler, it is convenient to use the <a href="https://www.asm80.com/">asm80</a> assembler-emulator <a href="https://www.asm80.com/">online</a> .  The extension of the source file being created must be .a18 <br><br>  To run the finished application on a real gland in nature there is a cartridge <a href="http://atariage.com/forums/topic/256935-rca-studio-ii-multicart/">RCA Studio II 40th Anniversary Multicart</a> .  I did not have it, but tnt23 redid one of the existing cartridges with the game under the EEPROM AT28C16 chip (2k x 8) installed in the socket. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lm/o1/cb/lmo1cbrxztmmaf8ufqc2dulos1g.jpeg"></div><br>  So, to run on a piece of iron, I inserted the chip into the programmer each time, flashed it, rearranged it into a converted cartridge, turned on the set-top box.  And so every time. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fp/s7/4n/fps74ndjanubcdqewbzktklheco.jpeg"></div><br><br><h1>  INTRO "NO SHADERS" </h1><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/py/sw/u-/pyswu-iacgl1gla9-txezpndig8.jpeg"></div><br>  In order to master the platform, I wrote 256 bytes intro (presented at the <a href="https://chaosconstructions.ru/">Chaos Constructions'2018</a> in the <a href="https://chaosconstructions.ru/compos">Tiny intro</a> competition). <br><br>  Unlike, say, from <a href="http://hype.retroscene.org/blog/dev/536.html">Vectrex</a> , where you can get a spectacular picture even by simply drawing a curve or from <a href="http://hype.retroscene.org/blog/dev/537.html">Videopac</a> , where the ROM already has a set of images of little men, here we have a sad situation - an ordinary, familiar, raster graphics, but black and white and the resolution is nowhere below (64x32).  In the ROM, there is not that pictures, but even characters.  Sound - and that is limited by the frequency of 625 Hz. <br><br>  Thus, the music was canceled, all types of plasma, lights and in general everything that implies non-square contours.  The text in any form was also canceled - there would not be enough space for letters. <br><br>  As a result, it was decided to a) scroll b) something repetitive c) at different speeds. It turned out like this: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Y75XFcLE30Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  As mentioned above, there is no hardware scrolling in the video controller.  However, low resolution and black and white not only have minuses, but also pluses - less bytes are rewritten. <br><br>  I scrolled line by line, via the shlc command (left shift with transfer) - when executed in a loop, it turns out that the leftmost bit from the next byte is shifted to the left and does not disappear, but placed in the carry flag (DF).  Accordingly, the next shlc in the loop picks it up and places it in the byte to the left.  It turns out a simple scrolling of the entire line, which will scroll eight times in a cycle (since it is convenient to take patterns of clouds and houses byte-by-byte) <br><br><pre> <code class="hljs rust">... scrollret: sep r3 ; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> from subroutine ;   scroll: ; set lines counter ldi LINES ; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> -&gt; D plo r10 ; D -&gt; Rn.<span class="hljs-number"><span class="hljs-number">0</span></span> nextline: ; set bytes counter ldi BYTES_PER_LINE ; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> -&gt; D plo r7 ; D -&gt; Rn.<span class="hljs-number"><span class="hljs-number">0</span></span> ; set carry to scroll glo r12 ; Rn -&gt; D shr ; get one bit to set carry plo r12 ; D -&gt; Rn.<span class="hljs-number"><span class="hljs-number">0</span></span> (save shifted byte) nextbyte: ldx ; Rx -&gt; D shlc ; D = D &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span> (carry -&gt; DF) stxd ; D -&gt; M(Rx), Rx-- dec r7 ; Rn-- glo r7 ; Rn -&gt; D bnz nextbyte dec r10 ; Rn-- glo r10 ; Rn -&gt; D bnz nextline ; one line (<span class="hljs-number"><span class="hljs-number">8</span></span> bytes) scrolled, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span><span class="hljs-symbol"><span class="hljs-symbol">'s</span></span> scroll next br scrollret ...</code> </pre><br>  Note that the entry point to the subroutine is on the scroll label, and to return, it is not just sep r3 that is executed, but first the br scrollret and already from there sep r3. <br><br>  This is done in order to leave r14 (which is the instruction counter inside the subroutine) in the correct state, then the subroutine can be called again and again (using sep r14). <br><br>  Of course, no variables are saved here when calls are made - all registers-variables are global. <br><br>  The scroll subroutine is called twice in the general cycle - every second time for houses and every fourth time for clouds (they scroll slower).  The overall cycle is synchronized in the reverse direction of the beam (the road, at home, the clouds - they have time to draw, the stars are static).  In the case of the road, only one line scrolls - the edges of the road are simply drawn with lines. <br><br>  I, for the sake of interest, tried to scroll the entire screen ‚Äî it doesn‚Äôt fit a bit in time. <br><br>  Houses are given by patterns: <br><br><pre> <code class="hljs css">... <span class="hljs-selector-tag"><span class="hljs-selector-tag">house1</span></span>: <span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> %00000000 <span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> %11111111 <span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> %10101010 <span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> %11111111 <span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> %10101010 <span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> %11111111 <span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> %00000000 <span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> 1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">house2</span></span>: <span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> %00000000 <span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> %00011111 <span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> %01110101 <span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> %01011111 <span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> %01110101 <span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> %00011111 <span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> %00000000 <span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> 1 ...</code> </pre><br>  and a sign with a link to each: <br><br><pre> <code class="hljs css">... <span class="hljs-selector-tag"><span class="hljs-selector-tag">commands</span></span>: <span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">house5</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">house2</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">house1</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">house3</span></span> ...</code> </pre><br>  In the loop, this label is sequentially sorted. <br><br>  Unlike houses, both clouds, for simplicity, are a single pattern that simply cycles. <br><br>  A certain number of bytes could be won due to the output of clouds on the same principle as the houses, as well as due to the program intervals between the patterns (now they are just repeated zeros in the data). <br><br>  The problem, however, is that the part of the registers is used by the interrupt handler - R0, R1, R2, R8, R9, R11 cannot be changed.  And storing variables in memory is a lot of extra bytes on their writing and reading (not to mention the ticks). <br><br>  Ideally, you probably should have scrolled in the interrupt handler.  However, for this you would have to write your handler instead of the standard one.  It would be more correct (and, in passing, could release a couple of R registers), but, most likely, in the end, everything would not fit into 256 bytes. <br><br>  As for the stars, they are static, however, to draw a few points that look randomly located, suddenly turned out to be not so simple: <br><br><pre> <code class="hljs rust">... <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>: ldn r4 ; M[Rn] -&gt; D ani %<span class="hljs-number"><span class="hljs-number">00000010</span></span> ; D AND <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> -&gt; D bdf skip ; jump <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> carry ldi <span class="hljs-number"><span class="hljs-number">0</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> -&gt; D skip: stxd ; D -&gt; M(Rx), Rx-- glo r4 ; Rn -&gt; D adi <span class="hljs-number"><span class="hljs-number">47</span></span> ; D + <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> -&gt; D plo r4 ; Rn -&gt; D glo r15 ; Rn -&gt; D bnz <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> ...</code> </pre><br>  Here, in the cycle, data is taken from the BIOS, which is thinned out and extra bits are masked.  Mask (for ani) and step (for adi) are selected manually. <br><br>  As for the sound, the impossibility to change the frequency is simply imitated by the ‚Äúbeeps‚Äù of the car. <br><br>  By the way - I believe that this intra is the first demo-stage work for RCA Studio II :) <br><br><h1>  EPILOGUE </h1><br>  After Studio II, RCA released several copies of <a href="http://bitsavers.org/components/rca/cosmac/Programming_Manual_for_STUDIO_III_Sep77.pdf">RCA Studio III</a> .  Differences in two things - the color appeared (the resolution did not change) and the sound became better (you can give out not one, but 255 different frequencies). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/db/bz/dh/dbbzdhe0-7bjwvpf4dgeiza-paa.jpeg"></div><br>  Interestingly, both machines are compatible with each other in both directions, including through the use of the same intermediate code with the interpreter. <br><br>  It is also known that there were plans for RCA Studio IV.  There, the resolution should have increased to 64x128 and even a new pseudo-code interpreter was already written. <br><br>  As for the CDP1802, this microprocessor continues to be released - first it was made by Hughes, then <a href="https://www.renesas.com/us/en/products/space-harsh-environment/harsh-environment/microprocessors-peripherals/device/CDP1802A.html">Intersil (Renesas)</a> <br><br>  Those who wish to learn more about this peculiar branch of the history of the development of computing technology, I recommend to google the words " <a href="https://www.google.ru/search%3Fq%3DCOSMAC%2BCDP1802">COSMAC" and "CDP1802</a> ". <br><br><h1>  Additional links </h1><br><blockquote><ul><li>  <a href="https://archive.kontek.net/studio2.classicgaming.gamespy.com/techinfo.htm">RCA Studio II Technical Information</a> </li><li>  <a href="http://www.textfiles.com/bitsavers/pdf/rca/cosmac/studio_II/RCA_Studio_II_Schematic.pdf">RCA Studio II circuit</a> </li><li>  <a href="http://www.hobbylabs.org/files/1802/RCA1802UserManual1976.pdf">Microprocessor CDP1802 Description</a> </li><li>  <a href="https://console5.com/techwiki/images/d/dd/RCA_CDP1861C.pdf">CDP1861 video controller description</a> </li><li>  <a href="http://enlight.ru/roi/">My other work for retrocomputers</a> </li><li>  <a href="https://www.youtube.com/watch%3Fv%3D3oMk1nXxvvA">My story about RCA Studio 2</a> on <a href="http://chaosconstructions.ru/">Chaos Constructions</a> </li></ul></blockquote></div><p>Source: <a href="https://habr.com/ru/post/422277/">https://habr.com/ru/post/422277/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../422263/index.html">"Dormamma, I came to agree": an algorithm for mutually beneficial cooperation with a person</a></li>
<li><a href="../422265/index.html">PICASO 3D Designer X PRO 3D Printer Review</a></li>
<li><a href="../422269/index.html">The book "The internal structure of Windows. 7th ed "</a></li>
<li><a href="../422273/index.html">There are no stupid roads in a smart city. What is RWIS and how it will reduce the cost of road works</a></li>
<li><a href="../422275/index.html">A Google employee was able to manage the door-opening system at the company's office due to software vulnerability</a></li>
<li><a href="../422281/index.html">A7 Data Server: online data management</a></li>
<li><a href="../422283/index.html">White box testing</a></li>
<li><a href="../422285/index.html">Why online shopping is enough loyalty 1% of buyers</a></li>
<li><a href="../422291/index.html">Little black square (visualization of all the money and markets in the world)</a></li>
<li><a href="../422293/index.html">Retrieving an alarm list from OSS via the AlarmIRP interface</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>