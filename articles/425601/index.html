<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Eliminate the bug in the 2000 Shockwave game</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Single byte replacement history 
 Cartoon Cartoon Summer Resort 
 It was the summer of 2000. I was six, I just finished first grade, and the holidays ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Eliminate the bug in the 2000 Shockwave game</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3be/21d/f61/3be21df619c031d81d9fedadf77ac563.png" alt="image"></div><br><h2>  Single byte replacement history </h2><br><h2>  Cartoon Cartoon Summer Resort </h2><br>  It was the summer of 2000.  I was six, I just finished first grade, and the holidays started.  This meant that I could play for a long time on the street, watch cartoons and turn on my father's computer with Windows 98, in order to search for games in a completely new, unexplored region called the Internet.  One of my favorites was the Cartoon Network website.  On it, I found many exciting flash-games based on television cartoons.  That summer they released a series of games called "Cartoon Cartoon Summer Resort". <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/JcEcJpV6Rvs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>Gameplay of the first episode of Cartoon Cartoon Summer Resort</i> <br><br>  This game was a two-dimensional RPG / adventure game from the top side view, consisting of four episodes.  The player controlled a cartoon character who was on vacation at a resort with other cartoon characters.  In each episode at the resort there was a problem that needed to be solved.  The player had to solve it, interacting with the characters and finding items or exchanging them. <br><a name="habracut"></a><br><h2>  Returning for 18 years ahead </h2><br>  During one of the recent bouts of nostalgia, I remembered this game and realized that I would play it again.  She has already turned almost two decades, so it was difficult to find a working link. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In addition, no modern browser would launch the ancient and vulnerable Shockwave player ... with the exception of Internet Explorer.  Probably, I was the first person to find a justified reason to use Internet Explorer in 2018. <br><br>  After playing a bit, I noticed moments that were impossible to ignore.  For example, monotonous background music playing in an infinite loop, and poor collision detection. <br><br><h2>  The same bug </h2><br>  After some time I found a bug in the game: <br><br>  <strong>When moving in areas in which nothing should happen, a dialog box sometimes appears.</strong> <br><br>  As can be seen from the animation, in the game you can rent a boat to move around in the water.  When you try to rent another boat, the message "Today there are no more rented boats!" Appears.  If you sail to the north and walk along the right edge of the island, but the same text that should appear at the boat pier will open. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/422/4f9/96b/4224f996ba06dd22ee7761eff7bb195a.gif"></div><br>  At this stage, any sane person who respects his time and energy would consider the bug a minor nuisance, reminding himself that it was a mediocre web game for children, created two decades ago, and would continue to play.  But not me. <br><br>  Already having all my knowledge of programming and looking at the game, I perceived this bug strangely appealing.  It seemed to me that I had unearthed an ancient tomb and found an untouched puzzle in it that could have disappeared, and so was not solved by anyone.  For me, this bug was an opportunity to learn and discover something new.  Interestingly, it was these possibilities that gave me the <em>process of the game itself</em> in childhood.  There is something almost poetic about how something can quite unintentionally set new tasks if you look at it from a different angle. <br><br><h2>  Deconstruction of the game </h2><br>  To fix the bug, I needed to understand the inner workings of the game.  After studying the question, I learned that the game was created on Shockwave in the <a href="https://en.wikipedia.org/wiki/Adobe_Director">Director</a> application.  When working with Director, projects are saved as a <code>.dir</code> file (Director).  This file is similar to a Photoshop PSD file.  Just as a PSD file contains non-destructive information about layers and text, a <code>.dir</code> project saves all the resources, raw source code, and other information that helps in the development process.  To animate scenes in Director, the proprietary scripting language <a href="https://en.wikipedia.org/wiki/Lingo_(programming_language)">Lingo was used</a> . <br><br>  If the game were saved in a <code>.dir</code> file, I could just open it in Director and easily study how the game works.  However, the game is published as a <code>.dcr</code> file.  A <code>.dcr</code> file is a compiled version of the Director project.  That is, all the source code is compiled into a bytecode running on the Shockwave platform.  This process is similar to how the PSD file is simplified and becomes a PNG image.  The PNG image (in our case, the DCR file) is smaller in size, but does not contain information about layers or edits, and is intended only for distribution. <br><br>  This meant that I was holding a 500-KB binary object without documentation about its structure.  Even if I figured out how to find a low-level byte-code, it seems no one performed the reverse-engineering of the Lingo byte-code and did not document how the Shockwave platform works.  All of this information is proprietary, owned by Adobe, which has no reason to publish it.  Chances to understand the game looked pretty grim. <br><br><h2>  Decompression </h2><br>  Feeling defeated because I most likely will not be able to eliminate this bug, I decided to find out whether it is possible in some way to extract resources from the game.  I figured it was possible to find a section of compressed data or something like that.  After searching, I found a couple of programs called <a href="https://aluigi.altervista.org/mytoolz.htm" rel="noopener">offzip and packzip</a> .  These tools can search for zlib data in arbitrary binary files, show offsets and extract them into separate files. <br><br>  I launched offzip with a DCR file and to my surprise, he really found the archives!  249 pieces, to be precise. <br><br> <code>$ ./offzip.exe -a 1.dcr <br> <br> - open input file: 1.dcr <br> - zip data to check: 32 bytes <br> - zip windowBits: 15 <br> - seek offset: 0x00000000 (0) <br> +------------+-----+----------------------------+----------------------+ <br> | hex_offset | ... | zip -&gt; unzip size / offset | spaces before | info | <br> +------------+-----+----------------------------+----------------------+ <br> 0x00000026 . 164 -&gt; 214 / 0x000000ca _ 38 8:7:26:0:1:7b6349f6 <br> 0x000000d3 .. 3932 -&gt; 9169 / 0x0000102f _ 9 8:7:26:0:1:c1079d84 <br> ... <br> 0x00080490 . 265 -&gt; 472 / 0x00080599 _ 0 8:7:26:0:1:04d6b43f <br> 0x00080599 . 209 -&gt; 366 / 0x0008066a _ 0 8:7:26:0:1:7da3ba08 <br> <br> - 249 valid compressed streams found <br> - 0x0004040d -&gt; 0x001565c8 bytes covering the 50% of the file</code> <br> <br>  I extracted all these files into a folder and began to study the results.  There were 206 <code>.dat</code> files, 38 <code>.fff</code> files, 4 <code>.fff</code> files, and a single <code>.ini</code> file. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5dd/18f/739/5dd18f73916632576f0f9987b38f0878.png"></div><br><h2>  Discoveries </h2><br>  I started with an INI file, but there was no benefit from it.  It was a simple font conversion table from Directory 7.0 between Windows and Mac.  Then I went to the DAT files.  Most of them had a size of 1KB, so I started with a huge, sized 144KB.  I opened it in a hex editor and studied.  These were mostly illegible data.  However, over time, I found a few words in them that seemed to be Lingo identifiers. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/293/37e/662/29337e6629e52d5bb775d44bcb0cbdab.png"></div><br>  Analyzing large DAT files gave me some clues, some interesting messages remained in them.  I found out that Photoshop 3.0 was most likely used for graphics.  I also learned that the game had an internal map editing tool called <code>Map-O-Matic v1</code> .  I would like to see how it looked and was created. <br><br>  I also found the name of the company that developed the game: <a href="https://www.linkedin.com/company/funny-garbage/" rel="noopener">Funny Garbage</a> .  The name of the lead developer was also in the file, but I will not call him.  It was great to discover the author of the game, which I tried hard to fix after almost 20 years, and finally see the face of the person who became the likely cause of this agony.  All these crumbs of information were of course interesting, but they didn‚Äôt help much. <br><br><h2>  Breakthrough </h2><br>  Then I began to study the <code>.fff</code> files in the hex editor.  To my great surprise, all the data in these files was readable and looked like map data: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c21/4e5/163/c214e5163bf2fbebc498207dd583a4de.png"></div><br>  I manually extracted some of this data and cleaned it up in a text editor.  What I did was very much like an array of JSON: <br><br> <code>[ <br> #member: "block.104", <br> #type: #FLOR, <br> #location: [16, 9], <br> #width: 64, <br> #WSHIFT: 0, <br> #height: 32, <br> #HSHIFT: 0, <br> #data: [ <br> #item: [ <br> #name: "", <br> #type: #WALL, <br> #visi: [ <br> #visiObj: "", <br> #visiAct: "", <br> #inviObj: "", <br> #inviAct: "" <br> ], <br> #COND: [[#hasObj: "", #hasAct: "", #giveObj: "sunscreen", #giveAct: "gotscreen"], #none, #none, #none] <br> ], <br> #move: [#U: 0, #d: 0, #L: 0, #R: 0, #COND: 1, #TIMEA: 0, #TIMEB: 0], <br> #message: [ <br> [#text: "You bought the sun screen.", #plrObj: "", #plrAct: ""], <br> [#text: "No more sunscreen today!", #plrObj: "", #plrAct: "gotscreen"] <br> ] <br> ] <br> ]</code> <br> <br>  It was very important, because I managed to learn a lot about how the game worked. <br><br><ol><li>  The game expects map, text, and event data to be in Lingo Objects objects like JSON. </li><li>  Each <code>#member</code> entry is a drawing, block or character drawn. </li><li>  Offsets coordinates and sizes <code>#member</code> can be edited. </li></ol><br>  Knowing that the game dialogs were saved to these files, I wrote a short line for exporting only one dialog to the file: <br><br> <code>grep -a -o '#text: "[^"]*' Uncompressed/*.fff | awk '{print $0,"\r"}' &gt; Dialogue.txt</code> <br> <br>  Using this file, I can quickly find the erroneous text and see which file it was in: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c52/223/723/c5222372338b5a772974bc6cdbeef45c.png"></div><br>  The erroneous text is either in <code>0004eda0.fff</code> , or in <code>0004f396.fff</code> .  In our case, the text of the bug was in the first file.  We know this because immediately after it is the message that we receive when interacting with Og, who is a character on the same map as the tile with the bug. <br><br><h2>  Bug fix </h2><br>  Now I could open <code>0004eda0.fff</code> and find the line about the boat in the hex editor.  Having found it, I was able to detect the associated object <code>#member</code> .  Then change its properties and save the file.  Then I squeezed it again and patched the original DCR game file using <code>packzip</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3be/21d/f61/3be21df619c031d81d9fedadf77ac563.png"></div><br> <code>$ ./packzip -o 0x0004EDA0 Uncompressed/0004eda0.fff test.dcr</code> <br> <br>  When I change the block type from <code>block.11</code> to <code>block.13</code> and the game patch, I can clearly see the outline of the erroneous tile: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ff/284/5bc/3ff2845bc1c7e5909568922f5e0d8966.png"></div><br>  <i>By changing the ID of the tile, you can see the boundaries of the problem area</i> <br><br>  The very fix of the bug is ridiculously simple.  All I had to do was change the <code>#message</code> identifier to <code>#message</code> for this erroneous <code>#fessage</code> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/89e/01d/222/89e01d2223a00f8ca352b28d22ed210b.gif"></div><br>  Now, if we patch the changes and go back to this area, the messages will no longer appear! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cf9/8fb/18b/cf98fb18bf28b734a992e0e1b307e35a.gif"></div><br>  <i>Eliminate the bug in the game, literally changing 1 byte</i> <br><br><h2>  Why is it possible to correct the error? </h2><br>  I can only assume that the game engine will probably check the tile on which it stands when the player moves.  If any condition is met, it displays the message corresponding to this tile from the <code>#message</code> array.  After changing <code>#message</code> to <code>#fessage</code> link to the <code>#message</code> array that the code is looking for is no longer located.  He considers this an empty (or undefined?) Object and displays nothing. <br><br>  Consider an example on JS: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bar</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bar[<span class="hljs-string"><span class="hljs-string">"message"</span></span>] !== <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// display the message } }</span></span></code> </pre> <br>  Suppose we cannot change the function <code>foo()</code> , but we need to change the result.  We have access to the data transmitted to it.  You can rename the <code>message</code> property of the passed object and the function will think that it was not there. <br><br><h2>  How did this bug come about? </h2><br>  I suppose that because of laziness.  The developers used to create this area map editor.  Most likely, they copied already ready maps into new areas, and then changed them.  It's easier than creating everything from scratch.  But since the event and text data are mixed, they most likely overlooked some places and forgot to remove or replace them.  It looks most logical, because the erroneous dialogue was often taken from the neighboring card, where it was used correctly. <br><br><h2>  Why waste so much labor on something so insignificant? </h2><br>  I do not know.  Perhaps because of nostalgia? </div><p>Source: <a href="https://habr.com/ru/post/425601/">https://habr.com/ru/post/425601/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../425591/index.html">We use free SSL certificates to protect Azure web sites</a></li>
<li><a href="../425593/index.html">Final build of Windows 1809 revoked</a></li>
<li><a href="../425595/index.html">Blaue Karte for a near IT guy or how I dumped to Germany</a></li>
<li><a href="../425597/index.html">‚ÄúTechnological‚Äù musical instruments before the 20th century: magnetic harpsichord and electromechanical piano</a></li>
<li><a href="../425599/index.html">How has the perception of space changed for 61 years</a></li>
<li><a href="../425603/index.html">Finding a career path</a></li>
<li><a href="../425605/index.html">Acceptance of payments from the card without jur. faces on Yandex.Money</a></li>
<li><a href="../425607/index.html">Identify fraud using Enron dataset. Part 2, the search for the optimal model</a></li>
<li><a href="../425609/index.html">Game Theory: Decision Making with Kotlin Examples</a></li>
<li><a href="../425611/index.html">Upper-level architecture frontend. Yandex lecture</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>