<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automatic regulator of temperature of a geyser</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to talk about the creation of an uncomplicated device that greatly eased the lives of home inhabitants ‚Äî an automatic regulator of the geyser t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automatic regulator of temperature of a geyser</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/4ea/19f/6cd/4ea19f6cd0cd4f06bc19cb80b44e93ad" align="left">  I want to talk about the creation of an uncomplicated device that greatly eased the lives of home inhabitants ‚Äî an automatic regulator of the geyser temperature.  Similar devices have already been created and described here in Habr√©, I wanted to make a slightly more advanced device and describe in detail the whole process of creation from concept and measurement to implementation, without using ready-made modules like Arduino.  The device will be assembled on a breadboard, the programming language is C. This is my first development of a complete (and working!) Device. <br><a name="habracut"></a><br><h3>  1. Baseline </h3><br>  We live in a rented apartment, which has one very unpleasant property: there is no hot water in the house, cold water is heated in place using a heater (Flow Gas Heater - <b>HSV</b> ), which is located in the kitchen.  While taking a shower, if there is another pressure surge, you have to spank naked to the speaker or call someone.  Integrate a full-fledged "smart home" is not possible, so it was decided to introduce automatic heater control.  By the way, I quickly found several similar solutions, for example <a href="http://geektimes.ru/post/252796/">here</a> , which means my problem is known and solved in its own form. <br><br>  HSV Model: Vector lux eco 20-3 (China) <br>  Water pressure: about 1.5 kgf / cm¬≤ (low pressure, the heater works just above the allowable limit) <br><br><h4>  Solution Requirements </h4><br><ul><li>  Simplicity </li><li>  PID controller or similar </li><li>  Ability to select a supported temperature </li><li>  Display current settings </li><li>  Solving device safety issues </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  System architecture </h4><br>  After some thought, the device architecture was scribbled as follows: <br><ul><li>  Servo (directly in the body of HSV) </li><li>  Thermal sensor regular HSV </li><li>  Thermal sensor signal amplification unit and servo power supply stabilizer (directly in the body of HSV) </li><li>  Control unit (external) </li></ul><br>  Further I will describe the development process in chronological order. <br><br><h3>  2. Servo Drive </h3><br>  Since my profession is software and mechanics has always remained the most difficult part - I decided to start with it.  I must say that for the first stage I could not get together for a long time, the HSV was very afraid to touch it, but another pressure drop forced me to start. <br><br>  After examining the column and looking around, I found places to install the TowerPro MG995 servo, once ordered for delivery on aliexpress. <br><br><img src="https://habrastorage.org/files/239/d04/adc/239d04adcbed4b1da45df2c0c98b3d27.JPG"><br><br>  To eliminate the backlash drive drive made one thrust spring-loaded.  The backlash was completely eliminated, but another problem emerged - the servos with a moment&gt; 10 kg * cm turned out to be too impudent for the HSV.  When turned on, the transients in the electronics of the machine cause a jerk to a random position and, after a couple of idle inclusions, the thrust was bent!  Silumin column definitely will not withstand such treatment.  The geometry of the rocking chair, which was not on the axis of the regulator, also caused complaints, which led to non-linearity of the adjustment.  The final view of the throttle actuator assembly: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/be9/f33/ceb/be9f33ceb886f3aa10e97339becc6a27.jpg"><br><br>  The knot is redone - springs from the VAZ (from the carburetor - bought in the auto parts store) are used and the rocking chair is now on the geometric axis of the shaft.  This design has a slight backlash, but is linear in adjustment and can dampen the rage of the steering machine.  The angles are set to the optimal values ‚Äã‚Äãfor adjustment in the most demanded positions of the regulator. <br><br><h3>  3. Sensor block of HSV </h3><br>  The HSV thermistor changes its resistance within 20..50 KŒ©, it is problematic to use directly as a divider - we get low measurement accuracy.  But as it turned out in practice - with an increase in the supply voltage up to 12V, it is possible to get an acceptable output signal range without problems - only use the DU in the repeater mode (if necessary, you can change the gain) to isolate the divider from the load.  Block diagram inside HSV: <br><br><img src="https://habrastorage.org/files/299/fde/8ae/299fde8aeff64e91b8440390dcc59fa8.png"><br><br>  The divider R2 and the thermal sensor of the column generates a signal with a voltage of 1.4..4.96 V in the full range of measurements (in practice - 20..60 degrees Celsius).  Initially, he developed a bridge circuit - which can compensate for the loss of the power source, but was discarded due to the fact that the power source had little effect, and the first ‚ÄúTK‚Äù item was ‚Äúsimplicity‚Äù.  Operational amplifier provides a divider decoupling and load.  Zener diode D1 limits the output voltage at 5.1 V for cases of disconnecting the sensor (otherwise the output would be 12V - which is deadly for the controller) - that the controller's circuit would be considered an unconditional error.  The integrated stabilizer 7805 nourishes the servo - the solution is unsuccessful, with the stopper of the machine it heats up terribly and I think it can fail with the drive wedge (if the built-in protection does not work).  More on this block I will not focus. <br><br><h3>  4. Controller </h3><br>  The controller is assembled on the basis of IC Atmega8 in a dip package. <br><br><img src="https://habrastorage.org/files/5e3/1ef/3aa/5e31ef3aa5024039937b772aa32aa107.JPG"><br><br>  Clocking - internal oscillator at 8 MHz.  Power - another 7805 on the board.  Indication through a standard LCD1602 display.  Block scheme: <br><br><img src="https://habrastorage.org/files/bf5/f2e/0ad/bf5f2e0ad5d2408a8b7cbd10da4df678.png"><br><br>  Power management of the unit is carried out from the column through the transistor - using a small-sized relay.  The temperature sensor signal (Contact No. 4 of the connector) has a pull-up to the ground and when disconnecting the sensor during operation, it will show a very high temperature - which will reduce the regulator and will not cause dangerous situations.  Assembled unit: <br><br><img src="https://habrastorage.org/files/1a6/30a/ffb/1a630affb70645e1a015b3ecf725dff4.JPG"><br><br><img src="https://habrastorage.org/files/bb4/1b5/41f/bb41b541f0534781bbbf6c584c38ed62.JPG"><br><br><h3>  4. Testing and adjustment </h3><br>  To test the PID controller, a HSV model was written on Qt.  On it were worked out the main points and situations of the heater - cold / hot start, pressure drops.  To remove the characteristics, a UART-connector was added to the controller board, where data on indicators were sent once a second - current temperature, throttle position, etc. <br><br><img src="https://habrastorage.org/files/2d7/bc3/f94/2d7bc3f94fc44e5a96eaf5e5fe5ac73e.JPG"><br><br>  When testing revealed the following: <br><ul><li>  A very large inertia of HSV from the beginning of exposure to the reaction at the temperature sensor is about 30 seconds. </li><li>  Rounding up to a degree in the controller firmware is a bad idea, the algorithm can work more accurately </li></ul><br><br>  The results of measurement and calibration of the temperature sensor, Dependence can be considered conditionally linear: <br><br><img src="https://habrastorage.org/files/2f3/95c/7c1/2f395c7c1ed644a49e97cf84c2b26c80.png"><br><br>  The first runs in the telemetry drawing program from the column: <br><br><img src="https://habrastorage.org/files/9ce/d84/27a/9ced8427ad624a36b69c949ac0c0e59a.png"><br><br>  (I forgot to add a legend to the charts. Hereinafter - <b>red</b> - sensor temperature, <b>green dotted</b> - throttle position, <b>blue</b> - temperature desired by the user) <br><br><img src="https://habrastorage.org/files/bc0/598/34c/bc059834cb8246739e04141ddaeaafe9.png"><br>  <i>Almost successful adjustment</i> <br><br><img src="https://habrastorage.org/files/03c/913/686/03c913686d824c89bc87d7afd3956774.png"><br>  <i>Successful odds options</i> <br><br><img src="https://habrastorage.org/files/edf/193/72a/edf19372a1f54593a46bfdfd39a71637.png"><br>  <i>A good start option</i> <br><br>  The first runs showed the main parameters of the system, it was no longer difficult to measure them and <a href="http://we.easyelectronics.ru/Theory/prostoy-metod-nastroyki-pid-regulyatora.html">adjust by the accelerated formula</a> , the parameters were selected for a long time and painfully.  It was not possible to get rid of the oscillations completely, but fluctuations within 1 degree are considered acceptable.  Accepted option: <br><br><img src="https://habrastorage.org/files/258/fd7/da1/258fd7da160947748df20f4c14012b6d.png"><br><br><img src="https://habrastorage.org/files/721/e51/c7b/721e51c7b9f24932aa844327d0b8accd.png"><br><br>  In the process of selecting the integral factor had to be completely disabled, I think that this is due to the large inertia of the system.  Totals: <br><br><pre><code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Pk = <span class="hljs-number"><span class="hljs-number">0.2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Ik = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Dk = <span class="hljs-number"><span class="hljs-number">0.2</span></span>;</code> </pre> <br><br><h3>  5. Enclosing </h3><br>  The device is assembled in a plastic box junction box. <br><br><img src="https://habrastorage.org/files/a1d/26c/422/a1d26c422d6a4517be1b1924e20e9dec.JPG"><br><br>  And in this form it works. <br><br><h3>  6. Safety of use </h3><br>  An important question that was asked from the very beginning. Let's go through the main points. <br><br><h4>  Galvanic isolation of the circuits of the column and the regulator </h4><br>  What happens if the 12V power supply shorts and 220 volts appears on the sensor circuit?  It will not cause a gas supply to the column.  As it turned out - it will not cause - in the column there are two levels of gas supply - the solenoid valve of the controller and the mechanical valve of water.  Open only the solenoid is small - gas will not flow without water flow. <br><br><h4>  Disabling or tearing off the sensor inside the HSV </h4><br>  When the thermistor is disconnected from the unit inside the HSV, a 0xFF (5.1V) signal will be generated at the output, which is checked by the program as an error, the controller stops the program execution, the servo is set to minimum. <br><br><h4>  Disconnect or detach the sensor from the controller </h4><br>  In this case, a high temperature is generated (tightening the sensor line to the ground), which will bring the drive to the minimum value, which is just as safe for the user. <br><br><h4>  Electron-mechanical protection of HSV </h4><br>  Values ‚Äã‚Äãof protection of HSV remain functional in normal mode, in case of boiling / overheating / thrust sensor columns, regular systems should turn it off. <br><br><h3>  7. Files </h3><br>  The full project archive is available on <a href="https://github.com/petrows/boiler-autotemp">github</a> .  In the project directories, measurement results, controller firmware, and boiler boiler on Qt are available. <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/262437/">https://habr.com/ru/post/262437/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262427/index.html">Truly responsive letters. Part ... first again</a></li>
<li><a href="../262429/index.html">Condition as a compromise</a></li>
<li><a href="../262431/index.html">Real-time data processing in AWS Cloud. Part 2</a></li>
<li><a href="../262433/index.html">IDA Pro Upgrade. Debugger plugin. Part I. Theory</a></li>
<li><a href="../262435/index.html">Simplify unit tests with the AutoFixture bundle and xUnit</a></li>
<li><a href="../262439/index.html">Optimizing Asterisk Dialplan Listing with MySQL</a></li>
<li><a href="../262443/index.html">A simple replacement for Boost :: Optional for using nullable types in C ++ projects</a></li>
<li><a href="../262445/index.html">Facebook World Data Analysis</a></li>
<li><a href="../262447/index.html">Event for university teachers in St. Petersburg on programming training</a></li>
<li><a href="../262451/index.html">Practical task with the analysis of the solution</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>