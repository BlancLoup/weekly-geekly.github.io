<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development for Sailfish OS: Creating your own QML component in C ++</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! This article is a continuation of a series of articles devoted to the development of the mobile platform Sailfish OS. In this article we will t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development for Sailfish OS: Creating your own QML component in C ++</h1><div class="post__text post__text-html js-mediator-article">  Hello!  This article is a continuation of a series of articles devoted to the development of the mobile platform Sailfish OS.  In this article we will talk about creating your own components in QML in C ++, and specifically about creating properties and methods available in QML, about signals and linking.  Also show how to connect a new component to the application. <br><a name="habracut"></a><br><h4>  Motivation </h4><br>  For a start, it is worthwhile to determine the cases in which the use of components in C ++ makes sense.  The built-in Qt Quick types certainly offer some tools for working with sensors, with databases and notifications, which we already talked about earlier <a href="https://habrahabr.ru/post/317252/">here</a> and <a href="https://habrahabr.ru/post/317738/">here</a> , with various system capabilities such as network or Bluetooth, D-Bus.  However, the capabilities of these tools are rather limited and are not suitable for creating more complex applications.  In this case, C ++ just allows you to implement functionality beyond what Qt Quick provides. <br><br>  Another argument in favor of C ++ is the ability to use a variety of low-level libraries.  In addition, complex logic is simply more correct to allocate in classes C ++.  That is what we were guided by when creating a component for displaying data on the time axis as a graph. <br><br><h4>  Component description </h4><br>  The appearance of the component is a coordinate plane on which various graphs are depicted.  Moving left and right on the graph is done using the buttons below the component.  Data on the plane can be displayed for different time periods: for a week, month, quarter or year.  When choosing one of the last three periods, the data is compacted.  So, for example, for the month, the graph shows the average values ‚Äã‚Äãfor each day of the range, and for the quarterly and annual range - the average values ‚Äã‚Äãfor every 3 and 12 days, respectively.  You can select the desired period using the buttons that are located above the coordinate plane: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/files/a46/f14/04d/a46f1404d4d84b928542eb492815bdf6.png"></div><br><h4>  Component implementation </h4><br>  It is worth noting that the process of creating components does not differ from that on Qt, however, there are still several features specific to Sailfish OS.  About them will be discussed below. <br><br>  First you need to create a C ++ class inherited from <a href="http://doc.qt.io/qt-5/qobject.html">QObject</a> or its descendants and containing the <i>Q_OBJECT</i> macro: <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QQuickPaintedItem&gt; #include &lt;QObject&gt; class PlotView : public QQuickPaintedItem { Q_OBJECT public: explicit PlotView(QQuickItem* parent = NULL); void paint(QPainter* painter); };</span></span></span></span></code> </pre> <br>  Our class is inherited from <a href="http://doc.qt.io/qt-5/qquickpainteditem.html">QQuickPaintedItem</a> to be able to override the <i>QQuickPaintedItem :: paint ()</i> method, which will implement the process of drawing graphics using the <i>QPainter</i> interface.  To implement visual components without drawing, you can use the <a href="http://doc.qt.io/qt-5/qquickitem.html">QQuickItem</a> class. <br><br>  Let us show the creation of properties that will be visible in QML, and work with them using the example of the periodIndex property, which is responsible for the index of the current selected period.  To declare a property, you must use the <a href="http://doc.qt.io/qt-5/qobject.html">Q_PROPERTY</a> macro: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlotView</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> QQuickPaintedItem { <span class="hljs-comment"><span class="hljs-comment">//... Q_PROPERTY(int periodIndex READ periodIndex WRITE setPeriodIndex NOTIFY periodIndexChanged) private: int periodIndexValue; //... public: void setPeriodIndex(int periodIndex); int periodIndex() const; //... signals: void periodIndexChanged(); };</span></span></code> </pre> <br>  As you can see from the example, for a property, you must specify its name, type, and <i>READ</i> function to get the property value.  You can also specify the <i>WRITE</i> function for assigning a property to a new value.  Full list of available options can be found <a href="http://doc.qt.io/qt-5/properties.html">here</a> .  In addition, inside the class it is best to declare a variable to store the value of the property (which we did in the example). <br><br>  Also, in order to use <a href="http://doc.qt.io/qt-5/qtqml-syntax-propertybinding.html">the binding mechanism</a> inside QML, using the <i>NOTIFY</i> parameter, the <i>periodIndex</i> property determines the signal that its value changes.  The call of the corresponding signal must be placed inside the <i>PlotView :: setPeriodIndex ()</i> method: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> PlotView::setPeriodIndex(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> periodIndex) { periodIndexValue = periodIndex; <span class="hljs-comment"><span class="hljs-comment">//... emit periodIndexChanged(); //... }</span></span></code> </pre> <br>  For all signals declared inside our component, you can create corresponding handlers when declaring a component in QML.  So, the signal handler about a change in the index of the current period will look like this: <br><br><pre> <code class="javascript hljs">PlotView { <span class="hljs-attr"><span class="hljs-attr">onPeriodIndexChanged</span></span>: {} <span class="hljs-comment"><span class="hljs-comment">//... }</span></span></code> </pre><br>  To create a method that will be available for calling inside QML, when you declare it, you must add the <i>Q_INVOKABLE</i> macro.  Let's declare a method that updates data for graphs and redraws the component: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlotView</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> QQuickPaintedItem { <span class="hljs-comment"><span class="hljs-comment">//... public: Q_INVOKABLE void drawPlot(); //... };</span></span></code> </pre><br>  Now we can add a call to this method to the <i>onPeriodIndexChanged ()</i> handler <i>.</i> <br><pre> <code class="javascript hljs">PlotView { <span class="hljs-attr"><span class="hljs-attr">onPeriodIndexChanged</span></span>: drawPlot() }</code> </pre><br>  Thus, when the <i>periodIndex</i> property <i>changes, the</i> coordinate plane and graphs will automatically be updated. <br><br>  It is worth noting that instead of using the <i>Q_INVOKABLE</i> method, you can declare it as a slot, which also makes it visible inside QML. <br><br>  The component itself draws, as mentioned above, using the <a href="http://doc.qt.io/qt-5/paintsystem.html">standard classes</a> provided by the Qt library.  An example of drawing horizontal lines of the coordinate plane is as follows: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> PlotView::drawVerticalScaleLines(QPainter* painter) { painter-&gt;setPen(QPen(QBrush(Qt::white), <span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> i = minValue; i &lt; maxValue; i += step) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = calculatePlotYCoordinate(i); painter-&gt;drawLine(<span class="hljs-number"><span class="hljs-number">0</span></span>, y, width(), y); } }</code> </pre><br>  So, to make our component available inside QML, you need to register it inside the application.  It is worth noting several features characteristic of Sailfish applications, namely, with their publication in the store Harbor: <br><br><ol><li>  The name of your application should begin with <i>harbor</i> and be recorded through "-".  For example, <i>harbor-plot-app</i> </li><li>  It is necessary that the <i>URI</i> on which you register the components starts with the name of the application, in which "-" is replaced with ".".  In our case, it will look like <i>harbour.plot.app.plotview</i> </li></ol><br>  A complete list of name requirements for publishing an application in the store can be found <a href="https://harbour.jolla.com/faq">here</a> . <br><br>  Registration is performed using the <i>qmlRegisterType ()</i> method and looks like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QtQuick/QQuickView&gt; #include &lt;QGuiApplication&gt; #include "plotview.h" //... int main(int argc, char *argv[]) { QGuiApplication* app = SailfishApp::application(argc, argv); //... qmlRegisterType&lt;PlotView&gt;("harbour.plotapp.plotview", 1, 0, "PlotView"); //... return app-&gt;exec(); }</span></span></span></span></code> </pre><br>  Thus, using this component in QML will look something like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> QtQuick <span class="hljs-number"><span class="hljs-number">2.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Sailfish.Silica <span class="hljs-number"><span class="hljs-number">1.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> harbour.plotapp.plotview <span class="hljs-number"><span class="hljs-number">1.0</span></span> <span class="hljs-comment"><span class="hljs-comment">//... PlotView { id: plotView periodIndex: 0 onPeriodIndexChanged: drawPlot(); //... } //...</span></span></code> </pre><br>  It is important to note that within our components, you can use classes and properties from the <a href="https://sailfishos.org/develop/docs/silica/sailfish-silica-all.html/">Sailfish Silica</a> library, thereby creating components that satisfy the Sailfish OS UI.  A good example for this is the <a href="https://sailfishos.org/develop/docs/silica/qml-sailfishsilica-sailfish-silica-theme.html/">Theme</a> class, which provides access to the standard style properties of Sailfish OS, such as color fonts and indents: <br><br><pre> <code class="javascript hljs">PlotView { <span class="hljs-comment"><span class="hljs-comment">//... width: parent.width - Theme.horizontalPageMargin * 2 anchors.horizontalCenter: parent.horizontalCenter //... }</span></span></code> </pre><br><h4>  Conclusion </h4><br>  As a result, the main steps for creating your own components were shown.  Similar steps can be used to create non-visual components for your application.  More information on this topic can be found <a href="http://doc.qt.io/qt-5/qtqml-tutorials-extending-qml-example.html">here</a> and <a href="http://doc.qt.io/qt-5/qtqml-cppintegration-topic.html">here</a> .  Sources of a small application to demonstrate the operation of our component are available on <a href="https://bitbucket.org/roydashprojects/harbor-plot-app">Bitbucket</a> . <br><br>  Technical issues can also be discussed on <a href="https://t.me/sailfishos">the Sailfish OS Russian-speaking community channel in a Telegram</a> or <a href="https://vk.com/merproject">VKontakte group</a> . <br><br>  The author: Daria Roychikova </div><p>Source: <a href="https://habr.com/ru/post/321426/">https://habr.com/ru/post/321426/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../321412/index.html">School of mobile marketing, UI design and Unity 3D do-it-yourself development</a></li>
<li><a href="../321416/index.html">How IT professionals work. Anatoly Matov, Development Manager at e2e4.lab</a></li>
<li><a href="../321418/index.html">GitLab 8.16 released: Support for Google Container Engine, built-in Prometheus + time tracking in CE</a></li>
<li><a href="../321420/index.html">Product Design Digest, January 2017</a></li>
<li><a href="../321424/index.html">DRM-protected Windows files can be used to de-anonymize a Tor user</a></li>
<li><a href="../321428/index.html">BIND vulnerability allows you to ‚Äúdrop‚Äù any server: how and why it works</a></li>
<li><a href="../321430/index.html">Mongoose Embedded Compact Web Server</a></li>
<li><a href="../321432/index.html">Virtuozz moving</a></li>
<li><a href="../321434/index.html">Neyrabayesovsky approach to machine learning problems. Lecture by Dmitry Vetrov in Yandex</a></li>
<li><a href="../321436/index.html">YouTrack release 2017.1 and Hub 2017.1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>