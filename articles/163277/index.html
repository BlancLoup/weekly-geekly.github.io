<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Parallel R</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Now it is almost impossible to imagine a world without parallel computing. Parallel to everything and everyone, even mobile phones now ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Parallel R</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  Now it is almost impossible to imagine a world without parallel computing.  Parallel to everything and everyone, even mobile phones now have several cores, which means ... well, you understand.  But let's not talk about mobile applications, but about more useful and interesting things.  About machine learning.  The topic is also fashionable, advertised, machinewives have even heard about machine learning, and only the lazy have not touched it with their hands.  For machine learning, and to be more precise, for statistical calculations there are many different frameworks, for my taste the best of them is R (forgive me, Octave fans).  And it will be about him. <br><br>  <b>Disclaimer</b> : <br>  I do not pretend to be particularly rigorous; my task is to convey a general idea to the readers. <br><a name="habracut"></a><br>  R is good and useful, but it has two limitations that almost do not interfere when working with a small amount of data and spoil life very much when working with large packages: <br><ul><li>  all code is executed in one process </li><li>  all data is stored in memory </li></ul><br>  This is almost always the case if you don‚Äôt really think about it.  And what if you think about it, I will tell you. <br><br><h4>  Work without cycles vs foreach </h4><br>  Those who wrote in R know that it is not generally accepted to use cycles in a language.  Usually, programs use list operations (apply and its fellows), which in practice are more effective than usual for, because all magic can and does happen inside.  Yes, and in the philosophy of the language, this approach fits much better, look: <br><pre><code class="hljs swift">a &lt;- <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">4</span></span>) { a&lt;- <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>(a, i^<span class="hljs-number"><span class="hljs-number">2</span></span>) } #   a &lt;- <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">4</span></span> * <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">4</span></span> # ,   ?</code> </pre> <br>  If you need to do something non-trivial, you can apply apply.  For example, the same result can be obtained as follows: <br><pre> <code class="hljs lisp"> a &lt;- sapply(<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">4</span></span>, function(<span class="hljs-name"><span class="hljs-name">x</span></span>) {x^<span class="hljs-number"><span class="hljs-number">2</span></span>})</code> </pre><br>  The apply functions family allows many goodies that work instantly and are very pleasing to the eye.  Of course, this approach requires some skill, but training pays off with a vengeance. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And where is the parallelism, you ask?  This is where the most interesting lies. <br>  Ordinary people came and thought: ‚ÄúAll these apply, lists, etc.  - it's good.  But I do not want to relearn.  Give me a familiar tool. ‚Äù  And such a tool has appeared.  You can find it in the foreach package. <br>  Actually, we are interested in the function of the same name, the beauty of which lies in the fact that it can combine the results obtained at each step of the cycle (which the original for can not, see perversions with it above).  And you can combine not just in some ways - foreach can feed your own combiner or any suitable function.  The most frequent and useful - c, cbind, rbind. <br><pre> <code class="hljs cs"> a &lt;- <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(i=<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">4</span></span>, .combine=<span class="hljs-string"><span class="hljs-string">'c'</span></span>) %<span class="hljs-keyword"><span class="hljs-keyword">do</span></span>% {i^<span class="hljs-number"><span class="hljs-number">2</span></span>}</code> </pre><br><br><h4>  Go! </h4><br>  What is the most effective way to start a parallel calculation process?  Break the task into small independent pieces.  This is exactly how parallelization works in R. The foreach and doSNOW module works as a basis. <br>  Let's create a ‚Äúcluster‚Äù for our calculations and run a simple test on it. <br><pre> <code class="hljs pgsql"> #   library(<span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>) library(doSNOW) cl &lt;- makeCluster(<span class="hljs-number"><span class="hljs-number">4</span></span>) registerDoSNOW(cl) a &lt;- mean(<span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(i=<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>^<span class="hljs-number"><span class="hljs-number">6</span></span>, .combine=<span class="hljs-string"><span class="hljs-string">'c'</span></span>) %dopar% {mean(rnorm(i))}) stopCluster(cl)</code> </pre><br>  For debugging, you can use the% do% and option in real life -% dopar%. <br>  <b>Important</b> : the code that runs inside a parallel loop should be as independent as possible.  For example, he will not be able to see the functions defined in your workspace, so often they are defined either directly inside% dopar%, or they take all the necessary actions into a separate source file, and then connect it via source ('trololo.R'). <br><br>  Clusters doSNOW are different.  In essence, a cluster is a collection of R instances that execute code inside% dopar%.  All of them can be on the same machine, but can also be separated into different ones. <br><pre> <code class="hljs lisp"> cl1 &lt;- makeCluster(<span class="hljs-name"><span class="hljs-name">c</span></span>(<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>,<span class="hljs-string"><span class="hljs-string">"remotehost"</span></span>), type = <span class="hljs-string"><span class="hljs-string">"SOCK"</span></span>)</code> </pre><br>  There are four types of clusters available: PVM (http://www.csm.ornl.gov/pvm/), MPI (http://cran.r-project.org/web/packages/Rmpi/index.html), NWS (http://nws-r.sourceforge.net/) and SOCK.  For the first three, additional libraries will be required (in fact, implementations), by default a socket-cluster will be launched. <br><br>  For debugging and all sorts of different statistics, you can use the snow.time function, wrapping all calls to the cluster in it: <br><pre> <code class="hljs matlab"> cl &lt;- makeCluster(<span class="hljs-number"><span class="hljs-number">4</span></span>) registerDoSNOW(cl) tm &lt;- snow.time(a &lt;- <span class="hljs-built_in"><span class="hljs-built_in">mean</span></span>(foreach(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>^<span class="hljs-number"><span class="hljs-number">6</span></span>, .combine=<span class="hljs-string"><span class="hljs-string">'c'</span></span>) <span class="hljs-comment"><span class="hljs-comment">%dopar% {mean(rnorm(i))})) print(tm) plot(tm) stopCluster(cl)</span></span></code> </pre><br>  It turns out about the following pictures: <br><img src="http://habrastorage.org/storage2/923/937/7d2/9239377d2abb555afe697918bc0e6050.png"><br><br><h4>  And what for goat bayan? </h4><br>  Probably, a lot more can be written, but after these examples, I think that everything will be sorted out where to dig. <br>  Why all this may be needed?  Yes, a lot of why, at least, we optimize the flow of time, and at the most we can now wait for the end of heavy calculations.  I used a similar approach mainly when testing any hypotheses when it was necessary either <br><ul><li>  to run the calculation on a very large time period (initial assessment of the efficiency of the exchange strategy) </li><li>  run the calculation on a set of similar datasets (RxQ-crossvalidation) </li></ul><br>  I think that you will be able to use this approach for your own purposes.  Good luck! </div><p>Source: <a href="https://habr.com/ru/post/163277/">https://habr.com/ru/post/163277/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../163261/index.html">Humble Indie Bundle 7</a></li>
<li><a href="../163263/index.html">2 gigapixel photo of Everest</a></li>
<li><a href="../163265/index.html">Steam for Linux is now in open beta. Festive gift from Valve</a></li>
<li><a href="../163267/index.html">Apple eMac. Acceleration from 1 GHz to 1.2 GHz with a soldering iron</a></li>
<li><a href="../163269/index.html">Experience using a vertical mouse or saving ourselves from tunnel syndrome</a></li>
<li><a href="../163279/index.html">Communication restoration after flood in Krymsk</a></li>
<li><a href="../163281/index.html">iOS Console App - writing a program for iOS without a GUI</a></li>
<li><a href="../163285/index.html">Testing unloading 200,000 products on the site of 1C</a></li>
<li><a href="../163287/index.html">Prestigio Multipad 8.0 Pro Duo Review</a></li>
<li><a href="../163289/index.html">Do I need to calibrate color printers?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>