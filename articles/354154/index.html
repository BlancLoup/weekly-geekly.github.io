<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Setting up a machine learning model: feature selection and optimization of hyper parameters</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 In the previous article of the cycle, we discussed the formulation of the problem of data analysis, took the first steps in setting up ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Setting up a machine learning model: feature selection and optimization of hyper parameters</h1><div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br>  In the previous <a href="https://habrahabr.ru/post/351074/">article of the</a> cycle, we discussed the formulation of the problem of data analysis, took the first steps in setting up a machine learning model, and wrote an interface suitable for use by an application programmer.  Today we will conduct further research of the task - we will experiment with new signs, try more complex models and options for their tuning parameters. <br><br><img src="https://habrastorage.org/webt/oi/qa/-9/oiqa-92vxv_zird9kv7zvi370ze.png"><br><br>  As far as possible, the article uses Russian-language terminology chosen by the author on the basis of literal translations of English-language terms and established slang in the community.  You can read about it <a href="https://habr.com/post/352812/">here</a> . <br><a name="habracut"></a><br>  Recall what we stopped in terms of setting up the model and assessing the quality of its prediction on a validation sample. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Current code</b> <div class="spoiler_text"><code>[research.py]</code> <br> <pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pickle <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> math <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.linear_model <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> LinearRegression TRAIN_SAMPLES_NUM = <span class="hljs-number"><span class="hljs-number">20000</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> list_of_instances = [] list_of_labels =[] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'./data/competition_data/train_set.csv'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> input_stream: header_line = input_stream.readline() columns = header_line.strip().split(<span class="hljs-string"><span class="hljs-string">','</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> input_stream: new_instance = dict(zip(columns[:<span class="hljs-number"><span class="hljs-number">-1</span></span>], line.split(<span class="hljs-string"><span class="hljs-string">','</span></span>)[:<span class="hljs-number"><span class="hljs-number">-1</span></span>])) new_label = float(line.split(<span class="hljs-string"><span class="hljs-string">','</span></span>)[<span class="hljs-number"><span class="hljs-number">-1</span></span>]) list_of_instances.append(new_instance) list_of_labels.append(new_label) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list_of_instances, list_of_labels <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_bracket_pricing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> instance[<span class="hljs-string"><span class="hljs-string">'bracket_pricing'</span></span>] == <span class="hljs-string"><span class="hljs-string">'Yes'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> instance[<span class="hljs-string"><span class="hljs-string">'bracket_pricing'</span></span>] == <span class="hljs-string"><span class="hljs-string">'No'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> ValueError <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_quantity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [int(instance[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>])] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_min_order_quantity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [int(instance[<span class="hljs-string"><span class="hljs-string">'min_order_quantity'</span></span>])] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_annual_usage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [int(instance[<span class="hljs-string"><span class="hljs-string">'annual_usage'</span></span>])] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_absolute_date</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-number"><span class="hljs-number">365</span></span> * int(instance[<span class="hljs-string"><span class="hljs-string">'quote_date'</span></span>].split(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]) + <span class="hljs-number"><span class="hljs-number">12</span></span> * int(instance[<span class="hljs-string"><span class="hljs-string">'quote_date'</span></span>].split(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>]) + int(instance[<span class="hljs-string"><span class="hljs-string">'quote_date'</span></span>].split(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)[<span class="hljs-number"><span class="hljs-number">2</span></span>])] SUPPLIERS_LIST = [<span class="hljs-string"><span class="hljs-string">'S-0058'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0013'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0050'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0011'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0070'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0104'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0012'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0068'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0041'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0023'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0092'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0095'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0029'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0051'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0111'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0064'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0005'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0096'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0062'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0004'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0059'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0031'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0078'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0106'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0060'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0090'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0072'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0105'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0087'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0080'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0061'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0108'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0042'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0027'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0074'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0081'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0025'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0024'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0030'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0022'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0014'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0054'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0015'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0008'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0007'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0009'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0056'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0026'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0107'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0066'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0018'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0109'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0043'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0046'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0003'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0006'</span></span>, <span class="hljs-string"><span class="hljs-string">'S-0097'</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_supplier</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> instance[<span class="hljs-string"><span class="hljs-string">'supplier'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> SUPPLIERS_LIST: supplier_index = SUPPLIERS_LIST.index(instance[<span class="hljs-string"><span class="hljs-string">'supplier'</span></span>]) result = [<span class="hljs-number"><span class="hljs-number">0</span></span>] * supplier_index + [<span class="hljs-number"><span class="hljs-number">1</span></span>] + [<span class="hljs-number"><span class="hljs-number">0</span></span>] * (len(SUPPLIERS_LIST) - supplier_index - <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: result = [<span class="hljs-number"><span class="hljs-number">0</span></span>] * len(SUPPLIERS_LIST) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_assembly</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance)</span></span></span><span class="hljs-function">:</span></span> assembly_id = int(instance[<span class="hljs-string"><span class="hljs-string">'tube_assembly_id'</span></span>].split(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>]) result = [<span class="hljs-number"><span class="hljs-number">0</span></span>] * assembly_id + [<span class="hljs-number"><span class="hljs-number">1</span></span>] + [<span class="hljs-number"><span class="hljs-number">0</span></span>] * (<span class="hljs-number"><span class="hljs-number">25000</span></span> - assembly_id - <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_assembly_specs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance, assembly_to_specs)</span></span></span><span class="hljs-function">:</span></span> result = [<span class="hljs-number"><span class="hljs-number">0</span></span>] * <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> spec <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> assembly_to_specs[instance[<span class="hljs-string"><span class="hljs-string">'tube_assembly_id'</span></span>]]: result[int(spec.split(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>])] = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to_sample</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance, additional_data)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (is_bracket_pricing(instance) + get_quantity(instance) + get_min_order_quantity(instance) + get_annual_usage(instance) + get_absolute_date(instance) + get_supplier(instance) + get_assembly_specs(instance, additional_data[<span class="hljs-string"><span class="hljs-string">'assembly_to_specs'</span></span>])) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to_interim_label</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(label)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> math.log(label + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to_final_label</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(interim_label)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> math.exp(interim_label) - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_additional_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> result = dict() assembly_to_specs = dict() <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'data/competition_data/specs.csv'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> input_stream: header_line = input_stream.readline() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> input_stream: tube_assembly_id = line.split(<span class="hljs-string"><span class="hljs-string">','</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>] specs = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> spec <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> line.strip().split(<span class="hljs-string"><span class="hljs-string">','</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>:]: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> spec != <span class="hljs-string"><span class="hljs-string">'NA'</span></span>: specs.append(spec) assembly_to_specs[tube_assembly_id] = specs result[<span class="hljs-string"><span class="hljs-string">'assembly_to_specs'</span></span>] = assembly_to_specs <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: list_of_instances, list_of_labels = load_data() print(len(list_of_instances), len(list_of_labels)) print(list_of_instances[:<span class="hljs-number"><span class="hljs-number">3</span></span>]) print(list_of_labels[:<span class="hljs-number"><span class="hljs-number">3</span></span>]) <span class="hljs-comment"><span class="hljs-comment"># print(list(map(to_sample, list_of_instances[:3]))) additional_data = load_additional_data() # print(additional_data) print(to_final_label(to_interim_label(42))) model = LinearRegression() list_of_samples = list(map(lambda x:to_sample(x, additional_data), list_of_instances)) train_samples = list_of_samples[:TRAIN_SAMPLES_NUM] train_labels = list(map(to_interim_label, list_of_labels[:TRAIN_SAMPLES_NUM])) model.fit(train_samples, train_labels) validation_samples = list_of_samples[TRAIN_SAMPLES_NUM:] validation_labels = list(map(to_interim_label, list_of_labels[TRAIN_SAMPLES_NUM:])) squared_errors = [] for sample, label in zip(validation_samples, validation_labels): prediction = model.predict(numpy.array(sample).reshape(1, -1))[0] squared_errors.append((prediction - label) ** 2) mean_squared_error = math.sqrt(sum(squared_errors) / len(squared_errors)) print('Mean Squared Error: {0}'.format(mean_squared_error)) with open('./data/model.mdl', 'wb') as output_stream: output_stream.write(pickle.dumps(model))</span></span></code> </pre><br> <code>[generate_response.py]</code> <br> <pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pickle <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> research <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FinalModel</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, model, to_sample, additional_data)</span></span></span><span class="hljs-function">:</span></span> self._model = model self._to_sample = to_sample self._additional_data = additional_data <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._model.predict(numpy.array(self._to_sample( instance, self._additional_data)).reshape(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>))[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'./data/model.mdl'</span></span>, <span class="hljs-string"><span class="hljs-string">'rb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> input_stream: model = pickle.loads(input_stream.read()) additional_data = research.load_additional_data() final_model = FinalModel(model, research.to_sample, additional_data) print(final_model.process({<span class="hljs-string"><span class="hljs-string">'tube_assembly_id'</span></span>:<span class="hljs-string"><span class="hljs-string">'TA-00001'</span></span>, <span class="hljs-string"><span class="hljs-string">'supplier'</span></span>:<span class="hljs-string"><span class="hljs-string">'S-0066'</span></span>, <span class="hljs-string"><span class="hljs-string">'quote_date'</span></span>:<span class="hljs-string"><span class="hljs-string">'2013-06-23'</span></span>, <span class="hljs-string"><span class="hljs-string">'annual_usage'</span></span>:<span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">'min_order_quantity'</span></span>:<span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">'bracket_pricing'</span></span>:<span class="hljs-string"><span class="hljs-string">'Yes'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span>:<span class="hljs-string"><span class="hljs-string">'1'</span></span>}))</code> </pre><br></div></div><br>  We selected several signs describing the objects on which we teach our algorithm (and this, I remind you, such a boring and, it would seem, far from IT thing as industrial pipes).  Based on these features, the key function <code>to_sample()</code> works, which currently looks like this: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to_sample</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance, additional_data)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (is_bracket_pricing(instance) + get_quantity(instance) + get_min_order_quantity(instance) + get_annual_usage(instance) + get_absolute_date(instance) + get_supplier(instance) + get_assembly_specs(instance, additional_data[<span class="hljs-string"><span class="hljs-string">'assembly_to_specs'</span></span>]))</code> </pre><br>  At the input, it takes a description of the object (the instance variable) contained in the main file <code>train_set.csv</code> and a set of additional data generated based on the remaining files from the dataset, and returns a fixed-length array at the output, which later goes to the input of the machine learning algorithm. <br><br>  Regarding specific modeling, no particular progress has yet occurred - elementary linear regression is still used without any settings that differ from the default Scikit-Learn package.  Nevertheless, for the time being we will continue to gradually increase the list of signs to improve the quality of the prediction algorithm.  Last time, we already (in a rather, in a banal way) used all the columns of the main file with training data <code>train_set.csv</code> and the file with auxiliary data <code>specs.csv</code> .  So now, perhaps, it is time to pay attention to the other files with additional data.  In particular, the content of the <code>bill_of_materials.csv</code> file, which describes the components of each product, looks promising. <br><br><h2>  Further selection of signs </h2><br><pre> <code class="bash hljs">$ head ./data/competition_data/bill_of_materials.csv tube_assembly_id,component_id_1,quantity_1,component_id_2,quantity_2,component_id_3,quantity_3,component_id_4,quantity_4,component_id_5,quantity_5,component_id_6,quantity_6,component_id_7,quantity_7,component_id_8,quantity_8 TA-00001,C-1622,2,C-1629,2,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00002,C-1312,2,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00003,C-1312,2,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00004,C-1312,2,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00005,C-1624,1,C-1631,1,C-1641,1,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00006,C-1624,1,C-1631,1,C-1641,1,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00007,C-1622,2,C-1629,2,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00008,C-1312,2,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA TA-00009,C-1625,2,C-1632,2,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA</code> </pre><br>  As you can see, the file format resembles <code>specs.csv</code> .  To begin with, let's see how many kinds of components are actually found, and already with the help of this information we will make a decision on what sign it is reasonable to form based on these auxiliary data. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>set_of_components = set() &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'./data/competition_data/bill_of_materials.csv'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> input_stream: ... header_line = input_stream.readline() ... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> input_stream: ... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>): ... new_component = line.split(<span class="hljs-string"><span class="hljs-string">','</span></span>)[i] ... set_of_components.add(new_component) ... &gt;&gt;&gt; len(set_of_components) <span class="hljs-number"><span class="hljs-number">2049</span></span> &gt;&gt;&gt; sorted(set_of_components)[:<span class="hljs-number"><span class="hljs-number">10</span></span>] [<span class="hljs-string"><span class="hljs-string">'9999'</span></span>, <span class="hljs-string"><span class="hljs-string">'C-0001'</span></span>, <span class="hljs-string"><span class="hljs-string">'C-0002'</span></span>, <span class="hljs-string"><span class="hljs-string">'C-0003'</span></span>, <span class="hljs-string"><span class="hljs-string">'C-0004'</span></span>, <span class="hljs-string"><span class="hljs-string">'C-0005'</span></span>, <span class="hljs-string"><span class="hljs-string">'C-0006'</span></span>, <span class="hljs-string"><span class="hljs-string">'C-0007'</span></span>, <span class="hljs-string"><span class="hljs-string">'C-0008'</span></span>, <span class="hljs-string"><span class="hljs-string">'C-0009'</span></span>]</code> </pre><br>  The component turned out to be quite a few, so the idea of ‚Äã‚Äãdeploying the attribute to an array of more than 2000 elements in a standard way does not seem very reasonable.  Let's try to use several dozen of the most popular options, and also leave the variable responsible for the number of these variations as a tuning parameter for optimization at the fine tuning stage. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_additional_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> result = dict() ... assembly_to_components = dict() component_to_popularity = dict() <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'./data/competition_data/bill_of_materials.csv'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> input_stream: header_line = input_stream.readline() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> input_stream: tube_assembly_id = line.split(<span class="hljs-string"><span class="hljs-string">','</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>] assembly_to_components[tube_assembly_id] = dict() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>): new_component = line.split(<span class="hljs-string"><span class="hljs-string">','</span></span>)[i] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> new_component != <span class="hljs-string"><span class="hljs-string">'NA'</span></span>: quantity = int(line.split(<span class="hljs-string"><span class="hljs-string">','</span></span>)[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]) assembly_to_components[tube_assembly_id][new_component] = quantity <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> new_component <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> component_to_popularity: component_to_popularity[new_component] += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: component_to_popularity[new_component] = <span class="hljs-number"><span class="hljs-number">1</span></span> components_by_popularity = [value[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> value <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sorted( component_to_popularity.items(), key=operator.itemgetter(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), reverse=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)] result[<span class="hljs-string"><span class="hljs-string">'assembly_to_components'</span></span>] = assembly_to_components result[<span class="hljs-string"><span class="hljs-string">'components_by_popularity'</span></span>] = components_by_popularity ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_assembly_components</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance, assembly_to_components, components_by_popularity, number_of_components)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" number_of_components: number of most popular components taken into account """</span></span> result = [<span class="hljs-number"><span class="hljs-number">0</span></span>] * number_of_components <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> component <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sorted(assembly_to_components[instance[<span class="hljs-string"><span class="hljs-string">'tube_assembly_id'</span></span>]]): component_index = components_by_popularity.index(component) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> component_index &lt; number_of_components: <span class="hljs-comment"><span class="hljs-comment"># quantity result[component_index] = assembly_to_components[ instance['tube_assembly_id']][component] return result def to_sample(instance, additional_data): return (is_bracket_pricing(instance) + get_quantity(instance) + get_min_order_quantity(instance) + get_annual_usage(instance) + get_absolute_date(instance) + get_supplier(instance) + get_assembly_specs(instance, additional_data['assembly_to_specs']) + get_assembly_components(instance, additional_data['assembly_to_components'], additional_data['components_by_popularity'], 100) )</span></span></code> </pre><br>  Run the program without a new feature to remember what the result was on validation. <br><br> <code>Mean Squared Error: 0.7754770419953809</code> <br> <br>  And now add a new sign. <br><br> <code>Mean Squared Error: 0.711158610883329</code> <br> <br>  As we see, the quality of the prediction has again increased significantly.  By the way, we have the first numerical tuning parameter, namely, the number of the most popular components that we take into account.  Let's try to vary it, bearing in mind that, based on general considerations, as the parameter increases, the quality of the prediction should improve - after all, we take into account more and more previously unused information. <br><br> <code>100: 0.711158610883329</code> <br> <code>200: 16433833.592963027</code> <br> <code>150: 0.7110152873760721</code> <br> <code>170: 19183113.422557358</code> <br> <code>160: 0.7107685953594116</code> <br> <code>165: 0.7119011633609398</code> <br> <code>168: 24813512.02303443</code> <br> <code>166: 0.7119603793730067</code> <br> <code>167: 0.7119604617354474</code> <br> <br>  While it is difficult to say what happens after the disaster exceeds the value of 168, for what reason the quality of the prediction is so sharply and suddenly deteriorating.  For the rest - we do not see any significant changes.  To clear our conscience, let us see how the quality of the prediction will change with a decrease in the variable parameter. <br><br> <code>80: 0.7116311373463766</code> <br> <code>50: 0.7211560841347712</code> <br> <code>30: 0.7548570148032887</code> <br> <code>70: 0.7121518708790175</code> <br> <br><img src="https://habrastorage.org/webt/2v/xh/a6/2vxha6zorvijw4fvhvi3j9bprsc.png" alt="image"><br><br>  It can be seen that with a decrease in the number of components, the error increases, and for values ‚Äã‚Äãbetween 80 and 160, it remains approximately constant.  Let's leave the parameter at 100 for now. <br><br>  As you can see, adding new features still gives significant improvements on validation.  We will conduct a couple more experiments of this kind and then proceed to varying the training models and their tuning parameters.  Let us consider more complex, but, judging by the <a href="https://www.kaggle.com/c/caterpillar-tube-pricing/data">description of the</a> data files, the key file is <code>tube.csv</code> . <br><br><pre> <code class="bash hljs">$ head data/competition_data/tube.csv tube_assembly_id,material_id,diameter,wall,length,num_bends,bend_radius,end_a_1x,end_a_2x,end_x_1x,end_x_2x,end_a,end_x,num_boss,num_bracket,other TA-00001,SP-0035,12.7,1.65,164,5,38.1,N,N,N,N,EF-003,EF-003,0,0,0 TA-00002,SP-0019,6.35,0.71,137,8,19.05,N,N,N,N,EF-008,EF-008,0,0,0 TA-00003,SP-0019,6.35,0.71,127,7,19.05,N,N,N,N,EF-008,EF-008,0,0,0 TA-00004,SP-0019,6.35,0.71,137,9,19.05,N,N,N,N,EF-008,EF-008,0,0,0 TA-00005,SP-0029,19.05,1.24,109,4,50.8,N,N,N,N,EF-003,EF-003,0,0,0 TA-00006,SP-0029,19.05,1.24,79,4,50.8,N,N,N,N,EF-003,EF-003,0,0,0 TA-00007,SP-0035,12.7,1.65,202,5,38.1,N,N,N,N,EF-003,EF-003,0,0,0 TA-00008,SP-0039,6.35,0.71,174,6,19.05,N,N,N,N,EF-008,EF-008,0,0,0 TA-00009,SP-0029,25.4,1.65,135,4,63.5,N,N,N,N,EF-003,EF-003,0,0,0</code> </pre><br>  Note that the contents of the ‚Äúmaterial_id‚Äù column match the prefix with the values ‚Äã‚Äãspecified in <code>specs.csv</code> .  What it means is difficult to say, and after conducting a search for several values ‚Äã‚Äãof the type SP-xyzt contained in the first 20 lines of <code>specs.csv</code> we will not find anything, but it's worth remembering this feature just in case.  Also, based on the description of the competition, it is difficult to understand the actual difference between the material indicated in the column and the materials indicated in <code>bill_of_materials.csv</code> .  We will not, however, so far torment ourselves with such tricky questions and try to analyze in the usual way the number of possible options and convert the value into (hopefully) a feature useful for the algorithm. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>set_of_materials = set() &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'./data/competition_data/tube.csv'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> input_stream: ... header_line = input_stream.readline() ... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> input_stream: ... new_material = line.split(<span class="hljs-string"><span class="hljs-string">','</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>] ... set_of_materials.add(new_material) ... &gt;&gt;&gt; len(set_of_materials) <span class="hljs-number"><span class="hljs-number">20</span></span> &gt;&gt;&gt; set_of_materials {<span class="hljs-string"><span class="hljs-string">'SP-0034'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0037'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0039'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0030'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0029'</span></span>, <span class="hljs-string"><span class="hljs-string">'NA'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0046'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0028'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0031'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0032'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0033'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0019'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0048'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0008'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0045'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0035'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0044'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0036'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0041'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0038'</span></span>}</code> </pre><br>  It turned out quite a number of options, so that we can not hesitate to add a standard categorical feature.  To do this, we first <code>load_additional_data()</code> function by loading the <code>assembly_to_material</code> dictionary. <br><br><pre> <code class="python hljs">assembly_to_material = dict() <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'./data/competition_data/tube.csv'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> input_stream: header_line = input_stream.readline() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> input_stream: tube_assembly_id = line.split(<span class="hljs-string"><span class="hljs-string">','</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>] material_id = line.split(<span class="hljs-string"><span class="hljs-string">','</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>] assembly_to_material[tube_assembly_id] = material_id result[<span class="hljs-string"><span class="hljs-string">'assembly_to_material'</span></span>] = assembly_to_material</code> </pre><br>  And we use it when writing similar to one of the existing functions. <br><br><pre> <code class="python hljs">MATERIALS_LIST = [<span class="hljs-string"><span class="hljs-string">'NA'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0008'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0019'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0028'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0029'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0030'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0031'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0032'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0033'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0034'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0035'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0036'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0037'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0038'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0039'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0041'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0044'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0045'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0046'</span></span>, <span class="hljs-string"><span class="hljs-string">'SP-0048'</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_material</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance, assembly_to_material)</span></span></span><span class="hljs-function">:</span></span> material = assembly_to_material[instance[<span class="hljs-string"><span class="hljs-string">'tube_assembly_id'</span></span>]] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> material <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> MATERIALS_LIST: material_index = MATERIALS_LIST.index(material) result = [<span class="hljs-number"><span class="hljs-number">0</span></span>] * material_index + [<span class="hljs-number"><span class="hljs-number">1</span></span>] + [<span class="hljs-number"><span class="hljs-number">0</span></span>] * (len(MATERIALS_LIST) - material_index - <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: result = [<span class="hljs-number"><span class="hljs-number">0</span></span>] * len(MATERIALS_LIST) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result</code> </pre><br> <code>Mean Squared Error: 0.7187098083419174</code> <br> <br>  Alas, this symptom did not help us improve the already existing result of approximately 0.711.  But it does not matter - you can hope that our work will not be in vain and will help in setting up a more complex model.  The next column in the same <code>tube.csv</code> file describes the diameter of the tube.  Such a property of an object is called <i>quantitative</i> and is converted into a sign in the simplest and most natural way, namely, by taking a value.  Of course, in some cases it may be useful to somehow normalize it or change it in some other way, but for the first attempt, you can do without it.  Having written the code corresponding to this feature, which has become a familiar way, <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_diameter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance, assembly_to_diameter)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [assembly_to_diameter[instance[<span class="hljs-string"><span class="hljs-string">'tube_assembly_id'</span></span>]]]</code> </pre><br>  and adding it to the <code>to_sample()</code> function, we can get another improvement in the quality of model prediction on a validation sample. <br><br> <code>Mean Squared Error: 0.6968043166687439</code> <br> <br>  As we see, simple extraction of new and new features and testing the quality of model prediction on a validation sample continues to improve the quality metric.  However, on the one hand, the increase in new signs is no longer so great (and sometimes negative - and then the corresponding attribute must be abandoned, as in the previous example with the material), and on the other, we have a training project, not a competitive or working one. , so let's leave for the time the selection of features and move on to the question of choosing the algorithm and optimizing the parameters. <br><br><h2>  We vary models </h2><br>  In the framework of the current set of features, we will try to find a machine learning model that is close to optimal and has a corresponding set of hyper parameters.  Let's start with testing different models.  Let's try to replace the simplest linear regression with a fashionable neural net from the Keras package, one of the easiest to use. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Sequential <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.layers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Dense <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.optimizers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> SGD model = Sequential() model.add(Dense(units=<span class="hljs-number"><span class="hljs-number">30</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'tanh'</span></span>, input_dim=len(list_of_samples[<span class="hljs-number"><span class="hljs-number">0</span></span>]))) model.add(Dense(units=<span class="hljs-number"><span class="hljs-number">1</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'linear'</span></span>)) optimizer = SGD(lr=<span class="hljs-number"><span class="hljs-number">0.1</span></span>) model.compile(loss=<span class="hljs-string"><span class="hljs-string">'mean_squared_error'</span></span>, optimizer=optimizer, metrics=[<span class="hljs-string"><span class="hljs-string">'accuracy'</span></span>])</code> </pre><br>  That corresponds to the fully connected network architecture with the number of neurons in the layer equal to 30, <code>learning_rate</code> equal to 0.1 and activation function <code>tanh</code> .  Note that at the output layer the function is linear, and not one or another variation of sigmoids, since we predict a numerical parameter. <br><br> <code>Mean Squared Error: nan</code> <br> <br>  The error turned out to be so great that it did not fit in the (very rather big) numpy-ev int.  Let's try to add another layer. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Sequential <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.layers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Dense <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.optimizers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> SGD model = Sequential() model.add(Dense(units=<span class="hljs-number"><span class="hljs-number">30</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'tanh'</span></span>, input_dim=len(list_of_samples[<span class="hljs-number"><span class="hljs-number">0</span></span>]))) model.add(Dense(units=<span class="hljs-number"><span class="hljs-number">20</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'tanh'</span></span>, input_dim=len(list_of_samples[<span class="hljs-number"><span class="hljs-number">0</span></span>]))) model.add(Dense(units=<span class="hljs-number"><span class="hljs-number">1</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'linear'</span></span>)) optimizer = SGD(lr=<span class="hljs-number"><span class="hljs-number">0.1</span></span>) model.compile(loss=<span class="hljs-string"><span class="hljs-string">'mean_squared_error'</span></span>, optimizer=optimizer, metrics=[<span class="hljs-string"><span class="hljs-string">'accuracy'</span></span>])</code> </pre><br> <code>Mean Squared Error: nan</code> <br> <br>  Again, a good result did not work.  It is a pity, but, apparently, neural networks are a useful and good model, but not for our task.  However, if someone is able to get a good result for her using neural network type models, then I wait for references to the code in the comments, and we will switch to more conservative approaches.  For example, one of the standard algorithms for solving a regression problem is gradient boosting.  Let's try to use it. <br><br><pre> <code class="python hljs">model = GradientBoostingRegressor()</code> </pre><br> <code>Mean Squared Error: 0.44000911792278125</code> <br> <br>  Obvious great progress, no doubt lifted us up after a deafening failure with the advertised neural networks.  Here, of course, you can try some other algorithm like RidgeRegression, but in general, the author already knew that the gradient boosting for such tasks fits well, neural networks are very bad, and the other models are more or less, so let's not go through all possible options, and we will be engaged in optimization of hyper parameters of the most suitable of them, namely boosting. <br><br>  Going to the appropriate page of the Scikit-Learn website dedicated to the library, located <a href="http://scikit-learn.org/stable/modules/generated/sklearn.ensemble.GradientBoostingRegressor.html">here</a> or simply typing help (GradientBoostingRegressor) in the console, we learn that this implementation of the algorithm has the following set of tuning parameters and their default values: <br><br> <code>loss='ls'</code> <br> <code>learning_rate=0.1</code> <br> <code>n_estimators=100</code> <br> <code>subsample=1.0</code> <br> <code>criterion='friedman_mse'</code> <br> <code>min_samples_split=2</code> <br> <code>min_samples_leaf=1</code> <br> <code>min_weight_fraction_leaf=0.0</code> <br> <code>max_depth=3</code> <br> <code>min_impurity_decrease=0.0</code> <br> <code>min_impurity_split=None</code> <br> <code>init=None</code> <br> <code>random_state=None</code> <br> <code>max_features=None</code> <br> <code>alpha=0.9</code> <br> <code>verbose=0</code> <br> <code>max_leaf_nodes=None</code> <br> <code>warm_start=False</code> <br> <code>presort='auto'</code> <br> <br>  Let's analyze them one by one and try changing the ones that, at first glance, can help improve the quality of the prediction. <br><br><pre> <code class="bash hljs"> | loss : {<span class="hljs-string"><span class="hljs-string">'ls'</span></span>, <span class="hljs-string"><span class="hljs-string">'lad'</span></span>, <span class="hljs-string"><span class="hljs-string">'huber'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantile'</span></span>}, optional (default=<span class="hljs-string"><span class="hljs-string">'ls'</span></span>) | loss <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> to be optimized. <span class="hljs-string"><span class="hljs-string">'ls'</span></span> refers to least squares | regression. <span class="hljs-string"><span class="hljs-string">'lad'</span></span> (least absolute deviation) is a highly robust | loss <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> solely based on order information of the input | variables. <span class="hljs-string"><span class="hljs-string">'huber'</span></span> is a combination of the two. <span class="hljs-string"><span class="hljs-string">'quantile'</span></span> | allows quantile regression (use `alpha` to specify the quantile).</code> </pre><br>  The loss function that we optimize.  It would seem that after our reformulation of the task (in terms of taking logarithms from labels and, accordingly, MSE optimization instead of LMSE), the default parameter corresponds to our task.  Leave as is. <br><br><pre> <code class="python hljs"> | learning_rate : float, optional (default=<span class="hljs-number"><span class="hljs-number">0.1</span></span>) | learning rate shrinks the contribution of each tree by `learning_rate`. | There <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> a trade-off between learning_rate <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> n_estimators.</code> </pre><br>  In many tasks, the key parameter to configure.  Let's try to see what will happen for other values. <br><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>:<span class="hljs-string"><span class="hljs-string">'GradientBoostingRegressor'</span></span>, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>:<span class="hljs-number"><span class="hljs-number">0.100</span></span>} ... model = GradientBoostingRegressor(learning_rate=MODEL_SETTINGS[<span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>])</code> </pre><br>  A simple explicit declaration of the hyperparameter is written in such a somewhat fanciful form so that in the future it would be convenient to change the parameters of the model (and the models themselves) in the script header, as well as for reasons of ease of logging. <br><br> <code>Mean Squared Error: 0.44002379237806705</code> <br> <br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>:<span class="hljs-string"><span class="hljs-string">'GradientBoostingRegressor'</span></span>, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>:<span class="hljs-number"><span class="hljs-number">0.200</span></span>}</code> </pre><br> <code>Mean Squared Error: 0.41423518862618164</code> <br> <br>  Aha, with an increase in <code>learning_rate</code> the quality metric improves significantly.  Let's try to continue to change this parameter in the same direction. <br><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>:<span class="hljs-string"><span class="hljs-string">'GradientBoostingRegressor'</span></span>, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>:<span class="hljs-number"><span class="hljs-number">0.300</span></span>}</code> </pre><br> <code>Mean Squared Error: 0.4051555356961356</code> <br> <br>  Increase more <br><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>:<span class="hljs-string"><span class="hljs-string">'GradientBoostingRegressor'</span></span>, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>:<span class="hljs-number"><span class="hljs-number">0.500</span></span>}</code> </pre><br> <code>Mean Squared Error: 0.39668129369369115</code> <br> <br>  And further <br><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>:<span class="hljs-string"><span class="hljs-string">'GradientBoostingRegressor'</span></span>, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>:<span class="hljs-number"><span class="hljs-number">1.000</span></span>}</code> </pre><br> <code>Mean Squared Error: 0.434184026080522</code> <br> <br>  With the next increase in the parameter, the target metric has deteriorated.  Let's try to look for something among intermediate values. <br><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>:<span class="hljs-string"><span class="hljs-string">'GradientBoostingRegressor'</span></span>, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>:<span class="hljs-number"><span class="hljs-number">0.700</span></span>}</code> </pre><br> <code>Mean Squared Error: 0.39998809063954305</code> <br> <br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>:<span class="hljs-string"><span class="hljs-string">'GradientBoostingRegressor'</span></span>, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>:<span class="hljs-number"><span class="hljs-number">0.600</span></span>}</code> </pre><br> <code>Mean Squared Error: 0.4032676539076024</code> <br> <br>  The data obtained in the experiments are already quite confusing, let's tabulate them and draw the corresponding schedule (I personally do not usually look at the graphs in such cases, limiting themselves to mental constructions, but for pedagogical purposes this may be useful). <br><br><table><tbody><tr><th>  learning_rate </th><th>  MSE </th></tr><tr><td align="center">  0.100 </td><td align="center">  0.4400 </td></tr><tr><td align="center">  0.200 </td><td align="center">  0.4142 </td></tr><tr><td align="center">  0.300 </td><td align="center">  0.4051 </td></tr><tr><td align="center">  0.500 </td><td align="center">  0.3966 </td></tr><tr><td align="center">  0.600 </td><td align="center">  0.4032 </td></tr><tr><td align="center">  0.700 </td><td align="center">  0.3999 </td></tr><tr><td align="center">  1,000 </td><td align="center">  0.4341 </td></tr></tbody></table><br><img src="https://habrastorage.org/webt/c_/fa/af/c_faafka8g1hufr4eo_uvvuw8ge.png" alt="image"><br><br>  At first glance, it looks as if the quality metric improves with a decrease in <code>learning_rate</code> from 0.100 to 0.500, then, until approximately 0.700, it remains relatively stable, and then worsens.  Let's test this hypothesis with more experiments. <br><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>:<span class="hljs-string"><span class="hljs-string">'GradientBoostingRegressor'</span></span>, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>:<span class="hljs-number"><span class="hljs-number">0.400</span></span>}</code> </pre><br> <code>Mean Squared Error: 0.40129637223972486</code> <br> <br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: <span class="hljs-string"><span class="hljs-string">'GradientBoostingRegressor'</span></span>, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.800</span></span>}</code> </pre><br> <code>Mean Squared Error: 0.4253214442400451</code> <br> <br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: <span class="hljs-string"><span class="hljs-string">'GradientBoostingRegressor'</span></span>, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.550</span></span>}</code> </pre><br> <code>Mean Squared Error: 0.39587242367884334</code> <br> <br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: <span class="hljs-string"><span class="hljs-string">'GradientBoostingRegressor'</span></span>, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.650</span></span>}</code> </pre><br> <code>Mean Squared Error: 0.40041838873950636</code> <br> <br><table><tbody><tr><th>  learning_rate </th><th>  MSE </th></tr><tr><td align="center">  0.100 </td><td align="center">  0.4400 </td></tr><tr><td align="center">  0.200 </td><td align="center">  0.4142 </td></tr><tr><td align="center">  0.300 </td><td align="center">  0.4051 </td></tr><tr><td align="center">  0.400 </td><td align="center">  0.4012 </td></tr><tr><td align="center">  0.500 </td><td align="center">  0.3966 </td></tr><tr><td align="center">  0.550 </td><td align="center">  0.3958 </td></tr><tr><td align="center">  0.600 </td><td align="center">  0.4032 </td></tr><tr><td align="center">  0.650 </td><td align="center">  0.4004 </td></tr><tr><td align="center">  0.700 </td><td align="center">  0.3999 </td></tr><tr><td align="center">  0.800 </td><td align="center">  0.4253 </td></tr><tr><td align="center">  1,000 </td><td align="center">  0.4341 </td></tr></tbody></table><br><br><img src="https://habrastorage.org/webt/6c/_f/p2/6c_fp2co0byujv9kwyvavjd2ag0.png" alt="image"><br><br>  It seems that the optimal value lies somewhere around 0.500 - 0.550 and changes in one direction or another by and large already have little effect on the final metric compared to other possible changes in the parameters of the model or the list of features.  Let's fix the learning_rate on the value 0.550 and pay attention to other parameters of our model. <br><br>  By the way, in similar cases, in order to verify the correct selection of one or another set of hyperparameters, it may be useful to change the random_state parameter that many algorithms have or even divide the sample into training and validation while maintaining the number of elements in them.  This will help to gather more information about the real efficiency of the algorithm in the case of not quite clear patterns between the settings of the hyperparameters and the quality of the prediction on the validation sample. <br><br>  |  n_estimators: int (default = 100) <br>  |  The number of boost stages to perform.  Gradient boosting <br>  |  large number usually <br>  |  results in better performance. <br><br>  The number of some ‚Äúboosting stages‚Äù when learning a gradient boosting model.  The author, to be frank, has already forgotten what role they play in the formal definition of the algorithm, however, let‚Äôs take this argument.  By the way, let's begin to note the time spent on training the model. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>:<span class="hljs-string"><span class="hljs-string">'GradientBoostingRegressor'</span></span>, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>:<span class="hljs-number"><span class="hljs-number">0.550</span></span>, <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>:<span class="hljs-number"><span class="hljs-number">100</span></span>} model = GradientBoostingRegressor(learning_rate=MODEL_SETTINGS[<span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>], n_estimators=MODEL_SETTINGS[<span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>]) time_start = time.time() model.fit(numpy.array(train_samples), numpy.array(train_labels)) print(<span class="hljs-string"><span class="hljs-string">'Time spent: {0}'</span></span>.format(time.time() - time_start)) print(<span class="hljs-string"><span class="hljs-string">'MODEL_SETTINGS = {{\n {0}\n {1}\n {2}}}'</span></span> .format(MODEL_SETTINGS[<span class="hljs-string"><span class="hljs-string">'model_name'</span></span>], MODEL_SETTINGS[<span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>], MODEL_SETTINGS[<span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>]))</code> </pre><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span>, <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>}</code> </pre><br> <code>Time spent: 71.83099746704102</code> <br> <code>Mean Squared Error: 0.39622103688045596</code> <br> <br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span> <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span>}</code> </pre><br> <code>Time spent: 141.9290111064911</code> <br> <code>Mean Squared Error: 0.40527237378150016</code> <br> <br>  ,      ,     .    -     . <br><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span> <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">300</span></span>}</code> </pre><br> <code>Time spent: 204.2548701763153</code> <br> <code>Mean Squared Error: 0.4027642069054909</code> <br> <br> ,  ,          . <br><br>  | max_depth: integer, optional (default=3) <br>  | maximum depth of the individual regression estimators. The maximum <br>  | depth limits the number of nodes in the tree. Tune this parameter <br>  | for best performance; the best value depends on the interaction <br>  | of the input variables. <br><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span> <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-string"><span class="hljs-string">'max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>}</code> </pre><br> <code>Time spent: 66.88031792640686</code> <br> <code>Mean Squared Error: 0.39713231957974565</code> <br> <br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span> <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-string"><span class="hljs-string">'max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>}</code> </pre><br> <code>Time spent: 86.24338245391846</code> <br> <code>Mean Squared Error: 0.40575622943301354</code> <br> <br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span> <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-string"><span class="hljs-string">'max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>}</code> </pre><br> <code>Time spent: 45.39022421836853</code> <br> <code>Mean Squared Error: 0.41356622455188463</code> <br> <br>  ,    ‚Äî       . <br><br>  | criterion: string, optional (default=¬´friedman_mse¬ª) <br>  | The function to measure the quality of a split. Supported criteria <br>  | are ¬´friedman_mse¬ª for the mean squared error with improvement <br>  | score by Friedman, ¬´mse¬ª for mean squared error, and ¬´mae¬ª for <br>  | the mean absolute error. The default value of ¬´friedman_mse¬ª is <br>  | generally the best as it can provide a better approximation in <br>  | some cases. <br><br>  ,       ,      - ,           ,       . <br><br>  | min_samples_split: int, float, optional (default=2) <br>  | The minimum number of samples required to split an internal node: <br>  | <br>  | ‚Äî If int, then consider `min_samples_split` as the minimum number. <br>  | ‚Äî If float, then `min_samples_split` is a percentage and <br>  | `ceil(min_samples_split * n_samples)` are the minimum <br>  | number of samples for each split. <br>  | <br> |‚Ä¶ versionchanged:: 0.18 <br>  | Added float values for percentages. <br><br>   ,          .   . <br><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span> <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-string"><span class="hljs-string">'max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-string"><span class="hljs-string">'min_samples_split'</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } &lt;source&gt; &lt;code&gt;Time spent: <span class="hljs-number"><span class="hljs-number">66.22262406349182</span></span>&lt;/code&gt; &lt;code&gt;Mean Squared Error: <span class="hljs-number"><span class="hljs-number">0.39721489877049687</span></span>&lt;/code&gt;    - ,  ,      .  . &lt;source lang=<span class="hljs-string"><span class="hljs-string">"python"</span></span>&gt; MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span>, <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> , <span class="hljs-string"><span class="hljs-string">'min_samples_split'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> }</code> </pre><br> <code>Time spent: 66.18473935127258</code> <br> <code>Mean Squared Error: 0.39493122173406714</code> <br> <br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span> <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-string"><span class="hljs-string">'max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-string"><span class="hljs-string">'min_samples_split'</span></span>: <span class="hljs-number"><span class="hljs-number">8</span></span> }</code> </pre><br> <code>Time spent: 66.7643404006958</code> <br> <code>Mean Squared Error: 0.3982469042761572</code> <br> <br>  ,     .        4. <br><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span>, <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'min_samples_split'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span> }</code> </pre><br> <code>Time spent: 66.75952744483948</code> <br> <code>Mean Squared Error: 0.3945186290058591</code> <br> <br>  - ,   3, ,   ,  ,      ,   . <br><br>  | min_samples_leaf: int, float, optional (default=1) <br>  | The minimum number of samples required to be at a leaf node: <br>  | <br>  | ‚Äî If int, then consider `min_samples_leaf` as the minimum number. <br>  | ‚Äî If float, then `min_samples_leaf` is a percentage and <br>  | `ceil(min_samples_leaf * n_samples)` are the minimum <br>  | number of samples for each node. <br>  | <br> |‚Ä¶ versionchanged:: 0.18 <br>  | Added float values for percentages. <br><br>   ,        .          (. .    ,             ) ,  ,    .  ,    ,    . <br><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span>, <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'min_samples_split'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-string"><span class="hljs-string">'min_samples_leaf'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>}</code> </pre><br> <code>Time spent: 68.58824563026428</code> <br> <code>Mean Squared Error: 0.39465027476703846</code> <br> <br>      ¬´ ¬ª       .  ,    ,  (  )         ,       . <br><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span>, <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'min_samples_split'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-string"><span class="hljs-string">'min_samples_leaf'</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>}</code> </pre><br> <code>Time spent: 68.03447198867798</code> <br> <code>Mean Squared Error: 0.39707533548242</code> <br> <br>     1  2      . -     . <br><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span>, <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'min_samples_split'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'min_samples_leaf'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'random_seed'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>}</code> </pre><br> <code>Time spent: 66.98832631111145</code> <br> <code>Mean Squared Error: 0.39419555554861274</code> <br> <br>  ,       ,    ,   ,      .         ,         ,         . ,      random_seed. <br><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span>, <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'min_samples_split'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'min_samples_leaf'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'random_seed'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>}</code> </pre><br> <code>Time spent: 67.16857171058655</code> <br> <code>Mean Squared Error: 0.39483997966302</code> <br> <br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span>, <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'min_samples_split'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-string"><span class="hljs-string">'min_samples_leaf'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'random_seed'</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>}</code> </pre><br> <code>Time spent: 66.11015605926514</code> <br> <code>Mean Squared Error: 0.39492203941997045</code> <br> <br>  ,          ,          .    ¬´  ¬ª ,          .      . <br><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span>, <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'min_samples_split'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-string"><span class="hljs-string">'min_samples_leaf'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span> , <span class="hljs-string"><span class="hljs-string">'random_seed'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>}</code> </pre><br> <code>Time spent: 66.96864414215088</code> <br> <code>Mean Squared Error: 0.39725274882841366</code> <br> <br>  .  ,   ,       -      ,   ?  . <br><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span>, <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'min_samples_split'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-string"><span class="hljs-string">'min_samples_leaf'</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span> , <span class="hljs-string"><span class="hljs-string">'random_seed'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>}</code> </pre><br> <code>Time spent: 66.33412432670593</code> <br> <code>Mean Squared Error: 0.39348528600652666</code> <br> <br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span>, <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'min_samples_split'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-string"><span class="hljs-string">'min_samples_leaf'</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span> , <span class="hljs-string"><span class="hljs-string">'random_seed'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>}</code> </pre><br> <code>Time spent: 66.22624254226685</code> <br> <code>Mean Squared Error: 0.3935675331843957</code> <br> <br>    .   ¬´¬ª           .  ,      . <br><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span>, <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'min_samples_split'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'min_samples_leaf'</span></span>: <span class="hljs-number"><span class="hljs-number">6</span></span> , <span class="hljs-string"><span class="hljs-string">'random_seed'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>}</code> </pre><br> <code>Time spent: 66.88769054412842</code> <br> <code>Mean Squared Error: 0.38855940004423717</code> <br> <br>      5  6    .        ,           . <br><br><table><tbody><tr><th> min_samples_leaf </th><th> MSE </th><th> time spent </th></tr><tr><td align="center">  one </td><td align="center"> 0.3946 </td><td align="center"> 68.58 </td></tr><tr><td align="center">  2 </td><td align="center"> 0.3970 </td><td align="center"> 68.03 </td></tr><tr><td align="center">  3 </td><td align="center"> 0.3941 </td><td align="center"> 66.98 </td></tr><tr><td align="center">  four </td><td align="center"> 0.3972 </td><td align="center"> 66.96 </td></tr><tr><td align="center">  five </td><td align="center"> 0.3934 </td><td align="center"> 66.33 </td></tr><tr><td align="center">  6 </td><td align="center"> 0.3885 </td><td align="center"> 66.88 </td></tr><tr><td align="center">  7 </td><td align="center"> 0.3895 </td><td align="center"> 65.22 </td></tr><tr><td align="center">  eight </td><td align="center"> 0.3903 </td><td align="center"> 65.89 </td></tr><tr><td align="center">  9 </td><td align="center"> 0.3926 </td><td align="center"> 66.31 </td></tr></tbody></table><br><br><img src="https://habrastorage.org/webt/sx/y-/ay/sxy-ayrpujv3g_ilrypgeff-pdu.png"><br><br>        ,  ,    min_samples_leaf  6.      . <br><br>  | min_weight_fraction_leaf: float, optional (default=0.) <br>  | The minimum weighted fraction of the sum total of weights (of all <br>  | the input samples) required to be at a leaf node. Samples have <br>  | equal weight when sample_weight is not provided. <br><br>   ,    .      ,      .  ,       ,   mean_samples_leaf. <br><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span>, <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'min_samples_split'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'min_samples_leaf'</span></span>: <span class="hljs-number"><span class="hljs-number">6</span></span> , <span class="hljs-string"><span class="hljs-string">'random_seed'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'min_weight_fraction_leaf'</span></span>: <span class="hljs-number"><span class="hljs-number">0.01</span></span>}</code> </pre><br> <code>Time spent: 68.06336092948914</code> <br> <code>Mean Squared Error: 0.41160143391833687</code> <br> <br> ,   .   ,     ? <br><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span>, <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'min_samples_split'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'min_samples_leaf'</span></span>: <span class="hljs-number"><span class="hljs-number">6</span></span> , <span class="hljs-string"><span class="hljs-string">'random_seed'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'min_weight_fraction_leaf'</span></span>: <span class="hljs-number"><span class="hljs-number">0.001</span></span>}</code> </pre><br> <code>Time spent: 67.03254532814026</code> <br> <code>Mean Squared Error: 0.39262469473669265</code> <br> <br>     .  ,     ,       ,   min_samples_leaf,   min_weight_fraction_leaf.        . <br><br>  | subsample: float, optional (default=1.0) <br>  | The fraction of samples to be used for fitting the individual base <br>  | learners. If smaller than 1.0 this results in Stochastic Gradient <br>  | Boosting. `subsample` interacts with the parameter `n_estimators`. <br>  | Choosing `subsample &lt; 1.0` leads to a reduction of variance <br>  | and an increase in bias. <br><br><pre> <code class="python hljs">MODEL_SETTINGS = { <span class="hljs-string"><span class="hljs-string">'model_name'</span></span>: GradientBoostingRegressor, <span class="hljs-string"><span class="hljs-string">'learning_rate'</span></span>: <span class="hljs-number"><span class="hljs-number">0.55</span></span>, <span class="hljs-string"><span class="hljs-string">'n_estimators'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'max_depth'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'min_samples_split'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'min_samples_leaf'</span></span>: <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'random_seed'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'min_weight_fraction_leaf'</span></span>: <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-string"><span class="hljs-string">'subsample'</span></span>: <span class="hljs-number"><span class="hljs-number">0.9</span></span>}</code> </pre><br> <code>Time spent: 155.24894833564758</code> <br> <code>Mean Squared Error: 0.39231319253775626</code> <br> <br>  ,          (  ,     ).  ,    ,     kaggle          . ,     kaggle     ,   ,   ,         <a href="https://habrahabr.ru/post/351074/">  </a> ,         . <br><br><h2>     </h2><br>      generate_response.py. <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"> [generate_response.py] <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pickle <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> research <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FinalModel</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, model, to_sample, additional_data)</span></span></span><span class="hljs-function">:</span></span> self._model = model self._to_sample = to_sample self._additional_data = additional_data <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, instance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._model.predict(numpy.array(self._to_sample( instance, self._additional_data)).reshape(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>))[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'./data/model.mdl'</span></span>, <span class="hljs-string"><span class="hljs-string">'rb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> input_stream: model = pickle.loads(input_stream.read()) additional_data = research.load_additional_data() final_model = FinalModel(model, research.to_sample, additional_data) <span class="hljs-comment"><span class="hljs-comment"># print(final_model.process({'tube_assembly_id':'TA-00001', 'supplier':'S-0066', # 'quote_date':'2013-06-23', 'annual_usage':'0', # 'min_order_quantity':'0', 'bracket_pricing':'Yes', # 'quantity':'1'})) list_of_predictions = [] with open('./data/competition_data/test_set.csv') as input_stream: header_line = input_stream.readline() column_names = header_line[:-1].split(',') for line in input_stream: cell_values = line[:-1].split(',') # new_id = cell_values[column_names.index('id')] new_id = cell_values[0] # id column new_instance = dict(zip(column_names[1:], cell_values[1:])) new_prediction = final_model.process(new_instance) list_of_predictions.append((new_id, new_prediction)) with open('./data/output.csv', 'w') as output_stream: output_stream.write('id,cost\n') for prediction in list_of_predictions: output_stream.write(prediction[0] + ',' + str(prediction[1]) + '\n')</span></span></code> </pre><br></div></div><br>       <a href="https://yadi.sk/d/PwRX3iCU3V62LU"></a> ,   <code>research.py</code>      <code>test_set.csv</code> ,   <a href=""></a> ,   .      <a href="https://yadi.sk/i/BlX1xX9_3V62L8">output.csv</a> .  ,       <code>generate_response.py</code>       (serving) .   ,      ,  ,  ,   ,   ,   ,         . <br><br>   kaggle  ,      ,         <a href="https://www.kaggle.com/c/caterpillar-tube-pricing/submit"></a> . <br><br><img src="https://habrastorage.org/webt/nh/zo/ze/nhzoze5otccwy9y6mo6y8ppila0.jpeg" alt="image"><br><br> ,   ,  ‚Äî     ,   . ,   ,          ,    ‚Äî      (   )     .         . <br><br><h2>  Conclusion </h2><br> ,    ,   ,            ,    , , ,       kaggle.        ,    ! <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"> ,  ,              .     HR-      .           ,      ,    , ,        (       ).   ,         ,               .   ,       ,   ,   ,     -      ,       .    ,            .      (  ‚Äî )    ,       ,    ,             . <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/354154/">https://habr.com/ru/post/354154/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354144/index.html">Hypothesis Quick Start Guide</a></li>
<li><a href="../354146/index.html">Hypotesis - Details and Extras</a></li>
<li><a href="../354148/index.html">Security Week 14: RSA Conference, Holed Advertising Networks, Alliances and Confrontation</a></li>
<li><a href="../354150/index.html">How we participated in the hackathon from OpenData</a></li>
<li><a href="../354152/index.html">Mobius-2018: robo report</a></li>
<li><a href="../354158/index.html">GitLab for Continuous Delivery project on InterSystems technology</a></li>
<li><a href="../354160/index.html">Whose weather forecast is more accurate?</a></li>
<li><a href="../354162/index.html">Chances of success in the European Court of Complaints about blocking resources</a></li>
<li><a href="../354164/index.html">3CX WebMeeting update, 3CX client for iOS and the Click to Call extension for Firefox</a></li>
<li><a href="../354166/index.html">How to stop being a demiurge and entrust the creation of PowerShell entities</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>