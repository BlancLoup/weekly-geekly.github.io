<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to draw curves graphics in the style of XKCD</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently I published an article on Habr√© about a guitar tuner , and many were interested in animated graphics that I used to illustrate sound waves, i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to draw curves graphics in the style of XKCD</h1><div class="post__text post__text-html js-mediator-article">  Recently I published an article on Habr√© <a href="http://habrahabr.ru/post/266471/">about a guitar tuner</a> , and many were interested in animated graphics that I used to illustrate sound waves, including the technology for creating such graphs.  Therefore, in this article I will share my approach and library on Node.js which will help to build such graphs. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d2e/d2c/a89/d2ed2ca89c1f42f39f2b71032fe53a59.png"></div><br><a name="habracut"></a><br><h2>  Prehistory </h2><br><h3>  Why make graphics curves? </h3><br>  In general, the idea of ‚Äã‚Äãcreating curves graphs comes from academic culture - not only Russian, but also global. <br><br>  This approach, when even quite complex scientific information is illustrated by sloppy charts, is a fairly common practice. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It is on this nuance that XKCD comics are created, the humor of which is based on simple dependencies interpreted in some unusual manner: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d51/5ed/968/d515ed96835741b782bde4b9054ae371.png"></div><br><br>  Negligence in the graphs allows you to shift attention from a quantitative assessment to a qualitative one, which in turn contributes to a better perception of new information. <br><br><h3>  Why write scripts to build graphs? </h3><br>  Firstly, when a publication is prepared where there is a lot of source data or where this data can change during preparation, it is better to compile and store graphs in the form of scripts.  In this case, if the data or results change during the preparation of the publication, you can re-arrange the graphs automatically. <br><br>  Secondly, it is difficult to say how a particular chart will look like in a publication; therefore, it is often necessary to adjust to the size of the fields, indents, and the alignment of the text.  This is easiest to do if there is a script and it allows you to rebuild the schedule for a new look by changing the parameters.  On the contrary, if the schedule was made without a script in some editor, such manipulations become time consuming. <br><br>  Thirdly, graphics in the form of scripts are much more convenient to maintain due to the ability to use version control systems - there is always the opportunity to roll back or merge patches without fear of losing working data. <br><br><h3>  Why Node.js? </h3><br>  There are many libraries for building graphs, including the XKCD effect, there are extensions for matplotlib and a special package for R. However, Javascript has several advantages. <br><br>  For Javascript, a convenient, convenient browser-based Canvas and Node.js libraries are available that implement this behavior.  In turn, the script written for Canvas can be reproduced in the browser, which allows, for example, to display data on the site dynamically.  Canvas is also useful for debugging animations in the browser, since  drawing actually happens on the fly.  Having a drawing script on Node.js, you can use the GIFEncoder package, which makes it very easy to create an animated movie. <br><br><h2>  Add curvature </h2><br>  The appearance of graphs in the style of XKCD can be obtained by adding random offsets.  But these offsets should not be added at every point, otherwise there will simply be a vague schedule, but with some step. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/4c7/c50/149/4c7c50149d9448dea42554808805dad4.png"></div><br><br>  Therefore, any line that needs to be drawn must be broken, and already the nodal points must be shifted by some random variable.  Since  the incoming line may contain either too small or too large sections, then an algorithm is required that would combine too small into large, and vice versa would break large sections into small ones. <br><br>  The described behavior can be implemented as follows: <br><br><pre><code class="hljs pgsql">self.replot = <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(<span class="hljs-type"><span class="hljs-type">line</span></span>, step, radius){ var accuracy = <span class="hljs-number"><span class="hljs-number">0.25</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-type"><span class="hljs-type">line</span></span>.length &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> []; var replottedLine = []; var beginning = <span class="hljs-type"><span class="hljs-type">line</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>]; replottedLine.push(beginning); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(var i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt; <span class="hljs-type"><span class="hljs-type">line</span></span>.length; i++){ var <span class="hljs-type"><span class="hljs-type">point</span></span> = <span class="hljs-type"><span class="hljs-type">line</span></span>[i]; var dx = <span class="hljs-type"><span class="hljs-type">point</span></span>.x - beginning.x; var dy = <span class="hljs-type"><span class="hljs-type">point</span></span>.y - beginning.y; var d = Math.sqrt(dx*dx+dy*dy); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(d &lt; step * (<span class="hljs-number"><span class="hljs-number">1</span></span> - accuracy) &amp;&amp; (i + <span class="hljs-number"><span class="hljs-number">1</span></span> &lt; <span class="hljs-type"><span class="hljs-type">line</span></span>.length)){ // too short <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(d &gt; step * (<span class="hljs-number"><span class="hljs-number">1</span></span> + accuracy)){ // too long var n = Math.ceil(d / step); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(var j = <span class="hljs-number"><span class="hljs-number">1</span></span>; j &lt; n; j++){ replottedLine.push({ x: beginning.x + dx * j / n, y: beginning.y + dy * j / n }); } } replottedLine.push(<span class="hljs-type"><span class="hljs-type">point</span></span>); beginning = <span class="hljs-type"><span class="hljs-type">point</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(var i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt; replottedLine.length; i++){ var <span class="hljs-type"><span class="hljs-type">point</span></span> = replottedLine[i]; replottedLine[i].x = <span class="hljs-type"><span class="hljs-type">point</span></span>.x + radius * (self.random() - <span class="hljs-number"><span class="hljs-number">0.5</span></span>); replottedLine[i].y = <span class="hljs-type"><span class="hljs-type">point</span></span>.y + radius * (self.random() - <span class="hljs-number"><span class="hljs-number">0.5</span></span>); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> replottedLine; };</code> </pre> <br><br>  The result of such processing: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/b0b/d38/270/b0bd38270f2b40f4a606c0e8a21b716c.png"></div><br><br>  Since  Since random displacements make even the smoothest graphs broken (and the sine wave is the ideal of smoothness), then it is impossible to stop at random displacements ‚Äî you must return the lost smoothness.  One of the ways to return smoothness is to use quadratic curves instead of straight lines. <br><br>  The quadraticCurveTo method from Canvas represents a drawing with smoothness sufficient for our tasks, but it also requires auxiliary nodes.  These nodes can be calculated based on the reference points obtained in the previous step: <br><br><pre> <code class="hljs matlab"> ctx.beginPath(); ctx.moveTo(replottedLine[<span class="hljs-number"><span class="hljs-number">0</span></span>].x, replottedLine[<span class="hljs-number"><span class="hljs-number">0</span></span>].y); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(var <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> &lt; replottedLine.<span class="hljs-built_in"><span class="hljs-built_in">length</span></span> - <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> ++){ var point = replottedLine[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>]; var nextPoint = replottedLine[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>]; var xc = (point.x + nextPoint.x) / <span class="hljs-number"><span class="hljs-number">2</span></span>; var yc = (point.y + nextPoint.y) / <span class="hljs-number"><span class="hljs-number">2</span></span>; ctx.quadraticCurveTo(point.x, point.y, xc, yc); } ctx.quadraticCurveTo(replottedLine[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>].x, replottedLine[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>].y, replottedLine[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>].x,replottedLine[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>].y); ctx.stroke();</code> </pre><br><br>  The resulting smoothed line will correspond exactly to the sloppy shape: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b41/0a2/80b/b410a280bacf478a9d24b773fd57d24f.png"></div><br><br><h2>  Clumsy Library </h2><br><br>  Based on the above algorithms, I built a small library.  It is based on the Clumsy wrapper class, which implements the desired behavior using the Canvas object. <br><br>  In the case of Node.js, the initialization process looks like this: <br><br><pre> <code class="hljs javascript"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Canvas = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Clumsy = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'clumsy'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> canvas = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Canvas(<span class="hljs-number"><span class="hljs-number">800</span></span>, <span class="hljs-number"><span class="hljs-number">600</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> clumsy = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Clumsy(canvas);</code> </pre><br><br>  The main methods of the class are needed to draw the simplest graphics: <br><br><pre> <code class="hljs ruby"> range(xa, xb, ya, yb); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     padding(size); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     draw(line); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   axis(axis, a, b); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   clear(color); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  canvas   tabulate(a, b, step, cb); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     </code> </pre><br><br>  A more complete list of methods and fields, as well as their description and examples of use can be found in the <a href="https://www.npmjs.com/package/clumsy">project documentation for npm</a> . <br><br>  How it works can be demonstrated by the example of sine: <br><br><pre> <code class="hljs javascript"> clumsy.font(<span class="hljs-string"><span class="hljs-string">'24px VoronovFont'</span></span>); clumsy.padding(<span class="hljs-number"><span class="hljs-number">100</span></span>); clumsy.range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sine = clumsy.tabulate(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI, <span class="hljs-number"><span class="hljs-number">0.01</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sin); clumsy.draw(sine); clumsy.axis(<span class="hljs-string"><span class="hljs-string">'x'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>); clumsy.axis(<span class="hljs-string"><span class="hljs-string">'y'</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>); clumsy.fillTextAtCenter(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-number"><span class="hljs-number">400</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>);</code> </pre><br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/863/77f/9f0/86377f9f0c4041b285ca430e5633cc98.png"></div><br><br><h2>  Animation </h2><br><br>  Getting a moving image on a Canvas in the browser is quite simple, just wrap the rendering algorithm into a function and pass it to setInterval.  This approach is useful primarily for debugging, since  the result is directly observed.  As for the generation of the finished gif on Node.js, in this case, you can use the GIFEncoder library. <br><br>  For example, take the Archimedes spiral, which we make rotate at a speed of pi radians per second. <br>  When you need to animate a certain graph, it is most convenient to make a separate file that is solely responsible for drawing, and separate files that set animation parameters - fps, movie duration, etc.  Let's name the script of the drawing spiral.js and create the Spiral function in it: <br><br><pre> <code class="hljs javascript"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Spiral</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">clumsy, phase</span></span></span><span class="hljs-function">)</span></span>{ clumsy.clear(<span class="hljs-string"><span class="hljs-string">'white'</span></span>); clumsy.padding(<span class="hljs-number"><span class="hljs-number">100</span></span>); clumsy.range(<span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); clumsy.radius = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> spiral = clumsy.tabulate(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0.01</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">t</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r = <span class="hljs-number"><span class="hljs-number">0.5</span></span> * t; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: r * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.cos(<span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI * t + phase), <span class="hljs-attr"><span class="hljs-attr">y</span></span>: r * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sin(<span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI * t + phase) }; }) clumsy.draw(spiral); clumsy.axis(<span class="hljs-string"><span class="hljs-string">'x'</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>); clumsy.axis(<span class="hljs-string"><span class="hljs-string">'y'</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>); clumsy.fillTextAtCenter(<span class="hljs-string"><span class="hljs-string">''</span></span>, clumsy.canvas.width/<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>); } <span class="hljs-comment"><span class="hljs-comment">//       if(typeof module != 'undefined' &amp;&amp; module.exports){ module.exports = Spiral; }</span></span></code> </pre><br><br>  Then you can view the result in a browser by making a debug page: <br><br><pre> <code class="html hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">!DOCUMENT</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://rawgit.com/kreshikhin/clumsy/master/clumsy.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://webfonts.ru/import/voronov.css"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"canvas"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">600</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">600</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"spiral.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> canvas = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementById(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'canvas'</span></span></span><span class="javascript">); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> clumsy = </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> Clumsy(canvas); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> phase = </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">; setInterval(</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>)</span></span></span><span class="javascript">{ </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">//  seed  ""  clumsy.seed(123); Spiral(clumsy, phase); phase += Math.PI / 10; }, 50); </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Debugging in the browser is convenient because the result appears immediately.  Since  no time required to generate frames and compress to GIF format.  What may take a few minutes.  Saving the page in the .html format and opening in the browser we should see a rotating spiral on the Canvas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/5a9/fda/0b4/5a9fda0b41c34d0f928c5a132674b096.gif"></div><br><br>  When the graph is debugged, you can use the same spiral.js file to create a script to generate a GIF file: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Canvas = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> GIFEncoder = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gifencoder'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Clumsy = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'clumsy'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> helpers = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'clumsy/helpers'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Spiral = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./spiral.js'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> canvas = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Canvas(<span class="hljs-number"><span class="hljs-number">600</span></span>, <span class="hljs-number"><span class="hljs-number">600</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> clumsy = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Clumsy(canvas); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> encoder = helpers.prepareEncoder(GIFEncoder, canvas); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> phase = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n = <span class="hljs-number"><span class="hljs-number">10</span></span>; encoder.start(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; n; i++){ <span class="hljs-comment"><span class="hljs-comment">//  seed  ""  clumsy.seed(123); Spiral(clumsy, phase); phase += 2 * Math.PI / n; encoder.addFrame(clumsy.ctx); }; encoder.finish();</span></span></code> </pre><br><br>  In exactly the same way, I created graphics to illustrate the standing wave phenomenon: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/b49/a38/251/b49a3825146b4133b38b70e9b9320c23.gif"></div><br><br><div class="spoiler">  <b class="spoiler_title">Source code scituner-standing-group.js</b> <div class="spoiler_text"><pre> <code class="hljs javascript"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StandingGroup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">clumsy, shift</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> canvas = clumsy.canvas; clumsy.clean(<span class="hljs-string"><span class="hljs-string">'white'</span></span>); clumsy.ctx.font = <span class="hljs-string"><span class="hljs-string">'24px VoronovFont'</span></span>; clumsy.padding(<span class="hljs-number"><span class="hljs-number">100</span></span>); clumsy.range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1.1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); clumsy.radius = <span class="hljs-number"><span class="hljs-number">3</span></span>; clumsy.step = <span class="hljs-number"><span class="hljs-number">10</span></span>; clumsy.lineWidth(<span class="hljs-number"><span class="hljs-number">2</span></span>); clumsy.color(<span class="hljs-string"><span class="hljs-string">'black'</span></span>); clumsy.axis(<span class="hljs-string"><span class="hljs-string">'x'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1.1</span></span>); clumsy.axis(<span class="hljs-string"><span class="hljs-string">'y'</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> f0 = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wave = clumsy.tabulate(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1.01</span></span>, <span class="hljs-number"><span class="hljs-number">0.01</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">t0</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dt = shift / f0; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = t0 + dt; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0.5</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sin(<span class="hljs-number"><span class="hljs-number">2</span></span>*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI*f0*t) * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.exp(<span class="hljs-number"><span class="hljs-number">-15</span></span>*(t0<span class="hljs-number"><span class="hljs-number">-0.5</span></span>)*(t0<span class="hljs-number"><span class="hljs-number">-0.5</span></span>)); }); clumsy.color(<span class="hljs-string"><span class="hljs-string">'red'</span></span>); clumsy.draw(wave); clumsy.fillTextAtCenter(<span class="hljs-string"><span class="hljs-string">" , V = 0"</span></span>, canvas.width/<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>); clumsy.fillText(<span class="hljs-string"><span class="hljs-string">"x(t)"</span></span>, <span class="hljs-number"><span class="hljs-number">110</span></span>, <span class="hljs-number"><span class="hljs-number">110</span></span>); clumsy.fillText(<span class="hljs-string"><span class="hljs-string">"t"</span></span>, <span class="hljs-number"><span class="hljs-number">690</span></span>, <span class="hljs-number"><span class="hljs-number">330</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> != <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports){ <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = StandingGroup; }</code> </pre><br></div></div><br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c0f/5a6/80e/c0f5a680e7c94a79956856d2fed02bd0.gif"></div><br><br><div class="spoiler">  <b class="spoiler_title">Source code scituner-standing-phase.js</b> <div class="spoiler_text"><pre> <code class="hljs javascript"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StandingPhase</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">clumsy, shift</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> canvas = clumsy.canvas; clumsy.clean(<span class="hljs-string"><span class="hljs-string">'white'</span></span>); clumsy.ctx.font = <span class="hljs-string"><span class="hljs-string">'24px VoronovFont'</span></span>; clumsy.lineWidth(<span class="hljs-number"><span class="hljs-number">2</span></span>); clumsy.padding(<span class="hljs-number"><span class="hljs-number">100</span></span>); clumsy.range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1.1</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); clumsy.radius = <span class="hljs-number"><span class="hljs-number">3</span></span>; clumsy.step = <span class="hljs-number"><span class="hljs-number">10</span></span>; clumsy.color(<span class="hljs-string"><span class="hljs-string">'black'</span></span>); clumsy.axis(<span class="hljs-string"><span class="hljs-string">'x'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1.1</span></span>); clumsy.axis(<span class="hljs-string"><span class="hljs-string">'y'</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> f = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wave = clumsy.tabulate(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1.01</span></span>, <span class="hljs-number"><span class="hljs-number">0.01</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">t0</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = t0 + shift; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sin(<span class="hljs-number"><span class="hljs-number">2</span></span>*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI*f*t0) * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.exp(<span class="hljs-number"><span class="hljs-number">-15</span></span>*(t<span class="hljs-number"><span class="hljs-number">-0.5</span></span>)*(t<span class="hljs-number"><span class="hljs-number">-0.5</span></span>)); }); clumsy.color(<span class="hljs-string"><span class="hljs-string">'red'</span></span>); clumsy.draw(wave); clumsy.fillTextAtCenter(<span class="hljs-string"><span class="hljs-string">" , V = 0"</span></span>, canvas.width/<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>); clumsy.fillText(<span class="hljs-string"><span class="hljs-string">"x(t)"</span></span>, <span class="hljs-number"><span class="hljs-number">110</span></span>, <span class="hljs-number"><span class="hljs-number">110</span></span>); clumsy.fillText(<span class="hljs-string"><span class="hljs-string">"t"</span></span>, <span class="hljs-number"><span class="hljs-number">690</span></span>, <span class="hljs-number"><span class="hljs-number">330</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> != <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports){ <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = StandingPhase; }</code> </pre><br></div></div><br><br><h2>  Conclusion </h2><br>  So, using such a simple-minded wrapper over a Canvas, you can achieve a rather original drawing of graphs in the style of XKCD.  In general, this was the main goal of creating a library. <br><br>  It is not universal, but if you need to build a fairly simple graph in the style of XKCD, then it copes with this task more than well.  Additional features can be implemented independently using the features of HTML5 Canvas. <br><br>  Full documentation and examples can be found at these links: <br><br><img src="https://habrastorage.org/files/f62/214/bb9/f62214bb9e0c425aba041f6f32926bf4.png">  <a href="https://github.com/kreshikhin/clumsy">github.com/kreshikhin/clumsy</a> <br><br><img src="https://habrastorage.org/files/96d/20f/465/96d20f4656df4d0a89686d8b38722606.ico">  <a href="https://www.npmjs.com/package/clumsy">npmjs.com/package/clumsy</a> <br><br>  The source code is accompanied by a MIT license.  Therefore, you can safely use the code sections you are interested in or the entire project code for your own purposes. </div><p>Source: <a href="https://habr.com/ru/post/269931/">https://habr.com/ru/post/269931/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269917/index.html">A library that helps bridge the conceptual gap between OOP and DB during testing using ORM - LinqTestable</a></li>
<li><a href="../269919/index.html">The digest of interesting materials for the mobile developer # 127 (October 26 - November 1)</a></li>
<li><a href="../269923/index.html">Immersion cooling reaches new heights: 250 kW per bitFury rack</a></li>
<li><a href="../269925/index.html">Altera + OpenCL: we open the core</a></li>
<li><a href="../269927/index.html">What we have learned by developing the backend</a></li>
<li><a href="../269933/index.html">Pitfalls of backup in hybrid storage systems</a></li>
<li><a href="../269935/index.html">Operating System Migration History</a></li>
<li><a href="../269937/index.html">PHP Digest number 73 - interesting news, materials and tools (October 18 - November 5, 2015)</a></li>
<li><a href="../269943/index.html">How to write Go code that is easy to port</a></li>
<li><a href="../269947/index.html">Cloud explanations: we create a virtual PBX operator service in three days</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>