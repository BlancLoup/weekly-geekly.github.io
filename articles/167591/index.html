<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Optimize knockoutjs when dynamically adding and removing templates</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Immediately I warn you that the article is intended only for those who use or intend to use knockoutjs. It is assumed that the reader already knows wh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Optimize knockoutjs when dynamically adding and removing templates</h1><div class="post__text post__text-html js-mediator-article">  Immediately I warn you that the article is intended only for those who use or intend to use knockoutjs.  It is assumed that the reader already knows <a href="http://habrahabr.ru/post/164937/">what it is and why it is needed</a> . <br><br>  In one of my projects, I decided to use knockout.js.  Everything was good and even wonderful, as long as there was little data and the challenges of computed methods were not resource intensive.  But then the data became more and more calculations appeared, which took noticeable time for the eye.  Trying to solve this problem, I divided the page into tabs.  Turning to a separate tab, I changed the template and thus logically expected that the number of computed values ‚Äã‚Äãwould decrease when any observable value changes.  But it was not there.  It turned out that the feature of the framework is such that the recalculation of values ‚Äã‚Äãoccurs even when the template is completely removed from the model house. <br><br><a name="habracut"></a><br>  To make it clearer what you are talking about, I will give a simple example: <br>  There is an input field.  When this field is changed, the number of characters entered is calculated, for example, and displayed. <br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"value:symbols"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text:symbolsLength"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vm={ <span class="hljs-attr"><span class="hljs-attr">symbols</span></span>:ko.observable(<span class="hljs-string"><span class="hljs-string">''</span></span>), }; vm.symbolsLength=ko.computed(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vm.symbols().length; }) ko.applyBindings(vm);</code> </pre><br>  Everything is simple and it works: <a href="http://jsfiddle.net/z9enL/3/">jsfiddle</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now let's change the example a little.  Let's transfer the calculated value to the template and add another template, which will contain static HTML.  And make a button, by clicking on which the templates will switch.  I expect (more precisely, I would like it to be so) that the value of symbolsLength will not be calculated when this value is not displayed.  Therefore, to check this, I will put an alert in the calculation function. <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"template1"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text:symbolsLength"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"template2"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">static</span></span></span><span class="actionscript"> html </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"value:symbols, valueUpdate: 'afterkeydown'"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"click:click"</span></span></span><span class="hljs-tag">&gt;</span></span>Change Template<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"template:templateName"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vm={ <span class="hljs-attr"><span class="hljs-attr">symbols</span></span>:ko.observable(<span class="hljs-string"><span class="hljs-string">''</span></span>), <span class="hljs-attr"><span class="hljs-attr">templateName</span></span>:ko.observable(<span class="hljs-string"><span class="hljs-string">'template1'</span></span>), <span class="hljs-attr"><span class="hljs-attr">click</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ vm.templateName( (vm.templateName()==<span class="hljs-string"><span class="hljs-string">'template1'</span></span>)? <span class="hljs-string"><span class="hljs-string">'template2'</span></span>: <span class="hljs-string"><span class="hljs-string">'template1'</span></span> ); } }; vm.symbolsLength=ko.computed(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ alert(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vm.symbols().length; }) ko.applyBindings(vm);</code> </pre><br><br>  Now <a href="http://jsfiddle.net/z9enL/5/">let's look at an example</a> and realize what happened.  The framework performed the calculation when initializing the symbolsLength property.  Thus, he learned from which objects this value depended.  In this case, the symbols object was called in the calculation function symbolsLength.  The next time you change the symbols, the Knockout will re-calculate the symbolsLength.  That is, when we change the value in the input field, the calculation function is called symbolsLength, which is confirmed by an alert. <br>  Also, please note that the alert pops up, even if we switch to another template using the ‚ÄúChange Template‚Äù button. <br><br>  So, two problems arise: <br>  1. The calculation of the computed values ‚Äã‚Äãduring initialization is always called, even if this value is not used anywhere else <br>  2. Even after removing the template in which the computed value was used, from the DOM, the calculation will still occur when the dependent value changes. <br><br>  The first problem is solved very simply.  To do this, you need to pass the parameter deferEvaluation: true to the function ko.computed: <br><pre> <code class="javascript hljs">vm.symbolsLength=ko.computed({ <span class="hljs-attr"><span class="hljs-attr">read</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ alert(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vm.symbols().length; }, <span class="hljs-attr"><span class="hljs-attr">deferEvaluation</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span> })</code> </pre><br><br>  Now, the symbolsLength will be evaluated only after its first use, that is, after adding the template1 template to the DOM.  But the second problem remains.  The symbolsLength object has already subscribed to the change of the symbols object, and even if symbolsLength is not used anywhere, a calculation will still occur. <br>  The inner voice tells you that the symbolsLength object should somehow be unsubscribed from the symbols. <br>  But how to do that?  And the second question: at what point? <br>  I found my answers to these questions and will talk about them further.  Perhaps there is a simpler option, which I want to know in the comments. <br><br>  The answer to the first question: we will not unsubscribe, we will simply create anew the same object.  And he will again wait until you need to calculate the value. <br><br>  The answer to the second question: this can be done during the next calculation of the value, when there are no more subscribers to the result of the calculation.  In this case, the subscriber to the symbolsLength calculation is the function of outputting this value in the template1 template. <br><br>  To determine the number of subscribers and the number of dependencies, the objects in the Knockout have two functions: <br>  getSubscriptionsCount () <br>  getDependenciesCount () <br><br>  In the course of monitoring the values ‚Äã‚Äãreturned by these functions, the following pattern was revealed: <br>  1. At the first calculation, both functions return zero.  In this case, we do nothing <br>  2. In the following calculations, these two functions return real values.  At the same time, the number of dependencies by definition will be greater than zero, since symbolsLength depends on symbols.  But we are interested in the situation when the number of subscribers is zero. <br>  Given the two points described, it is possible to calculate the moment when you need to recreate the object. <br><br>  So, the theoretical part is solved.  We proceed to the practical implementation. <br>  To do this, create a function that will replace ko.computed.  Let's call it ko.recompute: <br><pre> <code class="javascript hljs"> ko.recompute=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rez=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rez.val(); }; rez.__ko_proto__=ko.observable; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o={ <span class="hljs-attr"><span class="hljs-attr">deferEvaluation</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">read</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s=rez.val.getSubscriptionsCount()==<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> d=rez.val.getDependenciesCount()==<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(s!=d) { setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ rez.val.dispose(); rez.val=ko.computed(o); },<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> callback(); } }; rez.val=ko.computed(o); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rez; };</code> </pre><br><br>  Now our example will look like this: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vm={ <span class="hljs-attr"><span class="hljs-attr">symbols</span></span>:ko.observable(<span class="hljs-string"><span class="hljs-string">''</span></span>), <span class="hljs-attr"><span class="hljs-attr">templateName</span></span>:ko.observable(<span class="hljs-string"><span class="hljs-string">'template1'</span></span>), <span class="hljs-attr"><span class="hljs-attr">click</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ vm.templateName( (vm.templateName()==<span class="hljs-string"><span class="hljs-string">'template1'</span></span>)? <span class="hljs-string"><span class="hljs-string">'template2'</span></span>: <span class="hljs-string"><span class="hljs-string">'template1'</span></span> ); } }; vm.symbolsLength=ko.recompute(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ alert(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vm.symbols().length; }) ko.applyBindings(vm);</code> </pre><br>  Thus, the calculation of symbolsLength will occur in two cases: <br>  1. When it is necessary to display the values ‚Äã‚Äãof symbolsLength <br>  2. When the value of symbolsLength is displayed, but there is a change in the value of symbols <br>  And of course the result: <a href="http://jsfiddle.net/z9enL/8/">jsfiddle</a> <br><br>  But a more correct version of the ko.recompute function suggested <a href="http://habrahabr.ru/users/xdenser/" class="user_link">xdenser</a> : <br><pre> <code class="javascript hljs">ko.recompute=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ c = ko.computed({ <span class="hljs-attr"><span class="hljs-attr">read</span></span>: callback, <span class="hljs-attr"><span class="hljs-attr">deferEvaluation</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">disposeWhen</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (c.getSubscriptionsCount()==<span class="hljs-number"><span class="hljs-number">0</span></span>)&amp;&amp; setTimeout(create,<span class="hljs-number"><span class="hljs-number">0</span></span>); } }); } create(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c(); } read.__ko_proto__=ko.observable; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read; };</code> </pre><br>  This uses the special parameter disposeWhen.  Thus, the test will take place not in the calculation function, but in front of it. </div><p>Source: <a href="https://habr.com/ru/post/167591/">https://habr.com/ru/post/167591/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../167577/index.html">We release the car on the Internet! Modernization radio Prology mdn-2740t and analogues</a></li>
<li><a href="../167581/index.html">3000 ships clashed in battle in EVE Online</a></li>
<li><a href="../167583/index.html">Is mathematics as accurate as it seems?</a></li>
<li><a href="../167585/index.html">Acumatica on Habr√©</a></li>
<li><a href="../167589/index.html">Simple user authorization to access the Internet using ipfw</a></li>
<li><a href="../167595/index.html">Gamification mobile games</a></li>
<li><a href="../167597/index.html">Moscow or London - where is the party better?</a></li>
<li><a href="../167601/index.html">Opera 12.13 Final</a></li>
<li><a href="../167603/index.html">Announcement of intensive training on software testing in the framework of DevCon 2013</a></li>
<li><a href="../167607/index.html">Export Virtual Machines from VirtualBox to AWS Amazon</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>