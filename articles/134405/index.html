<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Accelerate your website - automatic PASTING + GZIP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are a lot of tips on how to speed up the return of the site - this is both static through nginx and clustering, and a lot of all sorts of clever...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Accelerate your website - automatic PASTING + GZIP</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/cc2956f2/fb998532/98529245/be97fd0f.gif" alt="Accelerate"><br><br>  There are a lot of tips on how to speed up the return of the site - this is both static through nginx and clustering, and a lot of all sorts of clever technologies.  However, in all the books, advising how to increase the loading of sites, you can find two constantly repeating topics - ‚Äúgluing CSS / JS‚Äù and ‚Äúenabling compression‚Äù. <br><a name="habracut"></a><br>  <b>Glueing</b> <br>  It's simple - if, for example, you have 3 CSS files and 5 JS on your page, the browser will have to create 8 connections and download data for them, and as you know, several large files are better than many smaller ones.  This is due to the fact that the browser spends time on each connection setup, and often rather big - up to 40% of download time. <br><br>  Standard methods to write a certain batch file, which would run over the necessary files and glue them together into one I did not like in principle, for doing things with pens that can be done automatically is fundamentally wrong, in this case at least because it affects either in development or in production (additional actions). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As they say "never rewrite what you can just cut and paste";) <br><br>  <b>Compression</b> <br>  The smaller the volume of ‚Äúpumped‚Äù files, the less time is spent on downloading.  Even if these files are compressed and we spend some time on unpacking - with modern computing power on the client, this time cost is practically insignificant. <br>  Most modern browsers support the deflate compression method, sometimes called gzip by the name of the standard * nix utility that does this. <br><br>  What can and should be compressed on the web?  Any text queries like JS / CSS / JSON / HTML. <br><br>  There is a wonderful module for Apache mod-deflate, which you can directly use .htaccess to specify what to compress and what not to compress, it is very easy to use, but alas!  - usually prohibited on standard hostings due to the fact that they (hosters) fear for their CPU time. <br>  Of course, there is a reasonable portion of it - this module presses everything ‚Äúon the fly‚Äù and if you do not take some tricks, each time loading a page for a new user, it will be <br>  re-pinch all css / js etc <br><br>  If you have a VDS and you are your own master, use mod-deflate, because it is well debugged and there are a lot of examples of network applications. <br><br>  And we will return to the usual hosts - is there a way out?  Even if you have been eaten, you always have two ways out - there is a way out here too.  And this task is very good to go to the previous one - now I will explain why. <br><br>  Most JS / CSS and other texts are static, i.e.  they do not change in the process of the site functioning - it makes sense to merge them in order to satisfy the ‚Äúgluing‚Äù clause + immediately compress. <br><br>  We put the received files in a certain cache, from where our Apache will take them and give.  Moreover, we automate the process through mod-rewrite. <br><br>  <b><i>The algorithm will turn out like this</i></b> : <br><ol><li>  some file is requested from a special URL </li><li>  if the client supports compression and a compressed file of this type is in our cache, we give and terminate processing </li><li>  if compression is not supported and there is just a file of this type - give it up and finish processing </li><li>  otherwise, run our handler </li></ol><br>  <i>Let us agree that our model will trigger when accessing the URL of the form "/ glue / ...."</i> <i><br></i>  <i>And the files will be in ‚Äú/ static / glue / ...‚Äù.</i> <br><br>  In this case, we kill another rabbit - the files will be given through PHP only once - during the formation, and then everything will be like the big ones :) the statics should and will be given by the web server. <br><br>  In principle, you can make the folder coincide with the URL, then the mod-rewrite config will be slightly easier but it will not be so interesting, in general, you can always simplify :) <br><br>  I hope that in the root of your site already lives a .htaccess file with content like this: <br><blockquote><code><font color="black"><br> <font color="#00007f">RewriteEngine</font> <font color="#0000ff">On</font> <br> <font color="#00007f">RewriteBase</font> / <br> <font color="#00007f">RewriteRule</font> ^.*$ index.php [QSA,L] <br></font></code> </blockquote><br><br>  Well, either like.  The main condition is that if mod-rewrite did not find what to do with the URL that came in, it will eventually cause some kind of script file. <br>  In this case, index.php <br><br>  To add our algorithm, let's write the following in .htaccess: <br><br>  <b><i>Add support for compressed .gz files, as well as .jz.gz and .css.gz</i></b> <br><blockquote> <code><font color="black"><br> <font color="#00007f">AddEncoding</font> gzip .gz <br> <br> &lt; <font color="#000000"><b>FilesMatch</b></font> <font color="#7f007f">" <font>\.</font> js.gz$"</font> &gt; <br> <font color="#adadad"><i># </i></font> <br> <font color="#00007f">Header</font> set Cache-control: private <br> <font color="#00007f">Header</font> append Vary User-Agent <br> <br> <font color="#00007f">ForceType</font> <font color="#7f007f">"text/javascript"</font> <br> <font color="#00007f">Header</font> set Content-Encoding: gzip <br> <font color="#00007f">AddCharset</font> windows- <font color="#ff0000">1251</font> .js.gz <br> &lt;/ <font color="#000000"><b>FilesMatch</b></font> &gt; <br> &lt; <font color="#000000"><b>FilesMatch</b></font> <font color="#7f007f">" <font>\.</font> css.gz$"</font> &gt; <br> <font color="#adadad"><i># </i></font> <br> <font color="#00007f">Header</font> set Cache-control: private <br> <font color="#00007f">Header</font> append Vary User-Agent <br> <br> <font color="#00007f">ForceType</font> <font color="#7f007f">"text/css"</font> <br> <font color="#00007f">Header</font> set Content-Encoding: gzip <br> &lt;/ <font color="#000000"><b>FilesMatch</b></font> &gt; <br></font></code> </blockquote><br><br>  <b><i>Add the rule of returning our files</i></b> (dereference of the URL to the physical folder) <br><blockquote> <code><font color="black"><br> <font color="#00007f">RewriteCond</font> %{ENV:REDIRECT_GZ} = <font color="#ff0000">1</font> <br> <font color="#00007f">RewriteCond</font> %{REQUEST_URI} ^/glue/(.+)$ <br> <font color="#00007f">RewriteCond</font> %{DOCUMENT_ROOT}/static/glue/%1 -f <br> <font color="#00007f">RewriteRule</font> . - [L] <br></font></code> </blockquote><br><br>  <b><i>We add check on support by client of compression</i></b> <br><blockquote> <code><font color="black"><br> <font color="#00007f">RewriteCond</font> %{REQUEST_URI} ^/glue/(.+)$ <br> <font color="#00007f">RewriteCond</font> %{DOCUMENT_ROOT}/static/glue/%1.gz -f <br> <font color="#00007f">RewriteCond</font> %{HTTP:Accept-Encoding} ^.*?gzip.*$ [NC] <br> <font color="#00007f">RewriteCond</font> %{HTTP_USER_AGENT} !^konqueror [NC] <br> <font color="#00007f">RewriteRule</font> ^siteglue/(.*)$ /static/glue/$1.gz [L,E=GZ: <font color="#ff0000">1</font> ] <br></font></code> </blockquote><br><br>  <b><i>If compression is not supported</i></b> <br><blockquote> <code><font color="black"><br> <font color="#00007f">RewriteCond</font> %{REQUEST_URI} ^/glue/(.+)$ <br> <font color="#00007f">RewriteCond</font> %{DOCUMENT_ROOT}/static/glue/%1 -f <br> <font color="#00007f">RewriteRule</font> . static/glue/%1 [L,E=GZ: <font color="#ff0000">1</font> ] <br></font></code> </blockquote><br><br>  Now let's take on our most important magic - the automatic generation of these same files. <br><br>  Here one more thing is a trick, in this case rather - one more convention - <i>in the html files we will write requests to css or js in the following form:</i> <i><br></i>  <i><i>‚Äú/Glue/1.css‚Äî2.css‚Äî 3-4-5.css‚Äù</i> , where ‚Äú-‚Äù is a replacement for ‚Äú/‚Äù, and ‚Äú-‚Äù is a file separator.</i> <br>  In addition, the names can only be English letters, numbers and the symbol "_", for me - this is more than enough. <br><br>  Of course, these are conventions and you can choose other rules and other separators.  For example, you can use "," or something else. <br>  However, I chose the "-" because it is a completely normal and frequently occurring URL symbol and there can hardly be any stupid problems with it, such as cutting out curved scripts on the path from you to the client. <br><br>  In the file in index.php (or what do you run there according to .htaccess?) We add a handler that checks the URL for compliance with our ‚Äú/glue/.*‚Äù and, in case of coincidence, makes <i>echo (Glue :: generate ($ str))</i> where <i>$ str</i> is what we have in the URL after the last slash, i.e.  for "/glue/a.js" it will be "a.js" <br><br>  <b><i>Glue class itself</i></b> <br><br><blockquote> <code><font color="black"><br> <font color="#3A00FF"><b>class</b></font> Glue <font color="#009900">{</font> <br> <font color="#990000">static</font> <font color="#000088">$allowedExt</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <br> <font color="#0000ff">"js"</font> <font color="#339933">=&gt;</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">"check"</font> <font color="#339933">=&gt;</font> <font color="#0000ff">"/^js/.*?.js$/"</font> <font color="#339933">,</font> <font color="#0000ff">"delimeter"</font> <font color="#339933">=&gt;</font> <font color="#0000ff">";n"</font> <font color="#339933">,</font> <font color="#0000ff">"mime"</font> <font color="#339933">=&gt;</font> ‚Äútext <font color="#339933">/</font> javascript‚Äù <font color="#009900">)</font> <font color="#339933">,</font> <br> <font color="#0000ff">"css"</font> <font color="#339933">=&gt;</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">"check"</font> <font color="#339933">=&gt;</font> <font color="#0000ff">"/^css/.*.css$/"</font> <font color="#339933">,</font> <font color="#0000ff">"delimeter"</font> <font color="#339933">=&gt;</font> <font color="#0000ff">"n"</font> <font color="#339933">,</font> <font color="#0000ff">"mime"</font> <font color="#339933">=&gt;</font> ‚Äútext <font color="#339933">/</font> css‚Äù <font color="#009900">)</font> <font color="#339933">,</font> <br> <font color="#009900">)</font> <font color="#339933">;</font> <br> <br> <font color="#990000">static</font> <font color="#3A00FF"><b>function</b></font> generate <font color="#009900">(</font> <font color="#000088">$str</font> <font color="#009900">)</font> <font color="#009900">{</font> <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$str</font> <font color="#009900">)</font> <font color="#b1b100">return</font> <font color="#3A00FF"><b>null</b></font> <font color="#339933">;</font> <font color="#666666"><i>//  URL</i></font> <br> <br> <font color="#000088">$files</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#990000">preg_replace</font> <font color="#009900">(</font> <font color="#0000ff">"/((?:[a-z0-9_.]+-)+[a-z0-9_.]+.([a-z0-9]+))(?:--|$)/ie"</font> <font color="#339933">,</font> <font color="#0000ff">" <font color="#006699"><b>$files</b></font> []=str_replace( '-', '/', "</font> <font color="#cc66cc">1</font> <font color="#0000ff">")"</font> <font color="#339933">,</font> <font color="#000088">$str</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">count</font> <font color="#009900">(</font> <font color="#000088">$files</font> <font color="#009900">)</font> <font color="#339933">==</font> <font color="#cc66cc">0</font> <font color="#009900">)</font> <font color="#b1b100">return</font> <font color="#3A00FF"><b>null</b></font> <font color="#339933">;</font> <font color="#666666"><i>//      URL</i></font> <br> <br> <font color="#000088">$srcF</font> <font color="#339933">=</font> ‚Äú <font color="#339933">/</font> <font color="#990000">static</font> ‚Äù <font color="#339933">;</font> <font color="#666666"><i>// ,   </i></font> <br> <font color="#000088">$dstF</font> <font color="#339933">=</font> ‚Äú <font color="#339933">/</font> glue‚Äù <font color="#339933">;</font> <font color="#666666"><i>//,  </i></font> <br> <br> <font color="#000088">$content</font> <font color="#339933">=</font> <font color="#0000ff">""</font> <font color="#339933">;</font> <br> <br> <font color="#000088">$cext</font> <font color="#339933">=</font> <font color="#990000">substr</font> <font color="#009900">(</font> <font color="#990000">strrchr</font> <font color="#009900">(</font> <font color="#000088">$files</font> <font color="#009900">[</font> <font color="#cc66cc">0</font> <font color="#009900">]</font> <font color="#339933">,</font> <font color="#0000ff">'.'</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">1</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$cext</font> <font color="#339933">===</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#b1b100">return</font> <font color="#3A00FF"><b>null</b></font> <font color="#339933">;</font> <font color="#666666"><i>//   </i></font> <br> <br> <font color="#000088">$fd</font> <font color="#339933">=</font> <font color="#3A00FF"><b>null</b></font> <font color="#339933">;</font> <br> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#3A00FF"><b>self</b></font> <font color="#339933">::</font> <font color="#000088">$allowedExt</font> <font color="#b1b100">as</font> <font color="#000088">$k</font> <font color="#339933">=&gt;</font> <font color="#000088">$v</font> <font color="#009900">)</font> <font color="#009900">{</font> <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$k</font> <font color="#339933">==</font> <font color="#000088">$cext</font> <font color="#009900">)</font> <font color="#009900">{</font> <br> <font color="#000088">$fd</font> <font color="#339933">=</font> <font color="#000088">$v</font> <font color="#339933">;</font> <br> <font color="#b1b100">break</font> <font color="#339933">;</font> <br> <font color="#009900">}</font> <br> <font color="#009900">}</font> <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$fd</font> <font color="#009900">)</font> <font color="#b1b100">return</font> <font color="#3A00FF"><b>null</b></font> <font color="#339933">;</font> <font color="#666666"><i>//    </i></font> <br> <br> <font color="#000088">$usedNames</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#000088">$fdC</font> <font color="#339933">=</font> <font color="#339933">&amp;</font> <font color="#000088">$fd</font> <font color="#009900">[</font> <font color="#0000ff">"check"</font> <font color="#009900">]</font> <font color="#339933">;</font> <br> <font color="#000088">$fdD</font> <font color="#339933">=</font> <font color="#339933">&amp;</font> <font color="#000088">$fd</font> <font color="#009900">[</font> <font color="#0000ff">"delimeter"</font> <font color="#009900">]</font> <font color="#339933">;</font> <br> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$files</font> <font color="#b1b100">as</font> <font color="#000088">$name</font> <font color="#009900">)</font> <font color="#009900">{</font> <br> <font color="#000088">$ext</font> <font color="#339933">=</font> <font color="#990000">substr</font> <font color="#009900">(</font> <font color="#990000">strrchr</font> <font color="#009900">(</font> <font color="#000088">$name</font> <font color="#339933">,</font> <font color="#0000ff">'.'</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#cc66cc">1</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <br> <font color="#000088">$ext</font> <font color="#339933">===</font> <font color="#3A00FF"><b>false</b></font> <font color="#339933">||</font> <br> <font color="#990000">in_array</font> <font color="#009900">(</font> <font color="#000088">$name</font> <font color="#339933">,</font> <font color="#000088">$usedNames</font> <font color="#009900">)</font> <font color="#339933">||</font> <br> <font color="#000088">$ext</font> <font color="#339933">!=</font> <font color="#000088">$cext</font> <font color="#339933">||</font> <br> <font color="#339933">!</font> <font color="#990000">preg_match</font> <font color="#009900">(</font> <font color="#000088">$fdC</font> <font color="#339933">,</font> <font color="#000088">$name</font> <font color="#009900">)</font> <br> <font color="#009900">)</font> <font color="#b1b100">return</font> <font color="#3A00FF"><b>null</b></font> <font color="#339933">;</font> <font color="#666666"><i>//   ,                </i></font> <br> <br> <font color="#000088">$usedNames</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$name</font> <font color="#339933">;</font> <br> <font color="#000088">$filec</font> <font color="#339933">=</font> <font color="#990000">file_get_contents</font> <font color="#009900">(</font> <font color="#0000ff">" <font color="#006699"><b>{$srcF}</b></font> / <font color="#006699"><b>{$name}</b></font> "</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$filec</font> <font color="#009900">)</font> <font color="#b1b100">return</font> <font color="#3A00FF"><b>null</b></font> <font color="#339933">;</font> <font color="#666666"><i>//     </i></font> <br> <font color="#000088">$content</font> <font color="#339933">.=</font> <font color="#000088">$content</font> <font color="#339933">!=</font> <font color="#0000ff">""</font> ? <font color="#000088">$fdD</font> <font color="#339933">.</font> <font color="#000088">$filec</font> <font color="#339933">:</font> <font color="#000088">$filec</font> <font color="#339933">;</font> <br> <font color="#009900">}</font> <br> <br> <br> <font color="#666666"><i>// </i></font> <br> file_put_contents <font color="#009900">(</font> <font color="#0000ff">" <font color="#006699"><b>{$dstF}</b></font> / <font color="#006699"><b>{$str}</b></font> "</font> <font color="#339933">,</font> <font color="#000088">$content</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <br> <font color="#666666"><i>//  </i></font> <br> <font color="#000088">$gzip</font> <font color="#339933">=</font> <font color="#990000">gzencode</font> <font color="#009900">(</font> <font color="#000088">$content</font> <font color="#339933">,</font> <font color="#cc66cc">9</font> <font color="#009900">)</font> <font color="#339933">;;</font> <font color="#666666"><i>//gzdeflate( $content, 9 );</i></font> <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$gzip</font> <font color="#009900">)</font> file_put_contents <font color="#009900">(</font> <font color="#0000ff">"/ <font color="#006699"><b>{$dstF}</b></font> / <font color="#006699"><b>{$str}</b></font> .gz"</font> <font color="#339933">,</font> <font color="#000088">$gzip</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <br> <font color="#666666"><i>//        mime-</i></font> <br> <font color="#990000">header</font> <font color="#009900">(</font> <font color="#0000ff">"Content-type: "</font> <font color="#339933">.</font> <font color="#000088">$fd</font> <font color="#009900">[</font> <font color="#0000ff">"mime"</font> <font color="#009900">]</font> <font color="#339933">,</font> <font color="#3A00FF"><b>true</b></font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#b1b100">return</font> <font color="#000088">$content</font> <font color="#339933">;</font> <br> <font color="#009900">}</font> <br> <font color="#009900">}</font> <br></font></code> </blockquote><br><br>  Again, this is only illustrated one way to HOW to do it - do not like the static class - you can choose any other way - with blackjack and ladies are not heavy behavior;) <br><br>  That's basically everything, it remains to run through the files of the project - all the same, there is a piece of ‚Äúmanual‚Äù work: (- and prescribe instead of a heap of scripts one, but according to the rules described a bit Above. <br><br>  All - at the first request, everything will automatically gather and begin to be given. <br><br>  <b><i>Another small addition - what to do with the content provided by PHP?</i></b> <br>  It must also be squeezed! <br><br>  To do this, in the place where you give the text files, where the generated content is given - for example, <b>echo ($ content);</b> <br><br>  Do the following: <br><blockquote> <code><font color="black"><br> <font color="#b1b100">if</font> <font color="#009900">(</font> isClientSupportGzip <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <br> <font color="#990000">ob_start</font> <font color="#009900">(</font> <font color="#0000ff">"ob_gzhandler"</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#990000">echo</font> <font color="#009900">(</font> <font color="#000088">$content</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#990000">ob_end_flush</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#990000">echo</font> <font color="#009900">(</font> <font color="#000088">$content</font> <font color="#009900">)</font> <font color="#339933">;</font> <br></font></code> </blockquote><br><br>  This will compress the output dynamic content if the client supports compression.  The function that tests it is taken from the Internet and looks like this: <br><blockquote> <code><font color="black"><br> <font color="#3A00FF"><b>function</b></font> isClientSupportGzip <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">headers_sent</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">||</font> <font color="#990000">connection_aborted</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#b1b100">return</font> <font color="#3A00FF"><b>false</b></font> <font color="#339933">;</font> <br> <font color="#b1b100">if</font> <font color="#009900">(</font> stripos <font color="#009900">(</font> <font color="#990000">getenv</font> <font color="#009900">(</font> <font color="#0000ff">"HTTP_ACCEPT_ENCODING"</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#0000ff">"gzip"</font> <font color="#009900">)</font> <font color="#339933">===</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#b1b100">return</font> <font color="#3A00FF"><b>false</b></font> <font color="#339933">;</font> <br> <font color="#b1b100">if</font> <font color="#009900">(</font> stripos <font color="#009900">(</font> <font color="#990000">getenv</font> <font color="#009900">(</font> <font color="#0000ff">"HTTP_USER_AGENT"</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#0000ff">"konqueror"</font> <font color="#009900">)</font> <font color="#339933">!==</font> <font color="#3A00FF"><b>false</b></font> <font color="#009900">)</font> <font color="#b1b100">return</font> <font color="#3A00FF"><b>false</b></font> <font color="#339933">;</font> <br> <font color="#b1b100">return</font> <font color="#3A00FF"><b>true</b></font> <font color="#339933">;</font> <br> <font color="#009900">}</font> <br></font></code> </blockquote><br><br>  For development, I recommend starting some kind of development mode constant, and in case it is set to 1, simply do not write files to the cache and do not compress the dynamics - you don‚Äôt have to climb and clear our cache directory every time you change it in any js file. <br><br>  <b>That's all - we slightly dispersed your site) According to my observations, the increase in the rate of return can be 30-40%.</b> <b><br></b> <br><br>  <i>If there are any corrections, suggestions or criticism - please, welcome in the comments - I will be very grateful, because as they say - learn a century)</i> <br><br>  <b>Fast sites, maximum compression and joyful customers;)</b> <b><img src="https://habrastorage.org/storage1/709aa92e/54a7b027/ffb066ec/cbc4935d.gif" alt="I'm"></b> <br><br>  <b>PS</b> <br><br>  If you use any library, for example jquery, on all pages of your project with the same location, I recommend to take it all the same to a hotel file, the same applies to a single css - so  it is faster cached by the browser. <br><br>  When gluing JS, remember the peculiarity - you need to glue it through ‚Äú;‚Äù, since  in the previous file after the last line may not be ";" <br><br>  When writing a cache formation handler, remember about hackers - check everything and everything, with illiterate screening you can stick together and get a lot of interesting things as statics, at worst you can drive away your disk space to death, so even Mr. Proper will not help - more accurate in general . <br><br>  If you have a site in the most unpopular coding, so that everything is chocolate, replace <br>  ForceType "text / javascript" on ForceType "text / javascript;  content = windows-1251 " <br>  and add: AddCharset windows-1251 .js and AddCharset windows-1251 .css <br><br>  And a little advice, keep the same order in specifying the files to be glued, because technically ‚Äú/glue/a.js‚Äî b.js‚Äù and ‚Äú/glue/b.js ‚Äîa.js‚Äù are one and the same, but in practice you will get two files in the cache ... <br><br>  <b>From comments</b> <br><br>  <b>Imenem</b> and <b>TrueDrago</b> suggested that the optimal level for deflate compression is not 9, but 6 </div><p>Source: <a href="https://habr.com/ru/post/134405/">https://habr.com/ru/post/134405/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134395/index.html">Political poster from programmers</a></li>
<li><a href="../134397/index.html">Create a TimePicker similar to the standard in Harmattan</a></li>
<li><a href="../134398/index.html">Testing programs in difficult "weather conditions"</a></li>
<li><a href="../134400/index.html">Higher education as an important stage of personality formation, or testing under load</a></li>
<li><a href="../134403/index.html">Circles are now in GMail - small GMail update</a></li>
<li><a href="../134406/index.html">Fast PHP routing</a></li>
<li><a href="../134407/index.html">Gray Hat Python - Immunity Debugger</a></li>
<li><a href="../134408/index.html">Quantum entanglement on the scale of our world or the providence of Vladislav Krapivin</a></li>
<li><a href="../134409/index.html">Setting up WiMax Internet and distributing it to others via Wi-Fi in openSUSE 12.1</a></li>
<li><a href="../134410/index.html">About marketing, netbooks and CMS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>