<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Exploring JavaScript Symbols. Use of symbols</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the second article in a series on characters and their use in JavaScript. The previous part: ‚ÄúSymbol is a new data type in JavaScript‚Äù . 

 Wi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Exploring JavaScript Symbols. Use of symbols</h1><div class="post__text post__text-html js-mediator-article"> This is the second article in a series on characters and their use in JavaScript.  The previous part: <a href="http://habrahabr.ru/post/255137/">‚ÄúSymbol is a new data type in JavaScript‚Äù</a> . <br><br>  With the advent of symbols, the <code>Object</code> been extended with one method that allows you to get all the symbols of an object: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> role = <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>(<span class="hljs-string"><span class="hljs-string">'role'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> score = <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>(<span class="hljs-string"><span class="hljs-string">'score'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = <span class="hljs-string"><span class="hljs-string">'Moderator'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> user = { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: id, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: name }; user[role] = <span class="hljs-string"><span class="hljs-string">'admin'</span></span>; user[score] = <span class="hljs-number"><span class="hljs-number">50000</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getOwnPropertySymbols( user ); <span class="hljs-comment"><span class="hljs-comment">// [Symbol(role), Symbol(score)]</span></span></code> </pre><br>  The presence of this method makes it impossible for us to create truly private properties. <br><a name="habracut"></a><br>  Here, for example, how to get a user role: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userSymbols = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getOwnPropertySymbols( user ); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> roleSymbol = userSymbols[<span class="hljs-number"><span class="hljs-number">0</span></span>]; user[ roleSymbol ]; <span class="hljs-comment"><span class="hljs-comment">// 'admin'</span></span></code> </pre><br>  If we take into account the fact that it is not possible to hide data on the client side, then this function should be considered as an auxiliary, which will be needed to get a list of characters, similarly to the situation when we get a list of all object property names using <code>Object.getOwnPropertyNames</code> . <br><br>  I also want to note that the ECMAScript 6 specification has added a new <code>Reflect</code> object which allows reflection (or reflection) in JavaScript.  And one of the methods of the <code>Reflect</code> object allows you to get all the properties that are declared through both strings and characters. <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> properties = <span class="hljs-built_in"><span class="hljs-built_in">Reflect</span></span>.ownKeys( user ); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log( user ); <span class="hljs-comment"><span class="hljs-comment">// ['id', 'name', Symbol(role), Symbol(score)]</span></span></code> </pre><br>  Symbols make it possible to divide properties into public and internal, which store internal information and are used only in the process of accessing public information. <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Project = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> projectData = <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>(<span class="hljs-string"><span class="hljs-string">'project'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> projectStatus = <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>(<span class="hljs-string"><span class="hljs-string">'status'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _getTitle = <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Project</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> data, status </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[ projectData ] = data; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[ projectStatus ] = status; } Project.prototype.getProjectTitle = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[ _getTitle ](); }; Project.prototype[ _getTitle ] = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[ projectData ].name + <span class="hljs-string"><span class="hljs-string">' ('</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[ projectData ].description + <span class="hljs-string"><span class="hljs-string">')'</span></span>; }; Project.prototype.getStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[ projectStatus ]; }; Project.prototype.changeStatus = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> status </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[ projectStatus ] = status; }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Project; }()); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> project = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Project({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Application'</span></span>, <span class="hljs-attr"><span class="hljs-attr">description</span></span>: <span class="hljs-string"><span class="hljs-string">'favorite project'</span></span> }, <span class="hljs-string"><span class="hljs-string">'open'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log( project.getStatus() ); <span class="hljs-comment"><span class="hljs-comment">// 'open' project.changeStatus('finished'); console.log( project.getStatus() ); // 'finished' console.log( project.getProjectTitle() ); // 'Application (favorite project)'</span></span></code> </pre><br>  In this example, the project information and its status are added through symbols, which makes it impossible to directly read / change them.  There is also an internal <code>_getTitle</code> method to which you can only refer to a symbol, which hides it from the public API and is used only when calling <code>getProjectTitle</code> .  Symbols also allowed us to bring all the methods to the prototype object. <br><br>  But still, the main reason for adding characters is not the need to create private properties (this possibility, by the way, was also proposed ‚Äî <a href="http://wiki.ecmascript.org/doku.php%3Fid%3Dharmony:private_name_objects">private name objects</a> , but for some reason it was not included in the current version of the specification).  The main problem that the symbols will solve is the creation of unique properties.  Library developers using symbols can add properties that are guaranteed to be unique, which means that they will not conflict with other properties (they will not override properties that are added by other modules, nor can custom code override these properties). <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Request = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> requestState = <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>(<span class="hljs-string"><span class="hljs-string">'state'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> states = { <span class="hljs-attr"><span class="hljs-attr">NOT_INITIALIZED</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>(), <span class="hljs-attr"><span class="hljs-attr">RECEIVED</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>(), <span class="hljs-attr"><span class="hljs-attr">PROCESSING</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>(), <span class="hljs-attr"><span class="hljs-attr">FINISHED</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>() }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Request</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[ requestState ] = states.NOT_INITIALIZED; } Request.prototype.getStates = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> states; }; Request.prototype.close = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[ requestState ] = states.FINISHED; }; Request.prototype.changeState = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> state </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[ requestState ] = state; }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Request; }()) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Request(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handledState = <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>(<span class="hljs-string"><span class="hljs-string">'state'</span></span>); request[ handledState ] = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">// code request[ handledState ] = true; request.close();</span></span></code> </pre><br>  The code above demonstrates a situation where we have a third-party module that the <code>Request</code> entity provides.  This module defines the <code>requestState</code> state required for the module to work using the symbol.  The developer also enters his state (for example, the state that displays or the request is processed), also using the symbol.  This way of declaring properties through symbols gives us a guarantee that the behavior of the module will not be redefined. <br><br>  In this example, another way of using symbols is also provided.  The <code>states</code> object can be treated as an enumerated type with unique values ‚Äã‚Äã(which allows you to check or pass the correct value). <br><br>  Now let's look at the methods that allow you to create characters in the global registry of characters. <br><br>  The code runs in the global context in which this code is declared, but we have the ability to execute code in a different context and this may already cause some problems.  For example, in a browser, code that is declared in an iframe will have a different global context and each iframe will have its own copy for <code>RegExp</code> , <code>Array</code> , <code>Date</code> , etc.  And the problem is that the characters also exist and are unique only within the context in which they are declared.  If your code interacts with the code in the iframe, then in this iframe you will not have references to symbols and you will not be able to access the properties that will be declared through these symbols. <br><br>  To solve this problem, a global registry has been introduced for characters.  To create a symbol that will be available in all contexts, use the <code>Symbol.for</code> method: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> UUIDSymbol = <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.for(<span class="hljs-string"><span class="hljs-string">'uuid'</span></span>);</code> </pre><br>  This method is also used to retrieve a character from the global registry.  The logic of the method is as follows: if the symbol is found, then it will be returned as the result of the method;  if the character is not found in the registry, it will be created, added to the global registry and returned as a result. <br><br>  A similar situation with the need to use the global registry is on the server side.  For example, in Node.js, there is a <code>vm</code> module that allows you to execute code in a different context. <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vm = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'vm'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ourArray = <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ourSymbol = <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>(<span class="hljs-string"><span class="hljs-string">'uuid'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> theirArray = vm.runInNewContext(<span class="hljs-string"><span class="hljs-string">'Array'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> theirSymbol = vm.runInNewContext(<span class="hljs-string"><span class="hljs-string">'Symbol("uuid")'</span></span>); ourArray === theirArray; <span class="hljs-comment"><span class="hljs-comment">// false ourSymbol === theirSymbol; // false</span></span></code> </pre><br>  You can see that <code>Array</code> in the current context is not equal to <code>Array</code> in a different context (each has its own copy).  Similar behavior as in the situation with iframe and with symbols, they are not equal to each other in different contexts. <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vm = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'vm'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ourSymbol = <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.for(<span class="hljs-string"><span class="hljs-string">'uuid'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> theirSymbol = vm.runInNewContext(<span class="hljs-string"><span class="hljs-string">'Symbol.for("uuid")'</span></span>); ourSymbol === theirSymbol; <span class="hljs-comment"><span class="hljs-comment">// true</span></span></code> </pre><br>  <code>Symbol.for</code> declaring symbols through <code>Symbol.for</code> we are able to use them in all contexts.  If your project uses a <code>vm</code> module with code execution with specific contexts, using <code>Symbol.for</code> would be an excellent solution in this situation. <br><br>  There is also a method that allows you to get the key by which the symbol is added to the registry - <code>Symbol.keyFor</code> : <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> UUIDSymbolKey = <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.keyFor( UUIDSymbol );</code> </pre><br>  If the specified character is not found in the registry, it will return <code>undefined</code> . <br><br>  I want to note once again that the simple creation of a symbol through the <code>Symbol('score')</code> - will not create a symbol in the global registry. <br><br>  In the next part, we will continue to consider the <code>Symbol</code> object, as well as touch on such a thing as Well-known symbols and see what opportunities they open up for us. </div><p>Source: <a href="https://habr.com/ru/post/255389/">https://habr.com/ru/post/255389/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255373/index.html">Making screenshots correctly: practical tips</a></li>
<li><a href="../255379/index.html">PVS-Studio: new trial mode</a></li>
<li><a href="../255381/index.html">Styling iOS Applications: How We Stretch Fonts, Colors, and Images</a></li>
<li><a href="../255383/index.html">ThinkPHP Conference Announcement</a></li>
<li><a href="../255387/index.html">Application of parallel algorithms in the 1C Enterprise environment</a></li>
<li><a href="../255391/index.html">Ubiquiti EdgeRouter X</a></li>
<li><a href="../255393/index.html">We invite students to Imagine Day: April 18 in Moscow</a></li>
<li><a href="../255397/index.html">We built RecyclerView in CardView</a></li>
<li><a href="../255399/index.html">Binary serialization in Unity3d</a></li>
<li><a href="../255403/index.html">Version Control for Designers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>