<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How Android works, part 4</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! We took the time to continue the series of articles about the internal device Android. In this article, I will discuss the Android boot process...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How Android works, part 4</h1><div class="post__text post__text-html js-mediator-article"><p> <a href=""><img src="https://habrastorage.org/webt/jv/bc/cd/jvbccdismv6aavwbri8o5q9uu5o.png"></a> </p><br><p>  Hello!  We took the time to continue the series of articles about the internal device Android.  In this article, I will discuss the Android boot process, the file system contents, how user and application data is stored, root access, the portability of Android assemblies, and the problem of fragmentation. </p><a name="habracut"></a><br><p>  Articles series: </p><br><ul><li>  <a href="https://habr.com/company/solarsecurity/blog/334796/">How Android works, part 1</a> </li><li>  <a href="https://habr.com/company/solarsecurity/blog/338292/">How Android works, part 2</a> </li><li>  <a href="https://habr.com/company/solarsecurity/blog/338494/">How Android works, part 3</a> </li><li>  How Android works, part 4 </li><li>  ... </li></ul><br><h2 id="pakety">  Packages </h2><br><p> As I said before, the Android architecture is built around applications.  It is applications that play a key role in the device of many parts of the system, the model of activity and intent is built for the harmonious interaction of applications, and the Android security model is based on the isolation of applications.  And if the activity manager is in charge of orchestrating the interaction of application components, then the <strong>package manager</strong> is responsible for installing, updating, and managing application rights (package manager ‚Äî in the shell, you can call it with the <code>pm</code> command). </p><br><p>  As the name ‚Äúpackage manager‚Äù suggests, at this level applications are often called <strong>packages</strong> .  Packages are distributed in the format of <strong>APK</strong> (Android package) - special zip-archives.  Each package has a <em>name</em> (also known as an <a href="https://developer.android.com/studio/build/application-id">application ID</a> ) that uniquely identifies this application (but not its specific version ‚Äî on the contrary, the names of different versions of the package must match, otherwise they will be considered separate packages).  Packet names are usually written in <a href="https://www.wikiwand.com/en/Reverse_domain_name_notation"><em>reverse DNS name notation</em></a> - for example, the YouTube application uses the package name <code>com.google.android.youtube</code> .  Often, the package name is the same as the namespace used in its Java code, but Android does not require it (besides, the application APK files usually include third-party libraries, whose namespace naturally has nothing to do with the package names, who use them). </p><br><p>  Each APK must be <a href="https://developer.android.com/studio/publish/app-signing"><strong>signed by the</strong></a> developer using a digital signature when building.  Android checks for the presence of this signature when installing the application, and when updating an already installed application, it additionally compares the public keys with which the old and new versions are signed;  they must match, which ensures that the new version was created by the same developer as the old one.  (If this check were not available, the attacker could create a package with the same name as the existing application, convince the user to install it by ‚Äúupdating‚Äù the application, and access the data of this application.) </p><br><p>  The package <strong>update</strong> itself is the installation of its new version instead of the old one, preserving the data and permissions received from the user.  It is also possible to ‚Äúroll back‚Äù (downgrade) applications to older versions, but by default Android deletes the data saved by the new version, since the old version may not be able to work with the data formats used by the new version. </p><br><p>  As I said, usually the code of each application is executed under its own Unix-user (UID), which ensures their mutual isolation.  Multiple applications can <a href="https://developer.android.com/guide/topics/manifest/manifest-element">explicitly ask</a> Android to use a common UID for them, which will allow them to directly access each other‚Äôs files and even, if they wish, run in the same process. </p><br><p>  Although usually one package corresponds to one APK file, Android supports packages consisting of several APKs (this is called split APK, or <strong>split APK</strong> ).  This is the basis of such ‚Äúmagic‚Äù features of Android, such as dynamic loading of additional modules of the application ( <a href="https://developer.android.com/guide/app-bundle/configure">dynamic feature modules</a> ) and <a href="https://medium.com/google-developers/instant-run-how-does-it-work-294a1633367f">Instant Run</a> in Android Studio (automatically updating the code of the running application without reinstalling it completely and, in many cases, even without restarting). </p><br><p><img src="https://habrastorage.org/webt/jm/_x/0q/jm_x0qtvqsmt4-tj6-hxbcwzizi.png"></p><br><h2 id="faylovaya-sistema">  File system </h2><br><p>  The device of the file system is one of the most important and interesting questions in the architecture of the operating system, and the device of the file system in Android is no exception. </p><br><p>  Of interest is, firstly, which file systems are used, that is, in what format the contents of the files are stored on the conditional disk (in the case of Android, this is usually flash-memory and SD-cards) and how this format is supported by .  The Linux kernel used in Android to a varying degree supports a large number of very different file systems - from the FAT and NTFS used in Windows and the infamous HFS + and modern APFS used in Darwin - to the network 9pfs from Plan 9. There are many "native "For Linux file systems - for example, Btrfs and the ext family. </p><br><p>  The de facto standard for Linux for a long time has been <strong>ext4</strong> , used by default by most popular Linux distributions.  Therefore, there is nothing surprising in the fact that it is used in Android.  Some builds (and some enthusiasts) also use <strong>F2FS</strong> (Flash-Friendly File System), optimized specifically for flash-memory (however, with its advantages, things are <a href="https://xakep.ru/2016/10/10/f2fs-mythology/">not so straightforward</a> ). </p><br><p>  Secondly, of interest is the so-called <strong>filesystem layout</strong> - the location of system and user folders and files in the file system.  Filesystem layout in ‚Äúnormal Linux‚Äù deserves a more detailed description (which can be found, for example, <a href="https://www.freedesktop.org/software/systemd/man/file-hierarchy.html">by this link</a> );  I will mention here only a few of the most important directories: </p><br><ul><li>  <code>/home</code> stores users home folders;  here, in various hidden folders ( <code>.cache</code> , <code>.cache</code> , <code>.config</code> and others), the programs store their settings, data and cache, specific to the user, </li><li>  <code>/boot</code> stores the Linux kernel and the initramfs image (special boot filesystem), </li><li>  <code>/usr</code> (it would be more logical to call <code>/system</code> ) stores the main part of the system itself, including libraries, executable files, configuration files, and also resources - themes for the interface, icons, the contents of the system manual, etc., </li><li>  <code>/etc</code> (it would be more logical to call <code>/config</code> ) stores system-wide settings, </li><li>  <code>/dev</code> stores device files and other special files (for example, socket <code>/dev/log</code> ), </li><li>  <code>/var</code> stores changeable data - logs, system cache, database contents, etc. </li></ul><br><p>  Android uses a similar but noticeably different filesystem layout.  Here are some of the most important parts of it: </p><br><ul><li>  <code>/data</code> stores changeable data, </li><li>  the kernel and the initramfs image are stored on a separate flash partition (partition) that is not mounted on the main file system, </li><li>  <code>/system</code> matches <code>/usr</code> and stores the system, </li><li>  <code>/vendor</code> - analog <code>/system</code> designed for files specific to this Android build, and not included in the "standard" Android, </li><li>  <code>/dev</code> , as in ‚Äúnormal Linux‚Äù, stores device files and other special files. </li></ul><br><p>  The most interesting of these directories are <code>/data</code> and <code>/system</code> .  The content <code>/system</code> describes the system and contains the majority of its component files.  <code>/system</code> is located on a separate section of flash-memory, which by default is mounted in read-only mode;  usually the data on it is changed only when the system is updated.  <code>/data</code> also located on a separate section and describes the changing state of a specific device, including user settings, installed applications and their data, caches, etc.  Clearing all user data, the so-called factory reset, with such a scheme is simply to clear the contents of the <em>data</em> section;  The untouched system remains installed in the <em>system</em> section. </p><br><pre> <code class="markdown hljs"><span class="hljs-section"><span class="hljs-section"># mount | grep /system /dev/block/mmcblk0p14 on /system type ext4 (ro,seclabel,relatime,data=ordered) # mount | grep /data /dev/block/mmcblk0p24 on /data type ext4 (rw,seclabel,nosuid,nodev,noatime,noauto_da_alloc,data=writeback)</span></span></code> </pre> <br><p>  Applications ‚Äî namely, their APK, odex files (compiled ahead-of-time Java code), and ELF libraries ‚Äî are installed in <code>/system/app</code> (for applications delivered with the system) or in <code>/data/app</code> (for user-installed applications).  When you create an Android assembly, each preinstalled application is allocated a folder with the name of the form <code>/system/app/Terminal</code> , and for user-installed applications, during installation, folders are created whose names begin with their package name.  For example, the YouTube app is saved to a folder with a name like <code>/data/app/com.google.android.youtube-bkJAtUtbTuzvAioW-LEStg==/</code> . </p><br><div class="spoiler">  <b class="spoiler_title">About this suffix</b> <div class="spoiler_text"><p>  The suffix in the names of the application folders is 16 random bytes encoded in Base64.  Using such a suffix does not allow other applications to "guess" the path to the application, the existence of which they should not be aware of.  In principle, the list of applications installed on the device and the paths to them is not a secret - it can be obtained through <a href="https://developer.android.com/reference/android/content/pm/PackageManager.html">standard APIs</a> - but in some cases (namely, for Instant apps), access to this data is restricted. </p><br><p>  This suffix serves another purpose.  Each time the application is updated, the new APK is installed in the folder with the new suffix, after which the old folder is deleted.  Prior to version 8.0 of Oreo, this was the purpose of suffixing, and instead of random bytes <a href="https://android.googlesource.com/platform/frameworks/base/%2B/5e10e8f1b2126f031b976b853c3f150418f3b342%255E%2521/">,</a> <code>-1</code> and <code>-2</code> <a href="https://android.googlesource.com/platform/frameworks/base/%2B/5e10e8f1b2126f031b976b853c3f150418f3b342%255E%2521/">used</a> alternately (for example, <code>/data/app/com.google.android.youtube-2</code> for YouTube). </p><br><p>  The full path to the application folder in <code>/system/app</code> or <code>/data/app</code> can be obtained using the standard API or the command <code>pm path org.example.packagename</code> , which displays the paths of all the APK files of the application. </p><br><pre> <code class="markdown hljs"><span class="hljs-section"><span class="hljs-section"># pm path com.android.egg package:/system/app/EasterEgg/EasterEgg.apk</span></span></code> </pre> </div></div><br><p>  Since the <strong>pre-installed applications are stored in the <em>system</em> section</strong> (the contents of which, I recall, only change when the system is updated), they cannot be deleted (instead of this, Android provides the ability to "disable" them).  Nevertheless, the <em>update of the</em> pre-installed applications is supported - at the same time a folder in <code>/data/app</code> is created for the new version, and the version supplied with the system remains in <code>/system/app</code> .  In this case, the user has the opportunity to "remove updates" of such an application by returning to the version from <code>/system/app</code> . </p><br><p>  Another feature of pre-installed applications is that they can receive <strong>special ‚Äúsystem‚Äù permissions</strong> .  For example, third-party applications do not get permissions <code>DELETE_PACKAGES</code> , which allows you to delete other applications, <code>REBOOT</code> , which allows you to restart the system, and <code>READ_FRAME_BUFFER</code> , which allows you to directly access the contents of the screen.  These permissions have <em>a signature protection level</em> , that is, the application attempting to access them must be signed with the same key as the application or service in which they are implemented - in this case, since these permissions are implemented by the system, the key that signed itself build Android. </p><br><p>  Each application is assigned a folder in <code>/data/data</code> (for example, <code>/data/data/com.google.android.youtube</code> for YouTube) for storing changeable data.  Only the application itself has access to this folder ‚Äî that is, only the UID under which this application runs (if the application uses multiple UIDs, or several applications use a common UID, things may be more complicated).  In this folder, applications save the settings, the cache (in the subfolders of <code>shared_prefs</code> and <code>cache</code> respectively) and any other data they need: </p><br><pre> <code class="markdown hljs"><span class="hljs-section"><span class="hljs-section"># ls /data/data/com.google.android.youtube/ cache code_cache databases files lib no_backup shared_prefs # cat /data/data/com.google.android.youtube/shared_prefs/youtube.xml &lt;?xml version='1.0' encoding='utf-8' standalone='yes' ?&gt; &lt;map&gt; &lt;string name="user_account"&gt;username@gmail.com&lt;/string&gt; &lt;boolean name="h264_main_profile_supported7.1.2" value="true" /&gt; &lt;int name="last_manual_video_quality_selection_max" value="-2" /&gt; &lt;...&gt; &lt;/map&gt;</span></span></code> </pre> <br><p>  The system is aware of the existence of the <code>cache</code> folder and can clean it itself if there is not enough space.  When you delete an application, the entire folder of this application is completely deleted, and the application leaves no trace behind it.  Alternatively, both can be explicitly done in the settings: </p><br><p> <a href=""><img src="https://habrastorage.org/webt/nz/a7/tw/nza7tw-1zno64k_jos3dtwoct9g.jpeg"></a> </p><br><p>  This data storage allocated to each application is called internal storage. </p><br><p>  In addition, there is another type of storage in Android - the so-called <strong>external storage</strong> (external storage - this name reflects the original idea that the external storage should be located on the external SD card inserted into the phone).  In fact, external storage plays the role of the <strong>user's home folder</strong> - it is there that folders such as Documents, Download, Music and Pictures are located, the external storage is opened by the file managers as the default folder, and it is the contents of the external Android storage that allows the computer to access when connected by cable. </p><br><pre> <code class="markdown hljs"><span class="hljs-section"><span class="hljs-section"># ls /sdcard Alarms Download Podcasts Android Movies Ringtones Books Music Subtitles DCIM Notifications bluetooth Documents Pictures</span></span></code> </pre> <br><p>  Unlike internal storage, divided into folders of individual applications, external storage is a ‚Äúcommon zone‚Äù: it has full access to any application that has received permission from the user.  As I mentioned in the last article, this permission should be requested by applications such as the file manager;  and for most other applications, it is better to use intent with the <a href="https://developer.android.com/reference/android/content/Intent.html"><code>ACTION_GET_CONTENT</code></a> action, allowing the user to select the desired file in the system file manager. </p><br><p>  Many applications prefer to save some of their internal files that are large (for example, the cache of downloaded images and audio files) in external storage.  For this, Android allocates to the applications in the external storage a folder with the names of the type <code>Android/data/com.google.android.youtube</code> .  The application itself <em>does not need</em> permission to access the entire external storage to access such a folder (because its UID is set as the owner of this folder), but any other application that has this permission can access this folder, so you really should use it only for storing public and non-critical data.  When you delete an application, the system will delete its special folder in the external storage;  but files created by applications in external storage outside their special folder are considered owned by the user and remain in place after the application that created them is deleted. </p><br><p>  As I mentioned above, the initial assumption was that the external storage would actually be located on an external SD card, because at that time the volume of SD cards was significantly higher than the amount of memory embedded in the phones (in the very same HTC Dream there were only 256 megabytes, of which about 90 megabytes were allocated to the <em>data</em> section).  Since then, many conditions have changed;  in modern phones, there is often no slot for an SD card, but a huge amount of internal memory is installed by mobile standards (for example, in Samsung Galaxy Note 9 it can be up to 512 <em>gigabytes</em> ). </p><br><p>  Therefore, in modern Android, almost always both internal and external storage are located in the internal memory.  The actual path that the external storage is located in the file system is of the form <code>/data/media/0</code> (for each user of the device <a href="https://source.android.com/devices/storage/traditional">, a</a> separate external storage <a href="https://source.android.com/devices/storage/traditional">is created</a> , and the number in the path corresponds to the user number).  For compatibility purposes, the external storage can also be reached via the <code>/sdcard</code> , <code>/mnt/sdcard</code> , <code>/storage/self/primary</code> , <code>/storage/emulated/0</code> paths, several paths starting with <code>/mnt/runtime/</code> , and some others. </p><br><p>  On the other hand, many devices still have a slot for an SD card.  An SD card inserted into an Android device can be used as a regular external drive (without turning it into internal or external storage of the system) - save files to it, open files stored on it, use it to transfer files to other devices, etc.  In addition, Android allows you to "borrow" the SD card and place the internal and external storage on it (this is called the <strong>adopted storage</strong> ).  At the same time, the system reformats the SD card and encrypts its contents - the data stored on it cannot be read by connecting it to another device. </p><br><p><img src="https://habrastorage.org/webt/rg/_o/ll/rg_ollklgpm44_ixtasfjhowl-a.png"></p><br><p>  You can read more about all this, for example, <a href="https://www.reddit.com/r/Android/comments/496sn3/lets_clear_up_the_confusion_regarding_storage_in/">in this post</a> and in the official documentation <a href="https://developer.android.com/guide/topics/data/data-storage">for application developers</a> and <a href="https://source.android.com/devices/storage">creators of Android assemblies</a> . </p><br><h2 id="zagruzka">  Loading </h2><br><p>  The traditional approach to computer system security is limited to protecting the system from software attacks.  It is believed that <strong>if the attacker has physical access to the computer, the game is already lost</strong> : he can get full access to any data stored on it.  To do this, it is sufficient, for example, to launch an arbitrary operating system controlled by it on this computer, allowing it to bypass any restrictions imposed by the ‚Äúprimary‚Äù system, or directly connect the data disk to another device.  If desired, an attacker can leave the computer in a healthy state, but patch the system installed on it, install arbitrary backdoors, keyloggers, etc. </p><br><p>  The Unix user rights restriction model (and the app sandbox technology in Android based on it) is focused on protection against software attacks;  the restriction of rights in Unix itself does not in any way protect the system from a user accessing the server and having physical access to the computer.  And if serious multi-user servers can and should be protected from unauthorized physical access to personal computers - and even more so mobile devices - this approach is simply not applicable. </p><br><p>  You can try to improve the situation with protection from an attacker who received physical access to the device in two ways: </p><br><ul><li>  First, you can <strong>encrypt the data stored on the disk</strong> , thereby preventing the attacker from gaining access to the data itself, even if it has access to the contents of the disk. </li><li>  Secondly, it is possible in one way or another <strong>to limit the ability to load arbitrary operating systems on the device</strong> , forcing the attacker to undergo authentication and authorization procedures in the installed system. </li></ul><br><p>  It is with these two areas of protection that the secure boot model in Android is associated. </p><br><h3 id="verified-boot">  Verified Boot </h3><br><p>  The Android download process is designed so that, on the one hand, it does not allow attackers to download an arbitrary OS on the device, on the other hand, it can allow users to install customized Android assemblies (and other systems). </p><br><p>  First of all, Android devices, unlike desktop computers, usually do not allow the user (or an attacker) to boot from external media;  instead, the <strong>bootloader</strong> installed on the device starts up immediately.  Bootloader is a relatively simple program whose tasks (when booting in ordinary mode) include: </p><br><ul><li>  Initialization and configuration of the Trusted Execution Environment (for example, ARM TrustZone), </li><li>  Finding the internal memory partitions in which Linux kernel and initramfs images are stored, </li><li>      (integrity) ‚Äî          ‚Äî     , </li><li>    initramfs      . </li></ul><br><h3 id="flashing-unlocking-fastboot-i-recovery"> Flashing, unlocking, fastboot  recovery </h3><br><p>  , bootloader        . </p><br><p> -,       (Android)   ,  <strong>recovery</strong> .  recovery,    Android-  ,           ,    Android  <em> recovery</em> . </p><br><p>      ¬´¬ª bootloader',       ‚Äî   ( <strong>flashing</strong> )           .   bootloader       ,   fastboot mode (   bootloader mode),        bootloader'      <strong>fastboot</strong> (    <code>fastboot</code>  Android SDK   ). </p><br><p>   bootloader'   .     ,   Samsung,    bootloader'a (Loke)        (Odin).    Odin          Samsung (   Odin),      <a href="https://glassechidna.com.au/heimdall/">Heimdall</a> . </p><br><p>      bootloader' (       ),      recovery   Android,    ,     : </p><br><pre> <code class="markdown hljs">$ fastboot flash recovery recovery.img $ fastboot flash boot boot.img $ fastboot flash system system.img</code> </pre> <br><p>      ;        : ,   <a href="https://android.googlesource.com/platform/external/avb/"><strong>  </strong></a> ,   bootloader'     Android,      ,      ,          ,      . </p><br><p>  ,    <strong> bootloader'</strong> (unlocking the bootloader,    OEM unlock) ‚Äî   bootloader'    recovery,         (     ).        Android,  <a href="https://lineageos.org/"><strong>LineageOS</strong></a> ( <strong>CyanogenMod</strong> ), <a href="http://paranoidandroid.co/">Paranoid Android</a> , <a href="http://aokp.co/">AOKP</a> , <a href="https://www.omnirom.org/">OmniROM</a>  . </p><br><p>   bootloader' -       ,         (  <em>data</em> ) <strong> </strong> .     ,   ,          (,      Google      ),   ‚Äî    ,       . </p><br><p> <a href=""><img src="https://habrastorage.org/webt/sb/_q/3k/sb_q3kyv1pigm9j1wmi2vhu7lwa.png"></a> </p><br><p>     recovery   bootloader   ,            . </p><br><p>   bootloader'         : </p><br><p> <a href=""><img src="https://habrastorage.org/webt/rz/a6/sf/rza6sf4m3cprxkxymn41msgoaq0.jpeg"></a> </p><br><p>   recovery,    ¬´¬ª (flashaholics) ‚Äî <a href="https://twrp.me/about/">TWRP</a> (Team Win Recovery Project).   -    ¬´¬ª,            zip-,           : </p><br><p> <a href=""><img src="https://habrastorage.org/webt/fo/rr/o_/forro_lz3skkvzytylekedddcli.png"></a> </p><br><h3 id="shifrovanie-diska">   </h3><br><p>   Android     ( <a href="https://source.android.com/security/encryption/file-based"><strong>file-based encryption</strong></a> ).       ext4  ,    Linux ( <a href="https://www.kernel.org/doc/html/latest/filesystems/fscrypt.html">fscrypt</a> ),          . </p><br><p>       ,    <em>data</em> ,   ,            (credential encrypted storage).  ,          ,         .                ,     ,     . </p><br><p> <a href=""><img src="https://habrastorage.org/webt/2f/4j/y8/2f4jy8m3qevncs1084-vvpqdku4.png"></a> </p><br><p>    credential encrypted storage  Android   device encrypted storage ‚Äî     ,     (    Trusted Execution Environment). ,   ,     ,    .     ,   <strong>Direct Boot</strong> :           ;         ( )     device encrypted storage,        ,     . , Direct Boot        ,   ,      -      . </p><br><h2 id="root">  Root </h2><br><p>   root- ‚Äî       ¬´ root¬ª (UID 0,    <strong></strong> ). ,  root ‚Äî    Unix-,  ‚Äî     ‚Äî       ,        . </p><br><p>       , Android     ,  <strong>        root-</strong> .       ,          ¬´  ¬ª,  Android  ¬´ ¬ª,    root-     ¬´¬ª,  : </p><br><ul><li>    ‚Äî      ,    APK   , </li><li>    : -, email-, ,  , ,   ,   ,       (      activity  intent',      ), </li><li>      (icon packs), </li><li>      ,     , </li><li>     (    Android-)        , </li><li>  ,    Android,      . </li></ul><br><p><img src="https://habrastorage.org/webt/np/pl/rh/npplrhnnumsl4ssb2vitzojmcqi.png"></p><br><p> ,   ,      , root-  .      root-        (   ),  <strong>   Android       root</strong> . ,     ,      Unix-;  shell,      <code>adb shell</code> ,        Unix- <em>shell</em> . </p><br><p>   , ,  root  : </p><br><ul><li> -, root-     Android  <a href="https://developer.android.com/studio/run/emulator"><strong></strong></a> ‚Äî    Android Studio     QEMU,             . <img src="https://habrastorage.org/getpro/habr/post_images/afa/9d4/6c3/afa9d46c303ccf673c839b29aff9fe97.gif"></li><li> -, root-        Android ( <strong>pre-rooted</strong> ROMs). </li><li> -,  <strong> bootloader'</strong> root-    Android   ,    ,   <code>su</code> ,  bootloader. </li><li>   , -, <strong>   ,   </strong> ,    root-,   (   root-          ). ,        2016 ,   root-  <a href="https://github.com/hazuki0x0/android_external_dirtycow"></a>     <a href="https://dirtycow.ninja/">Dirty Cow</a> . </li></ul><br><p>     ? , root-       .  ,  root-,    ,   ,     .        ‚Äî ,            .  ,     ,      <em>system</em> (     ). </p><br><p>  <a href="https://www.gnu.org/philosophy/keep-control-of-your-computing.ru.html">   </a> , root-   <strong>      </strong> ‚Äî  ,       . </p><br><h3 id="problemy-root-dostupa">  root- </h3><br><blockquote> With great power comes great responsibility. </blockquote><p>       ,           .  ,  root-          . </p><br><p> ,         ,   .   ,   root-       , ,  ,    root-   .      root, ,  , ,  <strong>       </strong> ‚Äî  ,   ,   ,    .. </p><br><p>        ,          Unix, Android   ,        ‚Äî      .   <strong>   root-</strong> , ,        . , root-      Android,               . </p><br><p>   ,  <strong>    ,    root-</strong> ,                . ,  ,   , ,  ,       .  ,      ‚Äî , <a href="https://pay.google.com/">Google Pay</a> ( Android Pay) ‚Äî  <strong>     root-</strong> ,    . </p><br><p><img src="https://habrastorage.org/webt/4h/qx/9g/4hqx9gfx2cobrrbikc6xhzzbobi.jpeg"></p><br><p> , -   Pok√©mon GO     root- , ,        . </p><br><h3 id="google-play-i-root-dostup"> Google Play  root- </h3><br><p> Google    Google Play Store  Google Play Services   ,  root- ,    Android     , , ,       ,          .   Play Store ‚Äî     (   ,    )    Android,        . (   ‚Äî , Amazon    Android   Fire OS    ‚Äî Echo, Fire TV, Fire Phone, Kindle Fire Tablet ‚Äî       Google).   root-       Android-. </p><br><p>     , Google   ,    root-,   Google Play (         <a href="https://opengapps.org/">Open GApps</a> );   Google <a href="https://www.xda-developers.com/google-blocks-gapps-uncertified-devices-custom-rom-whitelist/"></a> ,             <a href="https://www.google.com/android/uncertified/"> </a> . </p><br><blockquote> Device manufacturers work with Google to certify that Android devices with Google apps installed are secure and will run apps correctly. To be certified, a device must pass Android compatibility tests. If you are unable to add a Google Account on your Android device, your Android device software might not have passed Android compatibility tests, or the device manufacturer has not submitted the results to Google to seek approval. As a result, your device is uncertified. This means that your device might not be secure. <br><br> If you are a User wanting to use custom ROMs on your device, please register your device by submitting your Google Services Framework Android ID below. </blockquote><br><h3 id="ogranichenie-dostupa-kroot">    root </h3><br><p>  ¬´¬ª Linux,     Unix-,   root- (   <code>sudo</code>  <code>su</code> )     ( ,   Unix- root,        )     (,    ).         ,            root-. </p><br><p> <a href=""> </a>  <code>su</code>  Android Open Source Project     ,     Unix- <em>shell</em> (  root),       root-.    <code>su</code>      , ,    ,     . </p><br><p>        ,     <code>su</code> .     <code>su</code>     ,        root-.         , <a href="http://www.supersu.com/">SuperSU</a> ;           <a href="https://github.com/topjohnwu/Magisk">Magisk</a> . </p><br><p><img src="https://habrastorage.org/webt/ln/dk/s_/lndks_ju4haxlsnfbh8xpvofhek.png"></p><br><h3 id="magisk">  Magisk </h3><br><p>   Magisk ‚Äî      ,       ,    <code>/system</code> ,        <em>system</em> (   <strong>systemless-ly</strong> ), <a href="">    ¬´¬ª Linux</a> .    <strong>Magisk Hide</strong> ‚Äî        root-,         root-   Magisk   ‚Äî    -            Google Pay,     root- . Magisk Hide         root-,  <a href="https://developer.android.com/training/safetynet/attestation"><strong>SafetyNet</strong></a>  Google. </p><br><p>    <em> </em> ,  ,      Google Pay  root-        ‚Äî      root-   . ,    root-, -            Google Pay.    ,       . </p><br><p> Magisk  systemless-    ¬´¬ª   <strong>Magisk Modules</strong> , <a href="https://topjohnwu.github.io/Magisk/guides.html"> </a>     Magisk.    <a href="https://www.xda-developers.com/best-magisk-modules/">, </a> ,  root- Xposed  <a href="http://vipersaudio.com/blog/%3Fpage_id%3D25">ViPER</a> ,        . </p><br><h2 id="soc-drayvera-i-fragmentaciya"> SoC,    </h2><br><h3 id="sistemy-na-kristalle">    </h3><br><p>          <strong> </strong> ,       ¬´¬ª,      ,        ‚Äî ,    ‚Äî    (,    Wi-Fi ). </p><br><p>     ,   Android-    <strong>  </strong> (system on a chip, SoC).         ‚Äî  ,   ,  -,  , LTE-, Bluetooth-  Wi-Fi-  .. ‚Äî        .         ,     ,             ,        ,      ,          . </p><br><p> , ,       .      ,     ¬´¬ª, , ,   ,       . ,  ,  -,      ,        ,  ,      . </p><br><h3 id="o-drayverah">   </h3><br><p>  ‚Äî       Android ‚Äî  SoC        .     ,    ,      ‚Äî    LTE- ‚Äî      .      , <a href="https://medium.com/russian/%25D0%25BF%25D0%25BE%25D1%2587%25D0%25B5%25D0%25BC%25D1%2583-%25D0%25BC%25D0%25BE%25D0%25B9-%25D1%2582%25D0%25B5%25D0%25BB%25D0%25B5%25D1%2584%25D0%25BE%25D0%25BD-%25D0%25BD%25D0%25B5-%25D0%25BE%25D0%25B1%25D0%25BD%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2582%25D1%2581%25D1%258F-%25D0%25B4%25D0%25BE-%25D0%25BD%25D0%25BE%25D0%25B2%25D0%25BE%25D0%25B3%25D0%25BE-%25D0%25B0%25D0%25BD%25D0%25B4%25D1%2580%25D0%25BE%25D0%25B5%25D0%25B4%25D0%25B0-e4cd5fa3fa85">             ;  ,       </a> ,            . </p><br><p>    SoC (, Qualcomm)      Android- (, Sony  LG),       Android,     Android Open Source Project.   ,   Android,    ,       ,          . </p><br><p>     Android          Android-.         ,           Android.        Android     ,  ,            .             . </p><br><h3 id="fragmentaciya">  </h3><br><p>    ,   <strong></strong> :  Android       ‚Äî      ,     .           Android,              . </p><br><p> ,    ,             ,     Android.         . </p><br><p> -,  <strong></strong> .       ,      .      ,     ,   ,  ,     . </p><br><p> -,        Android ‚Äî    <strong>developer experience</strong> (DX,    user experience/UX).  ,              Android,    API ‚Äî Android Framework, OpenGL/Vulkan   ‚Äî      .   , ,   ,               Android ‚Äî   ,   ,     . </p><br><p> <a href="https://vk.com/love.android%3Fw%3Dwall-166578169_378"><img src="https://habrastorage.org/getpro/habr/post_images/aca/68a/fed/aca68afed91e22f1ab449a9b54c83ba5.jpg"></a> </p><br><h3 id="dont-stop-thinking-abouttomorrow"> Don't Stop Thinking About Tomorrow </h3><br><p>     Android-         . , Google      Nexus  Pixel   ,     Android.       Android      ,  ,   ,     . </p><br><p>  ,    ,   Android,    SoC. Android       ¬´¬ª  (, ,    <a href="http://www.android-x86.org/">Android-x86</a>  <a href="http://www.jide.com/remixos">RemixOS</a> ).   Android   ChromeOS,   Chromebook'  Android-   Linux-  -.   ‚Äî    Android   ‚Äî   <a href="https://anbox.io/">Anbox</a> ,   Android-  ¬´¬ª Linux-. (,  Android-     x86-,   ,     Java,    <a href="https://habr.com/company/solarsecurity/blog/338292/"></a>    .) </p><br><p><img src="https://habrastorage.org/webt/p4/6q/e0/p46qe0opbvxrwdru85-3py3pgw0.png"></p><br><p>    ,    Android          ‚Äî   ,     Android  . </p><br><p>       ‚Äî   <strong><a href="https://arstechnica.com/gadgets/2016/05/google-hopes-to-shame-slow-android-oems-with-update-rankings/"></a> </strong>       Android.   ,  ,    .    ,      <strong> </strong> ,    Android           . </p><br><p>     .  2017  Google <a href="https://android-developers.googleblog.com/2017/05/here-comes-treble-modular-base-for.html"></a> <strong>Project Treble</strong> ‚Äî ,    (     HAL, hardware abstraction layer)    (  ,    )    . Treble <a href="https://android-developers.googleblog.com/2018/05/faster-adoption-with-project-treble.html"></a>     ,   ,     ,   ‚Äî     ‚Äî     . </p><br><p> <strong>Treble    </strong>        .  Treble      (Sony, Nokia, OnePlus, Oppo, Xiaomi, Essential  Vivo ‚Äî      Google) <a href="https://www.androidcentral.com/project-treble-could-turn-out-be-more-important-we-thought"> </a>  - Android Pie. Treble <a href="https://www.essential.com/blog/android-pie-essential"></a> Essential    Android Pie   Essential Phone <em>   </em> Android Pie.      Android ‚Äî          -  ‚Äî <a href="https://www.xda-developers.com/how-project-treble-revolutionizes-custom-roms-android-oreo/">  </a>   ,  Treble,   ,         SoC. </p><br><p>  Treble   . Java   ¬´write once, run everywhere¬ª    ‚Äî       Android-       . Treble ‚Äî  ,        Android      SoC.    ,       ,   Treble.  ,        Android-  . </p><br><hr><br><p>         userspace Android:   init,  Zygote, Binder,   props. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/427431/">https://habr.com/ru/post/427431/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../427419/index.html">What to do the processor when there is nothing to do?</a></li>
<li><a href="../427421/index.html">How genealogical sites make it easier to catch killers</a></li>
<li><a href="../427423/index.html">City2Share: e-and autonomous vehicles in Munich logistics hubs</a></li>
<li><a href="../427427/index.html">How come to IT: about the interns and the June (the result of a survey of "My Circle")</a></li>
<li><a href="../427429/index.html">GUI frameworks - on stream</a></li>
<li><a href="../427433/index.html">Balancing traffic in the operator‚Äôs IP networks</a></li>
<li><a href="../427435/index.html">STM32H7 - setting clocking without HAL</a></li>
<li><a href="../427437/index.html">Configuring linked servers: ms sql server and teradata</a></li>
<li><a href="../427439/index.html">The whole truth about the RTOS. Article # 16. Signals</a></li>
<li><a href="../427441/index.html">Convergence with Kubernetes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>