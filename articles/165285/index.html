<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we ported the Silverlight application to Windows 8</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, we ported a relatively large business application to Windows 8 ‚Äî a editor for charts, flow charts, and other business graphics . Initially, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we ported the Silverlight application to Windows 8</h1><div class="post__text post__text-html js-mediator-article">  Recently, we ported a relatively large business application to Windows 8 ‚Äî a <a href="http://grapholite.com/">editor for charts, flow charts, and other business graphics</a> .  Initially, this editor was written for the Silverlight platform, but we rewrote it under the Windows Runtime and <a href="http://apps.microsoft.com/webpdp/app/grapholite-diagrams/726a2fd5-a1a3-48c1-976c-17e320982a30">successfully placed it in the Windows 8 Store</a> .  Unfortunately, we really didn‚Äôt have enough standard controls, so we had to write <a href="http://www.perpetuumsoft.com/Product.aspx%3Flang%3Den%26pid%3D150%26tid%3Doverview">our own library of controls</a> along the way.  And now we are ready to share our experience.  This article contains a number of nuances of developing applications for Windows 8 - from designing a user interface to technical details for working with DirectX. <br><img src="https://habrastorage.org/getpro/habr/post_images/65c/3d6/9db/65c3d69db8895de99afb68b5cb246114.png"><br><a name="habracut"></a><br>  From a technical point of view, porting was surprisingly easy.  Although we had to solve some API compatibility issues (which we hope to cover in the next posts), most of the C # code and XAML markup required only very simple transformations, such as renaming namespaces and some class members. <br><br>  But the main problem for us was the reworking of the user interface in the style of Microsoft Design Language (formerly known as the Windows Store UI, formerly known as Modern UI, formerly also known as Metro UI).  Compliance with this style is a prerequisite for certification when placing an application in a store, or simply a good tone rule, without which the application will look alien and incomprehensible to the user. <br><br>  If you watched materials and presentations on the principles of building a new UI, then you probably noticed that all the examples are quite simple in terms of the interface.  They are dedicated to applications that are intended solely for the consumption of content.  Therefore, if you are developing a Line-Of-Business application, then you are practically alone with the raw guidelines, proclaiming very beautiful principles like: <i>‚ÄúAlways put content before chrome‚Äù</i> , which are completely incomprehensible how to apply in real life. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this article, we will try with the example of our application to illustrate some design decisions that we made when switching to a new platform. <br><br><h4>  Content Before Chrome </h4><br>  As already mentioned, the basic principle of Microsoft Design Language: <i>"Always put content before chrome</i> . <i>"</i>  Your application should allow the user to focus on the data as much as possible; control elements should not distract him.  In our editor, we decided to take the whole screen to display the edited document and show controls only when necessary. <br><br><img src="https://habrastorage.org/storage2/eac/c7d/200/eacc7d20055561f02bfdd69e3eb7e8ff.png"><br><br>  See how the space allocated to the user to work directly with the document has grown.  This is especially valuable when working on a tablet where the physical dimensions of the screen are quite small. <br><br><h4>  Editing graphics primitives </h4><br>  Another one of the fundamental principles of the new UI is <i>‚ÄúDesign for a <b>touch-first</b> experience‚Äù</i> , which means <i>‚Äúdesign everything so that it is convenient to point with a finger, then somehow they will somehow fall with the mouse‚Äù</i> .  Naturally, this imposes a number of restrictions.  For us, when developing a graphic editor, the following were the most relevant: <br><ol><li>  Interactive elements should be tritely larger in size in order to compensate for the lower accuracy of the touch interface compared to the mouse one. </li><li>  No backlight mode.  If in classical interfaces it was possible to show controls when you hover the mouse over an object, then in the touch interface you need to click on the object.  Also, you cannot use cursor shape changes to prompt the user for the type of interaction, since there is no cursor in the touch interface. </li><li>  The functionality of mouse actions can be significantly expanded by using the mouse in combination with Ctrl / Shift / Alt.  In the new paradigm it is necessary to use a separate control element for each action. </li><li>  On the fingers there is not only a wheel, but also the right button.  But you can touch the screen with several fingers at once. </li></ol><br>  Here is how the set of controls for the selected object has changed during the transition to the new version: <br><img src="https://habrastorage.org/getpro/habr/post_images/c57/ef3/f7a/c57ef3f7a0f07339137a83c9d149a521.png"><br><table><tbody><tr><th>  Item number </th><th>  Why do you need </th><th>  Desktop </th><th>  Windows 8 </th></tr><tr><td>  one </td><td>  Controls the size </td><td>  Was small </td><td>  Became big </td></tr><tr><td>  2 </td><td>  Controls the rotation angle </td><td>  Was small </td><td>  Became big </td></tr><tr><td>  3 </td><td>  Manages different geometric properties. </td><td>  Was small </td><td>  Became big </td></tr><tr><td>  four </td><td>  Used to connect elements </td><td>  Context appeared over the object under the cursor </td><td>  Only applies to the selected item. </td></tr><tr><td>  five </td><td>  Deletes selected items. </td><td>  You could press the Del key </td><td>  A new item has appeared </td></tr><tr><td>  6 </td><td>  Used to create and move a copy. </td><td>  You could just drag the item with Ctrl pressed </td><td>  A new item has appeared </td></tr><tr><td>  7 </td><td>  Serves to call the context menu </td><td>  You could click the right mouse button </td><td>  A new item has appeared </td></tr></tbody></table><br><h4>  Navigation and work with documents </h4><br>  In Windows 8, navigation between equivalent elements, which undoubtedly are open editable documents, is supposed to be placed on the top AppBar.  AppBars are such horizontal controls that appear on the screen when you slide your finger from the top or bottom edge of the screen on the touchscreen, or when you right-click. <br><br><img src="https://habrastorage.org/storage2/e16/58e/8a5/e1658e8a54ae81e84d8cabf08750d188.png"><br><br>  Commands for manipulating documents are also supposed to be placed on the AppBar, with the right: <br><br><img src="https://habrastorage.org/storage2/f10/a19/b44/f10a19b4473e9c694a65ecdc180d15fc.png"><br><br><h4>  Contextual actions </h4><br>  Some commands that run in context over selected objects can also be placed on the lower AppBar.  Please note that contextual commands should be placed on the left, and AppBar should pop up automatically in cases where the command becomes relevant.  For example, when selecting an object of the appropriate type. <br><br>  In our application, this solution is used to control the selection mode of a set of objects.  In the desktop version of the application to select multiple objects, just hold down the Shift key, but in the tablet version the physical keyboard may not be available.  Therefore, for the simultaneous allocation of several objects had to provide a special mode.  To exit this mode, use the context AppBar: <br><br><img src="https://habrastorage.org/storage2/93b/c04/3de/93bc043de6931f0ae2c1473548242a9e.png"><br><br><h4>  Radial menus </h4><br>  The most interesting new element is the radial menu.  This is the original replacement for the classic context menu used in Microsoft OneNote.  It looks like this: <br><br><img src="https://habrastorage.org/storage2/c73/0f6/070/c730f6070e0dab7037e93d7e9c427e72.png"><br><br>  In addition to the usual commands, quite complex controls can be placed on the sub-levels of this menu, such as the color picker and sliders: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bfb/1dd/7de/bfb1dd7de5fdacb20447428200d3766e.png"><br><br>  Obvious advantages of this element are an unusual attractive design and the minimum distance to each command from the place of the initial location of the cursor pointer (or finger when working with the touch-screen).  In addition, this element looks normal only if no more than 8 teams are placed on the same level.  This forces the interface designer to avoid overloaded with menus and more carefully design user interaction.  But psychologists have long known that consciousness can work effectively with no more than 7-9 elements at a time. <br><br>  Unfortunately, this wonderful control is not in the standard library.  So we had to write it ourselves.  In our program, he completely replaced the classic context menus and took over part of the commands that were located on the ribbon. <br><br><img src="https://habrastorage.org/storage2/4ce/ab5/b80/4ceab5b8012fd7e449a4c8318405b7fa.png"><br><br><h4>  Pop up panels </h4><br>  All other controls we placed on the pop-up panel located on the right side of the screen: <br><br><img src="https://habrastorage.org/storage2/e31/dca/272/e31dca27212f3a3a058a5ca177cf2acd.png"><br><br><h4>  Sharms (miracle buttons) </h4><br>  A number of actions (calling the settings dialog, printing, etc.) in the new interface must be done using the Charms Bar, which is caused by sliding the finger from the right edge of the screen.  In fact, this is an analogue of the above-described AppBar, on which the system management functions and actions that are performed in the same type for all applications are located. <br><br>  This is how the print dialog call looks like: <br><br><img src="https://habrastorage.org/storage2/dd0/1c2/04d/dd01c204dba0b0412ded2b160c6feca3.png"><br><br><h4>  Directx </h4><br>  Without a doubt, one of the mandatory features of the diagram editor should be the ability to export the result to some graphic format.  Under Silverlight, this was done very simply - you could take the entire visual tree and render it into a picture.  For some reason, this functionality was removed in WinRT.  In particular, the <i><a href="http://msdn.microsoft.com/en-us/library/windows/apps/xaml/windows.ui.xaml.media.imaging.writeablebitmap">WriteableBitmap</a> .Render ()</i> method is no longer present.  There is a class <a href="http://msdn.microsoft.com/en-us/library/windows/apps/windows.ui.xaml.hosting.xamluipresenter">XamlUIPresenter</a> with the help of which <a href="http://advertboy.wordpress.com/2012/04/27/xamluipresenter-what-are-you/">you can probably do it somehow</a> , but with its use <a href="http://advertboy.wordpress.com/2012/04/27/xamluipresenter-what-are-you/">you can</a> not get into the Windows Store. <br><br>  There was an idea to implement export via HTML5, but its raster canvas didn‚Äôt have enough for our vector needs.  Therefore, we have only one way to go - use DirectX.  As you know, the only sane way to use DirectX under C # is <a href="http://sharpdx.org/">SharpDX</a> .  This wonderful open-source library provides the full DirectX API for the .NET platform.  For these purposes there are other products ( <a href="http://slimdx.org/">SlimDx</a> , <a href="http://en.wikipedia.org/wiki/Managed_DirectX">MDX</a> , etc.), but the creation of normal applications for Windows 8 only <a href="http://sharpdx.org/index.php/about/features">supports</a> SharpDx.  If you have never worked with this library before, <a href="http://sharpdx.org/download/">examples</a> and <a href="http://sharpdx.org/documentation">documentation</a> will help you.  If you just need to create a 2D image and save it as a graphic file, then you need a <a href="http://stackoverflow.com/questions/11859252/save-to-png-in-sharpdx">template with Stackoverflow</a> . <br><br>  It is worth bearing in mind one more thing.  Although the authors of SharpDx and <a href="http://sharpdx.org/news/new-version-2-1-0">boast</a> that all their assemblies are successfully certified, this is not entirely true.  When we first tried to get certified, we received messages of this type: <br><pre><code class="hljs kotlin">API D3DCompile <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> d3dcompiler_45.dll <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> not supported <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> application type. SharpDX.D3DCompiler.dll calls <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> API. API D3DCompile2 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> d3dcompiler_45.dll <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> not supported <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> application type. SharpDX.D3DCompiler.dll calls <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> API. API D3DCompileFromFile <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> d3dcompiler_45.dll <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> not supported <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> application type. SharpDX.D3DCompiler.dll calls <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> API. ...</code> </pre> <br>  So try to avoid using some rare methods.  But if you decided to use some kind of exotic functionality, it is better to first make sure that it will be certified in the Windows Store. <br><br><h4>  Conclusion </h4><br>  As you can see, creating a version of a business application for Windows Store will require significant reworking of the user interface.  Fortunately, the style adopted by Microsoft (everything is very, very square and with solid fills) makes this task for the programmer much easier. </div><p>Source: <a href="https://habr.com/ru/post/165285/">https://habr.com/ru/post/165285/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../165273/index.html">Seven years of WPF: what has changed?</a></li>
<li><a href="../165275/index.html">The key difference between AngularJS and Knockout</a></li>
<li><a href="../165277/index.html">Latest news from KickStarter: the best of 2012 (in the form of infographics)</a></li>
<li><a href="../165279/index.html">A bit about creating demos, part 1</a></li>
<li><a href="../165283/index.html">Data Mining: Primary data processing using DBMS. Part 3 (Pivot Tables)</a></li>
<li><a href="../165289/index.html">The course of the young soldier "Sell services web designer." Part 2 "The client is always wrong"</a></li>
<li><a href="../165293/index.html">VM Depot launched - a repository of virtual machine images on Linux for the Windows Azure community</a></li>
<li><a href="../165295/index.html">Catalana numbers</a></li>
<li><a href="../165297/index.html">Writing a bot for the game of Balls 2.0</a></li>
<li><a href="../165299/index.html">Method for constructing readable texts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>