<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ACS, raspberry and kettle</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The main actors are listed in the header, and as a result we will get a prototype of a simple access control system based on exactly the same RFID mod...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ACS, raspberry and kettle</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/geektimes/post_images/72d/edc/5cf/72dedc5cf4bb70e28103db455e672d3d.jpg" alt="image" align="left">  The main actors are listed in the header, and as a result we will get a prototype of a simple access control system based on <a href="http://malina-shop.ru/products/19886623">exactly the same RFID module RC522</a> , which can be used not only to open the door, but also to perform any similar action by applying and stopping the control signal. <br><br>  In the presence of a lot of diverse information on the Internet with not quite working examples, I will try to describe everything step by step and in detail.  This module works with RFID cards at a frequency of 13.56 MHz and, in addition to cards and chips with such a frequency, it also easily understands Moscow single tickets (I used the one-time single ticket used) and NFC tags. <a name="habracut"></a><br><br><h4>  <b>Hardware</b> </h4><br>  To implement the project, you need to connect the module and several additional components. <br><div class="spoiler">  <b class="spoiler_title">Module wiring diagram</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/geektimes/post_images/c9c/d98/8c0/c9cd988c00da87017ac09638ea1525a1.jpg" alt="image"><br></div></div><br>  To test the module, I used several diodes and piezo-dynamics.  Red and green diodes - to indicate the conditional operation of the conditional lock (red - the lock is closed, green - the lock is open), yellow diode - to indicate the control signal (in real conditions it will be replaced with a lock), piezo-dynamics - beeps when the lock is opened and signals an error.  In a real circuit with a lock, it is advisable to use a relay to control the power circuit of the lock. <br><div class="spoiler">  <b class="spoiler_title">Diode and speaker wiring diagram</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/geektimes/post_images/acb/fd5/1a3/acbfd51a3c2e343e7a78da32c89c57b7.jpg" alt="image"><br></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  <b>Software</b> </h4><br>  First you need to enable SPI on Raspberry, if not enabled.  How to do this is written <a href="https://geektimes.ru/post/271058/">here</a> . <br>  Now you can download the library for working with our module and check the reading and writing of maps.  Reading is important for us, in particular reading the UID of the card, for this we enter in the console: <br><pre><code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/mxgxw/MFRC522-python</code> </pre> <br>  For correct operation of the downloaded code, you must also download and install SPI-py: <br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/lthiery/SPI-Py sudo python /SPI-Py/setup.py install</code> </pre><br>  Now you can read the UID of the card and the information recorded in it.  To do this, run their uploaded files as an example: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> MFRC522-python sudo python Read.py</code> </pre><br>  The following should appear on the screen: <br><pre> <code class="bash hljs">Welcome to the MFRC522 data <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> example Press Ctrl-C to stop.</code> </pre><br>  After that, you can bring a card or tag to the reader and we will see its UID <br><pre> <code class="bash hljs">Card detected Card <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> UID: 60,56,197,101 Size: 8 Sector 8 [12, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</code> </pre><br>  In this case, we are interested in this part: <b>UID: 60,56,197,101</b> . <br>  And we can change this part <div class="spoiler">  <b class="spoiler_title">Spoiler header</b> <div class="spoiler_text">  , replacing zeros with the values ‚Äã‚Äãwe need: <b>Sector 8 [12, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</b> , but this is not what interests us now. </div></div><br>  Further, for the operation of our module and other components, I wrote a simple python script based on various sources. <br><br><div class="spoiler">  <b class="spoiler_title">Script with my comments</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python import RPi.GPIO as GPIO import MFRC522 import signal import time red = 11 green = 18 speaker = 16 doorlock = 12 #  UID  (UID     sudo python /MFRC522-python/Read.py card_01 = '6056197101' #white card_02 = '148167101184' #fob card_03 = '13652116101' # #   GPIO.setmode(GPIO.BOARD) #  ,         (3v3 - ) GPIO.setup(red, GPIO.OUT, initial=1) #   18   GPIO.setup(green, GPIO.OUT, initial=0) #     11 GPIO.setup(speaker, GPIO.OUT, initial=0) #  16 GPIO.setup(doorlock, GPIO.OUT, initial=0) #  12 continue_reading = True def end_read(signal,frame): #  ,        global continue_reading print "Ctrl+C captured, ending read." continue_reading = False GPIO.cleanup() # Create an object of the class MFRC522 (??) MIFAREReader = MFRC522.MFRC522() while continue_reading: #   -   UID (status,TagType) = MIFAREReader.MFRC522_Request(MIFAREReader.PICC_REQIDL) #    ,  " " if status == MIFAREReader.MI_OK: print "Card detected" #  UID  (status,uid) = MIFAREReader.MFRC522_Anticoll() #   UID,    if status == MIFAREReader.MI_OK: #  UID    UIDcode = str(uid[0])+str(uid[1])+str(uid[2])+str(uid[3]) print UIDcode #      if UIDcode == card_01 or UIDcode == card_03 or UIDcode == card_02: #    # ,       #  ( ,  ),  # ..     # ..       doorlock #  ,  ,      GPIO.output((red, green, speaker, doorlock), (0,1,1,1)) print "Door open" #    1  time.sleep(1) GPIO.output((red, green, speaker, doorlock), (1,0,0,0)) #   ,     print "Door closed" #      ,     else: GPIO.output((red, green, speaker, doorlock), (1,0,0,0)) time.sleep(0.05) GPIO.output((red, green, speaker, doorlock), (1,0,1,0)) time.sleep(0.05) GPIO.output((red, green, speaker, doorlock), (1,0,0,0)) time.sleep(0.05) GPIO.output((red, green, speaker, doorlock), (1,0,1,0)) time.sleep(0.05) GPIO.output((red, green, speaker, doorlock), (0,1,0,0)) time.sleep(0.05) GPIO.output((red, green, speaker, doorlock), (0,1,1,0)) time.sleep(0.05) GPIO.output((red, green, speaker, doorlock), (0,1,0,0)) time.sleep(0.05) GPIO.output((red, green, speaker, doorlock), (0,1,1,0)) time.sleep(0.05) GPIO.output((red, green, speaker, doorlock), (1,0,0,0)) time.sleep(0.05) GPIO.output((red, green, speaker, doorlock), (1,0,1,0)) time.sleep(0.05) GPIO.output((red, green, speaker, doorlock), (1,0,0,0)) time.sleep(0.05) GPIO.output((red, green, speaker, doorlock), (1,0,1,0)) time.sleep(0.05) GPIO.output((red, green, speaker, doorlock), (0,1,0,0)) time.sleep(0.05) GPIO.output((red, green, speaker, doorlock), (0,1,1,0)) time.sleep(0.05) GPIO.output((red, green, speaker, doorlock), (0,1,0,0)) time.sleep(0.05) GPIO.output((red, green, speaker, doorlock), (0,1,1,0)) time.sleep(0.05) GPIO.output((red, green, speaker, doorlock), (1,0,0,0)) print "Unrecognised Card"</span></span></code> </pre><br></div></div><br><br>  Create a file and copy the code into it: <br><pre> <code class="bash hljs">nano rf.py</code> </pre><br>  save the file (CTRL + x, y). <br>  Run the script with the command <br><pre> <code class="bash hljs">sudo python rf.py</code> </pre><br>  After the following will occur: <br>  the red diode will light up, indicating that our ‚Äúlock‚Äù is closed. <br>  If the card with the number (without commas) is listed, the red diode will go out, the green diode will light up, indicating that the ‚Äúlock‚Äù is open, the yellow diode will light up - in this case it is ‚Äúcontrol‚Äù, indicating that ‚Äú lock "is a control signal, piezo dynamics.  After a specified time (in our case, 1 second), the diodes and the speaker will return to the initial state, the reader will wait for the card to be read. <br>  If a card from a list is not brought to the reader, the red and green diodes will flash, the piezo-dynamics will squeak intermittently, signaling an error, the yellow diode will not light up (i.e. there is no signal to open the lock).  A little less than a second, everything will return to its original state. <br><br>  A short video illustrating the work: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/4z6fXMZl74A%3Ffeature%3Doembed&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjdJqQESk85bb50ovao1DlzuXTJOw" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/357956/">https://habr.com/ru/post/357956/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../357942/index.html">Heavy industry removal</a></li>
<li><a href="../357944/index.html">Attack of BitErrant with SHA-1 collisions: create different .exe with the same .torrent file</a></li>
<li><a href="../357950/index.html">Compact server for Django applications</a></li>
<li><a href="../357952/index.html">Raspberry pi zero</a></li>
<li><a href="../357954/index.html">Raspberry Pi Zero went on sale for $ 5: links to stores</a></li>
<li><a href="../357958/index.html">Thermal Raspberry Pi 3 showed a temperature of 101¬∫C</a></li>
<li><a href="../357960/index.html">We acquaint Qt with Raspberry Pi 3</a></li>
<li><a href="../357962/index.html">Restricted Access and CCTV at Raspberry PI</a></li>
<li><a href="../357964/index.html">Access Controller for Go + Raspberry Pi + Arduino Nano</a></li>
<li><a href="../357966/index.html">Orange Pi 2G-IOT or Orange Paradise</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>