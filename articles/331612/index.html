<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Limit the number of method executions per second</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Task : to develop the ability to run a specified number of operations per second. 

 Requirements : 



- The solution should work out as quickly as p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Limit the number of method executions per second</h1><div class="post__text post__text-html js-mediator-article">  <b>Task</b> : to develop the ability to run a specified number of operations per second. <br><br>  <b>Requirements</b> : <br><br><ul><li>  The solution should work out as quickly as possible (otherwise it makes no sense) </li><li>  Solution must be thread safe </li></ul><br>  As a result, I got a function (of course as part of a separate class), which returns true or false (permission to perform). <br><a name="habracut"></a><br>  The general principle is as follows.  There is a collection of <s>DateTime</s> time prints (in the comment they suggested that it would be wiser to take Stopwatch).  When requesting permission, it is checked whether the number of requests in the last second does not exceed the maximum specified value.  If it exceeds, false is returned, otherwise a nugget of the current time is added to the collection and true is returned. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Initially, I did everything based on the sheets (List &lt;&gt;), but the sheets have a dynamic data set, which means they are expanded as needed when adding new elements.  And it is also necessary to delete.  Therefore, I decided to use a collection of a given size.  Therefore, I decided to discard the paper in favor of the array.  As a result, I got the functionality of a circular collection based on an array, so in the end I made a circular collection. <br><br>  The result was a pool of date imprints of a given size based on a circular collection.  The pool class contains the current item, which has a date stamp and a link to the next item.  Initially, all dates have default values. <br><br>  When requesting permission, the next item from the current item is taken, and 1 second is added to its date.  If the date is greater than the current date, then there is no space in the pool and the request returns false.  Otherwise, the next element is set as the current element, a date nugget is set in the new current element and the return value is true. <br><br>  Now about the threads.  I didn‚Äôt think of anything better than putting lock on the resolution function. <br><br>  That's all. <br><br>  For testing, I created a method that performs a specified number of queries with a specified number of threads.  Launched it with the following parameters.  The number of operations per second is 6, the number of threads is 4, the number of requests is 50. <br><br>  These results turned out here: <br><br><img src="https://habrastorage.org/web/fef/3cc/e1f/fef3cce1fd4d4db09d784ffbcc5af5ce.PNG"><br><br>  ‚Üí <a href="https://github.com/iRumba/RpsBarrier">Link to githab</a> <br><br>  On the screen you can see that the code worked correctly. </div><p>Source: <a href="https://habr.com/ru/post/331612/">https://habr.com/ru/post/331612/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../331598/index.html">Phoenix Framework - Webpack instead of Brunch, deploy using Distillery and a little systemd</a></li>
<li><a href="../331600/index.html">Two in one: how to use vim and nano?</a></li>
<li><a href="../331604/index.html">How to create visual effects for games</a></li>
<li><a href="../331606/index.html">The digest of interesting materials for the mobile developer # 209 (June 19 - June 25)</a></li>
<li><a href="../331608/index.html">Java place in the HFT world</a></li>
<li><a href="../331614/index.html">Another example of asynchronous circuit synthesis: VME bus controller</a></li>
<li><a href="../331618/index.html">Image smoothing by Peron and Malik anisotropic diffusion filter</a></li>
<li><a href="../331620/index.html">Knowledge Base: 100 practical materials on safety, economics and IaaS tools</a></li>
<li><a href="../331624/index.html">How do retail companies evaluate the effectiveness of loyalty systems implementation in Russia and abroad</a></li>
<li><a href="../331626/index.html">ServiceNow Platform: Artificial Intelligence Automates Workflows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>