<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Disassemble Windows Explorer - disable grouping on the taskbar</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One day, in 2009, Windows 7 came out. At that time I was sitting on Vista, which slowed down on my old computer, and I decided to transfer to the seve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Disassemble Windows Explorer - disable grouping on the taskbar</h1><div class="post__text post__text-html js-mediator-article">  One day, in 2009, Windows 7 came out. At that time I was sitting on Vista, which slowed down on my old computer, and I decided to transfer to the seven right after it was released. <br><br>  The first thing I noticed after installation is the new taskbar.  More specifically, the fact that it groups the buttons according to the program to which they belong. <br><br><img src="https://habrastorage.org/storage2/804/6ce/50c/8046ce50c3cb393cebb3dc8772a7add4.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Immediately I got into the settings to disable this disgrace, and was surprised to find that the group is not turned off.  The closest option to the desired, Never Combine, still groups the buttons. <br><br><img src="https://habrastorage.org/storage2/67c/24f/75c/67c24f75c7d8bfd6001ca29f402bfa55.png"><br><br>  I thought that, like me, many people would not like it, and I was sure that a week or two later a solution to this problem would come up on the Internet.  But I did not find anything worthwhile, and I realized that I would have to act on my own. <br><br>  Under the cut: <br><ul><li>  A detailed demonstration of how you can independently tweak the principle of a system process such as explorer, for yourself, using the OllyDbg debugger. </li><li>  Ready solution to the problem described above. </li></ul><br><a name="habracut"></a><h4>  Getting started </h4><br>  <i>To understand the process described below, it is advisable to have a basic knowledge of the assembler.</i> <br><br>  In order to wean the taskbar from grouping, we need <a href="http://www.ollydbg.de/">OllyDbg</a> , a <i>free, proprietary 32-bit assembler-level debugger for Windows operating systems, designed to analyze and modify compiled executable files and libraries operating in user mode (ring-3)</i> ¬© <a href="http://ru.wikipedia.org/wiki/OllyDbg">Wikipedia</a> . <br><br>  You can repeat the process on Windows 7 or Windows 8. Unfortunately, at the moment there is only a 32-bit version of OllyDbg, so if you have a 64-bit OS, you will not be able to repeat the following steps (in this case you can use a virtual machine ). <br><br><h5>  Installation OllyDbg </h5><br>  OllyDbg is a portable program and does not need installation.  Create a folder with write permissions, and copy files from <a href="">this archive there</a> . <br><br><h5>  Configure Microsoft Symbol Server </h5><br>  Microsoft Symbol Server - Microsoft's debugging symbols server, thanks to which we, in addition to the pure assembler, will also see the names of functions and variables.  This is very helpful in analyzing the code. <br><br>  To do this, do the following: <br><ul><li>  Download <a href="">this archive</a> and place its content in the OllyDbg program folder. <br><div class="spoiler">  <b class="spoiler_title">What are these files?</b> <div class="spoiler_text"><ul><li>  <b>symsrv.dll</b> - Microsoft's DLL file, designed to work with their server debugging symbols.  Signed by Microsoft. </li><li>  <b>symsrv.yes</b> is an empty file.  Indicates that you agree to the terms of service provided. </li><li>  <b>symsrv.ini</b> - excludes all files except those that start with exp - for our explorer.exe.  Otherwise, if all the characters swing, you will have to wait a very long time, and we don‚Äôt need it for this demonstration. </li></ul></div></div></li><li>  Turn on OllyDbg, open the settings (Alt + O), and mark the option <i>Demangle symbolic names</i> .  This option decodes symbolic names, making them more readable for us humans. <br><div class="spoiler">  <b class="spoiler_title">Screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/e5a/9a6/822/e5a9a68223a0ec29fd4c962c48b5833d.png"></div></div></li><li>  In the settings, open the <i>Debugging data</i> page, and mark <i>Allow access to Microsoft Symbol Server</i> .  Then create a folder for characters, and select it in the settings, as in the screenshot. <br><div class="spoiler">  <b class="spoiler_title">Screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/ee1/b57/b31/ee1b57b317046df7339e6d24692c1bd8.png"></div></div></li><li>  Restart OllyDbg. </li></ul><br><h5>  Joining the explorer process </h5><br>  As you know, the taskbar is part of the Windows Explorer process.  Run OllyDbg, and select <i>File -&gt; Attach ....</i>  Then, select the <i>explorer</i> and click on <i>Attach</i> . <br><div class="spoiler">  <b class="spoiler_title">Screenshots</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/a77/778/67f/a7777867f63049fde6788065946e4063.png"><br><img src="https://habrastorage.org/storage2/f2b/939/ccf/f2b939ccf5c14cb6f3725a64d64bff88.png"></div></div><br>  Attach, from English - to attach - that is, we attach our debugger to the conductor to debug it. <br><br>  Then we wait until all modules are loaded.  This may take several minutes, and at this time the conductor will not respond.  After the download is completed, Paused will be written on the yellow background in the status bar on the right - that is, the process is suspended.  Click F9 to resume the process. <br><br>  <b>Attention, exceptions</b> : if the process pauses and <i>Exception xxxxxxxx</i> appears on the status bar (as in the screenshot below), press Shift + F9 to send the exception to its intended purpose. <br><div class="spoiler">  <b class="spoiler_title">Screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/c99/6b7/664/c996b766466b10a578598b7d28a7c228.png"></div></div><br><h5>  Overview of Explorer Functions </h5><br>  Now the conductor is working under the supervision of our debugger, OllyDbg.  If the connection to the server debugging characters passed as it should, we can look at the functions of the explorer. <br><br>  First, open the explorer process module in the CPU window of the debugger.  To do this, open the modules window (the letter E on a blue background), right-click on <i>Explorer</i> , and select <i>View code in CPU</i> . <br><div class="spoiler">  <b class="spoiler_title">Screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/eb1/760/720/eb17607207bfcff8acce389371a70cab.png"></div></div><br>  Then, right click on the code and select <i>Search for -&gt; Names</i> .  Before us will be a list of functions that are present in the explorer.  For more convenient work with the list, sort it by name, copy it and paste it into the text into your favorite text editor. <br><div class="spoiler">  <b class="spoiler_title">Screenshots</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/6d0/82b/16c/6d082b16cbbc7d1eab12e1627c6d8862.png"><br><img src="https://habrastorage.org/storage2/403/873/498/403873498c4d2fee2f402c21811b1288.png"></div></div><br>  So, we need to disable grouping.  It is logical to start the search with the word group.  Two classes immediately strike the eye: <i>CTaskBtnGroup</i> and <i>CTaskGroup</i> .  Together, these two classes have 131 functions ‚Äî not very much for a quick look at the titles. <br><br>  It‚Äôs hard for me to say if we can find the function we need by just learning the names, since I‚Äôm already well acquainted with many of them.  In any case, the function we need - <i>CTaskGroup :: DoesWindowMatch</i> , the name of which translates to <i>whether the window matches</i> , and it does exactly that - answers whether the window is suitable for a specific group. <br><div class="spoiler">  <b class="spoiler_title">Screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/2a8/cdd/b89/2a8cddb89cf25bc90c8015e610aff063.png"></div></div><br><h5>  View selected function </h5><br>  We found a function with an interesting name, now let's see what it is.  Let's go back to OllyDbg, press Ctrl + G and go to the address of the function (that eight-digit number at the beginning of the line, in our case 00973629). <br><br>  PS I advise you to turn on the highlight of <i>Jumps and calls</i> , thanks to which function calls and conditional / unconditional jumps are clearly visible. <br><div class="spoiler">  <b class="spoiler_title">Screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/4c4/537/ddd/4c4537ddd0be12a98036ecb89347ef43.png"></div></div><br>  So, here is our function: <br><img src="https://habrastorage.org/storage2/625/33c/9d0/62533c9d03b09895ed1aebd0204c6733.png"><br><br>  Columns, from left to right: address, bytes, commands (assembler), comments. <br>  Functions are marked in blue, transitions in yellow.  We will focus on them. <br><br>  First of all, some function is called, and a transition occurs depending on the result.  Here I will not linger on them, I will only note that they have nothing to do with our task. <br><br>  Then we see three transitions.  The first one jumps over the second and third.  The second and third go somewhere far away - let's see where ... <br><br>  <b>The first</b> <br>  The WinAPI function <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb776448%2528v%3Dvs.85%2529.aspx">ILIsEqual</a> , which compares two structures, is immediately apparent.  After some analysis, it becomes clear that the compared structures are associated with groups.  Our goal is to cancel any grouping, so we patch the code so that the conductor thinks that the structures are not equal. <br><br><img src="https://habrastorage.org/storage2/bf7/29d/6f4/bf729d6f43b4e24dc8f8fbd1b0ef70a3.png"><br><br>  To do this, we write an unconditional jump JMP, as in the screenshot above. <br><br>  <b>Second</b> <br>  As in the first time, immediately see the WinAPI function for comparison, this time the text - <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/dd317762%2528v%3Dvs.85%2529.aspx">CompareStringOrdinal</a> .  Again, after experimenting it becomes clear that this comparison is also related to groups.  This time, the so-called Application ID is compared - the application ID, according to which the taskbar groups the buttons. <br><br><img src="https://habrastorage.org/storage2/2d5/004/fbb/2d5004fbb348a90b5e6e8cb9ca22fbb2.png"><br><br>  Again, we set an unconditional jump, forcing the conductor to think that all identifiers are different. <br><br><h5>  We try </h5><br>  The big advantage of the debugger from, for example, a simple disassembler is that the changes take effect immediately, since we modify the memory of the running process directly.  For the same reason, you need to be very careful, as an error can lead to the collapse of the process. <br><br>  Let's try to open several copies of the notebook, and see that they are not grouped together: <br><br><img src="https://habrastorage.org/storage2/258/d1f/e30/258d1fe30b597a3a304d92e776b1e08c.png"><br><br>  Happened :) <br><br>  Since we changed the code only in the memory of the running process, our modification will last only until the completion of the process. <br><br><h5>  Bonus - decompiled version of the <i>CTaskGroup</i> function <i>:: DoesWindowMatch</i> </h5><br>  In spite of the fact that the original language of this code is C ++, the samopisny decompilation on pure C is shown below. <br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* return: S_OK if there's a match, E_FAIL otherwise *pnMatch: 1: AppId matches, ITEMIDLIST is missing 2: AppId matches, ITEMIDLIST doesn't match 3: ITEMIDLIST matches 4: hWnd already exists (pTaskItem recieves the CTaskItem) */</span></span> <span class="hljs-function"><span class="hljs-function">HRESULT </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CTaskGroup_DoesWindowMatch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">/*CTaskGroup*/</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">/*IN*/</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HWND hCompareWnd, </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">/*IN*/</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ITEMIDLIST *pCompareItemIdList, </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">/*IN*/</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WCHAR *pCompareAppId, </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">/*OUT*/</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *pnMatch, </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">/*OUT*/</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">/*CTaskItem*/</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **pTaskItem)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-comment"><span class="hljs-comment">/*CTaskItem*/</span></span> *CompareWndTaskItem; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nMatch; HRESULT hr; nMatch = <span class="hljs-number"><span class="hljs-number">0</span></span>; hr = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;lpVtbl-&gt;GetItemFromWindow(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, hCompareWnd, &amp;CompareWndTaskItem); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(SUCCEEDED(hr)) <span class="hljs-comment"><span class="hljs-comment">// if an item for this window already exists { if(pTaskItem) { *pTaskItem = NULL; IUnknown_Set(pTaskItem, CompareWndTaskItem); } nMatch = 4; CompareWndTaskItem-&gt;lpVtbl-&gt;Release(CompareWndTaskItem); } else { if(!(this-&gt;SomeFlags &amp; 0x80000000)) { if(pCompareItemIdList &amp;&amp; this-&gt;pItemIdList &amp;&amp; ILIsEqual(pCompareItemIdList, this-&gt;pItemIdList) != 0) { nMatch = 3; hr = S_OK; } else if(pCompareAppId &amp;&amp; CompareStringOrdinal(this-&gt;pAppId, -1, pCompareAppId, -1, TRUE) == CSTR_EQUAL) { hr = S_OK; if(pCompareItemIdList &amp;&amp; this-&gt;pItemIdList) nMatch = 2; else nMatch = 1; } } } *pnMatch = nMatch; return hr; }</span></span></code> </pre> <br><br><h4>  Turnkey solution </h4><br>  The <a href="http://rammichael.com/7-taskbar-tweaker">7+ Taskbar Tweaker</a> program, authored by me, is able to disable grouping both globally and selectively by the Application ID.  In addition, there are in the presence of several interesting settings on the taskbar. <br><br><img src="https://habrastorage.org/storage2/767/c13/fd2/767c13fd2a70fbc2ea85b432198c4f30.png"><br><br><h4>  Conclusion </h4><br>  Sometimes I open an article on a habr that seems interesting to me, but after I start reading, I understand that it is not that interesting (or not very clear).  In such cases, I often immediately turn down to the conclusion / conclusions. <br><br>  If you are here for the same reason, I will tell you briefly what was discussed: <br>  I took the debugger, and attached it to the conductor.  Then I found the necessary function, and changed it so that the conductor would think that any window created would not fit into any of the existing groups.  Due to this change, Explorer has stopped grouping buttons on the taskbar. </div><p>Source: <a href="https://habr.com/ru/post/174593/">https://habr.com/ru/post/174593/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../174575/index.html">Vkontakte blocked in the Oryol region</a></li>
<li><a href="../174577/index.html">DevConf 2013 - June 14 - we invite speakers, 43% discount for participation</a></li>
<li><a href="../174579/index.html">In GOD we trust</a></li>
<li><a href="../174583/index.html">New tools for developing games on Windows Phone</a></li>
<li><a href="../174589/index.html">Managing site rights with Google‚Äôs webmaster tools is easier</a></li>
<li><a href="../174597/index.html">"Soup" combined with the "Rambler". And why is all this necessary?</a></li>
<li><a href="../174601/index.html">Execution of operating system commands on the Cach√© server</a></li>
<li><a href="../174603/index.html">Pixi.js - 2D engine with transparent support for WebGL</a></li>
<li><a href="../174605/index.html">Video reports are posted from the last Yandex conference on project management</a></li>
<li><a href="../174609/index.html">Modular robot snake at Carnegie Mellon University</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>