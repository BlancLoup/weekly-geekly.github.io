<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Monads and do-notation in C ++</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In Haskell, as we know, there are monads, but in C ++ there are none. But nothing prevents to implement monads in C ++. Let's see if we have everythin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Monads and do-notation in C ++</h1><div class="post__text post__text-html js-mediator-article">  In Haskell, as we know, there are monads, but in C ++ there are none.  But nothing prevents to implement monads in C ++.  Let's see if we have everything necessary for their implementation: <br><ul><li>  Passing a function as an argument to another function is. </li><li>  Lambda functions are present in C ++ 11.  I'm not sure that they are necessary for the implementation of monads, but with them, of course, easier. </li><li>  Type classes are not.  In C ++, we wanted to add their analogue - concepts, but have not added it yet.  But for the implementation of monads, they are not needed, you can simply overload functions or operators for specific monads. </li><li>  do-notation  In C ++, it is not there, but it is not needed for the implementation of monads, although it makes their use much more convenient.  There is already a proposal to add its counterpart to the standard, but more on that below. </li></ul><a name="habracut"></a><br>  The monad in Haskell is defined as follows: <br><pre><code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Monad</span></span></span><span class="hljs-class"> m </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">where</span></span></span></span> (&gt;&gt;= ) ::ma -&gt; (a-&gt;mb)-&gt;mb (&gt;&gt; ) ::m a-&gt;m b-&gt;mb return ::a-&gt;ma fail::<span class="hljs-type"><span class="hljs-type">String</span></span>-&gt;ma</code> </pre> <br>  First, let's take some abstract monad, let it be of type in C ++ <pre> <code class="hljs coffeescript"><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">       ma,    f    f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb)</span></span></span><span class="hljs-function"> { return Ma &gt;&gt;= [=]</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A)</span></span></span><span class="hljs-function">{ return mb; }; }</span></span></code><span class="hljs-function"><span class="hljs-function">     &gt;&gt;= ,        .       </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</span></span></span></span></code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">,     Haskell  C++. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A&gt; Monad &lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A a)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">  return    C++,      mreturn.     ,     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">       . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">fail</span></span></code><span class="hljs-function"><span class="hljs-function">    ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,        C++,    -        .         - </span></span><code><span class="hljs-function"><span class="hljs-function">Maybe</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   .,     </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .      C++11.   </span></span><code><code><span class="hljs-function"><span class="hljs-function">future       T</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     .   , ,   -   ,      ,   ,  ,      .    </span></span><code><span class="hljs-function"><span class="hljs-function">future</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">get</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;class T&gt; class future { public: ... T get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //  get         ... };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   C++11    ‚Äì </span></span><code><span class="hljs-function"><span class="hljs-function">std::async</span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,           </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .       : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; result = async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">; //  -      f int a = result.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //    f    .</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(const A&amp; a)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([=]{ </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a; })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">  ,       future      ,   .     ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(ma.get()).get(); })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    ,         ma,       f,         f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,      .    3 ,     : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     C++, : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(a) &gt;&gt;= f)</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(mreturn(a).get()).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,  </span></span><code><span class="hljs-function"><span class="hljs-function"></span></span></code><span class="hljs-function"><span class="hljs-function"> .     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     . , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(a).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,  ,     </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function"> ,        .   ,   </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function">  ,      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(   )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">m &gt;&gt;= mreturn == m</span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mreturn(m.get()).get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> m.get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">  ,     m.    ,        m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    .    -     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">function&lt;future&lt;int&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int)</span></span></span><span class="hljs-function">&gt; f = []</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int a)</span></span></span><span class="hljs-function">{ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">; }; int a = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">) &gt;&gt;= f)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; cout &lt;&lt; a;</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    5  11. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  C++11      mreturn  &gt;&gt;=.      : </span></span><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf"><span class="hljs-function"><span class="hljs-function">n3721</span></span></a><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">make_ready_future</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function"> ,    </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function"> .     ,       </span></span><code><span class="hljs-function"><span class="hljs-function">A</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future.     ,        ,   future    ,   then</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   . </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-function">unwrap</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future&lt;future&gt;  future.   join</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">Control.Monad</span></span></code><span class="hljs-function"><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function">     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(shared_ptr&lt;stream&gt; str)</span></span></span><span class="hljs-function"> { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;</span></span>read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([](future&lt;int&gt; op) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> op.get() + <span class="hljs-number"><span class="hljs-number">11</span></span>; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(s).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> str.read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count + <span class="hljs-number"><span class="hljs-number">11</span></span>; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> ‚Äì     ( <code>&lt;-</code> )  <code><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      <span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> . ,   <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>    <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>       ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> .    <code>resumable</code>     <code>std::future</code> ,          <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> </pre> <code><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f) { ... //     }</code>       ma,    f    f. <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb) { return Ma &gt;&gt;= [=](A){ return mb; }; }</code>     &gt;&gt;= ,        .       ( <code>m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</code> ),     Haskell  C++. <br> <br> <code class="cpp">template&lt;typename A&gt; Monad &lt;A&gt; mreturn(A a) { ... //     }</code>  return    C++,      mreturn.     ,     <code>a</code>       . <br>  <code>fail</code>    ,        . <br> <br> ,        C++,    -        .         - <code>Maybe</code> ,   .,     <code>std::future</code> .      C++11.   <code><code>future       T</code> ,     .   , ,   -   ,      ,   ,  ,      .    <code>future</code>      <code>get</code> . <br> <code class="cpp">template&lt;class T&gt; class future { public: ... T get(); //  get         ... };</code> <br>   C++11    ‚Äì <code>std::async</code> .      ,           <code>std::future</code> .       : <code class="cpp">future&lt;int&gt; result = async(f); //  -      f int a = result.get(); //    f    .</code> <br>        <code>mreturn</code>  <code>&gt;&gt;=</code>   <code>std::future</code> <code class="cpp">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn(const A&amp; a) { return async([=]{ return a; }); }</code>  ,       future      ,   .     ,    . <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f) { return async([&amp;] () -&gt; B { return f(ma.get()).get(); }); }</code>   ,    ,         ma,       f,         f. <br> <br>  ,      .    3 ,     : <code class="haskell">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: (m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code> <br>     C++, : <br> <code class="cpp">(mreturn(a) &gt;&gt;= f) == f(a)</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(mreturn(a).get()).get(); }) == f(a)</code> ,  <code>mreturn(a).get()</code>   ,  <code></code> .     <code>a</code>  <code>std::future</code> ,     . , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(a).get(); }) == f(a)</code>  ,  ,     <code>f</code> ,        .   ,   <code>f</code>  ,      (   ). <br> <br>  : <code class="haskell">m &gt;&gt;= mreturn == m</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return mreturn(m.get()).get(); }) == m</code>      <code>mreturn(x).get()</code> , : <br> <code class="cpp">async([&amp;] () -&gt; B { return m.get(); }) == m</code>  ,     m.    ,        m. <br> <br>  : <code class="haskell">(m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code>       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. <br> <br>    .    -     : <code class="cpp">function&lt;future&lt;int&gt; (int)&gt; f = [](int a){ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn(a + 6); }; int a = (mreturn(5) &gt;&gt;= f).get(); cout &lt;&lt; a;</code>   ,    5  11. <br> <br>  C++11      mreturn  &gt;&gt;=.      : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf">n3721</a> <br>  <code>mreturn</code>  <code>make_ready_future</code> . <br>  <code>&gt;&gt;=</code> ,    <code>std::future</code>   <code>then</code> .     ,       <code>A</code> ,   <code><code><code>future.     ,        ,   future    ,   then</code> ,   . <br>     <code>unwrap</code>      <code><code><code>future&lt;future&gt;  future.   join</code>  <code>Control.Monad</code>  . <br> <br>  <code>then</code>     : <code class="cpp">future&lt;int&gt; f(shared_ptr&lt;stream&gt; str) { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;read(512, buf).then([](future&lt;int&gt; op) { return op.get() + 11; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; return f(s).then([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = await str.read(512, buf); return count + 11; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = await f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code>await</code> ‚Äì     ( <code>&lt;-</code> )  <code>do</code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      await</code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code>await</code> . ,   <code>await</code>    <code>then</code>       ,    <code>await</code> .    <code>resumable</code>     <code>std::future</code> ,          <code>then</code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> <pre> <code class="hljs coffeescript"><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">       ma,    f    f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb)</span></span></span><span class="hljs-function"> { return Ma &gt;&gt;= [=]</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A)</span></span></span><span class="hljs-function">{ return mb; }; }</span></span></code><span class="hljs-function"><span class="hljs-function">     &gt;&gt;= ,        .       </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</span></span></span></span></code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">,     Haskell  C++. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A&gt; Monad &lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A a)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">  return    C++,      mreturn.     ,     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">       . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">fail</span></span></code><span class="hljs-function"><span class="hljs-function">    ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,        C++,    -        .         - </span></span><code><span class="hljs-function"><span class="hljs-function">Maybe</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   .,     </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .      C++11.   </span></span><code><code><span class="hljs-function"><span class="hljs-function">future       T</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     .   , ,   -   ,      ,   ,  ,      .    </span></span><code><span class="hljs-function"><span class="hljs-function">future</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">get</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;class T&gt; class future { public: ... T get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //  get         ... };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   C++11    ‚Äì </span></span><code><span class="hljs-function"><span class="hljs-function">std::async</span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,           </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .       : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; result = async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">; //  -      f int a = result.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //    f    .</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(const A&amp; a)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([=]{ </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a; })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">  ,       future      ,   .     ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(ma.get()).get(); })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    ,         ma,       f,         f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,      .    3 ,     : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     C++, : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(a) &gt;&gt;= f)</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(mreturn(a).get()).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,  </span></span><code><span class="hljs-function"><span class="hljs-function"></span></span></code><span class="hljs-function"><span class="hljs-function"> .     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     . , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(a).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,  ,     </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function"> ,        .   ,   </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function">  ,      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(   )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">m &gt;&gt;= mreturn == m</span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mreturn(m.get()).get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> m.get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">  ,     m.    ,        m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    .    -     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">function&lt;future&lt;int&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int)</span></span></span><span class="hljs-function">&gt; f = []</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int a)</span></span></span><span class="hljs-function">{ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">; }; int a = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">) &gt;&gt;= f)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; cout &lt;&lt; a;</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    5  11. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  C++11      mreturn  &gt;&gt;=.      : </span></span><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf"><span class="hljs-function"><span class="hljs-function">n3721</span></span></a><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">make_ready_future</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function"> ,    </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function"> .     ,       </span></span><code><span class="hljs-function"><span class="hljs-function">A</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future.     ,        ,   future    ,   then</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   . </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-function">unwrap</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future&lt;future&gt;  future.   join</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">Control.Monad</span></span></code><span class="hljs-function"><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function">     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(shared_ptr&lt;stream&gt; str)</span></span></span><span class="hljs-function"> { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;</span></span>read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([](future&lt;int&gt; op) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> op.get() + <span class="hljs-number"><span class="hljs-number">11</span></span>; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(s).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> str.read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count + <span class="hljs-number"><span class="hljs-number">11</span></span>; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> ‚Äì     ( <code>&lt;-</code> )  <code><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      <span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> . ,   <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>    <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>       ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> .    <code>resumable</code>     <code>std::future</code> ,          <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> </pre> <code><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f) { ... //     }</code>       ma,    f    f. <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb) { return Ma &gt;&gt;= [=](A){ return mb; }; }</code>     &gt;&gt;= ,        .       ( <code>m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</code> ),     Haskell  C++. <br> <br> <code class="cpp">template&lt;typename A&gt; Monad &lt;A&gt; mreturn(A a) { ... //     }</code>  return    C++,      mreturn.     ,     <code>a</code>       . <br>  <code>fail</code>    ,        . <br> <br> ,        C++,    -        .         - <code>Maybe</code> ,   .,     <code>std::future</code> .      C++11.   <code><code>future       T</code> ,     .   , ,   -   ,      ,   ,  ,      .    <code>future</code>      <code>get</code> . <br> <code class="cpp">template&lt;class T&gt; class future { public: ... T get(); //  get         ... };</code> <br>   C++11    ‚Äì <code>std::async</code> .      ,           <code>std::future</code> .       : <code class="cpp">future&lt;int&gt; result = async(f); //  -      f int a = result.get(); //    f    .</code> <br>        <code>mreturn</code>  <code>&gt;&gt;=</code>   <code>std::future</code> <code class="cpp">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn(const A&amp; a) { return async([=]{ return a; }); }</code>  ,       future      ,   .     ,    . <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f) { return async([&amp;] () -&gt; B { return f(ma.get()).get(); }); }</code>   ,    ,         ma,       f,         f. <br> <br>  ,      .    3 ,     : <code class="haskell">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: (m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code> <br>     C++, : <br> <code class="cpp">(mreturn(a) &gt;&gt;= f) == f(a)</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(mreturn(a).get()).get(); }) == f(a)</code> ,  <code>mreturn(a).get()</code>   ,  <code></code> .     <code>a</code>  <code>std::future</code> ,     . , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(a).get(); }) == f(a)</code>  ,  ,     <code>f</code> ,        .   ,   <code>f</code>  ,      (   ). <br> <br>  : <code class="haskell">m &gt;&gt;= mreturn == m</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return mreturn(m.get()).get(); }) == m</code>      <code>mreturn(x).get()</code> , : <br> <code class="cpp">async([&amp;] () -&gt; B { return m.get(); }) == m</code>  ,     m.    ,        m. <br> <br>  : <code class="haskell">(m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code>       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. <br> <br>    .    -     : <code class="cpp">function&lt;future&lt;int&gt; (int)&gt; f = [](int a){ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn(a + 6); }; int a = (mreturn(5) &gt;&gt;= f).get(); cout &lt;&lt; a;</code>   ,    5  11. <br> <br>  C++11      mreturn  &gt;&gt;=.      : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf">n3721</a> <br>  <code>mreturn</code>  <code>make_ready_future</code> . <br>  <code>&gt;&gt;=</code> ,    <code>std::future</code>   <code>then</code> .     ,       <code>A</code> ,   <code><code><code>future.     ,        ,   future    ,   then</code> ,   . <br>     <code>unwrap</code>      <code><code><code>future&lt;future&gt;  future.   join</code>  <code>Control.Monad</code>  . <br> <br>  <code>then</code>     : <code class="cpp">future&lt;int&gt; f(shared_ptr&lt;stream&gt; str) { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;read(512, buf).then([](future&lt;int&gt; op) { return op.get() + 11; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; return f(s).then([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = await str.read(512, buf); return count + 11; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = await f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code>await</code> ‚Äì     ( <code>&lt;-</code> )  <code>do</code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      await</code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code>await</code> . ,   <code>await</code>    <code>then</code>       ,    <code>await</code> .    <code>resumable</code>     <code>std::future</code> ,          <code>then</code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> <pre> <code class="hljs coffeescript"><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">       ma,    f    f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb)</span></span></span><span class="hljs-function"> { return Ma &gt;&gt;= [=]</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A)</span></span></span><span class="hljs-function">{ return mb; }; }</span></span></code><span class="hljs-function"><span class="hljs-function">     &gt;&gt;= ,        .       </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</span></span></span></span></code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">,     Haskell  C++. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A&gt; Monad &lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A a)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">  return    C++,      mreturn.     ,     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">       . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">fail</span></span></code><span class="hljs-function"><span class="hljs-function">    ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,        C++,    -        .         - </span></span><code><span class="hljs-function"><span class="hljs-function">Maybe</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   .,     </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .      C++11.   </span></span><code><code><span class="hljs-function"><span class="hljs-function">future       T</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     .   , ,   -   ,      ,   ,  ,      .    </span></span><code><span class="hljs-function"><span class="hljs-function">future</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">get</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;class T&gt; class future { public: ... T get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //  get         ... };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   C++11    ‚Äì </span></span><code><span class="hljs-function"><span class="hljs-function">std::async</span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,           </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .       : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; result = async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">; //  -      f int a = result.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //    f    .</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(const A&amp; a)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([=]{ </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a; })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">  ,       future      ,   .     ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(ma.get()).get(); })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    ,         ma,       f,         f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,      .    3 ,     : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     C++, : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(a) &gt;&gt;= f)</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(mreturn(a).get()).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,  </span></span><code><span class="hljs-function"><span class="hljs-function"></span></span></code><span class="hljs-function"><span class="hljs-function"> .     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     . , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(a).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,  ,     </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function"> ,        .   ,   </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function">  ,      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(   )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">m &gt;&gt;= mreturn == m</span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mreturn(m.get()).get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> m.get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">  ,     m.    ,        m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    .    -     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">function&lt;future&lt;int&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int)</span></span></span><span class="hljs-function">&gt; f = []</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int a)</span></span></span><span class="hljs-function">{ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">; }; int a = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">) &gt;&gt;= f)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; cout &lt;&lt; a;</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    5  11. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  C++11      mreturn  &gt;&gt;=.      : </span></span><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf"><span class="hljs-function"><span class="hljs-function">n3721</span></span></a><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">make_ready_future</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function"> ,    </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function"> .     ,       </span></span><code><span class="hljs-function"><span class="hljs-function">A</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future.     ,        ,   future    ,   then</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   . </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-function">unwrap</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future&lt;future&gt;  future.   join</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">Control.Monad</span></span></code><span class="hljs-function"><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function">     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(shared_ptr&lt;stream&gt; str)</span></span></span><span class="hljs-function"> { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;</span></span>read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([](future&lt;int&gt; op) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> op.get() + <span class="hljs-number"><span class="hljs-number">11</span></span>; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(s).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> str.read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count + <span class="hljs-number"><span class="hljs-number">11</span></span>; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> ‚Äì     ( <code>&lt;-</code> )  <code><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      <span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> . ,   <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>    <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>       ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> .    <code>resumable</code>     <code>std::future</code> ,          <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> </pre> <code><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f) { ... //     }</code>       ma,    f    f. <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb) { return Ma &gt;&gt;= [=](A){ return mb; }; }</code>     &gt;&gt;= ,        .       ( <code>m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</code> ),     Haskell  C++. <br> <br> <code class="cpp">template&lt;typename A&gt; Monad &lt;A&gt; mreturn(A a) { ... //     }</code>  return    C++,      mreturn.     ,     <code>a</code>       . <br>  <code>fail</code>    ,        . <br> <br> ,        C++,    -        .         - <code>Maybe</code> ,   .,     <code>std::future</code> .      C++11.   <code><code>future       T</code> ,     .   , ,   -   ,      ,   ,  ,      .    <code>future</code>      <code>get</code> . <br> <code class="cpp">template&lt;class T&gt; class future { public: ... T get(); //  get         ... };</code> <br>   C++11    ‚Äì <code>std::async</code> .      ,           <code>std::future</code> .       : <code class="cpp">future&lt;int&gt; result = async(f); //  -      f int a = result.get(); //    f    .</code> <br>        <code>mreturn</code>  <code>&gt;&gt;=</code>   <code>std::future</code> <code class="cpp">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn(const A&amp; a) { return async([=]{ return a; }); }</code>  ,       future      ,   .     ,    . <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f) { return async([&amp;] () -&gt; B { return f(ma.get()).get(); }); }</code>   ,    ,         ma,       f,         f. <br> <br>  ,      .    3 ,     : <code class="haskell">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: (m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code> <br>     C++, : <br> <code class="cpp">(mreturn(a) &gt;&gt;= f) == f(a)</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(mreturn(a).get()).get(); }) == f(a)</code> ,  <code>mreturn(a).get()</code>   ,  <code></code> .     <code>a</code>  <code>std::future</code> ,     . , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(a).get(); }) == f(a)</code>  ,  ,     <code>f</code> ,        .   ,   <code>f</code>  ,      (   ). <br> <br>  : <code class="haskell">m &gt;&gt;= mreturn == m</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return mreturn(m.get()).get(); }) == m</code>      <code>mreturn(x).get()</code> , : <br> <code class="cpp">async([&amp;] () -&gt; B { return m.get(); }) == m</code>  ,     m.    ,        m. <br> <br>  : <code class="haskell">(m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code>       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. <br> <br>    .    -     : <code class="cpp">function&lt;future&lt;int&gt; (int)&gt; f = [](int a){ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn(a + 6); }; int a = (mreturn(5) &gt;&gt;= f).get(); cout &lt;&lt; a;</code>   ,    5  11. <br> <br>  C++11      mreturn  &gt;&gt;=.      : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf">n3721</a> <br>  <code>mreturn</code>  <code>make_ready_future</code> . <br>  <code>&gt;&gt;=</code> ,    <code>std::future</code>   <code>then</code> .     ,       <code>A</code> ,   <code><code><code>future.     ,        ,   future    ,   then</code> ,   . <br>     <code>unwrap</code>      <code><code><code>future&lt;future&gt;  future.   join</code>  <code>Control.Monad</code>  . <br> <br>  <code>then</code>     : <code class="cpp">future&lt;int&gt; f(shared_ptr&lt;stream&gt; str) { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;read(512, buf).then([](future&lt;int&gt; op) { return op.get() + 11; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; return f(s).then([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = await str.read(512, buf); return count + 11; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = await f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code>await</code> ‚Äì     ( <code>&lt;-</code> )  <code>do</code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      await</code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code>await</code> . ,   <code>await</code>    <code>then</code>       ,    <code>await</code> .    <code>resumable</code>     <code>std::future</code> ,          <code>then</code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> <pre> <code class="hljs coffeescript"><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">       ma,    f    f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb)</span></span></span><span class="hljs-function"> { return Ma &gt;&gt;= [=]</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A)</span></span></span><span class="hljs-function">{ return mb; }; }</span></span></code><span class="hljs-function"><span class="hljs-function">     &gt;&gt;= ,        .       </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</span></span></span></span></code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">,     Haskell  C++. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A&gt; Monad &lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A a)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">  return    C++,      mreturn.     ,     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">       . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">fail</span></span></code><span class="hljs-function"><span class="hljs-function">    ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,        C++,    -        .         - </span></span><code><span class="hljs-function"><span class="hljs-function">Maybe</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   .,     </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .      C++11.   </span></span><code><code><span class="hljs-function"><span class="hljs-function">future       T</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     .   , ,   -   ,      ,   ,  ,      .    </span></span><code><span class="hljs-function"><span class="hljs-function">future</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">get</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;class T&gt; class future { public: ... T get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //  get         ... };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   C++11    ‚Äì </span></span><code><span class="hljs-function"><span class="hljs-function">std::async</span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,           </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .       : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; result = async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">; //  -      f int a = result.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //    f    .</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(const A&amp; a)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([=]{ </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a; })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">  ,       future      ,   .     ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(ma.get()).get(); })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    ,         ma,       f,         f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,      .    3 ,     : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     C++, : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(a) &gt;&gt;= f)</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(mreturn(a).get()).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,  </span></span><code><span class="hljs-function"><span class="hljs-function"></span></span></code><span class="hljs-function"><span class="hljs-function"> .     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     . , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(a).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,  ,     </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function"> ,        .   ,   </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function">  ,      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(   )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">m &gt;&gt;= mreturn == m</span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mreturn(m.get()).get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> m.get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">  ,     m.    ,        m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    .    -     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">function&lt;future&lt;int&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int)</span></span></span><span class="hljs-function">&gt; f = []</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int a)</span></span></span><span class="hljs-function">{ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">; }; int a = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">) &gt;&gt;= f)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; cout &lt;&lt; a;</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    5  11. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  C++11      mreturn  &gt;&gt;=.      : </span></span><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf"><span class="hljs-function"><span class="hljs-function">n3721</span></span></a><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">make_ready_future</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function"> ,    </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function"> .     ,       </span></span><code><span class="hljs-function"><span class="hljs-function">A</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future.     ,        ,   future    ,   then</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   . </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-function">unwrap</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future&lt;future&gt;  future.   join</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">Control.Monad</span></span></code><span class="hljs-function"><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function">     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(shared_ptr&lt;stream&gt; str)</span></span></span><span class="hljs-function"> { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;</span></span>read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([](future&lt;int&gt; op) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> op.get() + <span class="hljs-number"><span class="hljs-number">11</span></span>; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(s).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> str.read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count + <span class="hljs-number"><span class="hljs-number">11</span></span>; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> ‚Äì     ( <code>&lt;-</code> )  <code><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      <span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> . ,   <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>    <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>       ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> .    <code>resumable</code>     <code>std::future</code> ,          <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> </pre> <code><code><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f) { ... //     }</code>       ma,    f    f. <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb) { return Ma &gt;&gt;= [=](A){ return mb; }; }</code>     &gt;&gt;= ,        .       ( <code>m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</code> ),     Haskell  C++. <br> <br> <code class="cpp">template&lt;typename A&gt; Monad &lt;A&gt; mreturn(A a) { ... //     }</code>  return    C++,      mreturn.     ,     <code>a</code>       . <br>  <code>fail</code>    ,        . <br> <br> ,        C++,    -        .         - <code>Maybe</code> ,   .,     <code>std::future</code> .      C++11.   <code>future       T</code> ,     .   , ,   -   ,      ,   ,  ,      .    <code>future</code>      <code>get</code> . <br> <code class="cpp">template&lt;class T&gt; class future { public: ... T get(); //  get         ... };</code> <br>   C++11    ‚Äì <code>std::async</code> .      ,           <code>std::future</code> .       : <code class="cpp">future&lt;int&gt; result = async(f); //  -      f int a = result.get(); //    f    .</code> <br>        <code>mreturn</code>  <code>&gt;&gt;=</code>   <code>std::future</code> <code class="cpp">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn(const A&amp; a) { return async([=]{ return a; }); }</code>  ,       future      ,   .     ,    . <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f) { return async([&amp;] () -&gt; B { return f(ma.get()).get(); }); }</code>   ,    ,         ma,       f,         f. <br> <br>  ,      .    3 ,     : <code class="haskell">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: (m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code> <br>     C++, : <br> <code class="cpp">(mreturn(a) &gt;&gt;= f) == f(a)</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(mreturn(a).get()).get(); }) == f(a)</code> ,  <code>mreturn(a).get()</code>   ,  <code></code> .     <code>a</code>  <code>std::future</code> ,     . , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(a).get(); }) == f(a)</code>  ,  ,     <code>f</code> ,        .   ,   <code>f</code>  ,      (   ). <br> <br>  : <code class="haskell">m &gt;&gt;= mreturn == m</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return mreturn(m.get()).get(); }) == m</code>      <code>mreturn(x).get()</code> , : <br> <code class="cpp">async([&amp;] () -&gt; B { return m.get(); }) == m</code>  ,     m.    ,        m. <br> <br>  : <code class="haskell">(m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code>       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. <br> <br>    .    -     : <code class="cpp">function&lt;future&lt;int&gt; (int)&gt; f = [](int a){ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn(a + 6); }; int a = (mreturn(5) &gt;&gt;= f).get(); cout &lt;&lt; a;</code>   ,    5  11. <br> <br>  C++11      mreturn  &gt;&gt;=.      : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf">n3721</a> <br>  <code>mreturn</code>  <code>make_ready_future</code> . <br>  <code>&gt;&gt;=</code> ,    <code>std::future</code>   <code>then</code> .     ,       <code>A</code> ,   <code><code><code>future.     ,        ,   future    ,   then</code> ,   . <br>     <code>unwrap</code>      <code><code><code>future&lt;future&gt;  future.   join</code>  <code>Control.Monad</code>  . <br> <br>  <code>then</code>     : <code class="cpp">future&lt;int&gt; f(shared_ptr&lt;stream&gt; str) { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;read(512, buf).then([](future&lt;int&gt; op) { return op.get() + 11; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; return f(s).then([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = await str.read(512, buf); return count + 11; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = await f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code>await</code> ‚Äì     ( <code>&lt;-</code> )  <code>do</code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      await</code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code>await</code> . ,   <code>await</code>    <code>then</code>       ,    <code>await</code> .    <code>resumable</code>     <code>std::future</code> ,          <code>then</code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> <pre> <code class="hljs coffeescript"><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">       ma,    f    f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb)</span></span></span><span class="hljs-function"> { return Ma &gt;&gt;= [=]</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A)</span></span></span><span class="hljs-function">{ return mb; }; }</span></span></code><span class="hljs-function"><span class="hljs-function">     &gt;&gt;= ,        .       </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</span></span></span></span></code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">,     Haskell  C++. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A&gt; Monad &lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A a)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">  return    C++,      mreturn.     ,     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">       . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">fail</span></span></code><span class="hljs-function"><span class="hljs-function">    ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,        C++,    -        .         - </span></span><code><span class="hljs-function"><span class="hljs-function">Maybe</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   .,     </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .      C++11.   </span></span><code><code><span class="hljs-function"><span class="hljs-function">future       T</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     .   , ,   -   ,      ,   ,  ,      .    </span></span><code><span class="hljs-function"><span class="hljs-function">future</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">get</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;class T&gt; class future { public: ... T get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //  get         ... };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   C++11    ‚Äì </span></span><code><span class="hljs-function"><span class="hljs-function">std::async</span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,           </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .       : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; result = async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">; //  -      f int a = result.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //    f    .</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(const A&amp; a)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([=]{ </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a; })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">  ,       future      ,   .     ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(ma.get()).get(); })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    ,         ma,       f,         f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,      .    3 ,     : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     C++, : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(a) &gt;&gt;= f)</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(mreturn(a).get()).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,  </span></span><code><span class="hljs-function"><span class="hljs-function"></span></span></code><span class="hljs-function"><span class="hljs-function"> .     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     . , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(a).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,  ,     </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function"> ,        .   ,   </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function">  ,      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(   )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">m &gt;&gt;= mreturn == m</span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mreturn(m.get()).get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> m.get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">  ,     m.    ,        m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    .    -     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">function&lt;future&lt;int&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int)</span></span></span><span class="hljs-function">&gt; f = []</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int a)</span></span></span><span class="hljs-function">{ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">; }; int a = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">) &gt;&gt;= f)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; cout &lt;&lt; a;</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    5  11. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  C++11      mreturn  &gt;&gt;=.      : </span></span><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf"><span class="hljs-function"><span class="hljs-function">n3721</span></span></a><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">make_ready_future</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function"> ,    </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function"> .     ,       </span></span><code><span class="hljs-function"><span class="hljs-function">A</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future.     ,        ,   future    ,   then</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   . </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-function">unwrap</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future&lt;future&gt;  future.   join</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">Control.Monad</span></span></code><span class="hljs-function"><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function">     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(shared_ptr&lt;stream&gt; str)</span></span></span><span class="hljs-function"> { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;</span></span>read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([](future&lt;int&gt; op) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> op.get() + <span class="hljs-number"><span class="hljs-number">11</span></span>; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(s).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> str.read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count + <span class="hljs-number"><span class="hljs-number">11</span></span>; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> ‚Äì     ( <code>&lt;-</code> )  <code><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      <span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> . ,   <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>    <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>       ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> .    <code>resumable</code>     <code>std::future</code> ,          <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> </pre> <code><code><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f) { ... //     }</code>       ma,    f    f. <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb) { return Ma &gt;&gt;= [=](A){ return mb; }; }</code>     &gt;&gt;= ,        .       ( <code>m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</code> ),     Haskell  C++. <br> <br> <code class="cpp">template&lt;typename A&gt; Monad &lt;A&gt; mreturn(A a) { ... //     }</code>  return    C++,      mreturn.     ,     <code>a</code>       . <br>  <code>fail</code>    ,        . <br> <br> ,        C++,    -        .         - <code>Maybe</code> ,   .,     <code>std::future</code> .      C++11.   <code>future       T</code> ,     .   , ,   -   ,      ,   ,  ,      .    <code>future</code>      <code>get</code> . <br> <code class="cpp">template&lt;class T&gt; class future { public: ... T get(); //  get         ... };</code> <br>   C++11    ‚Äì <code>std::async</code> .      ,           <code>std::future</code> .       : <code class="cpp">future&lt;int&gt; result = async(f); //  -      f int a = result.get(); //    f    .</code> <br>        <code>mreturn</code>  <code>&gt;&gt;=</code>   <code>std::future</code> <code class="cpp">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn(const A&amp; a) { return async([=]{ return a; }); }</code>  ,       future      ,   .     ,    . <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f) { return async([&amp;] () -&gt; B { return f(ma.get()).get(); }); }</code>   ,    ,         ma,       f,         f. <br> <br>  ,      .    3 ,     : <code class="haskell">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: (m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code> <br>     C++, : <br> <code class="cpp">(mreturn(a) &gt;&gt;= f) == f(a)</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(mreturn(a).get()).get(); }) == f(a)</code> ,  <code>mreturn(a).get()</code>   ,  <code></code> .     <code>a</code>  <code>std::future</code> ,     . , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(a).get(); }) == f(a)</code>  ,  ,     <code>f</code> ,        .   ,   <code>f</code>  ,      (   ). <br> <br>  : <code class="haskell">m &gt;&gt;= mreturn == m</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return mreturn(m.get()).get(); }) == m</code>      <code>mreturn(x).get()</code> , : <br> <code class="cpp">async([&amp;] () -&gt; B { return m.get(); }) == m</code>  ,     m.    ,        m. <br> <br>  : <code class="haskell">(m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code>       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. <br> <br>    .    -     : <code class="cpp">function&lt;future&lt;int&gt; (int)&gt; f = [](int a){ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn(a + 6); }; int a = (mreturn(5) &gt;&gt;= f).get(); cout &lt;&lt; a;</code>   ,    5  11. <br> <br>  C++11      mreturn  &gt;&gt;=.      : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf">n3721</a> <br>  <code>mreturn</code>  <code>make_ready_future</code> . <br>  <code>&gt;&gt;=</code> ,    <code>std::future</code>   <code>then</code> .     ,       <code>A</code> ,   <code><code><code>future.     ,        ,   future    ,   then</code> ,   . <br>     <code>unwrap</code>      <code><code><code>future&lt;future&gt;  future.   join</code>  <code>Control.Monad</code>  . <br> <br>  <code>then</code>     : <code class="cpp">future&lt;int&gt; f(shared_ptr&lt;stream&gt; str) { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;read(512, buf).then([](future&lt;int&gt; op) { return op.get() + 11; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; return f(s).then([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = await str.read(512, buf); return count + 11; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = await f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code>await</code> ‚Äì     ( <code>&lt;-</code> )  <code>do</code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      await</code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code>await</code> . ,   <code>await</code>    <code>then</code>       ,    <code>await</code> .    <code>resumable</code>     <code>std::future</code> ,          <code>then</code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> <pre> <code class="hljs coffeescript"><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">       ma,    f    f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb)</span></span></span><span class="hljs-function"> { return Ma &gt;&gt;= [=]</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A)</span></span></span><span class="hljs-function">{ return mb; }; }</span></span></code><span class="hljs-function"><span class="hljs-function">     &gt;&gt;= ,        .       </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</span></span></span></span></code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">,     Haskell  C++. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A&gt; Monad &lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A a)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">  return    C++,      mreturn.     ,     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">       . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">fail</span></span></code><span class="hljs-function"><span class="hljs-function">    ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,        C++,    -        .         - </span></span><code><span class="hljs-function"><span class="hljs-function">Maybe</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   .,     </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .      C++11.   </span></span><code><code><span class="hljs-function"><span class="hljs-function">future       T</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     .   , ,   -   ,      ,   ,  ,      .    </span></span><code><span class="hljs-function"><span class="hljs-function">future</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">get</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;class T&gt; class future { public: ... T get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //  get         ... };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   C++11    ‚Äì </span></span><code><span class="hljs-function"><span class="hljs-function">std::async</span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,           </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .       : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; result = async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">; //  -      f int a = result.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //    f    .</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(const A&amp; a)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([=]{ </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a; })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">  ,       future      ,   .     ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(ma.get()).get(); })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    ,         ma,       f,         f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,      .    3 ,     : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     C++, : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(a) &gt;&gt;= f)</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(mreturn(a).get()).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,  </span></span><code><span class="hljs-function"><span class="hljs-function"></span></span></code><span class="hljs-function"><span class="hljs-function"> .     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     . , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(a).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,  ,     </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function"> ,        .   ,   </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function">  ,      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(   )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">m &gt;&gt;= mreturn == m</span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mreturn(m.get()).get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> m.get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">  ,     m.    ,        m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    .    -     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">function&lt;future&lt;int&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int)</span></span></span><span class="hljs-function">&gt; f = []</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int a)</span></span></span><span class="hljs-function">{ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">; }; int a = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">) &gt;&gt;= f)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; cout &lt;&lt; a;</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    5  11. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  C++11      mreturn  &gt;&gt;=.      : </span></span><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf"><span class="hljs-function"><span class="hljs-function">n3721</span></span></a><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">make_ready_future</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function"> ,    </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function"> .     ,       </span></span><code><span class="hljs-function"><span class="hljs-function">A</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future.     ,        ,   future    ,   then</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   . </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-function">unwrap</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future&lt;future&gt;  future.   join</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">Control.Monad</span></span></code><span class="hljs-function"><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function">     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(shared_ptr&lt;stream&gt; str)</span></span></span><span class="hljs-function"> { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;</span></span>read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([](future&lt;int&gt; op) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> op.get() + <span class="hljs-number"><span class="hljs-number">11</span></span>; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(s).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> str.read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count + <span class="hljs-number"><span class="hljs-number">11</span></span>; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> ‚Äì     ( <code>&lt;-</code> )  <code><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      <span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> . ,   <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>    <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>       ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> .    <code>resumable</code>     <code>std::future</code> ,          <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> </pre> <code><code><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f) { ... //     }</code>       ma,    f    f. <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb) { return Ma &gt;&gt;= [=](A){ return mb; }; }</code>     &gt;&gt;= ,        .       ( <code>m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</code> ),     Haskell  C++. <br> <br> <code class="cpp">template&lt;typename A&gt; Monad &lt;A&gt; mreturn(A a) { ... //     }</code>  return    C++,      mreturn.     ,     <code>a</code>       . <br>  <code>fail</code>    ,        . <br> <br> ,        C++,    -        .         - <code>Maybe</code> ,   .,     <code>std::future</code> .      C++11.   <code>future       T</code> ,     .   , ,   -   ,      ,   ,  ,      .    <code>future</code>      <code>get</code> . <br> <code class="cpp">template&lt;class T&gt; class future { public: ... T get(); //  get         ... };</code> <br>   C++11    ‚Äì <code>std::async</code> .      ,           <code>std::future</code> .       : <code class="cpp">future&lt;int&gt; result = async(f); //  -      f int a = result.get(); //    f    .</code> <br>        <code>mreturn</code>  <code>&gt;&gt;=</code>   <code>std::future</code> <code class="cpp">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn(const A&amp; a) { return async([=]{ return a; }); }</code>  ,       future      ,   .     ,    . <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f) { return async([&amp;] () -&gt; B { return f(ma.get()).get(); }); }</code>   ,    ,         ma,       f,         f. <br> <br>  ,      .    3 ,     : <code class="haskell">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: (m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code> <br>     C++, : <br> <code class="cpp">(mreturn(a) &gt;&gt;= f) == f(a)</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(mreturn(a).get()).get(); }) == f(a)</code> ,  <code>mreturn(a).get()</code>   ,  <code></code> .     <code>a</code>  <code>std::future</code> ,     . , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(a).get(); }) == f(a)</code>  ,  ,     <code>f</code> ,        .   ,   <code>f</code>  ,      (   ). <br> <br>  : <code class="haskell">m &gt;&gt;= mreturn == m</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return mreturn(m.get()).get(); }) == m</code>      <code>mreturn(x).get()</code> , : <br> <code class="cpp">async([&amp;] () -&gt; B { return m.get(); }) == m</code>  ,     m.    ,        m. <br> <br>  : <code class="haskell">(m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code>       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. <br> <br>    .    -     : <code class="cpp">function&lt;future&lt;int&gt; (int)&gt; f = [](int a){ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn(a + 6); }; int a = (mreturn(5) &gt;&gt;= f).get(); cout &lt;&lt; a;</code>   ,    5  11. <br> <br>  C++11      mreturn  &gt;&gt;=.      : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf">n3721</a> <br>  <code>mreturn</code>  <code>make_ready_future</code> . <br>  <code>&gt;&gt;=</code> ,    <code>std::future</code>   <code>then</code> .     ,       <code>A</code> ,   <code><code><code>future.     ,        ,   future    ,   then</code> ,   . <br>     <code>unwrap</code>      <code><code><code>future&lt;future&gt;  future.   join</code>  <code>Control.Monad</code>  . <br> <br>  <code>then</code>     : <code class="cpp">future&lt;int&gt; f(shared_ptr&lt;stream&gt; str) { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;read(512, buf).then([](future&lt;int&gt; op) { return op.get() + 11; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; return f(s).then([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = await str.read(512, buf); return count + 11; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = await f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code>await</code> ‚Äì     ( <code>&lt;-</code> )  <code>do</code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      await</code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code>await</code> . ,   <code>await</code>    <code>then</code>       ,    <code>await</code> .    <code>resumable</code>     <code>std::future</code> ,          <code>then</code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> <pre> <code class="hljs coffeescript"><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">       ma,    f    f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb)</span></span></span><span class="hljs-function"> { return Ma &gt;&gt;= [=]</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A)</span></span></span><span class="hljs-function">{ return mb; }; }</span></span></code><span class="hljs-function"><span class="hljs-function">     &gt;&gt;= ,        .       </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</span></span></span></span></code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">,     Haskell  C++. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A&gt; Monad &lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A a)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">  return    C++,      mreturn.     ,     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">       . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">fail</span></span></code><span class="hljs-function"><span class="hljs-function">    ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,        C++,    -        .         - </span></span><code><span class="hljs-function"><span class="hljs-function">Maybe</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   .,     </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .      C++11.   </span></span><code><code><span class="hljs-function"><span class="hljs-function">future       T</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     .   , ,   -   ,      ,   ,  ,      .    </span></span><code><span class="hljs-function"><span class="hljs-function">future</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">get</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;class T&gt; class future { public: ... T get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //  get         ... };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   C++11    ‚Äì </span></span><code><span class="hljs-function"><span class="hljs-function">std::async</span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,           </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .       : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; result = async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">; //  -      f int a = result.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //    f    .</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(const A&amp; a)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([=]{ </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a; })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">  ,       future      ,   .     ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(ma.get()).get(); })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    ,         ma,       f,         f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,      .    3 ,     : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     C++, : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(a) &gt;&gt;= f)</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(mreturn(a).get()).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,  </span></span><code><span class="hljs-function"><span class="hljs-function"></span></span></code><span class="hljs-function"><span class="hljs-function"> .     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     . , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(a).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,  ,     </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function"> ,        .   ,   </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function">  ,      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(   )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">m &gt;&gt;= mreturn == m</span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mreturn(m.get()).get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> m.get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">  ,     m.    ,        m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    .    -     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">function&lt;future&lt;int&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int)</span></span></span><span class="hljs-function">&gt; f = []</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int a)</span></span></span><span class="hljs-function">{ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">; }; int a = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">) &gt;&gt;= f)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; cout &lt;&lt; a;</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    5  11. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  C++11      mreturn  &gt;&gt;=.      : </span></span><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf"><span class="hljs-function"><span class="hljs-function">n3721</span></span></a><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">make_ready_future</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function"> ,    </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function"> .     ,       </span></span><code><span class="hljs-function"><span class="hljs-function">A</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future.     ,        ,   future    ,   then</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   . </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-function">unwrap</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future&lt;future&gt;  future.   join</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">Control.Monad</span></span></code><span class="hljs-function"><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function">     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(shared_ptr&lt;stream&gt; str)</span></span></span><span class="hljs-function"> { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;</span></span>read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([](future&lt;int&gt; op) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> op.get() + <span class="hljs-number"><span class="hljs-number">11</span></span>; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(s).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> str.read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count + <span class="hljs-number"><span class="hljs-number">11</span></span>; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> ‚Äì     ( <code>&lt;-</code> )  <code><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      <span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> . ,   <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>    <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>       ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> .    <code>resumable</code>     <code>std::future</code> ,          <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> </pre> <code><code><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f) { ... //     }</code>       ma,    f    f. <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb) { return Ma &gt;&gt;= [=](A){ return mb; }; }</code>     &gt;&gt;= ,        .       ( <code>m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</code> ),     Haskell  C++. <br> <br> <code class="cpp">template&lt;typename A&gt; Monad &lt;A&gt; mreturn(A a) { ... //     }</code>  return    C++,      mreturn.     ,     <code>a</code>       . <br>  <code>fail</code>    ,        . <br> <br> ,        C++,    -        .         - <code>Maybe</code> ,   .,     <code>std::future</code> .      C++11.   <code>future       T</code> ,     .   , ,   -   ,      ,   ,  ,      .    <code>future</code>      <code>get</code> . <br> <code class="cpp">template&lt;class T&gt; class future { public: ... T get(); //  get         ... };</code> <br>   C++11    ‚Äì <code>std::async</code> .      ,           <code>std::future</code> .       : <code class="cpp">future&lt;int&gt; result = async(f); //  -      f int a = result.get(); //    f    .</code> <br>        <code>mreturn</code>  <code>&gt;&gt;=</code>   <code>std::future</code> <code class="cpp">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn(const A&amp; a) { return async([=]{ return a; }); }</code>  ,       future      ,   .     ,    . <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f) { return async([&amp;] () -&gt; B { return f(ma.get()).get(); }); }</code>   ,    ,         ma,       f,         f. <br> <br>  ,      .    3 ,     : <code class="haskell">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: (m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code> <br>     C++, : <br> <code class="cpp">(mreturn(a) &gt;&gt;= f) == f(a)</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(mreturn(a).get()).get(); }) == f(a)</code> ,  <code>mreturn(a).get()</code>   ,  <code></code> .     <code>a</code>  <code>std::future</code> ,     . , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(a).get(); }) == f(a)</code>  ,  ,     <code>f</code> ,        .   ,   <code>f</code>  ,      (   ). <br> <br>  : <code class="haskell">m &gt;&gt;= mreturn == m</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return mreturn(m.get()).get(); }) == m</code>      <code>mreturn(x).get()</code> , : <br> <code class="cpp">async([&amp;] () -&gt; B { return m.get(); }) == m</code>  ,     m.    ,        m. <br> <br>  : <code class="haskell">(m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code>       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. <br> <br>    .    -     : <code class="cpp">function&lt;future&lt;int&gt; (int)&gt; f = [](int a){ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn(a + 6); }; int a = (mreturn(5) &gt;&gt;= f).get(); cout &lt;&lt; a;</code>   ,    5  11. <br> <br>  C++11      mreturn  &gt;&gt;=.      : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf">n3721</a> <br>  <code>mreturn</code>  <code>make_ready_future</code> . <br>  <code>&gt;&gt;=</code> ,    <code>std::future</code>   <code>then</code> .     ,       <code>A</code> ,   <code><code><code>future.     ,        ,   future    ,   then</code> ,   . <br>     <code>unwrap</code>      <code><code><code>future&lt;future&gt;  future.   join</code>  <code>Control.Monad</code>  . <br> <br>  <code>then</code>     : <code class="cpp">future&lt;int&gt; f(shared_ptr&lt;stream&gt; str) { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;read(512, buf).then([](future&lt;int&gt; op) { return op.get() + 11; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; return f(s).then([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = await str.read(512, buf); return count + 11; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = await f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code>await</code> ‚Äì     ( <code>&lt;-</code> )  <code>do</code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      await</code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code>await</code> . ,   <code>await</code>    <code>then</code>       ,    <code>await</code> .    <code>resumable</code>     <code>std::future</code> ,          <code>then</code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> <pre> <code class="hljs coffeescript"><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">       ma,    f    f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb)</span></span></span><span class="hljs-function"> { return Ma &gt;&gt;= [=]</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A)</span></span></span><span class="hljs-function">{ return mb; }; }</span></span></code><span class="hljs-function"><span class="hljs-function">     &gt;&gt;= ,        .       </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</span></span></span></span></code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">,     Haskell  C++. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A&gt; Monad &lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A a)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">  return    C++,      mreturn.     ,     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">       . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">fail</span></span></code><span class="hljs-function"><span class="hljs-function">    ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,        C++,    -        .         - </span></span><code><span class="hljs-function"><span class="hljs-function">Maybe</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   .,     </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .      C++11.   </span></span><code><code><span class="hljs-function"><span class="hljs-function">future       T</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     .   , ,   -   ,      ,   ,  ,      .    </span></span><code><span class="hljs-function"><span class="hljs-function">future</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">get</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;class T&gt; class future { public: ... T get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //  get         ... };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   C++11    ‚Äì </span></span><code><span class="hljs-function"><span class="hljs-function">std::async</span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,           </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .       : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; result = async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">; //  -      f int a = result.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //    f    .</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(const A&amp; a)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([=]{ </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a; })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">  ,       future      ,   .     ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(ma.get()).get(); })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    ,         ma,       f,         f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,      .    3 ,     : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     C++, : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(a) &gt;&gt;= f)</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(mreturn(a).get()).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,  </span></span><code><span class="hljs-function"><span class="hljs-function"></span></span></code><span class="hljs-function"><span class="hljs-function"> .     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     . , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(a).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,  ,     </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function"> ,        .   ,   </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function">  ,      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(   )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">m &gt;&gt;= mreturn == m</span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mreturn(m.get()).get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> m.get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">  ,     m.    ,        m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    .    -     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">function&lt;future&lt;int&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int)</span></span></span><span class="hljs-function">&gt; f = []</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int a)</span></span></span><span class="hljs-function">{ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">; }; int a = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">) &gt;&gt;= f)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; cout &lt;&lt; a;</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    5  11. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  C++11      mreturn  &gt;&gt;=.      : </span></span><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf"><span class="hljs-function"><span class="hljs-function">n3721</span></span></a><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">make_ready_future</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function"> ,    </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function"> .     ,       </span></span><code><span class="hljs-function"><span class="hljs-function">A</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future.     ,        ,   future    ,   then</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   . </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-function">unwrap</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future&lt;future&gt;  future.   join</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">Control.Monad</span></span></code><span class="hljs-function"><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function">     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(shared_ptr&lt;stream&gt; str)</span></span></span><span class="hljs-function"> { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;</span></span>read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([](future&lt;int&gt; op) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> op.get() + <span class="hljs-number"><span class="hljs-number">11</span></span>; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(s).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> str.read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count + <span class="hljs-number"><span class="hljs-number">11</span></span>; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> ‚Äì     ( <code>&lt;-</code> )  <code><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      <span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> . ,   <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>    <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>       ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> .    <code>resumable</code>     <code>std::future</code> ,          <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> </pre> <code><code><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f) { ... //     }</code>       ma,    f    f. <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb) { return Ma &gt;&gt;= [=](A){ return mb; }; }</code>     &gt;&gt;= ,        .       ( <code>m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</code> ),     Haskell  C++. <br> <br> <code class="cpp">template&lt;typename A&gt; Monad &lt;A&gt; mreturn(A a) { ... //     }</code>  return    C++,      mreturn.     ,     <code>a</code>       . <br>  <code>fail</code>    ,        . <br> <br> ,        C++,    -        .         - <code>Maybe</code> ,   .,     <code>std::future</code> .      C++11.   <code>future       T</code> ,     .   , ,   -   ,      ,   ,  ,      .    <code>future</code>      <code>get</code> . <br> <code class="cpp">template&lt;class T&gt; class future { public: ... T get(); //  get         ... };</code> <br>   C++11    ‚Äì <code>std::async</code> .      ,           <code>std::future</code> .       : <code class="cpp">future&lt;int&gt; result = async(f); //  -      f int a = result.get(); //    f    .</code> <br>        <code>mreturn</code>  <code>&gt;&gt;=</code>   <code>std::future</code> <code class="cpp">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn(const A&amp; a) { return async([=]{ return a; }); }</code>  ,       future      ,   .     ,    . <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f) { return async([&amp;] () -&gt; B { return f(ma.get()).get(); }); }</code>   ,    ,         ma,       f,         f. <br> <br>  ,      .    3 ,     : <code class="haskell">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: (m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code> <br>     C++, : <br> <code class="cpp">(mreturn(a) &gt;&gt;= f) == f(a)</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(mreturn(a).get()).get(); }) == f(a)</code> ,  <code>mreturn(a).get()</code>   ,  <code></code> .     <code>a</code>  <code>std::future</code> ,     . , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(a).get(); }) == f(a)</code>  ,  ,     <code>f</code> ,        .   ,   <code>f</code>  ,      (   ). <br> <br>  : <code class="haskell">m &gt;&gt;= mreturn == m</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return mreturn(m.get()).get(); }) == m</code>      <code>mreturn(x).get()</code> , : <br> <code class="cpp">async([&amp;] () -&gt; B { return m.get(); }) == m</code>  ,     m.    ,        m. <br> <br>  : <code class="haskell">(m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code>       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. <br> <br>    .    -     : <code class="cpp">function&lt;future&lt;int&gt; (int)&gt; f = [](int a){ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn(a + 6); }; int a = (mreturn(5) &gt;&gt;= f).get(); cout &lt;&lt; a;</code>   ,    5  11. <br> <br>  C++11      mreturn  &gt;&gt;=.      : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf">n3721</a> <br>  <code>mreturn</code>  <code>make_ready_future</code> . <br>  <code>&gt;&gt;=</code> ,    <code>std::future</code>   <code>then</code> .     ,       <code>A</code> ,   <code><code><code>future.     ,        ,   future    ,   then</code> ,   . <br>     <code>unwrap</code>      <code><code><code>future&lt;future&gt;  future.   join</code>  <code>Control.Monad</code>  . <br> <br>  <code>then</code>     : <code class="cpp">future&lt;int&gt; f(shared_ptr&lt;stream&gt; str) { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;read(512, buf).then([](future&lt;int&gt; op) { return op.get() + 11; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; return f(s).then([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = await str.read(512, buf); return count + 11; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = await f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code>await</code> ‚Äì     ( <code>&lt;-</code> )  <code>do</code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      await</code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code>await</code> . ,   <code>await</code>    <code>then</code>       ,    <code>await</code> .    <code>resumable</code>     <code>std::future</code> ,          <code>then</code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> <pre> <code class="hljs coffeescript"><code><code class="cpp"><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">       ma,    f    f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb)</span></span></span><span class="hljs-function"> { return Ma &gt;&gt;= [=]</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A)</span></span></span><span class="hljs-function">{ return mb; }; }</span></span></code><span class="hljs-function"><span class="hljs-function">     &gt;&gt;= ,        .       </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</span></span></span></span></code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">,     Haskell  C++. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A&gt; Monad &lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A a)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">  return    C++,      mreturn.     ,     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">       . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">fail</span></span></code><span class="hljs-function"><span class="hljs-function">    ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,        C++,    -        .         - </span></span><code><span class="hljs-function"><span class="hljs-function">Maybe</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   .,     </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .      C++11.   </span></span><code><span class="hljs-function"><span class="hljs-function">future       T</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     .   , ,   -   ,      ,   ,  ,      .    </span></span><code><span class="hljs-function"><span class="hljs-function">future</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">get</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;class T&gt; class future { public: ... T get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //  get         ... };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   C++11    ‚Äì </span></span><code><span class="hljs-function"><span class="hljs-function">std::async</span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,           </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .       : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; result = async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">; //  -      f int a = result.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //    f    .</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(const A&amp; a)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([=]{ </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a; })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">  ,       future      ,   .     ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(ma.get()).get(); })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    ,         ma,       f,         f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,      .    3 ,     : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     C++, : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(a) &gt;&gt;= f)</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(mreturn(a).get()).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,  </span></span><code><span class="hljs-function"><span class="hljs-function"></span></span></code><span class="hljs-function"><span class="hljs-function"> .     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     . , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(a).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,  ,     </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function"> ,        .   ,   </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function">  ,      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(   )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">m &gt;&gt;= mreturn == m</span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mreturn(m.get()).get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> m.get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">  ,     m.    ,        m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    .    -     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">function&lt;future&lt;int&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int)</span></span></span><span class="hljs-function">&gt; f = []</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int a)</span></span></span><span class="hljs-function">{ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">; }; int a = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">) &gt;&gt;= f)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; cout &lt;&lt; a;</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    5  11. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  C++11      mreturn  &gt;&gt;=.      : </span></span><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf"><span class="hljs-function"><span class="hljs-function">n3721</span></span></a><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">make_ready_future</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function"> ,    </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function"> .     ,       </span></span><code><span class="hljs-function"><span class="hljs-function">A</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future.     ,        ,   future    ,   then</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   . </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-function">unwrap</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future&lt;future&gt;  future.   join</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">Control.Monad</span></span></code><span class="hljs-function"><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function">     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(shared_ptr&lt;stream&gt; str)</span></span></span><span class="hljs-function"> { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;</span></span>read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([](future&lt;int&gt; op) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> op.get() + <span class="hljs-number"><span class="hljs-number">11</span></span>; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(s).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> str.read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count + <span class="hljs-number"><span class="hljs-number">11</span></span>; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> ‚Äì     ( <code>&lt;-</code> )  <code><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      <span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> . ,   <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>    <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>       ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> .    <code>resumable</code>     <code>std::future</code> ,          <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code></code> </pre> <code><code><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f) { ... //     }</code>       ma,    f    f. <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb) { return Ma &gt;&gt;= [=](A){ return mb; }; }</code>     &gt;&gt;= ,        .       ( <code>m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</code> ),     Haskell  C++. <br> <br> <code class="cpp">template&lt;typename A&gt; Monad &lt;A&gt; mreturn(A a) { ... //     }</code>  return    C++,      mreturn.     ,     <code>a</code>       . <br>  <code>fail</code>    ,        . <br> <br> ,        C++,    -        .         - <code>Maybe</code> ,   .,     <code>std::future</code> .      C++11.   <code>future       T</code> ,     .   , ,   -   ,      ,   ,  ,      .    <code>future</code>      <code>get</code> . <br> <code class="cpp">template&lt;class T&gt; class future { public: ... T get(); //  get         ... };</code> <br>   C++11    ‚Äì <code>std::async</code> .      ,           <code>std::future</code> .       : <code class="cpp">future&lt;int&gt; result = async(f); //  -      f int a = result.get(); //    f    .</code> <br>        <code>mreturn</code>  <code>&gt;&gt;=</code>   <code>std::future</code> <code class="cpp">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn(const A&amp; a) { return async([=]{ return a; }); }</code>  ,       future      ,   .     ,    . <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f) { return async([&amp;] () -&gt; B { return f(ma.get()).get(); }); }</code>   ,    ,         ma,       f,         f. <br> <br>  ,      .    3 ,     : <code class="haskell">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: (m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code> <br>     C++, : <br> <code class="cpp">(mreturn(a) &gt;&gt;= f) == f(a)</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(mreturn(a).get()).get(); }) == f(a)</code> ,  <code>mreturn(a).get()</code>   ,  <code></code> .     <code>a</code>  <code>std::future</code> ,     . , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(a).get(); }) == f(a)</code>  ,  ,     <code>f</code> ,        .   ,   <code>f</code>  ,      (   ). <br> <br>  : <code class="haskell">m &gt;&gt;= mreturn == m</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return mreturn(m.get()).get(); }) == m</code>      <code>mreturn(x).get()</code> , : <br> <code class="cpp">async([&amp;] () -&gt; B { return m.get(); }) == m</code>  ,     m.    ,        m. <br> <br>  : <code class="haskell">(m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code>       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. <br> <br>    .    -     : <code class="cpp">function&lt;future&lt;int&gt; (int)&gt; f = [](int a){ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn(a + 6); }; int a = (mreturn(5) &gt;&gt;= f).get(); cout &lt;&lt; a;</code>   ,    5  11. <br> <br>  C++11      mreturn  &gt;&gt;=.      : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf">n3721</a> <br>  <code>mreturn</code>  <code>make_ready_future</code> . <br>  <code>&gt;&gt;=</code> ,    <code>std::future</code>   <code>then</code> .     ,       <code>A</code> ,   <code><code><code>future.     ,        ,   future    ,   then</code> ,   . <br>     <code>unwrap</code>      <code><code><code>future&lt;future&gt;  future.   join</code>  <code>Control.Monad</code>  . <br> <br>  <code>then</code>     : <code class="cpp">future&lt;int&gt; f(shared_ptr&lt;stream&gt; str) { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;read(512, buf).then([](future&lt;int&gt; op) { return op.get() + 11; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; return f(s).then([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = await str.read(512, buf); return count + 11; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = await f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code>await</code> ‚Äì     ( <code>&lt;-</code> )  <code>do</code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      await</code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code>await</code> . ,   <code>await</code>    <code>then</code>       ,    <code>await</code> .    <code>resumable</code>     <code>std::future</code> ,          <code>then</code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> <pre> <code class="hljs coffeescript"><code><code class="cpp"><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">       ma,    f    f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb)</span></span></span><span class="hljs-function"> { return Ma &gt;&gt;= [=]</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A)</span></span></span><span class="hljs-function">{ return mb; }; }</span></span></code><span class="hljs-function"><span class="hljs-function">     &gt;&gt;= ,        .       </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</span></span></span></span></code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">,     Haskell  C++. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A&gt; Monad &lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A a)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">  return    C++,      mreturn.     ,     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">       . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">fail</span></span></code><span class="hljs-function"><span class="hljs-function">    ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,        C++,    -        .         - </span></span><code><span class="hljs-function"><span class="hljs-function">Maybe</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   .,     </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .      C++11.   </span></span><code><span class="hljs-function"><span class="hljs-function">future       T</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     .   , ,   -   ,      ,   ,  ,      .    </span></span><code><span class="hljs-function"><span class="hljs-function">future</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">get</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;class T&gt; class future { public: ... T get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //  get         ... };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   C++11    ‚Äì </span></span><code><span class="hljs-function"><span class="hljs-function">std::async</span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,           </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .       : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; result = async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">; //  -      f int a = result.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //    f    .</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(const A&amp; a)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([=]{ </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a; })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">  ,       future      ,   .     ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(ma.get()).get(); })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    ,         ma,       f,         f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,      .    3 ,     : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     C++, : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(a) &gt;&gt;= f)</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(mreturn(a).get()).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,  </span></span><code><span class="hljs-function"><span class="hljs-function"></span></span></code><span class="hljs-function"><span class="hljs-function"> .     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     . , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(a).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,  ,     </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function"> ,        .   ,   </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function">  ,      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(   )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">m &gt;&gt;= mreturn == m</span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mreturn(m.get()).get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> m.get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">  ,     m.    ,        m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    .    -     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">function&lt;future&lt;int&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int)</span></span></span><span class="hljs-function">&gt; f = []</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int a)</span></span></span><span class="hljs-function">{ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">; }; int a = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">) &gt;&gt;= f)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; cout &lt;&lt; a;</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    5  11. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  C++11      mreturn  &gt;&gt;=.      : </span></span><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf"><span class="hljs-function"><span class="hljs-function">n3721</span></span></a><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">make_ready_future</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function"> ,    </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function"> .     ,       </span></span><code><span class="hljs-function"><span class="hljs-function">A</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future.     ,        ,   future    ,   then</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   . </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-function">unwrap</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future&lt;future&gt;  future.   join</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">Control.Monad</span></span></code><span class="hljs-function"><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function">     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(shared_ptr&lt;stream&gt; str)</span></span></span><span class="hljs-function"> { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;</span></span>read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([](future&lt;int&gt; op) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> op.get() + <span class="hljs-number"><span class="hljs-number">11</span></span>; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(s).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> str.read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count + <span class="hljs-number"><span class="hljs-number">11</span></span>; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> ‚Äì     ( <code>&lt;-</code> )  <code><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      <span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> . ,   <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>    <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>       ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> .    <code>resumable</code>     <code>std::future</code> ,          <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code></code> </pre> <code><code><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f) { ... //     }</code>       ma,    f    f. <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb) { return Ma &gt;&gt;= [=](A){ return mb; }; }</code>     &gt;&gt;= ,        .       ( <code>m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</code> ),     Haskell  C++. <br> <br> <code class="cpp">template&lt;typename A&gt; Monad &lt;A&gt; mreturn(A a) { ... //     }</code>  return    C++,      mreturn.     ,     <code>a</code>       . <br>  <code>fail</code>    ,        . <br> <br> ,        C++,    -        .         - <code>Maybe</code> ,   .,     <code>std::future</code> .      C++11.   <code>future       T</code> ,     .   , ,   -   ,      ,   ,  ,      .    <code>future</code>      <code>get</code> . <br> <code class="cpp">template&lt;class T&gt; class future { public: ... T get(); //  get         ... };</code> <br>   C++11    ‚Äì <code>std::async</code> .      ,           <code>std::future</code> .       : <code class="cpp">future&lt;int&gt; result = async(f); //  -      f int a = result.get(); //    f    .</code> <br>        <code>mreturn</code>  <code>&gt;&gt;=</code>   <code>std::future</code> <code class="cpp">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn(const A&amp; a) { return async([=]{ return a; }); }</code>  ,       future      ,   .     ,    . <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f) { return async([&amp;] () -&gt; B { return f(ma.get()).get(); }); }</code>   ,    ,         ma,       f,         f. <br> <br>  ,      .    3 ,     : <code class="haskell">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: (m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code> <br>     C++, : <br> <code class="cpp">(mreturn(a) &gt;&gt;= f) == f(a)</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(mreturn(a).get()).get(); }) == f(a)</code> ,  <code>mreturn(a).get()</code>   ,  <code></code> .     <code>a</code>  <code>std::future</code> ,     . , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(a).get(); }) == f(a)</code>  ,  ,     <code>f</code> ,        .   ,   <code>f</code>  ,      (   ). <br> <br>  : <code class="haskell">m &gt;&gt;= mreturn == m</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return mreturn(m.get()).get(); }) == m</code>      <code>mreturn(x).get()</code> , : <br> <code class="cpp">async([&amp;] () -&gt; B { return m.get(); }) == m</code>  ,     m.    ,        m. <br> <br>  : <code class="haskell">(m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code>       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. <br> <br>    .    -     : <code class="cpp">function&lt;future&lt;int&gt; (int)&gt; f = [](int a){ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn(a + 6); }; int a = (mreturn(5) &gt;&gt;= f).get(); cout &lt;&lt; a;</code>   ,    5  11. <br> <br>  C++11      mreturn  &gt;&gt;=.      : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf">n3721</a> <br>  <code>mreturn</code>  <code>make_ready_future</code> . <br>  <code>&gt;&gt;=</code> ,    <code>std::future</code>   <code>then</code> .     ,       <code>A</code> ,   <code><code><code>future.     ,        ,   future    ,   then</code> ,   . <br>     <code>unwrap</code>      <code><code><code>future&lt;future&gt;  future.   join</code>  <code>Control.Monad</code>  . <br> <br>  <code>then</code>     : <code class="cpp">future&lt;int&gt; f(shared_ptr&lt;stream&gt; str) { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;read(512, buf).then([](future&lt;int&gt; op) { return op.get() + 11; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; return f(s).then([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = await str.read(512, buf); return count + 11; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = await f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code>await</code> ‚Äì     ( <code>&lt;-</code> )  <code>do</code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      await</code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code>await</code> . ,   <code>await</code>    <code>then</code>       ,    <code>await</code> .    <code>resumable</code>     <code>std::future</code> ,          <code>then</code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> <pre> <code class="hljs coffeescript"><code><code class="cpp"><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">       ma,    f    f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb)</span></span></span><span class="hljs-function"> { return Ma &gt;&gt;= [=]</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A)</span></span></span><span class="hljs-function">{ return mb; }; }</span></span></code><span class="hljs-function"><span class="hljs-function">     &gt;&gt;= ,        .       </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</span></span></span></span></code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">,     Haskell  C++. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A&gt; Monad &lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A a)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">  return    C++,      mreturn.     ,     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">       . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">fail</span></span></code><span class="hljs-function"><span class="hljs-function">    ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,        C++,    -        .         - </span></span><code><span class="hljs-function"><span class="hljs-function">Maybe</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   .,     </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .      C++11.   </span></span><code><span class="hljs-function"><span class="hljs-function">future       T</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     .   , ,   -   ,      ,   ,  ,      .    </span></span><code><span class="hljs-function"><span class="hljs-function">future</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">get</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;class T&gt; class future { public: ... T get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //  get         ... };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   C++11    ‚Äì </span></span><code><span class="hljs-function"><span class="hljs-function">std::async</span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,           </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .       : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; result = async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">; //  -      f int a = result.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //    f    .</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(const A&amp; a)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([=]{ </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a; })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">  ,       future      ,   .     ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(ma.get()).get(); })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    ,         ma,       f,         f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,      .    3 ,     : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     C++, : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(a) &gt;&gt;= f)</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(mreturn(a).get()).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,  </span></span><code><span class="hljs-function"><span class="hljs-function"></span></span></code><span class="hljs-function"><span class="hljs-function"> .     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     . , : </span></span><br><span class="hljs-function"><span class="hljs-function"> async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(a).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">  ,  ,     </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function"> ,        .   ,   </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function">  ,      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(   )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">m &gt;&gt;= mreturn == m</span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mreturn(m.get()).get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> m.get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">  ,     m.    ,        m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    .    -     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">function&lt;future&lt;int&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int)</span></span></span><span class="hljs-function">&gt; f = []</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int a)</span></span></span><span class="hljs-function">{ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">; }; int a = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">) &gt;&gt;= f)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; cout &lt;&lt; a;</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    5  11. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  C++11      mreturn  &gt;&gt;=.      : </span></span><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf"><span class="hljs-function"><span class="hljs-function">n3721</span></span></a><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">make_ready_future</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function"> ,    </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function"> .     ,       </span></span><code><span class="hljs-function"><span class="hljs-function">A</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future.     ,        ,   future    ,   then</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   . </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-function">unwrap</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future&lt;future&gt;  future.   join</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">Control.Monad</span></span></code><span class="hljs-function"><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function">     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(shared_ptr&lt;stream&gt; str)</span></span></span><span class="hljs-function"> { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;</span></span>read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([](future&lt;int&gt; op) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> op.get() + <span class="hljs-number"><span class="hljs-number">11</span></span>; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(s).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> str.read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count + <span class="hljs-number"><span class="hljs-number">11</span></span>; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> ‚Äì     ( <code>&lt;-</code> )  <code><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      <span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> . ,   <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>    <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>       ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> .    <code>resumable</code>     <code>std::future</code> ,          <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code></code> </pre> <code><code><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f) { ... //     }</code>       ma,    f    f. <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb) { return Ma &gt;&gt;= [=](A){ return mb; }; }</code>     &gt;&gt;= ,        .       ( <code>m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</code> ),     Haskell  C++. <br> <br> <code class="cpp">template&lt;typename A&gt; Monad &lt;A&gt; mreturn(A a) { ... //     }</code>  return    C++,      mreturn.     ,     <code>a</code>       . <br>  <code>fail</code>    ,        . <br> <br> ,        C++,    -        .         - <code>Maybe</code> ,   .,     <code>std::future</code> .      C++11.   <code>future       T</code> ,     .   , ,   -   ,      ,   ,  ,      .    <code>future</code>      <code>get</code> . <br> <code class="cpp">template&lt;class T&gt; class future { public: ... T get(); //  get         ... };</code> <br>   C++11    ‚Äì <code>std::async</code> .      ,           <code>std::future</code> .       : <code class="cpp">future&lt;int&gt; result = async(f); //  -      f int a = result.get(); //    f    .</code> <br>        <code>mreturn</code>  <code>&gt;&gt;=</code>   <code>std::future</code> <code class="cpp">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn(const A&amp; a) { return async([=]{ return a; }); }</code>  ,       future      ,   .     ,    . <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f) { return async([&amp;] () -&gt; B { return f(ma.get()).get(); }); }</code>   ,    ,         ma,       f,         f. <br> <br>  ,      .    3 ,     : <code class="haskell">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: (m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code> <br>     C++, : <br> <code class="cpp">(mreturn(a) &gt;&gt;= f) == f(a)</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(mreturn(a).get()).get(); }) == f(a)</code> ,  <code>mreturn(a).get()</code>   ,  <code></code> .     <code>a</code>  <code>std::future</code> ,     . , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(a).get(); }) == f(a)</code>  ,  ,     <code>f</code> ,        .   ,   <code>f</code>  ,      (   ). <br> <br>  : <code class="haskell">m &gt;&gt;= mreturn == m</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return mreturn(m.get()).get(); }) == m</code>      <code>mreturn(x).get()</code> , : <br> <code class="cpp">async([&amp;] () -&gt; B { return m.get(); }) == m</code>  ,     m.    ,        m. <br> <br>  : <code class="haskell">(m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code>       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. <br> <br>    .    -     : <code class="cpp">function&lt;future&lt;int&gt; (int)&gt; f = [](int a){ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn(a + 6); }; int a = (mreturn(5) &gt;&gt;= f).get(); cout &lt;&lt; a;</code>   ,    5  11. <br> <br>  C++11      mreturn  &gt;&gt;=.      : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf">n3721</a> <br>  <code>mreturn</code>  <code>make_ready_future</code> . <br>  <code>&gt;&gt;=</code> ,    <code>std::future</code>   <code>then</code> .     ,       <code>A</code> ,   <code><code><code>future.     ,        ,   future    ,   then</code> ,   . <br>     <code>unwrap</code>      <code><code><code>future&lt;future&gt;  future.   join</code>  <code>Control.Monad</code>  . <br> <br>  <code>then</code>     : <code class="cpp">future&lt;int&gt; f(shared_ptr&lt;stream&gt; str) { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;read(512, buf).then([](future&lt;int&gt; op) { return op.get() + 11; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; return f(s).then([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = await str.read(512, buf); return count + 11; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = await f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code>await</code> ‚Äì     ( <code>&lt;-</code> )  <code>do</code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      await</code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code>await</code> . ,   <code>await</code>    <code>then</code>       ,    <code>await</code> .    <code>resumable</code>     <code>std::future</code> ,          <code>then</code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> <pre> <code class="hljs coffeescript"><code><code class="haskell"><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">       ma,    f    f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb)</span></span></span><span class="hljs-function"> { return Ma &gt;&gt;= [=]</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A)</span></span></span><span class="hljs-function">{ return mb; }; }</span></span></code><span class="hljs-function"><span class="hljs-function">     &gt;&gt;= ,        .       </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</span></span></span></span></code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">,     Haskell  C++. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A&gt; Monad &lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A a)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">  return    C++,      mreturn.     ,     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">       . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">fail</span></span></code><span class="hljs-function"><span class="hljs-function">    ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,        C++,    -        .         - </span></span><code><span class="hljs-function"><span class="hljs-function">Maybe</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   .,     </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .      C++11.   </span></span><code><span class="hljs-function"><span class="hljs-function">future       T</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     .   , ,   -   ,      ,   ,  ,      .    </span></span><code><span class="hljs-function"><span class="hljs-function">future</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">get</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;class T&gt; class future { public: ... T get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //  get         ... };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   C++11    ‚Äì </span></span><code><span class="hljs-function"><span class="hljs-function">std::async</span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,           </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .       : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; result = async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">; //  -      f int a = result.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //    f    .</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(const A&amp; a)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([=]{ </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a; })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">  ,       future      ,   .     ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(ma.get()).get(); })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    ,         ma,       f,         f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,      .    3 ,     : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     C++, : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(a) &gt;&gt;= f)</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(mreturn(a).get()).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,  </span></span><code><span class="hljs-function"><span class="hljs-function"></span></span></code><span class="hljs-function"><span class="hljs-function"> .     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     . , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(a).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,  ,     </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function"> ,        .   ,   </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function">  ,      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(   )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : m &gt;&gt;= mreturn == m   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mreturn(m.get()).get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> m.get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">  ,     m.    ,        m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    .    -     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">function&lt;future&lt;int&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int)</span></span></span><span class="hljs-function">&gt; f = []</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int a)</span></span></span><span class="hljs-function">{ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">; }; int a = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">) &gt;&gt;= f)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; cout &lt;&lt; a;</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    5  11. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  C++11      mreturn  &gt;&gt;=.      : </span></span><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf"><span class="hljs-function"><span class="hljs-function">n3721</span></span></a><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">make_ready_future</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function"> ,    </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function"> .     ,       </span></span><code><span class="hljs-function"><span class="hljs-function">A</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future.     ,        ,   future    ,   then</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   . </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-function">unwrap</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future&lt;future&gt;  future.   join</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">Control.Monad</span></span></code><span class="hljs-function"><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function">     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(shared_ptr&lt;stream&gt; str)</span></span></span><span class="hljs-function"> { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;</span></span>read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([](future&lt;int&gt; op) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> op.get() + <span class="hljs-number"><span class="hljs-number">11</span></span>; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(s).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> str.read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count + <span class="hljs-number"><span class="hljs-number">11</span></span>; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> ‚Äì     ( <code>&lt;-</code> )  <code><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      <span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> . ,   <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>    <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>       ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> .    <code>resumable</code>     <code>std::future</code> ,          <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code></code> </pre> <code><code><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f) { ... //     }</code>       ma,    f    f. <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb) { return Ma &gt;&gt;= [=](A){ return mb; }; }</code>     &gt;&gt;= ,        .       ( <code>m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</code> ),     Haskell  C++. <br> <br> <code class="cpp">template&lt;typename A&gt; Monad &lt;A&gt; mreturn(A a) { ... //     }</code>  return    C++,      mreturn.     ,     <code>a</code>       . <br>  <code>fail</code>    ,        . <br> <br> ,        C++,    -        .         - <code>Maybe</code> ,   .,     <code>std::future</code> .      C++11.   <code>future       T</code> ,     .   , ,   -   ,      ,   ,  ,      .    <code>future</code>      <code>get</code> . <br> <code class="cpp">template&lt;class T&gt; class future { public: ... T get(); //  get         ... };</code> <br>   C++11    ‚Äì <code>std::async</code> .      ,           <code>std::future</code> .       : <code class="cpp">future&lt;int&gt; result = async(f); //  -      f int a = result.get(); //    f    .</code> <br>        <code>mreturn</code>  <code>&gt;&gt;=</code>   <code>std::future</code> <code class="cpp">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn(const A&amp; a) { return async([=]{ return a; }); }</code>  ,       future      ,   .     ,    . <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f) { return async([&amp;] () -&gt; B { return f(ma.get()).get(); }); }</code>   ,    ,         ma,       f,         f. <br> <br>  ,      .    3 ,     : <code class="haskell">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: (m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code> <br>     C++, : <br> <code class="cpp">(mreturn(a) &gt;&gt;= f) == f(a)</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(mreturn(a).get()).get(); }) == f(a)</code> ,  <code>mreturn(a).get()</code>   ,  <code></code> .     <code>a</code>  <code>std::future</code> ,     . , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(a).get(); }) == f(a)</code>  ,  ,     <code>f</code> ,        .   ,   <code>f</code>  ,      (   ). <br> <br>  : <code class="haskell">m &gt;&gt;= mreturn == m</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return mreturn(m.get()).get(); }) == m</code>      <code>mreturn(x).get()</code> , : <br> <code class="cpp">async([&amp;] () -&gt; B { return m.get(); }) == m</code>  ,     m.    ,        m. <br> <br>  : <code class="haskell">(m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code>       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. <br> <br>    .    -     : <code class="cpp">function&lt;future&lt;int&gt; (int)&gt; f = [](int a){ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn(a + 6); }; int a = (mreturn(5) &gt;&gt;= f).get(); cout &lt;&lt; a;</code>   ,    5  11. <br> <br>  C++11      mreturn  &gt;&gt;=.      : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf">n3721</a> <br>  <code>mreturn</code>  <code>make_ready_future</code> . <br>  <code>&gt;&gt;=</code> ,    <code>std::future</code>   <code>then</code> .     ,       <code>A</code> ,   <code><code><code>future.     ,        ,   future    ,   then</code> ,   . <br>     <code>unwrap</code>      <code><code><code>future&lt;future&gt;  future.   join</code>  <code>Control.Monad</code>  . <br> <br>  <code>then</code>     : <code class="cpp">future&lt;int&gt; f(shared_ptr&lt;stream&gt; str) { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;read(512, buf).then([](future&lt;int&gt; op) { return op.get() + 11; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; return f(s).then([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = await str.read(512, buf); return count + 11; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = await f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code>await</code> ‚Äì     ( <code>&lt;-</code> )  <code>do</code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      await</code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code>await</code> . ,   <code>await</code>    <code>then</code>       ,    <code>await</code> .    <code>resumable</code>     <code>std::future</code> ,          <code>then</code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> <pre> <code class="hljs coffeescript"><code><code class="cpp"><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">       ma,    f    f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb)</span></span></span><span class="hljs-function"> { return Ma &gt;&gt;= [=]</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A)</span></span></span><span class="hljs-function">{ return mb; }; }</span></span></code><span class="hljs-function"><span class="hljs-function">     &gt;&gt;= ,        .       </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</span></span></span></span></code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">,     Haskell  C++. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A&gt; Monad &lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A a)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">  return    C++,      mreturn.     ,     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">       . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">fail</span></span></code><span class="hljs-function"><span class="hljs-function">    ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,        C++,    -        .         - </span></span><code><span class="hljs-function"><span class="hljs-function">Maybe</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   .,     </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .      C++11.   </span></span><code><span class="hljs-function"><span class="hljs-function">future       T</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     .   , ,   -   ,      ,   ,  ,      .    </span></span><code><span class="hljs-function"><span class="hljs-function">future</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">get</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;class T&gt; class future { public: ... T get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //  get         ... };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   C++11    ‚Äì </span></span><code><span class="hljs-function"><span class="hljs-function">std::async</span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,           </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .       : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; result = async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">; //  -      f int a = result.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //    f    .</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(const A&amp; a)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([=]{ </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a; })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">  ,       future      ,   .     ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(ma.get()).get(); })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    ,         ma,       f,         f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,      .    3 ,     : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     C++, : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(a) &gt;&gt;= f)</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(mreturn(a).get()).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,  </span></span><code><span class="hljs-function"><span class="hljs-function"></span></span></code><span class="hljs-function"><span class="hljs-function"> .     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     . , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(a).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,  ,     </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function"> ,        .   ,   </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function">  ,      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(   )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">m &gt;&gt;= mreturn == m</span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mreturn(m.get()).get(); })</span></span></span><span class="hljs-function"> == m      </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> m.get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">  ,     m.    ,        m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    .    -     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">function&lt;future&lt;int&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int)</span></span></span><span class="hljs-function">&gt; f = []</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int a)</span></span></span><span class="hljs-function">{ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">; }; int a = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">) &gt;&gt;= f)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; cout &lt;&lt; a;</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    5  11. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  C++11      mreturn  &gt;&gt;=.      : </span></span><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf"><span class="hljs-function"><span class="hljs-function">n3721</span></span></a><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">make_ready_future</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function"> ,    </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function"> .     ,       </span></span><code><span class="hljs-function"><span class="hljs-function">A</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future.     ,        ,   future    ,   then</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   . </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-function">unwrap</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future&lt;future&gt;  future.   join</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">Control.Monad</span></span></code><span class="hljs-function"><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function">     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(shared_ptr&lt;stream&gt; str)</span></span></span><span class="hljs-function"> { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;</span></span>read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([](future&lt;int&gt; op) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> op.get() + <span class="hljs-number"><span class="hljs-number">11</span></span>; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(s).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> str.read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count + <span class="hljs-number"><span class="hljs-number">11</span></span>; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> ‚Äì     ( <code>&lt;-</code> )  <code><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      <span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> . ,   <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>    <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>       ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> .    <code>resumable</code>     <code>std::future</code> ,          <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code></code> </pre> <code><code><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f) { ... //     }</code>       ma,    f    f. <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb) { return Ma &gt;&gt;= [=](A){ return mb; }; }</code>     &gt;&gt;= ,        .       ( <code>m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</code> ),     Haskell  C++. <br> <br> <code class="cpp">template&lt;typename A&gt; Monad &lt;A&gt; mreturn(A a) { ... //     }</code>  return    C++,      mreturn.     ,     <code>a</code>       . <br>  <code>fail</code>    ,        . <br> <br> ,        C++,    -        .         - <code>Maybe</code> ,   .,     <code>std::future</code> .      C++11.   <code>future       T</code> ,     .   , ,   -   ,      ,   ,  ,      .    <code>future</code>      <code>get</code> . <br> <code class="cpp">template&lt;class T&gt; class future { public: ... T get(); //  get         ... };</code> <br>   C++11    ‚Äì <code>std::async</code> .      ,           <code>std::future</code> .       : <code class="cpp">future&lt;int&gt; result = async(f); //  -      f int a = result.get(); //    f    .</code> <br>        <code>mreturn</code>  <code>&gt;&gt;=</code>   <code>std::future</code> <code class="cpp">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn(const A&amp; a) { return async([=]{ return a; }); }</code>  ,       future      ,   .     ,    . <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f) { return async([&amp;] () -&gt; B { return f(ma.get()).get(); }); }</code>   ,    ,         ma,       f,         f. <br> <br>  ,      .    3 ,     : <code class="haskell">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: (m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code> <br>     C++, : <br> <code class="cpp">(mreturn(a) &gt;&gt;= f) == f(a)</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(mreturn(a).get()).get(); }) == f(a)</code> ,  <code>mreturn(a).get()</code>   ,  <code></code> .     <code>a</code>  <code>std::future</code> ,     . , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(a).get(); }) == f(a)</code>  ,  ,     <code>f</code> ,        .   ,   <code>f</code>  ,      (   ). <br> <br>  : <code class="haskell">m &gt;&gt;= mreturn == m</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return mreturn(m.get()).get(); }) == m</code>      <code>mreturn(x).get()</code> , : <br> <code class="cpp">async([&amp;] () -&gt; B { return m.get(); }) == m</code>  ,     m.    ,        m. <br> <br>  : <code class="haskell">(m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code>       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. <br> <br>    .    -     : <code class="cpp">function&lt;future&lt;int&gt; (int)&gt; f = [](int a){ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn(a + 6); }; int a = (mreturn(5) &gt;&gt;= f).get(); cout &lt;&lt; a;</code>   ,    5  11. <br> <br>  C++11      mreturn  &gt;&gt;=.      : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf">n3721</a> <br>  <code>mreturn</code>  <code>make_ready_future</code> . <br>  <code>&gt;&gt;=</code> ,    <code>std::future</code>   <code>then</code> .     ,       <code>A</code> ,   <code><code><code>future.     ,        ,   future    ,   then</code> ,   . <br>     <code>unwrap</code>      <code><code><code>future&lt;future&gt;  future.   join</code>  <code>Control.Monad</code>  . <br> <br>  <code>then</code>     : <code class="cpp">future&lt;int&gt; f(shared_ptr&lt;stream&gt; str) { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;read(512, buf).then([](future&lt;int&gt; op) { return op.get() + 11; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; return f(s).then([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = await str.read(512, buf); return count + 11; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = await f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code>await</code> ‚Äì     ( <code>&lt;-</code> )  <code>do</code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      await</code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code>await</code> . ,   <code>await</code>    <code>then</code>       ,    <code>await</code> .    <code>resumable</code>     <code>std::future</code> ,          <code>then</code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> <pre> <code class="hljs coffeescript"><code><code class="cpp"><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">       ma,    f    f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb)</span></span></span><span class="hljs-function"> { return Ma &gt;&gt;= [=]</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A)</span></span></span><span class="hljs-function">{ return mb; }; }</span></span></code><span class="hljs-function"><span class="hljs-function">     &gt;&gt;= ,        .       </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</span></span></span></span></code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">,     Haskell  C++. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A&gt; Monad &lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A a)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">  return    C++,      mreturn.     ,     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">       . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">fail</span></span></code><span class="hljs-function"><span class="hljs-function">    ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,        C++,    -        .         - </span></span><code><span class="hljs-function"><span class="hljs-function">Maybe</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   .,     </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .      C++11.   </span></span><code><span class="hljs-function"><span class="hljs-function">future       T</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     .   , ,   -   ,      ,   ,  ,      .    </span></span><code><span class="hljs-function"><span class="hljs-function">future</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">get</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;class T&gt; class future { public: ... T get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //  get         ... };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   C++11    ‚Äì </span></span><code><span class="hljs-function"><span class="hljs-function">std::async</span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,           </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .       : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; result = async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">; //  -      f int a = result.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //    f    .</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(const A&amp; a)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([=]{ </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a; })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">  ,       future      ,   .     ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(ma.get()).get(); })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    ,         ma,       f,         f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,      .    3 ,     : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     C++, : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(a) &gt;&gt;= f)</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(mreturn(a).get()).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,  </span></span><code><span class="hljs-function"><span class="hljs-function"></span></span></code><span class="hljs-function"><span class="hljs-function"> .     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     . , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(a).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,  ,     </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function"> ,        .   ,   </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function">  ,      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(   )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">m &gt;&gt;= mreturn == m</span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mreturn(m.get()).get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> , : </span></span><br><span class="hljs-function"><span class="hljs-function"> async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> m.get(); })</span></span></span><span class="hljs-function"> == m  ,     m.    ,        m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    .    -     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">function&lt;future&lt;int&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int)</span></span></span><span class="hljs-function">&gt; f = []</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int a)</span></span></span><span class="hljs-function">{ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">; }; int a = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">) &gt;&gt;= f)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; cout &lt;&lt; a;</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    5  11. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  C++11      mreturn  &gt;&gt;=.      : </span></span><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf"><span class="hljs-function"><span class="hljs-function">n3721</span></span></a><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">make_ready_future</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function"> ,    </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function"> .     ,       </span></span><code><span class="hljs-function"><span class="hljs-function">A</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future.     ,        ,   future    ,   then</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   . </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-function">unwrap</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future&lt;future&gt;  future.   join</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">Control.Monad</span></span></code><span class="hljs-function"><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function">     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(shared_ptr&lt;stream&gt; str)</span></span></span><span class="hljs-function"> { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;</span></span>read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([](future&lt;int&gt; op) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> op.get() + <span class="hljs-number"><span class="hljs-number">11</span></span>; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(s).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> str.read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count + <span class="hljs-number"><span class="hljs-number">11</span></span>; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> ‚Äì     ( <code>&lt;-</code> )  <code><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      <span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> . ,   <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>    <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>       ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> .    <code>resumable</code>     <code>std::future</code> ,          <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code></code> </pre> <code><code><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f) { ... //     }</code>       ma,    f    f. <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb) { return Ma &gt;&gt;= [=](A){ return mb; }; }</code>     &gt;&gt;= ,        .       ( <code>m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</code> ),     Haskell  C++. <br> <br> <code class="cpp">template&lt;typename A&gt; Monad &lt;A&gt; mreturn(A a) { ... //     }</code>  return    C++,      mreturn.     ,     <code>a</code>       . <br>  <code>fail</code>    ,        . <br> <br> ,        C++,    -        .         - <code>Maybe</code> ,   .,     <code>std::future</code> .      C++11.   <code>future       T</code> ,     .   , ,   -   ,      ,   ,  ,      .    <code>future</code>      <code>get</code> . <br> <code class="cpp">template&lt;class T&gt; class future { public: ... T get(); //  get         ... };</code> <br>   C++11    ‚Äì <code>std::async</code> .      ,           <code>std::future</code> .       : <code class="cpp">future&lt;int&gt; result = async(f); //  -      f int a = result.get(); //    f    .</code> <br>        <code>mreturn</code>  <code>&gt;&gt;=</code>   <code>std::future</code> <code class="cpp">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn(const A&amp; a) { return async([=]{ return a; }); }</code>  ,       future      ,   .     ,    . <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f) { return async([&amp;] () -&gt; B { return f(ma.get()).get(); }); }</code>   ,    ,         ma,       f,         f. <br> <br>  ,      .    3 ,     : <code class="haskell">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: (m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code> <br>     C++, : <br> <code class="cpp">(mreturn(a) &gt;&gt;= f) == f(a)</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(mreturn(a).get()).get(); }) == f(a)</code> ,  <code>mreturn(a).get()</code>   ,  <code></code> .     <code>a</code>  <code>std::future</code> ,     . , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(a).get(); }) == f(a)</code>  ,  ,     <code>f</code> ,        .   ,   <code>f</code>  ,      (   ). <br> <br>  : <code class="haskell">m &gt;&gt;= mreturn == m</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return mreturn(m.get()).get(); }) == m</code>      <code>mreturn(x).get()</code> , : <br> <code class="cpp">async([&amp;] () -&gt; B { return m.get(); }) == m</code>  ,     m.    ,        m. <br> <br>  : <code class="haskell">(m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code>       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. <br> <br>    .    -     : <code class="cpp">function&lt;future&lt;int&gt; (int)&gt; f = [](int a){ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn(a + 6); }; int a = (mreturn(5) &gt;&gt;= f).get(); cout &lt;&lt; a;</code>   ,    5  11. <br> <br>  C++11      mreturn  &gt;&gt;=.      : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf">n3721</a> <br>  <code>mreturn</code>  <code>make_ready_future</code> . <br>  <code>&gt;&gt;=</code> ,    <code>std::future</code>   <code>then</code> .     ,       <code>A</code> ,   <code><code><code>future.     ,        ,   future    ,   then</code> ,   . <br>     <code>unwrap</code>      <code><code><code>future&lt;future&gt;  future.   join</code>  <code>Control.Monad</code>  . <br> <br>  <code>then</code>     : <code class="cpp">future&lt;int&gt; f(shared_ptr&lt;stream&gt; str) { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;read(512, buf).then([](future&lt;int&gt; op) { return op.get() + 11; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; return f(s).then([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = await str.read(512, buf); return count + 11; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = await f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code>await</code> ‚Äì     ( <code>&lt;-</code> )  <code>do</code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      await</code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code>await</code> . ,   <code>await</code>    <code>then</code>       ,    <code>await</code> .    <code>resumable</code>     <code>std::future</code> ,          <code>then</code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> <pre> <code class="hljs coffeescript"><code><code class="haskell"><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">       ma,    f    f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb)</span></span></span><span class="hljs-function"> { return Ma &gt;&gt;= [=]</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A)</span></span></span><span class="hljs-function">{ return mb; }; }</span></span></code><span class="hljs-function"><span class="hljs-function">     &gt;&gt;= ,        .       </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</span></span></span></span></code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">,     Haskell  C++. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A&gt; Monad &lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A a)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">  return    C++,      mreturn.     ,     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">       . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">fail</span></span></code><span class="hljs-function"><span class="hljs-function">    ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,        C++,    -        .         - </span></span><code><span class="hljs-function"><span class="hljs-function">Maybe</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   .,     </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .      C++11.   </span></span><code><span class="hljs-function"><span class="hljs-function">future       T</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     .   , ,   -   ,      ,   ,  ,      .    </span></span><code><span class="hljs-function"><span class="hljs-function">future</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">get</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;class T&gt; class future { public: ... T get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //  get         ... };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   C++11    ‚Äì </span></span><code><span class="hljs-function"><span class="hljs-function">std::async</span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,           </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .       : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; result = async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">; //  -      f int a = result.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //    f    .</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(const A&amp; a)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([=]{ </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a; })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">  ,       future      ,   .     ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(ma.get()).get(); })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    ,         ma,       f,         f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,      .    3 ,     : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     C++, : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(a) &gt;&gt;= f)</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(mreturn(a).get()).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,  </span></span><code><span class="hljs-function"><span class="hljs-function"></span></span></code><span class="hljs-function"><span class="hljs-function"> .     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     . , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(a).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,  ,     </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function"> ,        .   ,   </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function">  ,      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(   )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">m &gt;&gt;= mreturn == m</span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mreturn(m.get()).get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> m.get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">  ,     m.    ,        m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span><span class="hljs-function">       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    .    -     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">function&lt;future&lt;int&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int)</span></span></span><span class="hljs-function">&gt; f = []</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int a)</span></span></span><span class="hljs-function">{ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">; }; int a = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">) &gt;&gt;= f)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; cout &lt;&lt; a;</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    5  11. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  C++11      mreturn  &gt;&gt;=.      : </span></span><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf"><span class="hljs-function"><span class="hljs-function">n3721</span></span></a><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">make_ready_future</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function"> ,    </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function"> .     ,       </span></span><code><span class="hljs-function"><span class="hljs-function">A</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future.     ,        ,   future    ,   then</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   . </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-function">unwrap</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future&lt;future&gt;  future.   join</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">Control.Monad</span></span></code><span class="hljs-function"><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function">     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(shared_ptr&lt;stream&gt; str)</span></span></span><span class="hljs-function"> { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;</span></span>read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([](future&lt;int&gt; op) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> op.get() + <span class="hljs-number"><span class="hljs-number">11</span></span>; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(s).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> str.read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count + <span class="hljs-number"><span class="hljs-number">11</span></span>; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> ‚Äì     ( <code>&lt;-</code> )  <code><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      <span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> . ,   <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>    <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>       ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> .    <code>resumable</code>     <code>std::future</code> ,          <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code></code> </pre> <code><code><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f) { ... //     }</code>       ma,    f    f. <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb) { return Ma &gt;&gt;= [=](A){ return mb; }; }</code>     &gt;&gt;= ,        .       ( <code>m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</code> ),     Haskell  C++. <br> <br> <code class="cpp">template&lt;typename A&gt; Monad &lt;A&gt; mreturn(A a) { ... //     }</code>  return    C++,      mreturn.     ,     <code>a</code>       . <br>  <code>fail</code>    ,        . <br> <br> ,        C++,    -        .         - <code>Maybe</code> ,   .,     <code>std::future</code> .      C++11.   <code>future       T</code> ,     .   , ,   -   ,      ,   ,  ,      .    <code>future</code>      <code>get</code> . <br> <code class="cpp">template&lt;class T&gt; class future { public: ... T get(); //  get         ... };</code> <br>   C++11    ‚Äì <code>std::async</code> .      ,           <code>std::future</code> .       : <code class="cpp">future&lt;int&gt; result = async(f); //  -      f int a = result.get(); //    f    .</code> <br>        <code>mreturn</code>  <code>&gt;&gt;=</code>   <code>std::future</code> <code class="cpp">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn(const A&amp; a) { return async([=]{ return a; }); }</code>  ,       future      ,   .     ,    . <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f) { return async([&amp;] () -&gt; B { return f(ma.get()).get(); }); }</code>   ,    ,         ma,       f,         f. <br> <br>  ,      .    3 ,     : <code class="haskell">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: (m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code> <br>     C++, : <br> <code class="cpp">(mreturn(a) &gt;&gt;= f) == f(a)</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(mreturn(a).get()).get(); }) == f(a)</code> ,  <code>mreturn(a).get()</code>   ,  <code></code> .     <code>a</code>  <code>std::future</code> ,     . , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(a).get(); }) == f(a)</code>  ,  ,     <code>f</code> ,        .   ,   <code>f</code>  ,      (   ). <br> <br>  : <code class="haskell">m &gt;&gt;= mreturn == m</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return mreturn(m.get()).get(); }) == m</code>      <code>mreturn(x).get()</code> , : <br> <code class="cpp">async([&amp;] () -&gt; B { return m.get(); }) == m</code>  ,     m.    ,        m. <br> <br>  : <code class="haskell">(m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code>       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. <br> <br>    .    -     : <code class="cpp">function&lt;future&lt;int&gt; (int)&gt; f = [](int a){ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn(a + 6); }; int a = (mreturn(5) &gt;&gt;= f).get(); cout &lt;&lt; a;</code>   ,    5  11. <br> <br>  C++11      mreturn  &gt;&gt;=.      : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf">n3721</a> <br>  <code>mreturn</code>  <code>make_ready_future</code> . <br>  <code>&gt;&gt;=</code> ,    <code>std::future</code>   <code>then</code> .     ,       <code>A</code> ,   <code><code><code>future.     ,        ,   future    ,   then</code> ,   . <br>     <code>unwrap</code>      <code><code><code>future&lt;future&gt;  future.   join</code>  <code>Control.Monad</code>  . <br> <br>  <code>then</code>     : <code class="cpp">future&lt;int&gt; f(shared_ptr&lt;stream&gt; str) { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;read(512, buf).then([](future&lt;int&gt; op) { return op.get() + 11; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; return f(s).then([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = await str.read(512, buf); return count + 11; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = await f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code>await</code> ‚Äì     ( <code>&lt;-</code> )  <code>do</code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      await</code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code>await</code> . ,   <code>await</code>    <code>then</code>       ,    <code>await</code> .    <code>resumable</code>     <code>std::future</code> ,          <code>then</code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> <pre> <code class="hljs coffeescript"><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">       ma,    f    f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb)</span></span></span><span class="hljs-function"> { return Ma &gt;&gt;= [=]</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A)</span></span></span><span class="hljs-function">{ return mb; }; }</span></span></code><span class="hljs-function"><span class="hljs-function">     &gt;&gt;= ,        .       </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</span></span></span></span></code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">,     Haskell  C++. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A&gt; Monad &lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A a)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">  return    C++,      mreturn.     ,     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">       . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">fail</span></span></code><span class="hljs-function"><span class="hljs-function">    ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,        C++,    -        .         - </span></span><code><span class="hljs-function"><span class="hljs-function">Maybe</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   .,     </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .      C++11.   </span></span><code><code><span class="hljs-function"><span class="hljs-function">future       T</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     .   , ,   -   ,      ,   ,  ,      .    </span></span><code><span class="hljs-function"><span class="hljs-function">future</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">get</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;class T&gt; class future { public: ... T get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //  get         ... };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   C++11    ‚Äì </span></span><code><span class="hljs-function"><span class="hljs-function">std::async</span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,           </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .       : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; result = async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">; //  -      f int a = result.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //    f    .</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(const A&amp; a)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([=]{ </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a; })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">  ,       future      ,   .     ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(ma.get()).get(); })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    ,         ma,       f,         f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,      .    3 ,     : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     C++, : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(a) &gt;&gt;= f)</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(mreturn(a).get()).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,  </span></span><code><span class="hljs-function"><span class="hljs-function"></span></span></code><span class="hljs-function"><span class="hljs-function"> .     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     . , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(a).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,  ,     </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function"> ,        .   ,   </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function">  ,      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(   )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">m &gt;&gt;= mreturn == m</span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mreturn(m.get()).get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> m.get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">  ,     m.    ,        m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    .    -     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">function&lt;future&lt;int&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int)</span></span></span><span class="hljs-function">&gt; f = []</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int a)</span></span></span><span class="hljs-function">{ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">; }; int a = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">) &gt;&gt;= f)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; cout &lt;&lt; a;</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    5  11. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  C++11      mreturn  &gt;&gt;=.      : </span></span><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf"><span class="hljs-function"><span class="hljs-function">n3721</span></span></a><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">make_ready_future</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function"> ,    </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function"> .     ,       </span></span><code><span class="hljs-function"><span class="hljs-function">A</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future.     ,        ,   future    ,   then</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   . </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-function">unwrap</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future&lt;future&gt;  future.   join</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">Control.Monad</span></span></code><span class="hljs-function"><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function">     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(shared_ptr&lt;stream&gt; str)</span></span></span><span class="hljs-function"> { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;</span></span>read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([](future&lt;int&gt; op) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> op.get() + <span class="hljs-number"><span class="hljs-number">11</span></span>; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(s).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> str.read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count + <span class="hljs-number"><span class="hljs-number">11</span></span>; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> ‚Äì     ( <code>&lt;-</code> )  <code><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      <span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> . ,   <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>    <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>       ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> .    <code>resumable</code>     <code>std::future</code> ,          <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> </pre> <code><code><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f) { ... //     }</code>       ma,    f    f. <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb) { return Ma &gt;&gt;= [=](A){ return mb; }; }</code>     &gt;&gt;= ,        .       ( <code>m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</code> ),     Haskell  C++. <br> <br> <code class="cpp">template&lt;typename A&gt; Monad &lt;A&gt; mreturn(A a) { ... //     }</code>  return    C++,      mreturn.     ,     <code>a</code>       . <br>  <code>fail</code>    ,        . <br> <br> ,        C++,    -        .         - <code>Maybe</code> ,   .,     <code>std::future</code> .      C++11.   <code>future       T</code> ,     .   , ,   -   ,      ,   ,  ,      .    <code>future</code>      <code>get</code> . <br> <code class="cpp">template&lt;class T&gt; class future { public: ... T get(); //  get         ... };</code> <br>   C++11    ‚Äì <code>std::async</code> .      ,           <code>std::future</code> .       : <code class="cpp">future&lt;int&gt; result = async(f); //  -      f int a = result.get(); //    f    .</code> <br>        <code>mreturn</code>  <code>&gt;&gt;=</code>   <code>std::future</code> <code class="cpp">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn(const A&amp; a) { return async([=]{ return a; }); }</code>  ,       future      ,   .     ,    . <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f) { return async([&amp;] () -&gt; B { return f(ma.get()).get(); }); }</code>   ,    ,         ma,       f,         f. <br> <br>  ,      .    3 ,     : <code class="haskell">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: (m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code> <br>     C++, : <br> <code class="cpp">(mreturn(a) &gt;&gt;= f) == f(a)</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(mreturn(a).get()).get(); }) == f(a)</code> ,  <code>mreturn(a).get()</code>   ,  <code></code> .     <code>a</code>  <code>std::future</code> ,     . , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(a).get(); }) == f(a)</code>  ,  ,     <code>f</code> ,        .   ,   <code>f</code>  ,      (   ). <br> <br>  : <code class="haskell">m &gt;&gt;= mreturn == m</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return mreturn(m.get()).get(); }) == m</code>      <code>mreturn(x).get()</code> , : <br> <code class="cpp">async([&amp;] () -&gt; B { return m.get(); }) == m</code>  ,     m.    ,        m. <br> <br>  : <code class="haskell">(m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code>       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. <br> <br>    .    -     : <code class="cpp">function&lt;future&lt;int&gt; (int)&gt; f = [](int a){ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn(a + 6); }; int a = (mreturn(5) &gt;&gt;= f).get(); cout &lt;&lt; a;</code>   ,    5  11. <br> <br>  C++11      mreturn  &gt;&gt;=.      : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf">n3721</a> <br>  <code>mreturn</code>  <code>make_ready_future</code> . <br>  <code>&gt;&gt;=</code> ,    <code>std::future</code>   <code>then</code> .     ,       <code>A</code> ,   <code><code><code>future.     ,        ,   future    ,   then</code> ,   . <br>     <code>unwrap</code>      <code><code><code>future&lt;future&gt;  future.   join</code>  <code>Control.Monad</code>  . <br> <br>  <code>then</code>     : <code class="cpp">future&lt;int&gt; f(shared_ptr&lt;stream&gt; str) { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;read(512, buf).then([](future&lt;int&gt; op) { return op.get() + 11; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; return f(s).then([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = await str.read(512, buf); return count + 11; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = await f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code>await</code> ‚Äì     ( <code>&lt;-</code> )  <code>do</code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      await</code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code>await</code> . ,   <code>await</code>    <code>then</code>       ,    <code>await</code> .    <code>resumable</code>     <code>std::future</code> ,          <code>then</code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> <pre> <code class="hljs coffeescript"><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">       ma,    f    f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb)</span></span></span><span class="hljs-function"> { return Ma &gt;&gt;= [=]</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A)</span></span></span><span class="hljs-function">{ return mb; }; }</span></span></code><span class="hljs-function"><span class="hljs-function">     &gt;&gt;= ,        .       </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</span></span></span></span></code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">,     Haskell  C++. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A&gt; Monad &lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A a)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">  return    C++,      mreturn.     ,     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">       . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">fail</span></span></code><span class="hljs-function"><span class="hljs-function">    ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,        C++,    -        .         - </span></span><code><span class="hljs-function"><span class="hljs-function">Maybe</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   .,     </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .      C++11.   </span></span><code><code><span class="hljs-function"><span class="hljs-function">future       T</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     .   , ,   -   ,      ,   ,  ,      .    </span></span><code><span class="hljs-function"><span class="hljs-function">future</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">get</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;class T&gt; class future { public: ... T get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //  get         ... };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   C++11    ‚Äì </span></span><code><span class="hljs-function"><span class="hljs-function">std::async</span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,           </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .       : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; result = async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">; //  -      f int a = result.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //    f    .</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(const A&amp; a)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([=]{ </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a; })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">  ,       future      ,   .     ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(ma.get()).get(); })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    ,         ma,       f,         f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,      .    3 ,     : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     C++, : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(a) &gt;&gt;= f)</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(mreturn(a).get()).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,  </span></span><code><span class="hljs-function"><span class="hljs-function"></span></span></code><span class="hljs-function"><span class="hljs-function"> .     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     . , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(a).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,  ,     </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function"> ,        .   ,   </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function">  ,      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(   )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">m &gt;&gt;= mreturn == m</span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mreturn(m.get()).get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> m.get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">  ,     m.    ,        m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    .    -     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">function&lt;future&lt;int&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int)</span></span></span><span class="hljs-function">&gt; f = []</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int a)</span></span></span><span class="hljs-function">{ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">; }; int a = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">) &gt;&gt;= f)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; cout &lt;&lt; a;</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    5  11. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  C++11      mreturn  &gt;&gt;=.      : </span></span><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf"><span class="hljs-function"><span class="hljs-function">n3721</span></span></a><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">make_ready_future</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function"> ,    </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function"> .     ,       </span></span><code><span class="hljs-function"><span class="hljs-function">A</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future.     ,        ,   future    ,   then</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   . </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-function">unwrap</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future&lt;future&gt;  future.   join</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">Control.Monad</span></span></code><span class="hljs-function"><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function">     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(shared_ptr&lt;stream&gt; str)</span></span></span><span class="hljs-function"> { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;</span></span>read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([](future&lt;int&gt; op) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> op.get() + <span class="hljs-number"><span class="hljs-number">11</span></span>; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(s).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> str.read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count + <span class="hljs-number"><span class="hljs-number">11</span></span>; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> ‚Äì     ( <code>&lt;-</code> )  <code><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      <span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> . ,   <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>    <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>       ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> .    <code>resumable</code>     <code>std::future</code> ,          <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> </pre> <code><code><code><code><code><code><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f) { ... //     }</code>       ma,    f    f. <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb) { return Ma &gt;&gt;= [=](A){ return mb; }; }</code>     &gt;&gt;= ,        .       ( <code>m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</code> ),     Haskell  C++. <br> <br> <code class="cpp">template&lt;typename A&gt; Monad &lt;A&gt; mreturn(A a) { ... //     }</code>  return    C++,      mreturn.     ,     <code>a</code>       . <br>  <code>fail</code>    ,        . <br> <br> ,        C++,    -        .         - <code>Maybe</code> ,   .,     <code>std::future</code> .      C++11.   <code>future       T</code> ,     .   , ,   -   ,      ,   ,  ,      .    <code>future</code>      <code>get</code> . <br> <code class="cpp">template&lt;class T&gt; class future { public: ... T get(); //  get         ... };</code> <br>   C++11    ‚Äì <code>std::async</code> .      ,           <code>std::future</code> .       : <code class="cpp">future&lt;int&gt; result = async(f); //  -      f int a = result.get(); //    f    .</code> <br>        <code>mreturn</code>  <code>&gt;&gt;=</code>   <code>std::future</code> <code class="cpp">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn(const A&amp; a) { return async([=]{ return a; }); }</code>  ,       future      ,   .     ,    . <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f) { return async([&amp;] () -&gt; B { return f(ma.get()).get(); }); }</code>   ,    ,         ma,       f,         f. <br> <br>  ,      .    3 ,     : <code class="haskell">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: (m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code> <br>     C++, : <br> <code class="cpp">(mreturn(a) &gt;&gt;= f) == f(a)</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(mreturn(a).get()).get(); }) == f(a)</code> ,  <code>mreturn(a).get()</code>   ,  <code></code> .     <code>a</code>  <code>std::future</code> ,     . , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(a).get(); }) == f(a)</code>  ,  ,     <code>f</code> ,        .   ,   <code>f</code>  ,      (   ). <br> <br>  : <code class="haskell">m &gt;&gt;= mreturn == m</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return mreturn(m.get()).get(); }) == m</code>      <code>mreturn(x).get()</code> , : <br> <code class="cpp">async([&amp;] () -&gt; B { return m.get(); }) == m</code>  ,     m.    ,        m. <br> <br>  : <code class="haskell">(m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code>       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. <br> <br>    .    -     : <code class="cpp">function&lt;future&lt;int&gt; (int)&gt; f = [](int a){ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn(a + 6); }; int a = (mreturn(5) &gt;&gt;= f).get(); cout &lt;&lt; a;</code>   ,    5  11. <br> <br>  C++11      mreturn  &gt;&gt;=.      : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf">n3721</a> <br>  <code>mreturn</code>  <code>make_ready_future</code> . <br>  <code>&gt;&gt;=</code> ,    <code>std::future</code>   <code>then</code> .     ,       <code>A</code> ,   <code>future.     ,        ,   future    ,   then</code> ,   . <br>     <code>unwrap</code>      <code>future&lt;future&gt;  future.   join</code>  <code>Control.Monad</code>  . <br> <br>  <code>then</code>     : <code class="cpp">future&lt;int&gt; f(shared_ptr&lt;stream&gt; str) { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;read(512, buf).then([](future&lt;int&gt; op) { return op.get() + 11; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; return f(s).then([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = await str.read(512, buf); return count + 11; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = await f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code>await</code> ‚Äì     ( <code>&lt;-</code> )  <code>do</code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      await</code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code>await</code> . ,   <code>await</code>    <code>then</code>       ,    <code>await</code> .    <code>resumable</code>     <code>std::future</code> ,          <code>then</code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> <pre> <code class="hljs coffeescript"><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">       ma,    f    f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb)</span></span></span><span class="hljs-function"> { return Ma &gt;&gt;= [=]</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A)</span></span></span><span class="hljs-function">{ return mb; }; }</span></span></code><span class="hljs-function"><span class="hljs-function">     &gt;&gt;= ,        .       </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</span></span></span></span></code><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">,     Haskell  C++. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A&gt; Monad &lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A a)</span></span></span><span class="hljs-function"> { ... //     }</span></span></code><span class="hljs-function"><span class="hljs-function">  return    C++,      mreturn.     ,     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">       . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">fail</span></span></code><span class="hljs-function"><span class="hljs-function">    ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,        C++,    -        .         - </span></span><code><span class="hljs-function"><span class="hljs-function">Maybe</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   .,     </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .      C++11.   </span></span><code><code><span class="hljs-function"><span class="hljs-function">future       T</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     .   , ,   -   ,      ,   ,  ,      .    </span></span><code><span class="hljs-function"><span class="hljs-function">future</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">get</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;class T&gt; class future { public: ... T get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //  get         ... };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   C++11    ‚Äì </span></span><code><span class="hljs-function"><span class="hljs-function">std::async</span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,           </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> .       : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; result = async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">; //  -      f int a = result.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; //    f    .</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(const A&amp; a)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([=]{ </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a; })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">  ,       future      ,   .     ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f)</span></span></span><span class="hljs-function"> { return async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(ma.get()).get(); })</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    ,         ma,       f,         f. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,      .    3 ,     : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     C++, : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(a) &gt;&gt;= f)</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(mreturn(a).get()).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,  </span></span><code><span class="hljs-function"><span class="hljs-function"></span></span></code><span class="hljs-function"><span class="hljs-function"> .     </span></span><code><span class="hljs-function"><span class="hljs-function">a</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function"> ,     . , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f(a).get(); })</span></span></span><span class="hljs-function"> == f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,  ,     </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function"> ,        .   ,   </span></span><code><span class="hljs-function"><span class="hljs-function">f</span></span></code><span class="hljs-function"><span class="hljs-function">  ,      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(   )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-function">m &gt;&gt;= mreturn == m</span></span></code><span class="hljs-function"><span class="hljs-function">   , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mreturn(m.get()).get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> , : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">async</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([&amp;] () -&gt; B { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> m.get(); })</span></span></span><span class="hljs-function"> == m</span></span></code><span class="hljs-function"><span class="hljs-function">  ,     m.    ,        m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  : </span></span><code class="haskell"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m &gt;&gt;= f)</span></span></span><span class="hljs-function"> &gt;&gt;= g == m &gt;&gt;= </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\x -&gt; fx &gt;&gt;= g)</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    .    -     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">function&lt;future&lt;int&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int)</span></span></span><span class="hljs-function">&gt; f = []</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int a)</span></span></span><span class="hljs-function">{ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">; }; int a = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mreturn(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">) &gt;&gt;= f)</span></span></span><span class="hljs-function">.get</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; cout &lt;&lt; a;</span></span></code><span class="hljs-function"><span class="hljs-function">   ,    5  11. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  C++11      mreturn  &gt;&gt;=.      : </span></span><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf"><span class="hljs-function"><span class="hljs-function">n3721</span></span></a><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">mreturn</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">make_ready_future</span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">&gt;&gt;=</span></span></code><span class="hljs-function"><span class="hljs-function"> ,    </span></span><code><span class="hljs-function"><span class="hljs-function">std::future</span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function"> .     ,       </span></span><code><span class="hljs-function"><span class="hljs-function">A</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future.     ,        ,   future    ,   then</span></span></code><span class="hljs-function"><span class="hljs-function"> ,   . </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-function">unwrap</span></span></code><span class="hljs-function"><span class="hljs-function">      </span></span><code><code><code><span class="hljs-function"><span class="hljs-function">future&lt;future&gt;  future.   join</span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">Control.Monad</span></span></code><span class="hljs-function"><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-function">then</span></span></code><span class="hljs-function"><span class="hljs-function">     : </span></span><code class="cpp"><span class="hljs-function"><span class="hljs-function">future&lt;int&gt; f</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(shared_ptr&lt;stream&gt; str)</span></span></span><span class="hljs-function"> { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;</span></span>read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([](future&lt;int&gt; op) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> op.get() + <span class="hljs-number"><span class="hljs-number">11</span></span>; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(s).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> str.read(<span class="hljs-number"><span class="hljs-number">512</span></span>, buf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count + <span class="hljs-number"><span class="hljs-number">11</span></span>; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> ‚Äì     ( <code>&lt;-</code> )  <code><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      <span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> . ,   <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code>    <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>       ,    <code><span class="hljs-keyword"><span class="hljs-keyword">await</span></span></code> .    <code>resumable</code>     <code>std::future</code> ,          <code><span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> </pre> <code><code><code><code><code><code><code class="cpp">Monad. ,     . <br> template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;=(Monad&lt;A&gt; ma, function&lt;Monad&lt;B&gt; (A)&gt; f) { ... //     }</code>       ma,    f    f. <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; Monad&lt;B&gt; operator&gt;&gt;(Monad&lt;A&gt; ma, Monad&lt;B&gt; mb) { return Ma &gt;&gt;= [=](A){ return mb; }; }</code>     &gt;&gt;= ,        .       ( <code>m &gt;&gt; k = m &gt;&gt;= \_ -&gt; k</code> ),     Haskell  C++. <br> <br> <code class="cpp">template&lt;typename A&gt; Monad &lt;A&gt; mreturn(A a) { ... //     }</code>  return    C++,      mreturn.     ,     <code>a</code>       . <br>  <code>fail</code>    ,        . <br> <br> ,        C++,    -        .         - <code>Maybe</code> ,   .,     <code>std::future</code> .      C++11.   <code>future       T</code> ,     .   , ,   -   ,      ,   ,  ,      .    <code>future</code>      <code>get</code> . <br> <code class="cpp">template&lt;class T&gt; class future { public: ... T get(); //  get         ... };</code> <br>   C++11    ‚Äì <code>std::async</code> .      ,           <code>std::future</code> .       : <code class="cpp">future&lt;int&gt; result = async(f); //  -      f int a = result.get(); //    f    .</code> <br>        <code>mreturn</code>  <code>&gt;&gt;=</code>   <code>std::future</code> <code class="cpp">#include &lt;future&gt; using namespace std; template&lt;typename A&gt; future&lt;A&gt; mreturn(const A&amp; a) { return async([=]{ return a; }); }</code>  ,       future      ,   .     ,    . <br> <br> <code class="cpp">template&lt;typename A, typename B&gt; future&lt;B&gt; operator&gt;&gt;=(future&lt;A&gt;&amp; ma, const function&lt;future&lt;B&gt; (A)&gt;&amp; f) { return async([&amp;] () -&gt; B { return f(ma.get()).get(); }); }</code>   ,    ,         ma,       f,         f. <br> <br>  ,      .    3 ,     : <code class="haskell">Left identity : return a &gt;&gt;= f == fa Right identity: m &gt;&gt;= return == m Associativity: (m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code> <br>     C++, : <br> <code class="cpp">(mreturn(a) &gt;&gt;= f) == f(a)</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(mreturn(a).get()).get(); }) == f(a)</code> ,  <code>mreturn(a).get()</code>   ,  <code></code> .     <code>a</code>  <code>std::future</code> ,     . , : <br> <code class="cpp">async([&amp;] () -&gt; B { return f(a).get(); }) == f(a)</code>  ,  ,     <code>f</code> ,        .   ,   <code>f</code>  ,      (   ). <br> <br>  : <code class="haskell">m &gt;&gt;= mreturn == m</code>   , : <br> <code class="cpp">async([&amp;] () -&gt; B { return mreturn(m.get()).get(); }) == m</code>      <code>mreturn(x).get()</code> , : <br> <code class="cpp">async([&amp;] () -&gt; B { return m.get(); }) == m</code>  ,     m.    ,        m. <br> <br>  : <code class="haskell">(m &gt;&gt;= f) &gt;&gt;= g == m &gt;&gt;= (\x -&gt; fx &gt;&gt;= g)</code>       ,   ,   .      m   f,   ,      m.       g,     f.     f  g             m. <br> <br>    .    -     : <code class="cpp">function&lt;future&lt;int&gt; (int)&gt; f = [](int a){ cout &lt;&lt; a &lt;&lt; '\n'; return mreturn(a + 6); }; int a = (mreturn(5) &gt;&gt;= f).get(); cout &lt;&lt; a;</code>   ,    5  11. <br> <br>  C++11      mreturn  &gt;&gt;=.      : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3721.pdf">n3721</a> <br>  <code>mreturn</code>  <code>make_ready_future</code> . <br>  <code>&gt;&gt;=</code> ,    <code>std::future</code>   <code>then</code> .     ,       <code>A</code> ,   <code>future.     ,        ,   future    ,   then</code> ,   . <br>     <code>unwrap</code>      <code>future&lt;future&gt;  future.   join</code>  <code>Control.Monad</code>  . <br> <br>  <code>then</code>     : <code class="cpp">future&lt;int&gt; f(shared_ptr&lt;stream&gt; str) { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; return str-&gt;read(512, buf).then([](future&lt;int&gt; op) { return op.get() + 11; }); } future&lt;void&gt; g() { shared_ptr&lt;stream&gt; s = ...; return f(s).then([s](future&lt;int&gt; op) { s-&gt;close(); }); }</code>     ,   ,          .       resumable : <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3722.pdf">n3722</a> .        : <code class="cpp">future&lt;int&gt; f(stream str) resumable { shared_ptr&lt;vector&lt;char&gt;&gt; buf = ...; int count = await str.read(512, buf); return count + 11; } future&lt;void&gt; g() resumable { stream s = ...; int pls11 = await f(s); s.close(); }</code>   <code>resumable</code> ,    ,    ,       .     <code>await</code> ‚Äì     ( <code>&lt;-</code> )  <code>do</code>   . ,   <code>str.read</code>  <code>f</code>    <code><code>future,      await</code>  <code>int</code> ,       . <br> <br>      ?  ,    ,      :           <code>resumable</code> ,  ,   Fibers  Windows  <code>boost::coroutine</code> .    ,     .     <code>resumable</code>   -     ,    <code>await</code> . ,   <code>await</code>    <code>then</code>       ,    <code>await</code> .    <code>resumable</code>     <code>std::future</code> ,          <code>then</code>  <code>get</code> .         C++,        ,    ,  ,   .            <code>std::future</code> . <br>  ,    <code>resumable</code>       .        ,     <code>resumable</code>     .</code></code></code></code></code></code></code> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/205026/">https://habr.com/ru/post/205026/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../205014/index.html">Little Mermaid, which was not: the decline and the collapse of educational TV</a></li>
<li><a href="../205016/index.html">The site sales blackfriday2013 not made the flow of those who want to get freebies</a></li>
<li><a href="../205018/index.html">Python-digest # 5. News, interesting projects, articles and interviews [November 29, 2013 - December 6, 2013]</a></li>
<li><a href="../205020/index.html">Telemetry of Windows Phone 8 and Windows 8 applications</a></li>
<li><a href="../205022/index.html">How to work with HiConversion system</a></li>
<li><a href="../205028/index.html">STM32 on MAC OS</a></li>
<li><a href="../205032/index.html">IOS 7 jailbreak crowdfunding campaign</a></li>
<li><a href="../205038/index.html">How I bought a 3D printer</a></li>
<li><a href="../205040/index.html">AgileKitchen Conference Report November 29, 2013</a></li>
<li><a href="../205044/index.html">Directional attack research</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>