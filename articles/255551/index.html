<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Scaling operations in the Intel Media SDK</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article covers all scaling operations in the Intel Media SDK. Scaling is one of the most common operations in video processing. The application c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Scaling operations in the Intel Media SDK</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/e65/de1/a91/e65de1a91a4a4bc98b81c169527572b1.png"><br><br>  This article covers all scaling operations in the Intel Media SDK.  Scaling is one of the most common operations in video processing.  The application can set the desired area for each video using the video processing pipeline (VPP).  Using the Intel Media SDK VPP, you can perform various scaling operations.  Here we describe the two most frequently used operations and their results. <br><a name="habracut"></a><br>  A simple flowchart showing the pipeline of the functions involved in scaling is shown on the KDPV. <br><br>  <b>Detection of the free surface of a frame</b> ‚Äî surfaces from a pool of surfaces are used, blocked surfaces cannot be used, therefore, an unused surface is searched for. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetFreeSurfaceIndex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mfxFrameSurface1** pSurfacesPool, mfxU16 nPoolSize)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pSurfacesPool) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (mfxU16 i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; nPoolSize; i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span> == pSurfacesPool[i]-&gt;Data.Locked) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MFX_ERR_NOT_FOUND; }</code> </pre> <br>  <b>Load the raw frame to the surface</b> - for the raw frame, the light and chromaticity planes are read, then loaded to the surface. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">mfxStatus </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadRawFrame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mfxFrameSurface1* pSurface, FILE* fSource)</span></span></span><span class="hljs-function"> </span></span>{ w = pInfo-&gt;Width; h = pInfo-&gt;Height; pitch = pData-&gt;Pitch; ptr = pData-&gt;Y; <span class="hljs-comment"><span class="hljs-comment">//read luminance plane for (i = 0; i &lt; h; i++) { nBytesRead = (mfxU32) fread(ptr + i * pitch, 1, w, fSource); if (w != nBytesRead) return MFX_ERR_MORE_DATA; } mfxU8 buf[2048]; // maximum supported chroma width for nv12 w /= 2; h /= 2; ptr = pData-&gt;UV; // load U sts = ReadPlaneData(w, h, buf, ptr, pitch, 0, fSource); if (MFX_ERR_NONE != sts) return sts; // load V ReadPlaneData(w, h, buf, ptr, pitch, 1, fSource); if (MFX_ERR_NONE != sts) return sts; }</span></span></code> </pre><br>  <b>The write operation on the output surface</b> is after the RunFrameVPPSync operation, which asynchronously processes the frame.  A synchronization operation is called to get all the output data to write back to the raw frame. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">mfxStatus </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteRawFrame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mfxFrameSurface1* pSurface, FILE* fSink)</span></span></span><span class="hljs-function"> </span></span>{ mfxFrameInfo* pInfo = &amp;pSurface-&gt;Info; mfxFrameData* pData = &amp;pSurface-&gt;Data; mfxU32 i, j, h, w; mfxStatus sts = MFX_ERR_NONE; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; pInfo-&gt;Height; i++) sts = WriteSection(pData-&gt;Y, <span class="hljs-number"><span class="hljs-number">1</span></span>, pInfo-&gt;Width, pInfo, pData, i, <span class="hljs-number"><span class="hljs-number">0</span></span>, fSink); h = pInfo-&gt;Height / <span class="hljs-number"><span class="hljs-number">2</span></span>; w = pInfo-&gt;Width; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; h; i++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; w; j += <span class="hljs-number"><span class="hljs-number">2</span></span>) sts = WriteSection(pData-&gt;UV, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, pInfo, pData, i, j, fSink); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; h; i++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j = <span class="hljs-number"><span class="hljs-number">1</span></span>; j &lt; w; j += <span class="hljs-number"><span class="hljs-number">2</span></span>) sts = WriteSection(pData-&gt;UV, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, pInfo, pData, i, j, fSink); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sts; }</code> </pre><br>  We will use sample_vpp from the tutorial on the Media Solution Portal page.  The input file foreman.yuv can be obtained here.  The downloaded file will be in Y4M format, it will need to be converted to YV12 format using ffmpeg. <br><br><pre> <code class="bash hljs">ffmpeg -i input.y4m output.yuv</code> </pre><br>  For scaling operations, six VPP parameters are used. <br><ul><li>  <b>CropX</b> , <b>CropY</b> , <b>CropW</b> , <b>CropH</b> determine the location of the input and output frames, which must be explicitly set to obtain the result. </li><li>  The parameters <b>Width</b> and <b>Height</b> should be set explicitly for both input and output frames.  The values ‚Äã‚Äãof height and width must be a multiple of 16 for frame images and a multiple of 32 for fields. </li></ul><br>  <b>Trimming</b> is one of the most common video processing operations, and is often used to determine the working area (ROI).  With it, you can also change the aspect ratio of the video.  The most common changes are 16: 9-&gt; 4: 3 and 4: 3-&gt; 16: 9.  When changing the aspect ratio, black bars are added to the image, either on the top and bottom, or on the right and left.  Below is a table of input parameters for trimming, changing the aspect ratio with the addition of black bars above and below, to the right and left in sample_vpp. <br><table><tbody><tr><th></th><th>  CropX </th><th>  CropY </th><th>  Cropw </th><th>  CropH </th><th>  Width </th><th>  Height </th></tr><tr><td>  <b>Input</b> </td><td>  128 </td><td>  128 </td><td>  1024 </td><td>  464 </td><td>  1280 </td><td>  720 </td></tr><tr><td>  <b>Output_Crop</b> </td><td>  0 </td><td>  0 </td><td>  1024 </td><td>  464 </td><td>  1024 </td><td>  464 </td></tr><tr><td>  <b>Output_PillarBoxing</b> </td><td>  128 </td><td>  0 </td><td>  1024 </td><td>  720 </td><td>  1280 </td><td>  720 </td></tr><tr><td>  <b>Output_LetterBoxing</b> </td><td>  0 </td><td>  128 </td><td>  1280 </td><td>  464 </td><td>  1280 </td><td>  720 </td></tr></tbody></table>  Here are the results you get when using these parameters. <br><br><img src="https://habrastorage.org/files/cef/3e5/ea0/cef3e5ea07c7488c9dde544f9fe3523a.png"><br><br><img src="https://habrastorage.org/files/476/32e/8eb/47632e8ebcb44f5f8d5f19a982c58d1f.png"><br><br><img src="https://habrastorage.org/files/b16/09f/f35/b1609ff351d14fafbce797a123d09ece.png"><br><br>  Resizing is another video processing operation used to obtain a video image of the desired size.  But in this case no stripes are added to the image, its output resolution simply changes.  Resizing is possible in two dimensions, and only in one (you can only change the width or only the height of the video, which corresponds to horizontal and vertical stretching).  Below is a table of input parameters for resizing and stretching in sample_vpp. <br><table><tbody><tr><th></th><th>  CropX </th><th>  CropY </th><th>  Cropw </th><th>  CropH </th><th>  Width </th><th>  Height </th></tr><tr><td>  Input </td><td>  0 </td><td>  0 </td><td>  640 </td><td>  480 </td><td>  640 </td><td>  480 </td></tr><tr><td>  Output_re-size </td><td>  0 </td><td>  0 </td><td>  1280 </td><td>  720 </td><td>  1280 </td><td>  720 </td></tr><tr><td>  Output_VerticalStretch </td><td>  0 </td><td>  0 </td><td>  640 </td><td>  608 </td><td>  640 </td><td>  608 </td></tr><tr><td>  Output_HorizontalStretch </td><td>  0 </td><td>  0 </td><td>  720 </td><td>  480 </td><td>  720 </td><td>  480 </td></tr></tbody></table>  Here are the results you get when using these parameters. <br><br><img src="https://habrastorage.org/files/aaf/dd2/27a/aafdd227ac6842c3b7747cdf88bcb453.png"><br><br><img src="https://habrastorage.org/files/aeb/309/20d/aeb30920db93487ca6ab4ac59d19ce98.png"><br><br><img src="https://habrastorage.org/files/4b3/383/a22/4b3383a2238443838ed602f764e70029.png"><br><br>  More information about the parameters and functions can be found in the user manual, which is located in the documents folder of the installed copy of MSDK or is available <a href="https://software.intel.com/sites/default/files/mediasdk-man.pdf">here</a> . <br><br>  For more information on compiler optimization, see our <a href="https://software.intel.com/en-us/articles/optimization-notice">optimization notice</a> . <br><br><h4>  <b>Additional links</b> </h4><br><ul><li>  <a href="https://software.intel.com/ru-ru/articles/scaling-operations-in-intel-media-sdk">Original article on IDZ</a> </li><li>  <a href="https://software.intel.com/en-us/media-client-solutions">Intel Media Client Solutions</a> </li><li>  <a href="https://software.intel.com/ru-ru/articles/texture-sharing-from-intel-media-sdk-to-opengl">Texture Exchange between Intel Media SDK and OpenGL</a> </li><li>  <a href="https://software.intel.com/ru-ru/articles/video-encoding-using-the-integrated-intel-hd-graphics">Video encoding using Intel HD Graphics</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/255551/">https://habr.com/ru/post/255551/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255535/index.html">Use Java smart cards to protect software. Chapter 4. We write the first applet</a></li>
<li><a href="../255537/index.html">Use Java smart cards to protect software. Chapter 5. Security</a></li>
<li><a href="../255539/index.html">Release elementary OS "Freya"</a></li>
<li><a href="../255547/index.html">Krovi: Big Data - as dream. Unplanned Series 5: Big Game. Private opinion</a></li>
<li><a href="../255549/index.html">Remember watched videos on youtube</a></li>
<li><a href="../255557/index.html">Sunday tale of the importance of updating, even if you are a botnet operator</a></li>
<li><a href="../255559/index.html">The digest of interesting materials for the mobile # 98 developer (April 6-12)</a></li>
<li><a href="../255561/index.html">Techniques for designing game architecture</a></li>
<li><a href="../255565/index.html">ASN1js and PKIjs - a year after creation</a></li>
<li><a href="../255569/index.html">SSO on FreeIPA + Apache + Flask-Login + JWT</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>