<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Top 10 errors in C ++ projects for 2017</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Outside the window, the year 2018 is almost like 3 months, which means that the time has come (albeit a bit late) to compile the top 10 errors found b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Top 10 errors in C ++ projects for 2017</h1><div class="post__text post__text-html js-mediator-article"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c35/365/51c/c3536551c107bb033939d15ce93397eb.png" alt="Picture 1"></div><br><br>  Outside the window, the year 2018 is almost like 3 months, which means that the time has come (albeit a bit late) to compile the top 10 errors found by the PVS-Studio analyzer in C ++ projects over the past year.  So, let's begin! <br><a name="habracut"></a><br>  <b>Note.</b>  For more interest, I recommend that you first try to independently find errors in the above code snippets, and only then read the analyzer warning and explanations.  I think it will be so much more interesting. <br><br>  <b>Tenth place</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Source: <a href="https://www.viva64.com/ru/b/0511/">Notepad ++: Code Review Five Years Later</a> <br><br>  The error was found when checking one of the most famous text editors - Notepad ++. <br><br>  Error code snippet: <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">TCHAR </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetASCII</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(WPARAM wParam, LPARAM lParam)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> returnvalue; TCHAR mbuffer[<span class="hljs-number"><span class="hljs-number">100</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result; BYTE keys[<span class="hljs-number"><span class="hljs-number">256</span></span>]; WORD dwReturnedValue; GetKeyboardState(keys); result = ToAscii(<span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;UINT&gt;(wParam), (lParam &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>) &amp;&amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>, keys, &amp;dwReturnedValue, <span class="hljs-number"><span class="hljs-number">0</span></span>); returnvalue = (TCHAR) dwReturnedValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(returnvalue &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>){returnvalue = <span class="hljs-number"><span class="hljs-number">0</span></span>;} wsprintf(mbuffer, TEXT(<span class="hljs-string"><span class="hljs-string">"return value = %d"</span></span>), returnvalue); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(result!=<span class="hljs-number"><span class="hljs-number">1</span></span>){returnvalue = <span class="hljs-number"><span class="hljs-number">0</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (TCHAR)returnvalue; }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v560/">warning</a> : <a href="https://www.viva64.com/ru/w/v560/">V560</a> A part of conditional expression is always true: 0xff.  babygrid.cpp 711 <br><br>  The analyzer found the expression suspicious <i>(lParam &gt;&gt; 16) &amp;&amp; 0xff</i> .  The second argument passed to the <i>ToAscii</i> function will always have the value 0 or 1, and the resulting value depends only on the left subexpression - <i>(lParam &gt;&gt; 16)</i> .  Obviously, instead of the &amp;&amp; operator, the &amp; operator should be used. <br><br>  <b>Ninth place</b> <br><br>  Source: <a href="https://www.viva64.com/ru/b/0529/">Greetings to Yandex developers</a> <br><br>  In ninth place is the error from the ClickHouse project developed by Yandex. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">executeForNullThenElse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ColumnUInt8 * cond_col = typeid_cast&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ColumnUInt8 *&gt;(arg_cond.column.get()); .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cond_col) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cond_const_col) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> Exception( <span class="hljs-string"><span class="hljs-string">"Illegal column "</span></span> + cond_col-&gt;getName() + <span class="hljs-string"><span class="hljs-string">" of first argument of function "</span></span> + getName() + <span class="hljs-string"><span class="hljs-string">". Must be ColumnUInt8 or ColumnConstUInt8."</span></span>, ErrorCodes::ILLEGAL_COLUMN); .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v522/">warning</a> : <a href="https://www.viva64.com/ru/w/v522/">V522</a> Dereferencing of the null pointer 'cond_col' might take place.  FunctionsConditional.h 765 <br><br>  This code incorrectly handles the error situation when it is necessary to generate an exception.  Note the <i>cond_col</i> pointer.  For it, in the <i>if statement it</i> checks that the pointer is nonzero.  If control reaches the <i>else</i> branch where an exception is generated, the <i>cond_col</i> pointer <i>is</i> exactly zero.  However, when generating an exception message, <i>cond_col is</i> dereferenced in the expression <i>cond_col-&gt; getName ()</i> . <br><br>  <b>Eighth place</b> <br><br>  Source: <a href="https://www.viva64.com/ru/b/0542/">Firebird, MySQL and PostgreSQL Code Quality Comparison</a> <br><br>  In eighth place is one of the errors found in the MySQL project when comparing the quality of the Firebird, MySQL and PostgreSQL code. <br><br>  The code of the method containing the error: <br><br><pre> <code class="cpp hljs">mysqlx::<span class="hljs-function"><span class="hljs-function">XProtocol* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">active</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!active_connection) <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::runtime_error(<span class="hljs-string"><span class="hljs-string">"no active session"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> active_connection.get(); }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v596/">warning</a> : <a href="https://www.viva64.com/ru/w/v596/">V596</a> The object was not created.  The 'throw' keyword could be missing: throw runtime_error (FOO);  mysqlxtest.cc 509 <br><br>  If there is no active connection ( <i>! Active_connection</i> ), an exception object of the type <i>std :: runtime_error is created</i> and ... that's all.  Once created, it will simply be deleted, and the method will continue.  Obviously, the developer forgot the <i>throw</i> keyword to generate an exception. <br><br>  <b>Seventh place</b> <br><br>  Source: <a href="https://www.viva64.com/ru/b/0496/">How to find 56 potential vulnerabilities in FreeBSD code in one evening</a> <br><br>  How to find 56 potential vulnerabilities per evening?  With static analysis, of course! <br><br>  One of the problems found in FreeBSD code: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mlx5_core_create_qp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct mlx5_core_dev *dev, struct mlx5_core_qp *qp, struct mlx5_create_qp_mbox_in *in, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> inlen)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mlx5_destroy_qp_mbox_out</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dout</span></span></span><span class="hljs-class">;</span></span> .... err_cmd: <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(&amp;din, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(din)); <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(&amp;dout, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(dout)); din.hdr.opcode = cpu_to_be16(MLX5_CMD_OP_DESTROY_QP); din.qpn = cpu_to_be32(qp-&gt;qpn); mlx5_cmd_exec(dev, &amp;din, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(din), &amp;out, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(dout)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err; }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/V597/">warning</a> : <a href="https://www.viva64.com/ru/w/V597/">V597</a> The compiler could delete the memset function call, which is used to flush the 'dout' object.  The memset_s () function should be used to erase the private data.  mlx5_qp.c 159 <br><br>  Note the expression <i>memset (&amp; dout, 0, sizeof (dout)).</i>  The developer wanted to ‚Äúwipe‚Äù the data in the memory block corresponding to <i>dout</i> , setting zero values.  Usually this approach is used when it is necessary to clear some private data so that it does not ‚Äúhang‚Äù in memory. <br><br>  However, <i>dout is</i> not used further ( <i>sizeof (dout) is</i> not counted), which will allow the compiler to remove the above <i>memset</i> function call, since  this optimization does not affect the behavior of the program from the point of view of C / C ++.  As a result, the data that should have been cleaned may remain in memory. <br><br>  To dive deeper into the topic, I recommend reading the following articles: <br><br><ul><li>  <a href="https://www.viva64.com/ru/b/0388/">Secure cleaning of private data</a> . </li><li>  <a href="https://www.viva64.com/ru/w/v597/">Documentation for the V597 diagnostic rule</a> . </li><li>  <a href="https://www.viva64.com/ru/b/0360/">The most dangerous feature in the C / C ++ world</a> . </li></ul><br>  <b>Sixth place</b> <br><br>  Source: <a href="https://www.viva64.com/ru/b/0417/">CryEngine V Welcome Check</a> <br><br>  The first game engine, to which code we will address in this top - CryEngine V. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CTriMesh::Slice(....) { .... bop_meshupdate *pmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> bop_meshupdate, *pmd0; pmd-&gt;pMesh[<span class="hljs-number"><span class="hljs-number">0</span></span>]=pmd-&gt;pMesh[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; AddRef();AddRef(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(pmd0=m_pMeshUpdate; pmd0-&gt;next; pmd0=pmd0-&gt;next); pmd0-&gt;next = pmd; .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v529/">warning</a> : <a href="https://www.viva64.com/ru/w/v529/">V529</a> Odd semicolon ';'  after 'for' operator.  boolean3d.cpp 1314 <br><br>  Agree that if this fragment were not written out like this - being shortened and separated from the rest of the code, it would not be so easy to find in it that suspicious section that the analyzer found - the symbol ';', the final <i>for</i> loop.  At the same time, the formatting of the code (shift of the next expression) also suggests that the symbol ';'  there is an extra one, and the expression <i>pmd0-&gt; next = pmd;</i>  must be a loop body.  But judging by the logic of the <i>for</i> loop, it is precisely the wrong formatting of the code, which is confusing, and not a logical error.  In the CryEngine code, the formatting of the code, by the way, was corrected. <br><br>  <b>Fifth place</b> <br><br>  Source: <a href="https://www.viva64.com/ru/b/0517/">Static analysis as part of the Unreal Engine development process.</a> <br><br>  The next error was discovered during the work on correcting errors found by PVS-Studio in the code of the Unreal Engine. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; SelectedObjects.Num(); ++i) { UObject* Obj = SelectedObjects[<span class="hljs-number"><span class="hljs-number">0</span></span>].Get(); EdObj = Cast&lt;UEditorSkeletonNotifyObj&gt;(Obj); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(EdObj) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v767/">warning</a> : <a href="https://www.viva64.com/ru/w/v767/">V767</a> Suspicious access to element of SelectedObjects' array by a constant index inside a loop.  skeletonnotifydetails.cpp 38 <br><br>  In the loop, we wanted to bypass all the elements and find among them the first one having the type <i>UEditorSkeletonNotifyObj</i> .  But they made an annoying typo, using the constant index 0 in the <i>SelectedObjects [0]. Get ()</i> expression instead of the cycle counter <i>i</i> .  As a result, only the first item will always be checked. <br><br>  <b>Fourth place</b> <br><br>  Source: <a href="https://www.viva64.com/ru/b/0519/">27,000 errors in Tizen operating system</a> <br><br>  The error was found when checking the Tizen operating system, as well as third-party components used in it.  The article is large, and it contains many interesting examples of errors - I strongly recommend that you read it. <br><br>  But back to the specific warning: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _read_request_body(http_transaction_h http_transaction, <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **body) { .... *body = <span class="hljs-built_in"><span class="hljs-built_in">realloc</span></span>(*body, new_len + <span class="hljs-number"><span class="hljs-number">1</span></span>); .... <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(*body + curr_len, ptr, body_size); body[new_len] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; curr_len = new_len; .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v527/">warning</a> : <a href="https://www.viva64.com/ru/w/v527/">V527</a> It is odd that the '\ 0' value is assigned to 'char' type pointer.  Probably meant: * body [new_len] = '\ 0'.  http_request.c 370 <br><br>  The error lies in the expression <i>body [new_len] = '\ 0'</i> .  Notice that the <i>body</i> parameter has type <i>char **</i> , respectively, the type of the expression <i>[new_len]</i> is <i>char *</i> .  But the developer made a blunder, and, forgetting one more dereference, tried to write the value '\ 0' into the pointer (it will be converted to a null pointer). <br><br>  This leads to two problems: <br><br><ul><li>  Somewhere ( <i>body [new_len]</i> ) a null pointer will be written. </li><li>  The terminal zero will not be written to the end of the line. </li></ul><br>  Correct code: <br><br><pre> <code class="cpp hljs">(*body)[new_len] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>;</code> </pre> <br>  <b>Third place</b> <br><br>  Source: <a href="https://www.viva64.com/ru/b/0514/">How can PVS-Studio help finding vulnerabilities?</a> <br><br>  So we got to the top three.  The code below was found during the search for an answer to the question: ‚ÄúHow does PVS-Studio cope with CVE search?‚Äù (For the answer, see the article above).  The code from the illumos-gate project. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">devzvol_readdir</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *ptr; .... ptr = <span class="hljs-built_in"><span class="hljs-built_in">strchr</span></span>(ptr + <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'/'</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>; rw_exit(&amp;sdvp-&gt;sdev_contents); sdev_iter_datasets(dvp, ZFS_IOC_DATASET_LIST_NEXT, ptr); .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v769/">warning</a> : <a href="https://www.viva64.com/ru/w/v769/">V769</a> The 'strchr (ptr + 1,' / ')' pointer in the 'strchr (ptr + 1,' / ') + 1' expression could be nullptr.  In such a case, it will not be used. <br><br>  The <i>strchr</i> function returns a pointer to the first occurrence of the character specified by the second argument in the string specified by the first argument.  If no such character is found, <i>strchr</i> returns <i>NULL</i> .  However, this fact is not taken into account, and the value '1' is always added to the return value.  As a result, the <i>ptr</i> pointer will always be non-zero, which means that further checks like <i>ptr! = NULL</i> will not give information about the pointer's validity.  As a result, under certain conditions, this code led to the emergence of a kernel panic. <br><br>  This error was assigned the following identifier: CVE-2014-9491: The <i>devzvol_readdir</i> function is not subject to the <i>null</i> pointer dereference and panic via unspecified vectors. <br><br>  Despite the fact that CVE itself was discovered in 2014, during our own research, we discovered this error in 2017, so she got to this top. <br><br>  <b>Second place</b> <br><br>  Source: <a href="https://www.viva64.com/ru/b/0517/">Static analysis as part of the Unreal Engine development process.</a> <br><br>  The error, located in second place, was discovered ... yes, again in the Unreal Engine.  It seemed to me very interesting, so I could not resist and did not write it out. <br><br>  <b>Note</b>  Actually, I would have written a couple more mistakes from the above article about the Unreal Engine, but still I don‚Äôt want to refer so often to the same project.  Therefore, I strongly recommend that you look at the above article yourself, in particular, the <a href="https://www.viva64.com/ru/w/v714/">V714</a> and <a href="https://www.viva64.com/ru/w/v709/">V709 warnings</a> . <br><br>  There will be a lot of code, but it is necessary to understand the essence of the problem. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> FCreateBPTemplateProjectAutomationTests::RunTest( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FString&amp; Parameters) { TSharedPtr&lt;SNewProjectWizard&gt; NewProjectWizard; NewProjectWizard = SNew(SNewProjectWizard); TMap&lt;FName, TArray&lt;TSharedPtr&lt;FTemplateItem&gt;&gt; &gt;&amp; Templates = NewProjectWizard-&gt;FindTemplateProjects(); int32 OutMatchedProjectsDesk = <span class="hljs-number"><span class="hljs-number">0</span></span>; int32 OutCreatedProjectsDesk = <span class="hljs-number"><span class="hljs-number">0</span></span>; GameProjectAutomationUtils::CreateProjectSet(Templates, EHardwareClass::Desktop, EGraphicsPreset::Maximum, EContentSourceCategory::BlueprintFeature, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, OutMatchedProjectsDesk, OutCreatedProjectsDesk); int32 OutMatchedProjectsMob = <span class="hljs-number"><span class="hljs-number">0</span></span>; int32 OutCreatedProjectsMob = <span class="hljs-number"><span class="hljs-number">0</span></span>; GameProjectAutomationUtils::CreateProjectSet(Templates, EHardwareClass::Mobile, EGraphicsPreset::Maximum, EContentSourceCategory::BlueprintFeature, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, OutMatchedProjectsMob, OutCreatedProjectsMob); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( OutMatchedProjectsDesk == OutCreatedProjectsDesk ) &amp;&amp; ( OutMatchedProjectsMob == OutCreatedProjectsMob ); }</code> </pre> <br>  We note the following important point needed to understand the problem.  The variables <i>OutMatchedProjectsDesk</i> , <i>OutCreatedProjectsDesk</i> and <i>OutMatchedProjectsMob</i> , <i>OutCreatedProjectsMob</i> when declared are initialized with zeros, and then passed as arguments to the <i>CreateProjectSet</i> method. <br><br>  After that, the variables are compared in the <i>return statement</i> .  Therefore, the <i>CreateProjectSet</i> method must initialize the last two arguments. <br><br>  Now let's turn to the <i>CreateProjectSet</i> method, which contains errors. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateProjectSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(.... int32 OutCreatedProjects, int32 OutMatchedProjects)</span></span></span><span class="hljs-function"> </span></span>{ .... OutCreatedProjects = <span class="hljs-number"><span class="hljs-number">0</span></span>; OutMatchedProjects = <span class="hljs-number"><span class="hljs-number">0</span></span>; .... OutMatchedProjects++; .... OutCreatedProjects++; .... }</code> </pre> <br>  <b>PVS-Studio warnings</b> : <ul><li>  <a href="https://www.viva64.com/ru/w/v763/">V763</a> Parameter 'OutCreatedProjects' is always rewritten in function body before being used.  gameprojectautomationtests.cpp 88 </li><li>  <a href="https://www.viva64.com/ru/w/v763/">V763</a> Parameter 'OutMatchedProjects' is always rewritten in function body before being used.  gameprojectautomationtests.cpp 89 </li></ul><br>  The <i>OutCreatedProjects</i> and <i>OutMatchedProjects parameters were</i> forgotten to make links, and as a result, the values ‚Äã‚Äãof the corresponding arguments are simply copied.  As a result, the return value of the <i>RunTest</i> method given above is always <i>true</i> , since all compared variables have the same value specified during initialization ‚Äî 0. <br><br>  The correct code is: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateProjectSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(.... int32 &amp;OutCreatedProjects, int32 &amp;OutMatchedProjects)</span></span></span></span></code> </pre> <br>  <b>First place</b> <br><br>  Source: <a href="https://www.viva64.com/ru/b/0535/">Love static code analysis!</a> <br><br>  As soon as I saw this error, I did not have a single doubt about who should head the top.  In general, see for yourself.  Never go to the description of the problem until you find an error in the above code snippet.  By the way, the project - StarEngine - is again a game engine. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">PUGI__FN </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set_value_convert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">*&amp; dest, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uintptr_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; header, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uintptr_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> header_mask, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf[<span class="hljs-number"><span class="hljs-number">128</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(buf, <span class="hljs-string"><span class="hljs-string">"%d"</span></span>, value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> set_value_buffer(dest, header, header_mask, buf); }</code> </pre> <br>  Well, how are you doing with finding a bug?  :) <br><br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v614/">warning</a> : <a href="https://www.viva64.com/ru/w/v614/">V614</a> Uninitialized buffer 'buf' used.  Consider checking the printf function.  pugixml.cpp 3362 <br><br>  Surely you have a question: " <i>printf</i> ? Where in the warning of the <i>printf</i> analyzer, if the code contains a call to the <i>sprintf</i> function only?" <br><br>  This is the essence!  <i>A sprintf</i> is a macro that expands into (!) <i>std :: printf</i> ! <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> sprintf std::printf</span></span></code> </pre> <br>  As a result, the uninitialized buffer <i>buf is</i> used as a format string.  Great, isn't it?  I think this mistake quite deservedly won first place. <br><br>  <a href="">Link to the header file with the macro declaration</a> . <br><br><h2>  Conclusion </h2><br>  Hope you liked the bugs you have collected.  Personally, they seemed to me quite interesting.  But, of course, your vision may differ from mine, so you can create your ‚ÄúTop 10 ...‚Äù by reading articles from our <a href="https://www.viva64.com/ru/b/">blog</a> or by looking at the list of errors found by PVS-Studio in open source projects. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b23/00f/dce/b2300fdce779544407aedc511b3f8d12.png" alt="Picture 2"></div><br><br>  I also remind you that all the errors in the article ( <a href="https://www.viva64.com/ru/examples/">as well as many others</a> ) were found with the help of the PVS-Studio analyzer, which I advise you to try on your project: <a href="https://www.viva64.com/ru/pvs-studio-download/">link to the download page</a> . <br><br><p> <a href="https://www.viva64.com/en/b/0565/"><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Sergey Vasiliev.  <a href="https://www.viva64.com/en/b/0565/">Top 10 Bugs in the C ++ Projects of 2017</a> <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="https://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. </div></div></div><p>Source: <a href="https://habr.com/ru/post/352008/">https://habr.com/ru/post/352008/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351998/index.html">The release of Krita 4.0, a free graphic editor for artists, took place.</a></li>
<li><a href="../352000/index.html">Digital events in Moscow from March 26 to April 1</a></li>
<li><a href="../352002/index.html">A manager from Amazon about layoffs in the US and programmer performance evaluation</a></li>
<li><a href="../352004/index.html">What is a digital handwritten signature (CRP)</a></li>
<li><a href="../352006/index.html">Key Application Metrics - Mobile Landmarks 2018 Report</a></li>
<li><a href="../352010/index.html">Overview of the second day of Data Science Weekend 2018. Data Engineering, ETL, search services and more</a></li>
<li><a href="../352012/index.html">Resizing images on the site</a></li>
<li><a href="../352014/index.html">How to crack a picture and (not) get BTC</a></li>
<li><a href="../352016/index.html">Transparency and trust</a></li>
<li><a href="../352020/index.html">Work with notifications about events of IOT objects and GPS trackers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>