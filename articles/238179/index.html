<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How do we write a web service for a billion users</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="IT-director of the project BeSmart.net Maxim Model about the work on the global training service 



 Our team is working on the project BeSmart . Now...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How do we write a web service for a billion users</h1><div class="post__text post__text-html js-mediator-article"> <b>IT-director of the project BeSmart.net Maxim Model about the work on the global training service</b> <br><br><img src="https://habrastorage.org/files/548/efa/155/548efa155d9744b7a1b76dd9302ebd8b.jpg" alt="image"><br><br>  Our team is working on the project <a href="http://besmart.net/">BeSmart</a> .  Now we have nine programmers, including IT directors, that is, I myself (of course, there are designers, marketers, and other specialists ‚Äî altogether more than 20 people).  We work in Belarusian Vitebsk, famous in Russia for the festival ‚ÄúSlavic Bazaar‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      BeSmart.net is a service for hosting training lectures in video, audio and PDF formats, which we hope will eventually be watched around the world.  There are many ambitions, but for the time being we will set them aside and tell you what two goals we face, the developers, and how we fulfill them. <br><a name="habracut"></a><br><br>  Our first goal is to create a highly loaded system that would withstand the appeals of millions of users who would download lectures or buy them.  At the same time, we understand that we have taken on an extremely difficult task, and therefore we want to do everything thoroughly. <br><br>  The second goal is to protect content to the maximum.  Of course, we understand that it is now quite difficult to protect information on the Internet, if at all possible.  But nevertheless we intend to complicate as much as possible and, if possible, prevent unauthorized access to lectures hosted in our system. <br><br>  Now I will describe the technologies that we used to solve both problems. <br><br>  <b>What programming language have we chosen</b> <br><br>  We develop the core of the system in C ++, which, like any language, is not without flaws.  The main one is long development time.  C ++ programs are not written, but designed.  First, the architecture of the future application is developed, and only after that the development stage begins.  Of course, this approach is not mandatory, but it will greatly facilitate the maintenance and development of the project in the future. <br><br>  C ++ is an extremely powerful tool, and this power requires careful handling.  A programmer who writes in C ++ must be highly qualified so that the code is clear and understandable for those who will support the project. <br><br>  The second drawback (it also affects the first) is the lack of ready-made solutions, especially in the field of web development.  If, for example, there are a lot of them for PHP, then for C ++ there are practically none.  Much has to be done from scratch, and BeSmart.net is a 90% self-made product. <br><br>  It took more than two years to work.  In March 2012, the preparation of the TZ began, which lasted until May.  Then began the development of the core of the project, which lasted until November 2012.  In May 2013, we started developing our own file server.  And only in October 2013 the project reached the point of commercial use - it became possible to use the site fully. <br><br>  <b>What do we have in common with Facebook?</b> <br><br>  As you already understood, we realize that it is rather difficult and long to write C ++ code.  But now let us turn to the advantages of C ++, for which we have chosen this language.  First of all, it is the possibility of obtaining ready efficient compiled code, which is impossible or extremely difficult on other platforms.  This is very important for highly loaded projects. <br><br>  The code is converted by the compiler program (we use the GCC compiler) into machine code that is understandable only to the computer, after which the computer executes it.  The speed of processing user requests will be higher.  When thousands or even millions of people use the service at the same time, they will receive information quickly, and the physical capacity of the servers will require less than it could. <br><br>  Facebook was written in PHP, but later Zuckerberg needed to reduce the load on the servers: when you have millions of users it will provide significant savings.  Then Facebook wrote its own software - HipHop, which translates PHP into C ++ and immediately compiles it into machine code.  However, not all PHP scripts can be translated, and Facebook switched to C ++ only partially. <br><br>  Vkontakte programmers, as far as we know, still write code in PHP, but they do it consciously.  First, new functions of Vkontakte are quickly written in PHP, then tested, and if they work, they are written in a compiled programming language (a year ago Pavel Durov announced his own development, KPHP). <br><br>  Everything was originally written in C ++, and this is an indicator of a serious project.  When we started work on BeSmart.net, we met with IT people from other projects, and one of them asked me: ‚ÄúWell, how are you?  What are you doing? ‚ÄùI say:‚Äú Here, we will make an application in C ++. ‚Äù  To which my friend replied: "Are you going to serve a billion people?" I said, "Yes, we are going to serve a billion." <br><br>  <b>Where we store user data</b> <br><br>  So far we have no billion lecturers and listeners (by the way, you can bring our goal closer and download some lecture on BeSmart.net).  But we are already preparing to store large amounts of multimedia information.  Storage needs to be made safe, and this is our second big goal.  For this, we have both software and hardware solutions. <br><br>  We rent servers in two data centers: one is in Moscow, the second is in Hong Kong.  Now we are negotiating the lease of servers in another European country.  Information on servers is duplicated.  Depending on where in the world the request will be made, content will be sent from the server closest to the user. <br>  Of course, we are aware of the existence of companies that provide CDN services that do the same thing, but outsourced.  But the fact of the matter is that we do not use the services of other companies.  After all, we vouch for the safety of all data on the site. <br><br>  We also wrote our own asynchronous file server (responsible for storing software) in C ++.  Its peculiarity is that it gives users content not from servers, but from our local network. <br>  Here it is necessary to clarify: in addition to servers with the software part of the BeSmart.net service, we have separate servers with user data.  They are united in a local network that is not directly connected to the Internet.  This local network is accessed by the file server when it provides content to users of the site.  In fact, this is one bundle of servers inside another.  Thus, data is better protected from hacking. <br><br>  <b><i>So the data is stored in Besmart.net</i></b> <br><br><img src="https://habrastorage.org/files/174/54e/871/17454e871e714773adcb784cfa28338a.jpg" alt="image"><br><br>  <i><b>DC</b> - data processing center;</i> <i><br></i>  <i><b>Cluster Web</b> - a cluster of web servers for receiving and processing orders from users;</i> <i><br></i>  <i><b>Cluster FS</b> - a cluster of server access to the file resources of the project (download and upload content);</i> <i><br></i>  <i><b>GW</b> is a gateway that forms a secure channel for uniting the internal networks of different Besmart.net data centers into a single network (used to create a distributed storage network and replicate them).</i> <br><br>  <b>How we protect copyright content</b> <br><br>  The site accepts lectures from users in all popular video formats.  But they are stored in MP4 format, and when viewed, users receive them using the HLS (HTTP Live Streaming) protocol developed by Apple.  Streaming video is not given by the whole file, which is gradually played on the computer from the cache, but by fragments of 10 seconds each.  Some browsers, displaying the video, keep these pieces in the cache, some do not save, but in any case, the technology complicates the work of pirates. <br><br>  All the content that users upload to the site, we mark with a watermark ("watermark").  Of course, its use will not save from illegal distribution of video, but to designate your rights to it is, in general, not such a meaningless undertaking.  At the very least, it will definitely be easier to remove our lectures from sites that are in the legal field. <br><br>  So that the pirates could not easily get rid of the ‚Äúwatermark‚Äù, we made it dynamic - the BeSmart.net logo slowly floats around the picture, changing the trajectory.  During the saving of clips on the servers, the processing takes place: the recordings are sorted into audio and video tracks, a ‚Äúwatermark‚Äù is superimposed on them, after which the tracks are collected again.  As a result, the trajectory of the ‚Äúwatermark‚Äù movement in the frame is always different.  To separate audio and video tracks and merge them back, we wrote our software.  And for frame information "watermark" and the video stream, we use <a href="http://ru.wikipedia.org/wiki/FFmpeg">FFmpeg</a> . <br><br>  Let me remind you, in addition to video and audio files, you can upload PDF to the site.  These files are also marked ‚Äúwatermark‚Äù.  When downloading, we split these files into separate pages, and a program specially written by us puts a "watermark" on each of them.  At the same time, we deliberately degrade the quality of images so that the texts are readable, but not for printing. <br><br>  <b>What will happen next</b> <br><br>  Every day there are new tasks that do not always pursue our two main goals, but somehow improve service.  Recently, we made the so-called ‚Äúexchange of business cards‚Äù for users of the system who want to communicate with each other - an analogue of ‚Äúfriendship‚Äù in social networks.  In addition, the opportunity to blog, leave comments and evaluate lectures.  It took two weeks of writing code. <br><br>  Our project is young and for this reason it is not without flaws, but we are working on it.  The development process is not complete, we are at the beginning.  Nothing is impossible - there are only tasks and deadlines for their implementation. </div><p>Source: <a href="https://habr.com/ru/post/238179/">https://habr.com/ru/post/238179/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../238167/index.html">How to get control of Virtual Machine Sprawl: 7 useful reports in the Veeam Availability Suite</a></li>
<li><a href="../238169/index.html">Startup Guide, Part 6: Too Little Investment - How Much? And too much?</a></li>
<li><a href="../238171/index.html">Understanding Monads with Javascript</a></li>
<li><a href="../238173/index.html">Google Play Books are now available in Ukraine, Estonia, Latvia and Lithuania.</a></li>
<li><a href="../238175/index.html">The term of transfer of servers with personal data to Russia is reduced</a></li>
<li><a href="../238181/index.html">Why speak at IT conferences and meetings?</a></li>
<li><a href="../238183/index.html">Not so sat down: Apple responded to messages about the bent iPhone 6 and 6 Plus</a></li>
<li><a href="../238185/index.html">Vulnerability in verification of certificate signatures in the NSS library</a></li>
<li><a href="../238187/index.html">Dent in space with DisplacementMapFilter</a></li>
<li><a href="../238197/index.html">Arr.js: events for the standard array</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>