<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Multicore JIT compilation in .NET 4.5</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Historically, .NET developers have used the image generator in Ngen‚Äôs machine code. This works great if you have an installer, and you can generate th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Multicore JIT compilation in .NET 4.5</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/0a4/ad8/7bf/0a4ad87bfba73819105e3decad42452a.png" align="right"><br>  Historically, .NET developers have used the image generator in Ngen‚Äôs machine code.  This works great if you have an installer, and you can generate these images during the installation of the application.  But in other cases, for example, when you do not have an installer or you do not have access to Ngen, your application will perform a JIT compilation as needed, which will slow it down.  The CLR developers have provided a solution in the new version of .NET ‚Äî a multi-core JIT compilation with the ability to create optimization profiles. <br><a name="habracut"></a><br>  With multi-core JIT compilation, the code is compiled on two cores in parallel.  The more code you execute at boot time, the more noticeable will be the acceleration from the multi-core JIT.  You can get a 20-50% reduction in load times, which is good news for those who are developing large applications and do not have the ability to use Ngen.  For this you need to add to your code just a couple of lines of code. <br><br><h4>  <b>How it works</b> </h4><br>  In general, you will need to call only two methods in your application: <br><ul><li>  Specify the location where the multi-core JIT profiles will be stored, </li><li>  And start profiling by calling the StartProfile method. </li></ul><br>  The .NET runtime will create a profile based on the sequences of methods invoked while your application is running.  This profile will be saved to disk.  Simply put, when you first start, a profile will be ‚Äúrecorded‚Äù (images are taken <a href="http://blogs.msdn.com/b/dotnet/archive/2012/10/18/an-easy-solution-for-improving-app-launch-performance.aspx">from here</a> ): <br><img src="https://habrastorage.org/storage2/546/6db/cf1/5466dbcf1f4b756a602ec387ef460f4d.png"><br><br>  When the application is launched the next time, the .NET runtime will check for the presence of a ready profile and, having found it, will start a JIT compilation in the sequence in which they were stored in the profile. <br><img src="https://habrastorage.org/storage2/289/d98/8f4/289d988f480c06d07e7ec98c8ca062b6.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  <b>We use multi-core JIT compilation</b> </h4><br>  Using multi-core JIT compilation is easy.  In .NET 4.5 there is a class <a href="http://msdn.microsoft.com/en-us/library/system.runtime.profileoptimization.aspx">System.Runtime.ProfileOptimization</a> , which we can use to start recording a profile when the application starts.  This code looks like this: <br><br><pre><code class="cs hljs">ProfileOptimization.SetProfileRoot(<span class="hljs-string"><span class="hljs-string">@"C:\MyApp"</span></span>); ProfileOptimization.StartProfile(<span class="hljs-string"><span class="hljs-string">"LaunchProfile"</span></span>);</code> </pre> <br>  <b>SetProfileRoot</b> - enables optimization for the current AppDomain and sets the directory where the optimization profile will be saved.  This method is ignored on single-core computers. <br><br>  <b>StartProfile</b> - starts profiling and just-in-time compilation for those methods that were recorded in the profile (if it already exists). <br><br>  ASP.NET 4.5 includes multi-core JIT compilation by default.  If you want to turn off this optimization, add the attribute to <code>compilation</code> to your web.config: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">compilation</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">profileGuidedOptimizations</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"None"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  If you are unable to upgrade to .NET 4.5, and want to use this functionality in an application that is shared for .NET 4.0, there is a <a href="http://blog.getpaint.net/2012/09/08/using-multi-core-jit-from-net-4-0-if-net-4-5-is-installed/">way to enable optimization on computers that have .NET 4.5 installed</a> . <br><br>  If your application has multistage startup logic, you can call <code>StartProfile</code> in several places.  For example, if after the initial launch the user has a choice (for example in the menu) which part of the program to go on, you can use different profiles for different parts of the code.  This way you optimize JIT compilation based on user actions. <br><br><h4>  <b>Efficiency</b> </h4><br>  For large applications, a decrease in load time may be about 50%.  To demonstrate this, the development team took the Paint.NET editor, deleted the pre-generated Ngen images, and compared the time and processor load in two cases: <br><img src="https://habrastorage.org/storage2/ae4/45a/f27/ae445af27905e9a8b9224027f33d012a.png"><br><br>  This is definitely a fairly simple and effective way to reduce the load time of .NET applications that do not use Ngen. <br><br>  More information about performance improvements in .NET 4.5 is available in the article on MSDN: <br>  <a href="http://msdn.microsoft.com/en-us/magazine/hh882452.aspx">msdn.microsoft.com/en-us/magazine/hh882452.aspx</a> </div><p>Source: <a href="https://habr.com/ru/post/163725/">https://habr.com/ru/post/163725/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../163711/index.html">We understand the development of Windows 8 applications on XAML / –° #, implementing a simple RSS Reader. Part 1</a></li>
<li><a href="../163713/index.html">Apocalypse</a></li>
<li><a href="../163719/index.html">Admins of the Great Chinese firewall seriously took up the VPN</a></li>
<li><a href="../163721/index.html">The four-legged military robot AlphaDog grows and develops</a></li>
<li><a href="../163723/index.html">Be happy in 2013!</a></li>
<li><a href="../163727/index.html">Generator of texts on the basis of patterns, Hen Ryaba and Star Wars</a></li>
<li><a href="../163731/index.html">Briefly about the new: Samsung is ready to produce 14-nm FinFET chips</a></li>
<li><a href="../163733/index.html">The Open Republic portal began work in Bashkortostan</a></li>
<li><a href="../163735/index.html">Screenshot Monitor - monitor remote developers</a></li>
<li><a href="../163737/index.html">NeoQuest-2013 (doomsday is canceled)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>