<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We make a textbook or documentation for an hour on the Sphinx</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I teach web programming. When you teach people, the saying ‚Äúshoemaker without shoes‚Äù should not apply to you: you should do everything without visible...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We make a textbook or documentation for an hour on the Sphinx</h1><div class="post__text post__text-html js-mediator-article">  I teach web programming.  When you teach people, the saying ‚Äúshoemaker without shoes‚Äù should not apply to you: you should do everything without visible effort and quickly.  The textbook should be easy and simple, and look good. <br><br>  In general, if you need to make a documentation, tutorial, or just a set of texts with illustrations, then you need <a href="http://sphinx.pocoo.org/"><b>Python Sphinx</b></a> , and here I will tell you how to quickly configure and use it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bbb/fa0/cda/bbbfa0cda069adbb9ff8530a48d3d1a3.png" alt="Blank page of new documentation"><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Install Python and tools </h5><br><br>  On the Windows platform, you will need Python, and I‚Äôll leave it to you as your homework.  In addition to Python, you need the distribute and curl (or wget) packages.  Download and install distribute and <a href="http://www.pip-installer.org/en/latest/installing.html">pip</a> : <br><br><pre><code class="bash hljs">curl http://python-distribute.org/distribute_setup.py | python curl https://raw.github.com/pypa/pip/master/contrib/get-pip.py | python</code> </pre> <br><br>  Now you can install Sphinx itself: <br><br><pre> <code class="bash hljs"> pip install sphinx</code> </pre><br><br>  * in ubuntu / debian add sudo <br><br><h5>  Create a draft textbook </h5><br><br>  After that, it is enough to create a folder for the project and run the <b>sphinx-quickstart</b> script in it.  He will ask a few questions.  Of these, in my opinion, you have to answer two differently: <br><br><pre> <code class="bash hljs"> &gt; Separate <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> and build directories (y/N) [n]: y (        - ) &gt; Create Windows <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> file? (Y/n) [y]: n (   .bat, - ,    Linux)</code> </pre><br><br>  Procurement project is ready.  Then you can open index.rst and try to edit. <br><br>  How to study the markup ReStructured Text?  Good software does not require reading the documentation.  Sphinx is no exception: on all pages made by him there is a link <b>‚ÄúShow source code‚Äù (‚ÄúShow source‚Äù)</b> .  Peering into other people's sources, you can learn a lot and quickly.  Watch and experiment. <br><br>  Having written something significant, we run the HTML assembly in the console: <br><br><pre> <code class="bash hljs"> make html</code> </pre><br><br>  Open the index.html page from the _build / html folder and enjoy it.  We have a static site with a search (in JavaScript). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/371/1e5/9d8/3711e59d841652ca60ad6ad94ba81ebb.png" alt="     " title="Standard Style Sphinx Page"><br><br><h5>  Auto assembly </h5><br><br>  Finally, when we began to edit the files, it turns out that every time to run make html and update the browser is a very tedious task.  The inotify package allows you to monitor file changes and run commands.  Install infotify-tools and xdotool: <br><br><pre> <code class="bash hljs"> sudo apt-get install inotify-tools xdotool</code> </pre><br><br>  The simplest version of the script, tracking updates.  It launches the assembly of multipage html documentation and a single file, then presses the F5 button in Chrome in the open tab: <br><br><pre> <code class="bash hljs"> inotifywait -mr <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> --exclude _build -e close_write -e create -e delete -e move | <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> file event; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> make singlehtml html xdotool search --name Chromium key --window %@ F5 <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre><br><br>  But it quickly turns out to be a flaw: how many files are updated, so many times and the build starts.  It is necessary to group similar events in one.  Searching for various options, I decided not to write my script on Python, but to get by with a shell script that was run from the project folder: <br><br><pre> <code class="bash hljs"> inotifywait -mr <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> --exclude _build -e close_write -e create -e delete -e move --format <span class="hljs-string"><span class="hljs-string">'%w %e %T'</span></span> --timefmt <span class="hljs-string"><span class="hljs-string">'%H%M%S'</span></span> | <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> file event tm; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> current=$(date +<span class="hljs-string"><span class="hljs-string">'%H%M%S'</span></span>) delta=`expr <span class="hljs-variable"><span class="hljs-variable">$current</span></span> - <span class="hljs-variable"><span class="hljs-variable">$tm</span></span>` <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-variable"><span class="hljs-variable">$delta</span></span> -lt 2 -a <span class="hljs-variable"><span class="hljs-variable">$delta</span></span> -gt -2 ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> sleep 1 <span class="hljs-comment"><span class="hljs-comment">#  1         make html singlehtml xdotool search --name Chromium key --window %@ F5 fi done</span></span></code> </pre><br><br>  He compares the time of the event with the time when the turn came to him.  If the event happened 1-2 seconds ago, then you need to re-create the documentation.  In order for other systems to finish their work (for example, hg update is over), the script sleeps for 1 second.  The build begins.  After that, the following events are processed, and they will be very old, so the script skips them right away. <br><br>  You can also embed it in the Makefile: <br><br><pre> <code class="bash hljs"> .PHONY autobuild autobuild: &lt;&gt;</code> </pre><br><br><h5>  Documentation formats </h5><br><br>  Sphinx can do multi-page HTML, can make a single file, as well as PDF, e-books (EPUB) and someone made CHM. <br><br>  There are 2 ways to make a PDF: install Latex by pumping out 1 GB of packages, but the output will be a pouch.  Another option is the new Python package rst2pdf, which is fast and simple; it will issue a PDF of a very simple look.  Above him will have to work hard to bring the style to decent. <br><br><h5>  Download documentation in PDF </h5><br><br>  I add a link to download PDF on the main page, this is the download instruction.  So that it is not visible in the PDF itself, there is only a block: <br><br><pre> <code class="markdown hljs"> .. only:: html     :download:<span class="hljs-code"><span class="hljs-code">`  PDF &lt;../build/latex/manual.pdf&gt;`</span></span>.</code> </pre><br><br>  Attention: when Sphinx collects HTML, it will copy this file to the static folder.  Therefore, in order for the versions to match, you must first generate a PDF, only then HTML. <br><br><h5>  Publication </h5><br><br>  There are 3 options.  The simplest <a href="http://bitbucket.org/">thing is</a> to <a href="http://bitbucket.org/">upload the</a> project to <a href="http://bitbucket.org/">BitBucket</a> , add the free Read The Docs service to the repository, then register on <a href="http://readthedocs.org/">ReadTheDocs</a> and create a project there.  When you upload new revisions in the main branch, RTD will download them and redo the documentation.  Thus, the documentation for the program library does not need to be specifically dealt with: it is sufficient to keep up to date the dostrings. <br><br>  If you want to keep a closed site for your own, you can make a simple password-protected site and collect it manually.  It is enough to upload the contents of the _build / html folder to the root of the site.  I use rsync for this and wrote 2 lines in the Makefile: <br><br><pre> <code class="bash hljs">.PHONY: sync sync: latexpdf html rsync -ave ssh build/html/ siberiano@hosting:/home/siberiano/webapps/course_manual/ --delete</code> </pre><br><br>  First, the documentation will be compiled in latexpdf format, then in html (and PDF will be added to the ‚Äúdownload‚Äù), then rsync will upload the files to the hosting by deleting the old ones (option - delete). <br><br>  If you need your own closed system that does not depend on others, you can run the <a href="">ReadTheDocs</a> clone. <br><br><h5>  Beautiful design </h5><br><br>  Sphinx uses ‚Äúthemes‚Äù, these are <a href="http://jinja.pocoo.org/">Jinja</a> templates plus static files, folded into one folder.  I posted a <a href="">few collected from the free access to those</a> .  To enable a theme, you need to configure 2 conf.py lines: <br><br><pre> <code class="python hljs">html_theme = <span class="hljs-string"><span class="hljs-string">'armstrong'</span></span> <span class="hljs-comment"><span class="hljs-comment">#   html_theme_path = ['themes'] #   source,    </span></span></code> </pre><br><br>  Result: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e85/8c9/9a3/e858c99a30b17e8833c08be9324b8e45.png" alt="   Armstrong" title="Documentation with the Armstrong Theme"><br><br><h5>  Summary </h5><br><br><img src="https://habrastorage.org/getpro/habr/post_images/476/b37/e0a/476b37e0aa4653098f9dd81add6db044.png" alt="Project logo" align="right"><br>  Sphinx is a very powerful tool that can make you a static site from a minimum of data.  For a lot of static text and photos, this is the best option.  It can be quickly raised and updated very quickly.  And the documentation for software libraries will be collected at all by itself without your efforts - just a developer‚Äôs dream! <br><br>  PS I forgot to add examples of how to make automatic documentation.  In fact, the <a href="https://bitbucket.org/kmike/django-fab-deploy/src/9c01873aa50d/docs/conf.py">settings</a> and <a href="">source code</a> can be peeped in any project, and it is also useful to know <a href="http://sphinx.pocoo.org/man/sphinx-apidoc.html">sphinx-apidoc</a> . <br><br>  <b>Adding on 10/11/12:</b> on GitHub I found the <a href="https://github.com/vkocubinsky/SublimeTableEditor">preformatted table editor</a> for SublimeText, made especially for those who edit RST and Markdown. </div><p>Source: <a href="https://habr.com/ru/post/151129/">https://habr.com/ru/post/151129/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../151124/index.html">Happy Tester's Day '12!</a></li>
<li><a href="../151125/index.html">Simulator for testing software APCS: Example</a></li>
<li><a href="../151126/index.html">802.11 Network Security - Top Threats</a></li>
<li><a href="../151127/index.html">Does the Internet dumb us?</a></li>
<li><a href="../151128/index.html">Unix as IDE: Working with Text</a></li>
<li><a href="../151130/index.html">Happy Testers Day!</a></li>
<li><a href="../151131/index.html">Kinect for Windows SDK. Part 2. Data Flows</a></li>
<li><a href="../151132/index.html">Leaked information about the unusual camera from Sony</a></li>
<li><a href="../151133/index.html">ReactOS hires and pays in Euro</a></li>
<li><a href="../151134/index.html">The first chip to measure the strength of Casimir</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>