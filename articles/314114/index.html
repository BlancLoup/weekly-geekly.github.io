<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Enum in PHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Problem 
 As you know, there is no built-in type of enumeration in PHP, and in projects with a complex subject area, this fact creates many problems. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Enum in PHP</h1><div class="post__text post__text-html js-mediator-article"><h2>  Problem </h2><br>  As you know, there is no built-in type of enumeration in PHP, and in projects with a complex subject area, this fact creates many problems.  When in the next Symfony-project there was a need for transfers, it was decided to create its own implementation. <br><br>  Enumerations required flexibility and use in various components of the application.  The tasks that the enumerations should have solved are the following: <br><br><ul><li>  be able to get a list of enumeration values </li><li>  Doctrine integration to use enumeration as field type </li><li>  Integration with Form to use enumerations as a form field to select the desired item. </li><li>  integration with Twig to translate enumeration values </li></ul><a name="habracut"></a><br>  There are several implementations of enumerations, for example, <a href="https://github.com/myclabs/php-enum">myclabs / php-enum</a> , sometimes <a href="https://habrahabr.ru/post/38584/">quite strange</a> , including <a href="http://php.net/manual/ru/class.splenum.php">SplEnum</a> .  But when integrating them with other parts of the application (doctrine, twig), problems arise, especially when using Doctrine. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A feature of the Doctrine type system is that all types must inherit from the Type class, which has a private final constructor.  Those.  we cannot inherit from it and overload the constructor to accept the enumeration value.  Nevertheless, this problem was circumvented, albeit in a somewhat non-standard way. <br><br><h2>  Implementation </h2><br>  Enum - base class enums <br><br><div class="spoiler">  <b class="spoiler_title">Enum.php</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">System</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Enum</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">DBAL</span></span>\<span class="hljs-title"><span class="hljs-title">Platforms</span></span>\<span class="hljs-title"><span class="hljs-title">MySqlPlatform</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">DBAL</span></span>\<span class="hljs-title"><span class="hljs-title">Platforms</span></span>\<span class="hljs-title"><span class="hljs-title">PostgreSqlPlatform</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">DBAL</span></span>\<span class="hljs-title"><span class="hljs-title">Platforms</span></span>\<span class="hljs-title"><span class="hljs-title">SqlitePlatform</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">DBAL</span></span>\<span class="hljs-title"><span class="hljs-title">Types</span></span>\<span class="hljs-title"><span class="hljs-title">Type</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">DBAL</span></span>\<span class="hljs-title"><span class="hljs-title">Platforms</span></span>\<span class="hljs-title"><span class="hljs-title">AbstractPlatform</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enum</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $values = []; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $valueMap = []; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $value; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;value = $value; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;value; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;value; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> Enum[] * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> \Exception */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValues</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $className = get_called_class(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!array_key_exists($className, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$values)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(sprintf(<span class="hljs-string"><span class="hljs-string">"Enum is not initialized, enum=%s"</span></span>, $className)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$values[$className]; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getEnumObject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($value)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } $className = get_called_class(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$valueMap[$className][$value]; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $className = get_called_class(); $class = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \ReflectionClass($className); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (array_key_exists($className, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$values)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(sprintf(<span class="hljs-string"><span class="hljs-string">"Enum has been already initialized, enum=%s"</span></span>, $className)); } <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$values[$className] = []; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$valueMap[$className] = []; <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Enum[] $enumFields */</span></span> $enumFields = array_filter($class-&gt;getStaticProperties(), <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($property)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $property <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Enum; }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($enumFields) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(sprintf(<span class="hljs-string"><span class="hljs-string">"Enum has not values, enum=%s"</span></span>, $className)); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($enumFields <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $property) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (array_key_exists($property-&gt;getValue(), <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$valueMap[$className])) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(sprintf(<span class="hljs-string"><span class="hljs-string">"Duplicate enum value %s from enum %s"</span></span>, $property-&gt;getValue(), $className)); } <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$values[$className][] = $property; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$valueMap[$className][$property-&gt;getValue()] = $property; } } }</code> </pre> <br></div></div><br>  A specific Enum might look like this: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Format</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enum</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $WEB; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $GOST; } Format::$WEB = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Format(<span class="hljs-string"><span class="hljs-string">'web'</span></span>); Format::$GOST = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Format(<span class="hljs-string"><span class="hljs-string">'gost'</span></span>); Format::init();</code> </pre><br>  Unfortunately, php cannot use expressions for static fields, so the creation of objects has to be moved out of class. <br><br><h2>  Doctrine Integration </h2><br>  Due to the closed constructor, Enum cannot be inherited inherited from Type doctrines.  But how to make, that transfers were Type?  The answer came in the process of learning how Doctrine creates proxies for entities.  For each entity, Doctrine generates a proxy class, which is inherited from the entity class, which implements lazy loading and everything else.  Well, we will do the same - for each Enum class we will create a proxy class that inherits from Type and implements the logic needed to determine the type.  These classes can then be cached and loaded as needed. <br><br>  DoctrineEnumAbstractType, which implements the basic logic Type <br><br><div class="spoiler">  <b class="spoiler_title">DoctrineEnumAbstractType.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DoctrineEnumAbstractType</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Type</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Enum $enum */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $enumClass = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSqlDeclaration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $fieldDeclaration, AbstractPlatform $platform)</span></span></span><span class="hljs-function"> </span></span>{ $enum = <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>::$enumClass; $values = implode( <span class="hljs-string"><span class="hljs-string">", "</span></span>, array_map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Enum $enum)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"'"</span></span> . $enum-&gt;getValue() . <span class="hljs-string"><span class="hljs-string">"'"</span></span>; }, $enum::getValues())); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($platform <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> MysqlPlatform) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sprintf(<span class="hljs-string"><span class="hljs-string">'ENUM(%s)'</span></span>, $values); } <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> ($platform <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> SqlitePlatform) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sprintf(<span class="hljs-string"><span class="hljs-string">'TEXT CHECK(%s IN (%s))'</span></span>, $fieldDeclaration[<span class="hljs-string"><span class="hljs-string">'name'</span></span>], $values); } <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> ($platform <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> PostgreSqlPlatform) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sprintf(<span class="hljs-string"><span class="hljs-string">'VARCHAR(255) CHECK(%s IN (%s))'</span></span>, $fieldDeclaration[<span class="hljs-string"><span class="hljs-string">'name'</span></span>], $values); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(sprintf(<span class="hljs-string"><span class="hljs-string">"Sorry, platform %s currently not supported enums"</span></span>, $platform-&gt;getName())); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $enum = <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>::$enumClass; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \ReflectionClass($enum))-&gt;getShortName(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertToPHPValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($value, AbstractPlatform $platform)</span></span></span><span class="hljs-function"> </span></span>{ $enum = <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>::$enumClass; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $enum::getEnumObject($value); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertToDatabaseValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($enum, AbstractPlatform $platform)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Enum $enum */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $enum-&gt;getValue(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">requiresSQLCommentHint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AbstractPlatform $platform)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } }</code> </pre><br></div></div><br>  DoctrineEnumProxyClassGenerator, which generates proxy classes for enums. <br><br><div class="spoiler">  <b class="spoiler_title">DoctrineEnumProxyClassGenerator.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DoctrineEnumProxyClassGenerator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proxyClassName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($enumClass)</span></span></span><span class="hljs-function"> </span></span>{ $enumClassName = (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \ReflectionClass($enumClass))-&gt;getShortName(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $enumClassName . <span class="hljs-string"><span class="hljs-string">'DoctrineEnum'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proxyClassFullName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($namespace, $enumClass)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $namespace . <span class="hljs-string"><span class="hljs-string">'\\'</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;proxyClassName($enumClass); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateProxyClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($enumClass, $namespace)</span></span></span><span class="hljs-function"> </span></span>{ $proxyClassTemplate = &lt;&lt;&lt;EOF <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> &lt;<span class="hljs-title"><span class="hljs-title">namespace</span></span>&gt;; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">proxyClassName</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">proxyClassBase</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> \$enumClass = <span class="hljs-string"><span class="hljs-string">'\&lt;enumClass&gt;'</span></span>; } EOF; $placeholders = [ <span class="hljs-string"><span class="hljs-string">'namespace'</span></span> =&gt; $namespace, <span class="hljs-string"><span class="hljs-string">'proxyClassName'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::proxyClassName($enumClass), <span class="hljs-string"><span class="hljs-string">'proxyClassBase'</span></span> =&gt; DoctrineEnumAbstractType::class, <span class="hljs-string"><span class="hljs-string">'enumClass'</span></span> =&gt; $enumClass, ]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;generateCode($proxyClassTemplate, $placeholders); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($classTemplate, array $placeholders)</span></span></span><span class="hljs-function"> </span></span>{ $placeholderNames = array_map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($placeholderName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;'</span></span> . $placeholderName . <span class="hljs-string"><span class="hljs-string">'&gt;'</span></span>; }, array_keys($placeholders)); $placeHolderValues = array_values($placeholders); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str_replace($placeholderNames, $placeHolderValues, $classTemplate); } }</code> </pre><br></div></div><br>  For each enumeration, the ProxyClassGenerator generates a proxy class, which can then be used in Doctrine so that the entity fields are real enumerations. <br><br><h2>  Conclusion </h2><br>  As a result, we got Enum, which can be used with different components of a symfony application - Doctrine, Form, Twig.  I hope that this implementation can someone or inspire the search for new solutions. </div><p>Source: <a href="https://habr.com/ru/post/314114/">https://habr.com/ru/post/314114/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../314104/index.html">Docker: PostgreSQL configuration master-slave</a></li>
<li><a href="../314106/index.html">How we started a failover cluster</a></li>
<li><a href="../314108/index.html">Remotely enable Mikrotik scripts from Telegram</a></li>
<li><a href="../314110/index.html">Repository Pattern via CSLA .NET</a></li>
<li><a href="../314112/index.html">US authorities allowed researchers to do pentest and reverse engineering without legal consequences</a></li>
<li><a href="../314116/index.html">About how I wrote an ad blocker and trackers for Samsung smartphones on Android. Adhell</a></li>
<li><a href="../314118/index.html">The tortuous path of the developer</a></li>
<li><a href="../314120/index.html">The book "Graphic Design. Visual Grammar ¬ª</a></li>
<li><a href="../314122/index.html">Open operating systems for the Internet of things</a></li>
<li><a href="../314126/index.html">NPAPI plugin support will be disabled for everything except Flash</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>