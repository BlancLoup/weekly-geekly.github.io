<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making the database available for remote connection</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="To begin with, there are times when you need to make an application with a connection to the database. This is done so as not to delve into the backen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making the database available for remote connection</h1><div class="post__text post__text-html js-mediator-article">  To begin with, there are times when you need to make an application with a connection to the database.  This is done so as not to delve into the backend development and concentrate on the frontend due to lack of hands and skills.  I do not presume to say that my solution will be safe, but it works. <br><br>  Since I do not like to pay for hosting, I used the network at my work, there is a white IP there.  Here is its structure: <br><br><img src="https://habrastorage.org/webt/uq/mk/6p/uqmk6plxi-kwn_kcow5frbi7ndk.jpeg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I have access to several computers more precisely to 192.168.1.2 (aka 192.168.0.2) Linux is there and to 192.168.0.3 with Windows.  In general, for my application, I chose mysql and looked at what is on Linux.  It was already installed there, but no one knows the password, and those who knew forgot (those who worked before me).  Having found out that nobody needs him, I deleted it and tried to reinstall it.  There was not enough memory, and since I would have to connect a monitor and keyboard with a mouse to it to fix this error, I decided to quit this business.  Moreover, a Windows machine is much more powerful and plus everything, I myself have it on my home laptop.  In principle, I will not describe the installation itself, there are a bunch of manuals and videos about it.  Having installed mysql on a Windows machine, I decided to backup the tables from the laptop to the workstation. <br><br>  This is done like this (in my case): <br><br><pre><code class="bash hljs">mysqldump -uroot -p your_base &gt; dump_file.sql</code> </pre> <br>  Next, in the new database, create the database and restore the backup on the "new" machine. <br><br><pre> <code class="bash hljs">mysql -h localhost -u root -p</code> </pre><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> your_base; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> your_base;</code> </pre><br><pre> <code class="bash hljs">mysql -uroot -p your_base &lt; dump_file.sql</code> </pre><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">show</span></span> <span class="hljs-keyword"><span class="hljs-keyword">tables</span></span>;</code> </pre><br><a name="habracut"></a><br>  The backup file must be put on a new machine and possibly if not in the utility directory then the full path to it.  (I just uploaded a backup to the github and cloned it to a new machine).  I would add how the tables themselves are created, but I did not save the screenshots, and I think it‚Äôs not difficult even for a 2-3 year student. <br><br>  When I restored all the tables, it's time to make remote access to the database accessible.  In general, such commands did not lead to success (issued only read permissions to select) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> <span class="hljs-string"><span class="hljs-string">'client'</span></span>@<span class="hljs-string"><span class="hljs-string">'%'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTIFIED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-string"><span class="hljs-string">'client'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">grant</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> your_base . * <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-string"><span class="hljs-string">'client'</span></span>@<span class="hljs-string"><span class="hljs-string">'%'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">flush</span></span> <span class="hljs-keyword"><span class="hljs-keyword">privileges</span></span>;</code> </pre><br>  More precisely, I could connect to the database only with a team, <br><br><pre> <code class="bash hljs">mysql -h localhost -u client -pclient</code> </pre><br>  but this one couldn‚Äôt <br><br><pre> <code class="sql hljs">mysql -h 192.168.0.3 -u client -pclient</code> </pre><br>  it didn‚Äôt suit me and couldn‚Äôt connect via this address and from root. <br><br>  The mysql workbench program helped in the settings, change localhost to% and it works, although client did not help it.  Now you can connect to the database from the console or from the code from any address. <br><br><img src="https://habrastorage.org/webt/jk/ys/cs/jkyscs1lcvbpljzkxh14oqwkiiu.jpeg"><br><br>  You also need to make a home or enterprise network and turn off the Windows firewall otherwise you can‚Äôt even ping this machine (not that it connects to the database). <br><br>  Half the work is done, then I need to be able to connect to the database from home. <br><br>  As can be seen from the network diagram, then you need to go from 192.168.0.3 to 192.168.1.1 (router) to the Internet, let's go in the opposite direction.  Set up the route from 192.168.1.1 to 192.168.1.2 like this: <br><br><img src="https://habrastorage.org/5d/37/4d/5d374de1038ee757922449.jpeg"><br><br>  In general, the picture does not show - I will write with my hands: <br><br><pre> <code class="bash hljs">route add 192.168.0.0 mask 255.255.255.0 gateway 192.168.1.2</code> </pre><br>  This can only be done on one subnet, that is, you cannot immediately forward it to the address 192.168.0.2 or 192.168.0.3 <br><br>  This is necessary so that the router knows where the 192.168.0.0/24 subnet is located (learn the basics of networks, this is useful). <br><br>  Now we add the probros of port 3306 (the mysql port is defaulted (if you just did not change it during installation)) to the address 192.168.1.2 <br><br><img src="https://habrastorage.org/webt/es/av/3b/esav3bmwqprghssdh6oeslgo4ik.jpeg"><br><br>  It remains to do the most difficult thing is to do forwarding on a Linux machine (there are two network cards 192.168.1.2 on it (interface enp3s1) and 192.168.0.2 (interface enp3s0) so that network cards know what to transfer them from 192.168.1.2 to 192.168.0.2, and then to our windows machine with mysql. <br><br><pre> <code class="bash hljs">sudo iptables -A FORWARD -i enp3s1 -o enp3s0 -p tcp --syn --dport 3306 -m conntrack --ctstate NEW -j ACCEPT sudo iptables -A FORWARD -i enp3s1 -o enp3s0 -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT sudo iptables -A FORWARD -i enp3s0 -o enp3s1 -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT sudo iptables -t nat -A PREROUTING -i enp3s1 -p tcp --dport 3306 -j DNAT --to-destination 192.168.0.3 sudo iptables -t nat -A POSTROUTING -o enp3s0 -p tcp --dport 3306 -d 192.168.0.3 -j SNAT --to-source 192.168.1.2              sudo service iptables-persistent save</code> </pre><br>  Those.  The 1st line means that we accept the first connection, the 2nd and 3rd that you can send packets on both sides, the 4th and 5th means replacing the destination address and source.  And voila, you can connect from home through mysql.  And finally, my C ++ code that does this: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//DataBaseConnection.cpp #include "DataBaseConnection.h" DataBaseConnection::DataBaseConnection() { } void DataBaseConnection::Connect() { //    conn = mysql_init(NULL); if (conn == NULL) { //     ‚Äì     fprintf(stderr, "Error: can'tcreate MySQL-descriptor\n"); //exit(1); //    } //    if (!mysql_real_connect(conn, "192.168.0.3", "root", "password", "your_base", NULL, NULL, 0)) { //        //       fprintf(stderr, "Error: can't connect to database: %s\n", mysql_error(conn)); } else { //       - "Success!" fprintf(stdout, "Success!\n"); } } std::vector&lt;std::string&gt; DataBaseConnection::Query() { vectordrum.clear(); std::string query = "SELECT * FROM drum where id=0"; const char * q = query.c_str(); qstate = mysql_query(conn, q); if (!qstate) { res = mysql_store_result(conn); while (row = mysql_fetch_row(res)) { //printf("ID: %s,Position: %s, Image: %s\n", row[0], row[1], row[2]); vectordrum.push_back(row[2]); } } else { std::cout &lt;&lt; "Query failed:" &lt;&lt; mysql_error(conn) &lt;&lt; std::endl; } return vectordrum; } void DataBaseConnection::Close() { //       mysql_close(conn); } DataBaseConnection::~DataBaseConnection() { vectordrum.clear(); } //DataBaseConnection.h #pragma once #include &lt;iostream&gt; #include &lt;mysql.h&gt; #include &lt;vector&gt; #pragma comment(lib,"mysqlcppconn.lib") #pragma comment(lib,"libmysql.lib") class DataBaseConnection { public: DataBaseConnection(); void Connect(); std::vector&lt;std::string&gt; Query(); void Close(); ~DataBaseConnection(); MYSQL *conn; MYSQL_ROW row; MYSQL_RES *res; int qstate; std::vector&lt;std::string&gt; vectordrum; };</span></span></code> </pre><br>  Now you can safely drop this program to anyone, and you do not need to rewrite it to work locally. </div><p>Source: <a href="https://habr.com/ru/post/461503/">https://habr.com/ru/post/461503/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../461493/index.html">Django 3.0 will be asynchronous</a></li>
<li><a href="../461497/index.html">Modern text rendering on Linux: part 1</a></li>
<li><a href="../461499/index.html">What languages ‚Äã‚Äãto translate your game in 2019</a></li>
<li><a href="../4615/index.html">FAS vs NWT: answer for dial-up</a></li>
<li><a href="../461501/index.html">Why in the US they are investigating the work of large IT companies</a></li>
<li><a href="../461505/index.html">8 bugs of novice JavaScript developers that prevent you from becoming a professional</a></li>
<li><a href="../461507/index.html">Why did we decide to launch the Gazprom Neft corporate accelerator StartupDrive, and who has already passed it</a></li>
<li><a href="../461509/index.html">Travel Assistants: A selection of gadgets and accessories</a></li>
<li><a href="../46151/index.html">AppleJack - Mac OS X troubleshooter</a></li>
<li><a href="../461511/index.html">Python Dependency Management: A Comparison of Approaches</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>