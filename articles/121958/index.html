<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About blocks and their use in Objective-C part 3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Just like in the topic - ‚ÄúAbout blocks and their use in Objective-C part 2‚Äù , we will continue to talk about the advantages of using blocks with live ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About blocks and their use in Objective-C part 3</h1><div class="post__text post__text-html js-mediator-article">  Just like in the topic - <a href="http://habrahabr.ru/blogs/macosxdev/120869/">‚ÄúAbout blocks and their use in Objective-C part 2‚Äù</a> , we will continue to talk about the advantages of using blocks with live examples. <br>  Here we look at the usability of blocks when managing a sequence of operations. <br><br><h5>  5. UIView animation, sequence of animations. </h5><br>  To begin with, we will write a simple example in which we will move a button using animations (without blocks).  Then we change the order of the animations to see what changes will be needed in the code. <br><a name="habracut"></a><br><h6>  Step 1 </h6><br>  Create four animations: "move the button up", "... down", "... to the right" and "... left".  Accordingly, in the methods: moveUpAnimation, moveDownAnimation, moveRightAnimation and moveLeftAnimation. <br>  Here is an example of one of the animations: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">static</font> <font color="#0000ff">const</font> CGFloat button_offset_ = 20.f; <br> <br> -( <font color="#0000ff">void</font> )moveUpAnimation <br> { <br> [ UIView beginAnimations: nil context: nil ]; <br> <br> CGFloat new_y_ = self.animatedButton.frame.origin.y <br> - ( self.view.frame.size.height - button_offset_ * 2 ) <br> + self.animatedButton.frame.size.height; <br> self.animatedButton.frame = CGRectMake( self.animatedButton.frame.origin.x <br> , new_y_ <br> , self.animatedButton.frame.size.width <br> , self.animatedButton.frame.size.height ); <br> <br> [ UIView commitAnimations ]; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Then write the code in such a way that these four animations move the button along the contour of the screen in a clockwise direction.  Performing these animations is simply sequential: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">-(IBAction)animateButtonAction:( id )sender_ <br> { <br> [ self moveUpAnimation ]; <br> [ self moveRightAnimation ]; <br> [ self moveDownAnimation ]; <br> [ self moveLeftAnimation ]; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  will give nothing.  We will only see the latest animation.  The correct solution is to run the next animation at the end of the previous one.  To implement our plans, we need to set the animation <a href="http://developer.apple.com/library/ios/documentation/uikit/reference/uiview_class/uiview/uiview.html">delegate</a> and, in the context of the animation, transfer information about the next animation.  In the delegate, perform the following animation from the context.  For example: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// ()     </font> <br> @ <font color="#0000ff">interface</font> JFFNextAnimation : NSObject <br> <br> @property ( nonatomic, retain ) UIViewAnimationsExampleViewController* controller; <br> @property ( nonatomic, assign ) SEL nextAnimationSelector; <br> <br> @end <br> <br> -( <font color="#0000ff">void</font> )moveUpAnimation <br> { <br> JFFNextAnimation* next_animation_ = [ JFFNextAnimation <font color="#0000ff">new</font> ]; <br> <font color="#008000">//    </font> <br> next_animation_.controller = self; <br> next_animation_.nextAnimationSelector = @selector( moveRightAnimation ); <br> <font color="#008000">//      </font> <br> [ UIView beginAnimations: nil context: next_animation_ ]; <br> <br> CGFloat new_y_ = self.animatedButton.frame.origin.y <br> - ( self.view.frame.size.height - button_offset_ * 2 ) <br> + self.animatedButton.frame.size.height; <br> self.animatedButton.frame = CGRectMake( self.animatedButton.frame.origin.x <br> , new_y_ <br> , self.animatedButton.frame.size.width <br> , self.animatedButton.frame.size.height ); <br> <br> <font color="#008000">//  </font> <br> [ UIView setAnimationDelegate: self ]; <br> <br> [ UIView commitAnimations ]; <br> } <br> <br> <font color="#008000">// moveDownAnimation, moveRightAnimation  moveLeftAnimation </font> <br> -( <font color="#0000ff">void</font> )animationDidStop:( NSString* )animation_id_ <br> finished:( NSNumber* )finished_ <br> context:( <font color="#0000ff">void</font> * )context_ <br> { <br> <font color="#008000">//  </font> <br> JFFNextAnimation* context_object_ = context_; <br> [ context_object_.controller performSelector: context_object_.nextAnimationSelector ]; <br> [ context_object_ release ]; <br> } <br> <br> -(IBAction)animateButtonAction:( id )sender_ <br> { <br> <font color="#008000">//    </font> <br> [ self moveUpAnimation ]; <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Now everything works correctly.  But let's say we want an animation of moving the button not clockwise, but counterclockwise.  Then we will need to change the code of each of the methods moveUpAnimation, moveDownAnimation, moveRightAnimation and moveLeftAnimation.  This is not very convenient, so we will rewrite our code so that this task is easier to solve. <br><br><h6>  Step 2 </h6><br>  Change the sequence of animation calls.  To begin with, let's keep in context not the selector of the next animation, but all the animations that need to be performed after the current one: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">@ <font color="#0000ff">interface</font> JFFNextAnimation : NSObject <br> <br> @property ( nonatomic, retain ) UIViewAnimationsExampleViewController* controller; <br> <font color="#008000">//  ,         </font> <br> @property ( nonatomic, retain ) NSMutableArray* nextAnimations; <br> <br> @end</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The code for the moveUpAnimation, moveDownAnimation, moveRightAnimation, and moveLeftAnimation methods also need to be changed: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">//     ,      </font> <br> <font color="#008000">//    </font> <br> -( <font color="#0000ff">void</font> )moveUpAnimationWithNextAnimation:( JFFNextAnimation* )next_animation_ <br> { <br> [ UIView beginAnimations: nil context: next_animation_ ]; <br> <br> CGFloat new_y_ = self.animatedButton.frame.origin.y <br> - ( self.view.frame.size.height - button_offset_ * 2 ) <br> + self.animatedButton.frame.size.height; <br> self.animatedButton.frame = CGRectMake( self.animatedButton.frame.origin.x <br> , new_y_ <br> , self.animatedButton.frame.size.width <br> , self.animatedButton.frame.size.height ); <br> <br> [ UIView setAnimationDelegate: self ]; <br> <br> [ UIView commitAnimations ]; <br> } <br> <br> // moveDownAnimation, moveRightAnimation  moveLeftAnimation </font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The animation delegate also needs to be redone: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">-( <font color="#0000ff">void</font> )animationDidStop:( NSString* )animation_id_ <br> finished:( NSNumber* )finished_ <br> context:( <font color="#0000ff">void</font> * )context_ <br> { <br> <font color="#008000">//   -    </font> <br> <font color="#0000ff">if</font> ( !context_ ) <br> <font color="#0000ff">return</font> ; <br> <br> JFFNextAnimation* context_object_ = context_; <br> <br> <font color="#008000">//   </font> <br> NSString* next_animation_string_ = [ context_object_.nextAnimations objectAtIndex: 0 ]; <br> next_animation_string_ = [ [ next_animation_string_ retain ] autorelease ]; <br> <font color="#008000">//    </font> <br> [ context_object_.nextAnimations removeObjectAtIndex: 0 ]; <br> <br> SEL next_animation_sel_ = NSSelectorFromString( next_animation_string_ ); <br> <br> <font color="#0000ff">if</font> ( [ context_object_.nextAnimations count ] == 0 ) <br> { <br> <font color="#008000">//    </font> <br> <font color="#008000">//    </font> <br> [ context_object_.controller performSelector: next_animation_sel_ <br> withObject: nil ]; <br> <font color="#008000">// </font> <br> [ context_object_ release ]; <br> } <br> <font color="#0000ff">else</font> <br> { <br> <font color="#008000">//    </font> <br> [ context_object_.controller performSelector: next_animation_sel_ <br> withObject: context_object_ ]; <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  And of course, the result for which we worked, now the sequence of animations is easy to change: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">-(IBAction)animateButtonAction:( id )sender_ <br> { <br> JFFNextAnimation* next_animation_ = [ JFFNextAnimation <font color="#0000ff">new</font> ]; <br> next_animation_.controller = self; <br> <font color="#008000">//      </font> <br> next_animation_.nextAnimations = [ NSMutableArray arrayWithObjects: <br> <font color="#A31515">@"moveUpAnimationWithNextAnimation:"</font> <br> , <font color="#A31515">@"moveLeftAnimationWithNextAnimation:"</font> <br> , <font color="#A31515">@"moveDownAnimationWithNextAnimation:"</font> <br> , nil ]; <br> <br> <font color="#008000">//  </font> <br> [ self moveRightAnimationWithNextAnimation: next_animation_ ]; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  All code for the results can be found at <a href="">gihub</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6>  Results: </h6><br>  The task at the beginning of the topic, we certainly decided.  But the cost of the solution is high, the code is insecure (strings instead of selectors), complicated (the confusing logic of the delegate of the selector and the management of the context memory), is error-prone.  We will try to partially correct the situation using (of course, according to the name of the topic) blocks.  So‚Ä¶ <br><br><h6>  Step 3 </h6><br>  We rewrite animations using block api.  The first thing we can do is remove the context animation class - JFFNextAnimation and the delegate animation method; they won't be useful to us anymore.  The moveUpAnimation method is simplified to the following form: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">-(JFFSimpleBlock)moveUpAnimationBlock <br> { <br> <font color="#0000ff">return</font> [ [ ^ <br> { <br> CGFloat new_y_ = self.animatedButton.frame.origin.y <br> - ( self.view.frame.size.height - button_offset_ * 2 ) <br> + self.animatedButton.frame.size.height; <br> self.animatedButton.frame = CGRectMake( self.animatedButton.frame.origin.x <br> , new_y_ <br> , self.animatedButton.frame.size.width <br> , self.animatedButton.frame.size.height ); <br> } copy ] autorelease ]; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Add an auxiliary method creating a block that performs the animation: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">//      </font> <br> <font color="#008000">//       </font> <br> -(JFFSimpleBlock)animationBlockWithAnimations:( JFFSimpleBlock )animations_ <br> completion:( JFFSimpleBlock )completion_ <br> { <br> <font color="#008000">// ,    </font> <br> <font color="#008000">//          </font> <br> completion_ = [ [ completion_ copy ] autorelease ]; <br> <font color="#0000ff">return</font> [ [ ^ <br> { <br> [ UIView animateWithDuration: 0.2 <br> animations: animations_ <br> completion: ^( BOOL finished_ ) <br> { <br> <font color="#0000ff">if</font> ( completion_ ) <br> completion_(); <br> } ]; <br> } copy ] autorelease ]; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  And we define the sequence of the animations themselves: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">-(IBAction)animateButtonAction:( id )sender_ <br> { <br> <font color="#008000">//    ,   ,    </font> <br> JFFSimpleBlock move_left_animation_block_ = [ self moveLeftAnimationBlock ]; <br> <font color="#008000">//completion: -    ,     </font> <br> move_left_animation_block_ = [ self animationBlockWithAnimations: move_left_animation_block_ <br> completion: nil ]; <br> <br> JFFSimpleBlock move_down_animation_block_ = [ self moveDownAnimationBlock ]; <br> <font color="#008000">//completion: -     - "move left"</font> <br> move_down_animation_block_ = [ self animationBlockWithAnimations: move_down_animation_block_ <br> completion: move_left_animation_block_ ]; <br> <br> JFFSimpleBlock move_right_animation_block_ = [ self moveRightAnimationBlock ]; <br> <font color="#008000">//completion: -     - "move down"</font> <br> move_right_animation_block_ = [ self animationBlockWithAnimations: move_right_animation_block_ <br> completion: move_down_animation_block_ ]; <br> <br> <font color="#008000">//      </font> <br> JFFSimpleBlock move_up_animation_block_ = [ self moveUpAnimationBlock ]; <br> <font color="#008000">//completion: -     - "move right"</font> <br> move_up_animation_block_ = [ self animationBlockWithAnimations: [ self moveUpAnimationBlock ] <br> completion: move_right_animation_block_ ]; <br> <br> <font color="#008000">//    </font> <br> move_up_animation_block_(); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Now, as in the previous example (animations without blocks), we will try to change the sequence of animation calls.  Fortunately, this is not as difficult as it was in our very first example, but we will not stop there. <br><br><h6>  Step 4 </h6><br>  Let's go a little ahead and look at the <a href="">sequenceOfAsyncOperations</a> function.  This function takes several blocks that abstract asynchronous operations, in the form of arguments, and returns a new block, which, when called, will execute the block arguments of this function in the specified order.  The block of an asynchronous operation itself is of type <a href="">JFFAsyncOperation</a> , therefore we slightly change the animationBlockWithAnimations: function according to this type: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">-(JFFAsyncOperation)animationBlockWithAnimations:( JFFSimpleBlock )animations_ <br> { <br> <font color="#0000ff">return</font> [ [ ^( JFFAsyncOperationProgressHandler progress_callback_ <br> , JFFCancelHandler cancel_callback_ <br> , JFFDidFinishAsyncOperationHandler done_callback_ ) <br> { <br> done_callback_ = [ [ done_callback_ copy ] autorelease ]; <br> [ UIView animateWithDuration: 0.2 <br> animations: animations_ <br> completion: ^( BOOL finished_ ) <br> { <br> <font color="#0000ff">if</font> ( done_callback_ ) <br> done_callback_( [ NSNull <font color="#0000ff">null</font> ], nil ); <br> } ]; <br> <font color="#008000">//   </font> <br> JFFCancelAsyncOpration cancel_block_ = ^{ <font color="#008000">/*do nothing*/</font> }; <br> <font color="#0000ff">return</font> [ [ cancel_block_ copy ] autorelease ]; <br> } copy ] autorelease ]; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  And we get the result: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">-(IBAction)animateButtonAction:( id )sender_ <br> { <br> JFFSimpleBlock move_right_animation_block_ = [ self moveRightAnimationBlock ]; <br> JFFAsyncOperation move_right_async_block_ = [ self animationBlockWithAnimations: move_right_animation_block_ ]; <br> <br> JFFSimpleBlock move_up_animation_block_ = [ self moveUpAnimationBlock ]; <br> JFFAsyncOperation move_up_async_block_ = [ self animationBlockWithAnimations: move_up_animation_block_ ]; <br> <br> JFFSimpleBlock move_left_animation_block_ = [ self moveLeftAnimationBlock ]; <br> JFFAsyncOperation move_left_async_block_ = [ self animationBlockWithAnimations: move_left_animation_block_ ]; <br> <br> JFFSimpleBlock move_down_animation_block_ = [ self moveDownAnimationBlock ]; <br> JFFAsyncOperation move_down_async_block_ = [ self animationBlockWithAnimations: move_down_animation_block_ ]; <br> <br> <font color="#008000">//    </font> <br> <font color="#008000">//   - sequenceOfAsyncOperations</font> <br> JFFAsyncOperation result_animation_block_ = sequenceOfAsyncOperations( <br> move_right_async_block_ <br> , move_up_async_block_ <br> , move_left_async_block_ <br> , move_down_async_block_ <br> , nil ); <br> <br> <font color="#008000">// ,          </font> <br> result_animation_block_( nil, nil, nil ); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  On <a href="">gihub</a> you can see all the received code. <br><br>  That's all for now.  Thanks for attention.  If this topic is interesting, then in the next article I will try to talk about managing asynchronous operations using blocks. </div><p>Source: <a href="https://habr.com/ru/post/121958/">https://habr.com/ru/post/121958/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../121949/index.html">Report on meeting Apple Developers Community # 5</a></li>
<li><a href="../121950/index.html">Karatsuba algorithm for multiplying two numbers</a></li>
<li><a href="../121953/index.html">How we implemented business processes and why we need it at all</a></li>
<li><a href="../121954/index.html">Nokia Developer Day in Rostov-on-Don</a></li>
<li><a href="../121955/index.html">I build websites! Like a boss</a></li>
<li><a href="../121960/index.html">The hotel sued Google for search prompts when entering the hotel name.</a></li>
<li><a href="../121961/index.html">LulzSec Group attacked the website of the CIA and the US Senate. Week Lulz Security on Habr√© continues</a></li>
<li><a href="../121963/index.html">Big update: Evernote for Windows and Mac got links to notes, copies of notes and more.</a></li>
<li><a href="../121964/index.html">What units to choose when layout</a></li>
<li><a href="../121968/index.html">Video Tour of the International Space Station</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>