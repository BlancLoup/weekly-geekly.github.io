<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Colibri-ui - our solution for automating mobile application testing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="With the growth of teams, the number of features inevitably grows, and at the same time the test model and the number of test cases that need to be ch...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Colibri-ui - our solution for automating mobile application testing</h1><div class="post__text post__text-html js-mediator-article">  With the growth of teams, the number of features inevitably grows, and at the same time the test model and the number of test cases that need to be checked during regression testing.  At the same time, the number of teams is growing for a reason, in our case business wants to be released more and more often without losing quality. <br><br>  How we solved the problem of finding a balance between speed, budget and quality at Alfa Labs will be discussed today with the example of Alfa Mobile.  Looking ahead, ATTENTION, SPOILER !!!  Our solution is available on github: the <a href="https://github.com/alfa-laboratory/colibri-ui">colibri-ui</a> library and the <a href="https://github.com/alfa-laboratory/colibri-ui-template">colibri-ui-template template</a> for a quick start. <br><br>  <i>Pavel <a href="https://habrahabr.ru/users/pvivanov/" class="user_link">pvivanov</a> and Lilia <a href="https://habrahabr.ru/users/lidiyatullina/" class="user_link">Lidiyatullina</a> took an active part in writing the article <a href="https://habrahabr.ru/users/lidiyatullina/" class="user_link">.</a></i> <i><br></i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <a href="https://habrahabr.ru/company/alfa/blog/335278/"><img src="https://habrastorage.org/web/a33/cef/b83/a33cefb837cd46c1a29d62c6d0257019.jpg"></a> <br><br><h2>  What happened? </h2><br>  Back in 2013, we didn‚Äôt even have thoughts about testing automation, because the regression testing process took one day for one of the testers for both OSes (iOS / Android). <br><br>  However, with the active growth of the application, the addition of new services and services to it, the cost of manual testing also began to grow at a high rate. <br><a name="habracut"></a><br>  Add to this the increase in the number of teams (from one to six) that constantly produce new features - and regression testing will become a thrombus of your processes, which runs the risk of breaking off and jeopardizing production. <br><br>  At some point, we came to the conclusion that at the time of preparing the application for release, all six teams were ‚Äúidle‚Äù, until all six testers were releasing the release candidate.  In time equivalent, the duration of regression testing increased to 8 working days (six people!). <br><br>  This situation does not add motivation to the testers themselves.  At a certain point, we even had a joke ‚ÄúRegress like a holiday!‚Äù <br><br><h2>  What to do? </h2><br>  The problem needed to be solved somehow, and we had two ways to ‚Äúattach bablishko‚Äù: <br><br><ul><li>  bringing new people into the ranks of testers; </li><li>  test automation to eliminate manual testing. </li></ul><br>  For ethical and economic reasons, we chose the second option, after all, the cost of automation, whatever one may say, is a much more profitable investment. <br><br>  We decided to start the movement in the chosen direction with a pilot project for automating the testing of mobile applications.  Based on its results, we have formed requirements for the future instrument: <br><br><ol><li>  A test automation tool should be with the lowest possible entry threshold to start using it. <br>  It's about minimizing coding, getting rid of writing complex locators, etc., because the main users of the tool are testers from product teams who may not have automation experience. </li><li>  Test scripts should be clear to non-development users; </li><li>  The solution should be cross-platform and work simultaneously on two platforms - Android and iOS; </li><li>  A farm must be formed with a connected set of mobile devices; </li><li>  The solution should be scalable to other mobile applications of the bank. </li></ol><br>  Based on the received requirements, an automation tool was to be selected. <br>  In the framework of the pilot project, we considered: <br><br><ul><li>  Robotium </li><li>  Espresso </li><li>  Ui recorder </li><li>  Keep it Functional </li><li>  Calabash </li><li>  Appium </li></ul><br>  The requirement for cross-platform solutions narrowed down the choice to the last pair from the list.  The final choice was made in favor of Appium due to a more active community involved in development and support. <br><br><h2>  Reducing the threshold of entry into the development </h2><br>  Automating any process at the bottom level is scripts and code.  However, not everyone can understand the development tools or even write something on their own.  That is why we decided to maximally simplify this moment using the BDD-methodology on projects. <br><br>  Our framework is divided into several levels of abstraction, where the upper level is written in the popular test writing language Gherkin, and the lower level is written by developers in the Java programming language.  JBehave was chosen for writing scripts. <br><br>  So, what does our solution look like from the user? <br><br><pre><code class="java hljs">Then   <span class="hljs-string"><span class="hljs-string">" "</span></span> When   <span class="hljs-string"><span class="hljs-string">" "</span></span>  <span class="hljs-string"><span class="hljs-string">"  "</span></span> When    <span class="hljs-string"><span class="hljs-string">"  "</span></span> Then   <span class="hljs-string"><span class="hljs-string">"  "</span></span> When   <span class="hljs-string"><span class="hljs-string">"   "</span></span>  <span class="hljs-string"><span class="hljs-string">" "</span></span> When    <span class="hljs-string"><span class="hljs-string">" "</span></span></code> </pre> <br>  This example describes the transition process from the main screen to the mobile payment screen.  Maybe someone will argue that from the point of view of the business process, it does not matter to him which way he gets to the desired screen, and he will be right.  Indeed, nothing prevents us from going to the desired section, replacing the last five lines of the previous scenario with one, for example, like this: <br><br><pre> <code class="java hljs">When    <span class="hljs-string"><span class="hljs-string">" "</span></span></code> </pre> <br>  However, such steps will be less atomic and it will be more difficult to reuse them on two platforms at once, iOS and Android.  After all, when we want to lower the threshold for entering the development, we need to reuse the current steps as much as possible, otherwise the tester will always need new ones and, as a result, their implementation.  And here, as we remember, the tester does not always have the necessary development skills. <br><br><h2>  We describe the screens </h2><br>  If everything is extremely clear with the script, he reads "from the sheet" and describes our actions, then how can we specify the locators, while trying not to use them explicitly? <br><br>  One way to accomplish the task of reducing the entry threshold is to simplify writing complex locators and hide everything in the project more deeply.  Thus, two factories were born that allow us to create a locator by description and use it for searching.  Unfortunately, it is not always possible to do without writing locators, in rare cases it is necessary to write it.  For such situations, we left the possibility to find an element by XPath. <br><br>  The description of the elements on the screen can consist of four components.  All four components are never used, but two may well be used, for example, in the case when you first need to scroll to an element, and then click on it. <br><br><h3>  The components of the description of the page as a set of elements: </h3><br><br><ul><li>  <b>Content description</b> - by this identifier you can find items on Android; </li><li>  <b>ResourceId / AccessabilityIdeitificator</b> is a unique identifier.  Sometimes application developers do not put identifiers, but this is the most desirable element that we can find in the markup of an Android / iOS application, respectively; </li><li>  <b>Text</b> - visible text, for example, on a button that we can click on; </li><li>  <b>XPath</b> is a regular XPath with xml markup.  It is used in cases when the previous three methods unambiguously describe the element failed. </li></ul><br>  We will use the name of the element (Name in story) in the script, we will use it to pull out Content description / ResourceId / AccessabilityIdeitificator / Text / XPath. <br><br>  All the descriptions we collect in .csv files, where you can conveniently edit them in a table form.  On the one hand, this is the usual PageObject, and on the other hand, our testers do not have to edit the locators in the code. <br><br><img src="https://habrastorage.org/web/610/670/024/610670024d12494293e5de6a66fd0805.png"><br><br>  It seems that much easier!  We described the screen, wrote the script, launched autotests, but let's talk a bit about non-trivial tasks and look at our colibri-ui framework from the inside. <br><br><h2>  Customize the environment </h2><br>  When working with Appium, it is always necessary to indicate which mobile device we want to work with.  In our solution, you need to transfer to the project the udid device (unique identifier) ‚Äã‚Äãand its name.  The name will also be mentioned in the logs if something goes wrong.  Note that with the help of udid, our project will work with the desired mobile device, because we have a whole farm and all of them are connected to one Mac. <br><br>  Currently, descriptions of mobile devices are stored as a set of folders, each of which contains settings files such as .property and json-object.  The file type .property contains the udid and device name, the json object describes the node settings for operation in cluster mode (see the colibri-ui-template template). <br><br>  <i>A small offtop, or how to get udid connected devices!</i> <br><br>  For Android, we run ‚Äúadb devices‚Äù in the console, for iOS, ‚Äúinstruments -s devices | grep -v (Simulator | $ (id -un))‚Äù and get a list of connected devices.  In the case of Android, the list will contain both real devices and emulators, while for iOS we only filter real devices.  If someone needs to get only emulators, another filtering ‚Äúinstruments -s devices |  grep simulator. <br><br>  We plan to transfer this set of folders to the database or to another storage, or to receive the list dynamically, executing the above commands in the process of building the environment.  We currently have no need for such an improvement. <br><br>  Additionally, we note that for the above commands to work, ADB Driver and Xcode must be installed on your Mac, respectively.  When working with emulators, also do not forget to deflate their images. <br><br><h2>  We describe the user </h2><br>  To date, we have taken into account all that is necessary to run the project in the simplest mode.  We have scripts, screen descriptions and device descriptions.  However, in applications that we test, this is not enough.  In our applications, you need to log in to a test stand by some user and use its credentials, such as: phone number, login, password, account numbers, etc. <br><br>  Files with user credentials are also in the project as a separate folder.  In the future, as well as with devices, transfer them to the database or centralized storage. <br>  In scripts and descriptions of pages, we use markers of the form # userName #, by which we get the property value from the user file and replace these markers during the run. <br><br>  Thus, we can run the same set of scenarios on different users, including at the same time. <br><br>  This is how it looks in the page description: <br><br><img src="https://habrastorage.org/web/e45/45e/aa8/e4545eaa8ea64adf80ad22397e2a3415.png"><br><br>  This is how it looks in the user.property file: <br><br><pre> <code class="java hljs">paymentAccountRur=¬∑¬∑<span class="hljs-number"><span class="hljs-number">0278</span></span> beneficiarAccountRur=¬∑¬∑<span class="hljs-number"><span class="hljs-number">0163</span></span> beneficiarAccountUsd=¬∑¬∑<span class="hljs-number"><span class="hljs-number">0889</span></span> beneficiarAccountEur=¬∑¬∑<span class="hljs-number"><span class="hljs-number">0038</span></span></code> </pre> <br>  Be sure to specify the keys and values. <br><br><h2>  We form Uber-steps and some side effects </h2><br>  We started the development by describing fairly small steps, such as typing text or clicking on something.  Over time, we realized that we could not write scripts in small steps, or write complex steps, for example, to return to the main screen, without duplicating the code.  Thus began the search for a solution to reuse small steps into larger ones. <br>  The first attempt was to add guiCe to the project, for organizing DI, but its implementation brought with it the processing of almost the entire project core.  And since the dependencies, right in the appium-java-client, already have Spring, for us the solution became obvious and our next step was to introduce Spring. <br><br>  When introducing Sping into our project, the amount of change was minimal.  At the very depth of the project, only the JBeHave steps factory and a couple of lines in the Allure report connection have changed.  Almost all classes were declared components and removed most of the dependencies. <br><br>  The effect of the implementation was not only the steps of the designers, in which we can reuse smaller actions, but also the ability to make general decisions to the library (the link to the githab was at the very beginning).  For us, this is relevant, because we use this solution on several mobile projects. <br><br>  Well, the most unusual effect is that we can write tests for tests.  No matter how ridiculous and clumsy it may sound, but much also depends on the quality of the instrument, so it must also be maintained and developed.  At the moment, work on the coating is still underway.  With the introduction of changes to the core of the project, we will expand the test coverage inside the library. <br><br><h2>  Run the project </h2><br>  As already mentioned, we run our project on a specific set of devices in parallel. <br>  An example of running a project from the console: <br><br><pre> <code class="java hljs">./gradlew --info clean test --tests <span class="hljs-string"><span class="hljs-string">"*AndroidStories*"</span></span> -Dorg.gradle.project.platform=Nexus6p_android6 -Dorg.gradle.project.user=<span class="hljs-number"><span class="hljs-number">6056789</span></span> -Dorg.gradle.project.testType=smokeNewReg -Dorg.gradle.project.buildVersion=<span class="hljs-number"><span class="hljs-number">9.0</span></span>.0.7,development</code> </pre> <br>  From the example, it is clear that tests are run for Android (- tests "* AndroidStories *").  Also as parameters are passed: <br><br>  The device on which the test run will run, Nexus6p_android6.  Do not forget to describe the device in the project, we wrote about it above.  This is how it is done with us. <br><br>  The device.properties file contains: <br><br><pre> <code class="java hljs">UDID=ENU14008659 deviceName=Nexus6p</code> </pre> <br>  The test_node.json file contains data for running the node. <br><br>  Test user 6056789, whose data we will use.  There is a whole set of test users on the project that we use to run our tests.  The user must be described in user.properties. <br><br>  Type of testing smokeNewReg, in our framework the logic of choosing test scripts for <a href="https://habrahabr.ru/users/meta/" class="user_link">Meta</a> tags is implemented.  In each script in the <a href="https://habrahabr.ru/users/meta/" class="user_link">Meta</a> block there is a set of tags. <br><br><pre> <code class="java hljs">Meta: <span class="hljs-meta"><span class="hljs-meta">@regressCycle</span></span> <span class="hljs-meta"><span class="hljs-meta">@smokeCycle</span></span></code> </pre> <br>  The testCycle.properties file contains the keys and values ‚Äã‚Äãfor the labels. <br><br><pre> <code class="java hljs">smoke=+smokeCycle,+oldRegistration,-skip smokeNewReg=+smokeCycle,+newRegistrationCardNumber,-skip smokeNewAccountReg=+smokeCycle,+newRegistrationAccountNumber,-skip regress=+regressCycle,+oldRegistration,-skip regressNewReg=+regressCycle,+newRegistrationCardNumber,-skip</code> </pre> <br>  Thus, due to the presence of the Meta Matcher in JBehave, we can form a set of test scenarios for a specific testing cycle. <br><br>  The build number that we download from the centralized repository, and the branch from which the build will be downloaded.  In our case, the environmentAndroid.properties file contains a link with wildcard characters, which is formed based on the parameters, which in turn are passed to the input from the console. <br><br><pre> <code class="java hljs">remoteFilePathReleaseAndDevelopment=http:<span class="hljs-comment"><span class="hljs-comment">//mobile/android/mobile-%2$s/%1$s/mobile-%2$s-%1$s.apk</span></span></code> </pre> <br>  Now, knowing how to start a project from the console, you can easily integrate the project into Jenkins.  There is such an integration on our projects, and it is enough for the tester to simply form a job in Jenkins to run autotests. <br><br>  Now also formed a farm with mobile devices.  This is a Mac Pro with about ten mobile devices connected to it. <br><br><h2>  We form the report </h2><br>  In our project, a report is generated using the allure report.  Therefore, after the tests have completed, it is enough to run ‚Äúallure generate directory-with-results‚Äù <br><br>  In the report we can see the statuses for each scenario.  If you start to open scripts in a report, then you can find the steps that you took the test, almost before calling each method.  If something collapsed, in a step with an error inside there will be a screenshot of the screen. <br><br>  Previously, the screenshots were in each step, but we thought it was meaningless, and the screen is only on collapsed scenarios.  In addition, as the number of automated scripts grows, the report begins to take up more and more space. <br><br><h2>  The result we got </h2><br>  Let's summarize the tasks we set for ourselves. <br><br><ol><li>  We managed to make a tool to automate testing with a rather low threshold for entering the development.  On average, as practice has shown, a tester needs two weeks to confidently start writing and running autotests.  Testers are most challenged by the appium setup environment. </li><li>  Test scripts are understood by all team members, this is especially important when your project uses the BDD methodology. </li><li>  Our framework can work simultaneously with two platforms - iOS and Android. </li><li>  We currently have a farm of ten mobile devices and a Mac Pro.  The project is integrated with Jenkins, and any tester can run autotests in parallel on all ten devices. </li><li>  Our solution is scalable and already several mobile projects are actively working with our framework and run autotests. </li></ol><br>  As a bonus: <br><br><ol><li>  At one of the mobile projects due to automation, we completely relieved the functional testers from testing the front for backward compatibility with backend.  After the introduction of automation, the testing time in this case was reduced by 8 times (from 8 hours to 1 hour). </li><li>  New autotests are written by testers in the sprint along with the development of new functionality in mobile applications; </li><li>  Part of the regression testing is already automated, as a result - we have reduced the time to regress from 8 days to 1 day.  This allowed us to be released more often, and testers stopped falling out of teams for the period of regression testing.  Well, just become a little happier :) </li></ol><br>  The results met our expectations and confirmed the correctness of the decision to go into automation. <br><br>  We continue to develop our solution, which is available on github: the <a href="https://github.com/alfa-laboratory/colibri-ui">colibri-ui</a> library and the <a href="https://github.com/alfa-laboratory/colibri-ui-template">colibri-ui-template template</a> for a quick start.  Further only more! <br><br>  If you want to become one of the Alfa Lab <a href="http://bit.ly/2v2rlIC0408">testers</a> (or not just a tester) - we have open <a href="http://bit.ly/alfavacancies1008">vacancies</a> . </div><p>Source: <a href="https://habr.com/ru/post/335278/">https://habr.com/ru/post/335278/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335264/index.html">Digitalization and what kind of beast</a></li>
<li><a href="../335266/index.html">Materialize the search results, or how we released 25 processor cores</a></li>
<li><a href="../335270/index.html">YouTrack 2017.3 release: JavaScript workflow automation, improved Kanban support, and more</a></li>
<li><a href="../335272/index.html">12 useful sites for creative teams</a></li>
<li><a href="../335276/index.html">Analysis of Nikita Makarov's report on a revolver, mnemonic, warehouse manager and other useful things.</a></li>
<li><a href="../335280/index.html">Oh, My Code - a new program about IT management on the Technostrim channel</a></li>
<li><a href="../335282/index.html">The digest of reports from mitap at office of Mail.Ru Group</a></li>
<li><a href="../335284/index.html">Where is the best to live and work developer</a></li>
<li><a href="../335286/index.html">How to increase chances when looking for a job and get maximum invitations for promising interviews with minimum time</a></li>
<li><a href="../335288/index.html">8 some strange myths about HR-technology</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>