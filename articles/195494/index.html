<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We hunt for memory leaks in Node.js (1st of 12 articles on Node.js from the Mozilla Identity team)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From the translator: This is the first article from the cycle about Node.js from the Mozilla Identity team that deals with the Persona project. Both t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We hunt for memory leaks in Node.js (1st of 12 articles on Node.js from the Mozilla Identity team)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/351/21a/1b3/35121a1b38983c052d44793888b1dced.jpg" align="left">  <i><b>From the translator:</b> This is the first article from the <a href="https://hacks.mozilla.org/category/a-node-js-holiday-season/">cycle about Node.js</a> from the Mozilla Identity team that deals with the <a href="http://ru.wikipedia.org/wiki/Mozilla_Persona">Persona</a> project.</i>  <i>Both the client and server parts of Persona are written in JavaScript.</i>  <i>During the work, the project team created several tools for all occasions - from localization to debugging, dependency management, and more.</i>  <i>In this series of articles, Mozilla developers share their experience and these tools with the community, which will be useful to anyone who writes a high-load service on Node.js.</i> <i><br><br></i>  <i>The first article in the series is devoted to the common Node.js problem - memory leaks, features of leaks in high-load projects, and the node-memwatch library, which helps to find and fix such leaks in Node.</i> <i><br></i> <div class="spoiler">  <b class="spoiler_title">All articles of the cycle:</b> <div class="spoiler_text"><ol><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/195494/">Hunting for memory leaks in Node.js</a> " </li><li>  "We <a href="http://habrahabr.ru/company/nordavind/blog/195686/">load Node to the eyeballs</a> " </li><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/196018/">Store the session on the client to simplify application scaling</a> " </li><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/196358/">Frontend performance. Part 1 - concatenation, compression, caching</a> " </li><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/196518/">We write a server that does not fall under load</a> " </li><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/196818/">Frontend performance. Part 2 - we cache dynamic content using etagify</a> " </li><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/197166/">Taming Web Application Configurations with node-convict</a> " </li><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/197370/">Frontend performance. Part 3 - font optimization</a> " </li><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/197566/">Localization of Node.js Applications. Part 1</a> " </li><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/198154/">Localization of Node.js Applications. Part 2: Toolkit and Process</a> " </li><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/198252/">Localization of Node.js Applications. Part 3: Localization in Action</a> " </li><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/198590/">Awsbox - PaaS infrastructure for deploying Node.js applications in the Amazon cloud</a> " </li></ol><br></div></div><br><br><hr><br><h4>  Why bother? </h4><br>  You may ask, why monitor memory leaks at all?  Are there no more important things?  Why not just restart the process from time to time, or just add memory to the server?  There are three reasons why it is important to fix leaks: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  You may not be too worried about memory leaks, but this is not the case with V8 (the JavaScript engine that runs Node).  The more memory is occupied, the more actively the garbage collector works, slowing down your application.  So node leaks directly hurt performance. </li><li>  Leaks can lead to other problems.  Leaking code can block limited resources.  You may run out of file descriptors, or you suddenly will not be able to open another database connection.  Such problems may occur long before the memory runs out, but will bring down your application no worse. </li><li>  Sooner or later your application will fall.  And this is sure to happen during the influx of visitors.  Everybody will laugh at you and write bad things about you on Hacker News. </li></ol><br><a name="habracut"></a><br><h4>  Where does the sound of falling drops come from? </h4><br>  In a complex application there are many places where leaks can occur.  Probably the most famous and most painful place - the circuit.  Since closures can store references to variables from their scope for a long time, they become the most frequent leakage site. <br><br>  Some leaks can be detected sooner or later simply by looking for them in the code, but in the asynchronous world of Node, we constantly create many closures in the form of callbacks.  And if they work slower than they are created, the memory fragments of each callback are piled up so that the code that does not look current at all behaves like the current one.  Such leaks are much more difficult to track down. <br><br>  An application may also flow due to an error in someone else's code on which it depends.  Sometimes you can find a place in your program that causes a leak, but it happens that you just have to look bewildered at your perfectly debugged code, wondering how it can flow at all? <br><br>  It is such difficult to track leakage that created the need for node-memwatch.  Legend has it that a long time ago, a few months ago, our programmer Lloyd Hilayel locked himself in a closet for two days trying to track down a leak that manifested itself only under a very large load (by the way, he is the author of the next article in this series devoted to load testing. ). <br><br>  After two days of searching, he discovered that the required error was in the Node core: the event handlers in <code>http.ClientRequest</code> did not free the memory properly (the patch for correcting this error added only <a href="https://github.com/vvo/node/commit/e138f76ab243ba3579ac859f08261a721edc20fe">two small, but very important characters</a> to the Node.js code).  The agony caused Lloyd to write a tool that would help find such leaks. <br><br><h4>  Leak detection tools </h4><br>  Node.js applications already have a good and ever-growing selection of tools to search for leaks.  Here are some of them: <br><br><ul><li>  Jimba Esser's <a href="https://github.com/Jimbly/node-mtrace">node-mtrace</a> , which uses the GCC mtrace utility to profile heap usage; </li><li>  Dave Pacheco's <a href="https://github.com/davepacheco/node-heap-dump">node-heap-dump</a> , which takes a snapshot of the V8 heap and writes it into a huge JSON file.  Includes tools for exploring and parsing this image with JavaScript; </li><li>  <a href="https://github.com/dannycoates/v8-profiler">v8-profiler</a> and <a href="https://github.com/dannycoates/v8-profiler">node-inspector</a> Danny Coates, based on the V8 profiler and the WebKit Web Inspector debugger; </li><li>  Felix Heisendorfer's Node <a href="https://github.com/felixge/node-memory-leak-tutorial">memory leak guide</a> , which briefly and clearly describes the basics of working with v8-profiler and node-inspector; </li><li>  Joyent SmartOS platform, which provides a whole arsenal of tools for <a href="http://dtrace.org/blogs/bmc/2012/05/05/debugging-node-js-memory-leaks/">finding and fixing leaks in Node.js.</a> </li></ul><br>  We like these and many other tools, but none of them were perfect for our environment.  Web Inspector is great for applications in development, but difficult to use in a combat, running application, especially when many servers and processes are used.  Therefore, using it is difficult to catch errors that do not appear immediately and only under a large load.  Tools like dtrace or libumem are great too, but they don‚Äôt work in all operating systems. <br><br><h4>  Meet: node-memwatch </h4><br>  We needed a cross-platform debugging library that did not require any additional tools, with which we could find places and causes of memory leaks.  And so we wrote <a href="https://github.com/lloyd/node-memwatch">node-memwatch</a> . <br><br>  It provides three things: <br><br><ul><li>  Event <code>'leak'</code> <br><pre> <code class="javascript hljs">memwatch.on(<span class="hljs-string"><span class="hljs-string">'leak'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">info</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   info,  ,    });</span></span></code> </pre><br></li><li>  Event <code>'stats'</code> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> memwatch = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'memwatch'</span></span>); memwatch.on(<span class="hljs-string"><span class="hljs-string">'stats'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stats</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//        });</span></span></code> </pre><br></li><li>  Heap diff tracking class: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> memwatch.HeapDiff(); <span class="hljs-comment"><span class="hljs-comment">//   ... var diff = hd.end();</span></span></code> </pre><br></li></ul><br>  In addition, there is a function to force a call to the garbage collector, which can be useful when testing.  That is, after all, four things, not three. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stats = memwatch.gc();</code> </pre><br><br><h4>  memwatch.on ('stats', ...): heap statistics after garbage collection </h4><br>  A node-memwatch can issue heap usage statistics immediately after the garbage collector finishes, before memory is allocated to any new objects.  To do this, use the hook <code>V8::AddGCEpilogueCallback</code> . <br><br>  The statistics include fields: <br><br><ul><li>  usage_trend </li><li>  current_base </li><li>  estimated_base </li><li>  num_full_gc </li><li>  num_inc_gc </li><li>  heap_compactions </li><li>  min </li><li>  max </li></ul><br>  Here is an example that shows how the change in memory usage statistics for a leaking application looks.  The zigzag green line shows the memory usage according to the <code>process.memoryUsage()</code> data, and the red one shows the <code>current_base</code> value from the node-memwatch statistics.  Below left are additional data. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6f9/830/66c/6f983066c15fdbb17118bf371b2d2f72.png"><br><br>  Notice how often incremental garbage collection occurs.  This is an alarming sign, indicating that the V8 has to sweat, clearing the memory. <br><br><h4>  memwatch.on ('leak', ...): memory usage dynamics </h4><br>  We use simple heuristics to warn of potential leaks.  If after five garbage collections in a row memory usage grows, a 'leak' event is triggered.  Information about a possible leak is displayed in a convenient, readable form: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">start</span></span>: Fri, <span class="hljs-number"><span class="hljs-number">29</span></span> Jun <span class="hljs-number"><span class="hljs-number">2012</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">13</span></span> GMT, <span class="hljs-attr"><span class="hljs-attr">end</span></span>: Fri, <span class="hljs-number"><span class="hljs-number">29</span></span> Jun <span class="hljs-number"><span class="hljs-number">2012</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> GMT, <span class="hljs-attr"><span class="hljs-attr">growth</span></span>: <span class="hljs-number"><span class="hljs-number">67984</span></span>, <span class="hljs-attr"><span class="hljs-attr">reason</span></span>: <span class="hljs-string"><span class="hljs-string">'heap growth over 5 consecutive GCs (20s) - 11.67 mb/hr'</span></span> }</code> </pre><br><h4>  memwatch.HeapDiff (): find leaks </h4><br>  Finally, node-memwatch can compare heap snapshots, including the names of the number of objects that take up memory.  Diff helps to find violators. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> memwatch.HeapDiff(); <span class="hljs-comment"><span class="hljs-comment">//   ... var diff = hd.end();</span></span></code> </pre><br>  The contents of the <code>diff</code> object look like this: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"before"</span></span>: { <span class="hljs-string"><span class="hljs-string">"nodes"</span></span>: <span class="hljs-number"><span class="hljs-number">11625</span></span>, <span class="hljs-string"><span class="hljs-string">"size_bytes"</span></span>: <span class="hljs-number"><span class="hljs-number">1869904</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.78 mb"</span></span> }, <span class="hljs-string"><span class="hljs-string">"after"</span></span>: { <span class="hljs-string"><span class="hljs-string">"nodes"</span></span>: <span class="hljs-number"><span class="hljs-number">21435</span></span>, <span class="hljs-string"><span class="hljs-string">"size_bytes"</span></span>: <span class="hljs-number"><span class="hljs-number">2119136</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.02 mb"</span></span> }, <span class="hljs-string"><span class="hljs-string">"change"</span></span>: { <span class="hljs-string"><span class="hljs-string">"size_bytes"</span></span>: <span class="hljs-number"><span class="hljs-number">249232</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-string"><span class="hljs-string">"243.39 kb"</span></span>, <span class="hljs-string"><span class="hljs-string">"freed_nodes"</span></span>: <span class="hljs-number"><span class="hljs-number">197</span></span>, <span class="hljs-string"><span class="hljs-string">"allocated_nodes"</span></span>: <span class="hljs-number"><span class="hljs-number">10007</span></span>, <span class="hljs-string"><span class="hljs-string">"details"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"what"</span></span>: <span class="hljs-string"><span class="hljs-string">"Array"</span></span>, <span class="hljs-string"><span class="hljs-string">"size_bytes"</span></span>: <span class="hljs-number"><span class="hljs-number">66688</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-string"><span class="hljs-string">"65.13 kb"</span></span>, <span class="hljs-string"><span class="hljs-string">"+"</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">"-"</span></span>: <span class="hljs-number"><span class="hljs-number">78</span></span> }, { <span class="hljs-string"><span class="hljs-string">"what"</span></span>: <span class="hljs-string"><span class="hljs-string">"Code"</span></span>, <span class="hljs-string"><span class="hljs-string">"size_bytes"</span></span>: <span class="hljs-number"><span class="hljs-number">-55296</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-string"><span class="hljs-string">"-54 kb"</span></span>, <span class="hljs-string"><span class="hljs-string">"+"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"-"</span></span>: <span class="hljs-number"><span class="hljs-number">57</span></span> }, { <span class="hljs-string"><span class="hljs-string">"what"</span></span>: <span class="hljs-string"><span class="hljs-string">"LeakingClass"</span></span>, <span class="hljs-string"><span class="hljs-string">"size_bytes"</span></span>: <span class="hljs-number"><span class="hljs-number">239952</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-string"><span class="hljs-string">"234.33 kb"</span></span>, <span class="hljs-string"><span class="hljs-string">"+"</span></span>: <span class="hljs-number"><span class="hljs-number">9998</span></span>, <span class="hljs-string"><span class="hljs-string">"-"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, { <span class="hljs-string"><span class="hljs-string">"what"</span></span>: <span class="hljs-string"><span class="hljs-string">"String"</span></span>, <span class="hljs-string"><span class="hljs-string">"size_bytes"</span></span>: <span class="hljs-number"><span class="hljs-number">-2120</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-string"><span class="hljs-string">"-2.07 kb"</span></span>, <span class="hljs-string"><span class="hljs-string">"+"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"-"</span></span>: <span class="hljs-number"><span class="hljs-number">62</span></span> } ] } }</code> </pre><br>  <code>HeapDiff</code> calls the garbage collector before collecting statistics so that the data do not have too much unnecessary rubbish.  However, the <code>'stats'</code> event does not occur, so you can safely call <code>HeapDiff</code> inside the <code>'stats'</code> handler. <br><br>  Here is an example of statistics to which we added a list of objects occupying the most space in the heap. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a95/dc5/b0d/a95dc5b0d22dafed516ef5e8ba1bd437.png"><br><br><h4>  What's next? </h4><br>  Node-memwatch features: <br><br><ul><li>  accurate tracking of memory usage; </li><li>  possible leak notifications; </li><li>  means to get a heap diff; </li><li>  cross-platform; </li><li>  no dependencies on other tools. </li></ul><br>  We want more.  In particular, we want node-memwatch to be able to give specific data of flowing objects ‚Äî variable names, array indices, pieces of closure code. <br><br>  We hope that the node-memwatch will be useful to you when debugging the leaking Node.js applications, you will forc it and take part in its improvement. <br><hr><br><div class="spoiler">  <b class="spoiler_title">All articles of the cycle:</b> <div class="spoiler_text"><ol><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/195494/">Hunting for memory leaks in Node.js</a> " </li><li>  "We <a href="http://habrahabr.ru/company/nordavind/blog/195686/">load Node to the eyeballs</a> " </li><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/196018/">Store the session on the client to simplify application scaling</a> " </li><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/196358/">Frontend performance. Part 1 - concatenation, compression, caching</a> " </li><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/196518/">We write a server that does not fall under load</a> " </li><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/196818/">Frontend performance. Part 2 - we cache dynamic content using etagify</a> " </li><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/197166/">Taming Web Application Configurations with node-convict</a> " </li><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/197370/">Frontend performance. Part 3 - font optimization</a> " </li><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/197566/">Localization of Node.js Applications. Part 1</a> " </li><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/198154/">Localization of Node.js Applications. Part 2: Toolkit and Process</a> " </li><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/198252/">Localization of Node.js Applications. Part 3: Localization in Action</a> " </li><li>  " <a href="http://habrahabr.ru/company/nordavind/blog/198590/">Awsbox - PaaS infrastructure for deploying Node.js applications in the Amazon cloud</a> " </li></ol><br></div></div><br><br></div><p>Source: <a href="https://habr.com/ru/post/195494/">https://habr.com/ru/post/195494/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../195482/index.html">Introduction to algorithm complexity analysis (part 2)</a></li>
<li><a href="../195484/index.html">Java Update Coffee Shop in GTA V</a></li>
<li><a href="../195486/index.html">Meet SQL Server 14</a></li>
<li><a href="../195488/index.html">Read this before sending your next business letter.</a></li>
<li><a href="../195490/index.html">15 years of google</a></li>
<li><a href="../195496/index.html">Simple parser JSON on PL / SQL</a></li>
<li><a href="../195498/index.html">Nvidia introduced Tegra Note</a></li>
<li><a href="../195500/index.html">In African Hackspace collect 3d printer from the remnants of computers</a></li>
<li><a href="../195502/index.html">How is IT life in Koh Samui (Thailand)</a></li>
<li><a href="../195504/index.html">What unites VDS, Ruby and 1C-Bitrix: Corp. Portal? Jelastic on Infobox</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>