<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Secure backup using public services</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It often happens that there are many different projects that need to be backed up regularly. 
 But more often it happens that it is lazy to raise your...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Secure backup using public services</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/0a3/801/bc9/0a3801bc9cb513778b8589b0f5bcd462.png" align="left"><br>  It often happens that there are many different projects that need to be backed up regularly. <br>  But more often it happens that it is lazy to raise your own backup service, and copies are made at best from time to time, and at worst they are not made at all.  Especially for lazy people came up with file synchronization services, such as <a href="http://dropbox.com/">Dropbox</a> , <a href="http://disk.yandex.ru/">Yandex.Disk</a> and others like them.  The essence is always the same: a file loaded on one bound device appears on all the others.  Hurray, solution found. <br>  But another question arises: the security of downloaded content.  And if you can not worry too much about the pictures from Mallorca, then you can back up the 1C combat base so much.  And here, in this article itself, there is a small HOW-TO about how to stay lazy and keep files safe. <a name="habracut"></a><br><br><h4>  Assumptions </h4><br>  When writing this HOW-TO, I assume that the reader is familiar with the basics of system administration, can independently create an account and set up a synchronization service on a remote computer.  I will use the example of CentOS 6 Linux, <a href="http://habrahabr.ru/post/98227/">my</a> <a href="http://habrahabr.ru/post/208414/">sites</a> and the Dropbox service  All the same can be done on other operating systems and services.  And even instead of GnuPG, you can use OpenSSL. <br><br><h4>  Installing software on storage </h4><br><h5>  Install and configure Dropbox </h5><br>  <a href="https://www.dropbox.com/install">We swing</a> and set.  By the way, despite the fact that there is X11 in dependencies, you can safely install with --nodeps <br><pre><code class="bash hljs">[root@server ~]<span class="hljs-comment"><span class="hljs-comment"># wget https://www.dropbox.com/download?dl=packages/fedora/nautilus-dropbox-1.6.0-1.fedora.x86_64.rpm [root@server ~]# rpm -i --nodeps nautilus-dropbox-1.6.0-1.fedora.x86_64.rpm Dropbox installation successfully completed! You can start Dropbox from your applications menu. [root@server ~]# su user [user@server ~]$ dropbox start -i Downloading Dropbox... 100% Unpacking Dropbox... 100% Done! [user@server ~]$ dropbox stop [user@server ~]$ ~/.dropbox-dist/dropboxd This computer isnt linked to any Dropbox account... Please visit https://www.dropbox.com/cli_link?host_id=**************************************** to link this device. This computer isnt linked to any Dropbox account... Please visit https://www.dropbox.com/cli_link?host_id=**************************************** to link this device.</span></span></code> </pre> <br>  Follow the link, enter the passwords, and here: <br><pre> <code class="bash hljs">This computer is now linked to Dropbox. Welcome ********* ^C ~/.dropbox-dist/dropboxd &amp; [user@server ~]$ <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> [root@server ~]<span class="hljs-comment"><span class="hljs-comment"># rpm -e nautilus-dropbox</span></span></code> </pre><br><h5>  Installing GNUPG2 and creating keys </h5><br><pre> <code class="bash hljs">[root@server ~]<span class="hljs-comment"><span class="hljs-comment"># yum install gpg [... skipped ...] [root@server ~]# su user</span></span></code> </pre> <br>  Create a pair of keys <br><pre> <code class="bash hljs">[user@server ~]$ gpg --gen-key [... skipped ...] Please select what kind of key you want: (1) RSA and RSA (default) (2) DSA and Elgamal (3) DSA (sign only) (4) RSA (sign only) Your selection? 1 RSA keys may be between 1024 and 4096 bits long. What keysize <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> you want? (2048) 4096 Requested keysize is 4096 bits Please specify how long the key should be valid. 0 = key does not expire &lt;n&gt; = key expires <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> n days &lt;n&gt;w = key expires <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> n weeks &lt;n&gt;m = key expires <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> n months &lt;n&gt;y = key expires <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> n years Key is valid <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>? (0) Key does not expire at all Is this correct? (y/N) y GnuPG needs to construct a user ID to identify your key. Real name: Backup Server Email address: backup@my.company.com Comment: Main backup server You selected this USER-ID: <span class="hljs-string"><span class="hljs-string">"Backup Server (Main backup server) &lt;backup@my.company.com&gt;"</span></span> Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? O You need a Passphrase to protect your secret key. [... skipped ...] gpg: key E4E021AB marked as ultimately trusted public and secret key created and signed. gpg: checking the trustdb gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model gpg: depth: 0 valid: 1 signed: 0 trust: 0-, 0q, 0n, 0m, 0f, 1u pub 4096R/E4E021AB 2014-01-29 Key fingerprint = 0FDC B999 6FEB FBB5 1E59 48BD 71C2 6663 E4E0 21AB uid Backup Server (Main backup server) &lt;backup@my.company.com&gt; sub 4096R/C7212824 2014-01-29</code> </pre> <br>  If during the generation of gpg it will swear that there is not enough entropy, create it. <br>  I usually go to another console and do something like: <br><pre> <code class="bash hljs">[user@server ~]$ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> find / -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br>  It remains only to share the public key between all participants - put it in Dropbox. <br><pre> <code class="bash hljs">[user@server ~]$ gpg --<span class="hljs-built_in"><span class="hljs-built_in">export</span></span> -o ~/Dropbox/public.gpg</code> </pre> <br><h4>  Installing software on a reserved server </h4><br>  In principle, everything is the same, but you can not generate your keys. <br>  Enough to do <pre> <code class="bash hljs">[user@server ~]$ gpg --import ~/Dropbox/public.gpg</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Backup process </h4><br>  It can be different.  Each server has its own dropbox-account, and a folder that is shared (Shared folder) with a backup server.  Type backu_srv1, backup_srv2 and so on.  Although you can just have 1 account on all servers - it all depends on the amount of data that will be backed up. <br>  The main "trick" is to encrypt files before putting them into Dropbox. <br>  Below is an example of a script backing up the mysql database. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh FILE="~/Dropbox/backup_srv1/mysql_$(date +%d.%m.%y).sql.gz.gpg" LOG="~/scripts/backup.log" USER="************" PASS="************" DB="**********" KEY="0xE4E021AB" export PATH=/usr/local/sbin:/usr/local/bin:/usr/bin:/usr/bin/core_perl mysqldump -u${USER} -p${PASS} $DB|gzip -c|gpg --trust-model=always --yes -e -r $KEY -o "$FILE" &amp;&amp; echo "$FILE : OK" &gt;&gt; "$LOG" &amp;&amp; exit echo "$FILE : ERROR" &gt;&gt; "$LOG" &amp;&amp; exit</span></span></code> </pre><br>  Pay attention to KEY - this is the public key ID, which we obtained in step 2 and imported <i>into / to the</i> server. <br><br>  Actually, everything.  Backups are synchronized via Dropbox, while the data is not available to anyone, because the public key can only be encrypted, and the private key is only in the repository. <br><br><h4>  Further use of backups </h4><br>  Possible options.  You can decrypt all received backups and put them somewhere, you can store them encrypted until ‚ÄúX‚Äù hour.  It's a matter of taste.  The only thing I recommend is to have several copies of the private key, including on A4 paper in an envelope in the safe.  If you lose all other options, you will fill many-many characters with a piece of paper. <br><pre> <code class="bash hljs">[user@server ~]$ gpg --armor --<span class="hljs-built_in"><span class="hljs-built_in">export</span></span>-secret-keys</code> </pre> <br><br>  Oh yes.  Decoding itself. <br><pre> <code class="bash hljs">[user@server backup_srv1]$ gpg -o ~/mysql_29.01.14.sql.gz -d mysql_29.01.14.sql.gz.gpg  -      : <span class="hljs-string"><span class="hljs-string">"Backup Server (Main backup server) &lt;backup@my.company.com&gt;"</span></span> 4096- RSA , ID C7212824,  2014-01-29 (  ID E4E021AB) gpg:  4096-  RSA,  ID C7212824,  2014-01-29 <span class="hljs-string"><span class="hljs-string">"Backup Server (Main backup server) &lt;backup@my.company.com&gt;"</span></span></code> </pre> <br>  And now - the important thing: <br>  <b>Do not decrypt your backups in folders that are synchronized with Dropbox!</b> <br><br><h4>  Instead of conclusion </h4><br>  If you, after reading this article, ran to register an account on any service and generate keys, then you are one of those who are <b>already</b> doing backups.  Congratulations! <br>  If you are still lazy - do not despair, you will find a great experience and a lot of adrenaline.  <i>Someday</i> <br>  And if you wanted to find out what else gnupg can do - you can look <a href="http://habrahabr.ru/post/82658/">here.</a> <br><br>  - <br>  8033A3EF / DBD1 B794 73AD 3A5C 9279 A8E1 16B5 6AA3 8033 A3EF </div><p>Source: <a href="https://habr.com/ru/post/210744/">https://habr.com/ru/post/210744/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../210734/index.html">A plugin for Bootstrap 3 that enhances the accessibility of interfaces</a></li>
<li><a href="../210736/index.html">HID USB Device Management on Windows 7</a></li>
<li><a href="../210738/index.html">Facebook will create an energy-efficient data storage of 10,000 Blu-ray discs</a></li>
<li><a href="../210740/index.html">Analysis of popular game addiction theories</a></li>
<li><a href="../210742/index.html">How does chromecast work?</a></li>
<li><a href="../210746/index.html">Unification of associative STL-containers by a template parameter - comparator</a></li>
<li><a href="../210748/index.html">User Timing API</a></li>
<li><a href="../210750/index.html">2.4GHz USB "whistle" with your own hands</a></li>
<li><a href="../210754/index.html">We pump Google Tasks using a third-party service: repetitive tasks, sharing, notifications about deadlines and other features</a></li>
<li><a href="../210760/index.html">How to hash passwords and how not to</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>