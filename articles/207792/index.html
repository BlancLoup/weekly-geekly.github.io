<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Set the time interval on the watch face. Javascript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, dear reader. 

 What it is? 
 In the course of my development, I was faced with the task of creating a functional selection of the time inte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Set the time interval on the watch face. Javascript</h1><div class="post__text post__text-html js-mediator-article">  Good day, dear reader. <br><br><h4>  What it is? </h4><br>  In the course of my development, I was faced with the task of creating a functional selection of the time interval.  The first thing that came to mind was, of course, the simplest and most obvious - several text fields where the initial and final values ‚Äã‚Äãare driven in.  But is it interesting?  Not. <br><br>  I decided to take a bit of the original. <br><img src="https://habrastorage.org/getpro/habr/post_images/364/057/15f/36405715f7130fc28d0d38323c3a70b3.png"><br>  I think the picture quite clearly demonstrates my idea: we have a clock face and 2 sliders with which we select the interval.  I want to say at once that if I suddenly invented a bicycle ... hmm, well, not fatal.  All the same to create more interesting than using someone else's. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Skeleton </h4><br>  I want to immediately note that I am not a web designer, and I do not have the skills to work with CSS at the guru level, so my approach may seem clumsy to someone, not right. <br><br>  How to make a ring on HTML? <br><ul><li>  Create a square area with sides X. </li><li>  We set the area to the value of <i>border-radius</i> with the value X. As a result, we get a circle. </li><li>  In the center of the circle we place a similar area, only with a smaller radius and a different color. </li></ul><br>  The ring is ready, but we need not a whole ring, but only half of it, so we will add one more item <br><ul><li>  Cut off part of the area with the <i>clip</i> property so that a semicircle is obtained </li></ul><br><br>  For the final result, we need two ‚Äúcolored‚Äù semicircles (the code name is a <i>sash</i> ), and two semicircles with a background color (the code name is an <i>anti</i> - <i>fold</i> ). <br><img src="https://habrastorage.org/getpro/habr/post_images/070/af7/281/070af7281d91933c34a44767958fb1cb.png"><br><br>  Changing the position of the slider, we will rotate the sash.  <i>Anti-binders</i> are needed to hide the <i>leaves</i> , when the selection interval is less than 180 grams.  To hide is to display anti-folds over the doors, changing the value of <i>z-index</i> . <br><br>  The final HTML skeleton should look like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/d24/075/6ad/d240756ad879e3b1394339682c3dc3d0.png"><br><br><h4>  How should this work? </h4><br>  So.  We have two sliders (code name - <i>slider 1</i> and <i>slider 2</i> ).  When you click on the slider, or rather at the <i>onmousedown</i> event, it is activated to move.  Moving the cursor, change the position of the slider, then release the cursor (the <i>onmouseup</i> event) to select it. <br><br>  It should be noted that the movement of the cursor should not just be chaotic in all possible directions, as if we are forming an SSH key through puttygen, it is necessary that the movement more or less resemble circular ones.  To do this, when the slider is activated, the area in which movement is possible is determined.  When you exit the zone, the slider is deactivated.  Zone - two circles with radii larger and smaller than the radius of the circle along which the slider moves. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/147/102/f65/147102f656b2403aa610f2aafbea5638.png"><br><br>  From the point of view of formulas, everything is simple: we count the distance that the cursor is located away from the center of the circle.  Check whether this value is in the interval or not. <br><br><div class="spoiler">  <b class="spoiler_title">onmousemove</b> <div class="spoiler_text"><pre><code class="javascript hljs">onmousemove = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*         .         ,          */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rect = Area.getBoundingClientRect(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Xpoint = (e.clientX - area_radius) - rect.left; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Ypoint = (e.clientY - area_radius) - rect.top; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> R = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sqrt(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(Xpoint,<span class="hljs-number"><span class="hljs-number">2</span></span>)+<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(Ypoint,<span class="hljs-number"><span class="hljs-number">2</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = (<span class="hljs-number"><span class="hljs-number">180</span></span>*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.acos((Xpoint<span class="hljs-number"><span class="hljs-number">-0</span></span>)/R))/<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI; a = (Ypoint&gt;=<span class="hljs-number"><span class="hljs-number">0</span></span>) ? a=<span class="hljs-number"><span class="hljs-number">360</span></span>-a : a;<span class="hljs-comment"><span class="hljs-comment">//  ,      move(a,R); };</span></span></code> </pre> <br></div></div><br><br><h4>  Different coordinate systems </h4><br>  If everything fits, then we calculate the angle of the segment between the center of the circle and the position of the cursor.  And then one uncomfortable moment pops up - different coordinate systems (SC): normal, with an initial value at the extreme right point, increasing the angle when moving counterclockwise.  And watch.  00:00 we are in the highest position, and the movement, respectively, in a clockwise direction. <br><img src="https://habrastorage.org/getpro/habr/post_images/c63/df2/7f5/c63df27f50c92b6c5252e6aa6350223b.png"><br>  Elements must be moved in the usual SC, and the clock is calculated in the hour. <br><br><h4>  Boundaries of what is permitted </h4><br>  Each slider has borders: left and right, beyond which it can not move.  That's just the creation of these boundaries and was the biggest snag. <br><br>  I spent 3 days trying to come up with the right ... no, this is not the right word ... the working mechanism for handling borders.  Anyone who wants to repeat my feat will come up with his ‚Äúright‚Äù mechanism, with more or less success than me.  I completely "re-invented" it 3 times, when, going to a certain moment, I realized that with the current mechanism, it would not be possible to make a certain moment. <br><br>  As a result, the mechanism looks like this: each slider has 4 states (in the code, the variables responsible for the states are designated as <i>sONE</i> and <i>sTWO</i> ).  Everything is built around them. <br><ul><li>  -2 - extreme right position of the slider.  The value of the hour is 00:00. </li><li>  -1 - the slider is on the first turn of the dial.  The value of hours is from 00:00 to 11:59. </li><li>  1 - the slider is on the second turn of the dial.  Hours from 12:00 to 23:00. </li><li>  2 - extreme left position of the slider.  Value hours 24:00 </li></ul><br>  In fact, with positions 2 and -2, the sliders are at the same point, but the difference is from which side they came there.  Accordingly, further they can only move back. <br><br>  To determine in which direction the slider moves, the new value of the slider position is compared to the old one.  For example, to determine when the slider moves from the first turn on the dial to the second, you need to observe the condition under which the previous angle value was in the interval: <b>60 &lt;X, 0 &lt;X</b> , and new <b>0 == X;</b>  <b>330 &lt;x</b> .  All similar checks are done in approximately the same way, i.e.  not just checking <b>A&gt; B</b> , but specifying the interval where A can be located, but where <b>B is</b> .  You can simply pull the slider sharply and its value will immediately change to 10 or 15 degrees. <br><br><div class="spoiler">  <b class="spoiler_title">border handling</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(R&gt;=low_limit_polzunok_ONE &amp;&amp; R&lt;=high_limit_polzunok_ONE){ angle_polzunok_ONE_last = angle_polzunok_ONE; angle_polzunok_ONE = toClk(a); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(barier_ONE==<span class="hljs-literal"><span class="hljs-literal">true</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(angle_polzunok_ONE&gt;<span class="hljs-number"><span class="hljs-number">300</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(toClk(a)&gt;angle_polzunok_TWO+<span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; toClk(a)&lt;angle_polzunok_TWO+<span class="hljs-number"><span class="hljs-number">60</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>){ move_polzunok_ONE(toCoo(angle_polzunok_ONE)); barier_ONE=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(toClk(a)&gt;angle_polzunok_TWO+<span class="hljs-number"><span class="hljs-number">1</span></span>){ move_polzunok_ONE(toCoo(angle_polzunok_ONE)); barier_ONE=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sONE==<span class="hljs-number"><span class="hljs-number">-2</span></span>){<span class="hljs-comment"><span class="hljs-comment">//0 .          if(angle_polzunok_ONE&gt;300){ sONE=-1; move_polzunok_ONE(a); }else{ angle_polzunok_ONE=360; } }else if(sONE==-1){ if(angle_polzunok_ONE&gt;300 &amp;&amp; (angle_polzunok_ONE_last&gt;=0 &amp;&amp; angle_polzunok_ONE_last&lt;60)){ sONE=1; move_polzunok_ONE(a); }else if((angle_polzunok_ONE&gt;=0 &amp;&amp; angle_polzunok_ONE&lt;60) &amp;&amp; angle_polzunok_ONE_last&gt;300){ sONE=-2; angle_polzunok_ONE = 0; move_polzunok_ONE(90); }else{ move_polzunok_ONE(a); } }else if(sONE==0){//  12   if(angle_polzunok_ONE&gt;300){ sONE=1; move_polzunok_ONE(a); }else{ sONE=-1; move_polzunok_ONE(a); } }else if(sONE==1){ if((angle_polzunok_ONE&gt;=0 &amp;&amp; angle_polzunok_ONE&lt;60) &amp;&amp; angle_polzunok_ONE_last&gt;300){ sONE=-1; move_polzunok_ONE(a); }else if((angle_polzunok_ONE==0 || angle_polzunok_ONE&gt;300) &amp;&amp; (angle_polzunok_ONE_last&gt;0 &amp;&amp; angle_polzunok_ONE_last&lt;90)){ sONE=2; angle_polzunok_ONE = 0; move_polzunok_ONE(90); }else{ move_polzunok_ONE(a); } }else if(sONE==2){//24 .          if(angle_polzunok_ONE&gt;0 &amp;&amp; angle_polzunok_ONE&lt;60){ sONE=1; move_polzunok_ONE(a); }else{ angle_polzunok_ONE=0; } } //   i     if(sTWO==sONE &amp;&amp; angle_polzunok_TWO+1&gt;angle_polzunok_ONE){ barier_ONE = true; angle_polzunok_ONE = angle_polzunok_TWO+1; move_polzunok_ONE(toCoo(angle_polzunok_ONE)); } }else{ polzunok_switch_ONE(false); }</span></span></code> </pre><br></div></div><br><h4>  Timing </h4><br>  Actually on the previous paragraph ended all the most difficult and interesting.  The process of calculating time is nothing special.  A simple calculation of <i>360 g = 12 hours * 60 minutes</i> indicates that one degree corresponds to two minutes.  Knowing the degree of the slider in the clock coordinate system, it is easy to calculate the time.  If the slider is on the second rotation, you need to add another 360 to the degree value. <br><br>  The entire listing, as well as the result, can be found <a href="http://codepen.io/kos1nus/pen/bBFaC">here.</a> <br><br><h4>  On the road </h4><br>  My goal was to create such a thing, not for <i>JavaScript</i> , but for <i>GWT</i> .  Initially easier to develop on JS, and then migrate to GWT.  Therefore, I did not bother to create a convenient designer, and the procedure for calculating the date itself returns a plain text string as a result. <br><br>  This is a draft.  Test sample, but perhaps he will be useful to someone. <br><br>  Thank you for your attention, dear reader. <br><br>  PS Having finished writing a post, I realized that it would be possible to make everything easier.  That's usually - "a good idea comes after." </div><p>Source: <a href="https://habr.com/ru/post/207792/">https://habr.com/ru/post/207792/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../207778/index.html">Asynchronous JavaScript (book)</a></li>
<li><a href="../207780/index.html">The Mail.Ru Cloud License Agreement changed</a></li>
<li><a href="../207784/index.html">Merge sort and AS3. Overtaking the native Vector.sort (Array.NUMERIC)</a></li>
<li><a href="../207786/index.html">Metaclasses in Objective-C</a></li>
<li><a href="../207788/index.html">BI: the problem of choosing a solution and an example of one failure</a></li>
<li><a href="../207794/index.html">Jasmine DRY: Do you write tests correctly?</a></li>
<li><a href="../207796/index.html">98-year-old negatives found in the Antarctic</a></li>
<li><a href="../207798/index.html">The digest of news from the world of mobile development for the last week ‚Ññ35 (December 23-29, 2013)</a></li>
<li><a href="../207800/index.html">Development of Windows 8.1 applications on XAML / –° #. Part 5. Pop-ups and panels</a></li>
<li><a href="../207806/index.html">New Year's Eve Creative</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>