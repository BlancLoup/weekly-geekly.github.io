<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using the KOMPAS-3D API ‚Üí Lesson 6 ‚Üí Saving a document in various formats</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue the cycle of articles on working with the CAD API KOMPAS-3D Sergey Norseev, an engineer-programmer of the All-Russian Scientific-Research ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using the KOMPAS-3D API ‚Üí Lesson 6 ‚Üí Saving a document in various formats</h1><div class="post__text post__text-html js-mediator-article">  We continue the cycle of articles on working with the CAD API KOMPAS-3D Sergey Norseev, an engineer-programmer of the All-Russian Scientific-Research Institute ‚ÄúSignal‚Äù, the author of the book ‚ÄúDevelopment of applications for KOMPAS in Delphi‚Äù.  C ++ Builder is used as the medium.  In this lesson we will talk about how to save documents. <br><br><img src="https://habrastorage.org/webt/hw/o8/xl/hwo8xljzsc7a73fs-vhgjzczzhk.png"><br><a name="habracut"></a><br><blockquote><h4>  Content of the cycle of lessons ‚ÄúWorking with the API KOMPAS-3D‚Äù </h4><br>  1. <a href="https://habrahabr.ru/company/ascon/blog/328088/">Basics</a> <br>  2. <a href="https://habrahabr.ru/company/ascon/blog/330588/">Design drawing</a> <br>  3. <a href="https://habrahabr.ru/company/ascon/blog/332554/">Correct connection to COMPAS</a> <br>  4. <a href="https://habrahabr.ru/company/ascon/blog/337288/">Title Block</a> <br>  5. <a href="https://habrahabr.ru/company/ascon/blog/342030/">Graphic primitives</a> <br>  6. <b>Saving a document in various formats</b> <br>  7. <a href="https://habrahabr.ru/company/ascon/blog/350512/">Getting to know the settings</a> <br>  8. More complex methods of writing to the main title <br></blockquote><br><br><h2>  <font color="#00B2FF">Simple save</font> </h2><br>  To save a graphic document, the <b>ksSaveDocument</b> and <b>ksSaveDocumentEx</b> methods of the <b>ksDocument2D</b> interface are <b>used</b> .  Let's start with the first, its prototype is presented below. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs objectivec"><span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span> ksSaveDocument ( BSTR fileName <span class="hljs-comment"><span class="hljs-comment">//   );</span></span></code> </pre> <br>  The only parameter of the method is a string with the full name of the file in which you want to save the document.  If the <b>filename</b> parameter contains an empty string, then the document is saved along the path specified in the <b>filename</b> property of the <b>ksDocumentParam</b> interface (briefly described in the first part of the cycle). <br><br>  Note that if a file with the specified name already exists, KOMPAS will overwrite it. <br>  If successful, the <b>ksSaveDocument</b> method returns <i>true</i> , and in case of error, <i>false</i> . <br><br>  The <b>ksSaveDocumentEx</b> method <b>is</b> similar to the <b>ksSaveDocument</b> method and, in fact, is its extended version.  The following is a prototype of the <b>ksSaveDocumentEx</b> method. <br><br><pre> <code class="hljs objectivec"><span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span> ksSaveDocumentEx ( BSTR fileName, <span class="hljs-comment"><span class="hljs-comment">//   long version //     );</span></span></code> </pre><br>  As can be seen from the prototype, in comparison with the <b>ksSaveDocument</b> method in the <b>ksSaveDocumentEx</b> method, one more parameter was added: a sign in which version of KOMPAS to save the document.  It has only three valid values: <br><br>  <i>-1</i> ‚Äìin previous version; <br>  <i>0</i> - to the current version; <br>  <i>1</i> - in version 5.11. <br><br>  The additional parameter is the only difference between the <b>ksSaveDocumentEx</b> method and the <b>ksSaveDocument</b> method.  Calling the <b>ksSaveDocumentEx</b> method with the <b>version</b> parameter equal to <i>zero</i> is equivalent to calling the <b>ksSaveDocument</b> method. <br><br><h2>  <font color="#00B2FF">Save to DXF format</font> </h2><br>  According to Wikipedia: <a href="https://ru.wikipedia.org/wiki/DXF">DXF</a> (Drawing eXchange Format) is an open file format for exchanging graphic information between CAD applications.  KOMPAS supports this format and allows us to save documents in this format. <br>  To save the graphic document in the DXF format, use the <b>ksSaveToDXF</b> method of the <b>ksDocument2D</b> interface.  Here is its prototype. <br><br><pre> <code class="hljs objectivec"><span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span> ksSaveToDXF ( LPCTSTR dxfFileName <span class="hljs-comment"><span class="hljs-comment">//   );</span></span></code> </pre><br>  As the only parameter, it takes the full path to the file in which to save the document.  If successful, the method returns <i>true</i> , and in case of error, <i>false</i> . <br><br>  At its core, the DXF format is text-based, and you can view the contents of the file in a standard notepad.  However, the notebook does not fully support this format.  To view the full content of the file, you can use the sharecad.org site, or a special program.  The figure below shows a drawing saved in DXF format and opened on the sharecad.org portal. <br><br><img src="https://habrastorage.org/webt/b_/pl/fh/b_plfhoykbavckukfekfvalc54o.png"><br>  <i>DXF drawing open on the sharecad.org portal</i> <br><br><h2>  <font color="#00B2FF">Raster save options</font> </h2><br>  KOMPAS allows you to save documents in raster format.  To do this, you first need to fill in the <b>ksRasterFormatParam</b> parameter <b>interface</b> .  You can get this interface using the <b>ksDocument2D</b> interface <b>RasterFormatParam</b> <b>()</b> <b>method</b> .  This method has no input parameters and, if successful, returns the <b>ksRasterFormatParam</b> interface.  If an error occurs, it returns a <i>NULL</i> value.  Consider the properties of the <b>ksRasterFormatParam</b> interface. <br><br>  <b>colorBPP</b> - bitmap color.  Sets the color depth of the image being created.  Valid values ‚Äã‚Äãfor this property are listed in the table below.  Constants are declared in the <i>ldefin2d.h</i> module. <br><br><img src="https://habrastorage.org/webt/gz/7n/4z/gz7n4zn32stev9l5gelp4jrbv8i.png"><br>  <i>Valid values ‚Äã‚Äãfor the <b>colorBPP</b> property</i> <br><br>  <b>colorType</b> - the color depth of the output graphic image.  This property is similar to the <b>colorBPP</b> property and has the same valid values.  The difference between them is that the <b>colorBPP</b> property determines the color depth in the final file, and <b>colorType determines the</b> color depth when converting graphic objects to raster form before saving them to a file. <br>  <b>extResolution</b> - resolution of the bitmap in dots per inch.  If the value of this property is zero, then the current screen resolution is used.  The maximum resolution at which I managed to build an image was 960 dpi, although it is possible to build an image with even higher resolution on more productive systems. <br>  <b>extScale</b> - scale.  If <b>extScale</b> value is <b>greater</b> than one, then the image is increased in <b>extScale</b> times.  If it is less than one, then the image is reduced by <b>1 / extScale</b> times. <br>  <b>format</b> - raster image format.  Valid values ‚Äã‚Äãfor this property are shown in the table below.  Constants are declared in the <i>ldefin2d.h</i> module. <br><br><img src="https://habrastorage.org/webt/kw/ly/a0/kwlya0iflugutjgzaqst7vjezac.png"><br>  <i>Valid values ‚Äã‚Äãfor the <b>format</b> property</i> <br><br>  WMF format is not supported.  According to the KOMPAS documentation, when you try to save a document in this format, it will be saved in EMF format. <br><br>  <b>greyScale</b> is a sign of the use of shades of gray.  If the value of this property is <i>true</i> , then shades of gray are used.  If the value of the property is <i>false</i> , then a color image is saved. <br>  <b>multiPageOutput</b> - sign of saving sheets of the document in a single file.  If the value of this property is <i>true</i> , then all sheets of the document are saved in one file.  If the value of this property is <i>false</i> , then the sheets are saved in separate files.  This property is used only for TIFF format.  But, as shown by my experiments, KOMPAS for the TIFF format saves the sheets of a document into one file, regardless of the value of the <b>multiPageOutput</b> property.  For other formats, the sheets are saved in separate files. <br>  <b>onlyThinLine</b> is a sign of output in thin lines.  If the value of this property is <i>true</i> , then the content of the document is displayed only in thin lines.  If the value of this property is <i>false</i> , then the output of the document uses the lines set for the objects. <br>  <b>pages</b> - the list of output sheets of the document, presented as a string.  Example list: " <i>1-18</i> , <i>24-25</i> ."  In this example, sheets 1 through 18 are displayed, as well as 24 and 25 sheets.  Sheets are numbered from one.  If the string is empty, KOMPAS does not use this property. <br>  <b>rangeindex</b> - a sign of the choice of even and odd sheets.  Valid property values: <br>  <i>0</i> - all sheets; <br>  <i>1</i> - odd sheets; <br>  <i>2</i> - even sheets. <br>  <b>There is</b> only one method for the <b>ksRasterFormatParam</b> interface. <br>  <b>Init ()</b> - resets the values ‚Äã‚Äãof all interface properties.  It has no input parameters and, if successful, returns <i>true</i> . <br><br><h2>  <font color="#00B2FF">Saving as a raster image</font> </h2><br>  To save the document as a bitmap image, use the <b>Save AsToRasterFormat</b> method of the <b>ksDocument2D</b> interface.  Below is its prototype. <br><br><pre> <code class="hljs objectivec"><span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span> SaveAsToRasterFormat ( BSTR fileName, <span class="hljs-comment"><span class="hljs-comment">//    LPDISPATCH rasterPar //  );</span></span></code> </pre><br>  The first parameter specifies the full path to the file in which to save the document. <br>  The second parameter contains the <b>ksRasterFormatParam</b> interface, which specifies the save parameters as a bitmap image. <br><br>  On success, the <b>SaveAsToRasterFormat</b> method returns <i>true</i> , and on error, <i>false</i> . <br><br>  The following is an example of using this method. <br><br><pre> <code class="hljs erlang-repl">//   ,     WideString str_filepath; str_filepath = ExtractFileDir(Application-&gt;ExeName); str_filepath += L<span class="hljs-string"><span class="hljs-string">"\\MyNewDocument.jpg"</span></span>; //   KompasObjectPtr kompas; kompas.CreateInstance(L<span class="hljs-string"><span class="hljs-string">"KOMPAS.Application.5"</span></span>); //   DocumentParamPtr DocumentParam; DocumentParam=(DocumentParamPtr)kompas-&gt;GetParamStruct(ko_DocumentParam); DocumentParam-&gt;Init(); DocumentParam-&gt;type= lt_DocSheetStandart;//    //  Document2DPtr Document2D; Document2D = (Document2DPtr)kompas-&gt;Document2D(); Document2D-&gt;ksCreateDocument(DocumentParam); //     RasterFormatParamPtr RasterFormatParam; RasterFormatParam = (RasterFormatParamPtr)Document2D-&gt;RasterFormatParam(); RasterFormatParam-&gt;Init(); RasterFormatParam-&gt;set_colorBPP(BPP_COLOR_24); RasterFormatParam-&gt;set_colorType(BPP_COLOR_24); RasterFormatParam-&gt;set_extResolution(<span class="hljs-number"><span class="hljs-number">0</span></span>); RasterFormatParam-&gt;set_extScale(<span class="hljs-number"><span class="hljs-number">1.0</span></span>); RasterFormatParam-&gt;set_format(FORMAT_JPG); RasterFormatParam-&gt;set_greyScale(false); RasterFormatParam-&gt;set_onlyThinLine(false); RasterFormatParam-&gt;set_pages(SysAllocString(L<span class="hljs-string"><span class="hljs-string">""</span></span>)); RasterFormatParam-&gt;set_rangeIndex(<span class="hljs-number"><span class="hljs-number">0</span></span>); //     Document2D-&gt;SaveAsToRasterFormat(SysAllocString(str_filepath.c_bstr()), RasterFormatParam); //  RasterFormatParam.Unbind(); Document2D.Unbind(); kompas-&gt;set_Visible(true); kompas.Unbind();</code> </pre><br>  In this example, a new document is created, which is saved as a jpeg image.  Please note that since the document is empty, you will most likely see a blank sheet, and in non-commercial versions marked KOMPAS in the lower left corner, as in the figure below. <br><br><img src="https://habrastorage.org/webt/db/ka/0d/dbka0d1_wghorkki5n2o29imfxg.png"><br>  <i>Document mark in non-commercial versions (the edge of the sheet is shown conditionally)</i> <br><br><h2>  <font color="#00B2FF">Saving multi-sheet documents</font> </h2><br>  As a result, saving a document can result in one file or several files.  One file is obtained in the following cases: <br><br><ul><li>  the saved document consists of one sheet; </li><li>  only 1 sheet of the document is saved; </li><li>  The document is saved in TIFF format. </li></ul><br>  In other cases, when you save the document, several files will be created.  One file per sheet.  In this case, the number of the sheet stored in it is added to the file name.  For example, if you specify the name of the pict.jpeg file in the <b>fileName</b> parameter of the <b>SaveAsToRasterFormat</b> method, then saving the sheets with numbers 1, 4, 5 will create three files: pict (1) .jpeg, pict (4) .jpeg and pict (5) .jpeg. <br><br>  If the file in which the sheets are saved already exists, then KOMPAS behaves differently depending on how many files it should turn out.  If 1 file, then it is overwritten without any warning.  If multiple files are being generated, KOMPAS displays the dialog box shown below.  In this case, the <b>SaveAsToRasterFormat</b> method <b>will</b> not return until the user closes the window. <br><br><img src="https://habrastorage.org/webt/ro/2v/g2/ro2vg29jq0er4vcwmoinpxmf4yo.png"><br>  <i>Dialog box warning about file rewriting</i> <br><br>  These windows appear even if KOMPAS is running in invisible mode. <br><br>  The numbers of stored sheets are set using the properties <b>pages</b> and <b>rangeindex</b> .  Consider how they are used KOMPAS. <br><br>  If the <b>pages</b> property is not set or contains an empty string, and the value of the <b>rangeindex</b> property is <i>zero</i> , then all sheets of the document are saved.  If the pages property is set, and the value of the <b>rangeindex</b> property is zero, then all sheets specified in the <b>pages</b> property are saved. <br><br>  If the pages property contains an incorrect sheet number, then it is ignored.  For example, if for a document consisting of 5 sheets, the <b>pages</b> property is set to ‚Äú <i>0,1,4,8</i> ‚Äù, then pages 1 and 4 will be saved. If pages contains the string ‚Äú <i>invalid, 1, line, 3,</i> ‚Äù Sheets 1 and 3 will be saved. <br><br>  If the <b>rangeindex</b> property is <i>1</i> ( <i>2</i> ), and the <b>pages</b> property is not set, then all odd (even) sheets of the document will be saved.  For example, if for a document consisting of 5 sheets, the <b>rangeindex</b> property is <i>1</i> , and the <b>pages</b> property is not set, then the sheets will be saved: 1, 3, 5. <br><br>  If the <b>rangeindex</b> property is <i>1</i> ( <i>2</i> ) and the <b>pages</b> property is set, then odd (even) sheets specified in the <b>pages</b> property will be saved.  For example, provided <br>  <b>pages</b> = " <i>1,2,3</i> "; <br>  <b>rangeindex</b> = <i>1</i> ; <br>  Sheets 1 and 3 will be saved. Sheet 2 will not be saved exactly the same as sheet 5, if it is in the document. <br>  Take a look at this example: <br>  <b>pages</b> = " <i>1,3</i> "; <br>  <b>rangeindex</b> = <i>2</i> . <br>  In this case, not a single sheet will be saved.  According to the value of the <b>rangeindex</b> property <b>,</b> KOMPAS should save even sheets, but not even a single sheet is specified in the <b>pages</b> property.  Therefore, the <b>SaveAsToRasterFormat</b> method <b>does</b> not save anything and returns <i>false</i> . <br><br><h2>  <font color="#00B2FF">Save without compression</font> </h2><br>  To save the document as a non-compressed bitmap image, use the <b>Save AsToUncompressedRasterFormat</b> method of the <b>ksDocument2D</b> interface.  This method is completely analogous to the <b>SaveAsToRasterFormat</b> method discussed earlier.  Therefore, I will not describe it. <br><br>  Note that the difference between the <b>SaveAsToRasterFormat</b> and <b>SaveAsToUncompressedRasterFormat methods</b> is manifested only when working with TIFF files.  For other file types, they work exactly the same. <br><br>  <b>Conclusion</b> <br>  In this article, we looked at saving a graphic document in various formats.  Do not forget that saving as a bitmap or DXF should in no case replace the saving using the <b>ksSaveDocument</b> or <b>ksSaveDocumentEx method</b> . <br><br>  In general, when developing an application for KOMPAS, you should clearly define who is responsible for saving the document: you, or the user.  I believe that in most cases the user must be responsible for this.  Your program creates a document and shows it to the user, who decides what to do with it further: save, or forget.  However, if your program has to change a large number of documents, then it is ugly to shift the task of saving them to the user.  In this case, the program must save the documents.  Although it all depends on the task. <br><br>  <b>To be continued, stay tuned to the blog.</b> <br><br> <a href=""><img src="https://habrastorage.org/web/595/eee/f27/595eeef271b24830b3578751fcb52716.png"></a>  Sergey Norseev, author of the book ‚ÄúDevelopment of applications for KOMPAS in Delphi‚Äù. </div><p>Source: <a href="https://habr.com/ru/post/346772/">https://habr.com/ru/post/346772/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346762/index.html">The magic of the word "blockchain" and other materials in our collection</a></li>
<li><a href="../346764/index.html">January fixing holes in the .NET Framework and Core</a></li>
<li><a href="../346766/index.html">Recognizing motion gestures on Android using Tensorflow</a></li>
<li><a href="../346768/index.html">Two-factor authentication for Cisco Meraki Client VPN using Token2 TOTPRadius</a></li>
<li><a href="../346770/index.html">Undocumented CSS Techniques</a></li>
<li><a href="../346774/index.html">JavaScript exceeded everyone</a></li>
<li><a href="../346776/index.html">Hyper-V - a child of marketing or a real alternative?</a></li>
<li><a href="../346778/index.html">Once again about SWAP in Linux "on hot" on AWS EC2 Instance</a></li>
<li><a href="../346782/index.html">Optional: Schr√∂dinger's cat in Java 8</a></li>
<li><a href="../346784/index.html">Web application on Node and Vue, part 5: finalizing the project</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>