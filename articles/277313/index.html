<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I made a mistake when writing a hash table and what conclusions did I make of it</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For clarity of theoretical understanding, there is no better way than to learn from your own mistakes, the hard way. (Friedrich Engels) 


 Hello! 


...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I made a mistake when writing a hash table and what conclusions did I make of it</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  For clarity of theoretical understanding, there is no better way than to learn from your own mistakes, the hard way.  (Friedrich Engels) </blockquote><br><p>  Hello! </p><br><p>  A few weeks ago, a colleague wrote to me in Linkedin and said that the hash table does not quite work correctly on my github <a href="https://github.com/johan92/fpga-hash-table">project</a> . </p><br><p>  They sent me tests and fixes, and really created a situation where the system was "hanging".  When investigating a problem, I realized that I had made several verification errors.  On Habr√©, the topic of verification of the RTL code is not too detailed, so I decided to write an article. </p><br><p>  From the article you will learn: </p><br><ul><li>  how can you organize a hash table on FPGA. </li><li>  what was built verification. </li><li>  what mistakes I made (they led to the fact that the bug was not noticed earlier). </li><li>  how this can be fixed. </li></ul><br><p>  Welcome under the cut! </p><a name="habracut"></a><br><h2>  Briefly about the project </h2><br><h3>  Goals and background </h3><br><p>  The goals that I set before the start of the project: </p><br><ul><li>  if it is claimed that the hash table has N elements, then it is guaranteed that any N elements will fit there. </li><li>  the table itself resolves collisions, there is no limit on the number of items in the basket (but not more than the size of the hash table, of course). </li><li>  the table allows you to add, search, and delete by key </li><li>  if the search does not cause collisions, then the table is ready to accept tasks for searching every clock cycle (maximum performance). </li><li>  I don‚Äôt <abbr title="Although, this is a bit contrary to maximum performance, but oh well">worry</abbr> about resources and clock frequency. </li></ul><br><h3>  Internal device </h3><br><p>  I want to get maximum performance, so I organize the pipeline: </p><br><img src="https://habrastorage.org/files/126/633/93b/12663393b5b94e9a9d0b75a512f06070.png"><br><p> Login ( <code>ht_cmd</code> ): </p><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> logic [<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] { OP_SEARCH, OP_INSERT, OP_DELETE } <span class="hljs-keyword"><span class="hljs-keyword">ht_opcode_t</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">packed</span></span></span><span class="hljs-class"> {</span></span> logic [KEY_WIDTH<span class="hljs-number"><span class="hljs-number">-1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] key; logic [VALUE_WIDTH<span class="hljs-number"><span class="hljs-number">-1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] value; <span class="hljs-keyword"><span class="hljs-keyword">ht_opcode_t</span></span> opcode; } <span class="hljs-keyword"><span class="hljs-keyword">ht_command_t</span></span>;</code> </pre> <br><p>  Output ( <code>ht_res</code> ): </p><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> { SEARCH_FOUND, SEARCH_NOT_SUCCESS_NO_ENTRY, INSERT_SUCCESS, INSERT_SUCCESS_SAME_KEY, INSERT_NOT_SUCCESS_TABLE_IS_FULL, DELETE_SUCCESS, DELETE_NOT_SUCCESS_NO_ENTRY } <span class="hljs-keyword"><span class="hljs-keyword">ht_rescode_t</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">packed</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ht_command_t</span></span> cmd; <span class="hljs-keyword"><span class="hljs-keyword">ht_rescode_t</span></span> rescode; logic [BUCKET_WIDTH<span class="hljs-number"><span class="hljs-number">-1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] bucket; <span class="hljs-comment"><span class="hljs-comment">// valid only for opcode = OP_SEARCH logic [VALUE_WIDTH-1:0] found_value; } ht_result_t;</span></span></code> </pre> <br><p>  <strong>Note</strong> : <br>  In fact, in <code>ht_result_t</code> we are only concerned with <code>rescode</code> and <code>found_value</code> , but running a little ahead, it would be more difficult to verify without other fields.  Anyway, if they are not used in hardware, the synthesizer will cut them out and they will not occupy resources. </p><br><p>  What and where is located: </p><br><ul><li>  All data ( <code>key</code> , <code>value</code> ) is stored in <code>data_table</code> memory. </li><li>  Next to the data is stored information for organizing a linked list ( <code>next_ptr</code> , <code>next_ptr_val</code> ). </li><li>  The cell number where the start of the linked list for the cart is located is stored in the <code>head_table</code> . </li><li>  <code>empty_ptr_storage</code> stores numbers of empty lines in <code>data_table</code> . </li></ul><br><p>  Word in <code>head_table</code> : </p><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">packed</span></span></span><span class="hljs-class"> {</span></span> logic [HEAD_PTR_WIDTH<span class="hljs-number"><span class="hljs-number">-1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] ptr; logic ptr_val; } <span class="hljs-keyword"><span class="hljs-keyword">head_ram_data_t</span></span>;</code> </pre> <br><p>  Word in <code>data_table</code> : </p><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">packed</span></span></span><span class="hljs-class"> {</span></span> logic [KEY_WIDTH<span class="hljs-number"><span class="hljs-number">-1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] key; logic [VALUE_WIDTH<span class="hljs-number"><span class="hljs-number">-1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] value; logic [HEAD_PTR_WIDTH<span class="hljs-number"><span class="hljs-number">-1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] next_ptr; logic next_ptr_val; } <span class="hljs-keyword"><span class="hljs-keyword">ram_data_t</span></span>;</code> </pre> <br><p>  Work algorithm: </p><br><ul><li>  <code>calc_hash</code> uses the <code>key</code> to calculate the hash (its value will be the basket number ( <code>bucket_num</code> )). </li><li>  use <code>bucket_num</code> as the address for <code>head_table</code> : we get a pointer to the beginning of the linked list for the basket. </li><li>  the multiplexer distributes the job to the desired module ( <code>data_table_search</code> , <code>data_table_insert</code> , <code>data_table_delete</code> ) (focusing on <code>opcode</code> ). </li><li>  modules that receive the corresponding tasks ( <code>task</code> ) for execution (find, insert, delete) and read / write from the <code>data_table</code> (run on the linked list).  Form the result <code>ht_res</code> . </li></ul><br><p>  Interesting nuances: </p><br><ul><li>  The <code>data_table</code> memory has a read delay of two clocks, so in order to perform a search for each beat, several (five) parallel modules are made, the tasks between which are distributed by round-robin. </li><li>  For speeding up the search for a free cell, an <code>empty_ptr_storage</code> provided.  At the time of this writing, it is implemented very inefficiently: with the vector <code>empty_ptr_mask</code> (its length is the number of cells in the <code>data_table</code> table), which is stored on the registers.  And the search for an empty element occurs "brute force" for zero cycles (on the combination).  In terms of resources and frequency, this is not the best solution. </li></ul><br><p>  It looks like this ( <em>click to enlarge</em> ): <br> <a href=""><img src="https://habrastorage.org/files/d08/eae/6d1/d08eae6d1671420cb6867a7ac00a996a.png"></a> </p><br><h2>  What I did to avoid errors / simplify debugging </h2><br><p>  Before starting to make a hash table, I understood that the project was not easy, so I had foreseen in advance some things that accelerated development and simplified debugging. </p><br><h3>  SystemVerilog &amp; Coding Style </h3><br><p>  SystemVerilog and corporate coding style were used as the HDL language. </p><br><p>  It allows you to conveniently describe the structure (see above) and create your own data types, for example, to describe the FSM: </p><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> { IDLE_S, NO_VALID_HEAD_PTR_S, READ_HEAD_S, GO_ON_CHAIN_S, KEY_MATCH_S, ON_TAIL_WITHOUT_MATCH_S } state, next_state;</code> </pre> <br><h3>  Stream Interface (Avalon-ST) </h3><br><p>  When designing a pipeline, you need to be well aware of when it will <a href="https://habrahabr.ru/company/metrotek/blog/235037/">stop</a> . <br>  You can think of a lot of things, but it is best to use ready-made, developed interfaces. </p><br><p>  At work, I write under Altera's FPGA, so I‚Äôm better acquainted with the interfaces that they offer / promote.  In this project, I used the <a href="https://www.altera.com/content/dam/altera-www/global/en_US/pdfs/literature/manual/mnl_avalon_spec.pdf">Avalon</a> family. </p><br><p>  Commands are just a data stream (one word is one command), so I used the standard <code>Avalon-Streaming (Avalon-ST)</code> ( <code>data</code> , <code>ready</code> , <code>valid</code> signals). </p><br><p>  This is how a transaction on <code>Avalon-ST</code> looks like with <code>readyLatency = 0</code> ( <em>taken from the standard</em> ): </p><br><img src="https://habrastorage.org/getpro/habr/post_images/54d/8b6/9ca/54d8b69ca360b5f8202f681a65564dc8.png" width="600" height="312"><br><p>  In this picture you can see that the <em>ready</em> signal, which is controlled by the slave, closes the transaction and data transfer. </p><br><h3>  Dummy hash </h3><br><p>  When I wondered how I would make this hash table, I understood that the most difficult thing would be in its verification.  Obviously, the most interesting nuances appear when you try to add to the chain, where you already have data, or you delete it from the long chain and so on. </p><br><p>  This means that when the impact on the system is given, then you need to be able to easily generate a key using a predefined basket number. </p><br><p>  With real hash functions, this is problematic, so the <code>HASH_TYPE</code> parameter is <code>HASH_TYPE</code> to <code>"dummy hash"</code> . <br>  If this type of hash is selected, then the basket number is simply the highest <code>BUCKET_WIDTH</code> bit from the key. </p><br><p>  Therefore, when <code>key = 0x92123456</code> , and <code>BUCKET_WIDTH</code> is 8, then <code>bucket_num = 0x92</code> . <br>  This will make it easy to make the necessary impact for the generation of certain boundary cases. </p><br><h3>  Logging in simulation </h3><br><p>  Sometimes developers debug their RTL modules directly on hardware (read, boards) using <a href="https://marsohod.org/11-blog/213-signaltap">SignalTap</a> or <a href="http://www.xilinx.com/products/design-tools/chipscopepro.html">ChipScope</a> .  This approach is not always the fastest and most productive - it requires rebuilding the entire project (from 10 minutes to several hours) (and sometimes more than once), the board is at hand, the debugger, the generation of input effects, etc. </p><br><p>  To speed up development, special <a href="https://en.wikipedia.org/wiki/List_of_HDL_simulators">simulators are used</a> , such as <a href="https://www.mentor.com/products/fv/modelsim/">ModelSim</a> , VCS, Icarus Verilog, etc. They allow you to track the values ‚Äã‚Äãof all (or selected) signals / <em>variables</em> during debugging by constructing time diagrams (time frame).  A huge amount of time can be spent on viewing these diagrams during debugging. </p><br><p>  <strong>Solution</strong> : <br>  Log all actions that occur, for quick viewing with your eyes. </p><br><p>  To do this, in <code>data_table_insert</code> , <code>data_table_delete</code> , <code>data_table_search</code> I added functions that print to the log: </p><br><pre> <code class="hljs perl">function void <span class="hljs-keyword"><span class="hljs-keyword">print</span></span>( string <span class="hljs-keyword"><span class="hljs-keyword">s</span></span> ); $display(<span class="hljs-string"><span class="hljs-string">"%08t: %m: %s"</span></span>, $time, <span class="hljs-keyword"><span class="hljs-keyword">s</span></span>); endfunction</code> </pre> <br><p>  The <code>display</code> format is similar to <code>printf</code> (you can use <code>%d</code> , <code>%f</code> , etc.): </p><br><ul><li>  <code>%08t</code> - displays the simulation time (it will be convenient then to jump at the right time). </li><li>  <code>%m</code> - prints the module (hierarchical name) where it occurred.  (Attention: this does not require arguments!) </li><li>  <code>%s</code> - print line </li></ul><br><p>  Log FSM transitions: </p><br><pre> <code class="hljs perl">function void print_state_transition( ); string msg; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( next_state != <span class="hljs-keyword"><span class="hljs-keyword">state</span></span> ) begin $sformat( msg, <span class="hljs-string"><span class="hljs-string">"%s -&gt; %s"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">state</span></span>, next_state ); <span class="hljs-keyword"><span class="hljs-keyword">print</span></span>( msg ); end endfunction</code> </pre> <br><p>  We are printing a new assignment: </p><br><pre> <code class="hljs lua"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pdata2str</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( input ht_pdata_t pdata )</span></span></span></span>; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> s; $sformat( s, <span class="hljs-string"><span class="hljs-string">"opcode = %s key = 0x%x value = 0x%x head_ptr = 0x%x head_ptr_val = 0x%x"</span></span>, pdata.cmd.opcode, pdata.cmd.key, pdata.cmd.value, pdata.head_ptr, pdata.head_ptr_val ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> s; endfunction <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print_new_task</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( ht_pdata_t pdata )</span></span></span></span>; <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>( pdata2str( pdata ) ); endfunction</code> </pre> <br><p>  And so on... </p><br><p>  For simulation I use ModelSim.  In his log, which is displayed on the screen (and by default will go into the <code>transcript</code> file), the following lines appear: </p><br><pre> <code class="hljs go"><span class="hljs-number"><span class="hljs-number">1465</span></span>: top_tb.dut.d_tbl.sea_eng.g_s_eng[<span class="hljs-number"><span class="hljs-number">3</span></span>].search.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: opcode = OP_SEARCH key = <span class="hljs-number"><span class="hljs-number">0x04000000</span></span> value = <span class="hljs-number"><span class="hljs-number">0x0000</span></span> head_ptr = <span class="hljs-number"><span class="hljs-number">0x000</span></span> head_ptr_val = <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">1465</span></span>: top_tb.dut.d_tbl.sea_eng.g_s_eng[<span class="hljs-number"><span class="hljs-number">3</span></span>].search.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: IDLE_S -&gt; NO_VALID_HEAD_PTR_S <span class="hljs-number"><span class="hljs-number">1475</span></span>: top_tb.dut.d_tbl.sea_eng.g_s_eng[<span class="hljs-number"><span class="hljs-number">3</span></span>].search.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: RES: key = <span class="hljs-number"><span class="hljs-number">0x04000000</span></span> value = <span class="hljs-number"><span class="hljs-number">0x0000</span></span> rescode = SEARCH_NOT_SUCCESS_NO_ENTRY <span class="hljs-number"><span class="hljs-number">1475</span></span>: top_tb.dut.d_tbl.sea_eng.g_s_eng[<span class="hljs-number"><span class="hljs-number">3</span></span>].search.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: NO_VALID_HEAD_PTR_S -&gt; IDLE_S <span class="hljs-number"><span class="hljs-number">1475</span></span>: ht_tb.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: IN_MONITOR: key = <span class="hljs-number"><span class="hljs-number">0x04000000</span></span> value = <span class="hljs-number"><span class="hljs-number">0x0000</span></span> rescode = SEARCH_NOT_SUCCESS_NO_ENTRY <span class="hljs-number"><span class="hljs-number">1485</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: opcode = OP_DELETE key = <span class="hljs-number"><span class="hljs-number">0x04111111</span></span> value = <span class="hljs-number"><span class="hljs-number">0x0000</span></span> head_ptr = <span class="hljs-number"><span class="hljs-number">0x000</span></span> head_ptr_val = <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">1485</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: IDLE_S -&gt; NO_VALID_HEAD_PTR_S <span class="hljs-number"><span class="hljs-number">1495</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: RES: key = <span class="hljs-number"><span class="hljs-number">0x04111111</span></span> value = <span class="hljs-number"><span class="hljs-number">0x0000</span></span> rescode = DELETE_NOT_SUCCESS_NO_ENTRY <span class="hljs-number"><span class="hljs-number">1495</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: NO_VALID_HEAD_PTR_S -&gt; IDLE_S <span class="hljs-number"><span class="hljs-number">1495</span></span>: ht_tb.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: IN_MONITOR: key = <span class="hljs-number"><span class="hljs-number">0x04111111</span></span> value = <span class="hljs-number"><span class="hljs-number">0x0000</span></span> rescode = DELETE_NOT_SUCCESS_NO_ENTRY <span class="hljs-number"><span class="hljs-number">1505</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: opcode = OP_INSERT key = <span class="hljs-number"><span class="hljs-number">0x04000000</span></span> value = <span class="hljs-number"><span class="hljs-number">0xb95f</span></span> head_ptr = <span class="hljs-number"><span class="hljs-number">0x000</span></span> head_ptr_val = <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">1505</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: IDLE_S -&gt; NO_HEAD_PTR_WR_HEAD_PTR_S <span class="hljs-number"><span class="hljs-number">1515</span></span>: top_tb.dut.h_tbl.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: addr = <span class="hljs-number"><span class="hljs-number">0x04</span></span> wr_data.ptr = <span class="hljs-number"><span class="hljs-number">0x003</span></span> wr_data.ptr_val = <span class="hljs-number"><span class="hljs-number">0x1</span></span> <span class="hljs-number"><span class="hljs-number">1515</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: NO_HEAD_PTR_WR_HEAD_PTR_S -&gt; NO_HEAD_PTR_WR_DATA_S <span class="hljs-number"><span class="hljs-number">1525</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: WR: addr = <span class="hljs-number"><span class="hljs-number">0x003</span></span> key = <span class="hljs-number"><span class="hljs-number">0x04000000</span></span> value = <span class="hljs-number"><span class="hljs-number">0xb95f</span></span> next_ptr = <span class="hljs-number"><span class="hljs-number">0x000</span></span>, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">1525</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: RES: key = <span class="hljs-number"><span class="hljs-number">0x04000000</span></span> value = <span class="hljs-number"><span class="hljs-number">0xb95f</span></span> rescode = INSERT_SUCCESS <span class="hljs-number"><span class="hljs-number">1525</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: NO_HEAD_PTR_WR_DATA_S -&gt; IDLE_S</code> </pre> <br><p>  Such a text log is easy to grep'at, or run a search (for example, in vim'e). </p><br><p>  The logs saved a huge amount of time: when submitting simple examples, I knew what order should be written and just looked in the log.  If an error occurred, then proceeded to the analysis of the code, and not the time diagrams. </p><br><p>  I advise everyone to try to debug the RTL-code without a temporary house during the week (leave the comfort zone). </p><br><h3>  Verification </h3><br><p>  If you turn to good literature, for example, <a href="http://www.amazon.com/SystemVerilog-Verification-Learning-Testbench-Language/dp/1461407141">SystemVerilog for Verification</a> , then as a good, correct testbench the following scheme is given there: </p><br><img src="https://habrastorage.org/files/512/72e/4d1/51272e4d10994b4dadbdd8a72c5ddb3e.png"><br><p>  In this article, I'm not going to take away the bread from Chris Spear, so I‚Äôm not going to talk in detail about what all these components mean. </p><br><p>  My testbench circuit: </p><br><img src="https://habrastorage.org/files/a42/43d/536/a4243d53696649628ddc6eda431e56a7.png"><br><h4>  top_tb </h4><br><p>  Top module. </p><br><h4>  DUT (Device / Design Under Test) </h4><br><p>  Our experimental is an instance of the <code>hash_table_top</code> module. </p><br><h4>  ht_driver </h4><br><ul><li>  contains the mailbox <code>gen2drv</code> , which is intended for commands that will be sent to the <code>DUT</code> . </li><li>  as soon as a command appears in this queue, it will be sent to the <code>DUT</code> . </li><li>  after sending the command to the <code>DUT</code> , it is copied to the <code>ht_scoreboard</code> . </li></ul><br><p>  To put a command in this mailbox, hierarchical access is used: </p><br><pre> <code class="hljs pgsql">task send_to_dut_c( <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> ht_command_t c ); // <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> hierarchial <span class="hljs-keyword"><span class="hljs-keyword">access</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> put command <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> mailbox env.drv.gen2drv.put( c ); endtask</code> </pre> <br><h4>  tests </h4><br><p>  To test the performance were written three tests / input effects. </p><br><p>  Macros to simplify work: </p><br><pre> <code class="hljs markdown"><span class="hljs-code"><span class="hljs-code">`define CMD( _OP, _KEY, _VALUE ) cmds.push_back( '{ opcode : _OP, key : _KEY, value : _VALUE } ); `</span></span>define CMD<span class="hljs-emphasis"><span class="hljs-emphasis">_SEARCH( _</span></span>KEY ) <span class="hljs-code"><span class="hljs-code">`CMD( OP_SEARCH, _KEY, 0 ) `</span></span>define CMD<span class="hljs-emphasis"><span class="hljs-emphasis">_INSERT( _</span></span>KEY, <span class="hljs-emphasis"><span class="hljs-emphasis">_VALUE ) `CMD( OP_</span></span>INSERT, <span class="hljs-emphasis"><span class="hljs-emphasis">_KEY, _</span></span>VALUE ) <span class="hljs-code"><span class="hljs-code">`define CMD_INSERT_RAND( _KEY ) `</span></span>CMD<span class="hljs-emphasis"><span class="hljs-emphasis">_INSERT( _</span></span>KEY, $urandom() ) <span class="hljs-code"><span class="hljs-code">`define CMD_DELETE( _KEY ) `</span></span>CMD( OP<span class="hljs-emphasis"><span class="hljs-emphasis">_DELETE, _</span></span>KEY, 0 )</code> </pre> <br><p>  Test example: </p><br><pre> <code class="hljs matlab">task test_01( ); ht_command_t cmds[$]; $display(<span class="hljs-string"><span class="hljs-string">"%m:"</span></span>); `CMD_INSERT( <span class="hljs-number"><span class="hljs-number">32</span></span>'h01_00_00_00, <span class="hljs-number"><span class="hljs-number">16</span></span>'h1234 ) `CMD_INSERT( <span class="hljs-number"><span class="hljs-number">32</span></span>'h01_00_10_00, <span class="hljs-number"><span class="hljs-number">16</span></span>'h1235 ) `CMD_INSERT_RAND( <span class="hljs-number"><span class="hljs-number">32</span></span>'h01_00_00_00 ) `CMD_INSERT_RAND( <span class="hljs-number"><span class="hljs-number">32</span></span>'h01_00_00_01 ) `CMD_DELETE ( <span class="hljs-number"><span class="hljs-number">32</span></span>'h01_00_00_00 ) `CMD_INSERT_RAND( <span class="hljs-number"><span class="hljs-number">32</span></span>'h01_00_00_02 ) `CMD_SEARCH( <span class="hljs-number"><span class="hljs-number">32</span></span>'h01_00_00_00 ) `CMD_SEARCH( <span class="hljs-number"><span class="hljs-number">32</span></span>'h01_00_00_01 ) `CMD_SEARCH( <span class="hljs-number"><span class="hljs-number">32</span></span>'h01_00_00_01 ) `CMD_SEARCH( <span class="hljs-number"><span class="hljs-number">32</span></span>'h01_00_00_03 ) foreach( cmds[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>] ) begin send_to_dut_c( cmds[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>] ); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> endtask</code> </pre> <br><h4>  ht_monitor </h4><br><ul><li>  monitors the output interface <code>ht_res</code> . </li><li>  as soon as there is a result, it hooks it out and sends it to the <code>ht_scoreboard</code> . </li></ul><br><h4>  ht_scoreboard </h4><br><p>  Checks the correctness of the DUT'a work. </p><br><p>  It contains: </p><br><ul><li>  two <code>mailbox</code> , where put the command and the result of <code>ht_driver</code> and <code>ht_monitor</code> respectively. </li><li>  reference hash table <code>ref_hash_table</code> . </li></ul><br><p>  Work algorithm: </p><br><ul><li>  as soon as the result of <code>ht_res</code> came, he and the corresponding request are removed from the queue.  Here we are in the hands of the fact that each team will be answered. </li><li>  the <code>check</code> function is called, which feeds the command to the reference model and compares the results from the DUT and the reference model. </li><li>  if there is no match, then using <code>$error</code> the message will be printed to the log, and a red arrow will appear in the ModelSim GUI at the moment it happened. </li></ul><br><h3>  Coverage </h3><br><p>  So, there is already a system (if you wish, a framework) that allows you to send various input effects, as well as analyze the correctness of the DUT reaction.  In order to make sure that there are no bugs, it is necessary to cover "all possible" options. </p><br><p>  Objects such as <a href="http://www.testbench.in/CO_00_INDEX.html">covergroup and coverpoint are</a> introduced to assess coverage in the SystemVerilog language.  With their help, you can describe those points where we want to sample, as well as what statistics to collect. </p><br><pre> <code class="hljs objectivec">covergroup cg(); option.per_instance = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">CMDOP</span></span>: coverpoint result_locked.cmd.opcode; <span class="hljs-built_in"><span class="hljs-built_in">CMDRES</span></span>: coverpoint result_locked.rescode; BUCKOCUP: coverpoint bucket_occup[ result_locked.bucket ] { bins zero = { <span class="hljs-number"><span class="hljs-number">0</span></span> }; bins one = { <span class="hljs-number"><span class="hljs-number">1</span></span> }; bins two = { <span class="hljs-number"><span class="hljs-number">2</span></span> }; bins three = { <span class="hljs-number"><span class="hljs-number">3</span></span> }; bins four = { <span class="hljs-number"><span class="hljs-number">4</span></span> }; bins other = { [<span class="hljs-number"><span class="hljs-number">5</span></span>:$] }; } <span class="hljs-built_in"><span class="hljs-built_in">CMDOP_BUCKOCUP</span></span>: cross <span class="hljs-built_in"><span class="hljs-built_in">CMDOP</span></span>, BUCKOCUP; <span class="hljs-built_in"><span class="hljs-built_in">CMDRES_BUCKOCUP</span></span>: cross <span class="hljs-built_in"><span class="hljs-built_in">CMDRES</span></span>, BUCKOCUP { <span class="hljs-comment"><span class="hljs-comment">// we should ignore SEARCH_FOUND, INSERT_SUCCESS_SAME_KEY, DELETE_SUCCESS // when in bucket was zero elements, because it's not real situation ignore_bins not_real = binsof( CMDRES ) intersect{ SEARCH_FOUND, INSERT_SUCCESS_SAME_KEY, DELETE_SUCCESS } &amp;&amp; binsof( BUCKOCUP ) intersect{ 0 }; } endgroup</span></span></code> </pre> <br><p>  Explanation: </p><br><ul><li>  <code>CMDOP</code> and <code>CMDRES</code> keep track of what the <code>ht_cmd</code> operations <code>ht_cmd</code> and the results of <code>ht_res</code> . </li><li>  array <code>bucket_occup</code> stores the number of items that were in the basket at the time of the operation. </li><li>  <code>CMDOP_BUCKOCUP</code> - "crosses" the commands with the number of items in the basket: we get the events, the command was X, and in the basket, to which the <code>key</code> belonged, where were the Y elements. </li><li>  <code>CMDRES_BUCKOCUP</code> - "crosses" the result with the number of items in the basket. </li></ul><br><p>  After the simulation is finished, you can get a report in the ModelSim console: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">coverage</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">save</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.ucdb</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">vcover</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">report</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.ucdb</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-verbose</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-cvg</span></span></code> </pre> <br><p>  Report: </p><br><pre> <code class="hljs cpp">COVERGROUP COVERAGE: ---------------------------------------------------------------------------------------------------- Covergroup Metric Goal/ Status At Least ---------------------------------------------------------------------------------------------------- TYPE /top_tb/dut/resm/cg <span class="hljs-number"><span class="hljs-number">94.0</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Uncovered Coverpoint cg::CMDOP <span class="hljs-number"><span class="hljs-number">100.0</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Covered Coverpoint cg::CMDRES <span class="hljs-number"><span class="hljs-number">85.7</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Uncovered Coverpoint cg::BUCKOCUP <span class="hljs-number"><span class="hljs-number">100.0</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Covered Cross cg::CMDOP_BUCKOCUP <span class="hljs-number"><span class="hljs-number">100.0</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Covered Cross cg::CMDRES_BUCKOCUP <span class="hljs-number"><span class="hljs-number">84.6</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Uncovered Covergroup instance \/top_tb/dut/resm/cg1 <span class="hljs-number"><span class="hljs-number">94.0</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Uncovered Coverpoint CMDOP <span class="hljs-number"><span class="hljs-number">100.0</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Covered covered/total bins: <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> missing/total bins: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> bin <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>[OP_SEARCH] <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered bin <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>[OP_INSERT] <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered bin <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>[OP_DELETE] <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered Coverpoint CMDRES <span class="hljs-number"><span class="hljs-number">85.7</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Uncovered covered/total bins: <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> missing/total bins: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> bin <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>[SEARCH_FOUND] <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered bin <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>[SEARCH_NOT_SUCCESS_NO_ENTRY] <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered bin <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>[INSERT_SUCCESS] <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered bin <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>[INSERT_SUCCESS_SAME_KEY] <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered bin <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>[INSERT_NOT_SUCCESS_TABLE_IS_FULL] <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ZERO bin <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>[DELETE_SUCCESS] <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered bin <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>[DELETE_NOT_SUCCESS_NO_ENTRY] <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered Coverpoint BUCKOCUP <span class="hljs-number"><span class="hljs-number">100.0</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Covered covered/total bins: <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> missing/total bins: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> bin zero <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered bin one <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered bin two <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered bin three <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered bin four <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered bin other <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered Cross CMDOP_BUCKOCUP <span class="hljs-number"><span class="hljs-number">100.0</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Covered covered/total bins: <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> missing/total bins: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> bin &lt;<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>[OP_SEARCH],zero&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered bin &lt;<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>[OP_INSERT],zero&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered bin &lt;<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>[OP_SEARCH],one&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered ... Cross CMDRES_BUCKOCUP <span class="hljs-number"><span class="hljs-number">84.6</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Uncovered covered/total bins: <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">39</span></span> missing/total bins: <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">39</span></span> bin &lt;<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>[SEARCH_NOT_SUCCESS_NO_ENTRY],zero&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered bin &lt;<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>[INSERT_SUCCESS],zero&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered bin &lt;<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>[DELETE_NOT_SUCCESS_NO_ENTRY],zero&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Covered ...</code> </pre> <br><p>  All possible crosses were obtained automatically - we did not write anything extra. </p><br><p>  After three tests, it is clear that: </p><br><ul><li>  <code>OP_INSERT</code> were 21 <code>OP_INSERT</code> insertion <code>OP_INSERT</code> , and 18 </li><li>  only once tried to search when there were no items in the basket </li><li>  never had an <code>INSERT_NOT_SUCCESS_TABLE_IS_FULL</code> event </li></ul><br><h3>  Eventually </h3><br><ul><li>  There is a system that checks whether the DUT is working correctly by comparing its output with the reference model. </li><li>  There is a small set of tests that generate input effects. </li><li>  There is a feedback about the quality of tests (coverage). </li><li>  debug and simulate in advance using dummy hash and logging. </li></ul><br><h2>  What was the bug </h2><br><p>  It turned out, if you submit such an impact: </p><br><pre> <code class="hljs scala">`<span class="hljs-type"><span class="hljs-type">CMD_INSERT_RAND</span></span>( <span class="hljs-number"><span class="hljs-number">32</span></span><span class="hljs-symbol"><span class="hljs-symbol">'h05_00_00_00</span></span> ) `<span class="hljs-type"><span class="hljs-type">CMD_INSERT_RAND</span></span>( <span class="hljs-number"><span class="hljs-number">32</span></span><span class="hljs-symbol"><span class="hljs-symbol">'h05_00_00_01</span></span> ) `<span class="hljs-type"><span class="hljs-type">CMD_DELETE</span></span> ( <span class="hljs-number"><span class="hljs-number">32</span></span><span class="hljs-symbol"><span class="hljs-symbol">'h05_00_00_01</span></span> ) `<span class="hljs-type"><span class="hljs-type">CMD_INSERT_RAND</span></span>( <span class="hljs-number"><span class="hljs-number">32</span></span><span class="hljs-symbol"><span class="hljs-symbol">'h05_00_00_02</span></span> ) `<span class="hljs-type"><span class="hljs-type">CMD_INSERT_RAND</span></span>( <span class="hljs-number"><span class="hljs-number">32</span></span><span class="hljs-symbol"><span class="hljs-symbol">'h05_00_00_03</span></span> )</code> </pre> <br><p>  then this will cause the <code>0x05000003</code> module <code>data_table_insert</code> "hang" when inserting the key <code>0x05000003</code> : </p><br><ul><li>  constantly reading from address 0x001 </li><li>  the state of the FSM <code>state</code> hangs in <code>GO_ON_CHAIN_S</code> (and will never leave it again) </li></ul><br><p> <a href=""><img src="https://habrastorage.org/files/026/798/6d3/0267986d381f4dd8b0294c40be007eb7.png"></a> <br>  ( <em>click to enlarge</em> ) </p><br><p>  There are messages in the log: </p><br><pre> <code class="hljs dos"><span class="hljs-number"><span class="hljs-number">385</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: opcode = OP_INSERT key = <span class="hljs-number"><span class="hljs-number">0</span></span>x05000003 value = <span class="hljs-number"><span class="hljs-number">0</span></span>x7e7e head_ptr = <span class="hljs-number"><span class="hljs-number">0</span></span>x000 head_ptr_val = <span class="hljs-number"><span class="hljs-number">0</span></span>x1 <span class="hljs-number"><span class="hljs-number">385</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: IDLE_S -&gt; READ_HEAD_S <span class="hljs-number"><span class="hljs-number">415</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">RD</span></span>: addr = <span class="hljs-number"><span class="hljs-number">0</span></span>x000 key = <span class="hljs-number"><span class="hljs-number">0</span></span>x05000000 value = <span class="hljs-number"><span class="hljs-number">0</span></span>x1f62 next_ptr = <span class="hljs-number"><span class="hljs-number">0</span></span>x001, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0</span></span>x1 <span class="hljs-number"><span class="hljs-number">415</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: READ_HEAD_S -&gt; GO_ON_CHAIN_S <span class="hljs-number"><span class="hljs-number">445</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">RD</span></span>: addr = <span class="hljs-number"><span class="hljs-number">0</span></span>x001 key = <span class="hljs-number"><span class="hljs-number">0</span></span>x00000000 value = <span class="hljs-number"><span class="hljs-number">0</span></span>x0000 next_ptr = <span class="hljs-number"><span class="hljs-number">0</span></span>x001, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0</span></span>x1 <span class="hljs-number"><span class="hljs-number">475</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">RD</span></span>: addr = <span class="hljs-number"><span class="hljs-number">0</span></span>x001 key = <span class="hljs-number"><span class="hljs-number">0</span></span>x00000000 value = <span class="hljs-number"><span class="hljs-number">0</span></span>x0000 next_ptr = <span class="hljs-number"><span class="hljs-number">0</span></span>x001, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0</span></span>x1 <span class="hljs-number"><span class="hljs-number">505</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">RD</span></span>: addr = <span class="hljs-number"><span class="hljs-number">0</span></span>x001 key = <span class="hljs-number"><span class="hljs-number">0</span></span>x00000000 value = <span class="hljs-number"><span class="hljs-number">0</span></span>x0000 next_ptr = <span class="hljs-number"><span class="hljs-number">0</span></span>x001, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0</span></span>x1 <span class="hljs-number"><span class="hljs-number">535</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">RD</span></span>: addr = <span class="hljs-number"><span class="hljs-number">0</span></span>x001 key = <span class="hljs-number"><span class="hljs-number">0</span></span>x00000000 value = <span class="hljs-number"><span class="hljs-number">0</span></span>x0000 next_ptr = <span class="hljs-number"><span class="hljs-number">0</span></span>x001, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0</span></span>x1 ...</code> </pre> <br><p>  Rewind a little log and analyze it.  I gave only those lines that are interesting to us (what was read and written in the <code>data_table</code> table): </p><br><pre> <code class="hljs go"> <span class="hljs-number"><span class="hljs-number">75</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: opcode = OP_INSERT key = <span class="hljs-number"><span class="hljs-number">0x05000000</span></span> value = <span class="hljs-number"><span class="hljs-number">0x1f</span></span>62 head_ptr = <span class="hljs-number"><span class="hljs-number">0x000</span></span> head_ptr_val = <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">95</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: WR: addr = <span class="hljs-number"><span class="hljs-number">0x000</span></span> key = <span class="hljs-number"><span class="hljs-number">0x05000000</span></span> value = <span class="hljs-number"><span class="hljs-number">0x1f</span></span>62 next_ptr = <span class="hljs-number"><span class="hljs-number">0x000</span></span>, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">115</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: opcode = OP_INSERT key = <span class="hljs-number"><span class="hljs-number">0x05000001</span></span> value = <span class="hljs-number"><span class="hljs-number">0x3ff</span></span>2 head_ptr = <span class="hljs-number"><span class="hljs-number">0x000</span></span> head_ptr_val = <span class="hljs-number"><span class="hljs-number">0x1</span></span> <span class="hljs-number"><span class="hljs-number">145</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: RD: addr = <span class="hljs-number"><span class="hljs-number">0x000</span></span> key = <span class="hljs-number"><span class="hljs-number">0x05000000</span></span> value = <span class="hljs-number"><span class="hljs-number">0x1f</span></span>62 next_ptr = <span class="hljs-number"><span class="hljs-number">0x000</span></span>, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">155</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: WR: addr = <span class="hljs-number"><span class="hljs-number">0x001</span></span> key = <span class="hljs-number"><span class="hljs-number">0x05000001</span></span> value = <span class="hljs-number"><span class="hljs-number">0x3ff</span></span>2 next_ptr = <span class="hljs-number"><span class="hljs-number">0x000</span></span>, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">165</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: WR: addr = <span class="hljs-number"><span class="hljs-number">0x000</span></span> key = <span class="hljs-number"><span class="hljs-number">0x05000000</span></span> value = <span class="hljs-number"><span class="hljs-number">0x1f</span></span>62 next_ptr = <span class="hljs-number"><span class="hljs-number">0x001</span></span>, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0x1</span></span> <span class="hljs-number"><span class="hljs-number">185</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: opcode = OP_DELETE key = <span class="hljs-number"><span class="hljs-number">0x05000001</span></span> value = <span class="hljs-number"><span class="hljs-number">0x0000</span></span> head_ptr = <span class="hljs-number"><span class="hljs-number">0x000</span></span> head_ptr_val = <span class="hljs-number"><span class="hljs-number">0x1</span></span> <span class="hljs-number"><span class="hljs-number">215</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: RD: addr = <span class="hljs-number"><span class="hljs-number">0x000</span></span> key = <span class="hljs-number"><span class="hljs-number">0x05000000</span></span> value = <span class="hljs-number"><span class="hljs-number">0x1f</span></span>62 next_ptr = <span class="hljs-number"><span class="hljs-number">0x001</span></span>, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0x1</span></span> <span class="hljs-number"><span class="hljs-number">245</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: RD: addr = <span class="hljs-number"><span class="hljs-number">0x001</span></span> key = <span class="hljs-number"><span class="hljs-number">0x05000001</span></span> value = <span class="hljs-number"><span class="hljs-number">0x3ff</span></span>2 next_ptr = <span class="hljs-number"><span class="hljs-number">0x000</span></span>, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: WR: addr = <span class="hljs-number"><span class="hljs-number">0x001</span></span> key = <span class="hljs-number"><span class="hljs-number">0x05000001</span></span> value = <span class="hljs-number"><span class="hljs-number">0x3ff</span></span>2 next_ptr = <span class="hljs-number"><span class="hljs-number">0x000</span></span>, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">265</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: WR: addr = <span class="hljs-number"><span class="hljs-number">0x001</span></span> key = <span class="hljs-number"><span class="hljs-number">0x00000000</span></span> value = <span class="hljs-number"><span class="hljs-number">0x0000</span></span> next_ptr = <span class="hljs-number"><span class="hljs-number">0x000</span></span>, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">285</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: opcode = OP_INSERT key = <span class="hljs-number"><span class="hljs-number">0x05000002</span></span> value = <span class="hljs-number"><span class="hljs-number">0x5429</span></span> head_ptr = <span class="hljs-number"><span class="hljs-number">0x000</span></span> head_ptr_val = <span class="hljs-number"><span class="hljs-number">0x1</span></span> <span class="hljs-number"><span class="hljs-number">315</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: RD: addr = <span class="hljs-number"><span class="hljs-number">0x000</span></span> key = <span class="hljs-number"><span class="hljs-number">0x05000000</span></span> value = <span class="hljs-number"><span class="hljs-number">0x1f</span></span>62 next_ptr = <span class="hljs-number"><span class="hljs-number">0x001</span></span>, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0x1</span></span> <span class="hljs-number"><span class="hljs-number">345</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: RD: addr = <span class="hljs-number"><span class="hljs-number">0x001</span></span> key = <span class="hljs-number"><span class="hljs-number">0x00000000</span></span> value = <span class="hljs-number"><span class="hljs-number">0x0000</span></span> next_ptr = <span class="hljs-number"><span class="hljs-number">0x000</span></span>, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">355</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: WR: addr = <span class="hljs-number"><span class="hljs-number">0x001</span></span> key = <span class="hljs-number"><span class="hljs-number">0x05000002</span></span> value = <span class="hljs-number"><span class="hljs-number">0x5429</span></span> next_ptr = <span class="hljs-number"><span class="hljs-number">0x000</span></span>, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">365</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: WR: addr = <span class="hljs-number"><span class="hljs-number">0x001</span></span> key = <span class="hljs-number"><span class="hljs-number">0x00000000</span></span> value = <span class="hljs-number"><span class="hljs-number">0x0000</span></span> next_ptr = <span class="hljs-number"><span class="hljs-number">0x001</span></span>, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0x1</span></span> <span class="hljs-number"><span class="hljs-number">385</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: opcode = OP_INSERT key = <span class="hljs-number"><span class="hljs-number">0x05000003</span></span> value = <span class="hljs-number"><span class="hljs-number">0x7e7e</span></span> head_ptr = <span class="hljs-number"><span class="hljs-number">0x000</span></span> head_ptr_val = <span class="hljs-number"><span class="hljs-number">0x1</span></span> <span class="hljs-number"><span class="hljs-number">415</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: RD: addr = <span class="hljs-number"><span class="hljs-number">0x000</span></span> key = <span class="hljs-number"><span class="hljs-number">0x05000000</span></span> value = <span class="hljs-number"><span class="hljs-number">0x1f</span></span>62 next_ptr = <span class="hljs-number"><span class="hljs-number">0x001</span></span>, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0x1</span></span> <span class="hljs-number"><span class="hljs-number">445</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: RD: addr = <span class="hljs-number"><span class="hljs-number">0x001</span></span> key = <span class="hljs-number"><span class="hljs-number">0x00000000</span></span> value = <span class="hljs-number"><span class="hljs-number">0x0000</span></span> next_ptr = <span class="hljs-number"><span class="hljs-number">0x001</span></span>, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0x1</span></span> <span class="hljs-number"><span class="hljs-number">475</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: RD: addr = <span class="hljs-number"><span class="hljs-number">0x001</span></span> key = <span class="hljs-number"><span class="hljs-number">0x00000000</span></span> value = <span class="hljs-number"><span class="hljs-number">0x0000</span></span> next_ptr = <span class="hljs-number"><span class="hljs-number">0x001</span></span>, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0x1</span></span> <span class="hljs-number"><span class="hljs-number">505</span></span>: top_tb.dut.d_tbl.ins_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: RD: addr = <span class="hljs-number"><span class="hljs-number">0x001</span></span> key = <span class="hljs-number"><span class="hljs-number">0x00000000</span></span> value = <span class="hljs-number"><span class="hljs-number">0x0000</span></span> next_ptr = <span class="hljs-number"><span class="hljs-number">0x001</span></span>, next_ptr_val = <span class="hljs-number"><span class="hljs-number">0x1</span></span></code> </pre> <br><p>  You may notice that at the time point of 255-265 ns strange events occurred: first, one value was written to <code>addr = 0x001</code> and then another value. </p><br><p>  This leads to the fact that the <code>data_table</code> table contains incorrect data: </p><br><ul><li>  cell 0x000 indicates that there is a continuation of the chain in cell 0x001 ( <code>next_ptr = 0x001</code> , <code>next_ptr_val = 0x1</code> ) </li><li>  In cell 0x001, the key 0x00000000 is stored.  It can not be in the basket 0x05, because  <code>dummy hash</code> used in the simulation. </li></ul><br><p>  When adding the key 0x05000002, an interesting situation occurs: again, writing to the same cell 0x001 occurs twice. </p><br><ul><li>  writing to 355 ns records the new value, since  the <code>empty_ptr_storage</code> module issued that 0x001 is empty (we were lucky that now the algorithm of this module is such that it gives the smallest address that is considered empty) </li><li>  the 365 ns record updates the cell that is previous in the chain, and in the opinion of the module it is 0x001.  In total, 0x001 now points to 0x001. </li></ul><br><p>  When you try to add a key 0x05000003, a loop occurs as you move through the chain.  Starting from 445 ns, we will run endlessly along the chain and read the same address. </p><br><h3>  What was the mistake </h3><br><p>  Obviously, the error is made by the module that deleted the data ( <code>data_table_delete</code> ). </p><br><p>  At 255 ns, he should have made the next_ptr_val flag in cell 0x000 equal to zero, and at 265 ns, write 0x001 to write all zeros.  So it was assumed by the code of this module, but this, as we see, did not happen. </p><br><p>  The fact is that it was necessary to separately save <code>rd_addr</code> and <code>rd_data</code> , which we read from the end of the chain, and so we used the values ‚Äã‚Äãwe had just worked with. </p><br><p>  Such errors (an extra delay by one clock cycle, overwritten data at the wrong time, etc.) are quite typical in the RTL code.  They don‚Äôt have much interest, so I‚Äôm not really writing about it in the article. </p><br><h2>  What mistakes were made (during development) </h2><br><h3>  Keeping the project "imperfect" </h3><br><p>  The fact is that I did not bring the project to its logical end, which I imagined.  Why - now I do not remember. </p><br><p>  For example, in the project's <code>README</code> is not specified where and how this module was used / tested. </p><br><p>  Compare two phrases: </p><br><ol><li>  This project is used in production on a <a href="http://metrotek.spb.ru/b100.html">100G switch</a> . </li><li>  this project was written for fun on several weekends over <del>  cans of beer </del>  tomato juice. </li></ol><br><p>  If I explicitly indicated that I wrote this module just like that on weekends and did not embed it anywhere, then perhaps third-party developers would not use my module and save themselves time (although then I would not know that I have a bug , and you would not read this article). </p><br><p>  When I started to <code>prev_rd_addr</code> out where the problem is in the code, I was upset when I saw that the problem was with the variable <code>prev_rd_addr</code> .  The block where its value is assigned looks like this: </p><br><pre> <code class="hljs scala">always_ff @( posedge clk_i or posedge rst_i ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( rst_i ) prev_rd_addr &lt;= <span class="hljs-symbol"><span class="hljs-symbol">'0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( rd_en_o ) <span class="hljs-comment"><span class="hljs-comment">//FIXME prev_rd_addr &lt;= rd_addr;</span></span></code> </pre> <br><p>  <code>FIXME</code> without explanation is bad.  The extra five minutes of describing a problem will always pay off in the future. </p><br><p>  * <em>Conclusions</em> : </p><br><ul><li>  if you lay out something in open-source, clearly indicate how and where it was tested on hardware (if tested).  If it has not been tested, then write about it explicitly. </li><li>     ,  - (  ,   electronix.ru)  . ,   - , . </li><li>    ,      (,   ),       , <code>KNOWN_PROBLEMS</code> / <code>KNOWN_BUGS</code> </li></ul><br><h3> Coverage </h3><br><p>  ,   ,    ,    : </p><br><ul><li>   "":            . </li><li>        ,     ( //). </li></ul><br><p> <strong></strong> : </p><br><p>   <code>ht_chain_state_t</code> ,   ,     : </p><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> { NO_CHAIN, IN_HEAD, IN_MIDDLE, IN_TAIL, IN_TAIL_NO_MATCH } <span class="hljs-keyword"><span class="hljs-keyword">ht_chain_state_t</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    ht_result_t ... // only for verification ht_chain_state_t chain_state; } ht_result_t;</span></span></code> </pre> <br><p>     .  <code>data_table_delete</code>   : </p><br><pre> <code class="hljs pgsql">ht_chain_state_t chain_state; always_ff @( posedge clk_i <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> posedge rst_i ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( rst_i ) chain_state &lt;= NO_CHAIN; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( state != next_state ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>( next_state ) NO_VALID_HEAD_PTR_S : chain_state &lt;= NO_CHAIN; IN_TAIL_WITHOUT_MATCH_S : chain_state &lt;= IN_TAIL_NO_MATCH; KEY_MATCH_IN_HEAD_S : chain_state &lt;= IN_HEAD; KEY_MATCH_IN_MIDDLE_S : chain_state &lt;= IN_MIDDLE; KEY_MATCH_IN_TAIL_S : chain_state &lt;= IN_TAIL; // <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: just keep <span class="hljs-built_in"><span class="hljs-built_in">old</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> endcase <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> //   ,    ```ht_res_monitor``` assign result_o.chain_state = chain_state;</code> </pre> <br><p>   <code>ht_res_monitor</code> : </p><br><pre> <code class="hljs pgsql">//   ht_result_t result_history [HISTORY_DELAY:<span class="hljs-number"><span class="hljs-number">1</span></span>]; always_ff @( posedge clk_i ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( result_locked_val ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> result_history[<span class="hljs-number"><span class="hljs-number">1</span></span>] &lt;= result_locked; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt;= HISTORY_DELAY; i++ ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> result_history[i] &lt;= result_history[i<span class="hljs-number"><span class="hljs-number">-1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> // <span class="hljs-number"><span class="hljs-number">1</span></span>   ,   (bucket)    logic [HISTORY_DELAY:<span class="hljs-number"><span class="hljs-number">1</span></span>] bucket_hist_mask; always_comb <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt;= HISTORY_DELAY; i++ ) bucket_hist_mask[i] = ( result_history[i].bucket == result_locked.bucket ); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>   covergroup: </p><br><pre> <code class="hljs objectivec">... <span class="hljs-built_in"><span class="hljs-built_in">CMDOP_D1</span></span>: coverpoint result_history[<span class="hljs-number"><span class="hljs-number">1</span></span>].cmd.opcode; <span class="hljs-built_in"><span class="hljs-built_in">CMDOP_D2</span></span>: coverpoint result_history[<span class="hljs-number"><span class="hljs-number">2</span></span>].cmd.opcode; <span class="hljs-built_in"><span class="hljs-built_in">CMDRES_D1</span></span>: coverpoint result_history[<span class="hljs-number"><span class="hljs-number">1</span></span>].rescode; <span class="hljs-built_in"><span class="hljs-built_in">CMDRES_D2</span></span>: coverpoint result_history[<span class="hljs-number"><span class="hljs-number">2</span></span>].rescode; CHAIN: coverpoint result_locked.chain_state; BUCK_HIST_MASK: coverpoint bucket_hist_mask; <span class="hljs-built_in"><span class="hljs-built_in">CMDOP_HISTORY_D2</span></span>: cross <span class="hljs-built_in"><span class="hljs-built_in">CMDOP_D2</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">CMDOP_D1</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">CMDOP</span></span>, BUCK_HIST_MASK; <span class="hljs-built_in"><span class="hljs-built_in">CMDRES_HISTORY_D2</span></span>: cross <span class="hljs-built_in"><span class="hljs-built_in">CMDRES_D2</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">CMDRES_D1</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">CMDRES</span></span>, BUCK_HIST_MASK { ignore_bins not_check_now = binsof( <span class="hljs-built_in"><span class="hljs-built_in">CMDRES</span></span> ) intersect{ INSERT_NOT_SUCCESS_TABLE_IS_FULL } || binsof( <span class="hljs-built_in"><span class="hljs-built_in">CMDRES_D1</span></span> ) intersect{ INSERT_NOT_SUCCESS_TABLE_IS_FULL } || binsof( <span class="hljs-built_in"><span class="hljs-built_in">CMDRES_D2</span></span> ) intersect{ INSERT_NOT_SUCCESS_TABLE_IS_FULL }; } <span class="hljs-built_in"><span class="hljs-built_in">CMDOP_CHAIN</span></span>: cross <span class="hljs-built_in"><span class="hljs-built_in">CMDOP</span></span>, CHAIN { ignore_bins insert_in_middle = binsof( <span class="hljs-built_in"><span class="hljs-built_in">CMDOP</span></span> ) intersect { OP_INSERT } &amp;&amp; binsof( CHAIN ) intersect { IN_MIDDLE }; ignore_bins insert_in_tail_no_match = binsof( <span class="hljs-built_in"><span class="hljs-built_in">CMDOP</span></span> ) intersect { OP_INSERT } &amp;&amp; binsof( CHAIN ) intersect { IN_TAIL_NO_MATCH }; }</code> </pre> <br><p>  ,         bin  <code>CMDOP_HISTORY_D2</code> : </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">bin</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">auto</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[OP_DELETE]</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">auto</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[OP_SEARCH]</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">auto</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[OP_SEARCH]</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">auto</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">['b10]</span></span>&gt;</code> </pre> <br><p>  , : </p><br><ul><li>   <code>OP_SEARCH</code> , </li><li>    <code>OP_SEARCH</code>  ,    </li><li>    <code>OP_DELETE</code>  ,     </li></ul><br><p>           .  : </p><br><pre> <code class="hljs ruby">Coverpoint cg::CMDOP <span class="hljs-number"><span class="hljs-number">100.0</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Covered Coverpoint cg::CMDRES <span class="hljs-number"><span class="hljs-number">85.7</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Uncovered Coverpoint cg::CMDOP_D1 <span class="hljs-number"><span class="hljs-number">100.0</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Covered Coverpoint cg::CMDOP_D2 <span class="hljs-number"><span class="hljs-number">100.0</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Covered Coverpoint cg::CMDRES_D1 <span class="hljs-number"><span class="hljs-number">85.7</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Uncovered Coverpoint cg::CMDRES_D2 <span class="hljs-number"><span class="hljs-number">85.7</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Uncovered Coverpoint cg::CHAIN <span class="hljs-number"><span class="hljs-number">100.0</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Covered Coverpoint cg::BUCK_HIST_MASK <span class="hljs-number"><span class="hljs-number">100.0</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Covered Coverpoint cg::BUCKOCUP <span class="hljs-number"><span class="hljs-number">100.0</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Covered Cross cg::CMDOP_BUCKOCUP <span class="hljs-number"><span class="hljs-number">100.0</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Covered Cross cg::CMDRES_BUCKOCUP <span class="hljs-number"><span class="hljs-number">84.6</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Uncovered Cross cg::CMDOP_HISTORY_D2 <span class="hljs-number"><span class="hljs-number">18.5</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Uncovered covered/total <span class="hljs-symbol"><span class="hljs-symbol">bins:</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">108</span></span> missing/total <span class="hljs-symbol"><span class="hljs-symbol">bins:</span></span> <span class="hljs-number"><span class="hljs-number">88</span></span> <span class="hljs-number"><span class="hljs-number">108</span></span> Cross cg::CMDRES_HISTORY_D2 <span class="hljs-number"><span class="hljs-number">3.1</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Uncovered covered/total <span class="hljs-symbol"><span class="hljs-symbol">bins:</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">864</span></span> missing/total <span class="hljs-symbol"><span class="hljs-symbol">bins:</span></span> <span class="hljs-number"><span class="hljs-number">837</span></span> <span class="hljs-number"><span class="hljs-number">864</span></span> Cross cg::CMDOP_CHAIN <span class="hljs-number"><span class="hljs-number">84.6</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Uncovered</code> </pre> <br><p> ( <em>   , ..   </em> ) </p><br><p>  ,    <code>HISTORY</code>   (18.5%  3.1%).  ,  ,     . </p><br><p>     <strong></strong>  ,  ? <br>    . ,  ,  ,      ,       100% . </p><br><p>           ‚Äî   . ,             ( 5  6 <em>     </em> ). </p><br><p> <strong></strong> : </p><br><ul><li> coverage    .        ,      .         ,        . </li><li>    <strong></strong>    ,     . </li><li>    RTL,   ( ),       .    bin'  . </li></ul><br><h3>    </h3><br><p>        ,      . <br>     .  ‚Äî  .       ,    :   <a href="http://www.testbench.in/CR_01_CONSTRAINED_RANDOM_VERIFICATION.html">Constrained Random Verification</a> . </p><br><p> ,    ,   - ,   -  (  ) ,   ,   . </p><br><p>  ,            : </p><br><pre> <code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bit</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[KEY_WIDTH-1:0]</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gen_rand_key</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( int min_bucket_num = 0, int max_bucket_num = ( 2**BUCKET_WIDTH - 1 )</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_key_value</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( 2**( KEY_WIDTH - BUCKET_WIDTH )</span></span></span><span class="hljs-function"> - 1 ) ); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bit</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[BUCKET_WIDTH-1:0]</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bucket_num</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bit</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[KEY_WIDTH-1:0]</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gen_key</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( hash_table::HASH_TYPE != "dummy" )</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">begin</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">("%m: hash_type = %s not supported here!", hash_table::HASH_TYPE )</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fatal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bucket_num</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">urandom_range</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( max_bucket_num, min_bucket_num )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gen_key</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">urandom_range</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( max_key_value, 0 )</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">replace</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">high</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bits</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">by</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bucket_num</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(is needs in dummy hash)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gen_key</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ KEY_WIDTH - 1 : KEY_WIDTH - BUCKET_WIDTH ]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bucket_num</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gen_key</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endfunction</span></span></span></span></code> </pre> <br><p>       <code>[0;15]</code>    <code>[0;7]</code> . </p><br><pre> <code class="hljs vhdl">// testing small amount <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> buckets <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> random commands task test_05( ); ht_command_t cmds[$]; $display(<span class="hljs-string"><span class="hljs-string">"%m:"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( int c = <span class="hljs-number"><span class="hljs-number">0</span></span>; c &lt; <span class="hljs-number"><span class="hljs-number">5000</span></span>; c++ ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> `CMD_SEARCH ( gen_rand_key( <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span> ) ) `CMD_INSERT_RAND ( gen_rand_key( <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span> ) ) `CMD_DELETE ( gen_rand_key( <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span> ) ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> // ,    :) cmds.shuffle( ); foreach( cmds[i] ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> send_to_dut_c( cmds[i] ); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> endtask</code> </pre> <br><p>        : </p><br><pre> <code class="hljs objectivec">Cross cg::<span class="hljs-built_in"><span class="hljs-built_in">CMDOP_HISTORY_D2</span></span> <span class="hljs-number"><span class="hljs-number">98.1</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Uncovered covered/total bins: <span class="hljs-number"><span class="hljs-number">106</span></span> <span class="hljs-number"><span class="hljs-number">108</span></span> missing/total bins: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">108</span></span> Cross cg::<span class="hljs-built_in"><span class="hljs-built_in">CMDRES_HISTORY_D2</span></span> <span class="hljs-number"><span class="hljs-number">81.1</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Uncovered covered/total bins: <span class="hljs-number"><span class="hljs-number">701</span></span> <span class="hljs-number"><span class="hljs-number">864</span></span> missing/total bins: <span class="hljs-number"><span class="hljs-number">163</span></span> <span class="hljs-number"><span class="hljs-number">864</span></span></code> </pre> <br><p>  ,  bin'  ,   ,       : </p><br><pre> <code class="hljs vhdl">// testing only one bucket <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> random commands task test_06( ); ht_command_t cmds[$]; $display(<span class="hljs-string"><span class="hljs-string">"%m:"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( int c = <span class="hljs-number"><span class="hljs-number">0</span></span>; c &lt; <span class="hljs-number"><span class="hljs-number">1000</span></span>; c++ ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> `CMD_SEARCH ( gen_rand_key( <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span> ) ) `CMD_INSERT_RAND( gen_rand_key( <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span> ) ) `CMD_DELETE ( gen_rand_key( <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span> ) ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> cmds.shuffle( ); foreach( cmds[i] ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> send_to_dut_c( cmds[i] ); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> endtask</code> </pre> <br><p>  Result: </p><br><pre> <code class="hljs objectivec">Cross cg::<span class="hljs-built_in"><span class="hljs-built_in">CMDOP_HISTORY_D2</span></span> <span class="hljs-number"><span class="hljs-number">100.0</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Covered covered/total bins: <span class="hljs-number"><span class="hljs-number">108</span></span> <span class="hljs-number"><span class="hljs-number">108</span></span> missing/total bins: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">108</span></span> Cross cg::<span class="hljs-built_in"><span class="hljs-built_in">CMDRES_HISTORY_D2</span></span> <span class="hljs-number"><span class="hljs-number">99.1</span></span>% <span class="hljs-number"><span class="hljs-number">100</span></span> Uncovered covered/total bins: <span class="hljs-number"><span class="hljs-number">857</span></span> <span class="hljs-number"><span class="hljs-number">864</span></span> missing/total bins: <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">864</span></span></code> </pre> <br><p>   ,      ( ,   <code>rescode=INSERT_NOT_SUCCESS_TABLE_IS_FULL</code> ) </p><br><p>  <strong>Note</strong> : </p><br><ul><li> ,   <em></em>   <em>shuffle</em> ,    .     ,   .  SystemVerilog    <a href="http://www.testbench.in/CR_08_CONSTRAINT_BLOCK.html">constraint </a> :          . </li></ul><br><p> <strong></strong> : </p><br><ul><li>     .     ,    ,     . </li></ul><br><h3>     ""  </h3><br><p>      ,            . </p><br><p>    (      <code>ht_res</code> ),  ""  ,   . .          . </p><br><p>     ( ) ‚Äî          ()    . </p><br><p>      : </p><br><ul><li> <code>head_table</code> </li> <li> <code>data_table</code> </li> <li> <code>empty_ptr_storage</code> </li> </ul><br><p>     ,   -        . <br>     ( <em>   </em> )  ,     /. </p><br><p>  ,      : <br> <code>head_table</code> : </p><br><ul><li>          <code>ptr_val</code> </li><li>   <code>ptr_val</code>     ,    empty </li></ul><br><p> <code>data_table</code> : </p><br><ul><li> <code>key</code>    / </li><li>      </li><li> <code>next_ptr_val</code>     ,     </li><li>    ,      (  <code>head_table</code> ,   - ) </li><li>     ,     </li></ul><br><p> <code>empty_ptr_storage</code> : </p><br><ul><li>  <code>data_table_*</code>     ,     </li><li>      ,   ,      (   ). </li></ul><br><p>  <em>   </em> : </p><br><ul><li>   ,   -    -   . (  ,     ‚Äî      ).     ,    <strong></strong> . </li></ul><br><p>   <code>tables_monitor</code> ,       <code>head_table</code> , <code>data_table</code> , <code>empty_ptr</code> . <br>     ,        ,    .     <a href=""></a> . </p><br><p>        : </p><br><pre> <code class="hljs dos">... <span class="hljs-number"><span class="hljs-number">1195</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: opcode = OP_DELETE key = <span class="hljs-number"><span class="hljs-number">0</span></span>x01000000 value = <span class="hljs-number"><span class="hljs-number">0</span></span>x0000 head_ptr = <span class="hljs-number"><span class="hljs-number">0</span></span>x001 head_ptr_val = <span class="hljs-number"><span class="hljs-number">0</span></span>x1 <span class="hljs-number"><span class="hljs-number">1195</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: IDLE_S -&gt; READ_HEAD_S <span class="hljs-number"><span class="hljs-number">1225</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">RD</span></span>: addr = <span class="hljs-number"><span class="hljs-number">0</span></span>x001 key = <span class="hljs-number"><span class="hljs-number">0</span></span>x01001000 value = <span class="hljs-number"><span class="hljs-number">0</span></span>x1235 next_ptr = <span class="hljs-number"><span class="hljs-number">0</span></span>x002 next_ptr_val = <span class="hljs-number"><span class="hljs-number">0</span></span>x1 <span class="hljs-number"><span class="hljs-number">1225</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: READ_HEAD_S -&gt; GO_ON_CHAIN_S <span class="hljs-number"><span class="hljs-number">1255</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">RD</span></span>: addr = <span class="hljs-number"><span class="hljs-number">0</span></span>x002 key = <span class="hljs-number"><span class="hljs-number">0</span></span>x01000001 value = <span class="hljs-number"><span class="hljs-number">0</span></span>x3ff2 next_ptr = <span class="hljs-number"><span class="hljs-number">0</span></span>x000 next_ptr_val = <span class="hljs-number"><span class="hljs-number">0</span></span>x1 <span class="hljs-number"><span class="hljs-number">1285</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">RD</span></span>: addr = <span class="hljs-number"><span class="hljs-number">0</span></span>x000 key = <span class="hljs-number"><span class="hljs-number">0</span></span>x01000002 value = <span class="hljs-number"><span class="hljs-number">0</span></span>x5429 next_ptr = <span class="hljs-number"><span class="hljs-number">0</span></span>x004 next_ptr_val = <span class="hljs-number"><span class="hljs-number">0</span></span>x1 <span class="hljs-number"><span class="hljs-number">1315</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">RD</span></span>: addr = <span class="hljs-number"><span class="hljs-number">0</span></span>x004 key = <span class="hljs-number"><span class="hljs-number">0</span></span>x01000000 value = <span class="hljs-number"><span class="hljs-number">0</span></span>x1cc0 next_ptr = <span class="hljs-number"><span class="hljs-number">0</span></span>x000 next_ptr_val = <span class="hljs-number"><span class="hljs-number">0</span></span>x0 <span class="hljs-number"><span class="hljs-number">1315</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: GO_ON_CHAIN_S -&gt; KEY_MATCH_IN_TAIL_S <span class="hljs-number"><span class="hljs-number">1325</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: WR: addr = <span class="hljs-number"><span class="hljs-number">0</span></span>x004 key = <span class="hljs-number"><span class="hljs-number">0</span></span>x01000000 value = <span class="hljs-number"><span class="hljs-number">0</span></span>x1cc0 next_ptr = <span class="hljs-number"><span class="hljs-number">0</span></span>x000 next_ptr_val = <span class="hljs-number"><span class="hljs-number">0</span></span>x0 <span class="hljs-number"><span class="hljs-number">1325</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: KEY_MATCH_IN_TAIL_S -&gt; CLEAR_RAM_AND_PTR_S <span class="hljs-number"><span class="hljs-number">1335</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: WR: addr = <span class="hljs-number"><span class="hljs-number">0</span></span>x004 key = <span class="hljs-number"><span class="hljs-number">0</span></span>x00000000 value = <span class="hljs-number"><span class="hljs-number">0</span></span>x0000 next_ptr = <span class="hljs-number"><span class="hljs-number">0</span></span>x000 next_ptr_val = <span class="hljs-number"><span class="hljs-number">0</span></span>x0 <span class="hljs-number"><span class="hljs-number">1335</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: RES: key = <span class="hljs-number"><span class="hljs-number">0</span></span>x01000000 value = <span class="hljs-number"><span class="hljs-number">0</span></span>x0000 rescode = DELETE_SUCCESS chain_state = IN_TAIL <span class="hljs-number"><span class="hljs-number">1335</span></span>: top_tb.dut.d_tbl.del_eng.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: CLEAR_RAM_AND_PTR_S -&gt; IDLE_S <span class="hljs-number"><span class="hljs-number">1335</span></span>: ht_tb.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: IN_MONITOR: key = <span class="hljs-number"><span class="hljs-number">0</span></span>x01000000 value = <span class="hljs-number"><span class="hljs-number">0</span></span>x0000 rescode = DELETE_SUCCESS chain_state = IN_TAIL <span class="hljs-number"><span class="hljs-number">1335</span></span>: top_tb.dut.d_tbl.empty_ptr_storage.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>: add_empty_ptr: <span class="hljs-number"><span class="hljs-number">0</span></span>x004 ** Error: ERROR: addr = <span class="hljs-number"><span class="hljs-number">0</span></span>x004. This addr is empty, but ptr is val <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span>: <span class="hljs-number"><span class="hljs-number">1340</span></span> ns Scope: top_tb.tm.check_one_addr File: ../tb/tables_monitor.sv Line: <span class="hljs-number"><span class="hljs-number">119</span></span> ** Error: ERROR: addr = <span class="hljs-number"><span class="hljs-number">0</span></span>x004 key=<span class="hljs-number"><span class="hljs-number">0</span></span>x00000000 don't match bucket_num = <span class="hljs-number"><span class="hljs-number">0</span></span>x01 <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span>: <span class="hljs-number"><span class="hljs-number">1340</span></span> ns Scope: top_tb.tm.check_one_addr File: ../tb/tables_monitor.sv Line: <span class="hljs-number"><span class="hljs-number">127</span></span></code> </pre> <br><p> ,        <strong></strong>  (  )! </p><br><p>   : </p><br><ul><li>     0x004,    ,    , ..  1335   . </li><li>   0x004  <code>key = 0x00000000</code> ,      0x01 (..  <em>dummy hash</em> ). </li></ul><br><p> <strong></strong> : </p><br><ul><li> ,        .      !         ( ) . </li><li>         .       <a href="http://www.asic-world.com/systemverilog/assertions2.html">assertion</a> . </li></ul><br><h2>  Conclusion </h2><br><blockquote>  ,      ,      . (  ) </blockquote><br><p>               IP-  ASIC/FPGA    -. </p><br><p> <strong></strong> : </p><br><ul><li>  <a href="https://github.com/johan92/fpga-hash-table">project</a> </li><li> <a href="https://github.com/johan92/fpga-hash-table/tree/2b502a8b5228392c4db05c3b571c8b25f5f9cfca">   </a> </li><li> <a href="https://github.com/johan92/fpga-hash-table/tree/4c2c6196c075d923bc3a1a1c3ef38d005a7631cd">   </a> </li><li> <a href="https://github.com/johan92/fpga-hash-table/tree/dc74c7ff2f247d7b2067e977f75148b2130ab7e0">   </a> </li></ul><br><p>      ,         .      <a href=""></a> ,      ,       . </p><br><p> ,     RTL-,     . </p><br><p>   ,         RTL- :) </p><br><p>  Thanks for attention!           . </p><br><p>  PS: <br>     <del>   </del>    . <br> , : </p><br><ul><li>    <em></em> ,     <code>systemverilog</code> ? <strong>GitHub Flavored Markdown</strong>     ... </li><li>   <code>spoiler</code>   ,        markdown? </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/277313/">https://habr.com/ru/post/277313/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277303/index.html">Questionnaire customers. Zoho Survey Description</a></li>
<li><a href="../277305/index.html">Here it is, mutated algorithm. Or what can not "Lisp"</a></li>
<li><a href="../277307/index.html">Russian call center: Ekaterinburg Naumen + SIP-Gateway assembly Novosibirsk, the results</a></li>
<li><a href="../277309/index.html">CodingFuture + Puppet. Part II: Access and Standard Environment (cfauth + cfsystem)</a></li>
<li><a href="../277311/index.html">Why are mobile web apps so slow?</a></li>
<li><a href="../277315/index.html">Like this - to be a software developer for cars. Part 2/2</a></li>
<li><a href="../277317/index.html">Advanced internal SEO for e-commerce</a></li>
<li><a href="../277319/index.html">Azure-IaaS-Digest number 1 (January \ February)</a></li>
<li><a href="../277321/index.html">Decorators and reflection in TypeScript: from beginner to expert (Part 2)</a></li>
<li><a href="../277323/index.html">I am a web developer and for 10 days I can not write the simplest application</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>