<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>re2c - regular expression compiler</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The task of extracting certain tokens from a stream of characters is quite common. Often it is solved with the help of lexical analyzers configured by...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>re2c - regular expression compiler</h1><div class="post__text post__text-html js-mediator-article">  The task of extracting certain tokens from a stream of characters is quite common.  Often it is solved with the help of lexical analyzers configured by regular expressions.  Many analyzers are built on the principle of generating program code, which in turn implements the logic of regular expressions.  In fact, this is a compilation of the regular expression language into the programming language code. <br><br>  For example, <a href="http://en.wikipedia.org/wiki/Flex_lexical_analyser">flex</a> is one of these analyzers.  Old, but proven over the years. <br><br>  I used a lot of flex, it has both good and bad sides, but by and large, I didn't have to complain. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But yesterday I came across an interesting project - <a href="http://re2c.org/">re2c</a> .  In fact, on this thing you can write lexical analyzers directly on your knee in a few minutes. <br><br><a name="habracut"></a><br>  Suppose you need to select from the line some commands, integers and fractional numbers.  You can uncover flex, and you can write like this: <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; enum { CMD, INT, FLOAT, SPACE, END }; int scan(char** p, char** lex) { char* marker; if (lex) *lex = *p; /*!re2c re2c:define:YYCTYPE = "unsigned char"; re2c:define:YYCURSOR = *p; re2c:define:YYMARKER = marker; re2c:yyfill:enable = 0; re2c:yych:conversion = 1; re2c:indent:top = 1; "GET"|"PUT"|"EXIT" { return CMD; } [0-9]+ { return INT; } [0-9]+ '.' [0-9]* { return FLOAT; } [ \t]+ { return SPACE; } [^] { return END; } */ } int main(int argc, char* argv[]) { char *p, *last; int token; if (argc &lt; 2) return 1; p = argv[1]; while ((token = scan(&amp;p, &amp;last)) != END) { int sz = p - last; switch (token) { case CMD: printf("Command: '%.*s'\n", sz, last); break; case INT: printf("Number: '%.*s'\n", sz, last); break; case FLOAT: printf("Float: '%.*s'\n", sz, last); break; } } return 0; }</span></span></span></span></code> </pre> <br>  And that's it! <br><br>  It is clear that all the magic happens in the ‚Äúscan ()‚Äù function between the lines limited by the comments ‚Äú/ *! Re2c‚Äù and ‚Äú* /‚Äù. <br><br>  So, re2c is a regular expression compiler that embeds code directly into the program text. <br><br>  If we run our source through re2c: <br><br><pre> <code class="bash hljs"> re2c.exe -is test.re2c &gt;test.c</code> </pre><br>  So we get this: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* Generated by re2c 0.13.5 on Tue Apr 19 21:08:57 2011 */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; enum { CMD, INT, FLOAT, SPACE, END }; int scan(char** p, char** lex) { char* marker; if (lex) *lex = *p; { unsigned char yych; yych = (unsigned char)**p; if (yych &lt;= '9') { if (yych &lt;= 0x1F) { if (yych == '\t') goto yy8; goto yy10; } else { if (yych &lt;= ' ') goto yy8; if (yych &lt;= '/') goto yy10; goto yy6; } } else { if (yych &lt;= 'F') { if (yych == 'E') goto yy5; goto yy10; } else { if (yych &lt;= 'G') goto yy2; if (yych == 'P') goto yy4; goto yy10; } } yy2: yych = (unsigned char)*(marker = ++*p); if (yych == 'E') goto yy24; yy3: { return END; } yy4: yych = (unsigned char)*(marker = ++*p); if (yych == 'U') goto yy23; goto yy3; yy5: yych = (unsigned char)*(marker = ++*p); if (yych == 'X') goto yy18; goto yy3; yy6: ++*p; if ((yych = (unsigned char)**p) == '.') goto yy13; if (yych &lt;= '/') goto yy7; if (yych &lt;= '9') goto yy16; yy7: { return INT; } yy8: ++*p; yych = (unsigned char)**p; goto yy12; yy9: { return SPACE; } yy10: yych = (unsigned char)*++*p; goto yy3; yy11: ++*p; yych = (unsigned char)**p; yy12: if (yych == '\t') goto yy11; if (yych == ' ') goto yy11; goto yy9; yy13: ++*p; yych = (unsigned char)**p; if (yych &lt;= '/') goto yy15; if (yych &lt;= '9') goto yy13; yy15: { return FLOAT; } yy16: ++*p; yych = (unsigned char)**p; if (yych == '.') goto yy13; if (yych &lt;= '/') goto yy7; if (yych &lt;= '9') goto yy16; goto yy7; yy18: yych = (unsigned char)*++*p; if (yych == 'I') goto yy20; yy19: *p = marker; goto yy3; yy20: yych = (unsigned char)*++*p; if (yych != 'T') goto yy19; yy21: ++*p; { return CMD; } yy23: yych = (unsigned char)*++*p; if (yych == 'T') goto yy21; goto yy19; yy24: ++*p; if ((yych = (unsigned char)**p) == 'T') goto yy21; goto yy19; } } int main(int argc, char* argv[]) { char *p, *last; int token; if (argc &lt; 2) return 1; p = argv[1]; while ((token = scan(&amp;p, &amp;last)) != END) { int sz = p - last; switch (token) { case CMD: printf("Command: '%.*s'\n", sz, last); break; case INT: printf("Number: '%.*s'\n", sz, last); break; case FLOAT: printf("Float: '%.*s'\n", sz, last); break; } } return 0; }</span></span></span></span></code> </pre><br>  Fearfully?  Yes, the code is not for manual editing, but this is not required. <br><br>  Compile: <br><br><pre> <code class="bash hljs"> re2c.exe -is test.re2c &gt;test.c &amp;&amp; cl test.c</code> </pre><br>  Run: <br><br><pre> <code class="bash hljs"> <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> <span class="hljs-string"><span class="hljs-string">"GET 123.0 12344 PUT 10."</span></span></code> </pre><br>  Result: <br><br><pre> <code class="bash hljs"> Command: <span class="hljs-string"><span class="hljs-string">'GET'</span></span> Float: <span class="hljs-string"><span class="hljs-string">'123.0'</span></span> Number: <span class="hljs-string"><span class="hljs-string">'12344'</span></span> Command: <span class="hljs-string"><span class="hljs-string">'PUT'</span></span> Float: <span class="hljs-string"><span class="hljs-string">'10.'</span></span></code> </pre><br>  As they say, fast, cheap and angry.  In order to fully master re2c, one and only <a href="http://re2c.org/manual.html">documentation page</a> should be read. <br><br>  By the way, the simplicity of working with re2c does not mean that you cannot make complex analyzers on it.  The <a href="http://sourceforge.net/projects/re2c/">distribution</a> has examples for the grammar of the tokens of the languages <a href="">C</a> and <a href="">Rexx</a> . <br><br>  If you <a href="http://re2c.org/manual.html">play with re2c flags</a> , then instead of ‚Äúif / else‚Äù you can generate code based on ‚Äúswitch / case‚Äù.  The choice should be made on the basis of understanding which code your compiler optimizes better. <br><br>  As I understand it, the analyzer generated by re2c should be very fast, even very fast.  Although it would be interesting to measure it against the same flex, <a href="http://www.antlr.org/">ANTLR</a> 'a or <a href="http://www.boost.org/doc/libs/1_41_0/libs/spirit/doc/html/spirit/lex/tutorials/lexer_tutorials.html">Spirit</a> ' a. <br><br>  Posts almost on the topic: <br><ul><li>  <a href="http://easy-coding.blogspot.com/2009/07/lemon.html">Wrap Lemon grammar parser generator for C ++</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/117843/">https://habr.com/ru/post/117843/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../117836/index.html">How to choose a good hosting for a decent site</a></li>
<li><a href="../117838/index.html">What to read to increase your level of JavaScript</a></li>
<li><a href="../117839/index.html">Putin explained the position of the FSB to control Skype</a></li>
<li><a href="../117841/index.html">Comrades children!</a></li>
<li><a href="../117842/index.html">Multithreaded Go programming</a></li>
<li><a href="../117844/index.html">Hit print</a></li>
<li><a href="../117845/index.html">We invite you to participate in DEVCONF 2011 on June 4 (PHP, PERL, PYTHON, RUBY, .NET, JS)</a></li>
<li><a href="../117846/index.html">Opera Startup Awards begins!</a></li>
<li><a href="../117847/index.html">Do most Android users hate Apple?</a></li>
<li><a href="../117852/index.html">Version Control Systems as a Student Collaboration Tool</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>