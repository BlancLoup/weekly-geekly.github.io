<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The Empire Strikes Back</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A recent article, ‚ÄúHackathon 2: Time lapse analysis of Unreal Engine 4,‚Äù describes how you can find a lot of errors in the Unreal Engine 4 project usi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The Empire Strikes Back</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/c7e/580/055/c7e58005517ebed59b94d43da7289872.png" alt="Darth Vader - The Unicorn" align="left"><br>  A recent article, ‚ÄúHackathon 2: Time lapse analysis of Unreal Engine 4,‚Äù describes how you can find a lot of errors in the Unreal Engine 4 project using the Klocwork tool. I can't ignore this article.  The fact is that in due time we corrected all the errors that the PVS-Studio analyzer found in this project.  It is clear that not all errors were corrected at all, but only detected by the analyzer.  However, the article gives the impression that the PVS-Studio analyzer missed too much.  Well, now my move.  I also rechecked the Unreal Engine 4 again and found a lot of errors.  Thus, I can say that PVS-Studio can also find new errors in Unreal Engine 4 now.  Draw. <br><a name="habracut"></a><br><h2>  History reference </h2><br>  It all started a year and a half ago, when I wrote the article "The <a href="http://www.viva64.com/ru/b/0249/">long-awaited check of Unreal Engine 4</a> ".  Further, there was a cooperation with the Epic Games company, the result of which was the elimination of all warnings issued by PVS-Studio.  As a result, many errors were corrected and all false alarms of the analyzer were eliminated.  Our team issued a project to Epic Games, free from PVS-Studio warnings.  You can find out how this happened in the article " <a href="http://www.viva64.com/ru/b/0330/">How the PVS-Studio team improved the Unreal Engine code</a> ." <br><br>  Recently, on the Internet, I came across an article " <a href="http://blog.klocwork.com/static-analysis/analysis-of-unreal-engine-4/">Hackathon 2: Time lapse analysis of Unreal Engine 4</a> ".  The article is good and correct.  The company Rogue Wave is great that it holds such events and makes a powerful static code analyzer Klocwork.  Michail Greshishchev is also great that he did the work on testing the Unreal Engine and found time to write about this article.  All is well.  But I‚Äôm concerned that an outsider who is not familiar with static analyzers can make wrong conclusions.  Therefore, I am obliged to comment on this article. <br><br>  Unintentionally, but to the uninitiated reader, this article shows us in an unfavorable light compared to Klocwork.  It seems that PVS-Studio finds fewer errors than Klocwork.  In fact, the world is more complicated.  Both analyzers have different sets of diagnostics.  Partially these sets intersect.  However, each analyzer has a unique set of diagnostics.  Thus, having checked a large project with one analyzer, you will then always find something with another analyzer. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Another nuance.  We did not check third-party libraries (ThirdParty catalog), and Michail Greshishchev checked (at least partially), as evidenced by one of the code examples (see the HeadMountedDisplayCommon function).  In ThirdParty, the PVS-Studio analyzer can also easily find many interesting defects.  Moreover, the size of the ThirdParty source is 3 times the size of UE4 itself. <br><br>  However, all this sounds like a miserable attempt to justify himself :).  Therefore, I have no choice but to even the score.  For this purpose, the Unreal Engine 4 sources were taken and checked with the latest version of the PVS-Studio analyzer. <br><br>  And now I will demonstrate that you can always easily find errors in a large, rapidly changing project. <br><br><h2>  Results of project verification using PVS-Studio </h2><br>  I checked the source code of UE4 with the latest version of PVS-Studio.  The source codes of UE4 were checked without considering the ThirdParty catalog.  If I check them, I will not get an article, but a reference book :). <br><br>  I received 1,792 first and second level general purpose warnings.  Do not be afraid.  Now it becomes clear where this number came from. <br><br>  Most warnings (93%) are associated with the new V730 diagnostic rule, designed to detect uninitialized class members.  An uninitialized member of a class is not always a mistake, but nevertheless it is a place in the program that is worth checking out.  Generally 1672 warnings V730 is a lot.  On other projects, I have not seen a similar number of these warnings.  Moreover, the analyzer, if possible, tries to predict when an uninitialized member is not a problem.  By the way, the search for uninitialized members is a thankless job, and it may be interesting for readers to get acquainted with the article " <a href="http://www.viva64.com/ru/b/0354/">Search for uninitialized members of a class</a> ." <br><br>  But back to the UE4 project.  In the article, I will not touch the warning <a href="http://www.viva64.com/ru/d/0377/">V730</a> .  There are too many of them, and I know the project UE4 too poorly to judge whether this or that uninitialized variable can lead to an error in the program's work.  However, I am sure that among these 1672 warnings there are quite a few real serious mistakes.  I think the developers at Epic Games should analyze them.  If they find that these are continuous false positives, then this diagnostics can be simply turned off. <br><br>  So, 1792 - 1672 = 120. Total PVS-Studio issued 120 general-purpose warnings (level 1 and 2) when checking the Unreal Engine.  Many of these warnings revealed real errors.  Consider the most interesting code snippets and their corresponding warnings. <br><br><h2>  Interesting errors found with PVS-Studio </h2><br>  Once again I will emphasize that in the article I will give far from all parts of the code that deserve attention and editing.  First, I watched the report fluently and could miss something interesting.  Secondly, I did not write out frivolous errors or those that are difficult to explain (it takes a lot of code fragments). <br><br>  <b>Error n1</b> <br><pre><code class="cpp hljs">FORCEINLINE <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>==(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FShapedGlyphEntryKey&amp; Other) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FontFace == Other.FontFace &amp;&amp; GlyphIndex == Other.GlyphIndex &amp;&amp; FontSize == Other.FontSize &amp;&amp; FontScale == Other.FontScale &amp;&amp; GlyphIndex == Other.GlyphIndex; }</code> </pre> <br>  Warning PVS-Studio: V501 There are identical sub-expressions 'GlyphIndex == Other.GlyphIndex' operator.  fontcache.h 139 <br><br>  The ‚ÄúGlyphIndex == Other.GlyphIndex‚Äù check is repeated twice.  <a href="http://www.viva64.com/ru/b/0260/">The effect of the last line</a> in action.  Apparently, the last comparison should be: KeyHash == Other.KeyHash. <br><br>  <b>N2 error</b> <br><br>  Another effect of the last line.  Right canonical. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Compare</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> FPooledRenderTargetDesc&amp; rhs, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bExact)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Extent == rhs.Extent &amp;&amp; Depth == rhs.Depth &amp;&amp; bIsArray == rhs.bIsArray &amp;&amp; ArraySize == rhs.ArraySize &amp;&amp; NumMips == rhs.NumMips &amp;&amp; NumSamples == rhs.NumSamples &amp;&amp; Format == rhs.Format &amp;&amp; LhsFlags == RhsFlags &amp;&amp; TargetableFlags == rhs.TargetableFlags &amp;&amp; bForceSeparateTargetAndShaderResource == rhs.bForceSeparateTargetAndShaderResource &amp;&amp; ClearValue == rhs.ClearValue &amp;&amp; AutoWritable == AutoWritable; }</code> </pre> <br>  PVS-Studio warning: V501 operator: AutoWritable == AutoWritable rendererinterface.h 180 <br><br>  At the very end, they forgot to add ‚Äúrhs.‚Äù And as a result the variable 'AutoWritable' is compared with itself. <br><br>  <b>Error n3</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AEQSTestingPawn::PostLoad() { .... UWorld* World = GetWorld(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (World &amp;&amp; World-&gt;IsGameWorld() &amp;&amp; bTickDuringGame == bTickDuringGame) { PrimaryActorTick.bCanEverTick = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }</code> </pre> <br>  PVS-Studio warning: V501 operator: bTickDuringGame == bTickDuringGame eqstestingpawn.cpp 157 <br><br>  <b>Error n4</b> <br><pre> <code class="cpp hljs">int32 SRetainerWidget::OnPaint(....) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( RenderTargetResource-&gt;GetWidth() != <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; RenderTargetResource-&gt;GetWidth() != <span class="hljs-number"><span class="hljs-number">0</span></span> ) .... }</code> </pre> <br>  PVS-Studio warning: V501 There are identical sub-expressions 'RenderTargetResource-&gt; GetWidth ()! = 0' the operator.  sretainerwidget.cpp 291 <br><br>  <b>Error N5, N6</b> <br><br>  Two identical errors are located next door.  ZeroMemory macros, which are nothing more than memset () function calls, reset only part of the allocated memory. <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FD3D12BufferedGPUTiming</span></span></span><span class="hljs-class"> {</span></span> .... FD3D12CLSyncPoint* StartTimestampListHandles; FD3D12CLSyncPoint* EndTimestampListHandles; .... }; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> FD3D12BufferedGPUTiming::InitDynamicRHI() { .... StartTimestampListHandles = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FD3D12CLSyncPoint[BufferSize]; ZeroMemory(StartTimestampListHandles, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(StartTimestampListHandles)); EndTimestampListHandles = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FD3D12CLSyncPoint[BufferSize]; ZeroMemory(EndTimestampListHandles, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(EndTimestampListHandles)); .... }</code> </pre> <br>  PVS-Studio warnings: <ul><li>  V512 A call to the 'memset' function will start the 'StartTimestampListHandles'.  d3d12query.cpp 493 </li><li>  V512 A call to the 'memset' function will 'endTimestampListHandles'.  d3d12query.cpp 495 </li></ul><br>  The error is that the sizeof () operator computes the size of a pointer, not an array.  One of the correct options would be to write this: <br><pre> <code class="cpp hljs">ZeroMemory(StartTimestampListHandles, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(FD3D12CLSyncPoint) * BufferSize); ZeroMemory(EndTimestampListHandles, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(FD3D12CLSyncPoint) * BufferSize);</code> </pre> <br>  <b>Error N7</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> FDeferredShadingSceneRenderer::RenderLight(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bClearCoatNeeded) { SetShaderTemplLighting&lt;<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>&gt;( RHICmdList, View, *VertexShader, LightSceneInfo); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { SetShaderTemplLighting&lt;<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>&gt;( RHICmdList, View, *VertexShader, LightSceneInfo); } .... }</code> </pre> <br>  PVS-Studio warning: V523 The 'then' statement is equivalent to the 'else' statement.  lightrendering.cpp 864 <br><br>  Regardless of the condition, the same actions are performed. <br><br>  <b>Error n8</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> FBuildDataCompactifier::Compactify(....) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... uint64 CurrentFileSize; .... CurrentFileSize = IFileManager::Get().FileSize(*File); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CurrentFileSize &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { GLog-&gt;Logf(TEXT(<span class="hljs-string"><span class="hljs-string">"Warning. ......"</span></span>), *File); } .... }</code> </pre> <br>  PVS-Studio warning: V547 Expression 'CurrentFileSize&gt; = 0' is always true.  Unsigned type value is always&gt; = 0. buildpatchcompactifier.cpp 135 <br><br>  The ‚Äúif (CurrentFileSize&gt; = 0)‚Äù check does not make sense.  The variable 'CurrentFileSize' has an unsigned type, which means its value is always&gt; = 0. <br><br>  <b>Error n9</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> TParamRef&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UnsetParameters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... int32 NumOutUAVs = <span class="hljs-number"><span class="hljs-number">0</span></span>; FUnorderedAccessViewRHIParamRef OutUAVs[<span class="hljs-number"><span class="hljs-number">3</span></span>]; OutUAVs[NumOutUAVs++] = ObjectBuffers......; OutUAVs[NumOutUAVs++] = ObjectBuffers.Bounds.UAV; OutUAVs[NumOutUAVs++] = ObjectBuffers.Data.UAV; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CulledObjectBoxBounds.IsBound()) { OutUAVs[NumOutUAVs++] = ObjectBuffers.BoxBounds.UAV; } .... }</code> </pre> <br>  V557 Array overrun is possible.  The 'NumOutUAVs ++' index is pointing beyond array bound.  distancefieldlightingshared.h 388 <br><br>  If the condition (CulledObjectBoxBounds.IsBound ()) is met, then the array will be exceeded.  Note that the 'OutUAVs' array consists of only 3 elements. <br><br>  <b>Error N10</b> <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FSlateDrawElement</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-function"><span class="hljs-function">FORCEINLINE </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> FVector2D&amp; InPosition)</span></span></span><span class="hljs-function"> </span></span>{ Position = Position; } .... FVector2D Position; .... };</code> </pre> <br>  PVS-Studio warning: V570 The 'Position' variable is assigned to itself.  drawelements.h 435 <br><br>  This error is not even necessary to describe.  A typo.  It should be: {Position = InPosition;  }. <br><br>  <b>Error n11</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> FOculusRiftHMD::DoesSupportPositionalTracking() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FGameFrame* frame = GetFrame(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FSettings* OculusSettings = frame-&gt;GetSettings(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (frame &amp;&amp; OculusSettings-&gt;Flags.bHmdPosTracking &amp;&amp; (OculusSettings-&gt;SupportedTrackingCaps &amp; ovrTrackingCap_Position) != <span class="hljs-number"><span class="hljs-number">0</span></span>); }</code> </pre> <br>  PVS-Studio warning: V595 The 'frame' pointer was used before it was verified against nullptr.  Check lines: 301, 302. oculusrifthmd.cpp 301 <br><br>  First, the 'frame' variable is used, and then it is checked for nullptr equality. <br><br>  This error is very similar to the one described in the Klocwork <a href="http://blog.klocwork.com/static-analysis/analysis-of-unreal-engine-4/">article</a> : <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> FHeadMountedDisplay::IsInLowPersistenceMode() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> frame = GetCurrentFrame(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> FrameSettings = frame-&gt;Settings; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> frame &amp;&amp; FrameSettings-&gt;Flags.bLowPersistenceMode; }</code> </pre> <br>  As you can see, both analyzers are able to detect this type of defect. <br><br>  It should be noted that the code given in the Klocwork article refers to the ThirdParty catalog, the projects from which we did not check. <br><br>  <b>Error N12 - N21</b> <br><pre> <code class="cpp hljs">FName UKismetNodeHelperLibrary::GetEnumeratorName( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> UEnum* Enum, uint8 EnumeratorValue) { int32 EnumeratorIndex = Enum-&gt;GetIndexByValue(EnumeratorValue); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-literal"><span class="hljs-literal">NULL</span></span> != Enum) ? Enum-&gt;GetEnum(EnumeratorIndex) : NAME_None; }</code> </pre> <br>  PVS-Studio warning: V595 The 'Enum' pointer was used before it was verified against nullptr.  Check lines: 146, 147. kismetnodehelperlibrary.cpp 146 <br><br>  Again the situation is when the pointer is dereferenced at the beginning, and only then checked.  To consider such errors further boring.  Just give a list of places you should pay attention to: <ul><li>  V595 The 'Class' pointer was used against nullptr.  Check lines: 278, 282. levelactor.cpp 278 </li><li>  It was verified against nullptr.  Check lines: 380, 386. levelactor.cpp 380 </li><li>  V595 The 'UpdatedComponent' pointer was used before it was verified against nullptr.  Check lines: 100, 116. interptomovementcomponent.cpp 100 </li><li>  V595 The 'SourceTexture' pointer was used before it was verified against nullptr.  Check lines: 150, 178. d3d12rendertarget.cpp 150 </li><li>  V595 The 'NewRenderTarget' pointer was used before it was verified against nullptr.  Check lines: 922, 924. d3d11commands.cpp 922 </li><li>  V595 The 'RenderTarget' pointer was used before it was verified against nullptr.  Check lines: 2173, 2175. d3d11commands.cpp 2173 </li><li>  V595 The "MyMemory" pointer was used before it was verified against nullptr.  Check lines: 210, 217. bttask_moveto.cpp 210 </li><li>  V595 The 'SkelComp' pointer was used before it was verified against nullptr.  Check lines: 79, 100. animnode_animdynamics.cpp 79 </li><li>  V595 The 'Result' pointer was used before it was nullptr.  Check lines: 1000, 1004. uobjectglobals.cpp 1000 </li></ul><br>  <b>Error n22</b> <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FD3D12Device</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitD3DDevice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CleanupD3DDevice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; .... <span class="hljs-comment"><span class="hljs-comment">//    .... };</span></span></code> </pre> <br>  V599 The virtual destructor is not present, although the 'FD3D12Device' class contains virtual functions.  d3d12device.cpp 448 <br><br>  The FD3D12Device class has virtual methods.  This means that it is assumed that this class will have heirs.  However, there is no virtual destructor in this class.  This is very dangerous and is likely to lead to an error sooner or later. <br><br>  <b>Error N23-N26</b> <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SpawnTarget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(WCHAR* CmdLine)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!CreateProcess(....)) { DWORD ErrorCode = GetLastError(); WCHAR* Buffer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WCHAR[wcslen(CmdLine) + <span class="hljs-number"><span class="hljs-number">50</span></span>]; wsprintf(Buffer, <span class="hljs-string"><span class="hljs-string">L"Couldn't start:\n%s\nCreateProcess() returned %x."</span></span>, CmdLine, ErrorCode); MessageBoxW(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, Buffer, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, MB_OK); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> Buffer; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">9005</span></span>; } .... }</code> </pre> <br>  PVS-Studio warning: V611, it was allocated using the 'delete' operator.  Consider inspecting this code.  It's probably better to use 'delete [] Buffer;'.  bootstrappackagedgame.cpp 110 <br><br>  Invalid way, allocated memory is freed.  It should be written: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> [] Buffer;</code> </pre> <br>  There are a few more such errors: <ul><li>  V611 The memory was allocated using the 'new T []' operator.  Consider inspecting this code.  It's probably better to use 'delete [] ChildCmdLine;'.  bootstrappackagedgame.cpp 157 </li><li>  V611 The memory was allocated using the 'new T []' operator.  Consider inspecting this code.  It's probably better to use 'delete [] ChildCmdLine;'.  bootstrappackagedgame.cpp 165 </li><li>  V611 The memory was allocated using the 'new T []' operator.  Consider inspecting this code.  It's probably better to use 'delete [] ChildCmdLine;'.  bootstrappackagedgame.cpp 169 </li></ul><br>  <b>Error n27</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> FSlateTexture2DRHIRef::InitDynamicRHI() { .... checkf(GPixelFormats[PixelFormat].BlockSizeX == GPixelFormats[PixelFormat].BlockSizeY == GPixelFormats[PixelFormat].BlockSizeZ == <span class="hljs-number"><span class="hljs-number">1</span></span>, TEXT(<span class="hljs-string"><span class="hljs-string">"Tried to use compressed format?"</span></span>)); .... }</code> </pre> <br>  PVS-Studio warning: V709 Suspicious comparison found: 'a == b == c'.  Remember that 'a == b == c' is not equal to 'a == b &amp;&amp; b == c'.  slatetextures.cpp 67 <br><br>  The check does not work as the programmer intended.  Most likely it was necessary to write: <br><pre> <code class="cpp hljs">GPixelFormats[PixelFormat].BlockSizeX == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; GPixelFormats[PixelFormat].BlockSizeY == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; GPixelFormats[PixelFormat].BlockSizeZ == <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  <b>Error N28</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> UWidgetComponent::UpdateRenderTarget() { .... FLinearColor ActualBackgroundColor = BackgroundColor; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ( BlendMode ) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EWidgetBlendMode::Opaque: ActualBackgroundColor.A = <span class="hljs-number"><span class="hljs-number">1.0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EWidgetBlendMode::Masked: ActualBackgroundColor.A = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; } .... }</code> </pre> <br>  V519 The 'ActualBackgroundColor.A' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 938, 940. widgetcomponent.cpp 940 <br><br>  Here indirectly identified the missing 'break' operator.  The variable 'ActualBackgroundColor.A' may be assigned different values ‚Äã‚Äãtwo times in a row.  This is alarming the PVS-Studio analyzer. <br><br>  <b>Error n29</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> FProfilerManager::TrackDefaultStats() { <span class="hljs-comment"><span class="hljs-comment">// Find StatId for the game thread. for( auto It = GetProfilerInstancesIterator(); It; ++It ) { FProfilerSessionRef ProfilerSession = It.Value(); if( ProfilerSession-&gt;GetMetaData()-&gt;IsReady() ) { ....; } break; } }</span></span></code> </pre> <br>  PVS-Studio warning: V612 An unconditional 'break' within a loop.  profilermanager.cpp 717 <br><br>  Very suspicious code.  It seems that the operator 'break' is not located in its place.  I'm not sure, but maybe it was planned to write this: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> It = GetProfilerInstancesIterator(); It; ++It ) { FProfilerSessionRef ProfilerSession = It.Value(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( ProfilerSession-&gt;GetMetaData()-&gt;IsReady() ) { ....; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre> <br><h2>  Results </h2><br>  At least 29 warnings out of 120 issued by PVS-Studio indicated real errors (24%).  About 50% more, this is a code that smells.  The remaining - false positives.  The total time I spent on checking the project and writing this article is about 10 hours. <br><br>  What conclusions can be drawn from the results of the work of the PVS-Studio and Klocwork analyzers: <ol><li>  In a large and rapidly developing project you can always find a few more mistakes :) </li><li>  The PVS-Studio and Klocwork diagnostic kits are different, although there is an intersection. </li><li>  Perhaps Klocwork tested Unreal Engine 4, including third-party libraries (ThirdParty).  We did not check these libraries either then or now. </li><li>  Both analyzers are great, and using them can bring a lot of value to the software development process. </li></ol><br>  Thank you all for your attention. <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0356/"><img src="https://habrastorage.org/getpro/habr/post_images/35e/064/ddf/35e064ddf91f5d99b620384893909ff7.png"></a> </div><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Andrey Karpov.  <a href="http://www.viva64.com/en/b/0356/">The Empire Strikes Back</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/270783/">https://habr.com/ru/post/270783/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270765/index.html">Sound theory. What you need to know about the sound to work with it. Experience Yandex. Music</a></li>
<li><a href="../270775/index.html">How to use the Internet and modern technology people with visual impairment. Yandex research</a></li>
<li><a href="../270777/index.html">Windows Service Auto Update for Poor AWS</a></li>
<li><a href="../270779/index.html">Positioning in Wi-Fi networks with high accuracy</a></li>
<li><a href="../270781/index.html">About UWP Apps for WPF Developers</a></li>
<li><a href="../270785/index.html">666th Post: Fears and Superstitions of IT Professionals</a></li>
<li><a href="../270787/index.html">Early detection of cyber threats in the enterprise</a></li>
<li><a href="../270791/index.html">DataTalks # 4: Predictive Analytics</a></li>
<li><a href="../270793/index.html">New formats of mobile advertising, disassembling iOS - Android, and a lot of analytics in the news of the week for mobile developers</a></li>
<li><a href="../270797/index.html">We write a simple virtual machine in Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>