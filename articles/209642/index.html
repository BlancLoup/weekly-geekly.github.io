<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mail Encryption in Outlook 2010</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The post is addressed to anyone who would be interested in setting up encrypted message exchange between two or more users using the Outlook 2010 emai...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mail Encryption in Outlook 2010</h1><div class="post__text post__text-html js-mediator-article">  The post is addressed to anyone who would be interested in setting up encrypted message exchange between two or more users using the Outlook 2010 email client. As you know, email encryption in the outlook is based on certificates and public key infrastructure.  During the exchange of encrypted messages, certificates of two PKCS # 12 and X.509 formats will be used. <br><br>  <b>X.509</b> (file with * .cer extension) - a certificate format that, in addition to general information (version, serial number, signature algorithm, publisher information, expiration date, owner information, electronic fingerprint) contains your public key.  We send it to other users with whom we want to exchange encrypted messages. <a name="habracut"></a><br><br>  <b>PKCS # 12</b> (file with * .pfx extension) is the only certificate format that, in addition to general information, can contain not only a public but also a private key.  With it, we will decrypt messages encrypted by other users with our public key, as well as put our digital signature. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We will create certificates using <a href="http://cybersafesoft.com/rus/products/files-encryption/">CyberSafe</a> encryption <a href="http://cybersafesoft.com/rus/products/files-encryption/">software</a> , which can work as a Certification <a href="http://cybersafesoft.com/rus/products/files-encryption/">Authority</a> .  The root certificate of the CyberSafe Certification Authority is automatically added to the <i>Trusted</i> Windows store, the PKCS # 12 certificate will be stored in the <i>Personal</i> section, and X.509 in the <i>Other users</i> section. <br><br>  First, create a <i>personal certificate</i> containing the above certificates, public and private keys, as well as other information.  Run the program, go to the <i>Keys and Certificates</i> tab, select <i>Create</i> , fill in the required fields and click <i>Next</i> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bde/745/1cb/bde7451cb635bce34f33cf9fc7f6163e.jpg"><br><br>  The keys will be generated, certificates will be created and they will be written to the program database  If the option <i>Publish</i> after creation has been selected, the certificate will be published on the CyberSafe server, where your public key will be available for downloading to other users. <br><br>  Now we export the certificates we need to work with Outook into separate files: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/96d/e01/47a/96de0147ae3929611f4081222f907ebd.jpg"><br><br>  Certificates in CyberSafe are created based on the OpenSSL library, the certificate creation code is shown below: <br><br><div class="spoiler">  <b class="spoiler_title">View code</b> <div class="spoiler_text">  procedure TOpenSSL.CreateSignedCert (const FileName: String; OutFiles: TStringList; <br>  const Password: String; <br>  ValidDays: Integer;  KeySize: Integer;  const ExtendedKeyUsage: String; <br>  const CommonName, Email, Organization, OrganizationalUnit, Country: String; <br>  const CAFileSpec, CAPFXFileSpec, CAPrivateKeyPassword: String; <br>  ARandomFileSpec: String = ''; <br>  ProgressProc: TProgressProc = nil;  LogMsgProc: TLogMsgProc = nil); <br>  var <br>  TmpPrivateKeyFileSpec, TmpPublicKeyFileSpec: String; <br>  TmpCerFileSpec, TmpPfxFileSpec, TmpCsrFileSpec, TmpCASerialFileSpec, TmpExtFileSpec, TmpPemFileSpec: String; <br>  TmpCAPrivateKeyFileSpec: String; <br>  Subj: String; <br>  TempDir: String; <br>  Aborted: Boolean; <br>  WasError: Boolean; <br>  OutPublicKeyFileSpec: String; <br>  begin <br>  WasError: = True; <br>  TempDir: = GetTempDir; <br>  try <br>  CheckIsFileExists (CAFileSpec); <br><br>  // Retrieve the private key from the root certificate <br>  TmpCAPrivateKeyFileSpec: = TempDir + ChangeFileExt (ExtractFileName (CAPFXFileSpec), '') + '.privateKey.pem'; <br>  ExportPrivateKeyFromPfx (CAPFXFileSpec, TmpCAPrivateKeyFileSpec, CAPrivateKeyPassword); <br><br>  // All files are created in a temporary directory, and only after successful creation of all - // we transfer to the place of permanent storage <br>  TmpPrivateKeyFileSpec: = TempDir + FileName + '.privateKey.pem'; <br>  TmpPublicKeyFileSpec: = TempDir + FileName + '.publicKey.pem'; <br>  TmpCerFileSpec: = TempDir + FileName + '.cer'; <br>  TmpPemFileSpec: = TempDir + FileName + '.pem'; <br>  TmpPfxFileSpec: = TempDir + FileName + '.pfx'; <br>  TmpCsrFileSpec: = TempDir + FileName + '.csr'; <br>  TmpCASerialFileSpec: = TempDir + FileName + '.srl'; <br><br>  Subj: = GetSubj (CommonName, Email, Organization, OrganizationalUnit, Country); <br><br>  Aborted: = False; <br>  if Assigned (ProgressProc) then <br>  ProgressProc (13, 4, Aborted, Format ('% s (% d% s) ...' {'Generate Keys (% d bits) ...'}, [StKeysGenerate, KeySize, StBit])); <br>  if aborted then <br>  Exit; <br><br>  CreatePrivateKey (TmpPrivateKeyFileSpec, TmpPublicKeyFileSpec, KeySize, ARandomFileSpec); <br><br>  if Assigned (ProgressProc) then <br>  ProgressProc (13, 5, Aborted, Format ('% s ...', [StGenerateCertificate]) {'Generate certificate ...'}); <br>  if aborted then <br>  Exit; <br><br>  if Assigned (ProgressProc) then <br>  ProgressProc (13, 6, Aborted, Format ('% s ...', [StCreateCertificateRequest]) {'Create the certificate request ...'}); <br><br>  // Create a query - .csr <br>  RunOpenSSLConsole (Format ( <br>  'req -new -key "% s" -out "% s" -days% d -subj% s', <br>  [TmpPrivateKeyFileSpec, TmpCsrFileSpec, ValidDays, Subj] <br>  ), True, nil, nil); <br><br>  if Assigned (ProgressProc) then <br>  ProgressProc (13, 7, Aborted, Format ('% s ...', [StCreateExtensionsFile]) {'Create the extensions file ...'}); <br><br>  // <a href="http://www.openssl.org/docs/apps/x509v3_config.html">www.openssl.org/docs/apps/x509v3_config.html</a> <br>  TmpExtFileSpec: = StrToFile ( <br>  // 'keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment, keyCertSign' + <br>  'keyUsage = digitalSignature, keyEncipherment' + <br>  iif (ExtendedKeyUsage &lt;&gt; '', # 13 # 10'extendedKeyUsage = '+ ExtendedKeyUsage,' '), <br>  TempDir + FileName + '.extensions.cfg' <br>  ); <br><br>  if Assigned (ProgressProc) then <br>  ProgressProc (13, 8, Aborted, Format ('% s ...', [StCreateSignedCertificate]) {'Create the signed certificate ...'}); <br><br>  // Based on the request, create a certificate signed by the root certificate <br>  RunOpenSSLConsole (Format ( <br>  'x509 -req -days% d -passin pass:% s -in "% s" -CAform DER -CA "% s" -CAkey "% s" -Cserial "% s" -CAcreateserial -out "% s" - outform DER -extfile "% s" ', <br>  [ValidDays, Password, TmpCsrFileSpec, CAFileSpec, TmpCAPrivateKeyFileSpec, TmpCASerialFileSpec, TmpCerFileSpec, TmpExtFileSpec] <br>  ), False, nil, nil); <br><br>  if Assigned (ProgressProc) then <br>  ProgressProc (13, 9, Aborted, Format ('% s ...', [StConvertCertificate]) {'Convert the certificate from the CER to the PEM format ...'}); <br><br>  // Convert cer =&gt; pem for the next export to pfx <br>  RunOpenSSLConsole (Format ( <br>  'x509 -in "% s" -inform DER -out "% s" -outform PEM', <br>  [TmpCerFileSpec, TmpPemFileSpec] <br>  ), False, nil, nil); <br><br>  if Assigned (ProgressProc) then <br>  ProgressProc (13, 10, Aborted, Format ('% s ...', [StCreatePFX]) {'Create the PFX certificate file ...'}); <br><br>  // Make pfx from pem and keys <br>  RunOpenSSLConsole (Format ( <br>  'pkcs12 -password pass:% s -export -in "% s" -inkey "% s" -name "% s" -out "% s"', <br>  [Password, TmpPemFileSpec, TmpPrivateKeyFileSpec, FileName, TmpPfxFileSpec] <br>  ), False, nil, nil); <br><br>  OutPublicKeyFileSpec: = TmpPublicKeyFileSpec + '.signed'; <br><br>  if Assigned (ProgressProc) then <br>  ProgressProc (13, 11, Aborted, Format ('% s ...', [StExportPublicKey]) {'Export public keys from the PFX certificate file ...'}); <br><br>  ExportPublicKeyFromPfx (TmpPfxFileSpec, OutPublicKeyFileSpec, Password); <br><br>  // And the result is added to the file list <br>  OutFiles.Add (TmpCerFileSpec); <br>  OutFiles.Add (TmpPfxFileSpec); <br>  OutFiles.Add (TmpPrivateKeyFileSpec); <br>  OutFiles.Add (TmpPublicKeyFileSpec); <br>  OutFiles.Add (OutPublicKeyFileSpec); <br><br>  WasError: = False; <br>  finally <br>  // Delete temporary files <br>  if WasError then <br>  begin <br>  CheckDeleteFile (TmpCerFileSpec); <br>  CheckDeleteFile (TmpPfxFileSpec); <br>  CheckDeleteFile (TmpPrivateKeyFileSpec); <br>  CheckDeleteFile (TmpPublicKeyFileSpec); <br>  CheckDeleteFile (OutPublicKeyFileSpec); <br>  end; <br><br>  CheckDeleteFile (TmpCsrFileSpec); <br>  CheckDeleteFile (TmpCASerialFileSpec); <br>  CheckDeleteFile (TmpExtFileSpec); <br>  CheckDeleteFile (TmpPemFileSpec); <br>  CheckDeleteFile (TmpCAPrivateKeyFileSpec); <br>  end; <br>  end; <br></div></div><br>  Install the exported certificate in the PKCS # 12 format in the Windows store.  To do this, double click on the pfx file and follow the instructions of the Certificate Import Wizard.  Since this certificate contains your private key, during the import process you will need to enter the password that was specified when it was created. <br><br>  Next, open Outlook and go: <i>File&gt; Settings&gt; Security Control Center&gt; Security Control Center Settings&gt; Email Protection</i> .  In the <i>Encrypted e-mail</i> section, check the items: <br><br><ul><li>  Encrypt the contents and attachments of outgoing messages </li><li>  Add digital signature to outgoing messages </li></ul> <br>  Now, from the list of certificates installed in the store, you need to select the one that will be used for encryption and creating a digital signature.  To do this, click here <i>Options ...&gt; Select</i> and select your certificate: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c6b/92c/9a5/c6b92c9a5a37ea02d46ee20c62c42b47.jpg"><br><br>  On this, in principle, everything :).  However, let's make sure that everything works correctly with us and perform the encryption check ‚Äúfor ourselves‚Äù. <br><br>  Create a new contact.  Go <i>Home&gt; Contacts&gt; Create a contact</i> .  On the General tab, just fill in the fields <i>Full Name</i> and <i>Email.</i>  <i>mail</i> , then go to the <i>Certificates</i> tab, where we click <i>Import</i> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dbf/5d2/b03/dbf5d2b035b2f2a0acb2cf63da28e66d.jpg"><br><br>  In Windows Explorer, we find our certificate in * .cer format <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cc8/e7e/563/cc8e7e563eb65f1cc2dd6bb1c7bd8965.jpg"><br><br>  Make sure that the certificate has been imported and displayed in the <i>Certificates (digital signatures)</i> window.  Click <i>Save and Close</i> .  Now we can send an encrypted message to ourselves.  To do this, go to <i>Mail&gt; Home&gt; Create a message</i> .  In the <i>To</i> field, add your contact by selecting it from the Address Book: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/179/795/5af/1797955af683a6a2b589c9fa76d63f27.jpg"><br><br>  We send the letter.  Go to the <i>Inbox</i> and find the message we sent there.  It is encrypted, as evidenced by the icon with the blue lock in the upper left corner.  Click on it with the mouse to automatically decrypt and open. <br><br>  If the sent email does not appear in your inbox, go to the <i>Send &amp; Receive</i> tab and click <i>Refresh Folder</i> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/20b/a80/baa/20ba80baa570fb0f1e0100c88349e732.jpg"><br><br>  To view the security properties of a message or digital signature information, click on the corresponding icons in the field with general information about the message: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ac9/615/5c0/ac96155c02eef7106723929fbd82070e.png"><br><br>  Verification of the encryption function ‚Äúfor yourself‚Äù is performed. <br><br>  Now we send the message certified by the digital signature to other users and we receive their signed messages.  This will allow us to exchange public keys with each other, since the signed letter contains the public key. <br><br>  Having received such a letter from another user, we add it to <i>Contacts</i> (Address Book).  Next, you need to export the X.509 user certificate to a file and install it in the Windows storage.  To do this, in the field with general information about the letter, click on the digital signature icon <img src="https://habrastorage.org/getpro/habr/post_images/3c0/d59/0bd/3c0d590bd8474b8caa74e9a27804a244.jpg">  and select <i>Details&gt; Details&gt; View Certificate&gt; Composition&gt; Copy to File</i> and follow the instructions of the Certificate Export Wizard.  The exported certificate is added to the user's contact in the same way as we did when checking the encryption function ‚Äúfor ourselves‚Äù. <br><br>  If you do not have a certificate (and the public key of the correspondent), you should disable the encryption function when sending it the first message, otherwise the outlook cannot encrypt it and will generate an error.  You can disable the encryption function, leaving the digital signature function enabled on the <i>Settings</i> tab: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bc9/7d6/555/bc97d65555ef26dea2e861ed0af7e258.jpg"><br><br>  In conclusion, I would like to add that you can make your public key available to other users by publishing it on public key servers, such as the CyberSafe server.  Naturally, there you can also try to find the public keys of the users you are interested in, without waiting for them to send them to you. <br><br>  If the public key is downloaded from a non-trusted server, or you receive it by e-mail, you cannot be exactly sure of the authenticity of such a key.  It may be that this attacker sent you his ‚Äúfake‚Äù key instead of your friend's key.  Then he will be able to read all the encrypted messages that you send to your friend, but your friend will not be able to do this. <br><br>  Therefore, in this case, the authenticity of the public key should be verified by its electronic fingerprint.  One of the easiest ways to verify an imprint is to contact the owner of a public key on Skype or by phone. </div><p>Source: <a href="https://habr.com/ru/post/209642/">https://habr.com/ru/post/209642/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../209618/index.html">Why not use RJS</a></li>
<li><a href="../209624/index.html">Panorama of the Moon from "Chang'e 3" and the failure of the main color camera of the landing module</a></li>
<li><a href="../209626/index.html">Lightpack. Unboxing and installation</a></li>
<li><a href="../209630/index.html">Bird stole camera and aerial photo of penguin colony</a></li>
<li><a href="../209640/index.html">Kalman, Matlab, and State Space Models</a></li>
<li><a href="../209644/index.html">SELinux - description and features of working with the system. Part 1</a></li>
<li><a href="../209646/index.html">Experience does not matter</a></li>
<li><a href="../209650/index.html">Mobile game: where is the money?</a></li>
<li><a href="../209652/index.html">What nobody says to newbies</a></li>
<li><a href="../209654/index.html">DipTrace. Innovations</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>