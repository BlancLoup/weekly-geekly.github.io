<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>FreeSWITCH + mod_unimrcp + VoiceNavigator. Synthesis and recognition of Russian speech in FreeSWITCH</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the continuation of a series of articles on the integration of Asterisk and VoiceNavigator I will describe the integration of VoiceNavigator with F...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>FreeSWITCH + mod_unimrcp + VoiceNavigator. Synthesis and recognition of Russian speech in FreeSWITCH</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/d4048c23/cf914a43/54dba5c2/817e0185.png" alt="VoiceNavigator"><img src="https://habrastorage.org/storage2/4a6/959/c6a/4a6959c6a01b1dbe64b97e3b8e5cc193.png" alt="FreeSWITCH"><img src="https://habrastorage.org/getpro/habr/post_images/3aa/7ce/eeb/3aa7ceeebc73704cfea552d78f040e33.png" alt="UniMRCP"><br><br>  In the continuation of a <a href="http://habrahabr.ru/blogs/voip/124946/">series of articles</a> on the integration of Asterisk and VoiceNavigator I will describe the integration of <a href="http://speechpro.ru/product/recognition/platform/vn">VoiceNavigator</a> with <a href="http://www.freeswitch.org/">FreeSWITCH</a> . <br><br>  On Habr√© there are several articles and mentions of FS, but it‚Äôs not as popular with Asterisk)) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      FreeSWITCH, being a continuation and development of ideas embedded in Asterisk, has a truly modular architecture, where all the basic functionality, as far as possible, is rendered into separate modules.  This allows for greater flexibility in creating solutions scalable from softphone to softswitch.  FreeSWITCH can be used as a switch, PBX, media gateway or media server for IVR applications that use XML files to control the call processing algorithm. <br><br>  For FreeSWITCH, unlike Asterisk, there is no need to separately compile UniMRCP.  UniMRCP support has already been added and works out of the box as a module asr_tts / mod_unimrcp. <br><br>  The following describes installing FreeSWITCH, connecting VoiceNavigator to it, and creating a test voice application. <br><a name="habracut"></a><br><h5>  Install FreeSWITCH </h5><br>  The installation of FS was described both on Habr√© and in other sources, therefore I‚Äôll dwell on it briefly.  Fortunately, everything is simple and affordable.  The following describes the installation on CentOS. <br><br>  Download the distribution from <a href="http://www.freeswitch.org/">www.freeswitch.org</a> .  At the time of writing, the latest version of the distribution is 1.0.6. <br><br>  Before compiling, we install the necessary packages for FreeSWITCH and its modules: <br> <code>yum install autoconf automake libtool gcc-c++ ncurses-devel make expat-devel zlib zlib-devel libjpeg-devel unixODBC-devel openssl-devel gnutls-devel libogg-devel libvorbis-devel curl-devel gdbm gdbm-devel</code> <br> <br>  To add a UniMRCP module in the modules.conf file, uncomment the line asr_tts / mod_unimrcp. <br>  You also need to uncomment languages ‚Äã‚Äã/ mod_perl for the ability to work with a dialplan from Perl. <br><br>  Next, the standard compilation procedure: <br><pre>  ./configure
 make
 make check
 make install
 make cd-sounds-install
 make cd-moh-install
 make cd-sounds-ru-install
 make samples </pre><br>  After installation, FreeSWITCH is already configured and ready to use. <br>  To enable the use of the Russian language as the default language, you need to add to /usr/local/freeswitch/conf/vars.xml <br><pre>  &lt;X-PRE-PROCESS cmd = "set" data = "default_language = en" /&gt; </pre><br>  To run, use the / usr / local / freeswitch / bin / freeswitch command <br>  To test the operation, set up the softphone with user parameters - 1000, password - 1234 and register with the server, call 5000. If FreeSWITCH is set correctly, you will hear a test IVR. <br><br><h5>  Connecting VoiceNavigator to FreeSWITCH </h5><br>  1) Add the mod_unimrcp module load. <br>  To do this, add the following file to the /usr/local/freeswitch/conf/autoload_configs/modules.conf.xml file <br><pre>  &lt;load module = "mod_unimrcp" /&gt; </pre><br>  2) In the / usr / local / freeswitch / conf / mrcp_profiles folder, create a vn.xml file with the profile of our MRCP server. <br><pre>  &lt;include&gt;
   &lt;! - VoiceNavigator -&gt;
   &lt;profile name = "vn" version = "1"&gt;
     &lt;param name = "server-ip" value = "192.168.2.106" /&gt; &lt;! - IP address of the computer with VoiceNavigator -&gt;
     &lt;param name = "server-port" value = "8000" /&gt; &lt;! - Connection port to the MRCP server -&gt;
     &lt;param name = "resource-location" value = "" /&gt;
     &lt;param name = "speechsynth" value = "tts" /&gt;
     &lt;param name = "speechrecog" value = "asr" /&gt;
     &lt;param name = "rtp-ip" value = "192.168.3.161" /&gt; &lt;! - IP address of the computer with FreeSWITCH -&gt;
     &lt;param name = "rtp-port-min" value = "32768" /&gt;
     &lt;param name = "rtp-port-max" value = "33268" /&gt;
     &lt;param name = "codecs" value = "PCMU PCMA L16 / 96/8000" /&gt;
    &lt;/ profile&gt;
 &lt;/ include&gt; </pre><br>  3) Make the newly created profile used by default. <br>  To do this, in the file /usr/local/freeswitch/conf/autoload_configs/unimrcp.conf.xml, we will correct the lines indicating the default profiles. <br><pre>  &lt;! - UniMRCP profile to use for TTS -&gt;
 &lt;param name = "default-tts-profile" value = "vn" /&gt;
 &lt;! - UniMRCP profile to use for ASR -&gt;
 &lt;param name = "default-asr-profile" value = "vn" /&gt; </pre><br>  4) To allow FreeSWITCH interaction with other nodes, edit the file <br>  /usr/local/freeswitch/conf/autoload_configs/acl.conf.xml, adding the IP address of the machine with VoiceNavigator to the allowed nodes. <br><pre>  &lt;list name = "domains" default = "deny"&gt;		
	 &lt;node type = "allow" domain = "$$ {domain}" /&gt;
	 &lt;! - Allow for interaction the node with the address 192.168.2.106 -&gt;
	 &lt;node type = "allow" cidr = "192.168.2.106/32" /&gt;	
 &lt;/ list&gt; </pre><br>  This completes the setup of connecting the server from VoiceNavigator to FreeSWITCH. <br><br><h5>  Creating a test voice application </h5><br>  1) Create a digits.gram grammar file in the / usr / local / freeswitch / grammar / folder <br><pre>  &lt;? xml version = "1.0"?&gt;
 &lt;grammar xmlns = "http://www.w3.org/2001/06/grammar" xml: lang = "en-ru" version = "1.0" mode = "voice" root = "test"&gt;
     &lt;rule id = "test"&gt;
         &lt;one-of&gt;
             &lt;item&gt; one &lt;/ item&gt;
             &lt;item&gt; two &lt;/ item&gt;
             &lt;item&gt; three &lt;/ item&gt;
             &lt;item&gt; four &lt;/ item&gt;
             &lt;item&gt; five &lt;/ item&gt;
             &lt;item&gt; six &lt;/ item&gt;
             &lt;item&gt; seven &lt;/ item&gt;
             &lt;item&gt; eight &lt;/ item&gt;
             &lt;item&gt; nine &lt;/ item&gt;
             &lt;item&gt; ten &lt;/ item&gt;
         &lt;/ one-of&gt;
     &lt;/ rule&gt;
 &lt;/ grammar&gt; </pre><br>  2) Create a dialing plan in the test_vn.xml file and put it in / usr / local / freeswitch / conf / dialplan / <br><pre>  &lt;? xml version = "1.0" encoding = "utf-8"?&gt;
 &lt;include&gt;
   &lt;context name = "context_vn"&gt;
     &lt;extension name = "welcome"&gt;
         &lt;condition field = "destination_number" expression = "^ 777 $"&gt;
             &lt;action application = "answer" /&gt;
             &lt;action application = "set" data = "tts_engine = unimrcp: vn" /&gt;
             &lt;action application = "set" data = "tts_voice = Maria8000" /&gt;
             &lt;action application = "speak" data = "Give the number from one to ten!" /&gt;
             &lt;action application = "detect_speech" data = "unimrcp / usr / local / freeswitch / grammar / digits vn" /&gt;
             &lt;action application = "sleep" data = "10000" /&gt;
             &lt;action application = "hangup" /&gt;
         &lt;/ condition&gt;
     &lt;/ extension&gt;
   &lt;/ context&gt;
 &lt;/ include&gt; </pre><br>  Do you still think that FS dialplans are inconvenient and unreadable?  In my opinion it is quite simple and understandable)) <br><br>  3) To be able to call this application, add to the /usr/local/freeswitch/conf/dialplan/default.xml file <br><pre>  &lt;extension name = "context_vn"&gt;
       &lt;condition field = "destination_number" expression = "^ 777 $"&gt;
         &lt;action application = "transfer" data = "777 XML context_vn" /&gt;
       &lt;/ condition&gt;
 &lt;/ extension&gt; </pre><br><br>  FreeSWITCH is configured and ready to test the operation of the synthesis and recognition functions. <br>  Restart FS to apply the changes. <br><br>  Now you can call on number 777 to check the work of synthesis and recognition.  The system asks for a number from one to ten and displays the recognition result in the console. <br><br>  But then the most interesting.  How to get this result and process?  If in Asterisk it was enough to parse the $ {RECOG_RESULT} variable, then FreeSWITCH uses the more complex Event Socket mechanism for this.  Or rather the event DETECTED_SPEECH with Speech-Type: detected-speech. <br>  The topic of working with sockets FreeSWITCH is beyond the scope of this article and deserves a separate large description. <br>  For those interested, you can see the details <a href="http://wiki.freeswitch.org/wiki/Misc._Dialplan_Tools_detect_speech">here</a> and <a href="http://wiki.freeswitch.org/wiki/ESL">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/129811/">https://habr.com/ru/post/129811/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../129804/index.html">Single user authorization with support for multiple services</a></li>
<li><a href="../129805/index.html">XTreamer Ultra Review</a></li>
<li><a href="../129806/index.html">Video recording Apple Special Event, October 2011</a></li>
<li><a href="../129807/index.html">HackDay. Moscow. October 22-23</a></li>
<li><a href="../129810/index.html">Chinese t-shirt web service</a></li>
<li><a href="../129813/index.html">Live discussion. Artemy Lebedev. Megan Donahoe. Design, Metro, Windows Phone</a></li>
<li><a href="../129814/index.html">Embedding Spring Security in the ZK + Spring Framework + Hibernate: Part Three</a></li>
<li><a href="../129816/index.html">HP offers turnkey virtualization</a></li>
<li><a href="../129817/index.html">We deploy the application on a clean Ubunt: from A to Z</a></li>
<li><a href="../129819/index.html">Update server line at Hetzner.de</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>