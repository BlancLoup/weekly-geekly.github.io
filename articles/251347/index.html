<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Context Model Pattern via Aero Framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Context Model Pattern is an application design concept that combines the features of MVVM , MVP , MVC architectural patterns and is based on a set of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Context Model Pattern via Aero Framework</h1><div class="post__text post__text-html js-mediator-article">  <b>Context Model Pattern</b> is an application design concept that combines the features of <i>MVVM</i> , <i>MVP</i> , <i>MVC</i> architectural patterns and is based on a set of fairly free, progressive, well-coordinated positions.  The cornerstones are <i>representations</i> , <i>mediators</i> , <i>contextual objects</i> and <i>their collections</i> , and the fundamental recommendation is the <i>principle of direct injections</i> . <br><br>  <b>Aero Framework</b> is an open library in <i>C #</i> language, containing all the necessary infrastructure for creating xaml-oriented applications corresponding to the pattern in question.  With its proper use, the source code is obtained unprecedentedly concise, high-performance and intuitive, even for novice developers. <br><br>  Following the ideas of the pattern allows you to beautifully and naturally solve a lot of routine tasks from navigation and localization in the application to the implementation of data validation mechanisms, preservation of the visual state of the interface and logical view models.  But the most important thing is helping to build a clear, successful and very simple architecture.  Moreover, the speed and quality of development significantly increase, and the amount of written code is reduced several times, which has been successfully tested on <a href="http://makeloft.by/ru/works">various projects</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>An attentive and patient reader will be generously rewarded by knowledge.</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ab2/c0e/a82/ab2c0ea827cf4be4ecbd4f8e4439e77a.jpg" alt="image"><br><a name="habracut"></a><br><br>  <b><i>Context Context Principle</i></b> <br><br>  <i>Views</i> are interface markup templates that describe how to render specific instances of context objects.  Just as words acquire a semantic coloring within a text, intonation or situation (that is, context), the visual elements of the user interface become informative only in close connection with the context object, in other words, they begin to display useful data contained in the context . <br><br>  An instance of any type can act as a context object, only the representation itself must know how to interpret the information contained in the context object.  And even the representation itself can be the context for itself or another representation.  Moreover, representations can be multi-contextual, that is, they can simultaneously use information from several source objects. <br><br>  In other words, for the end user, only a bundle representation-context object makes sense.  A separate representation in itself is meaningless from a practical point of view, and the user is not able to perceive an object in a non-visual form.  When an object is put into correspondence with a representation, it acquires the property of <i>contextual fundamentality</i> , and the representation becomes <i>informative</i> . <br><br>  <i>CM-</i> pattern includes the following basic provisions: <br><br>  <i>‚Ä¢ one or several context objects can be associated with any view and vice versa (many to many).</i>  <i>Any interactions of representations and context objects occur through three types of mediators: property bindings, commands, and context injection;</i> <i><br><br></i>  <i>‚Ä¢ View models and models are entities that have different specifics, but perform common domain modeling functions and have the property of contextual fundamentality; therefore, applying the same base class to both the model and the view model becomes quite acceptable.</i> <br><br>  Complex representations themselves consist of smaller and elementary representations - elements of the visual tree.  Root views are special types - <i>screens</i> that support navigation in one form or another. <br><br>  <i>Any interaction of a view with a context object occurs through <u>mediators</u> .</i>  <i>This is an extremely important point, because it makes it easy to separate business logic from interface logic.</i> <br><br>  Its significance lies in the fact that often the lifetime of representations is shorter than the lifetime of context objects (for example, model view), and a correctly implemented mediator, if possible, contains only weak subscriptions and links to interacting objects, which does not prevent the view from garbage collection and protects against memory leaks. <br><br>  Mediators perform three main functions: <br>  ‚Ä¢ binding properties ( <i>Binding</i> , <i>StoreBinding</i> ) <br>  ‚Ä¢ command binding ( <i>Context</i> ) <br>  ‚Ä¢ context injection ( <i>Store</i> ) <br><br>  With regard to <i>xaml</i> , views include both individual markup pages, <i>Control Controls</i> and <i>Data Templates</i> .  In any case, <i>complex representations themselves consist of smaller and elementary representations - elements of the visual tree</i> . <br><br>  Consider an example: <br><pre><code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">DataContract</span></span>] <span class="hljs-comment"><span class="hljs-comment">// serialization attributes public class Person : ModelBase // DTO or ORM entity { [DataMember] public string FirstName { get; set; } [DataMember] public string LastName { get; set; } // Possible, contains Save hanges logic }</span></span></code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PersonsViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">ViewModelBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ObservableCollection&lt;Person&gt; Persons { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// Load, Save, Add, Remove items logic }</span></span></code> </pre><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ItemsSource</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{Binding</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Persons</span></span></span><span class="hljs-tag">}&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListBox.ItemTemplate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DataTemplate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding FirstName}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding LastName}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DataTemplate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListBox.ItemTemplate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListBox</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Here, the collection of entity entities of <i>Person is</i> bound to an element of the interface and the data of the model is directly displayed on the interface.  Other situation: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TextDocumentViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">ViewModelBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FileName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Text { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// Load, Save document logic }</span></span></code> </pre><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DocumentsViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">ViewModelBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ObservableCollection&lt;TextDocumentViewModel&gt; Documents { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// Open, Save, Create, Close documents logic }</span></span></code> </pre><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TabControl</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ItemsSource</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{Binding</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Persons</span></span></span><span class="hljs-tag">} </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ItemTemplate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{Binding</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FileName</span></span></span><span class="hljs-tag">, </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Converter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{StaticResource</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">TitleConverter</span></span></span><span class="hljs-tag">}}&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TabControl.ContentTemplate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DataTemplate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">AcceptsTab</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">AcceptsReturn</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Text, Mode=TwoWay}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DataTemplate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TabControl.ContentTemplate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TabControl</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Now <i>TextDocumentViewModel</i> aggregates in itself the data models <i>Text</i> and <i>FileName</i> , that is, in fact, is also a model, although it is inherited from the <i>ViewModelBase</i> class, but in both cases <i>Person</i> and <i>TextDocumentViewModel</i> are data context objects for the <i>DataTemplate</i> . <br><br>  <i>But does this not indicate that there may still be more common features between the view model and the model than is usually assumed?</i>  <i>What if ModelBase and ViewModelBase generalize to a single <u>ContextObject</u> entity?</i> <br><br>  Let's see what properties such an object should have.  <i>ViewModelBase</i> , as a rule, in one way or another implements the <i>INotifyPropertyChanged</i> interface for notifying interface elements about changes in property values.  <i>ModelBase can</i> also sometimes implement this interface and usually <i>supports serialization</i> .  All this functionality is implemented by the <i>ContextObject</i> class, therefore, <i>whenever</i> possible, it is recommended to use it as a basis not only for the view models, but also for the models themselves. <br><br>  At first glance, such recommendations may seem strange, but if you think about it more deeply, then everything is very natural, because despite the difference in practical use of the view models and models, they are data context objects (contextual objects), so they may well have a common basis .  Moreover, using an atypical serialization mechanism for view models allows you to very nicely solve a wide range of common tasks, as will be shown below. <br><br>  In addition, the basis of the <i>CM-</i> pattern is a set of additional recommendations, which are now discussed. <br><br>  <b>Simplicity - the key to good architecture</b> <br><br>  In the first section, in order to awaken the reader‚Äôs interest in the material and to give an introductory concept of the basic points, the general scheme of building an application using the <i>Aero Framework</i> library ( <a href="http://makeloft.by/tools">source codes with an example of the application</a> , <a href="http://makeloft.by/ru/">website</a> ) will be demonstrated and the following range of important questions will be briefly highlighted: <br><br>  ‚Ä¢ <i>Direct Injections Principle</i> <br>  ‚Ä¢ <i>Independent Injections via Exposable Pattern</i> <br>  ‚Ä¢ command-oriented navigation ( <i>Command-Oriented Navigation</i> ) <br>  ‚Ä¢ dynamic localization ( <i>Dynamic Localizing</i> ) <br>  ‚Ä¢ context commands and triggers ( <i>Context Commands &amp; Triggers</i> ) <br>  ‚Ä¢ notification and validation of properties ( <i>Property Notification &amp; Validation</i> ) <br>  ‚Ä¢ smart state <br><br>  Let it be the <u>task</u> - to make part of the functionality for Internet banking, namely: authorization screens and information about the user's products with accounts and bank cards.  According to the <i>CM-</i> pattern, the project contains a set of navigated views (screens) and a number of twist models for them, <i>and, as for a particular twist model there can be several screens, and some screens can simultaneously work with several twist models</i> . <br><br>  Create <i>LoginViewModel</i> and <i>ProductsViewModel</i> , inheriting them from the <i>ContextObject</i> class and the <i>IExposable</i> interface, and <i>LoginView</i> to authorize the user, <i>ProductsView</i> with a list of products to select and <i>ProductView</i> with detailed information about the selected product and a set of actions on it. <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">DataContract</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LoginViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">ContextObject</span></span>, <span class="hljs-title"><span class="hljs-title">IExposable</span></span> { [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Get(() =&gt; Name); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { Set(() =&gt; Name, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Password { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Get(() =&gt; Name); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { Set(() =&gt; Name, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> UserData UserData { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Get(() =&gt; UserData); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { Set(() =&gt; UserData, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Expose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[() =&gt; Name].PropertyChanged += (sender, args) =&gt; Context.Login.RaiseCanExecuteChanged(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[() =&gt; Password].PropertyChanged += (sender, args) =&gt; Context.Login.RaiseCanExecuteChanged(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[() =&gt; Name].Validation += () =&gt; Error = Name == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || Name.Length &lt; <span class="hljs-number"><span class="hljs-number">3</span></span> ? Unity.App.Localize(<span class="hljs-string"><span class="hljs-string">"InvalidName"</span></span>) : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[() =&gt; Password].Validation += (sender, args) =&gt; Error = Name == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || Name.Length &lt; <span class="hljs-number"><span class="hljs-number">4</span></span> ? Unity.App.Localize(<span class="hljs-string"><span class="hljs-string">"InvalidPassword"</span></span>) : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[Context.Login].CanExecute += (sender, args) =&gt; { args.CanExecute = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(Error); <span class="hljs-comment"><span class="hljs-comment">// Error contains last validation fail message }; this[Context.Login].Executed += async (sender, args) =&gt; { try { UserData = await Bank.Current.GetUserData(); Navigator.GoTo(args.Parameter); } catch (Exception exception) { Error = Unity.App.Localize(exception.Message); } }; this[Context.Logout].Executed += (sender, args) =&gt; { UserData = null; Navigator.RedirectTo(args.Parameter); }; } }</span></span></code> </pre><br><pre> <code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!--LoginView.xaml--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">View</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DataContext</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Store Key=viewModels:LoginViewModel}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Localizing Key=Name}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Name, Mode=TwoWay}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Localizing Key=Password}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PasswordBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Password</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Password, Mode=TwoWay}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Context Key=Login}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">CommandParameter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{x:Type ProductsView}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Localizing Key=Login}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Error}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">View</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ProductsViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">ContextObject</span></span>, <span class="hljs-title"><span class="hljs-title">IExposable</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Product CurrentProduct { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Get(() =&gt; CurrentProduct); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { Set(() =&gt; CurrentProduct, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ContextSet&lt;Product&gt; Products { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Expose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Products = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ContextSet&lt;Product&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[() =&gt; Name].PropertyChanged += (sender, args) =&gt; Context.Login.RaiseCanExecuteChanged(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[() =&gt; Password].PropertyChanged += (sender, args) =&gt; Context.Login.RaiseCanExecuteChanged(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[() =&gt; CurrentProduct].PropertyChanged += (sender, args) =&gt; Context.Get(<span class="hljs-string"><span class="hljs-string">"GoToProduct"</span></span>).RaiseCanExecuteChanged(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[Context.Get(<span class="hljs-string"><span class="hljs-string">"GoToProduct"</span></span>)].CanExecute += (sender, args) =&gt; args.CanExecute = CurrentProduct != <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[Context.Get(<span class="hljs-string"><span class="hljs-string">"GoToProduct"</span></span>)].Executed += (sender, args) =&gt; Navigator.GoTo(args.Parameter); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[Context.Refresh].Executed += <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (sender, args) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> products = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Bank.Current.GetProducts(); CurrentProduct = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Products.Clean(); products.ForEach(p =&gt; Products.Add); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception exception) { Error = Unity.App.Localize(exception.Message); } }; } }</code> </pre><br><pre> <code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!--ProductsView .xaml--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">View</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DataContext</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Store Key=viewModels:ProductsViewModel}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Attacher.ContextTriggers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ContextTrigger</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">EventName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Loaded"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">UseEventArgsAsCommandParameter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"False"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Context Key=Refresh, StoreKey=viewModels:ProductsViewModel}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Attacher.ContextTriggers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DataContext</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Store Key=viewModels:LoginViewModel}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Localizing Key=UserName}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Path=UserData.FullName}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Context Key=Logout}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">CommandParameter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{x:Type LoginView}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Localizing Key=Logout}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ItemsSource</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Products}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SelectedItem</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding CurrentProduct, Mode=TwoWay}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListBox.ItemTemplate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DataTemplate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Name}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Balance, StringFormat=D2}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding CurrencyCode}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Visibility</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{StoreBinding StoreKey=viewModels:SettingsViewModel, Path=ShowDetails, Converter="</span></span></span><span class="hljs-tag">{</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StaticResource</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">TrueToVisibleConverter</span></span></span><span class="hljs-tag">}"}"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Localizing Key=ExpireDate}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding ExpireDate}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DataTemplate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListBox.ItemTemplate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListBox</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Localizing Key=Next}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Context Key=GoToProduct}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">CommandParameter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{x:Type ProductView}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">View</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><pre> <code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!--ProductView .xaml--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">View</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DataContext</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Store Key=viewModels:ProductsViewModel}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DataContext</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding CurrentProduct}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Name}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Balance, StringFormat=D2}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding CurrencyCode}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Localizing Key=ExpireDate}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding ExpireDate}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DataContext</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Store Key=viewModels:NavigatorViewModel}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Localizing Key=MakePayment}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Context Key=Navigate}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">CommandParameter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{x:Type PaymentView}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Localizing Key=MakeTransfer}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Context Key=Navigate}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">CommandParameter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{x:Type TransferView}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">View</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  So now pay attention to the key points. <br><br>  <b>1) <i>Direct Injections Principle</i></b> <br><br>  Linking view-models with views occurs directly in <i>xaml</i> by directly injecting context objects using the <i>Binding / Markup Extensions extensions</i> . <br><br><pre> <code class="cs hljs">DataContext=<span class="hljs-string"><span class="hljs-string">"{Store Key=viewModels:ProductsViewModel}"</span></span> Visibility=<span class="hljs-string"><span class="hljs-string">"{StoreBinding StoreKey=viewModels:SettingsViewModel, Path=ShowDetails, Converter="</span></span>{StaticResource TrueToVisibleConverter}<span class="hljs-string"><span class="hljs-string">"}"</span></span></code> </pre><br>  Depending on the platform, for example, <i>Windows Desktop</i> or <i>Windows Phone</i> , the syntax may differ due to implementation details of the markup parser, but the principle remains the same. <br><br>  On <i>Windows Desktop, you</i> can write in the following ways: <br><br><pre> <code class="cs hljs">DataContext=<span class="hljs-string"><span class="hljs-string">"{Store viewModels:ProductsViewModel}"</span></span> DataContext=<span class="hljs-string"><span class="hljs-string">"{Store Key=viewModels:ProductsViewModel}"</span></span> Visibility=<span class="hljs-string"><span class="hljs-string">"{StoreBinding Path=ShowDetails, KeyType=viewModels:SettingsViewModel, Converter="</span></span>{StaticResource TrueToVisibleConverter}<span class="hljs-string"><span class="hljs-string">" Visibility="</span></span>{StoreBinding ShowDetails, KeyType=viewModels:SettingsViewModel, Converter=<span class="hljs-string"><span class="hljs-string">"{StaticResource TrueToVisibleConverter}"</span></span>}<span class="hljs-string"><span class="hljs-string">" Visibility="</span></span>{Binding ShowDetails, Source={Store viewModels:SettingsViewModel}, Converter=<span class="hljs-string"><span class="hljs-string">"{StaticResource TrueToVisibleConverter}"</span></span>}<span class="hljs-string"><span class="hljs-string">"</span></span></code> </pre><br>  <i>Windows Phone</i> only allows this: <br><br><pre> <code class="cs hljs">DataContext=<span class="hljs-string"><span class="hljs-string">"{m:Store Key=viewModels:ProductsViewModel}"</span></span> Visibility=<span class="hljs-string"><span class="hljs-string">"{m:StoreBinding StoreKey=viewModels:SettingsViewModel, Path=ShowDetails, Converter="</span></span>{StaticResource TrueToVisibleConverter}<span class="hljs-string"><span class="hljs-string">"</span></span></code> </pre><br>  The syntax of the <i>C #</i> code looks extremely simple: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> anyViewModel = Store.Get&lt;AnyViewModel&gt;();</code> </pre><br>  Note that injection is valid not only in the <i>DataContext</i> control, but also directly into the binding ( <i>Binding</i> )!  The second method helps a lot in some situations, for example, when displaying list data, when the context is already an element of the collection, and also in cases where different properties of the control must work with different sources ( <i>multi-contextual behavior</i> ). <br><br>  It is worth paying attention to <i>ProductsView</i> , because it consists of two logical parts associated with different view-models.  The first part carries information about the user and allows you to perform <i><u>Logout</u></i> , and the second directly displays a list of user products.  In most classical implementations, <i>LoginViewModel</i> would have to be injected into <i>ProductsViewModel</i> , however, in our case, the solution turned out to be more beautiful, because the view models retained considerable independence from each other. <br><br>  However, the <i>principle of direct injections</i> is broader.  For example, it also allows you to beautifully implement Bindable Dependancy Converters, which will be described in detail below. <br><br>  <b>2) <i>Independent Injections via Exposable Pattern</i></b> <br><br>  The important point is to inherit from the <i>IExposable</i> interface, which is responsible for the delayed initialization of the object.  This means that the reference to the instance becomes available even before initialization, which is diametrically opposed to the use of the <i>Disposable</i> pattern ( <i>IDisposabe</i> interface), which allows you to release resources before all references to the object are lost and the garbage collector eliminates it.  Such a lazy initialization has several advantages over the classical one with the help of the constructor, however, the second option is not excluded, moreover, they can be used together, as for example, in the finalizer, call the <i>Dispose</i> method. <br><br>  With the help of lazy initialization, it is possible to implement the principle of <i>independent injections</i> , which allows us to initialize two interrelated objects containing reciprocal links to each other. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ProductsViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">ContextObject</span></span>, <span class="hljs-title"><span class="hljs-title">IExposable</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Expose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> settingsViewModel = Store.Get&lt;SettingsViewModel&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[Context.Get(<span class="hljs-string"><span class="hljs-string">"AnyCommand"</span></span>)].Executed += (sender, args) =&gt; { <span class="hljs-comment"><span class="hljs-comment">// safe using of settingsViewModel } } }</span></span></code> </pre><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SettingsViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">ContextObject</span></span>, <span class="hljs-title"><span class="hljs-title">IExposable</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Expose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> productsViewModel = Store.Get&lt;SettingsViewModel&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[Context.Get(<span class="hljs-string"><span class="hljs-string">"AnyCommand"</span></span>)].Executed += (sender, args) =&gt; { <span class="hljs-comment"><span class="hljs-comment">// safe using of productsViewModel } } }</span></span></code> </pre><br>  In the case of using a constructor instead of an <i>Exposable</i> pattern, an attempt to create one of the view models would cause a recursive stack overflow.  Of course, one has to keep in mind the limitation that at the very moment of initialization (execution of the <i>Expose</i> method) it is sometimes unsafe to use another non-initialized view model, but in practice such situations are rare and rather indicate an error in the design of class design. <br><br>  If further inheritance is planned, then the <i>Expose</i> method should be used with the <i>virtual</i> modifier so that it can be overridden in the inherited classes and provide polymorphic behavior. <br><br>  <b>3) Command-Oriented Navigation ( <i>Command-Oriented Navigation</i> )</b> <br><br>  Perhaps this is quite an interesting aspect.  In order to provide the opportunity to reuse the same business logic with the view models in several projects, for example, for different platforms, you need to get rid of any references to <i>UI</i> classes.  But how then to organize a mechanism for choosing a presentation depending on the implementation of certain business rules?  <i>CM-</i> pattern gives its recommendation on this - <i>you need to use the command mechanism, and the type of presentation or uri should be passed as a parameter to the command</i> . <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Localizing GoToPayment}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Context Key=GoTo}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">CommandParameter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{x:Type PaymentView}"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Localizing GoToPayment}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Context Key=GoTo}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">CommandParameter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/Views/PaymentView.xaml"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AnyViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">ContextObject</span></span>, <span class="hljs-title"><span class="hljs-title">IExposable</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Expose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// this[Context.Get("GoTo")].CanExecute += (sender, args) =&gt; args.CanExecute = 'any condition'; this[Context.Get("GoTo")].Executed += (sender, args) =&gt; Navigator.GoTo(args.Parameter); } }</span></span></code> </pre><br>  The <i>Navigator</i> class accepts this parameter and, based on it, navigates to the desired view.  The following representation is easily linked with the necessary context object (I-view model) using the direct injection mechanism; therefore, any need to directly transfer any service parameters during navigation is lost, because any representation can get access to any context object.  The ability to switch to one or another screen is governed by the command <i>CanExecute</i> event. <br><br>  Everything turned out very elegant and simple, nothing superfluous.  However, it can be argued that we have taken the command parameter and cannot pass on anything else.  But again there is a beautiful solution: use the very primitive class <i>Set</i> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Set</span></span> : <span class="hljs-title"><span class="hljs-title">List</span></span>&lt;<span class="hljs-title"><span class="hljs-title">object</span></span>&gt; { }</code> </pre><br>  It allows you to create collections of various elements directly in <i>xaml</i> .  For example, by placing a record in the resources: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Set</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ParameterSet"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system:String</span></span></span><span class="hljs-tag">&gt;</span></span>/Views/AnyView.xaml<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system:String</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system:String</span></span></span><span class="hljs-tag">&gt;</span></span>SecondParaneter<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system:String</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Set</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  You can easily pass several arguments to the command: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Localizing GoToAnyView}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Context Key=GoTo}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">CommandParameter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{StaticResource ParameterSet}"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  <b>4) Dynamic localization ( <i>Dynamic Localizing</i> )</b> <br><br>  Localization is also implemented through the use of binding / markup extensions, which allows for a hot change of language during the operation of the application.  That is, the source of localized strings is the injected context object from which the necessary values ‚Äã‚Äãare extracted by key. <br><br>  For <i>Windows Desktop</i> , the syntax is very simple: <br><br><pre> <code class="cs hljs">Text=<span class="hljs-string"><span class="hljs-string">"{Localizing Name}"</span></span> Text=<span class="hljs-string"><span class="hljs-string">"{Localizing Key=Name}"</span></span></code> </pre><br>  For <i>Windows Phone it is a</i> bit more complicated, but also rather elementary: <br><br><pre> <code class="cs hljs">Text=<span class="hljs-string"><span class="hljs-string">"{m:Localizing Key=Name}"</span></span></code> </pre><br>  In the C # code, you need to install the resource manager at the right time (when loading the application or changing the language): <br><br><pre> <code class="cs hljs">Localizing.DefaultManager.Source = English.ResourceManager;</code> </pre><br>  And you can get a localized string like this: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> localizedValue = Unity.App.Localize(<span class="hljs-string"><span class="hljs-string">"KeyValue"</span></span>);</code> </pre><br><br>  <b>5) <i>Context Commands &amp; Triggers</i> ( <i>Context Commands &amp; Triggers</i> )</b> <br><br>  The classic <i>desktop WPF has</i> elaborated a powerful and convenient concept of routed commands ( <i>Routed Commands</i> ), but on other platforms it is not supported, partly due to technical differences, so the question arose whether it is possible to create something universal, syntactically and ideologically similar, and same time as routable commands. <br><br>  As a result, the idea of <i>contextual commands</i> was born.  As was shown above, it is extremely simple to use it and, moreover, it is perfectly compatible with <i>Routed Commands</i> . <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Localizing GoToPayment}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Context Key=GoTo}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">CommandParameter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/Views/PaymentView.xaml"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Localizing New}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"New"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AnyViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">ContextObject</span></span>, <span class="hljs-title"><span class="hljs-title">IExposable</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Expose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Context Command this[Context.Get("GoTo")].CanExecute += (sender, args) =&gt; args.CanExecute = 'any condition'; this[Context.Get("GoTo")].Executed += (sender, args) =&gt; Navigator.GoTo(args.Parameter); // Routed Command this[ApplicationCommands.New].CanExecute += (sender, args) =&gt; args.CanExecute = 'any condition'; this[ApplicationCommands.New].Executed += (sender, args) =&gt; AddNewDocument(); } }</span></span></code> </pre><br>  The static <i>Context</i> class contains several previously declared command names, and if necessary, you can add your own.  The entries <i>this [Context.Make]</i> and <i>this [Context.Get ("Make")] are</i> equivalent to each other.  It is worth noting that the implementation of contextual commands is safe in terms of memory leaks, since in some situations the command's subscription to the <i>CanExecuteChanged</i> event can keep the interface from garbage collection, which is not immediately obvious. <br><br>  Context commands are not routed through the visual tree, but are executed on the nearest context object, which is set in the <i>DataContext property of</i> the visual element itself or in its ancestors.  But according to the principle of direct injections, the context object can be directly installed in the team mediator itself, which gives great flexibility and versatility. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DataContext</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Store viewModels:FirstViewModel}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Context Key=Make}"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DataContext</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Store viewModels:FirstViewModel}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IsEnabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding CanMake}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Context Key=Make, StoreKey=viewModels:SecondViewModel}"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  In the first case, the Make command will be executed in <i>FirstViewModel</i> , and in the second, in <i>SecondViewModel</i> . <br><br>  It is also necessary to mention the contextual trigger commands.  Often, an action or series of actions must be performed when a certain control event occurs, for example, when a page is loaded, you need to request or update business data.  This functionality is implemented using command triggers, and all event types are supported, not just <i>Routed Events</i> . <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Window</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Attacher.ContextTriggers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Set</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ContextTrigger</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">EventName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Loaded"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Context Refresh, StoreKey=viewModels:AppViewModel}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ContextTrigger</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">EventName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Closing"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">UseEventArgsAsCommandParameter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Context Exit, StoreKey=viewModels:AppViewModel}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Set</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Attacher.ContextTriggers</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Window</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  In this example, it is important to note that the triggers are not descendants of the visual tree, therefore the context object must be injected directly into the command mediator - <i>StoreKey = viewModels: AppViewModel</i> .  It is also possible to pass as an argument parameter the event argument.  Therefore, when closing the window, the <i>Closing</i> event, there is the possibility of canceling the action by setting <i>args.Cancel = true</i> . <br><br>  <b>6) <i>Property Notification &amp; Validation</i></b> <br><br>  To notify the interface and other program objects about changes in properties, there is an INotifyPropertyChanged interface.  Aero Framework provides a number of convenient mechanisms for such purposes.  First, it is necessary to inherit from the ContextObject class, after which the possibility of using a concise and convenient syntax will become available. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LoginViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">ContextObject</span></span>, <span class="hljs-title"><span class="hljs-title">IExposable</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Auto with manual notification public string Name { get { return Get(() =&gt; Name); } set { Set(() =&gt; Name, value); } } // Only manual notification public string Password { get; set; } public virtual void Expose() { this[() =&gt; Name].PropertyChanging += (sender, args) =&gt; { // do anythink }; this[() =&gt; Name].PropertyChanged += (sender, args) =&gt; { // do anythink }; } }</span></span></code> </pre><br>  The first way to declare properties allows you to automatically notify other objects about changes, but it is permissible to make such notification in manual mode using the polymorphic methods <i>RaisePropertyChanging</i> and <i>RaisePropertyChanged</i> , for example: <br><br><pre> <code class="cs hljs">RaisePropertyChanging(() =&gt; Password); RaisePropertyChanged(() =&gt; Password);</code> </pre><br><pre> <code class="cs hljs">RaisePropertyChanging(<span class="hljs-string"><span class="hljs-string">"Name"</span></span>); RaisePropertyChanged(<span class="hljs-string"><span class="hljs-string">"Name"</span></span>);</code> </pre><br>  Writing <i>this [() =&gt; Name] .PropertyChanged</i> avoids cumbersome <i>if-else constructions</i> , and it is also easy to subscribe to changes in properties from the outside in a similar way: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> loginViewModel = Store.Get&lt;LoginViewModel&gt;(); loginViewModel[() =&gt; Name].PropertyChanging += (sender, args) =&gt; { <span class="hljs-comment"><span class="hljs-comment">// do anythink };</span></span></code> </pre><br>  Just remember that subscription to an event keeps a third-party listening object from garbage collection, so you need to unsubscribe from the event in time or use a weak subscription mechanism to avoid memory leaks in some situations. <br><br>  Validation of property values ‚Äã‚Äãalso looks comfortable using this approach and the implementation of the <i>IDataErrorInfo</i> interface. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[() =&gt; Name].Validation += (sender, args) =&gt; Error = Name == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || Name.Length &lt; <span class="hljs-number"><span class="hljs-number">3</span></span> ? Unity.App.Localize(<span class="hljs-string"><span class="hljs-string">"InvalidName"</span></span>) : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[() =&gt; FontSize].Validation += () =&gt; <span class="hljs-number"><span class="hljs-number">4.0</span></span> &lt; FontSize &amp;&amp; FontSize &lt; <span class="hljs-number"><span class="hljs-number">128.0</span></span> ? <span class="hljs-literal"><span class="hljs-literal">null</span></span> : Unity.App.Localize(<span class="hljs-string"><span class="hljs-string">"InvalidFontSize"</span></span>);</code> </pre><br><br>  <b>7) <i>Smart State</i></b> <br><br>  Now we come to a very unusual, but at the same time useful mechanism for maintaining state.  <i>Aero Framework</i> allows you to very elegantly and unmatchedly concisely solve problems of this kind. <br><br>  First, you may have noticed that the view models in the examples are sometimes marked with the <i>DataContract</i> attribute, and some properties with the <i>DataMember attribute</i> , which allows you to use serialization and deserialization mechanisms to preserve and restore the logical state. <br><br>  All you need to do to do this is to initialize the necessary framework during the launch of the application: <br><br><pre> <code class="cs hljs">Unity.AppStorage = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AppStorage(); Unity.App = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AppAssistent();</code> </pre><br>  By default, serialization occurs in files, but you can easily create your own implementation and save serialized objects, for example, to a database.  For this you need to inherit from the <i>Unity.IApplication</i> interface ( <i>AppStorage is</i> implemented by <i>default</i> ).  As for the interface <i>Unity.IApplication</i> ( <i>AppAssistent</i> ), it is necessary for cultural settings during serialization and in most cases it can be limited to its standard implementation. <br><br>  To save the state of any object that supports serialization, simply call the Snapshot attachment method, or use the <i>Store.Snapshot</i> call if the object is in the general container. <br><br>  We have dealt with the preservation of the logical state, but it often becomes necessary to store and visually, for example, the size and position of the windows, the state of the controls and other parameters.  <i>CM-</i> Pattern offers a non-standard, but incredibly convenient solution.  What if you store such parameters in context objects (view models), but not as separate properties for serialization, but implicitly, as a dictionary, where the key is the name of the ‚Äúimaginary‚Äù property? <br><br>  Based on this concept, the idea of <i>smart</i> properties was born.  The value of the <i>smart</i> property must be accessible through the indexer by the key name, as in a dictionary, and the classic get or set are optional and may be missing!  This functionality is implemented in the <i>SmartObject</i> class, from which <i>ContextObject</i> inherits, extending it. <br><br>  Just write in the desktop version: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AppViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">SmartObject</span></span> <span class="hljs-comment"><span class="hljs-comment">// ContextObject {}</span></span></code> </pre><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Window</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Sparrow.Views.AppView"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:viewModels</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clr-namespace:Sparrow.ViewModels"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DataContext</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Store Key=viewModels:AppViewModel}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">WindowStyle</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{ViewModel DefaultValue=SingleBorderWindow}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ResizeMode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding '[ResizeMode, CanResizeWithGrip]', Mode=TwoWay}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding '[Height, 600]', Mode=TwoWay}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{ViewModel DefaultValue=800}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Left</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{ViewModel DefaultValue=NaN}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Top</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding '[Top, NaN]', Mode=TwoWay}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{ViewModel DefaultValue='Sparrow'}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/Sparrow.png"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ShowActivated</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"This"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  after which the size and position of the window will be automatically saved when you exit the application and are exactly restored at startup!  Agree, this is an amazing conciseness for solving this kind of problem.  -  -        . <br><br>    <i>Window Phone</i> ,    -,      ,        <i>smart</i> -     ,  , <i>Indexer</i>      <i>ViewModel</i> .     ,     : <br><pre> <code class="cs hljs">Background=<span class="hljs-string"><span class="hljs-string">"{m:ViewModel Index=UseTable, FinalConverter={StaticResource BackgroundConverter}, Mode=OneWay, StoreKey=viewModels:SettingsViewModel, DefaultValue=True}"</span></span></code> </pre><br><pre> <code class="cs hljs">SelectedIndex=<span class="hljs-string"><span class="hljs-string">"{m:ViewModel Index=SelectedIndex, StoreKey=viewModels:AppViewModel}"</span></span></code> </pre><br><br>  ,              <i>Indexer</i> ,       ,          ,    .         -     ,     ,      .    <i>Aero Framework</i>   ¬´¬ª   .         ,  ,       <i>SelectedIndex</i> . <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TabControl</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TabControl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">MouseMove</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UIElement_OnMouseMove"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ItemsSource</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Documents}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SelectedItem</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Document}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SelectedIndex</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding '[DocumentIndex, 0, True].Value', Mode=TwoWay}"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>       <br><br><pre> <code class="cs hljs">SelectedIndex=<span class="hljs-string"><span class="hljs-string">"{Binding '[DocumentIndex, 0]', Mode=TwoWay}"</span></span></code> </pre><br>       ,       -  <i>Visual Studio</i>    ,   ,  <i>TabControl</i>       ,    <i>¬´Output¬ª Visual Studio</i> .        ,      . <br><br>           <i>IDataErrorInfo</i> ,   ,      -. <br><br>  <b>Results</b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The information presented is already enough to start programming applications that correspond to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CM</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pattern using the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aero Framework</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> library </font><font style="vertical-align: inherit;">. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What else do you need to know? </font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First, it is useful to have an idea of ‚Äã‚Äãthe nuances in the work of various serializers. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Aero Framework</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> uses the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DataContractJsonSerializer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> by default </font><font style="vertical-align: inherit;">, but you can use another one if necessary. </font><font style="vertical-align: inherit;">It is important to remember that this contract serializer does not call a constructor when deserializing an object, and also does not perform initialization of fields by default!</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Incorrect !!! [DataContract] public class AnyViewModel: ContextObject { private AnyType Field1 = new AnyType(); private AnyType Field2; public AnyViewModel() { Field2 = new AnyType(); } }</span></span></code> </pre><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Correct [DataContract] public class AnyViewModel : ContextObject { private AnyType Field1; private AnyType Field2; public AnyViewModel() { Initialize(); } // Called by serializer [OnDeserialized] // [OnDeserializing] public new void Initialize(StreamingContext context = default(StreamingContext)) { Field1 = new AnyType(); Field2 = new AnyType(); } }</span></span></code> </pre><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Correct (recomended) [DataContract] public class AnyViewModel : ContextObject, IExposable { private AnyType Field1; private AnyType Field2; public virtual void Expose() { Field2 = new AnyType(); Field2 = new AnyType(); } }</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> It may also sometimes be necessary to add an unfamiliar serializer to the KnownTypes collection. </font></font><br><pre> <code class="cs hljs">ContractFactory.KnownTypes.Add(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(SolidColorBrush)); <span class="hljs-comment"><span class="hljs-comment">//ContractFactory.KnownTypes.Add(typeof(MatrixTransform)); //ContractFactory.KnownTypes.Add(typeof(Transform)); ContractFactory.KnownTypes.Add(typeof(TextViewModel));</span></span></code> </pre><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Ä¢ Binding Extensions</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> On some implementations of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xaml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> platform, it is possible to create your own markup extensions ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Markup Extensions</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) by inheriting from the class of the same name. However, this possibility is not everywhere. But still, in most cases, inheritance from the Binding class is allowed.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Globalization; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Data; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Aero.Markup.Base</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BindingExtension</span></span> : <span class="hljs-title"><span class="hljs-title">Binding</span></span>, <span class="hljs-title"><span class="hljs-title">IValueConverter</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BindingExtension</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Source = Converter = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BindingExtension</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> source</span></span></span><span class="hljs-function">) </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">// set Source to null for using DataContext { Source = source; Converter = this; } protected BindingExtension(RelativeSource relativeSource) { RelativeSource = relativeSource; Converter = this; } public abstract object Convert(object value, Type targetType, object parameter, CultureInfo culture); public virtual object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture) { throw new NotImplementedException(); } } }</span></span></span></span></code> </pre><br>       <i>MarkupExtension</i> ,         ,      Binding,        . <br><br> <b>‚Ä¢ Bindable Dependency Converters</b> <br><br>    ,     <i>xaml</i> ,   ,    ,   - .       <i>IValueConverter</i>     <i>DependencyObject</i>     <i>DependencyProperty</i> ,        ,       ! ,        -,         ,      . <br><br> ,   ,      ,      <i>StoreBinding</i>  <i>Dependency Converter</i> . <br><br><pre> <code class="cs hljs">&lt;BooleanConverter x:Key=<span class="hljs-string"><span class="hljs-string">"BindableConverter"</span></span> OnTrue=<span class="hljs-string"><span class="hljs-string">"Value1"</span></span> OnFalse=<span class="hljs-string"><span class="hljs-string">"Value2"</span></span> OnNull=<span class="hljs-string"><span class="hljs-string">"{StoreBinding StoreKey=viewModels: SettingsViewModel, Path=AnyValue3Path}"</span></span>/&gt;</code> </pre><br>  <b>Switch converter</b> <br><br>          -       <i>switch</i> .    ,        Switch Converter: <br><br><pre> <code class="cs hljs">&lt;SwitchConverter Default=<span class="hljs-string"><span class="hljs-string">"ResultValue0"</span></span> x:Key=<span class="hljs-string"><span class="hljs-string">"ValueConverter1"</span></span>&gt; &lt;Case Key=<span class="hljs-string"><span class="hljs-string">"KeyValue1"</span></span> Value=<span class="hljs-string"><span class="hljs-string">"ResultValue1"</span></span>/&gt; &lt;Case Key=<span class="hljs-string"><span class="hljs-string">"KeyValue2"</span></span> Value=<span class="hljs-string"><span class="hljs-string">"ResultValue2"</span></span>/&gt; &lt;/SwitchConverter&gt;</code> </pre><br>  Moreover, the properties of this converter (including <i>Case</i> designs) are <i>Dependency</i> , that is, available for binding using <i>StoreBinding</i> !<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">type mode is</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> supported </font><font style="vertical-align: inherit;">when the key is not the object value itself, but the type:</font></font><br><br><pre> <code class="cs hljs">&lt;SwitchConverter TypeMode=<span class="hljs-string"><span class="hljs-string">"True"</span></span> Default=<span class="hljs-string"><span class="hljs-string">"{StaticResource DefaultDataTemplate}"</span></span> x:Key=<span class="hljs-string"><span class="hljs-string">"InfoConverter"</span></span>&gt; &lt;Case Type=<span class="hljs-string"><span class="hljs-string">"local:Person"</span></span> Value=<span class="hljs-string"><span class="hljs-string">"{StaticResource PersonDataTemplate}"</span></span>/&gt; &lt;Case Type=<span class="hljs-string"><span class="hljs-string">"local:PersonGroup"</span></span> Value=<span class="hljs-string"><span class="hljs-string">"{StaticResource PersonGroupDataTemplate}"</span></span>/&gt; &lt;/SwitchConverter&gt;</code> </pre><br>  It turns out that such a converter can easily be used as a <i>DataTemplateSelector</i> even where the latter is not supported!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The versatility of SwitchConverter allows you to cover a huge number of cases, you just need to apply a little imagination to it. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Ä¢ Global Resources</font></font></b> <br><br>  Since I started talking about converters, then it is worth telling how best to organize work with them.  First of all, the most common need to bring in a separate resource dictionary: <br><br><pre> <code class="cs hljs">&lt;!--AppConverters .xaml--&gt; &lt;ResourceDictionary xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span>&gt; &lt;BooleanConverter x:Key=<span class="hljs-string"><span class="hljs-string">"NullToTrueConverter"</span></span> OnNull=<span class="hljs-string"><span class="hljs-string">"True"</span></span> OnNotNull=<span class="hljs-string"><span class="hljs-string">"False"</span></span>/&gt; &lt;BooleanConverter x:Key=<span class="hljs-string"><span class="hljs-string">"NullToFalseConverter"</span></span> OnNull=<span class="hljs-string"><span class="hljs-string">"False"</span></span> OnNotNull=<span class="hljs-string"><span class="hljs-string">"True"</span></span>/&gt; &lt;BooleanConverter x:Key=<span class="hljs-string"><span class="hljs-string">"NullToVisibleConverter"</span></span> OnNull=<span class="hljs-string"><span class="hljs-string">"Visible"</span></span> OnNotNull=<span class="hljs-string"><span class="hljs-string">"Collapsed"</span></span>/&gt; &lt;BooleanConverter x:Key=<span class="hljs-string"><span class="hljs-string">"NullToCollapsedConverter"</span></span> OnNull=<span class="hljs-string"><span class="hljs-string">"Collapsed"</span></span> OnNotNull=<span class="hljs-string"><span class="hljs-string">"Visible"</span></span>/&gt; &lt;BooleanConverter x:Key=<span class="hljs-string"><span class="hljs-string">"TrueToFalseConverter"</span></span> OnTrue=<span class="hljs-string"><span class="hljs-string">"False"</span></span> OnFalse=<span class="hljs-string"><span class="hljs-string">"True"</span></span> OnNull=<span class="hljs-string"><span class="hljs-string">"True"</span></span>/&gt; &lt;BooleanConverter x:Key=<span class="hljs-string"><span class="hljs-string">"FalseToTrueConverter"</span></span> OnTrue=<span class="hljs-string"><span class="hljs-string">"False"</span></span> OnFalse=<span class="hljs-string"><span class="hljs-string">"True"</span></span> OnNull=<span class="hljs-string"><span class="hljs-string">"False"</span></span>/&gt; &lt;BooleanConverter x:Key=<span class="hljs-string"><span class="hljs-string">"TrueToVisibleConverter"</span></span> OnTrue=<span class="hljs-string"><span class="hljs-string">"Visible"</span></span> OnFalse=<span class="hljs-string"><span class="hljs-string">"Collapsed"</span></span> OnNull=<span class="hljs-string"><span class="hljs-string">"Collapsed"</span></span>/&gt; &lt;BooleanConverter x:Key=<span class="hljs-string"><span class="hljs-string">"TrueToCollapsedConverter"</span></span> OnTrue=<span class="hljs-string"><span class="hljs-string">"Collapsed"</span></span> OnFalse=<span class="hljs-string"><span class="hljs-string">"Visible"</span></span> OnNull=<span class="hljs-string"><span class="hljs-string">"Visible"</span></span>/&gt; &lt;BooleanConverter x:Key=<span class="hljs-string"><span class="hljs-string">"FalseToVisibleConverter"</span></span> OnTrue=<span class="hljs-string"><span class="hljs-string">"Collapsed"</span></span> OnFalse=<span class="hljs-string"><span class="hljs-string">"Visible"</span></span> OnNull=<span class="hljs-string"><span class="hljs-string">"Collapsed"</span></span>/&gt; &lt;BooleanConverter x:Key=<span class="hljs-string"><span class="hljs-string">"FalseToCollapsedConverter"</span></span> OnTrue=<span class="hljs-string"><span class="hljs-string">"Visible"</span></span> OnFalse=<span class="hljs-string"><span class="hljs-string">"Collapsed"</span></span> OnNull=<span class="hljs-string"><span class="hljs-string">"Visible"</span></span>/&gt; &lt;EqualsConverter x:Key=<span class="hljs-string"><span class="hljs-string">"EqualsToCollapsedConverter"</span></span> OnEqual=<span class="hljs-string"><span class="hljs-string">"Collapsed"</span></span> OnNotEqual=<span class="hljs-string"><span class="hljs-string">"Visible"</span></span>/&gt; &lt;EqualsConverter x:Key=<span class="hljs-string"><span class="hljs-string">"EqualsToVisibleConverter"</span></span> OnEqual=<span class="hljs-string"><span class="hljs-string">"Visible"</span></span> OnNotEqual=<span class="hljs-string"><span class="hljs-string">"Collapsed"</span></span>/&gt; &lt;EqualsConverter x:Key=<span class="hljs-string"><span class="hljs-string">"EqualsToFalseConverter"</span></span> OnEqual=<span class="hljs-string"><span class="hljs-string">"False"</span></span> OnNotEqual=<span class="hljs-string"><span class="hljs-string">"True"</span></span>/&gt; &lt;EqualsConverter x:Key=<span class="hljs-string"><span class="hljs-string">"EqualsToTrueConverter"</span></span> OnEqual=<span class="hljs-string"><span class="hljs-string">"True"</span></span> OnNotEqual=<span class="hljs-string"><span class="hljs-string">"False"</span></span>/&gt; &lt;AnyConverter x:Key=<span class="hljs-string"><span class="hljs-string">"AnyToCollapsedConverter"</span></span> OnAny=<span class="hljs-string"><span class="hljs-string">"Collapsed"</span></span> OnNotAny=<span class="hljs-string"><span class="hljs-string">"Vsible"</span></span>/&gt; &lt;AnyConverter x:Key=<span class="hljs-string"><span class="hljs-string">"AnyToVisibleConverter"</span></span> OnAny=<span class="hljs-string"><span class="hljs-string">"Visible"</span></span> OnNotAny=<span class="hljs-string"><span class="hljs-string">"Collapsed"</span></span>/&gt; &lt;AnyConverter x:Key=<span class="hljs-string"><span class="hljs-string">"AnyToFalseConverter"</span></span> OnAny=<span class="hljs-string"><span class="hljs-string">"False"</span></span> OnNotAny=<span class="hljs-string"><span class="hljs-string">"True"</span></span>/&gt; &lt;AnyConverter x:Key=<span class="hljs-string"><span class="hljs-string">"AnyToTrueConverter"</span></span> OnAny=<span class="hljs-string"><span class="hljs-string">"True"</span></span> OnNotAny=<span class="hljs-string"><span class="hljs-string">"False"</span></span>/&gt; &lt;/ResourceDictionary&gt;</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After that, you must directly or indirectly merge this dictionary with resources in App.xaml, which will allow you to use the basic converters in almost any </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xaml-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> files of the application without additional actions.</font></font> It is useful to make such an addition to the global resources of an application for any more or less common things: colors, brushes, patterns and styles ‚Äî which makes it very easy to implement, for example, the theme change mechanisms in the application. <br><br><pre> <code class="cs hljs">&lt;Application x:Class=<span class="hljs-string"><span class="hljs-string">"Sparrow.App"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> StartupUri=<span class="hljs-string"><span class="hljs-string">"Views/AppView.xaml"</span></span>&gt; &lt;Application.Resources&gt; &lt;ResourceDictionary&gt; &lt;ResourceDictionary.MergedDictionaries&gt; &lt;!--&lt;ResourceDictionary Source=<span class="hljs-string"><span class="hljs-string">"AppConverters.xaml"</span></span>/&gt;--&gt; &lt;ResourceDictionary Source=<span class="hljs-string"><span class="hljs-string">"AppStore.xaml"</span></span>/&gt; &lt;/ResourceDictionary.MergedDictionaries&gt; &lt;/ResourceDictionary&gt; &lt;/Application.Resources&gt; &lt;/Application&gt;</code> </pre><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Ä¢ Sets</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As mentioned earlier, it may be useful to use the </font><font style="vertical-align: inherit;">universal </font><i><font style="vertical-align: inherit;">Set</font></i><font style="vertical-align: inherit;"> collection </font><font style="vertical-align: inherit;">in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xaml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which is applicable in many cases. </font><font style="vertical-align: inherit;">Sometimes it allows you to avoid "multi-storey structures", make general points and make the code more accurate.</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br><br><pre> <code class="cs hljs">&lt;Set x:Key=<span class="hljs-string"><span class="hljs-string">"EditMenuSet"</span></span> x:Shared=<span class="hljs-string"><span class="hljs-string">"False"</span></span>&gt; &lt;MenuItem Header=<span class="hljs-string"><span class="hljs-string">"{Localizing Undo}"</span></span> Command=<span class="hljs-string"><span class="hljs-string">"Undo"</span></span>/&gt; &lt;MenuItem Header=<span class="hljs-string"><span class="hljs-string">"{Localizing Redo}"</span></span> Command=<span class="hljs-string"><span class="hljs-string">"Redo"</span></span>/&gt; &lt;Separator/&gt; &lt;MenuItem Header=<span class="hljs-string"><span class="hljs-string">"{Localizing Cut}"</span></span> Command=<span class="hljs-string"><span class="hljs-string">"Cut"</span></span>/&gt; &lt;MenuItem Header=<span class="hljs-string"><span class="hljs-string">"{Localizing Copy}"</span></span> Command=<span class="hljs-string"><span class="hljs-string">"Copy"</span></span>/&gt; &lt;MenuItem Header=<span class="hljs-string"><span class="hljs-string">"{Localizing Paste}"</span></span> Command=<span class="hljs-string"><span class="hljs-string">"Paste"</span></span>/&gt; &lt;MenuItem Header=<span class="hljs-string"><span class="hljs-string">"{Localizing Delete}"</span></span> Command=<span class="hljs-string"><span class="hljs-string">"Delete"</span></span>/&gt; &lt;Separator/&gt; &lt;MenuItem Header=<span class="hljs-string"><span class="hljs-string">"{Localizing SelectAll}"</span></span> Command=<span class="hljs-string"><span class="hljs-string">"SelectAll"</span></span>/&gt; &lt;/Set&gt; &lt;MenuItem Header=<span class="hljs-string"><span class="hljs-string">"{Localizing Edit}"</span></span> ItemsSource=<span class="hljs-string"><span class="hljs-string">"{StaticResource EditMenuSet}"</span></span>/&gt;</code> </pre><br><br> <b> ?</b> <br><br>  ‚Ä¶   ‚Äî   ,  . ,   ! <br><br> PS         ,      ,      " <a href="http://habrahabr.ru/post/250135/"></a> ". </div><p>Source: <a href="https://habr.com/ru/post/251347/">https://habr.com/ru/post/251347/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../251335/index.html">Interactive map of the shopping center on HTML5 canvas</a></li>
<li><a href="../251337/index.html">Architectural design of mobile applications: part 2</a></li>
<li><a href="../251339/index.html">Automatically Testing Java Swing Applications</a></li>
<li><a href="../251341/index.html">Whip and ... whip information security in the enterprise</a></li>
<li><a href="../251345/index.html">Pebble Time: a new watch with a color screen</a></li>
<li><a href="../251349/index.html">Processing logs based on previous messages in logstash / elasticsearch</a></li>
<li><a href="../251351/index.html">CoinFest-2015-Moscow</a></li>
<li><a href="../251353/index.html">We write a bot for MMORPG with assembler and draenei. Part 3</a></li>
<li><a href="../251355/index.html">Several subtleties of using jade in Meteor-projects</a></li>
<li><a href="../251357/index.html">Data exchange using MPI. Working with the MPI Library on the example of the Intel¬Æ MPI Library</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>