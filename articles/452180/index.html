<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Raise the performance of SSD from the knees, where to click and why</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In fact, today we will not only talk about drives that have been in use for any time, because the problem of poor performance can affect even the SSD ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Raise the performance of SSD from the knees, where to click and why</h1><div class="post__text post__text-html js-mediator-article">  In fact, today we will not only talk about drives that have been in use for any time, because the problem of poor performance can affect even the SSD just brought from the store.  Of course, physics cannot be fooled - over time all SSDs will lose performance.  But the reason for this may be not only the problem of the SSD itself.  Ensuring competent interaction of components and software in the system is not an easy task for ordinary users who do not want (or who simply don‚Äôt need to) understand the topic at least a little and listen to the advice of competent people.  It is easier for someone to reinstall the operating system or add some questionable tweakers to the list of applications used.  But think about it - for example, simple from our point of view, file deletion consists of a fairly large number of stages in which several participants are tied at once.  And, if at least one of them completed the task incorrectly, then this affects the performance of the disk.  What are these stages?  Who or what they are performed?  How to ensure stable operation?  In all of this we will understand today.  Simply and clearly, so that everything is clear.  And then it will become clear that treating the symptoms of poor SSD performance will not help. <br><img src="https://habrastorage.org/webt/tc/sd/c2/tcsdc2pur0tu5okr7lfszqt49vo.jpeg"><br><a name="habracut"></a><br><h2>  Seven troubles - one Deallocate </h2><br>  Many have heard about the team TRIM.  Those are the most cherished four letters that cause many questions to the average user.  TRIM is one of the ATA commands sent by the operating system to notify the SSD that the data has been deleted from the user by the user and that the occupied physical cells can be freed.  It should be said separately about the NVMe SSD - these disks have a different set of commands for operation, but there is also an analogue of the TRIM ATA command - it is called Deallocate and, accordingly, is identical.  Therefore, when we mention TRIM, we will also mean Deallocate too.  What is this all about?  It is precisely the problems with the execution of these commands in the overwhelming majority of cases that cause the poor performance of the drives.  Of course, we will not leave other problems aside, but everything has its time. <br><br><img src="https://habrastorage.org/webt/tq/ce/rp/tqcerpp13cozhrj0jgkmxzwz1gq.jpeg"><br><br>  At the moment when you delete data from your drive, in fact, an entry in the main file system table is deleted.  That is, the data itself remains in place, but the area is marked for deletion.  The ‚Äúcell clearing‚Äù itself occurs at a certain time, for example, when the store is idle while you are away for tea.  Thus, manufacturers seek to reduce memory wear and increase the performance of their drives in certain scenarios.  It is the cleaning of these cells that the controller deals with by executing the TRIM command.  By the way, after its execution, data recovery is almost impossible. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      More recently, we <a href="https://habr.com/ru/company/kingston_technology/blog/448624/">talked about the Secure Erase technology</a> , which is similar to TRIM, but affects not only the main cells, but also service areas, returning the drive to its original state.  Recall that Secure Erase can be performed on the drive only without a file system and under certain conditions.  A technology TRIM just requires an operating system with all the resulting requirements. <br><img src="https://habrastorage.org/webt/3-/_d/dg/3-_ddgsjzma7zuwofwj8xszcs7e.jpeg"><br><br><h2>  We explain on the fingers, just their 20 ... </h2><br>  When you create a file, the operating system sends a write command to the address of a specific logic block.  When you delete data from a disk, these blocks are marked free. <br>  In this case, the data will remain on the disk until the controller wants to overwrite them. <br><br>  Before us is the part of the memory in which the files A and B are of different sizes, occupying, respectively, a different number of blocks.  First we delete the file B, and then we write the file C to our disk.  To visualize the situation when TRIM is not working, we will add a simple illustration in which the following states are indicated: <br><br><ol><li>  Availability of files A and B. </li><li>  Deletion of file B with our hands. </li><li>  Certain idle time.  Note that the data blocks marked for clearing have remained with the data in them. </li><li>  Write file C, but first remove file B from cells. </li></ol><br>  For example, if you imagine (just imagine, yes) that a block of data in the form of a square is 1 MB, then in step 4, the controller first clears the two blocks of data marked for deletion with file B and only then writes file C. If a couple of megabytes of space more trifles, but with the active work with the accumulator of such blocks in the total there can be gigabytes, which already noticeably affects the time of writing operations. <br><br><img src="https://habrastorage.org/webt/7u/3o/u3/7u3ou3k6c2lp9xzdulbg7i9w_-u.png"><br><br>  And now what happens if the TRIM works.  Again in stages: <br><br><ol><li>  Availability of files A and B. </li><li>  Deletion of file B with our hands. </li><li>  Certain idle time in which blocks marked for deletion with a file B are cleared. </li><li>  Write file C without any delay to the area where file B was. </li></ol><br><img src="https://habrastorage.org/webt/0k/db/r7/0kdbr7iwlk4zabsabg90noydpxs.png"><br><br>  That is, the logic of the work is completely different.  Repeat the traversal - when we delete the file B, the TRIM command is sent, and since the SSD is often idle, he happily deletes unnecessary blocks almost immediately.  And the moment we want to write the file C, it is immediately written to the disk, and does not wait until the blocks with garbage are cleared for it. <br><br><h2>  TRIM, are there any?  And, if so, do you work? </h2><br>  You can find out whether the SSD supports the TRIM command with a sufficiently large number of free software.  Take, for example, CrystalDiskInfo: <br><br><img src="https://habrastorage.org/webt/pv/iv/dl/pvivdlbxu3-w8w2fggfhzrmgfba.png"><br><br>  But a demonstration of support is not work.  To begin with, let's go through situations where TRIM needs to be run in a tricky way or this command does not work at all.  Of course, over time, the situation may change, but for now things are as follows: <br><br><ol><li>  Standard Windows drivers cannot perform TRIM on RAID arrays.  Depending on the system and the type of RAID array, an Intel driver called Rapid Storage may solve the problem.  Arrays 0 and 1 are supported with the Enterprise version driver. </li><li>  Support for TRIM in Windows begins with the version of the operating system with the number 7. Vista and, moreover, XP does not support TRIM at the OS level.  Of course, this problem is solved by third-party software, but everything is at your own risk and risk - we cannot and will not recommend it. </li><li>  The Deallocate command (TRIM for NVMe SSD) is supported only with Windows 8 and later. </li><li>  TRIM does not work on virtual disks. </li><li>  TRIM only works in AHCI mode. </li><li>  TRIM does not work when connecting a drive via USB adapters. </li><li>  TRIM does not work in with the FAT32 file system (and more ‚Äúshaggy‚Äù). </li></ol><br>  <b>Now let's check - does TRIM work in the system?</b> <br><br>  First of all, let's try to find out right from the operating system.  In the command line or PowerShell launched on behalf of the Administrator, enter the command ‚Äúfsutil behavior query disabledeletenotify‚Äù without quotes and look at the result.  If the output shows "0", then this is good - TRIM works.  If "1", then the TRIM functionality is not available.  That's right: zero is the included command, 1 is the disabled command. <br><br><img src="https://habrastorage.org/webt/1g/gm/5q/1ggm5qu0emifcchod_oznrdqijc.png"><br><br>  For example, you can use the easy-to-use trimcheck program from Vladimir Panteleev.  The program works in two stages, between which it can take several seconds or tens of minutes - it all depends on the specifics of the specific SSD model.  The utility writes data to a disk and marks the addresses of virtual blocks in which they are located.  She saves these addresses to a JSON file in her folder, and then deletes the data, which causes sending a TRIM command.  The utility checks whether the previously recorded data is located at the saved addresses.  Their absence means that the controller took TRIM commands into account and deleted the data.  If TRIM is working, the message will be appropriate: <br><br><img src="https://habrastorage.org/webt/7q/km/gi/7qkmgipqp-082lqm74pqjbfao9q.png"><br><br>  Otherwise, the inscription will read <b>NOT WORKING</b> .  Actually, if you received a message about inoperability, then run the command line "fsutil behavior set disabledeletenotify 0" without quotes in the command line or PowerShell running as Administrator.  The TRIM function, if all conditions are met (supported by the OS, implementation in the SSD, etc.), should turn on and work.  If this does not happen, and all the requirements are met, then you will have to think about replacing the drive. <br><br>  <b>Problems, problems instead of lunch</b> <br><br>  The most common problem is inheritance.  Of course, we are talking about Windows up to version 8. For example, when a user installs SSDs in old systems or goes from HDD to SSD without changing BIOS settings (if necessary) or by cloning partitions or the entire disk in general.  We remind you that TRIM is available only in AHCI mode.  For example, many motherboards can operate in two modes: AHCI and IDE.  Accordingly, if the SSD is connected to such a board in IDE mode, then TRIM will not work.  Just having the AHCI mode does not solve the problem - Windows will install the drivers according to the chosen IDE.  It would seem that the situation may rarely occur, but in fact - no.  If you are not on friendly terms with the BIOS settings, then at least you need to check the operation mode.  You can do this in the device manager in the ‚ÄúIDE ATA / ATAPI Controllers‚Äù section: <br><br><img src="https://habrastorage.org/webt/9e/h-/l2/9eh-l2tya3vwx2nembzthxh4dns.png"><br><br>  Remember that just after installing Windows, switching the operation mode from IDE to AHCI (and vice versa) without additional manipulations will not work - the operating system simply will not boot.  Solutions to this problem exist (even from Microsoft itself), but they are not worth recommending.  You need to change the registry settings, add the driver you need, and be ready to reinstall the OS in case of failure. <br><br>  As for Linux-systems, the prerequisite, in addition to the hardware component, is the ext4 file system.  The inclusion of TRIM is indicated by the discard option in the fstab file.  Additional useful options for the section will be noatime (realtime or nodiratime), which will reduce the recording by disabling the update of the last access time to files and directories.  The very same TRIM command is launched using the fstrim program - ‚Äúfstrim / -v‚Äù without quotes and with root rights. <br><br>  Recall more about Secure Erase.  You can restore performance with this feature.  Only here is unlikely for a long time.  Especially if you quickly hammer your drive with new data.  So as a temporary solution - it will go, but it will always remain temporary. <br><br>  We‚Äôll also add about SLC caching, which is quite often used in many SSD drives without being tied to an interface.  Slow recording speed of a large number of files (or large files) after a certain threshold is not a problem, but a feature of the work.  The essence of caching is that the first recorded data fall into a special area of ‚Äã‚Äãmemory, and only then written to main memory in the background.  When the allocated high-speed memory ends, the data begins to be written directly to the memory at a noticeably reduced speed - from 50 to 150 MB / s.  This is a completely normal mode of operation of drives with SLC-cache, so nothing can be done here from the word at all. <br><br><img src="https://habrastorage.org/webt/cp/aa/5j/cpaa5jq3jtwxhvjkba4oyhmv10e.jpeg"><br><br><h2>  What is good and what is bad? </h2><br>  If the TRIM function worked from the very beginning, then it cannot go anywhere by itself.  But it is quite another thing if you are fond of various kinds of tweakers, third-party drivers or firmware, as well as builds of operating systems, supposedly improved.  All these programs and assemblies can only harm, if we are talking about Windows 8 and, especially Windows 10 - in these OS everything is thought out as it should.  In the G7, they can help with something, but this is rather an exception to the multitude of problems that they can bring. <br><br>  Separately, I must say a few words about NVMe drives and drivers for them.  When acquiring a high-speed SSD, the declared speed indicators received in the benchmarks should be reflected in your eyes.  Often this is the case, for example - with Kingston drives.  Set and forget, as they say, enjoying its high speeds.  But with other manufacturers' SSDs, this may not always be the case, which will obviously upset anyone.  There is no longer the lack of Deallocate is the cause of insufficient performance, and the standard NVMe driver.  Yes, yes, when purchasing NVMe SSD from some manufacturers, you have to go to its website and download the corresponding driver - the difference with the standard one can exceed twice! <br><br><h2>  Now, like, everything. </h2><br>  As it turned out, not everything is as scary as no first glance looked.  The user is required to follow only a few recommendations so that the system works correctly and has pleased the performance of the solid-state drive for a long time.  Finally, we will repeat them - a clean distribution of the operating system, current drivers and firmware from the manufacturer, as well as the absence of third-party ‚Äútuners‚Äù of the system, which, according to their developers, increase productivity by 146%.  If the problem is not hardware, then you will not have any complaints about the disk during the entire lifetime of your system.  So there will be no long conclusion-verbiage - everything that had to be said has already been said.  Capable of you SSD, their high speeds and stable operation! <br><br><img src="https://habrastorage.org/webt/tm/9l/t7/tm9lt7ldeox8efnddyomwl0mxrg.jpeg"><br><br>  For more information about <a href="https://bit.ly/2mdGrDZ">HyperX</a> and <a href="https://www.kingston.com/">Kingston</a> products, please visit the company websites. </div><p>Source: <a href="https://habr.com/ru/post/452180/">https://habr.com/ru/post/452180/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../452162/index.html">Bot for VK in Python with MySQL in an hour, part 1</a></li>
<li><a href="../452164/index.html">ModLook - register scanner ModBus. We celebrate the 20th anniversary of the program</a></li>
<li><a href="../452172/index.html">Complex systems. Critical level</a></li>
<li><a href="../452174/index.html">He does not give you a rook</a></li>
<li><a href="../452178/index.html">Parsing: 23 common mistakes in writing English and how to avoid them</a></li>
<li><a href="../452182/index.html">Employee survey. Main mistake</a></li>
<li><a href="../452184/index.html">On anonymity in account-based blockchains</a></li>
<li><a href="../452186/index.html">The rarest and most expensive programming languages</a></li>
<li><a href="../452188/index.html">Unit Testing Json Serialization in Spring Boot</a></li>
<li><a href="../45219/index.html">Serial, however</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>