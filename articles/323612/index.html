<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The story of how we translated the project into almost a quarter of a million lines in TypeScript and survived</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In 2016, statically typed javascript proved to be extremely popular. Many companies have taken advantage of these or other means to eliminate the draw...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The story of how we translated the project into almost a quarter of a million lines in TypeScript and survived</h1><div class="post__text post__text-html js-mediator-article">  In 2016, statically typed javascript proved to be extremely popular.  Many companies have taken advantage of these or other means to eliminate the drawbacks of the dynamic nature of JS.  <a href="http://coherent-labs.com/">We were</a> also attracted by the prospect of using the huge potential of static typing in our developments. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d17/178/cbb/d17178cbb19fca7113e21497ee62bc6a.png"></div><br>  Choosing the tools, we first stopped on TypeScript and Flow.  Although these projects are different, they are aimed at solving the same problem.  Namely, allowing you to control data types, they provide more advanced, in comparison with pure JS, code organization, improve refactoring capabilities, allow programmers to work faster and more confidently. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Coherent Labs and TypeScript</font> </h2><br>  We started looking at typed JS last year, when the project I'm working on now, a <a href="http://editor.coherent-labs.com/">visual editor of</a> user interfaces for HTML games, written mostly in JavaScript, has grown to more than 100 thousand lines of code.  The editor is equipped with a lot of features, as a result, its code base has become more difficult to maintain and refactor.  That is why we decided to do some research and find a solution for the problem we face. <br><br>  After a while we came to two options - TypeScript and Flow.  Both promised to give us static types for better control of the code, but that alone was not enough.  We wanted to use the full power of ES6 and future versions of the language.  Flow, in essence, is a static code analyzer, which means that we would have to use a transpiler for all our ES6 code, but using TypeScript, which is an add-on to JavaScript, we would get both static types and support for most of the latest ECMAScript features. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Given the above, it was easy to make a final decision.  We settled on TypeScript. <br><br><h2>  <font color="#3AC1EF">About the popularity of statically typed javascript</font> </h2><br>  Let's get a little distracted and talk about what static typing is and how it found its place in the dynamic world of JavaScript. <br><br>  The main difference between statically typed and dynamically typed languages ‚Äã‚Äãis how they perform data type checking.  The former do this at compile time, and the latter at runtime.  In other words, statically typed languages ‚Äã‚Äãrequire the programmer to declare data types before using them, while in dynamically typed languages ‚Äã‚Äãthis is not necessary. <br><br>  JavaScript, being a dynamically typed language, allows different types of data to be used in various operations.  For developers who came to JS from statically typed languages, like Java or C ++, this, in most cases, looks completely illogical and even strange.  This leads to serious trouble in large-scale projects.  For example, a programmer may need to spend many hours only to find out why suddenly some variable turned out to be NaN. <br><br>  TypeScript and Flow were created to solve such problems.  Flow, which has gained popularity in the past two years and is focused only on type checking, is supported by Facebook.  TypeScript, on which Microsoft had a hand, on the other hand, is an add-in over JavaScript.  This means that it not only supports type checking, but also allows you to work with the future capabilities of ES6 and ES7.  Both, and the other, have compilers that convert the code into pure JavaScript, which can be run in any browser. <br><br>  Here are some advantages of using typed javascript: <br><br><ul><li>  It allows you to improve the readability of the code. </li><li>  It contributes to the early detection of errors. </li><li>  It provides opportunities for more reliable refactoring. </li><li>  It improves language support at the IDE level. </li></ul><br>  When deciding whether to develop projects using typed JavaScript, ask yourself the following questions: <br><br><ul><li>  Is the project significant for your business? </li><li>  Does the project consist of many complex parts? </li><li>  Is it likely that you will refactor the project in order to better fit your needs? </li><li>  Do you have a large team in which developers need to minimize the time spent on learning the code base and maintaining their own knowledge of it up to date? <br></li></ul><br>  If the majority of answers to these questions are positive, then you should consider the possibility of transferring the project to TypeScript or Flow. <br><br><h2>  <font color="#3AC1EF">The eternal battle of the titans: TypeScript and Flow</font> </h2><br>  As already mentioned, both Flow and TypeScript give the JS developer a very important, and, in my opinion, very necessary opportunity - a type system. <br><br>  <a href="http://www.typescriptlang.org/">TypeScript</a> appeared in 2012, with the assistance of Microsoft, when Anders Hejlsberg released his first release.  Among other things, it supports optional type annotations and features of ES6 and ES7.  It has a compiler that processes annotations and generates code in regular JavaScript. <br><br>  <a href="https://flowtype.org/">Flow</a> is a static code analyzer that Facebook does.  It is designed to quickly find errors in JavaScript applications.  This is not a compiler, but an analyzer.  It can work at all without any type annotations, perfectly revealing itself in the task of printing types of variables. <br><br>  Take a look at a simple example.  There is the following function, which, taking the name, returns the greeting: <br><br><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">greet</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">) </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">`Hello, </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${name}</span></span></span><span class="hljs-string">!`</span></span>; }</code> </pre> <br>  And using TypeScript, and using Flow, this function will look something like this: <br><br><pre> <code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">greet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name: string</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">`Hello, </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${name}</span></span></span><span class="hljs-string">!`</span></span>; }</code> </pre> <br>  A ‚ÄúString‚Äù after a function parameter is a way to specify a type in TypeScript and Flow.  Types can be both simple and composite.  This means that if we try to use an argument whose type is different from the specified one, an error message will be displayed.  Consider an example of using a function. <br><br><pre> <code class="hljs delphi"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">message</span></span> = greet(<span class="hljs-number"><span class="hljs-number">43</span></span>);</code> </pre> <br>  We called the function by passing a number to it as an argument.  When compiling code, TypeScript will display a message that an error has occurred: <br><br><pre> <code class="hljs vhdl">Argument <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'number</span></span>' <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> assignable <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'string</span></span>.'</code> </pre> <br>  Catching such errors during compilation can have a very positive impact on productivity and even on the mood of the developer.  TypeScript also supports modern JS features such as switch functions, import and export, generators, async / await mechanisms, classes, and so on.  In the end, it turns out that TypeScript allows you to create an excellent ecosystem of developing applications in JavaScript. <br><br>  So now let me tell you how we translated a project containing more than 200 thousand lines of code into TypeScript. <br><br><h2>  <font color="#3AC1EF">Step one - the choice of technology</font> </h2><br>  Our project was rapidly developing, over time the volume of the code base increased almost exponentially.  In those days, TypeScript and statically typed JavaScript grew in popularity.  In all this we saw an opportunity that we should not have missed.  After some research and a couple of meetings, we stopped on two possible hikes: <br><br><ul><li>  Use Flow and Babel for ES6 Transpilation. </li><li>  Use TypeScript and its compiler for ES6 / ES7 compilation. </li></ul><br>  We chose TypeScript for several reasons: <br><br><ul><li>  In those days, TypeScript had a wider community, with more material on it. </li><li>  We did not want to complicate the process of building an application, which was already quite heavy.  Adding two more steps when using Flow (compiling Flow and Babel transpiling) would slow down the work even more.  TypeScript allowed us to manage with one additional assembly step, which seemed to us quite acceptable. </li><li>  TypeScript better support integrated development environments.  Our entire team uses WebStorm, which provides excellent TypeScript support. </li><li>  ES5 support.  The core of our system is built on WebKit and JavaScriptCore, taking into account certain limitations.  Some of the standard features of ES5 are not supported.  As a result, TypeScript features played a leading role in making the final decision. </li></ul><br>  After six months of work, I can frankly say that choosing the TypeScript was the right decision.  Not everything went smoothly during the project transfer process, but we didn‚Äôt face anything too complicated. <br><br><h2>  <font color="#3AC1EF">Step Two - Start</font> </h2><br>  After a long discussion of the transition process, in which the whole team participated, we decided to start with a small module and rewrite it.  The very beginning is the replacement of file extensions from .js to .ts. <br><br>  Next was the configuration of the assembly tool (Grunt) using <a href="https://github.com/TypeStrong/grunt-ts">grunt-ts</a> , and, after a day and a half, the first TypeScript module was ready.  The main difficulty was working with global and external modules.  TypeScript has strict rules regarding typing.  As a result, the TypeScript compiler does not recognize helper libraries, like jQuery and Kendo UI, and their methods.  This immediately gave more than 200 compilation errors, indicating that TypeScript could not find a variable of type ‚Äú$‚Äù.  The solution was quite simple - we used the <code>declare</code> instructions: <br><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> $; <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> kendo; ...</code> </pre> <br>  The <code>declare</code> keyword is used to create so-called surrounding ads.  They are used to provide TypeScript information about other libraries, data types, the source of which is not a TS file.  In that situation, this turned out to be a perfectly acceptable solution. <br>  At this stage, we successfully transferred the first module to TypeScript and were ready to go into work with the head, translating the entire project to TypeScript. <br><br><h2>  <font color="#3AC1EF">Step Three - Transition</font> </h2><br>  The next step was to transfer all other modules to TypeScript.  Some of them were strongly interconnected and it was necessary to think of a way to quickly make them workable.  After some additional research and a couple of hours of brainstorming, we came up with a relatively simple strategy. <br><br>  To begin with, we renamed all the files, giving them the .ts extension, and immediately ran into a squall of compilation errors.  Then we added the necessary TypeScript declarations and assigned the data type <code>Any</code> some variables.  This allows you to write to the variable data of various types.  In this way, variables were declared that can store data of different types, say, strings, numbers, logical values. <br><br>  After a two-day fight with types and declarations, we reached the first complete compilation of TypeScript.  However, there was still a lot of work to do.  It was necessary to improve the type checking, add the appropriate declarations for external libraries, and rework the ES5 code to ES6 standards. <br><br>  The declaration file describes the library device.  Using them (they are also called .d.ts files), you can avoid the misuse of libraries and get conveniences like autocompletion of commands in the code editor.  When working with TypeScript 1.8, in order to add a new ad file, you need to install separate npm packages globally, find ad files for a specific library, and save all library description files in the ‚Äútypings‚Äù folder.  Honestly, the decision was not the most elegant.  TypeScript 2.0 has a new way to manage library declarations ‚Äî using the npm registry.  This is all done now with a couple of commands.  First, the installation: <br><br><pre> <code class="hljs sql">npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> <span class="hljs-comment"><span class="hljs-comment">--save @types/jquery</span></span></code> </pre> <br>  Then - import where it is needed: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $ <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'jquery'</span></span></code> </pre> <br>  As a result, there is no more boring mess with files and folders. <br>  So, we dealt with external libraries.  The next step was to change all ads of the type <code>Any</code> to the appropriate data types.  This task took several days.  We decided not to hurry and process the code step by step.  In particular, they refactored under ES6 and changed types.  After a couple of weeks, we transferred 80% of the code incrementally to ES6, providing it with meaningful type annotations.  At this stage it was possible to move on to the next stage of work - testing. <br><br><h2>  <font color="#3AC1EF">Testing and TypeScript</font> </h2><br>  Our development environment was close to ideal and we were ready for the next big stage of the project work - end-to-end (E2E) testing.  We decided to use javascript tools.  Our arsenal is Mocha, Chai, Selenium and WebDriver Selenium.  We isolated the testing code ‚Äî the Selenium framework, tests, and all dependencies, providing them with a separate tsconfig.json. <br><br>  The presence of the tsconfig.json file in the directory indicates that the directory is the root of the TypeScript project.  This file specifies the root files and compiler options. <br><br>  We had to create one such file for the project itself and refactor the Grunt task in order to correctly use different configuration files.  Now we were ready to start working with the Selenium framework. <br><br>  The framework structure consists of seven core and five auxiliary modules.  Here are the main modules: <br><br><ul><li>  A driver handler that starts and stops Selenium and controls timeouts. <br></li><li>  A selector module containing all the elements that are used in the tests. </li><li>  The main action file, which is responsible for organizing work with various parts of the application and performing interactions with it, such as mouse clicks, selection of elements, data entry. </li><li>  Module to export and delete resources. </li><li>  Logging module. </li><li>  A screen copy module that takes a screenshot after each failed test. <br></li><li>  Module to simulate the API backend. </li></ul><br>  Auxiliary modules are divided into categories of tests.  So, we had a JavaScript execution module, a properties panel module, a timeline module module, and so on.  They all have methods for performing specific tasks. <br><br>  In addition, we added a report creation tool - <a href="https://github.com/adamgruber/mochawesome">mochawesome</a> , which output a full report on all tests after they are completed. <br><br>  Thanks to TypeScript, the project managed to use the capabilities of <a href="https://basarat.gitbooks.io/typescript/content/docs/async-await.html">async / await</a> , as a result, we came to cleaner and better organized code. <br><br><h2>  <font color="#3AC1EF">Future plans</font> </h2><br>  In fact, what I told you is just the beginning.  Switching to TypeScript is just a drop in the ocean.  We still have a lot to do.  Here are some of our plans: <br><br><ul><li>  Refactor the entire project architecture. </li><li>  Add new features, such as 3D selection and bounding boxes, visual pointers for data binding, and much more. </li><li>  Improve overall test execution time.  Now it takes about 30 minutes to complete 440 tests. </li></ul><br>  In addition, we are experimenting with libraries that support working with a virtual DOM, like React and InfernoJS.  Both that and another perfectly support TypeScript, the project can greatly benefit from the performance gains that work with the virtual DOM gives. <br>  We are closely following the development of TypeScript.  The latest releases introduce new features, such as type mapping, spread and rest operators for working with objects, supporting asynchronous functions when compiling in ES3 and ES5.  Future releases are expected to support generators for ES3 / ES5, improved means of generalized programming, asynchronous iterators. <br><br><h2>  <font color="#3AC1EF">Results</font> </h2><br>  The decision to use TypeScript in our project turned out to be correct, it brought a lot of good.  In particular, it is an increase in labor productivity, improvement in code controllability, support for ES6.  Initially, I was suspicious of TypeScript, but after working with him I can say that he is what I missed for a very long time. <br><br>  Although I highly recommend trying TypeScript, experimenting, you, thinking about translating your own project to TypeScript, should take into account all the details.  It is necessary to take into account the time required for processing the code base, the project features, the possible need for refactoring, and, most importantly, the opinion of the design team on TypeScript. <br><br>  In summary, I want to say that TypeScript can certainly be considered a significant phenomenon, the impact of which on the JavaScript world will make it better. <br><br>  Dear developers!  And how do you feel about static typing in JavaScript?  If you decide to recycle a large JS project, what would you choose? </div><p>Source: <a href="https://habr.com/ru/post/323612/">https://habr.com/ru/post/323612/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323600/index.html">+500 free tools to launch your startup in 2017</a></li>
<li><a href="../323602/index.html">Sticky Attacks: when key sticking helps hackers</a></li>
<li><a href="../323604/index.html">Magento BarCamp - the new season of reports. March 2017</a></li>
<li><a href="../323606/index.html">Check Point. What is it, what is it eaten with or briefly about the main thing</a></li>
<li><a href="../323608/index.html">Transition from DateTime to DateTimeOffset</a></li>
<li><a href="../323614/index.html">Pygest # 5. Releases, articles, interesting projects from the world of Python [February 28, 2017 - March 13, 2017]</a></li>
<li><a href="../323616/index.html">A preliminary DUMP program is ready. Speakers from Dropbox, JetBrains, Mozilla, Mail.Ru, Yandex, Rambler & Co</a></li>
<li><a href="../323618/index.html">PostgreSQL data change audit</a></li>
<li><a href="../323620/index.html">Where the games go: the problem of preserving old video games. Part 2</a></li>
<li><a href="../323622/index.html">Developing the mechanics of the game Bounce from Nokia JavaScript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>