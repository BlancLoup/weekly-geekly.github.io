<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tuning SQLite for PHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article evaluates the use of SQLite for PHP projects, discusses the features of multi-threaded work and ways to speed up work. "For dessert" - a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tuning SQLite for PHP</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/7f4/f01/355/7f4f013551c6bb2b11d6722b07cd40b9.png"><br>  This article evaluates the use of SQLite for PHP projects, discusses the features of multi-threaded work and ways to speed up work.  "For dessert" - a small comparison with other DBMS (MySQL, PosgreSQL, MS SQL, MongoDB). <br><a name="habracut"></a><br><h4>  Start </h4><br>  Not so long ago I wanted to make my promotional code service for one of my projects.  I did not hesitate in choosing a platform.  Once I have a server with a deployed PHP environment, then the service itself can be safely written in PHP (especially since I know it).  As a DBMS, I wanted to try SQLite (although MySQL and PostgreSQL are deployed on the server).  The reason is easier to transfer to the ‚Äúcombat‚Äù environment (just copy the folder), easier to deploy on the ‚Äúbare‚Äù server (except PHP, nothing is needed).  Additionally, I wanted to simplify the backup (I planned to use disk snapshots + just copy the resulting ‚Äúslice‚Äù). <br><br>  But before using, it is necessary to check the applicability and performance of this solution. <br><br><h4>  Iron </h4><br>  Testing took place at 2 sites: <br><ul><li>  Work station.  Intel i5.  12GB RAM.  SSD + HDD (WD Black).  Windows 8. Used by OpenServer to run PHP. </li><li>  Cloud in Selectel.  Debian 6. There will be a service.  LAMP installed in default configuration.  Is that Apache even more cut, in favor of reducing memory consumption. </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Preliminary estimate </h4><br>  A simple script was written for the initial performance evaluation: <br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//   function initDB() { $guid = ''; //      if (function_exists('com_create_guid') === true) { $guid = trim(com_create_guid(), '{}'); } else { $guid = sprintf('%04X%04X-%04X-%04X-%04X-%04X%04X%04X', mt_rand(0, 65535), mt_rand(0, 65535), mt_rand(0, 65535), mt_rand(16384, 20479), mt_rand(32768, 49151), mt_rand(0, 65535), mt_rand(0, 65535), mt_rand(0, 65535)); } //     $file = "_$guid.db"; //   ( ) $db = new SQLite3($file); //   $db-&gt;exec('CREATE TABLE foo (i INT, i2 INT)'); return $db; } //    function testDB($db, $count) { for ($i=0; $i&lt;$count; $i++) testIteration($db, $i); } // 1   function testIteration($db, $iteration) { $db-&gt;exec('INSERT INTO foo VALUES ('.$iteration.', 1)'); } // ----------     ---------- //    $COUNT = 1000.0; if(isset($_REQUEST['COUNT'])) $COUNT = $_REQUEST['COUNT']; //   $db = initDB(); //    $start = microtime(true); //   testDB($db, $COUNT); //   $time = microtime(true) - $start; //   echo "$COUNT inserts per " . number_format($time, 2) . "sec. " . number_format($COUNT / $time, 2) . " operation per second"; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br>  We consistently insert 1000 records into the table.  We measure elapsed time.  Calculate the number of operations per second. <br>  In principle, for a rough estimate, more is not necessary. <br>  I draw your attention to the fact that I did not specifically use transactions.  Each operation will go in its own transaction.  This mode of operation is closer to the actual use of the database in multi-threaded mode. <br><br>  <u>And now the results:</u> <br>  For the <b>SSD</b> drive received an estimate of 365 operations per second.  Not bad. <br>  For <b>HDD</b> received a total of 13 operations.  Sadly  But what will the server say? <br>  And the <b>server</b> pleased.  210 operations. <br>  In general, the performance evaluation on the server is quite decent.  You can continue testing PHP work with SQLite.  Just immediately make a mark that the server must use a fast file subsystem (SSD). <br>  In our case, as I said, the cloud in Selectel is used.  SSD acts there as a cache between disks and cloud machines (in any case, as I understood from the stories of the notorious <a href="http://habrahabr.ru/users/amarao/" class="user_link">amarao</a> ). <br><br><h4>  Multithreaded mode </h4><br>  Now we will try to answer the question whether the database will be able to work in multi-threaded mode. <br>  We read a wonderful series of articles about SQLite: <a href="http://habrahabr.ru/post/149356/">habrahabr.ru/post/149356</a> <br>  And we see that for a multithreaded mode, you need to include a WAL log.  Add a line to the database initialization (after opening): <br><pre> <code class="php hljs">$db-&gt;exec(<span class="hljs-string"><span class="hljs-string">'PRAGMA journal_mode=WAL;'</span></span>);</code> </pre><br>  <u>And immediately run the test:</u> <br>  <b>SSD:</b> 2000 transactions per second.  The indicator has grown more than 5 times! <br>  <b>HDD:</b> 42 operations.  Growth by 3 times. <br>  <b>Server:</b> 1000 operations.  Growth almost 5 times. <br><br>  Very unexpected results.  A simple change in the mode of the journal gives an increase of 5 times. <br>  The next step is to rewrite the script on multithreading. <br>  We will achieve multithreading via a PHP script call several times in several threads (closer to the real work of sites).  To do this, use the utility AB (Apache Benchmark). <br><pre> <code class="bash hljs">ab -n 1000 -c 10 <span class="hljs-string"><span class="hljs-string">"http://localhost:81/test/benc_sqlite.php"</span></span></code> </pre><br>  The resulting script text: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openDB</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     $file = "_TEMP.db"; //   ( ) $db = new SQLite3($file); //   $db-&gt;busyTimeout(5000); $db-&gt;exec('PRAGMA journal_mode=WAL;'); return $db; } //   function initDB() { $db = openDB(); //   $db-&gt;exec('CREATE TABLE foo (i INT, i2 INT)'); return $db; } //    function testDB($db, $count) { return testIteration($db, mt_rand(0, 1000)); } // 1   function testIteration($db, $iteration) { return $db-&gt;exec('INSERT INTO foo VALUES ('.$iteration.', 1)'); } // ----------     ---------- //   if(isset($_REQUEST['init'])) $db = initDB(); else $db = openDB(); //   if(testDB($db, 1)) echo 'OK'; else echo 'FAIL'; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br>  From the script, the insertion speed was measured, AB will give it to us.  Now initialization is carried out only 1 time, because  work with one DB is in progress. <br>  Additionally, installed <br><pre> <code class="php hljs">$db-&gt;busyTimeout(<span class="hljs-number"><span class="hljs-number">5000</span></span>);</code> </pre><br>  This is necessary so that when trying to multi-threaded recording, the process waited some time (I set 5 seconds) of my turn, and did not immediately fall with the fact that ‚ÄúSQLITE_BUSY‚Äù. <br><br>  <u>Results:</u> <br>  <b>SSD:</b> 970 operations per second.  More than enough. <br>  <b>HDD:</b> 35 operations. <br>  <b>Server:</b> 90 operations during the test from the local machine and 210 when running AB from the server.  A very big difference with the launch on SSD.  Apparently, it is due to differences in the configuration of systems (on the Apache server, it is cut down to the minimum possible). <br>  Additionally, it should be noted that the local indicators are very floating, the server cloudiness affects.  From me to the server is almost one and a half thousand kilometers. <br>  In any case, even if we take at least 90 operations per second, then this is more than enough, in my opinion.  For example, Habr has an average of 30 views per second (of course, strong peaks during the day, but even before Habr grow and grow). <br><br>  In the future, indicators for SSD and HDD are taken in the local test.  And for the server - from a remote machine. <br>  Server and SSD testing is done by running 1000 requests in 10 threads.  For HDD - 100 requests in 10 streams. <br><br><h4>  Complication </h4><br>  Let me remind you that in the test there was 1 simple INSERT request.  In principle, it is good to have a service that performs 1 operation on the base.  But it is very far from reality.  Complicate up to three queries (1 SELECT, 1 UPDATE and 1 INSERT). <br>  The final testIteration function: <br><pre> <code class="php hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testIteration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($db, $iteration)</span></span></span><span class="hljs-function"> </span></span>{ $rez = $db-&gt;querySingle(<span class="hljs-string"><span class="hljs-string">'SELECT count(*) FROM foo WHERE i='</span></span>.$iteration); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($rez &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { $db-&gt;exec(<span class="hljs-string"><span class="hljs-string">'UPDATE foo SET i2 = i2+1 where i='</span></span>.$iteration); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $db-&gt;exec(<span class="hljs-string"><span class="hljs-string">'INSERT INTO foo VALUES ('</span></span>.$iteration.<span class="hljs-string"><span class="hljs-string">', 1)'</span></span>); }</code> </pre><br>  It is clear that you can do without a SELECT query, but nevertheless, we have a test, not an optimization competition. <br><br>  <u>Indicators:</u> <br>  <b>SSD:</b> from 420 requests.  From launch to launch indicator falls. <br>  <b>HDD:</b> from 20 requests (and falls). <br>  <b>Server:</b> from 65 requests (and falls). <br><br><h4>  Database Optimization </h4><br>  I did not like the drop in performance.  Well, let's try to fix this problem.  Specifically, add indices.  Our search takes place in just one field, so add it to the index. <br><br>  In the initialization, add the line <br><pre> <code class="php hljs">$db-&gt;exec(<span class="hljs-string"><span class="hljs-string">'CREATE INDEX "idx_foo" ON "foo" ("i");'</span></span>);</code> </pre><br>  <u>Results:</u> <br>  <b>SSD:</b> 671 queries.  Not bad. <br>  <b>HDD:</b> from 25 to 12 requests.  I do not know what the problem is, but the result is not indicative.  Perhaps due to the fact that the server and SSD, I test 1000 requests in 10 streams, and HDD - 100 requests in 10 streams.  There is less data on the order.  But such a spread should not have affected. <br>  <b>Server:</b> 60 requests. <br><br>  Well, the results make me happy.  But we already have 2 operations for changing the base, where is my transaction?  Add it: <br><pre> <code class="php hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testIteration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($db, $iteration)</span></span></span><span class="hljs-function"> </span></span>{ $rez = $db-&gt;querySingle(<span class="hljs-string"><span class="hljs-string">'SELECT count(*) FROM foo WHERE i='</span></span>.$iteration); $db-&gt;exec(<span class="hljs-string"><span class="hljs-string">'BEGIN;'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($rez &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { $db-&gt;exec(<span class="hljs-string"><span class="hljs-string">'UPDATE foo SET i2 = i2+1 where i='</span></span>.$iteration); } $rez = $db-&gt;exec(<span class="hljs-string"><span class="hljs-string">'INSERT INTO foo VALUES ('</span></span>.$iteration.<span class="hljs-string"><span class="hljs-string">', 1)'</span></span>); $db-&gt;exec(<span class="hljs-string"><span class="hljs-string">'COMMIT;'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $rez; }</code> </pre><br>  <u>And again the results:</u> <br>  <b>SSD:</b> from 720 requests. <br>  <b>HDD:</b> from 30 requests.  And this time the indicator is quite stable. <br>  <b>Server:</b> from 70 requests. <br><br><h4>  Optimize database failures </h4><br>  Apache Benchmark in addition to the execution of requests, monitors the success of requests.  The length of the answer is taken and all answers, longer or shorter than the original, are considered errors.  Interestingly, when testing for a long time, similar problems began to emerge.  Let only a dozen per 1000 requests, but nonetheless. <br>  In the logs, the message ‚ÄúSQLite3 :: exec (): database is locked‚Äù.  Strange, WAL mode, transactions, and still ‚Äúdatabase is locked‚Äù.  The solution was found in the SQLite newsletter: <a href="http://www.mail-archive.com/sqlite-users%40sqlite.org/msg05525.html">http://www.mail-archive.com/sqlite-users@sqlite.org/msg05525.html</a> <br>  In multi-threaded mode, you must use not ‚ÄúBEGIN‚Äù, but ‚ÄúBEGIN IMMEDIATE‚Äù or ‚ÄúBEGIN EXCLUSIVE‚Äù.  Special transactions for multi-threading.  The ‚ÄúBEGIN EXCLUSIVE‚Äù mode sometimes gave me this problem, but the ‚ÄúBEGIN IMMEDIATE‚Äù mode solved it completely. <br><br>  <u>And now the final tests:</u> <br>  <b>SSD:</b> from 700 requests. <br>  <b>HDD:</b> from 30 requests.  Moreover, the figure is quite stable. <br>  <b>Server:</b> from 53 requests.  Strange, I expected about 70. But this is a cloud, there is no need to talk about stability. <br><br>  By the way, the indicator of the number of requests drops a little with time.  On a clean base, the SSD issues 1000 requests.  On the ‚Äúdirty‚Äù - up to 350. At the same time, about 50,000 records have accumulated in the database. <br><br>  <s>It should be added that if a single-threaded test is complicated, as we have complicated multi-threaded (1 SELECT, 1 UPDATE and 1 INSERT query + transaction + indices), then the result of SSD is 1500 iterations per second.</s>  <s>There is where to strive.</s>  <s>At the same time, with the growth of the database, the performance drops about 2 times slower than for the multi-threaded mode.</s> <br>  Repeated tests did not reveal significant advantages of single-thread operation mode of SQLite with respect to multi-threaded. <br><br>  In principle, the test showed quite good results.  Let him in some places contradictory, controversial and insufficiently learned.  But nevertheless, for me personally, an assessment of the health of the SQLite and PHP bundles was fully demonstrated. <br><br><h4>  Comparison with other DBMS </h4><br>  SQLite we looked.  But how do other DBMSs behave in these conditions? <br>  This test will occur only on the local machine and only on the SSD.  The reason is that the local machine costs more DBMS than the server, and this mode is closer to the work of my server. <br>  On hand were: SQLite (v3.7.7.1), PostgreSQL (v9.2.1), MS SQL Server (v11.0.3000.0 (2012, Developer Edition)), MySQL (v5.5.28), MongoDB (v2.4.4) . <br>  PHP used the standard driver for SQLite and MongoDB.  PostgreSQL, MySQL and MS SQL worked through PDO. <br>  Additionally, I decided to change the test a bit: 10,000 requests are executed in 10 threads.  For the purity of the experiment, the base was empty each time. <br>  Database initialization occurs in manual mode.  Initialization includes: creating a table and an index across the field. <br><div class="spoiler">  <b class="spoiler_title">Summary script for SQLite</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openDB</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     $file = "_TEMP.db"; //   ( ) $db = new SQLite3($file); //   $db-&gt;busyTimeout(5000); $db-&gt;exec('PRAGMA journal_mode=WAL;'); return $db; } //   function initDB() { $db = openDB(); //   $db-&gt;exec('CREATE TABLE foo (i INT, i2 INT)'); $db-&gt;exec('CREATE INDEX "idx_foo" ON "foo" ("i");'); return $db; } //    function testDB($db, $count) { return testIteration($db, mt_rand(0, 1000)); } // 1   function testIteration($db, $iteration) { $rez = $db-&gt;querySingle('SELECT count(*) FROM foo WHERE i='.$iteration); $db-&gt;exec('BEGIN IMMEDIATE;'); if($rez &gt; 0) { $db-&gt;exec('UPDATE foo SET i2 = i2+1 where i='.$iteration); } $rez = $db-&gt;exec('INSERT INTO foo VALUES ('.$iteration.', 1)'); $db-&gt;exec('COMMIT;'); return $rez; } // ----------     ---------- //   if(isset($_REQUEST['init'])) $db = initDB(); else $db = openDB(); if(testDB($db, 1)) echo 'OK'; else echo 'FAIL'; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Script for PDO (change connection string for PostgreSQL, MySQL and MS SQL)</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openDB</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// MySQL $db = new PDO('mysql:host=127.0.0.1;dbname=test', 'root', ''); // PosgreSQL //$db = new PDO("pgsql:host=127.0.0.1;dbname=test", "postgres", "" ); // MS SQL //$db = new PDO("sqlsrv:Database=test;Server=127.0.0.1\SQL2012", "sa", "" ); return $db; } //    function testDB($db, $count) { return testIteration($db, mt_rand(0, 1000)); } // 1   function testIteration($db, $iteration) { $rez = $db-&gt;query('SELECT count(*) FROM foo WHERE i='.$iteration); $rez2 = $rez-&gt;fetchAll(); $rez2 = $rez2[0][0]; $rez-&gt;closeCursor(); if(!$db-&gt;beginTransaction()) return false; if($rez2 &gt; 0) { $db-&gt;exec('UPDATE foo SET i2 = i2+1 where i='.$iteration); } $rez = $db-&gt;exec('INSERT INTO foo VALUES ('.$iteration.', 1)'); $db-&gt;commit(); return $rez; } // ----------     ---------- //   $db = openDB(); if(testDB($db, 1)) echo 'OK'; else echo 'FAIL'; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Script for MongoDB</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openDB</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $conn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mongo(<span class="hljs-string"><span class="hljs-string">'localhost'</span></span>); $db = $conn-&gt;test; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $db; } <span class="hljs-comment"><span class="hljs-comment">//    function testDB($db, $count) { return testIteration($db, mt_rand(0, 1000)); } // 1   function testIteration($db, $iteration) { $foo = $db-&gt;foo; $q = array('i' =&gt; $iteration); $ch = $foo-&gt;find($q); if($ch-&gt;count() &gt; 0) { $foo-&gt;update(array('i' =&gt; $iteration), array('$inc' =&gt; array("i2" =&gt; 1))); } $rez = $foo-&gt;insert(array('i' =&gt; $iteration, 'i2' =&gt; 1)); return $rez; } // ----------     ---------- //   $db = openDB(); if(testDB($db, 1)) echo 'OK'; else echo 'FAIL'; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre></div></div><br>  <u>Results:</u> <br>  <b>SQLite:</b> 993 queries per second.  Quite an expected result. <br>  <b>PostgreSQL:</b> <s>178</s> 202 queries per second.  Pretty little.  Apparently, the problem is in the default setting. <br>  <b>MS SQL:</b> 1400 queries per second.  Not bad, very good. <br>  <b>MySQL:</b> 1490 queries per second.  So you and default settings :).  It is worth noting that initially there were 9 requests per second.  The replacement of the call to localhost with 127.0.0.1 helped.  As far as I know, due to the active IPv6 in the system. <br>  <b>MongoDB:</b> 3173 requests per second.  Remarkable result.  Although I expected more from NoSQL. <br><br>  Frankly, the comparison is not the most honest.  The test took place at default settings.  I do not have the necessary administrative skills to align the settings of the DBMS. <br>  MongoDB, first of all, is focused on speed.  SQLIte is focused on reliability.  And PostgeSQL in the default setting is focused on a minimum of resource consumption.  Perhaps this is the reason for the failure. <br><hr>  <b>UPD:</b> I was told by the ‚Äúbig secret‚Äù that PostgreSQL does not like reconnecting.  Therefore, I conducted single-threaded tests for each DBMS. <br>  The test measures the operating time in single-point mode.  10,000 operations, clean db.  The operation is 1 SELECT, 1 UPDATE and 1 INSERT in a transaction.  Measurement of speed in the script (as in the 1st test), without connection time to the database. <br>  <u>The results are as follows:</u> <br>  <b>PostgreSQL:</b> 1403. Growth by 7 times.  What confirms PostgreSQL dislike for reconnections. <br>  <b>PostgreSQL (fsync = off):</b> 1766. Growth by a quarter relative to the default mode.  In multithreaded mode, the increment did not appear. <br>  <b>SQLite:</b> 938. Strange, before 1500 it was.  Probably in the test was a mistake. <br>  <b>MS SQL:</b> 1993. There is growth, but not significant.  Somewhere in 40% (an increase of 1.4 times). <br>  <b>MySQL:</b> 2514. There is growth, 1.7 times. <br>  <b>MongoDB:</b> 7603. Growth almost 2.5 times. <br><hr><br>  The results are quite interesting.  So much so that I decided to compare the performance of different DBMS on the server.  Let me remind you that you are using Debian 6. On the server are: SQLite (v3.7.3), PostgreSQL (v9.0.4), MySQL (v5.1.66).  All in default setting.  AB was run locally on the server.  10,000 requests in 10 threads. <br>  <u>Results:</u> <br>  <b>SQLite:</b> 174 queries per second. <br>  <b>PostgreSQL:</b> 104 queries per second. <br>  <b>MySQL:</b> 167 queries per second. <br><br>  As we see, there is no such big gap as for the local machine.  But do not forget that the server uses SSD (albeit not in ‚Äúpure‚Äù form, but as an element of the cloud storage system). <br><br><h4>  Total </h4><br>  As a result, we can say that a bunch of PHP and SQLite is quite efficient for low-loaded projects.  Enough to follow some simple rules: <br><ol><li>  Use WAL logging mode. </li><li>  Do not forget to install Busy Timeout. </li><li>  Record unite in the transaction.  And not simple, but ‚ÄúBEGIN IMMEDIATE‚Äù. </li></ol><br>  If the project cannot be classified as ‚Äúsmall‚Äù, then using the SSD for the base may well help here. <br><br>  If we talk about Hi-Load, then the guys involved in it, they know what to do without my advice. <br><br>  If we compare SQLite with other DBMS, then they have comparable performance on the default settings.  Anyway when using an SSD drive. <br>  At the same time, ease of setup and administration (nothing needs to be configured and administered), ease of transfer to another server (with a simple copy-paste) provide some advantage for SQLite.  First of all for developers.  For SQLite to work with PHP, nothing but PHP itself is needed. </div><p>Source: <a href="https://habr.com/ru/post/204438/">https://habr.com/ru/post/204438/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../204428/index.html">SMS vulnerability in all Nexus</a></li>
<li><a href="../204430/index.html">Multiple javascript hacks for hipsters</a></li>
<li><a href="../204432/index.html">Break me down completely (ZeroNights 2013)</a></li>
<li><a href="../204434/index.html">Graph500 (supercomputers rating 2013)</a></li>
<li><a href="../204436/index.html">Aggregator Architecture: Web Services Patterns (Part 1)</a></li>
<li><a href="../204440/index.html">Scroller for video and understanding of the time representation in Objective-C</a></li>
<li><a href="../204442/index.html">"Lisp in Small Pieces" in Russian</a></li>
<li><a href="../204446/index.html">Timelapse timer on arduino</a></li>
<li><a href="../204448/index.html">Intel processors for tablets and smartphones - plans for the near future</a></li>
<li><a href="../204450/index.html">Glyndwr University or another article about education abroad</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>