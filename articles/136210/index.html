<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Why C is faster than Java (from the perspective of a Java developer)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On the Git mailing list , there was a discussion about how a high-level programming language reduces application performance in connection with a disc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Why C is faster than Java (from the perspective of a Java developer)</h1><div class="post__text post__text-html js-mediator-article">  On <a href="http://marc.info/%3Fl%3Dgit%26r%3D1%26w%3D2">the Git mailing list</a> , there was a discussion about how a high-level programming language reduces application performance in connection with a discussion of <a href="http://www.jgit.org/">JGit</a> .  The discussion is especially interesting because programmers, experts of the highest level both in C and Java took part in it.  One of them is Shawn O. Pearce (Shawn O. Pearce), a well-known Java programmer from Google, an active committer in Eclipse, a co-author of Git, and the author of a Git Java implementation called JGit.  In <a href="http://marc.info/%3Fl%3Dgit%26m%3D124111702609723%26w%3D2">his message,</a> he described the real limitations that a highly qualified developer faces when trying to write efficient Java code that is comparable in performance to the most optimized C code. Although the letter dates from April 2009, some of Shawn's arguments have not lost their relevance. <br><br><blockquote>  <i>List: git</i> <i><br></i>  <i>Subject: Re: Why Git is so fast (Was: Re: Eric Sink's blog - notes on git,</i> <i><br></i>  <i>From: ‚ÄúShawn O. Pearce‚Äù &lt;spearce () spearce!</i>  <i>org&gt;</i> <br><br>  As mentioned earlier, we made a lot of small optimizations in Git C code to achieve <b>really</b> high performance.  5% is here, 10% is there, and suddenly you are already 60% faster than before.  Niko [Pitre], Linus [Torvalds] and Junio ‚Äã‚Äã[Hamano] - they all spent some time in the last three or four years to optimize individual Git fragments, solely to make it work as fast as possible. </blockquote><a name="habracut"></a><br><blockquote> High level programming languages ‚Äã‚Äãhide the machine to a certain extent, so that we cannot carry out all these optimizations. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For example, JGit suffers from a lack of <code>mmap()</code> , and when using Java NIO MappedByteBuffer, we still need to make a copy into the <code>byte[]</code> temporary array to get real data processing.  There is no such copy in Git on C.  Of course, in other high-level languages, the <code>mmap</code> method may be more comfortable, but they all also tend to garbage collection, and most languages ‚Äã‚Äãtry to associate the <code>mmap</code> control with the garbage collector "for safety and simplicity." <br><br>  JGit also suffers from the lack of unsigned data types in Java.  There are a lot of places in JGit where we really need <code>unsigned int32_t</code> or <code>unsigned long</code> (machine word of maximum size) or <code>unsigned char</code> , but these data types are simply missing in Java.  Converting a byte to an int, just to represent it as unsigned, requires an extra <code>&amp; 0xFF</code> operation to zero the sign extension. <br><br>  JGit suffers from the lack of an effective way to present SHA-1.  In C code, you can simply write <code>unsigned char[20]</code> and immediately copy the string into memory to the container.  In Java <code>byte[20]</code> <b>an additional</b> 16 bytes of memory will cost, and access to them will be longer, because these bytes themselves are in a different area of ‚Äã‚Äãmemory from the container.  We try to get around this by converting from <code>byte[20]</code> to five ints, but this is worth additional machine instructions. <br><br>  Git on C takes for granted that the <code>memcpy(a, b, 20)</code> operation is extremely cheap when copying the contents of the memory from the tree (inflated tree) into the structure object.  JGit has to pay a large fine for copying these 20 bytes into five ints, because later on these five ints are cheaper. <br><br>  In other high-level programming languages, it is also not possible to mark the type as unsigned.  Or they are forced to pay similar fines for storing a 20-byte binary array. <br><br>  Native Java collections (collection types) have become a real trap for us in JGit.  We used <code>java.util.*</code> Types in convenient cases, and it seemed that we almost solved the problem with the data structure, but they, as a rule, worked much worse than writing a specialized data structure. <br><br>  For example, we had an <code>ObjectIdSubclassMap</code> for what should look like a <code>Map&lt;ObjectId,Object&gt;</code> .  Only he demanded that the type Object, which you use as a ‚Äúvalue‚Äù, originated from an ObjectId, since this representation of the object works both as a key <b>and</b> as a value.  This causes a real nightmare when used on a <code>HashMap&lt;ObjectId,Object&gt;</code> .  (If anyone does not know, ObjectId is the JGit <code>unsigned char[20]</code> for SHA-1). <br><br>  Just a couple of days ago, I wrote <code>LongMap</code> , a faster version of <code>HashMap&lt;Long,Object&gt;</code> , for hashing objects by indexes in a packed file.  Here, the same thing. The cost of packaging in Java for converting a <code>long</code> (the largest integer) into an object suitable for the standard HashMap type was rather high. <br><br>  And now JGit is still slower when it comes to handling a commit or a tree object, where you need to keep track of the object links.  Or when the <code>inflate()</code> call <code>inflate()</code> .  We spend much more time on these procedures than git does on C, although we try to descend as low as possible, as far as <code>byte[]</code> allows, avoiding copying anything and avoiding memory allocation whenever possible. <br><br>  Characteristically, JGit performs a <code>rev-list --objects ‚Äìall</code> about twice as long as Git does on a project like the Linux kernel, and the <code>index-pack</code> for a file of about 270 MB also lasts about twice as long. <br><br>  Both parts of JGit are as good as I have enough knowledge to optimize them, but we really are at the mercy of JIT, and any changes in JIT can lead to a deterioration (or improvement) in our performance.  Unlike Git on C, where Linus Torvalds can change whole code snippets in assembler and try different approaches. <br><br>  So yes, there is a practical sense in creating Git in a high-level language, but you simply cannot get the same performance or strict memory consumption as Git does in C. That's what you are abstracted from in a high-level language.  However, JGit works quite fine;  fast enough so that we use it as a git server inside Google. </blockquote><br>  PS The post of Sean Pierce was written in 2009 and the author does not take into account the changes made in Java 1.7.  For example, Java is now <a href="http://weblogs.java.net/blog/forax/archive/2009/10/06/jdk7-do-escape-analysis-default">using</a> escape analysis to avoid heap storage when possible. </div><p>Source: <a href="https://habr.com/ru/post/136210/">https://habr.com/ru/post/136210/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136202/index.html">Unexpected need for data versioning</a></li>
<li><a href="../136203/index.html">WAW - Words do not need to be conveyed by the senses</a></li>
<li><a href="../136205/index.html">Configuring Squid 3 + QuintoLabs Content Security 1.4 and Integration with Active Directory</a></li>
<li><a href="../136206/index.html">At first they don't notice you, then they laugh at you, then they fight with you. And then you win. Mahatma Gandhi</a></li>
<li><a href="../136209/index.html">CyberPlat has closed acceptance of credit cards from abroad</a></li>
<li><a href="../136213/index.html">We are 1 year old!</a></li>
<li><a href="../136214/index.html">[archlinux testing news] / usr support on a separate section</a></li>
<li><a href="../136216/index.html">Facebook allows you to listen to music with friends</a></li>
<li><a href="../136218/index.html">Integration of some features of Scoreloop social gaming network into an Android application</a></li>
<li><a href="../136219/index.html">MSP430 Lunchpad Review and Test Project</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>