<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Convert video file to gif</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="My programming experience in c ++ is 5 months, until this time I had been developing applications for mobile operating systems for about two years. At...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Convert video file to gif</h1><div class="post__text post__text-html js-mediator-article">  My programming experience in c ++ is 5 months, until this time I had been developing applications for mobile operating systems for about two years.  At one point I got tired of it, and I decided that it was time to begin to fulfill my youthful dream - to become a game developer.  And I slightly changed the direction of my career. <br><br>  Somehow I sat and thought what would I write.  I chose 16 programs for myself, threw a coin several times, and the lot pointed me to a program for getting gifs from a video.  Who wants to see the amateur cross code - please under the cat. <br><a name="habracut"></a><br>  The principle and structure is very simple.  Two parameters enter our program: the path to our video and the name of the output gif.  We create an instance of our unpretentious class and call the method of creating a gif (I forgot to say that we will use the libraries OpenCv and Magick ++). <br><br>  Class Description: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Video</span></span></span><span class="hljs-class">{</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Video(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&amp; video_n, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&amp; gif_n){ video_name = video_n; output_gif_name = gif_n; }; ~Video() {}; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_gif</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> video_name; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> output_gif_name; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;Mat&gt; frames; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;Magick::Image&gt; Magick_frames; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">extract_frames</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> Magick::<span class="hljs-function"><span class="hljs-function">Image </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mat_2_magick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cv::Mat&amp; src)</span></span></span></span>; };</code> </pre> <br>  The constructor contains two parameters - our input parameters from the command line. <br><br>  std :: vector frames is a property that contains frames of our video in the structure cv :: Mat, std :: vector &lt;Magick :: Image&gt;. <br>  Magick_frames - this property stores the converted frames. <br><br>  The extract_frames method pulls frames from the video.  The algorithm is very simple and consists of the following: <br><br>  1) create an instance of the class cv :: VideoCapture (class for video capture) <br>  2) determine the frame counter and start the cycle where we will process the video <br>  3) if our counter does not fall within the scope of our video, we exit; otherwise, set the frame to VideoCapture equal to our counter (CV_CAP_PROP_POS_FRAMES property) <br>  4) try to read the frame and if it works out, then add it to std :: vector frames and increase the frame count by 10 (every tenth frame, which would facilitate the gif) <br><br><pre> <code class="hljs ruby">void Video::extract_frames(){ try{ VideoCapture cap(this-&gt;video_name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cap.isOpened()) CV_Error(CV_StsError, <span class="hljs-string"><span class="hljs-string">"Can't open video file"</span></span>); double fIdx = <span class="hljs-number"><span class="hljs-number">0</span></span>; double frnb(cap.get(CV_CAP_PROP_FRAME_COUNT)); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> std::cout &lt;&lt; <span class="hljs-string"><span class="hljs-string">"frame count = "</span></span> &lt;&lt; frnb&lt;&lt; std::endl; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (;;){ <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> std::cout&lt;&lt;<span class="hljs-string"><span class="hljs-string">"frame : "</span></span>&lt;&lt;fIdx&lt;&lt;std::endl; Mat frame; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fIdx &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-params"><span class="hljs-params">||</span></span> fIdx &gt;= frnb) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; cap.set(CV_CAP_PROP_POS_FRAMES, fIdx); bool success = cap.read(frame); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (success) { this-&gt;frames.push_back(frame); fIdx = fIdx + <span class="hljs-number"><span class="hljs-number">10</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } catch(cv::Exception&amp; e){ cerr &lt;&lt; e.msg &lt;&lt; std::endl; exit(<span class="hljs-number"><span class="hljs-number">1</span></span>); } }</code> </pre><br>  In the main create_gif () method, we first execute the frame acquisition method, then convert these frames to the Magic :: Image structure and write the output file. <br><br>  This is a method for converting cv :: Mat to Magic :: Image.  This is necessary because opencv does not know how to work with gif files, I found a bunch of libraries, but decided to stop at magick ++. <br><br>  <i>* To be honest, I didn‚Äôt feel the compression and quality reduction up to 50%, the output file, with both these and without these parameters, weighed equally *</i> <br><br><pre> <code class="hljs ruby">inline Magick::Image Video::mat_2_magick(cv::Mat&amp; src) { Magick::Image mgk(src.cols, src.rows, <span class="hljs-string"><span class="hljs-string">"BGR"</span></span>, Magick::CharPixel, (char *)src.data); mgk.compressType(JPEGCompression); mgk.quality(<span class="hljs-number"><span class="hljs-number">50</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mgk; } void Video::create_gif() { extract_frames();<span class="hljs-regexp"><span class="hljs-regexp">//</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(std::vector&lt;cv::Mat&gt;<span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:iterator</span></span> frame = this-&gt;frames.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(); frame != this-&gt;frames.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); ++frame){ this-&gt;Magick_frames.push_back(Video::mat_2_magick(*frame)); } Magick::writeImages(this-&gt;Magick_frames.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(), this-&gt;Magick_frames.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(), this-&gt;output_gif_name); }</code> </pre><br>  I will tell you a little about one problem with which I was busy until 7 in the morning.  I used CMake in this project and I did not specify the link and compilation flags.  It was pretty disappointing that I missed it.  Here is part of the Cmake file: <br><br><pre> <code class="hljs lisp">find_file(<span class="hljs-name"><span class="hljs-name">MAGICK_CONFIG_EXE</span></span> <span class="hljs-string"><span class="hljs-string">"Magick++-config"</span></span> PATHS <span class="hljs-string"><span class="hljs-string">"/usr/bin"</span></span> <span class="hljs-string"><span class="hljs-string">"/usr/local/bin"</span></span> ) if (<span class="hljs-name"><span class="hljs-name">MAGICK_CONFIG_EXE</span></span>) message(<span class="hljs-name"><span class="hljs-name">STATUS</span></span> <span class="hljs-string"><span class="hljs-string">"Found Image Magick++ libaries -- Enabling MagickPainter."</span></span>) execute_process(<span class="hljs-name"><span class="hljs-name">COMMAND</span></span> Magick++-config --cppflags OUTPUT_VARIABLE Magick_CPP_FLAGS OUTPUT_STRIP_TRAILING_WHITESPACE) execute_process(<span class="hljs-name"><span class="hljs-name">COMMAND</span></span> Magick++-config --cxxflags OUTPUT_VARIABLE Magick_CXX_FLAGS OUTPUT_STRIP_TRAILING_WHITESPACE) execute_process(<span class="hljs-name"><span class="hljs-name">COMMAND</span></span> Magick++-config --ldflags OUTPUT_VARIABLE Magick_LD_FLAGS OUTPUT_STRIP_TRAILING_WHITESPACE) execute_process(<span class="hljs-name"><span class="hljs-name">COMMAND</span></span> Magick++-config --libs OUTPUT_VARIABLE Magick_LIBS OUTPUT_STRIP_TRAILING_WHITESPACE) set(<span class="hljs-name"><span class="hljs-name">CMAKE_CXX_FLAGS</span></span> <span class="hljs-string"><span class="hljs-string">"${CMAKE_CXX_FLAGS} ${Magick_CPP_FLAGS} ${Magick_CXX_FLAGS}"</span></span>) set(<span class="hljs-name"><span class="hljs-name">CMAKE_EXE_LINKER_FLAGS</span></span> <span class="hljs-string"><span class="hljs-string">"${CMAKE_EXE_LINKER_FLAGS} ${Magick_LIBS} ${Magick_LD_FLAGS}"</span></span>) # remove_definitions(<span class="hljs-name"><span class="hljs-name">-DUSE_MAGICK_PAINTER</span></span>) endif (<span class="hljs-name"><span class="hljs-name">MAGICK_CONFIG_EXE</span></span>)</code> </pre><br>  Everything is <a href="https://github.com/GarryDvaraza/video2gif">on the gita</a> . <br><br>  PS: the first post, I do not want to ask for mercy.  On the contrary: I want you to appreciate to the fullest extent.  I hope you will write that I am wrong and advise something. <br><br>  Regards, Harry. </div><p>Source: <a href="https://habr.com/ru/post/269315/">https://habr.com/ru/post/269315/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269305/index.html">Rules of safe programming in C: past, present and future</a></li>
<li><a href="../269307/index.html">TemplateEngine.Docx - OpenSource .NET docx template engine for documents</a></li>
<li><a href="../269309/index.html">Apple fixed vulnerabilities in its products</a></li>
<li><a href="../269311/index.html">ECMA-130 (Compact Disc) on the fingers</a></li>
<li><a href="../269313/index.html">Microsoft will add support for the Clang compiler in the November update of Visual Studio 2015</a></li>
<li><a href="../269323/index.html">Introduce the anti-spam tool in personal messages on My Circle</a></li>
<li><a href="../269325/index.html">And a little more about auto-tuning textarea</a></li>
<li><a href="../269327/index.html">Using speech recognition and speech synthesis to learn English on iPhone / iPad. Aspects of copyright on techniques. My experience</a></li>
<li><a href="../269329/index.html">Hyper-V vNext - VM versions and new functionality</a></li>
<li><a href="../269331/index.html">SVG icons - a lot and with style</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>