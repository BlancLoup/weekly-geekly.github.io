<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Net :: Ethereum module for working with Solidity contracts</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Usually, when I need to use some kind of new service or technology from Perl scripts, I go to CPAN, and there is already one or more suitable modules....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Net :: Ethereum module for working with Solidity contracts</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/yy/-g/fx/yy-gfx2uzhzou5gkhyth8vxbra8.jpeg"><br><br>  Usually, when I need to use some kind of new service or technology from Perl scripts, I go to CPAN, and there is already one or more suitable modules.  However, in the case of frameworks for working with Ethereum blockchain nodes and Solidity contracts, unfortunately, I could not find the required module. <br><br>  We plan to soon use the smart contracts Solidity of the Ethereum network in our SAAS-service of online stores, written in Perl.  So I had no choice but to write my own Net :: Ethereum module (this module is already available on CPAN, albeit in the form of an alpha version). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I hope that the Net :: Ethereum module will be useful to those who want to integrate their Perl systems with the Ethereum blockchain contracts.  I would be very grateful to those who use this module and send me their thoughts on how to improve it, as well as information about errors found. <br><a name="habracut"></a><br><h2>  Why I made my Perl module </h2><br>  Many believe that Perl has become obsolete, and find many reasons for this.  Perhaps, if I started creating my service now, I would choose another programming language, such as Python or Golang.  However, the choice was made more than 10 years ago, and then using Perl was the right decision.  It was a reliable, well-developed technology, with a lot of documentation and books, including in Russian, available for quick mastering by beginners.  In addition, the CPAN repository, which contains many useful modules, helped to focus on solving applied problems. <br><br>  Now, when the task of integrating the online store service with Solidity contracts arose, it turned out that there are tools and frameworks only for JavaScript and Python.  At the same time, as far as I understand, only Web3 library, providing the API based on JavaScript, received official support. <br><br>  Of course, we could raise the Node.js node and create a microservice on it for the interaction of Perl scripts and Solidity smart contracts.  However, the cost of creating and maintaining this node, ensuring its high load capacity and fault tolerance would be added. <br><br>  It is theoretically possible to rewrite our SAAS service in Python or JavaScript, but it will require incredible financial costs and a lot of time.  As a result, I decided that it would be easier to write the Net :: Ethereum module and integrate with the Solidity smart contracts without any intermediate microservices. <br><br><h2>  Ethereum JSON RPC API will help us. </h2><br>  The node (node) of the Ethereum network can serve as a server providing the JSON RPC programming interface for performing all the necessary actions.  For this interface published a <a href="https://github.com/ethereum/wiki/wiki/JSON-RPC">detailed description</a> .  In addition, a <a href="https://github.com/ethereum/go-ethereum/wiki/Management-APIs">description of the Management APIs</a> will be helpful. <br><br>  Calling most of the Ethereum JSON RPC API functions is fairly trivial.  However, in order to pass the parameters to the designer of the smart script, its methods, and also to get the values ‚Äã‚Äãreturned by the methods, it is necessary to implement packing (marshaling, marshaling) and unpacking (unmarshaling).  It does not do without the so-called specification of the binary interface, published in the document <a href="https://solidity.readthedocs.io/en/develop/abi-spec.html">Application Binary Interface Specification</a> . <br><br>  Examining this specification may require some effort.  If you decide to understand all the details of the marshaling, then you, like me, will be helped by the article <a href="https://habrahabr.ru/company/raiffeisenbank/blog/338172/">Working with smart contracts through the Ethereum RPC API</a> . <br><br>  Another difficulty with marshaling is related to the fact that Solidity contracts work with very large numbers - int256, uint256.  Perl scripts can work with such numbers using the Math :: BigInt module.  This module connects to Net :: Ethereum. <br><br>  I must say that at the moment (version 0.28) marshaling (and unmarshaling) are implemented only for the following data types: <br><br><ul><li>  uint (uint8 ... uint256) </li><li>  int (int8 ... int256) </li><li>  bool </li><li>  address </li><li>  string </li></ul><br>  In the future, I plan to marshal for other types of Solidity data. <br><br><h2>  Preparing the environment for using Net :: Ethereum </h2><br>  I did all the work on creating and debugging the Net :: Ethereum module in the cloud, on the Ubuntu virtual machine on 04/16/3 LTS xenial.  At the same time, I used a private Ethereum network deployed on this virtual machine and consisting of one node. <br><br>  First of all, in the home directory of a user with normal permissions, you need to create a file genesis.json: <br><br><div class="spoiler">  <b class="spoiler_title">Genesis.json file</b> <div class="spoiler_text"><pre><code class="bash hljs">{ <span class="hljs-string"><span class="hljs-string">"config"</span></span>: { <span class="hljs-string"><span class="hljs-string">"chainId"</span></span>: 1907, <span class="hljs-string"><span class="hljs-string">"homesteadBlock"</span></span>: 0, <span class="hljs-string"><span class="hljs-string">"eip155Block"</span></span>: 0, <span class="hljs-string"><span class="hljs-string">"eip158Block"</span></span>: 0 }, <span class="hljs-string"><span class="hljs-string">"difficulty"</span></span>: <span class="hljs-string"><span class="hljs-string">"40"</span></span>, <span class="hljs-string"><span class="hljs-string">"gasLimit"</span></span>: <span class="hljs-string"><span class="hljs-string">"5100000"</span></span>, <span class="hljs-string"><span class="hljs-string">"alloc"</span></span>: {} }</code> </pre> <br></div></div><br>  Next, create an account: <br><br><pre> <code class="bash hljs">geth --datadir node1 account new</code> </pre><br>  When you create an account, you will be asked for a password that you want to save. <br><br>  In the next step, we initialize the node: <br><br><pre> <code class="bash hljs">geth --datadir node1 init genesis.json</code> </pre><br>  After the initialization is complete, launch the node in the first console window with the following command: <br><br><pre> <code class="bash hljs">geth --datadir node1 --nodiscover --mine --minerthreads 1 --maxpeers 0 --verbosity 3 --networkid 98765 --rpc --rpcapi=<span class="hljs-string"><span class="hljs-string">"db,eth,net,web3,personal,web3"</span></span> console</code> </pre><br>  Please note that we have specified the --rpc and --rpcapi parameters, they allow the node to provide the services we need.  In addition, using the - mine parameter, we launched local mining, which is necessary for publishing contracts and performing other transactions. <br><br>  After starting the node, we do not enter any commands in the first console window, but simply observe the messages that appear there. <br><br>  To work with Web3 interface commands, open the second console window, and run the command to connect to the node there: <br><br><pre> <code class="bash hljs">geth --datadir node1 --networkid 98765 attach ipc://home/frolov/node1/geth.ipc</code> </pre><br>  As for running Perl scripts that work with the Net :: Ethereum module, they need to be run in a separate, third console window.  You must first install the Net :: Ethereum module, and also make sure that the latest version of the Math :: BigInt module is installed. <br><br>  The Net :: Ethereum module is <a href="https://metacpan.org/pod/Net::Ethereum">in the CPAN directory</a> . <br><br><h2>  Create and publish test smart contract </h2><br>  The Net :: Ethereum module was tested on the following contract: <br><br><div class="spoiler">  <b class="spoiler_title">HelloSol.sol file</b> <div class="spoiler_text"><pre> <code class="hljs cs">pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span>; contract HelloSol { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> savedString; <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> savedValue; address contractOwner; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HelloSol</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> initValue, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> initString</span></span></span><span class="hljs-function">) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span></span> { contractOwner = msg.sender; savedString = initString; savedValue = initValue; } <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newString </span></span></span><span class="hljs-function">) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span></span> { savedString = newString; } <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> constant </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> curString</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> savedString; } <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setValue</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newValue </span></span></span><span class="hljs-function">) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span></span> { savedValue = newValue; } <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> constant </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> curValue</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> savedValue; } <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAll</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newValue, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newString</span></span></span><span class="hljs-function">) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span></span> { savedValue = newValue; savedString = newString; } <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAll</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> constant </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> curValue, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> curString</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (savedValue, savedString); } <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAllEx</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> constant </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isOk, address msgSender, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> curValue, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> curString, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> val1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> str1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> val2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> val3</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> memory sss=<span class="hljs-string"><span class="hljs-string">"++ ==================================== ++"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>, msg.sender, <span class="hljs-number"><span class="hljs-number">33333</span></span>, sss, <span class="hljs-number"><span class="hljs-number">9999</span></span>, <span class="hljs-string"><span class="hljs-string">"Line 9999"</span></span>, <span class="hljs-number"><span class="hljs-number">7777</span></span>, <span class="hljs-number"><span class="hljs-number">8888</span></span>); } <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">repiter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pBool, address pAddress, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pVal1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pStr1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pVal2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pStr2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pVal3, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pVal4</span></span></span><span class="hljs-function">) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> pure </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rbBool, address rpAddress, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rpVal1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rpStr1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rpVal2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rpStr2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rpVal3, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rpVal4</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (pBool, pAddress, pVal1, pStr1, pVal2, pStr2, pVal3, pVal4); } }</code> </pre><br></div></div><br>  Save this contract in the working directory, a file named HelloSol.sol. <br><br>  To compile and deploy a contract, I wrote a small deploy_contract.pl, presented below. <br><br><div class="spoiler">  <b class="spoiler_title">File deploy_contract.pl</b> <div class="spoiler_text"><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl use strict; use Net::Ethereum; use Data::Dumper; my $contract_name = $ARGV[0]; my $password = $ARGV[1]; my $node = Net::Ethereum-&gt;new('http://localhost:8545/'); my $src_account = $node-&gt;eth_accounts()-&gt;[0]; print 'My account: '.$src_account, "\n"; my $constructor_params={}; $constructor_params-&gt;{ initString } = '+ Init string for constructor +'; $constructor_params-&gt;{ initValue } = 102; my $contract_status = $node-&gt;compile_and_deploy_contract($contract_name, $constructor_params, $src_account, $password); my $new_contract_id = $contract_status-&gt;{contractAddress}; my $transactionHash = $contract_status-&gt;{transactionHash}; my $gas_used = hex($contract_status-&gt;{gasUsed}); print "\n", 'Contract mined.', "\n", 'Address: '.$new_contract_id, "\n", 'Transaction Hash: '.$transactionHash, "\n"; my $gas_price=$node-&gt;eth_gasPrice(); my $contract_deploy_price = $gas_used * $gas_price; my $price_in_eth = $node-&gt;wei2ether($contract_deploy_price); print 'Gas used: '.$gas_used.' ('.sprintf('0x%x', $gas_used).') wei, '.$price_in_eth.' ether', "\n\n";</span></span></code> </pre><br></div></div><br>  This script needs to be passed the name of the Solidity class, which must match the file name without the ".sol" extension, as well as the account password saved when preparing the Ethereum node for operation. <br><br>  The contract compilation and publishing program connects to the site at <a href="http://localhost/">localhost</a> : 8545 /.  If this address is not available, check the node start command. <br><br>  Next, the program using the eth_accounts method gets an array of accounts created on the current node, using the first one to work. <br><br>  We compile and publish the contract by compile_and_deploy_contract.  He is given the name and parameters of the contract, the address of the account on whose behalf the contract will be published, as well as the password of this account. <br><br>  The compile_and_deploy_contract method compiles the contract source code file by creating the abi binary interface specification file and the binary code code file in the build directory of the working directory.  To do this, use the following command: <br><br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $cmd = <span class="hljs-string"><span class="hljs-string">"$bin_solc --bin --abi $contract_src_path -o build --overwrite"</span></span>;</code> </pre><br>  Next, the compile_and_deploy_contract method unlocks the account using the personal_unlockAccount method, estimates the amount of gas required for publication using the deploy_contract_estimate_gas method. <br><br>  Publication is performed by the method deploy_contract, while waiting for the completion of the transaction executes the method wait_for_contract.  After the publication is completed, we receive the contract code using the eth_getCode method to make sure that the contract was published successfully. <br><br>  After the publication is completed, the compile_and_deploy_contract method returns the status of the contract.  Our publishing program retrieves and displays the address of a published contract, the transaction hash, and the amount of gas used.  The cost of publishing a contract is displayed in units of wei and ether. <br><br>  This way you can create your own script for publishing and deploying a contract.  It can be integrated into a continuous development and deployment system for your system software. <br><br><h2>  Work with contract methods </h2><br>  To work with a contract, we used the debug_contract.pl script shown below. <br><br><div class="spoiler">  <b class="spoiler_title">File debug_contract.pl</b> <div class="spoiler_text"><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> Net::Ethereum; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> Data::Dumper; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $contract_name = $ARGV[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $password = $ARGV[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $contract_id = $ARGV[<span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $node = Net::Ethereum-&gt;new(<span class="hljs-string"><span class="hljs-string">'http://localhost:8545/'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $src_account = $node-&gt;eth_accounts()-&gt;[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'My account: '</span></span>.$src_account, <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $abi = $node-&gt;_read_file(<span class="hljs-string"><span class="hljs-string">'build/'</span></span>.$contract_name.<span class="hljs-string"><span class="hljs-string">'.abi'</span></span>); $node-&gt;set_contract_abi($abi); $node-&gt;set_contract_id($contract_id); <span class="hljs-comment"><span class="hljs-comment"># Call contract methods without transactions my $function_params={}; my $test1 = $node-&gt;contract_method_call('getValue', $function_params); print Dumper($test1); my $test = $node-&gt;contract_method_call('getString'); print Dumper($test); my $testAll = $node-&gt;contract_method_call('getAll'); print Dumper($testAll); my $testAllEx = $node-&gt;contract_method_call('getAllEx'); print Dumper($testAllEx); $function_params={}; $function_params-&gt;{ pBool } = 1; $function_params-&gt;{ pAddress } = "0xa3a514070f3768e657e2e574910d8b58708cdb82"; $function_params-&gt;{ pVal1 } = 1111; $function_params-&gt;{ pStr1 } = "This is string 1"; $function_params-&gt;{ pVal2 } = 222; $function_params-&gt;{ pStr2 } = "And this is String 2, very long string +++++++++++++++++========="; $function_params-&gt;{ pVal3 } = 333; $function_params-&gt;{ pVal4 } = '-999999999999999999999999999999999999999999999999999999999999999977777777'; my $rc = $node-&gt;contract_method_call('repiter', $function_params); print Dumper($rc); # Send Transaction 1 my $rc = $node-&gt;personal_unlockAccount($src_account, $password, 600); print 'Unlock account '.$src_account.'. Result: '.$rc, "\n"; my $function_params={}; $function_params-&gt;{ newString } = '+++ New string for save +++'; my $used_gas = $node-&gt;contract_method_call_estimate_gas('setString', $function_params); my $gas_price=$node-&gt;eth_gasPrice(); my $transaction_price = $used_gas * $gas_price; my $call_price_in_eth = $node-&gt;wei2ether($transaction_price); print 'Estimate Transaction Gas: '.$used_gas.' ('.sprintf('0x%x', $used_gas).') wei, '.$call_price_in_eth.' ether', "\n"; my $tr = $node-&gt;sendTransaction($src_account, $node-&gt;get_contract_id(), 'setString', $function_params, $used_gas); print 'Waiting for transaction: ', "\n"; my $tr_status = $node-&gt;wait_for_transaction($tr, 25, $node-&gt;get_show_progress()); print Dumper($tr_status); # Send Transaction 2 $rc = $node-&gt;personal_unlockAccount($src_account, $password, 600); print 'Unlock account '.$src_account.'. Result: '.$rc, "\n"; $function_params={}; $function_params-&gt;{ newValue } = 77777; $used_gas = $node-&gt;contract_method_call_estimate_gas('setValue', $function_params); $transaction_price = $used_gas * $gas_price; $call_price_in_eth = $node-&gt;wei2ether($transaction_price); print 'Estimate Transaction Gas: '.$used_gas.' ('.sprintf('0x%x', $used_gas).') wei, '.$call_price_in_eth.' ether', "\n"; $tr = $node-&gt;sendTransaction($src_account, $node-&gt;get_contract_id(), 'setValue', $function_params, $used_gas); print 'Waiting for transaction: ', "\n"; $tr_status = $node-&gt;wait_for_transaction($tr, 25, $node-&gt;get_show_progress()); print Dumper($tr_status); $testAllEx = $node-&gt;contract_method_call('getAllEx'); print Dumper($testAllEx);</span></span></code> </pre><br></div></div><br>  As the first parameter, the script needs to pass the name of the contract class (as for the script for compiling and publishing the contract), the second is the account password, and the third is the address of the contract, which was printed to the console by the program deploy_contract.pl. <br><br>  At the very beginning of its work, the debug_contract.pl script receives the address of the first account created on the node and stores it in the $ src_account variable.  On behalf of this account we will send transactions. <br><br>  In order for us to call the contract methods, we need to load the contents of the binary interface abi specification file, and also save the contract address in the object: <br><br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $abi = $node-&gt;_read_file(<span class="hljs-string"><span class="hljs-string">'build/'</span></span>.$contract_name.<span class="hljs-string"><span class="hljs-string">'.abi'</span></span>); $node-&gt;set_contract_abi($abi); $node-&gt;set_contract_id($contract_id);</code> </pre><br><br><h2>  Calling methods without creating a transaction </h2><br>  If contract methods do not create transactions (for example, return values ‚Äã‚Äãfrom variables, constants, or literals), then we can use the contract_method_call method: <br><br><pre> <code class="perl hljs">$function_params={}; $function_params-&gt;{ pBool } = <span class="hljs-number"><span class="hljs-number">1</span></span>; $function_params-&gt;{ pAddress } = <span class="hljs-string"><span class="hljs-string">"0xa3a514070f3768e657e2e574910d8b58708cdb82"</span></span>; $function_params-&gt;{ pVal1 } = <span class="hljs-number"><span class="hljs-number">1111</span></span>; $function_params-&gt;{ pStr1 } = <span class="hljs-string"><span class="hljs-string">"This is string 1"</span></span>; $function_params-&gt;{ pVal2 } = <span class="hljs-number"><span class="hljs-number">222</span></span>; $function_params-&gt;{ pStr2 } = <span class="hljs-string"><span class="hljs-string">"And this is String 2, very long string +++++++++++++++++========="</span></span>; $function_params-&gt;{ pVal3 } = <span class="hljs-number"><span class="hljs-number">333</span></span>; $function_params-&gt;{ pVal4 } = <span class="hljs-string"><span class="hljs-string">'-999999999999999999999999999999999999999999999999999999999999999977777777'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $rc = $node-&gt;contract_method_call(<span class="hljs-string"><span class="hljs-string">'repiter'</span></span>, $function_params); <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> Dumper($rc);</code> </pre><br>  Note that the variable pVal4 of type int256 gets a very large negative value.  In the appropriate field, the method contract_method_call will return a value of type Math :: BigInt. <br><br><h2>  Calling Transactional Methods </h2><br>  If you need to set the value of the data field of the Solidity class, you will have to call the method that triggers the transaction (just as we did when publishing the contract). <br><br>  To do this, we first need to unlock the account using the personal_unlockAccount method. <br><br>  Next, we prepare a hash with the passed $ function_params values ‚Äã‚Äãand estimate the amount of gas needed to complete the transaction using the contract_method_call_estimate_gas method.  The transaction is sent using the sendTransaction method: <br><br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $function_params={}; $function_params-&gt;{ newString } = <span class="hljs-string"><span class="hljs-string">'+++ New string for save +++'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $used_gas = $node-&gt;contract_method_call_estimate_gas(<span class="hljs-string"><span class="hljs-string">'setString'</span></span>, $function_params); <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $gas_price=$node-&gt;eth_gasPrice(); <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $transaction_price = $used_gas * $gas_price; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $call_price_in_eth = $node-&gt;wei2ether($transaction_price); <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'Estimate Transaction Gas: '</span></span>.$used_gas.<span class="hljs-string"><span class="hljs-string">' ('</span></span>.sprintf(<span class="hljs-string"><span class="hljs-string">'0x%x'</span></span>, $used_gas).<span class="hljs-string"><span class="hljs-string">') wei, '</span></span>.$call_price_in_eth.<span class="hljs-string"><span class="hljs-string">' ether'</span></span>, <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $tr = $node-&gt;sendTransaction($src_account, $node-&gt;get_contract_id(), <span class="hljs-string"><span class="hljs-string">'setString'</span></span>, $function_params, $used_gas); <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'Waiting for transaction: '</span></span>, <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $tr_status = $node-&gt;wait_for_transaction($tr, <span class="hljs-number"><span class="hljs-number">25</span></span>, $node-&gt;get_show_progress()); <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> Dumper($tr_status);</code> </pre><br>  Next, using the wait_for_transaction method, we wait for its completion.  This method returns the status of the transaction, which you can check. <br><br><h2>  Conclusion </h2><br>  Read also my articles: <br><br><ul><li>  <a href="https://habrahabr.ru/post/344578/">Experiments with Solidity contracts on the Rinkeby test network of the Ethereum blockchain</a> </li><li>  <a href="https://habrahabr.ru/post/346542/">The decentralized data warehouse Ethereum Swarm</a> </li></ul><br>  I would like to express special gratitude to the author of the article <a href="https://github.com/ethereum/go-ethereum/wiki/Management-APIs">description of management interfaces Management APIs</a> .  This article helped me to deal with the most confusing in Ethereum JSON RPC API - packaging and unpacking of parameters for the designer of a smart contract and its methods. <br><br>  I also hope that the Net :: Ethereum module will help projects created in the Perl programming language to integrate with the Ethereum blockchain. </div><p>Source: <a href="https://habr.com/ru/post/346234/">https://habr.com/ru/post/346234/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346220/index.html">11 libraries (sets of components) for Vue, which is worth knowing in 2018</a></li>
<li><a href="../346222/index.html">"Letter to the Turkish Sultan" or linear regression on C # using Accord.NET for the analysis of open data in Moscow</a></li>
<li><a href="../346228/index.html">How to read math</a></li>
<li><a href="../346230/index.html">Reverse Engineering Star Wars: Yoda Stories</a></li>
<li><a href="../346232/index.html">MSSQL Server. Example of using linked server</a></li>
<li><a href="../346236/index.html">Knowledge Representations in Intelligent Systems, Expert Systems</a></li>
<li><a href="../346238/index.html">Ramp for the site</a></li>
<li><a href="../346242/index.html">Reactive forms (reactive forms) Angular 5 (2+) Part 1</a></li>
<li><a href="../346244/index.html">Simulation of events and operations</a></li>
<li><a href="../346248/index.html">Experience in the project for interns as a mentor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>