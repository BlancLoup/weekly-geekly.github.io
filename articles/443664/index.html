<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Weather Station Arduino</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Weather Station Arduino 


 I decided to write a detailed article describing all aspects of creating an Arduino meteorological station, since it is di...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Weather Station Arduino</h1><div class="post__text post__text-html js-mediator-article"><h2>  Weather Station Arduino </h2><br><p>  I decided to write a detailed article describing all aspects of creating an Arduino meteorological station, since it is difficult to immediately cover the whole process.  My performance of the weather station is convenient because its data is stored on a computer. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/sBqkzON_YKQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><div class="spoiler">  <b class="spoiler_title">What is necessary</b> <div class="spoiler_text"><ul><li>  local network built using a wifi router </li><li>  computer </li><li><img src="https://habrastorage.org/webt/xb/q0/dy/xbq0dy-gp5qjd0j99ezolrwrxz0.jpeg" alt="arduino uno">  Arduino UNO (I used a Chinese replica.) <br></li><li>  USB cable, for connecting to Arduino. </li><li><img src="https://habrastorage.org/webt/xb/x4/vq/xbx4vqqfnzsavras07uqzi216uq.jpeg">  Barometer BME280 5V I2C (temperature, humidity, pressure sensor) <br></li><li>  soldering station with hairdryer </li><li>  solder 0.7 mm </li><li>  flux. </li><li><img src="https://habrastorage.org/webt/lr/ns/vh/lrnsvhg4egw1azrzl9v7zssjfrk.jpeg">  Wi-Fi module ESP8266 version ESP-01 <br></li><li>  4 cables mom-dad for a breadboard. </li><li>  4 papa dad cables for breadboard </li><li>  4 cables 50 cm long for a breadboard. </li><li>  8 thin shrinkable tubes of length 10 cm each. </li><li>  1 large heat shrink tubing with a diameter such that it includes ‚Äú4 cables 50 cm long for a breadboard‚Äù along with other heat shrink tubes </li></ul><br></div></div><br><h3>  Network configuration </h3><br><p>  Every computer on the network must see the device on which the server is located. It is advisable to install the same work groups on all computers on the network. </p><br> <a href=""><img src="https://habrastorage.org/webt/ud/9g/do/ud9gdo-xql0u2zohzhhjggrgggs.jpeg"></a> <p>  <i>Click to enlarge.</i> </p><br><hr><br><p>  <b>It should disable the bradmauzer and other firewalls.</b> </p><br><p>  In the network settings, in the properties of the wireless adapter, in the access account, put a tick at the beginning ‚Äúallow other users access‚Äù and then click the settings; <br>  in the settings we put all the checkboxes, instead of numbers you will see the names of the services. </p><br> <a href=""><img src="https://habrastorage.org/webt/tm/rp/iu/tmrpiumi5cfgy2z__uewznwfsfm.jpeg"></a> <p>  <i>Click to enlarge.</i> </p><br> <a href=""><img src="https://habrastorage.org/webt/l5/aj/oe/l5ajoew55mnqtr9or8wr5q7gvfq.jpeg"></a> <p>  <i>Click to enlarge.</i> </p><br><hr><br><p>  It is necessary to open port <em>80</em> and <em>3306</em> in the router.  I will show with the example of the Tenda router: first, to find out your <em>Local IP address</em> , to do this, click on the wireless network icon.  Next, in the opened panel, next to the name of your network, <em>Properties</em> will appear.  After, scroll down. </p><br> <a href=""><img src="https://habrastorage.org/webt/9a/sk/ui/9askui6kcvu7i04omioewoz5cpg.jpeg"></a> <p>  <i>Click to enlarge.</i> </p><br><hr><br><p>  Next, open the web page of the router, I have it <a href="http://192.168.0.1/">http://192.168.0.1</a> , enter the password from the router, click Advanched settings, then Virtal Server. Then enter <em>Local IP</em> first, and port <em>80.</em> Then repeat the operation, but enter port <em>3306</em> . </p><br> <a href=""><img src="https://habrastorage.org/webt/j7/wd/3u/j7wd3umngfpeofjenbduzck8ivq.jpeg"></a> <p>  Click to enlarge. </p><br> <a href=""><img src="https://habrastorage.org/webt/1o/ji/tt/1ojittsmyle-r6cg36dzxxjyfdw.jpeg"></a> <p>  <i>Click to enlarge.</i> </p><br><br><hr><br><p>  We need the following components: <br><br></p><ul><li>  <em>Apache</em> - data from the weather station will be sent here. </li><li>  <em>PHP</em> - will pick up data from the weather station, and save the database. </li><li>  <em>Mysql</em> is the database where the temperature will be saved, since only PHP cannot provide mapping for several computers and other devices. </li><li>  <em>HeidiSQL</em> - <em>viewer</em> and editor of the database (you can use any other, for example: "PhpMyAdmin"). </li></ul><br><p>  I will not describe the <em>Apache</em> server setup in detail, there is a lot of information on the Internet. The main <em>thing is to</em> configure <em>Apache</em> and <em>MySQL</em> for visibility on the local network. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After that, create a table in the database - the temperature will be stored there. <br><br>  An example of my handler page (sensor readings) on the server: </p><br><br><div class="spoiler">  <b class="spoiler_title">PHP code</b> <div class="spoiler_text"><pre><code class="php hljs">$link = mysqli_connect(<span class="hljs-string"><span class="hljs-string">"   "</span></span>, <span class="hljs-string"><span class="hljs-string">"root"</span></span>, <span class="hljs-string"><span class="hljs-string">"  "</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$link) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">":     MySQL."</span></span> . PHP_EOL; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"  errno: "</span></span> . mysqli_connect_errno() . PHP_EOL; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"  error: "</span></span> . mysqli_connect_error() . PHP_EOL; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"  MySQL !"</span></span> . PHP_EOL; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"  : "</span></span> . mysqli_get_host_info($link) . PHP_EOL; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'temp'</span></span>])){ $c=$_GET[<span class="hljs-string"><span class="hljs-string">'temp'</span></span>]; $vlah=$_GET[<span class="hljs-string"><span class="hljs-string">'vlah'</span></span>]; $davlen=$_GET[<span class="hljs-string"><span class="hljs-string">'davlen'</span></span>]; $sql = <span class="hljs-string"><span class="hljs-string">"UPDATE `temp1` SET `C`='$c',`vlah`='$vlah',`davlen`='$davlen' WHERE `id`='1'"</span></span>;<span class="hljs-comment"><span class="hljs-comment">//     mysqli_query($link,$sql); } echo"&lt;br&gt;"; $sql1="SELECT * FROM `temp1`";//  $result = mysqli_query($link,$sql1); $row = mysqli_fetch_all($result,MYSQLI_NUM); echo " "; echo $row[count($row)-1][0]; echo " C"; echo"&lt;br&gt;"; echo " "; echo $row[count($row)-1][1]; echo "hPa"; echo"&lt;br&gt;"; echo " "; echo $row[count($row)-1][2]; echo "%";</span></span></code> </pre> <br></div></div><br><h3>  3. Configuring esp8266 </h3><br><p>  Connect the esp-01 to the adapter and connect it to the Arduino as follows: <em>Rx-RX, TX-TX, GND-GND, VCC-5V</em> ; <br>  Ground the <em>RESET</em> Arduino port to <em>GND</em> ; </p><br> <a href=""><img src="https://habrastorage.org/webt/na/n8/3k/nan83kwjixwsyljtavnoforknnm.jpeg"></a> <p>  <a href=""><i>Click to enlarge.</i></a> </p><br><br><p>  Connect the arduino to the computer, open the <em>Arduino IDE</em> , then the <em>Serial Monitor</em> . Then select the Rate <em>115200</em> , and <br>  <em>Both NL &amp; CR</em> . <br></p><br> <a href=""><img src="https://habrastorage.org/webt/hz/w_/jg/hzw_jgmc7muyjvzrfsq9gvd6zwa.jpeg"></a> <p>  <a href=""><i>Click to enlarge.</i></a> </p><br><ol><li>  Enter the <b>AT</b> command. </li><li>  Flashing <b>OK</b> . </li><li>  Enter <b>AT + RESTORE</b> , this will ask the module for factory settings. </li><li>  Enter <b>AT + CWMODE_CUR = 1</b> , this <b>puts the</b> module in client mode. </li><li>  Enter <b>AT + CWJAP_CUR = ‚ÄúNetwork_Name‚Äù, ‚ÄúPassword‚Äù</b> - connection to <b>Wi-Fi</b> . </li><li>  Flashing <b>OK</b> if a connection has occurred. </li></ol><br><h3>  Bme280 setup and final build </h3><br><p>  Connect the pins according to the diagram (attention is shown on the diagram esp8266 without an adapter, but in reality it must be connected to an adapter, and already from <br>  Adapter 4 outputs have the same function as shown in the diagram.  ) </p><br> <a href=""><img src="https://habrastorage.org/webt/2y/gz/8w/2ygz8w6joha1nexv-e5fdezoqus.jpeg"></a> <p>  <a href=""><i>Click to enlarge.</i></a> </p><br><p>  Open the Arduino IDE and paste the following code: </p><br><div class="spoiler">  <b class="spoiler_title">Arduino IDE Code</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#include &lt;Wire.h&gt; void setup(){ Wire.begin(); Serial.begin(9600); while (!Serial); Serial.println("\nI2C Scanner"); } void loop(){ byte error, address; int nDevices; Serial.println("Scanning..."); nDevices = 0; for(address = 8; address &lt; 127; address++ ){ Wire.beginTransmission(address); error = Wire.endTransmission(); if (error == 0){ Serial.print("I2C device found at address 0x"); if (address&lt;16) Serial.print("0"); Serial.print(address,HEX); Serial.println(" !"); nDevices++; } else if (error==4) { Serial.print("Unknow error at address 0x"); if (address&lt;16) Serial.print("0"); Serial.println(address,HEX); } } if (nDevices == 0) Serial.println("No I2C devices found\n"); else Serial.println("done\n"); delay(5000);</code> </pre><br></div></div><br><p>  Open <em>Serial Monitor</em> , and remember the highlighted IC2 adress. <br>  Download Libraries <a href="https://github.com/adafruit/Adafruit_BME280_Library">Library Sensor</a> , <a href="https://github.com/adafruit/Adafruit_Sensor">Touch Library</a> and unpack them in <em>C: \ Users \ user \ Documents \ Arduino</em> .  Open up <br>  <em>C: \ Users \ user \ Documents \ Arduino \ libraries \ Adafruit_BME280_Library-master</em> and change the address: </p><br> <a href=""><img src="https://habrastorage.org/webt/6h/zj/wj/6hzjwjvtf2-tqipynjsl6nneqck.jpeg" width="200" height="200"></a> <p>  <a href="">Click to enlarge.</a> </p><br><p>  Open the Arduino IDE and place the code: </p><br><div class="spoiler">  <b class="spoiler_title">Arduino IDE Code</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#include &lt;SoftwareSerial.h&gt; #define RX 10//    esp8266 #define TX 11//    esp8266 String AP = "Aleks"; //   String PASS = "1brui47ci881"; //  String HOST = "192.168.0.185";//   String PORT = "80";//  String field = "field1"; int countTrueCommand; int countTimeCommand; boolean found = false; int valSensor = 1; SoftwareSerial esp8266(RX,TX); #include &lt;Wire.h&gt; #include &lt;SPI.h&gt; #include &lt;Adafruit_Sensor.h&gt; #include &lt;Adafruit_BME280.h&gt; #define BME_SCK 13 #define BME_MISO 12 #define BME_MOSI 11 #define BME_CS 10 #define SEALEVELPRESSURE_HPA (1013.25) Adafruit_BME280 bme; // I2C //Adafruit_BME280 bme(BME_CS); // hardware SPI //Adafruit_BME280 bme(BME_CS, BME_MOSI, BME_MISO, BME_SCK); // software SPI unsigned long delayTime; void setup() { Serial.begin(9600); bool status; // default settings // (you can also pass in a Wire library object like &amp;Wire2) status = bme.begin(); if (!status) { Serial.println("Could not find a valid BME280 sensor, check wiring!"); while (1); } esp8266.begin(115200); sendCommand("AT",5,"OK"); sendCommand("AT+CWMODE=1",5,"OK"); sendCommand("AT+CWJAP=\""+ AP +"\",\""+ PASS +"\"",20,"OK"); sendCommand("AT+CIPMUX=1",5,"OK"); } void loop() { float vlah=bme.readPressure() / 100.0F; sendCommand("AT+CIPSTART=0,\"TCP\",\""+ HOST +"\","+ PORT,15,"OK"); String cmd = "GET /?temp="+String(bme.readTemperature())+"&amp;vlah="+String(vlah)+"&amp;davlen="+String(bme.readHumidity())+" HTTP/1.1\r\nHost: 192.168.0.185\r\n\r\n";// GET    ,temp,vlah,davlen           . sendCommand("AT+CIPSEND=0," +String(cmd.length()+4),4,"&gt;"); esp8266.println(cmd);delay(1500);countTrueCommand++; sendCommand("AT+CIPCLOSE=0",5,"OK"); delay(100000); } void printValues() { Serial.print("Temperature = "); Serial.print(bme.readTemperature()); Serial.println(" *C"); Serial.print("Pressure = "); Serial.print(bme.readPressure() / 100.0F); Serial.println(" hPa"); Serial.print("Humidity = "); Serial.print(bme.readHumidity()); Serial.println(" %"); Serial.println(); } void sendCommand(String command, int maxTime, char readReplay[]) { Serial.print(countTrueCommand); Serial.print(". at command =&gt; "); Serial.print(command); Serial.print(" "); while(countTimeCommand &lt; (maxTime*1)) { esp8266.println(command);//at+cipsend if(esp8266.find(readReplay))//ok { found = true; break; } countTimeCommand++; } if(found == true) { Serial.println("OYI"); countTrueCommand++; countTimeCommand = 0; } if(found == false) { Serial.println("Fail"); countTrueCommand = 0; countTimeCommand = 0; } found = false; }</code> </pre> <br></div></div><br><p>  Is done.  These temperatures are transmitted as variables to the database. <br><br>  As you can see, my weather station requires a basic knowledge of web programming, but the result is worth it. </p><br><div class="spoiler">  <b class="spoiler_title">Sources</b> <div class="spoiler_text"><ol><li>  <a href="https://hackware.ru/%3Fp%3D21">Installing a Web server.</a> <br></li><li>  <a href="https://medium.com/%40kasunsiyambalapitiya/how-to-setup-a-mysql-server-on-local-area-network-lan-c3c5012c7d6b">Apache set</a> <br></li><li>  <a href="https://arduinomania.in.ua/index.php%3Froute%3Dblog/article%26article_id%3D23">ic2 scaner</a> <br></li><li>  <a href="https://medium.com/%40cgrant/using-the-esp8266-wifi-module-with-arduino-uno-publishing-to-thingspeak-99fc77122e82">ESP8266</a> <br></li></ol></div></div><p></p></div><p>Source: <a href="https://habr.com/ru/post/443664/">https://habr.com/ru/post/443664/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../443652/index.html">Every day by Outlook I have just flour ...</a></li>
<li><a href="../443654/index.html">In the wake of calculators: Qalculate</a></li>
<li><a href="../443658/index.html">Setting up a Kubernetes HA cluster on bare metal, monitoring, logs and usage examples. Part 3/3</a></li>
<li><a href="../443660/index.html">Experts: "3D-scanner will cost 10 times cheaper than the error in the traditional quality control"</a></li>
<li><a href="../443662/index.html">Understanding Clean Code in Android</a></li>
<li><a href="../443666/index.html">Our approach to coloring the flow</a></li>
<li><a href="../443670/index.html">Error in new version of Google Chrome (73.0.3683.75)</a></li>
<li><a href="../443672/index.html">Risk based testing</a></li>
<li><a href="../443674/index.html">Anonymous prepaid cards - how, to whom and why?</a></li>
<li><a href="../443676/index.html">Vinyl instead of a postage stamp: an unusual rarity</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>