<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Wine Check: One Year Later</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Just over a year ago, the Wine project was taken to write an article on checking a project with the help of PVS-Studio. The article was written, the a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Wine Check: One Year Later</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/e97/afe/61f/e97afe61f4af5ea87c025a699217dce0.png" align="left">  Just over a year ago, the Wine project was taken to write an article on checking a project with the help of PVS-Studio.  The article was written, the authors were notified and even asked for a full report of the check by the analyzer, and received a positive response.  Recently, we wrote one of the developers of the project.  The article will tell you about our communication, the work done by the Wine project team to improve the code and what remains to be done. <br><a name="habracut"></a><br><h2>  Introduction </h2><br>  <a href="http://winehq.org/">Wine</a> (Wine Is Not Emulator - Wine is not an emulator) is a set of programs that allows Linux, Mac, FreeBSD, and Solaris users to run Windows applications without having to install Microsoft Windows on the computer itself.  Wine is an actively developing cross-platform free software distributed under the GNU Lesser General Public License. <br><br>  In August 2014, the article was published: <a href="http://www.viva64.com/ru/b/0272/">Checking Wine with PVS-Studio and Clang Static Analyzer</a> .  We recently received a letter from one of the Wine developers, Michael Stefaniuc.  In the letter, he thanked the PVS-Studio team for using the static analyzer and providing the report. <br><br>  He also brought a small statistic to correct the analyzer warnings for the year.  <a href="http://source.winehq.org/git/wine.git/search/HEAD%3Fpg%3D0%3Bs%3DPVS-Studio%3Bst%3Dcommit">You</a> can find about 180 commits with <a href="http://source.winehq.org/git/wine.git/search/HEAD%3Fpg%3D0%3Bs%3DPVS-Studio%3Bst%3Dcommit">this link</a> , containing source code fixes marked ‚ÄúPVS-Studio‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Figure 1 shows the statistics for the correction of the 20 most useful, from the authors point of view, types of analyzer warnings for a project. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6f3/3dd/c69/6f33ddc69a59564b06dd22cc52c6f875.png"></div><br>  <font color="#999999"><i>Figure 1 - The top 20 successful error codes for Wine</i></font> <br><br>  Michael explained that it is already difficult to combine the current source code with the old report of the analyzer and asked to check the project again.  The Wine project is actively developing, the PVS-Studio static analyzer is also actively developing, so I decided to check this project again.  The result was this small note where I describe the 10 most suspicious sections of code.  Naturally, developers have received a full report and will be able to explore other potentially dangerous places. <br><br><h2>  Top 10 Warnings </h2><br><h3>  V650 warning </h3>  <a href="http://www.viva64.com/ru/d/0269/">V650</a> Type casting operation is used 2 times in succession.  Next, the '+' operation is executed.  Probably meant: (T1) ((T2) a + b).  descriptor.c 967 <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">WINE_HIDP_PREPARSED_DATA* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build_PreparseData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... wine_report = (WINE_HID_REPORT*)((BYTE*)wine_report)+wine_report-&gt;dwSize; .... }</code> </pre> <br>  The analyzer has detected an addition operation with a variable with which a double type conversion is performed.  Most likely, they forgot to conclude the first type conversion and addition operation in brackets.  Above the code there is exactly the same fragment, only with parentheses: <br><br><pre> <code class="cpp hljs">wine_report = (WINE_HID_REPORT*)(((BYTE*)wine_report)+wine_report-&gt;dwSize);</code> </pre> <br><h3>  V590 warning </h3>  <a href="http://www.viva64.com/ru/d/0194/">V590</a> Consider inspecting the 'lret == 0 ||  lret! = 234 'expression.  The expression is misprint.  winemenubuilder.c 3430 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cleanup_menus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) { .... lret = RegEnumValueW(....); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lret == ERROR_SUCCESS || lret != ERROR_MORE_DATA) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; .... }</code> </pre> <br>  The code has a redundant comparison "lret == ERROR_SUCCESS".  Apparently there is a logical error.  The condition is true for all values ‚Äã‚Äãof the 'lret' variable that are not equal to 'ERROR_MORE_DATA'.  For clarity, you can look at the truth table in Figure 2. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ea9/857/85c/ea985785c3f11da3b8f279e35f4ae918.png"></div><br>  <font color="#999999"><i>Figure 2 - The truth table of the conditional expression</i></font> <br><br>  Two columns are highlighted in red, where the results of logical operations completely coincide. <br><br>  Another such place: <ul><li>  V590 Consider inspecting the 'last_error == 183 ||  last_error! = 3 'expression.  The expression is misprint.  schedsvc.c 90 </li></ul><br><h3>  Warning v576 </h3>  <a href="http://www.viva64.com/ru/d/0176/">V576</a> Incorrect format.  Consider checking the fourth argument of the printf function.  To print the value of the% p 'should be used.  msvcirt.c 828 <br><br><pre> <code class="cpp hljs">DEFINE_THISCALL_WRAPPER(streambuf_dbp, <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> __<span class="hljs-function"><span class="hljs-function">thiscall </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">streambuf_dbp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(streambuf *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">" base()=%p, ebuf()=%p, blen()=%d\n"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;base, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;ebuf, streambuf_blen(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"pbase()=%p, pptr()=%p, epptr()=%d\n"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;pbase, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;pptr, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;epptr); <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"eback()=%p, gptr()=%p, egptr()=%d\n"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;eback, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;gptr, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;egptr); .... }</code> </pre> <br>  The analyzer detected a suspicious place where the pointer value is attempted to be printed using the '% d' specifier.  Writing this code fragment was most likely done by copy-paste method.  It can be assumed that first the first call to the printf () function was written, the last argument in which correctly corresponds to the used specifier '% d'.  But then this line was copied two more times and the pointer was passed as the last argument, and the format of the line was forgotten. <br><br><h3>  Warning v557 </h3>  <a href="http://www.viva64.com/ru/d/0148/">V557</a> Array overrun is possible.  The '16' index is pointing beyond array bound.  winaspi32.c 232 <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* SCSI Miscellaneous Stuff */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> SENSE_LEN 14 typedef struct tagSRB32_ExecSCSICmd { .... BYTE SenseArea[SENSE_LEN+2]; } SRB_ExecSCSICmd, *PSRB_ExecSCSICmd; static void ASPI_PrintSenseArea(SRB_ExecSCSICmd *prb) { BYTE *rqbuf = prb-&gt;SenseArea; .... </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (rqbuf[15]&amp;0x8) { TRACE(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Pointer at %d, bit %d\n"</span></span></span><span class="hljs-meta">, rqbuf[16]*256+rqbuf[17],rqbuf[15]&amp;0x7); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//&lt;== } .... }</span></span></span></span></code> </pre> <br>  The analyzer detected memory access outside the 'rgbuf' array to elements with indices 16 and 17. The array itself contains only 16 elements.  Perhaps the ‚Äúrqbuf [15] &amp; 0x8‚Äù condition is rarely true and such an error was not noticed. <br><br><h3>  V711 Warning </h3>  It is a variable in this loop.  dplobby.c 765 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HRESULT WINAPI </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IDirectPlayLobby3AImpl_EnumAddressTypes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... FILETIME filetime; .... <span class="hljs-comment"><span class="hljs-comment">/* Traverse all the service providers we have available */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( dwIndex=<span class="hljs-number"><span class="hljs-number">0</span></span>; RegEnumKeyExA( hkResult, dwIndex, subKeyName, &amp;sizeOfSubKeyName, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, &amp;filetime ) != ERROR_NO_MORE_ITEMS; ++dwIndex, sizeOfSubKeyName=<span class="hljs-number"><span class="hljs-number">50</span></span> ) { .... FILETIME filetime; .... <span class="hljs-comment"><span class="hljs-comment">/* Traverse all the address type we have available */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( dwAtIndex=<span class="hljs-number"><span class="hljs-number">0</span></span>; RegEnumKeyExA( hkServiceProviderAt, dwAtIndex, atSubKey, &amp;sizeOfSubKeyName, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, &amp;filetime ) != ERROR_NO_MORE_ITEMS; ++dwAtIndex, sizeOfSubKeyName=<span class="hljs-number"><span class="hljs-number">50</span></span> ) { .... } .... } .... }</code> </pre> <br>  In the loop body, a declaration was found of the variable ‚Äúfiletime‚Äù, which coincides with the variable used to control the loop.  This will lead to a loss of local changes to the ‚Äúfilename‚Äù when exiting the internal loop.  Looking at the entire function code, it can be assumed that a large code fragment was copied into the body of the loop with minor changes.  It may not be a serious danger, anyway it is a bad programming style. <br><br><h3>  V530 Warning </h3>  <a href="http://www.viva64.com/ru/d/0119/">V530</a> DSCF_AddRef is required to be utilized.  dsound_main.c 760 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> ULONG WINAPI </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DSCF_AddRef</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LPCLASSFACTORY iface)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-function"><span class="hljs-function">HRESULT WINAPI </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DllGetClassObject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">NULL</span></span> != DSOUND_CF[i].rclsid) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsEqualGUID(rclsid, DSOUND_CF[i].rclsid)) { DSCF_AddRef(&amp;DSOUND_CF[i].IClassFactory_iface); <span class="hljs-comment"><span class="hljs-comment">//&lt;== *ppv = &amp;DSOUND_CF[i]; return S_OK; } i++; } .... }</span></span></code> </pre> <br>  The code found the function DSCF_AddRef (), the return value of which is not used.  Moreover, this function does not change any state in the program.  This is a very suspicious place that developers need to check. <br><br><h3>  Warning v593 </h3>  <a href="http://www.viva64.com/ru/d/0197/">V593</a> Consider reviewing the A = B &lt;C 'kind.  The expression is calculated as the following: 'A = (B &lt;C)'.  user.c 3247 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">DWORD WINAPI </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormatMessage16</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ret; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sz; LPSTR b = HeapAlloc(..., sz = <span class="hljs-number"><span class="hljs-number">100</span></span>); argliststart=args+insertnr<span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* CMF - This makes a BIG assumption about va_list */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((ret = vsnprintf(....) &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) || (ret &gt;= sz)) { sz = (ret == <span class="hljs-number"><span class="hljs-number">-1</span></span> ? sz + <span class="hljs-number"><span class="hljs-number">100</span></span> : ret + <span class="hljs-number"><span class="hljs-number">1</span></span>); b = HeapReAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, b, sz); } .... }</code> </pre> <br>  The priority of logical operations is higher than the priority of an assignment operation.  Thus, in this expression, the expression ‚Äúvsnprintf (....) &lt;0‚Äù is calculated first, therefore the variable 'ret' will not save the number of written characters, but the value 0 or 1. The expression ‚Äúret&gt; = sz‚Äù will always be false therefore, the loop will be executed only if the unit is written in 'ret'.  Such a scenario will be possible if the vsnprintf () function fails and returns a negative value. <br><br><h3>  V716 Warning </h3>  <a href="http://www.viva64.com/ru/d/0357/">V716</a> Suspicious type conversion in return statement: returned HRESULT, but the function actually returns BOOL.  ordinal.c 5198 <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_INVALIDARG _HRESULT_TYPEDEF_(0x80070057) BOOL WINAPI SHPropertyBag_ReadLONG(....) { VARIANT var; HRESULT hr; TRACE(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%p %s %p\n"</span></span></span><span class="hljs-meta">, ppb,debugstr_w(pszPropName),pValue); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (!pszPropName || !ppb || !pValue) return E_INVALIDARG; V_VT(&amp;var) = VT_I4; hr = IPropertyBag_Read(ppb, pszPropName, &amp;var, NULL); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (SUCCEEDED(hr)) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (V_VT(&amp;var) == VT_I4) *pValue = V_I4(&amp;var); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> hr = DISP_E_BADVARTYPE; } return hr; }</span></span></code> </pre> <br>  There are many places in the Wine project where the HRESULT type is converted to BOOL or simply work with a variable of this type as a boolean value.  The danger is that the HRESULT type is rather complicated and should signal whether the operation was successful, what result was returned after the operation was completed, in case of an error ‚Äî where the error occurred, the circumstances of this error, and so on. <br><br>  Fortunately, the developers are actively fixing such places and in the bug tracker you can find a lot of related commits. <br><br><h3>  Warning v523 </h3>  <a href="http://www.viva64.com/ru/d/0112/">V523</a> The 'then' statement is equivalent to the 'else' statement.  resource.c 661 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">WORD WINAPI </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDialog32Size16</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( LPCVOID dialog32 )</span></span></span><span class="hljs-function"> </span></span>{ .... p = (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DWORD *)p + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* x */</span></span> p = (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DWORD *)p + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* y */</span></span> p = (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DWORD *)p + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* cx */</span></span> p = (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DWORD *)p + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* cy */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dialogEx) p = (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DWORD *)p + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* ID */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> p = (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DWORD *)p + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* ID */</span></span> .... }</code> </pre> <br>  The analyzer detected a condition with the same code blocks.  Perhaps the code snippet was just copied and forgot to change. <br><br><h3>  Warning v519 </h3>  <a href="http://www.viva64.com/ru/d/0108/">V519</a> The 'res' variable is assigned twice successively.  Perhaps this is a mistake.  Check lines: 5905, 5907. action.c 5907 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_publish_components</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ .... res = RegCreateKeyExA(....); res = RegSetValueExA(....); ok(res == ERROR_SUCCESS, <span class="hljs-string"><span class="hljs-string">"RegSetValueEx failed %d\n"</span></span>, res); RegCloseKey(key); .... }</code> </pre> <br>  Testing should ensure the reliability of the application, and if errors are made in the tests, then the trouble.  In this code snippet, we forgot to check the result of one function and immediately went on to get and check the value of another function. <br><br><h2>  Conclusion </h2><br>  In response to a request to re-check the project, we sent a fresh report from the <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> analyzer and a temporary product key for easy viewing of the report using the plug-in tools for Visual Studio or the Standalone utility.  Over the year, the code of the Wine project has become much cleaner from the point of view of our analyzer, now developers can still improve their code. <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0352/"><img src="https://habrastorage.org/getpro/habr/post_images/35e/064/ddf/35e064ddf91f5d99b620384893909ff7.png"></a> </div><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Svyatoslav Razmyslov.  <a href="http://www.viva64.com/en/b/0352/">Analyzing Wine: One Year Later</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected the answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/269265/">https://habr.com/ru/post/269265/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269253/index.html">Intel RealSense R200 Camera - Code Samples</a></li>
<li><a href="../269255/index.html">HP Helion OpenStack Carrier Grade - cloud for telecom operators</a></li>
<li><a href="../269259/index.html">Emoji Encryption</a></li>
<li><a href="../269261/index.html">Back to the future, or Hello World today and thirty years ago</a></li>
<li><a href="../269263/index.html">Alpha version of SocketPush - universal notifications for all browsers + 3 million free notifications</a></li>
<li><a href="../269267/index.html">Knowledge Management with KCS</a></li>
<li><a href="../269269/index.html">Let's Encrypt is now trusted</a></li>
<li><a href="../26927/index.html">‚ÄúRevived‚Äù billboards</a></li>
<li><a href="../269271/index.html">Go Planner</a></li>
<li><a href="../269273/index.html">Algorithm for extracting information in ABBYY Compreno. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>