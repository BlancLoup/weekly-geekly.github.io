<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As I wrote the standard C ++ 11 library or why the boost is so scary. Introduction</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Instead of the preface 
 Perhaps this story should begin any story about boost , Loki , independent, and also supplied with the compilers implementati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As I wrote the standard C ++ 11 library or why the boost is so scary. Introduction</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/lr/zq/if/lrzqifvfeajppx2fdvqbxnwf4ce.png" alt="Yes - yes, with this motto I rushed into battle." width="300" height="350" align="left"><h3>  Instead of the preface </h3><br>  Perhaps this story should begin any story about <a href="https://www.boost.org/">boost</a> , <a href="https://ru.wikipedia.org/wiki/Loki">Loki</a> , independent, and also supplied with the compilers implementations of the standard library C ++. <br><br>  Yes, yes, and if you thought that the developers of the standard library for the same g ++, clang, Visual Studio, or God forgive me, C ++ Builder (formerly Borland, and the current Embarcadero) are gurus that do not cram down crutches, do not break the standard under their compiler and do not write bicycles, then, most likely, you are not actively using the standard C ++ library as you thought. <br><br>  The article is written as a story, and contains a lot of ‚Äúwater‚Äù and digressions, but I hope that my experience and the resulting code will be useful for those who have encountered similar problems when developing in C ++, especially on older compilers.  Link to GitHub with the result today for the impatient and non-readers: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote>  <a href="https://github.com/oktonion/stdex">https://github.com/oktonion/stdex</a> (commits and constructive criticism are welcome) </blockquote><br>  And now, first things first. <br><a name="habracut"></a><br><br><h4>  Table of contents </h4><br>  <b>Introduction</b> <b><br></b>  <b>Chapter 1. Viam supervadet vadens</b> <br>  <a href="https://habr.com/post/417099/">Chapter 2. #ifndef __CPP11_SUPPORT__ #define __COMPILER_SPECIFIC_BUILT_IN_AND_MACRO_HELL__ #endif</a> <br>  <a href="https://habr.com/post/417295/">Chapter 3. Finding the perfect implementation of nullptr</a> <br>  <a href="https://habr.com/post/417547/">Chapter 4. C ++ Template "Magic"</a> <br>  .... <a href="https://habr.com/post/417547/">4.1 Starting small</a> <br>  .... <a href="https://habr.com/post/417949/">4.2 How many we get wonderful errors are compiled by the log</a> <br>  .... <a href="https://habr.com/post/418347/">4.3 Pointers and all-all-all</a> <br>  .... <a href="https://habr.com/post/420365/">4.4 What else is needed for the template library</a> <br>  Chapter 5 <br>  ... <br><br><h3>  Introduction </h3><br>  The year was 2017, C ++ 11 has long been burst into a new stream of new and relatively new compilers, bringing standardized work with threads, mutexes, expanded template programming and standardized approaches to it, there are ‚Äúbig‚Äù types <b>long long</b> <u>in the standard</u> , finally got rid of the ubiquitous need to output types for the compiler using <b>auto</b> (goodbye <i>std :: map &lt;type, type&gt; :: const_iterator it = ...</i> - well, you understand me), and a bunch of this possibility with the new <b>for each</b> has become one of the most common used loop implementations by iterators.  Finally, we (the developers) were able to humanly tell the user (developer) why the code is not collected using <b>static_assert</b> , as well as <b>enable_if</b> , that selected the required overloads now as if by magic. <br><br>  It was 2017 in the yard!  Already C ++ 17 was actively introduced into GCC, clang, Visual Studio, everywhere there was <b>decltype</b> (since C ++ 11), <b>constexpr</b> (since C ++ 11, but significantly improved), modules are almost on the way, there was a good time.  I was at work, and with some disapproval, I looked at the next Internal Compiler Error in my Borland C ++ Builder 6.0, as well as at the many build errors with the next version of the boost library.  I think now you understand where this craving for cycling has come from.  We used Borland C ++ Builder 6.0 and Visual Studio 2010 under Windows, g ++ version 4.4.2 or lower under <a href="https://ru.wikipedia.org/wiki/QNX">QNX</a> and under some unix systems.  We were spared from MacOS, which undoubtedly was a plus.  There could be no talk of any other compilers (including C ++ 11), for reasons that we leave outside of this article. <br><br>  ‚ÄúAnd what could be so complicated there?‚Äù - the thought crept into my exhausted attempts to start a boost under the good old builder's brain.  ‚ÄúI just need <b>type_traits</b> , <b>thread</b> , <b>mutex</b> , maybe <b>chrono</b> , <b>nullptr</b> would be nice, <b>too</b> ,‚Äù I reasoned and set to work. <br><br><h3>  Chapter 1. Viam supervadet vadens </h3><br>  It was necessary to start somewhere, and start somewhere. Naturally, I had a number of header files and source files scattered around projects with implementations of a similar or identical functionality from the C ++ 11 standard library of my development, as well as honestly borrowed or reworked from codes same gcc and boost.  Combining all this together, I got some porridge from functions, classes, macros, which was supposed to turn into an elegant and slim standard library.  Assessing the amount of work, I immediately decided to abandon the implementation of everything and everything, limiting myself to developing the ‚Äúadd-on‚Äù over the standard C ++ 98 library supplied with the compiler. <br><br>  In the initial version there was no special adherence to the standard, mainly applied tasks were solved.  For example, <b>nullptr</b> looked like this: <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> nullptr 0</span></span></code> </pre> <br>  <b>static_assert</b> was solved too simply: <br><br><pre> <code class="cpp hljs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> STATIC_ASSERT(expr) typedef int test##__LINE__##[expr ? 1 : -1];</span></span></code> </pre><br>  <i>std :: to_string</i> was implemented via <i>std :: stringstream</i> , which was replaced by <i>std :: strstream</i> in implementations without the <i>sstream</i> header file, all of which was shoved immediately into the <b>namespace std</b> : <br><br><pre> <code class="cpp hljs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> NO_STD_SSTREAM_HEADER #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;sstream&gt; #else #include &lt;strstream&gt; namespace std {typedef std::strstream stringstream;} #endif namespace std { template&lt;class T&gt; string to_string(const T &amp;t) { stringstream ss; ss &lt;&lt; t; return ss.str(); } }</span></span></span></span></code> </pre><br>  There were also "tricks" that are not included in the standard, but nevertheless useful in everyday work, such as the <b>forever</b> or <b>countof macros</b> : <br><br><pre> <code class="cpp hljs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> forever for(;;) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//     #define countof(arr) sizeof(arr) / sizeof(arr[0]) //        C</span></span></span></span></code> </pre><br>  <b>countof</b> then transformed into a more C ++ version: <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> N&gt; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>(&amp;COUNTOF_REQUIRES_ARRAY_ARGUMENT(T(&amp;)[N]))[N]; <span class="hljs-comment"><span class="hljs-comment">//        C++ (       ): #define countof(x) sizeof(COUNTOF_REQUIRES_ARRAY_ARGUMENT(x))</span></span></code> </pre><br>  Work with threads (header file from std) was implemented through some of the Tiny libraries, rewritten taking into account the features of the entire compiler zoo and OS.  And unless <b>type_traits</b> to some extent was already similar to what the C ++ standard required. 11. There was <i>std :: enable_if</i> , <i>std :: integral_constant</i> , <i>std :: is_const,</i> and similar templates that were already used in development. <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Cond, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Iftrue</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Iffalse</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">conditional</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> Iftrue type; }; <span class="hljs-comment"><span class="hljs-comment">// Partial specialization for false. template&lt;class Iftrue, class Iffalse&gt; struct conditional&lt;false, Iftrue, Iffalse&gt; { typedef Iffalse type; }; template &lt;bool, class T = void&gt; struct enable_if { }; template &lt;class T&gt; struct enable_if&lt;true, T&gt; { typedef T type; }; template&lt;class Tp, Tp Val&gt; struct integral_constant { // convenient template for integral constant types static const Tp value = Val; typedef const Tp value_type; typedef integral_constant&lt;Tp, Val&gt; type; }; typedef integral_constant&lt;bool, true&gt; true_type; typedef integral_constant&lt;bool, false&gt; false_type; template&lt;bool Val&gt; struct bool_constant : public integral_constant&lt;bool, Val&gt; { }; template&lt;class, class&gt; struct is_same : public false_type { }; template&lt;class Tp&gt; struct is_same&lt;Tp, Tp&gt; : public true_type // specialization { }; } // ...    </span></span></code> </pre><br>  It was decided to allocate all non-standard and ‚Äúcompiler‚Äù macros, functions, types into a separate header file <b>core.h.</b>  And, contrary to the practice of boost, where "switching" implementations with the help of macros are commonly used, the macros related to compiler- <b>dependent</b> things in all library files, except <b>core.h, should be abandoned to the maximum</b> .  Also, the functionality that can not be implemented without the use of "hacks" (violation of the standard, relying that Undefined Behavior will be Somewhat Defined), or implemented individually for each compiler (through its build-in macros for example), it was decided not to add to the library, so as not to produce one more monstrous (but wonderful) boost.  As a result, the main and practically the only thing <b>core.h is</b> used for is to determine if the built-in <b>nullptr supports</b> (because compilers swear if they override the reserved words), support the built-in <b>static_assert</b> (again to avoid overlapping the reserved word) and support the built-in C ++ types 11 <b>char16_t</b> and <b>char32_t</b> . <br><br>  Looking ahead, I can say that the idea almost succeeded, because  most of the fact that boost is determined depending on the specific compiler by hard macros, in this implementation it is determined by the compiler itself at the compilation stage. <br><br>  The end of the first chapter.  In the <a href="https://habr.com/post/417099/">second chapter,</a> I will continue the story about the difficulties of dealing with compilers, about the found crutches and elegant solutions in the depths of gcc, boost and Visual Studio, as well as describing my impressions of what I saw and the experience gained with code examples. <br><br>  Thank you for attention. <br></div><p>Source: <a href="https://habr.com/ru/post/417027/">https://habr.com/ru/post/417027/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../417011/index.html">TOP 10 new blockchain projects in 2018 - Forbes</a></li>
<li><a href="../417013/index.html">"Sand Dunes" of Pluto consist not of sand - these are pellets of frozen methane</a></li>
<li><a href="../417015/index.html">Understand what is written and what is not recorded application Burger King</a></li>
<li><a href="../417017/index.html">How a failed nuclear experiment spawned neutrino astronomy</a></li>
<li><a href="../417023/index.html">Rambler Group experience: how we started to fully control the formation and behavior of front-end React components</a></li>
<li><a href="../417029/index.html">Code profiling with LLVM</a></li>
<li><a href="../417031/index.html">Mobile OAuth 2.0 Security</a></li>
<li><a href="../417033/index.html">QIWI Kitchen from June 7th - videos of our speakers</a></li>
<li><a href="../417035/index.html">UnnyWorld: postmortem</a></li>
<li><a href="../417037/index.html">BEERBRAZZERS. Control the light. Vixen Lights 3. Quick Start (1/4)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>