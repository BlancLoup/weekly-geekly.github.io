<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simplify localization in iOS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to all! My name is Nikolai, I am iOS-Lead at Touch Instinct . In the development process often have to deal with projects that need to work i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simplify localization in iOS</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/934/a67/877/934a6787765945afbb26d53a6a721a51.png"><br><br><p>  Good day to all!  My name is Nikolai, I am iOS-Lead at <a href="https://touchin.ru/">Touch Instinct</a> .  In the development process often have to deal with projects that need to work in several languages.  I'll tell you what approach we came up with when working with localization. </p><br><h2 id="minusy-bazovyh-podhodov">  Cons of basic approaches </h2><br><p>  There are several basic approaches for localizing an iOS application.  First you need to decide whether the application is being developed using storyboards or not. </p><br><h4 id="s-ispolzovaniem-storyboards">  Using storyboards </h4><br><p>  You can localize the lines directly in the storyboard.  However, with this approach there are a number of minuses: </p><br><ul><li>  in the case of a large number of storyboards, localized lines are scattered around the project; </li><li>  the inability to use attribute lines, as well as lines that consist of several component parts; </li><li>  you still have to localize part of the lines in the code.  This leads to even more variation in the application; </li><li>  In fact, there is no possibility to check something for another developer when conducting a code review. </li></ul><br><h4 id="bez-storyboards">  No storyboards </h4><br><p>  In this case, we localize everything in the code.  However, there are a number of drawbacks.  The fact is that files with localization strings localizable.strings are magic.  When such files change, the probability of an error due to the human factor is very high.  Changes cannot be tracked until an error is found during the testing process. </p><br><p>  Thus, although there are already ready mechanisms for localization in the iOS SDK, they have significant drawbacks.  See <a href="https://developer.apple.com/library/content/documentation/MacOSX/Conceptual/BPInternational/LocalizingYourApp/LocalizingYourApp.html%3Futm_source%3Dswifting.io%26utm_medium%3Dweb%26utm_campaign%3Dblog%2520post">here for</a> more details. </p><br><a name="habracut"></a><br><h2 id="razbiraemsya-s-celyami">  We understand the goals </h2><br><p>  If the standard solutions do not cope, you should not immediately rush to make your "bike".  Formulate goals to be achieved. <br><br>  The main criteria that a future solution must meet are: </p><br><ul><li>  <strong>integration of localization resources for all mobile platforms supported on the project.</strong>  In mobile development, we most often do a project right under several platforms, usually iOS + Android.  The same application on different platforms will use the same resources for localization.  At the same time it should be possible to have specific lines for each individual platform. </li><li>  <strong>automatic addition of new localization lines in the project without the participation of the developer.</strong>  If the application uses multiple languages, the resources will be filled either by a translator or an intermediary between the translator and the project.  The mediator can be a manager or other team members.  Giving access to the code to non-technical experts is moveton.  It is best to keep localization resources somewhere in a third-party location.  At the same time it is necessary that developers do not add these resources ‚Äúhands‚Äù every time. </li><li>  <strong>detection of errors in the project when changing localization resources at the compilation stage.</strong>  The standard approach, which uses NSLocalizedString, assumes that if the string itself changes to localizable.strings, but the code does not change, then the application will be released with an error.  The very first screen for finding an error should be the project build process.  Changes to the localization strings, as well as errors resulting from changes, must be obtained at this stage. </li><li>  <strong>no magic lines in the project.</strong>  Any magical value in a project is evil.  You can clean them in different ways.  There is a path to the comments to the code or making magic values ‚Äã‚Äãin constants with speaking names. </li></ul><br><h2 id="lokalizaciya-v-touch-instinct">  Touch Instinct localization </h2><br><h4 id="sozdaem-repozitoriy-dlya-strok">  Create a repository for strings </h4><br><p>  First you need to create a separate repository in your version control system.  What should be stored in this repository?  It's simple.  Here json files of the common_strings_eng.json / common_strings_ru.json / etc type are stored.  A separate json file is created for each language. <br>  Consider the contents of such files.  Json is a text format for describing data as key-value pairs, so we create a key-name for each localized string and use it in all files.  Value is a localized value and will be displayed in the application itself. <br>  Our company has a <a href="">styleguide</a> to unify the keys in all applications and make them consistent within each project. </p><br><p>  An attentive reader may have several questions: </p><br><p>  1) When filling in json files, you can make a mistake and, for example, forget to fill in the value for some key in a certain language? </p><br><p>  Yes, it's true.  However, here responsibility is escalated to the level of a translator or a single person.  At the same time, you can easily create a script that goes through all the json files and shows where and what is missing in the files. </p><br><p>  2) This system uses an ‚Äúold‚Äù <a href="https://en.wikipedia.org/wiki/Plural">system for working with Plural</a> .  Is it convenient? </p><br><p>  A small educational program, what is plural.  In fact, these are noun forms depending on its quantity.  Example: 1 day, 2 days, 5 days.  Indeed, you can often hear from developers that working with the plural is difficult.  However, we concluded that such resources are extremely small in applications.  Receiving other benefits, this can be neglected.  About work of the standard mechanism for work with plural in the form of the dictionary <a href="https://developer.apple.com/library/content/documentation/MacOSX/Conceptual/BPInternational/StringsdictFileFormat/StringsdictFileFormat.html">you can look here</a> . </p><br><habracut><br><p>  Now we have a separate repository in which localized resources for the project are created. </p><br><p>  Example: </p><br><pre><code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"common_global_error"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"common_notifications_no_new_notifications"</span></span>: <span class="hljs-string"><span class="hljs-string">"    "</span></span>, }</code> </pre> <br><h2 id="lokalizuem-prilozhenie">  Localize the application </h2><br><p>  <strong>A repository with strings must be connected as a submodule to your project.</strong>  What does this give?  If you do not need the latest version of the strings, you simply do not update the version of the submodule, and the translator / designers / other interested parties can easily create resources for the next versions. </p><br><p>  In the process of developing our projects, we decided to use localization in the code, even if storyboards are used. </p><br><p>  After connecting the submodule, we still need to somehow get the strings in the application to use them.  <strong>To do this, create a script and add it to the build phases as a run script.</strong> <br>  For the script itself, we will use php.  However, you can rewrite it into any other scripting language. </p><br><p>  <strong>We put <a href="https://github.com/TouchInstinct/team/blob/master/iOS/Examples/import_strings.php">this script</a> to us in the project.</strong>  <strong>Now add to our run script.</strong> </p><br><pre> <code class="php hljs">php ./common_strings/import_strings.php</code> </pre> <br><p>  Pre-call it, for example, "Localization".  Very often, we have to see third-party projects that have run scripts that are not named in any way.  Therefore, it is impossible to understand what is happening there. </p><br><img src="https://habrastorage.org/files/e65/d41/d2d/e65d41d2d4c74464bb570a115aaef0a4.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>  <strong>Create in advance empty localizable.strings files in the project, as well as String + Localization.swift.</strong>  After the first build (cmd + B), we have completed localizable.strings files in our project, as well as the String + Localization.swift file.  If the script is not executed or is executed incorrectly, make sure that you have previously created these files, as the script is responsible only for filling. </p><br><img src="https://habrastorage.org/files/0f9/270/a04/0f9270a04d6e4e99b79444cd764b769a.png"><br><p>  An example of the finished file Localizable.string (Russian) </p><br><img src="https://habrastorage.org/files/5af/6d0/15a/5af6d015a7e04e35b4ca2ea0a2c07cb7.png"><br><p>  An example of the finished file String + Localization.swift </p><br><p>  In addition, for ease of localization, <strong>create an <a href="https://github.com/TouchInstinct/team/blob/master/iOS/Examples/String%252BLocalization.swift">extension for the String</a> .</strong> </p><br><p>  Now we can use strings from String + Localization in the project.  For example: </p><br><pre> <code class="hljs pgsql">emptyLabel.text = .commonNotificationsNoNewNotifications</code> </pre> <br><p>  However, this is no longer a magic string.  When you hover on it, you can also see the translation of the word in a language that is most understandable to the developers of the project. </p><br><img src="https://habrastorage.org/files/ae9/ee0/67f/ae9ee067f81a4464884a5e7a797a4e7d.png"><br><br><p>  If the project uses the .commonNotificationsNoNewNotifications line, and then the translator removes it in the new version, then the developer will display a compilation error.  Because this line no longer exists in the project and needs to be corrected.  We predictively got an error about changing the resource and did not release it in production / gave it to testers / etc. </p><br><p>  As a result, we get a system for working with localization, which meets all the goals.  In this way, have already done several projects.  I hope that this technique will help you simplify the process of localizing applications, as well as make it less dependent on developers. </p></habracut></div><p>Source: <a href="https://habr.com/ru/post/327356/">https://habr.com/ru/post/327356/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327344/index.html">How hackers attack web applications: bots and simple vulnerabilities</a></li>
<li><a href="../327346/index.html">10 most profitable markets for launching a mobile game</a></li>
<li><a href="../327348/index.html">Personal experience: how we ordered advertising from video bloggers for our web studio</a></li>
<li><a href="../327352/index.html">Analysis of publications on Habrahabr over the past six months. Statistics, useful finds and ratings</a></li>
<li><a href="../327354/index.html">I want to know everything: business analysis. Part 1</a></li>
<li><a href="../327362/index.html">Testing: a simple IT track or a serious undertaking?</a></li>
<li><a href="../327364/index.html">React slow, React fast: React application optimization in practice</a></li>
<li><a href="../327368/index.html">Armor is strong and our tanks are fast.</a></li>
<li><a href="../327370/index.html">I want to know everything: business analysis. Part 2</a></li>
<li><a href="../327372/index.html">Creating a game on the Unreal Engine 4 for 150 hours (video + source)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>