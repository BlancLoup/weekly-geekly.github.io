<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Do you like Assert.That as some others love it or is dedicated to the release of NUnit v3 beta</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, the first beta version of the NUnit v3 test framework has been released. Among other things, this version implements the parallel execution ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Do you like Assert.That as some others love it or is dedicated to the release of NUnit v3 beta</h1><div class="post__text post__text-html js-mediator-article">  Recently, the first beta version of the <a href="http://www.nunit.org/">NUnit v3</a> test framework has been released.  Among other things, this version implements the parallel execution of tests (almost out of the box).  I decided to check how it works on one real project and found that the new version of nunit <a href="http://nunit.org/index.php%3Fp%3DbreakingChanges%26r%3D3.0">does not support</a> some of the things used in previous versions.  In particular, it is proposed to use Assert.Thorws or Assert.That instead of the ExpectedException attribute. <br>  Regardless of the release of this beta, in one of the projects I started using the <a href="http://www.nunit.org/index.php%3Fp%3DconstraintModel%26r%3D2.4.8">Assert.That</a> model instead of all the other methods and attributes of nunit. <br><br>  Under the cut a little experience transfer attribute ExpectedException model Assert.That. <br><a name="habracut"></a><br><br>  As it turned out, the test project that I chose to translate under nunit v3.  contains over 100 uses of the <a href="http://www.nunit.org/index.php%3Fp%3Dexception%26r%3D2.4.8">ExpectedException</a> attribute.  Naturally, I wanted to automate the transition process. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It is interesting that if earlier the attribute ExpectedException seemed very successful, recently I discovered several problems: <br>  For example, in the following test it is not very clear in which line an exception is expected.  Usually - in the latter, but if some previous method throws out the same exceptional situation, the test will not work correctly.  In any case, there is some kind of uncertainty ‚Äúwhere to expect an exceptional situation after all‚Äù. <br><pre><code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] [ExpectedException(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ArgumentException))] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestExpectedException</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { foo1(); foo4(); foo1(); }</code> </pre> <br><br>  Another trifle that interferes is the ‚Äúcode coverage‚Äù reports, i.e.  you start <a href="https://www.jetbrains.com/dotcover/">dotCover</a> , study the report and see: <br><br><img src="https://habrastorage.org/files/a2a/a64/3b8/a2aa643b8b7a4eb1b740cc6ad76829e5.png"><br><br>  But replace with Assert.That and quite another thing: you get 100% coverage. <br><br><img src="https://habrastorage.org/files/7a2/001/6c7/7a20016c712143088db620597ef1cb72.png"><br><br>  After I realized that changing with "hands" is too simple a way :), I decided to write a plug-in for the resharper, which helps to translate nunit constructions into the Assert.That model. <br><br>  And I started with the ones I need to translate my test project. <br><br>  At first everything was quite simple: <br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] [ExpectedException] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestShortExpectedException</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { foo1(); foo2(); foo1(); }</code> </pre><br>  translated into <br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestShortExpectedException</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { foo1(); Assert.That(foo2, Throws.Exception); foo1(); }</code> </pre><br>  A more complex example is the use of an anonymous method. <br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] [ExpectedException] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestExpectedExceptionWithExpressions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span> + getNumber(); }</code> </pre><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestExpectedExceptionWithExpressions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Assert.That(() =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span> + getNumber(); }, Throws.Exception); }</code> </pre><br>  Specific expected type required implementation <b>Throws.TypeOf</b> <br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] [ExpectedException(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ArgumentException))] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestExpectedException</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { foo1(); foo4(); foo1(); }</code> </pre><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestExpectedException</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { foo1(); Assert.That(() =&gt; { foo4(); }, Throws.TypeOf&lt;ArgumentException&gt;()); foo1(); }</code> </pre><br>  The expected text of the message of exceptional situation (or in Russian ‚Äúthe message of execination‚Äù) required to add <b>.And.Message</b> <br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] [ExpectedException(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(NotImplementedException), ExpectedMessage = <span class="hljs-string"><span class="hljs-string">"customer message"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestExpectedExceptionWithCustomerMessage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { foo4(<span class="hljs-string"><span class="hljs-string">"customer message"</span></span>); }</code> </pre><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestExpectedExceptionWithCustomerMessage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Assert.That(() =&gt; { foo4(<span class="hljs-string"><span class="hljs-string">"customer message"</span></span>); }, Throws.TypeOf&lt;NotImplementedException&gt;().And.Message.EqualTo(<span class="hljs-string"><span class="hljs-string">"customer message"</span></span>)); }</code> </pre><br><br>  Not all constructs are supported yet: for example, <b>MathType</b> will not be converted correctly. <br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] [ExpectedException(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(NotImplementedException), ExpectedMessage = <span class="hljs-string"><span class="hljs-string">"customer message"</span></span>, MatchType = MessageMatch.Contains)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestExpectedExceptionWithCustomerMessage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { foo4(<span class="hljs-string"><span class="hljs-string">"my customer message"</span></span>); }</code> </pre><br><br>  Converting Assert.IsNullOrEmpty and Assert.IsNotNullOrEmpty constructs implemented without programming, but only through <a href="https://www.jetbrains.com/resharper/webhelp80/Reference__Options__Code_Inspection__Custom_Patterns.html">Custom Patterns</a> . <br>  Custom Patterns is a strong feature, but, apparently, in the case of complex designs, it is still not running smoothly. <br>  Assert - the construction is simple and there were no problems: <br><br><img src="https://habrastorage.org/files/545/55d/434/54555d434eb54d92b81e5684ff6cb69f.png"><br><img src="https://habrastorage.org/files/aa1/12a/60c/aa112a60ce8246d3972d5b0a75b76bd5.png"><br><br>  The plugin is called "NUnit.That.Resharper.Plugin" and its beta version is available for download via Resharper - Manage Extensions. <br>  Tested only on resharper-version 8.2. <br>  Right now a <a href="https://github.com/constructor-igor/NUnit.That.Resharper.Plugin">small set of designs</a> is being <a href="https://github.com/constructor-igor/NUnit.That.Resharper.Plugin">maintained</a> . <br><br>  Visually, the work of the plugin looks like this: <br><br>  choose on the right line Replace <br><img src="https://habrastorage.org/files/fb1/d7b/110/fb1d7b110d874e08aedd2d1264a35c35.png"><br><br>  and you get the converted expression (the ExpectedException attribute is removed) <br><br><img src="https://habrastorage.org/files/cea/550/f8a/cea550f8a98c47d89deada85556a7ff6.png"><br><br>  <b>Conclusions</b> : <br>  - Assert. That seemed to me a rather attractive model; <br>  - NUnit v3.  still beta (be careful with the documentation!), but you can already start trying on test projects and prepare real ones; <br>  - a complete cycle ( <b>including tests and distribution</b> ) of writing plugins for a resharper is not as difficult as it seemed, and can be used to solve not only ‚Äúcommon‚Äù, but also local problems. <br><br>  I would like to express special gratitude to the resharper team (and personally <a href="http://habrahabr.ru/users/mezastel/" class="user_link">mezastel</a> ), who helped to understand the development of plug-ins in particular.  Resharper SDK allows you to create Visual Studio projects from templates, which greatly facilitates the work. <br><br>  References: <br>  - github project <a href="https://github.com/constructor-igor/NUnit.That.Resharper.Plugin">https://github.com/constructor-igor/NUnit.That.Resharper.Plugin</a> <br>  - <b>NUnit.That.Resharper.Plugin</b> plugin in the gallery <a href="https://resharper-plugins.jetbrains.com/packages/NUnit.That.Resharper_v8.Plugin/">https://resharper-plugins.jetbrains.com/packages/NUnit.That.Resharper_v8.Plugin/</a> <br><br>  Links to examples and documentation <br>  - developer documentation for resharper <a href="https://www.jetbrains.com/resharper/devguide/">ReSharper DevGuide</a> ; <br>  - post " <a href="http://dev-ua.livejournal.com/774.html">Write a plugin for ReSharper - not so difficult</a> " <br>  - <a href="https://github.com/hmemcpy/AgentMulder">Agent Mulder plugin for ReSharper</a> </div><p>Source: <a href="https://habr.com/ru/post/254289/">https://habr.com/ru/post/254289/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../254275/index.html">The ratio of abstraction and complexity in modeling</a></li>
<li><a href="../254277/index.html">The results of a survey of the popularity of PHP frameworks from Sitepoint</a></li>
<li><a href="../254279/index.html">MVC on the server does not happen</a></li>
<li><a href="../254281/index.html">Complete energy autonomy or how to survive with solar panels in the outback (part 3. transitional)</a></li>
<li><a href="../254287/index.html">iOS app from sketch to App Store</a></li>
<li><a href="../254291/index.html">Development of a vector editor in JavaScript (part two, with sources)</a></li>
<li><a href="../254293/index.html">IPv6 is fun, part 2</a></li>
<li><a href="../254295/index.html">WMS setup in stock with narrow aisle technology</a></li>
<li><a href="../254297/index.html">The digest of interesting materials for the mobile developer # 96 (on March 23-29)</a></li>
<li><a href="../254299/index.html">New in Wolfram Language: TimelinePlot function for creating timelines</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>