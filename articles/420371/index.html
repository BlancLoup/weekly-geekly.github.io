<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>To the issue of bicycle engineering in the field of electromail posting</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="By the will of fate there is in my care a mail server. Small, ~ 20 users. It works stably, software change is undesirable. And it would not be necessa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>To the issue of bicycle engineering in the field of electromail posting</h1><div class="post__text post__text-html js-mediator-article">  By the will of fate there is in my care a mail server.  Small, ~ 20 users.  It works stably, software change is undesirable.  And it would not be necessary, but once the backup logs hinted unambiguously - if you continue in the same vein, a full backup will go all night.  And the point - in the volume of user mailboxes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1e/lg/ef/1elgefhundgzt-huf1mhs5fgj1u.jpeg"></div><a name="habracut"></a><br>  The problem is indicated, it is necessary to solve.  The way ahead is to buy iron more powerful - not in my taste, and the budget is not rubber.  The obvious option: quotas.  But in practice it does not help much.  Oath assurances "I cleaned everything" on closer inspection turn into seals, funny pictures and family photo archives (in corporate mail, yes).  And the number of screams "I urgently burn does not work do immediately" increases by an order of magnitude.  So long and faith in people to lose. <br><br>  Fortunately, I am not a psychologist, not a coach or a mentor.  My job is technology.  Here we come from the technical side. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The first thing that was thought was self-destructing messages.  Roughly speaking, everything without the ‚Äúimportant‚Äù mark is deleted after N days.  For my taste, this should be ‚Äústitched‚Äù into e-mail standards.  But so far this is not, and the implementation seemed to me too large-scale. <br><br>  The second thought was a copy.  You know, these messages where you are not the main addressee.  Comes to you just for information.  Some of these messages could be deleted automatically.  But, suddenly, here the users were divided into two camps: ‚Äúthey all need you what‚Äù and ‚Äúwhat is it‚Äù.  I did not master the automatic sorting algorithm with such conditions. <br><br>  Well, do not delete, so copy!  Take all the copies and make symbolic links.  A quick analysis showed that even processing in this way only FULL duplicates saves THIRD repository.  But but but.  Unfortunately, the path is a dead end due to many technical limitations. <br><br><div class="spoiler">  <b class="spoiler_title">Details for those interested in a spoiler</b> <div class="spoiler_text">  - not all archivers understand symlinks; <br>  - server software goes crazy; <br>  - complexity org.  nature and access rights. <br></div></div><br>  By the way, in my mail server the settings for both general backups and archive storage for users are very scanty.  So there was little room for maneuver. <br><br>  What remains?  I looked at the cats with sadness <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3_/lg/nh/3_lgnhen33bf-iilsfejxyfrpuo.jpeg"></div><br>  and wondered already unpretentious neural network that would clean the mail for the user.  And then ... Excuse me, permit me, but what do the seals do in the letter?  I remember that a letter with an attachment weighs almost a third more than one attachment!  And whether to move the attachment? .. <br><br>  Thus began the path where there were "many wonderful discoveries."  If I knew ... Well, you understand.  A drop of ignorance and courage lead us to victories! <br><br>  So: we make <b>keeping attachments separate from letters</b> . <br><br>  The main mistake that can be made here is to open the eml file in a text editor and decide that there is plain text.  So I did.  And he was delighted.  Right now I'll write a batch file.  Command line utilities for extracting full attachments: <a href="https://github.com/erikvdv1/eml-attachments">github.com/erikvdv1/eml-attachments</a> or <a href="https://github.com/maiken2051/uudeview">github.com/maiken2051/uudeview</a> , offhand.  There are problems with encodings, but this is not the most important thing. <br><br>  The most important thing: to take out the file and create a link to it - it's a nasty business.  But shove this link into the original letter ... Because there is not a text.  There <b>mime</b> . <br><br>  An experienced reader, of course, is now laughing at the hapless author.  The author also discovered the delights of "standard".  The most important thing that I realized: for falling into a berserk, the toadstools are not necessary. <br><br><div class="spoiler">  <b class="spoiler_title">Examples and swearing - under the spoiler:</b> <div class="spoiler_text"><br>  charset = UTF-8 <br>  charset = "UTF-8" <br>  charset = "UTF-8" <br>  charset = UTF-8; <br>  charset = "UTF-8"; <br>  charset = "UTF-8"; <br>  This is their one and the same thing. <br><br>  Line breaks in the middle of the Base64 stream.  Where come from - for me is still a mystery. <br><br>  And vice versa: the absence of \ r \ n \ r \ n after the header part. <br><br>  In the title, the order of the fields at the request of the left heel. <br><br>  Old letters allow a length of no more than 80 characters, including service letters. <br><br>  There may be line breaks in file names (in the body of the letter, and not in the name itself). <br><br>  In general, line breaks can be anywhere, despite the fact that in the standard a line break is declared as the end of the current parameter. <br><br>  The text of the letter itself is coded.  How exactly it is encoded, remains on the conscience of a particular server, there are a lot of options (stinky) there. <br><br>  And, and in the letter there is almost always a html part.  That is, if you send "Hello" and there is a br or p tag, then the letter will always have TWO sections: with just text and tags.  And the text is duplicated.  And here they "saved" the computing power ... Just some kind of menagerie with Frankenstein. <br><br>  They have the file name like this: filename = "=? Encoding? Type ?; and it happens like this: filename * 0 * = encoding '' (STA ?? !!). The second is a newer standard, RFC5987. The standard explicitly states that filename * 0 * = ENC and filename = "=?  same.  At this point, I was finally convinced that they were being bullied.  How can I handle it normally, I do not know. <br><br>  Separately, as usual, distinguished Apple.  They have a standard of their own.  Looking ahead, long attempts to process their code led to the only correct solution: ‚ÄúError: Apple mail is not supported.‚Äù <br><br>  Thunderbird though.  With grief, I got into its source, but I could not find the necessary section in one and a half gigabytes of code on a mixture of python and dialects.  I got into their IRC, where I kindly suggested where to look, but I still could not find it. <br></div></div><br>  But he did not lose heart.  Documentation do not read @ code write, and ready.  No, seriously, I had to do something to bring the end of MIME closer. <br><br>  Batch-script has not done.  The result is <a href="https://github.com/automatize-it/eml-attachments">a command line utility in C # and dotNet</a> . <br><br>  The utility has two modes of operation: <br>  First: simply extracts attachments.  It works correctly with encodings under Windows. <br><br>  Second: and then the main fun.  Now we can still keep mail attachments separate from the mail!  The utility <b>creates a new letter to replace the old one</b> : the <b>attachment is cut out, the letter is reformatted in plain HTML with UTF encoding,</b> without limiting the length of the string.  The text / plain section is taken as the basis.  If there are tables in the html section, it transfers them while preserving the formatting inside the table, but this functionality works so-so.  At the end of the text of the current letter (if it is an answer or forward) links to network resources are inserted with the path to the extracted files in the file: /// and ftp: // formats. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cad/324/3b7/cad3243b7a0c78597fddcc3f4162c563.png" alt="image"><br><br>  The system was tested on 10,000+ letters and deployed on the existing infrastructure. <br><br>  <b>Identified advantages:</b> <br>  + was: <br><blockquote>  Backup <br>  was started at 01:00:08 <br>  and successfully completed 03:26:32 <br></blockquote><br>  has become: <br><blockquote>  Backup <br>  was started at 01:00:09 <br>  and successfully completed 01:40:36 <br></blockquote><br>  + Saved 30+% of the storage: the files are leaving the heavy Base64 and their ilk in the normal format of the file system, plus a lot of duplicates were found even inside separate boxes. <br><br>  + Increases the speed of processing mailboxes server and mail programs. <br><br>  + Disappears "I opened the letter from the post office, I edited it for 10 hours and it was not saved" <br><br>  + You can refuse quotas. <br><br>  + It remains possible to find an attachment in the mail, in contrast to the simple transfer to the file storage. <br><br>  + Approaching the end of MIME.  Repent, authors! <br><br>  <b>Solution Minuses:</b> <br><br>  - Some letters (but not attachments) are still fighting.  Mostly not internally, but when viewed in some clients; <br>  - some devils constantly break in ftp; <br>  - not all email clients support opening via file: /// <br><br>  <b>Controversial moments:</b> <br><br>  ?  Apple mail not supported.  For me, the Buddha is with him; <br>  ?  Fight letters with complex formatting.  These are usually Booker flyers or advertisements; <br>  ?  If the ftp server is on a non-standard port, then there may be problems with access.  Decided by mail bot. <br><br>  So the problem was solved by a thorny path. <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/420371/">https://habr.com/ru/post/420371/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../420359/index.html">Var, let or const? Problems scopes variables and ES6</a></li>
<li><a href="../420361/index.html">Bug when working TextBox.GetLineText in .NET WPF</a></li>
<li><a href="../420363/index.html">HPE webinars in August-October: new topics (+ storage, AI practice, turnkey petabyte storage)</a></li>
<li><a href="../420367/index.html">Air-conditioned apocalypse: blackout scenario of the grid using smart climate instruments</a></li>
<li><a href="../420369/index.html">Extreme Extended Edge, or IEEE 802.1BR based switching</a></li>
<li><a href="../420373/index.html">Almost OCR to get VPNBook password. PHP + Mikrotik</a></li>
<li><a href="../420375/index.html">Learn OpenGL. Lesson 5.8 - Bloom</a></li>
<li><a href="../420377/index.html">How we ran video calls</a></li>
<li><a href="../420379/index.html">Chamber of Commerce of Russia proposed not to punish users of "spyware" devices</a></li>
<li><a href="../420381/index.html">Why stop counting neural networks as a black box?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>