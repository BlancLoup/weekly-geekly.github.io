<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Solving the problem of clustering using gradient descent</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hey. In this article, we will discuss the method of data clustering using the gradient descent method . To be honest, this method is more academic tha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Solving the problem of clustering using gradient descent</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/b4b/7f7/967/b4b7f79677082b429ce13ca278e157e5.jpg" align="right">  Hey.  In this article, we will discuss the method of <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BB%25D0%25B0%25D1%2581%25D1%2582%25D0%25B5%25D1%2580%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B0%25D0%25BD%25D0%25B0%25D0%25BB%25D0%25B8%25D0%25B7">data clustering</a> using <a href="http://ru.wikipedia.org/wiki/%25D0%2593%25D1%2580%25D0%25B0%25D0%25B4%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582%25D0%25BD%25D1%258B%25D0%25B9_%25D1%2581%25D0%25BF%25D1%2583%25D1%2581%25D0%25BA">the gradient descent method</a> .  To be honest, this method is more academic than practical.  I needed to implement this method for demonstration purposes for a machine learning course to show how identical tasks can be solved in various ways.  Although of course, if you plan to cluster data using a differentiated metric, for which it is computationally more difficult to find a <a href="http://en.wikipedia.org/wiki/Centroid">centroid</a> , rather than counting a gradient on some data set, then this method may be useful.  So, if you're wondering how to solve the k-means clustering problem with a generalized metric using the gradient descent method, I ask for cat.  Code in R. <br><a name="habracut"></a><br><h4>  Data </h4><br>  First, let's discuss the set of data on which we will test the algorithms.  For testing uses a <a href="http://archive.ics.uci.edu/ml/datasets/Human%2BActivity%2BRecognition%2BUsing%2BSmartphones">lot of data from the sensors of smartphones</a> : only 563 fields in 7352 observations;  from the bottom 2 fields are allocated for the user ID and type of action.  The set is created to classify user actions depending on sensor readings, a total of 6 actions (WALKING, WALKING_UPSTAIRS, WALKING_DOWNSTAIRS, SITTING, STANDING, LAYING).  A more detailed description of the set can be found at the above link. <br><br>  As you understand it, to visualize such a multitude without reducing the dimensionality is a bit problematic.  To reduce the dimension, <a href="http://habrahabr.ru/post/146236/">the principal component method was</a> used; for this, you can use the standard means of the R language, or implement this method in the same language from <a href="https://github.com/mephistopheies/ml-r">my repository</a> .  Let's take a look at what the original set looks like, projected onto the first and third main components. <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre><code class="matlab hljs">m.proj &lt;- ProjectData(m.raw, e$eigenVectors[, c(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>)]) <span class="hljs-built_in"><span class="hljs-built_in">plot</span></span>(m.proj[, <span class="hljs-number"><span class="hljs-number">1</span></span>], m.proj[, <span class="hljs-number"><span class="hljs-number">2</span></span>], pch=<span class="hljs-number"><span class="hljs-number">19</span></span>, col=rainbow(<span class="hljs-number"><span class="hljs-number">6</span></span>)[unclass(as.<span class="hljs-built_in"><span class="hljs-built_in">factor</span></span>(samsungData$activity))], xlab=<span class="hljs-string"><span class="hljs-string">"first"</span></span>, ylab=<span class="hljs-string"><span class="hljs-string">"third"</span></span>, main=<span class="hljs-string"><span class="hljs-string">"Two components; actions"</span></span>)</code> </pre> <br></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage2/e54/f9d/531/e54f9d531be9f08848cf9d5a011516a1.png"><br><br>  Different colors indicate different actions, then we will use this two-dimensional set to test and visualize the results of clustering. <br><br><h4>  K-means algorithm cost function </h4><br>  We introduce the following notation: <br><ul><li><img src="https://habrastorage.org/storage2/48f/4c2/168/48f4c2168d91716fa124b04c01f60ff7.gif">  - many centroids <img src="https://habrastorage.org/storage2/021/68e/c72/02168ec72c8a8776abfbdd9343195736.gif">  corresponding clusters </li><li><img src="https://habrastorage.org/storage2/ef4/ae2/f2e/ef4ae2f2e81faac09b0f5e5e44b25a31.gif">  - the original set of data that must be clustered </li><li><img src="https://habrastorage.org/storage2/990/b3f/1d1/990b3f1d1dcc0681a04a9621bcc4198c.gif">  - k-th cluster, a subset of the original set </li></ul><br><br>  Now consider the cost function of the <a href="http://ru.wikipedia.org/wiki/K-means">classic k-means algorithm</a> : <br><img src="https://habrastorage.org/storage2/e46/1af/bde/e461afbde9885224beef3964160a22a5.gif"><br>  those.  the algorithm minimizes the total square deviation of cluster elements from the centroid.  In other words, the sum of squares of the Euclidean distance of cluster elements from the corresponding centroid is minimized: <br><img src="https://habrastorage.org/storage2/e42/203/027/e42203027f050e8e2fb4c5c7c0313afe.gif">  where <b><i>f</i></b> is in this case the Euclidean distance. <br><br>  As it is known, there is an effective learning algorithm <a href="http://habrahabr.ru/post/146556/">based on the expectation-maximization algorithm</a> for solving this problem.  Let's take a look at the result of this algorithm, using the built-in function in R: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="matlab hljs">kmeans.inner &lt;- kmeans(m.proj, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">plot</span></span>(m.proj[, <span class="hljs-number"><span class="hljs-number">1</span></span>], m.proj[, <span class="hljs-number"><span class="hljs-number">2</span></span>], pch=<span class="hljs-number"><span class="hljs-number">19</span></span>, col=rainbow(<span class="hljs-number"><span class="hljs-number">3</span></span>)[unclass(as.<span class="hljs-built_in"><span class="hljs-built_in">factor</span></span>(kmeans.inner$cluster))], xlab=<span class="hljs-string"><span class="hljs-string">"first"</span></span>, ylab=<span class="hljs-string"><span class="hljs-string">"third"</span></span>, main=paste(k, <span class="hljs-string"><span class="hljs-string">" clusters; kmeans \n cost = "</span></span>, kmeans.inner$tot.withinss/<span class="hljs-number"><span class="hljs-number">2</span></span>, sep=<span class="hljs-string"><span class="hljs-string">""</span></span>))</code> </pre><br></div></div><br><br><img src="https://habrastorage.org/storage2/187/703/9a6/1877039a6ca38d4f7b62edd1b5ced094.png"><br><br><h4>  Gradient descent </h4><br>  The <a href="http://ru.wikipedia.org/wiki/%25D0%2593%25D1%2580%25D0%25B0%25D0%25B4%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582%25D0%25BD%25D1%258B%25D0%25B9_%25D1%2581%25D0%25BF%25D1%2583%25D1%2581%25D0%25BA">gradient descent algorithm</a> itself <a href="http://ru.wikipedia.org/wiki/%25D0%2593%25D1%2580%25D0%25B0%25D0%25B4%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582%25D0%25BD%25D1%258B%25D0%25B9_%25D1%2581%25D0%25BF%25D1%2583%25D1%2581%25D0%25BA">is</a> pretty simple, the point is to move in small steps towards the opposite direction of the gradient, for example, <a href="http://habrahabr.ru/post/154369/">the back propagation error</a> <a href="http://habrahabr.ru/post/159909/">algorithm</a> , or <a href="http://habrahabr.ru/post/159909/">the contrastive divergence algorithm for learning the limited Boltzmann machine</a> , works.  First of all, it is necessary to calculate the gradient of the objective function, or the partial derivatives of the objective function from the model parameters. <br><br><img src="https://habrastorage.org/storage2/e2d/c9c/7fd/e2dc9c7fd9081d3aa7318efffc9d8d80.gif">  since we left the section on classic k-means, then <b><i>f</i></b> can in principle be any measure of distance, not necessarily the Euclidean metric <br><br>  But there is a problem, we do not know at this stage what the partition of the set <b><i>X</i></b> into clusters is.  Let's try to reformulate the objective function in such a way that we write it in the form of one formula that would be easy to differentiate: the sum of the minimum distances from each element of the set to one of the three centroids.  This formula is as follows: <br><br><img src="https://habrastorage.org/storage2/dbf/a90/57c/dbfa9057c4f643e1b04d199c8cd35ab4.gif"><br><br>  Now let's find the derivative of the new objective function: <br><br><img src="https://habrastorage.org/storage2/bc5/e39/a49/bc5e39a49ac58bbe290fcfd6d31c5c3d.gif"><br><br>  Well, it remains to find out what the derivative of the minimum is equal to, but everything turns out to be simple: if the <b><i>a-</i></b> th centroid is really the one to which the distance is minimal from the current element of the set, then the derivative of the expression is equal to the derivative of the square of the distance along the vector element, otherwise case is zero: <br><br><img src="https://habrastorage.org/storage2/b9e/836/6eb/b9e8366eb4a0d60904e3900e582f502a.gif"><br><br><h4>  Method implementation </h4><br>  As you understand, all the steps from the previous paragraph can be performed without squaring the distance.  This was done in the implementation of this method.  The method receives as parameters the distance function and the function of calculating the partial derivative of the distance function between two vectors by the component of the second vector, for example, ‚Äúhalf the square Euclidean distance‚Äù (convenient to use because the derivative is very simple), as well as the function of the gradient descent : <br><br><div class="spoiler">  <b class="spoiler_title">Distance functions</b> <div class="spoiler_text">  Distance function <br><br><pre> <code class="matlab hljs">HalfSqEuclidian.distance &lt;- <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(u, v)</span></span></span><span class="hljs-function"> { # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Half</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Squeared</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Euclidian</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">between</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">two</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vectors</span></span></span><span class="hljs-function"> # # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Args</span></span></span><span class="hljs-function">: # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">u</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">first</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vector</span></span></span><span class="hljs-function"> # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">second</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vector</span></span></span><span class="hljs-function"> # # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Returns</span></span></span><span class="hljs-function">: # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">value</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sum((uv)</span></span></span><span class="hljs-function">*</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uv)</span></span></span><span class="hljs-function">)/2) }</span></span></code> </pre><br><br>  Partial derivative function <br><pre> <code class="matlab hljs">HalfSqEuclidian.derivative &lt;- <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(u, v, i)</span></span></span><span class="hljs-function"> { # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Partial</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">derivative</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Half</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Squeared</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Euclidian</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-function"> # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">between</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">two</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vectors</span></span></span><span class="hljs-function"> # # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Args</span></span></span><span class="hljs-function">: # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">u</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">first</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vector</span></span></span><span class="hljs-function"> # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">second</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vector</span></span></span><span class="hljs-function"> # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">part</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">second</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vector</span></span></span><span class="hljs-function"> # # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Returns</span></span></span><span class="hljs-function">: # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">value</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">derivative</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(v[i] - u[i])</span></span></span><span class="hljs-function"> }</span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Gradient descent method</b> <div class="spoiler_text"><pre> <code class="matlab hljs">KMeans.gd &lt;- <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(k, data, distance, derivative, accuracy = 0.1, maxIterations = 1000, learningRate = 1, initialCentroids = NULL, showLog = F)</span></span></span><span class="hljs-function"> { # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Gradient</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">descent</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">version</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kmeans</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clustering</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">algorithm</span></span></span><span class="hljs-function"> # # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Args</span></span></span><span class="hljs-function">: # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">k</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">number</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clusters</span></span></span><span class="hljs-function"> # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">frame</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">or</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">matrix</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rows are observations)</span></span></span><span class="hljs-function"> # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cost</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">metrics</span></span></span><span class="hljs-function"> # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">centroid</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">centroid</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-function"> # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accuracy</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accuracy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculation</span></span></span><span class="hljs-function"> # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">learningRate</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">learning</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rate</span></span></span><span class="hljs-function"> # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initialCentroids</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initizalization</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">centroids</span></span></span><span class="hljs-function"> # </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showLog</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">log</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dim</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[2]</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initialCentroids</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitNewCentroid</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[sample(1:dim(data)[1]</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">m</span></span></span><span class="hljs-function">), ] } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(is.null(initialCentroids)</span></span></span><span class="hljs-function">) { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitNewCentroid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(k)</span></span></span><span class="hljs-function"> } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">costVec</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vector</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cost</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NA</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">d</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NA</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lastCost</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Inf</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(iter in 1:maxIterations)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">g</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">matrix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rep(NA, n*k)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nrow</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">k</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ncol</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function">) #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distances</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">between</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">centroids</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">d</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">matrix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rep(NA, k*dim(data)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">), </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nrow</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">k</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ncol</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dim</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i in 1:k)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">d</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i, ]</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data, 1, FUN = function(v)</span></span></span><span class="hljs-function"> {</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(v, c[i, ])</span></span></span><span class="hljs-function">}) } #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cost</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cost</span></span></span><span class="hljs-function"> &lt;- 0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i in 1:dim(data)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">) { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cost</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cost</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d[, i])</span></span></span><span class="hljs-function"> } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(showLog)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(paste("Iter: ", iter,"; Cost = ", cost, sep="")</span></span></span><span class="hljs-function">) } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">costVec</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(costVec, cost)</span></span></span><span class="hljs-function"> #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">conditions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(abs(lastCost - cost)</span></span></span><span class="hljs-function"> &lt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accuracy</span></span></span><span class="hljs-function">) { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">break</span></span></span><span class="hljs-function"> } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lastCost</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cost</span></span></span><span class="hljs-function"> #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gradients</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a in 1:k)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(b in 1:n)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">g</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[a, b]</span></span></span><span class="hljs-function"> &lt;- 0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i in 1:dim(data)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">) { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(min(d[, i])</span></span></span><span class="hljs-function"> == </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">d</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[a, i]</span></span></span><span class="hljs-function">) { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">g</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[a, b]</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">g</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[a, b]</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">derivative</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data[i, ], c[a, ], b)</span></span></span><span class="hljs-function"> } } } } #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">centroids</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a in 1:k)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(b in 1:n)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[a, b]</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[a, b]</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">learningRate</span></span></span><span class="hljs-function">*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">g</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[a, b]</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dim</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function"> } } } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">labels</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(NA, dim(data)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i in 1:dim(data)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">) { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">labels</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">which</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d[, i] == min(d[, i])</span></span></span><span class="hljs-function">) } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(list( labels = labels, cost = costVec )</span></span></span><span class="hljs-function">) }</span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Testing</b> <div class="spoiler_text"><pre> <code class="matlab hljs">KMeans.gd.result &lt;- KMeans.gd(k, m.proj, HalfSqEuclidian.distance, HalfSqEuclidian.derivative, showLog = T) <span class="hljs-built_in"><span class="hljs-built_in">plot</span></span>(m.proj[, <span class="hljs-number"><span class="hljs-number">1</span></span>], m.proj[, <span class="hljs-number"><span class="hljs-number">2</span></span>], pch=<span class="hljs-number"><span class="hljs-number">19</span></span>, col=rainbow(k)[unclass(as.<span class="hljs-built_in"><span class="hljs-built_in">factor</span></span>(KMeans.gd.result$labels))], xlab=<span class="hljs-string"><span class="hljs-string">"first"</span></span>, ylab=<span class="hljs-string"><span class="hljs-string">"third"</span></span>, main=paste(k, <span class="hljs-string"><span class="hljs-string">" clusters; KMeans.gd \n cost = "</span></span>, KMeans.gd.result$cost[<span class="hljs-built_in"><span class="hljs-built_in">length</span></span>(KMeans.gd.result$cost)], sep=<span class="hljs-string"><span class="hljs-string">""</span></span>))</code> </pre><br></div></div><br><br>  Let's take a look at the result of clustering and make sure that it is almost identical. <br><br><img src="https://habrastorage.org/storage2/348/ed7/d4b/348ed7d4bb1613d399533de88b8030bd.png"><br><br>  And this is how the dynamics of the value function from iteration of both algorithms look like: <br><br><img src="https://habrastorage.org/storage2/f26/c26/641/f26c266411e22127fa3f29a0a1b13706.png"><br><br><h4>  Conclusion </h4><br>  Let's first say a few words about what happened in our test.  We got a decent split of the two-dimensional set into three clusters, we visually see that the clusters do not overlap much and we can completely build models for recognizing actions for each cluster, thus we get some hybrid model (one cluster contains basically one action, the other two, and the third three). <br><br>  Take a look at the complexity of the algorithms for clustering using the Euclidean distance, consider only one iteration (analyzing the number of iterations is not a trivial task at all).  Let k be the number of clusters, n is the dimension of the data, m is the amount of data (k &lt;= m).  In the extreme case, k = m. <br><ul><li>  EM version: <img src="https://habrastorage.org/storage2/b48/b09/710/b48b097106fff40f294b18bae15c5319.gif"></li><li>  GD version: <img src="https://habrastorage.org/storage2/4a8/cfa/bf5/4a8cfabf5e3aeabaa30500b504ea1e92.gif"></li></ul><br><br>  In general, mathematically, both algorithms are on the same level, but we know that one is slightly higher. <br><br>  <a href="https://github.com/mephistopheies/ml-r">You can find</a> all the code <a href="https://github.com/mephistopheies/ml-r">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/188638/">https://habr.com/ru/post/188638/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../188620/index.html">Swiss scientists have developed an artificial eye</a></li>
<li><a href="../188622/index.html">How to speed build 1000 VisualStudio C ++ projects</a></li>
<li><a href="../188626/index.html">Internet pirates turn young children into corrupt</a></li>
<li><a href="../188630/index.html">NodeJS is beautiful, modular, object or make it so with the help of redis and nohm</a></li>
<li><a href="../188632/index.html">New features of Hyper-V 2012 R2</a></li>
<li><a href="../188640/index.html">The 7th international IT HR-conference ‚ÄúAnswer the answer!‚Äù</a></li>
<li><a href="../188644/index.html">GoIP SMS Server for Asterisk (Part 1)</a></li>
<li><a href="../188648/index.html">Edward Snowden received temporary asylum in Russia</a></li>
<li><a href="../188650/index.html">Bootstrap CSS Sprite: syntax sugar for <img /></a></li>
<li><a href="../188656/index.html">Another portable radio in a secure case - teXet TM-540R</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>