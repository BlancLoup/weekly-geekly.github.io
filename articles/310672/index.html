<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Spring Boot starter for Apache Ignite DIY</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Two articles have already been published in a potentially very long series of reviews of the distributed Apache Ignite platform (the first is about se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Spring Boot starter for Apache Ignite DIY</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/9c6/f06/103/9c6f06103f0443899a4c2de4d1d582cb.jpeg"></div><br>  Two articles have already been published in a potentially very long series of reviews of the distributed <a href="https://ignite.apache.org/">Apache Ignite</a> platform (the <a href="https://habrahabr.ru/post/310334/">first is</a> about setting up and running, the <a href="https://habrahabr.ru/post/310464/">second is</a> about building topology).  This article focuses on trying to make friends with Apache Ignite and Spring Boot.  The standard way to connect a certain library to Spring Boot is to create a ‚Äústarter‚Äù for this technology.  Despite the fact that Spring Boot is very popular and was described more than once on Habr√©, it seems that they haven‚Äôt written how to make starters.  I will try to close this annoying gap. <br><br>  The article is mainly devoted to Spring Boot and Spring Core, so those who are not interested in the Apache Ignite theme can still learn something new.  The code is posted on GitHub, <a href="https://github.com/kvmorozov/ignite-spring-boot">starter</a> and <a href="https://github.com/kvmorozov/ignite-spring-boot-demo">demo applications</a> . <br><a name="habracut"></a><br><h2>  What does the Spring Boot have to do with it? </h2><br>  As you know, Spring Boot is a very convenient thing.  Among its many pleasant features, its property is especially valuable by connecting several maven dependencies to turn a small application into a powerful software product.  For this in Spring Boot, the starter mechanism (starter) is responsible.  The idea is that you can design and implement some default configuration that, when connected, will customize the basic behavior of your application.  These configurations can be adaptive and make assumptions about your intentions.  Thus, it can be said that Spring Boot lays down in the application some idea of ‚Äã‚Äãan adequate architecture, which it deductively derives from the information that you provided to it, putting certain classes in the classpath or specifying settings in property files.  In a textbook example, Spring Boot displays ‚ÄúHello World!‚Äù Through a web application running on the built-in Tomcat with literally a couple of lines of application code.  All default settings can be overridden, and in the limiting case we can come up with a situation, as if we didn‚Äôt have Spring Boot.  Technically, the starter should inject everything that is needed, while providing meaningful default values. <br><br>  The <a href="https://habrahabr.ru/post/310334/">first article in the series</a> explained how to create and use Ignite objects.  Although it is not very difficult, I would like it even easier.  For example, to be able to use this syntax: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@IgniteResource</span></span>(gridName = <span class="hljs-string"><span class="hljs-string">"test"</span></span>, clientMode = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Ignite igniteClient;</code> </pre> <br>  Next, the starter for Apache Ignite will be described, which contains the simplest vision of an adequate Ignite application.  The example is purely demonstration and does not pretend to reflect any best practice. <br><br><h2>  Making a starter </h2><br>  Before you make a starter, you need to think about what it will be, what will be its proposed scenario of using the technology connected to it.  From previous articles, we know that Apache Ignite provides the ability to create topology from nodes of the client and server types, and to describe them using xml-configuration in the style of Spring core.  We also know that clients can connect to servers and perform tasks on them.  Servers for the job can be selected by some criteria.  Since the developers have not provided us with the best practice descriptions, for this simplest case, I will formulate it myself: the application must have at least one client that will send the load to the servers with those that it has, the value of gridName. <br>  Guided by this general idea, our starter will try to do everything so that the application does not collapse with the most minimal configurations.  From the point of view of the application programmer, it comes down to the fact that you need to get an object like <b>Ignite</b> and perform some manipulations on it. <br><br>  To begin with, let's create a frame for our starter.  First, let's connect maven-dependencies.  As a first approximation, this will suffice: <br><br><div class="spoiler">  <b class="spoiler_title">Main dependencies</b> <div class="spoiler_text"><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">java.version</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">java.version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">spring-boot.version</span></span></span><span class="hljs-tag">&gt;</span></span>1.4.0.RELEASE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">spring-boot.version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">spring.version</span></span></span><span class="hljs-tag">&gt;</span></span>4.3.2.RELEASE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">spring.version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ignite.version</span></span></span><span class="hljs-tag">&gt;</span></span>1.7.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ignite.version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">parent</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spring-boot-starter-parent<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.4.0.RELEASE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">parent</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spring-boot-starter<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spring-context<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${spring.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spring-boot-configuration-processor<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optional</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optional</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.apache.ignite<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>ignite-core<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${ignite.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.apache.ignite<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>ignite-spring<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${ignite.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Here we connect the spring-boot-starter-parent base starter, the main dependencies of Ignite and Spring.  When the application connection connects our starter, he will not have to do it.  The next step is to make the @IgniteResource annotation correctly inject an Ignite object without the participation of a programmer, with the possibility of overriding defaults.  The abstract itself is fairly simple: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Target</span></span>(ElementType.FIELD) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> IgniteResource { <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gridName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientMode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">true</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">peerClassLoadingEnabled</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">true</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">localAddress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> ""</span></span>; <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ipDiscoveryRange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> ""</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createIfNotExists</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">true</span></span></span></span>; }</code> </pre><br>  It is expected that an Ignite object with properties that are specified will be injected into a variable annotated in this way.  A search will be made for all configs, and if a suitable one is found, Ignite will be created based on it, if not, the createIfNotExists () setting will be taken into account, and Ignite will be created based on default and transferred values.  How do we achieve this?  It is necessary that the parameters of our annotation be taken into account in the process of instantiating bins.  For this process in Spring, objects of type <a href="http://docs.spring.io/autorepo/docs/spring-framework/4.3.2.RELEASE/javadoc-api/org/springframework/beans/factory/config/ConfigurableListableBeanFactory.html">ConfigurableListableBeanFactory</a> are responsible, and specifically in Spring Boot this is the DefaultListableBeanFactory.  Naturally, this class knows nothing about Ignite.  I remind you that Ignite configurations are stored as xml configurations, which are Spring configurations.  Or you can create them manually by creating an object of type IgniteConfiguration.  Thus, Spring needs to be trained to properly inject.  Since BeanFactory is created by the application context, we need to make our own: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IgniteApplicationContext</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AnnotationConfigApplicationContext</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IgniteApplicationContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IgniteBeanFactory()); } }</code> </pre><br>  Our context is inherited from AnnotationConfigApplicationContext, but Spring Boot for Web applications uses a different class.  We do not consider this case here.  Accordingly, the Ignite-Spring Boot application should use this context: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication app = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpringApplication(DemoIgniteApplication.class); app.setApplicationContextClass(IgniteApplicationContext.class); app.run(args); }</code> </pre><br>  Now you need to configure BeanFactory.  However, you must first take care of Spring's peace of mind.  Spring is not a fool, Spring is smart, he knows that if there is @Autowired, then there must be a <a href="https://habrahabr.ru/users/bean/" class="user_link">Bean</a> .  Therefore, we will add an autoconfiguration to our starter: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span>(name = <span class="hljs-string"><span class="hljs-string">"org.apache.ignite.Ignite"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IgniteAutoConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Ignite </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ignite</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }</code> </pre><br>  It will be loaded if you have the org.apache.ignite.Ignite class and will pretend that someone can return Ignite objects.  In fact, we will not return anything here, because from here we don‚Äôt see the configuration parameters specified in the @IgniteResource annotation.  The autoconfiguration connection is provided by spring.factories config, placed in META-INF, details in the <a href="http://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-developing-auto-configuration.html">Spring Boot documentation</a> .  Go back to the BeanFactory and do this: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IgniteBeanFactory</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultListableBeanFactory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IgniteSpringBootConfiguration configuration; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolveDependency</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DependencyDescriptor descriptor, String beanName, Set&lt;String&gt; autowiredBeanNames, TypeConverter typeConverter)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> BeansException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (descriptor == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || descriptor.getField() == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || !descriptor.getField().getType().equals(Ignite.class)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.resolveDependency(descriptor, beanName, autowiredBeanNames, typeConverter); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (configuration == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) configuration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IgniteSpringBootConfiguration( createBean(DefaultIgniteProperties.class)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> configuration.getIgnite( descriptor.getField().getAnnotationsByType(IgniteResource.class)); } }</code> </pre><br>  That is, if we are asked for an object of the Ignite type, we delegate the execution of the IgniteSpringBootConfiguration, which is described below, and if not, we leave everything as is.  In IgniteSpringBootConfiguration, we pass in the IgniteResource annotations hung on the field.  We continue to unravel this tangle and see what the IgniteSpringBootConfiguration is. <br><br><div class="spoiler">  <b class="spoiler_title">IgniteSpringBootConfiguration Part 1</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IgniteSpringBootConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Map&lt;String, List&lt;IgniteHolder&gt;&gt; igniteMap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> initialized = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> DefaultIgniteProperties props; IgniteSpringBootConfiguration(DefaultIgniteProperties props) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props = props; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IgniteHolder</span></span></span><span class="hljs-class"> </span></span>{ IgniteHolder(IgniteConfiguration config, Ignite ignite) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.config = config; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ignite = ignite; } IgniteHolder(IgniteConfiguration config) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>(config, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } IgniteConfiguration config; Ignite ignite; }</code> </pre><br></div></div><br>  Here we refer to the property class and define the structures for storing the Ignite data.  In turn, DefaultIgniteProperties uses the ‚ÄúType-safe Configuration Properties‚Äù mechanism, which I will not talk about and will <a href="http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/">refer to the manual</a> .  But it is important that under it lies the config, in which the main default values ‚Äã‚Äãare defined: <br><br><pre> <code class="hljs pgsql">ignite.<span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.configPath=classpath:ignite<span class="hljs-comment"><span class="hljs-comment">/**/</span></span>*.xml ignite.<span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.gridName=testGrid ignite.<span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.clientMode=<span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ignite.<span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.peerClassLoadingEnabled=<span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ignite.<span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.localAddress=localhost ignite.<span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.ipDiscoveryRange=<span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">47500.</span></span><span class="hljs-number"><span class="hljs-number">.47509</span></span> ignite.<span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.useSameServerNames=<span class="hljs-keyword"><span class="hljs-keyword">true</span></span></code> </pre> <br>  These parameters can be overridden in your application.  The first one indicates where we will look for the Ignite xml configurations, the rest determine the configuration properties that we will use if the profile is not found and a new one needs to be created.  Further, in the IgniteSpringBootConfiguration class, we will look for configurations: <br><br><div class="spoiler">  <b class="spoiler_title">IgniteSpringBootConfiguration Part 2</b> <div class="spoiler_text"><pre> <code class="java hljs"> List&lt;IgniteConfiguration&gt; igniteConfigurations = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); igniteConfigurations.addAll(context.getBeansOfType(IgniteConfiguration.class).values()); PathMatchingResourcePatternResolver resolver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PathMatchingResourcePatternResolver(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Resource[] igniteResources = resolver.getResources(props.getConfigPath()); List&lt;String&gt; igniteResourcesPaths = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Resource igniteXml : igniteResources) igniteResourcesPaths.add(igniteXml.getFile().getPath()); FileSystemXmlApplicationContext xmlContext = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileSystemXmlApplicationContext (igniteResourcesPaths.stream().toArray(String[]::<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>)); igniteConfigurations.addAll(xmlContext.getBeansOfType(IgniteConfiguration.class).values());</code> </pre><br></div></div><br>  First, we search for already known to our application bins of the IgniteConfiguration type, and then we search for configs according to the path specified in the settings, and finding them to create bins.  Bean configurations add to the cache.  Then, when a request for a bin comes to us, we search for this IgniteConfiguration cache named gridName, and if we find, we create an Ignite object based on this configuration and store it so that we can return it when we re-request it.  If the desired configuration is not found, create a new one based on the settings: <br><br><div class="spoiler">  <b class="spoiler_title">IgniteSpringBootConfiguration Part 3</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Ignite </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIgnite</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IgniteResource[] igniteProps)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!initialized) { initIgnition(); initialized = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } String gridName = igniteProps == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || igniteProps.length == <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> : igniteProps[<span class="hljs-number"><span class="hljs-number">0</span></span>].gridName(); IgniteResource gridResource = igniteProps == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || igniteProps.length == <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> : igniteProps[<span class="hljs-number"><span class="hljs-number">0</span></span>]; List&lt;IgniteHolder&gt; configs = igniteMap.get(gridName); Ignite ignite; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (configs == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { IgniteConfiguration defaultIgnite = getDefaultIgniteConfig(gridResource); ignite = Ignition.start(defaultIgnite); List&lt;IgniteHolder&gt; holderList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); holderList.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IgniteHolder(defaultIgnite, ignite)); igniteMap.put(gridName, holderList); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { IgniteHolder igniteHolder = configs.get(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (igniteHolder.ignite == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { igniteHolder.ignite = Ignition.start(igniteHolder.config); } ignite = igniteHolder.ignite; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ignite; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IgniteConfiguration </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDefaultIgniteConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IgniteResource gridResource)</span></span></span><span class="hljs-function"> </span></span>{ IgniteConfiguration igniteConfiguration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IgniteConfiguration(); igniteConfiguration.setGridName(getGridName(gridResource)); igniteConfiguration.setClientMode(getClientMode(gridResource)); igniteConfiguration.setPeerClassLoadingEnabled(getPeerClassLoadingEnabled(gridResource)); TcpDiscoverySpi tcpDiscoverySpi = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TcpDiscoverySpi(); TcpDiscoveryMulticastIpFinder ipFinder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TcpDiscoveryMulticastIpFinder(); ipFinder.setAddresses(Collections.singletonList(getIpDiscoveryRange(gridResource))); tcpDiscoverySpi.setIpFinder(ipFinder); tcpDiscoverySpi.setLocalAddress(getLocalAddress(gridResource)); igniteConfiguration.setDiscoverySpi(tcpDiscoverySpi); TcpCommunicationSpi communicationSpi = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TcpCommunicationSpi(); communicationSpi.setLocalAddress(props.getLocalAddress()); igniteConfiguration.setCommunicationSpi(communicationSpi); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> igniteConfiguration; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getGridName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IgniteResource gridResource)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gridResource == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? props.getGridName() : ifNullOrEmpty(gridResource.gridName(), props.getGridName()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getClientMode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IgniteResource gridResource)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gridResource == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? props.isClientMode() : gridResource.clientMode(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPeerClassLoadingEnabled</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IgniteResource gridResource)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gridResource == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? props.isPeerClassLoadingEnabled() : gridResource.peerClassLoadingEnabled(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIpDiscoveryRange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IgniteResource gridResource)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gridResource == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? props.getGridName() : ifNullOrEmpty(gridResource.ipDiscoveryRange(), props.getIpDiscoveryRange()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLocalAddress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IgniteResource gridResource)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gridResource == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? props.getGridName() : ifNullOrEmpty(gridResource.localAddress(), props.getLocalAddress()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ifNullOrEmpty</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String value, String defaultValue)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> StringUtils.isEmpty(value) ? defaultValue : value; }</code> </pre><br></div></div><br>  Now let's change the standard Ignite behavior to select servers to which tasks will be distributed, which is that the load is distributed to all servers.  Suppose we want servers to be selected by default with the same gridName as the client.  The <a href="https://habrahabr.ru/post/310464/">previous article</a> described how to do it by regular means.  Here we distort a little and instruct the resulting Ignite object with cglib.  Note that there is nothing terrible about this, Spring does it himself. <br><br><div class="spoiler">  <b class="spoiler_title">IgniteSpringBootConfiguration Part 4</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (props.isUseSameServerNames()) { Enhancer enhancer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Enhancer(); enhancer.setSuperclass(Ignite.class); enhancer.setCallback(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IgniteHandler(ignite)); ignite = (Ignite) enhancer.create(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ignite; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IgniteHandler</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InvocationHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Ignite ignite; IgniteHandler(Ignite ignite) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ignite = ignite; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object proxy, Method method, Object[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Throwable </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> method.getName().equals(<span class="hljs-string"><span class="hljs-string">"compute"</span></span>) ? ignite.compute(ignite.cluster() .forAttribute(ATTR_GRID_NAME, ignite.configuration().getGridName()) .forServers()) : method.invoke(ignite, args); } }</code> </pre><br></div></div><br>  And that's all, now the Ignite beans are issued according to the settings.  In the Spring Boot application, we can now call Ignite like this: <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CommandLineRunner </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runIgnite</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CommandLineRunner() { <span class="hljs-meta"><span class="hljs-meta">@IgniteResource</span></span>(gridName = <span class="hljs-string"><span class="hljs-string">"test"</span></span>, clientMode = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Ignite igniteClient; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String... args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ igniteClient.compute().broadcast(() -&gt; System.out.println(<span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span>)); igniteClient.close(); } }; }</code> </pre><br>  In @UgniteResource JUnit tests will not work, it is left as an exercise. <br><br><h2>  findings </h2><br>  Made the simplest starter for Apache Ignite, which allows to significantly simplify the client code, removing from it most of the specifics of Ignite.  Further, this starter can be refined, make more convenient settings for it, provide more adequate defaults.  As a further development, much can be done, for example, to make it more transparent than described in <a href="https://habrahabr.ru/post/310170/">my article</a> , screwing Ignite as an L2 cache to Activiti. <br><br><h2>  Links </h2><br><ul><li>  <a href="https://github.com/kvmorozov/ignite-spring-boot">Starter code on github</a> </li><li>  <a href="https://github.com/kvmorozov/ignite-spring-boot-demo">Demo code on GitHub</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/310672/">https://habr.com/ru/post/310672/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310660/index.html">Space Computing with a clear example</a></li>
<li><a href="../310662/index.html">JavaScript nomenclature (in the context of Node.js and Web API)</a></li>
<li><a href="../310666/index.html">Ukrainian prompted the British to do a webinar for IoT developers for agriculture. And we will talk about the CPU inside</a></li>
<li><a href="../310668/index.html">Foreign experience and its use in business</a></li>
<li><a href="../310670/index.html">IMHO how to write on Habr</a></li>
<li><a href="../310674/index.html">The history of communication towers: "the country's main television tower"</a></li>
<li><a href="../310676/index.html">Browsers and app specific security mitigation. Part 1</a></li>
<li><a href="../310678/index.html">Digital Agency 2.0 - How to become a boutique agency out of the pipeline</a></li>
<li><a href="../310680/index.html">The book "Multiplayer games. Network Application Development</a></li>
<li><a href="../310684/index.html">Freeform real-time speech recognition and call recording recognition</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>