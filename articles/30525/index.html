<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>More about compression</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this topic, I will try to summarize the material about data compression. It will be compressed css, js, html. 

 Merging files into modules 
 The f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>More about compression</h1><div class="post__text post__text-html js-mediator-article">  In this topic, I will try to summarize the material about data compression.  It will be compressed css, js, html. <br><a name="habracut"></a><br><h2>  Merging files into modules </h2><br>  The first step to compression was the combination of css and js files into modules.  Each module contains a list of css and js files, as well as modules that are necessary for their own work.  I decided to keep this information in the application config. <br><blockquote>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">units</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Jquery</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">js</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">file</font> <font color="#0000ff">&gt;</font> cms / js / Jquery / Core.js <font color="#0000ff">&lt;/</font> <font color="#800000">file</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">file</font> <font color="#0000ff">&gt;</font> cms / js / Jquery / Extens.js <font color="#0000ff">&lt;/</font> <font color="#800000">file</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">js</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Jquery</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Jquery.Facebox</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">depend</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">unit</font> <font color="#0000ff">&gt;</font> jQuery <font color="#0000ff">&lt;/</font> <font color="#800000">unit</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">depend</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">js</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">file</font> <font color="#0000ff">&gt;</font> cms / js / Jquery / Facebox.js <font color="#0000ff">&lt;/</font> <font color="#800000">file</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">file</font> <font color="#0000ff">&gt;</font> cms / js / Jquery / Pngfix.js <font color="#0000ff">&lt;/</font> <font color="#800000">file</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">js</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">css</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">file</font> <font color="#0000ff">&gt;</font> cms / js / Jquery / Facebox.css <font color="#0000ff">&lt;/</font> <font color="#800000">file</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">css</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Jquery.Facebox</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Cms.Core</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">js</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">file</font> <font color="#0000ff">&gt;</font> cms / js / Cms / Core.js <font color="#0000ff">&lt;/</font> <font color="#800000">file</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">file</font> <font color="#0000ff">&gt;</font> cms / js / Cms / Class.js <font color="#0000ff">&lt;/</font> <font color="#800000">file</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">js</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Cms.Core</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">units</font> <font color="#0000ff">&gt;</font></font> <font color="gray">This source code was highlighted with <a href="http://source.virtser.net/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote><br>  Now connect the necessary files is very simple.  For this, I wrote a class containing the static loadUnit () method.  Depending on the settings, it can connect the source files, or save their contents into one monolithic and connect it. <br><br><h2>  Compression and minimization </h2><br>  I selected the 3 packers listed in the app.  For compression, a class is written that, depending on the system settings, compresses files in a specific way.  HTML is also compressed.  Also, if gzip compression is enabled in the settings, files are compressed using the gzencode () method. <br><br><h2>  Caching </h2><br>  In order not to compress files, you can save two options, normal and compressed using the gzip method.  These files are sent directly to the web server, bypassing PHP.  To determine if the client browser supports compression, use mod_rewrite. <br> <code>RewriteCond %{HTTP:Accept-Encoding} gzip [OR] <br> RewriteCond %{HTTP:TE} gzip <br> RewriteCond %{HTTP_USER_AGENT} !Safari <br> RewriteCond %{HTTP_USER_AGENT} !Konqueror <br> RewriteCond %{REQUEST_FILENAME}.gz -f <br> RewriteRule ^pack\/(.*)$ /pack/$1.gz [QSA,L] <br></code> <br>  If there is no file, redirect the request to the script that creates it, or install the 404 error handler. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  You can still add ... </h2><br>  Compression loses meaning if the user has Outpost.  It automatically cuts the Accept-Encoding header, so we cannot find out if it is possible to give a compressed file.  This Outpost option is disabled in the registry, but it is not advisable to ask the user to do this.  If the user uses the opera, you can use the TE header, which is similar to the Accept-Encoding header.  For other browsers, I found only one solution - to determine the possibility of compression by version, but due to the inaccuracy of this method I chose not to use it. <br><br>  HTML on static sites can be cached in the same way as Java Script and CSS, giving the web server directly to the browser.  When data is changed, flush the cache.  But not always on sites using static content.  Therefore, it is necessary to compress dynamically, which is not acceptable on sites with high traffic.  If such sites are statistics on attendance, you can use this data and in hours with low load to give compressed HTML. <br><br>  If you do not want to write everything yourself and there is no need to adjust the compression for a specific system, you can use the ready-made Minify library. <br><br><h2>  application </h2><br>  The html compression function (taken from <a href="http://gadelkareem.com/">gadelkareem.com</a> ): <br><blockquote>  <font color="black">function htmlCompress ($ html)</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">preg_match_all ( <font color="#A31515">'! (&lt;(?: code | pre | script). *&gt; [^ &lt;] + &lt;/ (?: code | pre | script)&gt;)!'</font> , $ html, $ pre);</font> <font color="black"><br></font>  <font color="black">$ html = preg_replace ( <font color="#A31515">'! &lt;(?: code | pre). *&gt; [^ &lt;] + &lt;/ (?: code | pre)&gt;!'</font> , <font color="#A31515">'# pre #'</font> , $ html);</font> <font color="black"><br></font>  <font color="black">$ html = preg_replace ( <font color="#A31515">'# &lt;! - [^ \ []. + -&gt; #'</font> , <font color="#A31515">''</font> , $ html);</font> <font color="black"><br></font>  <font color="black">$ html = preg_replace ( <font color="#A31515">'/ [\ r \ n \ t] + /'</font> , <font color="#A31515">''</font> , $ html);</font> <font color="black"><br></font>  <font color="black">$ html = preg_replace ( <font color="#A31515">'/&gt; [\ s] + &lt;/'</font> , <font color="#A31515">'&gt; &lt;'</font> , $ html);</font> <font color="black"><br></font>  <font color="black">$ html = preg_replace ( <font color="#A31515">'/ [\ s] + /'</font> , <font color="#A31515">''</font> , $ html);</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (! empty ($ pre [0])) {</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">foreach</font> ($ pre [0] <font color="#0000ff">as</font> $ tag) {</font> <font color="black"><br></font>  <font color="black">$ html = preg_replace ( <font color="#A31515">'! # pre #!'</font> , $ tag, $ html, 1);</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">return</font> $ html;</font> <font color="black"><br></font>  <font color="black">}</font> <font color="gray">* This source code was highlighted with <a href="http://source.virtser.net/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote><br>  Used minimizers: <br>  <a href="http://dean.edwards.name/download/">Dean edwards javascript packer</a> <br>  <a href="http://code.google.com/p/minify/">Minify CSS compression script</a> <br><br>  Related Links: <br>  <a href="http://vectora.ru/articles-and-tutorials/49-web-technologies/117-css-js-compression-without-performance-penalties">Compressing css and js without losing server performance</a> <br>  <a href="http://webo.in/articles/habrahabr/14-minifing-css/">CSS: all about compression</a> <br>  <a href="http://webo.in/articles/habrahabr/07-gzip-all/">Practical CSS / JS: archive everything!</a> <br></div><p>Source: <a href="https://habr.com/ru/post/30525/">https://habr.com/ru/post/30525/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../305204/index.html">Roman Nester, co-founder of Segmento - about the future of advertising technologies on the Internet</a></li>
<li><a href="../30521/index.html">Codeigniter - make your life easier (expanding the base controller)</a></li>
<li><a href="../30523/index.html">Easy way to make IPSec tunnel from FreeBSD to Cisco</a></li>
<li><a href="../30524/index.html">HTC Touch Criticism</a></li>
<li><a href="../305246/index.html">Big Binary in my Rust?</a></li>
<li><a href="../305252/index.html">2D magic in detail. Part one. Shine</a></li>
<li><a href="../305254/index.html">ThinkPwn vulnerability in computer firmware was more serious than it seemed before</a></li>
<li><a href="../305256/index.html">ORegex: Is it fast enough for objects?</a></li>
<li><a href="../305258/index.html">Win a weightless flight with Veeam and Zero Gravity (USA)</a></li>
<li><a href="../305262/index.html">Vulners - Google for a hacker. How is the best search engine for vulnerabilities and how to use it</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>