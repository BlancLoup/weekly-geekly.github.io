<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Flappy Bird: - Let's go</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a story about how to write your game on Corona. 
 The level of entry is minimal (and the botanist from the department of algebra will understa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Flappy Bird: - Let's go</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/qa/qv/iz/qaqvizxcp7m2i4jd187uchamczy.png"></div><br>  This is a story about how to write your game on Corona. <br>  The level of entry is minimal (and the botanist from the department of algebra will understand). <br><br>  I remind you that Corona is an engine for creating 2D games on all platforms and, touch-touch, today is Cosmonautics Day.  The plot for the game is selected and, of course, we repeat after the first cosmonaut. <br><blockquote>  -Go! </blockquote><a name="habracut"></a><h2>  What happens in 2 hours of programming? </h2><br>  That's what I got in 2 hours of programming. <br><br>  Of course, all this tops will take you 3 times less time, since I am a linear programmer, like algebra. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/53e21_GHkx8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Learned?  Yes, this is an <i>ad</i> game of <i>Ishq</i> from Vietnam. <br><br>  Let me remind you that the application brought the author $ 50,000 per day.  In my opinion, not bad. <br><br>  If you look in my clip to the fragments of the collision of a bird with a pillar, you can see the inscription HABR.  I use this picture as a texture for particle effect. <br><br><h2>  Installing Corona Tool </h2><br>  Takes 10 minutes and is <a href="https://docs.coronalabs.com/guide/programming/index.html">beautifully painted in many places.</a> <br><br><h2>  Creating a gagarinbird project </h2><br>  Run Corona on your machine (I have a Mac) and select the menu item <i>Create New Empty Project</i> . <br><br>  As a result, the gagarinbird directory is created in the specified location, in which there is a bunch of all kinds of useful garbage, among which in the future we will edit a single file called <br><blockquote>  main.lua </blockquote>  Text editor - at your discretion.  Programming language - Lua. <br><br>  First of all, we need pictures and sounds for the game. <br><br><div class="spoiler">  <b class="spoiler_title">How to get them without torturing the author?</b> <div class="spoiler_text"><ul><li>  Download the Flappy Bird [Dong Nguyen] file (v1.2 LP os60) -Orbicos-ICPDA.rc309.ipa </li><li>  Rename the file Flappy Bird [Dong Nguyen] (v1.2 LP os60) -Orbicos-ICPDA.rc309.zip </li><li>  Unpack the Flappy Bird [Dong Nguyen] file (v1.2 LP os60) -Orbicos-ICPDA.rc309.zip </li><li>  Click the right mouse button on the Flap.app file and select the Show Package Content option. </li><li>  Copy pictures and sounds to our gagarinbird directory </li></ul><br></div></div><br>  For convenience, make a subdirectory of gagarinbird / Assets and place all the pictures here. <br>  Similarly, we do the gagarinbird / Sounds subdirectory and put all the sounds here. <br><br><h2>  The first 2 lines of code - checking sounds Mu </h2><br>  Paste the first two lines of code into the main.lua file. <br><br><pre><code class="lua hljs">dieSound = audio.loadSound( <span class="hljs-string"><span class="hljs-string">"Sounds/sfx_die.caf"</span></span> ) audio.play( dieSound )</code> </pre> <br>  Press in Corona (many people call it Corona Simulator) 2 hot buttons / cmd / + R and our application will start in a window that looks like a phone and makes a sound of death!  Ay-ah, everything works. <br>  The background is pristine black, but it doesn't matter - we just learned to play any sounds.  And they sound the same, on Android, on the iPhone, on Windows (forgive me, Lord). <br><br><h2>  We load sounds and we make everything beautiful </h2><br>  Make the loadSounds () function and call it <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadSounds</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> dieSound = audio.loadSound( <span class="hljs-string"><span class="hljs-string">"Sounds/sfx_die.caf"</span></span> ) hitSound = audio.loadSound( <span class="hljs-string"><span class="hljs-string">"Sounds/sfx_hit.caf"</span></span> ) pointSound = audio.loadSound( <span class="hljs-string"><span class="hljs-string">"Sounds/sfx_point.aif"</span></span> ) swooshingSound = audio.loadSound( <span class="hljs-string"><span class="hljs-string">"Sounds/sfx_swooshing.caf"</span></span> ) wingSound = audio.loadSound( <span class="hljs-string"><span class="hljs-string">"Sounds/sfx_wing.caf"</span></span> ) boomSound = audio.loadSound( <span class="hljs-string"><span class="hljs-string">"Sounds/sfx_boom.mp3"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-comment"><span class="hljs-comment">-- Start application point loadSounds()</span></span></code> </pre><br><h2>  Load the background image and process tap-tap </h2><br>  Learning to draw a background picture on the entire screen of the phone <br><br><pre> <code class="lua hljs"> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initBackGround</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> ground = display.newImageRect( <span class="hljs-string"><span class="hljs-string">"Assets/ground.png"</span></span>, display.actualContentWidth, display.actualContentHeight ) ground.x = display.contentCenterX ground.y = display.contentCenterY <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-comment"><span class="hljs-comment">--    initBackGround()</span></span></code> </pre><br>  Run (ctrl + R), get some pretty nice picture <br><br><img src="https://habrastorage.org/webt/0p/83/ex/0p83ex2gp1htx_qgjiuucjtzyss.png"><br><br>  Hurray, now we can draw any picture, place it anywhere and transform as we want. <br><br>  For example, <br><br><pre> <code class="lua hljs">ground.rotation = <span class="hljs-number"><span class="hljs-number">90</span></span></code> </pre><br>  rotates the background image 90 degrees. <br><br>  Add a poke into the screen. <br><br><pre> <code class="lua hljs"> ground:addEventListener(<span class="hljs-string"><span class="hljs-string">"tap"</span></span>, wing) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> audio.play( wingSound ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  We added a Listener, which catches all the clicks on the ground and calls the wing () function. <br>  If you look at the code, each poking into our ground should cause the sound of wing.caf. <br><br>  We start - everything works. <br><br><h2>  Flight physics and timer </h2><br>  Corona has a physics library, with gravity and collisions.  But for our game it is redundant.  Adding objects (birds, Earth and pillars) and setting parameters will require more code than simply starting a timer (40 times per second) with checking collisions and driving dynamics in the Earth‚Äôs gravitational field.  Earth in the porthole.  Sorry, distracted. <br><br>  Let's make the dynamics in the language of the time machine <br><br><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">--  ,    25  gameLoopTimer = timer.performWithDelay( 25, gameLoop, 0 ) local function gameLoop() vBird = vBird + dt * g yBird = yBird + dt * vBird end</span></span></code> </pre><br>  40 times per second our gameLoop () function is called <br><br>  The movement of the bird is recorded in two lines of this function.  Here g is the acceleration due to gravity (for iPhone it‚Äôs 800 pixels per second per second) <br><br>  dt = 0.025 - time step <br><br>  uBird - the speed of the bird along the X axis <br>  vBird - the speed of the bird along the Y axis <br><br>  xBird - the X coordinate of the bird <br>  yBird - the Y coordinate of the bird <br><br>  The dynamics of the movement of the pillars and the surface is even simpler - the movement occurs only along the X axis <br><br><pre> <code class="lua hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i=<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> pipes[i].x = pipes[i].x + dt * uBird <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><h2>  Game states </h2><br>  All the bricks are ready, it remains to put everything together in an elegant cattle-program.  So, in our game there are 4 states. <br><br>  State 0 (gameStatus = 0) is all frozen and ready to start the game.  We are waiting for clicking on the screen.  When pressed, go to state 1. <br>  State 1 (gameStatus = 1) the bird flies, the pillars move, gravity works.  Tapping the screen adds speed to the bird strictly up (vBird = jumpSpeed). <br>  State 2 (gameStatus = 2) the bird collided with a green pillar and falls strictly down, the pillars are standing, gravity works.  Tapping the screen does not affect anything. <br>  State 3 (gameStatus = 3) the bird collided with the Earth, everything froze, scoring and displaying the result of the flight.  We are waiting for clicking to go to state 0. <br><br>  In principle, state 1 and 2 can be combined by setting the horizontal velocity to 0 in the latter, this is a matter of taste. <br><br><h2>  Waving wings and sprite animation </h2><br>  The slope of the bird is proportional to the velocity vector. <br>  That is equal to the arctangent of the angle. <br><br><pre> <code class="lua hljs"> bird.rotation = <span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">atan</span></span>(vBird/uBird)</code> </pre><br>  To animate the flapping of the bird's wings when you tap the screen, the Corona sprite list is used.  It is a bit more complicated than just a png picture. <br><br><img src="https://habrastorage.org/webt/kq/bc/r_/kqbcr_uzldodabhj35hvrsvvrho.png"><br><br>  Let's create animation frames in a separate png file.  400 by 100 pixels.  The size of each internal sprite is 100 by 100. That is, we have 4 frames. <br><br>  Initialization code birdies next <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupBird</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> options = { width = <span class="hljs-number"><span class="hljs-number">100</span></span>, height = <span class="hljs-number"><span class="hljs-number">100</span></span>, numFrames = <span class="hljs-number"><span class="hljs-number">4</span></span>, sheetContentWidth = <span class="hljs-number"><span class="hljs-number">400</span></span>, <span class="hljs-comment"><span class="hljs-comment">-- width of original 1x size of entire sheet sheetContentHeight = 100 -- height of original 1x size of entire sheet } local imageSheet = graphics.newImageSheet( "Assets/bird.png", options ) local sequenceData = { name="walking", start=1, count=3, time=300, loopCount = 2, -- Optional ; default is 0 (loop indefinitely) loopDirection = "forward" -- Optional ; values include "forward" or "bounce" } bird = display.newSprite( imageSheet, sequenceData ) bird.x = xBird bird.y = yBird end</span></span></code> </pre><br>  Now, at the moment of clicking on the screen, we call the line of code <br><br><pre> <code class="lua hljs">bird:play()</code> </pre><br>  And the bird flaps its wings 2 times in a row. <br><br><h2>  Collision and particle effect </h2><br>  Collision checking is elementary. <br><br>  First, checking for collisions with the Earth‚Äôs surface <br><br><pre> <code class="lua hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> yBird&gt;yLand <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> yBird = yLand crash() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Second, the collision check with the pillars <br><br><pre> <code class="lua hljs"> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkCollision</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> dx = <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-comment"><span class="hljs-comment">--      local dy = 50 --      local boom = 0 local x = pipes[i].x local y = pipes[i].y if xBird &gt; (x-dx) and xBird &lt; (x+dx) then if yBird &gt; (y+dy) or yBird &lt; (y-dy) then boom = 1 end end return boom end</span></span></code> </pre><br>  Add a particle effect in the place where the bird collides with the pole. <br><br>  The code looks cumbersome, but by changing the effect's 20 parameters, you can get amazing explosions, flashes and fireballs. <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupExplosion</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> dx = <span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> p = <span class="hljs-string"><span class="hljs-string">"Assets/habra.png"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> emitterParams = { startParticleSizeVariance = dx/<span class="hljs-number"><span class="hljs-number">2</span></span>, startColorAlpha = <span class="hljs-number"><span class="hljs-number">0.61</span></span>, startColorGreen = <span class="hljs-number"><span class="hljs-number">0.3031555</span></span>, startColorRed = <span class="hljs-number"><span class="hljs-number">0.08373094</span></span>, yCoordFlipped = <span class="hljs-number"><span class="hljs-number">0</span></span>, blendFuncSource = <span class="hljs-number"><span class="hljs-number">770</span></span>, blendFuncDestination = <span class="hljs-number"><span class="hljs-number">1</span></span>, rotatePerSecondVariance = <span class="hljs-number"><span class="hljs-number">153.95</span></span>, particleLifespan = <span class="hljs-number"><span class="hljs-number">0.7237</span></span>, tangentialAcceleration = <span class="hljs-number"><span class="hljs-number">-144.74</span></span>, startParticleSize = dx, textureFileName = p, startColorVarianceAlpha = <span class="hljs-number"><span class="hljs-number">1</span></span>, maxParticles = <span class="hljs-number"><span class="hljs-number">128</span></span>, finishParticleSize = dx/<span class="hljs-number"><span class="hljs-number">3</span></span>, duration = <span class="hljs-number"><span class="hljs-number">0.75</span></span>, finishColorRed = <span class="hljs-number"><span class="hljs-number">0.078</span></span>, finishColorAlpha = <span class="hljs-number"><span class="hljs-number">0.75</span></span>, finishColorBlue = <span class="hljs-number"><span class="hljs-number">0.3699196</span></span>, finishColorGreen = <span class="hljs-number"><span class="hljs-number">0.5443883</span></span>, maxRadiusVariance = <span class="hljs-number"><span class="hljs-number">172.63</span></span>, finishParticleSizeVariance = dx/<span class="hljs-number"><span class="hljs-number">2</span></span>, gravityy = <span class="hljs-number"><span class="hljs-number">220.0</span></span>, speedVariance = <span class="hljs-number"><span class="hljs-number">258.79</span></span>, tangentialAccelVariance = <span class="hljs-number"><span class="hljs-number">-92.11</span></span>, angleVariance = <span class="hljs-number"><span class="hljs-number">-300.0</span></span>, angle = <span class="hljs-number"><span class="hljs-number">-900.11</span></span> } emitter = display.newEmitter(emitterParams ) emitter:stop() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  I leave this piece of code without comment - just indulge in the parameters themselves. <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">explosion</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> emitter.x = bird.x emitter.y = bird.y emitter:start() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Function explosion () is called at the moment of collision of a bird with a pillar.  I could not <i>pixelate the</i> effect in the style of all the pictures in the game.  Perhaps you have advice on how to do this.  If anything, Scale did not work. <br><br><h2>  thank </h2><br>  The entire project for free without SMS can be downloaded from the Corona Marketplace during the May holidays.  The code is moderated. <br><br>  Among other things, I became a Corona evangelist, received the first salary and all this thanks to the publication on Habr√©.  Thanks to the resource and of course you, readers.  Algebraists also hello. <br><br><h2>  Project code </h2><br><div class="spoiler">  <b class="spoiler_title">Project code in one main.lua file</b> <div class="spoiler_text"><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">----------------------------------------------------------------------------------------- -- -- main.lua -- ----------------------------------------------------------------------------------------- local gameStatus = 0 local yLand = display.actualContentHeight - 160 local hLand = 60 local xLand = display.contentCenterX local yBird = display.contentCenterY-50 local xBird = display.contentCenterX-50 local wPipe = display.contentCenterX+10 local yReady = display.contentCenterY-140 local uBird = -200 local vBird = 0 local wBird = -320 local g = 800 local dt = 0.025 local score = 0 local bestScore = 0 local scoreStep = 5 local bird local land local title local getReady local gameOver local emitter local board local scoreTitle local bestTitle local silver local gold local pipes = {} local function loadSounds() dieSound = audio.loadSound( "Sounds/sfx_die.caf" ) hitSound = audio.loadSound( "Sounds/sfx_hit.caf" ) pointSound = audio.loadSound( "Sounds/sfx_point.aif" ) swooshingSound = audio.loadSound( "Sounds/sfx_swooshing.caf" ) wingSound = audio.loadSound( "Sounds/sfx_wing.caf" ) boomSound = audio.loadSound( "Sounds/sfx_boom.mp3" ) end local function calcRandomHole() return 60 + 20*math.random(10) end local function loadBestScore() local path = system.pathForFile( "bestscore.txt", system.DocumentsDirectory ) -- Open the file handle local file, errorString = io.open( path, "r" ) if not file then -- Error occurred; output the cause print( "File error: " .. errorString ) else -- Read data from file local contents = file:read( "*a" ) -- Output the file contents bestScore = tonumber( contents ) -- Close the file handle io.close( file ) end file = nil end local function saveBestScore() -- Path for the file to write local path = system.pathForFile( "bestscore.txt", system.DocumentsDirectory ) local file, errorString = io.open( path, "w" ) if not file then -- Error occurred; output the cause print( "File error: " .. errorString ) else file:write( bestScore ) io.close( file ) end file = nil end local function setupBird() local options = { width = 70, height = 50, numFrames = 4, sheetContentWidth = 280, -- width of original 1x size of entire sheet sheetContentHeight = 50 -- height of original 1x size of entire sheet } local imageSheet = graphics.newImageSheet( "Assets/bird.png", options ) local sequenceData = { name="walking", start=1, count=3, time=300, loopCount = 2, -- Optional ; default is 0 (loop indefinitely) loopDirection = "forward" -- Optional ; values include "forward" or "bounce" } bird = display.newSprite( imageSheet, sequenceData ) bird.x = xBird bird.y = yBird end local function prompt(tempo) bird:play() end local function initGame() score = 0 scoreStep = 5 title.text = score for i=1,3 do pipes[i].x = 400 + display.contentCenterX * (i-1) pipes[i].y = calcRandomHole() end yBird = display.contentCenterY-50 xBird = display.contentCenterX-50 getReady.y = 0 getReady.alpha = 1 gameOver.y = 0 gameOver.alpha = 0 board.y = 0 board.alpha = 0 audio.play( swooshingSound ) transition.to( bird, { time=300, x=xBird, y=yBird, rotation = 0 } ) transition.to( getReady, { time=600, y=yReady, transition=easing.outBounce, onComplete=prompt } ) end local function wing() if gameStatus==0 then gameStatus=1 getReady.alpha = 0 end if gameStatus==1 then vBird = wBird bird:play() audio.play( wingSound ) end if gameStatus==3 then gameStatus=0 initGame() end end local function setupExplosion() local dx = 31 local p = "Assets/habra.png" local emitterParams = { startParticleSizeVariance = dx/2, startColorAlpha = 0.61, startColorGreen = 0.3031555, startColorRed = 0.08373094, yCoordFlipped = 0, blendFuncSource = 770, blendFuncDestination = 1, rotatePerSecondVariance = 153.95, particleLifespan = 0.7237, tangentialAcceleration = -144.74, startParticleSize = dx, textureFileName = p, startColorVarianceAlpha = 1, maxParticles = 128, finishParticleSize = dx/3, duration = 0.75, finishColorRed = 0.078, finishColorAlpha = 0.75, finishColorBlue = 0.3699196, finishColorGreen = 0.5443883, maxRadiusVariance = 172.63, finishParticleSizeVariance = dx/2, gravityy = 220.0, speedVariance = 258.79, tangentialAccelVariance = -92.11, angleVariance = -300.0, angle = -900.11 } emitter = display.newEmitter(emitterParams ) emitter:stop() end local function explosion() emitter.x = bird.x emitter.y = bird.y emitter:start() end local function crash() gameStatus = 3 audio.play( hitSound ) gameOver.y = 0 gameOver.alpha = 1 transition.to( gameOver, { time=600, y=yReady, transition=easing.outBounce } ) board.y = 0 board.alpha = 1 if score&gt;bestScore then bestScore = score saveBestScore() end bestTitle.text = bestScore scoreTitle.text = score if score&lt;10 then silver.alpha = 0 gold.alpha = 0 elseif score&lt;50 then silver.alpha = 1 gold.alpha = 0 else silver.alpha = 0 gold.alpha = 1 end transition.to( board, { time=600, y=yReady+100, transition=easing.outBounce } ) end local function collision(i) local dx = 40 -- horizontal space of hole local dy = 50 -- vertical space of hole local boom = 0 local x = pipes[i].x local y = pipes[i].y if xBird &gt; (x-dx) and xBird &lt; (x+dx) then if yBird &gt; (y+dy) or yBird &lt; (y-dy) then boom = 1 end end return boom end local function gameLoop() local eps = 10 local leftEdge = -60 if gameStatus==1 then xLand = xLand + dt * uBird if xLand&lt;0 then xLand = display.contentCenterX*2+xLand end land.x = xLand for i=1,3 do local xb = xBird-eps local xOld = pipes[i].x local x = xOld + dt * uBird if x&lt;leftEdge then x = wPipe*3+x pipes[i].y = calcRandomHole() end if xOld &gt; xb and x &lt;= xb then score = score + 1 title.text = score if score==scoreStep then scoreStep = scoreStep + 5 audio.play( pointSound ) end end pipes[i].x = x if collision(i)==1 then explosion() audio.play( dieSound ) gameStatus = 2 end end end if gameStatus==1 or gameStatus==2 then vBird = vBird + dt * g yBird = yBird + dt * vBird if yBird&gt;yLand-eps then yBird = yLand-eps crash() end bird.x = xBird bird.y = yBird if gameStatus==1 then bird.rotation = -30*math.atan(vBird/uBird) else bird.rotation = vBird/8 end end end local function setupLand() land = display.newImageRect( "Assets/land.png", display.actualContentWidth*2, hLand*2 ) land.x = xLand land.y = yLand+hLand end local function setupImages() local ground = display.newImageRect( "Assets/ground.png", display.actualContentWidth, display.actualContentHeight ) ground.x = display.contentCenterX ground.y = display.contentCenterY ground:addEventListener("tap", wing) for i=1,3 do pipes[i] = display.newImageRect( "Assets/pipe.png", 80, 1000 ) pipes[i].x = 440 + wPipe * (i-1) pipes[i].y = calcRandomHole() end getReady = display.newImageRect( "Assets/getready.png", 200, 60 ) getReady.x = display.contentCenterX getReady.y = yReady getReady.alpha = 0 gameOver = display.newImageRect( "Assets/gameover.png", 200, 60 ) gameOver.x = display.contentCenterX gameOver.y = 0 gameOver.alpha = 0 board = display.newGroup() local img = display.newImageRect(board, "Assets/board.png", 240, 140 ) scoreTitle = display.newText(board, score, 80, -18, "Assets/troika.otf", 21) scoreTitle:setFillColor( 0.75, 0, 0 ) bestTitle = display.newText(board, bestScore, 80, 24, "Assets/troika.otf", 21) bestTitle:setFillColor( 0.75, 0, 0 ) silver = display.newImageRect(board, "Assets/silver.png", 44, 44 ) silver.x = -64 silver.y = 4 gold = display.newImageRect(board, "Assets/gold.png", 44, 44 ) gold.x = -64 gold.y = 4 board.x = display.contentCenterX board.y = 0 board.alpha = 0 local txt = { x=display.contentCenterX, y=10, text="", font="Assets/troika.otf", fontSize=35 } title = display.newText(txt) title:setFillColor( 1, 1, 1 ) end -- Start application point loadSounds() setupImages() setupBird() setupExplosion() setupLand() initGame() loadBestScore() gameLoopTimer = timer.performWithDelay( 25, gameLoop, 0 )</span></span></code> </pre><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/353402/">https://habr.com/ru/post/353402/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../353372/index.html">PHDays 8: start online contests</a></li>
<li><a href="../353374/index.html">"Holey beep": found a critical vulnerability in the "beeper" Linux</a></li>
<li><a href="../353376/index.html">Professional burnout: how to recognize and prevent</a></li>
<li><a href="../353398/index.html">Transcription of the twelfth release of the podcast "Procurator"</a></li>
<li><a href="../353400/index.html">Internship retrospective</a></li>
<li><a href="../353404/index.html">The book "C ++ 17 STL. Standard Template Library ¬ª</a></li>
<li><a href="../353406/index.html">How I pumped the skills of personal effectiveness</a></li>
<li><a href="../353408/index.html">Scientific programming: part 1</a></li>
<li><a href="../353410/index.html">Device and mechanism of work of Prometheus Operator in Kubernetes</a></li>
<li><a href="../353412/index.html">What is frozen on feature freeze</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>