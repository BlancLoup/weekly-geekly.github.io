<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Flask Mega-Tutorial, Part 9: Pagination</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the ninth article in the series, where I describe my experience of writing a Python web application using the Flask mic framework. 

 The purp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Flask Mega-Tutorial, Part 9: Pagination</h1><div class="post__text post__text-html js-mediator-article"> This is the ninth article in the series, where I describe my experience of writing a Python web application using the Flask mic framework. <br><br>  The purpose of this guide is to develop a fairly functional microblog application, which I decided to call <code>microblog.</code> in the absence of originality <code>microblog.</code> <br><br><div class="spoiler">  <b class="spoiler_title">Content</b> <div class="spoiler_text">  Content 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="http://habrahabr.ru/post/193242/">Part 1: Hello, World!</a> <br>  <a href="http://habrahabr.ru/post/193260/">Part 2: Templates</a> <br>  <a href="http://habrahabr.ru/post/194062/">Part 3: Forms</a> <br>  <a href="http://habrahabr.ru/post/196810/">Part 4: Database</a> <br>  <a href="http://habrahabr.ru/post/222983/">Part 5: User Login</a> <br>  <a href="http://habrahabr.ru/post/223375/">Part 6: Profile Page and Avatars</a> <br>  <a href="http://habrahabr.ru/post/223783/">Part 7: Unit Testing</a> <br>  <a href="http://habrahabr.ru/post/230643/">Part 8: Subscribers, contacts and friends.</a> <br>  <a href="http://habrahabr.ru/post/230897/">Part 9: Pagination (this article)</a> <br>  <a href="http://habrahabr.ru/post/234613/">Part 10: Full Text Search</a> <br>  <a href="http://habrahabr.ru/post/234737/">Part 11: Email Support</a> <br>  <a href="http://habrahabr.ru/post/234785/">Part 12: Reconstruction</a> <br>  <a href="http://habrahabr.ru/post/236753/">Part 13: Date and Time</a> <br>  <a href="http://habrahabr.ru/post/236861/">Part 14: I18n and L10n</a> <br>  <a href="http://habrahabr.ru/post/237065/">Part 15: Ajax</a> <br>  <a href="http://habrahabr.ru/post/237317/">Part 16: Debugging, Testing, and Profiling</a> <br>  <a href="http://habrahabr.ru/post/237489/">Part 17: Deploying to Linux (and even to Raspberry Pi!)</a> <br>  <a href="http://habrahabr.ru/post/237517/">Part 18: Deploying to Heroku Cloud</a> <br></div></div><br><br><h2>  Brief repetition </h2><br><br>  In the previous article, we made all the necessary changes to the database to support the "subscribers" paradigm, in which users can track the posts of other users. <br><br>  Today, based on what we did last time, we will bring our application to mind, so that it receives and delivers real content for our users.  Today we say goodbye to the last of our fake objects! <br><a name="habracut"></a><br><h2>  Blog posting </h2><br><br>  Let's start with something simple.  The homepage should have a custom form for new posts. <br><br>  First we define a single field form object <code>( app/forms.py)</code> : <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostForm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Form)</span></span></span><span class="hljs-class">:</span></span> post = TextField(<span class="hljs-string"><span class="hljs-string">'post'</span></span>, validators = [Required()])</code> </pre><br><br>  Next, we will add the form to the templates <code>( app/templates/index.html)</code> : <br><br><pre> <code class="python hljs">&lt;!-- extend base layout --&gt; {% extends <span class="hljs-string"><span class="hljs-string">"base.html"</span></span> %} {% block content %} &lt;h1&gt;Hi, {{g.user.nickname}}!&lt;/h1&gt; &lt;form action=<span class="hljs-string"><span class="hljs-string">""</span></span> method=<span class="hljs-string"><span class="hljs-string">"post"</span></span> name=<span class="hljs-string"><span class="hljs-string">"post"</span></span>&gt; {{form.hidden_tag()}} &lt;table&gt; &lt;tr&gt; &lt;td&gt;Say something:&lt;/td&gt; &lt;td&gt;{{ form.post(size = <span class="hljs-number"><span class="hljs-number">30</span></span>, maxlength = <span class="hljs-number"><span class="hljs-number">140</span></span>) }}&lt;/td&gt; &lt;td&gt; {% <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> form.errors.post %} &lt;span style=<span class="hljs-string"><span class="hljs-string">"color: red;"</span></span>&gt;[{{error}}]&lt;/span&gt;&lt;br&gt; {% endfor %} &lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&lt;/td&gt; &lt;td&gt;&lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> value=<span class="hljs-string"><span class="hljs-string">"Post!"</span></span>&gt;&lt;/td&gt; &lt;td&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/form&gt; {% <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> post <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> posts %} &lt;p&gt; {{post.author.nickname}} says: &lt;b&gt;{{post.body}}&lt;/b&gt; &lt;/p&gt; {% endfor %} {% endblock %}</code> </pre><br><br>  Nothing extraordinary, as you can see.  We simply add another form, just as we did before. <br><br>  And finally, the view function that links everything together <code>( app/views.py)</code> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> forms <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> LoginForm, EditForm, PostForm <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> User, ROLE_USER, ROLE_ADMIN, Post @app.route(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, methods = [<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'POST'</span></span>]) @app.route(<span class="hljs-string"><span class="hljs-string">'/index'</span></span>, methods = [<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'POST'</span></span>]) @login_required <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> form = PostForm() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> form.validate_on_submit(): post = Post(body = form.post.data, timestamp = datetime.utcnow(), author = g.user) db.session.add(post) db.session.commit() flash(<span class="hljs-string"><span class="hljs-string">'Your post is now live!'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> redirect(url_for(<span class="hljs-string"><span class="hljs-string">'index'</span></span>)) posts = [ { <span class="hljs-string"><span class="hljs-string">'author'</span></span>: { <span class="hljs-string"><span class="hljs-string">'nickname'</span></span>: <span class="hljs-string"><span class="hljs-string">'John'</span></span> }, <span class="hljs-string"><span class="hljs-string">'body'</span></span>: <span class="hljs-string"><span class="hljs-string">'Beautiful day in Portland!'</span></span> }, { <span class="hljs-string"><span class="hljs-string">'author'</span></span>: { <span class="hljs-string"><span class="hljs-string">'nickname'</span></span>: <span class="hljs-string"><span class="hljs-string">'Susan'</span></span> }, <span class="hljs-string"><span class="hljs-string">'body'</span></span>: <span class="hljs-string"><span class="hljs-string">'The Avengers movie was so cool!'</span></span> } ] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render_template(<span class="hljs-string"><span class="hljs-string">'index.html'</span></span>, title = <span class="hljs-string"><span class="hljs-string">'Home'</span></span>, form = form, posts = posts)</code> </pre><br><br>  Let's take a look at the changes we made in this function, step by step: <br><br><ul><li>  First we import the <code>Post</code> and <code>PostForm</code> classes <code>PostForm</code> <br></li><li>  We accept POST requests from both routes associated with the <code>index()</code> view function, here we will accept new posts. <br></li><li>  Before the post is saved in the database, it falls into this function.  When we get into this function via GET, everything happens as before. <br></li><li>  The template now receives an additional argument, a form, which it renders into text fields. </li></ul><br><br>  And finally, before we continue.  Please note that before writing a new post in the database, we do this: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> redirect(url_for(<span class="hljs-string"><span class="hljs-string">'index'</span></span>))</code> </pre><br><br>  We can easily skip this redirect and move on to rendering.  Perhaps it will even be more effective.  Because everything that does this redirect, in fact, it returns us to the same function. <br><br>  So why redirect?  Consider what happens when a user writes a post to a blog, publishes it and presses the Refresh button.  What does the Refresh command do?  The browser re-sends the previous request. <br><br>  Without a redirect, the last one was a POST request that sent the form, so the ‚ÄúRefresh‚Äù action will re-send this request, with the result that we get a second post that is identical to the first one.  This is bad. <br><br>  But with a redirect, we will force the browser to issue another request after submitting the form.  This is a simple GET request, and now the Refresh button will simply load the page once more, instead of re-sending the form. <br><br>  This simple trick allows you to avoid inserting duplicate messages if the user accidentally refreshes the page after posting. <br><br><h2>  Displaying blog posts </h2><br><br>  We turn to the most interesting.  We are going to pull out posts from the database and display them. <br><br>  If you remember a few articles back, we made a couple of fake posts and we showed them on our main page for a long time.  These fake objects were created explicitly in a Python list view function: <br><br><pre> <code class="python hljs"> posts = [ { <span class="hljs-string"><span class="hljs-string">'author'</span></span>: { <span class="hljs-string"><span class="hljs-string">'nickname'</span></span>: <span class="hljs-string"><span class="hljs-string">'John'</span></span> }, <span class="hljs-string"><span class="hljs-string">'body'</span></span>: <span class="hljs-string"><span class="hljs-string">'Beautiful day in Portland!'</span></span> }, { <span class="hljs-string"><span class="hljs-string">'author'</span></span>: { <span class="hljs-string"><span class="hljs-string">'nickname'</span></span>: <span class="hljs-string"><span class="hljs-string">'Susan'</span></span> }, <span class="hljs-string"><span class="hljs-string">'body'</span></span>: <span class="hljs-string"><span class="hljs-string">'The Avengers movie was so cool!'</span></span> } ]</code> </pre><br><br>  But in the last article, we created a query that allows us to receive all the messages from people that the user has signed up for, so we can simply replace the above lines <code>( app/views.py)</code> : <br><br><pre> <code class="python hljs"> posts = g.user.followed_posts().all()</code> </pre><br><br>  Now, when you launch the app, you will see posts from the database! <br><br>  The <code>followed_post</code> method of the <code>User</code> class returns a <code>query</code> sqlalchemy object that is configured to pull messages of interest to us.  By calling the <code>all()</code> method on this object we get all the posts in the form of a sheet, so ultimately we will work with the structure we are used to.  They are so similar that the template will not notice anything. <br><br>  Now you can play with our application.  Do not be shy.  You can create multiple users, subscribe them to other users, and finally publish several messages to see how each user sees their feed. <br><br><h2>  Pagination </h2><br><br>  Our application looks better than ever, but there is a problem.  We shows all posts on the home page.  What happens if a user is subscribed to several thousand people?  Or a million?  As you can imagine, sampling and processing such a large list will be extremely inefficient. <br><br>  Instead, we will show a potentially large number of posts paginated. <br><br>  Flask-SQLAlchemy comes with very good pagination support.  If, for example, we want to get the first three posts from tracked users, we can do this: <br><br><pre> <code class="python hljs"> posts = g.user.followed_posts().paginate(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>).items</code> </pre><br><br>  The <code>paginate</code> method <code>paginate</code> called on any <code>query</code> object.  It takes three arguments: <br><br><ul><li>  Page number, starting with 1 </li><li>  number of elements per page, </li><li>  and flag error.  If the flag is set to True, when going outside the bounds of the list, a 404 error is returned to the client. </li><li>  Otherwise, an empty list will be returned instead of an error. </li></ul><br><br>  The <code>paginate</code> method returns the Pagination object.  Members of this object contain a list of the elements of the requested page.  There are other useful things in the Pagination object, but we will look at them a little later. <br><br>  Let's think about how we can implement pagination in our index () view function.  We can start by adding a configuration item to our application that determines how many items on the page we will show. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># pagination POSTS_PER_PAGE = 3</span></span></code> </pre><br><br>  It is a good idea to keep the global settings of the application, which may affect the behavior, in one place. <br><br>  In the final application, of course, we will use a number greater than 3, but for testing it is more convenient to work with a small amount. <br><br>  Next, let's decide now what the URL will look like with the page request.  We have seen before that Flask allows you to take arguments in routes, so that we can add a suffix that points to the page you need: <br><br><pre> <code class="python hljs">http://localhost:<span class="hljs-number"><span class="hljs-number">5000</span></span>/ &lt;-- page <span class="hljs-comment"><span class="hljs-comment">#1 (default) http://localhost:5000/index &lt;-- page #1 (default) http://localhost:5000/index/1 &lt;-- page #1 http://localhost:5000/index/2 &lt;-- page #2</span></span></code> </pre><br><br>  This URL format can be easily implemented using the additional route in our view <code>( app/views.py)</code> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> config <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> POSTS_PER_PAGE @app.route(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, methods = [<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'POST'</span></span>]) @app.route(<span class="hljs-string"><span class="hljs-string">'/index'</span></span>, methods = [<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'POST'</span></span>]) @app.route(<span class="hljs-string"><span class="hljs-string">'/index/&lt;int:page&gt;'</span></span>, methods = [<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'POST'</span></span>]) @login_required <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(page = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> form = PostForm() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> form.validate_on_submit(): post = Post(body = form.post.data, timestamp = datetime.utcnow(), author = g.user) db.session.add(post) db.session.commit() flash(<span class="hljs-string"><span class="hljs-string">'Your post is now live!'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> redirect(url_for(<span class="hljs-string"><span class="hljs-string">'index'</span></span>)) posts = g.user.followed_posts().paginate(page, POSTS_PER_PAGE, <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>).items <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render_template(<span class="hljs-string"><span class="hljs-string">'index.html'</span></span>, title = <span class="hljs-string"><span class="hljs-string">'Home'</span></span>, form = form, posts = posts)</code> </pre><br><br>  Our new route pulls the argument with the page number and declares it as an integer.  We also need to add this argument to the <code>index()</code> function and set a default value, because two of the three routes do not use this argument, and for them it will be used with the default value. <br><br>  Now that we have a page number, we can easily connect it to our <code>followed_posts</code> request, along with the <code>POSTS_PER_PAGE</code> variable that we defined earlier. <br><br>  Notice how easy the changes go through and how little the code changes.  We try to write every part of the application, not trying to guess how the other parts work, which allows us to build modular and reliable applications that are easy to test. <br><br>  Now you can experience pagination by entering URLs with different line numbers into the address bar of the browser.  Make sure that there are more than three posts that you see on the page. <br><br><h2>  Page navigation </h2><br><br>  Now we need to add links through which the user can move to the next / previous page, and fortunately for us Flask-SQLAlchemy will do most of the work. <br><br>  We are going to start by making small changes to the view function.  In our current version we use pagination as follows: <br><br><pre> <code class="python hljs">posts = g.user.followed_posts().paginate(page, POSTS_PER_PAGE, <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>).items</code> </pre><br><br>  By doing this, we only save the elements of the Pagination object returned by the paginate method.  But this object provides several very useful features, so we will keep the entire object <code>( app/views.py)</code> : <br><br><pre> <code class="python hljs">posts = g.user.followed_posts().paginate(page, POSTS_PER_PAGE, <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>)</code> </pre><br><br>  To copy this change, we need to change the template <code>( app/templates/index.html)</code> : <br><br><pre> <code class="python hljs">&lt;!-- posts <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> a Paginate object --&gt; {% <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> post <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> posts.items %} &lt;p&gt; {{post.author.nickname}} says: &lt;b&gt;{{post.body}}&lt;/b&gt; &lt;/p&gt; {% endfor %}</code> </pre><br><br>  What the Paginate object in the template gives us.  Here are the object methods we will use: <br><br><ul><li>  has_next: True there is at least one page after the current one </li><li>  has_prev: True if there is at least one page before the current one </li><li>  next_num: next page number </li><li>  prev_num: previous page number </li></ul><br><br>  With their help, we can do the following <code>( app/templates/index.html)</code> : <br><br><pre> <code class="python hljs">&lt;!-- posts <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> a Paginate object --&gt; {% <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> post <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> posts.items %} &lt;p&gt; {{post.author.nickname}} says: &lt;b&gt;{{post.body}}&lt;/b&gt; &lt;/p&gt; {% endfor %} {% <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> posts.has_prev %}&lt;a href=<span class="hljs-string"><span class="hljs-string">"{{ url_for('index', page = posts.prev_num) }}"</span></span>&gt;&lt;&lt; Newer posts&lt;/a&gt;{% <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> %}&lt;&lt; Newer posts{% endif %} | {% <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> posts.has_next %}&lt;a href=<span class="hljs-string"><span class="hljs-string">"{{ url_for('index', page = posts.next_num) }}"</span></span>&gt;Older posts &gt;&gt;&lt;/a&gt;{% <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> %}Older posts &gt;&gt;{% endif %}</code> </pre><br><br>  Now we have two links.  First we will show the link "Newer posts", which will send us to the previous page, to new posts.  On the other hand, ‚ÄúOlder posts‚Äù will send us to the next page, to older posts. <br><br>  But when we are on the first page, we don‚Äôt need a link to the previous page.  Such a case is easy to track using the posts.has_prev method, which returns False.  In this case, we show the link text, but without the link itself.  The link is not the next page is processed in the same way. <br><br><h2>  Implementing the sub-template Post </h2><br><br>  Earlier, in the article in which we added an avatar, we will define a subpattern with the HTML code for rendering a single post.  We made this template to get rid of code duplication if we want to render posts on different pages. <br><br>  It is time to implement this sub-template on the main page. It will be as simple as most things we do today <code>( app/templates/index.html)</code> : <br><br><pre> <code class="python hljs">&lt;!-- posts <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> a Paginate object --&gt; {% <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> post <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> posts.items %} {% include <span class="hljs-string"><span class="hljs-string">'post.html'</span></span> %} {% endfor %}</code> </pre><br><br>  Amazing right?  We simply replaced the old rendering code with the include of our template.  This way we get a better version of rendering, with the user's avatar. <br><br>  Here is a screenshot of the main page in the current state: <br><br><img src="http://blog.miguelgrinberg.com/static/images/flask-mega-tutorial-part-ix.png" alt="image"><br><br><h2>  User profile page </h2><br><br>  Now we are done with the main page.  We also included messages in the user profile, but not all, but only the owner of the profile.  To be consistent, we need to change the profile page to fit the main page. <br><br>  Changes are similar to those we made on the main page.  Here is a brief list of what we need to do: <br><br><ul><li>  add an additional route that takes the page number </li><li>  add an argument with the page number to the presentation function and assign it to 1 </li><li>  replace fake posts with real ones from the database and split them into pages </li><li>  update template to use pagination object </li></ul><br><br>  These are the presentation function updates <code>( app/views.py)</code> : <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@app.route('/user/&lt;nickname&gt;') @app.route('/user/&lt;nickname&gt;/&lt;int:page&gt;') @login_required def user(nickname, page = 1): user = User.query.filter_by(nickname = nickname).first() if user == None: flash('User ' + nickname + ' not found.') return redirect(url_for('index')) posts = user.posts.paginate(page, POSTS_PER_PAGE, False) return render_template('user.html', user = user, posts = posts)</span></span></code> </pre><br><br> <code> ,       ( ),        .</code> <br> <br>  Changes in the template are also quite simple <code>( app/templates/user.html)</code> : <br><br><pre> <code class="python hljs">&lt;!-- posts <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> a Paginate object --&gt; {% <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> post <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> posts.items %} {% include <span class="hljs-string"><span class="hljs-string">'post.html'</span></span> %} {% endfor %} {% <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> posts.has_prev %}&lt;a href=<span class="hljs-string"><span class="hljs-string">"{{ url_for('user', nickname = user.nickname, page = posts.prev_num) }}"</span></span>&gt;&lt;&lt; Newer posts&lt;/a&gt;{% <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> %}&lt;&lt; Newer posts{% endif %} | {% <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> posts.has_next %}&lt;a href=<span class="hljs-string"><span class="hljs-string">"{{ url_for('user', nickname = user.nickname, page = posts.next_num) }}"</span></span>&gt;Older posts &gt;&gt;&lt;/a&gt;{% <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> %}Older posts &gt;&gt;{% endif %}</code> </pre><br><br><h2>  Final words </h2><br><br>  Below I post the updated version of the <code>microblog</code> application in all the changes made in this article. <br><br>  Download <a href="">microblog-0.9.zip.</a> <br><br>  As always, there is no database, you have to create it yourself.  If you follow this series of articles, you know how to do it.  If not, go back to the database article to find out. <br><br>  As always, I thank you for following me.  I hope to see you in the next article. <br><br>  <a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-ix-pagination">Miguel</a> </div><p>Source: <a href="https://habr.com/ru/post/230897/">https://habr.com/ru/post/230897/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230883/index.html">QPX Express API: ticket business without getting up off the couch</a></li>
<li><a href="../230887/index.html">Where are you? Heredoc from javascript</a></li>
<li><a href="../230889/index.html">Lightroom 5 & Capture One Pro 7 & Media Pro - comparing usability as a photo-processing catalog</a></li>
<li><a href="../230893/index.html">WebCamp 2014 Live Webcast: Developer Day</a></li>
<li><a href="../230895/index.html">Geomagnetic storm that just missed the earth</a></li>
<li><a href="../230899/index.html">About organizational structure and bureaucracy</a></li>
<li><a href="../230901/index.html">The division of the revenue of the stora into categories, the percentage of those who did not come to iOS7 and the next claims to Apple on in-game purchases are the main mobile news for the week</a></li>
<li><a href="../230903/index.html">Memorize effectively: two important principles in language learning</a></li>
<li><a href="../230905/index.html">New statistics Facebook: 1.32 billion users, 30% come only from the phone</a></li>
<li><a href="../230907/index.html">Unity 3D Test Automation Team</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>