<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How machines communicate: Modbus protocol</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Modbus protocol is the most common industrial protocol for M2M interaction. It is a de facto standard and is supported by almost all manufacturers...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How machines communicate: Modbus protocol</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/bb/c7/yu/bbc7yu_iqs8ucr9ofnja0lv48fm.png"></div><br>  The Modbus protocol is the most common industrial protocol for <abbr title="Machine to Machine">M2M</abbr> interaction.  It is a de facto standard and is supported by almost all manufacturers of industrial equipment. <br><br>  Due to its versatility and openness, the standard allows the integration of equipment from different manufacturers.  Modbus is used to collect readings from sensors, control relays and controllers, monitoring, etc. <br><br>  In the article we will analyze the implementation of the Modbus protocol, data formats, software for working with the protocol.  Let's try in practice to read data from the device. <br><a name="habracut"></a><br><h2>  Modbus history </h2><br>  Modbus was introduced in 1979 by Modicon (now Schneider Electric).  It was an open standard working on the RS-232 interface.  Later, a protocol implementation for RS-485 and Modbus TCP interfaces appeared.  The protocol quickly gained popularity, and many manufacturers began to implement it in their devices. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Later, the rights to the protocol were transferred to the non-profit organization <a href="http://www.modbus.org/">Modbus Organization</a> , which until now owns the standard. <br><br>  In the description of the Modbus standard, terminology inherited from the <a href="https://ru.wikipedia.org/wiki/Ladder_Diagram">relay logic</a> languages ‚Äã‚Äãis used.  For example, some registers are called coils (English coil). <br><br><h2>  Physical level </h2><br><img src="https://habrastorage.org/webt/m5/34/_z/m534_zwjmv1mjx1rl0b1n-soqew.png"><br><br><ul><li>  <b>RS-232/422/485</b> - serial interfaces widely used in industry.  RS-422/485 interfaces provide signal range up to 1200 meters.  Modbus RTU / ASCII protocols are used. </li><li>  <b>TCP / IP networks</b> - the physical data transfer channel can any ethernet interfaces.  Modbus TCP protocol used </li></ul><br><h2>  Logical level </h2><br><img src="https://habrastorage.org/webt/dn/mb/cx/dnmbcxephexiyanr-ipj70jvx58.png"><br>  <font color="999999">Modbus protocol differences</font> <br><br><h4>  Modbus ASCII </h4><br>  The data is encoded with characters from an ASCII table and transmitted in hexadecimal format.  The beginning of each package is indicated by a colon, and the end by a carriage return and line break.  This allows the protocol to be used on long delay lines and equipment with less accurate timers. <br><br><h4>  Modbus RTU </h4><br>  In the Modbus RTU protocol, the data is encoded in binary format, and the time slot is used as a packet delimiter.  This protocol is critical for delays and cannot work, for example, on modem lines.  At the same time, the overhead of data transmission is less than in Modbus ASCII, since the length of the messages is less. <br><br><h4>  Modbus TCP </h4><br>  The packet structure is similar to Modbus RTU, the data is also encoded in binary format, and packed into a regular TCP packet, for transmission over IP networks.  The integrity check used in Modbus RTU does not apply, since TCP already has its own integrity control mechanism. <br><br><h2>  Package format </h2><br><img src="https://habrastorage.org/webt/l2/r0/0n/l2r00nqrxcfnjpcabmcqgo0kpx0.png"><br>  <font color="999999">Formats of a package of different implementations of Modbus</font> <br><br>  All Modbus devices interact by following the master-slave model.  Requests can be initiated only by a master device, slaves can only respond to requests, and cannot start data transmission on their own.  Depending on the implementation of the protocol, the packet headers differ.  Here are the main components of the package, which is important to know: <br><br>  <b>ADU (Application Data Unit)</b> - Modbus package entirely, with all headers, PDU, checksum, address, and markers.  It differs, depending on the implementation of the protocol. <br><br>  <b>PDU (protocol data unit)</b> is the main part of the packet, the same for all implementations of the protocol.  Contains payload itself. <br><br>  <b>Device</b> address - the address of the recipient, that is, the slave device.  Up to 247 devices can be located in one segment of the Modbus network.  Only slaves have different addresses, the master has no addresses.  The address ‚Äú0‚Äù is used for broadcast requests from master, while slaves cannot respond to these broadcast packets. <br><br>  <b>Checksum</b> - packet integrity checking algorithms.  Modbus RTU and ASCII use 2 bytes of checksum.  The Modbus RTU uses the CRC16 algorithm, while the Modbus ASCII uses a simpler and less reliable LRC8.  In Modbus TCP, the checksum is not added to the ADU, since integrity is checked at the TCP level. <br><br>  We will not analyze additional headers specific to each individual protocol implementation, since this is not significant when working with the protocol at the application level. <br><br><h2>  Modbus registers and functions </h2><br>  In simplified form, the Modbus request structure consists of a function code (read / write), and data that must be read or written.  At the same time, function codes are different for different data types.  Let us examine what are the registers, and functions for working with them. <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/4a/wl/ph/4awlphxzog5eg3h5ntjnfjvnkwg.png"></div><br><ul><li>  <b>Discrete Inputs</b> - discrete device inputs, read only.  The range of addresses of registers: from 10001 to 19999. They have the function "02" - reading a group of registers </li><li>  <b>Coils</b> - discrete device outputs, or internal values.  Available for reading and writing.  The range of addresses of registers: from 20001 to 29999. It has the functions: ‚Äú01‚Äù - reads a group of registers, ‚Äú05‚Äù - write one register, ‚Äú15‚Äù - write a group of registers </li><li>  <b>Input Registers</b> - 16-bit device inputs.  Read only.  The range of addresses of registers: from 30001 to 39999. Have the function: "04" - reading a group of registers </li><li>  <b>Holding Registers</b> - 16-bit device outputs, or internal values.  Available for reading and writing.  The range of addresses of registers: from 40001 to 49999. They have </li></ul><br>  Despite the names, the inputs and outputs can actually be internal variables, store counters, flags, or be control triggers.  There are also other register ranges, but in the vast majority of devices they are not used, so we will look at four basic types of registers.  Different devices can be involved in different ranges of registers, or all at once. <br><br><h2>  Work examples </h2><br>  For an example of working with the Modbus TCP protocol, we will use the most simple console utility <a href="https://github.com/tallakt/modbus-cli">modbus-cli</a> written in the Ruby language.  It makes it easy to read and write data in the Modbus registers. <br><br>  Let's try to read the state of the transmitted packet counters on the Advantech EKI-5524SSI industrial switch.  First you need to determine the addresses of the registers that store the necessary information, for this we will look into the <a href="http://advdownload.advantech.com/productfile/Downloadfile5/1-YNI1GW/ProView_UM_DF-G_06262015.pdf">documentation of the</a> device.  Description of registers are in the section "Modbus Mapping Table": <br><br><img src="https://habrastorage.org/webt/gv/fb/nl/gvfbnliwkc7paqecufmcym_5hcw.png"><br>  <font color="999999">Description of register values ‚Äã‚Äãin the EKI switch documentation</font> <br><br>  It can be seen that the value of the transmitted packets for one port is stored in four registers, and for the first port it is registers from 38193 to 38197. A description is also given of the data storage format, from which it follows that an integer number of transmitted packets is stored in hexadecimal format and the value of 11223344 packets will be written as 0xAB4130, from right to left. <br><br>  Make a request: <br><br><pre><code class="plaintext hljs">$ modbus read 192.168.0.17 38193 4 38193 0x0000 38194 0x0000 38195 0x0000 38196 0x3459</code> </pre> <br>  <b>read</b> - <b>read</b> command.  The program itself understands what specific read command to use, depending on the address of the register, in our case the command ‚Äú04‚Äù will be used to read 16-bit registers. <br><br>  <b>192.168.0.17</b> - the IP address of the device. <br><br>  <b>38193</b> - the starting address of the register. <br><br>  <b>4</b> - offset relative to the starting address.  We read four registers for port 1, as follows from the datasheet. <br><br>  We receive the answer containing values ‚Äã‚Äãof four registers.  We see that the number of packets is small: 0x3459, that is 13401, - the switch has been switched on recently. <br><br><h2>  Disadvantages of the Modbus protocol </h2><br>  In fairness, it is worth mentioning the shortcomings of the protocol.  Since it was developed more than 40 years ago, when the processor performance was significantly lower and the protocols were developed without taking into account data protection, it has a lot of minuses: <br><br><ul><li>  The protocol does not provide for authentication and encryption of transmitted data.  Therefore, when using Modbus TCP, it is necessary to use additional VPN tunnels. </li><li>  The slave device cannot initiate data transfer, so the master must constantly poll slave devices </li><li>  The slave device cannot detect loss of communication with the master.  This problem directly follows from the previous one. </li></ul><br>  However, despite all the shortcomings, Modbus is still the most common industrial protocol, and due to its openness, makes it easy to combine devices from different manufacturers.  Low demand for resources allows the protocol to be integrated into the most low-power devices. <br><br><h2>  Equipment with Modbus support </h2><br>  Advantech offers a wide range of industrial equipment with Modbus protocol support for any tasks: automation, control, data collection and transmission. <br><br><h3>  <a href="https://www.advantech.ru/products/ethernet-i-o-modules-adam-6000-adam-6100-adam-6200-wise-4000-lan/sub_gf-5197%3Futm_source%3Dhabr%26utm_medium%3Dpost%26utm_campaign%3Dmodbus%26utm_content%3Dadam-6000">ADAM-6000</a> and <a href="https://www.advantech.ru/products/iot-wireless-i-o-modules-wise-4000/sub_cff2131f-4a19-433f-b404-b7875680a53c%3Futm_source%3Dhabr%26utm_medium%3Dpost%26utm_campaign%3Dmodbus%26utm_content%3Dwise-4000">WISE-4000</a> ‚Äî Remote I / O Modules </h3><br><br><img width="300" align="left" src="https://habrastorage.org/webt/bm/b9/b-/bmb9b-docciwnsxbugs_iurafge.png">  The modules of the <a href="https://www.advantech.ru/products/ethernet-i-o-modules-adam-6000-adam-6100-adam-6200-wise-4000-lan/sub_gf-5197%3Futm_source%3Dhabr%26utm_medium%3Dpost%26utm_campaign%3Dmodbus%26utm_content%3Dadam-6000">ADAM-6000</a> and <a href="https://www.advantech.ru/products/iot-wireless-i-o-modules-wise-4000/sub_cff2131f-4a19-433f-b404-b7875680a53c%3Futm_source%3Dhabr%26utm_medium%3Dpost%26utm_campaign%3Dmodbus%26utm_content%3Dwise-4000">WISE-4000</a> series allow you to remotely control digital and analogue inputs / outputs using the Modbus TCP protocol.  Used to control peripheral devices and collect data in slave mode.  Can work together with a programmable logic controller, or connect directly to a SCADA server. ‚†Ä‚†Ä‚†Ä ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä <br><br><h3>  <a href="https://www.advantech.ru/products/modbus-gateways/sub_db72f61c-801b-4e61-8863-5d418f01b6e9%3Futm_source%3Dhabr%26utm_medium%3Dpost%26utm_campaign%3Dmodbus%26utm_content%3Dgateway">EKI-1200</a> - Modbus gateways for interface conversion </h3><br><img width="150" align="left" src="https://habrastorage.org/webt/am/pe/59/ampe59uyvdyrklbjfex5upjfcdu.png"><br>  To convert Modbus RTU / ASCII protocols to Modbus TCP, Modbus gateways are used.  The <a href="https://www.advantech.ru/products/modbus-gateways/sub_db72f61c-801b-4e61-8863-5d418f01b6e9%3Futm_source%3Dhabr%26utm_medium%3Dpost%26utm_campaign%3Dmodbus%26utm_content%3Dgateway">EKI-1200</a> series <a href="https://www.advantech.ru/products/modbus-gateways/sub_db72f61c-801b-4e61-8863-5d418f01b6e9%3Futm_source%3Dhabr%26utm_medium%3Dpost%26utm_campaign%3Dmodbus%26utm_content%3Dgateway">devices</a> have up to four RS-232/422/485 serial interfaces, and two Ethernet ports.  They allow you to combine devices with different protocols into one network.  For example, connect a slave device that supports only Modbus RTU via an RS-485 interface to a Modbus TCP network segment. <br><br><h3>  <a href="https://www.advantech.ru/products/automation-controllers-i-os/sub_1-2mlf31%3Futm_source%3Dhabr%26utm_medium%3Dpost%26utm_campaign%3Dmodbus%26utm_content%3Dcontrollers">APAX-5000, ADAM-3600, WISE-5000</a> - automation controllers </h3><br>  The controllers support Modbus RTU functions as slave / master and Modbus TCP client / server. <br><br><img src="https://habrastorage.org/webt/31/ko/qu/31koqu3d3rpq4z-ibxpekx6mzbk.jpeg"><br><br><h2>  Application examples </h2><br><h3>  Greenhouse monitoring system </h3><br>  The Advantech monitoring solution integrates the TPC-1070H, ADAM-6024, ADAM-6050, ADAM-6060 devices and WebAccess software in an enclosure near agricultural land.  By connecting to various sensitive devices, the ADAM-6000 modules can obtain real-time environmental data and control equipment switching to ensure that the greenhouse is in an optimal environment for plant growth.  Thanks to Advantech‚Äôs special feature ‚Äî graphical condition logic (GCL), users can define their own control logic rules and load these rules into the ADAM-6000 Ethernet I / O modules, and then the modules automatically execute the logic rules as stand-alone modules.  controller.  Another feature - Peer-to-Peer (P2P) uses the most open and flexible Ethernet network to not only simplify the implementation process without a controller, but also save hardware costs. <br><br>  All received data is then transmitted via Ethernet to a computer with a TPC-1070H touch panel.  Thanks to the cooling system without a fan and a front panel that complies with the IP65 standard, the TPC-1070H is a robust and compact design suitable for a variable operating environment, and its powerful computing capabilities are capable of processing large amounts of data.  To manage devices, Advantech WebAccess allows engineers or managers to view, monitor and configure a monitoring system via an intranet or the Internet using a standard web browser from any device, including tablets and smartphones. <br><br><img src="https://habrastorage.org/webt/10/ek/ui/10ekuin0sxm2gbaxe8ptasqze8u.png"><br><br><h3>  Monitoring solar water heating systems </h3><br>  The engineering company had to be able to control the amount of solar energy, temperature and water consumption in the solar water heating system for an Olympic-sized pool provided by their newly developed solar panel.  They should also be able to directly monitor these values ‚Äã‚Äãand their alarms on LCD panels and save these values ‚Äã‚Äãfor future use. <br><br>  Advantech's Adam modules provided a solution to the customer that used data acquisition modules connected via RS485 and a two-wire bus to transfer data from all sensors.  This system architecture has two main advantages: first, it allows you to add more sensors of data acquisition modules to the system at any time, and, second, it is very easy to add additional tags to the software for monitoring and recording these values ‚Äã‚Äãon a PC. <br><br><img src="https://habrastorage.org/webt/44/3z/q7/443zq73odzxkcymwcnc6m1giwe0.png"></div><p>Source: <a href="https://habr.com/ru/post/450234/">https://habr.com/ru/post/450234/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../450222/index.html">5 cool digital marketing services that have not been heard in Russia</a></li>
<li><a href="../450224/index.html">Step-by-Step Guide to Creating a Voice Assistant with Python</a></li>
<li><a href="../450228/index.html">10 myths about rabies</a></li>
<li><a href="../450230/index.html">You are not google</a></li>
<li><a href="../450232/index.html">Reverse osmosis water treatment systems - healthy or not?</a></li>
<li><a href="../450236/index.html">How I stopped worrying and looked differently at working time accounting systems</a></li>
<li><a href="../450238/index.html">Validation on TypeScript interface using Joi</a></li>
<li><a href="../45024/index.html">Themes are now available in Gmail</a></li>
<li><a href="../450240/index.html">Walmart opened the first AI-managed store.</a></li>
<li><a href="../450242/index.html">Why did you need another PHP framework?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>