<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Deferred call to Asterisk</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The problem is as old as a Panasonic PBX in your office. If she, of course, still have. 
 When implementing Asterisk, employees with experience always...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Deferred call to Asterisk</h1><div class="post__text post__text-html js-mediator-article">  The problem is as old as a Panasonic PBX in your office.  If she, of course, still have. <br>  When implementing Asterisk, employees with experience always want to leave the old set of PBX functionality they used to use.  And one of the killer features of Panasonic was ‚Äú6-ka‚Äù - deferred challenge. <br><br>  ‚ÄúI call him, and he is 'busy'!  So, then I hop the '6' and press the box of the box, and how he gets free and ATSka will call me back ‚Äù- Mikhail Mikhalych, our warehouse manager, tells me with pleasure.  ‚ÄúCan your miracle machine?‚Äù <br><br>  Aw, can an Asterisk know how to make a ‚Äú6‚Äù out of the box?  Next will be a detailed positive answer to this question with an even small number of fables. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  So recently came <a href="http://ofps.oreilly.com/titles/9781449303822/">across the</a> book <a href="http://ofps.oreilly.com/titles/9781449303822/">Asterisk CookBook</a> .  Share it with a colleague.  Together with him, we snickered that many recipes we had long ago mastered on our own, and the book is small, what could be new and useful in it? <br><br>  But after the weekend, a colleague mysteriously smiled and said: ‚ÄúCCSS!‚Äù <br><br>  In Asterisk 1.8, developers implemented the Call Completion Supplementary Service.  When I was flipping through the book, I didn‚Äôt pay attention, because  I thought that behind this is probably hidden implementation of some chips for ISDN. <br><br>  However, behind this loud name there is a neat architecture that anyone can look at in this <a href="https://wiki.asterisk.org/wiki/download/attachments/9076838/CCSS_architecture.pdf">PDF</a> (and there really is about ISDN :). <br><br>  And I turn to the application of the <a href="https://wiki.asterisk.org/wiki/display/AST/Generic%2BCall%2BCompletion%2BExample">example of official documentation.</a> <br><br><pre><code class="python hljs">  sip.conf [Mark] context=phone_calls cc_agent_policy=generic cc_monitor_policy=generic [Richard] context=phone_calls cc_agent_policy=generic cc_monitor_policy=generic  dialplan<span class="hljs-string"><span class="hljs-string">' [phone_calls] exten =&gt; 1000,1,Dial(SIP/Mark,20) exten =&gt; 1000,n,Hangup exten =&gt; 2000,1,Dial(SIP/Richard,20) exten =&gt; 2000,n,Hangup exten =&gt; 30,1,CallCompletionRequest exten =&gt; 30,n,Hangup exten =&gt; 31,1,CallCompletionCancel exten =&gt; 31,n,Hangup</span></span></code> </pre> <br><br>  And that's it!  Almost:) Much less invented bicycles on the forums ( <a href="http://asteriskforum.ru/viewtopic.php%3Fp%3D60384">link</a> ) <br><br>  But, there is one nuance.  At the Panasonic PBX, we pressed ‚Äú6‚Äù after we heard the beeps ‚Äúbusy‚Äù, but before we hung up, then we hung up and waited for the delayed call from the PBX. <br><br>  In the case of Asterisk, the situation looks like this: they called, heard "busy", hung up, picked up the phone, dialed the call order code for the busy subscriber (in the example "30"), hung up, waited for a call from Asterisk.  In the example of dialplan, there is not enough message like "A call to an occupied subscriber is ordered." <br><br>  I suppose the cancellation code (in the example "31") especially no one will strain.  But you can cancel an order to call a busy subscriber. <br><br>  In addition from useful options can be for a feast: <br>  cc_max_agents - the maximum number of watching your feast <br>  cc_max_monitors - the maximum amount you can follow <br>  cc_recall_timer - call time when calling from Asterisk to you when ordering a service <br><br>  For those using realtime, in general, everything is neatly solved by adding fields to the database. <br><br>  To monitor the current status of using CCSS in CLI: cc report status <br><br>  In the ccss.conf configuration file, you can specify an additional setting: the maximum number of followers max_cc_agents.  There is also a description of all parameters and their possible values. <br><br>  It is also worth noting that the phone will not be occupied (and we need it according to the conditions of the problem) if he has the opportunity to take the second call.  To limit the channels to the peer, you can use call-limit and / or disable Call Waiting on the device. <br><br>  In general, Mikhalych was extremely pleased with the inclusion of the 6-ki on Asterisk, got more comfortable and told how he had cut through the electric car at the defense plant. <br><br>  PS In the comments I ask to share the experience of operating this functionality, an opinion on the stability of the work, and the found behavioral features. </div><p>Source: <a href="https://habr.com/ru/post/154887/">https://habr.com/ru/post/154887/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../154869/index.html">IP telephony: modern technology of free calls</a></li>
<li><a href="../154871/index.html">Competition of student projects InterSystems CIS Student Innovator Awards 2012</a></li>
<li><a href="../154875/index.html">The FBI operation "Site Down" against warez-scene. Do we find out the truth?</a></li>
<li><a href="../154879/index.html">Cisco IOS ACLs</a></li>
<li><a href="../154883/index.html">IPv4 crash, myths about the need to use dedicated IP</a></li>
<li><a href="../154889/index.html">From November 1, payments in rubles will appear in PayPal</a></li>
<li><a href="../154891/index.html">Dynamic interpretation of metamodels</a></li>
<li><a href="../154895/index.html">Google Play introduced a new Developer Console</a></li>
<li><a href="../154897/index.html">Go</a></li>
<li><a href="../154899/index.html">Budget 3D-cinema as a business project</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>