<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Inno Setup: creating an installer using the example of deploying a C # application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 

 I am not a professional programmer. In the sense that I do not earn money with this craft, but I use my skills as a tool for basic, sc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Inno Setup: creating an installer using the example of deploying a C # application</h1><div class="post__text post__text-html js-mediator-article"><h1>  Introduction </h1><br><br>  I am not a professional programmer.  In the sense that I do not earn money with this craft, but I use my skills as a tool for basic, scientific, activity.  Therefore, all my ‚Äúcrafts‚Äù live only for the period set aside for them to solve a specific task and do not go beyond the project catalogs.  In addition, for a long time already, I departed from developing for Windows, because Linux is more convenient for solving my problems. <br><br>  However, scientists also want to eat, decently dress and fill the car.  Therefore (although quite rarely) there is a need for a bit of poflelance. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Recently, they planted a not too complicated project for me - one company wants to write an analogue of a program that exists in another.  A bit of reversing, a bit of coding, in general, the project is quite ordinary.  However, the question of creating an installer immediately arose - the client would like to have a ‚Äúturnkey‚Äù product to click on the ‚Äúsetup‚Äù, click ‚ÄúNext‚Äù and get the program ready for work. <br><br>  I never created installers.  Therefore, this question was thoroughly "zaguglen", among other things, got <a href="http://habrahabr.ru/post/20560/">such an article</a> from Habr.  The choice of tools for such a task is quite wide, and includes both proprietary and open source products.  Here is a list of what I "felt" <br><br><ol><li>  <a href="http://www.installshield.com/">InstallShield</a> - a classic of the genre, quite a solid proprietary product </li><li>  <a href="http://www.advancedinstaller.com/">Adnvanced Installer</a> is a proprietary tool with extensive customization capabilities through the GUI.  The site says that if you are a blogger and you will write many good words about this product, then you have the opportunity to get a Free License </li><li>  <a href="http://wixtoolset.org/">WiX</a> is an open source XML-based free product.  Powerful, well-documented stuff.  I haven‚Äôt dealt with it yet, because time is precious (and the soul is not very good for XML).  Maybe someday I will return to it.  Yes, it has plug-ins for Visual Studio, which is a definite plus. </li><li>  <a href="http://www.jrsoftware.org/isdl.php">Inno Setup</a> is an open source project whose <a href="https://github.com/jrsoftware/issrc">code is available on the github</a> .  Due to the free and low threshold of entry, my choice was on it, as a tool that allowed me to do the job quickly and efficiently. </li></ol><br><br>  So in the article we will look at an example of using Inno Setup, for which there is a useful <a href="https://www.kymoto.org/products/inno-script-studio">Inno Script Studio</a> frontend that allows you to create simple installers using a wizard and change settings through the GUI.  I needed the GUI for the first acquaintance with the product, but we will not pay much attention to it - my ‚ÄúLinux brain‚Äù has more and more taken me away from the desire to use all kinds of ‚Äúmasters‚Äù (this is subjective, please do not kick) .  We will consider a hardcore way of writing a script from scratch. <br><br><a name="habracut"></a><br><br><h1>  1. Installation, configuration and simple (but pretty solid) script </h1><br><br>  I think that downloading the program from the official site and installing it will not be difficult.  Run Inno Setup Compiler and see this window. <br><br>  <i>Frighteningly sadly meets us Inno Setup ...</i> <br><img src="https://habrastorage.org/files/f3d/e50/ca3/f3de50ca389143a9b3a02988dcc6edc5.PNG"><br><br>  What is it?  In fact, it is simply an editor for a set of scripts, equipped with syntax highlighting and compile and launch buttons.  We are expected to start typing the script text in this window that defines the logic of the future installer.  Well, let's not waste time. <br><br>  First of all, we define the necessary constants. <br><pre><code class="hljs cpp">;------------------------------------------------------------------------------ ; ;     Inno Setup <span class="hljs-number"><span class="hljs-number">5.5</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span> ; (c) maisvendoo, <span class="hljs-number"><span class="hljs-number">15.04</span></span><span class="hljs-number"><span class="hljs-number">.2015</span></span> ; ;------------------------------------------------------------------------------ ;------------------------------------------------------------------------------ ;    ;------------------------------------------------------------------------------ ;   <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> Name </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Miramishi Painter"</span></span></span><span class="hljs-meta"> ;   #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> Version </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"0.0.1"</span></span></span><span class="hljs-meta"> ; - #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> Publisher </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Miramishi"</span></span></span><span class="hljs-meta"> ;    #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> URL </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"http://www.miramishi.com"</span></span></span><span class="hljs-meta"> ;    #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ExeName </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Miramishi.exe"</span></span></span></span></code> </pre> <br><br>  These lines will often be found in script code, so we define them, as in C, using the directive <b>#define</b> <br><br>  The script body is divided into sections, each of which carries its own functional purpose.  Mandatory <b>[Setup]</b> section sets global parameters of the installer and uninstaller. <br><br><pre> <code class="hljs smalltalk">;------------------------------------------------------------------------------ ;   ;------------------------------------------------------------------------------ [<span class="hljs-type"><span class="hljs-type">Setup</span></span>] ;   , ;  <span class="hljs-type"><span class="hljs-type">Tools</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Generate</span></span> <span class="hljs-type"><span class="hljs-type">GUID</span></span> <span class="hljs-type"><span class="hljs-type">AppId</span></span>={{<span class="hljs-type"><span class="hljs-type">F3E2EDB6</span></span><span class="hljs-number"><span class="hljs-number">-78E8</span></span><span class="hljs-number"><span class="hljs-number">-4539</span></span><span class="hljs-number"><span class="hljs-number">-9</span></span>C8B-<span class="hljs-type"><span class="hljs-type">A78F059D8647</span></span>} ;  ,    <span class="hljs-type"><span class="hljs-type">AppName</span></span>={<span class="hljs-symbol"><span class="hljs-symbol">#Name</span></span>} <span class="hljs-type"><span class="hljs-type">AppVersion</span></span>={<span class="hljs-symbol"><span class="hljs-symbol">#Version</span></span>} <span class="hljs-type"><span class="hljs-type">AppPublisher</span></span>={<span class="hljs-symbol"><span class="hljs-symbol">#Publisher</span></span>} <span class="hljs-type"><span class="hljs-type">AppPublisherURL</span></span>={<span class="hljs-symbol"><span class="hljs-symbol">#URL</span></span>} <span class="hljs-type"><span class="hljs-type">AppSupportURL</span></span>={<span class="hljs-symbol"><span class="hljs-symbol">#URL</span></span>} <span class="hljs-type"><span class="hljs-type">AppUpdatesURL</span></span>={<span class="hljs-symbol"><span class="hljs-symbol">#URL</span></span>} ;   - <span class="hljs-type"><span class="hljs-type">DefaultDirName</span></span>={pf}\{<span class="hljs-symbol"><span class="hljs-symbol">#Name</span></span>} ;     <span class="hljs-comment"><span class="hljs-comment">""</span></span> <span class="hljs-type"><span class="hljs-type">DefaultGroupName</span></span>={<span class="hljs-symbol"><span class="hljs-symbol">#Name</span></span>} ; ,     setup     <span class="hljs-type"><span class="hljs-type">OutputDir</span></span>=<span class="hljs-type"><span class="hljs-type">E</span></span>:\work\test-setup <span class="hljs-type"><span class="hljs-type">OutputBaseFileName</span></span>=test-setup ;   <span class="hljs-type"><span class="hljs-type">SetupIconFile</span></span>=<span class="hljs-type"><span class="hljs-type">E</span></span>:\work\<span class="hljs-type"><span class="hljs-type">Mirami</span></span>\<span class="hljs-type"><span class="hljs-type">Mirami</span></span>\icon.ico ;   <span class="hljs-type"><span class="hljs-type">Compression</span></span>=lzma <span class="hljs-type"><span class="hljs-type">SolidCompression</span></span>=yes</code> </pre><br><br>  We pay close attention to the AddId option - a unique application identifier (GUID) used to register the application in the Windows registry.  We write it not ‚Äúfrom the lantern‚Äù, but we generate it by opening the curly bracket, and choosing Tools -&gt; Generate GUID from the menu (or using the hot key Shift + Ctrl + G).  Next, we indicate the name of the application under which it will be installed in the system, its version, data of the developer‚Äôs company, addresses of the developer‚Äôs sites, technical support and updates. <br><br>  The default path offered by the installer for installation is determined by the <b>DefaultDirName</b> option.  The <b>{pf}</b> variable is the path to the Program Files directory of the corresponding bitness.  The <b>DefaultGroupName</b> option defines the program group name in the Start menu.  Please note that to indicate the name of the application, we use the macro we defined above, framing it with curly braces and a grid. <br><br>  A pair of options <b>OutputDir</b> and <b>OutputBaseFileName</b> specify the directory where the compiled setup will be written and its name (without extension).  In addition, we specify where to get the icon for test-setup.exe with the <b>SetupIconFile</b> option. <br><br>  The last options in this section define the compression algorithm (LZMA) and indicate that all files are compressed simultaneously and not separately ( <b>SolidCompression</b> ), which speeds up the unpacking process with a large number of files of the same type. <br><br>  A good installer should support multiple languages.  We include it in our "setup" using the optional <b>[Languages]</b> section.  In the absence of this section, English will be used. <br><br><pre> <code class="hljs 1c">;------------------------------------------------------------------------------ ;   <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   ;------------------------------------------------------------------------------ [Languages] Name: <span class="hljs-string"><span class="hljs-string">"english"</span></span>; MessagesFile: <span class="hljs-string"><span class="hljs-string">"compiler:Default.isl"</span></span>; LicenseFile: <span class="hljs-string"><span class="hljs-string">"License_ENG.txt"</span></span> Name: <span class="hljs-string"><span class="hljs-string">"russian"</span></span>; MessagesFile: <span class="hljs-string"><span class="hljs-string">"compiler:Languages\Russian.isl"</span></span>; LicenseFile: <span class="hljs-string"><span class="hljs-string">"License_RUS.txt"</span></span></code> </pre><br><br>  Each line in this section defines one of the languages ‚Äã‚Äãused during the installation.  The syntax of the line is <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span><span class="hljs-tag"> &gt;</span></span>: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span><span class="hljs-tag"> &gt;</span></span></code> </pre><br><br>  A semicolon is used as a parameter separator.  The <b>Name</b> parameter speaks for itself - the ‚Äúname‚Äù of the language, common two-letter abbreviations are allowed (‚Äúen‚Äù, ‚Äúru‚Äù, ‚Äúde‚Äù, and so on).  The <b>MessagesFile</b> parameter tells the compiler where to get the template of messages displayed during installation.  These templates are taken in the Inno Setup compiler directory, which we inform about by the <b>compiler</b> directive.  The Default.isl template is suitable for English, for Languages ‚Äã‚Äã\ Russian.isl for Russian. <br><br>  The LicenseFile parameter specifies the path to the file with the license text in the corresponding language. <br><br>  Usually the installer offers us, for example, to determine whether we want or do not want to create a shortcut on the desktop.  Such installation options are determined by the optional <b>[Tasks]</b> section <b>.</b> <br><br><pre> <code class="hljs css">;<span class="hljs-selector-tag"><span class="hljs-selector-tag">------------------------------------------------------------------------------</span></span> ;  <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>  ,      ;<span class="hljs-selector-tag"><span class="hljs-selector-tag">------------------------------------------------------------------------------</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[Tasks]</span></span> ;      <span class="hljs-selector-tag"><span class="hljs-selector-tag">Name</span></span>: "<span class="hljs-selector-tag"><span class="hljs-selector-tag">desktopicon</span></span>"; <span class="hljs-selector-tag"><span class="hljs-selector-tag">Description</span></span>: "{<span class="hljs-attribute"><span class="hljs-attribute">cm</span></span>:CreateDesktopIcon}"; <span class="hljs-selector-tag"><span class="hljs-selector-tag">GroupDescription</span></span>: "{<span class="hljs-attribute"><span class="hljs-attribute">cm</span></span>:AdditionalIcons}"; <span class="hljs-selector-tag"><span class="hljs-selector-tag">Flags</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">unchecked</span></span></code> </pre><br><br>  Here <b>Name</b> sets the name of the operation - ‚Äúdesktopicom‚Äù - creating an icon on the desktop;  <b>Description</b> - a checkbox description with an option that the user will see.  Design <br><br><pre> <code class="hljs css">{<span class="hljs-attribute"><span class="hljs-attribute">cm</span></span>:&lt; &gt;}</code> </pre><br><br>  sets the standard message text corresponding to the language selected at the beginning of the installation.  The <b>GroupDescription</b> parameter is a <b>checkbox</b> group header with options.  The Flags parameter specifies certain actions and states of the controls, in this case indicating that the checkbox ‚Äúcreate a shortcut on the desktop‚Äù should be unchecked. <br><br><div class="spoiler">  <b class="spoiler_title">To make it clear - this is the result.</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/430/f94/36b/430f9436b35442d1b9c06d2d66b91ec4.PNG"><br></div></div><br><br>  Now we will indicate which files should be included in the distribution and where they should be placed during installation.  To do this, use the mandatory section <b>[Files]</b> <br><br><pre> <code class="hljs tex">;------------------------------------------------------------------------------ ; ,       ;------------------------------------------------------------------------------ [Files] ;   Source: "E:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">work</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Mirami</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Mirami</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bin</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Release</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Miramishi</span></span></span></span>.exe"; DestDir: "{app}"; Flags: ignoreversion ;   Source: "E:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">work</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Mirami</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Mirami</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bin</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Release</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>"; DestDir: "{app}"; Flags: ignoreversion recursesubdirs createallsubdirs</code> </pre><br><br>  Here <br><br><ul><li>  <b>Source</b> - the path to the source file.  I have everything the program needs to work in the Release directory of the MS VS project. </li><li>  <b>DestDir</b> - installation directory, the {app} variable contains the path selected by the user in the installer window </li><li>  <b>Flags</b> - various flags.  In our example for the executable file: ignoring the program version when overwriting the executable module, if it already exists in the system (ignorevarsion);  for other files and directories, we also ignore the version, recursively include all subdirectories and source files (recursesubdirs) and create subdirectories if they are not (createallsubdirs) </li></ul><br><br>  Finally, so that everything is beautiful, we will optionally tell the compiler where to get icons for placement in the program menu and on the desktop <br><br><pre> <code class="hljs objectivec">;------------------------------------------------------------------------------ ;  ,      ;------------------------------------------------------------------------------ [Icons] Name: <span class="hljs-string"><span class="hljs-string">"{group}\{#Name}"</span></span>; Filename: <span class="hljs-string"><span class="hljs-string">"{app}\{#ExeName}"</span></span> Name: <span class="hljs-string"><span class="hljs-string">"{commondesktop}\{#Name}"</span></span>; Filename: <span class="hljs-string"><span class="hljs-string">"{app}\{#ExeName}"</span></span>; Tasks: desktopicon</code> </pre><br><br>  Here I indicate that for the group in the Start menu and for the desktop, the icon must be taken from the executable module.  Naturally, the icon should be ‚Äúcompiled‚Äù into it, otherwise in the required places we will see a standard icon from the Windows collection. <br><br>  So, everything seems to be ready.  Hit Ctrl + F9 and try to build the installer.  If syntax errors are not made, the build process will begin. <br><br>  <i>Inno Setup builds installer</i> <br><img src="https://habrastorage.org/files/080/473/d6d/080473d6d04140c0b2f92adbb376c165.PNG"><br><br>  After successful assembly, the installer can be started by pressing F9.  If you are working under the account with limited rights (and I work in Windows that way), then you will have to go into the directory with the results of the compilation that we specified in the script, and run the installer with admin rights <br><br>  <i>Running the installer under a limited account</i> <br><img src="https://habrastorage.org/files/5ad/a0c/ca2/5ada0cca2363451e812dcef9287db00c.PNG"><br><br>  As a result, we will see a language selection window that is painfully familiar to every Windows user. <br><img src="https://habrastorage.org/files/9c3/ec4/e48/9c3ec4e484a3402eb62af12bad24e410.PNG"><br>  greeting master <br><img src="https://habrastorage.org/files/598/704/c40/598704c4087140b18f348d83a9383969.PNG"><br>  license agreement <br><img src="https://habrastorage.org/files/c42/c92/a0f/c42c92a0f7134d17a2c76a1597cbe7ac.PNG"><br><br>  and so on.  It's nice that the laconic design of the wizard is used by default, without ryushechek (which you can add if you wish) <br><br>  What can I say?  Hooray!  We wrote our first "setup" and we could be happy, but <br><br><h1>  2. Deploying the .NET Framework </h1><br><br>  You did not notice that we have forgotten about something?  An application created in C # will not work without the framework with which it was built, if it does not exist in the system.  The corresponding framework must be installed, and for this you need <br><br><ol><li>  To decide on how we will get the distribution kit of the framework.  There are two options - to ship it along with the distribution package of the program or, if necessary, to install it, download it online to the target machine.  We will focus on the option to include the framework in the distribution.  The framework itself, say version 4.0, can be <a href="http://www.microsoft.com/ru-ru/download/details.aspx%3Fid%3D17718">taken free of charge from Microsoft</a> </li><li>  Detect the presence / absence of the given framework in the target system.  To do this, you will need to write logic that analyzes the state of the registry. </li></ol><br><br>  The values ‚Äã‚Äãin the registry that need to be checked are listed in the <a href="https://support.microsoft.com/ru-ru/kb/318785">official Microsoft documentation</a> . In the article I will give a brief squeeze out of it. <br><br>  <b>Table 1</b> .  Registry keys to check the installed version of the .NET Framework <br><table><tbody><tr><th>  .NET version </th><th>  Registry key </th><th>  Value </th></tr><tr><td>  3.0 </td><td>  HKLM \ Software \ Microsoft \ NET Framework Setup \ NDP \ v3.0 \ Setup \ InstallSuccess </td><td>  one </td></tr><tr><td>  3.5 </td><td>  HKLM \ Software \ Microsoft \ NET Framework Setup \ NDP \ v3.0 \ Setup \ Install </td><td>  one </td></tr><tr><td>  4.0 Client Profile </td><td>  HKLM \ Software \ Microsoft \ NET Framework Setup \ NDP \ v4.0 \ Client \ Install </td><td>  one </td></tr><tr><td>  4.0 Full Profile </td><td>  HKLM \ Software \ Microsoft \ NET Framework Setup \ NDP \ v4.0 \ Full \ Install </td><td>  one </td></tr><tr><td>  4.5 </td><td>  HKLM \ Software \ Microsoft \ NET Framework Setup \ NDP \ v4.0 \ Full \ Release </td><td>  release number </td></tr></tbody></table><br><br>  To implement arbitrary installer logic, Inno Setup provides the <b>[Code]</b> section.  Within this section is placed the code implementing the logic of functions in the Pascal language.  We will move this section into a separate <b>dotnet.pas</b> file and include the #include directive in the main script. <br><br><pre> <code class="hljs css">;<span class="hljs-selector-tag"><span class="hljs-selector-tag">------------------------------------------------------------------------------</span></span> ;       ;<span class="hljs-selector-tag"><span class="hljs-selector-tag">------------------------------------------------------------------------------</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[Code]</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#include</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">dotnet</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pas</span></span>"</code> </pre><br><br>  although you can type the code directly in the <b>[Code]</b> section.  It must be remembered that the Pascal syntax is used inside this section, and comments are preceded by the sequence "//" instead of the semicolon used in the main part of the script. <br><br>  Let's write a function that determines whether the system has the correct version of .NET <br><br><pre> <code class="hljs bash">//----------------------------------------------------------------------------- //     //----------------------------------------------------------------------------- <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> IsDotNetDetected(version: string; release: cardinal): boolean; var reg_key: string; //     success: boolean; //     .NET release45: cardinal; //     4.5.x key_value: cardinal; //      sub_key: string; begin success := <span class="hljs-literal"><span class="hljs-literal">false</span></span>; reg_key := <span class="hljs-string"><span class="hljs-string">'SOFTWARE\Microsoft\NET Framework Setup\NDP\'</span></span>; //  3.0 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Pos(<span class="hljs-string"><span class="hljs-string">'v3.0'</span></span>, version) = 1 <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> begin sub_key := <span class="hljs-string"><span class="hljs-string">'v3.0'</span></span>; reg_key := reg_key + sub_key; success := RegQueryDWordValue(HKLM, reg_key, <span class="hljs-string"><span class="hljs-string">'InstallSuccess'</span></span>, key_value); success := success and (key_value = 1); end; //  3.5 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Pos(<span class="hljs-string"><span class="hljs-string">'v3.5'</span></span>, version) = 1 <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> begin sub_key := <span class="hljs-string"><span class="hljs-string">'v3.5'</span></span>; reg_key := reg_key + sub_key; success := RegQueryDWordValue(HKLM, reg_key, <span class="hljs-string"><span class="hljs-string">'Install'</span></span>, key_value); success := success and (key_value = 1); end; //  4.0   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Pos(<span class="hljs-string"><span class="hljs-string">'v4.0 Client Profile'</span></span>, version) = 1 <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> begin sub_key := <span class="hljs-string"><span class="hljs-string">'v4\Client'</span></span>; reg_key := reg_key + sub_key; success := RegQueryDWordValue(HKLM, reg_key, <span class="hljs-string"><span class="hljs-string">'Install'</span></span>, key_value); success := success and (key_value = 1); end; //  4.0   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Pos(<span class="hljs-string"><span class="hljs-string">'v4.0 Full Profile'</span></span>, version) = 1 <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> begin sub_key := <span class="hljs-string"><span class="hljs-string">'v4\Full'</span></span>; reg_key := reg_key + sub_key; success := RegQueryDWordValue(HKLM, reg_key, <span class="hljs-string"><span class="hljs-string">'Install'</span></span>, key_value); success := success and (key_value = 1); end; //  4.5 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Pos(<span class="hljs-string"><span class="hljs-string">'v4.5'</span></span>, version) = 1 <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> begin sub_key := <span class="hljs-string"><span class="hljs-string">'v4\Full'</span></span>; reg_key := reg_key + sub_key; success := RegQueryDWordValue(HKLM, reg_key, <span class="hljs-string"><span class="hljs-string">'Release'</span></span>, release45); success := success and (release45 &gt;= release); end; result := success; end;</code> </pre><br><br>  Despite the abundance of code, the logic of its operation is quite simple - depending on the value of the version parameter, the RegQueryDWordValue (...) function reads the value of the corresponding registry key and compares it with the required value (see table 1).  For version 4.5, we also give the release number in the release parameter. <br><br>  For the application that we are going to deploy, we need a well-defined version of .NET, so we will write a wrapper function to define it in the target system. <br><br><pre> <code class="hljs bash">//----------------------------------------------------------------------------- // -       //----------------------------------------------------------------------------- <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> IsRequiredDotNetDetected(): boolean; begin result := IsDotNetDetected(<span class="hljs-string"><span class="hljs-string">'v4.0 Full Profile'</span></span>, 0); end;</code> </pre><br><br>  To start the installation, check the availability of the framework and inform the user about the actions taken using the Callback-function InitializeSetup () <br><br><pre> <code class="hljs bash">//----------------------------------------------------------------------------- // Callback-,     //----------------------------------------------------------------------------- <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> InitializeSetup(): boolean; begin //     .NET    ,   //       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> not IsDotNetDetected(<span class="hljs-string"><span class="hljs-string">'v4.0 Full Profile'</span></span>, 0) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> begin MsgBox(<span class="hljs-string"><span class="hljs-string">'{#Name} requires Microsoft .NET Framework 4.0 Full Profile.'</span></span><span class="hljs-comment"><span class="hljs-comment">#13#13 'The installer will attempt to install it', mbInformation, MB_OK); end; result := true; end;</span></span></code> </pre><br><br>  Now in the <b>[Files]</b> section we will add an entry about where the compiler should take the .NET distribution kit, where the installer should unpack it, and under what conditions it should be unpacked <br><br><pre> <code class="hljs pgsql">; .NET Framework <span class="hljs-number"><span class="hljs-number">4.0</span></span> Source: "E:\install\dotNetFx40_Full_x86_x64.exe"; DestDir: "{tmp}"; Flags: deleteafterinstall; <span class="hljs-keyword"><span class="hljs-keyword">Check</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> IsRequiredDotNetDetected</code> </pre><br><br>  In the flags, we say that you need to remove the .NET distribution after installation (deleteafterinstall).  The condition under which the unpacking is required is set with the <b>Check</b> option, where we call the IsRequiredDotNetDetected () function, unpacking the spruce, it returns false. <br><br>  You can start the installation of the framework itself after installing the main program, therefore we include the <b>[Run]</b> section in the script, which indicates what needs to be started after the installation is completed <br><br><pre> <code class="hljs vbscript">;------------------------------------------------------------------------------ ;       ;------------------------------------------------------------------------------ [Code] #include <span class="hljs-string"><span class="hljs-string">"dotnet.pas"</span></span> [Run] ;------------------------------------------------------------------------------ ;     ;------------------------------------------------------------------------------ Filename: {tmp}\dotNetFx40_Full_x86_x64.exe; Parameters: <span class="hljs-string"><span class="hljs-string">"/q:a /c:""install /l /q"""</span></span>; Check: <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> IsRequiredDotNetDetected; StatusMsg: Microsoft Framework <span class="hljs-number"><span class="hljs-number">4.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> installed. Please wait...</code> </pre><br><br>  Notice that we first specify the name of the [Run] section to close the [Code] section, and then we write a comment starting with a semicolon.  This is necessary because of the difference in the syntax of the main script and the [Code] section; otherwise, we will get a syntax error during compilation. <br><br>  In the section, the path to the installer of the framework is set - we have previously unpacked it into a temporary directory (the <b>{tmp}</b> variable contains the path to the temporal directory);  set command line options.  The <b>Check</b> option defines the condition for launching an installation ‚Äî this is the absence of the necessary framework in the target system.  The <b>StatusMsg</b> option defines the message that the user will see in the installer window. <br><br>  Compile our project again.  Now, when running on a ‚Äúclean‚Äù Windows, the installer will display a message <br><br>  <i>We are told that the .NET Framework 4.0 is required and will be installed for us.</i> <br><img src="https://habrastorage.org/files/5be/de0/b26/5bede0b261c44944a9a81fa5bde05c58.PNG"><br><br>  When unpacking, we note that it additionally unpacks the .NET distribution in a temporary folder. <br><br><img src="https://habrastorage.org/files/fc1/54e/0bd/fc154e0bd2ff43aab48a01be8415c33f.PNG"><br><br>  and then the process switches to the .NET installation <br><br>  <i>Microsoft asks us to accept the license ...</i> <br><img src="https://habrastorage.org/files/5b0/4eb/cab/5b04ebcabc604b0589bcfcef8c00a0f4.PNG"><br><br>  <i>Installing .NET</i> <br><img src="https://habrastorage.org/files/040/b41/095/040b410957fd426e932d2674c03f5948.PNG"><br><br>  After that we get a workable C # application installed ‚Äúfor an adult‚Äù <br><br><h1>  Conclusion </h1><br><br>  I am not a professional and in many things I could be wrong.  Please treat this with understanding.  The article was written by a noob for noobs, its main goal is to set the search vector when solving the problem of writing an installer.  For other questions, consult the documentation that came with Inno Setup. <br><br>  <a href="https://github.com/maisvendoo/test-setup">The code for this example is available</a> in my repository on Github.  The "krakozyabry" in the comments are caused by the mismatch of the Cyrillic encodings.  For myself, I always write English comments, but for a better understanding of the code I made this blunder.  When downloading in Windows, everything looks fine, so I ask you to forgive me and this absurdity. <br><br>  As for the rest, I think the hautushka came out decent and thank you for your attention to me. </div><p>Source: <a href="https://habr.com/ru/post/255807/">https://habr.com/ru/post/255807/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255793/index.html">The results of a single rating web studios 2015</a></li>
<li><a href="../255799/index.html">RSA encryption in PHP (openssl), Android / Java, JavaScript and Go</a></li>
<li><a href="../255801/index.html">Overview of malicious browser extensions</a></li>
<li><a href="../255803/index.html">How I did an English simulator, which is used not only by my mother</a></li>
<li><a href="../255805/index.html">MS Lync: Personal Call Identification</a></li>
<li><a href="../255809/index.html">Localization of WPF pages</a></li>
<li><a href="../255813/index.html">Factorial Calculation or the Power of the Stream API</a></li>
<li><a href="../255815/index.html">Centralized collection of Windows event logs, without installing an agent, followed by visualization using ELK</a></li>
<li><a href="../255817/index.html">Unlock Open Source 2GIS</a></li>
<li><a href="../255819/index.html">How-to: Rules for the layout of email-letters</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>