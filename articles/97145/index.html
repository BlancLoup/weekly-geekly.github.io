<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with video in Matlab</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Matlab is a well-known numerical computing environment widely used by the scientific community. Works in Windows, nix-systems and on Macs. The Matlab ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with video in Matlab</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://ru.wikipedia.org/wiki/MATLAB">Matlab</a> is a well-known numerical computing environment widely used by the scientific community.  Works in Windows, nix-systems and on Macs.  The Matlab language is optimized for working with matrices and multidimensional arrays; in addition, there are a <a href="http://www.mathworks.com/products/product_listing/index.html">huge number of</a> extensions (officially called Toolboxes) for solving optimization problems, statistical calculations, signal and image processing, etc.  Plus, there is a large amount of scientific code already written on Matlab, which additionally spurs its popularity. <br><br>  In this article I will briefly describe the possibilities of Matlab to work with video.  For those who are not familiar with the matlab syntax, a brief overview of the main features in Russian can be read <a href="http://www.machinelearning.ru/wiki/index.php%3Ftitle%3DMatlab">here</a> . <br><a name="habracut"></a><br><br><h1>  Video format </h1><br>  The first thing you need to do to work with video is to upload it to Matlab.  The main difficulty that arose in me is related to codecs.  By default, the list of supported video formats is small ( <a href="http://www.mathworks.com/access/helpdesk/help/techdoc/ref/mmreaderclass.html">English documentation</a> ) and whether a matlab will open your video depends on the codecs installed in the system.  The general rule is that if your built-in player (Windows Media Player in Windows) cannot open a file, then Matlab most likely will not open it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Accordingly, the ability to record video is highly dependent on the installed codecs, although Matlab will be able to create uncompressed video on any system without installed codecs. <br><br>  Problems with reading and recording video, I decided to install the <a href="http://www.codecguide.com/download_k-lite_codec_pack_full.htm">KLite Codec Pack Full</a> in the version of "Lots of stuff": <br><img src="https://habrastorage.org/storage/habraeffect/f8/b5/f8b572d202515b955199c45be328fca8.png"><br><br><h1>  Different ways to read videos </h1><br>  There are several ways to read videos in the lab.  About two of them are described below. <br><br><h2>  Reading video using mmreader and read methods </h2><br>  The first way to read video is to use the <code>mmreader</code> method to open a file and further use the <code>read</code> method to read frames: <br><br><pre> % open file
 video = mmreader ('d: \ test \ 1.avi');

 % like this you can learn about some properties of the open video
 width = video.Width;
 height = video.Height;
 frameRate = video.FrameRate;
 numOfFrames = video.NumberOfFrames;

 % read frame
 % frames numbered from 1
 frameNo = 50;
 frame = read (video, frameNo);

 % frame can be read and like this
 frame = video.read (frameNo);

 % read frame range
 % 50 - the number of the first frame read
 % 100 - last read frame number
 framesRange = [50 100];
 frames = read (video, framesRange);

 % read all videos
 % operation will not be performed if the video is large and does not fit into memory
 entireVideo = read (video);

 % There is no special function to close the video file.
 % Correspondingly, when you finish working with video
 % no additional action is needed.
</pre><br><br>  All frame reading functions return a multidimensional matrix as the execution result.  For example, here is the result of executing several commands for working with video in the interactive desktop lab: <br><br><pre>  &gt;&gt; video.Width

 ans =

    704

 &gt;&gt; video.Height

 ans =

    576

 &gt;&gt; frame = read (video, 5);
 &gt;&gt; size (frame)

 ans =

    576,704 3

 &gt;&gt; frames = read (video, [5 10]);
 &gt;&gt; size (frames)

 ans =

    576 704 3 6 </pre><br><br>  Thus, as a result of reading one frame, a matrix is ‚Äã‚Äãobtained with the size of Height x Width x 3, the elements of which are 8-bit unsigned integers.  As a result of reading a range of several frames, a matrix is ‚Äã‚Äãobtained with the size of Height x Width x 3 x NumOfFrames. <br><br>  Correspondingly, when you have loaded a frame, you can work with it as with an ordinary matlab matrix, and also apply various functions for image processing included in the <a href="http://www.mathworks.com/access/helpdesk/help/toolbox/images/f3-23960.html">Image Processing Toolbox to it.</a> <br><br><h2>  Reading video with System Objects - Matlab 2010a innovations </h2><br>  The concept of system objects was introduced in the hardware version 2010a.  The Matlab manual <a href="http://www.mathworks.com/access/helpdesk/help/toolbox/dspblks/ug/br_xl0s.html">says</a> that system objects provide an object-oriented implementation of algorithms.  Compared to ordinary Matlab functions, they automatically control their state and are well suited for stream processing.  In general, the main point is that according to the developers, it is more convenient to use them for stream processing of information.  At the expense of convenience, you can argue, but the code becomes a bit shorter. <br><br>  Here is an example of frame-by-frame video reading using system objects: <br><br><pre> % create an object to read the video
 reader = video.MultimediaFileReader ('Filename', 'd: \ test \ 1.avi');

 % read all videos frame by frame
 % step function will return a matrix with the size of Height x Width x 3
 % true the elements of this matrix will be of the single type - 4 byte floating point numbers
 while ~ isDone (reader)
    frame = step (reader);
 end

 % here as in the previous case, you do not need to perform any closing operations
 % at the end of reading the video
</pre><br><br>  A significant disadvantage of this approach is that there is no random access to the video - you can only read frames sequentially.  Also, in terms of subjective sensations, opening video and reading frames using system objects takes a little longer than using <code>mmreader</code> and <code>read</code> . <br><br><h1>  Playing video </h1><br>  Besides the fact that the video can be read and processed, it can also be played with built-in tools. <br><br><h2>  Playing with the movie function </h2><br>  The <a href="http://www.mathworks.com/access/helpdesk/help/techdoc/ref/movie.html">movie</a> function allows you to play a video.  The feature of using this function is that you need to prepare in advance the entire video that should be played.  In addition, the video should be stored in memory in a format different from that obtained by reading the video.  The following is an example of how this feature can be used to play the first 200 frames of video: <br><br><pre> %% reading video
 filename = 'd: \ test \ 1.avi';
 video = mmreader (filename);
 nFrames = 200;

 % prepare the structure in which the information will be read
 mov (1: nFrames) = struct ('cdata', [], 'colormap', []);

 % Read frame by frame
 for k = 1: nFrames
     mov (k) .cdata = read (video, k);
 end

 %% play video
 hf = figure;
 set (hf, 'position', [150 150 video.Width video.Height])
 movie (hf, mov, 1, video.FrameRate);
</pre><br><br>  In this code, a movie is prepared in the <code>mov</code> variable.  This variable stores an array of structures.  Each structure has two fields: <code>cdata</code> and <code>colormap</code> .  The <code>cdata</code> field stores the bitmap of the frame, and the <code>colormap</code> field needs to store a color palette for indexed video.  In this case, this is a full-fledged RGB video and the <code>colormap</code> empty. <br><br><h2>  Playing with system objects </h2><br>  Compared with the previous example, the use of system objects can significantly reduce the code: <br><br><pre> % create an object to read the video
 reader = video.MultimediaFileReader ('Filename', 'd: \ test \ 1.avi');

 % create an object to play the video
 player = video.VideoPlayer;

 % read frame by frame and play the video
 while ~ isDone (reader)
    frame = step (reader);
    step (player, frame);
 end </pre><br><br><h1>  Video recording </h1><br>  You can also record video in several ways.  Here I will analyze 3 methods: frame by frame recording, video recording in one piece and using system objects. <br><br>  I will note in advance that if you are recording a video in more than one piece, you must close the video file at the end of the operation.  If the file is not closed, then until you exit the lab you cannot access, delete, or overwrite it. <br><br><h2>  Record video frame by frame </h2><br><br><pre> %% prepare variables
 filename = 'd: \ test \ 1.avi';
 result_file = 'd: \ test \ result.avi';
 nFrames = 200;
 video = mmreader (filename);
 % open file for writing
 % compressor set - XVID
 writer = avifile (result_file, 'compression', 'XVID');

 %% in cycle read-modify-write
 % structuring element for dilatation
 se = strel ('rectangle', [3 3]);
 for k = 1: nFrames
     % read frame
     frame = read (video, k);
     % do frame dilatation
     frame = imdilate (frame, se);
     % write frame
     writer = addframe (writer, frame);
 end
 % sure to close the writer
 writer = close (writer); </pre><br><br>  Here I will note the way in which the arguments of the <code>avifile</code> function are <code>avifile</code> .  The first argument is the name of the file, then the arguments go in pairs ‚Äî first the name of the parameter, then the value.  In the above example, the <code>avifile</code> function <code>avifile</code> in addition to the file name, also passes the compression parameter with the value XVID. <br><br>  As the compression parameter, you can specify one of the identifiers: 'None', 'MSVC', 'RLE', 'Cinepak', 'Indeo3' or 'Indeo5'.  On * nix systems, only the option 'None' is available.  In addition to the above options, you can also specify the FourCC of the desired compressor (as in the example).  Here everything depends on the codecs installed in the system for encoding the video.  It should be noted that not all of the installed codecs are suitable for both decoding and video encoding.  Only XVID earned on my system of several tested options. <br><br><h2>  Video recording in one piece </h2><br>  In addition to frame-by-frame recording, you can also set up an array of frames and write them all at once to a file.  An array of frames should be prepared in the same way as in the example of using the <code>movie</code> function to play videos.  More to the point: the array should consist of structures, one of the members of the structure is the cdata field that stores the bitmap of the image, and the second is the colormap field that stores the palette for the indexed color image: <br><br><pre> %% reading video
 filename = 'd: \ test \ 1.avi';
 video = mmreader (filename);
 nFrames = 200;

 % prepare the structure in which the information will be read
 mov (1: nFrames) = struct ('cdata', [], 'colormap', []);

 % Read and modify the first 200 frames of video
 se = strel ('rectangle', [3 3]);
 for k = 1: nFrames
     frame = read (video, k)
     mov (k) .cdata = imdilate (frame, se);
 end

 %% video recording
 movie2avi (mov, 'd: \ test \ result.avi', 'compression', 'XVID', 'fps', 25);
</pre><br><br>  The compression parameter of the <code>movie2avi</code> function is the same as in the previous section. <br><br><h2>  Record video using system objects </h2><br>  The following code demonstrates the use of system objects for recording video: <br><br><pre> reader = video.MultimediaFileReader ('Filename', 'd: \ test \ 1.avi');
 % open the video to record
 % file name = d: \ test \ result.avi
 % audio - no, there is video
 % video codec = MJPEG
 writer = video.MultimediaFileWriter ('Filename', 'd: \ test \ result.avi', ...
     'AudioInputPort', false, 'VideoInputPort', true, ...
     'VideoCompressor', 'MJPEG Compressor');
 % structuring element for dilatation
 se = strel ('rectangle', [3 3]);
 while ~ isDone (reader)
    % read frame
    frame = step (reader);
    % do frame dilatation
    frame = imdilate (frame, se);
    % write frame
    step (writer, frame);
 end

 % sure to close the writer
 close (writer);
</pre><br><br>  The arguments of the <code>video.MultimediaFileWriter</code> function are the pairs 'parameter name', the value of the parameter.  Even the file name is transferred in this way (i.e., the pair 'Filename', 'file name' is indicated). <br><br>  The possible values ‚Äã‚Äãof the VideoCompressor parameter here are already different from those that can be specified for the <code>avifile</code> and <code>movie2avi</code> .  ‚ÄúNone (uncompressed)‚Äù can be specified as VideoCompressor, ‚ÄúMJPEG Compressor‚Äù has also worked for me.  If you omit the VideoCompressor parameter in the argument list, it will be equivalent to specifying 'None (uncompressed)'. <br><br><h1>  A free alternative in the face of GNU Octave </h1><br>  In general, the Matlab product is quite expensive, but there are some free alternatives that are partially compatible with it.  One of them is <a href="http://ru.wikipedia.org/wiki/GNU_Octave">GNU Octave</a> . <br><br>  GNU Octave is being actively developed and the syntax of the actual language is almost identical to Matlabovsky.  Differences in the syntax are mainly due to the fact that some feature has already appeared in the trademark, and in Octave has not yet been added. <br><br>  With a set of libraries, things are worse.  There are no toolbox matlab in GNU Octave, although for some of the functions there are still substitutions. <br><br><h2>  Installing GNU Octave in Ubuntu 10.04 </h2><br>  I worked with Octave in Ubuntu, so for those who want to repeat my experience I describe the installation instructions: <br><br>  <b>1.</b> With the help of the package manager, you need to install the octave3.2 Linux packages;  octave3.2-doc;  octave3.2-headers with all dependencies. <br>  <b>2.</b> Octave, in contrast to the matlab, consists only of an interpreter.  Accordingly, you may need a GUI development environment.  I installed QtOctave in Ubuntu 10.04 (also through the package manager). <br>  <b>3.</b> If you plan to work with video, then you must install the Linux packages libavformat-dev, libavcodec-dev, libavutil-dev, libswscale-dev <br>  <b>4.</b> In Octave itself there is also the concept of a package.  Octave packages include a variety of features that extend Octave functionality.  Download Octave packages from the <a href="http://octave.sourceforge.net/">Octave-Forge</a> site. <br>  To install the Octave package, you need to run Octave with administrative rights: <code>sudo octave</code> .  And then in Octave run the command <code>pkg install /path/to/package.tar.gz</code> <br>  Octave-packages <a href="http://octave.sourceforge.net/image/index.html">image</a> and <a href="http://octave.sourceforge.net/video/index.html">video</a> for working with images and <a href="http://octave.sourceforge.net/video/index.html">video</a> <br><br><h2>  Actually working with video in Octave </h2><br>  In general, loading and saving video in Octave is done in a similar way as it is done in the lab.  The following is the code that dilates the first 25 frames of video: <br><br><pre> filename = '/home/alexey/octave/1.avi';
 result_file = '/home/alexey/octave/result.avi';

 % uncomment the next line to access the video properties
 % info = aviinfo (filename);
 % width = info.Width
 % height = info.Height

 % create a video recording object
 writer = avifile (result_file);
 se = ones ([3 3 3]);
 for i = 1: 25
   % read frame i from video
   frame = aviread (filename, i);
   % do frame dilatation
   frame = imdilate (frame, se);
   % write frame
   addframe (writer, frame);
 end
</pre><br><br>  Here, the <code>avifile(filename, frameNo)</code> function reads the frame with the <code>frameNo</code> number from the video file with the name <code>filename</code> .  No need to create any objects in advance and open the file.  This function is also present in the trademark, but it is deprecated. <br><br>  If you need to know information about the video, you can do this using the <code>aviinfo(filename)</code> function.  As a result, the structure will be returned storing information about the size and format of the video, the number of frames, etc.  In the lab, this function is deprecated. <br><br>  Video is recorded using the <code>avifile</code> and <code>addframe</code> , but the syntax of these functions is slightly different in the hardware and Octave.  In addition, in Octave, it is not necessary to close the object recording the video (moreover, there is not even a method that would close it). <br><br>  As a result, for the above code for Octave to work in the hardware it needs to be modified as follows: <br><br><pre> %% reading video
 filename = 'd: \ test \ result.avi';
 result_file = 'd: \ test \ result2.avi';

 % info = aviinfo (filename);
 % width = info.Width;
 % height = info.Height;

 writer = avifile (result_file, 'compression', 'xvid');
 se = strel ('rectangle', [3 3]);
 for i = 1: 25
    frame = aviread (filename, i);
    frame.cdata = imdilate (frame.cdata, se);
    writer = addframe (writer, frame.cdata);
 end
 writer = close (writer);
</pre><br><br>  Thus, in terms of video and image processing, there is currently a difference in the syntax of Matlabov functions and GNU Octave functions. </div><p>Source: <a href="https://habr.com/ru/post/97145/">https://habr.com/ru/post/97145/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../97134/index.html">Barnes & Noble vs Amazon - cheers cheers price war?</a></li>
<li><a href="../97138/index.html">Fixes for * nix and something else</a></li>
<li><a href="../97140/index.html">First recorded music of the sun</a></li>
<li><a href="../97142/index.html">Denial of obsolete browsers</a></li>
<li><a href="../97144/index.html">Improving Google Calendar</a></li>
<li><a href="../97151/index.html">Yandex.ru: upload files by drag and drop</a></li>
<li><a href="../97152/index.html">Search statuses VKontakte</a></li>
<li><a href="../97153/index.html">How do Habr's visitors relate to Twitter?</a></li>
<li><a href="../97154/index.html">Live streaming service online</a></li>
<li><a href="../97156/index.html">Google Voice is open to anyone who lives in America.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>