<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"Gonochki" on SVG</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prologue 
 Arcade js game. The prototype served as the so-called "Gonochki in a cage" (in some children's magazine saw). The point is that the track i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>"Gonochki" on SVG</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/2ae/4c8/dc9/2ae4c8dc94b40b9bd7dbb91749b1cc5d.jpg" alt="image"><br><br><h3>  Prologue </h3><br>  Arcade js game.  The prototype served as the so-called "Gonochki in a cage" (in some children's magazine saw).  The point is that the track is drawn on the notebook sheet and the players walk in the cells.  In one move, you can increase the speed by one or decrease.  If you "crash" into the wall, then you continue from this place with a unit speed. <br><a name="habracut"></a><br><img src="https://habrastorage.org/getpro/habr/post_images/f87/51f/e95/f8751fe958f8efc48b4a56461e2bf894.jpg" alt="image"><br><br>  ‚Üí <a href="https://github.com/Arteben/races">Game code</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The game is made using raphael.js and playground.js, with graphics rendering in SVG.  On my average laptop (CPU 4 x 2.1 GHz) under chromium, the game gives out 50 fps for small tracks and 40fps for large ones. <br><br>  Up to 5 racers (or racers) participate on one track.  Opponent riders repeat the actions of previous players who have the best results on this track.  In order for the tracer riser to register in the database, it is enough to come to the finish not the last.  In the menu you can select the color of the riser and the name under which this result can be recorded (to display the results when finishing, and for the best - in the main menu). <br><br>  Physics is implemented on a two-dimensional array.  Riser rides (flies?) On the moves.  Each turn, the player can change the speed (3 units more or 10 units less) and also the direction (left or right).  Based on this data and the current position, the game looks where the current turn ends and checks the array for the presence of walls or finish.  Depending on what is at this end point, further implementation of the corresponding algorithms follows.  The creation of tracers is also implemented on this array (array indices are stored in the database, and not the actual size of the offsets). <br><br>  The widths of the tracks vary from 500 units to 2000. There is no actual size limit, but the more, the smaller the fps is given by the browser. <br><br>  For graphics, SVG is used with 11 children.  5 (path) - for drawing racers, 4 (path) - for drawing tracks, 1 (circle) - for animating collisions with walls and 1 (path) - for exhaust lights. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/97b/8ec/d31/97b8ecd313ebbc7afba8f830f3e963a8.jpg" alt="image"><br><br>  The database is represented by a single json-file with tracers.  It is served by three php scripts.  Maps are stored in the js variable.  It would be possible to create json for maps, but they are static and they have a small size. <br><br>  In the arcade there are sounds of collisions, sounds of racers (both of what is under the control of the player and others, as you approach them), and there is also the sound of whistling walls.  I really liked this effect in the NFS series, and I tried to repeat it here.  All sounds are downloaded from the <a href="https://opengameart.org/">opengameart.org</a> website.  The background is Let the Games Begin (Section 31 - Tech), or alien swamp (unfortunately, the author is unknown). <br><br><h3>  Drawing route </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/107/fbe/027/107fbe027d0f9b35e11fede8c8b26c9d.jpg" alt="image"><br><br>  First, I read an array of objects. <br><br><pre><code class="javascript hljs">{<span class="hljs-attr"><span class="hljs-attr">i</span></span>: size_i, <span class="hljs-attr"><span class="hljs-attr">j</span></span>: size_j, <span class="hljs-attr"><span class="hljs-attr">size</span></span>: indent_in_cell}</code> </pre> <br>  and get a chain of segments, each element of which is connected with the next, and the final with the first.  And so I get a closed set of segments. <br><br>  From this set of segments, using the functions of trigonometry, by indent_in_cell, I get a set of parallelepipeds (there should have been rectangles, but they did not work) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/99c/bb6/c72/99cbb6c7216b4b1a4cea94bdf5f3f57d.png" alt="image"><br><br>  Then I, using all the same functions of trigonometry, determine whether an element of the array is located (which I created using the radius parameter, and initially it is filled with ones) in a lump of rectangles.  If yes, then this element of the array is assigned the value 0. <br><br>  At the very end, I draw all the rectangles with one ‚Äúpath‚Äù element. <br><br>  For the finish line, I indicate the offset in width i.  At this offset, the algorithm searches for the first segment of zero elements and takes the end and starting point from this segment, and then using the ‚Äúpath‚Äù element, it is drawn. <br><br>  Values ‚Äã‚Äãfor "boxes" are taken from an array of elements of type <br><br><pre> <code class="javascript hljs">{<span class="hljs-attr"><span class="hljs-attr">i</span></span>: size_i, <span class="hljs-attr"><span class="hljs-attr">j</span></span>: size_j, <span class="hljs-attr"><span class="hljs-attr">width</span></span>: width_in_cels}</code> </pre><br>  i and j are specified for the upper left corner, and width is the total size for the square.  Then, based on these parameters, the main array is changed.  The elements that fall into the "boxes" are assigned the values ‚Äã‚Äãof 3. Next on the array, I outline all the boxes.  They are drawn, of course, all with one ‚Äúpath‚Äù element. <br><br><h3>  Creating and reading tracer. </h3><br>  A tracer is an array of objects of the type: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">s</span></span>: racer.speed, <span class="hljs-attr"><span class="hljs-attr">r</span></span>: racer.root, <span class="hljs-attr"><span class="hljs-attr">i</span></span>: racer.coord.i, <span class="hljs-attr"><span class="hljs-attr">j</span></span>: racer.coord.j, <span class="hljs-attr"><span class="hljs-attr">wait</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, }</code> </pre><br>  where s is the speed of the riser, root is the direction, i, j are the coordinates to which the rayser is to be set in the current course, wait is the wait time.  I add tracer information to the last element of the array: <br><br><pre> <code class="javascript hljs"> time: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.timer, <span class="hljs-attr"><span class="hljs-attr">human_time</span></span>: racer.human_time, <span class="hljs-attr"><span class="hljs-attr">start_i</span></span>: racer.start.i, <span class="hljs-attr"><span class="hljs-attr">start_j</span></span>: racer.start.j, <span class="hljs-attr"><span class="hljs-attr">road</span></span>: settings.road, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: racer.name, <span class="hljs-attr"><span class="hljs-attr">color</span></span>: racer.fill,</code> </pre><br>  where, time is the total number of frames for which this rayser came to the finish, human_time is time in the format hh: ss, start_i, start_j are the coordinates for the starting position, road is the index of the route on which this tracer is received, name is the name tracer, color - the color of the riser. <br><br>  At each player‚Äôs turn, an object is written to the array with the current parameters.  Coordinates for the start of the course, direction and speed.  If the speed is zero, then the wait parameter increments.  Once a frame, 1 is added to this parameter and so on until the speed becomes <br>  Above zero. <br><br>  At the start of the rayser, the turn object is created and the wait starts incrementing (since the speed is first zero). Then, at each turn, when the frame counter equals zero, either the stroke object is written to the array or the wait is incremented. <br><br>  When reading this array, the value wait first looks.  If this parameter is greater than zero, then the render of this rayser is turned off and its own counter is incriminated.  When the own counter is equal to the value of wait, then the next object of the turn looks further.  Objects of the tracer, where wait is not zero, are processed by the same functions as the movements of the rayser under the control of the player.  That is, the speed and direction of the object and the so-called goal of the move (the end point for this move) are set, and a standard set of functions is started to calculate the render parameters and draw the course of the riser. <br><br><h3>  Conclusion </h3><br>  As a result, I got a pretty smart arcade game with elements of network interaction between players.  I didn‚Äôt check the cross-browser compatibility ... firefox, or rather, gave terrible fps when changing the scale, and I don‚Äôt know what this is about.  If someone does not work, then chromium or, in extreme cases, chrom. <br><br>  At first, I thought of something slow and puzzling, that is, I had to count the cells and find points from which one could not hit the wall on the next turn.  And there were cells.  But after I realized that at 50 fps, you can describe the racers with great speed and smoothness, then I redid everything and instead of a logical game of moves, an arcade turned out. <br><br>  <a href="http://coderjs.zz.vc/projects/races/index.html">The game is</a> about 3,000 lines of code and 4 megabytes. <br><br>  UP 1: Someone knows why chromium under linux works fine (50fps), then only gives 20. Only why firefox doesn‚Äôt like viewBox and especially scaling so much?  The whole render works on window.requestAnimationFrame () </div><p>Source: <a href="https://habr.com/ru/post/331430/">https://habr.com/ru/post/331430/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../331418/index.html">We dot the microservices. Avito section on RHS ++ 2017 (Video)</a></li>
<li><a href="../331420/index.html">Z-order in 8D</a></li>
<li><a href="../331422/index.html">Welcome to Science Slam Digital July 7</a></li>
<li><a href="../331426/index.html">Videos: Android meetup at Badoo office</a></li>
<li><a href="../331428/index.html">The final of the SAP contest Koder 2017 will be held live</a></li>
<li><a href="../331432/index.html">SIP: this growth does not stop</a></li>
<li><a href="../331434/index.html">We put Selenium Grid on Apache Mesos wheels</a></li>
<li><a href="../331436/index.html">Monitoring System Delays with JHiccup</a></li>
<li><a href="../331438/index.html">Artificial Intelligence Half-Life SDK: Retrospective</a></li>
<li><a href="../331440/index.html">Medici effect or is it possible to cross a peach and melon or Windows and iOs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>