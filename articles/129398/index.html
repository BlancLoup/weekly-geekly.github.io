<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unobtrusive Validation in ASP.NET MVC3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not long ago, I started developing ASP.NET MVC websites and in one of my projects I had a need for a non-standard validator that would check if a form...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unobtrusive Validation in ASP.NET MVC3</h1><div class="post__text post__text-html js-mediator-article">  Not long ago, I started developing ASP.NET MVC websites and in one of my projects I had a need for a non-standard validator that would check if a form element is required to be filled depending on the value of another element.  That is what I want to tell. <br><br>  The site was developed on automotive topics.  The need for a validator appeared on the registration form.  The user can register as an individual and as a car dealer.  If the user wants to register as a car dealer, then he needs to fill in a few additional required fields.  Of course, it was possible to do the registration in several stages, but I wanted the entire registration process to take place in one step. <br><a name="habracut"></a><br><br><h5>  Server part </h5>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To create our own validator, we need to inherit from the ValidationAttribute class. <br><br><pre><code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">AttributeUsage(AttributeTargets.Property, AllowMultiple = true, Inherited = true)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RequiredIfAttribute</span></span> : <span class="hljs-title"><span class="hljs-title">ValidationAttribute</span></span>, <span class="hljs-title"><span class="hljs-title">IClientValidatable</span></span> { <span class="hljs-comment"><span class="hljs-comment">//,    . private const string _defaultErrorMessage = "{0} is required"; //  private string _targetPropertyName; //   private bool _targetPropertyCondition; public RequiredIfAttribute(string targetPropertyName, bool targetPropertyCondition) : base(_defaultErrorMessage) { this._targetPropertyName = targetPropertyName; this._targetPropertyCondition = targetPropertyCondition; } public override string FormatErrorMessage(string name) { return String.Format(CultureInfo.CurrentUICulture, ErrorMessageString, name, _targetPropertyName, _targetPropertyCondition); } protected override ValidationResult IsValid(object value, ValidationContext validationContext) { bool result = false; bool propertyRequired = false; //       . //   var targetProperty = validationContext.ObjectType.GetProperty(_targetPropertyName); //    var targetPropertyValue = (bool)targetProperty.GetValue(validationContext.ObjectInstance, null); //     ,      . if (targetPropertyValue == _targetPropertyCondition) { propertyRequired = true; } if (propertyRequired) { //    if (value == null) { var message = FormatErrorMessage(validationContext.DisplayName); return new ValidationResult(message); } } return null; } public IEnumerable&lt;ModelClientValidationRule&gt; GetClientValidationRules(ModelMetadata metadata, ControllerContext context) { var rule = new ModelClientValidationRule(); rule.ErrorMessage = FormatErrorMessage(metadata.GetDisplayName()); rule.ValidationType = "requiredif"; rule.ValidationParameters.Add("targetpropertyname", this._targetPropertyName); rule.ValidationParameters.Add("targetpropertyvalue", this._targetPropertyCondition.ToString().ToLower()); yield return rule; } }</span></span></code> </pre> <br><br>  Define an attribute for the error message that will be issued to the user in _defaultErrorMessage, and also define two fields _targetPropertyName and _targetPropertyCondition, which will store the name of the field in the model, depending on which will be checked whether the current field is filled (for which this attribute is specified) and the value of this field, respectively. <br><br>  In order to implement client validation, it is necessary to inherit the IClientValidatable interface.  In the GetClientValidationRules method, we create a new rule for which we specify an error message, a validator type, as well as the parameters of our validator.  Subsequently, all this will be added to the markup form. <br><br><img src="https://habrastorage.org/storage1/5e3b2289/69623d6c/f740952d/9d23f230.png"><br><br><h5>  Client part </h5><br><br>  This completes the server part.  Let us turn to the client part.  In order for our validator to work on the client side, we need to create our own validation function and our adapter. <br><br><pre> <code class="javascript hljs">$(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $.validator.addMethod(<span class="hljs-string"><span class="hljs-string">"requiredif"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value, element, param</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($(param.propertyname).is(<span class="hljs-string"><span class="hljs-string">':checked'</span></span>).toString() == param.propertyvalue) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.depend(param, element)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"dependency-mismatch"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (element.nodeName.toLowerCase()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'select'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> val = $(element).val(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> val &amp;&amp; val.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'input'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.checkable(element)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getLength(value, element) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $.trim(value).length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }); $.validator.unobtrusive.adapters.add(<span class="hljs-string"><span class="hljs-string">"requiredif"</span></span>, [<span class="hljs-string"><span class="hljs-string">"targetpropertyname"</span></span>, <span class="hljs-string"><span class="hljs-string">"targetpropertyvalue"</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (options.element.tagName.toUpperCase() !== <span class="hljs-string"><span class="hljs-string">"INPUT"</span></span> || options.element.type.toUpperCase() !== <span class="hljs-string"><span class="hljs-string">"CHECKBOX"</span></span>) { options.rules[<span class="hljs-string"><span class="hljs-string">"requiredif"</span></span>] = { <span class="hljs-attr"><span class="hljs-attr">propertyname</span></span>: <span class="hljs-string"><span class="hljs-string">"#"</span></span> + options.params.targetpropertyname, <span class="hljs-attr"><span class="hljs-attr">propertyvalue</span></span>: options.params.targetpropertyvalue }; options.messages[<span class="hljs-string"><span class="hljs-string">"requiredif"</span></span>] = options.message; } }); } (jQuery));</code> </pre><br><br><h5>  Using: </h5><br><br>  In order to use, you must specify the RequiredIf attribute in the model for the corresponding fields: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RegisterModel</span></span> { [Required] [Display(Name = <span class="hljs-string"><span class="hljs-string">"First name"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required] [Display(Name = <span class="hljs-string"><span class="hljs-string">"Last name"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> LastName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required] [DataType(DataType.EmailAddress)] [Display(Name = <span class="hljs-string"><span class="hljs-string">"Email address"</span></span>)] [RegularExpression(<span class="hljs-string"><span class="hljs-string">"^([A-Za-z0-9_\\-\\.])+\\@([A-Za-z0-9_\\-\\.])+\\.([A-Za-z]{2,4})$"</span></span>, ErrorMessage = <span class="hljs-string"><span class="hljs-string">"Not a valid email."</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Email { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Display(Name = <span class="hljs-string"><span class="hljs-string">"Dealer"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsDealer { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [RequiredIf(<span class="hljs-string"><span class="hljs-string">"IsDealer"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)] [StringLength(<span class="hljs-number"><span class="hljs-number">100</span></span>, ErrorMessage = <span class="hljs-string"><span class="hljs-string">"The {0} must be at least {2} characters long."</span></span>, MinimumLength = <span class="hljs-number"><span class="hljs-number">3</span></span>)] [Display(Name = <span class="hljs-string"><span class="hljs-string">"Dealer name"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br><br>  And also add our script to the page: <br><pre> <code class="html hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Url.Content("</span></span></span><span class="hljs-tag">~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Scripts</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">jquery.validate.unobtrusive.requiredif.js</span></span></span><span class="hljs-tag">")" </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  As a result, we got a fairly easy-to-use validator that works on both the server and client side: <br><br><img src="https://habrastorage.org/storage1/6821bb16/87325bc4/eddd1196/1c15e50e.png"><br><br>  PS: By default, unobtrusive validation is disabled in ASP.NET MVC3.  You can enable it in two ways.  First, using the Web.config file: <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appSettings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ClientValidationEnabled"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UnobtrusiveJavaScriptEnabled"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appSettings</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  You can also specify in the code: <br><br><pre> <code class="cs hljs">HtmlHelper.ClientValidationEnabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; HtmlHelper.UnobtrusiveJavaScriptEnabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;</code> </pre><br><br>  and you also need to add a couple of JavaScript files in the View: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Url.Content("</span></span></span><span class="hljs-tag">~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Scripts</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">jquery.validate.js</span></span></span><span class="hljs-tag">")" </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Url.Content("</span></span></span><span class="hljs-tag">~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Scripts</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">jquery.validate.unobtrusive.js</span></span></span><span class="hljs-tag">")" </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/129398/">https://habr.com/ru/post/129398/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../129392/index.html">Embedding Spring Security in the ZK + Spring Framework + Hibernate: Part One</a></li>
<li><a href="../129393/index.html">Nokia is working on the creation of a new mobile OS Meltemi</a></li>
<li><a href="../129394/index.html">Amazon will lose $ 50 on each tablet.</a></li>
<li><a href="../129395/index.html">OpenGTS open-source vehicle tracking solution</a></li>
<li><a href="../129396/index.html">WP Creator Calculator - a plugin for creating a calculator form</a></li>
<li><a href="../129399/index.html">Loopdetect DIY</a></li>
<li><a href="../129401/index.html">Serious vulnerability in all versions of FreeBSD</a></li>
<li><a href="../129402/index.html">And what is your last completed project?</a></li>
<li><a href="../129403/index.html">Review of the "sleeping" laptop Samsung 350U2B</a></li>
<li><a href="../129404/index.html">Princeton will be struggling with a paid subscription to scientific articles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>