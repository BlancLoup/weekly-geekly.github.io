<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dropbox on macOS uses malware tricks to get privileges that it doesn't need</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you have Dropbox installed, check   ‚Üí   ‚Üí  . 




 TL; DR: Dropbox 


- Shows macOS fake system window to get user password 
- Adds itself to privi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dropbox on macOS uses malware tricks to get privileges that it doesn't need</h1><div class="post__text post__text-html js-mediator-article"><p> If you have Dropbox installed, check <code> </code> ‚Üí <code>  </code> ‚Üí <code></code> . </p><br><img src="https://habrastorage.org/files/f93/38d/9de/f9338d9debf24643b9403bdab7c1dd5d.png"><br><p><br>  TL; DR: Dropbox </p><br><ul><li>  Shows macOS fake system window to get user password </li><li>  Adds itself to privileged processes without permission for everyone. </li><li>  Puts backdoor in the system to restore permissions if they are explicitly selected. </li><li>  These permissions do not really use &lt;irony /&gt; <a name="habracut"></a></li></ul><br><p>  Notice anything unusual in this picture?  Ever wondered how it got here?  Thought - maybe you added it yourself when Dropbox asked permission to control a computer? </p><br><p>  No, your memory does not fail you.  You do not remember how you allowed it, because Dropbox never showed you a dialog asking for permission ‚Äî like this: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/bd1/0e4/4a0/bd10e44a0cea4f0fb57897407a429102.png" width="600"></div><br><p>  This is the only officially allowed opportunity to get on this list - but Dropbox never asked you for permission.  Later I will tell you why this is important, but now do an amazing experiment: try <strong>deleting</strong> it. </p><br><p>  ‚ÄúEasy!‚Äù You say.  The way everyone knows: click <code>¬´¬ª</code> , select the line from Dropbox, delete it with the <strong>"-"</strong> button.  And now, look: it is no more, right? </p><br><p>  <strong>Wrong</strong> .  He has a bad habit of coming back every time.  Try to re-enter the system (or restart the program), and Dropbox will add itself again to the list of allowed applications and a check mark in front of it will be installed.  This is real magic! </p><br><p>  If you don't want to try, see how I try to disable this feature in Dropbox: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/9ZOrDPC8mfw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Two questions arise here: </p><br><ul><li>  Why is it important? </li><li>  Is it possible to somehow remove this check mark, but continue to use Dropbox? </li></ul><br><h2>  Why is it important? </h2><br><p>  This is important for at least three reasons: </p><br><p>  <strong>First</strong> , and most important: because Dropbox <strong>did not even ask permission</strong> to control your computer.  ‚ÄúManaging a computer‚Äù in macOS means pressing buttons, menu items, launching programs, deleting files ... This is a security risk, and therefore programs should require entering a password and explicit permission to enter that list. </p><br><div class="spoiler">  <b class="spoiler_title">And the ‚Äúexplanation‚Äù from Dropbox doesn‚Äôt explain why they do this trick.</b> <div class="spoiler_text"><p>  Interlude: Contrary to Dropbox's complete spurious ‚Äúexplanation‚Äù / obfuscation.  <a href="https://developer.apple.com/library/mac/documentation/Accessibility/Conceptual/AccessibilityMacOSX/index.html">Accessibility frameworks</a> were first introduced through the System Events and the Processes suite.  It can be used as a guideline. </p></div></div><br><p>  But, for example, you trust Dropbox, and consider that they are a big company that does not want to upset its users and will not do things that are not worthy of their honest name? </p><br><p>  If you reason like this, you make two mistakes: </p><br><ul><li><p>  The larger the company, the less it suffers from frustrated users.  It's simple: if 1000 people read this article and stop using the service <em>(by Habr√©, there were 200 people)</em> , by and large, nothing will change.  <em>It is foolish to</em> assume that a large company will not send you to hell from the fact that it is afraid of losing all customers and business.  Even more stupid - if you remember that you have them at a free rate.  ( <a href="http://arstechnica.com/security/2016/07/dark-patterns-are-designed-to-trick-you-and-theyre-all-over-the-web/">Below is a</a> detailed analysis of why large companies rarely think about the ethics of their actions). </p><br></li><li>  More importantly, you <strong>already have</strong> serious evidence that Dropbox cannot be trusted: it has just gained control of the system, bypassing macOS protection, and without asking you.  In addition, as you saw in that amazing experiment, even when you clearly take control away from him, he ignores your decision and restores it.  How he does it - we will soon find out.  (There are other good reasons to disbelieve Dropbox - for example, <a href="https://habrahabr.ru/post/119348/">this one</a> is approx. Lane.) </li></ul><br><p>  There is a <strong>second</strong> problem with this Dropbox trick. </p><br><p>  Imagine for a moment that the developers do not want evil and do not want to do anything bad to you.  But, nevertheless, the Dropbox process has the possibility of this.  This means that an attacker can find an error in the Dropbox code and use it to take control of your computer.  For now this is only a potential threat;  but, like all threats, it will become real as soon as some attacker uses it. </p><br><p>  The whole point of the OS security system ‚Äî and the main task of the macOS permissions system ‚Äî is that the program <strong>should not have more authority than it needs to complete the task</strong> .  Dropbox either stores the administrator password explicitly (this is very bad), or starts its process with superuser privileges (no less bad) - otherwise it would have to ask the password every time you remove it from the allowed ones. </p><br><p>  In my opinion, this measure is not only secretive (since I did not give explicit permission for such), but also excessive. </p><br><p>  And this is the <strong>third</strong> problem: Dropbox does not need superuser rights or access to the <code>Accesibility API</code> for normal operation.  (As suggested in the <a href="http://applehelpwriter.com/2016/08/29/discovering-how-dropbox-hacks-your-mac/">comments to the original article <sup>(English)</sup></a> , Dropbox thus wants to know when you take a screenshot; but the Habr commentators confirm that the publication of the pictures works - apparently in a civilized way, via <code>FSEvents</code> - approx. Lane). </p><br><p>  I spent a long test to make sure it worked, using it on 3 Macs and iPhone for 10 months, and did not find any problems.  I could not check all the features of the service - I used Dropbox in the usual way on a regular OS X. I repeat: there were no problems, and even if they had arisen, then Dropbox would have to ask for additional permissions - like all other programs - and respect my decision if i take that permission away. </p><br><p>  In addition, I reported my findings to Apple Product Security, and waited to see if they could force developers to change the program's behavior (so far to no avail) </p><br><p>  Then we have only one question left: </p><br><h2>  How to disable all this, but save Dropbox.app? </h2><br><p>  <em>(Comments indicate that deleting Dropbox in the usual way does not remove the backdoor - approx. Lane.)</em> </p><br><ul><li>  Stop Dropbox (Dropbox icon in menu bar ‚Üí context menu ‚Üí <code>¬´¬ª</code> ‚Üí <code> Dropbox</code> ) </li><li>  Delete the directory <code>/Library/DropboxHelperTools</code> </li><li>  Remove Dropbox from <code>  </code> ‚Üí <code> </code> </li><li>  Log out and log back in. </li><li>  Launch Dropbox and see this window: </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/files/71c/d46/b83/71cd46b8373940cb97d28a9928698a70.png"></div><br><p>  As we‚Äôve already figured out, this dialog box is lying (still believe a big serious company?) When it says that Dropbox will not function correctly;  but the main deception is that this is not the window that should be shown by a program that wants access to the <code>Accessibility API</code> .  In fact, even with a user password, it should not be allowed in <code> </code> .  It seems that the guys from Dropbox are paid a salary for inventing hacks for macOS. </p><br><p>  And here is a small snag: if you don‚Äôt give your program your password, it won‚Äôt get into <code> </code> and will work without it - as well as before.  But every time it starts, it will again and again require your password. </p><br><p>  Now you will need to look at who asks for a password, and not give it to any program.  Of course, you shouldn‚Äôt do that without my advice - but this dialog box looks <abbr title="But not really present. Look at the details: incorrect indents, inaccurate hyphenation, wording of the text give a fake">almost like a real</abbr> system window of macOS itself - and, perhaps, has already taught you to write everything you ask for. </p><br><p>  This request is unpleasant every time, but not as unpleasant as the program that hacked your Mac. </p><br><h2>  Additions </h2><br><ul><li>  Second article: A detailed analysis of the technology that Dropbox uses to deploy to the system: <a href="http://applehelpwriter.com/2016/08/29/discovering-how-dropbox-hacks-your-mac/">Discovering How Dropbox Hack's Your Mac <sup>(eng.)</sup></a> </li><li>  The answer is an apology from the developers in the <a href="http://applehelpwriter.com/2016/08/29/discovering-how-dropbox-hacks-your-mac/">comments <sup>(eng.)</sup></a> To the second article.  It comes down to phrases: "Well, you noticed it, now you have to remove it" and "We are not villains, we just have a bad code."  They also say that the window is a real system, not a fake. </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/310074/">https://habr.com/ru/post/310074/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310062/index.html">Pitfalls of conditional formatting in MS Access</a></li>
<li><a href="../310064/index.html">How to avoid mistakes using modern C ++</a></li>
<li><a href="../310066/index.html">31 best email marketing automation tools</a></li>
<li><a href="../310068/index.html">PHP: fractal misuse</a></li>
<li><a href="../310070/index.html">Hackathon in the company: how to do it and why to participate in it</a></li>
<li><a href="../310076/index.html">What game evaluation window to integrate into your mobile phone</a></li>
<li><a href="../310078/index.html">The project from the CIS became the winner of the annual battle of startups on TechCrunch</a></li>
<li><a href="../310082/index.html">Overview of decentralized crypto platforms. Part 1: Waves</a></li>
<li><a href="../310084/index.html">Features of the use of machine learning in the protection against DDoS attacks</a></li>
<li><a href="../310086/index.html">Blend4Web vs Unity. Battle in the ring. Round 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>