<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SAMBA File Server Based on Linux CentOS 7</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi Habr! 
 After the activity of the Petya encryption company on 06/27/2017, I turned off SMB1 aka CIFS, and received production equipment and network...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SAMBA File Server Based on Linux CentOS 7</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/ace/1e1/936/ace1e1936dfa46fc872cd5b2cdb6a9aa.png"><br><br>  Hi Habr! <br>  After the activity of the <a href="https://ru.wikipedia.org/wiki/Petya">Petya</a> encryption company on 06/27/2017, I turned off SMB1 aka CIFS, and received production equipment and network MFPs that do not know how to work on ‚Äúnew‚Äù versions of the SMB protocol. <br><br>  How then to receive data from "old" devices?  As practice has shown, a separate ‚Äúmachine‚Äù with Windows is not an option; during the attack, in addition to domain ‚Äúmachines‚Äù, those not included in the domain also suffered, therefore, and for licensing reasons, I decided to use Linux. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Under the cut there is a step-by-step instruction on installing and configuring the SAMBA file server based on CentOS 7: <br><br>  - Anonymous access <br>  - Authentication and authorization <br>  - Active Directory integration <br><a name="habracut"></a><br><h4>  CentOS 7 installation </h4><br>  The servers are running VMware ESXi, and therefore I installed CentOS 7 1611 on the VM, allocating 1 CPU, 1GB RAM and 3GB HDD. <br><br>  I do not use LVM, I do not create a SWAP partition, allocate 500MB to the boot partition, and give everything else to the root of the file system.  I use ext4 as a file system. <br><br><img src="https://habrastorage.org/web/6da/256/977/6da2569770c34ae29179f671818287d7.png"><br><br>  I will not describe the installation process, even if you have never done this, it is not difficult, you will succeed.  I assume that you have already installed everything, then you can proceed. <br><br>  If you are new to Linux, make copies of the original files with configs, use the <b>cp</b> command. <br><br><pre><code class="bash hljs">cp /etc/somefile.conf /etc/somefile.conf.bak</code> </pre> <br><h4>  Getting ip address by DHCP </h4><br>  If for some reason there is no DHCP server on the network, you should raise it.  Working with a large number of VMs without DHCP is not convenient. <br><br>  To force update or get ip address, run the command <br><br><pre> <code class="bash hljs">dhclient</code> </pre> <br>  Show ip address <br><pre> <code class="bash hljs">ifconfig  nmcli device show</code> </pre> <br><br><h4>  Yum </h4><br>  CentOS 7 uses the YUM package manager.  Cheat sheet on yum is <a href="https://habrahabr.ru/post/301292/">here</a> . <br><br>  If the Internet access is organized through a proxy server, add the proxy address to the configuration file <b>/etc/yum.conf</b> , use the vi editor or the following command <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> proxy=http://your.proxy:8888 &gt;&gt; /etc/yum.conf</code> </pre> <br>  If you use the login and password to access the proxy server, add the following parameters: <br><blockquote>  proxy_username = yum-user <br>  proxy_password = qwerty </blockquote><br><h4>  Installing agents on the VM to interact with the host server </h4><br>  VMware ESXi requires open-vm-tools to be installed. <br><br><pre> <code class="bash hljs">yum install open-vm-tools</code> </pre> <br>  For Hyper-V, hyperv-daemons <br><br><pre> <code class="bash hljs">yum install hyperv-daemons</code> </pre> <br><h4>  <font color="#cc0000">Install Updates</font> </h4><br>  It is very important to install all available updates. <br><br><pre> <code class="bash hljs">yum update</code> </pre> <br><h4>  Midnight commander </h4><br>  Editing files without a normal editor is not very convenient, and I suggest using mc and mcedit <br><br><pre> <code class="bash hljs">yum install mc</code> </pre> <br><h4>  Network configuration </h4><br>  You can use the <b>nmtui</b> utility to configure a static ip address and host name <b>.</b> <br><br><img src="https://habrastorage.org/web/794/dad/619/794dad619d1f4f48804cf14874324902.png"><br><br>  The command line list of network adapters can be obtained with the command <br><br><pre> <code class="bash hljs">nmcli device status</code> </pre> <br>  The static ip and gateway are defined by the following command, where ‚Äúens192‚Äù is the name of the network adapter <br><br><pre> <code class="bash hljs">nmcli connection modify ‚Äúens192‚Äù ipv4.addresses ‚Äú192.168.1.100/24 192.168.1.1‚Äù</code> </pre> <br><h4>  FQDN setting </h4><br>  Let the full host name be <b>ls01.fqdn.com</b> , execute the command <br><br><pre> <code class="bash hljs">hostnamectl <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-hostname ls01.fqdn.com</code> </pre> <br>  Rebooting the name service <br><br><pre> <code class="bash hljs">systemctl restart systemd-hostnamed</code> </pre> <br>  You can check the result with the following commands. <br><br><pre> <code class="bash hljs">hostnamectl status hostname hostname -s hostname -f</code> </pre> <br><h4>  ipv6 </h4><br>  If the ipv6 protocol is not used, it is logical to disable it. To do this, add two parameters to the <b>/etc/sysctl.conf</b> file, run the following commands, or use the <b>mcedit</b> editor <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> net.ipv6.conf.all.disable_ipv6 = 1 &gt;&gt; /etc/sysctl.conf <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> net.ipv6.conf.default.disable_ipv6 = 1 &gt;&gt; /etc/sysctl.conf</code> </pre> <br>  Restart network service <br><br><pre> <code class="bash hljs">service network restart</code> </pre> <br><h4>  SELINUX </h4><br>  At this stage, the SELINUX service needs to be disabled, you can check the status of the SELINUX service with the command <br><br><pre> <code class="bash hljs">sestatus</code> </pre> <br>  Change the SELINUX value in the <b>/ etc / selinux / config</b> <b>file</b> to <b>SELINUX = disabled</b> then restart the server. <br><br><pre> <code class="bash hljs">reboot</code> </pre> <br>  I'll be back to SELINUX at the end of the article. <br><br><h4>  Samba </h4><br>  Installation <br><br><pre> <code class="bash hljs">yum install samba</code> </pre> <br>  Add service to auto start <br><br><pre> <code class="bash hljs">chkconfig smb on</code> </pre> <br>  Service start and status check <br><br><pre> <code class="bash hljs">service smb start smbstatus</code> </pre> <br><h4>  firewallD </h4><br>  By default, CentOS 7 uses the firewallD firewall, the status of the service can be found with the command <br><br><pre> <code class="bash hljs">firewall-cmd --state</code> </pre> <br>  For a list of rules and services use <br><br><pre> <code class="bash hljs">firewall-cmd --list-all firewall-cmd --list-services</code> </pre> <br><img src="https://habrastorage.org/web/452/7fa/a93/4527faa930454ff38beb3bffd8279e82.png"><br><br>  Pay attention to the list of services, if you have disabled the ipv6 protocol, it is also logical to do with dhcpv6-client <br><br><pre> <code class="bash hljs">firewall-cmd -‚Äìpermanent -‚Äìremove-service=dhcpv6-client</code> </pre> <br>  Create a rule for SAMBA and reboot <br><br><pre> <code class="bash hljs">firewall-cmd --permanent --add-service=samba firewall-cmd --reload</code> </pre> <br><h4>  <font color="#cc0000">Anonymous shared resource</font> </h4><br>  Create a folder for the resource / samba / guest <br><br><pre> <code class="bash hljs">mkdir /samba mkdir /samba/guest</code> </pre> <br>  Change the owner and assign rights <br><br><pre> <code class="bash hljs">chown nobody:nobody /samba/guest chmod 777 /samba/guest</code> </pre> <br>  Editing the SAMBA configuration file <b>/etc/samba/smb.conf</b> <br><br><pre> <code class="bash hljs">mcedit /etc/samba/smb.conf</code> </pre> <br>  Change the contents of the original file to the following <br><blockquote>  [global] <br>  workgroup = WORKGROUP <br>  security = user <br>  map to guest = bad user <br>  min protocol = NT1 <br><br>  [guest] <br>  path = / samba / guest <br>  guest ok = Yes <br>  writable = Yes </blockquote>  Just in case, I specified the minimum version of the <b>SMB</b> protocol <b>= NT1</b> .  If you specify SMB2 or SMB3, clients with Windows XP and below will not be able to access resources. <br><br>  Parameter check and service restart <br><br><pre> <code class="bash hljs">testparm service smb restart smbstatus</code> </pre> <br><br>  <b>Congratulations, you have reached the first level of dedication.</b>  <b>The shared resource with anonymous access is configured, it will work for a long time and reliably.</b>  <b>But you can and need to adjust a few more things.</b> <br><br><h4>  Bows </h4><br>  By default, the log files are located in the <b>/ var / log / samba</b> folder.  If you need to get detailed logs, you must add the log level = 2 or 3 parameter to the [global] section. The default value is 1, the value 0 disables logging. <br><blockquote>  [global] <br>  log level = 2 </blockquote>  As you may know, providing access to files is only part of the SAMBA functionality.  If the server will only have file resources, the print service is logical to disable.  In the [global] section, add the following parameters <br><blockquote>  [global] <br>  load printers = no <br>  show add printer wizard = no <br>  printcap name = / dev / null <br>  disable spoolss = yes </blockquote><br>  The SAMBA configuration is in the <b>/ etc / samba</b> directory, and the logs in the <b>/ var / log / samba</b> directory <br>  It is more convenient for me to keep all the tools at hand, so I mount the directories I need in <b>/ samba</b> <br><br>  Create directories into which everything will be mounted <br><br><pre> <code class="bash hljs">mkdir /samba/smbconf mkdir /samba/smblogs</code> </pre> <br>  Editing the config file <b>/ etc / fstab</b> , I assume that you know what <a href="http://help.ubuntu.ru/wiki/fstab">fstab</a> is responsible for. <br><br><pre> <code class="bash hljs">mcedit /etc/fstab</code> </pre> <br>  Add the following lines <br><blockquote>  / etc / samba / samba / smbconf none bind 0 0 <br>  / var / log / samba / samba / smblogs none bind 0 0 </blockquote><br>  Mount without rebooting <br><pre> <code class="bash hljs">mount -a</code> </pre> <br><h4>  Disk connection </h4><br>  Keeping a shared resource on a system disk without a quota is not the best choice.  I decided not to get quotas, it is easier for me to connect a separate ‚Äúphysical‚Äù disk. <br><br>  You can use the <b>lsblk</b> command to get the list of devices <b>.</b> <br><br><pre> <code class="bash hljs">lsblk</code> </pre> <br>  Creating a partition table on the / dev / sdb disk <br><br><pre> <code class="bash hljs">parted /dev/sdb mklabel msdos</code> </pre> <br>  or <br><br><pre> <code class="bash hljs">parted /dev/sdb mklabel gpt</code> </pre> <br>  Detailed information about gpt can be read <a href="https://habrahabr.ru/post/327572/">here.</a> <br><br>  Creating a partition for the entire sdb disk, in the best traditions of the genre, I decided to indent 1MiB at the beginning of the disk. <br><br><pre> <code class="bash hljs">parted /dev/sdb mkpart primary ext4 1MiB 100%</code> </pre> <br>  Create an ext4 file system <br><br><pre> <code class="bash hljs">mkfs.ext4 /dev/sdb1</code> </pre> <br>  Editing fstab <br><br><pre> <code class="bash hljs">mcedit /etc/fstab</code> </pre> <br>  Add another line <br><blockquote>  / dev / sdb1 / samba / guest ext4 defaults 0 0 </blockquote><br>  Mounting <br><br><pre> <code class="bash hljs">mount ‚Äìa</code> </pre> <br>  Check the result <br><br><pre> <code class="bash hljs">df -h</code> </pre> <br>  Assignment of rights <br><br><pre> <code class="bash hljs">chmod 777 /samba/guest</code> </pre> <br><h4>  Mount Disk Image </h4><br>  If you do not need large amounts, and enough resource size xxx mb, you can mount a disk image from a file. <br><br>  Create a directory for storing images <br><br><pre> <code class="bash hljs">mkdir /samba/smbimg</code> </pre> <br>  Create an image file size of 100 MB <br><br><pre> <code class="bash hljs">dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=/dev/zero of=/samba/smbimg/100M.img bs=100 count=1M</code> </pre> <br>  About the dd command you can read a lot of interesting stuff <a href="https://habrahabr.ru/post/117050/">here.</a> <br><br>  In the version with the image, I decided not to create a partition table, just create an ext4 file system. <br><br><pre> <code class="bash hljs">mkfs.ext4 /samba/smbimg/100M.img</code> </pre> <br>  Editing fstab <br><br><pre> <code class="bash hljs">mcedit /etc/fstab</code> </pre> <br>  Config for mounting image <br><blockquote>  /samba/smbimg/100M.img / samba / guest ext4 defaults 0 0 </blockquote><br>  Mounting <br><br><pre> <code class="bash hljs">mount -a</code> </pre> <br>  Check the result <br><br><pre> <code class="bash hljs">df -h</code> </pre> <br>  Assignment of rights <br><br><pre> <code class="bash hljs">chmod 777 /samba/guest</code> </pre> <br><h4>  RAM disk connection </h4><br>  For temporary resources where a large amount is not needed, I think the RAM disk is the best option, it is very quickly and simply tuned, and the speed of work is amazing. <br><br>  Editing fstab <br><br><pre> <code class="bash hljs">mcedit /etc/fstab</code> </pre> <br>  Config for RAM disk <br><blockquote>  none / samba / guest tmpfs defaults, size = 100M 0 0 </blockquote><br>  Mounting <br><br><pre> <code class="bash hljs">mount -a</code> </pre> <br>  Check the result <br><br><pre> <code class="bash hljs">df -h</code> </pre> <br><h4>  Deleting old files </h4><br>  In the case of a file dumper, resources need to be somehow freed up, for this you can use the crontab task scheduler <br><br>  View assignments <br><br><pre> <code class="bash hljs">crontab ‚Äìl</code> </pre> <br>  Task editing <br><br><pre> <code class="bash hljs">crontab ‚Äìe</code> </pre> <br>  Config example: <br><blockquote>  SHELL = / bin / bash <br>  PATH = / sbin: / bin: / usr / sbin: / usr / bin <br>  MILTO = "" <br>  HOME = / <br><br>  # delete files and directories every hour <br>  * 0-23 * * * rm ‚ÄìR / samba / guest / * <br><br>  # Delete only files older than 1 day, run the command every 10 minutes. <br>  0-59 / 10 * * * * find / samba / guest / * -type f -mtime +1 -exec rm ‚Äìf {} \; <br><br>  # delete files older than 50 minutes, run the command every 10 minutes <br>  0-59 / 10 * * * * find / samba / guest / * -type f -mmin +50 -exec rm -f {} \; </blockquote><br>  Exit vi <br><br><pre> <code class="bash hljs">&lt;ESC&gt; :wq</code> </pre> <br>  The crontab service logs are located in the <b>/ var / log / cron</b> file <br><br><h4>  Access restriction to SAMBA by ip addresses </h4><br>  If you need to restrict access to all SAMBA resources, add your access lists in the global section, and if you need to restrict only to a specific resource, in the section of this resource. <br><br>  Example: <br><blockquote>  [global] <br>  hosts allow = 192.168.1.100, 192.168.1.101 <br>  hosts deny = ALL <br><br>  [guest] <br>  hosts allow = 192.168.0.0/255.255.0.0 <br>  hosts deny = 10. except 10.1.1.1 </blockquote><br><h4>  <font color="#cc0000">User authentication and authorization</font> </h4><br>  Restricting access to ip addresses is not always convenient or possible, then you can use logins and passwords. <br><br>  First you need to create a local user in the system. <br><br><pre> <code class="bash hljs">adduser user1</code> </pre> <br>  If the user will only work with SAMBA resources, there is no need to set a password for the system.  The password for the system and for SAMBA are stored in different files and may differ. <br><br>  Then you need to add the system user to the samba users and set the password for it. <br><br><pre> <code class="bash hljs">smbpasswd -a user1</code> </pre> <br>  By default, the tdb file format located in the / var / lib / samba / private / directory is used to store passwords. <br><br>  You can change the file location using the global passdb backend parameter. <br><blockquote>  [global] <br>  passdb backend = tdbsam: /etc/samba/smbpassdb.tdb </blockquote><br>  tdb files were created to replace the ‚Äúobsolete‚Äù text files, if you want to use text files, for this, use the <b>passdb</b> parameter <b>backend = smbpasswd</b> in the global section <br>  passdb backend = smbpasswd: / etc / samba / smbpasswd <br><br>  Then specify lists of users and groups for accessing resources. <br><blockquote>  [guest] <br>  path = / samba / guest <br>  writable = no <br>  read list = user1, @ group2 <br>  write list = user2, user3 </blockquote><br><h4>  <font color="#cc0000">Active Directory integration</font> </h4><br>  It is also possible to receive information about users from LDAP, but this option is not interesting to me and I immediately turn to AD.  Detailed instructions from Microsoft are <a href="https://technet.microsoft.com/ru-ru/jj680665.aspx">here</a> . <br><br>  <b>Time synchronization is very important for AD, so it‚Äôs worth starting with.</b> <br><br>  Install the appropriate service <br><br><pre> <code class="bash hljs">yum install ntp</code> </pre> <br>  Add the /etc/ntp.conf file of the server domain controllers to the config <br><br><pre> <code class="bash hljs">mcedit /etc/ntp.conf</code> </pre> <br>  Example: <br><blockquote>  server 192.168.1.10 <br>  server 192.168.1.20 <br>  server someserver.contoso.com </blockquote><br>  We add ntp service to automatic start <br><br><pre> <code class="bash hljs">chkconfig ntpd on</code> </pre> <br>  We start the service <br><br><pre> <code class="bash hljs">service ntpd start</code> </pre> <br>  Checking time synchronization <br><br><pre> <code class="bash hljs">ntpq ‚Äìp</code> </pre> <br><h4>  winbind </h4><br>  To get information about users from AD, you need to install the <b>samba-winbind package</b> <br><br><pre> <code class="bash hljs">yum install samba-winbind</code> </pre> <br>  We add service to automatic start <br><br><pre> <code class="bash hljs">chkconfig winbind on</code> </pre> <br>  We start the service <br><br><pre> <code class="bash hljs">service winbind start</code> </pre> <br><h4>  Adding a host to AD </h4><br>  Let me remind you that at the beginning of this instruction, the host name was set to <b>ls01.fqdn.com</b> .  We assume that the full domain name is <b>fqdn.com</b> , and let the short one be <b>fqdn_com</b> <br><br>  To make all the necessary parameters in the configuration files, you can use the <b>authconfig-tui utility</b> , check the Use Winbind box, then go to the next window <br><br><img src="https://habrastorage.org/web/736/977/b00/736977b008e24131bb11159620f4f57e.png"><br><br>  Select the ADS security model and enter your domain names.  In the domain controller field, enter ‚Äú*‚Äù, this is necessary to automatically search for an available domain controller.  Then click OK and close the utility. <br><br><img src="https://habrastorage.org/web/178/b6d/8d3/178b6d8d3bba45a2a349445d98f40c6c.png"><br><br>  To add a host to AD, use the command <b>net ads join ‚ÄìU% username%</b> , the user must have the rights to create a PC account in the domain <br><br><pre> <code class="bash hljs">net ads join ‚ÄìU youruser</code> </pre> <br><img src="https://habrastorage.org/web/ec7/c57/7b5/ec7c577b56624fe6ac315de4b2a44748.png"><br><br>  If the machine is not added to the domain, add the FQDN of the host name to the <b>/ etc / hosts file</b> . <br>  I checked everything several times, and I made changes to the hosts file when I didn‚Äôt set the full hostname at the network setup stage. <br><br>  To remove a host from a domain, use the command <b>net ads leave ‚ÄìU% username%</b> <br><br><h4>  What does the authconfig-tui utility do? </h4><br>  The utility adds parameters for connecting to AD in the following files, there are not many parameters and, if desired, you can score everything with your hands. <br><br>  <b>/etc/krb5.conf</b> <br><blockquote>  [libdefaults] <br>  Default_realm = FQDN.COM <br><br>  [realms] <br>  FQDN.COM = { <br>  kdc = * <br>  } <br></blockquote><br>  <b>/etc/nsswitch.conf</b> <br><blockquote>  passwd: files sss <b>winbind</b> <br>  shadow: files sss <b>winbind</b> <br>  group: files sss <b>winbind</b> <br></blockquote><br>  <b>/etc/samba/smb.conf</b> <br><blockquote>  [global] <br>  workgroup = FQDN_COM <br>  password server = * <br>  realm = FQDN.COM <br>  security = ads <br>  idmap config *: range = 16777216-33554431 <br>  template shell = / sbin / nologin <br>  kerberos method = secrets only <br>  winbind use default domain = false <br>  winbind pffline logon = false <br></blockquote><br>  <b>You may have noticed that this utility introduces noticeably fewer parameters than is written in instructions from Microsoft or other instructions, but if it works this way, then why not?</b> <br><br>  From the Microsoft manual I add the following parameters to the config <br><blockquote>  [global] <br>  domain master = no <br>  local master = no <br>  preferred master = no <br>  os level = 0 <br>  domain logons = no </blockquote><br>  <b>Setting permissions on a resource</b> <br>  As an example and for clarity, I recommend setting up resources with different rights to the same folder. <br><blockquote>  [domain users read only] <br>  path = / samba / guest <br>  read list = "@fqdn_com \ domain users" <br>  force create mode = 777 <br>  directory mask = 777 <br><br>  [domain users writable] <br>  path = / samba / guest <br>  read list = "@fqdn_com \ domain users" <br>  write list = "@fqdn_com \ domain users" <br>  force create mode = 777 <br>  directory mask = 777 </blockquote><br>  Restart samba service <br><br><pre> <code class="bash hljs">service smb restart</code> </pre> <br>  Check <br><br><pre> <code class="bash hljs">smbstatus</code> </pre> <br>  The screenshot shows a domain user who is in one of the public folders. <br><img src="https://habrastorage.org/web/f9d/3c7/c18/f9d3c7c184a749dfa63822739c64f8dd.png"><br><br>  <b>THE END</b> <br><br>  List of useful links: <br><br>  <a href="https://habrahabr.ru/company/pc-administrator/blog/331906/">Fighting viruses and infrastructure, or disabling SMB v1</a> <br>  <a href="https://habrahabr.ru/company/pt/blog/329558/">SambaCry critical vulnerability: how to protect</a> <br>  <a href="https://www.tecmint.com/fix-sambacry-vulnerability-cve-2017-7494-in-linux/">How to Fix SambaCry Vulnerability (CVE-2017-7494) in Linux Systems</a> <br><br>  <a href="https://habrahabr.ru/post/301292/">Yum, cheat sheet</a> <br>  <a href="https://habrahabr.ru/post/117050/">Dd command and everything related to it</a> <br><br>  <a href="https://www.samba.org/samba/docs/using_samba/toc.html">Using Samba, 2nd Edition</a> <br>  <a href="https://technet.microsoft.com/ru-ru/jj680665.aspx">Inclusion of the Ubuntu-based Samba server in the AD domain</a> <br>  <a href="https://www.tecmint.com/setup-samba-file-sharing-for-linux-windows-clients/">Setting Up Samba and Configure Firewalls for Allow File Sharing on Linux / Windows Clients</a> <br><br>  <a href="https://habrahabr.ru/company/kingservers/blog/209644/">SELinux - description and features of working with the system.</a>  <a href="https://habrahabr.ru/company/kingservers/blog/209644/">Part 1</a> <br>  <a href="https://habrahabr.ru/company/kingservers/blog/209970/">SELinux - description and features of working with the system.</a>  <a href="https://habrahabr.ru/company/kingservers/blog/209970/">Part 2</a> <br><br>  <b>PS</b> <br>  Back to SELINUX, so that the SAMBA server can provide access to any directories, the following commands should be executed. <br><br><pre> <code class="bash hljs">setsebool -P samba_export_all_ro=1 setsebool -P samba_export_all_rw=1</code> </pre> <br><br>  Unfortunately, I still could not configure winbind when SELINUX is enabled, if you tell me how, I will be grateful. </div><p>Source: <a href="https://habr.com/ru/post/337556/">https://habr.com/ru/post/337556/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337540/index.html">Setting up a Webpack 3 + Angular 4 development environment: from complex to simple</a></li>
<li><a href="../337546/index.html">Why don't CRM work</a></li>
<li><a href="../337548/index.html">Kaggle: how our nets considered sea lions in the Aleutian Islands</a></li>
<li><a href="../337550/index.html">Learn OpenGL. Part 2.4. - Texture Cards</a></li>
<li><a href="../337554/index.html">The path of the Jedi. From a small user to an employee of an IT company</a></li>
<li><a href="../337558/index.html">What is LinkedList under the hood?</a></li>
<li><a href="../337560/index.html">Why did we do VOD on WebRTC</a></li>
<li><a href="../337564/index.html">Specific use of Redux in Polymer and Vue</a></li>
<li><a href="../337566/index.html">How to resurrect a jaguar for a thousand hours?</a></li>
<li><a href="../337568/index.html">SDAccel - check data transfer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>