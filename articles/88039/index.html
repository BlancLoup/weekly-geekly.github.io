<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cross-domain tracking with Google Analytics</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What is cross-domain tracking and why is it needed? 
 The essence of cross-domain tracking using Google Analytics web analytics is that when you switc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cross-domain tracking with Google Analytics</h1><div class="post__text post__text-html js-mediator-article"><h4>  What is cross-domain tracking and why is it needed? </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/efb/4d1/4e3/efb4d14e31f91a4991310f2e57acf2b2.jpg" alt="image" align="left">  The essence of cross-domain tracking using Google Analytics web analytics is that when you switch from one site to another via a link or through a form, information from the previous site‚Äôs cookies is transmitted, with the result that the user's session would not terminate, but allow you to track the user's movement across multiple monitored sites. <br><br>  In fact, it turns out that the visitor does not leave the site through an external link, but simply goes to another page, although in reality he is already on a different domain.  Thus, we can trace the user's path from the beginning to the end of his visits to a group of sites. <br><br>  Another important result of this implementation for commercial sites is the ability to track the initial source that led, for example, to the order of goods on the site. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In Google Analytics, there is a section ‚ÄúReturn path to the goal‚Äù, with which we can trace the visitor‚Äôs path before making an order. <br><br>  Here's how to use it in practice. <br><a name="habracut"></a><br>  For example, the company has 2 sites: first.ru and second.ru.  If the user first goes to the first.ru website, and then follows the link from him to the second.ru website and places an order for it, then the return path to the target without the use of cross-domain tracking will look like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aef/9b3/9f4/aef9b39f48355f6e39e67af27d1d565f.png" alt="image"><br><br>  When using cross-domain tracking in reports, we can find the initial source of this visit: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f44/fa6/3fe/f44fa63fe0a44063feaa85019a939235.png" alt="image"><br><br>  In addition, we can find out the keyword, by which the visitor came first to the site first.ru, subsequently ordering the goods on second.ru: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/140/e42/0b4/140e420b4427fa0856decaba6655ac88.png" alt="image"><br><br>  All this expands the possibilities of data collection by Google Analytics, which allows for a more in-depth analysis of sites. <br><br><h4>  Implementing cross-domain tracking </h4><br>  To implement this tracking, follow these steps: <br><ol><li>  Make some changes to the Google Analytics tracking code for each domain </li><li>  Adding onClick and onSubmit events to outgoing links and / or forms </li><li>  Add filter to Google Analytics web analytics site profile </li></ol><br><br><h4>  1. Changes to the Google Analytics tracking code </h4><br>  In order to track the overall statistics for all domains in one profile, you should create a new profile and for all domains in the Google Analytics code register the same ID, i.e.  "UA-XXXXX-X".  With this option of collecting information, statistics for all sites will be collected and stored in one profile. <br><br>  As a result, we will be able to collect statistics and at the same time observe which page of another site we are tracking followed the user, which way went to this page of the site, etc. <br><br>  Next, you need to add the following code lines to the Google Analytics standard tracking code for each site: <br><br> <code>pageTracker._setDomainName("none"); <br> pageTracker._setAllowLinker(true); <br> pageTracker._setAllowHash(false);</code> <br> <br>  For example, the real code will look like this: <br><br> <code><br></code> <br><br>  By adding these lines of code, we are activating the methods of the Google Analytics system to transfer the user's cookies (save cookies from visiting the previous site, instead of creating new ones) from one domain to another. <br><br>  In some cases, in addition to the domains themselves, we need to take into account their subdomains. <br><br>  Suppose we have sites site1.ru and site2.ru and their subdomains poddomen.site1.ru and poddomen.site2.ru. <br><br>  In this case, the Google Analytics code on these two sites and subdomains will look like this: <br><br>  For site1.ru and its subdomains: <br> <code>pageTracker._setDomainName(".site1.ru"); <br> pageTracker._setAllowLinker(true); <br> pageTracker._setAllowHash(false);</code> <br> <br>  For site2.ru and its subdomains: <br> <code>pageTracker._setDomainName(".site2.ru"); <br> pageTracker._setAllowLinker(true); <br> pageTracker._setAllowHash(false);</code> <br> <br><h4>  2. Adding onClick and onSubmit events to outgoing links and forms </h4><br>  The next step is to add the <b>_link</b> method to all outgoing links leading to the required domains. <br><br>  Example: <br><br>  need to replace the link <br><pre>  &lt;a href="http://www.vneshniy-say.ru/"&gt; Link to an external site &lt;/a&gt; </pre><br><br>  on the link <br><pre>  &lt;a href="http://www.vneshnii-say.ru/" onclick="pageTracker._link(this.href); return false;"&gt; Link to external site &lt;/a&gt; </pre><br><br>  Thus, the same onClick event is added to all external links. <br> <code>onclick="pageTracker._link(this.href); return false;"</code> <br> <br>  Now, when we switch to the second site we are tracking, the user‚Äôs cookies will not be recreated, but transferred from the previous domain, and the visitor will not be considered new to Google Analytics for this site: it will have its own history (where it came from, what keywords looked at the previous site and so on).  The result is that the visitor just moved to another section of the site. <br><br>  If the information is transferred between domains using forms, the <b>_linkByPost</b> method should be used <b>.</b> <br><br>  Example of use: <br><pre>  &lt;form action = "XXX" onSubmit = "pageTracker._linkByPost (this)"&gt; </pre><br><br><h4>  3. Adding a filter to the site profile </h4><br>  By default, all data on sites is collected in one profile, respectively, in Google Analytics reports only site pages will be displayed (without domains).  For example pages of two domains site1.ru/news and site2.ru/news will be displayed as / news.  In order to add a domain to the pages (instead of / news there will be site1.ru/news and site2.ru/news), you need to create the following filter in your profile: <br><br>  Filter Type: Custom Filter&gt; Advanced <br>  Field A: Host Name <br>  Extract A: (. *) <br>  Field B: Request URI <br>  Extract B: (. ‚Äã‚Äã*) <br>  Output to: Request URI <br>  Constructor: / $ A1 $ B1 <br><br>  As a result, in Google Analytics reports instead of such records: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/de6/a80/4ef/de6a804efceed9d00abd3949550b3133.png" alt="image"><br><br>  we get these: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fee/2ed/cf5/fee2edcf516672aebe3f1b3099624078.png" alt="image"><br><br>  As a result of this work, we get a working tool for tracking groups of sites. </div><p>Source: <a href="https://habr.com/ru/post/88039/">https://habr.com/ru/post/88039/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../88021/index.html">How unlucky I am with virtualization or check everything!</a></li>
<li><a href="../88022/index.html">Netgraph ipfw and flexible traffic accounting via netflow</a></li>
<li><a href="../88026/index.html">Google Discount Coupons</a></li>
<li><a href="../88027/index.html">Is this the Wrench ?!</a></li>
<li><a href="../88036/index.html">Google Maps 4.1</a></li>
<li><a href="../88041/index.html">Visual experiments</a></li>
<li><a href="../88042/index.html">Free hosting from e-Style Telecom</a></li>
<li><a href="../88043/index.html">Advertising logos appeared on Google Maps</a></li>
<li><a href="../88049/index.html">Blender 2.5 Beginners Guide</a></li>
<li><a href="../88052/index.html">April 1 is a sad day for payment terminal owners.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>