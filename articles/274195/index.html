<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Direct disk access from python</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I will tell you today about how I tried to get from the python to the hard disk interface, and what came of it. 

 I periodically need to test a large...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Direct disk access from python</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/e03/2cf/e61/e032cfe6188049f884cb1bca3f78c6b5.jpg" alt="image"><br><br>  I will tell you today about how I tried to get from the python to the hard disk interface, and what came of it. <br><br>  I periodically need to test a large number of hard drives.  Usually for this is used presov Victoria loaded on the network.  She tests the discs one by one, which is not very convenient.  In addition, recently went to the board does not have IDE mode, which further complicates the task.  At first, I had an idea to get ready software for Linux with open source and add the possibility of parallel testing of several disks to it.  After a quick search, it turned out the depressing state of this area in Linux.  From the software, when testing, statistics on access time to sectors and types of errors were found only by whdd.  Attempt to deal with code whdd ended in complete failure.  For me, never a programmer, the code seemed very confusing.  In addition, most of it is not working with iron. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Realizing that a simple solution is not expected, I decided to try to write a similar program on my own.  Understanding that I don‚Äôt master a similar C project, I began to study the possibility of working directly with python disks, which I often use to solve simple problems and love for simplicity and clarity.  The cat wept for information on this issue on the network, but still I found out that there is an fcntl module that also allows sending ioctl requests to the device.  Now I have the opportunity to send commands to the disk.  But in Linux, all disks are considered scsi disks, and for testing, you must transfer the disk directly to ata commands.  It turned out that there is an ATA Command Pass-Through mechanism that allows to wrap the ata command in a scsi request.  Basic information on how to use it was learned from the source code of the sg3_utils project.  It remains to try to implement it all on python. <br><a name="habracut"></a><br>  In order to create in Python structures similar to the structures of the C language, for later transfer to ioctl, there is a module ctypes.  We should also mention the number of gray hairs that appeared as a result of debugging strange glitches with these structures.  So I discovered the knowledge of aligning structures in C. As a result, two structures were born: <br><br>  Structure for ATA Pass-Through: <br><br><pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ataCmd</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(ctypes.Structure)</span></span></span><span class="hljs-class">:</span></span> _pack_ = <span class="hljs-number"><span class="hljs-number">1</span></span> _fields_ = [ (<span class="hljs-string"><span class="hljs-string">'opcode'</span></span>, ctypes.c_ubyte), (<span class="hljs-string"><span class="hljs-string">'protocol'</span></span>, ctypes.c_ubyte), (<span class="hljs-string"><span class="hljs-string">'flags'</span></span>, ctypes.c_ubyte), (<span class="hljs-string"><span class="hljs-string">'features'</span></span>, ctypes.c_ushort), (<span class="hljs-string"><span class="hljs-string">'sector_count'</span></span>, ctypes.c_ushort), (<span class="hljs-string"><span class="hljs-string">'lba_h_low'</span></span>, ctypes.c_ubyte), (<span class="hljs-string"><span class="hljs-string">'lba_low'</span></span>, ctypes.c_ubyte), (<span class="hljs-string"><span class="hljs-string">'lba_h_mid'</span></span>, ctypes.c_ubyte), (<span class="hljs-string"><span class="hljs-string">'lba_mid'</span></span>, ctypes.c_ubyte), (<span class="hljs-string"><span class="hljs-string">'lba_h_high'</span></span>, ctypes.c_ubyte), (<span class="hljs-string"><span class="hljs-string">'lba_high'</span></span>, ctypes.c_ubyte), (<span class="hljs-string"><span class="hljs-string">'device'</span></span>, ctypes.c_ubyte), (<span class="hljs-string"><span class="hljs-string">'command'</span></span>, ctypes.c_ubyte), (<span class="hljs-string"><span class="hljs-string">'control'</span></span>, ctypes.c_ubyte)]</code> </pre> <br>  And the structure for ioctl: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sgioHdr</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(ctypes.Structure)</span></span></span><span class="hljs-class">:</span></span> _pack_ = <span class="hljs-number"><span class="hljs-number">1</span></span> _fields_ = [ (<span class="hljs-string"><span class="hljs-string">'interface_id'</span></span>, ctypes.c_int), <span class="hljs-comment"><span class="hljs-comment"># [i] 'S' for SCSI generic (required) ('dxfer_direction', ctypes.c_int), # [i] data transfer direction ('cmd_len', ctypes.c_ubyte), # [i] SCSI command length ( &lt;= 16 bytes) ('mx_sb_len', ctypes.c_ubyte), # [i] max length to write to sbp ('iovec_count', ctypes.c_ushort), # [i] 0 implies no scatter gather ('dxfer_len', ctypes.c_uint), # [i] byte count of data transfer ('dxferp', ctypes.c_void_p), # [i], [*io] points to data transfer memory ('cmdp', ctypes.c_void_p), # [i], [*i] points to command to perform ('sbp', ctypes.c_void_p), # [i], [*o] points to sense_buffer memory ('timeout', ctypes.c_uint), # [i] MAX_UINT-&gt;no timeout (unit: millisec) ('flags', ctypes.c_uint), # [i] 0 -&gt; default, see SG_FLAG... ('pack_id', ctypes.c_int), # [i-&gt;o] unused internally (normally) ('usr_ptr', ctypes.c_void_p), # [i-&gt;o] unused internally ('status', ctypes.c_ubyte), # [o] scsi status ('masked_status', ctypes.c_ubyte), # [o] shifted, masked scsi status ('msg_status', ctypes.c_ubyte), # [o] messaging level data (optional) ('sb_len_wr', ctypes.c_ubyte), # [o] byte count actually written to sbp ('host_status', ctypes.c_ushort), # [o] errors from host adapter ('driver_status', ctypes.c_ushort), # [o] errors from software driver ('resid', ctypes.c_int), # [o] dxfer_len - actual_transferred ('duration', ctypes.c_uint), # [o] time taken by cmd (unit: millisec) ('info', ctypes.c_uint)] # [o] auxiliary information</span></span></code> </pre><br>  Since the filling of these structures is required before each disk operation and takes up a lot of space, this operation is moved to a separate function.  In multibyte values, you need to swap the byte order. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareSgio</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cmd, feature, count, lba, direction, sense, buf)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> direction == SG_DXFER_FROM_DEV: buf_len = ctypes.sizeof(buf) buf_p = ctypes.cast(buf, ctypes.c_void_p) prot = <span class="hljs-number"><span class="hljs-number">4</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-comment"><span class="hljs-comment"># PIO Data-In elif direction == SG_DXFER_TO_DEV: buf_len = ctypes.sizeof(buf) buf_p = ctypes.cast(buf, ctypes.c_void_p) prot = 5 &lt;&lt; 1 # PIO Data-Out else: buf_len = 0 buf_p = None prot = 3 &lt;&lt; 1 # Non-data if cmd != 0xb0: # not SMART COMMAND prot = prot | 1 # + EXTEND sector_lba = lba.to_bytes(6, byteorder='little') ata_cmd = ataCmd(opcode=0x85, # ATA PASS-THROUGH (16) protocol=prot, # flags field # OFF_LINE = 0 (0 seconds offline) # CK_COND = 1 (copy sense data in response) # T_DIR = 1 (transfer from the ATA device) # BYT_BLOK = 1 (length is in blocks, not bytes) # T_LENGTH = 2 (transfer length in the SECTOR_COUNT field) flags=0x2e, features=swap16(feature), sector_count=swap16(count), lba_h_low=sector_lba[3], lba_low=sector_lba[0], lba_h_mid=sector_lba[4], lba_mid=sector_lba[1], lba_h_high=sector_lba[5], lba_high=sector_lba[2], device=0, command=cmd, control=0) sgio = sgioHdr(interface_id=ASCII_S, dxfer_direction=direction, cmd_len=ctypes.sizeof(ata_cmd), mx_sb_len=ctypes.sizeof(sense), iovec_count=0, dxfer_len=buf_len, dxferp=buf_p, cmdp=ctypes.addressof(ata_cmd), sbp=ctypes.cast(sense, ctypes.c_void_p), timeout=1000, flags=0, pack_id=0, usr_ptr=None, status=0, masked_status=0, msg_status=0, sb_len_wr=0, host_status=0, driver_status=0, resid=0, duration=0, info=0) return sgio</span></span></code> </pre><br>  This function accepts ata command, parameters, and buffers, and returns a ready-made structure for the ioctl request.  Then everything is simple.  Create a buffer in which the command execution status and the contents of the ata status and error registers are returned.  Create a buffer for a sector read from disk.  We fill the structures and execute our first ata command. <br><br><pre> <code class="python hljs">sense = ctypes.c_buffer(<span class="hljs-number"><span class="hljs-number">64</span></span>) identify = ctypes.c_buffer(<span class="hljs-number"><span class="hljs-number">512</span></span>) sgio = prepareSgio(<span class="hljs-number"><span class="hljs-number">0xec</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, SG_DXFER_FROM_DEV, sense, identify) <span class="hljs-comment"><span class="hljs-comment"># IDENTIFY with open(dev, 'r') as fd: if fcntl.ioctl(fd, SG_IO, ctypes.addressof(sgio)) != 0: return None # fcntl failed!</span></span></code> </pre><br>  In response, we get a sector with information about the disk: <br><br><pre> <code class="dos hljs"><span class="hljs-number"><span class="hljs-number">0000000</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>a04 ff3f <span class="hljs-number"><span class="hljs-number">37</span></span>c8 <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>f00 <span class="hljs-number"><span class="hljs-number">0000</span></span> Z..?<span class="hljs-number"><span class="hljs-number">7</span></span>.......?... <span class="hljs-number"><span class="hljs-number">0000010</span></span>: <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">2020</span></span> <span class="hljs-number"><span class="hljs-number">2020</span></span> <span class="hljs-number"><span class="hljs-number">2020</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>b4a <span class="hljs-number"><span class="hljs-number">3131</span></span> <span class="hljs-number"><span class="hljs-number">3142</span></span> .... KJ111B <span class="hljs-number"><span class="hljs-number">0000020</span></span>: <span class="hljs-number"><span class="hljs-number">3942</span></span> <span class="hljs-number"><span class="hljs-number">5647</span></span> <span class="hljs-number"><span class="hljs-number">4142</span></span> <span class="hljs-number"><span class="hljs-number">4659</span></span> <span class="hljs-number"><span class="hljs-number">0300</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>fea <span class="hljs-number"><span class="hljs-number">3800</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>b4a <span class="hljs-number"><span class="hljs-number">9</span></span>BVGABFY.._.<span class="hljs-number"><span class="hljs-number">8</span></span>.KJ <span class="hljs-number"><span class="hljs-number">0000030</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>f41 <span class="hljs-number"><span class="hljs-number">3341</span></span> <span class="hljs-number"><span class="hljs-number">4145</span></span> <span class="hljs-number"><span class="hljs-number">6948</span></span> <span class="hljs-number"><span class="hljs-number">6174</span></span> <span class="hljs-number"><span class="hljs-number">6863</span></span> <span class="hljs-number"><span class="hljs-number">2069</span></span> <span class="hljs-number"><span class="hljs-number">5548</span></span> OA3AAEiHathc iUH <span class="hljs-number"><span class="hljs-number">0000040</span></span>: <span class="hljs-number"><span class="hljs-number">3741</span></span> <span class="hljs-number"><span class="hljs-number">3232</span></span> <span class="hljs-number"><span class="hljs-number">3230</span></span> <span class="hljs-number"><span class="hljs-number">4130</span></span> <span class="hljs-number"><span class="hljs-number">414</span></span>c <span class="hljs-number"><span class="hljs-number">3333</span></span> <span class="hljs-number"><span class="hljs-number">2030</span></span> <span class="hljs-number"><span class="hljs-number">2020</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>A2220A0AL33 <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0000050</span></span>: <span class="hljs-number"><span class="hljs-number">2020</span></span> <span class="hljs-number"><span class="hljs-number">2020</span></span> <span class="hljs-number"><span class="hljs-number">2020</span></span> <span class="hljs-number"><span class="hljs-number">2020</span></span> <span class="hljs-number"><span class="hljs-number">2020</span></span> <span class="hljs-number"><span class="hljs-number">2020</span></span> <span class="hljs-number"><span class="hljs-number">2020</span></span> <span class="hljs-number"><span class="hljs-number">1080</span></span> .. <span class="hljs-number"><span class="hljs-number">0000060</span></span>: <span class="hljs-number"><span class="hljs-number">0040</span></span> <span class="hljs-number"><span class="hljs-number">002</span></span>f <span class="hljs-number"><span class="hljs-number">0040</span></span> <span class="hljs-number"><span class="hljs-number">0002</span></span> <span class="hljs-number"><span class="hljs-number">0002</span></span> <span class="hljs-number"><span class="hljs-number">0700</span></span> ff3f <span class="hljs-number"><span class="hljs-number">1000</span></span> .@./.@.......?.. <span class="hljs-number"><span class="hljs-number">0000070</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>f00 <span class="hljs-number"><span class="hljs-number">10</span></span>fc fb00 <span class="hljs-number"><span class="hljs-number">0001</span></span> ffff ff0f <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0700</span></span> ?............... <span class="hljs-number"><span class="hljs-number">0000080</span></span>: <span class="hljs-number"><span class="hljs-number">0300</span></span> <span class="hljs-number"><span class="hljs-number">7800</span></span> <span class="hljs-number"><span class="hljs-number">7800</span></span> <span class="hljs-number"><span class="hljs-number">7800</span></span> <span class="hljs-number"><span class="hljs-number">7800</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> ..xxxx...... <span class="hljs-number"><span class="hljs-number">0000090</span></span>: <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>f00 <span class="hljs-number"><span class="hljs-number">0617</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>e00 <span class="hljs-number"><span class="hljs-number">4400</span></span> ............^.D. <span class="hljs-number"><span class="hljs-number">00000</span></span>a0: fc01 <span class="hljs-number"><span class="hljs-number">2900</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>b34 <span class="hljs-number"><span class="hljs-number">697</span></span>d <span class="hljs-number"><span class="hljs-number">7347</span></span> <span class="hljs-number"><span class="hljs-number">6934</span></span> <span class="hljs-number"><span class="hljs-number">41</span></span>bc <span class="hljs-number"><span class="hljs-number">6347</span></span> ..).k4i}sGi4A.cG <span class="hljs-number"><span class="hljs-number">00000</span></span>b0: <span class="hljs-number"><span class="hljs-number">7</span></span>f40 <span class="hljs-number"><span class="hljs-number">0401</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> feff <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0800</span></span> .@.............. <span class="hljs-number"><span class="hljs-number">00000</span></span>c0: ca00 f900 <span class="hljs-number"><span class="hljs-number">1027</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> b088 e0e8 <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> .....'.......... <span class="hljs-number"><span class="hljs-number">00000</span></span>d0: ca00 <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">875</span></span>a <span class="hljs-number"><span class="hljs-number">0050</span></span> a2cc cb22 <span class="hljs-number"><span class="hljs-number">44</span></span>fc .......ZP.."D. <span class="hljs-number"><span class="hljs-number">00000</span></span>e0: <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">1440</span></span> ...............@ <span class="hljs-number"><span class="hljs-number">00000</span></span>f0: <span class="hljs-number"><span class="hljs-number">1440</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> .@.............. <span class="hljs-number"><span class="hljs-number">0000100</span></span>: <span class="hljs-number"><span class="hljs-number">0100</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>b00 <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">8020</span></span> f10d <span class="hljs-number"><span class="hljs-number">20</span></span>fa <span class="hljs-number"><span class="hljs-number">0100</span></span> ......... .. ... <span class="hljs-number"><span class="hljs-number">0000110</span></span>: <span class="hljs-number"><span class="hljs-number">0040</span></span> <span class="hljs-number"><span class="hljs-number">0404</span></span> <span class="hljs-number"><span class="hljs-number">0403</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0502</span></span> <span class="hljs-number"><span class="hljs-number">0604</span></span> <span class="hljs-number"><span class="hljs-number">0504</span></span> .@.............. <span class="hljs-number"><span class="hljs-number">0000120</span></span>: <span class="hljs-number"><span class="hljs-number">0506</span></span> <span class="hljs-number"><span class="hljs-number">0803</span></span> <span class="hljs-number"><span class="hljs-number">0506</span></span> <span class="hljs-number"><span class="hljs-number">0504</span></span> <span class="hljs-number"><span class="hljs-number">0505</span></span> <span class="hljs-number"><span class="hljs-number">0603</span></span> <span class="hljs-number"><span class="hljs-number">0505</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> ................ <span class="hljs-number"><span class="hljs-number">0000130</span></span>: <span class="hljs-number"><span class="hljs-number">3741</span></span> <span class="hljs-number"><span class="hljs-number">3342</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>a78 <span class="hljs-number"><span class="hljs-number">0000</span></span> bd5d d3a1 <span class="hljs-number"><span class="hljs-number">0080</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>A3B...x...].... <span class="hljs-number"><span class="hljs-number">0000140</span></span>: <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> ................ <span class="hljs-number"><span class="hljs-number">0000150</span></span>: <span class="hljs-number"><span class="hljs-number">0200</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> ................ <span class="hljs-number"><span class="hljs-number">0000160</span></span>: <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> ................ <span class="hljs-number"><span class="hljs-number">0000170</span></span>: <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> ................ <span class="hljs-number"><span class="hljs-number">0000180</span></span>: <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> ................ <span class="hljs-number"><span class="hljs-number">0000190</span></span>: <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>d00 <span class="hljs-number"><span class="hljs-number">0000</span></span> ............=... <span class="hljs-number"><span class="hljs-number">00001</span></span>a0: <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> ................ <span class="hljs-number"><span class="hljs-number">00001</span></span>b0: <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">201</span></span>c <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>f10 <span class="hljs-number"><span class="hljs-number">2100</span></span> .. ...........!. <span class="hljs-number"><span class="hljs-number">00001</span></span>c0: <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> ................ <span class="hljs-number"><span class="hljs-number">00001</span></span>d0: <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0100</span></span> e003 <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> ................ <span class="hljs-number"><span class="hljs-number">00001</span></span>e0: <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> ................ <span class="hljs-number"><span class="hljs-number">00001</span></span>f0: <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> a503 ................</code> </pre><br>  It contains complete information about the disk, we extract the main one. <br><br><pre> <code class="python hljs"> serial = swapString(identify[<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span>]) firmware = swapString(identify[<span class="hljs-number"><span class="hljs-number">46</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>]) model = swapString(identify[<span class="hljs-number"><span class="hljs-number">54</span></span>:<span class="hljs-number"><span class="hljs-number">93</span></span>]) sectors = int.from_bytes(identify[<span class="hljs-number"><span class="hljs-number">200</span></span>] + identify[<span class="hljs-number"><span class="hljs-number">201</span></span>] + identify[<span class="hljs-number"><span class="hljs-number">202</span></span>] + identify[<span class="hljs-number"><span class="hljs-number">203</span></span>] + identify[<span class="hljs-number"><span class="hljs-number">204</span></span>] + identify[<span class="hljs-number"><span class="hljs-number">205</span></span>] + identify[<span class="hljs-number"><span class="hljs-number">206</span></span>] + identify[<span class="hljs-number"><span class="hljs-number">207</span></span>], byteorder=<span class="hljs-string"><span class="hljs-string">'little'</span></span>)</code> </pre><br>  The result is: <br><br>  Model: Hitachi HUA722020ALA330;  firmware: JKAOA3;  serial number: JK11A1YAJE2N5V;  number of sectors: 3907029168. <br><br>  Now we can send ata commands to the disk and receive answers from it.  Slowly, the result of my work took shape in a library containing the implementation of the main set of ata commands, including reading SMART.  Anyone interested can look at it <a href="https://github.com/kazenniy/sgio">here</a> .  Do not scold the quality of the code, I'm not <s>a</s> programmer <s>wizard</s> , I'm just learning. <br><br>  It now remains with its help to write a testing utility.  Feel me waiting for many more discoveries. <br><br>  Upd: <br>  As recommended by <a href="https://habrahabr.ru/users/amarao/" class="user_link">amarao,</a> I rewrote the library using classes and exceptions.  I also decided that the name sgio is misleading about the purpose of the library.  The library is now called atapt and is available on <a href="https://github.com/kazenniy/atapt">GitHub</a> and via pip.  There is an example of using a githaba. </div><p>Source: <a href="https://habr.com/ru/post/274195/">https://habr.com/ru/post/274195/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../274185/index.html">Diagnosing and fixing memory leaks in TypeScript applications</a></li>
<li><a href="../274187/index.html">Development Environment: Redmine + Git + ownCloud</a></li>
<li><a href="../274189/index.html">Does your site have problems with Google?</a></li>
<li><a href="../274191/index.html">New Year's check .NET Core Libraries (CoreFX)</a></li>
<li><a href="../274193/index.html">Draw together. Portrait of user IE 8 full face</a></li>
<li><a href="../274197/index.html">Computational chemistry is a modern way to obtain the necessary chemical compounds from IBM</a></li>
<li><a href="../274203/index.html">The quickest start with Angular 2 (beta) and Dart</a></li>
<li><a href="../274205/index.html">Data Festival at the Moscow Museum, as it were</a></li>
<li><a href="../274207/index.html">Manage Vscale Servers via Ansible</a></li>
<li><a href="../274209/index.html">Domain sharding: Ruby on Rails implementation and results</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>