<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Asterisk from easy to hard</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Good day. Writing an article led me to the need to transfer my knowledge to my subordinates, who already had time to delve into the wor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Asterisk from easy to hard</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  Good day.  Writing an article led me to the need to transfer my knowledge to my subordinates, who already had time to delve into the work of Asterisk. <br>  When I noticed an interest in the platform from their side, I was extremely happy, but I was perplexed when all the zeal stopped at the clacking on trixbox and its like. <br><br>  I have nothing against add-ons to Asterisk, which make life easier, but I am afraid that a generation of Asterisk administrators soon appeared, who did not see the console live in the future. <br><br>  The goal of my articles is to show that the asterisk is beautiful in itself, without additional add-ons, which is possible using minimal scripting languages ‚Äã‚Äãthat speed up the work - to work wonders.  I want to show people who are looking for and wanting to learn new things, the nuances and subtleties of the system. <br><a name="habracut"></a><br><h4>  What is Asterisk? </h4><br>  About the asterisk there are many articles describing the functionality and features.  A beginner needs to know the most important thing - at the initial stage (as a training), the Asterisk is able to perform any tasks related to telephony, or almost all. <br>  There are a number of inconveniences or limitations that are inherent in working with Asterisk, we will try to eliminate them in the process of familiarization with the system. <br>  You should also understand that it is extremely difficult to build a high-load system on an asterisk - there are other solutions for this. <br>  For simplicity, we can assume that the asterisk is advisable to use in systems where the number of simultaneous calls does not exceed 100. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Start from here </h4><br>  Honestly looking through the 10 pages of the Asterisk search query results on a habr, I realized that I had to start all over again, but without fanaticism.  I will not talk about the installation, but we will talk about the structure of the Asterisk and what we need when working.  We will talk about Asterisk 1.8, but the principles work on all versions of the asterisk. <br><br><h4>  System structure </h4><br>  Asterisk, like any application, works on the basis of configuration files, of which there are quite a lot.  Honestly, I still do not know the role of half of the configs.  For our initial work, we need to know and understand the settings stored in the sip.conf and extensions.conf files.  I note that with a standard installation all configs files are stored in / etc / asterisk /. <br><br><h5>  Sip.conf file </h5><br>  This file contains a description of the basic parameters of the SIP protocol, setting up NAT, codecs, and most importantly - accounts.  Later I will talk about how to store accounts in the database. <br><br>  The default sip.conf config allows you to run Asterisk, provided that you are prescribed accounts, and it will work while listening to incoming connections on all interfaces. <br><br>  Accounts in sip.conf can be of three types: <br>  - user (user) <br>  - peer <br>  - friend (user + peer) <br><br>  I almost always set up accounts as a friend, for the reason that it combines all the functions of both a peer and a user. <br><br>  A simple example of an account looks like this: <br><br>  [1001];  the name of the feast, we will use it in the future, to work with the rules of calls,; matching with the login is optional <br>  type = friend;  account type <br>  host = dynamic;  we allow login from different IP addresses <br>  username = 1001;  Username <br>  secret = 1234;  password <br>  context = default;  context about it later <br>  disallow = all;  ban all codecs <br>  allow = alaw;  allow G.711a codec (alaw) <br><br>  Such a record is enough to register on a fresh server with user parameters 1001 and password 1234. <br><br>  Create two entries with the names 1001 and 1002 at the very bottom of the sip.conf file. <br><br><h5>  File extensions.conf </h5><br>  This file is a key file in the Asterisk system, since it describes the rules for working with any voice traffic that has appeared in the system.  This is like a static routing table.  On the storage of data in the database will talk later. <br><br>  The file structure is quite simple: <br>  - global parameters are written inside the file, including variables <br>  - further, the file is divided into contexts, each of which lives its own life and the rules for the operation of calls within each context can be different. <br><br>  Contexts are needed to distinguish between the behavior of a telephone call and the separation of some user groups and their calls from others.  Contexts allow to create multiple subsystems with their own rules and users (analogue of virtual machines) within the same system. <br><br>  Contexts are denoted as [CONTEXT NAME]. <br>  The context structure is as follows: <br><br>  exten =&gt; MASK, ORDER, ACTION <br>  where <br>  MASK - number mask, or statically specified number <br>  ORDER - order of action for a specific MASK (a sequence of actions is possible) <br>  ACTION - a command executed by the system in case of a call to this rule. <br><br>  Our test users are created in the default context, so if you just launch an asterisk and call any number, you can hear the Asterisk test demo menu. <br><br>  We open for editing extensiond.conf, do a search on [default] and in the next one after the line [default] we boldly enter the local call rule: <br><br>  Static rule: <br>  exten =&gt; 1001,1, Dial (SIP / 1001) <br>  exten =&gt; 1002.1, Dial (SIP / 1002) <br><br>  Dynamic rule: <br>  exten =&gt; _XXXX, 1, Dial (SIP / $ {EXTEN});  here X says that any number will be dialed, about methods;  making masks (extensions) - later. <br><br>  These rules will allow you to make a local call between test users. <br><br><h4>  Finally: Work with the server console </h4><br>  The server is started with the asterisk command from under the root, or / usr / sbin / asterisk. <br>  To enter the console, enter asterisk -r from under the root, or / usr / sbin / asterisk -r (hereafter, for convenience, we will use asterisk, meaning that we are talking about working with the server executable file). <br><br>  In order for Asterisk to re-read configs from the console, it is enough to reload. <br><br><h5>  homework </h5><br>  1. Make a local call. <br>  2. Get acquainted with configuration examples that are in sip.conf and extensions.conf <br>  3.Add to bookmarks <a href="http://www.voip-info.org/wiki/view/Asterisk">www.voip-info.org/wiki/view/Asterisk</a> <br><br>  Thanks for attention. <br><br>  Thank you so much for the feedback and comments. <br>  I want to note that the article is designed for people who are starting to study Asterisk and is aimed at making their lives easier.  In the future, I want to take into account all the comments, and make and write new articles according to the wishes, while maintaining the general line of development from simple things to complex ones. <br>  It is nice to receive criticism, I will try, and in case of inaccuracies to correct. <br>  Thank. </div><p>Source: <a href="https://habr.com/ru/post/122898/">https://habr.com/ru/post/122898/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../122891/index.html">Dive into 3D with the Marmalade SDK</a></li>
<li><a href="../122893/index.html">‚ÄúStartup without a budget‚Äù: uncomfortable about business, but interesting</a></li>
<li><a href="../122894/index.html">Registration for the 6th All-Russian Meeting of Sysadmins has opened</a></li>
<li><a href="../122895/index.html">HTC Evo 3D will be available in Europe and Russia</a></li>
<li><a href="../122896/index.html">Droider Chart 58. Hit parade of Android applications</a></li>
<li><a href="../122899/index.html">How do you feel about parsing sites without the permission of their owners?</a></li>
<li><a href="../122903/index.html">Which payment system do you use most often?</a></li>
<li><a href="../122905/index.html">Preparations for the launch of Levenhuk-1 (part 1)</a></li>
<li><a href="../122909/index.html">We storm DjangoDash</a></li>
<li><a href="../122910/index.html">About character design for websites and interfaces</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>