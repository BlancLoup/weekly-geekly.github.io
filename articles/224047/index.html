<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ansible under Windows with crutches, props and integration with Vagrant</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It so happened that on our project Ansible is now used. I will not dwell on what Ansible is, how to prepare it and what to use it with, and also on wh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ansible under Windows with crutches, props and integration with Vagrant</h1><div class="post__text post__text-html js-mediator-article">  It so happened that on our project Ansible is now used.  I will not dwell on what Ansible is, how to prepare it and what to use it with, and also on why it is used (for this is not the best choice for operating conditions under Microsoft OS) I suggest to consider in the context of this post it is a given.  It is also not a secret for anyone that a lot of web developers work under Windows for various reasons.  The reluctance to fight Linux, lack of money for poppy, tanchiki after work, corporate policy - there could also be reasons for the car.  And about them in this post, too, will not be a word. <br><br>  If the circumstances are such that you need to use Ansible under Windows (which, in principle, is not so stressful, although it is not described anywhere else properly) and, good, integrate this business with Vagrant under Windows - I ask for cat. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I will begin, perhaps, with the warning.  If you choose Provisioner to automate the deployment of project infrastructure and as a master you want to use your workstation on Windows and only it - better not use Ansible.  Here is what is written <a href="http://docs.ansible.com/intro_installation.html">in his installation documentation</a> : ‚ÄúCurrently Ansible can be run (installed) (installed).‚Äù  Everything described below is a system of crutches and supports in case of emergency.  And if, however, an extreme case has come or you are not looking for easy ways, let's go. <br><br><h4>  Installation </h4><br>  In general, there is nothing surprising.  If the subject does not support Windows out of the box, but normally works only under * nix - you can try to set up a small * nix in Windows using Cygwin.  Moreover, you can google already ready instructions on how to raise Ansible under Cygwin, but I managed to do it, I think, simpler and cleaner than, for example, the <a href="https://servercheck.in/blog/running-ansible-within-windows">author of this instruction</a> . <br><br>  Looking ahead, I‚Äôll say that for me it was the first experience with Cygwin (I myself have been on Linux for a long time, this instruction as a whole - an attempt to let the team work with a tool that was rashly chosen without a discount on Windows) and installing packages there a thing not quite obvious to me.  I had to google it: it turns out that to install a package, you need to find it in the list, click on this icon <img src="https://habrastorage.org/getpro/habr/post_images/91e/dcc/b5d/91edccb5d9e57ae3e64ef873e2d4186c.png">  - then its status will change;  To add or remove packages, you need to run the installer and go the same way as during the initial installation. <br><br>  Another note.  If you are from Belarus, use the mirror of Beltelecom (http://ftp.mgts.by/pub/cygwin) - by experience, this is the only way to install everything quickly.  To do this, enter the specified address in the field under the list of mirrors and click Add, then select it in the list. <br><br>  When installing Cygwin, select the following packages: <br><ul><li>  binutils (from devel) </li><li>  libuuid-devel (from libs) </li><li>  python (from Python) </li><li>  python-crypto (from Python) </li><li>  python-setuptools (from Python) </li></ul><br>  Optionally - gcc-core from Devel, then some Python modules will be assembled from source code in C, otherwise it will be left to be satisfied with the Python implementation. <br><br>  What explains this set?  It is normal to put Ansible only through the Python package pip manager, and it does not work without libuuid-devel, at least on the x86_64 version of Cygwin.  binutils allows pip to use the cygwin implementation of libuuid.  The rest, I think, is understandable - for Ansible himself. <br><br>  Immediately after installing Cygwin, I recommend explaining to him where your home directory is.  By default, it will use some sort of its own folder;  using a user folder in this capacity seems to me somewhat more understandable and transparent;  In addition, it solves some problems that occur when starting from under Cygwin Vagrant - without additional shaman passes, it will constantly re-create the virtual machine. <br>  This can be done with the following command executed in Cygwin: <br> <code>mkpasswd -l -c -p "$(cygpath -H)" &gt; /etc/passwd</code> <br> <br>  With strapping finished.  Now Ansible itself.  Everything is unexpected just a couple of teams in Cygwin - and you're done: <br><ul><li> <code>easy_install pip</code> </li> <li> <code>pip install ansible==1.5.3</code> </li> </ul><br><br>  Why 1.5.3, ask?  This is the latest version at the moment, working under Windows and not having some annoying bugs. <br><br>  In addition, you need to explain to Ansible that you do not need to use an ssh feature like ControlMaster (it does not work under Windows).  Its essence is as follows: ssh establishes a connection with the host, creates a socket and does not kill it for some configurable time.  The next time he connects, if possible, he uses this socket (already established connection) in order not to reinstall it and Ansible works without the overhead of setting up the connection for each task.  This can be done through the environment variable: <code>ANSIBLE_SSH_ARGS=-o ControlMaster=no</code> or via the Ansible config, indicated in the <code>[ssh_connection]</code> section of the <code>ssh_args = -o ControlMaster=no</code> option.  On stackoverflow you can find <a href="http://stackoverflow.com/questions/20959792/is-ssh-control-master-with-cygwin-on-windows-actually-possible">some information on this topic</a> . <br><br>  In general, that's all.  After that, from Cygwin you can use the <code>ansible-playbook</code> as in * nix. <br><br><h4>  Ansible with Vagrant: Atmosphere </h4><br>  In theory, <a href="http://docs.vagrantup.com/v2/provisioning/ansible.html">Vagrant integrates with Ansible</a> nicely and transparently.  But not under Windows.  When you first try to run vagrant provision with Ansible as a Provisioner for Windows, you will get some kind of intricate error.  The reason is quite simple: Ansible will only work under Cygwin.  I did not manage to find an easy way to force vagrant to call it.  It would seem that the trouble is great: to build a batch file called ansible-playbook.bat, which will launch the already real ansible-playbook in Cygwin, put it in <code>%Path%</code> so that Vagrant gets on it - just something!  But it was not there. <br><br>  Vagrant under Windows is the same system of crutches and supports with its bash and collection of * nix utilities.  Accordingly, simply writing <code>bash</code> will not work: Vagrant will dilute the <code>%Path%</code> path to its directory with * nix-utilities (by the way, GitBash is the same sinner), and we need Cygwin and its utilities. <br><br>  As a result, through trial, error and prolonged suffering, <a href="https://gist.github.com/kamazee/77371a41625bbaf3ec0c">this batch</a> was born.  It may be disgusting, but I didn‚Äôt have any knowledge of Windows scripting, so I was blind from what was, following the methodology of StackOverflow Driven Development. <br>  Also in the process it turned out that this is the best place to set the environment variable <code>ANSIBLE_SSH_ARGS</code> mentioned above.  It is inconvenient to set it in the config, because Ansible doesn‚Äôt merge the configs, but takes the first one found - respectively, either you don‚Äôt manage to use the Ansible config in the context of the project, or you have to set this parameter for everyone, even for those who don‚Äôt need it (and turn off <code>ControlMaster</code> greatly slows down the delivery).  It could also be specified in the Vagrant file, but then without additional bouncing it would not have been possible to use the ansible-playbook without Vagrant. <br><br>  This .bat assumes that the Cygwin bin is added to <code>%Path%</code> (no matter which part), and the path to the batch file itself is added to <code>%Path%</code> before the Cygwin bin. <br><br>  As a result, all of the above described was literally put in quite a few brief instructions in the steps of the project deployment and was more or less successfully tested on the new developers who came to the project at various levels. </div><p>Source: <a href="https://habr.com/ru/post/224047/">https://habr.com/ru/post/224047/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../224031/index.html">Derby 0.6 - FAQ</a></li>
<li><a href="../224033/index.html">Useful materials for mobile developer # 54 (May 19-25)</a></li>
<li><a href="../224039/index.html">New perspective gesture interface</a></li>
<li><a href="../224043/index.html">Tylt Energi 2K: AC adapter + spare battery</a></li>
<li><a href="../224045/index.html">NASA hands over control of the ISEE-3 satellite to the hands of space enthusiasts</a></li>
<li><a href="../224053/index.html">Autodocumentation of mobile web services on the example of Yii</a></li>
<li><a href="../224055/index.html">Active noise reduction of the shutter sound in the camera of the mobile device</a></li>
<li><a href="../224057/index.html">Open Terminal Client OTC-110 - works with Citrix</a></li>
<li><a href="../224063/index.html">Hacking the D-Link DSP-W215 Smart Plug: Again, Again, Again</a></li>
<li><a href="../224065/index.html">Python-digest # 28. News, interesting projects, articles and interviews [May 19, 2014 - May 25, 2014]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>