<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Performance comparison of various encryption systems for linux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will try to compare the performance of various encryption systems under linux. In theory, of course, it is known which system is mor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Performance comparison of various encryption systems for linux</h1><div class="post__text post__text-html js-mediator-article">  In this article I will try to compare the performance of various encryption systems under linux.  In theory, of course, it is known which system is more productive, and attempts to calculate the performance of different systems were ( <a href="http://habrahabr.ru/post/57884/">for example</a> ).  Truecrypt even contains a built-in benchmark (which shows, however, performance on RAM, it can only be used to estimate the speed of different encryption algorithms).  I will do something different - I measure the speed of the file system, encrypted using different means, as a percentage of the usual unencrypted file system. <br><img src="https://habrastorage.org/getpro/habr/post_images/8d4/dba/271/8d4dba271fb9372ea4a4232214cf2bf1.jpg" alt="image"><br><a name="habracut"></a><br>  We will encrypt a separate partition on a separate HDD, which does not contain the root file system, by the algorithm used by default in each specific case.  As a regular user, I don‚Äôt understand the nuances of encryption standards (for example, how does the RIPEMD-160 hashing from Whirpool differ, which of these modes is faster, and which contributes to higher protection), so we just rely on the fact that the manufacturers of each software product chose sufficiently robust default options.  Maybe this is not entirely correct, because the performance of different encryption algorithms is not the same.  If you wish, of course, you can change the type of encryption, but I'm not sure that there is an absolutely identical set of algorithms in all tested products.  We will test: <br><br>  1) <a href="http://en.wikipedia.org/wiki/LUKS">LUKS</a> is a native encryption system, in theory it should be the fastest.  LUKS encrypted volumes can be used on Windows via FreeOTFE. <br><br>  2) <a href="http://en.wikipedia.org/wiki/Truecrypt">Truecrypt</a> - unlike LUKS, it has, in addition to the console, a GUI interface, which makes it much easier to use.  Multiplatform software.  Providing two levels of plausible denial of the presence of encrypted data, necessary in case of a forced opening of the password by the user.  Truecrypt volumes do not have a header; they cannot be distinguished from a set of random data.  In theory, slower than LUKS, because  uses <a href="http://en.wikipedia.org/wiki/Filesystem_in_Userspace">FUSE.</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      3) <a href="http://en.wikipedia.org/wiki/Ecryptfs">eCryptfs</a> is the default system offered by Ubuntu users to encrypt home directories, and therefore is included in this test.  Works on top of an existing FS.  Encrypts each file separately, so everyone can see the rights, modification dates, the number of encrypted files;  by default, file names are also visible, although there is an option to encrypt them.  The least functional tool from the presented. <br><br>  4) <a href="http://en.wikipedia.org/wiki/EncFS">EncFS</a> is an approximate analogue of eCryptfs, but uses FUSE. <br><br>  So, for tests, a separate old age machine is allocated in the following configuration: CPU - Intel Celeron 2000Mhz, RAM - 512 Mb DDR PC2700, system HDD - WD Caviar SE 5400 RPM 80Gb, test HDD - WD Caviar SE 7200 RPM 80Gb. <br>  OS - Ubuntu 12.04 LTS, versions of all software relevant to the repositories of this OS at the time of this writing (Truecrypt 7.1a-linux-x86 is not from the repositories). <br><br>  We will test the default ext4 file system for most distributions.  For performance testing, we will use the <a href="http://www.iozone.org/">iozone3</a> utility and a shell script written ‚Äúon the knee‚Äù to measure the percentage difference in tests. <br><div class="spoiler">  <b class="spoiler_title">Script for counting.</b>  <b class="spoiler_title">Special attention was paid to the purity of the code, the only criterion for writing was the presence of the correct result.</b> <div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh gendifffile () { #  ,   . -,  #   ; -,       ,  #     ; -,     - #      cat $1 | while read LINE ; do echo $LINE| grep "^[[:space:]]*[[:digit:]]" | awk '{for (i=3;i&lt;=NF;i++) {print $i}}' done &gt;&gt; $2 } getline () { #    $2  $1 head -n $2 "$1" | tail -n 1 } compare () { #    $1  $2,       #    ,       #,    , ,    P=0 MAX=0 L1=`cat "$1" | wc -l` #    L2=`cat "$2" | wc -l` if [ $L1 -ne $L2 ]; then #     ,       echo error return fi STEP=$(( $L1*5/100 )) J=0 for I in `seq 1 $L1`; do J=$(( $J+1 )) if [ $J -eq $STEP ]; then J=0 echo "$(( 100*$I/$L1 ))%  ($I  $L1)" fi A=`getline "$1" $I` B=`getline "$2" $I` if [ `echo $A \&gt; $B|bc -l` -eq 1 ]; then D=`echo "100-($B*100/$A)"|bc -l` if [ `echo $D \&gt; $MAX| bc -l` -eq "1" ]; then MAX=$D sleep 5 fi else D=`echo "100-($A*100/$B)"|bc -l` if [ `echo $D \&gt; $MAX| bc -l` -eq "1" ]; then MAX=$D sleep 5 fi D="-$D" #    "-", ,      #  ,     fi P=`echo "$P+$D"| bc -l` done P=`echo $P/$L1| bc -l` #   echo PERCENT=$P MAX_PERCENT=$MAX } genaverage () { #     ,     #      ,     AVG=`mktemp` F=`ls "$1"|wc -l` #       # ,           #       if [ ! -d "$1" -o $F -lt 2 ]; then echo error &gt;/dev/stderr #        stderr, .. #stdout     rm -f $AVG exit fi TMP=`mktemp` find "$1" -type f| while read FILE; do #    iozone,     I=`mktemp` #  ,    gendifffile "$FILE" "$I" #      "TMP"  echo "$I"&gt;&gt;$TMP done L=`cat \`getline "$TMP" 1\`|wc -l` cat "$TMP"| while read LINE; do #    L1=`cat "$LINE"| wc -l` #       if [ $L -ne $L1 ]; then echo error &gt;/dev/stderr exit fi done STEP=$(( $L*5/100 )) J=0 for I in `seq 1 $L`; do J=$(( $J+1 )) if [ $J -eq $STEP ]; then J=0 echo "$(( 100*$I/$L ))%  ($I  $L)" &gt;/dev/stderr fi SUMFILE=`mktemp` #      SUM    SUM=0 cat "$TMP"| while read LINE; do SUM=$(( `getline "$LINE" $I`+$SUM )) echo $SUM &gt; "$SUMFILE" done echo `tail -n 1 "$SUMFILE"`/$F|bc -l &gt;&gt; $AVG #   #      # AVG rm -f "$SUMFILE" done cat "$TMP"| while read LINE; do # e  rm -f "$LINE" done rm -f "$TMP" echo $AVG } printf %b "\\033[1;31m 1/3\n" printf %b "\\033[1;37m" echo      \""$1"\" A=`genaverage "$1"` printf %b "\\033[1;31m 2/3\n" printf %b "\\033[1;37m" echo      \""$2"\" B=`genaverage "$2"` printf %b "\\033[1;31m 3/3\n" printf %b "\\033[1;37m" echo    compare "$A" "$B" rm -f $A $B</span></span></code> </pre> </div></div><br>  Under the spoiler, I will tell you more about the testing algorithm, so that everyone can conduct the test that interests him. <br><div class="spoiler">  <b class="spoiler_title">testing algorithm</b> <div class="spoiler_text">  1) we connect the tested <i>unencrypted</i> partition to the mount point, go to it, run the iozone test series <br><pre> <code class="bash hljs">i=0 <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> i=$(( <span class="hljs-variable"><span class="hljs-variable">$i</span></span>+1 )) <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> i=<span class="hljs-variable"><span class="hljs-variable">$i</span></span> time iozone -a &gt;report<span class="hljs-variable"><span class="hljs-variable">$i</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> sleeping 180 sleep 180 <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre><br>  We run as many laps as we don‚Äôt mind.  The larger the number, the more accurate the result.  For some types of dough (for the slowest), a large number of circles does not matter, enough is 5. <br>  Add the results to a separate directory, let's call it, for example, unencrypted. <br>  2) encrypt the partition, connect to the mount point, similarly run a series of tests, add the results to another directory (for example, encrypted). <br>  3) run the counting script, passing it the names of both directories as parameters.  The script will display a certain number, by what percentage, on average, the difference in performance between the reports of the first and second directories.  If the number is&gt; 0, then the reports of the first directory are faster by this number of percent;  and vice versa, if the number is &lt;0, it means slower. <br></div></div><br>  We rely on the -a mode, in which iozone should automatically perform a series of tests that cover all sorts of operations with files of different sizes and different recording lengths (my version produced 1638 tests). <br>  During the experiment, it turned out that one series of iozone tests may differ by 5% in performance, so I will not rely on the results of a single test suite and do this: conduct a test suite several times and generate a file with averaged values ‚Äã‚Äãfor each from tests (in all calculations of this article, averaged values ‚Äã‚Äãare the arithmetic mean value).  After that, I compare the average file containing a series of tests on an unencrypted file system with a similar file containing a series of tests on an encrypted filesystem in this way: each test of the first file will be compared with the corresponding test of the second in percentage, the results will be added, and the amount divided by the number of tests By obtaining the arithmetic mean value, by how many percent the first group of tests is faster or slower than the second. <br>  Also, for a simple estimate of speed, in addition to the above calculations, we will conduct a simple test - copying dd 500 megabytes from urandom to an encrypted filesystem with blocks equal to the default ext4 cluster size (4 kilobytes).  dd if = / dev / urandom of = testfile bs = 4k count = 128000.  The entire section will be encrypted (except for eCryptfs, which is not able to do this).  I will not give commands for each case, I will show only the results. <br>  So let's get started: <br><br>  1) Encryption system: no <br>  Number of test runs: 14 <br>  Average performance difference between the same test series: 1.3% <br>  Result dd: 524288000 bytes (524 MB) copied, 187.823 s, 2.8 MB / s <br><br>  2) Encryption system: LUKS.  Using the default keys, our volume will be encrypted like this: <br>  Cipher name: aes <br>  Cipher mode: cbc-essiv: sha256 <br>  Hash spec: sha1 <br>  Number of test runs: 8 <br>  Average performance difference between the same test series: 1.4% <br>  Result dd: 524288000 bytes (524 MB) copied, 199.505 s, 2.6 MB / s <br>  Decline in performance compared to unencrypted FS: <b>7.9%</b> <br><br>  3) Encryption system: Truecrypt.  Using all the default parameters, the volume will be encrypted with AES with the RIPEMD-160 hash algorithm. <br>  Number of test runs: 22 <br>  Average performance difference between the same test series: 3.2% <br>  Result dd: 524288000 bytes (524 MB) copied, 199.719 s, 2.6 MB / s <br>  Performance drop compared to unencrypted FS: <b>7%</b> <br><br>  4) Encryption system: eCryptfs <br>  aes: blocksize = 16;  keysize = 16 <br>  Number of test runs: 9 <br>  Average performance difference between the same test series: 0.9% <br>  Dd result: 524288000 bytes (524 MB) copied, 199.624 s, 2.6 MB / s <br>  Performance drop compared to unencrypted FS: <b>49.5%</b> <br><br>  5) Encryption system: EncFS <br>  Applying the preset <i>paranoia</i> mode, the following settings will be used: <br>  Cipher: AES <br>  Key Size: 256 bits <br>  PBKDF2 with 3 second runtime, 160 bit salt <br>  Filesystem Block Size: 1024 bytes <br>  Filename Encoding: Block encoding with IV chaining <br>  Unique initialization vector file headers <br>  Message Authentication Code block headers <br>  External IV Chaining <br>  Number of test runs: 5 <br>  Average performance difference between the same test series: 0.7% <br>  Result dd: 524288000 bytes (524 MB) copied, 293.656 s, 1.8 MB / s <br>  Performance drop compared to unencrypted FS: <b>94.5%</b> <br><br>  Bottom line: EncFS showed the worst result.  The performance of eCryptfs for all sorts of file operations leaves much to be desired, although the usual dd test with the optimal block size shows a speed similar to other encryption systems.  I wouldn't cipher my entire home directory.  It is convenient to use only when encrypting individual subdirectories.  The expectations of lower Truecrypt performance due to the use of FUSE did not materialize, in my case it turned out to be even slightly faster than LUKS. <br><br>  In addition, as a bonus, I will give a similar test dd for Truecrypt and LUKS, but for the file-hosted container (all encryption parameters are similar). <br>  1) LUKS <br>  524288000 bytes (524 MB) copied, 207.07 s, 2.5 MB / s <br>  2) Truecrypt <br>  524288000 bytes (524 MB) copied, 205.046 s, 2.6 MB / s <br>  The drop in performance can be explained by the fact that there are additional overhead costs for reading the container file from an already existing file system instead of directly accessing the partition. <br><br>  PS Added EncFS. <br>  PPS Added a detailed description of the testing algorithm. </div><p>Source: <a href="https://habr.com/ru/post/201694/">https://habr.com/ru/post/201694/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../201680/index.html">Automatic quest generator</a></li>
<li><a href="../201682/index.html">Once again about obfuscation javascript or tale about how i obfuscator wrote. Part 1</a></li>
<li><a href="../201686/index.html">Vanilla JS vs jQuery 2.0</a></li>
<li><a href="../201688/index.html">Autorun Yandex.Disk as systemd service in Fedora 19</a></li>
<li><a href="../201692/index.html">Postmorthem: how to manage to make 14 mistakes, having developed one social game</a></li>
<li><a href="../201696/index.html">Anonymous chat TorChat and its improvement</a></li>
<li><a href="../201698/index.html">Scalable NAS</a></li>
<li><a href="../201700/index.html">API Development for the SolidWorks 2012 Software Package. Part 1</a></li>
<li><a href="../201702/index.html">How-to: robots and brokerage trading system APIs</a></li>
<li><a href="../201704/index.html">Android - iOS - Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>