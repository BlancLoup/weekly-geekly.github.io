<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Perfect - REST server on Swift</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Most iOS developers sooner or later become crowded in the world of iOS SDK. And the reason, by no means, is that IOS does not have enough opportunitie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Perfect - REST server on Swift</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/3da/287/98a/3da28798a3384c6eaed56f9fe8aa82d7.jpg" alt="image"><br>  Most iOS developers sooner or later become crowded in the world of iOS SDK.  And the reason, by no means, is that IOS does not have enough opportunities for serious development, but the fact that most modern serious applications have a client-server architecture, but only the client world is available to iOS developers.  Server development is left to server <s>reindeer</s> programmers, who are very jealous of the requirements of mobile developers to change something in the API.  It does not add optimism to the fact that to implement the simplest API, one has to learn another programming language, with its own paradigms and nuances.  Even in order to run around some pilot idea, one has to either attract people from the outside, or plunge into the world of alien dreams (PHP, Pyton, Ruby, C #).  Is it all so bad in the Objectove-C / Swift?  It turned out not at all.  A little googling for server development, I came across a rather curious undertaking claiming to become a real cross-platform solution ‚Äî that is, it works equally well in OSX and * nix systems (I don‚Äôt talk about Windows, there # hardly anyone moves - too many goodies). <br><br>  Perfect - as the creators of the project say - The ideal web server and toolkit for developers using Swift programming language to create applications and other REST services.  It is clear that ‚ÄúIdeal‚Äù is nothing more than a play on words, but at the same time, after getting acquainted with the proposed solution, you begin to incline to the fact that there is some truth in this statement. <br><br>  In the "press" ran through the article that on the way a new programming language, which can become an industry standard with easy filing Apple.  A language that is based on the Swift being promoted to the masses.  As a rule, articles about this caused more questions, and even more irritation for those who are tired of retraining everything (Swift itself is changing quite quickly).  However, delving into the study of the issue, it becomes clear that everything is much better than it seems. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Perfect is not a new language, server development.  Perfect is a server environment that allows you to create REST API services using Swift's latest implementation exclusively (at the time of writing Swift 2.2) There is nothing beyond the scope of what client developers have to do daily. <br><a name="habracut"></a><br><br>  What we will do: Create a business card page (blank) to show it when accessing the server.  Let us demonstrate the ability to easily create REST API services that will respond to GET / POST requests.  Let us demonstrate the mechanism of dynamic formation of static pages on the site.  Moreover, we will do all this on Swift. <br><br><div class="spoiler">  <b class="spoiler_title">Mono</b> <div class="spoiler_text">  Mono lovers can say that a cross-platform server development tool has been around for a long time, and it‚Äôs hard to disagree if one essential ‚ÄúBUT‚Äù is for someone who is familiar with the server part of C # /. Net programming in Mono turns into pain and tears causing disgust. <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Disclaimer</b> <div class="spoiler_text">  Evangelicals HATEOAS and HAL may pass by.  There will be a mention of REST in the form that mobile developers are used to.  The purity of such a REST can be questioned, but that will not stop it being one.  There is no need to arrange holivars about whether an African elephant can be considered an elephant, or only Indian elephants can be considered an elephant. <br></div></div><br><br>  So, the starting point of the trip will be the creation of the appropriate environment.  Unfortunately, the way to go is not so obvious, and is associated with a number of very strange manipulations - from creating a Workspace to changing schemes in Xcode.  Step-by-step tutorial is shown in the video prepared by the authors of the project.  Describing each step in the article is rather a topic for the ‚Äútranslations‚Äù hub.  I would like to focus on the practical application of the Perfect features, which are missing in the commercials, or are presented there in a <s>monstrous</s> mysterious way.  By the way, some videos published by the authors are more <b>harmful</b> than useful. <br><br><div class="spoiler">  <b class="spoiler_title">HelloPerfect</b> <div class="spoiler_text">  <a href="https://www.youtube.com/watch%3Fv%3DLNU6L2pnq0k">How to setup an Xcode Workspace (HelloPerfect Part 1)</a> <br>  <a href="https://www.youtube.com/watch%3Fv%3DrYV9M64pPv8">How to host your first web application with a custom route (Hello Perfect Part 2)</a> <br></div></div><br><br>  For a start, let's understand the concepts.  Perfect consists of two parts: the Server Library (PerfectLib), and the launching application with a minimalist interface (Perfect Server).  Both applications are open source, and theoretically, you can edit / add to your needs.  However, I strictly do not recommend you do this.  Personally, I constantly have attempts to improve something.  But it should be noted that Perfect is not adapted for use with Swift 3. And the language creators declare that Swift 3 will not have top-down support, which means that after the release of the third version of the language, Perfect is guaranteed to be updated, and you will have to completely get rid of the changes already made, in order to go to the new version of Swift. <br><br>  If you have not yet reached the ‚ÄúHello Perfect!‚Äù Stage - it's time to do it, download the environment you need <a href="">here</a> .  (Some of the links on the project site are broken) <br><br>  Next, create the index.html and template.html files, and then add them to our working draft.  After adding, let's go to Build Phases and add the step ‚ÄúNew Copy Files Phase‚Äù <br><br><img src="https://habrastorage.org/files/78e/673/0af/78e6730afde9411084ea11072a5cb72e.jpg" alt="image"><br><br>  Ultimately, the window should look like this: <br><br><img src="https://habrastorage.org/files/2e4/ece/591/2e4ece5917e04526b47d8749087c6f30.jpg" alt="image"><br><br><div class="spoiler">  <b class="spoiler_title">Source code index.html</b> <div class="spoiler_text"><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HTML</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HEAD</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TITLE</span></span></span><span class="hljs-tag">&gt;</span></span>My company name.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TITLE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HEAD</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BODY</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BGCOLOR</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FFFFFF"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CENTER</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">IMG</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SRC</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.telemis.com/sites/default/files/Cloud-Plain-Blue_2.png"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"300px"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CENTER</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HR</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://demonsoft.net"</span></span></span><span class="hljs-tag">&gt;</span></span>My name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> is a link to another nifty site <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">H1</span></span></span><span class="hljs-tag">&gt;</span></span>This is a Header<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">H1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">H2</span></span></span><span class="hljs-tag">&gt;</span></span>This is a Medium Header<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">H2</span></span></span><span class="hljs-tag">&gt;</span></span> Send me mail at <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"mailto:support@yourcompany.com"</span></span></span><span class="hljs-tag">&gt;</span></span> mail@gmail.com<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span>. <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P</span></span></span><span class="hljs-tag">&gt;</span></span> This is a new paragraph! <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">B</span></span></span><span class="hljs-tag">&gt;</span></span>This is a new paragraph!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">B</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">B</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">I</span></span></span><span class="hljs-tag">&gt;</span></span>This is a new sentence without a paragraph break, in bold italics.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">I</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">B</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HR</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BODY</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HTML</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Source code template.html</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HTML</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HEAD</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TITLE</span></span></span><span class="hljs-tag">&gt;</span></span>{{TITLE}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TITLE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HEAD</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BODY</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">border</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>{{TITLE}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">border</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">align</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"left"</span></span></span><span class="hljs-tag">&gt;</span></span>{{BODY}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">border</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">align</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"right"</span></span></span><span class="hljs-tag">&gt;</span></span>{{FOOTER}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BODY</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HTML</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><br>  For the most part, all of these actions are reviewed in a video from the project page: <a href="https://www.youtube.com/watch%3Fv%3DJ441eJ40PH4">www.youtube.com/watch?v=J441eJ40PH4</a> However, the considered case allows you to either host Web pages or use the REST API.  We will try to combine both needs into one opportunity. <br><br>  Completely replace the PerfectServerModuleInit code with the code below: <br><div class="spoiler">  <b class="spoiler_title">PerfectServerModuleInit</b> <div class="spoiler_text"> <code>public func PerfectServerModuleInit() <br> { <br> Routing.Handler.registerGlobally() <br> <br> // Root index.html page <br> Routing.Routes["*"] = { (_:WebResponse) in StaticFileHandler() } <br> <br> // Request for static pages <br> Routing.Routes["GET", ["/index", "/list"]] = { (_:WebResponse) in return StaticPageHandler(staticPage: "index.html") } <br> <br> // REST <br> Routing.Routes["GET", ["/hello"]] = { (_:WebResponse) in return HelloHandler() } <br> Routing.Routes["GET", ["/help"]] = { (_:WebResponse) in return HelpHandler() } <br> Routing.Routes["GET", ["/cars", "/car"]] = { (_:WebResponse) in return CarsJson() } <br> <br> <br> Routing.Routes["POST", ["/list"]] = { (_:WebResponse) in return CarsJson() } <br> } <br></code> <br></div></div><br>  The call to the PerfectServerModuleInit method is present in the server project (in my case MySwiftServer), but is not tied to any class.  I rendered it into a separate .swift file. <br>  PerfectServerModuleInit is the entry point to our Web service.  It is similar to the main function.  Method Called by the server library.  Later I will explain what is happening here. <br><br>  Now you need to add some more classes. <br><br><div class="spoiler">  <b class="spoiler_title">HelloHandler class</b> <div class="spoiler_text"> <code>import Foundation <br> import PerfectLib <br> <br> class HelloHandler:RequestHandler <br> { <br> func handleRequest(request: WebRequest, response: WebResponse) <br> { <br> response.appendBodyString("Hello World!\n") <br> response.appendBodyString("Hello Perfect!\n") <br> response.appendBodyString("Hello Swift Server!\n") <br> response.requestCompletedCallback() <br> } <br> } <br></code> <br></div></div><br>  The HelloHandler class does nothing useful and is mainly used to check that the server is up and running.  You can see that the server‚Äôs response comes down to adding a line to the output buffer, and calling back the client (browser or client application). <br><br><div class="spoiler">  <b class="spoiler_title">Class StaticPageHandler</b> <div class="spoiler_text"> <code>import Foundation <br> import PerfectLib <br> <br> class StaticPageHandler:RequestHandler <br> { <br> var staticPage = "index.html" <br> <br> internal init(staticPage:String) { <br> self.staticPage = staticPage <br> } <br> <br> func handleRequest(request: WebRequest, response: WebResponse) <br> { <br> let file = ContentPage().page(request.documentRoot, pageFile: self.staticPage) <br> <br> response.appendBodyString(file) <br> response.requestCompletedCallback() <br> } <br> } <br></code> <br></div></div><br>  The StaticPageHandler class allows you to host static pages with the specified names.  ‚ÄúDefault‚Äù will use index.html, but, in principle, it can be any other page added to the project. <br><br><div class="spoiler">  <b class="spoiler_title">Class HelpHandler</b> <div class="spoiler_text"> <code>import Foundation <br> import PerfectLib <br> <br> class HelpHandler:RequestHandler <br> { <br> func handleRequest(request: WebRequest, response: WebResponse) <br> { <br> let list = Routing.Routes.description.stringByReplacingString("+h", withString: "") <br> let html = ContentPage(title:"HELP", body:list).page(request.documentRoot) <br> response.appendBodyString("\(html)") <br> response.requestCompletedCallback() <br> } <br> } <br></code> <br></div></div><br>  The HelpHandler class allows you to get a list of commands processed by the server.  Some other server environments (for example, MS Framework 4.5.1) provide an autodocumented REST API server.  This is very convenient for developers of mobile applications - do not have to tugging server developers for the maintenance / addition of commands. <br>  <b>Update:</b> <a href="https://habrahabr.ru/post/283432/">In the following article, we improved the API documentation mechanism.</a> <br><br><div class="spoiler">  <b class="spoiler_title">CarsJson class</b> <div class="spoiler_text"> <code>import Foundation <br> import PerfectLib <br> <br> class CarsJson:RequestHandler <br> { <br> func handleRequest(request: WebRequest, response: WebResponse) <br> { <br> let car1:[JSONKey: AnyObject] = ["Wheel":4, "Color":"Black"] <br> let car2:[JSONKey: AnyObject] = ["Wheel":3, "Color":["mixColor":0xf2f2f2]] <br> let cars = [car1, car2] <br> let restResponse = RESTResponse(data:cars) <br> response.appendBodyBytes(restResponse.array) <br> response.requestCompletedCallback() <br> } <br> } <br></code> <br></div></div><br>  The CarsJson class demonstrates how GET / POST requests work with a complex structure of returned data.  The returned data is represented by an AnyObject object. <br><br><div class="spoiler">  <b class="spoiler_title">ContentPage class</b> <div class="spoiler_text"> <code>import Foundation <br> <br> public class ContentPage:NSObject <br> { <br> private var title = "" <br> private var body = "" <br> private var footer = "" <br> <br> public init(title:String="", body:String="", footer:String="Copyright (C) 2016 _MY_COMPANY_NAME_. All rights reserved.") <br> { <br> self.title = title <br> self.body = body <br> self.footer = footer <br> } <br> <br> func page(webRoot:String, pageFile:String="template.html") -&gt; String <br> { <br> let template = self.loadIndexHtml(webRoot, pageFile:pageFile) <br> let htmlBody = self.body.stringByReplacingString("\n", withString: " <br> ") <br> <br> var page = template <br> page = page.stringByReplacingString("{{TITLE}}", withString: self.title) <br> page = page.stringByReplacingString("{{BODY}}", withString: htmlBody) <br> page = page.stringByReplacingString("{{FOOTER}}", withString: self.footer) <br> <br> return page <br> } <br> <br> private func loadIndexHtml(webRoot:String, pageFile:String) -&gt; String { <br> <br> let fileManager = NSFileManager.defaultManager() <br> let directory = fileManager.currentDirectoryPath <br> let path = directory + "/\(webRoot)/\(pageFile)" <br> do { <br> return try String(contentsOfFile: path) <br> } catch { <br> print("File didn't create") <br> } <br> <br> return "404 NOT FOUND" <br> } <br> } <br></code> <br></div></div><br>  A service class that returns a static page and makes a replacement in the appropriate fields.  By default, the template is used template.html, but in principle, any other template added to the project can be used. <br><br><div class="spoiler">  <b class="spoiler_title">Class RESTResponse</b> <div class="spoiler_text"> <code>import Foundation <br> import PerfectLib <br> <br> public class RESTResponse <br> { <br> <br> public var data:AnyObject = "" // Data from Server to Client <br> public var status = "" // HTTP status or other code of operation. <br> public var message = "" // This message Client can show in the Alert View <br> public var errors = [String]() // All real errors for Console <br> <br> <br> public init(data:AnyObject="", status:String="200", message:String="", errors:[String]=[]) <br> { <br> self.data = data <br> self.status = status <br> self.message = message <br> self.errors = errors <br> } <br> <br> public var array: [UInt8] { <br> <br> let result = ["data":self.data, "status":self.status, "message":self.message, "errors":self.errors] <br> return serialization(result) <br> } <br> <br> private func serialization(object:AnyObject) -&gt; [UInt8] <br> { <br> do { <br> let jsonData = try NSJSONSerialization.dataWithJSONObject(object, options: NSJSONWritingOptions.PrettyPrinted) <br> let count = jsonData.length / sizeof(UInt8) <br> var jsonArray = [UInt8](count: count, repeatedValue: 0) <br> jsonData.getBytes(&amp;jsonArray, length:count * sizeof(UInt8)) <br> return jsonArray <br> <br> } catch let error as NSError { <br> print(error) <br> } <br> <br> return [UInt8]() <br> } <br> } <br></code> <br></div></div><br>  The RESTResponse class is a key class using the REST API and, most controversial. <br>  The returned data object has the following JSON wrapper structure: <br> <code>{ <br> ¬´data¬ª:{‚Ä¶. }, <br> ¬´errors¬ª:[‚Ä¶ ], <br> "message":"", <br> "status":200 <br> } <br></code> <br><br>  1) Some developers categorically do not accept this format.  But I didn‚Äôt see any convincing arguments against this format of returned data.  But, there are certain advantages in a typed format.  The ‚Äústatus‚Äù field according to historical tradition has the value ‚Äú200‚Äù in case of successful operation.  But, it is not directly related to HTTP responses.  They can always be subtracted from the request headers, and there they are transferred to the client side by the server environment itself.  In the ‚Äústatus‚Äù field you can transfer the meaning of meaning within the business logic of a web service, and not the HTTP layer.  The ‚Äúmessage‚Äù field contains the string that the user needs to demonstrate to notify any actions on the server side.  For example, information about the session expiration, especially when from the point of view of the client application, everything is going well.  The ‚Äúerrors‚Äù: [] field is an array of a term that notifies the client of any abnormal situations.  It is useful to save and process this information on the client side or send it to a specialized log server for further processing.  Finally, the ‚Äúdata‚Äù field: {....  } contains a complex data structure - exactly what is expected to be obtained on the client side.  The main advantage of this approach is that if the server‚Äôs response does not satisfy the given scheme, it can be rejected by the client with a clear conscience.  You can read about how to organize it here: <a href="https://habrahabr.ru/post/283012/">habrahabr.ru/post/283012</a> Those developers who are opposed to the described approach can easily modify the property ‚Äúarray‚Äù so that the raw data is returned without the described wrapper. <br><br>  2) I was somewhat taken aback by the approach that Perfect developers suggested using to return a JSON object.  In the proposed tutorial, each JSON object was supposed to be formed by successively building a tree by listing key / value pairs of the form [JSONKey: JSONValue] (which is equivalent to [String: AnyObject]).  It is supposed to use the following code: <br><br> <code>public var json: String <br> { <br> let result = ["data":self.data, "status":self.status, "message":self.message, "errors":self.errors] <br> <br> let jsonEncoder = JSONEncoder() <br> do { <br> let respString = try jsonEncoder.encode(result) <br> return respString <br> } catch let error as NSError { <br> print(error) <br> } <br> return "" <br> } <br> ‚Ä¶.. <br> response.appendBodyString(self.json) <br> response.requestCompletedCallback() <br> <br></code> <br>  However, this code is completely inoperative, even with the data that is now contained in the CarsJson class.  In addition, if you follow the logic of the tutorial of the creators of Perfect, for each returned object you will have to write your class to encode complex structures.  In the variant proposed by me, quite obviously, it is possible to serialize an object of any nesting degree with several lines of code.  This will not be difficult to see after starting the service. <br><br>  <b>Run!</b> <br><br>  If everything is done correctly, we will get the following page in the browser: <br><img src="https://habrastorage.org/files/2ad/bd2/a20/2adbd2a201f04e428ae5ea44bb5736e6.jpg" alt="image"><br><br>  Greetings to the server: enter in the browser / hello line <br><img src="https://habrastorage.org/files/20c/b49/4c6/20cb494c61a1414686e264c524c2938d.jpg" alt="image"><br><br>  Ask the server for information about the commands being executed: <br><img src="https://habrastorage.org/files/ee0/ca3/fc2/ee0ca3fc2e5b48528e1a6a96eba31273.jpg" alt="image"><br><br>  Please note that all commands are divided into categories - GET, POST.  If you use other predicates, they will also appear in this list. <br>  However, the / list command is simultaneously present in both lists.  It was she who added PerfectServerModuleInit to the GET and POST command, but (!) Has different handlers! <br>  If you access / list from the browser‚Äôs command line, an index page will be displayed. <br><img src="https://habrastorage.org/files/31b/d7d/904/31bd7d9044d44141843b6407aeac45b4.jpg" alt="image"><br><br>  But if you use a special application (for example, a free Postman), then in the body of the Post request we will have the expected JSON: <br><img src="https://habrastorage.org/files/ef1/2a1/abc/ef12a1abc88f44e38bf029b2a18b8c67.jpg" alt="image"><br><br>  Please note that JSON is fully consistent with the structure that was formed in the CarsJson class. <br><br>  But what will happen if you remove the / list command from the GET list? <br> <code>Routing.Routes["GET", ["/index", "/list"]] = { (_:WebResponse) in return StaticPageHandler(staticPage: "index.html") } <br></code> <br>  We get: <br><img src="https://habrastorage.org/files/90f/0f4/ad7/90f0f4ad785a4ae2a90e6b627f217c21.jpg" alt="image"><br><br>  In this simple way, substituting the start page, or any stub page, you can easily disguise the use of any REST command. As a rule, if this is not a service with an open API, at the end of the development, commands of the / help type are deleted or blocked.  But you can use this opportunity in another way: display information with details on the GET request with the command, forcing the static page handler to work. <br><br>  It is completely expected that the / car and / cars commands will return the same structure but in the form of a web page. <br><img src="https://habrastorage.org/files/5e4/e9c/360/5e4e9c3602154a85980dc68b5f356213.jpg" alt="image"><br><br>  With a certain skill, creating a REST API will be as easy as creating a ViewController with the necessary navigation. <br><br>  Extreme fans can try running it all on Linux. <br><br>  <b>UPDATE:</b> <br>  An explanation appeared on why such a mysterious serialization of JSON responses was used in the tutorial - all NS methods (including NSJSONSerialization) stop working on Ubuntu. </div><p>Source: <a href="https://habr.com/ru/post/283260/">https://habr.com/ru/post/283260/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../283250/index.html">Sale of PHDays VI tickets closes.</a></li>
<li><a href="../283252/index.html">Lossless data compression algorithms: what they say about markets</a></li>
<li><a href="../283254/index.html">9 secrets of online payments. Part 6: one click payment</a></li>
<li><a href="../283256/index.html">Trend Analysis in Mobile Broadband Access (MBB)</a></li>
<li><a href="../283258/index.html">[Peter] Meeting about OpenOnload: high-performance network stack for Linux</a></li>
<li><a href="../283262/index.html">Paul Graham, ‚ÄúHackers and Artists,‚Äù Chapter 5: The Other Road Ahead, continued</a></li>
<li><a href="../283264/index.html">Search for the spine line in photos of book spreads</a></li>
<li><a href="../283270/index.html">Analysis of the tasks of the first qualifying round of the RCC 2016</a></li>
<li><a href="../283274/index.html">There are no hares under Android - the history of creation</a></li>
<li><a href="../283276/index.html">Veeam Backup & Replication: workaround for one problem with backup job metadata</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>