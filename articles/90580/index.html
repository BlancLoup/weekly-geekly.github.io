<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A few words about the size of structures in C / C ++ and why this happened</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Below in the text, the term ‚Äúplatform‚Äù will call any given set of processor, compiler and operating system under which the compiled code will run. 

 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A few words about the size of structures in C / C ++ and why this happened</h1><div class="post__text post__text-html js-mediator-article">  Below in the text, the term ‚Äúplatform‚Äù will call any given set of processor, compiler and operating system under which the compiled code will run. <br><br>  Historically, the C language was created such that among the main objectives underlying it are: <ul><li>  be as independent as possible from a particular platform, </li><li>  be as efficient as possible on all platforms.  Ideally, at all. </li></ul><br>  A little bit about the variety of platforms.  There are a huge number of them (platforms) - there are 16-bit, 32-bit and 64-bit among the processors.  There are those who are able to perform floating-point operations at the hardware level, some support operations with double precision, and in some processors the FPU is completely absent.  Processors also differ in the internal order of the bytes in the word (big / little endian), how exactly the processor works with external memory, etc.  etc. <br><br>  And for this whole zoo there is one and only Standard of the C language. How was it possible?  This is where the fun begins. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  The C language has very few restrictions on what its base types should be (char, short, int, long, float, double).  Specifies the minimum number of bits for some types (for example, the type ‚Äúchar‚Äù must be at least 8 bits, ‚Äúint‚Äù / ‚Äúshort‚Äù - 16, ‚Äúlong‚Äù - 32), it is specified that the sizes of the basic types are multiples of the size of the char, and the size of the char itself is identically equal to one. <br><br>  And, for example: in MS-DOS programs, the size of the int and short is the same, and the types themselves were 16-bit.  For the Win32 platform, the size of the int has already become different - 32 bits. <br><br>  A bit of exotic: there are platforms (from Texas Instruments, for example), where the size of the basic types is very different from the ‚Äúusual‚Äù.  For example, the size of <i>all</i> base types is the same and equal to one.  Those.  sizeof (int) == sizeof (char) == sizeof (double).  Yes, that's right - both char and short on this platform are 32-bit.  The standard is not violated.  Or such a platform: the ‚Äúlong‚Äù type occupies 8 bytes in memory, but only 5 are actually used there.  sizeof (long) == 8, and ULONG_MAX = 1099511627775 or 2 <sup>40</sup> -1.  All this does not contradict the Standard, but at first it surprises. <br><br>  Another important moment from the ‚Äúiron world‚Äù, which had to be taken into account when developing the Standard, is how the processor works with memory.  If you don‚Äôt go into how the address bus, data bus and memory chips function, then for the overwhelming number of architectures there is the following rule: if we read / write an N-byte value in one command, then its address must be a multiple N. That is, if 4-byte int is written to the memory, the address should be completely divided by 4. Similarly for 2-byte short'ov, etc. <br><br>  What happens if this rule is not executed?  On different platforms - in different ways: on some (ARMs, for example), the processor is interrupted and control is transferred to the OS kernel, on others (DSP from TI), the processor will silently write to the nearest multiple address (i.e., not where they said, and <i>next</i> ), and on the x86 platform, the processor ( <i>for some types of data</i> ) will do as the programmer implies, due to some drop in performance.  It is important here to understand one thing - all processors work in the same way, when the address is equalized, and who is in that much - if this requirement is not met.  That is why the definition of alignment (alignment) is defined at the very beginning of the Standard and is constantly mentioned when describing the language memory model. <br><br>  What does all this lead from the programmer's point of view?  This is best shown by example.  Suppose we have such a structure: <blockquote> <code>struct Foo { <br> int iiii; <br> char c; <br> }; <br></code> <br></blockquote><br>  From the point of view of the programmer (inexperienced), the size of this structure is equal to sizeof (int) + sizeof (char) = 4 + 1 = 5 (we assume that the size of an int is 4 bytes).  However, what happens if you declare an array of several elements of this type?  In memory, they will be located as follows: <br><img src="http://i6.fastpic.ru/big/2010/0406/5b/1c6033a6808047b958247af13cedd85b.gif" alt="image"><br><br>  Or in words: the field iiii of the first element is located at the leveled address, and for the second element this is no longer true.  Those.  at the size of the structure Foo equal to 5, it is impossible to fulfill the requirements of memory model C. <br><br>  For the same, so that the sheep were intact, and the wolves are fed, the compiler inserts "invisible" (for the programmer) additional 3 bytes at the end of the structure (the so-called padding bytes).  This leads to the fact that the size of the structure becomes equal to 8 and in memory the array begins to be located as follows: <br><img src="http://i6.fastpic.ru/big/2010/0406/c7/e01760ce862d84ed3a857b87a4b64bc7.gif" alt="image"><br><br>  However, this is not all that the compiler does with this structure.  In addition to the fact that the size of Foo is 8, the compiler also remembers that the minimum alignment requirement for this entire structure is 4 bytes.  The differences are easy to show with the following example: <blockquote> <code>struct Foo { <br> int iiii; <br> char c; <br> }; <br> <br> struct Bar { <br> char c8[8]; <br> }; <br> <br> struct Test1 { <br> char c; <br> Foo foo; <br> }; <br> <br> struct Test2 { <br> char c; <br> Bar bar; <br> }; <br></code> </blockquote><br>  Here such moments are interesting: the size and Foo and Bar are the same and equal to 8 bytes.  But I align requirements for Foo - 4 bytes, and Bar - 1. This leads to the fact that in the structure of Test1, between 'c' and 'foo', the compiler inserts an additional 3 bytes to ensure that the field 'foo' will always be Begin at the address multiple of 4th.  In the structure of Test2, you do not need to do anything of this kind, as a result, sizeof (Test1) is 12, and sizeof (Test2) is 9. That is, we got a different result by combining the ‚Äúbricks‚Äù of the same size! <br><br><h6>  If this is all interesting, then the topic can be continued. </h6></div><p>Source: <a href="https://habr.com/ru/post/90580/">https://habr.com/ru/post/90580/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../90563/index.html">ANPR-Automated Number Plate Recognition (Automatic Number Recognition)</a></li>
<li><a href="../90566/index.html">TEDxKyiv 2010</a></li>
<li><a href="../90571/index.html">The story of an artificial virtual world</a></li>
<li><a href="../90576/index.html">Indication of a new Gmail message via Arduino</a></li>
<li><a href="../90577/index.html">Password Managers RoboForm and Kaspersky Password Manager</a></li>
<li><a href="../90583/index.html">Dropbox and document collaboration</a></li>
<li><a href="../90585/index.html">4 answers that will bring you money</a></li>
<li><a href="../90587/index.html">The combination of multi-touch and pen input</a></li>
<li><a href="../90590/index.html">Tank - your robot on the Arduino</a></li>
<li><a href="../90591/index.html">MOPSLinux will no longer be?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>