<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to cook hundreds of bases 1C and not go crazy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The button is not the most common accounting company, but we keep accounting in 1C, like most domestic colleagues. At the moment, hundreds of bases re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to cook hundreds of bases 1C and not go crazy</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://knopka.com/">The button</a> is not the most common accounting company, but we keep accounting in 1C, like most domestic colleagues.  At the moment, hundreds of bases reside on our server, so we had to learn how to administer all this wealth quickly and efficiently.  If you are an accounting company, a hoster with 1C service, or you just have a bunch of 1Sok from somewhere, you know how difficult it is.  We love to benefit, so we will share our experience, practical tips and insights that we managed to visit for countless nights, holidays and days off spent on updating and updating our entire farm. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/379/0b7/d8a/3790b7d8ab418be3f5b06c6f971cca2f.jpg"><br><br>  We do not sell 1C, and therefore the story will be without cuts, censorship, and most importantly - without a marketing bulshit.  Bonustrek, in the course of the post, you can find some useful scripts and tips for those who really have a lot of 1C bases. <br><a name="habracut"></a><br>  So why do we have so many bases at all?  In fact, right now we are exploring the technology of data sharing, but have not yet begun to use it, so for each business we serve, we are forced to create a separate database (and often not one). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Incredible way from cloud 1C to own server cluster </h4><br>  At the beginning of our journey, we used the cloud <nobr>1C-Frechet</nobr> : this service is moderately convenient, as far as it can be convenient to use the desktop application through a browser.  However, rather quickly we have accumulated fifty bases and it has become unbearable to administer them via the web - the <nobr>web interface</nobr> began to slow down, plus there was a need to programmatically integrate 1C with our internal tools, which Fresh is absolutely not able to do.  I had to migrate, unloading all the data from the cloud.  Fortunately, it was easy to do this (‚ÄúUpload data to the local version‚Äù ‚Üí ‚ÄúLoad data from the service‚Äù). <br><br>  The second important stage of evolution was the use of the <nobr>service provider</nobr> , and we, again, were satisfied with everything until the bases became more than a hundred.  Configuration updates, as well as publication with the addition of users, took place through a letter to technical support.  In principle, everything is operational, but not interactive. <br><br>  Special inconvenience was caused by the inability to start.  <nobr>exe-files</nobr> without prior approval (adding <nobr>hash sums</nobr> to the resolving domain policies), and we will remind you that integration was necessary.  There were also problems with the fact that, for unknown reasons, the storage provider of the provider incorrectly synchronized the nodes at the block level.  So we lost several important bases, which had to be long and painfully restored.  With storage systems, things are often difficult and dishonest. <br><br><blockquote>  Mistress note: test storage.  If you are a hoster, then pay more attention to this.  If you use a third-party hosting - be sure to check the storage and drives.  These are children's rakes, which are even harder to attack than adults :) </blockquote><br>  After all the adventures, we decided to migrate to your VPS.  The power of modern virtual servers allows you to safely keep a couple of hundred <nobr>1C-bases</nobr> , easily allowing them a couple of dozen accountants.  VPS providers are often not responsible for licensing software products that you run inside, so you need to take care of purchasing a license for users and purchasing configurations. <br><br><blockquote>  Hostess note: when licensing a large number of databases, surprises can wait for you - activating each database for each user through a software key can be your main job in the coming weeks.  The hardware key is deprived of this drawback, but you can't just take it and start using it in VPS. </blockquote><br>  Let's not forget that even the best VPS (selected using <a href="http://habrahabr.ru/company/poiskvps/blog/210722/">this cool service</a> ) cannot be compared with a warm and lamp own server.  We decided to migrate for the third time. <br><br><blockquote>  One evening, our VPS did not start.  There was the very peak of reporting - the last of her hours, and the server was down for an unreasonably long time.  At the same time, we could not do anything through the control panel - the server was in the launch stage, and technical support just waved its hands.  As it turned out, our virtual machine ran out of RAM on the host, and it simply was not enough to launch it. </blockquote><br><h6>  Total </h6>  Now, having hundreds of bases having gone from <nobr>1C-Farsh</nobr> , through pain, migrations, database inconsistency, technical support incompetence, problems with host synchronization of nodes, web publishing, exports, imports, backups and a lot of restorations, we came to our server cluster . <br><br>  What I would like to draw the attention of those who pass this way or are planning to take: <ul><li>  think about licenses; </li><li>  if you need integration - use a dedicated server or VPS; </li><li>  take care of the storage or carefully test it with your provider; </li><li>  backups are really important; </li><li>  Immediately give up <nobr>web access</nobr> if the load is serious and stability is important. </li></ul><br><h4>  How to simplify life if you are forced to work with a bunch of bases </h4><br><h6>  Creating a database with a link to it in the profile of the current user </h6>  We deploy all our databases from a pre-prepared template (with loaded treatments, reference books, customized ITS subscriptions and backups). <br><br>  For the file option: <br><pre><code class="hljs perl">CHCP <span class="hljs-number"><span class="hljs-number">1251</span></span> <span class="hljs-string"><span class="hljs-string">"%ProgramFiles(x86)%\1cv8\&lt;&gt;\bin\1cv8.exe"</span></span> createinfobase File=<span class="hljs-string"><span class="hljs-string">"X:\Base\habrahabr"</span></span> /AddInList <span class="hljs-string"><span class="hljs-string">" "</span></span> /UseTemplate <span class="hljs-string"><span class="hljs-string">"X:\tmplts\.cf"</span></span></code> </pre> <br>  For SQL option: <br><pre> <code class="hljs pgsql">CHCP <span class="hljs-number"><span class="hljs-number">1251</span></span> "%ProgramFiles(x86)%\1cv8\&lt;&gt;\bin\1cv8.exe" createinfobase Srvr="habr" <span class="hljs-keyword"><span class="hljs-keyword">Ref</span></span>="HabraBD" SQLSrvr="habr" SQLDB="HabraBD" SQLUID="sa" SQLPwd="123" /AddInList " " /UseTemplate "X:\tmplts\.cf"</code> </pre><br><h6>  How to create or delete a user immediately in a hundred databases? </h6>  User management has always been a sore point 1C.  In earlier editions, this required to get exclusive access to the database files, later added the ability to add on the fly, but only through the configurator, now (in the latest editions of bookkeeping or trading) you can create a user directly from the main mode of operation, through administrative tools.  But to do it with hands in the case of hundreds of databases is already unrealistic, so we learned how to add users programmatically.  <a href="http://en.wikipedia.org/wiki/Component_Object_Model">COM</a> comes to the rescue.  We establish an external connection V8.COMConnector and transfer to the database all the necessary information.  We add users with access rights, fill out directories or create documents.  <a href="https://mega.co.nz/">See how</a> . <br><br><h6>  How to connect the user immediately hundreds of databases? </h6>  To add all the necessary databases to the user list at once, we use the v8i <nobr>file-lists of the</nobr> common bases located on the file ball.  Links to these files are added in the user profile (for example, through GPO or <nobr>to the default</nobr> profile) in the% AppData% \ 1C \ 1CEStart \ 1CEStart.cfg file: <br><pre> <code class="hljs tex">CommonInfoBases=X:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Base</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">List</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Base</span></span></span></span>_a1.v8i CommonInfoBases=X:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Base</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">List</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Base</span></span></span></span>_a2.v8i CommonInfoBases=X:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Base</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">List</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Base</span></span></span></span>_a3.v8i</code> </pre><br>  Or from the 1C itself (already under the user) we add the list of common information databases: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/37d/e0f/abc/37de0fabcb9a624ca363e32396890cf3.png"><br><br>  Inside, the v8i files look like this: <br><pre> <code class="hljs pgsql">[ ] <span class="hljs-keyword"><span class="hljs-keyword">Connect</span></span>=File="X:\Base\Accounting\habrahabr"; ID= OrderInList=<span class="hljs-number"><span class="hljs-number">6062080</span></span> Folder=/ OrderInTree=<span class="hljs-number"><span class="hljs-number">6422528</span></span> <span class="hljs-keyword"><span class="hljs-keyword">External</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span> App=Auto WA=<span class="hljs-number"><span class="hljs-number">1</span></span> Version=<span class="hljs-number"><span class="hljs-number">8.3</span></span></code> </pre><br>  You can create them directly from the database selection window (‚ÄúSave link to file‚Äù) or take in the profile of the <nobr>user who created the</nobr> database -% AppData% \ <nobr>1 ¬∞ C</nobr> \ 1CEStart \ ibases.v8i.  The link can be to the database operating in any mode (file, server, web).  We recommend storing no more than one hundred databases in one file, otherwise the file may simply not load to the end :) <br><br><h6>  How to update a hundred databases at once? </h6>  It is better to update the databases on a separate server (or even better on two at once :) - this is faster and it is easier to manage the process.  We use typical configurations (without withdrawal from support), updated via ITS.  In the first quarter of this year, for ‚ÄúAccounting 3.0‚Äù more than 10 updates were released, roll them even into a dozen of databases manually - that‚Äôs fun.  Because we have developed some strategy. <br><br><blockquote>  Cool story: in the first reporting period of 2014, our favorite state bodies and 1C suddenly deprived us of sleep, releasing from March to April more than 10 updates just for the configuration of Bookkeeping 3.0!  Of course, we did not update everything, but even 3-4 updates for hundreds of bases in such a short period of time are a good test of strength. <br>  The reader may wonder where all this hassle is?  The answer is simple: changes in legislation and at the same time at the very last moment.  For example: from the beginning of 2014 there were no approved forms of the FSS and the FIU.  In one of the first <nobr>10-ki</nobr> updates added them, but only for delivery in paper form, but in the electron - no.  And it happens all the time. </blockquote><br><h6>  Lock </h6>  Through the interface: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4f4/da4/872/4f4da4872982de148f19793aa5d45a27.png"><br><br>  Or through the creation of a file in the base directory 1Cv8.cdn with the following contents: <br><pre> <code class="hljs objectivec">{<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">20140514173100</span></span>,<span class="hljs-number"><span class="hljs-number">00010101000000</span></span>,<span class="hljs-string"><span class="hljs-string">"   !  =)  :      ,       "</span></span><span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-string"><span class="hljs-string">"  : ENTERPRISE /F"</span></span><span class="hljs-string"><span class="hljs-string">"X:\Base\habrahabr"</span></span><span class="hljs-string"><span class="hljs-string">" /C /UC&lt; &gt;"</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>}</code> </pre><br><h6>  Update </h6>  For the file option: <br><pre> <code class="hljs pgsql">CHCP <span class="hljs-number"><span class="hljs-number">1251</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> cfu_file="X:\tmplts\1C\Accounting\3.0.32.7\1cv8.cfu" <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> base_dir="X:\update\habrahabr" "%ProgramFiles(x86)%\1cv8\&lt;&gt;\bin\1cv8s.exe" CONFIG /F %base_dir% /N"" /P"123" /UpdateCfg %cfu_file% /UpdateDBCfg /<span class="hljs-keyword"><span class="hljs-keyword">Out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">update</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span></code> </pre><br>  For SQL option: <br><pre> <code class="hljs pgsql">CHCP <span class="hljs-number"><span class="hljs-number">1251</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> cfu_file="X:\tmplts\1C\Accounting\3.0.32.7\1cv8.cfu" "%ProgramFiles(x86)%\1cv8\&lt;&gt;\bin\1cv8s.exe" CONFIG /S"habr\HabraBD" /N"" /P"123" /UpdateCfg %cfu_file% /UpdateDBCfg /<span class="hljs-keyword"><span class="hljs-keyword">Out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">update</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span></code> </pre><br><h6>  How to backup databases? </h6>  <i>If you use SQL, the next paragraph can be mercilessly skipped, it is relevant only for the file mode.</i> <br><br>  In our practice, we have repeatedly met the base in an inconsistent state.  Moreover, in the file version, there are no special tools to inform the database about the start of copying, there is no way to block work with it if it is running right now.  We coped with this in the following way: at midnight, the RDP server switched to the mode of prohibiting new connections, after a couple of hours all users gently drove out the script.  Then the routine update and backup worked. <br><br><h6>  Upload to dt </h6>  For the file option: <br><pre> <code class="hljs perl">CHCP <span class="hljs-number"><span class="hljs-number">1251</span></span> <span class="hljs-string"><span class="hljs-string">"%ProgramFiles(x86)%\1cv8\&lt;&gt;\bin\1cv8s.exe"</span></span> CONFIG /F <span class="hljs-string"><span class="hljs-string">"X:\Base\habrahabr"</span></span> /N<span class="hljs-string"><span class="hljs-string">""</span></span> /P<span class="hljs-string"><span class="hljs-string">"123"</span></span> /DumpIB <span class="hljs-string"><span class="hljs-string">"X:\Backup\DT\habrahabr.dt"</span></span></code> </pre><br>  For SQL option: <br><pre> <code class="hljs perl">CHCP <span class="hljs-number"><span class="hljs-number">1251</span></span> <span class="hljs-string"><span class="hljs-string">"%ProgramFiles(x86)%\1cv8\&lt;&gt;\bin\1cv8s.exe"</span></span> CONFIG /S<span class="hljs-string"><span class="hljs-string">"habr\HabraBD"</span></span> /N<span class="hljs-string"><span class="hljs-string">""</span></span> /P<span class="hljs-string"><span class="hljs-string">"123"</span></span> /DumpIB <span class="hljs-string"><span class="hljs-string">"X:\Backup\DT\habrahabr.dt"</span></span></code> </pre><br>  All the above is true for 1C Enterprise, platform 8.3;  Accounting 3.0;  Salary and Personnel Management 2.5. <br><br>  Next time we will talk about working in the data sharing mode for several hundred companies on one base.  We will be glad to hear questions, comments and suggestions.  And to all those who are faced with similar tasks - I would like to wish patience, perseverance and faith in victory. </div><p>Source: <a href="https://habr.com/ru/post/225027/">https://habr.com/ru/post/225027/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../225015/index.html">Experiments in the genre of match3, ‚ÄúHunger Games‚Äù from Kabam and updated HockeyApp - the main mobile news of the week</a></li>
<li><a href="../225017/index.html">Post inspiration: the best time to start your own business</a></li>
<li><a href="../225019/index.html">Creating audio plug-ins, part 2</a></li>
<li><a href="../225021/index.html">How to earn income from Google Play to the account of LLC</a></li>
<li><a href="../225025/index.html">Analysis of the tasks of the fourth qualifying round of the Russian Code Cup 2014</a></li>
<li><a href="../225031/index.html">Chasing the chairs</a></li>
<li><a href="../225033/index.html">x264 + VirtualDub vs XviD. Explore opportunities, increase efficiency</a></li>
<li><a href="../225035/index.html">How it works: data center "Berzarina"</a></li>
<li><a href="../225037/index.html">How much do brand owners spend on new domains?</a></li>
<li><a href="../225039/index.html">The organizers of the exchange of information will merge the intelligence services with all the data on user actions.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>