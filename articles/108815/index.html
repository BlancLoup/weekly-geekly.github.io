<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Release Version: debugging is just beginning ...</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What is it about? 
 Your program has finally earned, the customer confidently pokes buttons on the test site, everything is working properly ... but d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Release Version: debugging is just beginning ...</h1><div class="post__text post__text-html js-mediator-article"><h4>  What is it about? </h4><br>  Your program has finally earned, the customer confidently pokes buttons on the test site, everything is working properly ... but do not be in a hurry to rejoice: problems may lie in wait for you after the release version.  The software begins to roll with obscure bugs, the customer is ready to tear you to the British flag ... <br><br>  Do you think this is a problem only Si-Schnick?  You're wrong! <br><a name="habracut"></a><br><h4>  Practical example </h4><br>  Usually you are accustomed to the fact that you lay out a debug version on the test site (this, of course, does not apply to everyone, but believe me, this happens very often).  This saves time, and more debugging information, you can hook on remote debugging ... <br><br>  It would seem that the burden of releasing the release does not concern you very much, yet .NET is a little bit improved C ++ <a href="">in which there are certain problems</a> .  But everything is not as cloudless as it may seem at first. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, an example: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">static</font> <font color="#0000ff">void</font> Main( <font color="#0000ff">string</font> [] args) { System.Threading.Timer t = <font color="#0000ff">new</font> System.Threading.Timer(state =&gt; { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"Timer!"</font> ); GC.Collect(); }, <font color="#0000ff">null</font> , 0, 1000); <font color="#2B91AF">Console</font> .ReadKey(); }</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <ol><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Main( <font color="#0000ff">string</font> [] args) { System.Threading.Timer t = <font color="#0000ff">new</font> System.Threading.Timer(state =&gt; { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"Timer!"</font> ); GC.Collect(); }, <font color="#0000ff">null</font> , 0, 1000); <font color="#2B91AF">Console</font> .ReadKey(); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Main( <font color="#0000ff">string</font> [] args) { System.Threading.Timer t = <font color="#0000ff">new</font> System.Threading.Timer(state =&gt; { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"Timer!"</font> ); GC.Collect(); }, <font color="#0000ff">null</font> , 0, 1000); <font color="#2B91AF">Console</font> .ReadKey(); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Main( <font color="#0000ff">string</font> [] args) { System.Threading.Timer t = <font color="#0000ff">new</font> System.Threading.Timer(state =&gt; { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"Timer!"</font> ); GC.Collect(); }, <font color="#0000ff">null</font> , 0, 1000); <font color="#2B91AF">Console</font> .ReadKey(); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Main( <font color="#0000ff">string</font> [] args) { System.Threading.Timer t = <font color="#0000ff">new</font> System.Threading.Timer(state =&gt; { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"Timer!"</font> ); GC.Collect(); }, <font color="#0000ff">null</font> , 0, 1000); <font color="#2B91AF">Console</font> .ReadKey(); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Main( <font color="#0000ff">string</font> [] args) { System.Threading.Timer t = <font color="#0000ff">new</font> System.Threading.Timer(state =&gt; { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"Timer!"</font> ); GC.Collect(); }, <font color="#0000ff">null</font> , 0, 1000); <font color="#2B91AF">Console</font> .ReadKey(); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Main( <font color="#0000ff">string</font> [] args) { System.Threading.Timer t = <font color="#0000ff">new</font> System.Threading.Timer(state =&gt; { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"Timer!"</font> ); GC.Collect(); }, <font color="#0000ff">null</font> , 0, 1000); <font color="#2B91AF">Console</font> .ReadKey(); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Main( <font color="#0000ff">string</font> [] args) { System.Threading.Timer t = <font color="#0000ff">new</font> System.Threading.Timer(state =&gt; { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"Timer!"</font> ); GC.Collect(); }, <font color="#0000ff">null</font> , 0, 1000); <font color="#2B91AF">Console</font> .ReadKey(); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Main( <font color="#0000ff">string</font> [] args) { System.Threading.Timer t = <font color="#0000ff">new</font> System.Threading.Timer(state =&gt; { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"Timer!"</font> ); GC.Collect(); }, <font color="#0000ff">null</font> , 0, 1000); <font color="#2B91AF">Console</font> .ReadKey(); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Main( <font color="#0000ff">string</font> [] args) { System.Threading.Timer t = <font color="#0000ff">new</font> System.Threading.Timer(state =&gt; { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"Timer!"</font> ); GC.Collect(); }, <font color="#0000ff">null</font> , 0, 1000); <font color="#2B91AF">Console</font> .ReadKey(); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> </ol> <code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">static</font> <font color="#0000ff">void</font> Main( <font color="#0000ff">string</font> [] args) { System.Threading.Timer t = <font color="#0000ff">new</font> System.Threading.Timer(state =&gt; { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"Timer!"</font> ); GC.Collect(); }, <font color="#0000ff">null</font> , 0, 1000); <font color="#2B91AF">Console</font> .ReadKey(); }</font> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  The simplest code, which according to the author‚Äôs idea is to write the coveted ‚ÄúTimer!‚Äù To the console once a second.  Debugging in the project compiled in the debug configuration does not reveal anything suspicious, and a release is being prepared ... in which the program <b>does not work</b> . <br><br><h4>  Debriefing </h4><br>  Yes, yes, this ‚Äúbug‚Äù is a direct consequence of optimization (and, of course, a small negligence of the programmer).  Negligence lies in the fact that the specified System.Threading.Timer actually inherits IDisposable, and, for good, we should call the Dispose () method for it.  Well, suppose we do not do this (in fact, this is irrelevant). <br><br>  We study the listing of IL code generated in the release and debug versions and see this. <br>  debug: <br><blockquote> <code>.method private hidebysig static void Main(string[] args) cil managed <br> { <br> .entrypoint <br> .maxstack 5 <br> <b>.locals init ( <br> [0] class [mscorlib]System.Threading.Timer t)</b> <br> L_0000: nop <br> L_0001: ldsfld class <br> [mscorlib]System.Threading.TimerCallback ConsoleApplication11.Program::CS$&lt;&gt;9__CachedAnonymousMethodDelegate1 <br> .... <br></code> <br></blockquote><br><br>  and release: <br><blockquote> <code>.method private hidebysig static void Main(string[] args) cil managed <br> { <br> .entrypoint <br> .maxstack 8 <br> L_0000: ldsfld class [mscorlib]System.Threading.TimerCallback ConsoleApplication11.Program::CS$&lt;&gt;9__CachedAnonymousMethodDelegate1 <br> .... <br></code> <br></blockquote><br><br>  I <b>highlighted the</b> difference. <br><br><h5>  For those who have not figured it out yet </h5><br>  In the debug version, the compiler leaves the Timer link on the stack not used anywhere (except for the declaration), and the GC sees that the link is alive (until the method is finished) does nothing.  The timer is working. <br><br>  In the release of the same version, the link does not exist anywhere, and the first (not guaranteed) method GC.Collect () will destroy the timer. <br><br><h4>  Afterword </h4><br>  I sincerely hope that you will never have to fall for obvious (or not) optimizer bugs, as in the example above, in real life.  The search for such bugs (especially on the customer side) is very complicated and I can only recommend assembling the debug version of all components and gradually compiling the parts in the release in order to find the ‚Äúdefective‚Äù assembly and its further analysis.  Distributing debug information (.pdb file usually) can also help. <br><br>  Good Friday, keep logs 8-) </div><p>Source: <a href="https://habr.com/ru/post/108815/">https://habr.com/ru/post/108815/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../108804/index.html">Usability testing on the knee</a></li>
<li><a href="../108806/index.html">Statistics of participants of foreign affiliate programs</a></li>
<li><a href="../108807/index.html">Samsung BDC - how we participated in the competition and won it</a></li>
<li><a href="../108809/index.html">Right now. Lecture by Stanislav Smirnov in FML 239</a></li>
<li><a href="../108813/index.html">Zip zip: hooray! Or - Dump the archive</a></li>
<li><a href="../108817/index.html">New materials on ASP.Net in Russian (150 articles)</a></li>
<li><a href="../108820/index.html">Installing an unsupported Wifi card in the HP Pavilion dv6-1319er</a></li>
<li><a href="../108823/index.html">Apache will breathe new life into Google Wave</a></li>
<li><a href="../108824/index.html">How to update your Facebook, LinkedIn & Twitter status using spring-social</a></li>
<li><a href="../108828/index.html">The release of the second part of the book "Smashing Magazine": add yourself to the book!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>