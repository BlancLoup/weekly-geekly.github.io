<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Workshop Zend Framework. Part Three: Zend_Acl</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we look at an example of creating Acl for a system with a large number of roles and resources. 


- Part one Authentication - user login ACL - d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Workshop Zend Framework. Part Three: Zend_Acl</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/storage1/a72071b0/743c98fa/11b5976c/00858629.png"></div><br>  Today we look at an example of creating Acl for a system with a large number of roles and resources. <a name="habracut"></a><br><ul><li>  <a href="http://habrahabr.ru/blogs/zend_framework/121114/"><b>Part one</b></a> <br><ul><li>  <b>Authentication</b> - user login </li><li>  <b>ACL</b> - distribution of access rights </li></ul><br></li><li>  <b><a href="http://habrahabr.ru/blogs/zend_framework/121222/">Part two</a></b> <br><ul><li>  <b>Routing</b> - setting the url for various system components </li><li>  <b>Registry</b> - quick access to system constants </li></ul></li><li>  <b>Part three</b> <br><ul><li>  <b>Acl</b> - advanced example </li></ul></li></ul><br>  Hubrauzer <a href="http://habrahabr.ru/users/anexroid/" class="user_link">Anexroid</a> kindly provided a description of such a project: <br><blockquote>  The following access rights exist: Admin, with access to the admin panel.  And in the admin about 20-30 sections, 5 admins.  All access is different.  That is, someone has 2-3 sections, someone - all 20. All menu items are stored in the database. <br>  User - registered on the site.  It can create photo albums, comment on news without entering a captcha, etc.  + everything that a guest can do. <br>  Enterprise - has a personal page in the catalog, depending on the package purchased - various items in the personal account. <br>  Well, a guest who can view everything unlimited.  Comments - with captcha. <br>  There are also consultants - answer questions in consultations. <br>  Moreover, enterprises and consultants have no registration, they are added by the administrator.  + again, all the tables in the database are separate - separate administrators, separate users, separate enterprises, consultants separately. <br></blockquote><br>  To begin with, we will define roles and resources, create hierarchies of inheritance of resources and roles: <br><div style="text-align:center;"><img src="http://www.dizballanze.com/wp-content/uploads/2011/06/1-1024x537.png" alt=" " title="Role hierarchy" width="1024" height="537"></div><br>  In our example, the upper part of the resource hierarchy will coincide in structure with the hierarchy of roles.  In order to conveniently display the hierarchy of resources, we will add abstract resources for each role, except Admin1-N, CompanyPackage1-N, to our list of access rights.  This is because the resources for the Guest, User and common resources for all admins and companies have a simple tree structure, which is not the case with the lower nodes of the tree where there will be intersections.  For example, Admin1 and Admin2 may have access to the Add News resource, and Zend_Acl resource trees, unfortunately, do not support multiple inheritance.  Therefore, resources for the Admin1-N, CompanyPackage1-N roles will be allocated as exceptions, explicitly assigned to the desired roles. <br><div style="text-align:center;"><img src="http://www.dizballanze.com/wp-content/uploads/2011/06/bbb.png" alt=" " title="Resource hierarchy" width="933" height="454"></div><br>  So, we figured out the hierarchy of resources, now let's create Acl directly.  To do this, expand the Zend_Acl class: <br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Acl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Zend_Acl</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   $this-&gt;addRole('guest'); $this-&gt;addRole('user', 'guest'); $this-&gt;addRole('admin', 'user'); $this-&gt;addRole('company', 'user'); $this-&gt;addRole('company-package-1', 'company'); $this-&gt;addRole('company-package-2', 'company'); $this-&gt;addRole('company-package-3', 'company'); // ... $this-&gt;addRole('admin-1', 'admin'); $this-&gt;addRole('admin-2', 'admin'); // ... $this-&gt;addRole('admin-5', 'admin'); //  // //   ! $this-&gt;add(new Zend_Acl_Resource('guest_res')); //    ,    guest_res $this-&gt;add(new Zend_Acl_Resource('add-comments-with-captcha'), 'guest_res'); //   ! $this-&gt;add(new Zend_Acl_Resource('user_res')); //    ,    user_res $this-&gt;add(new Zend_Acl_Resource('add-comments'), 'user_res'); //   ! $this-&gt;add(new Zend_Acl_Resource('admin_res')); //      ,    admin_res $this-&gt;add(new Zend_Acl_Resource('admin-tools-list'), 'admin_res'); //   ! $this-&gt;add(new Zend_Acl_Resource('company_res')); //      ,    company_res $this-&gt;add(new Zend_Acl_Resource('show-company-statistics'), 'company_res'); //      ,    $this-&gt;add(new Zend_Acl_Resource('advertise')); $this-&gt;add(new Zend_Acl_Resource('add-company')); // , -   $this-&gt;deny(null, null, null); $this-&gt;allow('guest', 'guest_res', 'show'); $this-&gt;allow('user', 'user_res', 'show'); $this-&gt;allow('admin','admin_res', 'show'); $this-&gt;allow('company','company_res', 'show'); //        $this-&gt;allow('company-package-1','advertise', 'show'); $this-&gt;allow('admin-1','add-company', 'show'); } }</span></span></code> </pre> <br>  And immediately check that everything works as we expected: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $acl-&gt;isAllowed(<span class="hljs-string"><span class="hljs-string">'guest'</span></span>, <span class="hljs-string"><span class="hljs-string">'add-comments-with-captcha'</span></span>, <span class="hljs-string"><span class="hljs-string">'show'</span></span>)?<span class="hljs-string"><span class="hljs-string">'yes'</span></span>:<span class="hljs-string"><span class="hljs-string">'no'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// yes echo $acl-&gt;isAllowed('guest', 'add-comments', 'show')?'yes':'no'; // no echo $acl-&gt;isAllowed('admin-1', 'add-company', 'show')?'yes':'no'; // yes echo $acl-&gt;isAllowed('company-package-2', 'advertise', 'show')?'yes':'no'; // no</span></span></code> </pre><br>  In this example, I allowed myself to simplify and introduced one show privilege, which corresponds to the ability to view a particular page.  However, you can extend this example and add different privileges if required. <br>  Also, it is obvious that this code does not correspond to the fact that company packages and administrators will be added, and the rights of other roles may change over time.  Therefore, you will need to store data in a database and either build an object on demand, retrieving the necessary data, or store a serialized instance of the Acl class in any storage (for example, memcached).  This choice is yours, I personally prefer the second option. <br>  In the <a href="http://habrahabr.ru/blogs/zend_framework/121114/">first post of</a> this cycle, I considered how to create Acl using the ‚Äúcontroller / action‚Äù strings as resources, which is very convenient in small projects. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/122469/">https://habr.com/ru/post/122469/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../122457/index.html">SkyDrive update and how to connect SkyDrive as a network resource</a></li>
<li><a href="../122458/index.html">Sony Ericsson Athlete and Styler - Presentation Video</a></li>
<li><a href="../122459/index.html">Right now look online: Pavel Cherkashin says "How to sell yourself a business angel?"</a></li>
<li><a href="../122460/index.html">Beltelecom blocks Vkontakte for the time of the ‚Äúrevolution from the social network‚Äù</a></li>
<li><a href="../122468/index.html">Firefox as a workhorse, Chrome as a sports car</a></li>
<li><a href="../122476/index.html">Security Updates for Firefox 4 Will No More</a></li>
<li><a href="../122479/index.html">Dataflow architecture. Part 1</a></li>
<li><a href="../122481/index.html">SumIT-2011 is near, and you are without a project?</a></li>
<li><a href="../122482/index.html">Sony Ericsson Xperia ray and Xperia active - first impressions</a></li>
<li><a href="../122484/index.html">Opera Startup Awards - Semifinal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>