<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHPUnit && ordered tests</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="All programmers are lazy. And everyone wants not to write additional code, but to use it already. Moreover, it is a good practice. 

 So I had a probl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHPUnit && ordered tests</h1><div class="post__text post__text-html js-mediator-article">  All programmers are lazy.  And everyone wants not to write additional code, but to use it already.  Moreover, it is a good practice. <br><br>  So I had a problem in which I wanted not to do copy-paste, but run a few tests for execution.  But, each next test depended on the previous data, and so on, and so on ... As a result, I needed a strict sequence of tests and the ability to respond to dependencies.  What is the solution, look under the cut ... <br><a name="habracut"></a><br><br><h5>  Precondition </h5><br>  There is a facade of the system that can perform any actions.  There are dependent actions, and there are independent actions.  Dependent actions require an independent action (and sometimes not one).  Therefore, in the end, we should get a so-called ordered list of actions. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Since all the actions that are invoked, you need to test, then accordingly you need to get an ordered list of tests.  PHPUnit was used as a test framework, as its conditions were quite enough for a certain type of action. <br><br><h5>  Condition </h5><br>  So, now I can see that they will want to throw tomatoes at me and say that there is <a href="http://www.phpunit.de/manual/current/en/writing-tests-for-phpunit.html">dependency</a> in PHPUnit.  And indeed it is.  BUT, as written by the author himself, dependencies do not allow you to specify a strict order of test execution. <br><blockquote>  PHPUnit supports the declaration of explicit dependencies between test methods.  It is not necessary to determine the order. </blockquote><br>  In addition, as I found out later, to indicate the dependence of a single test method in a descendant class on a test method of the parent class, it is like immediately indicating that the test should be ignored. <br>  For example: <br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">Class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ParentTestCase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPUnit_Framework_TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testOne</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::assertTrue(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@depends</span></span></span><span class="hljs-comment"> testOne */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testTwo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::assertTrue(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } }</code> </pre> <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChildTestCase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ParentTestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@depends</span></span></span><span class="hljs-comment"> testTwo */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testThree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::assertTrue(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } }</code> </pre><br>  I‚Äôll point out that this is due to the use of <i>reflection</i> , because the methods from the descendant class are collected first, and then from the ancestor class. <br><br>  In this regard, I had the idea to modify PHPUnit so that it supports the sequence of test execution and that the basis for this sequence lies in indicating dependencies on test execution. <br><br><h5>  Decision </h5><br>  First, let's determine where we are going to store the order of dependencies of the test.  To do this, create a child <b>TestCase</b> and add control functions for this order. <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MagicTestCase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPUnit_Framework_TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $order = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-comment"><span class="hljs-comment">/** * Sets the orderSet of a TestCase. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $orderSet */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setOrderSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $orderSet)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;order = $orderSet; } <span class="hljs-comment"><span class="hljs-comment">/** * Get the orderSet of a TestCase. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array $order */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOrderSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;order; } }</code> </pre><br><br>  After that, you must specify the initial dependence for each test.  To do this, override the <b>addTestMethod</b> method for the <b>PHPUnit_Framework_TestSuite</b> class in the inherited class.  Install the dependency: <br><pre> <code class="php hljs">$test-&gt;setOrderSet(PHPUnit_Util_Test::getDependencies($class-&gt;getName(), $name));</code> </pre> <br>  Now we need to add the constructor of our TestSuite, so that it sorts all the tests in the order we set.  In the same place for each test we define a recursive order. <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;tests <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $test) { $test-&gt;setOrderSet( array_unique(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRecursiveOrderSet($test, $test-&gt;getName())) ); } usort(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;tests, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">"MagicUtilTest "</span></span>, <span class="hljs-string"><span class="hljs-string">"compareTestOrder"</span></span>));</code> </pre><br><br>  In addition, the <b>addTestSuite</b> function creates an instance of itself ( <b>PHPUnit_Framework_TestSuite</b> ), and it is necessary that it create a modified <b>TestSuite</b> , because in the first case, it does not use the modified <b>TestSuite constructor</b> .  It all depends on one line, which we redefine inside the method: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addTest(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MagicTestSuite($testClass));</code> </pre> <br><br>  The resulting class is: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MagicTestSuite</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPUnit_Framework_TestSuite</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Constructs a new TestSuite: * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> mixed $theClass * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $name * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> InvalidArgumentException */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($theClass = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct($theClass, $name); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;tests <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $test) { $test-&gt;setOrderSet( array_unique(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRecursiveOrderSet($test, $test-&gt;getName())) ); } usort(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;tests, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">"MagicUtilTest "</span></span>, <span class="hljs-string"><span class="hljs-string">"compareTestOrder"</span></span>)); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $object * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $methodName * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRecursiveOrderSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($object, $methodName)</span></span></span><span class="hljs-function"> </span></span>{ $orderSet = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;tests <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $test) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($test-&gt;getName() == $methodName &amp;&amp; get_class($object) == get_class($test)) { $testOrderSet = $test-&gt;getOrderSet(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($testOrderSet)) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($testOrderSet <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $orderMethodName) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!in_array($orderMethodName, $orderSet)) { $orderResult = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRecursiveOrderSet($test, $orderMethodName); $orderSet = array_merge($orderSet, $orderResult); } } } $orderSet = array_merge($orderSet, $testOrderSet); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $orderSet; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> ReflectionClass $class * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> ReflectionMethod $method */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addTestMethod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ReflectionClass $class, ReflectionMethod $method)</span></span></span><span class="hljs-function"> </span></span>{ $name = $method-&gt;getName(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;isPublicTestMethod($method)) { $test = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::createTest($class, $name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($test <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> PHPUnit_Framework_TestCase || $test <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> PHPUnit_Framework_TestSuite_DataProvider) { $test-&gt;setDependencies( PHPUnit_Util_Test::getDependencies($class-&gt;getName(), $name) ); } $test-&gt;setOrderSet(PHPUnit_Util_Test::getDependencies($class-&gt;getName(), $name)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addTest($test, PHPUnit_Util_Test::getGroups( $class-&gt;getName(), $name) ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;isTestMethod($method)) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addTest( <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::warning( sprintf( <span class="hljs-string"><span class="hljs-string">'Test method "%s" is not public.'</span></span>, $name ) ) ); } <span class="hljs-comment"><span class="hljs-comment">/** * Adds the tests from the given class to the suite. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> mixed $testClass * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> InvalidArgumentException */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addTestSuite</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($testClass)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_string($testClass) &amp;&amp; class_exists($testClass)) { $testClass = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ReflectionClass($testClass); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_object($testClass)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> PHPUnit_Util_InvalidArgumentHelper::factory( <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'class name or object'</span></span> ); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($testClass <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> PHPUnit_Framework_TestSuite) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addTest($testClass); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($testClass <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ReflectionClass) { $suiteMethod = <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$testClass-&gt;isAbstract()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($testClass-&gt;hasMethod(PHPUnit_Runner_BaseTestRunner::SUITE_METHODNAME)) { $method = $testClass-&gt;getMethod( PHPUnit_Runner_BaseTestRunner::SUITE_METHODNAME ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($method-&gt;isStatic()) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addTest( $method-&gt;invoke(<span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, $testClass-&gt;getName()) ); $suiteMethod = <span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$suiteMethod &amp;&amp; !$testClass-&gt;isAbstract()) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addTest(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MagicTestSuite($testClass)); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidArgumentException; } } }</code> </pre><br>  Well, respectively, add a utility function that will compare the two tests and indicate in which direction to sort them. <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MagicUtilTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@static</span></span></span><span class="hljs-comment"> * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> PHPUnit_Framework_TestCase $object1 * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> PHPUnit_Framework_TestCase $object2 * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compareTestOrder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PHPUnit_Framework_TestCase $object1, PHPUnit_Framework_TestCase $object2)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (in_array($object2-&gt;getName(), $object1-&gt;getOrderSet())) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (in_array($object1-&gt;getName(), $object2-&gt;getOrderSet())) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre><br><br><h5>  Application </h5><br>  Create a test run file: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> dirname(<span class="hljs-keyword"><span class="hljs-keyword">__FILE__</span></span>) . DIRECTORY_SEPARATOR.<span class="hljs-string"><span class="hljs-string">' runSuite.php'</span></span>; PHPUnit_Util_Filter::addFileToFilter(<span class="hljs-keyword"><span class="hljs-keyword">__FILE__</span></span>, <span class="hljs-string"><span class="hljs-string">'PHPUNIT'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'PHPUnit/TextUI/Command.php'</span></span>; $tests= runSuite::suite(); PHPUnit_TextUI_TestRunner::run($tests); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>;</code> </pre><br><br>  Create a common class TestSuite, which will directly run the tests.  We inherit it from our created: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'MagicTestSuite.php'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">runSuite</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MagicTestSuite</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">suite</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $suite = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>(); $suite-&gt;addTestSuite(‚ÄúChildTestCase‚Äù); } }</code> </pre><br>  Well, TestCases, which include tests and dependencies: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'MagicTestCase.php'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ParentTestCase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MagicTestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testOne</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::assertTrue(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@depends</span></span></span><span class="hljs-comment"> testOne */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testTwo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::assertTrue(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } }</code> </pre><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'ParentTestCase.php'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChildTestCase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ParentTestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@depends</span></span></span><span class="hljs-comment"> testTwo */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testThree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::assertTrue(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } }</code> </pre><br><br><h5>  Restrictions </h5><br>  The current solution does not allow to break the closing dependencies.  That is, if we have two tests that will depend on each other, then we get an infinite loop. <br><br>  Of course, it was possible to build a dependency tree of the test ... but I honestly did not think up in which case (besides human error) you can use closure dependencies for tests. </div><p>Source: <a href="https://habr.com/ru/post/116896/">https://habr.com/ru/post/116896/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../116891/index.html">Boodler Sound Landscape Generator</a></li>
<li><a href="../116892/index.html">Multi-threaded application under Tornado</a></li>
<li><a href="../116893/index.html">Mangrove, Ventech Capital and ABRT have invested in oktogo.ru</a></li>
<li><a href="../116894/index.html">Nginx + uWSGI + Django, one of the launch options</a></li>
<li><a href="../116895/index.html">Service development: Classmates, VKontakte, ethics vs. aesthetics</a></li>
<li><a href="../116898/index.html">Run third-party code in the sandbox</a></li>
<li><a href="../116899/index.html">The first public version of Appcelerator Titanium Studio has been released.</a></li>
<li><a href="../116902/index.html">Skype phone booth at Tallinn Airport</a></li>
<li><a href="../116903/index.html">Show your startup to Yandex, Mail.ru, Groupon</a></li>
<li><a href="../116904/index.html">Introduction to F #, the blue pill</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>