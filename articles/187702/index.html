<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How-To: Connect Pfsense with Huawei E392 Modem to Yota Provider</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 This post was written because there is little information on the Internet and it is scattered, we had to collect in rows from various s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How-To: Connect Pfsense with Huawei E392 Modem to Yota Provider</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  This post was written because there is little information on the Internet and it is scattered, we had to collect in rows from various sources.  I will try in this manual to bring it all together.  It is assumed that you already have basic knowledge of the pfSence assembly and you can go to the console. <br>  System version: <br><pre><code class="bash hljs">[2.0.3-RELEASE][admin@pfsense.office]/root(1): uname -a FreeBSD pfsense.office 8.1-RELEASE-p13 FreeBSD 8.1-RELEASE-p13 <span class="hljs-comment"><span class="hljs-comment">#0: Fri Apr 12 10:47:01 EDT 2013 root@snapshots-8_1-i386.builders.pfsense.org:/usr/obj.pfSense/usr/pfSensesrc/src/sys/pfSense_SMP.8 i386</span></span></code> </pre> <br><br><a name="habracut"></a><h5>  Why Huawey E392? </h5><br>  This modem was chosen due to the presence of stable reception in places where conventional modems do not catch.  You can also connect an external antenna to it and move it to the external wall of a building. <br>  The router was already available, it worked for a long time and successfully, and I didn‚Äôt want to change the additional equipment due to the change of provider.  Buying a new router from Yota is undesirable, because all sorts of buns, such as blocking sites and channel shaping in it, are not available. <br><br><h5>  Transfer modem modem mode </h5><br>  By default, the modem is in usbdisk + CD-ROM mode for installing drivers under Windows.  Drivers are right on it.  This mode is of little interest to us, we need to transfer it to modem mode. <br>  Check that the modem is seen in the system with the command <b>dmesg</b> .  There should be such lines: <br><pre> <code class="bash hljs">da3: Attempt to query device size failed: NOT READY, Medium not present Root mount waiting <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: usbus4 ugen4.3: &lt;Huawei Technologies&gt; at usbus4 umass1: &lt;Huawei Technologies HUAWEI Mobile, class 0/0, rev 2.00/0.00, addr 3&gt; on usbus4 umass1: SCSI over Bulk-Only; quirks = 0x0000 Root mount waiting <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: usbus4 umass1:1:1:-1: Attached to scbus1 Trying to mount root from ufs:/dev/ad6s1a WARNING: / was not properly dismounted (probe0:umass-sim1:1:0:0): TEST UNIT READY. CDB: 0 0 0 0 0 0 (probe0:umass-sim1:1:0:0): CAM status: SCSI Status Error (probe0:umass-sim1:1:0:0): SCSI status: Check Condition (probe0:umass-sim1:1:0:0): SCSI sense: NOT READY asc:3a,0 (Medium not present) cd0 at umass-sim1 bus 1 scbus1 target 0 lun 0 cd0: &lt;HUAWEI Mass Storage 2.31&gt; Removable CD-ROM SCSI-0 device cd0: 40.000MB/s transfers cd0: Attempt to query device size failed: NOT READY, Medium not present</code> </pre><br>  We check which <b>idVendor</b> and <b>idProduct are</b> set by default with the command <b>usbconfig -d 4.3 dump_device_desc</b> , the value of the -d parameter is <b>viewed</b> from the output of <b>dmesg</b> ( <i><code>ugen4.3: at usbus4</code> ):</i> <i><br></i> <pre> <i><code class="bash hljs">ugen4.3: &lt;HUAWEI Mobile Huawei Technologies&gt; at usbus4, cfg=0 md=HOST spd=HIGH (480Mbps) pwr=ON bLength = 0x0012 bDescriptorType = 0x0001 bcdUSB = 0x0200 bDeviceClass = 0x0000 bDeviceSubClass = 0x0000 bDeviceProtocol = 0x0000 bMaxPacketSize0 = 0x0040 idVendor = 0x12d1 idProduct = 0x1505 bcdDevice = 0x0000 iManufacturer = 0x0003 &lt;Huawei Technologies&gt; iProduct = 0x0002 &lt;HUAWEI Mobile&gt; iSerialNumber = 0x0000 &lt;no string&gt; bNumConfigurations = 0x0001</code></i> </pre> <i><br></i>  <i>Since there are no / usr / ports in the FreeBSD pfSence edition, we will install the package to change the modem configuration directly from the official repository via a direct link</i> <i><br></i>  <i>We need a compiled <b>usb_modeswitch</b> package.</i> <i><br></i> <pre> <i><code class="bash hljs">pkg_add -r ftp://ftp.freebsd.org/pub/FreeBSD/ports/i386/packages-8-stable/Latest/usb_modeswitch.tbz</code></i> </pre> <i><br></i>  <i>This package stores the configuration in the <b>/usr/local/etc/usb_modeswitch.conf</b> file and the startup script <b>/ usr / local / sbin / usb_modeswitch</b></i> <i><br></i>  <i>After installation, edit the configuration file, adding <b>idVendor</b> and <b>idProduct to it</b> :</i> <i><br></i> <pre> <i><code class="bash hljs">DisableSwitching=0 EnableLogging=1 DefaultVendor= 0x12d1 DefaultProduct= 0x1505 TargetVendor= 0x12d1 TargetProduct= 0x140c TargetClass= 01 DetachStorageOnly=0 HuaweiMode=0 MessageEndpoint= not <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> MessageContent=<span class="hljs-string"><span class="hljs-string">"55534243000000000000000000000011060000000000000000000000000000"</span></span> NeedResponse=0 ResponseEndpoint= not <span class="hljs-built_in"><span class="hljs-built_in">set</span></span></code></i> </pre> <i><br></i>  <i>As a result, we get the replacement of <b>DefaultProduct 0x1505</b> with <b>TargetProduct 0x140c</b> .</i> <i><br></i>  <i>To do this, execute the script, substituting the config for it:</i> <i><br></i> <pre> <i><code class="bash hljs">/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/sbin/usb_modeswitch -H -c /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/etc/usb_modeswitch.conf</code></i> </pre> <i><br></i>  <i>We check <b>usbconfig -d 4.3 dump_device_desc</b> , we are satisfied with the values <b>idProduct 0x1506</b> and <b>0x140c</b> .</i> <i><br></i>  <i>Checking the <b>dmesg</b> , should get the following lines on the output:</i> <i><br></i> <pre> <i><code class="bash hljs">ugen4.3: &lt;Huawei Technologies&gt; at usbus4 u3g0: &lt;Huawei Technologies HUAWEI Mobile, class 0/0, rev 2.00/0.00, addr 3&gt; on usbus4 u3g0: Found 4 ports.</code></i> </pre> <i>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </i>  <i>But this is not enough, when rebooting, our modem will return to its settings again, and the connection will be reset.</i>  <i>To prevent this from happening, we <b>‚Äôll</b> add to the <b>/etc/devd.conf</b> file a check at startup, whether our device is in the required configuration, and a script launch, if it is in <b>USBmass</b> mode</i> <i><br></i> <pre> <i><code class="bash hljs">attach 10 { device-name <span class="hljs-string"><span class="hljs-string">"ugen[0-9]+"</span></span>; match <span class="hljs-string"><span class="hljs-string">"vendor"</span></span> <span class="hljs-string"><span class="hljs-string">"0x12d1"</span></span>; match <span class="hljs-string"><span class="hljs-string">"product"</span></span> <span class="hljs-string"><span class="hljs-string">"0x1505"</span></span>; action <span class="hljs-string"><span class="hljs-string">"/usr/local/sbin/3G.sh"</span></span>; };</code></i> </pre> <i><br></i>  <i>Create the file <b>/usr/local/sbin/3G.sh</b> and make it executable.</i>  <i>File contents:</i> <i><br></i> <pre> <i><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh sleep 3 /usr/local/sbin/usb_modeswitch -H -c /usr/local/etc/usb_modeswitch.conf sleep 12 /usr/local/sbin/usb_modeswitch -H -c /usr/local/etc/usb_modeswitch.conf</span></span></code></i> </pre> <i><br><br></i> <h5>  <i>ISP connection setup</i> </h5> <i><br></i>  <i>To create a connection to Yota, go to the top Interfaces -&gt; (assign) menu and select the PPPs tab.</i> <i><br><img src="https://habrastorage.org/storage2/926/d2c/32d/926d2c32dac86fee62ff8f8a00df66cd.jpg"><br><br></i>  <i>Add a new connection, type PPP, specify Link (/dev/cauU0.3) phone number * 99 #, address of the access point yota.ru.</i> <i><br><img src="https://habrastorage.org/storage2/aa6/8d6/b64/aa68d6b64283cf3bbcaf50dd64d227d0.jpg"><br><br></i>  <i>In the additional options you need to specify that the connection will be raised on request - Enable the Dial on Demand option.</i> <i><br><img src="https://habrastorage.org/storage2/5e4/bfa/f7a/5e4bfaf7a3141739876c9c19a0b590e9.jpg"><br><br></i>  <i>After that, the new interface will appear on the Interface assignments tab.</i> <i><br><img src="https://habrastorage.org/storage2/a65/6fe/dd0/a656fedd0d4b8cc59402a86d701f0dc4.jpg"><br><br></i>  <i>We turn it on through the top menu Interfaces -&gt; OPT1 and turn it on, choosing PPP as the interface type, phone number * 99 # and APN yota.ru.</i> <i><br><img src="https://habrastorage.org/storage2/331/74e/ee1/33174eee1810bede1247b600fd2b08b1.jpg"><br><br></i> <h5>  <i>Add equipment to your personal account</i> </h5> <i><br></i>  <i>In the end, you need to register the equipment in your account on the Yota.ru website and link the device to your account.</i>  <i>This can be done from any machine; specify ID number on the sim-card with 10 digits (010100xxxx) as the equipment ID.</i>  <i>Without this, you can only go to the site yota.ru</i> <i><br><img src="https://habrastorage.org/storage2/124/cdc/6dc/124cdc6dceacfd38852752f50ae2b80f.jpg"><br><br></i> <h4>  <i>Conclusion</i> </h4> <i><br></i>  <i>This setup is complete, we can use.</i>  <i>For other modems, this configuration is also fair, you only need to clarify the idVendor and idProduct parameters required for operation of the equipment in modem mode and substitute them into the configuration.</i> <i><br><br></i>  <i>Author: Dmitry Barsukov, will be grateful for an invite, if the article is worth it, as well as for pointing out possible shortcomings and mistakes.</i>  <i>Thank!</i> </div><p>Source: <a href="https://habr.com/ru/post/187702/">https://habr.com/ru/post/187702/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../187678/index.html">Ancient device - scales</a></li>
<li><a href="../187680/index.html">Prototypes of Apple devices 30 years ago</a></li>
<li><a href="../187690/index.html">The whole world of domains in your SMS from REG.RU</a></li>
<li><a href="../187696/index.html">Auto-tracking of low-orbit satellites or listening to the radio signal from the ISS</a></li>
<li><a href="../187700/index.html">VKontakte stops support for Jabber.</a></li>
<li><a href="../187704/index.html">NASA has published a photo of the Earth, view from the rings of Saturn</a></li>
<li><a href="../187706/index.html">Meet Tizen</a></li>
<li><a href="../187708/index.html">Unusual site navigation</a></li>
<li><a href="../187716/index.html">Yandex Islands Beta: "We want to give meaning to any element on the search results page"</a></li>
<li><a href="../187720/index.html">Raytracing render on C</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>