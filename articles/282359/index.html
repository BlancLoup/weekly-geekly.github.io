<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>cx_Freeze + virtualenv = bugs and zigzags</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The other day I decided to try to assemble my freshly baked bot for Telegrams into an executable file. There are various solutions: py2exe , pyInstall...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>cx_Freeze + virtualenv = bugs and zigzags</h1><div class="post__text post__text-html js-mediator-article">  The other day I decided to try to assemble my freshly baked bot for Telegrams into an executable file.  There are various solutions: <a href="http://www.py2exe.org/">py2exe</a> , <a href="http://www.pyinstaller.org/">pyInstaller</a> , <a href="http://cx-freeze.sourceforge.net/">cx_Freeze</a> .  I use <b>Ubuntu 14.04</b> both on my computer and on the server, so the choice fell on <b>cx_Freeze</b> , due to its cross-platform and <b>Python 3</b> support.  (At the time of this writing, I have not yet had time to <b>try</b> out <b>pyInstaller</b> , which has the same properties. If there is something interesting, I will tell about it in another article). <br><a name="habracut"></a><br><h2>  Cx_Freeze installation </h2><br>  Initially, it seemed that everything was trivial: <br><blockquote>  sudo apt install cx-freeze </blockquote><br>  Not suitable because it installs cx_Freeze for <b>Python2</b> . <br><br>  Let's try through pip3: <br><blockquote>  sudo pip3 install cx_Freeze </blockquote><br>  However, as if not so.  On Ubunt (I have not tried other OSes yet) this causes the following error (I apologize for the pictures. At the time of writing, it was difficult to make a text copy-paste for reasons from the ‚Äúthis is a long history‚Äù series): <br><br><img src="http://s020.radikal.ru/i704/1604/a9/7683bfaf5309.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Having rummaged through StackExchange, I realized that without installing from the <a href="">sources,</a> it would not do. <br><br>  Downloaded.  Unpacked.  Launched: <br><blockquote>  sudo python3 setup.py install </blockquote><br>  The story is similar: <br><br><img src="http://i042.radikal.ru/1604/9e/2c3ee3986df4.png" alt="image"><br><br>  Rummaged through <a href="http://stackoverflow.com/a/25119820/2052138">StackOverflow</a> again.  I had to get into <i>setup.py</i> and replace the line there: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> vars.get(<span class="hljs-string"><span class="hljs-string">"Py_ENABLE_SHARED"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>):</code> </pre> <br>  on <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>:</code> </pre><br>  I tried to start again - and it was installed!  Hooray! <br><br><h5>  On a note </h5><br>  While writing the article, I repeated the installation process on a ‚Äúfresh‚Äù virtual machine with Ubuntu 14.04 32bit.  I ran into an error: <br><blockquote>  / usr / bin / ld: cannot find -lz </blockquote><br>  According to <a href="http://stackoverflow.com/a/5850955/2052138">this</a> , it is solved (on 32-bit systems) using: <br><blockquote>  sudo apt-get install lib32z1-dev </blockquote><br>  And also, just in case (since it was mentioned in <a href="http://stackoverflow.com/q/25107697/2052138">this question</a> ), I installed <i>python-dev</i> : <br><blockquote>  sudo apt-get install python-dev </blockquote><br><h2>  Putting the script! </h2><br>  Consider the simplest way to build a script using cx_Freeze.  Go to the folder with the scripts and run: <br><blockquote>  cxfreeze main.py --target-dir build </blockquote><br>  where <i>main.py</i> is the name of the main (launched) script, and <i>build</i> is the folder where the executable file and libraries will go. <br><br>  It should be noted that, unlike, say, C ++ compilers, cx_Freeze does not catch errors.  Therefore, it can perfectly collect everything, but when you run the executable file, exceptions will sprinkle, and in a rather illegible format.  I advise you to test the code while it is still pythonic. <br><br>  I think that optimizing the code for building into an executable file is a topic for a separate discussion, because when building, problems that couldn‚Äôt have happened when running the script through the Python interpreter could come up.  Here I will talk about one (thank God, one! No more just arose) such a problem. <br><br>  My script accesses external settings files.  But when launched from an executable file, for some reason he began to perceive the name of the script as one of the folders on the way to the settings file.  That is, if the assembled executable file called <i>main</i> is in <i>/ tmp / 001</i> , and the settings file is in <i>/ tmp / 001 / sett</i> , the script thought that the settings file is actually located in <i>/ tmp / 001 / main / sett</i> .  That, naturally, is nonsense.  And if you run the python script - this problem does not exist. <br><br>  The fact is that at the beginning of my programs I often cram the following line: <br><br><pre> <code class="python hljs">SCRIPT_FOLDER = path.dirname(path.realpath(__file__))</code> </pre><br>  I then use this variable when setting paths to files that are always in the same place <b>relative to the script</b> : settings files, save, tokens, application codes, etc. Thus, I guarantee that the program reads the file from the right place regardless of where it was launched from (for example, from another folder or through a daemon). <br><br>  Scripts collected through cx_Freeze usually either incorrectly interpret the global variable __file__ or do not know it at all.  The latter just happened when I tried to build and run the executable file from a simple test script: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> path SCRIPT_FOLDER = path.dirname(path.realpath(__file__)) print(SCRIPT_FOLDER)</code> </pre><br>  The problem turned out to be <a href="http://stackoverflow.com/a/22270293/2052138">known</a> .  It was enough to slightly patch my program: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> getattr(sys, <span class="hljs-string"><span class="hljs-string">'frozen'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>): <span class="hljs-comment"><span class="hljs-comment"># frozen SCRIPT_FOLDER = path.dirname(sys.executable) else: SCRIPT_FOLDER = path.dirname(path.realpath(__file__))</span></span></code> </pre><br>  As a result, everything started with half a pint!  Fine.  The simple part is complete!  Go to repeating all this in a virtual environment! <br><br><h2>  Oh, those virtual environments! </h2><br>  If you do not use <i>virtualenv</i> , I think you are not very interested in further reading this article.  The peculiarity lies not only in installing cx_Freeze on Wednesday, but also in running it in such a way that it uses dependencies from the environment, and not system dependencies. <br><br><h5>  On a note </h5><br>  We will not have to use the environment in the shell (run through ‚Äúsource env / bin / activate‚Äù).  I tried, it did not give effect. <br><br><h3>  Installation </h3><br>  My virtual environment is in the <i>env</i> folder in the main directory of my project.  To install cx_Freeze on Wednesday, go to the source folder cx_Freeze (with the <i>setup.py</i> file processed by the above method) and run: <br><blockquote>  / path / to / my / project / env / bin / python3 setup.py install </blockquote><br>  Not very comfortable.  I had to prescribe the path to the interpreter of Python in our environment.  But everything was established. <br><br><h3>  Assembly </h3><br>  The single line method described above will not work here.  It is necessary to use another - through the installation file. <br><br>  This file, in short form, which was quite sufficient for me, looks like this: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> cx_Freeze <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> setup, Executable PROGRAM_NAME = <span class="hljs-string"><span class="hljs-string">"Train delays bot"</span></span> VERSION = <span class="hljs-string"><span class="hljs-string">"0.0.5"</span></span> MAIN_SCRIPT_NAME = <span class="hljs-string"><span class="hljs-string">"train_delays_bot_main.py"</span></span> setup( name = PROGRAM_NAME, version = VERSION, executables = [Executable(MAIN_SCRIPT_NAME)])</code> </pre><br>  The most important thing here is to set MAIN_SCRIPT_NAME, which corresponds to the name of the main file of our program. <br><br>  We place this script in the project folder and go there.  Run: <br><blockquote>  env / bin / python3 setup.py install </blockquote><br>  The <i>build</i> folder was automatically created, and in it another one is <i>exe.linux-x86_64-3.4</i> (in your case, it may be called differently, depending on the OS and version of the interpreter).  It contains the executable file and the library.  I transferred there folders with files of tokens and settings.  Everything started.  And versions of dependences appeared just from the virtual environment.  That can not but rejoice, especially after two hours of <s>travidroma of</s> hard work. <br><br><h1>  Finally </h1><br>  And instead of a disclaimer.  In no case do I claim to be absolute correctness and maximum convenience of the above methods.  If you have more effective methods, tell us about them in the comments.  I think everyone who has mastered my writings will be interested. </div><p>Source: <a href="https://habr.com/ru/post/282359/">https://habr.com/ru/post/282359/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282347/index.html">The experience of automating uneasy correspondence (Completion. Sampling and Export)</a></li>
<li><a href="../282349/index.html">DGA Domain Detection</a></li>
<li><a href="../282351/index.html">The Internet of Things on a real example - car search system</a></li>
<li><a href="../282353/index.html">Explosive final of the Imagine Cup 2016</a></li>
<li><a href="../282357/index.html">Local positioning technology. Part II</a></li>
<li><a href="../282361/index.html">Connect to the Shielded VM webinar on Windows Server 2016. Begin on April 27 at 11:00 (GMT)</a></li>
<li><a href="../282363/index.html">Open DevOps Expert Meeting April 28 at Microsoft Technology Center</a></li>
<li><a href="../282365/index.html">OpenStack transforms data centers</a></li>
<li><a href="../282367/index.html">The book "From data storage to information management"</a></li>
<li><a href="../282369/index.html">The react-router text tutorial, as well as react-router + redux. In Russian</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>