<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Internet of Things protocol stack</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. We have been on the [censored] team (yes, we are called) for a while now we have been creating a stack for building wireless mesh networks with...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Internet of Things protocol stack</h1><div class="post__text post__text-html js-mediator-article">  Hello.  We have been on the [censored] team (yes, we are called) for a while now we have been creating a stack for building wireless mesh networks with adaptive routing.  And imagine, it turns out! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/8f8/b74/e56/8f8b74e564d34cb4b69e273b644b847d.jpg"></div><a name="habracut"></a><br>  And it just so happened that the time has come to break the cover of secrecy (ta-dam) and tell us what we are doing, why, and what opportunities for developing projects in the realm of the very Internet of things and the industrial Internet opens our stack protocol. <br><br>  It would be reasonable to begin this kind of story by explaining what was the impetus for the beginning of our work.  Briefly, this reason can be formulated as follows: we have concluded that modern mobile networks have a number of drawbacks (incompatible with life in the future), which cannot be overcome without the introduction of technology with a fundamentally different architecture, the version of which we thought up and decided to implement. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Who is guilty </h2><br>  At the dawn of the emergence of mobile networks, some of their architectural features had not yet turned into flaws: the concept of dividing the coverage area into separate areas looked elegant and logical, in full accordance with the ‚Äúdivide and conquer‚Äù strategy.  But since its inception, the mobile device market has continuously expanded, requirements for the quality of the services provided have become tougher, data rates and the number of subscribers have increased hundreds of times.  This growth made it possible to identify the problems of scalability and flexibility of the now classic mobile network architecture.  Paraphrasing the classics, 640 Kb was not enough. <br><br>  1. Mobile networks do not scale well by the number of cells.  Each new cell is a simulation of the propagation of radio waves in the area of ‚Äã‚Äãinterest, the calculation of the noise level, the definition of suitable settings to minimize interference (both for the new station and for others, if any), expensive equipment, permissions from supervisory services, provision of backup lines communications and food, the work of specialists in installation, configuration and maintenance ... - in general, time and money.  And the more actively radio communication is used in this area, the greater the costs.  First of all it concerns LPWAN networks <br><br>  2. Mobile networks do not scale well by the number of subscribers.  Each device supported by the base station reserves either a frequency (FDMA), or a time slot (TDMA), or a code sequence (CDMA).  All these resources are limited, and when subscribers become too many, the quality of communication begins to suffer: for someone who does not have enough frequency, slot or code, the base station ceases to exist, which in many cases turns into a subscriber‚Äôs loss from the network. <br><br>  <i>At the same time, the growth of the Internet of Things market leads to an avalanche-like growth in the number of devices requiring access to the network.</i>  <i>The number of gadgets is growing exponentially, and developers do not bother to work on communication methods, relying on existing solutions: most smart gadgets either ‚Äúlive‚Äù in the home router‚Äôs network or connect to the Internet through the network of mobile operators.</i>  <i>And often we see a comical situation: devices that are in the same room communicate with each other through cloud services.</i>  <i>And even if there are relatively few such devices now, then very soon the throughput of both communication channels and processing stations is simply not enough.</i>  <i>Goodbye, beautiful life!</i> <br><br>  3. Modern networks are completely non-flexible.  Even in everyday mode, when base conditions change, it is necessary to recalculate and reconfigure base stations, and in case of emergency and emergency situations, the ‚Äúfall‚Äù of one of the stations leads to an abrupt influx of devices to the neighboring ones, which often leads to a fall in the entire network, which is fraught with problems disaster situations or other emergencies. <br><br>  <i>Just remember any New Year when it is impossible to reach anyone, and all subscribers are temporarily not served.</i>  <i>And if the influx during the New Year ends pretty quickly and there are no special reasons to worry, during the rescue events, the presence of at least some connection is a vital factor.</i>  <i>And about the fact that the battery of your favorite smartphone discharges even faster from the network search, you can not speak.</i> <i><br></i> <br><h2>  What to do </h2><br>  The root of all ills is the usual use of the topology of the "star" with a fairly rigid centralization.  That's why we decided to start developing infrastructure for the rapid deployment of a decentralized network called Ad-Hoc or MESH.  The idea is to exclude the ‚Äúweak‚Äù link ‚Äî the base station ‚Äî from the network ‚Äî for which the connectivity features are shifted to subscriber devices.  As a result, each of them, in addition to the role of a consumer of communication services, also plays the role of their supplier for its neighbors.  The devices themselves in such networks are traditionally referred to as nodes.  In such networks, when new nodes appear or existing ones fail, the network automatically rebuilds the routes, keeping it working, which simplifies scaling and makes the whole system unusually flexible.  The need to administer and configure such networks is minimized and can be performed remotely.  That is why the maintenance of wireless MESH networks does not require expensive infrastructure, cabling, installation of base stations and their regular administration, which makes these networks very economical to operate. <br><br>  Obviously, the main feature of the node of a decentralized wireless network are the algorithms that control the routing process, which should be more complex than those in familiar routers.  But since the majority of subscriber devices do not have large computational resources, the applied routing algorithms must be not only highly intelligent, but also not resource-intensive.  This range of tasks was accepted by us as a kind of challenge. <br><br><h2>  What is done </h2><br>  About a year ago, having put forward several hypotheses about what solutions need to be implemented to build a centralized wireless network, we tested them on a specially created simulation model.  Since various types of MESH networks were attempted to be built before us, it was important to overcome the constraint that their developers faced before: it is difficult to combine more than a hundred, and sometimes even a dozen, subscribers in one Ad-Hoc network.  However, the simulation results were encouraging, and we set about implementing. <br><br>  Our first partner was a local company engaged in systems integration and management automation solutions.  We were invited to participate in a project to develop a smart street lighting system, in which our protocol stack would take its rightful place - to ensure the transfer of data.  The partners had to design the hardware and create applications for controlling the lanterns, which would become the ‚Äúclients‚Äù of our stack.  As a result of the discussion of hardware requirements, it was decided to work with NXP LPC1343 microcontrollers and Semtech SX1272 radio transmitters (RFM96) that support the LoRa standard.  At that time, the resources of the selected microcontroller seemed to be enough, and in front of us were a lot of lines of code on pure C. <br><br>  In the minimal implementation, the stack is represented by three levels, between which data is constantly exchanged: the interface level, the routing level, and the service level.  We did not want to devote time and effort to creating our own parallel processing primitives, so it was decided to implement the stack under FreeRTOS (not without problems, but with unexpected successes).  In addition, this solution provided some cross-platform, which would be useful for the further development of the project. <br><br>  To fully validate the stack, we decided to create a separate, open development platform.  We chose the Raspberry Pi as the basis, and made a box for it, which facilitates the installation of the necessary peripherals: LCD-display, GPS-module, board- ‚Äúhats‚Äù for radio modules, etc. ... You can read how it was done in end of article. <br><br>  Despite the economical use of resources of the microcontroller, it was soon discovered that the stack did not fit in a 32 KB FLASH, so the hardware requirements were raised.  Today, the minimum stack version requires the following platform characteristics: <br><br>  <b>MCU: Cortex M3</b> <b><br></b>  <b>OS: FreeRTOS</b> <b><br></b>  <b>FLASH: 128 KB</b> <b><br></b>  <b>EEPROM: 8 KB</b> <b><br></b>  <b>RAM: 32 Kb</b> <br><br>  In addition, to generate pseudo-random numbers, the stack uses an ADC built into the microcontroller, however, if necessary, it can be replaced with any suitable frequency generator with the required cryptographic strength.  In fact, this stack is called MOAR. <br><br><h2>  What to expect next </h2><br>  The next goal we set for ourselves is the development of the GNU / Linux version of the MOAR stack, and with the support - as far as possible - of the POSIX standards.  We believe that there is no need to explain in detail the reasons for this decision in a world where the absolute majority of network devices work, if not under GNU / Linux control, then with an operating system that supports POSIX.  In addition, we plan to publish the source codes of the stack under a free license. <br><br>  The version for GNU / Linux, in contrast to the first, already includes five different levels: the channel level and the presentation level were added to the previously existing ones.  Instead of the queues used in the first version, standard Unix sockets are now used to exchange data between levels.  Each of the levels can be restarted separately from the others, which is much more useful. <br><br>  The stack has an API that we try to bring closer to the familiar socket API.  It seems to us that this approach will greatly facilitate the "move" to developers who will use the stack as a ready-made solution.  In addition, fine-tuning the stack is possible through configuration files, using them on the fly and transferring via the network itself - the simplest implementation of this functionality is already in the first version of the stack, for GNU / Linux it will be developed and expanded. <br><br>  This flexibility and modularity of the stack being developed was chosen not only for aesthetic reasons and ease of development.  Future plans include the implementation of many breathtaking opportunities, such as adaptive routing, using a self-learning neural network to predict the states of its nearest neighbors and route priorities.  Due to the architectural features of our solution, you can change data processing scenarios without the need to reload the entire stack or re-train the neural network.  Other planned features are in the field of information security, and we will describe them in detail later. <br><br>  On December 23, we will publish MOAR stack source codes under a free license and look forward to your questions, ideas, comments, and even forks! <br><br><div class="spoiler">  <b class="spoiler_title">For those who are interested in photos</b> <div class="spoiler_text">  In addition to the release of Open Source DevKit, we plan to post the full information on node assembly.  Under the <a href="https://moarstack.net/assets/doc/moarstack_making_prototype_REV1.1R.pdf">link</a> you can find a brief assembly instructions and a list of necessary details.  If you do not know what to do in the New Year holidays and are tired of answering the question of what to give you for the new year, you can kill a couple of three birds with one volley. <br></div></div><br><br>  <b>UPD.</b>  <a href="https://habrahabr.ru/post/318342/">Release</a> </div><p>Source: <a href="https://habr.com/ru/post/317056/">https://habr.com/ru/post/317056/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../317044/index.html">Why corporate funds can earn more on investment than consumer?</a></li>
<li><a href="../317048/index.html">Limit the speed of traffic. Policer or shaper, what to use on the net?</a></li>
<li><a href="../317050/index.html">Neural networks on JS. Creating a network from scratch</a></li>
<li><a href="../317052/index.html">Android developers have reduced the size of updates by an average of 65%</a></li>
<li><a href="../317054/index.html">6 free CDNs to speed up and improve the security of your site</a></li>
<li><a href="../317058/index.html">Colocation as an option to save on the deployment of its own infrastructure and solving technical problems</a></li>
<li><a href="../317060/index.html">Remote (dev) tools do it yourself - interview with Roman Dvornov (Avito)</a></li>
<li><a href="../317062/index.html">Stepik Contest Global Challenge Contest</a></li>
<li><a href="../317064/index.html">DevOpsDays 2017 Conference: Become a Rapporteur or Participant</a></li>
<li><a href="../317066/index.html">Psychology in the service of information security. Tendency to crime</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>