<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to use UrlManager to set up routing and create ‚Äúfriendly‚Äù URLs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello dear readers! I continue the series of articles on how we developed an atypical, large-scale project using the Yii2 framework and AngularJS. 

 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to use UrlManager to set up routing and create ‚Äúfriendly‚Äù URLs</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/1be/8b4/923/1be8b49239004910a425d7006a6aec36.png"><br>  Hello dear readers!  I continue the series of articles on how we developed an atypical, large-scale project using the Yii2 framework and AngularJS. <br><br>  In the <a href="https://habrahabr.ru/post/304908/">previous article,</a> I described the benefits of the technology stack we chose, and proposed the modular architecture of our <a href="https://carvoy.com/">application</a> . <br><br>  This article focuses on setting up routing and creating a URL using urlManager for each module separately.  I will also sort out the process of creating your own rules for specific URLs by writing a class that extends UrlRuleInterface.  In conclusion, I will describe how we implemented the generation and output of meta tags for public pages of the site. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The most interesting under the cut. <br><a name="habracut"></a><br><h3>  URL Rules </h3><br>  I assume that you most likely have already used UrlManager earlier, at least to turn on the CNC and hide index.php from the URL. <br><br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//... 'urlManager' =&gt; [ 'class' =&gt; 'yii\web\UrlManager', 'enablePrettyUrl' =&gt; true, 'showScriptName' =&gt; false, ], /..</span></span></code> </pre> <br>  But UrlManager can do much more than that.  Beautiful URLs have a great influence on the site‚Äôs search engine results.  You also need to consider that you can hide the structure of your application by defining your own rules. <br><br>  'enableStrictParsing' =&gt; true is a very useful property that restricts access only to rules that are already configured.  In the configuration example, the route <a href="http://www.our-site.com/">www.our-site.com</a> will point to site / default / index, but <a href="http://www.our-site.com/site/default/index">www.our-site.com/site/default/index</a> will show page 404. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//... 'urlManager' =&gt; [ 'class' =&gt; 'yii\web\UrlManager', 'enablePrettyUrl' =&gt; true, 'showScriptName' =&gt; false, 'enableStrictParsing' =&gt; true, 'rules' =&gt; [ '/' =&gt; 'site/default/index', ], ], /..</span></span></code> </pre><br>  Since we have divided the application into modules and want these modules to be as independent as possible from each other, URL rules can be added dynamically to the URL manager.  This will make it possible to distribute and reuse modules without having to tweak UrlManager, because modules will manage their own URLs with rules. <br><br>  In order for dynamically added rules to take effect during the routing process, you must add them during the self-tuning stage.  For modules, this means that they must implement yii \ base \ BootstrapInterface and add rules in the bootstrap () bootstrap method, thus: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">modules</span></span>\<span class="hljs-title"><span class="hljs-title">site</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">base</span></span>\<span class="hljs-title"><span class="hljs-title">BootstrapInterface</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bootstrap</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BootstrapInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@inheritdoc</span></span></span><span class="hljs-comment"> */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bootstrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($app)</span></span></span><span class="hljs-function"> </span></span>{ $app-&gt;getUrlManager()-&gt;addRules( [ <span class="hljs-comment"><span class="hljs-comment">//    '' =&gt; 'site/default/index', '&lt;_a:(about|contacts)&gt;' =&gt; 'site/default/&lt;_a&gt;' ] ); } }</span></span></code> </pre><br>  The file Bootstrap.php with this code is added to the module folder / modules / site /.  And we will have such a file in every module that will add its own Url rules. <br><br>  Note that you must also list these modules in yii \ web \ Application :: bootstrap () so that they can participate in the self-tuning process.  To do this, in the /frontend/config/main.php file, list the modules in the bootstrap array: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//... 'params' =&gt; require(__DIR__ . '/params.php'), 'bootstrap' =&gt; [ 'modules\site\Bootstrap', 'modules\users\Bootstrap', 'modules\cars\Bootstrap' 'modules\lease\Bootstrap' 'modules\seo\Bootstrap' ], ];</span></span></code> </pre><br>  Please note that since writing the first article I have added a few more modules: <br><br><ul><li>  modules / users - Module in which operations with the user and all user pages will be processed (registration, login, personal account) </li><li>  modules / cars - The module in which they will work with the database of brands, brands, vehicle modifications. </li><li>  modules / lease - Module in which ads added by users will be processed. </li><li>  modules / seo - Module for SEO.  All components and helpers that will help us meet SEO requirements will be stored here.  I will write about them further. </li></ul><br><h3>  Custom URL Rules </h3><br>  Although the standard class yii \ web \ UrlRule is quite flexible for most projects, there are situations where you have to create your own rule classes. <br><br>  For example, on a car dealer website, you can support a URL format like / new-lease / state / Make-Model-Location / Year, where state, Make, Model, Year and Location must match some data stored in the base table data.  The default class will not work here, since it relies on statically declared patterns. <br><br>  A little distracted from the code, and I will describe to you the essence of the task that confronted us. <br><br>  According to the specification, we needed to make the following types of pages with the corresponding rules for creating Url and meta tags: <br><br><h4>  Search results pages </h4><br>  They, in turn, are divided into three types: <br><br>  Dealer Ads <br><blockquote>  url: / new-lease / (state) / (Make) - (Model) - (Location) <br>  url: / new-lease / (state) / (Make) - (Model) - (Location) / (Year) </blockquote><br>  Custom ads: <br><blockquote>  url: / lease-transfer / (state) / (Make) - (Model) - (Location) <br>  url: / lease-transfer / (state) / (Make) - (Model) - (Location) / (Year) </blockquote><br>  For example: / new-lease / NY / volkswagen-GTI-New-York-City / 2015 <br><br>  Search results when the location is not specified in the filter: <br>  / (new-lease | lease-transfer) / (Make) - (Model) / (year) <br><br><blockquote>  Title: (Make) (Model) (Year) for Lease in (Location).  (New Leases | Lease Transfers) <br>  For example: Volkswagen GTI 2015 for Lease in New York City.  Dealer Leases. <br>  Keywords: (Make), (Model), (Year), for, Lease, in, (Location), (New, Leases | Lease, Transfers) <br>  Description: List of (Make) (Model) (Year) in (Location) available for lease.  (Dealer Leases | Lease Transfers). </blockquote><br><h4>  Ad Review Page </h4><br>  They, in turn, are divided into two types: <br><br>  Dealer ad: <br>  url: / new-lease / (state) / (make) - (model) - (year) - (color) - (fuel type) - (location) - (id) <br><br>  Custom ad: <br>  url: / lease-transfer / (state) / (make) - (model) - (year) - (color) - (fuel type) - (location) - (id) <br><br><blockquote>  Title: (make) - (model) - (year) - (color) - (fuel type) for lease in (location) <br>  Keywords: (year), (make), (model), (color), (fuel type), (location), for, lease <br>  Description: (year) (make) (model) (color) (fuel type) for lease (location) </blockquote><br><h4>  Information pages about the car </h4><br><blockquote>  url: / i / (make) - (model) - (year) <br>  Title: (make) - (model) - (year) <br>  Keywords: (year), (make), (model) <br>  Description: (year), (make), (model) </blockquote><br>  This is only part of the pages that we needed to implement.  An excerpt from the technical assignment is given here so that you understand what we need to achieve from the Url manager and how far these are non-trivial rules. <br><br>  Yii2 allows you to define custom URLs through parsing and URL generation logic by making a custom UrlRule class.  If you want to make your own UrlRule, you can either copy the code from yii \ web \ UrlRule and expand it or, in some cases, simply implement yii \ web \ UrlRuleInterface. <br><br>  Below is the code that was written by our team for the URL structure we discussed.  For it, we created the file / modules/seo/components/UrlRule.php.  I do not consider this code a standard, but I am sure that it definitely performs the task. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">modules</span></span>\<span class="hljs-title"><span class="hljs-title">seo</span></span>\<span class="hljs-title"><span class="hljs-title">components</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">modules</span></span>\<span class="hljs-title"><span class="hljs-title">seo</span></span>\<span class="hljs-title"><span class="hljs-title">models</span></span>\<span class="hljs-title"><span class="hljs-title">Route</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">modules</span></span>\<span class="hljs-title"><span class="hljs-title">zipdata</span></span>\<span class="hljs-title"><span class="hljs-title">models</span></span>\<span class="hljs-title"><span class="hljs-title">Zip</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">helpers</span></span>\<span class="hljs-title"><span class="hljs-title">Json</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Yii</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">web</span></span>\<span class="hljs-title"><span class="hljs-title">UrlRuleInterface</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UrlRule</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UrlRuleInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($manager, $route, $params)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Lease module create urls */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($route === <span class="hljs-string"><span class="hljs-string">'lease/lease/view'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($params[<span class="hljs-string"><span class="hljs-string">'state'</span></span>], $params[<span class="hljs-string"><span class="hljs-string">'node'</span></span>], $params[<span class="hljs-string"><span class="hljs-string">'role'</span></span>])) { $role = ($params[<span class="hljs-string"><span class="hljs-string">'role'</span></span>] == <span class="hljs-string"><span class="hljs-string">'dealer'</span></span>) ? <span class="hljs-string"><span class="hljs-string">'new-lease'</span></span> : <span class="hljs-string"><span class="hljs-string">'lease-transfer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $role . <span class="hljs-string"><span class="hljs-string">'/'</span></span> . $params[<span class="hljs-string"><span class="hljs-string">'state'</span></span>] . <span class="hljs-string"><span class="hljs-string">'/'</span></span> . $params[<span class="hljs-string"><span class="hljs-string">'node'</span></span>]; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($route === <span class="hljs-string"><span class="hljs-string">'lease/lease/update'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($params[<span class="hljs-string"><span class="hljs-string">'state'</span></span>], $params[<span class="hljs-string"><span class="hljs-string">'node'</span></span>], $params[<span class="hljs-string"><span class="hljs-string">'role'</span></span>])) { $role = ($params[<span class="hljs-string"><span class="hljs-string">'role'</span></span>] == <span class="hljs-string"><span class="hljs-string">'dealer'</span></span>) ? <span class="hljs-string"><span class="hljs-string">'new-lease'</span></span> : <span class="hljs-string"><span class="hljs-string">'lease-transfer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $role . <span class="hljs-string"><span class="hljs-string">'/'</span></span> . $params[<span class="hljs-string"><span class="hljs-string">'state'</span></span>] . <span class="hljs-string"><span class="hljs-string">'/'</span></span> . $params[<span class="hljs-string"><span class="hljs-string">'node'</span></span>] . <span class="hljs-string"><span class="hljs-string">'/edit/update'</span></span>; } } <span class="hljs-comment"><span class="hljs-comment">/** * Information Pages create urls */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($route === <span class="hljs-string"><span class="hljs-string">'cars/info/view'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($params[<span class="hljs-string"><span class="hljs-string">'node'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'i/'</span></span> . $params[<span class="hljs-string"><span class="hljs-string">'node'</span></span>]; } } <span class="hljs-comment"><span class="hljs-comment">/** * Search Pages create urls */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($route === <span class="hljs-string"><span class="hljs-string">'lease/search/view'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($params[<span class="hljs-string"><span class="hljs-string">'url'</span></span>])) { $params[<span class="hljs-string"><span class="hljs-string">'url'</span></span>] = str_replace(<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'_'</span></span>, $params[<span class="hljs-string"><span class="hljs-string">'url'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($search_url = Route::findRouteByUrl($params[<span class="hljs-string"><span class="hljs-string">'url'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'/'</span></span>.$params[<span class="hljs-string"><span class="hljs-string">'url'</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $route = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Route(); $route-&gt;url = str_replace(<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'_'</span></span>, substr($params[<span class="hljs-string"><span class="hljs-string">'url'</span></span>],<span class="hljs-number"><span class="hljs-number">1</span></span>) ); $route-&gt;route = <span class="hljs-string"><span class="hljs-string">'lease/search/index'</span></span>; $route-&gt;params = json_encode([<span class="hljs-string"><span class="hljs-string">'make'</span></span>=&gt;$params[<span class="hljs-string"><span class="hljs-string">'make'</span></span>], <span class="hljs-string"><span class="hljs-string">'model'</span></span>=&gt;$params[<span class="hljs-string"><span class="hljs-string">'model'</span></span>], <span class="hljs-string"><span class="hljs-string">'location'</span></span>=&gt;$params[<span class="hljs-string"><span class="hljs-string">'location'</span></span>] ]); $route-&gt;save(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'/'</span></span>.$params[<span class="hljs-string"><span class="hljs-string">'url'</span></span>]; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($params[<span class="hljs-string"><span class="hljs-string">'type'</span></span>]) &amp;&amp; in_array($params[<span class="hljs-string"><span class="hljs-string">'type'</span></span>], [<span class="hljs-string"><span class="hljs-string">'user'</span></span>,<span class="hljs-string"><span class="hljs-string">'dealer'</span></span>])) { $type = ($params[<span class="hljs-string"><span class="hljs-string">'type'</span></span>] == <span class="hljs-string"><span class="hljs-string">'dealer'</span></span>)? <span class="hljs-string"><span class="hljs-string">'new-lease'</span></span> : <span class="hljs-string"><span class="hljs-string">'lease-transfer'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($params[<span class="hljs-string"><span class="hljs-string">'zip'</span></span>]) &amp;&amp; !<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($params[<span class="hljs-string"><span class="hljs-string">'zip'</span></span>])) || (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($params[<span class="hljs-string"><span class="hljs-string">'location'</span></span>]) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($params[<span class="hljs-string"><span class="hljs-string">'state'</span></span>]))) { <span class="hljs-comment"><span class="hljs-comment">// make model price zip type if (isset($params['zip']) &amp;&amp; !empty($params['zip'])) { $zipdata = Zip::findOneByZip($params['zip']); } else { $zipdata = Zip::findOneByLocation($params['location'], $params['state']); } // city state_code if (!empty($zipdata)) { $url = $type . '/' . $zipdata['state_code'] . '/' . $params['make'] . '-' . $params['model'] . '-' . $zipdata['city']; if (!empty($params['year'])) { $url.='/'.$params['year']; } $url = str_replace(' ', '_', $url); if($search_url = Route::findRouteByUrl($url)) { return '/'.$url; } else { $route = new Route(); $route-&gt;url = str_replace(' ','_',$url); $route-&gt;route = 'lease/search/index'; $pars = ['make'=&gt;$params['make'], 'model'=&gt;$params['model'], 'location'=&gt;$zipdata['city'], 'state'=&gt;$zipdata['state_code'] ]; //, 'zip'=&gt;$params['zip'] ]; if (!empty($params['year'])) { $pars['year']=$params['year']; } $route-&gt;params = json_encode($pars); $route-&gt;save(); return $route-&gt;url; } } } if (isset($params['make'], $params['model'] )) { $url = $type . '/' . $params['make'] . '-' . $params['model'] ; if (!empty($params['year'])) { $url.='/'.$params['year']; } $url = str_replace(' ', '_', $url); if($search_url = Route::findRouteByUrl($url)) { return '/'.$url; } else { $route = new Route(); $route-&gt;url = str_replace(' ','_',$url); $route-&gt;route = 'lease/search/index'; $pars = ['make'=&gt;$params['make'], 'model'=&gt;$params['model'] ]; if (!empty($params['year'])) { $pars['year']=$params['year']; } $route-&gt;params = json_encode($pars); $route-&gt;save(); return $route-&gt;url; } } } return false; } /** * Parse request * @param \yii\web\Request|UrlManager $manager * @param \yii\web\Request $request * @return array|boolean */ public function parseRequest($manager, $request) { $pathInfo = $request-&gt;getPathInfo(); /** * Parse request for search URLs with location and year */ if (preg_match('%^(?P&lt;role&gt;lease-transfer|new-lease)\/(?P&lt;state&gt;[A-Za-z]{2})\/(?P&lt;url&gt;[._\sA-Za-z-0-9-]+)\/(?P&lt;year&gt;\d{4})?%', $pathInfo, $matches)) { $route = Route::findRouteByUrl($pathInfo); if (!$route) { return false; } $params = [ 'node' =&gt; $matches['url'] . '/' . $matches['year'], 'role' =&gt; $matches['role'], 'state' =&gt; $matches['state'], 'year' =&gt; $matches['year'] ]; if (!empty($route['params'])) { $params = array_merge($params, json_decode($route['params'], true)); } return [$route['route'], $params]; } /** * Parse request for search URLs with location and with year */ if (preg_match('%^(?P&lt;role&gt;lease-transfer|new-lease)\/(?P&lt;url&gt;[._\sA-Za-z-0-9-]+)\/(?P&lt;year&gt;\d{4})%', $pathInfo, $matches)) { $route = Route::findRouteByUrl($pathInfo); if (!$route) { return false; } $params = [ 'node' =&gt; $matches['url'] . '/' . $matches['year'], 'role' =&gt; $matches['role'], 'year' =&gt; $matches['year'] ]; if (!empty($route['params'])) { $params = array_merge($params, json_decode($route['params'], true)); } return [$route['route'], $params]; } /** * Parse request for leases URLs and search URLs with location */ if (preg_match('%^(?P&lt;role&gt;lease-transfer|new-lease)\/(?P&lt;state&gt;[A-Za-z]{2})\/(?P&lt;url&gt;[_A-Za-z-0-9-]+)?%', $pathInfo, $matches)) { $route = Route::findRouteByUrl([$matches['url'], $pathInfo]); if (!$route) { return false; } $params = [ 'role' =&gt; $matches['role'], 'node' =&gt; $matches['url'], 'state' =&gt; $matches['state'] ]; if (!empty($route['params'])) { $params = array_merge($params, json_decode($route['params'], true)); } return [$route['route'], $params]; } /** * Parse request for search URLs without location and year */ if (preg_match('%^(?P&lt;role&gt;lease-transfer|new-lease)\/(?P&lt;url&gt;[._\sA-Za-z-0-9-]+)?%', $pathInfo, $matches)) { $route = Route::findRouteByUrl($pathInfo); if (!$route) { return false; } $params = [ 'node' =&gt; $matches['url'], 'role' =&gt; $matches['role'], ]; if (!empty($route['params'])) { $params = array_merge($params, json_decode($route['params'], true)); } return [$route['route'], $params]; } /** * Parse request for Information pages URLs */ if (preg_match('%^i\/(?P&lt;url&gt;[_A-Za-z-0-9-]+)?%', $pathInfo, $matches)) { $route = Route::findRouteByUrl($matches['url']); if (!$route) { return false; } $params = Json::decode($route['params']); $params['node'] = $route['url']; return [$route['route'], $params]; } return false; } }</span></span></code> </pre><br>  In order to use it, you only need to add this class to the array of rules yii \ web \ UrlManager :: $ rules. <br><br>  To do this, create the Bootstrap.php file in the / modules / seo module (similar to the Bootstrap.php file in the / modules / site module) and declare the following rule in it: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//... public function bootstrap($app) { $app-&gt;getUrlManager()-&gt;addRules( [ [ 'class' =&gt; 'modules\seo\components\UrlRule, ], ] ); } /..</span></span></code> </pre><br>  This special rule is intended for a very specific use case.  We do not plan to reuse this rule in other projects, so it has no settings. <br><br>  Since the rule is not configurable, there is no need to extend from yii \ web \ UrlRule, yii \ base \ Object, or from anything else.  Just implement the interface yii \ web \ UrlRuleInterface.  Because we do not plan to reuse this rule in our reusable modules, we defined it in the SEO module. <br><br>  parseRequest () scans the route, and if it matches the regular expression in the condition, it parses further to extract the parameters. <br><br>  In this method, we use the auxiliary Route model, in which the generated links are stored in the url field.  According to them, the search for compliance with the findRouteByUrl method takes place.  This method returns us one record from the table (in case there is one) with fields: <br><br><ul><li>  url - part of the search query for which the entry was found, </li><li>  route - a route to which control must be transferred, </li><li>  params - additional, parameters in the format of JSON string that must be passed to the action for further work. </li></ul><br>  parseRequest () returns an array with an action and parameters: <br><br><pre> <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'lease/search/view'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'node'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>-lease/NY/ volkswagen-GTI-<span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-York-City/<span class="hljs-number"><span class="hljs-number">2016</span></span>, <span class="hljs-string"><span class="hljs-string">'role'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'new-lease'</span></span>, <span class="hljs-string"><span class="hljs-string">'state'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'NY'</span></span>, <span class="hljs-string"><span class="hljs-string">'year'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'2016'</span></span> ] ]</code> </pre><br>  Otherwise, it returns false to indicate to the UrlManager that it cannot parse the request. <br><br>  createUrl () builds a URL from the provided parameters, but only if the URL has been proposed for action lease / lease / view, cars / info / view or lease / search / view. <br><br><h3>  For performance reasons </h3><br>  When developing complex web applications, it is important to optimize URL rules so that it takes less time to parse requests and create URLs. <br><br>  When analyzing or creating a URL, the URL manager analyzes the URL rules in the order in which they were declared.  Thus, you can consider adjusting the order of URL rules so that more specific and / or frequently used rules are placed before less used rules. <br><br>  It is often found that your application consists of modules, each of which has its own set of URL rules with a module ID, as well as their common prefix. <br><br><h3>  Generate and output meta tags </h3><br>  In order to generate and display meta tags in a specific format for the specified page types, a special helper was written, which is located in the modules / seo / helpers / Meta.php file.  It contains the following code: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">modules</span></span>\<span class="hljs-title"><span class="hljs-title">seo</span></span>\<span class="hljs-title"><span class="hljs-title">helpers</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Yii</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">helpers</span></span>\<span class="hljs-title"><span class="hljs-title">Html</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@package</span></span></span><span class="hljs-comment"> modules\seo\helpers */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *  meta  title, keywords, description     . * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $type  ,    meta  * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> object $model * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string $title   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">all</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($type, $model = null)</span></span></span><span class="hljs-function"> </span></span>{ $title = <span class="hljs-string"><span class="hljs-string">'Carvoy | A new generation of leasing a car!'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   -. switch ($type) { case 'home': $title = 'Carvoy | A new generation of leasing a car!'; Yii::$app-&gt;view-&gt;registerMetaTag(['name' =&gt; 'keywords','content' =&gt; 'lease, car, transfer']); Yii::$app-&gt;view-&gt;registerMetaTag(['name' =&gt; 'description','content' =&gt; 'Carvoy - Change the way you lease! Lease your next new car online and we\'ll deliver it to your doorstep.']); break; case 'lease': $title = $model-&gt;make . ' - ' . $model-&gt;model . ' - ' . $model-&gt;year . ' - ' . $model-&gt;exterior_color . ' - ' . $model-&gt;engineFuelType . ' for lease in ' . $model-&gt;location; Yii::$app-&gt;view-&gt;registerMetaTag(['name' =&gt; 'keywords','content' =&gt; Html::encode($model-&gt;year . ', ' . $model-&gt;make . ', ' . $model-&gt;model . ', ' . $model-&gt;exterior_color . ', ' . $model-&gt;engineFuelType . ', ' . $model-&gt;location . ', for, lease')]); Yii::$app-&gt;view-&gt;registerMetaTag(['name' =&gt; 'description','content' =&gt; Html::encode($model-&gt;year . ' ' . $model-&gt;make . ' ' . $model-&gt;model . ' ' . $model-&gt;exterior_color . ' ' . $model-&gt;engineFuelType . ' for lease in ' . $model-&gt;location)]); break; case 'info_page': $title = $model-&gt;make . ' - ' . $model-&gt;model . ' - ' . $model-&gt;year; Yii::$app-&gt;view-&gt;registerMetaTag(['name' =&gt; 'keywords','content' =&gt; Html::encode($model-&gt;year . ', ' . $model-&gt;make . ', ' . $model-&gt;model)]); Yii::$app-&gt;view-&gt;registerMetaTag(['name' =&gt; 'description','content' =&gt; Html::encode($model-&gt;year . ' ' . $model-&gt;make . ' ' . $model-&gt;model)]); break; case 'search': if ($model['role'] == 'd') $role = 'Dealer Lease'; elseif ($model['role'] == 'u') $role = 'Lease Transfers'; else $role = 'All Leases'; if (isset($model['make']) &amp;&amp; isset($model['model'])) { $_make = (is_array($model['make']))? (( isset($model['make']) &amp;&amp; ( count($model['make']) == 1) )? $model['make'][0] : false ) : $model['make']; $_model = (is_array($model['model']))? (( isset($model['model']) &amp;&amp; ( count($model['model']) == 1) )? $model['model'][0] : false ) : $model['model']; $_year = false; $_location = false; if (isset($model['year'])) { $_year = (is_array($model['year']))? (( isset($model['year']) &amp;&amp; ( count($model['year']) == 1) )? $model['year'][0] : false ) : $model['year']; } if (isset($model['location'])) { $_location = (is_array($model['location']))? (( isset($model['location']) &amp;&amp; ( count($model['location']) == 1) )? $model['location'][0] : false ) : $model['location']; } if ( ($_make || $_model) &amp;&amp; !(isset($model['make']) &amp;&amp; ( count($model['make']) &gt; 1)) ) { $title = $_make . (($_model)? ' ' . $_model : '') . (($_year)? ' ' . $_year : '') . ' for Lease' . (($_location)? ' in ' . $_location . '. ' : '. ') . $role . '.'; } else { $title = 'Vehicle for Lease' . (($_location)? ' in ' . $_location . '. ' : '. ') . $role . '.'; } Yii::$app-&gt;view-&gt;registerMetaTag(['name' =&gt; 'keywords','content' =&gt; Html::encode( ltrim($_make . (($_model)? ', ' . $_model : '') . (($_year)? ', ' . $_year : '') . ', for, Lease' . (($_location)? ', in, ' . $_location : '') . ', ' . implode(', ', (explode(' ', $role))), ', ') ) ]); Yii::$app-&gt;view-&gt;registerMetaTag(['name' =&gt; 'description','content' =&gt; Html::encode( 'List of '. ((!$_model &amp;&amp; !$_make)? 'Vehicles' : '') . $_make . (($_model)? ' ' . $_model : '') . (($_year)? ' ' . $_year : '') . (($_location)? ' in ' . $_location : '') . ' available for lease. ' . $role . '.' )]); } else { $title = 'Search results'; } break; } return $title; } }</span></span></code> </pre><br>  We use this helper in the view page for which you want to set meta tags.  For example, for the ad viewing page, add the following line to the file / modules/lease/views/frontend/lease/view.php <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//... $this-&gt;title = \modules\seo\helpers\Meta::all('lease', $model); /..</span></span></code> </pre><br>  The first parameter to the method is the type of page for which meta tags are generated.  The second parameter is the current ad model. <br><br>  Meta tags are generated inside the method depending on the page type and added to the head using the registerMetaTag method of the yii \ web \ View class.  The method returns us the generated string for the title tag.  Thus, through the $ title property of the yii \ web \ View class, we set the page title. <br><br>  Thanks for attention! <br><br>  Material prepared: <a href="https://habrahabr.ru/users/greebn9k/" class="user_link">greebn9k</a> (Sergey Gribnyak), <a href="https://habrahabr.ru/users/pavel-berezhnoy/" class="user_link">pavel-berezhnoy</a> (Pavel Berezhnoy), <a href="https://habrahabr.ru/users/silmarilion/" class="user_link">silmarilion</a> (Andrey Khakharev) </div><p>Source: <a href="https://habr.com/ru/post/308948/">https://habr.com/ru/post/308948/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../308936/index.html">UDL support</a></li>
<li><a href="../308938/index.html">Errors of questionnaires. Error 2: questionnaire wording. 13 cases of misunderstanding and manipulation in the survey (part 1)</a></li>
<li><a href="../308940/index.html">iKnow Review Analyzer (iKRA)</a></li>
<li><a href="../308944/index.html">Check the speed of the promis</a></li>
<li><a href="../308946/index.html">Finding errors in the GCC compiler code using the PVS-Studio analyzer</a></li>
<li><a href="../308950/index.html">Half-HA cluster PostgreSQL on Windows 2012</a></li>
<li><a href="../308952/index.html">Porting a portfolio from Brainstorage to Freelansim</a></li>
<li><a href="../308954/index.html">How-to: interactive writing guide</a></li>
<li><a href="../308956/index.html">Microsoft Azure StorSimple: easy access to hybrid cloud. Part 1</a></li>
<li><a href="../308958/index.html">In the new list of the most profitable IT companies in Russia, 50% of the seats are occupied by foreign firms.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>