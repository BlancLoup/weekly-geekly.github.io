<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Monitoring system, are you sure that it works?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Our company is engaged in server maintenance. Monitoring for us is a supercritical system, its refusal can lead to large financial losses. Another mon...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Monitoring system, are you sure that it works?</h1><div class="post__text post__text-html js-mediator-article">  Our company is engaged in server maintenance.  Monitoring for us is a supercritical system, its refusal can lead to large financial losses.  Another monitoring system can monitor the physical accessibility of monitoring, but logical errors ... <br><br>  I will tell the story of one mistake, what conclusions we made, and how we changed the approach to the monitoring system.  There will be no code lines, it will be about ideology.  Who cares, welcome tackle. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4b/do/6q/4bdo6qk_023docm7xsqfqq3wotu.jpeg"></div><a name="habracut"></a><br>  Input: There are several hundred customers.  There is a monitoring system zabbix.  For each client, a separate group is established, in which all client servers are located.  New hosts are added automatically.  The client has access to metrics by the hosts in their group.  There is one special host that checks the availability of all client sites.  All triggers lead to the creation of a task in redmine.  This is how our monitoring looked a couple of years ago. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It all started with a simple request from the client to provide access to monitoring accessibility of the site.  As you remember, we have one for all clients and we could not give access.  And wrap ... <br><br><h3>  Part One: Epic Fail, We Found You </h3><br>  We sat down, pondered and decided that it was high time to make such a special host for each client and give access to the metrics.  Admins are lazy people, they didn‚Äôt want to copy with their hands.  They wrote a script that will sort out all the projects, create and transfer all the necessary metrics and triggers.  The script, tested "on cats", worked like a Swiss watch. <br><br>  Run the script in production, and to our amazement, he throws out the bag and a small cart of errors.  A cursory analysis shows that metrics are collected, and there are no triggers for them!  Problem checks accumulated about 10%.  It seems not so much, but the situation itself is extremely sad.  The client will call: ‚ÄúOur site has fallen!‚Äù And what will we answer?  ‚ÄúThank you for reporting, we ourselves do not know ...‚Äù?  And if the site lay 10 hours?  We were lucky we found the problem before she fired. <br><br><h3>  Part two: who is to blame and what to do </h3><br>  Guilty were found.  The reason turned out to be trivial: adding new checks, lazy and cloned existing ones.  Sometimes they forgot to click clone and change the settings of the current trigger.  Yes, yes, this is shame and shame.  But if you can make a mistake, sooner or later a person will make it.  The first conclusion: the human factor always works. <br><br>  What to do?  Of course, write another script that will create triggers where they are missing.  One could add this script to cron and close this situation.  But we eliminated the consequences, not the problem.  Let me remind you the problem: the human factor always works. <br><br>  We analyzed and identified tasks that can be fully or partially automated. <br><br>  We have automated all work related to the addition of templates.  We wrote scripts that create checks, the admin needs only to set the input data. Need to add a site availability check?  Just run the script --url site.com.  Need to add a host to maintenance?  Run the script ... Well, you understand.  We even added functionality for checking for updates in git so that everyone is guaranteed to use the latest version of the scripts.  We also wrote a script that does all possible checks for errors, disabled hosts, hosts left in maintenance, etc.  etc.  And we began to live joy and fun.  Happy end. <br><br><h3>  Part Three: A New Wave of Problems </h3><br>  It would seem that happiness has come.  But early we were delighted.  One fine Friday evening, as usual, a colleague wrote: "I have no templates for a dozen hosts."  Let me remind you that the process is automated, the script looks at the roles in the configuration system and hooks the necessary templates.  On Friday evening, no one wants to take on such a thing.  We ask a colleague to wait half an hour, suddenly it will improve itself.  An hour passed, the second, the third ... The templates did not catch on.  Nowhere to go, climbed to watch.  It turned out that after the next update, some of the scripts stopped working.  At the same time, making changes, we did selective testing, but it was the failed scripts that did not fit into the sample. <br><br>  Since one person is involved in monitoring, the culprit was obvious.  They did not punish, but asked: "What should be done so that this does not happen again?" <br><br>  What to do?  Of course, write autotests.  Now we have all the scripts to deploy on the server autotests. <br><br><h3>  Epilogue </h3><br>  After reading this article, someone will say: "Shame, how can you work this way?" But have you never deleted the prod database yourself ??  Even in Gitlab this happened ... We are not afraid of mistakes, each file gives us the opportunity to make the company better.  The main thing is to find and eliminate the causes, and not to treat the symptoms. <br><br>  Are you sure that your monitoring system is 100% healthy? <br><br>  PS: While working on the article, I caught myself thinking that in devops the work of ops is more and more like dev.  So, do not reinvent the wheel, we will take practices and tools from dev and use in ops. <br><br>  PSS: We do not show code samples, because the code is tailored to our needs and our architecture.  But if you're interested, write in the comments, and we'll upload the code on github. </div><p>Source: <a href="https://habr.com/ru/post/341294/">https://habr.com/ru/post/341294/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341276/index.html">Safety Issues of Smart Energy</a></li>
<li><a href="../341278/index.html">What is good (and bad) Typescript: experience of UI-developers</a></li>
<li><a href="../341280/index.html">Shutdown PC anywhere in the world (JAVA)</a></li>
<li><a href="../341282/index.html">Google Analytics API for a marketer on a practical example</a></li>
<li><a href="../341288/index.html">‚ÄúSometimes you have to look into the Spark code‚Äù: Alexander Morozov (SEMrush) about using Scala, Spark and ClickHouse</a></li>
<li><a href="../341296/index.html">An extraordinary charge: how we have automated the park</a></li>
<li><a href="../341298/index.html">Listen to traffic and increase the loyalty of bank customers: myth or reality</a></li>
<li><a href="../341300/index.html">Extreme Networks is making Network Fabrics a reality</a></li>
<li><a href="../341302/index.html">Beauty go</a></li>
<li><a href="../341304/index.html">Do not confuse software development and programming.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>