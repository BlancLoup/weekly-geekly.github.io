<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Building RESTful Message Based Web Services on WCF</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 I already wrote about how to make a SOAP Message Based web service on WCF . And now I want to talk about the design and construction of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Building RESTful Message Based Web Services on WCF</h1><div class="post__text post__text-html js-mediator-article"><h3>  Introduction </h3><br>  I already wrote about <a href="http://habrahabr.ru/post/223685/">how to make a SOAP Message Based web service on WCF</a> .  And now I want to talk about the design and construction of RESTful Message Based web services on WCF.  Understanding this article requires basic knowledge of <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">REST</a> and how to create RESTful web services on WCF.  To familiarize yourself with RESTful web services you can find: <a href="http://msdn.microsoft.com/en-us/library/dd203052.aspx">A Guide to Designing and Building RESTful Web Services with WCF 3.5</a> . <br><br>  In the article I will try to uncover and solve the problems of RESTful design.  You will learn how to build a RESTful web service that: <br><ul><li>  It has a stable and versatile interface. </li><li>  Transmits data according to the <a href="http://martinfowler.com/eaaCatalog/dataTransferObject.html">DTO</a> pattern. </li></ul><br><a name="habracut"></a><br>  Let's design a WCF web service for Santa Claus.  Santa loves the architectural style of REST and does not like the <a href="http://en.wikipedia.org/wiki/Open_Data_Protocol">Open Data Protocol (OData) at all</a> , so he put forward the following requirements: <br><ul><li>  The service must have a RESTful API </li><li>  The service should have the following functionality: <ul><li>  Saving a request for a gift. </li><li>  Update request for a gift. </li><li>  Receipt of a request for a gift by status and country. </li><li>  Deleting a gift request by Id. </li></ul></li></ul><br><h3>  Identify key business objects </h3><br>  Our goal is to design a RESTful web service, so let's keep business objects as simple as possible. <br><br>  Consider the class <b>Request for a gift</b> (hereinafter PresentRequest).  PresentRequest is an <a href="http://martinfowler.com/bliki/DDD_Aggregate.html">aggregate</a> and contains all the necessary information about desire. <br><div class="spoiler">  <b class="spoiler_title">PresentRequest</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PresentRequest</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Address Address { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Guid Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> PresentRequestStatus Status { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Wish { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Address</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Address</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Country { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Recipient { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> StreetAddress { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ZipCode { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">PresentRequestStatus</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> PresentRequestStatus { Pending, Accepted, Rejected, Completed }</code> </pre></div></div><br>  Now we have everything you need to start. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  RESTful WCF Web Service: The Problem of Design </h3><br>  In this step, we define the web service interface.  Let's start with the <code>Save</code> method. <br><br><h5>  Preservation PresentRequest </h5><br>  The simplest implementation will look like this: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PresentRequest request</span></span></span><span class="hljs-function">)</span></span></code> </pre><br>  The client fills in all the fields and sends a request for a web service.  The <code>Save</code> method returns <code>void</code> , since  we know that the service will be heavily loaded, so the generation of a unique <code>Id</code> falls on the client‚Äôs shoulders. <br><br>  In accordance with the RESTful design style, we must decorate the <code>Save</code> method with the <code>WebInvoke</code> attribute and specify the appropriate HTTP method.  Here is a small cheat sheet for HTTP methods: <br><table><tbody><tr><td>  <b>Operation</b> <br></td><td>  <b>HTTP</b> <br></td></tr><tr><td>  Create <br></td><td>  PUT / POST <br></td></tr><tr><td>  Read <br></td><td>  Get <br></td></tr><tr><td>  Update <br></td><td>  PUT / PATCH <br></td></tr><tr><td>  Delete <br></td><td>  DELETE <br></td></tr></tbody></table>  As a result, we get the following <i>ServiceContract</i> : <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ServiceContract</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IPresentRequestService</span></span> { [WebInvoke(Method = <span class="hljs-string"><span class="hljs-string">"POST"</span></span>, UriTemplate = <span class="hljs-string"><span class="hljs-string">"requests"</span></span>)] [OperationContract] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PresentRequest request</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre><br>  <i>Note: ServiceContract is the main part of the service, which should have stability and flexibility.</i>  <i>All customers are dependent on ServiceContract, so we must be very careful with any changes in the contract.</i> <br><br>  The Save method has both advantages and disadvantages. <br>  <b>Pros</b> : <br><ul><li>  The method is abstract, so we can easily add fields to the <code>PresentRequest</code> </li><li>  The request is sent as an object, not as URL parameters </li></ul><br>  Most developers know from the book <a href="http://">Mythical Man-Month</a> that the first version of the software will be thrown away.  The same applies to <i>ServiceContract</i> , so we must try to make it as flexible as possible. <br>  <b>Cons</b> : <br><ul><li>  We must have as many <code>Save</code> methods as we will have different <code>PresentRequest</code> objects.  But what about <a href="http://en.wikipedia.org/wiki/Object-oriented_programming">OOP</a> ? </li></ul><br>  I know about <a href="http://">KnownTypeAttribute</a> , but we will have to create a useless class hierarchy only for the deserialization process. <br><br>  The <code>Create</code> , <code>Update</code> and <code>Delete</code> operations have similar pros and cons.  The Get operation is different and appears, in my opinion, the most difficult to follow method. <br><br><h5>  Getting PresentRequests </h5><br>  For the Get operation, the parameters are sent in <a href="http://en.wikipedia.org/wiki/Query_string">the query string</a> .  In our case, to get the <code>PresentRequest</code> by status and country, we need to create something like <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">WebGet(UriTemplate = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"requests?country={country}&amp;status={status}"</span></span></span><span class="hljs-meta">)</span></span>] [OperationContract] <span class="hljs-function"><span class="hljs-function">List&lt;PresentRequest&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> country, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> status</span></span></span><span class="hljs-function">)</span></span>;</code> </pre><br>  <b>Pros</b> : <br><ul><li>  A readable URL, such as <a href="http://santaclaus.org/requests%3Fcountry%3Dsheldonopolis%26status%3Dpending">SantaClaus.org/requests?country=sheldonopolis&amp;status=pending</a> . </li></ul><br>  Before listing the deficiencies, let's take a look at the <code>Get</code> method.  Imagine that we use this method inside our application, without WCF. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IPresentRequestService</span></span> { <span class="hljs-function"><span class="hljs-function">List&lt;PresentRequest&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> country, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> status</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre><br>  One of the biggest problems with this method is the signature.  We will need to update the service implementation after any changes in the method signature.  This method is fragile and has a smell.  Thus, a RESTful <code>Get</code> operation is difficult to maintain by default. <br>  Here is a better solution, we can change the request without changing the interface: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IPresentRequestService</span></span> { <span class="hljs-function"><span class="hljs-function">List&lt;PresentRequest&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PresentRequestQuery query</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre><br>  All the necessary query data contains the <code>PresentRequestQuery</code> class: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PresentRequestQuery</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Country { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Status { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br>  <b>Cons</b> : <br>  As mentioned above, the <code>Get</code> method has a fragile signature, so extending the functionality without breaking changes is really difficult.  The parameters of a Get operation are sent as a <a href="http://en.wikipedia.org/wiki/Query_string">query string</a> with simple fields that are also represented in the signature of the <code>Get</code> method.  There is no connectivity between the parameters, since  WCF does not create a request object based on parameters. <br>  Let's take a look at an example: <a href="http://santaclaus.org/requests%3Fcountry%3Dsheldonopolis%26status%3Dpending">SantaClaus.org/requests?country=sheldonopolis&amp;status=pending</a> URL to get <code>PresentReuqest</code> s by country and status. <br>  Here is the corresponding method in the WCF service: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;PresentRequest&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> country, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> status</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotImplementedException(); }</code> </pre><br>  According to the method signature, there is no connection between country and status.  In fact, we do not know what <code>country</code> and <code>status</code> means, we can only guess.  In my opinion, WCF should be able to create a request date based on the request object (serialize), and also create a request object based on the request string (deserialization).  Thus, to send the following request object: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PresentRequestQuery</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Country { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Status { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br>  must be serialized to <code>country=sheldonopolis&amp;status=pending</code> , and after receiving the query string must be deserialized into the <code>PresentRequestQuery</code> instance and the <code>Get</code> method should look like this: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;PresentRequest&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PresentRequestQuery query</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotImplementedException(); }</code> </pre><br>  We have to create as many Get methods as we have requests.  Here is a sample code from <a href="http://msdn.microsoft.com/en-us/library/dd203052.aspx">WCF's Guide to Designing and Building RESTful Web Services</a> : <br><div class="spoiler">  <b class="spoiler_title">BookmarkService</b> <div class="spoiler_text"><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ServiceContract</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BookmarkService</span></span> { [WebGet(UriTemplate = <span class="hljs-string"><span class="hljs-string">"?tag={tag}"</span></span>)] [OperationContract] <span class="hljs-function"><span class="hljs-function">Bookmarks </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetPublicBookmarks</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tag</span></span></span><span class="hljs-function">)</span></span> {...} [WebGet(UriTemplate = <span class="hljs-string"><span class="hljs-string">"{username}?tag={tag}"</span></span>)] [OperationContract] <span class="hljs-function"><span class="hljs-function">Bookmarks </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetUserPublicBookmarks</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> username, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tag</span></span></span><span class="hljs-function">)</span></span> {...} [WebGet(UriTemplate = <span class="hljs-string"><span class="hljs-string">"users/{username}/bookmarks?tag={tag}"</span></span>)] [OperationContract] <span class="hljs-function"><span class="hljs-function">Bookmarks </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetUserBookmarks</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> username, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tag</span></span></span><span class="hljs-function">)</span></span> {...} [WebGet(UriTemplate = <span class="hljs-string"><span class="hljs-string">"users/{username}/profile"</span></span>)] [OperationContract] <span class="hljs-function"><span class="hljs-function">UserProfile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetUserProfile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> username</span></span></span><span class="hljs-function">)</span></span> {...} [WebGet(UriTemplate = <span class="hljs-string"><span class="hljs-string">"users/{username}"</span></span>)] [OperationContract] <span class="hljs-function"><span class="hljs-function">User </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetUser</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> username</span></span></span><span class="hljs-function">)</span></span> {...} [WebGet(UriTemplate = <span class="hljs-string"><span class="hljs-string">"users/{username}/bookmarks/{bookmark_id}"</span></span>)] [OperationContract] <span class="hljs-function"><span class="hljs-function">Bookmark </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetBookmark</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> username, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bookmark_id</span></span></span><span class="hljs-function">)</span></span> {...} ... }</code> </pre></div></div><br>  I do not understand why WCF does not support the serialization of the query string, that is, the creation of an object from the query string.  This simple trick could help create a more stable method signature.  On the other hand, a Get method can have such a signature.  So the kind of method is reusable and <a href="http://en.wikipedia.org/wiki/Polymorphism_(computer_science)">polymorphic</a> . <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">Message </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message request</span></span></span><span class="hljs-function">)</span></span>;</code> </pre><br>  <b>Cons of <code>Get</code></b> : <br><ul><li>  Methods are difficult to maintain. </li><li>  You need to create too many <code>Get</code> methods. </li><li>  No connectivity between request parameters </li><li>  No polymorphism </li></ul><br>  Please keep in mind that WCF SOAP service has polymorphism, or rather has a special polymorphism ( <a href="http://en.wikipedia.org/wiki/Ad_hoc_polymorphism">ad hoc polymorphism</a> ), implemented through <code>KnownTypeAttribute</code> , but, in my opinion, WCF must support <a href="http://en.wikipedia.org/wiki/Parametric_polymorphism">parametric polymorphism</a> . <br><br><h4>  Conclusion </h4><br>  WCF as a RESTful framework has several architectural features that make it difficult to create reusable and stable services.  On the other hand, WCF has everything you need to solve these problems. <br><br><h3>  RESTful Web Service on WCF: improved design </h3><br>  First of all, let's eliminate the disadvantages of the <code>Get</code> method.  I think an approach based on serialization messages can help us. <br><br><h4>  URL serialization and deserialization </h4><br>  We have already seen the <code>PresentRequestQuery</code> class, but now let's serialize it. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PresentRequestQuery</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Country { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Status { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br>  As we know, <code>Get</code> sends the parameters as a query string, so our serialization method should create a valid query string.  The ideal query string resulting from serialization should look like this: <code>country=sheldonopolis&amp;status=pending</code> and we want to create something similar.  The ideal result of serialization has one drawback: the lack of a connection between the parameters, so we cannot deserialize the URL into the request object.  Our serialization mechanism should also solve this problem. <br><br>  Generally speaking, a query string is a collection of different key-value pairs: <code>key1=value1&amp;key2=value2&amp;key3=value3</code> . <br>  In our case, we have two keys: <ul><li>  Request type </li><li>  Request data, object fields </li></ul><br>  I see the following serialization algorithm: <br><ol><li>  Determine the type of request </li><li>  Serialize request object in JSON </li><li>  Encode json </li></ol><br>  The resulting query string must match the mask: <code>type={request type}&amp;data={request data}</code> <br>  Here is an instance of the request object: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> query = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PresentRequestQuery { Country = <span class="hljs-string"><span class="hljs-string">"sheldonopolis"</span></span>, Status = <span class="hljs-string"><span class="hljs-string">"pending"</span></span> };</code> </pre><br>  Result query string: <code>type=PresentRequestQuery&amp;data=%7B%22Country%22%3A%22sheldonopolis%22%2C%22Status%22%3A%22pending%22%7D</code> <br>  This query string can be easily deserialized into a <code>PresentRequestQuery</code> instance.  The implementation is very simple: <br><div class="spoiler">  <b class="spoiler_title">CreateQueryParams &lt;T&gt; (T value)</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> NameValueCollection CreateQueryParams&lt;T&gt;(T <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> data = JsonDataSerializer.ToString(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NameValueCollection { { RestServiceMetadata.ParamName.Type, UrlEncode(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(T).Name) }, { RestServiceMetadata.ParamName.Data, UrlEncode(data) } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre></div></div>  where <code>UrlEncode</code> calls only <code>Uri.EscapeDataString</code> and <code>JsonDataContractSerializer</code> is an instance of the <code>DataContractJsonSerializer</code> . <br><div class="spoiler">  <b class="spoiler_title">ToString &lt;T&gt; (T value)</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ToString&lt;T&gt;(T <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemoryStream()) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> serializer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataContractJsonSerializer(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(T)); serializer.WriteObject(stream, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Encoding.UTF8.GetString(stream.ToArray()); } }</code> </pre></div></div><br>  Now we are ready for the next step ‚Äî using a <a href="http://www.codeproject.com/Articles/598157/Building-SOAP-Message-Based-Web-Services-with-WCF">message-based approach</a> .  For the SOAP service we used this contract: <div class="spoiler">  <b class="spoiler_title">ISoapService</b> <div class="spoiler_text">  <code>SeriviceContract</code> : <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ServiceContract</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ISoapService</span></span> { [OperationContract(Action = ServiceMetadata.Action.Process)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span>; [OperationContract(Action = ServiceMetadata.Action.ProcessWithResponse, ReplyAction = ServiceMetadata.Action.ProcessResponse)] <span class="hljs-function"><span class="hljs-function">Message </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessWithResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre></div></div><br>  The RESTful style requires at least four methods: <code>Get, Post, Put, Delete</code> and <code>ServiceContract</code> can be like this: <br><div class="spoiler">  <b class="spoiler_title">Ijsonservice</b> <div class="spoiler_text"><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ServiceContract</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IJsonService</span></span> { [OperationContract] [WebInvoke(Method = OperationType.Delete, UriTemplate = RestServiceMetadata.Path.Delete, RequestFormat = WebMessageFormat.Json, ResponseFormat = WebMessageFormat.Json)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Delete</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span>; [OperationContract] [WebInvoke(Method = OperationType.Delete, UriTemplate = RestServiceMetadata.Path.DeleteWithResponse, RequestFormat = WebMessageFormat.Json, ResponseFormat = WebMessageFormat.Json)] <span class="hljs-function"><span class="hljs-function">Message </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DeleteWithResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span>; [OperationContract] [WebGet(UriTemplate = RestServiceMetadata.Path.Get, RequestFormat = WebMessageFormat.Json, ResponseFormat = WebMessageFormat.Json)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span>; [OperationContract] [WebGet(UriTemplate = RestServiceMetadata.Path.GetWithResponse, RequestFormat = WebMessageFormat.Json, ResponseFormat = WebMessageFormat.Json)] <span class="hljs-function"><span class="hljs-function">Message </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetWithResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span>; [OperationContract] [WebInvoke(Method = OperationType.Post, UriTemplate = RestServiceMetadata.Path.Post, RequestFormat = WebMessageFormat.Json, ResponseFormat = WebMessageFormat.Json)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Post</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span>; [OperationContract] [WebInvoke(Method = OperationType.Post, UriTemplate = RestServiceMetadata.Path.PostWithResponse, RequestFormat = WebMessageFormat.Json, ResponseFormat = WebMessageFormat.Json)] <span class="hljs-function"><span class="hljs-function">Message </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PostWithResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span>; [OperationContract] [WebInvoke(Method = OperationType.Put, UriTemplate = RestServiceMetadata.Path.Put, RequestFormat = WebMessageFormat.Json, ResponseFormat = WebMessageFormat.Json)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Put</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span>; [OperationContract] [WebInvoke(Method = OperationType.Put, UriTemplate = RestServiceMetadata.Path.PutWithResponse, RequestFormat = WebMessageFormat.Json, ResponseFormat = WebMessageFormat.Json)] <span class="hljs-function"><span class="hljs-function">Message </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PutWithResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre></div></div><br>  <code>IJsonService</code> has the flexibility, stability and ease of maintenance.  We can transfer any data, because the service depends only on the <code>Message</code> class, which is fundamental for WCF ( <a href="http://msdn.microsoft.com/en-us/library/ms734675.aspx">MSDN</a> ).  Another advantage is CRUD.  Using IJsonService and URL serialization, we can create reusable RESTful services with <a href="http://en.wikipedia.org/wiki/Parametric_polymorphism">parametric polymorphism</a> . <br><br><h3>  Implementing a RESTful service </h3><br>  I will not give all the code here, because  He already cited <a href="http://www.codeproject.com/Articles/598157/Building-SOAP-Message-Based-Web-Services-with-WCF">previously</a> .  The following is an example of how to Create, Update, Receive and Delete requests. <br><div class="spoiler">  <b class="spoiler_title">Clientprocessor</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ClientProcessor</span></span> : <span class="hljs-title"><span class="hljs-title">IPostWithResponse</span></span>&lt;<span class="hljs-title"><span class="hljs-title">CreateClientRequest</span></span>&gt;, <span class="hljs-title"><span class="hljs-title">IGetWithResponse</span></span>&lt;<span class="hljs-title"><span class="hljs-title">GetClientRequest</span></span>&gt;, <span class="hljs-title"><span class="hljs-title">IDelete</span></span>&lt;<span class="hljs-title"><span class="hljs-title">DeleteClientRequest</span></span>&gt;, <span class="hljs-title"><span class="hljs-title">IPutWithResponse</span></span>&lt;<span class="hljs-title"><span class="hljs-title">UpdateClientRequest</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> List&lt;Client&gt; _clients = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Client&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Delete</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DeleteClientRequest request</span></span></span><span class="hljs-function">)</span></span> { _clients = _clients.Where(x =&gt; x.Id != request.Id).ToList(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetWithResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GetClientRequest request</span></span></span><span class="hljs-function">)</span></span> { Client client = _clients.Single(x =&gt; x.Id == request.Id); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClientResponse { Id = client.Id, Email = client.Email }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PostWithResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">CreateClientRequest request</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Client { Id = Guid.NewGuid(), Email = request.Email }; _clients.Add(client); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClientResponse { Id = client.Id, Email = client.Email }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PutWithResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">UpdateClientRequest request</span></span></span><span class="hljs-function">)</span></span> { Client client = _clients.Single(x =&gt; x.Id == request.Id); client.Email = request.Email; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClientResponse { Id = client.Id, Email = client.Email }; } }</code> </pre></div></div><br>  The following interfaces represent CRUD operations: <br><img src="https://habrastorage.org/getpro/habr/post_images/9c2/df1/289/9c2df128928166f4efee9d2abec3b120.jpg" alt="image"><br>  Now we need to associate requests with suitable CRUD operations. <br><div class="spoiler">  <b class="spoiler_title">Serviceprocessor</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ServiceProcessor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> RequestMetadataMap _requests = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RequestMetadataMap(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Configuration _configuration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Configuration(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> RequestProcessorMap _requestProcessors = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RequestProcessorMap(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RequestMetadata requestMetaData</span></span></span><span class="hljs-function">)</span></span> { IRequestProcessor processor = _requestProcessors.Get(requestMetaData.Type); processor.Process(requestMetaData); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Message </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessWithResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RequestMetadata requestMetaData</span></span></span><span class="hljs-function">)</span></span> { IRequestProcessor processor = _requestProcessors.Get(requestMetaData.Type); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> processor.ProcessWithResponse(requestMetaData); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Configuration</span></span> : <span class="hljs-title"><span class="hljs-title">IConfiguration</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Bind&lt;TRequest, TProcessor&gt;(Func&lt;TProcessor&gt; creator) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TRequest : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TProcessor</span></span> : <span class="hljs-title"><span class="hljs-title">IRequestOperation</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (creator == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-string"><span class="hljs-string">"creator"</span></span>); } _requestProcessors.Add&lt;TRequest, TProcessor&gt;(creator); _requests.Add&lt;TRequest&gt;(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Bind&lt;TRequest, TProcessor&gt;() <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TRequest : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TProcessor</span></span> : <span class="hljs-title"><span class="hljs-title">IRequestOperation</span></span>, <span class="hljs-title"><span class="hljs-title">new</span></span>() { Bind&lt;TRequest, TProcessor&gt;(() =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TProcessor()); } } }</code> </pre></div></div><br>  A specific <code>ServiceProcessor</code> has only configuration and processing methods. <br><div class="spoiler">  <b class="spoiler_title">RestServiceProcessor</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RestServiceProcessor</span></span> : <span class="hljs-title"><span class="hljs-title">ServiceProcessor</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RestServiceProcessor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IConfiguration </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Configure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action&lt;IConfiguration&gt; action</span></span></span><span class="hljs-function">)</span></span> { action(_configuration); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _configuration; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span> { RequestMetadata metadata = _requests.FromRestMessage(message); Process(metadata); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Message </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessWithResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span> { RequestMetadata metadata = _requests.FromRestMessage(message); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ProcessWithResponse(metadata); } }</code> </pre></div></div><br>  <code>RequestMetadataMap</code> used to store the types of requests that are needed to create specific requests from <code>Message</code> instances. <br><div class="spoiler">  <b class="spoiler_title">RequestMetadataMap</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RequestMetadataMap</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, Type&gt; _requestTypes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, Type&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Add&lt;TRequest&gt;() <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TRequest : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> { Type requestType = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(TRequest); _requestTypes[requestType.Name] = requestType; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> RequestMetadata </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FromRestMessage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span> { UriTemplateMatch templateMatch = WebOperationContext.Current.IncomingRequest.UriTemplateMatch; NameValueCollection queryParams = templateMatch.QueryParameters; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> typeName = UrlSerializer.FromQueryParams(queryParams).GetTypeValue(); Type targetType = GetRequestType(typeName); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RequestMetadata.FromRestMessage(message, targetType); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> RequestMetadata </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FromSoapMessage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> typeName = SoapContentTypeHeader.ReadHeader(message); Type targetType = GetRequestType(typeName); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RequestMetadata.FromSoapMessage(message, targetType); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Type </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetRequestType</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> typeName</span></span></span><span class="hljs-function">)</span></span> { Type result; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_requestTypes.TryGetValue(typeName, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> result)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> errorMessage = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format( <span class="hljs-string"><span class="hljs-string">"Binding on {0} is absent. Use the Bind method on an appropriate ServiceProcessor"</span></span>, typeName); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException(errorMessage); } }</code> </pre></div></div><br>  Look at the reusable implementation of the <code>IJsonService</code> : <br><div class="spoiler">  <b class="spoiler_title">JsonServicePerCall</b> <div class="spoiler_text"><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ServiceBehavior(InstanceContextMode = InstanceContextMode.PerCall)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">JsonServicePerCall</span></span> : <span class="hljs-title"><span class="hljs-title">IJsonService</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Delete</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span> { RestServiceProcessor.Process(message); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Message </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DeleteWithResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RestServiceProcessor.ProcessWithResponse(message); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span> { RestServiceProcessor.Process(message); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Message </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetWithResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RestServiceProcessor.ProcessWithResponse(message); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Post</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span> { RestServiceProcessor.Process(message); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Message </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PostWithResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RestServiceProcessor.ProcessWithResponse(message); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Put</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span> { RestServiceProcessor.Process(message); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Message </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PutWithResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RestServiceProcessor.ProcessWithResponse(message); } }</code> </pre></div></div><br>  As you can see, you can send anything and everything according to RESTful. <br>  The most interesting thing happens in <code>RestRequestMetadata</code> , a class that helps create a specific request from a URL.  Before looking at the implementation of <code>RestRequestMetadata</code> , I want to give some explanations.  <code>RestRequestMetadata</code> uses <code>WebOperationContext</code> to get the query string and create a specific query.  It can also create a response message based on the request. <br><div class="spoiler">  <b class="spoiler_title">RestRequestMetadata</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RestRequestMetadata</span></span> : <span class="hljs-title"><span class="hljs-title">RequestMetadata</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> _request; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> WebOperationContext _webOperationContext; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RestRequestMetadata</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message, Type targetType</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">targetType</span></span></span><span class="hljs-function">)</span></span> { _webOperationContext = WebOperationContext.Current; OperationType = GetOperationType(message); _request = CreateRequest(message, targetType); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> OperationType { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Message </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> response</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> serializer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataContractJsonSerializer(response.GetType()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _webOperationContext.CreateJsonResponse(response, serializer); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> TRequest GetRequest&lt;TRequest&gt;() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (TRequest)_request; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateRequestFromContent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message, Type targetType</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemoryStream()) { XmlDictionaryWriter writer = JsonReaderWriterFactory.CreateJsonWriter(stream); message.WriteMessage(writer); writer.Flush(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> serializer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataContractJsonSerializer(targetType); stream.Position = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> serializer.ReadObject(stream); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetOperationType</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> httpReq = (HttpRequestMessageProperty)message.Properties[HttpRequestMessageProperty.Name]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> httpReq.Method; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CraeteRequestFromUrl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Type targetType</span></span></span><span class="hljs-function">)</span></span> { UriTemplateMatch templateMatch = _webOperationContext.IncomingRequest.UriTemplateMatch; NameValueCollection queryParams = templateMatch.QueryParameters; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UrlSerializer.FromQueryParams(queryParams).GetRequestValue(targetType); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateRequest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message message, Type targetType</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsRequestByUrl()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CraeteRequestFromUrl(targetType); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CreateRequestFromContent(message, targetType); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsRequestByUrl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> OperationType == Operations.OperationType.Get || OperationType == Operations.OperationType.Delete; } }</code> </pre></div></div><br>  All specific requests are processed by the RequestProcessor class. <br><div class="spoiler">  <b class="spoiler_title">RequestProcessor &lt;TRequest, TProcessor&gt;</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RequestProcessor</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TRequest</span></span>, <span class="hljs-title"><span class="hljs-title">TProcessor</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">IRequestProcessor</span></span> <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TRequest</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TProcessor</span></span> : <span class="hljs-title"><span class="hljs-title">IRequestOperation</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Func&lt;TProcessor&gt; _creator; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RequestProcessor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Func&lt;TProcessor&gt; creator</span></span></span><span class="hljs-function">)</span></span> { _creator = creator; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RequestMetadata metadata</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (metadata.OperationType) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> OperationType.Get: Get(metadata); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> OperationType.Post: Post(metadata); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> OperationType.Put: Put(metadata); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> OperationType.Delete: Delete(metadata); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> message = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"Invalid operation type: {0}"</span></span>, metadata.OperationType); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException(message); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Message </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessWithResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RequestMetadata metadata</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (metadata.OperationType) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> OperationType.Get: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetWithResponse(metadata); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> OperationType.Post: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PostWithResponse(metadata); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> OperationType.Put: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PutWithResponse(metadata); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> OperationType.Delete: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DeleteWithResponse(metadata); <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> message = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"Invalid operation type: {0}"</span></span>, metadata.OperationType); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException(message); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Delete</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RequestMetadata metadata</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> service = (IDelete&lt;TRequest&gt;)_creator(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = metadata.GetRequest&lt;TRequest&gt;(); service.Delete(request); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Message </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DeleteWithResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RequestMetadata metadata</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> service = (IDeleteWithResponse&lt;TRequest&gt;)_creator(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = metadata.GetRequest&lt;TRequest&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> result = service.DeleteWithResponse(request); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> metadata.CreateResponse(result); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RequestMetadata metadata</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> service = (IGet&lt;TRequest&gt;)_creator(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = metadata.GetRequest&lt;TRequest&gt;(); service.Get(request); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Message </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetWithResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RequestMetadata metadata</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> service = (IGetWithResponse&lt;TRequest&gt;)_creator(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = metadata.GetRequest&lt;TRequest&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> result = service.GetWithResponse(request); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> metadata.CreateResponse(result); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Post</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RequestMetadata metadata</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> service = (IPost&lt;TRequest&gt;)_creator(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = metadata.GetRequest&lt;TRequest&gt;(); service.Post(request); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Message </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PostWithResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RequestMetadata metadata</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> service = (IPostWithResponse&lt;TRequest&gt;)_creator(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = metadata.GetRequest&lt;TRequest&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> result = service.PostWithResponse(request); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> metadata.CreateResponse(result); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Put</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RequestMetadata metadata</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> service = (IPut&lt;TRequest&gt;)_creator(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = metadata.GetRequest&lt;TRequest&gt;(); service.Put(request); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Message </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PutWithResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RequestMetadata metadata</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> service = (IPutWithResponse&lt;TRequest&gt;)_creator(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = metadata.GetRequest&lt;TRequest&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> result = service.PutWithResponse(request); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> metadata.CreateResponse(result); } }</code> </pre></div></div><br><br><h3>  RESTful service client </h3><br>  The client is quite simple, just serializes the data into the query string and sends it to the service.  Client is based on <a href="httpclient.aspx">HttpClient</a> .  The following are client methods: <br><div class="spoiler">  <b class="spoiler_title">Client methods</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Delete&lt;TRequest&gt;(TRequest request) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TRequest : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">TResponse</span></span> <span class="hljs-title"><span class="hljs-title">Delete</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TRequest</span></span>, <span class="hljs-title"><span class="hljs-title">TResponse</span></span>&gt;(<span class="hljs-title"><span class="hljs-title">TRequest</span></span> <span class="hljs-title"><span class="hljs-title">request</span></span>) <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TRequest</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">Task</span></span> <span class="hljs-title"><span class="hljs-title">DeleteAsync</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TRequest</span></span>&gt;(<span class="hljs-title"><span class="hljs-title">TRequest</span></span> <span class="hljs-title"><span class="hljs-title">request</span></span>) <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TRequest</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">Task</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TResponse</span></span>&gt; <span class="hljs-title"><span class="hljs-title">DeleteAsync</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TRequest</span></span>, <span class="hljs-title"><span class="hljs-title">TResponse</span></span>&gt;(<span class="hljs-title"><span class="hljs-title">TRequest</span></span> <span class="hljs-title"><span class="hljs-title">request</span></span>) <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TRequest</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">void</span></span> <span class="hljs-title"><span class="hljs-title">Get</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TRequest</span></span>&gt;(<span class="hljs-title"><span class="hljs-title">TRequest</span></span> <span class="hljs-title"><span class="hljs-title">request</span></span>) <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TRequest</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">TResponse</span></span> <span class="hljs-title"><span class="hljs-title">Get</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TRequest</span></span>, <span class="hljs-title"><span class="hljs-title">TResponse</span></span>&gt;(<span class="hljs-title"><span class="hljs-title">TRequest</span></span> <span class="hljs-title"><span class="hljs-title">request</span></span>) <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TRequest</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">Task</span></span> <span class="hljs-title"><span class="hljs-title">GetAsync</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TRequest</span></span>&gt;(<span class="hljs-title"><span class="hljs-title">TRequest</span></span> <span class="hljs-title"><span class="hljs-title">request</span></span>) <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TRequest</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">Task</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TResponse</span></span>&gt; <span class="hljs-title"><span class="hljs-title">GetAsync</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TRequest</span></span>, <span class="hljs-title"><span class="hljs-title">TResponse</span></span>&gt;(<span class="hljs-title"><span class="hljs-title">TRequest</span></span> <span class="hljs-title"><span class="hljs-title">request</span></span>) <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TRequest</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">void</span></span> <span class="hljs-title"><span class="hljs-title">Post</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TRequest</span></span>&gt;(<span class="hljs-title"><span class="hljs-title">TRequest</span></span> <span class="hljs-title"><span class="hljs-title">request</span></span>) <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TRequest</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">TResponse</span></span> <span class="hljs-title"><span class="hljs-title">Post</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TRequest</span></span>, <span class="hljs-title"><span class="hljs-title">TResponse</span></span>&gt;(<span class="hljs-title"><span class="hljs-title">TRequest</span></span> <span class="hljs-title"><span class="hljs-title">request</span></span>) <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TRequest</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">Task</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TResponse</span></span>&gt; <span class="hljs-title"><span class="hljs-title">PostAsync</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TRequest</span></span>, <span class="hljs-title"><span class="hljs-title">TResponse</span></span>&gt;(<span class="hljs-title"><span class="hljs-title">TRequest</span></span> <span class="hljs-title"><span class="hljs-title">request</span></span>) <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TRequest</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">Task</span></span> <span class="hljs-title"><span class="hljs-title">PostAsync</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TRequest</span></span>&gt;(<span class="hljs-title"><span class="hljs-title">TRequest</span></span> <span class="hljs-title"><span class="hljs-title">request</span></span>) <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TRequest</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">void</span></span> <span class="hljs-title"><span class="hljs-title">Put</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TRequest</span></span>&gt;(<span class="hljs-title"><span class="hljs-title">TRequest</span></span> <span class="hljs-title"><span class="hljs-title">request</span></span>) <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TRequest</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">TResponse</span></span> <span class="hljs-title"><span class="hljs-title">Put</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TRequest</span></span>, <span class="hljs-title"><span class="hljs-title">TResponse</span></span>&gt;(<span class="hljs-title"><span class="hljs-title">TRequest</span></span> <span class="hljs-title"><span class="hljs-title">request</span></span>) <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TRequest</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">Task</span></span> <span class="hljs-title"><span class="hljs-title">PutAsync</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TRequest</span></span>&gt;(<span class="hljs-title"><span class="hljs-title">TRequest</span></span> <span class="hljs-title"><span class="hljs-title">request</span></span>) <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TRequest</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">Task</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TResponse</span></span>&gt; <span class="hljs-title"><span class="hljs-title">PutAsync</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TRequest</span></span>, <span class="hljs-title"><span class="hljs-title">TResponse</span></span>&gt;(<span class="hljs-title"><span class="hljs-title">TRequest</span></span> <span class="hljs-title"><span class="hljs-title">request</span></span>) <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TRequest</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span></code> </pre></div></div><br><br>  And now let's make Santa happy owner of a RESTful service based on messages. <br><br><h3>  RESTful service example </h3><br>  Santa is still waiting for a RESTful service that can save and search for requests for gifts by filter. <br><h4>  Service </h4><br>  The most common configuration file: <br><br><div class="spoiler">  <b class="spoiler_title">Configuration</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system.serviceModel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">services</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Nelibur.ServiceModel.Services.JsonServicePerCall"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">baseAddresses</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">baseAddress</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://localhost:9090/requests"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">baseAddresses</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">endpoint</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">binding</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"webHttpBinding"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">contract</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Nelibur.ServiceModel.Contracts.IJsonService"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">services</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system.serviceModel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">startup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">supportedRuntime</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"v4.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">sku</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".NETFramework,Version=v4.5"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">startup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div></div><br>  <code>JsonServicePerCall</code> and <code>IJsonService</code> have already been mentioned above. <br><br>  Below is the binding and other settings.  Binding says that the <code>PresentRequestProcessor</code> will handle the <code>PresentRequest</code> and the <code>PresentRequestQuery</code> . <br><div class="spoiler">  <b class="spoiler_title">Binding Setup</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { RestServiceProcessor.Configure(x =&gt; { x.Bind&lt;PresentRequest, PresentRequestProcessor&gt;(); x.Bind&lt;PresentRequestQuery, PresentRequestProcessor&gt;(); x.Bind&lt;UpdatePresentRequestStatus, PresentRequestProcessor&gt;(); x.Bind&lt;DeletePresentRequestsByStatus, PresentRequestProcessor&gt;(); }); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> serviceHost = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebServiceHost(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(JsonServicePerCall))) { serviceHost.Open(); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Santa Clause Service has started"</span></span>); Console.ReadKey(); serviceHost.Close(); } }</code> </pre></div></div><br>  Finally, <code>PresentRequestProcessor</code> shows Get, Post, Put and Delete requests for gifts: <br><div class="spoiler">  <b class="spoiler_title">PresentRequestProcessor</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PresentRequestProcessor</span></span> : <span class="hljs-title"><span class="hljs-title">IPost</span></span>&lt;<span class="hljs-title"><span class="hljs-title">PresentRequest</span></span>&gt;, <span class="hljs-title"><span class="hljs-title">IPost</span></span>&lt;<span class="hljs-title"><span class="hljs-title">UpdatePresentRequestStatus</span></span>&gt;, <span class="hljs-title"><span class="hljs-title">IGetWithResponse</span></span>&lt;<span class="hljs-title"><span class="hljs-title">PresentRequestQuery</span></span>&gt;, <span class="hljs-title"><span class="hljs-title">IDelete</span></span>&lt;<span class="hljs-title"><span class="hljs-title">DeletePresentRequestsByStatus</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> List&lt;PresentRequest&gt; _requests = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;PresentRequest&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Delete</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DeletePresentRequestsByStatus request</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> status = (PresentRequestStatus)Enum.Parse(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(PresentRequestStatus), request.Status); _requests = _requests.Where(x =&gt; x.Status != status).ToList(); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Request list was updated, current count: {0}"</span></span>, _requests.Count); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetWithResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PresentRequestQuery request</span></span></span><span class="hljs-function">)</span></span> { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Get Present Requests by: {0}"</span></span>, request); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> status = (PresentRequestStatus)Enum.Parse(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(PresentRequestStatus), request.Status); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _requests.Where(x =&gt; x.Status == status) .Where(x =&gt; x.Address.Country == request.Country) .ToList(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Post</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PresentRequest request</span></span></span><span class="hljs-function">)</span></span> { request.Status = PresentRequestStatus.Pending; _requests.Add(request); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Request was added, Id: {0}"</span></span>, request.Id); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Post</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">UpdatePresentRequestStatus request</span></span></span><span class="hljs-function">)</span></span> { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Update requests on status: {0}"</span></span>, request.Status); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> status = (PresentRequestStatus)Enum.Parse(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(PresentRequestStatus), request.Status); _requests.ForEach(x =&gt; x.Status = status); } }</code> </pre></div></div><br><br><h4>  Customer </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Customer code self-documenting: </font></font><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Customer</font></font></b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JsonServiceClient(<span class="hljs-string"><span class="hljs-string">"http://localhost:9090/requests"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> presentRequest = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PresentRequest { Id = Guid.NewGuid(), Address = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Address { Country = <span class="hljs-string"><span class="hljs-string">"sheldonopolis"</span></span>, }, Wish = <span class="hljs-string"><span class="hljs-string">"Could you please help developers to understand, "</span></span> + <span class="hljs-string"><span class="hljs-string">"WCF is awesome only with Nelibur"</span></span> }; client.Post(presentRequest); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> requestQuery = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PresentRequestQuery { Country = <span class="hljs-string"><span class="hljs-string">"sheldonopolis"</span></span>, Status = PresentRequestStatus.Pending.ToString() }; List&lt;PresentRequest&gt; pendingRequests = client.Get&lt;PresentRequestQuery, List&lt;PresentRequest&gt;&gt;(requestQuery); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Pending present requests count: {0}"</span></span>, pendingRequests.Count); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> updatePresentRequestStatus = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UpdatePresentRequestStatus { Status = PresentRequestStatus.Accepted.ToString() }; client.Post(updatePresentRequestStatus); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> deleteByStatus = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DeletePresentRequestsByStatus { Status = PresentRequestStatus.Accepted.ToString() }; client.Delete(deleteByStatus); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Press any key for Exit"</span></span>); Console.ReadKey(); }</code> </pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Results of execution: screenshot of the </font></font><a href="http://www.telerik.com/download/fiddler"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fiddler</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> program </font><font style="vertical-align: inherit;">:</font></font><br><img src="https://habrastorage.org/getpro/habr/post_images/53f/ebf/986/53febf9862733ac39b5db8b009251171.png" alt="image"><br><br><h3>  the end </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The message-based approach is a mega powerful architectural style. </font><font style="vertical-align: inherit;">He can help create a RESTful service with a stable, maintainable interface, and of course Santa himself will be pleased to receive just such a RESTful service as a Christmas present. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sources can be downloaded from </font></font><a href="http://www.codeproject.com/Articles/712689/Building-RESTful-Message-Based-Web-Services-with-W"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the original article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or from </font></font><a href="http://nelibur.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the project site</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><a href="http://www.nuget.org/packages/Nelibur/"><font style="vertical-align: inherit;">Nuget package is</font></a></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> also </font></font><a href="http://www.nuget.org/packages/Nelibur/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">available</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An interesting article on the topic: </font></font><a href="https://github.com/ServiceStack/ServiceStack/wiki/Advantages-of-message-based-web-services"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advantages of message based web services</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div><p>Source: <a href="https://habr.com/ru/post/218149/">https://habr.com/ru/post/218149/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../218135/index.html">How to become a world-class tester?</a></li>
<li><a href="../218137/index.html">Durov was not joking. But in VKontakte will remain</a></li>
<li><a href="../218139/index.html">Ale, Dispatch: AdvertOne vs Google Tag Manager</a></li>
<li><a href="../218143/index.html">Investigation of information security in Yandex. Rdomn - hidden threat</a></li>
<li><a href="../218147/index.html">Node.js vs Ruby on Rails</a></li>
<li><a href="../218153/index.html">Interview with the speaker Loc Kit 2014</a></li>
<li><a href="../218161/index.html">Diagnosing problems with the "unstable availability" of the site</a></li>
<li><a href="../218169/index.html">Windows XP discontinued today</a></li>
<li><a href="../218171/index.html">Why in Russia there are almost no civil / commercial high-tech production?</a></li>
<li><a href="../218173/index.html">"Flexible" office with service racks and mini columns from Schneider-electric</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>