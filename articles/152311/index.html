<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automated OS installation on the example of Windows Embedded x64</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Step-by-step instruction with examples 
 Surely everyone can manually install and configure the Windows operating system. But for the case when for pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automated OS installation on the example of Windows Embedded x64</h1><div class="post__text post__text-html js-mediator-article"><h4>  <i>Step-by-step instruction with examples</i> </h4><br><img src="https://habrastorage.org/storage2/d38/1d2/e26/d381d2e26487ae266ab2ba8807fc7eb2.jpg" align="left">  Surely everyone can manually install and configure the Windows operating system.  But for the case when for production purposes this task should be performed dozens or hundreds of times, the need arises for an automated installation. <br><br>  This article describes the basic steps and tips on how to create a "silent", automated installation of the operating system, configure it and test the result.  Of course, the network can find a fairly large number of articles and tips about the individual phases of this task, but the general instructions and answers to the questions: Where to start?  What needs to be prepared?  What are the main process steps?  - unfortunately, a rarity. <br><br>  Therefore, the answers to these questions here will find those who perform such a task for the first time. <br><a name="habracut"></a><br>  <i>Windows Embedded Standard 7x64 is</i> chosen as the operating system for the examples. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Machine requirements: </h4><br><h5>  Should be installed: </h5><br><ul><li>  <a href="http://www.microsoft.com/windowsembedded/en-us/evaluate/windows-embedded-standard-7-technical-specifications.aspx">Windows Embedded Standard 7 SP1 (Tools)</a> <br>  Toolkit can be downloaded <a href="http://www.microsoft.com/en-us/download/details.aspx%3Fid%3D11887">here</a> (evaluation version) <br>  In previous versions of Windows, the <a href="">Windows System Image Manager</a> (SIM) is used to edit answer files.  Windows SIM is part of the Windows Automated Installation Kit (AIK), which can be downloaded <a href="http://www.microsoft.com/en-us/download/details.aspx%3Fid%3D9085">here</a> .  The <i>Image Configuration Editor</i> interface in <i>Windows Embedded Standard 7 Tools is</i> very similar to the <i>Windows SIM</i> interface. </li></ul><br><h5>  Must be available: </h5><br><ul><li>  The original ISO image for installing Windows (+ license key, if you do not plan to install the evaluation version). </li><li>  All necessary drivers for target device. </li><li>  Applications that are planned to be installed in the system immediately after installing the OS. </li></ul><br><h5>  Basic tools: </h5><br><ul><li>  Windows Embedded Standard 7 SP1 (Tools) \ <b>Image Configuration Editor (ICE)</b> </li><li>  Windows Embedded Standard 7 SP1 (Tools) \ <b>Windows PE Tools Command Prompt</b> </li><li>  Symantec Ghost \ <b>Ghost Boot Wizard</b> </li></ul>  Before starting, it is recommended that you familiarize yourself with these tools and the phases of Windows installation. <br><br><h5>  Folder structure in production environment: </h5><br>  Create a working folder.  For example, a folder named ‚ÄúWork‚Äù. <br>  Copy the contents of the original ISO image with the installation of Windows in your working directory.  The result should be the following: <br><br><img src="https://habrastorage.org/storage2/595/20a/557/59520a55732009c01b5dc574be7affe7.png"><img src="https://habrastorage.org/storage2/d46/24a/e96/d4624ae96a400e0362672d6ec10be33b.png"><br><br>  Notice the two subfolders in the Distribution Share (DS) folder: ‚Äú <b>$ OEM $ Folders</b> ‚Äù and ‚Äú <b>Out-Of-Box Drivers</b> ‚Äù. <br><br>  Create a folder ‚ÄúWork \ DS \ <b>Out-Of-Box Drivers</b> \‚Äù.  The necessary drivers for the target device will be stored here. <br><br>  Create the ‚ÄúWork \ DS \ <b>$ OEM $ Folders</b> \ (CustomFolder) \ $ OEM $ \ $$ folder structure.  Additional files, applications, registry files, configurations and scripts will be stored here. <br><br>  The contents of the <b>\ $ OEM $ \ $$</b> folder are automatically copied to the% WINDIR% folder, so it can be used during any phase of the Windows installation.  <a href="http://msdn.microsoft.com/en-us/library/ff794652(v%3Dwinembedded.60).aspx">More details</a> about $ OEM $ folders. <br><br>  The steps to create an automated installation are: <br>  <a href="https://habr.com/ru/company/infopulse/blog/152311/">Step 1. Create an AutoUnattend.xml answer file.</a> <br>  <a href="https://habr.com/ru/company/infopulse/blog/152311/">Step 2. Adding drivers to the process of automatic installation of the OS.</a> <br>  <a href="https://habr.com/ru/company/infopulse/blog/152311/">Step 3. Adding additional applications and system settings using an answer file, scripts and commands.</a> <br>  <a href="https://habr.com/ru/company/infopulse/blog/152311/">Step 4. Creating a test image.</a> <br>  <a href="https://habr.com/ru/company/infopulse/blog/152311/">Step 5. Remove the image from the test machine and deploy to target devices.</a> <br><br>  These steps can be divided into sub-items with many details.  But in this article it is planned to give only a general vision of the task. <br><br><a name="Step1"></a><h4>  1. Create an AutoUnattend.xml answer file. </h4><br>  To make the installation fully automated, you need at least to answer all the questions in the Windows Setup Wizard.  The XML response file contains all the required fields for this. <br><br>  <b>The Image Configuration Editor (ICE)</b> can be used to create and edit an automated installation answer file.  Of course, you can use any text editor for this, but without the convenience and graphical interface of the ICE oriented to this task. <br><br>  ICE allows you to create an answer file, add components (features), drivers, and all the necessary options to make the installation fully automated. <br><br>  An intuitive user interface and an advanced search system make ICE a priority when choosing a tool to create and edit an answer file. <br><br><img src="https://habrastorage.org/storage2/b98/c37/487/b98c37487d55f65afbdba47a2570ee0f.png"><br><br><h5>  To get started with ICE: </h5><br><ul><li>  Open Distribution Share (DS): in our case it will be ‚ÄúWork \ DS‚Äù. </li><li>  Create a new (blank) answer file.  Add components and options. </li></ul><br><h5>  Features </h5><br>  Windows Features (in this text, the word ‚Äúcomponent‚Äù is used as the Russian equivalent here) are added in accordance with the requirements of the target device.  ICE can automatically add necessary and optional components after you add the required minimum. <br><br>  If your device is limited in disk space - pay attention to the Estimated Footprint indicator: this is the estimated size that Windows will occupy on the disk after installation. <br><br><img src="https://habrastorage.org/storage2/cfc/69f/c9c/cfc69fc9cf52d5dfdeec7bfc972db1bb.png"><br><br><h5>  Options </h5><br>  All components have one or more properties.  At a minimum, it is necessary to determine the answers to the <a href="http://technet.microsoft.com/en-us/library/dd744272.aspx">standard installation</a> questions: the <a href="http://technet.microsoft.com/en-us/library/dd744272.aspx">default installation</a> language, confirmation of the Microsoft Software License Terms, the product key, on which disk and in which partition Windows will be installed, and local installations. <br><br>  You can also automatically set the following <a href="http://technet.microsoft.com/en-us/library/dd744547.aspx">Windows Welcome</a> settings: language and region, user name, computer name, desktop wallpaper, date and time, current location, home group, wireless network, administrator password. <br>  All options are configured on one or more phases of the installation of Windows.  Pay attention to what specific phase you are planning to set up a specific option. <br><br><h5>  Disk tuning </h5><br>  In the first phase of Windows installation ( <b>Windows PE</b> ), you can configure the creation and deletion of partitions on a physical disk.  The set of options allows you to delete existing partitions, create new partitions, specify types, specify formats, letters and partition marks, select which drive will be installed on Windows. <br><br>  To create a new disk partition for the <i>DiskConfiguration / Disk / CreatePartitions</i> option, in the context menu, select the action " <i>Insert New CreatePartition</i> ". <br><br><img src="https://habrastorage.org/storage2/249/fcf/b30/249fcfb304df2aa87f3f834ab363987b.png"><br><br>  In the <i>CreatePartition section</i> that appears, type: <br><ul><li>  The sequence number of the created section ( <i>Order</i> ); </li><li>  Type ( <i>Type</i> ) - Primary, EFI, Extended, Logical or MSR; </li><li>  Size ( <i>Size</i> ); </li><li>  And will the partition be a fixed size or expandable ( <i>Extend</i> ) - true or false.  If Extend = true, the Size option is not required </li></ul><br>  To add additional features to the created partitions for the <i>DiskConfiguration / Disk / ModifyPartitions option,</i> in the context menu, select the <i>"Insert New ModifyPartition" action</i> . <br><br><img src="https://habrastorage.org/storage2/917/d61/c90/917d61c905b8723544f626b1efb529e4.png"><br><br>  In the <i>ModifyPartition</i> branch that <i>appears,</i> enter: <br><ul><li>  Order number - it must match the order number in the CreatePartition section; </li><li>  Section label ( <i>Label</i> ); </li><li>  The letter of the section ( <i>Letter</i> ); </li><li>  Format ( <i>Format</i> ) - NTFS or FAT32; </li><li>  Will the partition be a fixed size or expandable ( <i>Extend</i> ) - true or false; </li><li>  Section <i>Active</i> ( <i>Active</i> ) - true or false; </li><li>  Type of section ( <i>TypeID</i> ).  For example, for the system partition used to store system repair tools, the TypeID should be assigned 0x27. </li></ul><br><br><img src="https://habrastorage.org/storage2/008/564/a96/008564a969767a43440fa204f3f5a9a8.png"><br><br>  The <i>ImageInstall</i> option allows <i>you</i> to select on which partition the operating system will be installed. <br><br><img src="https://habrastorage.org/storage2/e62/750/297/e62750297c8234e89cee46a0b09f88fd.png"><br><br><h5>  Check and save answer file </h5><br>  To check the error response file, use <b>F5</b> .  Warnings and errors will be displayed in the message panel. <br><br><img src="https://habrastorage.org/storage2/1a8/482/1b7/1a84821b70f65328290d77e4a4c9d574.png"><br><br>  If you have omitted the required packages, you can add them automatically using the keyboard shortcuts <b>Ctrl + F5</b> . <br>  <b>Ctrl + Shift + F5</b> adds all required and optional packages.  Using this option, you should pay attention to the fact that the footprint can be significantly exceeded. <br><br>  The answer file must be named Autounattend.xml and saved to the root of the working directory. <br><br><a name="Step2"></a><h4>  2. Adding drivers to the process of automatic installation of the OS. </h4><br>  To enable the automatic installation of the driver, you must download them in advance from the official website and: <br><ul><li>  Add to Out-Of-Box drivers a folder with driver installation files. </li><li>  Add a path to each driver to one of the Windows installation phases.  <a href="http://technet.microsoft.com/en-us/library/cc766485(v%3Dws.10).aspx">Attention</a> : a certain driver must be installed at a certain stage (in a certain phase). </li></ul><br><br><a name="Step3"></a><h4>  3. Adding additional applications and system settings using an answer file, scripts and commands. </h4><br>  To add additional files to the installation, use the <b>$ OEM $</b> folder.  The $ OEM $ directory and its subfolders are automatically detected by Windows installation and copied to the hard disk. <br>  For example, all files and folders from ‚ÄúDS \ $ OEM $ Folders \\ $ OEM $ \ $$‚Äù will be copied to% WinDir%.  You can run scripts and install applications right from there. <br>  To use the $ OEM $ folder, do the following: <br><ul><li>  <i>Set the</i> value ‚Äútrue‚Äù to the property <i>‚ÄúUseConfigurationSet‚Äù in the</i> answer file </li><li>  In the Distribution Share panel in ICE, expand $ OEM $ Folders. </li></ul><br><img src="https://habrastorage.org/storage2/b8a/77f/5b5/b8a77f5b59c41cc34a987bc122dc26c1.png"><br><ul><li>  Right-click on the CustomFolder, and select ‚ÄúInsert Oem Folders Path‚Äù. </li></ul><br><br>  To install applications automatically after installation of the OS, set their settings, add registry entries and files, you can use the following methods: <br><br><ul><li>  <i>RunSynchronous</i> and <i>RunAsynchronous</i> commands in the answer file. </li><li>  <i>FirstLogonCommands</i> in the answer file.  These commands are executed automatically when the user logs into the system for the first time. </li><li>  <i>SetupComplete.cmd</i> starts automatically at the end of the OS installation.  Windows Setup looks for a file named SetupComlete.cmd in the <i>‚Äú% WINDIR% \ Setup \ Scripts‚Äù directory</i> , so you should copy this file to the <i>‚ÄúDS \ $ OEM $ Folders \ (CustomFolder) \ $ OEM $ \ $$ \ Setup \ Scripts directory ‚Äù</i> In the working folder. </li></ul><br>  Each of these methods has its pros and cons.  And be sure to consider the context of command execution. <br><br>  To silently install applications during OS installation, use the appropriate keys: <i>/ s</i> , <i>/ silent</i> or <i>/ r</i> with <i>setup.iss</i> file for InstallShield installation, <i>/ qn</i> for MSI packages, <i>/ verysilent / SP</i> for InnoSetup, <i>/ s</i> for Wiseinstaller etc.  Use <i>help</i> and the <i>/</i> option <i>.</i>  to see the command line options for installing the application. <br><br><a name="Step4"></a><h4>  4. Creating a test image. </h4><br>  A test image can be created as an ISO image or as a bootable USB. <br><br>  An example of creating an ISO image using the oscdimg tool (% ProgramFiles% \ Windows Embedded Standard 7 \ Tools \ AMD64 \ oscdimg.exe) in case the Work folder is located in the root of drive C: <br><br>  <i><b>oscdimg -bC: \ work \ boot \ etfsboot.com -u2 -hmc: \ work c: \ work \ wes7x64_test.iso</b></i> <i><br></i> <br>  For test purposes, we advise you to include standard tools for testing all necessary configurations (accessories, Microsoft management console, etc.) in the installation for the duration of the test. <br><br><a name="Step5"></a><h4>  5. Removing an image from a test machine and deploying it to target devices. </h4><br>  If you plan to make an image from a test machine and apply it on target devices, you first need to prepare a test machine using SYSPREP.  This is a requirement from Microsoft.  Otherwise, Microsoft does not provide product support. <br><br>  <a href="http://support.microsoft.com/kb/314828/en-us">Sysprep</a> prepares a Microsoft Windows installation for duplication, auditing, and delivery to the client. <br>  Sysprep removes specific system data from Windows, such as ComputerSID.  Therefore, preparation using SYSPREP is an important step in creating an image. <br><br>  You can create an image using <a href="http://technet.microsoft.com/en-us/library/cc766093(v%3Dws.10).aspx">WindowsPE</a> with <a href="">ImageX</a> or <a href="http://www.symantec.com/ghost-solution-suite">SymantecGhost</a> tools. <br>  Using the <b>WindowsPE Tools Command Prompt,</b> you can create a bootable WinPE image with automated wim file creation. <br>  Using the <b>Symantec Ghost \ Ghost Boot Wizard,</b> you can create a bootable Ghost image with automated creation of a ghost file. <br><br>  Each of these images can be used for further delivery to target devices. <br><br>  The resulting image can be used in lite-touch and zero-touch <a href="http://technet.microsoft.com/en-us/library/dd919185(WS.10).aspx">deployment strategies</a> . </div><p>Source: <a href="https://habr.com/ru/post/152311/">https://habr.com/ru/post/152311/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../152299/index.html">Multichannel software PWM to AVR</a></li>
<li><a href="../152301/index.html">Sergey Brin: You can buy a car with robotic control in five years</a></li>
<li><a href="../152305/index.html">RoboHornet: a new approach to browser performance testing</a></li>
<li><a href="../152307/index.html">AWS: Accelerated Media for RDS</a></li>
<li><a href="../152309/index.html">DariVVmeste.ru - all for one</a></li>
<li><a href="../152313/index.html">Analyzing Twitter data in the cloud using Apache Hadoop and Hive</a></li>
<li><a href="../152315/index.html">Explore the ocean with Google Maps</a></li>
<li><a href="../152317/index.html">Google maps go under water</a></li>
<li><a href="../152319/index.html">Digium G100 / G200 E1 / T1 / PRI Router</a></li>
<li><a href="../152321/index.html">Kickstarter has changed the rules for publishing projects</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>