<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GAE: batch put, distribution and some fraudulent gestures</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="An incomprehensible title, the lack of a picture - in general a topic in a purely marasmic style. 

 Once Emele happened to find out where his hamster...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GAE: batch put, distribution and some fraudulent gestures</h1><div class="post__text post__text-html js-mediator-article">  An incomprehensible title, the lack of a picture - in general a topic in a purely marasmic style. <br><br>  Once Emele happened to find out where his hamster came from (I exaggerate), for which Emelya turned to maxmind with a request to give IP2City a base. <br><br>  Vobshchem some smart start ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Task</b> : Make a definition of the city of users by IP for the GAE application. <br><br>  First problems: <br>  - it is impossible to upload the database file directly (1mb / file limit) <br>  - limited free resources <br><br>  and yes, the problems are not the last. <br><a name="habracut"></a><br>  Of course, it was possible to raise servachek, pour the base on the muscle, or, in general, use the binary base and the Python IP, but did not want to breed a zoo + also a ‚ÄúBUT‚Äù slide, which are much smaller. <br><br>  I did not dare to fill 3.5 million objects into the main application, for a reason: <br>  - the application itself needs resources <br>  - no interdependence (services are easily separated) <br><br>  Therefore, a separate application was created, which in the future will be called via urlfetch and output data on a specific IP. <br><br>  The 1Mb limit was overcome by creating a RequestHandler to get a part of the file and load this part of the objects into the storage. <br><br>  On the client side there is a small script that sends data using the POST method. <br><br><h2>  And here ... </h2><br><br>  ... start dancing "in the style of hard disco."  As it turned out, after 40,000 inserted objects, 1 hour of processor time was consumed.  And, having thought that separate put for each object is wasteful, I decided to try db.put () (so-called batch put), which inserts objects in batches. <br><br>  As it turned out, <i>db.put not only did not reduce the CPU time</i> for each request (remember, the local script transmits 200 lines from the ip block file for one request and so on until the end of the file), <i>but also increased it by about 10%</i> .  Agree, something is wrong here.  I still do not understand what the problem is, but in my opinion db.put simply causes put on all objects in the list (yes, it still inserts objects in a single transaction if possible, but this is not our case). <br><br>  With a simple recalculation, something turns out to be about $ 10 per load for the entire base (without locations) <br><br><h2>  Total, when developing for GAE: </h2><br><ul><li>  Think about how you will upload large amounts of data.  It is better to figure out how to collect them in the course of the life of the application. </li><li>  Use the resource in 10 applications, create web services for your services and be the most service of the service.  This will allow one way or another to reduce resource costs and get away from ‚Äúhard‚Äù limits, if required.  This is the main way to reach out to your needs. </li><li>  At the moment, db.put () has no performance advantages over Model.put () </li></ul><br><br>  Waiting for you in my <a href="http://marzmo.livejournal.com/">LiveJournal</a> . </div><p>Source: <a href="https://habr.com/ru/post/72610/">https://habr.com/ru/post/72610/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../72603/index.html">HTPC from old trash</a></li>
<li><a href="../72605/index.html">Mac OS X "Snow Leopard" Review</a></li>
<li><a href="../72606/index.html">Steam system statistics</a></li>
<li><a href="../72608/index.html">Webmoney has one of the worst tech support.</a></li>
<li><a href="../72609/index.html">Patch everything, that neither getting or Open source in action</a></li>
<li><a href="../72612/index.html">How to make a website more iPhone-compatible in 5 steps</a></li>
<li><a href="../72617/index.html">Sip moquito</a></li>
<li><a href="../72618/index.html">Business in the style of Habr - 3. Criticism of pure reason</a></li>
<li><a href="../72619/index.html">Recruitment in the open source command</a></li>
<li><a href="../72623/index.html">Prototype T-1000?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>