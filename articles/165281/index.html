<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Data Mining: Primary data processing using DBMS. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Every half hour there is a new article with a screaming slogan Big data - ‚Äúnew oil‚Äù! . Just a godsend for marketing texts. Big Data = Big Oil = Profit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Data Mining: Primary data processing using DBMS. Part 2</h1><div class="post__text post__text-html js-mediator-article">  Every half hour there is a new article with a screaming slogan <i><b>Big data - ‚Äúnew oil‚Äù!</b></i>  .  Just a godsend for marketing texts.  Big Data = Big Oil = Profit.  Where did this statement come from?  Let's go beyond the stamp and dig a little deeper: <br>  One of the first to use it was Michael Palmer [ <a href="http://ana.blogs.com/maestros/2006/11/data_is_the_new.html">1</a> ] as early as 2006: <br><blockquote>  Data is just crude oil.  It is valuable, but without processing it cannot be really used.  It must be turned into gas, plastic, chemicals, etc., in order to create value that drives profitability;  so the data needs to be analyzed and ‚Äúsee through‚Äù so that they become valuable. <br></blockquote><br>  Such an understanding of the trend ‚ÄúBig data - new oil!‚Äù Is closer to reality than to marketing.  And it does not cancel the statement of Disraeli: <br>  <i>"There are three kinds of lies: There are lies, blatant lies and statistics</i> . <i>"</i> <br>  This article is a continuation of the <a href="http://habrahabr.ru/post/165001/">Data Mining</a> topic <a href="http://habrahabr.ru/post/165001/">: Primary data processing using DBMS.</a>  <a href="http://habrahabr.ru/post/165001/">Part 1</a> <br>  We continue the prey! <br><img src="https://habrastorage.org/storage2/8f1/1d0/2ff/8f11d02ff24631c62f9d1d59028122c3.jpg"><br><a name="habracut"></a><br><h5>  Continuing to remove doubles </h5><br>  In the last article was given a small example of code that allows you to get rid of the "twins".  Continue to move in the same direction.  For successful work, you also need to convert the table with test data: <br><pre><code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--    --     select nextval('titanik_train_seq') as id, a.* into titanik_test_pk from titanik_test a; --          select id,pclass,"name",sex,age,sibsp,parch,ticket,fare,cabin,embarked, m[1] as ticket_type, m[2] as ticket_number into titanik_test_1 from (select id,pclass,"name",sex,age,sibsp,parch,ticket,fare,cabin,embarked, regexp_matches(ticket, '^\s*?(.*?)\s*?(\d*?)$') as m from titanik_test_pk ) as a;</span></span></code> </pre> <br>  In this code example, I decided to use a sequence from the previous table, in order to make it easier to combine the data if necessary later.  The division of the ticket name into text and series is carried out in the same way. <br><br>  We apply similar update operators to the test table (plus we will add two more, at the end, to replace the elements that were not in the training table): <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">update</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ticket_type=<span class="hljs-string"><span class="hljs-string">'A.5.'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ticket_type = <span class="hljs-string"><span class="hljs-string">'A./5.'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ticket_type=<span class="hljs-string"><span class="hljs-string">'A.5.'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ticket_type = <span class="hljs-string"><span class="hljs-string">'A/5'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ticket_type=<span class="hljs-string"><span class="hljs-string">'A.5.'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ticket_type = <span class="hljs-string"><span class="hljs-string">'A/5.'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ticket_type=<span class="hljs-string"><span class="hljs-string">'A.5.'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ticket_type = <span class="hljs-string"><span class="hljs-string">'A/S'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ticket_type=<span class="hljs-string"><span class="hljs-string">'A/4'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ticket_type = <span class="hljs-string"><span class="hljs-string">'A/4.'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ticket_type=<span class="hljs-string"><span class="hljs-string">'A/4'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ticket_type = <span class="hljs-string"><span class="hljs-string">'A4.'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ticket_type=<span class="hljs-string"><span class="hljs-string">'CA'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ticket_type = <span class="hljs-string"><span class="hljs-string">'CA'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ticket_type=<span class="hljs-string"><span class="hljs-string">'CA'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ticket_type = <span class="hljs-string"><span class="hljs-string">'CA.'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ticket_type=<span class="hljs-string"><span class="hljs-string">'SW/PP'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ticket_type = <span class="hljs-string"><span class="hljs-string">'SW/PP'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ticket_type=<span class="hljs-string"><span class="hljs-string">'SC/PARIS'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ticket_type = <span class="hljs-string"><span class="hljs-string">'SC/Paris'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ticket_type=<span class="hljs-string"><span class="hljs-string">'SOTON/OQ'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ticket_type = <span class="hljs-string"><span class="hljs-string">'SOTON/OQ'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ticket_type=<span class="hljs-string"><span class="hljs-string">'SOTON/O2'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ticket_type = <span class="hljs-string"><span class="hljs-string">'STON/O 2.'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ticket_type=<span class="hljs-string"><span class="hljs-string">'SOTON/O2'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ticket_type = <span class="hljs-string"><span class="hljs-string">'STON/O2.'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ticket_type=<span class="hljs-string"><span class="hljs-string">'W/C'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ticket_type = <span class="hljs-string"><span class="hljs-string">'W./C.'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ticket_type=<span class="hljs-string"><span class="hljs-string">'WEP'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ticket_type = <span class="hljs-string"><span class="hljs-string">'WE/P'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ticket_type=<span class="hljs-string"><span class="hljs-string">'SOTON/OQ'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ticket_type = <span class="hljs-string"><span class="hljs-string">'STON/OQ.'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ticket_type=<span class="hljs-string"><span class="hljs-string">'SC/PARIS'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ticket_type = <span class="hljs-string"><span class="hljs-string">'SC/PARIS'</span></span>;</code> </pre><br>  Ticket data - processed.  Now it is necessary to process the remaining text data on the same principle: <br>  Sex (sex) - twins are not found, does not need to be separated: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> sex, <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(sex) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> titanik_train_1 <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">asc</span></span>;</code> </pre><br><table><tbody><tr><th>  sex </th><th>  count </th></tr><tr><td>  female </td><td>  314 </td></tr><tr><td>  male </td><td>  577 </td></tr></tbody></table><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> sex, <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(sex) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">asc</span></span>;</code> </pre><br><table><tbody><tr><th>  sex </th><th>  count </th></tr><tr><td>  female </td><td>  152 </td></tr><tr><td>  male </td><td>  266 </td></tr></tbody></table><br>  Cabins (cabin) - more interesting here: <br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- ! -- select cabin, count(cabin) from titanik_train_1 group by 1 order by 1 asc; select cabin, count(id) from titanik_train_1 group by 1 order by 1 asc;</span></span></code> </pre><br>  If we execute the first request (commented out), we get a rather strange value - 0 entries with no cabin specified.  This is due to the peculiarities of the work of aggregating functions.  Cannot add empty values ‚Äã‚Äãcorrectly.  Therefore, we write <b>count (id)</b> .  And we get the result: 687 passengers with an unspecified cabin.  You can make the assumption that this is a "common" compartment.  And most likely for these entries is not specified class ticket. <br>  Check our assumption: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, cabin, ticket_type <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> titanik_train_1 <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> cabin <span class="hljs-keyword"><span class="hljs-keyword">ISNULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, cabin, ticket_type <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> titanik_train_1 <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> cabin <span class="hljs-keyword"><span class="hljs-keyword">NOTNULL</span></span>;</code> </pre><br>  Not confirmed.  Led many lines for which the ticket type is specified.  And vice versa (request number 2)?  Also not confirmed.  We conclude that either a series of tickets has been lost for a certain number of people, or it shows something else, and not the location of the person in the cabin or not.  That is, carries additional information.  We return to the previous request. <br>  In the output of queries on booths and the number of records with grouping, there are interesting lines: <br><table><tbody><tr><th>  cabin </th><th>  count </th></tr><tr><td>  C23 C25 C27 </td><td>  four </td></tr><tr><td>  C30 </td><td>  one </td></tr><tr><td>  F g73 </td><td>  2 </td></tr><tr><td>  T </td><td>  one </td></tr></tbody></table><br>  Firstly - information about the type of cabin (the first letter in front of the numbers). <br>  Secondly, for one ticket - several cabins.  And very often there are several people in the same cabin with tickets in which several cabins are indicated (read the seats).  It turns out quite interesting data that can not be ignored.  In fact, this data is duplicate of relatives, but taking into account, for example, friends or acquaintances, or work colleagues - i.e.  familiar people willing to help each other.  Also, we obtain information on how many people were in the cabin. <br>  Conclusion - add a box type cabin.  And add the number of cabins in the ticket.  Also add a field the number of people in the cabins. <br>  Those.  A family of 4 people takes 2 cabins.  Or for example, two different people occupy the same cabin.  The amount of data is growing! <br>  Requests that implement this are quite complex and require an understanding of how PREG regular expressions work in PostgreSQL. <br>  You can fit everything into one huge query, but I decided to split it into two parts.  Part one determines the type of cabin and the number of cabins on the ticket, and the second request determines the number of people with the same cabin (set of cabins) in the ticket. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>,survived,pclass,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,sex,age,sibsp,parch,ticket,fare,cabin,embarked, cnt <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cabin_cnt, cabin_type, ticket_type, ticket_number <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> titanik_train_2 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, survived, pclass,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,sex,age,sibsp,parch,ticket,fare,cabin,embarked, ticket_type, ticket_number, regexp_matches(cabin, <span class="hljs-string"><span class="hljs-string">'^\s*?([AZ]\d*)\s*?([AZ]\d*)\s*?([AZ]\d*)\s*?([AZ]\d*)\s*?.*?$'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> m, <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cnt, <span class="hljs-keyword"><span class="hljs-keyword">substring</span></span>(cabin, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cabin_type <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> titanik_train_1 <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, survived, pclass,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,sex,age,sibsp,parch,ticket,fare,cabin,embarked, ticket_type, ticket_number, regexp_matches(cabin, <span class="hljs-string"><span class="hljs-string">'^\s*?([AZ]\d*)\s*?([AZ]\d*)\s*?([AZ]\d*)\s*?$'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> m, <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cnt, <span class="hljs-keyword"><span class="hljs-keyword">substring</span></span>(cabin, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cabin_type <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> titanik_train_1 <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, survived, pclass,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,sex,age,sibsp,parch,ticket,fare,cabin,embarked, ticket_type, ticket_number, regexp_matches(cabin, <span class="hljs-string"><span class="hljs-string">'^\s*?([AZ]\d*)\s*?([AZ]\d*)\s*?$'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> m, <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cnt, <span class="hljs-keyword"><span class="hljs-keyword">substring</span></span>(cabin, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cabin_type <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> titanik_train_1 <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, survived, pclass,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,sex,age,sibsp,parch,ticket,fare,cabin,embarked, ticket_type, ticket_number, regexp_matches(cabin, <span class="hljs-string"><span class="hljs-string">'^\s*?([AZ]\d*)\s*?$'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> m, <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cnt, <span class="hljs-keyword"><span class="hljs-keyword">substring</span></span>(cabin, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cabin_type <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> titanik_train_1 <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, survived, pclass,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,sex,age,sibsp,parch,ticket,fare,cabin,embarked, ticket_type, ticket_number, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> m, <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cnt, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cabin_type <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> titanik_train_1 <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> cabin <span class="hljs-keyword"><span class="hljs-keyword">ISNULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> a;</code> </pre><br>  In principle, the only difficult point here is the regular expression.  How I built it: <br>  F 82 45 - an example of the name to be snatched.  This query is built from the main unit: <br>  <b>([AZ] \ d *)</b> - [AZ] means that there must be at least one large alphabetic character, \ d * - any number of 0 ... numbers. <br><br>  And the second request, which considers the number of people in the cabins. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> a.*, b.cnt <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cabin_people_cnt <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> titanik_train_3 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> titanik_train_2 a, ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> cabin <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cabid, <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cnt <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> titanik_train_1 <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> b <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> a.cabin = b.cabid <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> (a.cabin <span class="hljs-keyword"><span class="hljs-keyword">ISNULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> b.cabid <span class="hljs-keyword"><span class="hljs-keyword">ISNULL</span></span>); <span class="hljs-comment"><span class="hljs-comment">--.     -     687. update titanik_train_3 set cabin_people_cnt=0 where cabin ISNULL;</span></span></code> </pre><br>  As a result, we obtain three additional fields: the type of cabin, the number of cabins per ticket, and the number of people in the cabin. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Similarly, we do for test data: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>,pclass,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,sex,age,sibsp,parch,ticket,fare,cabin,embarked, cnt <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cabin_cnt, cabin_type, ticket_type, ticket_number <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> titanik_test_2 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, pclass,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,sex,age,sibsp,parch,ticket,fare,cabin,embarked, ticket_type, ticket_number, regexp_matches(cabin, <span class="hljs-string"><span class="hljs-string">'^\s*?([AZ]\d*)\s*?([AZ]\d*)\s*?([AZ]\d*)\s*?([AZ]\d*)\s*?.*?$'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> m, <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cnt, <span class="hljs-keyword"><span class="hljs-keyword">substring</span></span>(cabin, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cabin_type <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, pclass,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,sex,age,sibsp,parch,ticket,fare,cabin,embarked, ticket_type, ticket_number, regexp_matches(cabin, <span class="hljs-string"><span class="hljs-string">'^\s*?([AZ]\d*)\s*?([AZ]\d*)\s*?([AZ]\d*)\s*?$'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> m, <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cnt, <span class="hljs-keyword"><span class="hljs-keyword">substring</span></span>(cabin, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cabin_type <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, pclass,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,sex,age,sibsp,parch,ticket,fare,cabin,embarked, ticket_type, ticket_number, regexp_matches(cabin, <span class="hljs-string"><span class="hljs-string">'^\s*?([AZ]\d*)\s*?([AZ]\d*)\s*?$'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> m, <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cnt, <span class="hljs-keyword"><span class="hljs-keyword">substring</span></span>(cabin, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cabin_type <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, pclass,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,sex,age,sibsp,parch,ticket,fare,cabin,embarked, ticket_type, ticket_number, regexp_matches(cabin, <span class="hljs-string"><span class="hljs-string">'^\s*?([AZ]\d*)\s*?$'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> m, <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cnt, <span class="hljs-keyword"><span class="hljs-keyword">substring</span></span>(cabin, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cabin_type <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, pclass,<span class="hljs-string"><span class="hljs-string">"name"</span></span>,sex,age,sibsp,parch,ticket,fare,cabin,embarked, ticket_type, ticket_number, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> m, <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cnt, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cabin_type <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> cabin <span class="hljs-keyword"><span class="hljs-keyword">ISNULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> a;</code> </pre><br>  and the second part: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> a.*, b.cnt <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cabin_people_cnt <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> titanik_test_3 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> titanik_test_2 a, ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> cabin <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cabid, <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cnt <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> titanik_test_1 <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> b <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> a.cabin = b.cabid <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> (a.cabin <span class="hljs-keyword"><span class="hljs-keyword">ISNULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> b.cabid <span class="hljs-keyword"><span class="hljs-keyword">ISNULL</span></span>);</code> </pre><br>  Only one field remains: landing port (embarked): <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> embarked, <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> titanik_train_3 <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">asc</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> embarked, <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> titanik_test_3 <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">asc</span></span>;</code> </pre><br>  The result of this is that no doubles are found, it does not need to be separated: <br><table><tbody><tr><th>  embarked </th><th>  count </th></tr><tr><td>  C </td><td>  168 </td></tr><tr><td>  Q </td><td>  77 </td></tr><tr><td>  S </td><td>  644 </td></tr><tr><td></td><td>  2 </td></tr></tbody></table><br>  What to do with two records where there is no data?  You can replace the random values, you can drop, you can put the average.  To choose from. <br><br><h5>  findings </h5><br>  In this part, we have previously prepared the text data in the training and test sample.  By the time, this work took about three hours.  From downloading data to the current moment. <br><br>  This part turned out quite impressive in volume, because the continuation in the next post.  In the next post we will try to form a table with numeric values ‚Äã‚Äãinstead of string values.  If suddenly someone decides to do at the same time with me, using requests and processing data on this tutorial, I will answer questions in comments.  Waiting for critics. <br><br>  <b>Update</b> <br>  Part Three: <a href="http://habrahabr.ru/post/165283/">habrahabr.ru/post/165283</a> <br>  Part Four: <a href="http://habrahabr.ru/post/173819/">habrahabr.ru/post/173819</a> </div><p>Source: <a href="https://habr.com/ru/post/165281/">https://habr.com/ru/post/165281/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../165269/index.html">Mouse Wheel Speed ‚Äã‚ÄãCounter</a></li>
<li><a href="../165273/index.html">Seven years of WPF: what has changed?</a></li>
<li><a href="../165275/index.html">The key difference between AngularJS and Knockout</a></li>
<li><a href="../165277/index.html">Latest news from KickStarter: the best of 2012 (in the form of infographics)</a></li>
<li><a href="../165279/index.html">A bit about creating demos, part 1</a></li>
<li><a href="../165283/index.html">Data Mining: Primary data processing using DBMS. Part 3 (Pivot Tables)</a></li>
<li><a href="../165285/index.html">How we ported the Silverlight application to Windows 8</a></li>
<li><a href="../165289/index.html">The course of the young soldier "Sell services web designer." Part 2 "The client is always wrong"</a></li>
<li><a href="../16529/index.html">New videos "Get a Mac"</a></li>
<li><a href="../165293/index.html">VM Depot launched - a repository of virtual machine images on Linux for the Windows Azure community</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>