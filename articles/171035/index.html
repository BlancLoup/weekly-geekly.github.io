<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Posting videos on YouTube‚Äôs user‚Äôs channel</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="While developing an Android application for creating photo slideshows, I was faced with the task of publishing ready-made videos on YouTube‚Äôs personal...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Posting videos on YouTube‚Äôs user‚Äôs channel</h1><div class="post__text post__text-html js-mediator-article">  While developing an Android application for creating photo slideshows, I was faced with the task of publishing ready-made videos on YouTube‚Äôs personal channel. <br>  I had to tinker, because  First, we use cloud computing and data processing can take longer than the token.  And secondly, to implement the function, I had to face some inaccuracies and questions in the Google manual.  Details under the cut. <br><img src="https://habrastorage.org/storage2/528/4e5/4cc/5284e54cc40916fc2c93a6b0edf29fcd.png"><br><a name="habracut"></a><br>  <b>The essence of the task:</b> <br>  When the user has selected all the photos on his Android and decided on the music, the data for processing is sent to the server, and the user is prompted to specify where to put the finished video: in the on-line collection on our server, on the YouTube application‚Äôs shared channel YouTube channel.  (Also to the email address comes a link for downloading the video). <br>  If you choose to publish on a personal channel, we ask permission and upon confirmation, we get the token required to access the channel, which is saved on the server with the user data and remains valid for 60 minutes. <br>  But if the user has a slow Internet (long upload of photos) or a queue has accumulated on the server, the token becomes invalid, a second request is required.  For this situation, we immediately began to request token and refresh token, the second validity period is unlimited and we can publish videos even after 60 minutes. <br>  <b>Corrected mistakes:</b> <br>  In more detail what is token and refresh token and how to use them is in the manual, but here there are things that did not work exactly as described. <br>  1. The very first difficulty: the token received on the device was invalid when used on the server. <br><br>  <b>In the end, decided like this</b> <b><br></b>  <b>On Android, we use:</b> <br><pre><code class="java hljs">Intent intent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(...); intent.setData(Uri.parse(<span class="hljs-string"><span class="hljs-string">"https://accounts.google.com/o/oauth2/auth?"</span></span>+ <span class="hljs-string"><span class="hljs-string">"scope= "</span></span> + scope + <span class="hljs-string"><span class="hljs-string">"&amp;"</span></span> + <span class="hljs-string"><span class="hljs-string">"redirect_uri="</span></span> + redirect_uri + <span class="hljs-string"><span class="hljs-string">"&amp;"</span></span> + <span class="hljs-string"><span class="hljs-string">"response_type="</span></span> + response_type + <span class="hljs-string"><span class="hljs-string">"&amp;"</span></span> + <span class="hljs-string"><span class="hljs-string">"client_id="</span></span> + client_id)); startActivityForResult(intent);</code> </pre> <br>  As a result, we get an authorization code, then we get token and refresh token ourselves <br><pre> <code class="java hljs">HttpPosthttppost = newHttpPost(<span class="hljs-string"><span class="hljs-string">"https://accounts.google.com/o/oauth2/token"</span></span>); httppost.setHeader(<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>); List&lt;NameValuePair&gt;nameValuePairs = newArrayList&lt;NameValuePair&gt;(); nameValuePairs.add(newBasicNameValuePair(<span class="hljs-string"><span class="hljs-string">"code"</span></span>, code)); nameValuePairs.add(newBasicNameValuePair(<span class="hljs-string"><span class="hljs-string">"client_id"</span></span>, client_id)); nameValuePairs.add(newBasicNameValuePair(<span class="hljs-string"><span class="hljs-string">"redirect_uri"</span></span>, redirect_uri)); nameValuePairs.add(newBasicNameValuePair(<span class="hljs-string"><span class="hljs-string">"grant_type"</span></span>, <span class="hljs-string"><span class="hljs-string">"authorization_code"</span></span>)); httppost.setEntity(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UrlEncodedFormEntity(nameValuePairs)); HttpResponse response = httpclient.execute(httppost); HttpEntity entity = response.getEntity(); BufferedReader reader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BufferedReader(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(entity.getContent())); String responseLines; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((line = reader.readLine()) != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { responseLines += line; } JSONObject jsonObject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JSONObject(responseLines);</code> </pre><br>  <b>As a result, we get a response of the form:</b> <br><pre> <code class="java hljs">{ <span class="hljs-string"><span class="hljs-string">"access_token"</span></span>:<span class="hljs-string"><span class="hljs-string">"1/fFAGRNJru1FTz70BzhT3Zg"</span></span>, <span class="hljs-string"><span class="hljs-string">"expires_in"</span></span>:<span class="hljs-number"><span class="hljs-number">3920</span></span>, <span class="hljs-string"><span class="hljs-string">"token_type"</span></span>:<span class="hljs-string"><span class="hljs-string">"Bearer"</span></span>, <span class="hljs-string"><span class="hljs-string">"refresh_token"</span></span>:<span class="hljs-string"><span class="hljs-string">"1/xEoDL4iW3cxlI7yDbSRFYNG01kVKM2C-259HOF2aQbI"</span></span> }</code> </pre><br>  Get the token and refresh token and send them to the server <br>  <b>On the server side:</b> <b><br></b>  <b>To check the validity of the token:</b> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> verificationUri = <span class="hljs-string"><span class="hljs-string">"https://www.googleapis.com/oauth2/v1/tokeninfo?access_token="</span></span> + youTubeToken; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hc = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpClient(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> response = hc.GetAsync(verificationUri).Result; string tokenInfo = response.Content.ReadAsStringAsync().Result; JsonTextParser parse = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JsonTextParser(); JsonObject jsonObj = parse.Parse(tokenInfo);</code> </pre><br>  <b>As a result, we get a response of the form:</b> <br><pre> <code class="java hljs">{ <span class="hljs-string"><span class="hljs-string">"access_token"</span></span>:<span class="hljs-string"><span class="hljs-string">"1/fFAGRNJru1FTz70BzhT3Zg"</span></span>, <span class="hljs-string"><span class="hljs-string">"expires_in"</span></span>:<span class="hljs-number"><span class="hljs-number">320</span></span>, <span class="hljs-string"><span class="hljs-string">"token_type"</span></span>:<span class="hljs-string"><span class="hljs-string">"Bearer"</span></span> }</code> </pre><br>  <b>If the token's lifetime is enough, then use it, if not, then we get a new token, use the refresh token:</b> <br><pre> <code class="java hljs">WebClient client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebClient(); NameValueCollectionloginFormValues = newNameValueCollection(); loginFormValues.Add(<span class="hljs-string"><span class="hljs-string">"client_id"</span></span>, client_id); loginFormValues.Add(<span class="hljs-string"><span class="hljs-string">"refresh_token"</span></span>, refreshYouTubeToken); loginFormValues.Add(<span class="hljs-string"><span class="hljs-string">"grant_type"</span></span>, <span class="hljs-string"><span class="hljs-string">"refresh_token"</span></span>); Byte[] response = client.UploadValues(<span class="hljs-string"><span class="hljs-string">"https://accounts.google.com/o/oauth2/token"</span></span>, loginFormValues); string result = Encoding.UTF8.GetString(response); JsonTextParser parse = newJsonTextParser(); JsonObjectjsonObj = parse.Parse(result);</code> </pre><br>  <b>As a result, we get a response of the form:</b> <br><pre> <code class="java hljs">{ <span class="hljs-string"><span class="hljs-string">"access_token"</span></span>:<span class="hljs-string"><span class="hljs-string">"1/fFBGRNJru1FQd44AzqT3Zg"</span></span>, <span class="hljs-string"><span class="hljs-string">"expires_in"</span></span>:<span class="hljs-number"><span class="hljs-number">3600</span></span>, <span class="hljs-string"><span class="hljs-string">"token_type"</span></span>:<span class="hljs-string"><span class="hljs-string">"Bearer"</span></span>, }</code> </pre><br>  Use the received token for its intended purpose. <br><br>  2. Further, the parameters "scope", "state" and "client_secret": in some cases, where according to the documentation these parameters must be specified, the program gave an error if we set them, and worked fine if not set.  And vice versa - sometimes they had to be used not only where indicated. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For example, the ‚Äústate‚Äù parameter often returns a value in the form of the nearest US state where the Google server is located ‚Äî this increases the speed of data exchange between the server and the device.  In some cases, this parameter is specified as mandatory.  But in Russia it is useless. <br><br>  ‚ÄúScope‚Äù is responsible for which service we want to use when accessing Google.  It is not clear where to get the full list of values ‚Äã‚Äãfor this parameter.  Since we needed YouTube, we, having indicated it, simply guessed.  At the same time, it is not clear what parameter value should be if we want to refer, for example, to the Google calendar? <br><br>  In one of Google‚Äôs documentation requests, the client_secret parameter is needed.  We don't have it.  And if we receive and specify - nothing works. <br><br>  3. Most of our application is done on a webserver.  But when requesting a token, the webserver was not valid, so we applied installedapps and requests approached it.  To be honest, they did not understand why. <br><br>  4. The <a href="https://developers.google.com/accounts/docs/OAuth2InstalledApp">developers.google.com/accounts/docs/OAuth2InstalledApp#formingtheurl</a> documentation lists two possible options for the redirect_uri parameter: ‚Äúurn: ietf: wg: oauth: 2.0: oob‚Äù and <a href="http://localhost/">localhost</a> .  How to use <a href="http://localhost/">localhost</a> , it was not clear to me, with ‚Äúurn: ietf: wg: oauth: 2.0: oob‚Äù everything worked. <br><br>  5. Also open is the question of how to use the token obtained from the Android account on the device itself.  Those.  An account is linked to Android, and it is from this account that you can get a token, but it is unclear how to use it.  We use what we request from the user account. <br><br>  6. It is not clear yet what scope should be used for ‚Äúlogging in to your GOOGLE account‚Äù?  We use "to control YouTube". <br><br>  7. And I wonder why the Google Library for OAUTH2 Android weighs so much?  Using it, our application becomes several times harder, so we refused to use it. <br><br>  Thanks for attention!  I would be glad if someone will help my comments, as well as if someone can answer my questions. </div><p>Source: <a href="https://habr.com/ru/post/171035/">https://habr.com/ru/post/171035/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../171021/index.html">Programming low latency sound in iOS</a></li>
<li><a href="../171025/index.html">Practical tips for portfolio building for testers</a></li>
<li><a href="../171029/index.html">‚ÄúFake video work of the smartphone application with the background around‚Äù or ‚ÄúHow to save on the DIY stabilization system‚Äù or ‚ÄúIs it possible to write this down with a thread of software right in the smart?‚Äù</a></li>
<li><a href="../171031/index.html">New Grandmothers. "Innovative" cloud video surveillance</a></li>
<li><a href="../171033/index.html">The history of the GNU operating system, or what happened to Hurd?</a></li>
<li><a href="../171037/index.html">Google two-way authentication bypass</a></li>
<li><a href="../171041/index.html">The coolest result on TechCrunch Moscow '12</a></li>
<li><a href="../171043/index.html">Video from the W3C conf 2013 conference is available on YouTube</a></li>
<li><a href="../171045/index.html">3PAR StoreServ for work in a corporate mail environment</a></li>
<li><a href="../171047/index.html">What to read? Proposals for the publication of computer books. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>