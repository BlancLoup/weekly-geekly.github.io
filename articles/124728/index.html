<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Building an index for a search engine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The full content and list of my articles on the search engine will be updated here . 

 In previous articles, I talked about the work of the search en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Building an index for a search engine</h1><div class="post__text post__text-html js-mediator-article">  The full content and list of my articles on the search engine will be updated <a href="http://habrahabr.ru/blogs/search_engines/123671/">here</a> . <br><br>  In previous articles, I talked about the work of the search engine, and that is how it came to a technically difficult moment.  Let me remind you that they share 2 types of indices - direct and inverse.  Direct ‚Äî compares a document with a list of words in it.  Reverse - the word is matched with a list of documents in which it is.  Logically, a reverse index is best for quick searches.  An interesting question and about the order in which the list of stored documents. <br><br>  In the previous DataFlow step from the indexing module, we received a piece of data in the form of a direct index, reference information, and page information.  Usually I have about 200-300mb and contains about 100 thousand pages.  Over time, I abandoned the whole direct index storage strategy, and I only store all these pieces + a full reverse index in several versions so that you can roll back. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A reverse index device with a simple form, we store a file, in it there is a table of addresses of the beginning of the data for each word in the beginning, then the data itself.  This is me exaggerated.  This is how the format that is most beneficial for optimizing search speeds turns out - no need to jump through the pages - as Bryn and Page wrote, - 1 seek, 1 read.  At each iteration of the rebuild, I use 20-50 pieces of information described above, I obviously cannot load all of them into memory, especially since it is useful to store a lot of index overhead there. <br><a name="habracut"></a><br>  To solve this and many other problems associated with the limitations of the file system, the disk, parallel access to several lists of pages, I divided the entire index into 256 parts.  Part I contains lists of pages for the words WORD_ID% 256 = I <br>  Thus we divide the index into approximately equal parts.  In addition, all processing at the next iteration of rebuilding the index is connected only within one part.  Those.  out of 20-50 pieces of database of 200-300 Mb, you need to download only those data that are associated with words that fall into the part being processed. <br><br>  Total: we do 256 repetitions of the same procedure: <br><br><ol><li>  We read the necessary data from the input pieces of the database, after downloading all the information about words, pages and Url pages.  In the memory we sort, make lists of the correct structure.  We pack info about the page and add its ID, HASH and other data. </li><li>  open the barrel (I called so the pieces of the index) reverse index "extreme version" for reading.  Open the empty barrel of the ‚Äúnew version‚Äù of the index for writing. </li><li>  For each word, we merge 2 lists in order ‚Äî one built sorted in memory, and the other readable and already sorted in the file. </li><li>  Close, append everything you need, rejoice. </li></ol><br><br>  In practice, it turned out naturally that the list that is already stored in the ‚Äúprevious version‚Äù of the index turns out to be sorted during the new iteration only when no external information about the pages has changed, and this is obviously not the case. <br><br>  After all, while we were saving info for the index, we could recalculate data on PR, page metrics, websites relevance, and so on.  And as a result, the odds for sorting will change.  The question whether it is necessary to sort lists at all by similar parameters is still open.  According to rumors, Google sorts the pages in lists on PR, but obviously then you need to be able to quickly discard the husks when searching - which you have specially pumped PR, but the content is not enough. <br><br>  I use a combined factor, built from general information about a word on a page (number of meetings; meeting place ‚Äî title, meta, links, text; selection, formatting), from the metrics of the topic (they are very poorly developed at the moment), from PR, from the word-by-word PR (I also have PR for every word) and some others. <br><br>  And it is obvious that with high-frequency queries, we really need, God forbid, the first 1000-2000 results in the list, for accuracy we will count 262 thousand.  Because  all the popular answers obviously fall into them, and then you can run them already ranking function that sorts them properly. <br>  With low-frequency queries, when we really need 2-3-10 results, we cannot do without complete index passing, however, the total length of the list of pages is rarely more than 100 thousand. <br><br>  In general, if we can guarantee that the first N of thousands of pages in the list will be the best of the remaining couple of millions, then the problem is solved, and to guarantee this is quite simple heuristic methods.  Then for correct rebuilding of each barrel: <br><ol><li>  remember which PR has changed a lot when recalculating </li><li>  we load the first N thousands from the list + a bit from the rest according to the PR criteria, page metrics and other heuristics </li><li>  there we load from the input data the necessary portion of the words of the current barrel </li><li>  only for selected pages we are already updating all the data to the correct, new ones - PR, metrics </li><li>  sorting hundreds of thousands of results, instead of a couple of tens of millions and already in memory </li><li>  we write the sorted, and the rest is simply copied from the previous index by removing duplicates </li></ol><br><br>  And of course, you need to have the ‚Äúupdate entirely‚Äù function once a month or six months, for example, the index will be rebuilt all with the simplest direct algorithm. <br><br>  It is clear that even this amount of work applied to 3 million words and numbers used average is not easy, but compared with a complete rebuilding, the gain is significant: you don‚Äôt need to sort on the disk, you don‚Äôt need to load external metrics, PR and other parameters - because also can not cache everything in memory. <br><br>  It's funny that the iterative rebuilding method gives you many times more performance than the simplest construction of the inverse index from the direct one.  Of course, some search engines manage to do it fairly quickly on a fairly powerful hardware, but this is still not the best approach, even though the most correct one.  It‚Äôs just that the number of long inserts in the inverse index reduces all advantages to nothing, and in the storage structures known to me either the insertion speed or the sequential read speed suffers. </div><p>Source: <a href="https://habr.com/ru/post/124728/">https://habr.com/ru/post/124728/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../124718/index.html">In the IT industry, technical experts are most in demand.</a></li>
<li><a href="../124721/index.html">A preliminary version of Windows Azure Toolkit for Social Games has been released.</a></li>
<li><a href="../124724/index.html">Innovative laboratory extends the competition!</a></li>
<li><a href="../124725/index.html">Installing common lisp as a user</a></li>
<li><a href="../124727/index.html">The iTwin gadget simplifies remote file transfer from PC to PC</a></li>
<li><a href="../124729/index.html">kedDroid - S04E02. Video review software for Android</a></li>
<li><a href="../124730/index.html">Service selection of names and names from idea to implementation</a></li>
<li><a href="../124731/index.html">Knockout, hands-on experience</a></li>
<li><a href="../124732/index.html">MultiMi is a good aggregator of your life on the Web.</a></li>
<li><a href="../124733/index.html">Google introduces credit cards for advertisers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>