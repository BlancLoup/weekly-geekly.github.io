<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Developing a game of endless racing for iOS using Cocos2D-iphone</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today I want to tell you about creating a game for iOS based on Cocos2D on the example of the recently released game ‚ÄúBee Races‚Äù (eng. - Bee Race). 
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Developing a game of endless racing for iOS using Cocos2D-iphone</h1><div class="post__text post__text-html js-mediator-article">  Today I want to tell you about creating a game for iOS based on Cocos2D on the example of the recently released game ‚ÄúBee Races‚Äù (eng. - Bee Race). <br>  The gameplay does not contain anything difficult - it is essentially an endless runner in which you need to collect points and dodge obstacles.  Only instead of a red-haired girl or a treasure hunt - a two-dimensional bee flies here. <br>  For those interested, please under the cat (Achtung! Minen und a lot of abbreviations). <br>  The main sections to consider: <br><ol><li>  <a href="https://habr.com/ru/post/165601/">A very brief introduction to Cocos2D</a> </li><li>  <a href="https://habr.com/ru/post/165601/">Use Cocos2D at the same time as StoryBoard</a> </li><li>  <a href="https://habr.com/ru/post/165601/">Brief description of the gameplay and project structure</a> </li><li>  <a href="https://habr.com/ru/post/165601/">We buy tools and what to do if a toad is choking</a> </li><li>  <a href="https://habr.com/ru/post/165601/">What does not smell the application or connect in-app billing</a> </li><li>  <a href="https://habr.com/ru/post/165601/">We socialize.</a>  <a href="https://habr.com/ru/post/165601/">We connect Game Center and create a multiplayer version for two players</a> </li><li>  <a href="https://habr.com/ru/post/165601/">What missed Akela</a> </li><li>  <a href="https://habr.com/ru/post/165601/">Publish</a> </li></ol><br><br>  Spoiler: <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/QDMmyaKdWoA%3Ffeature%3Doembed&amp;xid=17259,15700002,15700021,15700186,15700191,15700253&amp;usg=ALkJrhgxHpMXDGH9RJVl2njLzUr_gGnPFg" frameborder="0" allowfullscreen=""></iframe><br><a name="habracut"></a><br><br><a name="chapter1"></a><br><h5>  1. A very brief introduction to Cocos2D. </h5><br>  Cocos2d-iphone is a free 2D iOS engine that uses OpenGL for hardware accelerated graphics and supports Chipmunk or Box2D as physics engines. <br>  Actually, why do we need an engine?  In order to avoid the need to write a sprite uploader (in particular from sprites), correctly start / stop animation, game timers, physics engine.  Well, the main thing is hardware acceleration of graphics, if you create a game, albeit with simple graphics, based on Cocoa Touch components, then after the N-th number of game elements, you will actively get the bullet-time effect to the place and out of place, or The game generally honors in Bose. <br>  Cocos2D stores all the sprites in the cache, duplicates of one sprite are relatively light, because  Sprite stores a link to the frame, but not the graphics itself.  At the same time rendering the sprite in OpenGL buffer is a faster operation than rendering the Cocoa element in the tree of other graphic elements. <br>  As for physical objects - they are not directly related to sprites, so if you want a sprite, for example a flower, to contain a corresponding physical polygon, then you need to write a heir to SpriteFlower.  But a more flexible system - a flower can add not one but several polygons, besides, you can even choose which of the physics engines to use. <br>  Now that we have <s>understood all the unimaginable subtleties,</s> have read the promised introduction to Cocos2D, let's get down to some specifics. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="chapter2"></a><br><h5>  2. Use Cocos2D at the same time as StoryBoard </h5><br>  After all the praises of Cocos2D, it looks a bit illogical.  However, in reality, for static windows it is much easier to use Interface Builder and Storyboard mechanisms.  Firstly, you can mouse all these pictures, and secondly, the Storyboard software interface itself is too convenient not to use it.  And yes, I know that there is <a href="http://cocosbuilder.com/">cocosbuilder.com</a> <br>  How it looks in Interface Builder: <br><img src="https://habrastorage.org/storage2/8f7/954/07e/8f795407e6013793feb90adda46bd647.png"><br>  All the windows here are described in the Storyboard, and the main window of the game simply contains the Cocos2D scene as the background, and the HUD is placed on top, also made on the basis of standard elements. <br><img src="https://habrastorage.org/storage2/cbe/ef9/554/cbeef9554cdacc5f38f5e503d86821f6.png"><br>  Pay attention to what the screen looks like - the white background is Cocos2D, which will load the necessary graphics at the start of the game, and the indicator of lives, strings, etc. is done using the builder's interface. <br>  I will not increase the already large article with a description of how this is done, I‚Äôll just provide a link from where I <s>copied the code and</s> drew inspiration. <a href="https://github.com/tinytimgames/CCViewController">Github.com/tinytimgames/CCViewController</a> <br><br><a name="chapter3"></a><br><h5>  3. Brief description of the gameplay and project structure </h5><br>  The gameplay is as follows - the bee hangs motionless, and according to the theory of relativity, the field rushes forward, carrying various dangers in the form of spiders and poisonous plants, as well as various buns in the form of dandelions and dandelion seeds.  In Cocos2D, in fact, there is a camera object that can follow the player, but in practice it turned out to be easier to move the CCLayer on which the game world is located. <br>  Management is the simplest - tapnul on the screen, the bee flew down, tapnul again - up.  Nevertheless, it turned out that the players intuitively want to make a slide and therefore, at the beginning, it is not quite convenient. <br>  The generation of the world is not uniform, but in portions according to a simple algorithm.  The game has three special layers for filling with objects.  During the start of the game, all three are filled with objects.  Then one of the layers is taken and filled with objects for a certain length.  After some time, the next section is filled, but in the second layer, and then the third.  When the bee flies from the second to the third section, the first layer is cleared, and then the fourth section starts to fill in, and so on.  It would have been possible to manage with two layers, but then it would have been more difficult to deal with the effect when an object that had flown from one area to another disappears (in my case such objects are only the flying seeds of an oduvan).  This is due to the fact that objects are removed in one fell swoop, and not coordinatewise. <br>  The project uses the Chipmunk physics engine.  I took it for two reasons.  Firstly, it seems to be more simple, and secondly, I already dealt with Box2D when I used AndEngine, but I wanted something new.  The engine is needed only to determine the collision of a bee with game objects, physics, as in evil birds, no. <br><br><a name="chapter4"></a><br><h5>  4. We buy tools and what to do if a toad is choking </h5><br>  In the development of kazualki the main thing is not to dwell.  I can confidently say that the main killer of Angry Birds could only be perfectionism.  But even if it is not <s>possible</s> to make a superframe with the base class MyObject, which can be edited by a specially designed editor, this does not mean that you cannot automate many things. <br>  First of all, greatly simplifies the life of Linux-way.  For example, the artist drops me in high resolution pictures in dropbox.  I have a script that converts them to a lower resolution (mogrify, aha) + adds ‚Äìhd version (@ 2x depending on the situation). <br>  Using Cocos2D with Interface builder is also primarily a time optimization. <br>  It can also be very useful to <a href="http://www.codeandweb.com/texturepacker">TexturePacker</a> , which will pack all the sprites into one spriteshit and thus reduce the amount of memory consumed, unless you can even manage to make all the sprites in size multiples of two.  TexturePacker paid, but it is worth it.  With sprititshit easier in the sense that adding a new sprite, there is no need to add new files to the project. <br>  The main difficulty for 2D physics is to create a polygon using pictures, which will be loaded with a physics engine.  Manually it is impossible to do this, so you need to use some kind of tool.  There are various types of offers to make a vector structure using Inkspace, but I personally wrote the AndengineVertexHelper utility code.google.com/p/andengine-vertex-helper/downloads/list for this purpose <a href="http://code.google.com/p/andengine-vertex-helper/downloads/list">.</a> <br>  It took about one day to do it, but this thing turned out to be very useful.  By default, the program is a template for code generation engine Andengine, details here <a href="http://www.andengine.org/forums/features/vertex-helper-t1370.html">www.andengine.org/forums/features/vertex-helper-t1370.html</a> <br>  Change the template to <pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span>%.5f<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span>%.5f<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  and get the formatting in plist. <br><br>  Next, create a plist file with object descriptions: <br><div class="spoiler">  <b class="spoiler_title">Expand example</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plist</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>bee0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>vertices<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">array</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span>-0.41786<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span>-0.14844<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span>-0.40714<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span>0.07031<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span>-0.03929<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span>0.14453<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span>0.27143<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span>0.15625<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span>0.46071<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span>-0.02344<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span>0.45714<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span>-0.29688<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span>0.26786<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span>-0.46484<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span>0.02143<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span>-0.46094<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span>-0.29643<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span>-0.31250<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">real</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">array</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br><br>  And the object loader: <br><div class="spoiler">  <b class="spoiler_title">Expand example</b> <div class="spoiler_text"><pre> <code class="hljs objectivec">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)createBodyAtLocation:(<span class="hljs-built_in"><span class="hljs-built_in">CGPoint</span></span>)location{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> mass = <span class="hljs-number"><span class="hljs-number">1.0</span></span>; body = cpBodyNew(mass, cpMomentForBox(mass, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.sprite.contentSize.width*<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.sprite.scale, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.sprite.contentSize.height*<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.sprite.scale)); body-&gt;p = location; body-&gt;data = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; cpSpaceAddBody(space, body); <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *path =[[<span class="hljs-built_in"><span class="hljs-built_in">NSBundle</span></span> mainBundle] pathForResource:<span class="hljs-string"><span class="hljs-string">@"obj _descriptions"</span></span> ofType:<span class="hljs-string"><span class="hljs-string">@"plist"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// &lt;- load plist NSDictionary *objConfigs = [[[NSDictionary alloc] initWithContentsOfFile:path] autorelease]; NSArray *vertices = [[objConfigs objectForKey:namePrefix] objectForKey:@"vertices"]; shape = [ChipmunkUtil polyShapeWithVertArray:vertices withBody:body width:self.sprite.contentSize.width height:self.sprite.contentSize.height]; shape-&gt;e = 0.7; shape-&gt;u = 1.0; shape-&gt;data = self; shape-&gt;collision_type = OBJ_COLLISION_TYPE; cpSpaceAddShape(space, shape); }</span></span></code> </pre> </div></div><br>  To visually test the conformity of sprites and their physical representations, I strongly advise you to use this thing: <a href="https://github.com/nubbel/CPDebugLayer">github.com/nubbel/CPDebugLayer</a> <br>  It will look much clearer: <br><img src="https://habrastorage.org/storage2/aaa/59d/04d/aaa59d04d7d6691a4aca54a2e4796f25.png"><br>  For another game, I wrote a custom map editor (I used the same PyQt) and I can say that this time has returned many times. <br>  Summarizing this section, I want to say - automate your work, even simple scripts will save you a lot of time, and most importantly, you will be busy with programming this time. <br><br><a name="chapter5"></a><br><h5>  5. Than does not smell the application or connect in-app billing </h5><br>  By collecting in the game oduvany, the player actually gets in-game money.  They can be spent on new characters.  By and large, the characters do not differ by anything except the appearance - they are neither more agile nor anything else.  However, where there is progress, there is a cheat.  The game has the opportunity to buy dowan for real money.  Since  the characters are almost the same, then there is no server check for the validity of the purchase. <br><br><a name="chapter6"></a><br><h5>  6. We socialize.  We connect GameCenter and create a multiplayer version for two players </h5><br>  For the socialization of the application, I added two leaderboards - a counter for the distance traveled and the number of points scored.  Although I am genuinely interested, does anyone use this at all? <br>  A more useful feature of the game center is the ability to create a multiplayer game. <br>  I did not do it in vain for the portionality of the card generation - so that the buffer is filled with a sufficient number of objects ‚Äúfor the future‚Äù if there are problems with the network.  One of the players will be the server, the other - the client. <br>  To determine who is who, at the beginning of the game a random number is transmitted along with other meta-information about the player.  The one who has it more is the server. <br>  And although the size of the buffer with objects is large enough to smooth out the unevenness of the network, the delay can lead to the fact that one player is far ahead of the other.  In this case, the opponent will be shown by an arrow, i.e.  its height will be displayed. <br>  The second player‚Äôs sprite was also immobile, however, its position was periodically corrected taking into account the information transmitted by it and the current position of the ‚Äúworld‚Äù position.  Ideally (with instant network transmission), the player would ‚Äúmove‚Äù evenly, without transferring too much information. <br>  However, in practice, this update caused side effects - the player twitched, because  even small delays between updates were noticeable.  Therefore, the update was made not instant, but in the form of a tween animation in half a second.  In practice, it looks as if the bee is slowing down or accelerating smoothly. <br><br><a name="chapter7"></a><br><h5>  7. What did Akela miss </h5><br>  Following the development, some problems surfaced: <br>  1. The aforementioned control problem - tap is not intuitive in this game. <br><br>  2. The graphics stumble a bit each restart of the overall layer. <br>  Moreover, if the action is looped like repeatForever, then there is practically no such problem: <br><div class="spoiler">  <b class="spoiler_title">Expand example</b> <div class="spoiler_text"><pre> <code class="hljs objectivec">-(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) infiniteMove{ <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> actionBy = [CCMoveBy actionWithDuration: BUFFER_DURATION position: ccp(-BUFFER_LENGTH, <span class="hljs-number"><span class="hljs-number">0</span></span>)]; <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> actionCallFunc = [CCCallFunc actionWithTarget:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> selector:<span class="hljs-keyword"><span class="hljs-keyword">@selector</span></span>(requestFillingNextBuffer)]; <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> actionSequence = [CCSequence actions: actionBy, actionCallFunc, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> repeateForever = [CCRepeatForever actionWithAction:actionSequence]; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.bufferContainer runAction:repeateForever]; }</code> </pre> </div></div><br>  But I made the movement gradually accelerate, so each cycle creates a new action.  This causes the graphics to stumble a bit: <br><div class="spoiler">  <b class="spoiler_title">Expand example</b> <div class="spoiler_text"><pre> <code class="hljs objectivec">-(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) infiniteMoveWithAccel{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> duration = BUFFER_DURATION-BUFFER_ACCEL*<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.lastBufferNumber; duration = max(duration, MIN_BUFFER_DURATION); <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> actionBy = [CCMoveBy actionWithDuration: duration position: ccp(-BUFFER_LENGTH, <span class="hljs-number"><span class="hljs-number">0</span></span>)]; <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> restartMove = [CCCallFunc actionWithTarget:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> selector:<span class="hljs-keyword"><span class="hljs-keyword">@selector</span></span>(infiniteMoveWithAccel)]; <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> fillBuffer = [CCCallFunc actionWithTarget:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> selector:<span class="hljs-keyword"><span class="hljs-keyword">@selector</span></span>(requestFillingNextBuffer)]; <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> actionSequence = [CCSequence actions: actionBy, restartMove, fillBuffer, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.bufferContainer runAction:actionSequence]; }</code> </pre> </div></div><br>  In other matters, when I tested "on cats", none of the subjects complained about it, but if you look closely, you can see. <br><br>  3. Using Game Center for multiplayer, on the one hand, eliminated the need for authorization, and also made it possible to make the game without a server part (using only the Eagle Peer-to-Peer), but on the other hand, it made it impossible to write a bot. <br>  But this game is unlikely to gain as many users as there are always several people online.  A bot in this regard is a wonderful solution - a man defeats AI, thinking that he is fighting a real person, and even the simplest game seems to be several times more interesting. <br><br><a name="chapter8"></a><br><h5>  8. And finally, the publication. </h5><br>  In fact, there was nothing in the publication.  Unless four days could not understand why the application with the status ready for sale is not visible in iTunes.  It turned out that I just forgot to change the date of ‚ÄúRights and Pricing -&gt; Availability Date‚Äù, which I had already in July of this year. <br><br>  I hope it was interesting to read and someone learned something useful for themselves. </div><p>Source: <a href="https://habr.com/ru/post/165601/">https://habr.com/ru/post/165601/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../165587/index.html">Writing to a doctor via the Internet - inside view</a></li>
<li><a href="../165593/index.html">The origin of coworking in Saratov</a></li>
<li><a href="../165595/index.html">Browse content of 4 Sony Xperia smartphones: J, Tipo Dual, Acro S and Miro</a></li>
<li><a href="../165597/index.html">Strings in C # and .NET</a></li>
<li><a href="../165599/index.html">Meet the BitTorrent client for Google Chrome</a></li>
<li><a href="../165605/index.html">Anonymous asks to recognize DDoS attacks as a legitimate form of protest</a></li>
<li><a href="../165607/index.html">How was stolen half-life 2</a></li>
<li><a href="../165609/index.html">Logic - interesting announcements at CES 2013 and the latest gaming and IT industry news ‚Ññ9</a></li>
<li><a href="../165611/index.html">A simple oscilloscope for 1 day</a></li>
<li><a href="../165613/index.html">Familiarity with technology after 25 years in prison</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>