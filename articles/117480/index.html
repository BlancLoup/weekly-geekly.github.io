<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We teach Google Analytics to be friends with Yandex.Direct</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Google Analytics ‚Äî a freeware statistics service for Google‚Äôs companionship companies ‚Äî provides such detailed statistics with a host of powerful tool...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We teach Google Analytics to be friends with Yandex.Direct</h1><div class="post__text post__text-html js-mediator-article"><img src="http://tandl.ru/temp/gahead.png" align="left">  Google Analytics ‚Äî a freeware statistics service for Google‚Äôs companionship companies ‚Äî provides such detailed statistics with a host of powerful tools that it instantly became popular among webmasters, including Runet experts.  But even such a developed and thought-out system has several disadvantages.  And cope with them is obtained far from always, and certainly not with a little blood, because all the Google Analytics tools, data processing scripts and, most importantly, all the statistics obtained are stored on Google servers, official information and consultants provide a minimum of information, and the main script for collection of <a href="">ga.js</a> and that is obfuscated to impossibility.  All this ties hands when trying to solve problems arising from data processing. <br>  Many of these problems, Google gently ruffles the nerves of Russian-speaking users: there are mysterious problems with encodings, disregard for Runet search engines and a problem that has long depressed both modest owners of online stores and experienced web analysts - a categorical refusal to perceive Yandex advertising platforms. Direct.  Moreover, such hatred is not reciprocal, and Yandex.Metrika honestly tries to process, as best it can, transitions from Google Adwords, but the maximum, as Analytics support suggests, is to use the Linker URL to mark its advertising campaigns.  I still managed to find a solution to the current situation and make friends the stern Google with my Russian-speaking colleague. <br><a name="habracut"></a><br><h5>  1) Use URL builder </h5><br>  The first, most popular and almost the only method used by everyone to track their own advertising campaigns.  Including Yandex.Direct campaigns. <br>  The tool for implementing this method is offered by Google Analytics itself - <a href="http://www.google.ru/support/analytics/bin/answer.py%3Fanswer%3D55578">URL Linker</a> .  The essence of the tool is in addition to the target URL of your ad specific parameters-tags, which in turn successfully recognize and sort Analytics. <br>  These are tags: <br>  ‚Ä¢ <b>utm_source</b> (mandatory) ‚Äîfor marking the source of the transition, in our case <i>YandexDirect</i> ; <br>  ‚Ä¢ <b>utm_medium</b> (mandatory) ‚ÄîThe campaign <b>media</b> , such as a banner or newsletter.  We have a <i>cpc</i> ; <br>  ‚Ä¢ <b>utm_campaign</b> (mandatory) - the name of the campaign for the convenience of distinguishing them.  The same <i>YandexDirect</i> ; <br>  ‚Ä¢ <b>utm_term</b> - the keyword itself.  For example, <i>tort_habrahabr</i> ; <br>  ‚Ä¢ <b>utm_content</b> - mark ads or any differences in placement within the same source.  For example, <i>text_ad1</i> . <br>  The result is a link like: <br>  yummyhabr.ru/tort/?utm_source= <i>YandexDirect</i> &amp; utm_medium = <i>cpc</i> ... <br>  ... &amp; utm_term = <i>tort_habrahabr</i> &amp; utm_content = <i>text_ad1</i> &amp; utm_campaign = <i>YandexDirect</i> <br>  Which we need to make a target for our ads in Yandex.Direct. <br><div style="text-align:center;"><img src="http://tandl.ru/temp/method1_small.png"></div><br>  Consider the pros and cons of this method: <br>  <b>+</b> Works for sure and fairly accurately.  After all, Analytics itself promises its work. <br>  <b>+</b> Accounting for different parameters (means, content, name) when marking ads. <br><br>  It's all.  And wherein: <br>  <b>-</b> No wonder in the example I did not use Cyrillic.  With her, everything is very, very tight.  Rarely when it works stably and is recognized.  Use translit. <br>  <b>-</b> And instead of spaces it is better to use underscores. <br>  <b>-</b> If you have already launched an advertising campaign with a hundred or two ads in Yandex.Direct, then you‚Äôll have the job of translating keywords from a hotly appreciated Russian to transliterate and mark all this good hundred. <br>  <b>-</b> In addition, many of them have several key phrases on one ad.  So, using this tagging, we can only track the ads themselves, not the phrases that correspond to them, because Yandex.Direct allows you to assign target URLs directly to the ad. <br><br>  <b>Bonus:</b> <br>  With a special <s>exacerbation of laziness,</s> you can write your own small script to automatically generate the URL and mark the ads.  For example, using the PHPExcel class and the <a href="http://help.yandex.ru/direct/%3Fid%3D1111746%26ncrnd%3D1683">ability to upload data</a> from campaigns to an xls file, which Yandex.Direct kindly provides.  I sketched <a href="http://tandl.ru/directurlupdate/directurlupdate.php">one</a> ‚Äúon the knee‚Äù <a href="http://tandl.ru/directurlupdate/directurlupdate.php">like this</a> (accepts unloaded xls or created using the Yandex template). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  2) Use _openstat </h5><br>  The first thing I came up with was not satisfied with the official URL linker - this is a perverted method of using OpenStat tags.  OpenStat is a base64-encoded parameter set that is included in the URL and is recognized by some statistics systems, such as LiveInternet or SpyLog, but not by our beloved Google Analytics.  Yandex.Direct supports and allows you to use these tags automatically in their advertising campaigns.  In this case, the tag includes the identification number of the advertisement in the Yandex.Direct system, the keyword number, the source and position of the advertisement on the output page.  Tags are automatically generated by Yandex for each ad each time it is issued to the user.  It is enabled on the campaign settings page by ticking ‚ÄúExternal Internet Statistics: - Connect‚Äù.  Now target URLs marked with the _openstat parameter can be filtered in Google Analytics as belonging to Yandex.Direct. <br>  To do this, we create three custom advanced filters in Google Analytics ( <a href="https://www.google.com/support/googleanalytics/bin/answer.py%3Fanswer%3D55593%26hl%3Dru_RU%26utm_id%3Dad">read more here</a> ): <br>  ‚Ä¢ Filter1 <br>  Field A-&gt; ‚ÄúRequest URI‚Äù: (/?_openstat=.*) <br>  Output in-&gt; ‚ÄúCampaign Source‚Äù: YandexDirect <br>  ‚Ä¢ Filter 2 <br>  Field A-&gt; ‚ÄúCampaign Medium‚Äù: organic <br>  Field B-&gt; ‚ÄúCampaign Source‚Äù: YandexDirect <br>  Output to-&gt; Campaign Medium: cpc <br>  * Field B is required <br>  ‚Ä¢ Filter 3 <br>  Field A-&gt; ‚ÄúCampaign Source‚Äù: YandexDirect <br>  Output in-&gt; ‚ÄúCampaign Name‚Äù: Yandex.Direct <br>  Thus, we take all the transitions made by the URL that contains the openstat parameter and define them as transitions from Yandex.Direct ads. <br>  We get this picture: <br><div style="text-align:center;"><img src="http://tandl.ru/temp/method2_small.png"></div><br>  What happened: <br>  <b>+</b> Quickly with one click enable tracking of all ads at once. <br>  <b>+</b> Under the keywords we see exactly the user requests for which they found us. <br>  <b>+</b> All in Russian. <br><br>  But: <br>  <b>-</b> We can not share and evaluate statistics for our keywords. <br>  <b>-</b> The whole picture collapses, if we still use openstat marks for statistics somewhere or such links appear somewhere (for example, they were indexed by search engines or added by the user to bookmarks).  Therefore, we immediately add to the robots.txt parameter <i>Disallow: / * _ openstat</i> . <br>  <b>-</b> And the main disadvantage is that after visiting our website using the marked URL and its transition to another internal page, the label is lost, which means it is not processed by our filters and is not marked as an advertising transition.  As a result, we will not receive reports on conversions by this source and the average number of visited pages here will always be less than 2. <br><br>  <b>Bonus:</b> <br>  If you liked this method with something, do not be confused by displaying user search queries in keywords, then you can use the Custom segment in Google Analytics to track full statistics on such transitions (at the top right in the Advanced Segments reports), where ‚ÄúCampaign‚Äù ‚Äúexactly corresponds‚Äù to ‚ÄúYandex.Direct‚Äù, that is, the name we specified in the filters.  In this case, Google Analytics for this segment shows not only statistics on visits to the site, which have YandexDirect source, but also internal transitions on the site of visitors with such a source, and, accordingly, conversion and so on.  Why is he so mysteriously acting, I do not know.  After all, it turns out that he knows, sly one, about the source of our wandering user, but he refuses to enter the internal transitions in the campaign statistics. <br><br><h5>  3) Use Yandex.Direct templates </h5><br>  We are trying to improve the first method and teach Google Analytics to somehow recognize individual key requests and be friends with the Russian language.  While I was teaching, I even tried to create 30 internal filters by reverse translating our key phrases, but nothing good came of it ... <br>  But we draw our attention to the ‚Äú <a href="http://help.yandex.ru/direct/%3Fid%3D991161">templates</a> ‚Äù tool in Yandex.Direct.  It works simply.  If we select a word or phrase in our text ad with the # tags (oktotorp, also known as "grid"), when issued to the user in the search for our ad, the word or phrase between these tags will be replaced with the keyword corresponding to the search query of this user. .  If it is impossible to replace, the default is the word or phrase enclosed in these tags. <br>  And the most useful for us in this tool is that it is possible to apply templates even to the target URL of the ad.  In this case, the Cyrillic keywords are inserted into the link in UTF-8 format. <br>  Now we can create something like this using the URL builder: <br>  <i>yummyhabr.ru/tort/?utm_source=YandexDirect&amp;utm_medium=cpc‚Ä¶</i> <i><br></i>  <i>... &amp; utm_term = tort_habrahabr &amp; utm_content = # text_ad1 # &amp; utm_campaign = YandexDirect</i> <br>  And we will see in the statistics: <br><div style="text-align:center;"><img src="http://tandl.ru/temp/method3_small.png"></div><br>  The ad content column now shows our key queries received after applying templates.  It is immediately obvious that we don‚Äôt always have UTF-8 here.  However, this is another joy from Google Analytics, the Yandex.Direct tool has nothing to do with it.  And it becomes clear why, in order not to spoil the statistics, we used the templates in utm_content (‚Äúad content‚Äù), and not in utm_term (‚Äúkeywords‚Äù). <br><br>  But there are pluses: <br>  <b>+</b> All the same stability, as the official linker URL is used. <br>  <b>+</b> Now, somehow, but we can recognize our specific keywords. <br>  <b>+</b> Moreover, we can even relate and filter statistics on individual ads and their corresponding words. <br><br>  The cons are obvious: <br>  <b>-</b> Nobody loves the "krakozyabra" and it is hard to understand "where exactly those 23 people came from." <br>  <b>-</b> Again, have to mess with all of our ads. <br>  <b>-</b> As a result, full of garbage, you still have to break your eyes over the transliteration, and now also over the "left" encodings. <br><br><h5>  4) We use all the achievements </h5><br>  I was inspired by the example of Brian Clifton (Brian Clifton), the head of Google‚Äôs Web Analytics department, which he cited in his book <a href="http://www.advanced-web-metrics.com/">Advanced Web Metrics with Google Analytics</a> .  That example described the ability to add to the main Google Analytics script, placed on each page of the site, its own code that allows you to work with cookies and collect information on transition sources. <br>  So, take everything that we used before and add some JavaScript. <br>  For this we: <br>  ‚Ä¢ Mark all ads in our campaign with tags from the Google linker, using Yandex.Direct templates, as in the third method.  We get: <br>  <i>yummyhabr.ru/tort/?utm_source=YandexDirect&amp;utm_medium=cpc‚Ä¶</i> <i><br></i>  <i>... &amp; utm_term = tort_habrahabr &amp; utm_content = # text_ad1 # &amp; utm_campaign = YandexDirect</i> <br>  ‚Ä¢ We write a JavaScript script (let's call it, for example, directdecode.js), which will pull out the utm_content parameter from the URL of our page (location.search), decode it using decodeURIComponent and in the case of IE use another converter from Win-1251 to UTF-8.  Using the Directkey () function, write the resulting value to the user variable using the "_gaq.push (['_ setVar', keyw]);" method, where keyw is the value we decoded. <br>  ‚Ä¢ We connect the directdecode.js script to the pages and add the Directkey () function to the Google Analytics code on all of our pages in the following way: <br> <code>var _gaq = _gaq || []; <br> _gaq.push(['_setAccount', 'UA-XXXXXXXX-X']); <br> //  <br> <b>Directkey();</b> <br> _gaq.push(['_trackPageview']); <br> <br> (function() { <br> var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; <br> ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; <br> var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); <br> })();</code> <br> <br>  This function will pull out our keyword from the URL, carefully inserted into it with the Yandex.Direct template, in case you need to decode it and write it as a custom Analytics variable. <br>  ‚Ä¢ Add the following custom advanced filter to your profile in our Analytics account: <br>  <b>YandexDirect Filter</b> <br>  Field A-&gt; ‚ÄúCampaign Source‚Äù: YandexDirect <br>  Field B-&gt; ‚ÄúUser Defined‚Äù: (. *) <br>  Output in-&gt; ‚ÄúCampaign search terms‚Äù: $ B1 <br>  * Field B is required <br><br>  Thus, we take our decoded keyword from a user variable and write it into our reports on Yandex.Direct. <br>  Everything.  We give time for the passage of the moderation of ads and script remaking by site users.  We get the desired image: <br><div style="text-align:center;"> <a href=""><img src="http://tandl.ru/temp/method4_small.png"></a> </div><br>  Pros: <br>  <b>+</b> All in Russian. <br>  <b>+</b> All data is full, displayed in all reports. <br>  <b>+</b> Statistics for specific keywords. <br><br>  And cons: <br>  <b>-</b> A rather complicated connection.  And again I have to use the URL linker (by the way, my automatic converter issues a URL immediately under this method using templates). <br>  <b>-</b> There may be minor glitches due to the failure of the encodings. <br><hr><br>  I had the opportunity to thoroughly test all methods on a large sample of sites for a sufficient time, and I stopped on the fourth method.  Now I‚Äôm happy to collect statistics on contextual advertising Yandex.Direct on Google Analytics. <br>  The measurement error for transitions in all methods is 5-10%.  It is within the normal range. </div><p>Source: <a href="https://habr.com/ru/post/117480/">https://habr.com/ru/post/117480/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../117470/index.html">We disassemble ThinkPad T410s</a></li>
<li><a href="../117471/index.html">Create an application for Windows Phone 7 from start to finish. Part 2. Tools for creating applications, recommendations for designing an interface</a></li>
<li><a href="../117473/index.html">IndexedDB: try to cook</a></li>
<li><a href="../117475/index.html">Iconizer.net - reborn free icon generator</a></li>
<li><a href="../117477/index.html">International Open Data and World Bank Competition</a></li>
<li><a href="../117481/index.html">The architecture of the hardware complex Cloud One</a></li>
<li><a href="../117483/index.html">New circle pre-orders for Notion Ink Adam</a></li>
<li><a href="../117484/index.html">Smartphone control device concept using the ‚Äúpower ring‚Äù</a></li>
<li><a href="../117485/index.html">About iOS memory leaks and how to deal with them</a></li>
<li><a href="../117487/index.html">The web posted a beta version of WebOS 3.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>