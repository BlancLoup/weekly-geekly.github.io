<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Microsoft revealed the technical aspects of the implementation of the Linux subsystem in Windows 10</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In our previous posts, we talked about Microsoft‚Äôs intention to include the Ubuntu Linux subsystem in Windows 10. The executable files of the subsyste...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Microsoft revealed the technical aspects of the implementation of the Linux subsystem in Windows 10</h1><div class="post__text post__text-html js-mediator-article">  In our previous posts, we talked about Microsoft‚Äôs intention to include the Ubuntu Linux subsystem in Windows 10. The executable files of the subsystem appeared in the OS <a href="https://habrahabr.ru/company/eset/blog/278339/">starting</a> with Windows 10 Insider Preview Build 14251, for use it became available in Insider Preview Build 14316, and for all Windows 10 users it will be available with Microsoft promised a great June update, i.e. this month.  To use the subsystem, it will need to be enabled by a special setting, since it is turned off by default.  The process of inclusion, we described in <a href="https://habrahabr.ru/company/eset/blog/281418/">this</a> post. <br><br><img src="https://habrastorage.org/files/d83/c4e/d83/d83c4ed836844e7897c5f53e804b72d4.jpeg"><br><br>  Microsoft calls the Linux subsystem for Windows as Windows Subsystem for Linux (WSL).  Today the company has <a href="https://blogs.msdn.microsoft.com/wsl/2016/06/08/wsl-system-calls/">published</a> new technical details of the implementation of WSL.  We have previously <a href="https://habrahabr.ru/company/eset/blog/280584/">written</a> about the model of subsystems in Windows 10 (NT) and how WSL is implemented at the Windows kernel level due to the drivers LXss.sys and LXCore.sys.  Since the original Windows kernel model allows the top level of components (for example, ntdll.dll - Win32) to use its semantics of system calls due to the extended kernel interface, WSL has no problems with its implementation in the Windows environment. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><img src="https://habrastorage.org/files/05e/459/4ca/05e4594ca43d45948e209c22a128b114.png"><br>  Fig.  An example of the implementation of the service to get a list of files in a directory.  The kernel mode driver LXss.sys implements the semantics of the ls command by using the <i>ntoskrnl! NtQueryDirectoryFile</i> kernel interface, which allows it to do so.  The same operation for the Windows subsystem is performed by the ntdll.dll component, referring to <i>ntoskrnl! NtQueryDirectoryFile</i> directly (on the right). <br><br>  An interesting feature is the implementation of Linux system calls in the new subsystem, since this function is the most important operation when running Linux programs.  A system service is a call to a kernel function to perform a basic action in the OS, passing arguments to it.  Such actions include operations with files, processes, network, etc. To call the service, a microprocessor instruction called <i>syscall is used</i> , which transfers control to the kernel mode and calls the service control manager. <br><br>  Microsoft refers to the rules for invoking a system service as the Application Binary Interface (ABI).  The ABI feature for WSL is that it does not completely match the one used in Windows.  Below are the differences in passing arguments to the system service in the case of identical operations ‚Äî the <i>getdents64</i> service on Linux and <i>NtQueryDirectoryFile</i> on Windows.  A description of the Linux service arguments is <a href="http://man7.org/linux/man-pages/man2/getdents.2.html">here</a> . <br><br><img src="https://habrastorage.org/files/ec5/f9e/7fe/ec5f9e7feee3436db044e1283d76b0bc.png"><br>  Fig.  Differences in ABI between Linux and Windows. <br><br>  The difference lies in both the Windows and Linux registers used, and in the number of system services that must be transferred in the <i>rax</i> register.  The above table shows this difference, with the other ABI steps being identical, the arguments of both services are placed in the registers and the <i>syscall</i> call is <i>made</i> .  Another difference lies in the statuses returned by the Linux and Windows services.  While Windows uses special NTSTATUS negative constants, Linux uses a different numbering system for the status of operations performed.  After calling the WLS system service, control is transferred to the Windows system services manager, which, in unchanged form, sends a LXss.sys request that implements the corresponding semantics. <br><br>  The LXss.sys driver can simply invoke the Windows system service without providing additional semantics for it.  This applies to those services whose implementation semantics are the same for both OSs.  For example, the Linux <i>sched_yield</i> function corresponds to a Windows service called <i>ZwYieldExecution</i> , which has the same semantics.  This function instructs the kernel to transfer the microprocessor to another thread.  WLS will not take any additional action, but will simply call <i>ZwYieldExecution</i> .  In other cases, for example, when implementing pipe work functions and <i>fork fork</i> processes, LXss.sys implements the corresponding semantics based on the basic functions and synchronization primitives of the Windows kernel. </div><p>Source: <a href="https://habr.com/ru/post/302976/">https://habr.com/ru/post/302976/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../302964/index.html">Documentation - the basis of the game</a></li>
<li><a href="../302966/index.html">Intel Media SDK 2016 R2 - what's new?</a></li>
<li><a href="../302968/index.html">D3.js. Graph visualization</a></li>
<li><a href="../302970/index.html">Interview with Andrei Svetlov about the Python language and not only</a></li>
<li><a href="../302974/index.html">The essence of photography: the ability to see and create</a></li>
<li><a href="../302984/index.html">Developer Meeting on Sphinx, June 18 (Saturday)</a></li>
<li><a href="../302986/index.html">It's simple. You come up we do</a></li>
<li><a href="../302988/index.html">‚ÄúOurs are near Moscow!‚Äù, Or for the first time at Microsoft DevCon</a></li>
<li><a href="../302990/index.html">Description of the process of creating an online trading system architecture: hedge fund analyst approach</a></li>
<li><a href="../302994/index.html">Vulnerability in FindFace allowing to get user id without payment</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>