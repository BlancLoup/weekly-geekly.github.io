<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ATM. On the other side of the wire</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In connection with the recently touched topic of ATM devices, the desire of the Habr to learn more about them, as well as the number of speculations f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ATM. On the other side of the wire</h1><div class="post__text post__text-html js-mediator-article">  In connection with the <a href="http://habrahabr.ru/post/216315/">recently</a> touched topic of ATM devices, the desire of the Habr to learn more about them, as well as the number of speculations from such a seemingly technically savvy audience, I decided to write this post.  Unlike <a href="http://habrahabr.ru/users/userside/" class="user_link">UserSide</a> , which was mainly engaged in the physical maintenance of ATMs, and it seems to me that it is very far from those who actually write software for managing their host, I will talk about that side.  Naturally, to the best of their knowledge, still too modest. <br><br>  Since this is my first article on Habr√©, I apologize for, perhaps, excessive confusion. <br><br>  The first thing I want to point out is everything that was said in the article and almost everything in the comments is true, but the truth is one-sided - it describes particular cases.  And although these are special cases, in the manner in which the information is submitted, an unprepared reader may have the impression that this is only the way it was told.  And although several opposite descriptions of situations appeared in the comments, no one sounded the main thing - all these are special cases. <br><a name="habracut"></a><br><h4>  1. Cards and bills </h4><br>  One of the members of the forum, referring to his experience, insisted that any account (and in any currency) can be tied to a card in 5 minutes, someone else doubted.  It really is.  The possibility of this procedure is determined only by the capabilities of the software of the processing system itself, its support from the Internet / mobile bank, the desire of the bank to provide such services to the public and its desire to pay for this additional money to the system developer.  In the system, to the development of which I have a relation, the map and the account are two different entities. <br>  The card in our terminology is a token - just as a token is, for example, a password, a certificate, an identity document and some others, I don‚Äôt remember at once.  The token serves only to access the account.  Moreover, as an account can be accessed through several tokens, a token can serve several accounts.  For example, in one bank where our system works, during a card transaction you may be asked to indicate a specific account - if there are several of them linked to a card. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  2. PIN is the opposite for fraudsters </h4><br>  This feature is called ‚ÄúFalse PIN‚Äù (iPIN).  The fact that some bank proposes to do it by default, as the main PIN, recorded on the contrary, serves only the purpose of easier memorization.  Judging by the comments, I got the impression that not everyone understands this. <br>  As far as I heard from colleagues, this feature is not very popular, because  It has its negative sides (I do not know which ones).  The fact is that it is used extremely rarely. <br><br><h4>  3. Cards collectors / supervisors </h4><br>  Again, this is not an immutable rule, it is made just for ease of maintenance.  In our system, it is made in this way, I suspect that in all the others it is the same: <br>  When inserting such a card, the host, instead of performing a transaction, requests current counters from an ATM (or an ATM application itself can determine such a card and send the counters right away ‚Äî further applications).  Next, there is a physical collection of the terminal with the introduction of new meters into it (this is done manually, but I heard with the edge of my ear that automatic polling of the tapes is also possible ... but it seems to me that now there is rarely any).  After the ATM closes, the door presses down a special button called the supervisor button, and the ATM reports to the network at least that the ‚Äúsupervisor mode‚Äù sensor state has changed, at the most ‚Äî its full state, including new counters (or maybe old ones ‚Äî see in the chapter on applications).  If the report contains information only about the sensor, the host itself requests the counters.  At this point, the host can compare the new counters with the old ones and create a collection transaction.  Again, I repeat, this is how it works for us, but this does not mean that it works everywhere.  But since the scheme is very flexible and autonomous, it is probably used in almost any software product of this kind. <br><br>  Instead of a card, a command for the initial poll of the counters (before transferring the ATM to supervisor mode for collection) can be given from the host.  Collection in this case may look like this: collectors arrive at the scene, call the processing center, the operator executes the command through the system, then everything is as in the first scenario. <br><br><h4>  4. Application on ATM </h4><br>  Here it should be noted that all applications can be divided into 2 types: <br><ul><li>  the exchange protocol is strictly defined; on the ATM side, the program running under this protocol is being executed and cannot be expanded.  These are, for example, NDC, DDC and Triton. </li><li>  the exchange protocol is not only not rigidly fixed, but on the contrary, the application on the ATM is an extensible plugin to support communication with a specific host.  This is how Kalignite ATMs are set up - by the way, the most flexible ones I have ever worked with.  The Kalignite application is a regular .Net application, the screens displayed on the ATM screen are normal HTML pages displayed through the standard .Net component of the browser (which, in turn, is based on the IE kernel, that is, it has all its vulnerabilities. However, component is heavily trimmed).  Thanks to this, the development of the visual part of the script can be done by web designers and enjoy all the benefits - for example, jQuery, virtual keyboard and everything your heart desires. <br>  Since the ATM has a code that is written by the system developer himself, the execution of any service functions can be simplified significantly - for example, a collection transaction can be formed on the ATM itself and sent to the host as a normal transaction request (only this will be an administrative transaction). </li></ul><br>  The most important thing that distinguishes these schemes of interaction between a host and an ATM is which side stores intermediate data until a full-fledged transaction can form.  This can happen, for example, in the case when 2 or more accounts are linked to the card, because  The interaction script does not know the number of invoices in advance; it simply makes a transaction request and sends it to the host.  The host rejects it with the reason "Need clarification" and sends a list of parameters that need to be clarified.  And then there are two options: <br><ul><li>  the terminal sends only the updated parameters - in this case, the host must somewhere store the information that the ATM sent in the previous request - the stateless ATM, the statefull host - all ATM programs with fixed protocols behave this way (NDC / DDC, Triton and others) because  the protocol does not provide a place to store this data; </li><li>  the terminal sends all past data plus the specified parameters - a statefull ATM, stateless.  This is best done when working with Kalignite, because  you still need (preferably) to write your extension to communicate using a convenient host protocol. </li></ul><br><h4>  5. Withdrawals and invalid IDs </h4><br>  When detecting a non-withdrawn card, the behavior is fully configurable - an ATM can either capture it or leave it in the path.  The same applies to issuing a card before / after money, at the beginning / end of work, during a power outage (if the bank is not quite poor, there should be a UPS in the ATM).  What to do if an incorrect PIN is entered, a false PIN is entered (if it exists), when the counter of invalid PIN is reset, if the card is captured, the host decides everything.  If the host does not instruct the ATM to grab the card, it will not capture it, even if it is fake, stolen and lost at least ten times. <br><br><h4>  6. Chip cards </h4><br>  What to do with chip cards, if you could not read the chip, depends on the scenario settings.  A narrower range of services may be offered, or it may simply refuse to serve.  The same goes for the cards of other banks. <br><br><h4>  7. Maximum of 40 bills for issuing and issuing algorithm </h4><br>  Which issuing algorithm to use and from where the ATM recognizes it - again, it completely depends on the setting.  Of course, now, in the era of the mass Internet, it is more profitable for the host to perform all the calculations, and only issue commands to the ATM.  However, for example, the Kaliginte object for managing CashDispenser (cash dispenser) also knows how to calculate the payout amount for different algorithms.  In our system, we do not use this feature.  Again, allowing the user to choose the issuance algorithm, or, as someone said in the comments, even specific denominations of bills completely depend on the bank‚Äôs desire to create such a scenario (well, of course, on the software‚Äôs capabilities). <br><br>  The limit of 40 bills really comes from physical limitations - a pack of 40 banknotes is almost a centimeter thick.  About the fact that the ATM simply refuses to issue an amount that can not be physically issued at once, with an unintelligible error - the fault of the script developer - that did not provide for a clear message about the reason.  Everything is simple with Kalignite, it‚Äôs just plain HTML, as I‚Äôve already mentioned above, actually a local site, and for NDC / DDC ATMs the host‚Äôs response may contain updated screens, the text on which, again, defines the host ... The Triton protocol is poorer , and he has few error codes, but Tritons in Russia, it seems, are not very common. <br><br><h4>  8. Operating system </h4><br>  On those on which I have been tested, it is worth Windows XP.  And I was tested with the Kalignite script, with NDC and DDC ATMs. <br><br><hr><br>  Here you go.  I hope it was interesting and the chaos in my head diminished.  The main idea I wanted to convey is absolutely EVERYTHING.  Naturally, somewhere less, somewhere more, but this is more concerned with the deeper nuances than those that are visible at first glance. </div><p>Source: <a href="https://habr.com/ru/post/217337/">https://habr.com/ru/post/217337/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../217321/index.html">PVS-Studio now supports any build system on Windows and any compiler. Easy and out of the box</a></li>
<li><a href="../217325/index.html">Automatic update of C # programs</a></li>
<li><a href="../217327/index.html">Attacks in time - a fairy tale or a real threat?</a></li>
<li><a href="../217331/index.html">Enigma algorithm</a></li>
<li><a href="../217333/index.html">Once again about the leak of atoms and the VCL bug</a></li>
<li><a href="../217339/index.html">Running a tmux window adapted for convenient work with Ruby on Rails</a></li>
<li><a href="../217341/index.html">JSSamePHP: I know PHP, but I need JavaScript</a></li>
<li><a href="../217343/index.html">The index of the sequence of assembly operations. Improving the productivity of workers in assembly plants with a laser pointer</a></li>
<li><a href="../217345/index.html">Quadcopter based on AeroQuad Open Source project</a></li>
<li><a href="../217347/index.html">How to start taking utilities in comfort</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>