<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A bunch of ExtJS + Django + Apache + SVN deploy (and a simple CRUD controller on Django)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword  I just want to apologize for such an overloaded article, but for me now all this is relevant and connected. I think that some of this may be...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A bunch of ExtJS + Django + Apache + SVN deploy (and a simple CRUD controller on Django)</h1><div class="post__text post__text-html js-mediator-article"><h4>  Foreword </h4>  I just want to apologize for such an overloaded article, but for me now all this is relevant and connected.  I think that some of this may be useful for future development.  <i>I want to note that in this article I will not tell you how to install certain trivial things, the installation of which, moreover, depends on a particular platform.</i>  Also in the article I do not describe the gestures on setting up access rights to the server files, again, this depends on the implementation.  The article describes the configuration process on the PDC server named tci.lan, all the names are saved, in your case they should be replaced with the ones you need.  This article contains the code, to improve readability it is hidden in spoilers. <a name="habracut"></a><br><br><h5>  Formulation of the problem </h5>  Recently, I faced the task: <i>to write a simple database for the organization</i> in which I work.  In principle, I was given the opportunity to choose the architecture, storage, framework, etc.  The technical task was also provided very ambiguously - in the form of a list of all attributes of all models (there was no division into models). <br><br><h5>  Choice of architecture </h5>  In the choice of architecture, I was operating in that the system should be cross-platform and, preferably, does not require additional software installation (frameworks, Vine, flash, silverlight, etc.).  Based on this, I stopped at a web application with a client-server architecture.  Actually, this also contributed to the presence in the organization of a web server on CentOS, which I also administer. <br>  As a GUI chose ExtJS.  At the time of development, the latest version was release 4.2b.  As a backend, if you can call it that way (it‚Äôs rather an API server), I chose Django, since I‚Äôve come across it and wanted to get to know it better. <br>  I chose PyCharm as the IDE, which seems to be one of the most normal IDEs for Python. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Result </h5>  The result is a customized system for development on ExtJS and Django: <br><ul><li>  Apache web server with configured virtual host and handlers for working with static files. </li><li>  SVN server.  Performs version control and code deployment on the server during commit. </li><li>  CRUD controller implemented on Django.  Allows you to implement a mechanism for creating, reading, updating and deleting records from the database using API requests. </li><li>  PyCharm with customized SVN and local debugging. </li><li>  Configured by Sencha Architect 2. Used to design ExtJS. </li></ul><br><br><h4>  Setting in order </h4><h5>  Apache web server setup </h5> So let's start with Apache.  We assume that the web server is already installed.  First we need a virtual host (at least for those who have more than one site hosted on the server). <br>  To create a virtual host, you only need to create the file <code>/etc/httpd/conf/vhosts/db.tci.lan.conf</code> with approximately <div class="spoiler">  <b class="spoiler_title">following content:</b> <div class="spoiler_text"><pre> <code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;VirtualHost *:80&gt;</span></span> <span class="hljs-attribute"><span class="hljs-attribute">ServerAdmin</span></span> lufton@gmail.com ServerName www.db.tci.lan ServerAlias db.tci.lan DirectoryIndex index.html index.php DocumentRoot /home/lufton/public_html/db.tci.lan/public WSGIScriptAlias / /home/lufton/public_html/db.tci.lan/public/db/mod.wsgi Alias /js/app.js <span class="hljs-string"><span class="hljs-string">"/home/lufton/public_html/db.tci.lan/public/db/app.js"</span></span> Alias /css <span class="hljs-string"><span class="hljs-string">"/home/lufton/public_html/db.tci.lan/public/db/css"</span></span> &lt;Location <span class="hljs-string"><span class="hljs-string">"/css"</span></span>&gt; SetHandler None Allow from <span class="hljs-literal"><span class="hljs-literal">all</span></span> &lt;/Location&gt; Alias /js <span class="hljs-string"><span class="hljs-string">"/home/lufton/public_html/db.tci.lan/public/db/js"</span></span> &lt;Location <span class="hljs-string"><span class="hljs-string">"/js"</span></span>&gt; SetHandler None Allow from <span class="hljs-literal"><span class="hljs-literal">all</span></span> &lt;/Location&gt; Alias /img <span class="hljs-string"><span class="hljs-string">"/home/lufton/public_html/db.tci.lan/public/db/img"</span></span> &lt;Location <span class="hljs-string"><span class="hljs-string">"/img"</span></span>&gt; SetHandler None Allow from <span class="hljs-literal"><span class="hljs-literal">all</span></span> &lt;/Location&gt; Alias /media <span class="hljs-string"><span class="hljs-string">"/usr/lib/python2.6/site-packages/django/contrib/admin/media"</span></span> &lt;Location <span class="hljs-string"><span class="hljs-string">"/media"</span></span>&gt; SetHandler None Allow from <span class="hljs-literal"><span class="hljs-literal">all</span></span> &lt;/Location&gt; &lt;Location <span class="hljs-string"><span class="hljs-string">"/svnmanager"</span></span>&gt; SetHandler None Allow from <span class="hljs-literal"><span class="hljs-literal">all</span></span> &lt;/Location&gt; LogLevel warn ErrorLog /home/lufton/public_html/db.tci.lan/log/error.log CustomLog /home/lufton/public_html/db.tci.lan/log/access.log combined &lt;/VirtualHost&gt; LoadModule python_module modules/mod_python.so &lt;Directory /home/lufton/public_html/db.tci.lan/&gt; Options Indexes FollowSymLinks MultiViews AllowOverride None Order allow,deny allow from <span class="hljs-literal"><span class="hljs-literal">all</span></span> AddHandler mod_python .py PythonHandler mod_python.publisher | .py AddHandler mod_python .psp .psp_ PythonHandler mod_python.psp | .psp .psp_ PythonDebug <span class="hljs-literal"><span class="hljs-literal">On</span></span> &lt;/Directory&gt;</code> </pre><br></div></div><br>  This file sets up the root folder of the server files, sets the processing of <code>*.py</code> files by Python and creates 5 alias ( <code>/js/app.js</code> , <code>/img</code> , <code>/css</code> , <code>/js</code> , <code>/media</code> ) to serve the static ExtJS files and Django Admin.  Also adds the project path to the Python system path. <br>  Here lufton is the user name, db.tci.lan is the address where our server will be available.  You also need to take care that the files from the <code>/etc/httpd/conf/vhosts/</code> folder are included in the config file. To do this, add / uncomment the line in the <code>/etc/httpd/conf/httpd.conf</code> file: <br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-attribute">Include</span></span> /etc/httpd/conf/vhosts/*.conf</code> </pre><br>  Make sure also that you have installed <a href="http://code.google.com/p/modwsgi/">mod_wsgi</a> and it is monitored in this file. <br>  It is also necessary to create a structure in the appropriate folder: <br><img src="https://habrastorage.org/getpro/habr/conversation/943/c1e/b45/943c1eb45d328bb2ad5223d6d88f829d.png"><br>  This completes the Apache configuration. <br><br><h5>  Subversion setup </h5>  First you need to create a repository, in my case it is called <code>db</code> located along the path <code>/srv/svn/repos/db</code> .  After the repository is created, it is necessary to configure the SVN so that after each commit, the repository HEAD files are updated in the root folder of the server.  To do this, first of all you need to checkout the repository in the root folder of the server.  This is done as usual. <br> <code><a href="http://127.0.0.1/svn/db"></a> svn checkout 127.0.0.1/svn/db /home/lufton/public_html/db.tci.lan/public/db</code> <br>  Now you need to copy the file from <br> <code>/srv/svn/repos/db/hooks/post-commit.tmpl</code> <br>  at <br> <code>/srv/svn/repos/db/hooks/post-commit</code> <br>  Instead of <code>mailer.py commit "$REPOS" "$REV" /path/to/mailer.conf</code> add the lines: <br><pre> <code class="hljs pgsql">cd /home/lufton/public_html/db.tci.lan/<span class="hljs-built_in"><span class="hljs-built_in">public</span></span>/db /usr/bin/svn <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> # python manage.py syncdb # /etc/init.d/httpd <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span></code> </pre><br>  Now, after each commit'a in the repository, the folder will be updated automatically, which will reduce the number of your <s>gestures</s> actions. <br><br><h5>  Creating a simple CRUD controller </h5>  In the task set before me, a large number of actions with records in the database was foreshadowed, so work with models should be simplified to a minimum, and the functionality should be preserved.  My implementation allows: <br><ul><li>  Perform operations on models (creation, selection, modification and deletion) by model name. </li><li>  Represent the sample in a JSON-like structure (with output in response). </li><li>  Limit the selection to the start and limit parameters. </li><li>  Filter the selection by exact coincidence of the parameter values ‚Äã‚Äã(operator =). </li><li>  Sort the selection by field name. </li><li>  Filter the selection by the query parameter (each model has its own method of comparison for the specified field). </li><li>  Include model properties in the selection (not to be confused with model fields). </li><li>  Include fields and properties of related models and lists in the selection (OneToOne, ForeignKey). </li></ul><br><br><h6>  Model class inheritance </h6>  So let's start with the creation of an abstract class inherited from Model.  Each model should now be able to present itself as a JSON-like structure.  For convenience, I also added some useful methods.  I‚Äôll say right away that it‚Äôs far from Python, so the solution may not be the most elegant, but still working. <br><div class="spoiler">  <b class="spoiler_title">Class text:</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CoolModel</span></span></span><span class="hljs-class"> </span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">( Model )</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> abstract = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> app_label = <span class="hljs-string"><span class="hljs-string">"db"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( self, *args, **kwargs )</span></span></span><span class="hljs-function">:</span></span> super(CoolModel, self).__init__(*args, **kwargs) self.__initial = self._dict <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDict</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( self, properties = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"*"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( field, properties = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"*"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">:</span></span> value = getattr(self, field.name) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(field, ForeignKey): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> field.name <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> properties: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value.toDict(properties[field.name]) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(value, datetime.date) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> isinstance(value, datetime.datetime): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value.isoformat() <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(field, CommaSeparatedIntegerField) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> isinstance(value, basestring): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.loads(value) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(value, Decimal): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> float(value) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(field, ImageField): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value.url <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> value <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(field, NullBooleanField): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> value <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> value <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value result = {} fields = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> field <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self._meta.fields: fields[field.name] = field <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(field, ForeignKey): idAttr = <span class="hljs-string"><span class="hljs-string">"%s_id"</span></span> % field.name result[idAttr] = getattr(self, idAttr) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: result[field.name] = getValue(field, properties) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(properties, dict): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k, v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> properties.iteritems(): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> hasattr(self, k): value = getattr(self, k) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(value, CoolModel): result[k] = value.toDict(v) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> value.__class__.__name__ == <span class="hljs-string"><span class="hljs-string">"RelatedManager"</span></span>: result[k] = toJSON(value.all(), v) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> value <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: result[k] = {} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> k <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> fields <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> isinstance(fields[k], ForeignKey) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: result[k] = value <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result @property <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">diff</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( self )</span></span></span><span class="hljs-function">:</span></span> d1 = self.__initial d2 = self._dict diffs = [(k, (v, d2[k])) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k, v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> d1.items() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> v != d2[k]] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dict(diffs) @property <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( self )</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.__class__.objects.get(id = self.id) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> self.__class__.DoesNotExist: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> @property <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasChanged</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( self )</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bool(self.diff) @property <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">changedFields</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( self )</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.diff.keys() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFieldDiff</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( self, field_name )</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.diff.get(field_name, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( self, *args, **kwargs )</span></span></span><span class="hljs-function">:</span></span> super(CoolModel, self).save(*args, **kwargs) self.__initial = self._dict @property <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_dict</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( self )</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> model_to_dict(self, fields = [field.name <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> field <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self._meta.fields])</code> </pre><br></div></div><br>  The class was written for specific purposes, so the toDict method should be doped with a file, the main thing is that you, I hope, understand how it works.  If in short, the whole field-value of the pair is first added to the dictionary (the value depends on the class, at this stage <s>you</s> need to teach the method of how to serialize a particular type / class).  Then the entire property-value of a pair from the list of additional properties is added to the dictionary.  The property list is not really a list, but a hash table of the form: <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">address</span></span>: { <span class="hljs-attr"><span class="hljs-attr">country</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">state</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">fullTitle</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }, <span class="hljs-attr"><span class="hljs-attr">district</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">city</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">fullTitle</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }, <span class="hljs-attr"><span class="hljs-attr">streetType</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">fullAddress</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }</code> </pre><br>  This hash table says that from this model you need to select a few more additional properties: address and type.  Each of which, in turn, in addition to the field values, must contain several additional properties: contry, state, district, city, streetType, fullAddress for the address property.  null means selecting only the fields defined in the model class.  Due to such a tree structure of properties properties, it is possible to select nested properties and selections. <br><br><h6>  Creating a universal handler </h6>  In this section, I will tell you how I implemented a unified handler.  <code>urls.py</code> add urlpattern to urls.py: <br><pre> <code class="python hljs">url(<span class="hljs-string"><span class="hljs-string">r'^(?P&lt;view&gt;[^/]*)/.*$'</span></span>, <span class="hljs-string"><span class="hljs-string">'db.views.page'</span></span>)</code> </pre><br>  Now add the <code>page</code> method to the <code>views.py</code> file. <br><div class="spoiler">  <b class="spoiler_title">Page method</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">page</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( req, view )</span></span></span><span class="hljs-function">:</span></span> models = { <span class="hljs-string"><span class="hljs-string">"countries"</span></span>: Country, <span class="hljs-string"><span class="hljs-string">"statetypes"</span></span>: StateType, <span class="hljs-string"><span class="hljs-string">"states"</span></span>: State, <span class="hljs-string"><span class="hljs-string">"districts"</span></span>: District, <span class="hljs-string"><span class="hljs-string">"cities"</span></span>: City, <span class="hljs-string"><span class="hljs-string">"people"</span></span>: Person <span class="hljs-comment"><span class="hljs-comment">#... } modelClass = models[view] if view in models else None if view in models: method = req.method properties = json.loads(req.GET.get("properties", "{}")) if method == "GET": id = req.GET.get("id", None) if id: return read(req, modelClass, filters = {"id": id}, properties = properties) else: query = req.GET.get("query", None) start = int(req.GET.get("start", 0)) limit = int(req.GET.get("limit", -1)) if limit &lt; 0: limit = None f = json.loads(req.GET.get("filter", "[]")) s = json.loads(req.GET.get("sort", "[]")) q = None filters = {} for filter in f: filters[filter["property"]] = filter["value"] queryProperties = { "countries": "title__icontains", "states": "title__icontains", "districts": "title__icontains", "cities": "title__icontains", "people": ["lastName__icontains", "firstName__icontains", "middleName__icontains"] #... } if view in queryProperties and query: if isinstance(queryProperties[view], list): for p in queryProperties[view]: q |= Q(**{p: query}) if q else Q(**{p: query}) else: q |= Q(**{queryProperties[view]: query}) if q else Q(**{queryProperties[view]: query}) sorters = ["%s%s" % ("" if k == "ASC" else "-", v) for k, v in s] return read(req, modelClass, start, limit, filters, q, sorters, properties) elif method == "POST": items = json.loads(req.raw_post_data) return create(req, modelClass, items, properties) elif method == "PUT": items = json.loads(req.raw_post_data) return update(req, modelClass, items, properties) elif method == "DELETE": items = json.loads(req.raw_post_data) return delete(req, modelClass, items) elif view in globals(): if not view in ["signin"]: if not req.user.is_authenticated: return JsonResponse({ "success": False, "message": u"  !" }) else: if not req.user.is_superuser: return JsonResponse({ "success": False, "message": u"   !" }) return globals()[view](req) else: return JsonResponse({ "success": False, "message": u"  (%s)  !" % view })</span></span></code> </pre><br></div></div><br>  The <code>models</code> dictionary contains the key-value of the pair, where the key is the name of the API method, the value is the class of the corresponding model.  The variable <code>queryProperties</code> contains the key-value of the pair, where the key is the name of the API method, the value is the field name or a list of such names (with modifications like "__in", "__gt", "__icontains", etc.).  The selection will be filtered by the query parameter by the specified fields (filters will be combined with the OR operator). <br>  It remains only to implement the methods create, read, update and delete. <br><div class="spoiler">  <b class="spoiler_title">Here is the code for these methods:</b> <div class="spoiler_text">  @ transaction.commit_manually <br>  def create (req, modelClass, items, properties = None): <br>  results = [] <br>  try: <br>  for item in items: <br>  model = modelClass () <br>  for k, v in item.iteritems (): <br>  if hasattr (model, k): <br>  setattr (model, k, v) <br>  model.save () <br>  results.append (toJSON (model, properties)) <br>  transaction.commit () <br>  return JsonResponse ({ <br>  "Success": True, <br>  "Items": results <br>  }) <br>  except Exception, e: <br>  transaction.rollback () <br>  return JsonResponse ({ <br>  "Success": False, <br>  "Message": e.message <br>  }) <br><br>  def read (req, modelClass, start = 0, limit = None, filters = None, q = None, sorters = None, properties = None): <br>  try: <br>  query = modelClass.objects.all () <br>  if filters: <br>  query = query.filter (** filters) <br>  if q: <br>  query = query.filter (q) <br>  if sorters: <br>  query = query.order_by (sorters) <br>  count = query.count () <br>  results = toJSON (query [start: (start + limit) if limit else None], properties) <br>  return JsonResponse ({ <br>  "Success": True, <br>  "Items": results, <br>  "Total": count <br>  }) <br>  except Exception, e: <br>  return JsonResponse ({ <br>  "Success": False, <br>  "Message": e.message <br>  }) <br><br>  @ transaction.commit_manually <br>  def update (req, modelClass, items, properties = None): <br>  results = [] <br>  try: <br>  for item in items: <br>  try: <br>  model = modelClass.objects.get (id = item ["id"]) <br>  for k, v in item.iteritems (): <br>  if hasattr (model, k): <br>  setattr (model, k, v) <br>  model.save () <br>  results.append (toJSON (model, properties)) <br>  except modelClass.DoesNotExist: <br>  pass <br>  transaction.commit () <br>  return JsonResponse ({ <br>  "Success": True, <br>  "Items": results <br>  }) <br>  except Exception, e: <br>  transaction.rollback () <br>  return JsonResponse ({ <br>  "Success": False, <br>  "Message": e.message <br>  }) <br><br>  @ transaction.commit_manually <br>  def delete (req, modelClass, items): <br>  try: <br>  for item in items: <br>  modelClass.objects.get (id = item ["id"]). delete () <br>  transaction.commit () <br>  return JsonResponse ({ <br>  "Success": True <br>  }) <br>  except Exception, e: <br>  transaction.rollback () <br>  return JsonResponse ({ <br>  "Success": False, <br>  "Message": e.message <br>  }) <br></div></div><br>  Each of the methods performs the creation, selection, modification, and deletion of models, respectively, and returns in response a selection or created / modified models. <br><br><h5>  PyCharm setup </h5>  Actually there is no complicated configuration in PyCharm.  To begin, checkout the repository to the local computer: <br> <code><a href="http://db.tci.lan/svn/db"></a> svn checkout db.tci.lan/svn/db ~/Projects/db</code> <br>  Open in PyCharm and create a Django project from a template.  Specify the folder <code>~/Projects/db</code> as the path (here you need to be careful not to create the folder <code>db</code> in the folder <code>~/Projects/db</code> ).  The path to <code>settings.py</code> should be <code>~/Projects/db/settings.py</code> .  Add automatically created files in SVN, create CRUD, as described above. <br>  You must also create a <code>mod.wsgi</code> file that Apache warned us about. <div class="spoiler">  <b class="spoiler_title">Its contents may be something like this:</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os, sys sys.path.append(<span class="hljs-string"><span class="hljs-string">'/home/lufton/public_html/db.tci.lan/public'</span></span>) sys.path.append(<span class="hljs-string"><span class="hljs-string">'C:/Documents and Settings/lufton.TCI/Projects'</span></span>) os.environ[<span class="hljs-string"><span class="hljs-string">'DJANGO_SETTINGS_MODULE'</span></span>] = <span class="hljs-string"><span class="hljs-string">'db.settings'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> django.core.handlers.wsgi application = django.core.handlers.wsgi.WSGIHandler()</code> </pre><br></div></div><br>  Here, <code>sys.path.append</code> used twice in order for the configuration to work on Windows, which I sometimes use. <br>  Now, each commit will not only provide you with version control, but will automatically automatically upload the project to the specified folder, after which the changes will immediately take effect. <br>  Naturally, for local debugging, you will need to configure Django to use a remote database; for this I simply specified the server IP address as the database server. <br><br><h5>  Configuring Sencha Architect 2 </h5>  Sencha Architect has a lot of limitations, one of which is due to the fact that it is quite difficult to set up publishing to a selected folder so that loading the project in the browser does not cause complications. <br>  In our case, the publication folder is installed in <code>~/Projects/db</code> .  In the Application properties, set the <code>appFolder: 'js/app'</code> Now, after each posting, you <s>just need to move the file <code>~/Projects/db/app.js</code> to <code>~/Projects/db/js/app.js</code></s> you don‚Äôt even have to move the <code>app.js</code> file <code>app.js</code> , because we created our own alias for it and it can be excellently issued upon request to <code>/js/app.js</code> . <br><br><h4>  Conclusion </h4>  Now you have a fully working and customized system for ExtJS and Django development.  The development process now is to work with SA.  After the next Publish in SA, if necessary, add the newly created model / storage / view / controller files in SVN <s>, if you made changes with Application, you also need to take care of moving the <code>app.js</code> file as described above</s> .  Zakommitte project and observe the changes. </div><p>Source: <a href="https://habr.com/ru/post/167165/">https://habr.com/ru/post/167165/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../167143/index.html">The digest of interesting news and materials from the world of ayti for the last week ‚Ññ41 (January 19 - 25, 2013)</a></li>
<li><a href="../167151/index.html">Spoiler with css ...</a></li>
<li><a href="../167153/index.html">Types in PHP: good or bad?</a></li>
<li><a href="../167159/index.html">MODX Club in Moscow</a></li>
<li><a href="../167161/index.html">Rails 4 Subtleties - Turbolinks</a></li>
<li><a href="../167167/index.html">Perhaps the strangest accessory. HTC launches bluetooth smartphone phone</a></li>
<li><a href="../167169/index.html">Facebook Hacker Cup 2013 - The Qualification Round is taking place right now</a></li>
<li><a href="../167171/index.html">Manage Windows services using PowerShell. Part 2</a></li>
<li><a href="../167173/index.html">Introduction to Jasmine</a></li>
<li><a href="../167177/index.html">Search for common elements in an array</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>