<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>React + mobx path from scratch. Mobx + react, side view</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In ‚Äúreal‚Äù projects, we receive data from the server or user input, format, validate, normalize, and perform other operations on them. All this is cons...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>React + mobx path from scratch. Mobx + react, side view</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/201/f0f/c08/201f0fc084fa4c3396583e4ae3cbd5a7.jpg"><br><br>  In ‚Äúreal‚Äù projects, we receive data from the server or user input, format, validate, normalize, and perform other operations on them.  All this is considered business logic and should be placed in the <b>M</b> odel.  Since react is only a third of M <b>V</b> C pie, to create user interfaces, we will need something else for business logic.  Some use <a href="https://github.com/reactjs/redux">redux</a> or <a href="https://github.com/facebook/flux">flux</a> patterns, some <a href="http://backbonejs.org/">backbone.js</a> or even angular, we will use <a href="https://github.com/mobxjs/mobx">mobx.js</a> as <b>M</b> odel. <br><a name="habracut"></a><br>  In the previous article we have already prepared the <a href="https://github.com/AlexeyRyashencev/react-hot-mobx-es6">foundation</a> , we will build on it.  Since mobx is a standalone library, then for connecting with react, we need <a href="https://github.com/mobxjs/mobx-react">mobx-react</a> : <br><br><pre><code class="bash hljs">npm i --save mobx mobx-react</code> </pre> <br>  In addition, to work with decorators and transform class properties, we will need babel <a href="https://babeljs.io/docs/plugins/transform-class-properties/">babel-plugin-transform-class-properties</a> and <a href="https://github.com/loganfsmyth/babel-plugin-transform-decorators-legacy">babel-plugin-transform-decorators-legacy plugins</a> : 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="bash hljs">npm i --save-dev babel-plugin-transform-decorators-legacy babel-plugin-transform-class-properties</code> </pre> <br>  Do not forget to add them to .babelrc <br><br><pre> <code class="xml hljs"> "plugins": [ "react-hot-loader/babel", "transform-decorators-legacy", "transform-class-properties" ]</code> </pre> <br>  We have a Menu component, let's continue working with it.  The panel will have two states ‚Äúopen / closed‚Äù, and we will manage the state using mobx. <br><br>  1. First, we need to <b>determine the state and make it observable</b> by adding the @observable decorator.  A state can be represented by any data structure: objects, arrays, classes, and so on.  Create a storage for the menu (menu-store.js) in the stores directory. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observable} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MenuStore</span></span></span><span class="hljs-class"> </span></span>{ @observable show; <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.show = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MenuStore();</code> </pre> <br>  Store is an ES6 class with a single show property.  We hung decorator @observable on it, thus told the mobx to watch it.  Show is the state of our panel, which we will change. <br><br>  2. <b>Create a view that responds to state changes</b> .  It's good that we already have it, this is component / menu / index.js.  Now that the state is changing, our menu will automatically replicate, while mobx will find the shortest way to update the view.  To make this happen, you need to wrap the function describing the react component in observer. <br><br><div class="spoiler">  <b class="spoiler_title">components / menu / index.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cn <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'classnames'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx-react'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* stores */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> menuStore <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../stores/menu-store'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* styles */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> styles <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./style.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Menu = observer(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">nav</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{cn(styles.menu,</span></span></span></span><span class="xml"><span class="hljs-tag"> { [</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">styles.active</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">menuStore.show</span></span></span></span><span class="xml"><span class="hljs-tag"> })}&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{styles[</span></span></span></span><span class="xml"><span class="hljs-tag">'</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">toggle-btn</span></span></span></span><span class="xml"><span class="hljs-tag">']}&gt;</span></span></span><span class="xml">‚ò∞</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">nav</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> )); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Menu;</code> </pre> <br></div></div><br>  In any react application, we need the <a href="https://github.com/JedWatson/classnames">classnames</a> utility to work with className.  Previously, it was included in the react-a package, but now it is put separately: <br><br><pre> <code class="bash hljs">npm i --save classnames</code> </pre> <br>  With its help, you can glue the names of classes using various conditions, an indispensable thing. <br>  It can be seen that we add the class ‚Äúactive‚Äù, if the value of the menu state is show === true.  If in the storage designer you change the state to this.show = true, then the panel will display the ‚Äúactive‚Äù class. <br><br>  3. It remains <b>to change the state</b> .  Add a click event for the hamburger in <br><div class="spoiler">  <b class="spoiler_title">menu / index.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs">&lt;div onClick={() =&gt; { menuStore.toggleLeftPanel() }} className={styles[<span class="hljs-string"><span class="hljs-string">'toggle-btn'</span></span>]}&gt;‚ò∞&lt;<span class="hljs-regexp"><span class="hljs-regexp">/div&gt;</span></span></code> </pre> </div></div><br>  and the toggleLeftPanel () method in <br><div class="spoiler">  <b class="spoiler_title">stores / menu-store.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MenuStore</span></span></span><span class="hljs-class"> </span></span>{ @observable show; <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.show = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } toggleLeftPanel() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.show = !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.show; } } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> menuStore = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MenuStore(); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> menuStore; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { MenuStore };</code> </pre> <br></div></div><br>  <i>Note: By default, we export the storage as a singleton instance, and the class is also exported directly, as it may also be needed, for example, for tests.</i> <br><br>  For clarity, add styles: <br><br><div class="spoiler">  <b class="spoiler_title">components / menu / styles.css</b> <div class="spoiler_text"><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.menu</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>: fixed; <span class="hljs-attribute"><span class="hljs-attribute">top</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">left</span></span>: -<span class="hljs-number"><span class="hljs-number">180px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">bottom</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">220px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: tomato; &amp;.active { <span class="hljs-attribute"><span class="hljs-attribute">left</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; } &amp; <span class="hljs-selector-class"><span class="hljs-selector-class">.toggle-btn</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>: absolute; <span class="hljs-attribute"><span class="hljs-attribute">top</span></span>: <span class="hljs-number"><span class="hljs-number">5px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">right</span></span>: <span class="hljs-number"><span class="hljs-number">10px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">26px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-weight</span></span>: <span class="hljs-number"><span class="hljs-number">500</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: white; <span class="hljs-attribute"><span class="hljs-attribute">cursor</span></span>: pointer; } }</code> </pre> <br></div></div><br>  And check that by clicking on the icon, our panel opens and closes.  We wrote a minimal mobx store to manage the status of the panel.  Let's increase the meat a bit and try to control the panel from another component.  We will need additional methods for opening and closing the panel: <br><br><div class="spoiler">  <b class="spoiler_title">stores / menu-store.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observable, computed, action } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MenuStore</span></span></span><span class="hljs-class"> </span></span>{ @observable show; <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.show = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } @computed get isOpenLeftPanel() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.show; } @action(<span class="hljs-string"><span class="hljs-string">'toggle left panel'</span></span>) toggleLeftPanel() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.show = !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.show; } @action(<span class="hljs-string"><span class="hljs-string">'show left panel'</span></span>) openLeftPanel() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.show = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } @action(<span class="hljs-string"><span class="hljs-string">'hide left panel'</span></span>) closeLeftPanel() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.show = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> menuStore = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MenuStore(); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> menuStore; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { MenuStore };</code> </pre> <br></div></div><br>  You may notice that we added computed and action decorators, they are only required in strict mode (disabled by default).  Computed values ‚Äã‚Äãwill be automatically recalculated when the corresponding data is changed.  It is recommended to use action, it will help to better structure the application and optimize performance.  As you can see, the first argument is the expanded name of the action being performed.  Now with debbage we will be able to observe which method was called and how the state changed. <br><br><img src="https://habrastorage.org/files/28d/3e5/61b/28d3e561b22b4dc1a696461269fa9b02.png"><br><br>  <i>Note: When developing it is convenient to use chrome extensions for <a href="https://chrome.google.com/webstore/detail/mobx-developer-tools/pfgnfdagidkfgccljigdamigbcnndkod">mobx</a> and <a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi">react</a> , as well as <a href="https://mobx.js.org/best/devtools.html">react-mobx devtools</a></i> <br><br>  Create another component <br><div class="spoiler">  <b class="spoiler_title">components / left-panel-controller / index.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* stores */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> menuStore <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../stores/menu-store'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* styles */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> styles <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./styles.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Component = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{styles.container}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span></span><span class="xml"><span class="hljs-tag">=&gt;</span></span></span><span class="xml">{ menuStore.openLeftPanel(); }}&gt;Open left panel</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span></span><span class="xml"><span class="hljs-tag">=&gt;</span></span></span><span class="xml">{ menuStore.closeLeftPanel(); }}&gt;Close left panel</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Component;</code> </pre> <br></div></div><br>  Inside are a couple of buttons that will open and close the panel.  This component will add to the Home page.  You should have the following: <br><br><div class="spoiler">  <b class="spoiler_title">structure</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/ebd/d7f/919/ebdd7f9190f6439284ede2369686c205.png"><br></div></div><br>  In the browser, it will look like this: <br><br><div class="spoiler">  <b class="spoiler_title">mobx at work</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/cf6/e8f/e5e/cf6e8fe5e67a4080bb8488435acca281.png"><br></div></div><br>  Now we can manage the state of the panel not only from the panel itself, but also from another component. <br>  <i>Note: if you perform the same action several times, for example, press the ‚Äúclose left panel‚Äù button, then in the debager you can see that the action is triggered, but no reaction occurs.</i>  <i>This means that mobx does not recalculate the component, as the state has not changed and we do not need to write ‚Äúextra‚Äù code, as for the pure react component.</i> <br><br>  It remains to comb our approach a little, it is pleasant to work with the stores, but it is ugly to scatter imports of storage facilities throughout the project.  In mobx-react, <a href="https://github.com/mobxjs/mobx-react">Provider</a> appeared for such purposes <a href="https://github.com/mobxjs/mobx-react">(see Provider and inject)</a> - a component that allows you to pass stors (and not only) to descendants using the <a href="https://facebook.github.io/react/docs/context.html">react context</a> .  To do this, wrap the app.js root component in the Provider: <br><br><div class="spoiler">  <b class="spoiler_title">app.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Provider } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx-react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useStrict } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* components */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Menu <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../components/menu'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* stores */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> leftMenuStore <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../stores/menu-store'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* styles */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./global.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> style <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./app.css'</span></span>; useStrict(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> stores = { leftMenuStore }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> App = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function"> =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Provider</span></span></span></span><span class="xml"><span class="hljs-tag"> { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">...stores</span></span></span></span><span class="xml"><span class="hljs-tag"> }&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{style[</span></span></span></span><span class="xml"><span class="hljs-tag">'</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">app-container</span></span></span></span><span class="xml"><span class="hljs-tag">']}&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Menu</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{style[</span></span></span></span><span class="xml"><span class="hljs-tag">'</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">page-container</span></span></span></span><span class="xml"><span class="hljs-tag">']}&gt;</span></span></span><span class="xml"> {props.children} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Provider</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> App;</code> </pre> <br></div></div><br>  Immediately we import all the stores (we have one) and transfer them to the provider via props.  Since the provider works with the context, the stories will be available in any child component.  Also, split the menu.js component into two to get a <a href="https://habrahabr.ru/post/266559/">‚Äústupid‚Äù and ‚Äúsmart‚Äù component</a> . <br><br><div class="spoiler">  <b class="spoiler_title">components / menu / menu.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cn <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'classnames'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> styles <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./style.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Menu = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function"> =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">nav</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{cn(styles.menu,</span></span></span></span><span class="xml"><span class="hljs-tag"> { [</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">styles.active</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">props.isOpenLeftPanel</span></span></span></span><span class="xml"><span class="hljs-tag"> })}&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{props.toggleMenu}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{styles[</span></span></span></span><span class="xml"><span class="hljs-tag">'</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">toggle-btn</span></span></span></span><span class="xml"><span class="hljs-tag">']}&gt;</span></span></span><span class="xml">‚ò∞</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">nav</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Menu;</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">components / menu / index.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observer, inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx-react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Menu <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./menu'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Component = inject(<span class="hljs-string"><span class="hljs-string">'leftMenuStore'</span></span>)(observer(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ leftMenuStore }</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Menu</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">toggleMenu</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> leftMenuStore.toggleLeftPanel()} isOpenLeftPanel={leftMenuStore.isOpenLeftPanel} /&gt; ))); Component.displayName = "MenuContainer"; export default Component;</span></span></code> </pre> <br></div></div><br>  ‚ÄúStupid‚Äù is not interesting to us, as it is a normal stateless component that receives data through props about whether the panel and the callback to switch are opened or closed. <br><br>  It is much more interesting to look at his wrapper: here we see the <a href="https://facebook.github.io/react/docs/higher-order-components.html">HOC</a> , where we inject the necessary storus, in our case ‚ÄúleftMenuStore‚Äù, we pass our ‚Äústupid component‚Äù wrapped in observer as a component.  Since we leftMenuStore, the storage is now available via props. <br><br>  almost the same thing we do with the left-panel-controller: <br><br><div class="spoiler">  <b class="spoiler_title">components / left-menu-controller / left-menu-controller.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* styles */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> style <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./styles.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> LeftPanelController = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function"> =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{style.container}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> props.openPanel()}&gt;Open left panel</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> props.closePanel()}&gt;Close left panel</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> LeftPanelController;</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">components / left-menu-controller / index.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx-react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> LeftPanelController <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./left-panel-controller'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Component = inject(<span class="hljs-string"><span class="hljs-string">'leftMenuStore'</span></span>)(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ leftMenuStore }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;LeftPanelController openPanel={(</span></span></span><span class="hljs-function">) =&gt;</span></span> leftMenuStore.openLeftPanel()} closePanel={() =&gt; leftMenuStore.closeLeftPanel()} /&gt; ); }); LeftPanelController.displayName = <span class="hljs-string"><span class="hljs-string">'LeftPanelControllerContainer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Component;</code> </pre> <br></div></div><br>  With the only difference that we do not use observer here, since this component does not need to redraw, we only need the openLeftPanel () and closeLeftPanel () methods from the storage. <br><br>  <i>Note: I use displayName to set the name of the component, which is convenient for the debbag:</i> <br><br><div class="spoiler">  <b class="spoiler_title">For example, you can now find a component through the search.</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/f70/aba/d5b/f70abad5b6eb465db832a95e83e7bbb0.png"><br></div></div><br>  It's all simple, now let's get the data from the server, let it be a list of users with checkboxes. <br><br>  Go to the server and add the route "/ users" to get users: <br><br><div class="spoiler">  <b class="spoiler_title">server.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> USERS = [ { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"Alexey"</span></span>, <span class="hljs-attr"><span class="hljs-attr">age</span></span>: <span class="hljs-number"><span class="hljs-number">30</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"Ignat"</span></span>, <span class="hljs-attr"><span class="hljs-attr">age</span></span>: <span class="hljs-number"><span class="hljs-number">15</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"Sergey"</span></span>, <span class="hljs-attr"><span class="hljs-attr">age</span></span>: <span class="hljs-number"><span class="hljs-number">26</span></span> }, ]; ... app.get(<span class="hljs-string"><span class="hljs-string">"/users"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { res.send(USERS); }, <span class="hljs-number"><span class="hljs-number">1000</span></span>); });</code> </pre> <br></div></div><br>  Deliberately add a delay to verify that the application is working correctly even with a large server response interval. <br><br>  Next we need <br><br><div class="spoiler">  <b class="spoiler_title">user store:</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observable, computed, action, asMap, autorun } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span></span>{ @observable user = observable.map(); <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(userData = {}, checked = <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.user.merge(userData); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.user.set(<span class="hljs-string"><span class="hljs-string">"checked"</span></span>, checked); } @computed get userInfo() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.user.get(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">"name"</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string"> - </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.user.get(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">"age"</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">`</span></span>; } @action toggle() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.user.set(<span class="hljs-string"><span class="hljs-string">"checked"</span></span>, !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.user.get(<span class="hljs-string"><span class="hljs-string">"checked"</span></span>)); } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserStore</span></span></span><span class="hljs-class"> </span></span>{ @observable users; <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.users = []; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fetch(); } @computed get selectedCount() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.users.filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">userStore</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> userStore.user.get(<span class="hljs-string"><span class="hljs-string">"checked"</span></span>); }).length; } getUsers() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.users; } @action fetch() { fetch(<span class="hljs-string"><span class="hljs-string">'/users'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'GET'</span></span> }) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function"> =&gt;</span></span> res.json()) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">json</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.putUsers(json)); } @action putUsers(users) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> userArray = []; users.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">user</span></span></span><span class="hljs-function"> =&gt;</span></span> { userArray.push(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User(user)); }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.users = userArray; } } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> userStore = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UserStore(); autorun(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(userStore.getUsers().toJS()); }); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> userStore; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { UserStore };</code> </pre><br></div></div><br>  Here is described the User class with the user property.  In mobx there is an <a href="https://mobx.js.org/refguide/map.html">observable.map</a> data type, it is just suitable for us to describe the user.  Roughly speaking, we get the observed object, and, moreover, one can observe the change in a specific field.  Also getter, setter and other auxiliary methods become available.  For example, in the constructor using ‚Äúmerge‚Äù, we can easily copy the fields from userData to user.  This is very convenient if the object contains many fields.  We also write one action to switch the user's state and a calculated value to get information about the user. <br><br>  The following is the story itself, in which the observed are an array of users.  In the constructor, we pull the method to get users from the server and through the action putUsers we fill the empty array with users.  Finally, we add a method that returns the calculated number of checked users. <br><br>  <i>Note: <a href="https://mobx.js.org/refguide/autorun.html">autorun</a> performs the function automatically if the observed value has been changed.</i>  <i>For example, all users are displayed in the console.</i>  <i>If you try to get users using the ‚ÄúgetUsers ()‚Äù method, you will notice that the type of the returned data is not Array, but ObservableArray.</i>  <i>To convert observable objects into a javascript structure, use <a href="https://mobx.js.org/refguide/tojson.html">toJS ()</a> .</i> <br><br>  In app.js, let's not forget to add a new user store so that descendants can use it. <br><br>  Add the react components to the components directory: <br><br><div class="spoiler">  <b class="spoiler_title">user-list / index.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observer, inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx-react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UserList <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./user-list'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Component = inject(<span class="hljs-string"><span class="hljs-string">'userStore'</span></span>)(observer(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ userStore }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">UserList</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">users</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{userStore.getUsers()}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">selectedUsersCount</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{userStore.selectedCount}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> ); })); Component.displayName = 'UserList'; export default Component;</span></span></code> </pre> <br></div></div><br>  There is already a familiar wrapper to us, passing an array of users and the number of users checked through props. <br><br><div class="spoiler">  <b class="spoiler_title">user-list / user-list.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* components */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UserListItem <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./user-list-item'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* styles */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> style <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./styles.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> UserList = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div className={style.container}&gt; &lt;ul&gt; {props.users.map(userStore =&gt; { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ( &lt;UserListItem key={userStore.user.get(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'id'</span></span></span></span></span><span class="hljs-function">)} </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">isChecked</span></span></span><span class="hljs-function">={</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">userStore</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">user</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'checked'</span></span></span></span></span><span class="hljs-function">)} </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">={</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">userStore</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">userInfo</span></span></span><span class="hljs-function">} </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">onToggle</span></span></span><span class="hljs-function">={</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> userStore.toggle()} /&gt;); })} &lt;<span class="hljs-regexp"><span class="hljs-regexp">/ul&gt; &lt;span&gt;{`Users:${props.users.length}`}&lt;/</span></span>span&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{`Selected users: ${props.selectedUsersCount}`}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/div&gt; ); }; export default UserList;</span></span></code> </pre> <br></div></div><br>  We show a list of users and information on their number.  Pass the ‚Äútoggle ()‚Äù method of stor via props. <br><br><div class="spoiler">  <b class="spoiler_title">user-list / user-list-item.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> UserListItem = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function"> =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"checkbox"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">checked</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{props.isChecked}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> props.onToggle()} /&gt;{props.text} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ); export default UserListItem;</span></span></code> </pre> <br></div></div><br>  Render one user. <br><br>  We add styles and we catch the finished component on the Home page.  Everything is ready ( <a href="https://github.com/AlexeyRyashencev/react-hot-mobx-es6">github</a> ), you can play with the checkboxes and make sure that all the methods work. <br><br>  As a result, we saw how mobx works in conjunction with react, taking into account all the possibilities of mobx, we can assume that such a solution has the right to life.  Mobx copes with the responsibility of the state manager for react applications and provides rich functionality for implementation. </div><p>Source: <a href="https://habr.com/ru/post/324388/">https://habr.com/ru/post/324388/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324376/index.html">Exceptions in Windows x64. How it works. Part 3</a></li>
<li><a href="../324378/index.html">We bring business to the international market in 5 minutes</a></li>
<li><a href="../324380/index.html">Hard Prioritization</a></li>
<li><a href="../324382/index.html">Fine Rust state machines</a></li>
<li><a href="../324384/index.html">Intel SGX Extensions Tutorial. Part 7, revision of the enclave</a></li>
<li><a href="../324394/index.html">Are commodity aggregators good?</a></li>
<li><a href="../324396/index.html">Check Point Security CheckUP - Free network security audit. Part 1</a></li>
<li><a href="../324398/index.html">Biometrics: the art of recognition. Perspectives of biometric systems on the example of the Id-Me platform from the company RecFaces</a></li>
<li><a href="../324400/index.html">NSUserDefaults in practice</a></li>
<li><a href="../324402/index.html">Open machine learning course. Theme 5. Compositions: bagging, random forest</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>