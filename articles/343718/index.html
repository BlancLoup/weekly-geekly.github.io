<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sound settings in Ubuntu</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have a hobby - writing music. Therefore, after installing a fresh version of Ubuntu on my laptop, I needed to adjust the sound a little more subtly ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sound settings in Ubuntu</h1><div class="post__text post__text-html js-mediator-article"><p>  I have a hobby - writing music.  Therefore, after installing a fresh version of <a href="https://www.ubuntu.com/">Ubuntu</a> on my laptop, I needed to adjust the sound a little more subtly than regular users.  To my regret, I didn‚Äôt do it.  Nevertheless, I want to talk about the steps that brought me a little closer to the result.  I hope that someone will save time.  Or maybe with the help of readers I can go further.  If you are using Linux and can say the words sidechain and compression in one meaningful sentence - Welcome! </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/21/ur/yr/21uryruubr7s0ocwbc_nx8u7cw4.jpeg"></div><a name="habracut"></a><br><h1 id="kratko">  Briefly </h1><br><p>  To begin, in more detail about the essence of the problem: there is a laptop Asus N55 with <a href="https://wiki.ubuntu.com/ArtfulAardvark/ReleaseNotes/Kubuntu">Kubuntu 17.10</a> on board.  It is necessary to achieve the same configuration that can be obtained on Windows: </p><br><div class="spoiler">  <b class="spoiler_title">Configuration</b> <div class="spoiler_text"><ul><li>  Without a subwoofer connection, the driver works in 2.0 mode </li><li>  When a subwoofer is connected, the driver switches to 2.1 mode.  With this switch, frequency filters are applied to the channels - LF for the subwoofer and HF for the speakers </li><li>  When headphones are connected, the audio output switches to them, the output to the speakers / subwoofer pauses </li><li>  If you need low latency, you can switch to a mode that allows exclusive sound card capture by selecting a different driver. </li></ul></div></div><br><p>  Immediately after installation, we get a non-working subwoofer and non-working headphones. <br>  As a result of my experiences, I managed to achieve the following system state: </p><br><ul><li>  The driver works in 2.1 mode. </li><li>  When you connect a subwoofer, nothing changes </li><li>  When headphones are connected, the audio output switches to them, the output to the speakers / subwoofer pauses, but the filters continue to work and only HF go to the headphones </li><li>  If necessary, low delays can be addressed to the card via ALSA, but in this mode the subwoofer and filters do not work.  But switching to headphones works </li></ul><br><p>  For acquaintance with <a href="https://lmms.io/">LMMS</a> ( <em>with which, as it turned out, it is impossible to work normally, but this is a separate topic</em> ), this is in general enough. <br>  If you also got to this state, then I will not tell you anything new with this article. </p><br><h1 id="obzor">  Overview </h1><br><p>  Have you ever thought about how a Linux sound system works?  So I am not - usually the sound was either not needed, or somehow it worked, the speakers were playing - there was no talk about connecting the subwoofer or headphones. <br>  Looks like now is the time to find out a little more about it.  Googling showed the following picture: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/03/tx/xe/03txxexaudgjyhhkv5xbgpbkzr8.png"></div><br><ul><li>  <a href="https://www.alsa-project.org/main/index.php/Main_Page">ALSA</a> is a component that provides interaction of sound glands with the core.  It provides the most direct access to the device from reasonable options, but at the same time this exclusive access - to turn on the song in VLC and open the video in the browser, alas, will not work. </li><li>  For these purposes, PulseAudio is just what is needed - a sound server that routes audio streams.  He will be responsible for mixing the sound streams from different applications while using them.  The price for such convenience is the additional delay of the audio stream. </li><li>  There is also a <a href="http://jackaudio.org/">JACK</a> - analog PulseAudio, positioned as a "professional" sound-server.  Promises steep routing capabilities and minimal latency when dispatching threads. </li></ul><br><h1 id="mysl-pervaya-udalyaem-pulseaudio---stavim-jack">  Thought the first: we delete PulseAudio - we put JACK </h1><br><p>  Few people say that PulseAudio is the de facto standard for sound integration, at least in Ubuntu.  Virtually any software that makes sounds will most likely use the PulseAudio API.  FF, for example, <a href="http://www.zamaudio.com/%3Fp%3D1580">to support JACK must be separately collected</a> . <br>  Therefore, you should not delete PulseAudio if you are not sure that everything you use will know how to work with JACK.  Apparently, therefore, there is another version of the integration of Jack-PulseAudio.  But I refused this option because  to work on software where low latency is required, I am satisfied with exclusive access through ALSA (under Windows, it works the same way - where low latency is needed, exclusive access is requested).  Maybe when it comes to installing some <a href="https://ardour.org/">Ardour</a> , I will have to go back to this option. </p><br><h1 id="mysl-vtoraya-alsa-i-pulseaudio-nado-nastraivat">  Thought two: ALSA and PulseAudio need to be customized </h1><br><p>  So, well, JACK is not needed.  So, to make it work, I need to configure the ALSA component for my card and integrate it with PulseAudio </p><br><h2 id="pulseaudio">  PulseAudio </h2><br><p>  Here we are offered out of the box just such a UI console </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/u0/mo/5n/u0mo5n_xwxaixrkztw7v3vh9naw.png"></div><br><p>  It seems to me that there is no need for such an explanation tool.  After applying the settings, you can immediately hear the changes, so try. <br>  Another <a href="https://habrahabr.ru/users/amarao/" class="user_link">amarao</a> <a href="https://habrahabr.ru/post/343718/">advises</a> to pay attention to pactl / pacmd.  If I get there, I'll write what's what with these utilities. </p><br><h2 id="diagnostika-alsa">  ALSA Diagnostics </h2><br><p> First of all, at least some diagnostic tools will be needed - this is the alsa-utils package. <br> <code>sudo apt install alsa-utils</code> <br>  Now let's see how our equipment sees the system. <br> <code>aplay -l</code> </p> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kb/te/nb/kbtenbdjvoa7zztu1liznctwn_k.png"></div><br><p>  In addition, the settings must be checked.  For these purposes, the speaker-test utility was found. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ny/li/i7/nylii7uqbdzzlswbrnnc36wjiom.png"></div><br><p>  calling speaker-test --help will show what the utility can do, but I am particularly interested in the configuration <br> <code>speaker-test -Dplughw:1,0 -c4</code> </p> <br><ul><li>  -D - device id.  1.0 is the device and sub-device indexes, which we saw above in the aplay output <br>  but the structure of the text part is described <a href="https://www-uxsup.csx.cam.ac.uk/pub/doc/suse/suse9.0/userguide-9.0/ch18.html">here</a> </li><li>  -c - the number of channels on which the test will be displayed <br>  In my case, the first 2 channels work well, but further it is interesting - the 3rd channel LFO does not sound, but the 4th channel sounds.  <em>It feels like the LFO is tuned like a stereo ...? I think this is part of my problem.</em> <br><br></li></ul><br><h2 id="nastroyka-alsa">  ALSA Setup </h2><br><p>  <a href="https://habrahabr.ru/post/343718/">Here</a> and <a href="https://habrahabr.ru/post/343718/">here it is</a> advised to learn dmix - this is the channel mixer module in ALSA - I will watch </p><br><h3 id="alsamixer">  alsamixer </h3><br><p>  alsamixer is a pseudo graphic mixer interface.  Half the tuning tips are limited to this utility.  And indeed, it is this utility that will often show when the channel has suddenly closed down or its volume has been reset. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/5f/xy/di/5fxydiwck35_jk5rycpmcco4nkc.png"></div><br><p>  But the setting in the mixer did not give the result. </p><br><h3 id="hdajacksensetest">  hdajacksensetest </h3><br><p>  The next useful utility is hdajacksensetest.  Shows which connectors detect external device connections. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_z/z0/vb/_zz0vb7tlfnkwdw48iyliknyayq.png"></div><br><p>  OK, I see that my external subwoofer is connected to port 0x1a. <br>  Let's try to find out how to explain to the map where to put the LFO. </p><br><h3 id="hdajackretask">  hdajackretask </h3><br><p>  Most tips for setting up mapping point to the hdajackretask utility: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/n0/li/kj/n0likjm_5a6nfpjfkmwkhete4au.png"></div><br><p>  Here everything seems to be clear - there are ports, there is a mapping.  Unfortunately, no manipulations with port 0x1a resulted in success. <br>  Maybe after setting you need to restart services explicitly? <br> <code>sudo alsa force-reload</code> <br>  No, look further. </p><br><h3 id="hdaanalyzer">  HDAAnalyzer </h3><br><p>  To configure the mapping there is another utility: <br>  You can download it as a python-script (!!!) <a href="https://www.alsa-project.org/main/index.php/HDA_Analyzer">here</a> . </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/f7/1j/fu/f71jfu682q8mskp9evlue0kiotg.png"></div><br><p>  This thing looks like a pumped-up version of hdajackretask - it even knows how to build a port routing scheme graphically.  But experiments with this thing also did not lead to anything except the complete loss of sound. <br>  I didn‚Äôt find any configuration guide, so I tried by trial and error. </p><br><h2 id="pravka-konfigov">  Edit Configs </h2><br><p>  I did not find other utilities that can help in setting up the sound.  It remains to try only one thing - to search and edit configs.  With the help of Google and find, I managed to find several locations. </p><br><h3 id="pulseaudio-1">  PulseAudio </h3><br><p> <code>/usr/share/pulseaudio</code> <br>  in the alsa-mixer folder there are configs here.  Since  Pulseaudio is more or less working here, I did not touch anything. <br> <code>/etc/pulse/daemon.conf</code> <br>  As I understand it, these are the settings of the pulseaudio service - one of the few configs, the changes in which affect something.  It is here settings: <br> <code>enable-lfe-remixing = yes</code> <br> <code>lfe-crossover-freq = 200</code> <br>  I made my subwoofer from Pulseaudio sound as it should.  For lfe-crossover-freq 200, this is a clear cut-off frequency in hertz. <br>  But then it becomes obvious that it is not possible to adjust something more complicated (when connecting headphones to stop sending bass to the subwoofer). </p><br><h3 id="alsa">  Alsa </h3><br><p> <code>/usr/share/alsa/*</code> <br>  There are several shell scripts here, incl.  alsa-info.sh, which can be useful in preparing a defect in the tracker, etc. <br>  and there are some configs in the pcm folder, which I could not figure out: </p><br><div class="spoiler">  <b class="spoiler_title">Config example: center_lfe.conf</b> <div class="spoiler_text"><pre> <code class="hljs mel">pcm.!center_lfe { @args [ CARD DEV ] @args.CARD { type <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { @func <span class="hljs-keyword"><span class="hljs-keyword">getenv</span></span> vars [ ALSA_CENTER_LFE_CARD ALSA_PCM_CARD ALSA_CARD ] <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { @func refer name defaults.pcm.center_lfe.card } } } @args.DEV { type integer <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { @func igetenv vars [ ALSA_CENTER_LFE_DEVICE ] <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { @func refer name defaults.pcm.center_lfe.device } } } type empty slave.pcm { @func refer name { @func concat strings [ <span class="hljs-string"><span class="hljs-string">"cards."</span></span> { @func card_driver card $CARD } <span class="hljs-string"><span class="hljs-string">".pcm.center_lfe."</span></span> $DEV <span class="hljs-string"><span class="hljs-string">":CARD="</span></span> $CARD ] } } hint { show { @func refer name defaults.namehint.basic } description <span class="hljs-string"><span class="hljs-string">"Center and Subwoofer speakers"</span></span> device $DEV } }</code> </pre> </div></div><br><p>  I did not dare touch them yet. <br>  <code>/etc/modprobe.d/alsa-base.conf</code> is the second proven useful config.  This line, added to the bottom of the config, really made ALSA headphones work: <br> <code>options snd-hda-intel model=auto,auto probe_mask=1</code> <br>  Quite a lot has been written about the configuration of this config.  One of his goals, as I understood it, is to match codecs (model) to devices.  Codecs are ... some preset mappings ... There is a <a href="http://git.alsa-project.org/%3Fp%3Dalsa-kernel.git%3Ba%3Dblob%3Bf%3DDocumentation/sound/alsa/HD-Audio-Models.txt%3Bhb%3DHEAD">sign</a> (there is a copy <a href="https://github.com/spotify/linux/blob/master/Documentation/sound/alsa/HD-Audio.txt">here</a> ).  <strong>I think in most cases this is really enough for standard configurations.</strong> <br>  There are described models for different controllers.  But if they do not work for you, then you are recommended to add your configuration. <br>  It sounds cool, but here I have to make 2 remarks: </p><br><ul><li>  guide how to make your configuration - what to configure, where to save, commit, etc.  I did not find. </li><li>  After changing the settings in alsa-base.conf, you need to restart the OS.  No reboot any <code>sudo alsa force-reload</code> and even hardcore <code>echo 1 | sudo tee /sys/class/sound/hwC1D0/reconfig</code>  <code>echo 1 | sudo tee /sys/class/sound/hwC1D0/reconfig</code> does not force ALSA to re-read the device codec. </li></ul><br><p>  By the way, in <code>/sys/class/sound/hwC1D0/</code> - the files are already directly devices, i.e.  As I understand it, hdajackretask works with these files.  Here, too, you can probably do something useful if you know where to write. </p><br><h1 id="vyvody">  findings </h1><br><p>  I have it all.  After editing in <code>daemon.conf</code> and <code>alsa-base.conf</code> , I got the result described at the beginning.  This is all that I could help you in setting up the sound for Ubuntu. <br>  I received most of the information <a href="https://www.alsa-project.org/main/index.php/Help_To_Debug_Intel_HDA">here,</a> and the <a href="https://wiki.archlinux.org/index.php/Advanced_Linux_Sound_Architecture">ALSA documentation on Arch Linux</a> . <br>  As I said, after the work done, there are more questions than answers: </p><br><ul><li>  how does pulseaudio work normally with a subwoofer, but not ALSA ??? </li><li>  what configs do you need to edit to edit the port mapping ?? </li><li>  how to make your own HD-Audio model ??? </li><li>  How much is ALSA effective compared to peers in other operating systems?  Is it suitable for working with sound? </li></ul><br><p>  The general conclusion that I can draw from the results of the work done is: in general, it is clear that if the GUI, for example, the community is more or less involved, the audio subsystem is clearly overboard. <br>  To date, the possibility of using this subsystem can not withstand any competition with counterparts in other popular operating systems. <br>  Such annoying problems, such as a broken subwoofer or headphones, or the absence of a low-pass filter for a subwoofer, make you think again before discarding the pre-installed software.  After all, no one wants to receive less recoil from their hardware because of the curvature of the OS. </p><br><p>  ps  If there are any other tools, manuals about which it is useful to know when setting up the sound - write, I will add them to the article <br>  ws  Regarding my specific problem, I started the ticket, the owners of the Asus N55 are well-known: <br>  <a href="https://bugs.launchpad.net/ubuntu/%2Bsource/alsa-driver/%2Bbug/1733029">https://bugs.launchpad.net/ubuntu/+source/alsa-driver/+bug/1733029</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/343718/">https://habr.com/ru/post/343718/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343704/index.html">Learning a computer to write like Tolstoy, Volume I</a></li>
<li><a href="../343706/index.html">I created an application that makes learning algorithms and data structures much more interesting.</a></li>
<li><a href="../343708/index.html">Code Textures</a></li>
<li><a href="../343714/index.html">Local automation of builds (Crashlytics + Slack + FastLane)</a></li>
<li><a href="../343716/index.html">Experiment to promote the game on Google Play. Part 1</a></li>
<li><a href="../343720/index.html">Strong typing in non-strict tests</a></li>
<li><a href="../343724/index.html">PLATO: the history of the world's first e-learning system</a></li>
<li><a href="../343726/index.html">Hinton's capsule nets</a></li>
<li><a href="../343728/index.html">Unity game, open source</a></li>
<li><a href="../343730/index.html">We write DSL in Koltin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>