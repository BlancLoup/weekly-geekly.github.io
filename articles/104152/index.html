<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GLGDI + or ‚Äúswitch from GDI + to OpenTK‚Äù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I think many have had to deal with the problem that GDI + slows down, and slows down, because it is not accelerated by iron. 
 So I once wrote a level...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GLGDI + or ‚Äúswitch from GDI + to OpenTK‚Äù</h1><div class="post__text post__text-html js-mediator-article">  I think many have had to deal with the problem that GDI + slows down, and slows down, because it is not accelerated by iron. <br>  So I once wrote a level editor <br><img src="https://habrastorage.org/storage/0c3ee603/dacd0f40/d3166666/1a09765f.jpg"><br>  and I realized that GDI + is no longer enough for me, I need to move on to something accelerated, and in minimal time.  A little googling, I decided to opt for the OpenTK library. <br><a name="habracut"></a><br><blockquote>  OpenTK (Open Toolkit) is a low-level library that is a wrapper for OpenGL, OpenGL ES, OpenCL and OpenAL.  This library is designed for games, scientific applications, as well as for any other applications that require 3D-graphics, audio and computational functionality.  OpenTK is a cross-platform library and works on both Mono and .NET. </blockquote><br>  Why the choice fell on OpenTK?  First, OpenTK provides the GLControl class (which is a direct descendant of UserControl), which allows you to simplify the transition to this library.  Secondly, the bundle includes the TextPrinter class, which makes it quite easy to display text on the screen.  Thirdly, during googling, I found a small archive ‚ÄúEngine.zip‚Äù with a set of classes for 2D rendering, OpenGL initialization and other amenities. <br><br>  At first, I planned to describe which pitfalls I encountered when switching to OpenTK, but, recalling that the issue of switching from GDI + to something fast is quite popular, I decided to write a small library that mimics GDI + and put it in open access.  I called it <a href="http://code.google.com/p/glgdiplus/">GLGDI +</a> .  Remember that this is a lightweight library and contains only the most necessary minimum and does not attempt to completely copy the GDI + API.  It contains the classes GLGraphics, GLImage and GLMultiImage.  GLGraphics contains the following methods: <br><ul><li>  DrawString - displays text </li><li>  DrawImage - draws a GLImage </li><li>  DrawLine - draws a line </li><li>  DrawRectangle - draws a rectangle </li><li>  FillRectangle draws a filled rectangle </li><li>  DrawPoint - draws a point </li><li>  DrawPoints - draws several points </li><li>  DrawMultiImage - draws GLMultiImage (to draw several identical images at once - this is much faster than drawing one at a time if there are many such images) </li></ul><br><h5>  Some moments </h5><br>  I will still describe some points that I had to face when using OpenTK.  There are good tutorials on the OpenTK site, which I, of course, have not read, I‚Äôd read them, and there would be fewer problems.  But, that was, that was: <br><ol><li>  The first thing I encountered was that the control did not redraw at all at startup, it was decided simply, you need to remember to call the SwapBuffers method at the end of OnPaint, GLControl already has the built-in DoubleBuffer functionality, you only need to switch the buffer </li><li>  The next moment I stumbled over was black rectangles instead of images.  It was solved by calling image.SetBlending () before rendering, now all images are drawn with blending in the library, so there should be no problems with it </li><li>  When I transferred the second control to OpenTK rails, it turned out that the first control stopped performing its functions after that, it was decided to call the MakeCurrent method on OnPaint before drawing the elements </li><li>  TextPrinter (the basis for DrawString) sometimes falls when displaying text, there's nothing you can do about it - it's buggy and it falls on certain combinations of drawing quality, font and font size, I had to choose the font and size </li><li>  You also need to keep track of what control was loaded and only after that work with OpenTK / GLGraphics, and also check that the control is not in the form designer mode </li><li>  When resizing controls you need to remember to call GLGraphics.Resize (Width, Height) </li></ol><br><h5>  Conclusion </h5><br>  The library is <a href="http://code.google.com/p/glgdiplus/">on GoogleCode</a> , under the BSD license.  If anyone needs - use on health.  To understand how to work with the library - look at the source code of the sample that comes with it, it is very simple: <br><img src="https://habrastorage.org/storage/863919b1/984cf9c7/ba364ab7/edf084be.png"><br>  All the ‚Äúmoments‚Äù described above are taken into account. <br>  I would not recommend using this library for products aimed at a mass user - it is too young for this, but in utilities it is quite suitable for use. <br>  At the moment I have no plans for the development of the library - I have enough of its functionality.  But bugfixes and patches are welcome :) <br><br>  Judging by what I read on the OpenTK forum, TextPrinter (used for text output) will be excluded from the library in the future, but perhaps in a separate project.  So his fate is still foggy.  Now he is in the Deprecated state, therefore he gives warnings when compiling the library. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now the map editor is much faster and does not slow down anything, which is what you want! <br><br>  UPD: forgot to provide a link to the site <a href="http://www.opentk.com/">OpenTK</a> <br>  <strong>UPD2:</strong> fixed a bug with the paths in the source code of the sample (both in the archive and in SVN) </div><p>Source: <a href="https://habr.com/ru/post/104152/">https://habr.com/ru/post/104152/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../104143/index.html">Raffle prizes for the Day of the programmer!</a></li>
<li><a href="../104144/index.html">About raised floors in the data center</a></li>
<li><a href="../104145/index.html">How is copyright used in political struggle</a></li>
<li><a href="../104146/index.html">Hewlett-Packard buys ArcSight</a></li>
<li><a href="../104147/index.html">Fujitsu is going to put the production of wireless charging on stream</a></li>
<li><a href="../104153/index.html">Press release following the congress of the Pirate Party of Russia</a></li>
<li><a href="../104154/index.html">Problem with ping</a></li>
<li><a href="../104155/index.html">World masterpieces of classical music without copyright</a></li>
<li><a href="../104159/index.html">History of one keyboard</a></li>
<li><a href="../104161/index.html">OS / 2 Death</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>