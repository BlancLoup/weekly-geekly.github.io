<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Splunk. Introduction to machine data analysis - part 1. Examples of SPL queries and log visualization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, we will tell and show how to load data into Splunk, how to build search queries in the system based on the integrated SPL language an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Splunk. Introduction to machine data analysis - part 1. Examples of SPL queries and log visualization</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/43c/d23/97a/43cd2397a2bc47c9af80ff495d50f289.png"><br><br>  In this article, we will tell and show how to load data into Splunk, how to build search queries in the system based on the integrated SPL language and how you can visualize them.  This is a purely practical ‚ÄúHow to‚Äù article based on <a href="">test data</a> , access to which is provided freely and is available for download to everyone. <br><br>  After reading and repeating, you will learn: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Use basic system functionality </li><li>  Upload data to Splunk </li><li>  Build basic search queries </li><li>  Visualize the results </li></ul><br><a name="habracut"></a><br><h2>  Loading data into the system </h2><br><img src="https://habrastorage.org/files/8df/d0b/efe/8dfd0befee16423aba1061ad0e1ba971.png"><br><br>  The system can be divided into 5 main sources of collecting logs (this is not a complete list): <br><br><ul><li>  <b>Files and Directories:</b> Splunk can one-time pick up or monitor a specific file or directory with files, and independently monitors the change. </li><li>  <b>Network events:</b> data coming from network ports (syslog for example) </li><li>  <b>Windows sources: Windows</b> event logs, AD events </li><li>  <b>Scripted Inputs: Scripted</b> Data </li><li>  <b>Modular Inputs:</b> Collecting Data from Specific Platforms, Systems, and Applications </li></ul><br>  In this article, for clarity, we will use the most simple method.  We simply upload the <a href="">test file</a> to Splunk from the local computer.  It is clear that in the history with Enterprise use nobody does this, and the options described above are used together with the forwarder <a href="https://www.splunk.com/en_us/download/universal-forwarder.html">agents</a> on the target systems, and then the infrastructure looks like this: <br><br><img src="https://habrastorage.org/files/127/20d/dc4/12720ddc470d43debd7fe3760c1cce20.png"><br><br>  But in our educational example, one free <a href="https://www.splunk.com/en_us/download/splunk-enterprise.html">Splunk Enterprise Free</a> downloaded to the local computer will be enough for us.  Installation instructions can be found in our <a href="https://habrahabr.ru/company/tssolution/blog/323814/">previous article</a> . <br><br>  Now that you have downloaded the data and installed Splunk, you need to load it into it.  In fact, it is quite simple ( <a href="http://docs.splunk.com/Documentation/Splunk/6.5.2/PivotTutorial/GetthetutorialdataintoSplunk">instruction</a> ), because the data are prepared in advance.  <b>It is important</b> !  No need to unzip the archive. <br><br><h2>  SPL requests </h2><br>  Key features of the SPL language: <br><br><ul><li>  140+ search commands </li><li>  The syntax is similar to the Unix pipeline and SQL and is optimized for <b>data with a time stamp.</b> </li><li>  SPL allows you to search, filter, modify, enrich, combine and delete </li><li>  SPL includes <b>machine learning</b> and <b>anomaly lookups.</b> </li></ul><br><img src="https://habrastorage.org/files/9b2/c75/b4d/9b2c75b4dbed4886bf18255c6f033aa2.png"><br><br><h3>  SPL structure: </h3><br>  Standardly, the SPL query can be divided into several stages: filtering and selecting the necessary data, then creating new fields based on existing ones, then aggregating the data and calculating statistics, and finally renaming the fields, sorting in other words, refining the output. <br><br><img src="https://habrastorage.org/files/c97/5b2/c9c/c975b2c9cebc4f96860fc5ad03d7cc07.png"><br><br>  After you have loaded the data into the system, you can search for them (below are examples of requests, with the results of execution): <br><br>  The search interface is as follows: <br><br><img src="https://habrastorage.org/files/f1e/c63/bb7/f1ec63bb7ac246a1b02cd8fc5a21c250.png"><br><br><h4>  Search and filtering: </h4><br>  In Splunk, you can ‚Äúsearch in Google‚Äù for events by keyword, or a set of keywords separated by standard logic operators, examples below.  You can also update your search at any time by selecting the time interval you need both in the menu on the right and in the central green histogram, which shows the number of events in a certain period of time. <br><br><ul><li>  <b>Search by keyword</b> : <oembed>  sourcetype = access * http </oembed><br><br><img src="https://habrastorage.org/files/f98/b88/cc5/f98b88cc5cda429783d2228e4b68d313.png"><br><br></li><li>  <b>Filtration</b> : <oembed>  sourcetype = access * http clientip = 87.194.216.51 </oembed><br><br><img src="https://habrastorage.org/files/386/e22/581/386e225814304129bd446cbaac6af4e2.png"><br><br></li><li>  <b>Combination</b> : <oembed>  sourcetype = access * http clientip = 87.194.216.51 (503 OR 504) </oembed><br><br><img src="https://habrastorage.org/files/709/16c/fe5/70916cfe57ba4190820df45ee5ef616b.png"><br></li></ul><br><h4>  Calculated Fields (Eval): </h4><br>  Splunk can create new fields based on existing ones. For this, use the <a href="http://docs.splunk.com/Documentation/Splunk/6.5.2/SearchReference/Eval">eval</a> command, the syntax and example of which is described below.  After we have created a field, it can also participate in further requests. <br><br><ul><li>  <b>Calculate new field:</b> <oembed>  sourcetype = access * |  eval KB = bytes / 1024 </oembed><br><br><img src="https://habrastorage.org/files/d4b/3de/7da/d4b3de7da4154ec8b52dee35c058138e.png"><br><br></li><li>  <b>Creating a new field by condition:</b> <oembed>  sourcetype = access * |  eval http_response = if (status! = 200, "Error", "OK") </oembed><br><br><img src="https://habrastorage.org/files/8dd/375/717/8dd3757174cf4c0d9737a871bb179ed4.png"><br><br></li><li>  <b>Coupling two fields in the new:</b> <oembed>  sourcetype = access * |  eval connection = clientip. ":". other </oembed><br><br><img src="https://habrastorage.org/files/4a2/5f3/21a/4a25f321a07f420c93ab3e5cab752183.png"></li></ul><br><h4>  Statistical queries and visualization: </h4><br>  After we have learned to filter and create new fields, we proceed to the next stage - statistical queries or data aggregation.  Plus, all this can naturally be visualized.  For these requests, you will need to upload <a href="https://yadi.sk/d/9tJ7EfYF3FybNP">another test file</a> to the system.  It is important that at the download stage, <b>change the sourcetype</b> <b>csv</b> to <b>eq</b> using the <b>Save As</b> button, so that the results of the requests coincide with our screenshots. <br><br><img src="https://habrastorage.org/files/2fb/65e/d96/2fb65ed966684ede959c07bc0994ea25.jpg"><br><br><ul><li>  <b>Calculation:</b> <oembed>  sourcetype = "eq" |  stats avg (mag) AS "Medium Magnitude" </oembed><br><br><img src="https://habrastorage.org/files/7ab/c1a/17c/7abc1a17c6d1404da98d26df4d11b541.png"><br><br></li><li>  <b>Several calculations:</b> <oembed>  sourcetype = "eq" |  stats avg (mag) AS "Medium Magnitude", sparkline (avg (mag)) AS "Trend" </oembed><br><br><img src="https://habrastorage.org/files/72f/a67/87b/72fa6787b59740958be2116cee344556.png"><br><br></li><li>  <b>Group by type</b> <oembed>  sourcetype = "eq" |  stats avg (mag) AS "Average Magnitude", sparkline (avg (mag)) AS "Trend" by type </oembed><br><br><img src="https://habrastorage.org/files/c0e/a94/37b/c0ea9437bfff440f8dba3386ce2078d5.png"></li></ul><br><h4>  Statistical queries in time: </h4><br>  Since Splunk performs all searches in time, one of the most common commands is <a href="http://docs.splunk.com/Documentation/Splunk/latest/SearchReference/timechart">timechart</a> , which allows you to build statistical queries with reference to time, below are examples (you can choose the type of visualization in the interface under the statistics, visualization tabs and next to the format button): <br><br><ul><li>  <b>Visualization of simple time statistics:</b> <oembed>  sourcetype = "eq" |  timechart avg (mag) as "Medium magnitude" </oembed><br><br><img src="https://habrastorage.org/files/0d0/c59/7ef/0d0c597efe6f4da0825adf830de8aeba.png"><br><br></li><li>  <b>Add a trend line ( <a href="https://docs.splunk.com/Documentation/Splunk/latest/SearchReference/Trendline">algorithm</a> ):</b> <oembed>  sourcetype = "eq" |  timechart avg (mag) as "Medium magnitude" |  trendline sma5 ("Medium magnitude") </oembed><br><br><img src="https://habrastorage.org/files/d30/30a/44f/d3030a44f82c4b3a9ad2e8ee5a6a4c65.png"><br><br></li><li>  <b>Add <a href="https://docs.splunk.com/Documentation/Splunk/6.5.2/SearchReference/Predict">predictive</a> barriers:</b> <oembed>  sourcetype = "eq" |  timechart avg (mag) as "Medium magnitude" |  predict "Average magnitude" </oembed><br><br><img src="https://habrastorage.org/files/74c/b95/7fb/74cb957fb75a429ca48dc31005370ffc.png"></li></ul><br><h4>  Conclusion </h4><br>  <a href="https://habrahabr.ru/company/tssolution/blog/324716/">Next time</a> we will talk about several interesting commands that allow you to work with data that has geographic coordinates and how and where to get these coordinates if they are not there, as well as grouping data to highlight transactions and identify the order of events. <br><br>  I also want to note a super useful document containing in one place a lot of information about Splunk - <a href="https://www.splunk.com/content/dam/splunk2/pdfs/solution-guides/splunk-quick-reference-guide.pdf">Quick Reference Guide</a> . </div><p>Source: <a href="https://habr.com/ru/post/324136/">https://habr.com/ru/post/324136/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324124/index.html">Using the ArcGIS API for Python in Jupyter Notebook</a></li>
<li><a href="../324126/index.html">Logo is clothing</a></li>
<li><a href="../324128/index.html">Configure SSL VPN on the Cisco Router</a></li>
<li><a href="../324130/index.html">Criminal Code of the developer</a></li>
<li><a href="../324132/index.html">What to do if you are locked in rbash</a></li>
<li><a href="../324138/index.html">Sending files to the Xamarin.Forms application. Part 1</a></li>
<li><a href="../324140/index.html">How to find vulnerabilities and protect your WordPress site</a></li>
<li><a href="../324142/index.html">Setting up automatic deployment of independent development environments on one machine (Docker, Ansible, TeamCity)</a></li>
<li><a href="../324144/index.html">Java memory leak diagnostics</a></li>
<li><a href="../324146/index.html">Top 3 NPS Survey Services (Consumer Loyalty Index)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>