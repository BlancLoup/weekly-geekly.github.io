<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Chronicles of the laboratory: how we considered ground coffee as a software for analyzing cellular structures</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Other articles of the cycle: 
 Hello, I am Meklon and I am caffeine-dependent 
 Compote from coffee dried fruits. Meet a cascara - a cyclist's best fr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Chronicles of the laboratory: how we considered ground coffee as a software for analyzing cellular structures</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/4d1/801/742/4d18017421ce403f876c9e979e88daca.jpg"><br><br>  Other articles of the cycle: <br>  <a href="https://geektimes.ru/post/253326/">Hello, I am Meklon and I am caffeine-dependent</a> <br>  <a href="https://geektimes.ru/post/271082/">Compote from coffee dried fruits.</a>  <a href="https://geektimes.ru/post/271082/">Meet a cascara - a cyclist's best friend</a> <br><br>  I continue the coffee theme, which I started on geektimes: <a href="http://geektimes.ru/post/253326/">Hello, I am Meklon and I am caffeine-dependent</a> .  Today, we will create lewdness with software for bioengineering tasks - CellProfiler.  Normal people consider them to be cells, plasmids, protein expression, and other necessary things.  We are damned, so we will carry out a grain-size analysis of the milling of micrographs, beat coffee with static electricity and think about how to attach a hairdryer to this outrage.  And of course, we will need an adhesive tape to obtain a <s>graphene</s> pattern of particle distribution. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In general, computer image analysis is flexible and can be used in completely strange tasks.  At the same time we will check whether it is possible to replace the Turk with a flask with a magnetic stirrer.  In the end, the main principle of survival in the laboratory - "No coffee - no work") There are a lot of photos under the cut, but I tried to shrink them to a decent size. <br><a name="habracut"></a><br><h4>  Graphene and coffee </h4><br><img src="https://habrastorage.org/files/59e/a29/464/59ea294646be41b7bc664e500dd4011a.jpg"><br><br>  The main task that I wanted to solve was an objective comparison of the quality of grinding of different coffee grinders.  In theory, high-quality grinding is characterized by perfect uniformity.  So we need to count the number of particles in a given area and sort them by size.  The greater the variance - the worse the quality.  The simplest example is a rotary coffee grinder, which breaks up grains with fast rotating blades.  In its profile of grinding there are simultaneously large fractions and fine dust.  Good espresso from this coffee will not work.  The problem is related to the uneven penetration of the ‚Äúwater channels‚Äù through which the coffee tablet is poured.  Small particles will give bitterness due to overexposure, and large ones will create ‚Äúworkarounds‚Äù that will make the coffee watery.  In contrast to the rotary, a mill-type coffee grinder gives a more or less calibrated version with identical particles. <br>  Actually, now the task consists of two main points: <br><ol><li>  Place the particles in a normal distribution on a transparent substrate so that they can be photographed with a microscope </li><li>  Calculate the size and number of particles <s>manually for a couple of years</s> automated complex </li><li>  Take stock, make a cup of good espresso and meticulously praise yourself for your wits </li></ol><br>  When we raised this question in the previous <a href="http://geektimes.ru/post/253326/">topic,</a> <a href="https://habrahabr.ru/users/sptor/" class="user_link">sptor</a> and <a href="https://habrahabr.ru/users/mwizard/" class="user_link">mwizard</a> suggested using vibration in various ways.  But this method, like many others, has a very important drawback - the unevenness of the effect of vibration on particles of different sizes.  We need to get a cast of real average composition, and not create a sorting tray of the gold miner in miniature.  The most successful idea came to mind <a href="https://habrahabr.ru/users/eexo/" class="user_link">eexo</a> - use regular tape.  What exactly is a good method?  Cheap, angry.  Just at first glance.  And most importantly - by touching ground coffee with scotch tape, you get a complete set of particles in a realistic distribution.  Naturally, without a rake, electrical injuries and villainous laughter during the experiment could not have done ... <br><br><img src="https://habrastorage.org/files/72b/726/02c/72b72602cf7a4037a57b940c64f99dcf.jpg"><br><div class="spoiler">  <b class="spoiler_title">The result is a little closer</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/7d5/2a6/525/7d52a6525c994610a740073022223421.jpg"><br></div></div><br><h4>  Hair dryer against electrophore machine </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/32d/002/93b/32d00293b23b9fecbb44a327b1b1659a.jpg" alt="image"><br><br>  One of the main problems I encountered was the tendency of small coffee dust particles to stick together, which ultimately leads to an incorrect definition of the boundaries and sizes of objects.  The logic suggested that the problem could be solved by electrifying the coffee particles with the same charge.  It remains only to understand how it is easier to do.  Van de Graaff generator was not at hand.  I decided to just shake the bag of ground coffee.  Since the package turned out to be slightly leaky, I had to sweep and wipe the coffee powder throughout the laboratory for a long time.  Yes, and electrification especially did not work. <br><br>  An alternative version was presented to me at one of the university exhibitions, where unhappy schoolchildren are brought by buses and forced to be inspired by the expositions of educational institutions.  I had fun with a simulator of endoscopic operations, removing the gallbladder for speed, but after the third round it was getting annoying.  I wasn‚Äôt allowed to sit quietly on the Internet.  Every 15-20 minutes, all wireless communication tightly fell.  When I decided to go to the neighboring stands - I saw those strange people who had collected a Tesla coil and a couple of related devices from a pile of copper wire and someone's mother.  It was this vundervaflya shit in all frequencies when turned on and dropped the entire connection. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/0dV1uaBaDdQ%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjIv7BrezeUPe8K5jnIUuSkjDmO3w" frameborder="0" allowfullscreen=""></iframe><br><br>  I tried to remove this tired man, who once again showed the children glowing gas-distributing tubes, but the phone was beginning to go wild with the mind next to the installation, throwing out the camera‚Äôs hardware error, and then hanging tight.  The tablet seemed to hold, but the file slightly beat.  Tesla Coil, the thing is certainly cool, but it does not solve my problem.  But on the same table they found an electrophore machine with leyden banks.  I used this kind of car when I was at school, so that I could charge classmates in the corridor with electric shocks.  The physics teacher scolded and screamed so that I would immediately be grounded to the battery.  In general, I immersed one of the electrodes in the coffee and began to rotate the handle.  Judging by the fact that the hair began to crackle quietly - the potential was gained tangible.  But svolochnaya powder stubbornly did not want to fluff.  Then I made a big mistake, deciding to add more statics.  The Leyden banks that they used were somehow particularly evil.  And very, very capacious.  A beautiful flash between my hands turned out to be extremely painful.  Apparently, the people carefully finalized the design. <br><br>  As a result, I also refused an electrophore machine and decided to take pictures as it is.  Already after I photographed the samples, an alternative idea came to my mind, but there was no time to implement it.  There will be a mood - try.  The idea is to use very hot air, friction and convection at the same time.  That is stupid hair dryer and pipe.  Pour a teaspoon of coffee into the pipe, turn on the hairdryer, wait for the electrification and drop the scotch tape on the hard frame inside to collect the particles.  The diagram below: <br><br><img src="https://habrastorage.org/files/873/6f5/e8e/8736f5e8ed95419ba4f3a7c716784f05.png"><br><br><h4>  Microscope and CellProfiler </h4><br><img src="https://habrastorage.org/files/a8c/1bb/3ee/a8c1bb3ee6d74430b4485ace8e872cde.jpg"><br><br>  Having received our portion of thoughtful views from colleagues, we solemnly go to the microscope, waving pieces of scotch.  As it turned out, coffee particles have an interesting translucent structure at high magnification: <br><br><img src="https://habrastorage.org/files/52e/26a/c41/52e26ac418fd4539a761d972e79822fd.jpg"><br><div class="spoiler">  <b class="spoiler_title">Another photo</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/924/935/0da/9249350da9e04e2fbc85c18667d6d656.jpg"><br></div></div><br>  Unfortunately, our microscope does not support <a href="https://en.wikipedia.org/wiki/Focus_stacking">z-stacking</a> , and in EXIF ‚Äã‚Äãdoes not write enough data to do this in a third-party software.  Therefore, the depth of field is small and collecting a clear picture from the series will not work. <br><br>  In principle, for our purposes, we do not need perfect clarity.  Therefore, we take a 4x lens and photograph our future espresso: <br><br><img src="https://habrastorage.org/files/63c/281/42e/63c28142e84d4e19b1ab8a9d1bbc133d.jpg"><br>  <i>Sample from the roaster, ground Mahlkoenig EKK43</i> <br><br><img src="https://habrastorage.org/files/05d/87e/e52/05d87ee5200c49af84e9b0b59fe379b6.jpg"><br>  <i>Sample from my home grinder, ground DeLonghi KG89</i> <br><br>  Unfortunately, something fell off in the camera built into the microscope and she started to make a lot of noise.  I assumed that the Pelet√© element on the matrix had died, but it was not possible to cool it down normally with a coolant.  Therefore, the second frame looks quite beaten due to post-filtering. <br><br>  Now we give the images to the entrance of the specialized free software <a href="http://www.cellprofiler.org/">CellProfiler</a> .  It is rewritten in Python, was once a superstructure over MatLAB.  Developed by a small team of The Broad Institute of MIT and Harvard.  The interface is completely non-humanoid, but it allows researchers like me to perform complex batch processing and statistical image analysis without deep programming knowledge.  Everything is organized in the form of a pipeline, when the original image is fed into the input, then the necessary manipulations are performed on it, the necessary objects are recognized, counted and measured, after which the cycle is repeated again on the entire file array.  As a result, some time is spent on writing the pipeline, but then you can feed at least 100,000 images and go for tea.  The process is parallelized according to the number of processor threads. <br><br><img src="https://habrastorage.org/files/f86/168/586/f861685861a148198f5118e5b9e1bf21.png"><br>  <i>Program interface</i> <br><br>  I will briefly describe the stages: <br><ol><li>  Convert three channels of 8-bit sRGB into one, monochrome </li><li>  Invert image.  This is a historical feature - the program is sharpened by the recognition of light objects on a dark background </li><li>  Threshold filtering for background clipping.  A manually selected global threshold was used. </li><li>  Identification of objects and their boundaries.  The Otsu algorithm was used to separate objects from the background. </li><li>  Measurement of object parameters - area, eccentricity, diameter, etc. </li><li>  Classification of objects into 3 conditional groups by the parameter "area" </li><li>  Saving selected results table and saving individual intermediate images </li></ol><br><br><img src="https://habrastorage.org/files/599/a7d/46c/599a7d46c0674d72bfdd02a02deb6041.png"><br><br>  Here is the identification of objects.  Recognition in our version is far from ideal, since it did not turn out to separate stuck particles.  According to the settings, the algorithm, after separating the background, tries to find round-shaped objects. <br><br><div class="spoiler">  <b class="spoiler_title">Recognized objects, large.</b>  <b class="spoiler_title">Bounding defects are visible</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/b65/a1a/79a/b65a1a79a0a54aaa8f47f83c7c9e499b.png"><br><img src="https://habrastorage.org/files/3df/da2/5b0/3dfda25b01674e93b69c3b0e3aacf7ed.png"><br></div></div><br><br>  After sorting into small, medium and large particles, we obtained the following distribution for a professional and home grinder, respectively: <br><br><img src="https://habrastorage.org/files/70f/db7/2b5/70fdb72b5de8458cab56bd2a0be96c6a.png"><br><img src="https://habrastorage.org/files/e6f/800/4e8/e6f8004e861d47cc91878b49ed0e9274.png"><br><br>  I will not interpret the results, since the samples did not initially meet the requirements for separation of particles.  If someone is interested in repeating, I laid out the pipeline for Cellprofiler on <a href="https://www.dropbox.com/s/rysmv7ly0bpqpra/coffee.cpproj%3Fdl%3D0">Dropbox</a> .  You can check it yourself.  Visually, grinding on a professional machine is more uniform, but more difficult to say.  Very high sample requirements for normal statistics. <br><br><h4>  Other uses </h4><br>  CellProfiler doesn't care what to count.  I quite successfully sawed the pipelines for analyzing some nanocrystals.  For fun, I even tried to see how he would cope with the definition of objects in astrophotography.  In the example below, I simply fed the software a high resolution photo of the starry sky and brought all the channels into one monochrome.  Theoretically, playing with filters and intensity thresholds, you can separate the stars of different spectral classes from each other.  Especially if the source is not 8-bit.  The program natively supports work with wide dynamic range images. <br><br>  The source, a little crushed Habrastorage: <br><br><img src="https://habrastorage.org/files/5dd/e1b/2dc/5dde1b2dccaa42c8b8096e9e776d3411.jpg"><br><br>  But honestly certain 34767 stars with some degree of error. <br><br><img src="https://habrastorage.org/files/1aa/75f/f7f/1aa75ff7f4094c748473abf5545e92b8.png"><br><br>  With further analysis, you can analyze the coefficient of the neighborhood, use masks, sort by area, color, or something else. <br><br><h4>  How to make coffee in the lab </h4><br>  Thinking well with Diana, we decided that <a href="http://www.torrefacto.ru/catalog/roasted/guatemala-platanillo-egipto/">Guatemala Plataniyo Ezipto</a> should not be lost to our favorite variety.  I love him wildly for the fullness and fullness of espresso, with tantalizing notes of mature cocoa and light sourness.  One of the brightest varieties of medium degree of roasting, in my opinion.  Especially when it is fried a few days ago.  But since we started testing the samples, we decided to try an alternative approach to making coffee.  We will cook it on a precision laboratory heater with a magnetic stirrer.  The main thing is not to get then on the head from the head of the laboratory. <br><br>  This will help me Diana <a href="https://habrahabr.ru/users/in_green_shoes/" class="user_link">in_green_shoes</a> .  She is actually a linguist and translator, but sometimes, when no one sees her, she puts on a robe and makes a smart appearance, playing a scientist. <br><br><img src="https://habrastorage.org/files/c8a/0f1/c37/c8a0f1c37add4f28b859dd6ea1715fc2.jpg"><br><br>  First we collect de-ionized water from Milli-Q.  On resistance - a deaf insulator with a resistance of 18.2 MŒ© ¬∑ cm Water of such purity is used for analytical chemistry, molecular biology and now for coffee brewing. <br><br><div class="spoiler">  <b class="spoiler_title">Diana with a smart look examines a flask with water</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/fa3/bb7/f11/fa3bb7f118b544b4b52e5674f9122c8a.jpg"><br></div></div><br>  Now you need to carefully examine the sample.  And make friends with him.  After all, this is a friend-coffee powder.  This variety makes her especially happy, yes. <br><br><img src="https://habrastorage.org/files/642/9b7/134/6429b71340c44978a5937cd76f5cde9e.jpg"><br><img src="https://habrastorage.org/files/bd1/ca0/69b/bd1ca069bb9e4e86b0417d621e180e0d.jpg"><br><br>  We accurately weigh the right amount of coffee.  We weigh exactly.  Four decimal places will be enough, I think.  We are in the laboratory after all. <br><br><img src="https://habrastorage.org/files/78a/2bd/412/78a2bd412eb6401faba1f7e03ffff236.jpg"><br><br>  Pour coffee into a flask and throw a neodymium magnet in a ceramic shell.  During the cooking process, it will rotate at a speed of about 1000 revolutions per minute, ensuring maximum extraction. <br><br><img src="https://habrastorage.org/files/a67/2ad/588/a672ad58845840a9889af8280e1ec384.jpg"><br><img src="https://habrastorage.org/files/382/7c2/7d1/3827c27d1b5147ab982ffa1cec5d0514.jpg"><br><br>  And here is the heater itself.  In theory, it is also necessary to dip the feedback sensor in the coffee, but before that it was used with something toxic, and patiently expect that something does not fall off.  Therefore, we decided to get by with a simpler version.  Just set 320 degrees for primary heating and reduce the temperature to 97 just before boiling.  The magnetic stirrer rotates like an abnormal, providing continuous stirring. <br><br><img src="https://habrastorage.org/files/c0a/191/ab5/c0a191ab54f848f3838130cd99baf7aa.jpg"><br><img src="https://habrastorage.org/files/cf4/cc6/370/cf4cc63709ad47469b889f0c674672eb.jpg"><br><br>  We catch foam raising in the same way as with classic Turk: <br><br><img src="https://habrastorage.org/files/3da/a63/a1d/3daa63a1d6244dd18d3775041ea5a417.jpg"><br><br>  As a result, we get burns due to the fact that we have forgotten about heating the neck of the flask from hot steam.  At the next attempt we use thick gloves and gently pour the result into cups.  The coffee turned out to be aromatic, but very highly extracted.  Eyes open sharply and you start to run like caffeine protein.  The method is actually just for fun, but why not try it?  Well, as a bonus, I will add more photos from this photoset) <br><br><div class="spoiler">  <b class="spoiler_title">I think coffee has a strange effect on her.</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/ecf/9b2/aec/ecf9b2aecd8a4a0bbf8cbf015cc91267.jpg"><br><img src="https://habrastorage.org/files/e4f/483/a4a/e4f483a4aa244158a059ab02d5f0540c.jpg"><br><img src="https://habrastorage.org/files/e1e/16c/22a/e1e16c22aeb04066a40f4c44dadfabb1.jpg"><br><img src="https://habrastorage.org/files/bf8/024/fe4/bf8024fe42ed48fca9ca68ee966f5a62.jpg"><br></div></div><br><br>  PS I still managed to contact the guys from Torrefakto, promised to find time to answer questions.  They actually have a lot of different high-tech stuff.  Only one photocolorimeter for accurate determination of the color of the grain is worth something.  This, for example, is an important point in an objective assessment of the degree of roasting.  If it is interesting, I will try to find time to talk about these things. </div><p>Source: <a href="https://habr.com/ru/post/271405/">https://habr.com/ru/post/271405/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../271395/index.html">Results GeekWeek. How to find a job, on what to develop and what systems to use</a></li>
<li><a href="../271397/index.html">Flexbox for interfaces in all its glory: Implementing Tracks (Part 2)</a></li>
<li><a href="../271399/index.html">We test the quality of VoIP through the channels of mobile operators (iOS)</a></li>
<li><a href="../271401/index.html">How did programmers go to a marketing conference, or about VeeamON 2015 first-person</a></li>
<li><a href="../271403/index.html">The digest of interesting materials for the mobile developer # 130 (November 16‚Äì22)</a></li>
<li><a href="../271407/index.html">Analyze resumes with HeadHunter. Who earns how much and in which industries he works</a></li>
<li><a href="../271409/index.html">Drupal 8. Educational materials and not only</a></li>
<li><a href="../271411/index.html">News from the world of payment systems: Visa and Visa Eu - once again a single whole</a></li>
<li><a href="../271413/index.html">All for watchOS</a></li>
<li><a href="../271417/index.html">Briefly about the architecture of the component Symfony Config</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>