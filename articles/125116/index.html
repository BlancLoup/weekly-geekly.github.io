<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Loginza - authorization through Vkontakte, Facebook, etc. OpenID servers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Instead of intro 
 About Loginza service today is not so much 
 information, and which is available - mainly from the developers themselves and quite ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Loginza - authorization through Vkontakte, Facebook, etc. OpenID servers</h1><div class="post__text post__text-html js-mediator-article"><h4>  Instead of intro </h4><br>  About <a href="http://loginza.ru/">Loginza</a> service today is not so much <br>  information, and which is available - mainly from the developers themselves and quite dry.  it <br>  even strange.  I want to talk about my own development experience. <br>  I had to face the solution of the authorization problem on the developed <br>  website via Facebook and VKontakte.  Not long googling, stumbled upon Loginzu.  Peered and <br>  decided to try. <br><br>  The documentation, although present, is, in my opinion, rather poor.  Few examples.  There are ready <br>  authorization modules for promoted engines.  In this post I would like to briefly <br>  tell the algorithm that I applied in my project. <br><br><a name="habracut"></a><br><h4>  Preparatory stage </h4><br>  The entire preparatory stage comes down to viewing the demos (to represent the final view) and <br>  registration in Loginze.  Registration is simple, I registered through my Yandex account, on <br>  Mail instantly received a letter with registration confirmation and a link to the activation. <br>  In the interface of the personal account Loginzy you need to register the site.  Then take <br>  confirm the rights by posting the file to the site.  As in Yandex webmaster (by the way, who does not know - <br>  Yandex bought Loginz). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After the rights are confirmed, you can get the ID of the widget, and the secret key of the widget. <br>  They will be needed to develop an authorization script.  Also, in the settings you need <br>  tick "safe mode".  "Dangerous mode", apparently was in the past, about <br>  Security a few words at the end of the post. <br><br>  The final preparatory step is getting the widget's HTML code.  This can be done all on <br>  same management page "My Widgets". <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/5e3/335/2eb/5e33352eb8395073c1288949ec639e46.png" alt="image"><br><br><h4>  Base development </h4><br>  My implementation will not claim perfection, but it will fully show <br>  the essence of what is happening. <br><br>  It should be understood that authorization "through LoginZu" is just an interlayer between <br>  user of soc.  network and site.  Successful authorization through Loginzu still does not give <br>  authorization on the site.  Usually, for authorization on the site, the user must enter <br>  correct login and password, after which he gets access.  In our case, successful authorization <br>  through Loginzu, this is a kind of login and password entry, but not yet authorization. <br><br>  So, we have two tables in the database: <br>  1. users (fields: user_id, nickname, password, email) <br>  2. loginza (fields: id, identity, provider, nickname, email, status, user_id) <br><br>  The first table stores the users of the site, authorization on the site occurs exactly according to the data in <br>  this table.  C fields of this table, I think, everything is clear. <br><br>  The second table also stores users.  But these are users who successfully logged in through <br>  Loginzu. <br>  identity - passes Loginza.  Something like a unique key from the provider. <br>  provider - passes Loginza.  This is the service through which the user logged in (VKontakte, Facebook, <br>  Yandex, etc.) <br>  nickname, email - betrays Loginza.  Nickname (mail) who returned the authorization provider.  Can <br>  be anything  Or not at all. <br>  status - new user / old user <br>  user_id - user id in the users table <br><br>  This is the minimum set of tables. <br><br><h4>  Authorization script itself </h4><br><h6>  Login page </h6><br>  The HTML code you received at the first stage is a login form.  Placed on page <br>  authorization. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/c6f/fcb/7c1/c6ffcb7c164a1627cec74d0d8c5d9433.png" alt="image"><br><br>  In the resulting code, you must specify the address to which the user will go if successful <br>  authorization.  This script will receive the data on authorization! <br>  <a href="http://loginza.ru/api/widget%3Foverlay%3Dloginza%26token_url%3D">loginza.ru/api/widget?overlay=loginza&amp;token_url= Your</a> <b><a href="http://xn--80aae4a9adjj3b/auth.php">site / auth.php</a></b> <br>  You need to specify the full URL with http: // or https: //, pre-encoded PHP <br>  the urlencode () function. <br><h6>  The script receive the response and registration and authorization of the user </h6><br>  This script should recognize the response from logins and guide the user further. <br>  The contents of the script is something like this: <br> <code>$loginzaid='ID'; //ID          <br> . <br> $loginzakey='HASH'; //         <br>  . <br> <br> $token=$_POST['token']; //  . <br> $sig=md5($token.$loginzakey); // . <br> $kk="http://loginza.ru/api/authinfo?token=".$token."&amp;id=".$loginzaid."&amp;sig=".$sig.""; // <br> url      <br> $b=file_get_contents($kk); //    <br> $authresult=json_decode($b,true); // PHP     <br></code> <br><br>  In the array $ authresult - data about the authorized user. <br><br>  <i>In this example, we will somewhat simplify the task and assume that nickname and email are passed</i> <i><br></i>  <i>the authorization provider and the user with such data in our users table are not yet</i> <i><br></i>  <i>exists.</i>  <i>In practice, this should be checked, and if there is no data or they duplicate</i> <i><br></i>  <i>existing login in the user base - request a clarification from the user.</i>  <i>But it is different</i> <i><br></i>  <i>story.</i> <br><br>  So, we continue. <br><br>  <b>New user</b> <br><br>  Check if there are entries in the loginza table with the received provider parameters and <br>  identity <br> <code>$res=mysql_query("SELECT * FROM $tbl_l WHERE identity='$authresult[identity]' AND <br> provider='$authresult[provider]'");</code> <br>  If there is no such record, then we put the user in the loginza table <br> <code>if(mysql_num_rows($res)==0) <br> { <br> mysql_query("INSERT INTO loginza ( <br> `identity`, <br> `provider`, <br> `nickname`, <br> `email`, <br> `status`, <br> `soc_user_id` <br> ) <br> VALUES <br> ( <br> '$authresult[identity]', <br> '$authresult[provider]', <br> '$authresult[nickname]', <br> '$authresult[email]', <br> 0, <br> 0 <br> ) <br> ") ; <br> <br> } <br></code> <br><br>  Now for sure this user is there. <br>  We read about the user with such identity and provider (ugly, but for simplicity <br>  narration). <br><br> <code>$res=mysql_query("SELECT * FROM $tbl_l WHERE identity='$authresult[identity]' AND <br> provider='$authresult[provider]'"); <br> $loginza=mysql_fetch_assoc($res); <br></code> <br>  If this is his first entry and acc.  it is not yet registered in the users table - register it <br>  there, and then update the loginza table: <br> <code>if($loginza['status']==0) <br> { <br> $pwd=md5(' '); // ( )   MD5-  <br> mysql_query("INSERT INTO users (nickname, password, email) VALUES ('$loginza[nickname]', <br> '$pwd', '$loginza[email]' )"); //  <br> $iid=mysql_insert_id(); // ID  .  . <br> //         loginza <br> mysql_query("UPDATE loginza SET status=1, user_id=$iid WHERE id=$loginza[id]"); //  <br> =1       users <br> } <br></code> <br><br>  Everything!  Now we have a link between the authorization of this user and Loginz. <br><br>  It remains only to authorize this user on the table users and put it on the site. <br> <code>if($loginza['status']==1) <br> { <br> Someauthorization($iid); //,    <br> } <br></code> <br><br>  <b>Existing user.</b>  <b>Re-entry.</b> <br>  What will happen if this user logs in again (next time)?  Back to the moment <br>  when we assigned a check to the first user login: <br> <code>if($loginza['status']==0) <br></code> <br>  And so on. <br>  If the user has already logged in successfully to the site, his status in the loginza table is one. <br>  We need to find out the user_id of this loginza entry and send it for authorization!  And it's all! <br> <code>if($loginza['status']==1) <br> { <br> Someauthorization($loginza['user_id']); //,    <br> } <br></code> <br><h5>  A few words about security </h5><br>  In my opinion, Loginza provides sufficient security, all critical <br>  shoals that were - sort of covered up.  Personally, I do not see a potential vulnerability. <br><br>  As for the code given by me - this is just an example, an illustration, and not a ready-made code.  Not <br>  It is worth using the code given by me in the form in which it is. </div><p>Source: <a href="https://habr.com/ru/post/125116/">https://habr.com/ru/post/125116/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../125105/index.html">Fry it! Or reanimation of the video card in the oven</a></li>
<li><a href="../125107/index.html">ListView inside ScrollView</a></li>
<li><a href="../125112/index.html">Do you have a rutted smartphone?</a></li>
<li><a href="../125114/index.html">New way to transfer funds to QIWI Wallet: by email</a></li>
<li><a href="../125115/index.html">30 years old MS-DOS</a></li>
<li><a href="../125118/index.html">First introduction to the Google Maps Javascript API</a></li>
<li><a href="../125120/index.html">Intel developers govodayat too</a></li>
<li><a href="../125122/index.html">How often on sites do you use the icons of ‚Äúhouse‚Äù, ‚Äúmagnifying glass‚Äù and ‚Äúenvelope‚Äù?</a></li>
<li><a href="../125123/index.html">Do you use the "sealed" modifier?</a></li>
<li><a href="../125126/index.html">WM> Bank = Technical Overdraft</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>