<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unit testing of models in Yii</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Now I will talk about the use of TDD technology for developing models using the Yii-framework. 
 Initially it is assumed that the ‚ÄúTesting‚Äù topic was ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unit testing of models in Yii</h1><div class="post__text post__text-html js-mediator-article">  Now I will talk about the use of TDD technology for developing models using the Yii-framework. <br>  Initially it is assumed that the ‚ÄúTesting‚Äù topic was read from the official manual ( <a href="http://yiiframework.ru/doc/guide/ru/test.overview">http://yiiframework.ru/doc/guide/ru/test.overview</a> ). <br><br>  So, the environment is set up and now our task will be to create models of categories and products (Category, Product) and cover them with tests. <br><br><a name="habracut"></a><br>  Suppose the table of categories we have the following fields: <br><ul><li>  parent_id </li><li>  name </li><li>  description </li><li>  status </li></ul><br>  Product table: <br><ul><li>  category_id </li><li>  name </li><li>  description </li><li>  price </li><li>  status </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Using Gii, we create models using these tables.  These will be Category and Product models. <br><br>  Since our models work with the base, test classes will inherit from CDbTestCase. <br>  Create a test class for the Category model.  Inside, we create the ‚Äúcategory‚Äù property for the object of the class being tested and set the assignment in the setUp () method. <br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CategoryTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CDbTestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Category */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $category; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::setUp(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Category(); } }</code> </pre> <br>  In all models we have field validation, and we will begin testing with it. <br><br>  We describe what validation rules will have to exist for our model: <br><ul><li>  title is a required field </li><li>  maximum length 150 characters </li><li>  parent_id if filled, must necessarily exist in the table </li><li>  description length up to 4000 characters </li><li>  status is a required field </li><li>  status must contain a value from the specified list of statuses. </li></ul><br><br>  So, "title is a required field."  Guided by TDD, we first write a test. <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testTitleIsRequired</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;title = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertFalse(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;validate(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span>))); }</code> </pre><br><ul><li>  The name of the test clearly tells us that this method is testing. </li><li>  Inside, we assign the title an empty string, run validation and check that it did not pass. </li></ul><br><br>  Run test red.  We write validation. <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'required'</span></span>), ); }</code> </pre><br>  Run test green.  Refactoring is not required, so go to the next test. <br><br>  Maximum length 150 characters <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testTitleMaxLengthIs150</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;title = generateString(<span class="hljs-number"><span class="hljs-number">151</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertFalse(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;validate(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;title = generateString(<span class="hljs-number"><span class="hljs-number">150</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertTrue(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;validate(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span>))); } <span class="hljs-comment"><span class="hljs-comment">// generateString(),      function generateString($length) { $random= ""; srand((double)microtime()*1000000); $char_list = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"; $char_list .= "abcdefghijklmnopqrstuvwxyz"; $char_list .= "1234567890"; // Add the special characters to $char_list if needed for($i = 0; $i &lt; $length; $i++) { $random .= substr($char_list,(rand()%(strlen($char_list))), 1); } return $random; }</span></span></code> </pre><br>  Run test red.  It is necessary to plant the test by adding validation. <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'required'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'length'</span></span>, <span class="hljs-string"><span class="hljs-string">'max'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">150</span></span>) ); }</code> </pre><br>  We start, the test is green, everything is ok. <br><br>  We now turn to validating the relationships of the model.  In the ‚ÄúCategory‚Äù model, we imply the existence of a ‚Äúparent‚Äù connection. <br>  To implement the bond test, we need fixtures. <br>  Create a fixture file in the desired folder. <br>  Let me remind you that the fixture file should be named in the same way as the table in which the fixture data will be stored. <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'sample'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, ), <span class="hljs-string"><span class="hljs-string">'sample2'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'parent_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ) );</code> </pre><br><br>  Connect fixture to the test. <br><pre> <code class="php hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CategoryTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CDbTestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $fixtures = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'categories'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Category'</span></span> ); ...</code> </pre><br><br>  We write a test to check the connection. <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testBelongsToParent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $category = Category::model()-&gt;findByPk(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertInstanceOf(<span class="hljs-string"><span class="hljs-string">'Category'</span></span>, $category-&gt;parent); }</code> </pre><br>  Run test red.  It is necessary to describe the relationship in the model. <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">relations</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'parent'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::BELONGS_TO, <span class="hljs-keyword"><span class="hljs-keyword">__CLASS__</span></span>, <span class="hljs-string"><span class="hljs-string">'parent_id'</span></span>), ); }</code> </pre><br>  Run test green. <br>  With the advent of fixtures, there was a problem.  The setUp () method of the CDbTestCase class calls a resource-intensive method for loading fixtures, even when no test fixtures are needed.  This problem can be solved like this. <br><pre> <code class="php hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DbTestCase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CDbTestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $_loadFixturesFlag = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Load fixtures one time */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$_loadFixturesFlag &amp;&amp; is_array(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;fixtures)) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loadFixtures(); <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$_loadFixturesFlag = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } <span class="hljs-comment"><span class="hljs-comment">/** * Load fixtures */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadFixtures</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($fixtures = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($fixtures === <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { $fixtures = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;fixtures; } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getFixtureManager()-&gt;load($fixtures); } }</code> </pre><br><br>  We created a descendant of CDbTestCase and modified it.  Now the fixtures will be called only once, but if we change the data of the fixtures in one of the tests, then we reload them by calling the loadFixtures () method manually. <br><br>  Now I will give the source codes of the final version of the ‚ÄúCategory‚Äù and ‚ÄúCategoryTest‚Äù classes.  Writing tests for the model ‚ÄúProduct‚Äù remains as homework. <br><br><pre> <code class="php hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CategoryTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DbTestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Category */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $category; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::setUp(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Category(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testAllAttributesHaveLabels</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $attributes = array_keys(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;attributes); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($attributes <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $attribute) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertArrayHasKey($attribute, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;attributeLabels()); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testBelongsToParent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $category = Category::model()-&gt;findByPk(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertInstanceOf(<span class="hljs-string"><span class="hljs-string">'Category'</span></span>, $category-&gt;parent); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testTitleIsRequired</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;title = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertFalse(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;validate(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span>))); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testTitleMaxLengthIs150</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;title = generateString(<span class="hljs-number"><span class="hljs-number">151</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertFalse(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;validate(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;title = generateString(<span class="hljs-number"><span class="hljs-number">150</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertTrue(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;validate(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span>))); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testParentIdIsExist</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;parent_id = <span class="hljs-string"><span class="hljs-string">'not-exist-value'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertFalse(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;validate(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'parent_id'</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;parent_id = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertTrue(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;validate(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'parent_id'</span></span>))); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testDescriptionMaxLengthIs4000</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;description = generateString(<span class="hljs-number"><span class="hljs-number">4001</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertFalse(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;validate(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'description'</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;description generateString(<span class="hljs-number"><span class="hljs-number">4000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertTrue(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;validate(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'description'</span></span>))); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testStatusIsRequired</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;status = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertFalse(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;validate(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'status'</span></span>))); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testStatusExistsInStatusList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;status = <span class="hljs-string"><span class="hljs-string">'not-in-list-value'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertFalse(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;validate(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'status'</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;status = array_rand(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;getStatusList()); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertTrue(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;category-&gt;validate(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'status'</span></span>))); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testSafeAttributesOnSearchScenario</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $category = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Category(<span class="hljs-string"><span class="hljs-string">'search'</span></span>); $mustBeSafe = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'description'</span></span>); $safeAttrs = $category-&gt;safeAttributeNames; sort($mustBeSafe); sort($safeAttrs); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertEquals($mustBeSafe, $safeAttrs); } } <span class="hljs-comment"><span class="hljs-comment">/** * This is the model class for table "{{categories}}". * * The followings are the available columns in table '{{categories}}': * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@property</span></span></span><span class="hljs-comment"> integer $id * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@property</span></span></span><span class="hljs-comment"> integer $parent_id * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@property</span></span></span><span class="hljs-comment"> string $title * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@property</span></span></span><span class="hljs-comment"> string $description * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@property</span></span></span><span class="hljs-comment"> integer $status */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Category</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CActiveRecord</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> STATUS_PUBLISH = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> STATUS_DRAFT = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Get status list or status label, if key exist * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@static</span></span></span><span class="hljs-comment"> * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $key * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStatusList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($key = null)</span></span></span><span class="hljs-function"> </span></span>{ $arr = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::STATUS_PUBLISH =&gt; <span class="hljs-string"><span class="hljs-string">'Publish'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::STATUS_DRAFT =&gt; <span class="hljs-string"><span class="hljs-string">'Draft'</span></span>, ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $key === <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? $arr : $arr[$key]; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string the associated database table name */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'{{categories}}'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array validation rules for model attributes. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title, status'</span></span>, <span class="hljs-string"><span class="hljs-string">'required'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'length'</span></span>, <span class="hljs-string"><span class="hljs-string">'max'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">150</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'parent_id'</span></span>, <span class="hljs-string"><span class="hljs-string">'exist'</span></span>, <span class="hljs-string"><span class="hljs-string">'className'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">__CLASS__</span></span>, <span class="hljs-string"><span class="hljs-string">'attributeName'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'id'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'description'</span></span>, <span class="hljs-string"><span class="hljs-string">'length'</span></span>, <span class="hljs-string"><span class="hljs-string">'max'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4000</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'status'</span></span>, <span class="hljs-string"><span class="hljs-string">'in'</span></span>, <span class="hljs-string"><span class="hljs-string">'range'</span></span> =&gt; array_keys(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getStatusList())), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title, description'</span></span>, <span class="hljs-string"><span class="hljs-string">'safe'</span></span>, <span class="hljs-string"><span class="hljs-string">'on'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'search'</span></span>) ); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array relational rules. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">relations</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'parent'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::BELONGS_TO, <span class="hljs-keyword"><span class="hljs-keyword">__CLASS__</span></span>, <span class="hljs-string"><span class="hljs-string">'parent_id'</span></span>), ); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array customized attribute labels (name=&gt;label) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attributeLabels</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'ID'</span></span>, <span class="hljs-string"><span class="hljs-string">'parent_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Parent ID'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Title'</span></span>, <span class="hljs-string"><span class="hljs-string">'description'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Description'</span></span>, <span class="hljs-string"><span class="hljs-string">'status'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Status'</span></span>, ); } <span class="hljs-comment"><span class="hljs-comment">/** * Retrieves a list of models based on the current search/filter conditions. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> CActiveDataProvider the data provider that can return the models based on the search/filter conditions. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">search</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $criteria=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CDbCriteria; $criteria-&gt;compare(<span class="hljs-string"><span class="hljs-string">'title'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;title,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $criteria-&gt;compare(<span class="hljs-string"><span class="hljs-string">'description'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;description,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CActiveDataProvider(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'criteria'</span></span>=&gt;$criteria, )); }</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/147491/">https://habr.com/ru/post/147491/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../147486/index.html">Ukrainian team QuadSquad won the Imagine Cup 2012</a></li>
<li><a href="../147487/index.html">Facebook App Center becomes global (in Russia - in a few weeks)</a></li>
<li><a href="../147488/index.html">Eviterra.com: Where to fly cheap or Price Map</a></li>
<li><a href="../147489/index.html">Last.fm lies due to an accident in a datacenter</a></li>
<li><a href="../147490/index.html">Negotiating Instructions</a></li>
<li><a href="../147492/index.html">Space Snake in the Store or How We Put the ‚ÄúCheeseShop‚Äù</a></li>
<li><a href="../147493/index.html">Fulfillment - a catalyst for the growth of regional online sales</a></li>
<li><a href="../147494/index.html">Radio project about SaaS-services (20 gears) + Megaplan mini-series</a></li>
<li><a href="../147495/index.html">We send Nagios notifications to Skype chat</a></li>
<li><a href="../147496/index.html">We invite to August 2 in Kiev for a free seminar on ITIL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>