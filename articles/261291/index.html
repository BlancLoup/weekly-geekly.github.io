<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Entity Framework or Why I Implement Repository</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Abstractions? Who needs abstractions? 
 EF is the coolest ORM from MS. habrahabr.ru/post/157267 is really cool. To develop such a system is very expen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Entity Framework or Why I Implement Repository</h1><div class="post__text post__text-html js-mediator-article">  <b>Abstractions?</b>  <b>Who needs abstractions?</b> <br>  EF is the coolest ORM from MS.  <a href="http://habrahabr.ru/post/157267/">habrahabr.ru/post/157267</a> is really cool.  To develop such a system is very expensive in all areas.  CodeFirs thing, knowledge of database design, but what is there!  No knowledge of SQL itself is needed - and this is awesome.  But is it all rosy? <br>  <b>Julie Lerman</b> can tell a lot <a href="https://msdn.microsoft.com/en-us/magazine/ff898427.aspx">msdn.microsoft.com/en-us/magazine/ff898427.aspx</a> <br><img src="https://habrastorage.org/getpro/habr/post_images/6b5/b23/f5a/6b5b23f5a6170dc1e5d566721087cefc.png" alt="image"><br>  Nothing like? <a name="habracut"></a><br>  This is the implementation of Repository + UoW.  So, using EF, doing all sorts of wrappers is useless? <br>  EF is an incredibly popular technology, it‚Äôs difficult to find the right provider for your storage. <br>  The main idea of ‚Äã‚ÄãEF (like any Repository) is to separate the object layer from the storage layer.  But why? <br>  Everything is simple - to change the storage without pain and the object is independent. <br><h6>  When do I need to change the storage? </h6><br>  I would like to never, but as they say "never say ..".  I am working on a project in which there are two battle layers of the storage and one more demonstration.  The client chooses how he will store his data. <br><h6>  Do I need to build an abstraction on top of the abstraction and do something that is already implemented? </h6><br>  The answer lies in the compatibility of specific providers.  Here's what compatibility says one of the developers of such providers <b>Yevhen Shchyholyev</b> <a href="http://www.infoq.com/articles/multiple-databases">www.infoq.com/articles/multiple-databases</a> .  Problems that were understood at the intuitive level are reinforced by the developers themselves. <br>  Here are some of them <br><h4>  <b>Data types</b> </h4><br><blockquote>  The Entity Framework supports a limited set of .NET types (signed integers, Single, Double, Decimal, String, Byte [], TimeSpan, DateTime, DateTimeOffset, Boolean, Guid).  However, not all .NET types from this list are supported by databases. </blockquote><br>  Types - the eternal problem.  That is, a single script executed on one provider (namely on the provider) may not give the same results on the other. <br><h5>  <b>DateTimeOffset support</b> </h5><br><blockquote>  DataTimeOffset is the most problematic type of .NET.  It is supported in SQL Server MS 2008, Oracle and SQLite, but not in SQL Server MS 2005, MySQL or PostgreSQL, since these databases do not have DateTime, which can save time zone offsets. </blockquote><br>  The problem we have is that the date is stored in UTC, but EF under SQLight persistently returned to Local.  The problem was easily solved, we use Mapping. <br><h5>  <b>Performance</b> </h5><br><blockquote>  If the specific features of a particular database are not taken into account, it is possible that a LINQ query may be processed faster in one database and slower in another. <br>  The pagination of data performed by the LINQ methods .Skip () /. Take () can be one of the most costly operations.  Unlike in SQL Server, Skip / Take, Oracle generates two subquery sorts in an internal subquery that can negatively affect performance.  It should be noted that pagination can be quite inefficient in other databases, especially if the sorting is performed on non-indexable columns. </blockquote><br>  Here is the most interesting, for different providers you need to write your queries on LINQ.  Another interesting scenario: they wrote some functionality with a bunch of requests for the context and everything works fine.  But the application is cross and you need to check how it will work on another provider.  It was found that some of the requests were not effective.  It does not matter - optimization.  All is well.  The question of how optimization has affected the work with the source provider? <br><h5>  <b>Request Restrictions</b> </h5><br><blockquote>  In EF, a developer can generate queries using either LINQ to Entities, or Entity SQL, or a combination of both.  In any case, such a request is converted by the EF mechanism into an intermediate representation as an expression tree and sent to the EF provider so that it generates a SQL query.  Since EF was originally developed for SQL Server, sometimes EF providers have to significantly transform the original expression tree in order to generate the correct SQL for a specific database.  <b>However, this is not always possible</b> . </blockquote><br>  It clearly states <b>mission impossible</b> .  SQL SQLyu provider, provider.  Here even it is not a question that the request will not be effective, but that it can crumble the execution of the application. <br><blockquote>  The corresponding MSDN section says that all these functions are supported by all EF providers: <br>  "This section discusses canonical functions that are supported by all data providers and can be used by all query technologies." <br>  This section seems to be over-optimistic, since different DBMSs have different functionality, and sometimes <b>it‚Äôs impossible to</b> implement all the compatibility features. </blockquote><br>  Here is the <a href="https://msdn.microsoft.com/en-us/library/bb738626(VS.100).aspx">link</a> .  But not anyhow, but the leading developer of a set of third-party providers says <b>mission impossible</b> . <br><h5>  <b>Conclusion</b> </h5><br><blockquote>  In this article I tried to provide a brief description of the most common problems in the development of EF applications for non-Microsoft SQL Server databases.  Undoubtedly, many other aspects did not receive attention in this article ... </blockquote><br>  That is, it is not all the problems that may arise alongside the described ones, and which can only be learned by standing on a rake. <br><h4>  <b>Summing up.</b> </h4><br>  EF is a good abstraction, and like any abstraction, it is not without its main drawback - its implementation.  The problems described in this article are not taken from the head and not from the mouth of skeptics, but from the first hands - the developer of providers. <br>  Providers are developed by different companies and I am sure that if providers from different manufacturers use compatibility problems in one project, there will be much more.  forums.mysql.com/read.php?174,614148,614148 <br>  I am by no means saying <b>NO EF</b> , I say yes to the Repository, because all the problems described are easily circumvented with the help of this abstraction that will wrap the EF and absorb compatibility issues. <br><h4>  <b>PS</b> </h4><br>  Only a technological example is considered, for which it may be necessary to implement the ‚ÄúBicycle‚Äù, the reasons for which it is possible and necessary to use the repository and gadgets are much more. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/261291/">https://habr.com/ru/post/261291/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../261275/index.html">Key trends in the development of mobile applications, which is worth remembering in 2015</a></li>
<li><a href="../261277/index.html">Detailed App Store Optimization Guide for 2015 - Part 2: Google Play Store</a></li>
<li><a href="../261279/index.html">How does the program work with all these errors?</a></li>
<li><a href="../261285/index.html">C ++ User Group, meeting in Nizhny Novgorod</a></li>
<li><a href="../261287/index.html">Everything gets better when there is Bluetooth</a></li>
<li><a href="../261293/index.html">Effective logo design, part 1: symbols, metaphors and intuition capabilities</a></li>
<li><a href="../261295/index.html">Commercial VPN service in opensource</a></li>
<li><a href="../261301/index.html">SSL / TLS traffic analysis in Wireshark</a></li>
<li><a href="../261305/index.html">The digest of interesting materials for the mobile # 109 developer (June 22-28)</a></li>
<li><a href="../261307/index.html">Workers and shared workers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>