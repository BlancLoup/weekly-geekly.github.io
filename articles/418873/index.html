<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Just about the complicated. Part 3, we continue to create a wireless "smart home". Based on Z-Wave technology and MajorDoMo software</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, we continue the first steps to create our own wireless ‚ÄúSmart Home‚Äù based on open source technologies and protocol. On the example of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Just about the complicated. Part 3, we continue to create a wireless "smart home". Based on Z-Wave technology and MajorDoMo software</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/ir/jz/yb/irjzybhkk4nwnyhk-_v-vaqegy0.jpeg"><br>  In this article, we continue the first steps to create our own wireless ‚ÄúSmart Home‚Äù based on open source technologies and protocol.  On the example of connecting one device using Z-Wave technology: the FIBARO Wall Plug Z-Wave smart socket (FGWPF-102_ZW5). <br><br>  The choice was made for the following reason: the device has several functions: it works as a relay and a switch, you can turn on / off both on demand and on schedule, a meter of power consumed at the moment, an electricity meter for a certain period of time. <br><br>  In this part of the manual there will be quite a few pictures (screenshots) and although everything is relatively clear on an intuitive level, I will try to make the description accessible and understandable even for a user who is not very well versed in modern technologies and not an IT specialist. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The principle of this, made it work, rechecked, gave the task with a small instruction to his eldest son to repeat, he had some difficulties, explained, added information to the instruction and made a little explanation. <br><a name="habracut"></a><br>  In the previous parts: <br><br>  ‚Üí <a href="https://habr.com/post/416007/">Part One: A small step-by-step instruction on installing the Smart Home operating system based on the Raspberry single-board computer, Z-Way RaZberry module and MajorDoMo software</a> <br><br>  ‚Üí <a href="https://habr.com/post/416007/">Part Two: continued: Z-Way RaZberry module and MajorDoMo software</a> <br><br>  In previous articles, we installed the Raspbian system with MajorDoMo on the single-board computer Raspberry, installed the RaZbery module for the Z-Way technology.  They registered everything in the ‚ÄúSmart Home‚Äù system.  Requirements for hardware and software are indicated in both the first and second parts. <br>  But after this article, I hope you can start at least a partial automation of your housing. <br><br><h4>  Connecting the first Z-Wave device to the controller </h4><br>  Now we will try to connect a new device, see the capabilities of standard software from the developer of the Z-Wave protocol.  We will receive remote access to the equipment and install the mobile application.  Brief theoretical information will be in italics. <br><br>  The FIBARO Wall Plug Z-Wave (FGWPF-102_ZW5) will be the first managed device.  The choice was also made due to compliance (certification) of this device with the Z-Wave + specification. <br><blockquote>  <i>Compatibility condition is one of the main advantages of Z-Wave technology.</i>  <i>Before going on sale, all devices are certified by Z-Wave at one of their three certificate authorities, where they check the device for compatibility.</i>  <i>More than 150 manufacturers worldwide have chosen Z-Wave as the main protocol for their products.</i>  <i>And they are all compatible with each other within the same region (one frequency range).</i> <i><br></i> </blockquote>  We go to our single-board computer Raspberry by typing its IP address in the address bar of the browser with the Z-Way port <a href="http://192.168.43.60:8083/">http://192.168.43.60:8083</a> . <br><br>  Let me remind at the moment our username admin, the password is the one that was set in the previous part. <br>  As a primary controller, we have a single-board computer Raspberry with the RaZerry module installed. <br><br>  At the entrance, in the device panel (home page) we have almost nothing, only service modules. <br><br><img src="https://habrastorage.org/webt/nb/kf/e5/nbkfe57cwijfhkqn7mjw69bmc0u.png"><br><br>  We enter the expert mode by typing, we see a brief information about the network, the type and number of the controller, the number of devices in the network.  To select a language, use: Settings (gear icon) - Language. <br><br>  Go to the tab Devices - Status: <br>  <a href="http://192.168.43.60:8083/expert">http://192.168.43.60:8083/expert</a> <br><br><img src="https://habrastorage.org/webt/qy/ft/yl/qyftylrz2eya00wm6r4pfuiplq0.png"><br><br>  From the list of devices, we have only one primary controller and little information about its state. <br><br>  A little about the possibilities and terms of the network Z-Way: <br><blockquote>  <i>The primary controller is the network coordinator.</i>  <i>This is the only node capable of including new nodes in the network and excluding existing ones.</i>  <i>It also stores information about the network topology and can update the lists of neighbors for all other (secondary) controllers and generate routes in all the child nodes.</i>  <i>The primary controller can be only one on the network.</i>  <i>Usually, the primary controller is the one that started building the network.</i>  <i>However, in the future, the primary controller may include a new controller in the network, transferring its role to it.</i> <i><br><br></i>  <i>Each Z-Wave network is identified by a unique Network ID (generated when a network is created by a random number generator with radio noise as a source of random numbers or assigned by Sigma Designs for old controllers).</i>  <i>Network ID (also known as Home ID) is a common identifier of all nodes belonging to the same logical Z-Wave network.</i>  <i>The Network ID is 4 bytes long (32 bits) and is assigned to each device through the primary controller when the device is connected to the network.</i>  <i>Multiple Z-Wave networks with different Home IDs can coexist on the same territory.</i>  <i>However, they will not see each other and interact with each other.</i>  <i>and can include up to 232 nodes defined by a device ID (Node ID).</i> <i><br><br></i>  <i>Nodes with different network IDs cannot communicate with each other.</i> <i><br><br></i>  <i>Z-Wave uses a mesh network topology and you can create a network from one managed and one control device.</i>  <i>(What we are doing at the moment).</i>  <i>Additional devices can be added at any time, as well as several controllers.</i> <i><br><br></i>  <i>Devices must be ‚Äúplugged in‚Äù to the Z-Wave network before they can be managed.</i> <i><br><br></i>  <i>Inclusion is done by switching the controller to the special Enable mode (Inclusion mode; usually with a special button in the key or a combination of keys), and the device being switched on into the Learning mode (Learn mode; usually with a single or triple pressing the button).</i>  <i>In this case, the controller and the included device must be in direct view.</i>  <i>Many modern (protocol versions 4.5x or 6.x) devices that are constantly feeding (not sleeping) for the first 3-5 minutes after switching on the power supply themselves switch to a special training mode (Network Wide Inclusion, NWI), if they are not yet included in the network .</i>  <i>In this case, the condition of being in direct visibility is no longer required.</i>  <i>This makes it quite easy to plug new devices into the network without running around the house.</i> <i><br><br></i>  <i>Exclusion from the network is similar: the controller is switched to the Exclusion mode, and the child node is switched to the Training mode.</i>  <i>After exclusion, the Node ID and Home ID of the device will be reset to 0 (for NodeID controllers, it will be reset to 1, and HomeID to factory default).</i>  <i>Most devices will reset all other user settings to their factory defaults.</i> <i><br><br></i>  <i>It is worth noting that the device already registered in one network will not be included in another network.</i>  <i>But any primary controller can be excluded from the network (even the device is not from its network).</i> <i><br><br></i>  <i>This connection process is repeated for each device in the system.</i>  <i>The controller remembers the signal strength of the device during the connection process, so the architecture assumes that the devices must be located in the final location before they are added to the system.</i>  <i>However, Z-Wave involves reconfiguring the network ‚Äî running this procedure on the controller allows you to redistribute routes and improve communication between devices located far from the controller.</i> <br></blockquote>  More detailed information can be viewed by going to the Network tab and selecting Information about the controller. <br><br>  Let's try to add our first device: <br><br>  Go to network management: Network - Management <br><br><img src="https://habrastorage.org/webt/vt/3e/np/vt3enppyzy_8zsxhh_mdntct6zk.png"><br><br>  Included with the smart socket was a small instruction in several languages, including Russian. <br><br>  Quickly familiarizing with it we find out that the process of switching on Inclusion is achieved by quick triple pressing of a button on sockets.  At first we start the Turn on mode on the controller: <b><u>Turn on (anew) the device</u></b> , then quickly press the socket button 3 times. <br><br>  More detailed information about the device, its settings, functions, FIBARO Wall Plug Z-Wave (FGWPF-102_ZW5) can be viewed <br><br>  ‚Üí <a href="https://manuals.fibaro.com/content/manuals/ru/FGWPx-101/FGWPx-101-RU-A-v1.00.pdf">instruction in Russian</a> <br><br>  ‚Üí <a href="https://manuals.fibaro.com/content/manuals/en/FGWPEF-102/FGWPEF-102-EN-A-v2.0.pdf">instruction in English</a> <br><br>  FIBARO Wall Plug Z-Wave connection: <br><br>  Our RaZberry controller supports several frequencies for different regions, at the bottom of the page we see the region switching buttons (EU by default) and a small note: <br>  <i>Current frequency: EU May be unknown, not supported, or another region (EU / US / RU / ....)</i> <i><br><br></i>  <i>Current frequency: EU can be unknown, unsupported or any region (EU / US / RU /....)/</i> <br>  I earned a default on the European frequency.  If your managed Z-wave device is not defined, you can try the frequency sweep. <br><br>  After adding our device was determined: <br><br><img src="https://habrastorage.org/webt/du/vz/rb/duvzrb7hlwbm69r62-5nxhqn4da.png"><br><br>  Going to the device, we can see its properties, version, etc. <br><br><img src="https://habrastorage.org/webt/0w/lg/wg/0wlgwgx-47ctplcjo9eewt0sy6c.png"><br><br>  We go to the main page of our Z-Wave house and see that new labels of our device have been added to the service ones.  <a href="http://192.168.43.60:8083/">http://192.168.43.60:8083</a> <br><br><img src="https://habrastorage.org/webt/cx/fy/vw/cxfyvwhlh_wivdq46wpvszow3r8.png"><br><br>  Going to the <b>Elements</b> tab, in the settings (gear label in the upper right corner) each element can be removed from the main screen.  As a result, I became this kind. <br><br><img src="https://habrastorage.org/webt/fw/oe/dw/fwoedwd71oc6d1erraqxgk9plna.png"><br><br>  After this action, I want to make a small warning before trying something else, try, especially on an intuitive level: <br>  <u><b>Back up the image of your bootable memory card</b></u> , there are a lot of programs on the network, learning to use will not be difficult. <br><br>  It may happen like this: <br><br><img src="https://habrastorage.org/webt/sp/yc/zp/spyczpaix-7xx8cybe4ypsm_2_c.png"><br><br><img src="https://habrastorage.org/webt/m_/dw/pi/m_dwpi09zjuvz3gmlkhlrxjwavo.png"><br><br><h4>  Setting up remote access and the first steps in automation </h4><br>  Set up remote access, to manage our Z-Wave network from a mobile phone: Go to the additional <b>Menu - Control - Remote Access</b> , check the <b>Enable remote access</b> option and remember our ID. <br><br><img src="https://habrastorage.org/webt/zb/tk/qq/zbtkqq5g6_fxt3ggikznja12trg.png"><br>  On the smartphone (on my Android OS) we install the Z-Wave application, there are several applications, I installed the Z-Way (Z-Wave Europe Gmbh). <br><br>  After installing and launching a mobile application, the program offers to log in using a QR code, you can get it <b>Menu - Manage - Devices</b> on your phone‚Äôs tweet - add a new one. <br><br><img src="https://habrastorage.org/webt/wz/km/b-/wzkmb-cnuaqa0jhdgacfoekkg8s.png"><br><br>  But I did not succeed in this way.  Therefore, I will describe an alternative option.  On the phone in the window with the QR code, we press manually: the fields for filling appear, we enter our login (admin), password, and network ID number from the <b>Remote access</b> tab.  There is a connection process, as a result we get to the main page of the application: <br><br><img src="https://habrastorage.org/webt/s7/tb/tj/s7tbtjqxskvv4fur_cy_imptcn0.png"><br><br>  The labels of our devices (elements) are arranged in the same order as in the browser on the main page. <br><br>  Now we can control the device remotely, watch its status. <br><br>  But But management and control is not automation. <br><br>  A little try and customize. <br><br>  Go <b>Menu - Applications - Local</b> : <br><br><img src="https://habrastorage.org/webt/9v/sk/_z/9vsk_zfr_wvnc2gi5xekmohrrpc.png"><br><br>  We can create our schedule, both in time and by day of the week. <br><br><img src="https://habrastorage.org/webt/hq/p5/4u/hqp54uwzadr2ok-yzpik-53jjbi.png"><br><br>  There is also another interesting application <b>If -&gt; Then</b> , with its help we can create algorithms for the operation of devices of our ‚ÄúSmart Home‚Äù. <br><br>  This could be done, but using a little bit like using the Z-Wave device settings in the browser and the mobile application, for me personally I would like more from automation and the list of supported devices. <br><br>  Therefore, in this part we will begin the small setup of MajorDoMo. <br><br>  As in the previous part, we go into our system, this time without specifying the port.  <a href="http://ip_of_your_raspberry/">IP_OF_YOUR_RASPBERRY</a> , go to <b>Control Panel - Devices - Z-Wave</b> . <br><br>  At the moment, our Z-Way controller in the MajorDoMo system is not configured and we do not see its state (offline).  You need to register it by specifying the API URL: and your login and password in the Z-Wave system. <br><br>  From the API documentation, the controller URL itself has the format: http: // {username}: {password} @ {ip}: 8083 / {anyurl} <br><br><img src="https://habrastorage.org/webt/5d/t4/ki/5dt4kip45ccjlki1ba0cmkc-phk.png"><br><br>  The password and login are substituted by the MajorDoMo system, therefore we only write the address with the indication of the page.  By the way, instead of IP, you can specify localhost: 8083 / ... </div><p>Source: <a href="https://habr.com/ru/post/418873/">https://habr.com/ru/post/418873/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../418859/index.html">Some features of PowerShell when working with user accounts</a></li>
<li><a href="../418863/index.html">Understand Render Props with an example</a></li>
<li><a href="../418867/index.html">Dynamic programming in olympiad problems</a></li>
<li><a href="../418869/index.html">Easier than it seems. Chapters 9-10</a></li>
<li><a href="../418871/index.html">Kegel‚Äôs Elvie Smart Trainer for Strengthening Intimate Muscles - Why You Need It</a></li>
<li><a href="../418875/index.html">HP pays up to $ 10,000 for printer bugs, hackers are given remote access</a></li>
<li><a href="../418877/index.html">The role of customer support in game development and its interaction with other departments</a></li>
<li><a href="../418879/index.html">Testing Methods for Crypto Exchanges and Crypto Wallets</a></li>
<li><a href="../418883/index.html">GitLab to NAS</a></li>
<li><a href="../418885/index.html">Crispr can accelerate natural processes and change the way food is grown.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>