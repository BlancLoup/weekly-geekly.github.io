<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Game development under NES in C. Chapters 1-3. From introduction to Hello World</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For the first time I thought about how they develop games for consoles about 20 minutes after the very first time I saw Turbo Pascal. Subor sometimes ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Game development under NES in C. Chapters 1-3. From introduction to Hello World</h1><div class="post__text post__text-html js-mediator-article"><p>  For the first time I thought about how they develop games for consoles about 20 minutes after the very first time I saw Turbo Pascal.  Subor sometimes came across with the keyboard, and the thought appeared: "Probably you can type some program and then play it."  But interest quickly faded out, because absolutely no information on this topic was then available.  The next time the same idea came up when I saw completely playable emulators of old consoles.  Then it became clear that it‚Äôs not necessary to drive a listing into the console itself.  Somewhere very then Habr appeared with a benevolent audience for such things.  At some point, I even began to collect the scattered info to write the manual myself, and today I came across a ready-made textbook, which obviously needs to be translated. </p><br><p>  Development under old consoles is documented up and down, but according to NES, 99% of the information is related to development in Assembler.  For some reason, I was hacked to learn how to work with S. </p><br><p>  <a href="https://habrahabr.ru/post/348212/">next &gt;&gt;&gt;</a> <br><img src="https://habrastorage.org/getpro/habr/post_images/5e2/82a/073/5e282a07309b245eefb9ae2df61e15a7.png" alt="image"></p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Table of contents</b> <div class="spoiler_text"><ol><li>  <a href="https://habrahabr.ru/post/348022/">Where to begin</a> </li><li>  <a href="https://habrahabr.ru/post/348022/">How does cc65 work</a> </li><li>  <a href="https://habrahabr.ru/post/348022/">First program</a> </li><li>  <a href="https://habrahabr.ru/post/348212/">What is V-blank</a> </li><li>  <a href="https://habrahabr.ru/post/348212/">Some color</a> </li><li>  <a href="https://habrahabr.ru/post/348212/">Sprites</a> </li><li>  <a href="https://habrahabr.ru/post/348820/">Input</a> </li><li>  <a href="https://habrahabr.ru/post/348820/">Sprite collisions</a> </li><li>  <a href="https://habrahabr.ru/post/348820/">Work with background</a> </li><li>  <a href="https://habrahabr.ru/post/348820/">Background collisions</a> </li><li>  <a href="https://habrahabr.ru/post/349376/">Scroll</a> </li><li>  <a href="https://habrahabr.ru/post/349376/">Simple platformer</a> </li><li>  <a href="https://habrahabr.ru/post/349376/">Debag and Sprite 0</a> </li><li>  <a href="https://habrahabr.ru/post/349742/">Simple sounds</a> </li><li>  <a href="https://habrahabr.ru/post/349742/">Add music</a> </li><li>  <a href="https://habrahabr.ru/post/349742/">Add sound effects</a> </li><li>  <a href="https://habrahabr.ru/post/350426/">Game planning</a> </li><li>  <a href="https://habrahabr.ru/post/350426/">Coding 1</a> </li><li>  <a href="https://habrahabr.ru/post/350426/">Coding 2</a> </li><li>  <a href="https://habrahabr.ru/post/350426/">Coding 3</a> </li><li>  <a href="https://habrahabr.ru/post/350426/">Thanks</a> </li><li>  <a href="https://habrahabr.ru/post/351034/">What's next?</a> </li><li>  <a href="https://habrahabr.ru/post/351034/">Sounds DMC</a> </li><li>  <a href="https://habrahabr.ru/post/351530/">MMC3, bank switching, interrupts</a> </li></ol></div></div><br><p>  Hello. <br><img src="https://habrastorage.org/getpro/habr/post_images/244/6fd/b6c/2446fdb6c977699f7f67a66c27e47ef5.jpg" alt="image"></p><br><p>  My name is Doug.  I have been writing games for NES for a year now, and decided to start this blog.  I intend to write a NES game development tutorial to inspire other people to make their own games. </p><br><p>  A special feature of the blog will be the use of pure C, so other programmers will be able to start writing quickly and not really delving into the assembler for the 6502 processor. As far as I know, there are no other tutorials of this format on the cc65 compiler, except for a few examples of games on the <a href="https://shiru.untergrund.net/">Shiru</a> website. </p><br><p>  Also remember that I am not a professional neither in development nor in blogging.  If you have questions about the NES, the answers are likely to be found in the <a href="http://wiki.nesdev.com/">wiki</a> . </p><br><p>  I will try to simplify the training as much as possible, and use the simplest examples.  I also recommend starting with the simplest idea of ‚Äã‚Äãthe game.  The reader obviously wants to make a new <a href="https://ru.wikipedia.org/wiki/The_Legend_of_Zelda_(%25D0%25B8%25D0%25B3%25D1%2580%25D0%25B0)">Zelda</a> , but it will not work.  The simplest game will require 2-3 months to develop, Zelda - 2-3 years.  Such a project is likely to be abandoned.  Focus on Pakman, at least the first time. </p><br><h4 id="pamyat-konsoli">  Console memory </h4><br><p>  Let's talk about the structure of memory.  NES has two independent address spaces - processor memory with a range of $ 0- $ FFFF and PPU memory - a video chip. </p><br><p>  Let's start with the processor memory. </p><br><ul><li>  The first $ 800 is RAM. </li><li>  The range of $ 6000- $ 7FFF is used by some games for working with SRAM (saving on a cartridge with a battery), or as an additional Work RAM. </li><li>  ROM is displayed on the space of $ 8000- $ FFFF.  Some mappers (extra processor in a cartridge) can use more than 32k ROM, but they still usually work through $ 8000- $ FFFF. </li><li>  The address $ FFFC- $ FFFD is a reset vector, which indicates the beginning of the program. </li></ul><br><p>  <a href="http://wiki.nesdev.com/w/index.php/CPU_memory_map">Here is</a> more detailed information. </p><br><p>  PPU has its own independent address space.  It is $ 3FFF in size, but is mirrored in some places.  Access to it goes through the registers in the memory of the processor.  Video memory is enough for 4 screen buffers, but in the overwhelming majority of games only 2 are used - for scrolling. </p><br><ul><li>  $ 0- $ 1FFF = Sprites are stored here. </li><li>  $ 2000- $ 23FF = Name Table 0 </li><li>  $ 2400- $ 27FF = Name Table 1 </li><li>  $ 2800- $ 2BFF = Name Table 2 </li><li>  $ 2C00- $ 2FFF = Name Table 3 <br>  At the same time, tables 2 and 3 are a mirror of tables 0 and 1. </li><li>  $ 3F00- $ 3F1F = Palette </li></ul><br><p>  The name table, nametable, links the background tiles and their position on the screen. </p><br><p>  Mirroring allows you to control horizontal or vertical scrolling, but everything has its time. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d6f/68d/6f7/d6f68d6f7f1e05516af8dcae1443bcb9.gif" alt="image"></p><br><p>  Still in PPU there is a separate area of ‚Äã‚Äãmemory OAM, Object Attribute Memory, 256 bytes in size.  Access to it is implemented through registers in the address space of the processor, and it allows you to control the display of sprites. </p><br><p>  Here are the details of PPU memory: <br><a href="http://wiki.nesdev.com/w/index.php/PPU_memory_map"></a>  <a href="http://wiki.nesdev.com/w/index.php/PPU_memory_map">http://wiki.nesdev.com/w/index.php/PPU_memory_map</a> </p><br><p>  One more thing.  There are two types of cartridges.  In some, two ROM chips - PRG-ROM with executable code and CHR-ROM with graphics.  In this case, the schedule is automatically displayed in the addresses $ 0-1FFF PPU.  This makes it very easy to draw - just write the tile number in the table.  We will use this format. </p><br><p>  Another type of cartridge uses CHR-RAM instead of CHR-ROM.  This allows you to load a part of the graphics into this additional RAM.  This is a complex technique and is not covered in this tutorial. </p><br><p>  Now you can look at the software used for development. </p><br><ul><li>  Compiler </li><li>  Tile editor </li><li>  Graphics editor </li><li>  Notepad ++ </li><li>  Good emulator </li><li>  Tile wrapper </li></ul><br><p>  In this tutorial only <a href="http://cc65.github.io/cc65/">cc65 is</a> considered.  This is one of the best compilers for 6502, NES processor. </p><br><p>  I am using version 2.15 (for verification, type 'cc65 --version' in the console).  Files from different versions are incompatible, so if necessary use nes.lib from your compiler kit. </p><br><p>  Secondly, you need to create graphics.  I use <a href="http://www.romhacking.net/utilities/119/">YY-CHR</a> </p><br><p>  To pre-process graphics you need any graphics editor: Photoshop or GIMP, to your liking. </p><br><p>  It is convenient to write the code in <a href="https://notepad-plus-plus.org/download/">Notepad ++</a> .  It has highlighting of syntax and line numbering - this makes debugging easier. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/38e/5d8/291/38e5d82916a50efd354272e6a6ba3535.png" alt="image"></p><br><p>  And now the emulator.  I use FCEUX 90% of the time, because it has cool debugger and memory tools, sprite viewers and all that.  But it is not the most accurate in emulation.  Games need to be tested somewhere else.  Judging by the reviews, the most accurate emulators are Nintendulator, Nestopia, and puNES.  It is also desirable to load a more accurate palette - is <a href="">here</a> . </p><br><p>  There are two versions of FCEUX - SDL and Win32.  The first works almost everywhere, the second only in Windows.  So, the debugger is only in the second.  So in the case of an alternative OS, you will have to use Virtualka or Wine. </p><br><p>  And finally tile arranger.  We can make a game without him, but he will definitely help.  I recommend the <a href="https://shiru.untergrund.net/software.shtml">NES Screen Tool</a> .  It perfectly shows the limitations of the console by color and is great for single-screen games.  For games with scrolling, <a href="http://www.mapeditor.org/">Tiled map editor is</a> better suited. </p><br><p>  How to use all this? </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/317/cc1/c06/317cc1c06c80828185de4b511bd9e18f.png" alt="image"></p><br><p>  It is necessary to compress the image to an adequate size, for example 128 pixels wide.  Then convert to 4 colors and correct if necessary flaws.  Now you can copy-paste to YY-CHR. </p><br><p>  In YY-CHR, you need to check that the color is two-bit. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/fc5/0cb/6b8/fc50cb6b8b9c115adc940302f6466337.png" alt="image"></p><br><p>  The palette does not matter now, because it is still set elsewhere. </p><br><h4 id="kak-rabotaet-ss65">  How does ss65 work </h4><br><p>  All compilers for NES work through the console, without a graphical interface.  That is, we write the program in Notepad, and then we call the compiler with the necessary parameters. </p><br><p>  To simplify the work, we will use .bat scripts and Makefiles.  This will automate the process and collect the image of the cartridge in one touch. </p><br><p> The process is approximately the same.  cc65 compiles a file with a code on C in the assembly code.  ca65 collects the object file.  ld65 links it to an .nes cartridge image that can be run in an emulator.  Settings are stored in a .cfg file. </p><br><p>  The console uses an 8-bit MOS 6502 processor. It does not know how to simply access variables larger than 8 bits.  16-bit addressing, from mathematics there is only addition, subtraction and bit shifts.  So the code will have to write with these factors. </p><br><ul><li>  Most variables must be of type unsigned char - 8 bits, values ‚Äã‚Äã0-255 </li><li>  It is better not to pass the values ‚Äã‚Äãin the function, or do it through the fastcall directive, which passes arguments through 3 registers - A, X, Y </li><li>  Arrays should not be longer than 256 bytes </li><li>  printf is missing </li><li>  ++ g is noticeably faster than g ++ </li><li>  cc65 can neither pass structures by value nor return them from a function </li><li>  Global variables are much faster than local variables, even structures </li></ul><br><p>  Use the -O option to optimize.  There are also options i, r, s, which sometimes combine in -Oirs, but they, for example, can remove a read from a processor register whose value is not used.  And this is fatal. </p><br><p>  <a href="http://www.cc65.org/doc/coding.html">Here are some more recommendations</a> for using the compiler. </p><br><p>  Optimization is vital, because an 8-bit processor has very few resources, and in some cases it is necessary to monitor the execution time of the code.  And the usual C code does not meet these requirements. </p><br><p>  Import of variables from other files is supported.  cc65 can import variables and arrays from assembler modules with the command </p><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> foo;</code> </pre> <br><p>  and if it is a character from a zero page of memory, then add a directive </p><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> zpsym (‚Äúfoo‚Äù);</span></span></code> </pre> <br><p>  In the future, these designs will be rarely used.  The only exception is the import of a large binary file.  In this case, it would be optimal to wrap it in an assembly file: </p><br><pre> <code class="hljs css"><span class="hljs-selector-class"><span class="hljs-selector-class">.export</span></span> _<span class="hljs-selector-tag"><span class="hljs-selector-tag">foo</span></span> _<span class="hljs-selector-tag"><span class="hljs-selector-tag">foo</span></span>: <span class="hljs-selector-class"><span class="hljs-selector-class">.incbin</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">foo</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.bin</span></span>"</code> </pre> <br><p>  and then import into C as </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> foo[];</code> </pre> <br><p>  The _ sign is critical here, because when compiled into the assembler code, cc65 adds _ in front of each variable name.  We need to match this. </p><br><p>  You can call functions written in assembler via __fastcall__.  In this case, the arguments are passed to the function through the registers, and not the stack - it saves time.  In some cases, it is impossible to do without assembly code, for example, when initializing a set-top box.  In any case, the fewer arguments passed to the function, the better.  Compare two functions, with the test and A global variables: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> A)</span></span></span><span class="hljs-function"> </span></span>{ test = A; } <span class="hljs-comment"><span class="hljs-comment">//       19  </span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">_Test</b> <div class="spoiler_text"><pre> <code class="hljs mel">jsr pusha ldy #$00 lda (sp),y sta _test ; test = A; jmp incsp1 pusha: ldy sp beq @L1 dec sp ldy #<span class="hljs-number"><span class="hljs-number">0</span></span> sta (sp),y rts @L1: dec sp+<span class="hljs-number"><span class="hljs-number">1</span></span> dec sp sta (sp),y rts incsp1: inc sp bne @L1 inc sp+<span class="hljs-number"><span class="hljs-number">1</span></span> @L1: rts</code> </pre></div></div><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ test = A; } <span class="hljs-comment"><span class="hljs-comment">//   ,   3 </span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">_Test</b> <div class="spoiler_text"><pre> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">lda</span></span> _A sta _test rts</code> </pre> </div></div><br><p>  You can also insert assembly code directly into sishny.  I almost never do that, but it‚Äôs probably necessary sometimes.  It looks like this: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">asm</span></span> (<span class="hljs-string"><span class="hljs-string">"Z: bit $2002"</span></span>) ; <span class="hljs-keyword"><span class="hljs-keyword">asm</span></span> (<span class="hljs-string"><span class="hljs-string">"bpl Z"</span></span>) ;</code> </pre> <br><p>  In addition, I replaced the bulky crt0.s initialization code with a compact reset.s, and corrected the configuration for all of this.  These files will sometimes change.  nes.lib is used standard from the compiler.  The project is built with the option ‚Äìadd-source, which does not delete intermediate assembly files - you can examine the generated code. </p><br><p>  It is more convenient to define variables in the sish code, and then import them into assembly code through </p><br><pre> <code class="hljs haskell">.<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> _Foo</code> </pre> <br><p>  But this is a question of taste, in my opinion, such code is more obvious. </p><br><h4 id="hello-world">  Hello world </h4><br><p>  This program will simply print text on the screen.  It must be remembered that the prefix does not know about ASCII encoding and working with text in any form.  But it is possible to display 8x8 images on top of the background. </p><br><p>  So we make an array of sprite letters, so that the addresses of the letters in it correspond to their ASCII codes.  Then they can be pulled from the code in C. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ee0/aad/6c2/ee0aad6c21cc96ab27139c9ff8040afe.png" alt="image"></p><br><p>  The prefix initialization code is taken as it is, after its execution, the transition to main () takes place. </p><br><p>  We need to do the following operations: </p><br><ul><li>  Turn off the screen </li><li>  Customize palette </li><li>  Print the cherished words </li><li>  Turn off scrolling </li><li>  Turn on screen </li><li>  Repeat </li></ul><br><p>  Turning off the screen is necessary because working with video memory causes garbage on the screen.  It is necessary either to turn off the screen, or to wait for a personnel blanking impulse (V-Blank).  We will consider this question in detail next time. </p><br><p>  The initialization code fills the memory with zeros, so the entire screen will be filled with zero tile - in our case, it is empty.  And the whole palette is filled with gray. </p><br><p>  To display on the screen, you need to record the coordinates of the start of the fill starting from the high byte at $ 2006, and then write the tile numbers to $ 2007.  PPU will display tiles with the corresponding numbers one by one, with the transition to a new line.  You can reconfigure the PPU in an output step equal to 32 - the tiles will be displayed one below the other.  We also need to set up step 1, through the register $ 2000.  You can recalculate the coordinates of the screen to the address through the NES screen tool. </p><br><p>  We also need to fill the first 4 colors of the palette - they are responsible for the background.  They are written at $ 3F00. </p><br><p>  Writing to the PPU registers breaks the scroll position, so it must also be reset.  Otherwise, the picture may leave the screen.  We do this through the $ 2006 and $ 2005 registers. </p><br><div class="spoiler">  <b class="spoiler_title">lesson1.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PPU_CTRL *((unsigned char*)0x2000) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PPU_MASK *((unsigned char*)0x2001) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PPU_STATUS *((unsigned char*)0x2002) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> SCROLL *((unsigned char*)0x2005) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PPU_ADDRESS *((unsigned char*)0x2006) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PPU_DATA *((unsigned char*)0x2007) unsigned char index; const unsigned char TEXT[]={ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Hello World!"</span></span></span><span class="hljs-meta">}; const unsigned char PALETTE[]={ 0x1f, 0x00, 0x10, 0x20 }; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//black, gray, lt gray, white void main (void) { // turn off the screen PPU_CTRL = 0; PPU_MASK = 0; // load the palette PPU_ADDRESS = 0x3f; // set an address in the PPU of 0x3f00 PPU_ADDRESS = 0x00; for(index = 0; index &lt; sizeof(PALETTE); ++index){ PPU_DATA = PALETTE[index]; } // load the text PPU_ADDRESS = 0x21; // set an address in the PPU of 0x21ca PPU_ADDRESS = 0xca; // about the middle of the screen for( index = 0; index &lt; sizeof(TEXT); ++index ){ PPU_DATA = TEXT[index]; } // reset the scroll position PPU_ADDRESS = 0; PPU_ADDRESS = 0; SCROLL = 0; SCROLL = 0; // turn on screen PPU_CTRL = 0x90; // NMI on PPU_MASK = 0x1e; // screen on // infinite loop while (1); }</span></span></span></span></code> </pre></div></div><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0da/97d/728/0da97d72846b95f0aa3958e576c58a2a.png" alt="image"></p><br><p>  Link to code: </p><br><p>  <a href="">Dropbox</a> <br>  <a href="https://github.com/BubaVV/nesdoug">Github</a> <br>  On Gitkhab, I just fixed the Makefile to work correctly under Windows. </p><br><p>  Line <br> <code>ONCE: load = PRG, type = ro, optional = yes;</code> <br>  inside the segments {} section of the .cfg files is needed for compatibility with the latest version of cc65. </p><br><p>  Turning on the screen via ‚ÄúPPUMASK = 0x1e‚Äù is described in the <a href="http://wiki.nesdev.com/w/index.php/PPU_registers">Wiki</a> . </p><br><p>  All files here are 0x4000.  This is the smallest possible size of PRG ROM.  90% of games here do not fit, and will be displayed on the addresses of $ 8000- $ FFFF.  In our country, the game is loaded into $ C000- $ FFFF addresses and mirrored to $ 8000- $ BFFF.  To develop a larger game, you will need to reconfigure the start address of the ROM to $ 8,000, and set the size to $ 8,000 too.  And also include the second bank of the PRG ROM in the header section. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/348022/">https://habr.com/ru/post/348022/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../348012/index.html">As I measured the quality of technical support work</a></li>
<li><a href="../348014/index.html">Blockchain: features, structure, EDS and task for a student, part 1</a></li>
<li><a href="../348016/index.html">And so it will come down ... or the Hole as a means of protection</a></li>
<li><a href="../348018/index.html">Even in Java 9, ArrayList can still (and should) be improved.</a></li>
<li><a href="../348020/index.html">Blockchain: Networking, Signature Verification and Student Assignment, Part 2</a></li>
<li><a href="../348024/index.html">SecurityWeek 2: army of clones, Google hunts for ghosts, Blizzard patches</a></li>
<li><a href="../348026/index.html">Installing Linux without .ISO and virtualization</a></li>
<li><a href="../348028/index.html">Convolutional neural network, part 2: training in the error back-propagation algorithm</a></li>
<li><a href="../348032/index.html">Mobility Express - when they decided to migrate and scale the wireless network, but as always, there is no money</a></li>
<li><a href="../348034/index.html">Meeting Room Little Helper</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>