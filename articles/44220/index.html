<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing Debian Lenny on Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Well, Android came out and even the source code was posted. And we got the first Android-powered device. What we really didn‚Äôt have was the change of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing Debian Lenny on Android</h1><div class="post__text post__text-html js-mediator-article"><img src="http://ironphone.ru/wp-content/uploads/2008/11/debian.jpg" alt="image" align="left">  Well, Android came out and even the source code was posted.  And we got the first Android-powered device.  What we really didn‚Äôt have was the change of game in which we would suddenly get control of our phones.  You remember what Google promised us last year. <br>  The reality is that even Google cannot influence the world of mobile devices.  Those who have already received their G1 and managed to play with it for some time were upset by the fact that we are still just ordinary users on our phone: T-Mobile did not allow us to use the root user, fearing how we would do something . <br><br>  If you want to try this instruction in action, consider that everything you do, you do at your own peril and risk. <br><a name="habracut"></a><br>  <b>Getting super user permissions (root) / Jailbreaking</b> <br><br>  For me, restrictions of this kind turn the device into nothing more than a toy: those who watched my adventures in the iPhone world know that I consider it a shame to wear a phone with a high-speed ARM processor running a modern operating system, a large screen with numerous ways control / input, just to use it as a regular cell phone. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Fortunately, this changed a few days ago, when someone found a serious vulnerability in the Android firmware.  You could get privileged rights.  Just typing telnetd in the console and connecting using the telnet client you get root. <br><br>  Unfortunately, it is still difficult to do something worthwhile with the help of Google's replacement of the busybox - toolbox.  What we need is a complete unix environment.  This phone is powerful enough, even to develop applications directly on it. <br><br>  <b>Installing Debian ARMEL</b> <br><br>  There have already been several attempts to install busybox on Android.  I think that we can go further, and with the help of this instruction, install the full Debian distribution, one of the highly respected Linux distributions that allows you to install everything you want. <br>  To do this, we need to think through several issues related to G1.  First, where do we keep it?  The phone has built-in flash memory, but there is only 128MB for the operating system and other applications. <br><br>  Therefore, we drew attention to the more capacious part of the phone - a microSD card, which allows you to store up to 16GB of data.  Unfortunately, to be able to read it by all card readers, this card has a FAT file system, which is useless for storing Unix programs and data. <br>  But what we came up with is that we can store a Debian image on a memory card and then just mount it. <br><br>  After reviewing the contents of / proc / filesystems, we can see all the types of file systems that we can use: vfat, yaffs, yaffs2.  On T-Mobile, only the minimum part of the drivers for the file systems necessary for the functioning of Android is installed.  This means that we need to load a driver that would allow us to mount our image, since the kernel is built with the support of the modules. <br><br>  If necessary, I can write a manual, because I collect modules for G1.  I encourage people who are committed to discussing G1 development / modification topics.  For a discussion, you can subscribe to <a href="http://www.telesphoreo.org/cgi-bin/mailman/listinfo/g1-hackers">the G1-Hackers mailing list</a> that I keep on Telesphoreo. <br>  I also support IRC on irc.saurik.com (the same server that hosts the Phone oriented channels) on the #android channel, along with several other interested people. <br><br>  <b>Creating a Debian Disk Image</b> <br><br>  So, stop talking, let's get started!  First, we will need a Debian file system image, which we will place on the phone's memory card.  To create it, we can use an existing Debian system.  Fortunately, Debian already has <a href="http://wiki.debian.org/ArmEabiPort">full support for ARM EABI</a> and even has <a href="http://wiki.debian.org/ArmEabiHowto">useful instructions on</a> how to install. <br><br>  For people who have no desire to mess with the creation of the image, I have already created a 750MB ready, you can download the <a href="">full image</a> here (RapidShare).  This image was packaged with bzip2 and takes ~ 85MB. <br><br>  RapidShare is a rather slow server, so the guys from <a href="http://modmygphone.com/">modmyGphone.com</a> put a mirror of the image on their servers.  Details can be read <a href="http://modmygphone.com/forums/showthread.php%3Ft%3D5191">here</a> . <br><br>  If you want to create an image yourself (maybe you need a different file system size for debian other than 750MB, or just want to control the whole process), this can be done using the following commands: <br><br> <code><a href="http://ftp.de.debian.org/debian"></a> apt-get install debootstrap <br> dd if=/dev/zero of=debian.img seek=749999999 bs=1 count=1 <br> mke2fs -F debian.img <br> mkdir debian <br> mount -o loop debian.img debian <br> debootstrap --verbose --arch armel --foreign lenny debian ftp.de.debian.org/debian <br> umount debian</code> <br> <br>  <b>Build our tool kit (kit) for debian</b> <br><br>  Now we have the image of the debian, we need to copy it to the memory card.  Also there you need to copy additional files.  One important point of this step is that you need to install the driver corresponding to the firmware you are using. <br><br>  * ext2.ko ( <a href="">RC19</a> ) ( <a href="">RC29 / 30</a> ) - standard Linux file system module <br>  * unionfs.ko ( <a href="">RC19</a> ) ( <a href="">RC29 / 30</a> ) - allows you to merge folders (advanced) <br>  * <a href="http://cache.saurik.com/android/armel/busybox">busybox</a> - a set of system utilities <br><br>  Copy this all (and debian.img) to a folder on a microSD memory card (I used a USB connection, which is simpler and faster than the others).  If you downloaded the finished image, it makes sense to rename it to debian.img, so that it would be easier to use it later. <br><br>  <b>Install and mount</b> <br><br>  Where is it better for us to put it all?  I copied the tool kit (kit) to the root directory of the microSD card and put everything else in / data / local (a very useful folder in which you can normally write). <br><br>  We export paths in order to not be able to type constantly long paths.  It also allows this instruction to look semantically much easier to read. <br><br> <code>export kit=/sdcard/kit <br> export bin=/data/local/bin <br> export mnt=/data/local/mnt</code> <br> <br>  Next you need to export a few more paths, they will need programs that we will use in the future.  This will save time when loading the driver for ext2.  It may look strange (at least the HOME variable), but if we don‚Äôt ask them later, major problems may arise. <br><br> <code>export PATH=$bin:/usr/bin:/usr/sbin:/bin:$PATH <br> export TERM=linux <br> export HOME=/root <br> <br> insmod $kit/ext2.ko</code> <br> <br>  The next step is to copy somewhere to busybox for future use.  Since G1 does not contain the cp command, we will use cat for this.  Note, the mkdir command does not have the -p option (since the toolbox does not support it), so if you select a directory with a lot of nesting (or an existing one) you will have to ignore some errors or solve them differently. <br><br> <code>mkdir $bin #-p <br> cat $kit/busybox &gt;$bin/busybox <br> chmod 755 $bin/busybox</code> <br> <br>  busybox is installed, now we can use it to create a device node for the loopback driver.  We need busybox, since G1 does not contain the mknod utility, which will be needed to create the node.  We will also create aliases (short names) for busybox to make it easier to type commands. <br><br> <code>alias _=busybox <br> _ mknod /dev/loop0 b 7 0</code> <br> <br>  If you get an error at startup: _ not found, just try resetting it: <br><br> <code>unalias _ <br> alias _=busybox</code> <br> <br>  Finally that loopback device is created, we can plug in a debian image!  Note, as the name of the debian.img image, use the name of your image if it is different. <br><br> <code>_ mkdir -p $mnt <br> _ mount -o loop $kit/debian.img $mnt</code> <br> <br>  There can be several major errors: if the error / etc / fstab, then apparently the $ kit / debian.img file does not exist, or the $ mnt variable may not be set. <br><br>  <b>Final installation step</b> <br><br>  At this stage, we have to finish what debootstrap can't do.  First, you need to run several scripts and fix the URLs to the Debian repositories (for some reason, debootstrap confuses them, for some unknown reason).  If you have already downloaded the finished image, then you do not need to do these two commands. <br> <code><a href="http://ftp.de.debian.org/debian"></a> _ chroot $mnt /debootstrap/debootstrap --second-stage <br> echo 'deb ftp.de.debian.org/debian lenny main' &gt;$mnt/etc/apt/sources.list</code> <br> <br>  After these commands are executed (it may take almost 10 minutes), we can change the environment to debian using the chroot command.  We get a shell and a complete debian environment, with all the cool things that we can do.  This command is performed by everyone, even those who downloaded the finished image. <br><br> <code>_ chroot $mnt /bin/bash</code> <br> <br>  Next we connect the file systems devpts, proc and sysfs to our environment. <br><br> <code>mount -t devpts devpts /dev/pts <br> mount -t proc proc /proc <br> mount -t sysfs sysfs /sys</code> <br> <br>  It is also necessary to set a password for the root user, so that we can remotely connect to the phone. <br><br> <code>passwd root</code> <br> <br>  <b>Install OpenSSH</b> <br><br>  This is where the power of debian is shown: quick installation of new programs on the phone.  Well, let's install an SSH server in order to get a full-fledged console. <br>  For this we will use APT (package management system in Debian).  The first command to update information about packages in the repositories and install updates.  The second will install the actual ssh server itself. <br> <code>apt-get update <br> apt-get install openssh-server <br></code> <br>  If you later want to start OpenSSH again (since the normal debian start is not used), you can do this with the following command (or using ‚Äúrestart‚Äù instead of ‚Äústart‚Äù). <br><br> <code>/etc/init.d/ssh start <br></code> <br><br>  <b>What next?</b> <br><br>  Have fun!  The first thing I did was install subversion, gcc and vim so that I could start developing.  I repeat, people who want to learn more about the insides of Android (kernel drivers, access to hardware, the process of flashing) can join the <a href="http://www.telesphoreo.org/cgi-bin/mailman/listinfo/g1-hackers">G1-Hackers mailing list</a> . <br><br>  After you restart the phone you will need to run, if not all, then most of these commands again.  For those who used the same ways as me, they can use scripts for reconnection ( <a href="">script</a> ). <br><br>  It is also worth mentioning that while the image is mounted, Android will not be available via USB cable.  To do this, you need to unmount all that was mounted before <br><br> <code>_ umount $mnt/dev/pts $mnt/proc $mnt/sys $mnt</code> <br> <br>  Although Android comes with a umount unmount utility, which works as if normal, but nevertheless it leaves a loopback device that will continue to block the microSD card for USB connection.  You can delete it manually using the following command: <br><br> <code>_ losetup -d /dev/loop0</code> <br> <br>  <b>Running Debian on /</b> <br><br>  Most of all in this process grieves that we have to choose between android and debian.  This is where unionfs comes to the rescue. <br><br>  Note, all subsequent commands must be executed outside the debian environment.  For this you need to dial in the current telnet session: <br> <code>exit</code> <br> <br>  or open another session.  All commands can be downloaded as a <a href="">ready-made script</a> . <br>  To run this script, you must already have exported all the standard variables.  If you copied the script in $ kit, then you can execute it with the following command. <br><br> <code>. $kit/unionfs.sh</code> <br> <br>  You can install this script using wget: <br><br> <code><a href=""></a> _ chroot $mnt wget -O /tmp/unionfs.sh cache.saurik.com/android/script/unionfs.sh <br> cat $mnt/tmp/unionfs.sh &gt;$kit/unionfs.sh <br> rm $mnt/tmp/unionfs.sh <br></code> <br><br>  For those who did not use a ready-made script: <br><br> <code>insmod $kit/unionfs.ko <br> mount -t unionfs -o dirs=$mnt/etc=rw:/etc=ro unionfs /etc</code> <br> <br>  Now we have / etc contains files from Android and Debian.  When changing / creating files in / etc, all modifications will be stored in the Debian partition - this allows us to get full access to / etc! <br><br>  The next problem is that Android and Linux use different naming conventions for their dynamic linker.  For Android, we have / system / bin / linker, and for Linux, we have /lib/ld-linux.so.3.  This means that we get an error file not found when running running programs.  This is easy to fix with symbolic links. <br><br> <code>_ mount -o remount,rw / <br> _ ln -s $mnt/lib /</code> <br> <br>  At first glance it may look dangerous, but it is not.  When changing the phone's root file system, this will be the change in ‚Äúrootfs‚Äù: a special state of Linux ramfs (file system in memory).  This means that any changes that we make, after restarting the phone, will disappear. <br><br>  Now we can run most Debian programs without chroot, simply by running programs from $ mnt.  Unfortunately, not everything will work, since most of the files are not where they should be.  Let's fix this with symbolic links. <br><br> <code>for x in <br> bin boot home media mnt <br> opt selinux srv usr var <br> do <br> _ ln -s $mnt/$x / <br> done <br></code> <br>  There are still a few directories that need to be fixed.  The first: / root is empty, so we can replace it with a link.  Since we‚Äôve finished changing the files to /, I strongly recommend that you reinstall the root / to read-only mode. <br><br> <code>rmdir /root <br> _ ln -s $mnt/root / <br> _ mount -o remount,ro / <br></code> <br>  There are still two / sbin and / dev.  There is no big catch with / dev.  Since / dev / pts is mounted inside this folder, it cannot be merged using unionfs.  To solve this problem, simply mount / dev / pts over unionfs: <br><br> <code>mount -t unionfs -o dirs=$mnt/sbin=rw:/sbin=ro unionfs /sbin <br> mount -t unionfs -o dirs=$mnt/dev=rw:/dev=rw unionfs /dev <br> mount -t devpts devpts /dev/pts</code> <br> <br>  Everything is ready for us, even for such programs as openssh to work correctly, restart the service: <br><br> <code>/etc/init.d/ssh restart</code> <br> <br>  <b>Finally</b> <br><br>  It all looks good, but there are still a few problems to note: <br>  First, it is not yet clear where user names and authentication information are stored.  If you look at file owners with ls, which is part of debian, you will notice that they are not there. <br><br>  The second, using the symlink for /, instead of using chroot (so far it has not been possible to transparently load all services) means that any package attempting to add the directory to / will fail.  To install programs via apt-get will have to use chroot. <br><br>  And lastly, the RC30 update will be released soon, after which jailbreak via Telnetd will no longer work.  So while not playing enough, do not install it. <br>  (I hope I understand why the telephone companies love to sell us devices that are purposely limited in functionality. Does this improve their business?) <br><br>  If you find inconsistencies or any other errors in the article, please report. <br>  The article with the translation is also posted by <a href="http://ironphone.ru/android-jail/1772/">ironphone.ru</a> </div><p>Source: <a href="https://habr.com/ru/post/44220/">https://habr.com/ru/post/44220/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442188/index.html">Then finish it. Chapter 1, in which it all begins (and, very bad)</a></li>
<li><a href="../442190/index.html">SketchUp extension (plug-in) for furniture designing by a programmer</a></li>
<li><a href="../442192/index.html">‚ÄúReverse Engineering‚Äù of the ‚ÄúGrozny‚Äù apparatus from Jules Verne‚Äôs novel ‚ÄúThe Lord of the World‚Äù</a></li>
<li><a href="../442194/index.html">Russians will give money for IT-training</a></li>
<li><a href="../442196/index.html">8 mistakes in the pronunciation of English sounds, which makes the majority of Russian speakers</a></li>
<li><a href="../442200/index.html">Moonlight mission "Bereshit" - engineers at the SpaceIL and Israel Aerospace Industries (IAI) MCC solved problems</a></li>
<li><a href="../442202/index.html">Mailing Push Notifications with SpringBoot Server</a></li>
<li><a href="../442204/index.html">Laptop Compaq LTE 5000, part one - acquaintance</a></li>
<li><a href="../442206/index.html">Preparations for the inspection of Roskomnadzor: a harsh practice for the brave</a></li>
<li><a href="../442208/index.html">Posting typos in publications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>