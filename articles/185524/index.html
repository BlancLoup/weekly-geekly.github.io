<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Happstack Lite: Haskell Web Framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Picture to attract attention, clckwrks is a web framework closely related to Happstack. 

 Happstack is a great- powered web framework with a rich API...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Happstack Lite: Haskell Web Framework</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/4c9/062/711/4c90627110d5368928575fe437932124.jpg" alt="image"><br>  <i>Picture to attract attention, clckwrks is a web framework closely related to Happstack.</i> <br><br>  <a href="http://happstack.com/">Happstack</a> is a great- <a href="http://happstack.com/">powered</a> web framework with a rich API that has evolved over the past seven years to meet the needs of everyday web development.  Unfortunately, a rich and flexible API can be useless and confusing when you need something simple.  However, many do not realize that under the wing of Happstack lies a very elegant and easy-to-use web framework Happstack Lite. <br><br><a name="habracut"></a><br><h4>  Foreword </h4><br>  Happstack Lite is a simple and easy-to-use version of Happstack.  To create it, the developers: <br><ol><li> We collected all the main types and functions that you need to develop a web application in a single <code>Happstack.Lite</code> module, so you don‚Äôt need to search the modules for what you need. </li><li>  They gave functions much simpler signatures, eliminating monad transformers and getting rid of most types of types. </li><li>  We created this tutorial, which in less than 2000 words describes all the basic things you need to know in order to start writing a web application. </li></ol><br>  But most importantly, Happstack Lite is almost completely compatible with Happstack!  If you are developing an app on Happstack Lite, and you need an advanced feature from Happstack, you can simply import the appropriate module and use it. <br>  To translate a project from Happstack Lite to a regular one, you need to make only 4 small changes: <br><ol><li>  <code>import Happstack.Lite</code> to replace <code>import Happstack.Server</code> </li><li>  <code>serve Nothing</code> to replace with <code>simpleHTTP nullConf</code> </li><li>  add <code>import Control.Monad (msum)</code> </li><li>  add explicit <code>decodeBody</code> call ( <a href="http://www.happstack.com/docs/crashcourse/RqData.html">details</a> ) </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      While Happstack Lite is lightweight compared to regular Happtsack, it still is a full-featured framework along with other Haskele web frameworks. <br><br>  In order to simplify the developers have abandoned the use of some of the advanced libraries that work with Happstack.  If you are interested in a framework with type-safe URLs, type-safe forms, HTML syntax in literals and many others, then perhaps you should consider the Happstack Foundation.  The learning curve is higher, but the additional reliability is worth it.  Since these libraries are built on top of the Happstack kernel, the material studied in this tutorial will also be useful in their use. <br><br>  For more in-depth information, you can read the <a href="http://www.happstack.com/docs/crashcourse/index.html">Happstack Crash Course</a> ( <i>which I will also translate if interest is shown in this article - note. Lane.</i> ) <br><br><h4>  Server startup </h4><br>  First we need a couple of language extensions: <br><pre> <code class="haskell hljs"><span class="hljs-meta"><span class="hljs-meta">{-# LANGUAGE OverloadedStrings, ScopedTypeVariables #-}</span></span></code> </pre> <br>  Now let's connect some libraries: <br><pre> <code class="haskell hljs"><span class="hljs-keyword"><span class="hljs-keyword">module</span></span> Main <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Control.Applicative ((&lt;$&gt;), optional) <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Data.Maybe (<span class="hljs-title"><span class="hljs-title">fromMaybe</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Data.Text (<span class="hljs-type"><span class="hljs-type">Text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Data.Text.Lazy (<span class="hljs-title"><span class="hljs-title">unpack</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Happstack.Lite <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Text.Blaze.Html5 (<span class="hljs-type"><span class="hljs-type">Html</span></span>, (!), a, form, input, p, toHtml, label) <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Text.Blaze.Html5.Attributes (<span class="hljs-title"><span class="hljs-title">action</span></span>, <span class="hljs-title"><span class="hljs-title">enctype</span></span>, <span class="hljs-title"><span class="hljs-title">href</span></span>, <span class="hljs-title"><span class="hljs-title">name</span></span>, <span class="hljs-title"><span class="hljs-title">size</span></span>, <span class="hljs-title"><span class="hljs-title">type_</span></span>, <span class="hljs-title"><span class="hljs-title">value</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">qualified</span></span> Text.Blaze.Html5 <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> H <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">qualified</span></span> Text.Blaze.Html5.Attributes <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> A</code> </pre><br>  To start the application, we call the <code>serve</code> function.  The first argument is the configuration; it is optional.  The second argument is our web application itself. <br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">main</span></span> :: <span class="hljs-type"><span class="hljs-type">IO</span></span> () main = serve <span class="hljs-type"><span class="hljs-type">Nothing</span></span> myApp</code> </pre><br>  The web application is of the <code>ServerPart Response</code> type.  You can consider <code>ServerPart</code> web equivalent of an <code>IO</code> monad. <br><br>  ( <i>The default port is 8000, that is, you can see your application at <a href="http://localhost:8000/">http: // localhost: 8000 /</a> - approx. Lane.</i> ) <br><br><h4>  Static addresses </h4><br>  Here is our web application: <br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">myApp</span></span> :: <span class="hljs-type"><span class="hljs-type">ServerPart</span></span> <span class="hljs-type"><span class="hljs-type">Response</span></span> myApp = msum [ dir <span class="hljs-string"><span class="hljs-string">"echo"</span></span> $ echo , dir <span class="hljs-string"><span class="hljs-string">"query"</span></span> $ queryParams , dir <span class="hljs-string"><span class="hljs-string">"form"</span></span> $ formPage , dir <span class="hljs-string"><span class="hljs-string">"fortune"</span></span> $ fortune , dir <span class="hljs-string"><span class="hljs-string">"files"</span></span> $ fileServing , dir <span class="hljs-string"><span class="hljs-string">"upload"</span></span> $ upload , homePage ]</code> </pre><br>  In the most general form, our application is just a few handlers assigned to static addresses. <br><br>  <code>dir</code> used so that the handler is executed only when the static components of the path are successfully matched.  For example, <code>dir "echo"</code> will successfully work with the address <code><a href="http://localhost/"></a> localhost:8000/echo</code>  <code><a href="http://localhost/"></a> localhost:8000/echo</code> .  To assign a handler to the address <code>"/foo/bar"</code> , simply write <code>dir "foo" $ dir "bar" $ handler</code> . <br><br>  An attempt is made to consistently apply each handler, until one of them returns a result successfully.  In this case, the <code>Response</code> . <br><br>  We convert the list of handlers into one with the help of <code>msum</code> . <br><br>  The last handler, <code>homePage</code> , is unlimited ( <i>dir doesn't apply to it</i> ), so it will always be called if none of the other handlers work successfully. <br><br><h4>  HTML templates </h4><br>  As we create a web application, we will need to create HTML pages.  We can do this using Blaze, which also has a <a href="http://jaspervdj.be/blaze/tutorial.html">tutorial</a> . <br><br>  The subject of HTML templating causes widespread controversy in the community.  No template system can satisfy everyone, so Happstack supports many different systems.  Blaze is used in this tutorial because it is supported and based on purely functional combinators.  If you like compile time patterns, but you want HTML syntax, you can consider HSP.  If you are negative about patterns in your code and prefer external XML files, consider Heist. <br><br>  It is convenient to have a template function that combines common elements for all pages of a web application, such as importing CSS, external JS files, menus, etc. In this tutorial we will use a very simple template: <br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">template</span></span> :: <span class="hljs-type"><span class="hljs-type">Text</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Html</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Response</span></span> template title body = toResponse $ <span class="hljs-type"><span class="hljs-type">H</span></span>.html $ <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-type"><span class="hljs-type">H</span></span>.head $ <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-type"><span class="hljs-type">H</span></span>.title (toHtml title) <span class="hljs-type"><span class="hljs-type">H</span></span>.body $ <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> body p $ a ! href <span class="hljs-string"><span class="hljs-string">"/"</span></span> $ <span class="hljs-string"><span class="hljs-string">" "</span></span></code> </pre><br><br>  Then the main page looks like this: <pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">homePage</span></span> :: <span class="hljs-type"><span class="hljs-type">ServerPart</span></span> <span class="hljs-type"><span class="hljs-type">Response</span></span> homePage = ok $ template <span class="hljs-string"><span class="hljs-string">" "</span></span> $ <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-type"><span class="hljs-type">H</span></span>.h1 <span class="hljs-string"><span class="hljs-string">"!"</span></span> <span class="hljs-type"><span class="hljs-type">Hp</span></span> <span class="hljs-string"><span class="hljs-string">"   Happstack Lite   !"</span></span> <span class="hljs-type"><span class="hljs-type">Hp</span></span> <span class="hljs-string"><span class="hljs-string">"   :"</span></span> <span class="hljs-type"><span class="hljs-type">Hp</span></span> $ a ! href <span class="hljs-string"><span class="hljs-string">"/echo/secret%20message"</span></span> $ <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-type"><span class="hljs-type">Hp</span></span> $ a ! href <span class="hljs-string"><span class="hljs-string">"/query?foo=bar"</span></span> $ <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-type"><span class="hljs-type">Hp</span></span> $ a ! href <span class="hljs-string"><span class="hljs-string">"/form"</span></span> $ <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-type"><span class="hljs-type">Hp</span></span> $ a ! href <span class="hljs-string"><span class="hljs-string">"/fortune"</span></span> $ <span class="hljs-string"><span class="hljs-string">"- ()"</span></span> <span class="hljs-type"><span class="hljs-type">Hp</span></span> $ a ! href <span class="hljs-string"><span class="hljs-string">"/files"</span></span> $ <span class="hljs-string"><span class="hljs-string">"  "</span></span> <span class="hljs-type"><span class="hljs-type">Hp</span></span> $ a ! href <span class="hljs-string"><span class="hljs-string">"/upload"</span></span> $ <span class="hljs-string"><span class="hljs-string">" "</span></span></code> </pre><br>  The <code>ok</code> function sets the page‚Äôs HTTP code ‚Äú200 OK‚Äù.  There are other auxiliary functions, for example, <code>notFound</code> sets the code ‚Äú404 Not Found‚Äù, <code>seeOther</code> - ‚Äú303 See Other‚Äù.  To set the HTTP code number, use <code>setResponseCode</code> . <br><br><h4>  Dynamic parts of the address </h4><br>  The <code>dir</code> function matches only the static part of the address.  We can use the <code>path</code> function to extract a value from the dynamic part of the address and optionally convert it to some type, such as <code>Integer</code> .  In this example, we simply display the dynamic part of the path.  To check, visit <a href="http://localhost:8000/echo/fantastic">http: // localhost: 8000 / echo / fantastic</a> <pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">echo</span></span> :: <span class="hljs-type"><span class="hljs-type">ServerPart</span></span> <span class="hljs-type"><span class="hljs-type">Response</span></span> echo = path $ \(msg :: <span class="hljs-type"><span class="hljs-type">String</span></span>) -&gt; ok $ template <span class="hljs-string"><span class="hljs-string">""</span></span> $ <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> p $ <span class="hljs-string"><span class="hljs-string">"  : "</span></span> &gt;&gt; toHtml msg p <span class="hljs-string"><span class="hljs-string">"  ,     - ."</span></span></code> </pre><br><br><h4>  Request parameters </h4><br>  We can also get the values ‚Äã‚Äãof the string parameters of the request.  The query string is the part of the address that looks like " <code>?foo=bar</code> ".  Try visiting <a href="http://localhost:8000/query%3Ffoo%3Dbar">http: // localhost: 8000 / query? Foo = bar</a> <br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">queryParams</span></span> :: <span class="hljs-type"><span class="hljs-type">ServerPart</span></span> <span class="hljs-type"><span class="hljs-type">Response</span></span> queryParams = <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> mFoo &lt;- optional $ lookText <span class="hljs-string"><span class="hljs-string">"foo"</span></span> ok $ template <span class="hljs-string"><span class="hljs-string">" "</span></span> $ <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> p $ <span class="hljs-string"><span class="hljs-string">"foo = "</span></span> &gt;&gt; toHtml (show mFoo) p $ <span class="hljs-string"><span class="hljs-string">"  ,     foo."</span></span></code> </pre><br>  In case the request parameter is not set, the <code>lookText</code> function will return <code>mzero</code> .  In this example, we use <code>optional</code> from the <code>Control.Applicative</code> module, so we end up with a value of type <code>Maybe</code> . <br><br><h4>  Forms </h4><br>  We can use <code>lookText</code> to get data from forms. <pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">formPage</span></span> :: <span class="hljs-type"><span class="hljs-type">ServerPart</span></span> <span class="hljs-type"><span class="hljs-type">Response</span></span> formPage = msum [ viewForm, processForm ] <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> viewForm :: <span class="hljs-type"><span class="hljs-type">ServerPart</span></span> <span class="hljs-type"><span class="hljs-type">Response</span></span> viewForm = <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> method <span class="hljs-type"><span class="hljs-type">GET</span></span> ok $ template <span class="hljs-string"><span class="hljs-string">"form"</span></span> $ form ! action <span class="hljs-string"><span class="hljs-string">"/form"</span></span> ! enctype <span class="hljs-string"><span class="hljs-string">"multipart/form-data"</span></span> ! <span class="hljs-type"><span class="hljs-type">A</span></span>.method <span class="hljs-string"><span class="hljs-string">"POST"</span></span> $ <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> label ! <span class="hljs-type"><span class="hljs-type">A</span></span>.for <span class="hljs-string"><span class="hljs-string">"msg"</span></span> $ <span class="hljs-string"><span class="hljs-string">" - "</span></span> input ! type_ <span class="hljs-string"><span class="hljs-string">"text"</span></span> ! <span class="hljs-type"><span class="hljs-type">A</span></span>.id <span class="hljs-string"><span class="hljs-string">"msg"</span></span> ! name <span class="hljs-string"><span class="hljs-string">"msg"</span></span> input ! type_ <span class="hljs-string"><span class="hljs-string">"submit"</span></span> ! value <span class="hljs-string"><span class="hljs-string">""</span></span> processForm :: <span class="hljs-type"><span class="hljs-type">ServerPart</span></span> <span class="hljs-type"><span class="hljs-type">Response</span></span> processForm = <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> method <span class="hljs-type"><span class="hljs-type">POST</span></span> msg &lt;- lookText <span class="hljs-string"><span class="hljs-string">"msg"</span></span> ok $ template <span class="hljs-string"><span class="hljs-string">"form"</span></span> $ <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-type"><span class="hljs-type">Hp</span></span> <span class="hljs-string"><span class="hljs-string">" :"</span></span> <span class="hljs-type"><span class="hljs-type">Hp</span></span> (toHtml msg)</code> </pre><br>  We use the same <code>lookText</code> function as in the previous paragraph to get the data from the form.  You may also have noticed that we use the <code>method</code> function to distinguish between <code>GET</code> and <code>POST</code> requests. <br>  When a user views a form, the browser requests the page <code>/form</code> using <code>GET</code> .  In the HTML <code>form</code> tag, we specified the opening of the same page as the button action, but using the attribute we chose the <code>POST</code> method. <br><br><h4>  Cookies!  (HTTP cookies) </h4><br>  This example extends the form example by storing the message in a cookie.  This means the user can leave the page, and when he comes back, the page will remember the saved message. <pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">fortune</span></span> :: <span class="hljs-type"><span class="hljs-type">ServerPart</span></span> <span class="hljs-type"><span class="hljs-type">Response</span></span> fortune = msum [ viewFortune, updateFortune ] <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> viewFortune :: <span class="hljs-type"><span class="hljs-type">ServerPart</span></span> <span class="hljs-type"><span class="hljs-type">Response</span></span> viewFortune = <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> method <span class="hljs-type"><span class="hljs-type">GET</span></span> mMemory &lt;- optional $ lookCookieValue <span class="hljs-string"><span class="hljs-string">"- ()"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> memory = fromMaybe <span class="hljs-string"><span class="hljs-string">"      -!"</span></span> mMemory ok $ template <span class="hljs-string"><span class="hljs-string">"fortune"</span></span> $ <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-type"><span class="hljs-type">Hp</span></span> <span class="hljs-string"><span class="hljs-string">"   - ():"</span></span> <span class="hljs-type"><span class="hljs-type">Hp</span></span> (toHtml memory) form ! action <span class="hljs-string"><span class="hljs-string">"/fortune"</span></span> ! enctype <span class="hljs-string"><span class="hljs-string">"multipart/form-data"</span></span> ! <span class="hljs-type"><span class="hljs-type">A</span></span>.method <span class="hljs-string"><span class="hljs-string">"POST"</span></span> $ <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> label ! <span class="hljs-type"><span class="hljs-type">A</span></span>.for <span class="hljs-string"><span class="hljs-string">"fortune"</span></span> $ <span class="hljs-string"><span class="hljs-string">"  : "</span></span> input ! type_ <span class="hljs-string"><span class="hljs-string">"text"</span></span> ! <span class="hljs-type"><span class="hljs-type">A</span></span>.id <span class="hljs-string"><span class="hljs-string">"fortune"</span></span> ! name <span class="hljs-string"><span class="hljs-string">"new_fortune"</span></span> input ! type_ <span class="hljs-string"><span class="hljs-string">"submit"</span></span> ! value <span class="hljs-string"><span class="hljs-string">""</span></span> updateFortune :: <span class="hljs-type"><span class="hljs-type">ServerPart</span></span> <span class="hljs-type"><span class="hljs-type">Response</span></span> updateFortune = <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> method <span class="hljs-type"><span class="hljs-type">POST</span></span> fortune &lt;- lookText <span class="hljs-string"><span class="hljs-string">"new_fortune"</span></span> addCookies [(<span class="hljs-type"><span class="hljs-type">Session</span></span>, mkCookie <span class="hljs-string"><span class="hljs-string">"fortune"</span></span> (unpack fortune))] seeOther (<span class="hljs-string"><span class="hljs-string">"/fortune"</span></span> :: <span class="hljs-type"><span class="hljs-type">String</span></span>) (toResponse ())</code> </pre>  ( <i>I didn't manage to save the word game between the HTTP cookie and the fortune cookie somehow - approx. Lane.</i> ) <br><br>  Compared to the previous example, quite a bit of new has appeared: <br><ol><li>  <code>lookCookieValue</code> works in the same way as <code>lookText</code> , with the only difference that it looks for the value in the cookies, not the query parameters or the form. </li><li>  <code>addCookies</code> sends cookies to the browser and has the following type: <code>addCookies :: [(CookieLife, Cookie)] -&gt; ServerPart ()</code> </li><li>  <code>CookieLife</code> determines how long cookies exist and are considered valid.  <code>Session</code> means the lifetime for cookies until the browser window is closed. </li><li>  <code>mkCookie</code> takes the name of the cookie, its value, and creates a <code>Cookie</code> . </li><li>  <code>seeOther</code> (i.e., 303, redirect) tells the browser to make a new <code>GET</code> request to the <code>/fortune</code> page. </li></ol><br><br><h4>  File access </h4><br>  Most web applications need to provide access to static files from the disk, such as images, style sheets, scripts, etc. We can do this with the <code>serveDirectory</code> function: <br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">fileServing</span></span> :: <span class="hljs-type"><span class="hljs-type">ServerPart</span></span> <span class="hljs-type"><span class="hljs-type">Response</span></span> fileServing = serveDirectory <span class="hljs-type"><span class="hljs-type">EnableBrowsing</span></span> [<span class="hljs-string"><span class="hljs-string">"index.html"</span></span>] <span class="hljs-string"><span class="hljs-string">"."</span></span></code> </pre><br>  The first argument specifies whether <code>serveDirectory</code> create a list of files in a directory so that they can be viewed. <br>  The second argument is a list of index files.  If the user requests to browse the directory and it contains an index file, then instead of a list of files it will be displayed. <br>  The third argument is the path to the directory to which access is granted.  In this example, we provide access to the current directory. <br><br>  On supported platforms (Linux, OS X, Windows), the <code>serveDirectory</code> function automatically uses <code>sendfile()</code> to access files.  In <code>sendfile()</code> low-level kernel operations are used to ensure the transfer of files from the drive to the network with minimal processor overhead and maximum utilization of the network channel. <br><br><h4>  File allocation </h4><br>  Processing file uploads to the server is fairly straightforward.  We create the form, as in the previous example, but instead of <code>lookText</code> use <code>lookFile</code> . <br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">upload</span></span> :: <span class="hljs-type"><span class="hljs-type">ServerPart</span></span> <span class="hljs-type"><span class="hljs-type">Response</span></span> upload = msum [ uploadForm , handleUpload ] <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> uploadForm :: <span class="hljs-type"><span class="hljs-type">ServerPart</span></span> <span class="hljs-type"><span class="hljs-type">Response</span></span> uploadForm = <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> method <span class="hljs-type"><span class="hljs-type">GET</span></span> ok $ template <span class="hljs-string"><span class="hljs-string">" "</span></span> $ <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> form ! enctype <span class="hljs-string"><span class="hljs-string">"multipart/form-data"</span></span> ! <span class="hljs-type"><span class="hljs-type">A</span></span>.method <span class="hljs-string"><span class="hljs-string">"POST"</span></span> ! action <span class="hljs-string"><span class="hljs-string">"/upload"</span></span> $ <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> input ! type_ <span class="hljs-string"><span class="hljs-string">"file"</span></span> ! name <span class="hljs-string"><span class="hljs-string">"file_upload"</span></span> ! size <span class="hljs-string"><span class="hljs-string">"40"</span></span> input ! type_ <span class="hljs-string"><span class="hljs-string">"submit"</span></span> ! value <span class="hljs-string"><span class="hljs-string">"upload"</span></span> handleUpload :: <span class="hljs-type"><span class="hljs-type">ServerPart</span></span> <span class="hljs-type"><span class="hljs-type">Response</span></span> handleUpload = <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> (tmpFile, uploadName, contentType) &lt;- lookFile <span class="hljs-string"><span class="hljs-string">"file_upload"</span></span> ok $ template <span class="hljs-string"><span class="hljs-string">" "</span></span> $ <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> p (toHtml $ <span class="hljs-string"><span class="hljs-string">" : "</span></span> ++ tmpFile) p (toHtml $ <span class="hljs-string"><span class="hljs-string">" : "</span></span> ++ uploadName) p (toHtml $ <span class="hljs-string"><span class="hljs-string">" : "</span></span> ++ show contentType)</code> </pre><br><br>  When a file is uploaded, we store it in a temporary location.  The temporary file will be automatically deleted when the server sends the response to the browser.  This ensures that unused files do not pollute disk space. <br><br>  In most cases, the user does not want to download the file just for the sake of it being deleted.  Usually in the handler, <code>moveFile</code> or <code>copyFile</code> to move (or copy) the file to its permanent location. <br><br><h4>  From translator </h4><br>  The author of the article assumes the existence of basic knowledge of the Haskel language.  To install Happstack use the instructions on the site. <br><br>  If you are interested in this framework, I recommend to get acquainted with its full version (the <a href="http://happstack.com/docs/crashcourse/index.html">course</a> on which I am also going to translate), as well as the <a href="http://www.clckwrks.com/">clckwrks</a> based on it.  Pleasant development! </div><p>Source: <a href="https://habr.com/ru/post/185524/">https://habr.com/ru/post/185524/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../185510/index.html">Homemade tracking parcels, or there and back</a></li>
<li><a href="../185514/index.html">Douglas Engelbart, inventor of a computer mouse, died.</a></li>
<li><a href="../185516/index.html">Vulnerability in Android allows attackers to turn any application into a trojan</a></li>
<li><a href="../185518/index.html">Porting to python 3. Bug fixes</a></li>
<li><a href="../185522/index.html">Remote management of objects in Blender</a></li>
<li><a href="../185526/index.html">Effective technical guidance</a></li>
<li><a href="../185528/index.html">Our vision of Opera 15 and its future</a></li>
<li><a href="../185530/index.html">Convert FLAC to MP3</a></li>
<li><a href="../185532/index.html">Published specifications for International Linear Collider</a></li>
<li><a href="../185534/index.html">Equipment for working with money. A bit of history</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>