<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Setting up the Guard to automate Ruby on Rails development</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! In my opinion, every programmer should strive to automate and optimize everything that is moving and not yet. This article will explain how to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Setting up the Guard to automate Ruby on Rails development</h1><div class="post__text post__text-html js-mediator-article">  Hello!  In my opinion, every programmer should strive to automate and optimize everything that is moving and not yet.  This article will explain how to automate a Ruby on Rails developer‚Äôs workflow using a gem Ruby called Guard.  This article is primarily useful to Ruby developers, but may be useful to others. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/855/c53/57a/855c5357ab14c9aa13ade0e9f171102f.png" alt="image" align="left"><br><h1>  What is the Guard? </h1><br><a name="habracut"></a><br>  <a href="https://github.com/guard/guard">Guard</a> is a tool that allows you to automatically execute any commands when a file changes.  For example, if you change the server settings file, Guard may automatically restart the server.  Or you can set up an automatic compilation of LESS in CSS when saving a file.  It all depends on how the Guard is configured by the developer. <br><br>  At Guard there is a special file of settings Guardfile, which indicates which commands to run when changing which files.  All settings can be specified by yourself, or you can use those written by the community Guard Plugins, in which the most frequently used settings are written in advance. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Installation and first launch </h1><br>  The best way to integrate Guard into a project is to add it to the Gemfile. <br><br><pre><code class="ruby hljs">group <span class="hljs-symbol"><span class="hljs-symbol">:development</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> gem <span class="hljs-string"><span class="hljs-string">'guard'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  And then install it with the command <br><br><pre> <code class="bash hljs">$ bundle</code> </pre><br>  After that, you need to create a Guardfile command <br><br><pre> <code class="bash hljs">$ bundle <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> guard init</code> </pre><br>  It is best to run Guard using the Bundler command. <br><br><pre> <code class="bash hljs">$ bundle <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> guard</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/24d/8ce/447/24d8ce447a07653a3a194403235aee44.png" alt="image"><br><br><h1>  Configuring Ruby on Rails Applications </h1><br>  After installation, consider using Guard for a standard RoR project.  Suppose the RoR application is already created.  Let the Guard automatically install all necessary gems when the gemfile changes. <br><br><h2>  1. Adding to the project </h2><br>  To do this, in the Gemfile we will add to the group to develop the <a href="https://github.com/guard/guard-bundler">guard-bundler gems.</a> <br><br><pre> <code class="ruby hljs">group <span class="hljs-symbol"><span class="hljs-symbol">:development</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-comment"><span class="hljs-comment"># And updates gems when needed gem 'guard-bundler', require: false end</span></span></code> </pre><br>  Set the heme <br><br><pre> <code class="bash hljs">$ bundle install</code> </pre><br>  And then we initialize the plugin with the command <br><br><pre> <code class="bash hljs">$ guard init bundler</code> </pre><br>  Pay attention to the Guardfile, located in the root of the project.  Now there are lines <br><br><pre> <code class="ruby hljs">guard <span class="hljs-symbol"><span class="hljs-symbol">:bundler</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> watch(<span class="hljs-string"><span class="hljs-string">'Gemfile'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  It says that Guard will monitor the Gemfile file and will execute the command previously recorded in the guard-bundler gem.  In this case, this <br><br><pre> <code class="bash hljs">$ bundle install</code> </pre><br><br><h2>  2. Check </h2><br>  Check it out!  Enable Guard in the terminal command <br><br><pre> <code class="bash hljs">$ bundle <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> guard</code> </pre><br>  Add some gems to the gemfile.  For example, <a href="https://github.com/guard/guard-rspec">guard-rspec</a> , which will automatically run tests for the Rspec. <br><br><pre> <code class="ruby hljs">gem <span class="hljs-string"><span class="hljs-string">'guard-rspec'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">require:</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre><br>  Let's open the terminal with the guard process and see that it automatically started the bundler there, as a result of which the guard-rspec was automatically installed.  As you can see, such a setting Guard allows the developer to automate one of the frequently performed tasks. <br><br><h2>  3. Customization </h2><br>  Initialize the plugin for Rspec after installing it <br><br><pre> <code class="bash hljs">$ guard init rspec</code> </pre><br>  Now in the Guardfile there are new lines.  Consider them: <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># Note: The cmd option is now required due to the increasing number of ways # rspec may be run, below are examples of the most common uses. # * bundler: 'bundle exec rspec' # * bundler binstubs: 'bin/rspec' # * spring: 'bin/rsspec' (This will use spring if running and you have # installed the spring binstubs per the docs) # * zeus: 'zeus rspec' (requires the server to be started separetly) # * 'just' rspec: 'rspec' guard :rspec, cmd: 'bundle exec rspec' do watch(%r{^spec/.+_spec\.rb$}) watch(%r{^lib/(.+)\.rb$}) { |m| "spec/lib/#{m[1]}_spec.rb" } watch('spec/spec_helper.rb') { "spec" } # Rails example watch(%r{^app/(.+)\.rb$}) { |m| "spec/#{m[1]}_spec.rb" } watch(%r{^app/(.*)(\.erb|\.haml|\.slim)$}) { |m| "spec/#{m[1]}#{m[2]}_spec.rb" } watch(%r{^app/controllers/(.+)_(controller)\.rb$}) { |m| ["spec/routing/#{m[1]}_routing_spec.rb", "spec/#{m[2]}s/#{m[1]}_#{m[2]}_spec.rb", "spec/acceptance/#{m[1]}_spec.rb"] } watch(%r{^spec/support/(.+)\.rb$}) { "spec" } watch('config/routes.rb') { "spec/routing" } watch('app/controllers/application_controller.rb') { "spec/controllers" } watch('spec/rails_helper.rb') { "spec" } # Capybara features specs watch(%r{^app/views/(.+)/.*\.(erb|haml|slim)$}) { |m| "spec/features/#{m[1]}_spec.rb" } # Turnip features and steps watch(%r{^spec/acceptance/(.+)\.feature$}) watch(%r{^spec/acceptance/steps/(.+)_steps\.rb$}) { |m| Dir[File.join("**/#{m[1]}.feature")][0] || 'spec/acceptance' } end</span></span></code> </pre><br>  These lines set up the automatic launch of the Rspec tests.  Consider some of them.  For example, the string <br><br><pre> <code class="ruby hljs">ruby watch(<span class="hljs-string"><span class="hljs-string">'spec/spec_helper.rb'</span></span>) { <span class="hljs-string"><span class="hljs-string">"spec‚Äù }</span></span></code> </pre><br>  says that Guard will monitor the spec / spec_helper.rb file (the path relative to the project root is the Guardfile file) and if it is changed it will start testing the entire spec folder.  Block start <br><br><pre> <code class="ruby hljs">ruby guard <span class="hljs-symbol"><span class="hljs-symbol">:rspec</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">cmd:</span></span> <span class="hljs-string"><span class="hljs-string">'bundle exec rspec'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span></code> </pre><br>  says that for any rule all Rspec commands will be run with the parameters bundle exec rspec.  That is, in the considered case, if you change ruby ‚Äã‚Äãspec / spec_helper.rb, the command will be run <br><br><pre> <code class="bash hljs">$ bundle <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> rspec spec</code> </pre><br>  Line <br><br><pre> <code class="ruby hljs">rubywatch(<span class="hljs-regexp"><span class="hljs-regexp">%r{^app/(.+)\.rb$}</span></span>) { <span class="hljs-params"><span class="hljs-params">|m|</span></span> <span class="hljs-string"><span class="hljs-string">"spec/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{m[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">_spec.rb"</span></span> }</code> </pre><br>  says that when changing any .rb file, the testing of the test associated with this file will be launched.  That is, when you change app / models / user.rb, the command will automatically start. <br><br><pre> <code class="bash hljs">$ bundle <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> spec spec/models/user_spec.rb</code> </pre><br>  Regular expressions are used to create and edit such actions.  I recommend using the match command in the Ruby console for debugging, for example <br><br><pre> <code class="ruby hljs"><span class="hljs-string"><span class="hljs-string">"app/views/units/index.html.slim"</span></span>.match(<span class="hljs-regexp"><span class="hljs-regexp">%r{^app/views/(.+)/(.*)\.(.*)\.(erb|haml|slim)$}</span></span>)</code> </pre><br><br><h1>  More examples! </h1><br>  For Guard written a <a href="https://github.com/guard/guard/wiki/List-of-available-Guards">large number of plugins</a> for all occasions.  Each developer should independently find the necessary for him and customize them for themselves.  I will briefly describe those that are used by me at the moment.  I myself have not yet found the ideal solutions, so I will be glad to any comments and suggestions! <br><br><h2>  In gemfile </h2><br><br><pre> <code class="ruby hljs">group <span class="hljs-symbol"><span class="hljs-symbol">:development</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-comment"><span class="hljs-comment"># Integrates jasmine js testing gem 'jasmine-rails' # With guard gem 'guard-jasmine', git: "git://github.com/guard/guard-jasmine.git", branch: "jasmine-2" # Checks ruby code grammar gem 'rubocop', require: false # With rspec gem 'rubocop-rspec' # With guard gem 'guard-rubocop' end group :development do # Automagically launches tests for changed files gem 'guard' gem 'guard-rspec', require: false # And updates gems when needed gem 'guard-bundler', require: false # And auto starts rails server gem 'guard-rails' # And auto runs migrations gem 'guard-migrate' end</span></span></code> </pre><br><br><h2>  In guardfile </h2><br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># More info at https://github.com/guard/guard#readme # https://github.com/guard/guard-bundler guard :bundler do watch('Gemfile') end # https://github.com/guard/guard-rspec guard :rspec, cmd: 'zeus rspec' do watch(%r{^spec/.+_spec\.rb$}) watch(%r{^lib/(.+)\.rb$}) { |m| "spec/lib/#{m[1]}_spec.rb" } # Run the model specs related to the changed model watch(%r{^app/(.+)\.rb$}) { |m| "spec/#{m[1]}_spec.rb" } # Controller changes watch(%r{^app/controllers/(.+)_(controller)\.rb$}) { |m| ["spec/#{m[2]}s/#{m[1]}_#{m[2]}_spec.rb", "spec/acceptance/#{m[1]}_spec.rb"] } watch('config/routes.rb') { "spec/controllers" } watch('app/controllers/application_controller.rb') { "spec/controllers" } watch(%r{^spec/support/(.+)\.rb$}) { "spec" } watch('spec/rails_helper.rb') { "spec" } watch('spec/spec_helper.rb') { "spec" } # Capybara features specs watch(%r{^app/views/(.+)/.*\.(erb|haml|slim)$}) { |m| "spec/acceptance/#{m[1]}" } watch(%r{^app/views/(.+)/(.*)\.(.*)\.(erb|haml|slim)$}) { |m| "spec/acceptance/#{m[1]}" } watch(%r{^app/views/(.+)/_.*\.(erb|haml|slim)$}) { |m| "spec/acceptance/#{m[1].partition('/').first}/#{m[1].partition('/').last}_spec.rb" } end # Checks any changed ruby file for code grammar # https://github.com/yujinakayama/guard-rubocop guard :rubocop, all_on_start: false, cli: ['--out', 'log/rubocop.log'] do watch(%r{^(.+)\.rb$}) { |m| "#{m[1]}.rb" } end # Restarts server on config changes # https://github.com/ranmocy/guard-rails guard :rails, zeus: true, daemon: true do watch('Gemfile.lock') watch(%r{^(config|lib)/.*}) end # Restarts all jasmine tests on any js change # https://github.com/guard/guard-jasmine guard :jasmine, all_on_start: false, server_mount: '/specs' do watch(%r{^app/(.+)\.(js\.coffee|js|coffee)}) { "spec/javascripts" } watch(%r{^spec/javascripts/(.+)\.(js\.coffee|js|coffee)}) { "spec/javascripts" } end # Runs migrations on migrate files changes # https://github.com/glanotte/guard-migrate guard :migrate do watch(%r{^db/migrate/(\d+).+\.rb}) watch('db/seeds.rb') end</span></span></code> </pre><br><h2>  Little rubocop </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/558/1c4/7a1/5581c47a11a48e93f6b26c6bed173f4a.png" alt="image"><br>  <a href="https://github.com/bbatsov/rubocop">Rubocop</a> is a Ruby gem that allows you to check the .rb file for correct syntax.  In this example, it is configured with Guard, so that every time a .rb file is modified, Rubocop checks it and displays the result in the console and in the log / rubocop.log file. <br><br>  Rubocop has a huge amount of settings, thanks to which it can be adapted to any syntax requirements.  You can even make it automatically adjust the code.  To configure the gem, the .rubocop.yml file is used, for example, rubocop usually swears for lines greater than 90 characters, but thanks to the settings file, it can be made so that it points only to lines larger than 140. <br><br>  To see all the settings, just run the command. <br><br><pre> <code class="ruby hljs">$ rubocop --auto-gen-config</code> </pre><br>  which will create a file with all disabled settings.  You can thus include one by one and get the final required .rubocop.yml file. <br><br><h2>  results </h2><br>  What is the final result?  In this project, it is enough to run separate processes zeus and guard.  Then the following happens: <br><ol><li>  The server running via zeus Rails is automatically supported and restarted each time the main project settings files are changed. </li><li>  With each change in Gemfile, all gems are set. </li><li>  When changing any file with the test, this test is run. </li><li>  When changing any file controllers / models / libs / views, the associated test is started, if there is one </li><li>  Each modified ruby ‚Äã‚Äãfile is checked for literacy using rubocop </li><li>  When changing any javascript / coffeescript file, all jasmine tests are run. </li><li>  When changing any migration file or seeds, all necessary migrations are run. </li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/de8/493/64f/de849364fe4aa3b800f0572f5449009a.png" alt="image"><br><br>  Thus, a sufficiently large number of processes could be automated.  I would like to make it so that each project would only be enough to run guard and fully focus on the creative process. <br><br><h1>  An example of working with Guard </h1><br>  Now I will describe the current process of working with the Guard.  Below are the recommendations that I gave the rest of the developers with whom I am currently working. <br><ol><li>  Open a terminal and go to the project folder. </li><li>  Run zeus for accelerated tests / server <br><pre> <code class="bash hljs">$ zeus start</code> </pre></li><li>  Launch Guard <br><pre> <code class="bash hljs">$ bundle <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> guard</code> </pre><br>  Now the Guard will automatically start and keep the enabled Rails server enabled via Zeus. </li><li>  Run all tests by pressing Enter in the terminal.  After fixing all the tests you can work! </li></ol><br>  What you should pay attention: when changing test files, tests will be run automatically.  That is, I recommend keeping the terminal window open at the same time as the IDE window (in Rubymine, for example, this can be done right in the sub window), where you can immediately see if the tests have fallen off with the changes made. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0b0/8a5/e56/0b08a5e56b770b05217edb5e8d3d164f.png" alt="image"><br><br><h1>  Thank! </h1><br>  Thank you for reading!  I do not claim that I am an expert in the Guard, so I will be glad to any comments and suggestions. </div><p>Source: <a href="https://habr.com/ru/post/238667/">https://habr.com/ru/post/238667/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../238653/index.html">How we practice corridor testing</a></li>
<li><a href="../238659/index.html">Welcome to Moscow.pm and Perl Golf</a></li>
<li><a href="../238661/index.html">Adventures in the mathematical forest of fractal trees</a></li>
<li><a href="../238663/index.html">Interview with Junior Veloso, one of the co-founders of Kevvox</a></li>
<li><a href="../238665/index.html">How we organized the automatic sending of appeals to government bodies</a></li>
<li><a href="../238671/index.html">Evernote service is not affected by Shellshock bug</a></li>
<li><a href="../238675/index.html">Mounting wrap. Technology</a></li>
<li><a href="../238679/index.html">Using Fujitsu PalmSecure technology in two-factor authentication cases</a></li>
<li><a href="../238681/index.html">Microsoft at KRI 2014 and Games Jam 2014</a></li>
<li><a href="../238683/index.html">How to create a user survey that improves conversion?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>