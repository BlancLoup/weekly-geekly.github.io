<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SockJS server performance study</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good time of day! 

 It so happened that I do all sorts of different push technologies using Tornado. A little earlier I described Tornadio2 , the ser...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SockJS server performance study</h1><div class="post__text post__text-html js-mediator-article">  Good time of day! <br><br>  It so happened that I do all sorts of different push technologies using Tornado.  A little earlier I described <a href="http://habrahabr.ru/blogs/python/133350/">Tornadio2</a> , the server implementation of the socket.io protocol on top of <a href="http://www.tornadoweb.org/">Tornado</a> . <br><br>  Now I want to present a similar project - <a href="https://github.com/MrJoes/sockjs-tornado">sockjs-tornado</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For those who are not very interested, there is another useful information: comparative load testing of PyPy 1.7 versus CPython 2.6.6, sockjs-node and socket.io (both at node.js 0.6.5).  Everything is under the cut :-) <br><a name="habracut"></a><br>  First, what is SockJS?  This is a client library written in javascript that mimics the Websocket API, but it supports all browsers by using various surrogate substitutes in the form of ajax long-polling, jsonp-polling and the like.  In general, very similar to socket.io, but with some key differences. <br><br>  A small digression - I have nothing to do with the client part of the library, except that I sent out bug reports and annoyed it in every way. <br><br>  So why do you need it if there is a <a href="http://socket.io/">socket.io</a> ? <br>  I will cite a couple of reasons that led to the development of SockJS: <br>  1. Developers socket.io, starting with version 0.7, went somewhere wrong.  Instead of correcting errors, adding support for different browsers, they decided to make the API higher level.  I do not argue - all the innovations are very convenient, but the number of errors has not decreased.  For example, a fairly serious race condition can not close more than <a href="https://github.com/LearnBoost/socket.io/issues/438">3 months</a> .  Connecting after disconnecting does not work until now.  Well, and the like. <br>  2. Sometimes you do not want to become attached to a specific library.  If you use socket.io, then it will be difficult to abandon it, since you will have to change all the places where there is a binding to socket.io. <br><br>  So what is SockJS? <br>  1. As noted earlier, this is a simple replacement for the Websocket API for the browser.  Accordingly, the relocation of an existing application that uses web sockets will be fairly painless (if not to talk about the server part) <br>  2. SockJS even works in Opera, which socket.io doesn't really like.  In addition, SockJS works correctly with different antiviruses - rolls back to another transport, while socket.io cannot establish a connection at all. <br>  3. SockJS supports streaming protocols: one permanent connection from the server, for outgoing data.  socket.io declined streaming transport from version 0.7. <br>  4. The protocol is much simpler and very well documented.  For developers, there is even a set of tests that the server implementation must pass. <br>  5. Scalability laid down in the protocol.  For example, load balancer does not have to work with cookies to organize a sticky session - all the necessary information is already in the URL. <br>  6. The library is very well tested in different conditions, there are even <a href="http://docs.jquery.com/QUnit">qunit</a> tests that check both the client and the server directly from the browser.  For example, here is an example of tests for sockjs-node: <a href="http://sockjs.popcnt.org/">http://sockjs.popcnt.org/</a> <br><br>  In general, this thing just works. <br><br>  Now to the second part of the article, performance. <br><br>  After writing sockjs-tornado, I decided to check how it is in comparison with the ‚Äúnative‚Äù server written in node.js.  Now node.js is very fashionable, and they often talk about its performance in various push technologies.  I will tell you in advance - the results of testing surprised me greatly. <br><br>  The testing methodology was chosen very simple: we have a chat room with one room.  Each incoming message is simply sent by the server to all chat participants.  If interested, <a href="https://github.com/MrJoes/sockjs-tornado/blob/master/examples/bench/bench.py">here is</a> the server code. <br><br>  There is a Websocket client that sends ping and waits for its ‚Äúown‚Äù response.  After receiving the answer, it considers the time taken between sending and receiving.  Results for different levels of parallelism and the number of sent messages are saved and a graph is plotted. <br><br>  Maybe some will ask - what is actually being tested?  And this is what is being tested: <br>  - The speed of implementing Websocket protocol for different servers <br>  - The maximum number of messages at which the server starts to choke <br>  - Overhead to support a large number of connections <br>  - Response time at different load levels <br><br>  To another question, why do we need a "stupid" chat, which is generally without logic?  If someone came across such a project as the <a href="http://www.humblebundle.com/">Humble Indie Bundle</a> , they have the amount of money earned is shown in real time.  So, they use a "broker" that "holds" a large number of web clients.  And they also have a data source (producer), which from time to time sends the broker how much money was earned.  The broker must send this information to all its connected clients.  The faster the broker works, the greater the number of clients it can service in the shortest time. <br><br>  The study was done in English, as the developers of sockjs asked to do comparative testing with sockjs-node and it can be viewed <a href="http://mrjoes.github.com/2011/12/15/sockjs-bench.html">right here</a> .  If anyone is interested, I can translate the article into Russian. <br><br>  In short, it turns out the following picture: <br>  - sockjs-node can send up to 45,000 messages per second with an average response time of 200 ms. <br>  - sockjs-tornado in cpython 2.6.6 can produce up to 55,000 messages per second with a response time of 200 ms <br>  - sockjs-tornado on pypy 1.7 simply ‚Äúbreaks‚Äù with its 150,000+ messages per second. <br><br>  Of course, servers can send more messages per second, but the response time grows and the application ceases to be realtime :-) <br><br>  A comparative chart can be found <a href="http://mrjoes.github.com/2011/12/15/sockjs-bench.html">here</a> .  On the X axis, we have the number of messages sent by the server in one second.  Y axis - response time.  Each line is a server combination (node ‚Äã‚Äã= sockjs-node, socket.io = socket.io node, cpython = sockjs-tornado in cpython, pypy = sockjs-tornado in pypy 1.7) with the number of simultaneous connections.  socket.io is an example of the performance of another project on node.js. <br><br>  Even if you don‚Äôt compare node.js and cpython, pypy performance was a complete surprise to me. <br><br>  Well, in conclusion. <br><br>  I recommend to look towards SockJS if any real-time functionality is planned, even if you have already considered options with socket.io.  And I hope that sockjs-tornado will be useful to someone else. </div><p>Source: <a href="https://habr.com/ru/post/134822/">https://habr.com/ru/post/134822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134817/index.html">TPoDT keygenme analysis # 2</a></li>
<li><a href="../134818/index.html">Kiri</a></li>
<li><a href="../134819/index.html">XNA Draw: write deferred lighting to three sources using a shader</a></li>
<li><a href="../134820/index.html">Introduction to mnemonics</a></li>
<li><a href="../134821/index.html">Three20 demystifying: TTModel</a></li>
<li><a href="../134823/index.html">Asynchronous function sequential call</a></li>
<li><a href="../134824/index.html">2GIS - iOS version appeared</a></li>
<li><a href="../134825/index.html">Recognition and speech synthesis in any iOS application in an hour</a></li>
<li><a href="../134826/index.html">Do I need authorization after registration?</a></li>
<li><a href="../134828/index.html">Optimize battery consumption</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>