<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Belt conveyor for linear data</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Five years ago I happened to design one program that processes text with control commands. The number of processing steps was quite significant - 6-7 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Belt conveyor for linear data</h1><div class="post__text post__text-html js-mediator-article">  Five years ago I happened to design one program that processes text with control commands.  The number of processing steps was quite significant - 6-7 processors could consistently pass through quite large amounts of data, as sometimes happens in Unix pipelines.  To accurately accomplish the task, I developed a general method that can be useful in other places.  The idea behind this article is really very similar to Unix pipelines, but there are a few significant differences: <br><ul><li>  Unix pipeline works asynchronously, in different processes, while here it is required to implement processing within one program, and parallelization may be undesirable; </li><li>  transfer of any data is possible, not necessarily text, but which can be characterized by the term "linear". </li></ul>  Under the <i>linear data,</i> I will understand the sequence of objects, allowing the transition to the next (if any).  Examples include: binary file, text from UTF-8 characters, sequence of tokens, commands.  A complex program that processes linear data, such as a translator, usually performs several transformations.  Here is an example: <br><ul><li>  reading file bytes, </li><li>  decoding in UTF-8, </li><li>  preprocessor, </li><li>  lexical analysis </li><li>  parsing </li></ul><br>  It's no secret that in this case there is no need to store data entirely in memory.  It is much more efficient to read the file in chunks, which immediately go through all stages of the conversion, without lingering in memory. <br><br>  Converters are arranged in the form of a ‚Äúpipeline‚Äù, each following receives data from the previous one.  The converter can also change the type of data, for example, in the lexer the letters at the input, at the output - the token. <br><br>  I do not have the implementation of these algorithms worthy of publication, so I will limit myself to a general idea and scheme of implementation.  Approximate schemes are given in C ++, they use <a href="http://ru.wikipedia.org/wiki/%25D0%2592%25D0%25B8%25D1%2580%25D1%2582%25D1%2583%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BD%25D0%25B0%25D1%2581%25D0%25BB%25D0%25B5%25D0%25B4%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">virtual</a> and multiple inheritance, as well as templates. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  What happens if you design the processing of linear data, especially without bothering </h5><br>  Let's consider a possible implementation of the converter software interface.  In the simplest version, three types of transducers are possible: <br><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Source</span></span></span><span class="hljs-class"> {</span></span> ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; ‚Ä¶ }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sink</span></span></span><span class="hljs-class"> {</span></span> ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">putData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T)</span></span></span></span>; ‚Ä¶ }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Universal</span></span></span><span class="hljs-class"> {</span></span> ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; };</code> </pre> <br><br><img src="https://habrastorage.org/storage2/33f/2d7/5b1/33f2d75b17bc64d9102f8516ae521d45.png"><br>  <i>Figure 1.</i> A simple implementation of the pipeline. <br><br>  Here is a trivial example of such a pipeline, an "adder" (it reads numbers from std :: cin, adds them in pairs, prints to std :: cout, this is a working program in C ++): <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt; //   std::cin class IntSource { public: int getData() { int next; std::cin&gt;&gt;next; return next; } bool good() const { return std::cin.good(); } }; //   std::cout class IntSink { public: void putData(int data) { std::cout&lt;&lt;data&lt;&lt;std::endl; } }; //    IntSource      IntSink class IntUniversal { IntSource source; IntSink sink; public: void process() { int i1 = source.getData(); int i2 = source.getData(); if( good() ) sink.putData(i1+i2); } bool good() const { return source.good(); } }; int main() { IntUniversal belt; while( belt.good() ) belt.process(); }</span></span></span></span></code> </pre><br><br>  The source converter provides an interface that allows the next converter in the pipeline to get a piece of data from it.  In contrast, the Sink converter (absorber) can receive a signal from the previous converter that the data is ready.  Source gives the data ‚Äúon demand‚Äù, but takes care of its receipt itself, while Sink can give the data to the next element, but receives it only when the previous one likes.  Only a universal converter has complete freedom: it can get data from the previous one and pass it on to the next one when it pleases.  We note several simple, forced rules of such a simplified ‚Äúpipeline‚Äù, based on the limitations of the converter capabilities: <br><ul><li>  the first item in the pipeline is the Source; </li><li>  the last element is Sink; </li><li>  the Sink converter can directly precede only another Sink converter, the Source converter can directly follow only another Source converter; </li><li>  Universal converter must follow Source and precede Sink. </li></ul>  It follows from these rules that the only possible implementation of the pipeline is: Source <sub>1</sub> , ..., Source <sub>n</sub> , Universal, Sink <sub>1</sub> , ..., Sink <sub>m</sub> .  The call stack for such a pipeline may look like this: <br><br><ul><li>  Source <sub>k</sub> :: getData </li><li>  ... </li><li>  Source <sub>n</sub> :: getData </li><li>  Universal :: process, </li></ul>  or <br><ul><li>  Sink <sub>l</sub> :: putData </li><li>  ... </li><li>  Sink <sub>1</sub> :: putData </li><li>  Universal :: process. </li></ul><br><br><h5>  We improve the conveyor </h5><br>  Using Source and Sink imposes restrictions on the implementation of procedures, as well as on their effectiveness.  The programmer would be more comfortable if the pipeline looked like this: Universal, ..., Universal.  You can bring this desire to life by adding what the conveyor really lacks: a ‚Äúbelt‚Äù.  Our <i>tape</i> will be a memory area that stores data ‚Äúbetween‚Äù the converters.  Once the transducer produces data, it is placed on the tape, from where the next transducer can read it.  The conveyor is now complicated and can not be controlled by itself, as it was before, so a special ‚Äúconveyor manager‚Äù is required to monitor the tape and the converters.  Converters will now be built in the form of heirs from base classes with an interface.  Here is their simplified view: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UniversalBase</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">S</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UniversalSource</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UniversalSink</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">//       template &lt;class S&gt; class UniversalSource : public virtual UniversalBase { UniversalSink&lt;S&gt;* next; protected: void putOnBelt(const S&amp;); }; //       template &lt;class T&gt; class UniversalSink : public virtual UniversalBase { UniversalSource&lt;T&gt;* prev; protected: T getFromBelt(); }; // ,    T     S template &lt;class T, class S&gt; class Universal : public UniversalSink&lt;T&gt;, public UniversalSource&lt;S&gt; { };</span></span></code> </pre><br><br><img src="http://habrastorage.org/storage2/1e9/06e/d7b/1e906ed7b25184aed28adf6c2373b1c5.png"><br>  <i>Fig 2.</i> Scheme of the improved implementation of the pipeline. <br><br>  The <b>process</b> function is implemented in each specific converter in its own way, and fulfills the essence of its purpose.  Its task is to produce a certain amount of data and transfer it to the pipeline manager for placement on the tape.  For this process calls the function <b>putOnBelt</b> defined in the base class.  It is important to understand that the process of each converter can be called several times, it must produce some reasonable amount of data (for example, one unit) and complete.  As soon as the process implementation requires input, it accesses the manager by calling <b>getFromBelt</b> . <br><br>  Here is an example of the same adder, but implemented using the new concept of the pipeline.  Now this is not a full-fledged program, it lacks the implementation of the pipeline manager. <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt; #inlcude &lt;belt.h&gt; //   std::cin class IntSource : public Belt::UniversalSource&lt;int&gt; { public: void process() { int data; if( std::cin&gt;&gt;data ) putOnBelt(data); } }; //   std::cout class IntSink : public Belt::UniversalSink&lt;int&gt; { public: void process() { if(!hasData() ) return; std::cout&lt;&lt;getFromBelt()&lt;&lt;std::endl; } }; //           class IntUniversal : public Belt::Universal&lt;int,int&gt; { public: void process() { int i1 = getFromBelt(); int i2 = getFromBelt(); if(!good() ) return; putOnBelt(i1+i2); } }; int main() { IntSource source; IntUniversal universal; IntSink sink; (source &gt;&gt; universal &gt;&gt; sink).process(); }</span></span></span></span></code> </pre><br>  It uses functions and classes that were not previously mentioned: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> UniversalSink::hasData(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> UniversalSink::good(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">S</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UnboundedBelt</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Universal&lt;T,S&gt; {...}; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RightBoundedBelt</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> UniversalSink&lt;T&gt; {...}; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">S</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LeftBoundedBelt</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> UniversalSource&lt;S&gt; {...}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Belt</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> UniversalBase {...}; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">S</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UnboundedBelt</span></span></span><span class="hljs-class">&lt;T,S&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">operator</span></span></span><span class="hljs-class"> &gt;&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Universal</span></span></span><span class="hljs-class">&lt;T,R&gt;&amp;,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Universal</span></span></span><span class="hljs-class">&lt;R,S&gt;&amp;);</span></span> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">S</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LeftBoundedBelt</span></span></span><span class="hljs-class">&lt;S&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">operator</span></span></span><span class="hljs-class"> &gt;&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UniversalSource</span></span></span><span class="hljs-class">&lt;R&gt;&amp;,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Universal</span></span></span><span class="hljs-class">&lt;R,S&gt;&amp;);</span></span> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RightBoundedBelt</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">operator</span></span></span><span class="hljs-class"> &gt;&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Universal</span></span></span><span class="hljs-class">&lt;T,R&gt;&amp;,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UniversalSink</span></span></span><span class="hljs-class">&lt;R&gt;&amp;);</span></span> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Belt</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">operator</span></span></span><span class="hljs-class"> &gt;&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UniversalSource</span></span></span><span class="hljs-class">&lt;R&gt;&amp;,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UniversalSink</span></span></span><span class="hljs-class">&lt;R&gt;&amp;);</span></span></code> </pre><br>  The problem of determining the end of data can be solved as follows: the virtual function bool UniversalSource :: hasData () is defined, the implementation of which by default is based on the rule - we assume that the data is finished if process did not issue anything as an iteration. <br><br><h5>  Approaches to the implementation of the pipeline manager </h5><br>  The process function is called by the pipeline manager.  Differences between different implementations of the pipeline manager can be in the order in which to call the process functions of different converters.  It is desirable that the tape does not accumulate an excess of data, as this will increase memory consumption, and also, it is desirable to avoid too deep call stacks. <br><br>  The getFromBelt function reads data from a tape, if it is on it, and otherwise, it starts the process from the previous converter until it issues some piece of data to the tape.  putOnBelt simply puts data on tape.  It can call the process of the next converter, so that it immediately processes them, but this is not necessary, and creates difficulties, about which - a little later. <br><br>  Thus, the call stack in the simple case takes the form: <br><br><ul><li>  ... </li><li>  <i>pipeline manager</i> </li><li>  UniversalSink :: getFromBelt () </li><li>  Converter <sub>n <sub>2</sub></sub> :: process () </li><li>  <i>pipeline manager</i> </li><li>  UniversalSink :: getFromBelt () </li><li>  Converter <sub>n <sub>1</sub></sub> :: process () </li><li>  <i>pipeline manager</i> </li></ul><br>  In order to ensure the normal operation of the pipeline, which is necessary for the functioning of most ordinary applications, it is necessary to fulfill only one axiom: <br><ul><li>  the pipeline manager has no right to call the process function of the converter if the process function of the same converter is already on the call stack.  (A) </li></ul>  The fulfillment of this axiom imposes an important (and only) restriction on the implementation (we are talking only about the single-threaded case): <br><ul><li>  the pipeline manager does not have the right to call the process function of the converter if the process function of the leftmost converter is on the call stack. </li></ul>  Indeed, let us see what happens if this requirement is not fulfilled, and control is transferred to the more right R converter, while the more left L converter is being executed.  If R needs data, and there is no data on the tape, then the pipeline manager will have to call the left converters, which may lead to violation of axiom (A). <br><br>  Here are two possible manager implementations: <br><ul><li>  <i>Recursive</i>  It calls the process directly only on the last converter, the rest is run recursively if necessary. </li><li>  <i>Consistent</i> .  Calls the process in turn (from left to right), ‚Äúaccumulating‚Äù data on the tape.  As soon as it decides that there is enough data, it moves to one converter to the right.  For this option, it is desirable to have an estimate of how much data a particular converter ‚Äúconsumes‚Äù during one iteration of the process. </li></ul><br><h5>  Possible buns </h5><br>  The article provides a simplified scheme for the implementation of the pipeline.  Its improvements can be implemented: <br><ul><li>  ‚Äúforward looking‚Äù operation: the converter reads the data, but in fact it is not removed from the tape, and returned upon its request; </li><li>  ‚ÄúCandy boxes‚Äù: the delivery of data in chunks, which improves efficiency when working with a large number of small data, such as characters.  A ‚Äúbox‚Äù is transmitted along the conveyor at once, instead of a ‚Äúone candy‚Äù transfer, which makes it possible to avoid function calls per data unit; </li><li>  ‚ÄúSmart‚Äù memory allocator (allocator), which will allow you to avoid permanent allocations / deletions of dynamic memory, when the pipeline is working, and can even save you from unnecessary copying operations; </li><li>  execution in multiple threads.  In the case of a pipeline, this is always possible, and effective, if each of the converters is single-threaded. </li></ul><br><br>  Also, compared with ‚Äúimplementations in the forehead,‚Äù a big advantage is: the independence of the individual parts of the program from each other (each converter knows only the types of its input and output data, may not know anything about the converters to which it is connected by input and output), the ability to safely switch on new converters and change their order. <br><br><h5>  Conclusion </h5><br>  I apologize to: <br><ul><li>  who have studied the topic, read the literature on this topic, horrified by the terminology or concept; </li><li>  knowledgeable English, terrifying precedents for the use of English words in identifiers; </li><li>  numerous adherents of coding styles different from my (and no doubt more correct); </li><li>  C ++ haters or multiple inheritance; </li><li>  programmers not familiar with used C ++ constructs. </li></ul><br>  I admit that these concepts, and perhaps much more convenient, are implemented in some popular library, such as Boost (if yes - it will be interesting to see).  But for me, the content of this article seems to be a beautiful pattern, not only and not so much of practical significance with which I wanted to share. </div><p>Source: <a href="https://habr.com/ru/post/183998/">https://habr.com/ru/post/183998/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../183988/index.html">Review of the monoblock Samsung 300A2A-T01</a></li>
<li><a href="../183990/index.html">Bicycle to generate Excel documents on the template</a></li>
<li><a href="../183992/index.html">The way to protect against unauthorized copying of files to the root of a flash card for users of OS WINDOWS</a></li>
<li><a href="../183994/index.html">What is important for creating an AI?</a></li>
<li><a href="../183996/index.html">Address book on OpenLDAP for Outlook</a></li>
<li><a href="../184000/index.html">The Ministry of Revenues of Ukraine will undertake other payment systems, including Yandex.Money</a></li>
<li><a href="../184002/index.html">Lumia 925 Presentation: Quick Review and Comparison with Lumia 920</a></li>
<li><a href="../184004/index.html">Microsoft refused to buy Nokia</a></li>
<li><a href="../184008/index.html">Google admitted that interview puzzles are useless</a></li>
<li><a href="../184014/index.html">Can companies trust Microsoft again? Intelligence agencies received information about the 0-day vulnerabilities of Windows and Skype</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>