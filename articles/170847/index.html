<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unit testing and continuous integration with Jenkins for C ++ projects</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I think everyone knows what unit tests are, everyone knows, or at least heard what continuous integration is, and many people program in C ++. But I w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unit testing and continuous integration with Jenkins for C ++ projects</h1><div class="post__text post__text-html js-mediator-article">  I think everyone knows what unit tests are, everyone knows, or at least heard what continuous integration is, and many people program in C ++.  But I was faced with the fact that the Internet is not so much information about how to combine it all and make it work together.  This article is an attempt to give newbies a step-by-step instruction that will allow you to take the first step in creating unit tests for C ++ projects and organize the run-through of unit tests using a CI server. <br>  <b>Update:</b> Plan: <br><ol><li>  Write HelloWorld </li><li>  Let's set up assembly of HelloWorld on Jenkins </li><li>  Let's write a unit test for HelloWorld </li><li>  Let's configure run of modular tests on Jenkins </li></ol><br>  Warning: a lot of letters and screenshots, half of which are redundant.  Especially for those who are already in the subject. <br><br><a name="habracut"></a><br><br><h4>  Prerequisites </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To achieve the task we need: <br><ul><li>  Access to version control system (subversion, mercurial or git).  In this article, I use the subversion repository on my own server.  You can use, for example, any free repository like GitHub or bitbucket. </li><li>  An assembly server or a continuous integration server (Continuous integration server).  This article uses Jenkins.  But there are other good options.  This server should be able to build C ++ projects.  You also need the xUnit plugin. </li><li>  Any development environment on your desktop.  In this article I use Netbeans 7.3 C ++ edition. </li><li>  C ++ compiler.  I am using gcc. </li></ul><br><br>  Just a few words why Netbeans.  This development environment is the only one that includes integration with version control systems and unit test support for C / C ++ at the IDE level.  This does not mean that other IDEs cannot be used to create unit tests, this means that it may be slightly easier <b>to start</b> developing unit tests in this IDE than with other IDEs.  That is, easier for beginners. <br><br>  In order for me not to shower tomatoes on Windows and Visual Studio, I would like to make a reservation that Visual Studio in this sense, they say, is very good.  But I do not use Windows. <br><br><h4>  Create a HelloWorld project </h4><br><br><ol><li>  Optional.  I recommend creating a new repository, if you have such an opportunity.  The principle of "one project - one repository" is a very good principle, in my opinion. </li><li>  Get a local copy of the repository you are using.  For subversion it is checkout, for git and mercurial it is clone. </li><li>  Create a folder for the project in the repository (this is if you do not have a separate repository).  In my case, this is the 'unittests' folder in the svn repository. </li><li>  Launch Netbeans: <br><img src="https://habrastorage.org/getpro/habr/post_images/117/8cc/ed4/1178cced4c804c44150560db58e631a4.png" alt="image"></li><li>  Create a new project: menu File -&gt; New Project. </li><li>  Select "C / C ++ Application" as the project type </li><li><img src="https://habrastorage.org/getpro/habr/post_images/bd3/fc4/f44/bd3fc4f44e76612155c2758f16532c75.png" alt="image"></li><li>  Specify the name of the project (I have 'helloworld'), and the project location (Project Location) in which it will be (in my screenshot this is the same folder that I received from the subversion server. In the 'Project Folder' field you will get the full path where the resulting project will be stored. The remaining fields can be left unchanged. <br><img src="http://s3-eu-west-1.amazonaws.com/risik/images/articles/habr-cppunit/netbeans-basic/Screenshot03.png" alt="image"></li><li>  Click on the 'Finish' button. </li><li>  After this, a project with a single source file will be created. <br><img src="https://habrastorage.org/getpro/habr/post_images/6d7/413/345/6d7413345fe0f0ea5402af289fb109aa.png" alt="image"></li><li>  Please note that in the file list, the file 'main.cpp' is marked in green.  This color marks new files that are missing in the repository. </li><li>  Select in the main menu: Team -&gt; Subversion -&gt; Show Changes (you can right-click on this file and select Subversion -&gt; Show Changes in the popup menu, but in the future I will write an option through the main menu).  At the bottom of the screen there is a list of changed files (for now this is only main.cpp). <br><img src="https://habrastorage.org/getpro/habr/post_images/431/68e/6da/43168e6dabd06c4043b95e38ec16730b.png" alt="image"><br></li><li>  You can right-click on this file and see, for example, diff.  Although this is not yet interesting, since the repository was still empty. <br><img src="https://habrastorage.org/getpro/habr/post_images/779/c9b/785/779c9b7852b23051e9ba402be97c50f6.png" alt="image"><br></li><li>  Let's change the changes.  Select the root in the project tree and in the main menu: Team -&gt; Subversion -&gt; Commit.  As we see here, Netbeans will create the 'helloworld' folder in the repository and the main.cpp file in it.  And also all the project files.  Here you can (need) add a comment to the commit. <br><img src="https://habrastorage.org/getpro/habr/post_images/d5d/850/171/d5d850171ccc9434c2934c76f5bea665.png" alt="image"></li><li>  Please note that after the commit in the list of files main.cpp became black.  That is, there are no changes in this file. </li><li>  It would be nice to try to build and run the resulting project.  Press the Play button (or the main menu Run -&gt; Run Project, or simply F6).  If everything is normal, then after the assembly you will see a message like: ‚ÄúRUN FINISHED;  exit value 0;  real time: 0ms;  user: 0ms;  system: 0ms " </li><li>  If this does not happen, then most likely there is some problem with the settings of the PATH environment variable or the lack of libraries.  Look carefully at the messages you receive. </li><li>  Add a message type to the main function: <br><pre><code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>;</code> </pre> <br></li><li>  And add a header file connection: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt;</span></span></span></span></code> </pre><br></li><li>  Run again, F6. </li><li>  Note that the added lines are highlighted with a green highlight to the left of the line, and the modified file in the file list is now blue.  In fact, modern IDEs are very good clients for version control systems.  If you study the features that are available in the Team menu, then it is possible that for some of the version control systems you can refuse to use third-party version control clients. <br></li><li>  Now diff files look more fun. <br><img src="https://habrastorage.org/getpro/habr/post_images/716/85f/a7e/71685fa7e2028f05d18e37ce47c99f21.png" alt="image"></li><li>  Let's make this change as well. </li></ol><br><br><h4>  Build from the command line </h4><br><br>  In order to do the automatic assembly, we need some kind of assembly script for the assembly from the command line.  A good option would be a 'makefile' (although I know people who prefer to build C ++ projects with 'ant').  If you know well how to create it, then do it and do not read this paragraph further.  And if you are a beginner, you need to come up with something. <br><br>  Creating a makefile is a separate large topic that does not fit into the scope of this article.  Therefore, we will go the easiest way for us.  Netbeans keeps its project, in fact, in the form of a makefile (but also with a bunch of additional files).  We will use it as the makefile. <br><br>  Generally speaking, the question of whether to store project files in the repository or not is a very controversial issue.  I think not.  But the build script must be in the repository.  The Netbeans project in this case is such a compromise.  Since, as I said, the Netbeans project files are, in fact, an assembly script.  Not the best, but still an assembly script. <br><br><ol><li>  Open a terminal (cmd.exe or FAR for Windows users). </li><li>  Go to the project folder ('/ home / risik / work / unittests / helloworld' for me). </li><li>  Run the command 'make clean' from the command line, and then 'make' </li><li>  If you had no problems building a project from Netbeans, then there should be no problems. </li><li>  It is these files that we committed earlier together with the project files.  But you, for some reason, did not do this, then this is the time to do it. </li><li>  From Netbeans: right-click on a project, and further: Subversion -&gt; Commit.  However, it seems there is a slight error in Netbeans.  Among other files in my project folder there is a file called '.dep.inc', which is needed for correct handling of dependencies.  You can do without it - the assembly works, but it is better to add it now manually. </li><li>  The second option is from the command line or what you usually use to work with your version control system. </li></ol><br><br>  I got the following list of files: <br>  project root: <br><ul><li>  Makefile </li><li>  .dep.inc </li></ul><br>  nbproject folder: <br><ul><li>  Makefile-Debug.mk </li><li>  Makefile-Release.mk </li><li>  Makefile-impl.mk </li><li>  Makefile-variables.mk </li><li>  Package-Debug.bash </li><li>  Package-Release.bash </li><li>  configurations.xml </li><li>  project.xml </li></ul><br>  folder nbproject / private: <br><ul><li>  Makefile-variables.mk </li><li>  configurations.xml </li><li>  private.xml </li></ul><br><br><h4>  Jenkins Initial Setup </h4><br><br><ol><li>  Open Jenkins in your browser (in my screenshots it is located at 192.168.1.109:8080/jenkins). </li><li>  Create a new task (Jenkins - New Job) </li><li>  Specify a name for the task and select the task type ‚ÄúBuild a free-style software project‚Äù. <br><img src="https://habrastorage.org/getpro/habr/post_images/3c0/16d/53e/3c016d53eed9047ee6efe37ab950101e.png" alt="image"><br></li><li>  Set the configuration, similar to that shown in the screenshots. <br><img src="https://habrastorage.org/getpro/habr/post_images/acb/fef/591/acbfef591be44af5edd0cdccb8ba5f2b.png" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/979/d5e/3c9/979d5e3c93e30c90c7a08af129085dba.png" alt="image"><br></li><li>  Let us consider in more detail the fields that should be modified. <br>  - Job title.  I just called it - helloworld-cpp <br>  - In the 'Source Code Management' section, specify the type of version control system used.  I have this 'Subversion'. <br>  - Additional fields are different for different systems of version control, for SVN the most important of them is the URL of the repository. <br>  - Attention: when you ask this URL, then most likely, your Jenkins will say something like "I can not connect to the repository."  At the end of a long red trace of the log you can find the words: "(Maybe you need to enter credential?)" And a link to enter your login and password.  Enter your login and password for the repository, and Jenkins will remember it.  Another option is to specify a username and password directly in the URL.  Or the third option is to place the authentication information right in the user's home folder under which Jenkins works. <br>  - In the 'Build Triggers' section, I indicated the SCM build.  That is, the assembly is scheduled.  '* / 15 * * * *' means build every 15 minutes. <br>  - Note: it is generally better to use push assembly by trigger from your version control system instead of SCM, but creating this configuration is beyond the scope of the article. <br>  - In the 'Build' section, add a new build step of the 'Execute Shell' type.  If your Jenkins works on Windows and you do not have cygwin installed on this server (and how do you live, if so?), Then it may be better to select the 'Execute Windows Batch Command' option. <br></li><li>  Click the save button and let's try building a project. </li><li>  I fell it.  The problem is easily localized if you look at the 'Console Log': <br><pre> <code class="hljs pgsql">Started <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> anonymous Building <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> workspace /var/lib/jenkins/jobs/helloworld-cpp/workspace Checking <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> a fresh workspace because ther<span class="hljs-string"><span class="hljs-string">e's no workspace at /var/lib/jenkins/jobs/helloworld-cpp/workspace Cleaning local Directory . Checking out https://sergeyborisov.com/svn/teach/kcup_unittests/helloworld at revision '</span></span><span class="hljs-number"><span class="hljs-number">2013</span></span><span class="hljs-number"><span class="hljs-number">-02</span></span><span class="hljs-number"><span class="hljs-number">-25</span></span>T01:<span class="hljs-number"><span class="hljs-number">37</span></span>:<span class="hljs-number"><span class="hljs-number">54.054</span></span> +<span class="hljs-number"><span class="hljs-number">0700</span></span><span class="hljs-string"><span class="hljs-string">' A main.cpp A nbproject A nbproject/Makefile-Release.mk A nbproject/Makefile-impl.mk A nbproject/Package-Release.bash A nbproject/project.xml A nbproject/Makefile-Debug.mk A nbproject/Makefile-variables.mk A nbproject/configurations.xml A nbproject/private A nbproject/private/Makefile-variables.mk A nbproject/private/configurations.xml A nbproject/private/private.xml A nbproject/Package-Debug.bash A Makefile U . At revision 132 [workspace] $ /bin/sh -xe /tmp/hudson8376440745271858508.sh + make all /tmp/hudson8376440745271858508.sh: 2: /tmp/hudson8376440745271858508.sh: make: not found Build step '</span></span><span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span> shell<span class="hljs-string"><span class="hljs-string">' marked build as failure Finished: FAILURE</span></span></code> </pre><br></li><li>  Well, everything is simple.  I did not have the server command 'make'. </li><li>  And after the second iteration, I learned that I was missing g ++.  Well, it is also easy to eliminate. </li><li>  Only the third time, everything turned out well. <br><pre> <code class="hljs pgsql">Started <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> anonymous Building <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> workspace /var/lib/jenkins/jobs/helloworld-cpp/workspace Updating https://sergeyborisov.com/svn/teach/kcup_unittests/helloworld at revision <span class="hljs-string"><span class="hljs-string">'2013-02-25T01:42:03.200 +0700'</span></span> At revision <span class="hljs-number"><span class="hljs-number">132</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> change <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> https://sergeyborisov.com/svn/teach/kcup_unittests/helloworld since the previous build [workspace] $ /bin/sh -xe /tmp/hudson8326466894395366933.sh + make <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> CONF <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Release</span></span> ; \ <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> \ "make" -f nbproject/Makefile-${CONF}.mk QMAKE= SUBPROJECTS= .build-conf; \ done make[<span class="hljs-number"><span class="hljs-number">1</span></span>]: Entering directory `/var/lib/jenkins/jobs/helloworld-cpp/workspac<span class="hljs-string"><span class="hljs-string">e' "make" -f nbproject/Makefile-Debug.mk dist/Debug/GNU-Linux-x86/helloworld make[2]: Entering directory `/var/lib/jenkins/jobs/helloworld-cpp/workspace'</span></span> mkdir -p build/<span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span>/GNU-Linux-x86 rm -f build/<span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span>/GNU-Linux-x86/main.od g++ -c -g -MMD -MP -MF build/<span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span>/GNU-Linux-x86/main.od -o build/<span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span>/GNU-Linux-x86/main.o main.cpp mkdir -p dist/<span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span>/GNU-Linux-x86 g++ -o dist/<span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span>/GNU-Linux-x86/helloworld build/<span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span>/GNU-Linux-x86/main.o make[<span class="hljs-number"><span class="hljs-number">2</span></span>]: Leaving directory `/var/lib/jenkins/jobs/helloworld-cpp/workspac<span class="hljs-string"><span class="hljs-string">e' make[1]: Leaving directory `/var/lib/jenkins/jobs/helloworld-cpp/workspace'</span></span> make[<span class="hljs-number"><span class="hljs-number">1</span></span>]: Entering directory `/var/lib/jenkins/jobs/helloworld-cpp/workspac<span class="hljs-string"><span class="hljs-string">e' "make" -f nbproject/Makefile-Release.mk dist/Release/GNU-Linux-x86/helloworld make[2]: Entering directory `/var/lib/jenkins/jobs/helloworld-cpp/workspace'</span></span> mkdir -p build/<span class="hljs-keyword"><span class="hljs-keyword">Release</span></span>/GNU-Linux-x86 rm -f build/<span class="hljs-keyword"><span class="hljs-keyword">Release</span></span>/GNU-Linux-x86/main.od g++ -c -O2 -MMD -MP -MF build/<span class="hljs-keyword"><span class="hljs-keyword">Release</span></span>/GNU-Linux-x86/main.od -o build/<span class="hljs-keyword"><span class="hljs-keyword">Release</span></span>/GNU-Linux-x86/main.o main.cpp mkdir -p dist/<span class="hljs-keyword"><span class="hljs-keyword">Release</span></span>/GNU-Linux-x86 g++ -o dist/<span class="hljs-keyword"><span class="hljs-keyword">Release</span></span>/GNU-Linux-x86/helloworld build/<span class="hljs-keyword"><span class="hljs-keyword">Release</span></span>/GNU-Linux-x86/main.o make[<span class="hljs-number"><span class="hljs-number">2</span></span>]: Leaving directory `/var/lib/jenkins/jobs/helloworld-cpp/workspac<span class="hljs-string"><span class="hljs-string">e' make[1]: Leaving directory `/var/lib/jenkins/jobs/helloworld-cpp/workspace'</span></span> Finished: SUCCESS</code> </pre><br></li></ol><br><br><h4>  Creating tests in Netbeans </h4><br>  For now, leave Jenkins alone and go back to Netbeans.  To begin with, we modify our project a little.  In order for it to have at least something that can be tested, let the welcome line form a separate class. <br><br><ol><li>  Right-click on 'Source Files' and select New -&gt; C ++ Class from the context menu. </li><li>  In the class creation dialog, specify the name of a new class, for example, Helloer (forgive me for this name, but I could not think of what to call it).  In general, it would be right here to set the folder for the new file.  Well, at least 'src'.  But I was too lazy. <br><img src="https://habrastorage.org/getpro/habr/post_images/564/c73/f92/564c73f927ab98d9ef452babcbf3214e.png" alt="image"></li><li>  A list of files will appear in the file list ‚Äî Helloer.cpp and Helloer.h.  In Netbeans, they are created in one folder, and in other IDEs they can be created in two separate folders, for example, 'src' and 'include'. </li><li>  As you can see, the constructor without parameters, copy constructor and <b>virtual</b> destructor are created automatically. </li><li>  First, we commit to what was generated, and then add what we need. <img src="https://habrastorage.org/getpro/habr/post_images/83a/c5e/a7f/83ac5ea7f59458656850083913721b29.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/e5a/ec4/bc4/e5aec4bc464c42bc748b8359f2f31295.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/0ef/02f/4de/0ef02f4def2c6b73b5d98335bbb3377e.png" alt="image"></li><li>  That is, I added to the Helloer class a constructor with a string, as a parameter, which will indicate who exactly we will greet.  And also added a method for receiving a greeting message. </li><li>  Check out the changes.  Please note that the project files have also been modified, they must also be committed. </li><li>  Open Helloer.h, right-click inside the file and select Create Test -&gt; Create CppUnit Test. </li><li>  In the dialog that appears, select the items to be tested.  I selected only the message method. <img src="https://habrastorage.org/getpro/habr/post_images/3bc/0b8/9f8/3bc0b89f8e54dab2343d81541fbc441f.png" alt="image"></li><li>  In the next dialog, enter the name of the test.  By the way, if Netbeans did not find the required library (cppunit), he will tell you about it here.  I have this package libcppunit-dev. <br><img src="https://habrastorage.org/getpro/habr/post_images/412/a43/477/412a4347732256b15894dabc3b505655.png" alt="image"></li><li>  That's what I did after generating the tests. <img src="https://habrastorage.org/getpro/habr/post_images/eb4/393/09f/eb439309f2c1aa29c4beeb22c0eb74b5.png" alt="image"></li><li>  The HelloWorldTests branch appeared in the project structure - this is the name I gave to the whole group of tests in the test configuration dialog.  And in it, the test run module of this group (Runner), which I have called 'HelloWorldTestRunner.cpp' and so far the only test class is HelloerTest (.cpp + .h). </li><li>  Let's try to run.  Menu Run -&gt; Test Project.  uh ... I got a file ‚Äî the unit tests didn't come together.  Since there was no header file 'Helloer.h'.  Well, here it is simple - you need to add the path to the file.  To do this, call the context menu on the HelloWorldTests test group and select the Properties item.  You will see the project folder properties dialog. <img src="https://habrastorage.org/getpro/habr/post_images/fea/7fe/d81/fea7fed81a35975aa49709114d725d57.png" alt="image"></li><li>  In this dialog, in the 'C ++ Compiler' section, find the 'Include Directories' item and click the '...' button on the right. </li><li>  In the 'Include Directories' dialog that appears, click the 'Add' button <img src="https://habrastorage.org/getpro/habr/post_images/317/b9b/783/317b9b783e5f0a48cbae50e0432d1670.png" alt="image"></li><li>  Finally, select the folder where your header file is located.  Since this file is part of the project, the path to the file should be stored in a relative form, which is indicated in the right part of the dialog.  Since I was too lazy to create even the 'src' folder when I created the Helloer class, I‚Äôll have this folder as the project folder.  That is, the folder '.'. <img src="https://habrastorage.org/getpro/habr/post_images/54c/3d8/176/54c3d81763184f7fc180af717fc06711.png" alt="image"></li><li>  Close the properties dialog and try to run the unit test again. </li><li>  This time he got ready, started, but fell, on Assertion. <img src="https://habrastorage.org/getpro/habr/post_images/6e2/273/420/6e227342079352a068774b5892b83f51.png" alt="image"></li><li>  However, I immediately commited, everything that was generated.  And now I will correct the test: <br><img src="https://habrastorage.org/getpro/habr/post_images/784/f31/74f/784f3174feb86ad2d852c64317c6be7a.png" alt="image"></li><li>  And the changes are also commited.  Please note that you need to commit not only source code, but also project files. </li><li>  Open the file 'HelloWorldTestRunner.cpp' if you look closely, its structure is simple and clear: <br>  - Prepare the test run. <br>  - We chase them. <br>  - We print the result. </li><li>  Netbeans generated print results in the 'compiler compatible' format.  This is a very convenient format for working with Netbeans, but an inconvenient format for Jenkins.  Therefore, I will also add printing in XML format: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">ofstream </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xmlFileOut</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"cpptestresults.xml"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">XmlOutputter </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xmlOut</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&amp;result, xmlFileOut)</span></span></span></span>; xmlOut.write();</code> </pre></li><li>  Naturally you need to include the necessary header files: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;cppunit/XmlOtputter.h&gt; #include &lt;ostream&gt;</span></span></span></span></code> </pre></li><li>  Note: print in XML format, not instead of text, but with text. </li><li>  The file name (‚Äúcpptestresults.xml‚Äù for me) and the path to it could have been chosen by another.  But most importantly, what would you know what.  We will need this information soon. </li></ol><br><br><h4>  Customize the run of autotests in Jenkins </h4><br><ol><li>  I opened the browser with Jenkins and I see that he has already done several assemblies.  After all, I pointed out to him the SCM build every 15 minutes.  And consequently, if at the next check, which is carried out every 15 minutes, as you might guess, there were new commits to the repository, then Jenkins collected the project.  Well, since I wrote it all leisurely, he found reasons for a couple of runs :) </li><li>  There is an important nuance here.  If the system time of the server with your repository and the system time of the server with Jenkins diverge, then you can get very strange effects.  For example, Jenkins will refuse to recognize that possible modifications to the source text in the future.  Therefore, I highly recommend setting up time synchronization on all servers and best of all on a common ntp server.  Yes, and your desktop would be good to synchronize in the same way. </li><li>  Add ‚ÄúPost build action‚Äù to the job, for example: <br><img src="https://habrastorage.org/getpro/habr/post_images/22d/830/243/22d8302435856c96de60094251a828ef.png" alt="image"><br></li><li>  We try to collect.  and voila!  Everything is collected and the test is passed!  And you in the build have information about the passed tests: <br><img src="https://habrastorage.org/getpro/habr/post_images/0be/3d7/bb3/0be3d7bb3154603a4393a150e5fa8003.png" alt="image"></li><li>  And after collecting again in the job schedule will appear.  Well, while I have it like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/4c3/e3c/5f8/4c3e3c5f864c6ae42d8f23ec6c333918.png" alt="image"></li><li>  But in the 'Latest Tests Results' you can see more detailed information about all passed and failed tests (so far the only one): <br><img src="https://habrastorage.org/getpro/habr/post_images/6e1/362/43a/6e136243adf9e714dccc653ced00f365.png" alt="image"></li><li>  Do not be embarrassed that you see (root) in the table of the general list of tests.  Jenkins is designed for Java.  And here should have been the names of the packages. </li><li>  Let's do one more test.  At the same time, we will immediately bear in mind a slight modification of the functionality: If there is nobody to greet (the 'who' line is not set), then there is no need to say any greetings. </li><li>  That is, we must add the following lines to the header file: <br><img src="https://habrastorage.org/getpro/habr/post_images/cff/b0b/225/cffb0b2256eba4576ee6e416cc5c1705.png" alt="image"></li><li>  and this method to the .cpp file: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> HelloerTest::testMessageNobody() { Helloer helloer; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> result = helloer.message(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-comment"><span class="hljs-comment">/*check result*/</span></span>) { CPPUNIT_ASSERT(result == <span class="hljs-string"><span class="hljs-string">""</span></span>); } }</code> </pre></li><li>  commit  And now either we are waiting for the next launch of the assembly via SCM or we start the assembly manually. </li><li>  Now we see that we have a fallen test! <br><img src="https://habrastorage.org/getpro/habr/post_images/d8b/a99/afb/d8ba99afb7d2d31e273f9a29e1945632.png" alt="image"></li><li>  True, the assembly is still marked as successful.  We return to this issue later. </li><li>  But the trend has become prettier: <br><img src="https://habrastorage.org/getpro/habr/post_images/f87/525/fdf/f87525fdf0703b85ba475c15838eabf4.png" alt="image"></li><li>  Fix the resulting test fail: <br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">string</span></span> Helloer::message() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (who.length() == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>)<span class="hljs-string"><span class="hljs-string">"Hello "</span></span> + who; }</code> </pre><br></li><li>  And again run the tests in the IDE.  Now everything is OK.  Let's finish it, collect Jenkins on the side and see that everything is fine there too (I managed to get through the assembly with the still broken dough). <br><img src="https://habrastorage.org/getpro/habr/post_images/9b1/783/d2d/9b1783d2d1697aa4580cf1c0050002f6.png" alt="image"></li><li>  A few words about the status of the assembly.  Jenkins allows you to configure the formation of the status is quite flexible.  This configuration can be seen in the setting of the xUnit step in the job - the 'Failed Tests' and 'Skipped Tests' methods.  How it will be better specifically for you - I do not know.  But I believe that every new test that has fallen should result in a breakdown of the assembly, that is, the assembly should be marked as red.  But those tests that were broken earlier, should lead to a "yellow status."  Experiment! </li></ol><br>  Well that's all!  If you still got here through all the steps, and not just scrolled to the bottom of the page, then you have taken the first step in automating the run of the unit tests in your C ++ project.  And the first step to TDD.  Good luck! <br><br><h4>  Links </h4><br><ul><li>  Using Hudson for C ++ / CMake / CppUnit: <a href="http://schneide.wordpress.com/2008/09/29/using-hudson-for-ccmakecppunit/">schneide.wordpress.com/2008/09/29/using-hudson-for-ccmakecppunit</a> Here I looked at how to save the test results in XML </li><li>  How to Add Unit Tests to Existing C / C ++ Projects in the Oracle Solaris Studio IDE.  by Nik Krasilnikov.  <a href="http://www.oracle.com/technetwork/articles/servers-storage-dev/howto-add-unittests-ide-1731716.html">www.oracle.com/technetwork/articles/servers-storage-dev/howto-add-unittests-ide-1731716.html</a> - Tutorial on creating unit tests in Netbeans. </li><li>  Adding Unit Tests to a C Project - NetBeans IDE Tutorial.  Contributed by Susan Morgan.  <a href="http://netbeans.org/kb/docs/cnd/c-unit-test.html">netbeans.org/kb/docs/cnd/c-unit-test.html</a> - Another tutorial on creating unit tests in Netbeans. </li><li>  UnitTesting.  <a href="http://wiki.codeblocks.org/index.php%3Ftitle%3DUnitTesting">wiki.codeblocks.org/index.php?title=UnitTesting</a> - Tutorial on creating unit tests in code :: blocks.  Alas, in the code :: blocks everything is not so simple and transparent at the start, as in Netbeans. </li></ul><br><h4>  License </h4><br> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US"><img alt="Creative Commons License" src="https://habrastorage.org/getpro/habr/post_images/b19/f14/bf8/b19f14bf830a4eecadc0e9ecab09618b.png"><br></a> <br>  The article " <a href="http://habrahabr.ru/post/170847/">Unit Testing and Continuous Integration with Jenkins for C ++ Projects</a> " by <a href="http://risik.info/">Sergey Borisov (AKA risik)</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a> . </div><p>Source: <a href="https://habr.com/ru/post/170847/">https://habr.com/ru/post/170847/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../170829/index.html">Configuring Kerberos authentication using smart cards</a></li>
<li><a href="../170831/index.html">Come to experience new flash storage systems for data centers</a></li>
<li><a href="../170835/index.html">Anyone can program at any age.</a></li>
<li><a href="../170843/index.html">Enthusiasts ported Ubuntu for 24 smartphones and tablet PCs</a></li>
<li><a href="../170845/index.html">PyCon is gone</a></li>
<li><a href="../170849/index.html">Elastix - Asterisk as an emergency voice alert system</a></li>
<li><a href="../170851/index.html">Comparison of css3 & html5 (v 2.0) browsers</a></li>
<li><a href="../170853/index.html">Canon has released mixed reality glasses</a></li>
<li><a href="../170857/index.html">The announcement of the new generation of PaaS and cloud architecture for developers</a></li>
<li><a href="../170861/index.html">ASUS Transformer Book TX300CA Review</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>