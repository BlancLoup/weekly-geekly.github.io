<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>FB2 Backend to AsciiDoc</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prehistory 

 I initially had a complex relationship with the FictionBook 2 format: at first I did not recognize it, then I allowed it as the source m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>FB2 Backend to AsciiDoc</h1><div class="post__text post__text-html js-mediator-article"><h4>  Prehistory </h4><br><br>  I initially had a complex relationship with the FictionBook 2 format: at first I did not recognize it, then I allowed it as the source material for the formation of my books, later, with the development of the format and related tools, it became the basis of my library. <br><br>  Naturally, one of the first tasks was the problem of converting to this format.  Of all the existing tools, none of them suited me, and for ordinary works of art it was easier and faster for me to do it in my usual text editor (jEdit or VIM). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Small difficulties for me were: a) document description - this was solved by using a template;  b) images - it was usually a cover and could be added using FB Editor (first);  c) footnotes - they met infrequently, little by little, and, in principle, knowing the format, they were added without any particular difficulty. <br><br>  Some time ago, a converter from FB2 to PDF from KiR appeared, besides being a great tool for getting pdf of good, almost publishing quality, it was an example of using the DocBook format, which I heard a lot about, but could not start Collect all the necessary tools together. <br><br>  DocBook, like FictionBook, is an XML-based format.  And as for FictionBook, it is not very convenient to edit in its natural format, but, fortunately, there is a utility such as <b>asciidoc</b> , which allows you to create a corresponding DocBook, html or other document from a text file with fairly simple markup. <br><br><h4>  Creating fb2-backend </h4><br><br>  As already mentioned, the current situation completely satisfied me: I do not read very often, and the process of preparing the book also brings me pleasure.  But when I wanted to transform a non-fiction, but a popular science book with a lot of illustrations and footnotes, some difficulties (b) and c) were quite significant.  And the thought crept into my head to adapt asciidoc to the formation of books in the FictionBook format. <br><br><a name="habracut"></a><br><br>  In a way I managed it.  The resulting tool allowed us to draw up the book "Why we do not fall through the floor" by James Gordon in just a day (not counting proofreading) with a sufficiently large comfort and ease. <br><br>  Positive qualities (IMHO): <br><ol><li>  Text file as a source: ease of reading, no markup, compactness, familiarity; </li><li>  Convenient addition of footnotes: the text of the footnotes is at the place which he explains; </li><li>  Convenient addition of images: the file name is indicated, and the addition of the corresponding sections in the fb2 file rests on the backend. </li></ol><br><br>  Negative qualities: <br><ol><li>  Asciidoc is intended to form a DobBook, which is richer in terms of a set of tags: this, in particular, leads to the fact that asciidoc sometimes detects formatting that is not in FictionBook and creates an incorrect fb2 file.  In such situations, it is necessary to know the asciidoc markup language and how to disable it; </li><li>  There is no direct support for poems and other lyrics: I did not manage to make such a setting, I think it is possible, but they are not often met with me, and you can get by with a direct insertion (see the attached example); </li><li>  Images can only be <b>jpg</b> and <b>png</b> formats: this is an arbitrary restriction and can be easily expanded; </li><li>  Images should be in the same place as the source text: it was easier this way; </li><li>  You need to personally make sure that the sections are either with text or with other sections: DobBook does not have this restriction, and therefore there is no automatic control; </li><li>  References to parts of the text are not implemented: in this place DocBook and FictionBook are similar, so if there is a need, it can be easily organized, but so far there is no need; </li><li>  The source text must be utf-8 encoded; </li><li>  The names of the images in the text and on the disk must match up to the register. </li></ol><br><br><h4>  Approximate scheme of fb2-backend </h4><br><br>  The application was scammed "hastily" as an auxiliary, to achieve the goal: a set of one book - from this follows all the inflexibility that is inherent in it. <br><br>  The entire application is assembled as a set of simple scripts combined by the <b>txt2fb2.bat</b> command file. <br><br>  So, what happens after calling txt2fb2.bat SourceFile.txt: <br><ol><li>  Called asciidoc with fb2 backend.  Its result is something similar in structure to FictionBook 2, but requiring further refinement: adding images, bringing footnotes to the end; </li><li>  There is a preparation of images.  For all images in <b>jpg</b> and <b>png</b> formats, a companion file with the .b64 extension is created (this is actually the &lt;binary&gt; element that can be placed in the resulting fb2 file).  It is at this stage that an arbitrary restriction on graphic file formats arises. </li><li>  FictionBook 2 is <b>debugged with the</b> xslt-script <b>adjust_fb2.xsl</b> .  At this stage, the ‚ÄúAbstract‚Äù and ‚ÄúDocument History‚Äù sections fall into the right places of the title.  Footnotes are highlighted and taken to the end.  Images from the files obtained in step 2 are added. </li></ol><br><br>  The resulting fb2 file must be checked with a validator. <br><br><h4>  Additional formatting </h4><br><br>  I recommend reviewing the documentation on asciidoc to familiarize yourself with the permissible markup, and also to look at the book that I attach as a sample. <br><br>  For convenience of converting to the fb2 format, some asciidoc markup extensions have been introduced, which I will describe here. <br><br><h5>  Document title </h5><br><br>  Many parameters are defined using document attributes: <br> <code>:genre:                 sf -- &lt;br&gt; <br> :firstname:               &lt;br&gt; <br> :middlename:              &lt;br&gt; <br> :lastname:                &lt;br&gt; <br> :nickname:                &lt;br&gt; <br> :date:                  2009 --   &lt;br&gt; <br> :lang:                  ru --  &lt;br&gt; <br> :src-lang:              en --  &lt;br&gt; <br> :coverpage-image:       Cover.png --  &lt;br&gt; <br> :sequence-name:         Malazan Book of the Fallen --  &lt;br&gt; <br> :sequence-number:       6 --   &lt;br&gt; <br> :translator-firstname:   --  &lt;br&gt; <br> :translator-middlename:  --  &lt;br&gt; <br> :translator-lastname:    --  &lt;br&gt; <br> :document-firstname:    Stas --   &lt;br&gt; <br> :document-lastname:     Bushuev --   &lt;br&gt; <br> :document-nickname:     Xitsa --   &lt;br&gt; <br> :document-date:         2009-05-07 --   &lt;br&gt; <br> :document-id:           Xitsa-7AD2-4B5F-92E5-892DEA3AE559 --  &lt;br&gt; <br> :document-version:      1.01 --  &lt;br&gt; <br> :program-used:          FB Tools, sed, VIM, Far, asciidoc+fb2 backend --     &lt;br&gt; <br></code> <br><br>  An annotation is any text that is between the title and the first section. <br><br>  Document history is described in the special section of the upper level: <br> <code>Document History <br> ---------------- <br></code> <br><br><h5>  Footnotes </h5><br><br>  AsciiDoc supports two types of footnotes: <b>footnote</b> and <b>footnoteref</b> , for correct formation of footnotes using fb2-backend, you only need to use footnoteref and only with numbers footnote numbering, but I chose to leave the possibility of repeated reference). <br><br>  Example: <br> <code> footnoteref:[3," ,  \"\",    "] <br> <br>        footnoteref:[3] <br></code> <br><br>  In asciidoc 8.4.5 for some reason they made it so that the footnoteref macro in front of which is not a space, but a significant character does not work, therefore in the example I posted, <b>asciidoc.conf is</b> fixed and does not match the original. <br><br><h5>  Additional macros </h5><br><br>  An additional author can be added using the macro macro author, unnecessary attributes can be omitted.  For example: <br><br> <code>author::[,,,Nickname] <br> author::[,] <br></code> <br><br>  In FictionBook there is a <b>subtitle</b> tag, which I did not find a counterpart in DocBook, so I implemented it using a macro: <br><br> <code>subtitle::[* * *] <br></code> <br><br>  The &lt;empty-line /&gt; tag can be inserted, if necessary, using the following macro, which should be a separate paragraph: <br><br> <code>empty::[] <br></code> <br><br><h5>  Quotes and epigraphs </h5><br><br>  Both quotes and epigraphs are distinguished from the text with underscores.  Attributes must either be in quotes or must not contain commas. <br><br>  Examples: <br> <code>["quote"," ",""] <br> ____________________________________________________________ <br>     <br> ____________________________________________________________ <br> <br> ____________________________________________________________ <br>      <br> ____________________________________________________________ <br> <br> [epigraph,. . ,  ...] <br> ____________________________________________________________ <br> ++++++++++++++++++++++++++++++++++++++++ <br> &lt;poem&gt;&lt;stanza&gt;&lt;br&gt; <br> &lt;v&gt;   ,&lt;/v&gt;&lt;br&gt; <br> &lt;v&gt;   ...&lt;/v&gt;&lt;br&gt; <br> &lt;/stanza&gt;&lt;/poem&gt;&lt;br&gt; <br> ++++++++++++++++++++++++++++++++++++++++ <br>   ,      . <br> ____________________________________________________________ <br></code> <br><br><h4>  How to try </h4><br><br>  I have built a separate application that does not require installation, you can take it <a href="http://ifile.it/9012znx">here.</a> <br><br>  Immediately you can try running <b>txt2fb2.bat materials.txt</b> - this is a demo book that uses most of the asciidoc fb2 extensions. <br><br>  In the <b>doc</b> directory is the documentation for asciidoc, which is desirable to read. <br><br>  Linux users can take this <a href="http://ifile.it/paz68mh">file</a> and modify it with a file: <br><ol><li>  Install asciidoc 8.4.5 (and replace asciidoc.conf with mine (or take it from the trunk)); </li><li>  Set the python binding to libxml, or use xsltproc directly; </li><li>  Rewrite txt2fb2.bat in terms of the shell used. </li></ol><br><br><h4>  Further development </h4><br><br>  The project is at the alpha stage and is laid out in the hope that someone else will be interested or useful.  In this case, it will be possible to think about how to bring it into a decent look: with documentation, examples and refine. </div><p>Source: <a href="https://habr.com/ru/post/63734/">https://habr.com/ru/post/63734/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../63726/index.html">Hosting php 5.3</a></li>
<li><a href="../63727/index.html">Yeah! Buy DNA Upgrade at 50% discount!</a></li>
<li><a href="../63728/index.html">VirtualBox. Convenient switching between Host and Guest</a></li>
<li><a href="../63729/index.html">PC-BSD 7.1.1 Released</a></li>
<li><a href="../63732/index.html">To work on time</a></li>
<li><a href="../63739/index.html">Answer quoted on iPhone OS 3.0</a></li>
<li><a href="../63740/index.html">Great Baikal Trail</a></li>
<li><a href="../63741/index.html">What can motivate me to come to work by 10 am?</a></li>
<li><a href="../63749/index.html">Sayter.ru - comment on the Internet!</a></li>
<li><a href="../63750/index.html">Flip-chart session at PM Labs 2009 or half-price conference ticket</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>