<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OTRS 4.0.10. We put on Ubuntu + AD + Kerberos + SSO (Part Two)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I continue the story about how to actually install this beast on Ubuntu and set up a transparent domain authorization, plus how to fasten some nice bu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OTRS 4.0.10. We put on Ubuntu + AD + Kerberos + SSO (Part Two)</h1><div class="post__text post__text-html js-mediator-article">  I continue the story about how to actually install this beast on Ubuntu and set up a transparent domain authorization, plus how to fasten some nice buns available in the free version of OTRS. <br><br>  <a href="http://habrahabr.ru/post/264617/">Part One: System Preparation</a> <br>  <a href="http://habrahabr.ru/post/265537/">Part Two: Installing and Configuring OTRS</a> <br>  <a href="http://habrahabr.ru/post/265541/">Part three: fix the shoals fasten buns</a> <br><br><h4>  6. Installing and configuring OTRS </h4><br>  Well, the system is fully prepared, even more than we, with a clear conscience and a light heart, proceed to install directly OTRS. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  6.1.  The essence of the proposed method and the necessary packages </h5><br>  We will install the last stable version, at the moment it is 4.0.10, in fact it is not significant, because we initially went the canonically correct way and did not use any gaskets and crutches such as NTLM, SSPI and other adams, and raised the full-fledged Kerberos authentication.  And for it in the OTRS module <i>HTTPBasicAuth</i> is responsible, which has not undergone significant changes, so the described method will work on all versions of the system starting from at least 3.1.1. <br><br>  What is the essence of the method?  And the whole point is that OTRS in general does not perform any user authorization or authentication, but simply takes the name of the logged-in user from the <i>$ _ENV</i> environment variable <i>['Remote_User']</i> searches for it in its database and, if it finds it, opens the interface for it Custome in logged form.  That is, the entire burden of verification of the user falls on Apache‚Äôs shoulders, which the Kerberos mechanism authenticates the user and, if he succeeds, then drives his login into the environment variable.  Whence OTRS picks it up, considering that if there is something there, then the authentication has already been successful.  So let's get started. <br><br><a name="habracut"></a><br><br>  Excellent article about <a href="http://tokarchuk.ru/2014/08/otrs-install-auth-sso/">this here</a> .  The installation process is described in great detail. <br><br>  Everything related to domain authorization and pass-through authentication has been gathered around the world and worked out through trial and error, so I can‚Äôt give any links. <br><br>  Here is a list of packages that we will need at this stage: <br><ul><li>  libapache2-mod-perl2 </li><li>  libtemplate-perl </li><li>  libarchive-zip-perl </li><li>  libjson-xs-perl </li><li>  libmail-imapclient-perl </li><li>  libdbd-mysql-perl </li><li>  libnet-dns-perl </li><li>  libnet-ldap-perl </li><li>  libio-socket-ssl-perl </li><li>  libpdf-api2-perl </li><li>  libsoap-lite-perl </li><li>  libgd-text-perl </li><li>  libgd-graph-perl </li><li>  libapache-dbi-perl </li><li>  libyaml-libyaml-perl </li><li>  mysql-server </li><li>  wget </li></ul><br>  Most of them are already in the system or we have already installed them, but in order not to go through each one, we will just give the command to install everything, those that already exist will simply be skipped by the package manager and that's it.  So we execute <br><pre><code class="bash hljs">apt-get install libapache2-mod-perl2 libtemplate-perl libarchive-zip-perl libjson-xs-perl libmail-imapclient-perl libdbd-mysql-perl libnet-dns-perl libnet-ldap-perl libio-socket-ssl-perl libpdf-api2-perl libsoap-lite-perl libgd-text-perl libgd-graph-perl libapache-dbi-perl libyaml-libyaml-perl mysql-server wget</code> </pre> <br><h5>  6.2.  We put OTRS </h5><br>  As already mentioned above, we will install version 4.0.10, the last one at the time of this writing.  We swing OTRS itself: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~ wget http://ftp.otrs.org/pub/otrs/otrs-4.0.10.tar.gz</code> </pre><br>  Unpack the archive: <br><pre> <code class="bash hljs">tar zxf ./otrs-4.0.10.tar.gz</code> </pre><br>  Move the unpacked OTRS folder / opt: <br><pre> <code class="bash hljs">mv ./otrs-4.0.10 /opt</code> </pre><br>  And create a symlink to it in the same folder: <br><pre> <code class="bash hljs">ln -s /opt/otrs-4.0.10/ /opt/otrs</code> </pre><br>  Check whether we have put all the modules: <br><pre> <code class="bash hljs">perl /opt/otrs/bin/otrs.CheckModules.pl</code> </pre><br>  If we need some additional modules, we install (in the output of the previous command, there is a hint next to each module how to install it if it is not).  We get the user for OTRS: <br><pre> <code class="bash hljs">useradd -r -d /opt/otrs/ -c <span class="hljs-string"><span class="hljs-string">'OTRS user'</span></span> otrs</code> </pre><br>  And we include it in the www-data group: <br><pre> <code class="bash hljs">usermod -g www-data otrs</code> </pre><br>  Keep in mind: our machine is included in the domain and <i>winbind</i> binded all users in the local user base, so you need to make sure that there is no user in the domain with the login ‚Äú <i>otrs</i> ‚Äù.  If it is, delete it and reboot the Linux machine. <br><br>  We create default configs for OTRS: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /opt/otrs/Kernel cp Config.pm.dist Config.pm cp Config/GenericAgent.pm.dist Config/GenericAgent.pm</code> </pre><br>  And we set up rights for a newly created user: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /opt/otrs bin/otrs.SetPermissions.pl --otrs-user=otrs --web-group=www-data /opt/otrs</code> </pre><br>  It remains to create a vhost Apache for OTRS and you can configure the system: <br><pre> <code class="bash hljs">cp /opt/otrs/scripts/apache2-httpd.include.conf /etc/apache2/sites-available/otrs.conf</code> </pre><br>  Turn on vhost OTRS: <br><pre> <code class="bash hljs">a2ensite otrs</code> </pre><br>  And reread Apache configs: <br><pre> <code class="bash hljs">service apache2 reload</code> </pre><br>  Everything.  Installation is complete, now we can do the configuration OTRS. <br><br><h5>  6.3.  Initial configuration of the OTRS system.  LDAP Integration (in our case AD) </h5><br>  The initial configuration of the system takes place via the web interface.  Go to <i><a href="http://helpdesk/otrs/installer.pl">helpdesk / otrs / installer.pl</a></i> , see the OTRS installation wizard: <br><br><img src="https://habrastorage.org/files/9ce/d9a/f3d/9ced9af3d18e4950992b5e5ee0f036f6.png"><br><br>  We press further and see the license agreement, read it carefully and click ‚Äúaccepted conditions‚Äù. <br><br><img src="https://habrastorage.org/files/137/661/76d/13766176d3494a3d8825cae7c08d9f10.png"><br><br>  At the third stage, you need to select the database to use, in our case, the MySQL database, so click next.  Here it is more interesting, you need to enter the login of that MySQL user root @ localhost, we created this password in step 6, when we set up the Apache and MySQL server. <br><br>  OTRS will try to connect to the database server (localhost) and if everything is fine, it will create a database called otrs and user otrs, as well as with a very tricky password, we also remember it wherever we are in a notebook, just in case. <br><br><img src="https://habrastorage.org/files/8eb/f87/11b/8ebf8711b09a4d02b9dccdbcede1b2eb.png"><br><br>  We configure mail.  At the output, OTRS will report the password of the default user root @ localhost, remember its password. <br><br>  We follow the link ‚Äúhome page‚Äù and see invitations to log in, this is where we enter only the recorded username and password.  By and large, the OTRS installation is already complete, but this is not enough for us and we didn‚Äôt bother with Kerberos so much, we need integration with AD and pass-through authentication, so we go ahead. <br><br>  And then turn to the respected <a href="https://habrahabr.ru/users/rasa/" class="user_link">rasa</a> <a href="http://habrahabr.ru/post/125089/">manual</a> .  We will draw something from there, something from the Internet, and we will invent our own way. <br><br>  So for a start.  In the domain, there should be one user who completely coincides with the OTRS administrator, we will have it and read the LDAP and we will get the rest of the OTRS admins through it.  In my case, this is the <i>otrs.admin</i> user, by the way, for the installation period I gave him domain administrator rights and all domain manipulations, such as switching the machine into the domain, receiving tickets, etc., on behalf of this particular user, after installing these rights it can be selected, moreover, to prohibit him from logging into domain machines, he only needs to read information from LDAP, nothing more. <br><br>  And so, in the interface of the OTRS Agent, go to the ‚ÄúAdministration‚Äù tab, go to the ‚Äúagents‚Äù section and see the only agent, click on it and change its credentials in accordance with the data of the user in the domain, as I said above, in my case This is the login otrs.admin and the corresponding domain password, click ‚Äúsend‚Äù at the bottom of the page and try to log out and log in again with the new credentials. <br><br>  <b>!</b>  <b>ATTENTION!</b>  <b>To match the data of the domain user must not only login, but also the password!</b> <br><br>  Now turn off the possibility of self-registration bush.  <i>‚ÄúAdministration‚Äù - ‚ÄúSystem Configuration‚Äù - (in the drop-down list on the left, select ‚ÄúFramework‚Äù) - ‚ÄúFrontend :: Customer‚Äù</i> on the <i>CustomerPanelCreateAccount</i> <i>select</i> ‚ÄúNo‚Äù and click on the ‚ÄúUpdate‚Äù button below.  Here you can also correct the name of the organization that will be displayed at the bush meter in CustomerHeadline.  There are a lot of other settings that can be twisted and tried, but this is later, now we are interested in integration with LDAP. <br><br>  The OTRS integration with LDAP will be configured via the <i>/opt/otrs/Kernel/Config.pm</i> configuration file: <br><pre> <code class="bash hljs">mcedit /opt/otrs/Kernel/Config.pm</code> </pre><br>  We find the line <i># insert your own config settings ‚Äúhere‚Äù #</i> and insert the following config after it: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  LDAP    # #  LDAP      # $Self-&gt;{'AuthModule'} = 'Kernel::System::Auth::LDAP'; # IP  LDAP  # $Self-&gt;{'AuthModule::LDAP::Host'} = '192.168.10.1'; #   ,   LDAP # $Self-&gt;{'AuthModule::LDAP::BaseDN'} = 'dc=domain,dc=ru'; #        UID # $Self-&gt;{'AuthModule::LDAP::UID'} = 'sAMAccountName'; #   .      OTRSagents  OU organization # #       ,        # $Self-&gt;{'AuthModule::LDAP::GroupDN'} = 'cn=OTRSagents,ou=organization,dc=domain,dc=ru'; $Self-&gt;{'AuthModule::LDAP::AccessAttr'} = 'member'; $Self-&gt;{'AuthModule::LDAP::UserAttr'} = 'DN'; #     LDAP # $Self-&gt;{'AuthModule::LDAP::SearchUserDN'} = 'otrs.admin@domain.ru'; $Self-&gt;{'AuthModule::LDAP::SearchUserPw'} = '  otrs.admin'; #       LDAP# $Self-&gt;{'AuthModule::LDAP::AlwaysFilter'} = ''; $Self-&gt;{'AuthModule::LDAP::Params'} = { port =&gt; 389, timeout =&gt; 120, async =&gt; 0, version =&gt; 3, sscope =&gt; 'sub' }; #   LDAP    # #      LDAP # #     LDAP # $Self-&gt;{'AuthSyncModule'} = 'Kernel::System::Auth::Sync::LDAP'; # IP  LDAP  # $Self-&gt;{'AuthSyncModule::LDAP::Host'} = '192.168.10.1'; #  BaseDN # $Self-&gt;{'AuthSyncModule::LDAP::BaseDN'} = 'dc=domain, dc=ru'; #       UID # $Self-&gt;{'AuthSyncModule::LDAP::UID'} = 'sAMAccountName'; #     LDAP # $Self-&gt;{'AuthSyncModule::LDAP::SearchUserDN'} = 'otrs.admin@domain.ru'; $Self-&gt;{'AuthSyncModule::LDAP::SearchUserPw'} = '  otrs.admin'; #    # $Self-&gt;{'AuthSyncModule::LDAP::UserSyncMap'} = { UserFirstname =&gt; 'givenName', UserLastname =&gt; 'sn', UserEmail =&gt; 'mail', }; #    # $Self-&gt;{'AuthSyncModule::LDAP::UserSyncInitialGroups'} = [ 'users', 'basic_admin', ]; #      # #    # #   ,     HTTPBasicAuth # #  HTTPBasicAuth   # $Self-&gt;{'Customer::AuthModule'} = 'Kernel::System::CustomerAuth::HTTPBasicAuth'; #          # $Self-&gt;{CustomerPanelLoginURL1} = 'http://helpdesk.domain.ru/otrs/customer.pl'; $Self-&gt;{CustomerPanelLogoutURL1} = 'http://helpdesk.domain.ru/otrs/customer.pl'; #     # #       LDAP # #          # $Self-&gt;{CustomerUser} = { Module =&gt; 'Kernel::System::CustomerUser::LDAP', Params =&gt; { Host =&gt; '192.168.10.1', BaseDN =&gt; 'DC=domain,DC=ru', SSCOPE =&gt; 'sub', UserDN =&gt;'otrs.admin@domain.ru', UserPw =&gt; '  otrs.admin', AlwaysFilter =&gt; '(&amp;(samAccountType=805306368)(!(userAccountControl:1.2.840.113556.1.4.803:=2)))', SourceCharset =&gt; 'utf-8', DestCharset =&gt; 'utf-8', }, #    # #   ,   ,   # CustomerKey =&gt; 'sAMAccountName', CustomerID =&gt; 'mail', CustomerUserListFields =&gt; ['sAMAccountName', 'cn', 'mail'], CustomerUserSearchFields =&gt; ['sAMAccountName', 'cn', 'mail'], CustomerUserSearchPrefix =&gt; '', CustomerUserSearchSuffix =&gt; '*', CustomerUserSearchListLimit =&gt; 10000, CustomerUserPostMasterSearchFields =&gt; ['mail'], CustomerUserNameFields =&gt; ['givenname', 'sn'], Map =&gt; [ #              # #      # # , : Login, Email  CustomerID ! # [ 'UserFirstname', 'Firstname', 'givenname', 1, 1, 'var' ], [ 'UserLastname', 'Lastname', 'sn', 1, 1, 'var' ], [ 'UserLogin', 'Login', 'sAMAccountName', 1, 1, 'var' ], [ 'UserEmail', 'Email', 'mail', 1, 1, 'var' ], [ 'UserCustomerID', 'CustomerID', 'mail', 0, 1, 'var' ], [ 'UserPhone', 'Phone', 'telephonenumber', 1, 0, 'var' ], ], }; #   #</span></span></code> </pre><br>  After that, you can save the file and try to log in as an agent under the domain account, which is included in the OTRSagents group in the domain. <br><br>  Go to <i><a href="http://helpdesk.domain.ru/otrs/index.pl">helpdesk.domain.ru/otrs/index.pl</a></i> , enter the login and password of the domain account in the OTRSagents group.  Should all ride.  The newly logged agent will have no administration tab, you can enable it by logging in under the account of the original admin, in my case it is otrs.admin and having distributed access rights to the new agent. <br><br>  Please note: agents are created in the OTRS database after the first login. <br><br>  It is also necessary to check that OTRS pulled the Customers database from the LDAP.  To do this, go to <i>"Administration" - "Client Account"</i> .  Here we must see the full list of domain users in a table, login, name, email, etc. <br><br>  Check whether everything successfully pulled up from the domain. <br><br>  In order to access the Customers, a minor improvement is required, first of all, you need to enable Kerberos authentication on folders with scripts.  The scripts are here <i>/ opt / otrs / bin / cgi-bin.</i>  . <br><br>  Turning on Kerberos will require manipulations similar to those we performed in step 7 with the <i>/ var / www / html / php</i> folder.  Open the otrs virtual host config file: <br><pre> <code class="bash hljs">mcedit /etc/apache2/site-available/otrs.conf</code> </pre><br>  And we see the following configurations of the location <i>/ otrs</i> and directories <i>/ opt / otrs / bin / cgi-bin</i> .  The first piece: <br><pre> <code class="bash hljs">&lt;Location /otrs&gt; <span class="hljs-comment"><span class="hljs-comment"># ErrorDocument 403 /otrs/customer.pl ErrorDocument 403 /otrs/index.pl SetHandler perl-script PerlResponseHandler ModPerl::Registry Options +ExecCGI PerlOptions +ParseHeaders PerlOptions +SetupEnv &lt;IfModule mod_version.c&gt; &lt;IfVersion &lt; 2.4&gt; Order allow,deny Allow from all &lt;/IfVersion&gt; &lt;IfVersion &gt;= 2.4&gt; Require all granted &lt;/IfVersion&gt; &lt;/IfModule&gt; &lt;IfModule !mod_version.c&gt; Order allow,deny Allow from all &lt;/IfModule&gt; &lt;/Location&gt;</span></span></code> </pre><br>  And the second piece: <br><pre> <code class="bash hljs">&lt;Directory <span class="hljs-string"><span class="hljs-string">"/opt/otrs/bin/cgi-bin/"</span></span>&gt; AllowOverride None &lt;IfModule mod_version.c&gt; &lt;IfVersion &lt; 2.4&gt; Order allow,deny Allow from all &lt;/IfVersion&gt; &lt;IfVersion &gt;= 2.4&gt; Require all granted &lt;/IfVersion&gt; &lt;/IfModule&gt; &lt;IfModule !mod_version.c&gt; Order allow,deny Allow from all &lt;/IfModule&gt; &lt;IfModule mod_filter.c&gt; &lt;IfModule mod_deflate.c&gt; AddOutputFilterByType DEFLATE text/html text/javascript application/javascript text/css text/xml application/json text/json &lt;/IfModule&gt; &lt;/IfModule&gt; <span class="hljs-comment"><span class="hljs-comment"># Make sure CSS and JS files are read as UTF8 by the browsers. AddCharset UTF-8 .css AddCharset UTF-8 .js # Set explicit mime type for woff fonts since it is relatively new and apache may not know about it. AddType application/font-woff .woff &lt;/Directory&gt;</span></span></code> </pre><br>  At first glance, everything is very clear and simple, but again it was not possible to comprehend this shamanism with a swoop.  In a nutshell, certain directives are connected here depending on the presence or absence of certain Apache modules or on their versions.  The developers piled all this up because they did not know in advance what conditions the system would work with, which packages and which versions of these packages.  But we are with you already absolutely certain which packages and which versions we have in the system.  Therefore, just mercilessly cut out all unnecessary and bring these two blocks to the following form: <br><br>  The first piece: <br><pre> <code class="bash hljs">&lt;Location /otrs&gt; ErrorDocument 403 /otrs/index.pl SetHandler perl-script PerlResponseHandler ModPerl::Registry Options +ExecCGI PerlOptions +ParseHeaders PerlOptions +SetupEnv AuthType Kerberos AuthName <span class="hljs-string"><span class="hljs-string">"Kerberos Authntication"</span></span> KrbAuthRealms RUS.LOCAL Krb5Keytab /etc/httpd.keytab KrbMethodNegotiate On KrbSaveCredentials Off KrbVerifyKDC Off Require valid-user &lt;/Location&gt;</code> </pre><br>  The second piece: <br><pre> <code class="bash hljs">&lt;Directory <span class="hljs-string"><span class="hljs-string">"/opt/otrs/bin/cgi-bin/"</span></span>&gt; AllowOverride All Options +ExecCGI -Includes AuthType Kerberos AuthName <span class="hljs-string"><span class="hljs-string">"Kerberos Authntication"</span></span> KrbAuthRealms RUS.LOCAL Krb5Keytab /etc/httpd.keytab KrbMethodNegotiate On KrbSaveCredentials Off KrbVerifyKDC Off Require valid-user &lt;/Directory&gt;</code> </pre><br>  Then we re-read Apache configs and restart it: <br><pre> <code class="bash hljs">service apache2 reload service apache2 restart</code> </pre><br>  After these manipulations, when trying to access the OTRS scripts, Apache will try to authenticate the user and, if successful, will drive his login to the <i>$ _ENV ['REMOTE_USER']</i> variable, from where the OTRS <i>HTTPBasicAuth</i> authentication module will find the user‚Äôs name, go through its database and if he finds such a user, This will open the Custome page in the logged-in form. <br><br>  And everything seems to be nothing, here is just a Custom page, if we now try to enter it, tell us something completely strange, ‚ÄúAuthorization was successful, but you could not find a user in the database.‚Äù <br><br>  We are starting debugging.  To do this, download a couple of scripts on pearl: <br>  <a href="https://gist.github.com/benallfree/b636e915ba56f87668da">whoami.pl</a> <br>  <a href="http://pastebin.com/AiPF3wVv">test.pl</a> <br><br>  We drop them to the rest of the OTRS scripts in the <i>/ opt / otrs / bin / cgi-bin folder</i> , expose them to the rights and the owner of the same one that is already there and try to open them in the browser. <br><br>  The first script simply checks for the <i>$ _ENV ['REMOTE_USER']</i> variable, and if there is something in it, it displays a message that we seem to be driven into the NT domain with such and such account, if it is, and it shows us the correct account, then everything is ok. <br><br>  The second script shows us which line OTRS receives as user login.  And it is here that we see that OTRS receives something like <i>username@DOMAIN.RU</i> , but we know that we use <i>sAMAccountName</i> as the login <i>name</i> , that is, just the <i>username</i> , without a domain, and in the list of Clients in the previous one stage, we also saw that we have logins without a domain name. <br><br>  That's where the dog rummaged, so this situation happens, Apache worked, authorization was successful and everything was OK, but OTRS could not find the user in its database.  It turns out that we need to somehow throw out the domain name from the user name before searching it in the OTRS database. <br><br>  The blessing to fix it is quite simple, although while I figured out how, it took decently time and effort. <br><br>  To do this, again go to the Agent interface, <i>‚ÄúAdministration‚Äù - ‚ÄúSystem Configuration‚Äù - ‚ÄúFramework‚Äù - ‚ÄúFrontend :: Customer :: Auth‚Äù</i> , find the parameter <i>Customer :: AuthModule :: HTTPBasicAuth :: ReplaceRegExp</i> , <i>enable</i> it, and in the for input we leave what is there, for those who erased the default, there should be such a regular <br> <code>^(.+?)@.+?$ <br></code> <br>  Unfortunately, regular expressions on Perle remain for me inaccessible magic and transcendent shamanism, so I cannot explain how it works (I will be extremely grateful if anyone gives explanations in the comments, and I will gladly add it to the article) But in a nutshell, it discards everything on behalf of the user after the <i>‚Äú@‚Äù</i> symbol inclusively. <br><br>  Click "send" at the bottom of the page and stamp to the address of the Customer interface: <i><a href="http://helpdesk.domain.ru/otrs/customer.pl">helpdesk.domain.ru/otrs/customer.pl</a></i> <br>  Everything should work. <br><br><h4>  UPD. </h4><br>  Regarding the magic of regular expression: <br> <code>^(.+?)@.+?$ <br></code> <br>  Everything turned out to be very simple, as they explained to me "compared to the magic of the regulars, this is so, a children's seance" (c). <br>  symbol ^ - the beginning of the processed string <br>  the $ character is the end of the string <br>  Symbols () - show that as a result of processing you need to leave what is between them <br>  ?  - any character <br>  . + - recursive concatenation (as a result, the expression '. +?' - literally means any string) <br>  The @ symbol is not a special character, therefore it is processed as part of a line (surprisingly, I never would have thought, I always thought that it was just a special character and needed to be escaped, just the absence of such an escape made me astray and prevented myself from understanding this expression ) <br><br>  And as a result, we get that the regular partition breaks the resulting string into two parts ‚Äúeverything before the @ character‚Äù and ‚Äúeverything after the @ character‚Äù and returns the first part (as it is in parentheses). <br><br>  MA-A-A-A-A-Giya </div><p>Source: <a href="https://habr.com/ru/post/265537/">https://habr.com/ru/post/265537/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265525/index.html">Resource Binding in Microsoft DirectX 12</a></li>
<li><a href="../265527/index.html">Single-threaded Android WebView</a></li>
<li><a href="../265529/index.html">Basic principles of virtualization on the fingers</a></li>
<li><a href="../265531/index.html">Emacs: we train the cursor</a></li>
<li><a href="../265533/index.html">Dell ASM vs. Cisco UCS: How We Tested Infrastructure Automation</a></li>
<li><a href="../265541/index.html">OTRS 4.0.10. We put on Ubuntu + AD + Kerberos + SSO (Part Three)</a></li>
<li><a href="../265543/index.html">Free mono-vendor seminar: ‚ÄúKerio Connect is the solution for safe and comfortable work with e-mail‚Äù</a></li>
<li><a href="../265545/index.html">Atmospheric scattering in the video The Blacksmith</a></li>
<li><a href="../265547/index.html">220,000 iCloud accounts compromised using a backdoor for jailbreaked iOS devices</a></li>
<li><a href="../265549/index.html">Datathon at Data Science Week</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>