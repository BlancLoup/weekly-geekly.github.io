<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Rzborda, or How to Make an Internet-Controlled Typewriter</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Over the past few years I have had the opportunity to make quite a few remote-controlled devices. Some were managed locally, from a regular PC or from...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Rzborda, or How to Make an Internet-Controlled Typewriter</h1><div class="post__text post__text-html js-mediator-article">  Over the past few years I have had the opportunity to make quite a few remote-controlled devices.  Some were managed locally, from a regular PC or from a smartphone.  Some are via the Internet.  All devices are united by a common principle - a person controls them, guided by the picture from the video camera on board the device.  And the management itself, as a result, comes down to issuing control signals to servos or motor controller (driver). <br><br>  So, having gained experience in this case, I decided to try to more or less systematize various types of device management, so that when creating a new device, I did not have to rewrite a lot of things, and it was enough just to change some configuration parameters.  As a result, the RCboard, or RCbord software package was born.  Since  I do all the controlled things with the controller Virt2real ( <a href="http://habrahabr.ru/company/virt2real/blog/183892/">Virturilka</a> ) as the main onboard brain, then the rebord was originally written just for her.  So the whole bundle can be pathetically called "Software and hardware complex of the Retzbord". <br><br>  In general, in the continuation of the topic, I will try to write a recipe about how to make a machine controlled via the Internet using Virtual Virtual Radio and RT-Board from a conventional radio-controlled machine (well, locally it will also be controlled).  The communication channel will be the usual Wi-Fi (access to the Internet through a home router) or 4G connection through the Yota whistle. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Crawler BSD Racing 4WD RTR 2.4Ghz 1:10 <br><img src="https://habrastorage.org/files/107/7de/e80/1077dee80c274f02971753dc1ea471e6.jpg"><br><br>  I‚Äôll just clarify - by the term ‚Äúradio-controlled machine‚Äù I mean not cheap Chinese cars, in which all the electronics are implemented on one board, but more or less decent cars built according to a modular scheme - which have an engine speed control (collector, brushless) - and Servo to control the rotation of the front wheels. <br><br>  I will give such a machine as a guinea pig only in this recipe, as it is easiest to repeat.  With slight changes in the settings of the rebridgeboard and the addition of the engine speed regulator, the same can be done with any typewriter, the main thing is that the typewriter had wheels (yes even tracks) and had a motor. <br><br><h2>  What you need to build </h2><br><ul><li>  The machine with a motor regulator, engine and servo </li><li>  Battery (any suitable for the regulator voltage) </li><li>  Virt2real controller with virtual camera, USB-OTG adapter, micro-SD flash drive </li><li>  Whistle Wi-Fi or Yota (you can use any other 4G modem) </li><li>  Hands of moderate linearity </li></ul><br><br><a name="habracut"></a><br><br>  But first, to demonstrate some use cases. <br><br><h1>  Where it was already used </h1><br><br>  As I already wrote, we have already used a rebordboard in many places, but from the documented cases I found only these: <br><br><h4>  Tests of rzbordy on buggy in Shenzhen, management from Moscow </h4><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/YqaSECyBaD4%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhje_2OPoIK1yIYGF_pOQv8or0DwcA" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  Tests of RCsboards on a crawler in St. Petersburg, control from Moscow </h4><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/qG1Rkmc3jQQ%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhg-e6GX7LiP75EAxgNd71ySkV0Bdg" frameborder="0" allowfullscreen=""></iframe><br>  <a href="http://habrahabr.ru/company/virt2real/blog/223145/">habrahabr.ru/company/virt2real/blog/223145</a> <br><br><h4>  Testing of the rebels on an airplane over St. Petersburg, control from Moscow </h4><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Oy9fqVSlnm4%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhj0Qm-I3YSTNyva4KQyoemEf0p59A" frameborder="0" allowfullscreen=""></iframe><br>  <a href="http://habrahabr.ru/company/virt2real/blog/223183/">habrahabr.ru/company/virt2real/blog/223183</a> <br><br><h4>  Cool snow blower running rzbordy </h4><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/xZZCym0yiHw%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhjnEw351_NEdV1SdIdPsdtaf54k3w" frameborder="0" allowfullscreen=""></iframe><br>  By the way, the snow blower itself is the development of the Perm guys <a href="http://omiplow.ru/">http://omiplow.ru</a> <br><br><h4>  The hardest device running the RCBord </h4><br>  Joint project with <a href="http://defence.ru/">an open research center of promising technologies</a> <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/LqchVc-BvUY%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhg_ObYxdN0PWYSd4jsaNTiX2Wgn-A" frameborder="0" allowfullscreen=""></iframe><br><br><h2>  So, guinea pig </h2><br>  The crawler for remote control is good because it has a very high maneuverability. <br><br><div class="spoiler">  <b class="spoiler_title">By the way, he even knows how to do it like this.</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/2f4/52e/465/2f452e46571f4a89b65ebb539e213dc1.jpg"></div></div><br><br>  The crawler has four-wheel drive, permanent locking differentials (all wheels spin at the same time) and a constant "downshift."  Those.  He drives relatively slowly, but powerfully and passable. <br><br><h2>  Tuning Virtual </h2><br><br>  Before you assemble the machine, you need to configure Virtuylka.  First, consider the option to connect via Wi-Fi. <br><br>  So, the points: <br><ul><li>  Download the latest firmware, especially for the pcb <a href="">files.virt2real.ru/firmware/virt2real-board/1.1/rcboard-0.01.002.zip</a> </li><li>  We connect micro-USB - USB cable to Virtuirka, we plug the other end into the PC.  A new network interface, a subnet 192.168.3.0/24, will appear on the computer.  For Windows, you may need to install a <a href="">driver.</a> </li><li>  Open the basic admin panel (Virtual Virtluk web management panel) at <a href="http://192.168.3.1/admin">http://192.168.3.1/admin</a> </li><li>  Go to the ‚ÄúSettings‚Äù -&gt; ‚ÄúNetwork‚Äù section and set the ip for the wlan0 interface (or specify dhcp if you do not need a static ip) </li><li>  Go to the section ‚ÄúSettings‚Äù -&gt; ‚ÄúWi-Fi‚Äù -&gt; ‚ÄúWi-Fi setting‚Äù and set the parameters of the wireless network (change the ssid and psk fields) for the first network </li><li>  Go to the ‚ÄúSettings‚Äù -&gt; ‚ÄúAutostart‚Äù section - move the S80dhcp-server script to inactive (if the initial setup via USB is no longer required) </li><li>  We go to the section "Administration" -&gt; "Restart" and rebuild Virturilcu </li><li>  Disconnect the USB cable from Virtuurka, connect the whistle whistle to the micro USB.  From the recommended I recommend ASUS N10, N13, TP-link TL-WM722N, but best of all are pyatigighertsovye, for example, ASUS N53 or Dlink DWA-160 rev.B2 </li></ul><br><br><h2>  Checking virtual network connection </h2><br><br><ul><li>  During the virtual boot process, the LEDs on it will light up.  When the power is turned on, if the bootable USB flash drive is successfully read, the green LED will light up.  Then, while the kernel is loading, a blue LED will light up.  After a full download, if the connection to the Wi-Fi network is successful, the red LED will turn on.  And when the rebordboard starts up (it is registered in the autorun), all the LEDs go out and the red LED starts blinking. <br></li><li>  Install the application to manage.  It is called Virt2real Player and is for Windows ( <a href="">distribution</a> or <a href="">zip-archive</a> ), <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.virt2real.player">for Android</a> , <a href="https://itunes.apple.com/us/app/virt2real-player/id938612930%3Fl%3Dru%26ls%3D1%26mt%3D8">for IOS</a> .  The application for IOS in the appstore is still the old version, the new one passes appruv, so while putting it to no purpose - the management will work clumsily. <br></li><li>  We open Explorer (if on a Windows computer), if Virturile has successfully connected to the local network via WiFi - the ‚ÄúRCboard (Virt2real)‚Äù device should appear in the ‚ÄúNetwork‚Äù section.  You can get to the admin panel by right-clicking on this device and selecting the ‚ÄúView device web page‚Äù menu item. <br><div class="spoiler">  <b class="spoiler_title">It looks like this</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/7e9/8f6/170/7e98f6170c574712aca4bf7f144d8db3.png"></div></div><br></li><li>  We start Virt2real Player for Windows or for Android, the RCboard server should be found.  Server discovery in an IOS application is not yet implemented. <br><br><div class="spoiler">  <b class="spoiler_title">Screenshot Virt2real Player for Windows</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/e66/270/bad/e66270bad86b4e639e17f4f84593466f.png"></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Screenshot Virt2real Player for Android</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/79a/e94/52b/79ae9452b55547f0b9e7e8ef12149050.png"></div></div><br><br></li></ul><br><br><h2>  The general principle of connecting motor cars </h2><br><br>  Usually, RC cars have two motors.  One ordinary, collector - turns the wheels.  The second - the servomotor turns the front wheels in the right direction.  Those.  it turns out that only two control channels are required - gas and a steering wheel.  Initially (if the machine is purchased in assembled form) all channels are connected to a regular radio receiver with three-pin JR type connectors (standard servo connector).  Black (or brown) wire - ground, red - power (5-6V), yellow (or white, or orange) - signal wire. <br><br>  It is through the signal wire that we will control the motors, but first we need to power the servo, which drives the wheels.  Here the general principle is - from the onboard battery the power supply with the voltage equal to the battery voltage goes through the thick wires to the powerful regulator of the collector (or brushless) motor.  Inside this regulator there is a so-called BEC - voltage converter, making stable 5 volts (sometimes 6V, with a jumper on the regulator) required for powering the onboard servos, receiver and various other electronics from various battery voltages.  This stabilized power supply is usually designed for a load of no more than 2-3A, although this also depends on the model of the regulator. <br><br>  The BEC output voltage through the black and red wires of a thin three-core cable from the regulator is fed to the receiver.  Here lies the main nuance, which not all immediately comprehend.  I repeat - there is a cable with three conductors from the regulator.  Of these, two cores are power supplied from the regulator, i.e.  this is the way out.  And the third wire (white, yellow or orange) is the control wire, i.e.  entrance.  It seems a trifle, but for some reason, many are confused. <br><br>  The receiver has several groups of three-pin contacts.  Their number depends on the number of channels for which the receiver is designed.  The machines usually have 2 or 3 channels, so the groups are 3 or 4, respectively (one group to set the Pair jumper (signal for pairing receiver and transmitter). For these contact groups, all the power pins are closed between each other, i.e., ground and power comes from the regulator and is sent to all contact groups at once, but the signal pins are all independent, they receive a signal received by the receiver from the radio control equipment. <br><br><div class="spoiler">  <b class="spoiler_title">Conventional wiring diagram with collector motor</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/f52/90c/feb/f5290cfeb38f40c888338f7d48e0ce0f.png"></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Conventional wiring diagram with brushless motor</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/043/19d/259/04319d259a0f45459058c70677d4400b.png"></div></div><br><br>  Since we will manage with the help of an independent controller, we don‚Äôt need a typewriter receiver, we remove it altogether.  And the three-core cables from the regulator and from the servos we need to connect in a sly way - connect the black wire with the black, red with the red.  And the remaining white (yellow or orange) two wiring must be connected to Virturilka, namely to the pin CON44 and CON43, <a href="">see the diagram</a> .  What kind of wire to which pin does not really matter, since the channels can be configured later in the config file. <br><br>  It should look like this connection <br><div class="spoiler">  <b class="spoiler_title">Wiring the Virtualka to the intestines of a typewriter</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/64e/a07/0c1/64ea070c1bea464b899c8beca51e7d44.png"></div></div><br><br>  If there are servos at hand, it is convenient to make a connection with them.  I have with them eternal tension, so I just cut off the wiring and twist-solder. <br><br>  And yes, the most important thing is that we supply power to the Virturku directly from the battery contacts.  She is not afraid of voltage up to 20V, so the higher the voltage, the better, the less current will consume.  The efficiency of the power converter (SEPIC, installed on Virturilka itself) drops only after 15V, so the ideal power supply is from 12 to 15 V, while at full load (with Wifi), the Virtirlka will consume about 150-300 mA.  Although it also depends on the whistle (Yota whistle is very gluttonous, it will be more with it). <br><br><h2>  Assembly machine </h2><br><br>  I tried to capture the video of the assembly process of my crawler.  I do not know how everything is clear there, but I think it will not be superfluous.  Here's a video about the assembly: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Xq_Fl0CXAZ8%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhinxRJeMf446bPCZ_N_KztgM05g6w" frameborder="0" allowfullscreen=""></iframe><br><br><h2>  Setting up the server rzbordy </h2><br><br>  All settings of the pcbord can be edited in a special control panel of the pcbord (not to be confused with the admin virtualka).  This is how the control panel of the redboard looks now (the first version) <br><br><img src="https://habrastorage.org/files/e7d/d9e/040/e7dd9e04027546ff99b957757f68cf7e.png"><br><br>  In the ‚ÄúGeneral Settings‚Äù tab, you can set the device name (displayed when a device is detected in applications), specify whether to launch the rebordboard server automatically when the Virtualrika loads, set the type of configuration. <br><br>  The configuration can be local (i.e., the configuration file resides in the directory of the redboards and is available for editing in the control panel), or it can be deleted when the configuration file is downloaded each time the launch of the redboards from the web server. <br><br>  Server of remote configs, by default, <a href="http://rc.virt2real.ru/getconfig">http://rc.virt2real.ru/getconfig</a> , create and edit configurations there are allowed only registered users of the <a href="http://forum.virt2real.ru/">forum.virt2real.ru</a> <br><br>  In the topic, I will tell only about the local configuration, you can try the remote configuration yourself if anyone is interested.  By the way, when I rode on Shenzhen (the video at the end of the topic), I used the remote config so that I could change the settings.  Changing the settings from the application is still in the form of sketches, it really does not work yet, but even when I finish it, the remote config is still useful. <br><br>  So, we are most interested in the ‚ÄúLocal Configuration‚Äù tab.  In general, the default config already configures the RCBD to server mode, you can connect the machine and manage it locally (in the local network, from a Windows application, from an Android or from an iPhone / iPad).  Is that you may need to swap channels.  But for the P2P mode (peer-to-peer), to control via the Internet, the settings will have to be changed. <br><br>  By default, the universal.so library is responsible for all management, for which the parameters are located at the end of the config, in the "[universal]" section. <br><br>  The correspondence of control channels and PWM / PPM channels is specified by the axis parameter. <br><br><blockquote>  axis = 0,1,2,3 </blockquote><br><br>  By default, 4 PPM channels are set up, which are on the pins CON43, CON44, CON19, CON42.  These lines of config are responsible for this. <br><br><blockquote>  ch0 = 43, ppm, 500,1500,2500,127.0 <br>  ch1 = 44, ppm, 500,1500,2500,127.0 <br>  ch2 = 19, ppm, 500,1500,2500,127,1 <br>  ch3 = 42, ppm, 500,1500,2500,127,1 <br></blockquote><br><br>  The channel setting format is: <br>  <b>chX = CON, TYPE, MIN, CENTER, MAX, NEUTRAL, NOAUTOCENTER</b> <br><br>  Where <br>  <b>X</b> is the PWM / PPM channel number, from 0 to 3 <br>  <b>CON</b> - pin number (not GPIO, namely pin, <a href="">see diagram</a> ) <br>  <b>TYPE</b> - signal type, ppm or pwm.  For the machine, you need ppm, for the pwm type, a different config string format. <br>  <b>MIN</b> is the minimum position of the PPM signal, in milliseconds. <br>  <b>MAX</b> - the maximum position of the PPM signal, in milliseconds. <br>  <b>CENTER</b> is the center position of the PPM signal, in milliseconds. <br>  <b>NEUTRAL</b> is the relative value of the neutral, i.e.  neutral value of control commands.  Normally = 127 <br>  <b>NOAUTOCENTER</b> - if = 0 - automatically return the signal to the center position, = 1 - do not return.  For gas channels and a rudder, you need to specify 0, for servo channels, which are used to rotate the camera, you need to specify 1 (if there are any, of course) <br><br>  If there are lights on the machine, you can turn them on and off, you will need to assemble a simple transistor amplifier (one field effect transistor, in fact).  To get the control signal, use the ‚Äúpins‚Äù parameter.  It sets the pins that will be set to 0 or 1 when the button is pressed in Virt2real Player (on the on-screen buttons, on the keyboard, mouse, or on the gamepad). <br><br><blockquote>  pins = 1.30.0.0 | 2.31.0.1 </blockquote><br>  The format is: <br>  <b>pins = CHANNEL, CON, DEFVALUE, SAVESTATE | ...</b> <br>  Where <br>  <b>CHANNEL</b> - button channel (from 1 to 32) <br>  <b>CON</b> - pin number to be set to 0 or 1 after the arrival of the control command from the buttons <br>  <b>DEFVALUE</b> - the value in which this pin will be set when launching rebats <br>  <b>SAVESTATE</b> - if = 0 - when pressing the button, set the pin to 1, when released - set to 0. If = 1 - when pressing the button, set the pin to 1, when releasing the button, do nothing.  The next time you press the pin button to set to 0, when released - again do nothing.  And so in the cycle. <br><br>  Channels of buttons can be specified in a row, through the separator "|". <br><br>  A brief conclusion from this vague information - if you have the gas and rudder channels confused - you can swap them by changing the axis parameter to axis = 1,0,2,3 :-) <br><br>  If you need to limit the extreme position of the steering serva, change the MIN and MAX values ‚Äã‚Äãfor the desired channel.  If the machine goes forward or backward in neutral position - change the CENTER value for the desired channel. <br><br><h1>  Additional modules </h1><br><br>  In the ‚ÄúAdditional modules‚Äù tab there is a list of active and inactive modules. <br><br><img src="https://habrastorage.org/files/d0b/7ac/94e/d0b7ac94e6a94f96bc7cf3f3b2d9c634.png"><br><br>  A module is a separate application (executable binary) that usually acts as a telemetry source.  Active modules are those that are started automatically at the start of the redboard and terminate at the completion of its operation.  In the control panel, you can move modules from one column to another by clicking on the orange arrow.  When moving to the active column, the module starts up immediately, no matter if the rebord is running or not.  When moving to inactive - the module automatically stops working. <br><br>  The modules work simply - they read the required parameters and send via UDP to the local port (ext_telemetry) specified in the config.  And there already rtsborda takes info and transmits via telemetry to the application Virt2real Player.  At the same time, the same information is transferred to the user's device library (in our case, it is universal.so), so that the application can analyze the information and use it for its intended purpose.  For example, I had a library of a device called autobot.so, a controlled trolley that, in addition to user management, could also autonomously drive, guided by a signal from an ultrasonic rangefinder. <br><br>  From the main modules - statuswifi delivers information on the status of the Wi-Fi link to the radioboard.  Airosstatus.php (yes, the module can also be written on pohapa) - reads the link status from the Ubiquity equipment, gps - reads the GPS receiver.  The imu module processes the information from inertial sensors (Euler angles, azimuth and compass), although it still works with only one type of sensor, so it is not suitable for universal use.  Nfc - reads NFC tags, but also works with only one type of reader.  rc.in - reads PPM signals from an RC receiver, i.e.  You can also control the machine with a normal app, it has priority over control commands via Wi-Fi.  rfid - read RFID tags.  statusyota - reads the status of the 4G modem Yota link.  usrange - reads ultrasound rangefinder readings.  voltage - determines the voltage of the onboard power supply, a simple voltage divider (2 resistors) is required to be connected to the ADC0.  In general, there are a lot of interesting modules, for each there is a detailed description to be done, so for now we believe that I mentioned them for seed :-) <br><br>  For our managed machine recipe, the statuswifi module is relevant - if we are setting up a connection via Wi-Fi or statusyota - if we connect the Virturika through the Yota whistle. <br><br><h1>  Application setup </h1><br><br>  In Android and ipad-iphone applications, the settings are simple, only in the choice of control channels.  In Android, there is also a channel button selection (by default, the channel is not set, the buttons are not displayed).  But in the Windows application, I have wound so many features that I myself come to a state of light panic with the knowledge that all this must be documented.  While I can only give a reference to the description of the previous version of the application <br>  <a href="http://wiki.virt2real.ru/wiki/%25D0%259A%25D0%25B0%25D0%25BA_%25D1%2581%25D0%25B4%25D0%25B5%25D0%25BB%25D0%25B0%25D1%2582%25D1%258C_%25D1%2583%25D0%25BF%25D1%2580%25D0%25B0%25D0%25B2%25D0%25BB%25D1%258F%25D0%25B5%25D0%25BC%25D1%2583%25D1%258E_%25D1%2582%25D0%25B5%25D0%25BB%25D0%25B5%25D0%25B6%25D0%25BA%25D1%2583_2">http://wiki.virt2real.ru/wiki/How_to do_controlled_trolley_2</a> <br>  <a href="http://wiki.virt2real.ru/wiki/RCboard">http://wiki.virt2real.ru/wiki/RCboard</a> <br><br>  The control protocol has since changed noticeably, but the configuration of the Windows application has changed slightly, so it can help with picking.  I will try to write a detailed description of the current version next year :-) <br><br>  By the way, in the earliest version, I used the MAVLINK protocol to transmit telemetry, but as I got fouled with features, it was not enough, so I switched to my own protocol.  I am thinking of adding MAVLINK as a parallel telemetry channel, but this is already in the next version of the application. <br><br>  I can only say one thing - it is best to control the machine with a USB steering wheel and pedals connected to the computer.  Well, or at least with RC appy, connected by a coaching connector to a computer.  A finger across the screen of a smartphone can be cool, but it's not convenient without tactile sensations. <br><br><h2>  And now the most important thing is management via the Internet. </h2><br><br><h3>  P2P mode introductory information </h3><br><br>  Since both the control channel and the video channel use UDP, I wanted to make a full P2P (Peer-to-peer) link so as not to drive the video from the board to the server and back to the client.  Well, if I wanted to, I took it and did it :-) In fact, it turned out to be a simple and easy analogue of Adobovsky RTMFP (not to be confused with RTMP).  Only now the transfer of sound to add any hands do not reach, so that rtsbord until dumb and deaf. <br><br>  With UDP, the main problem is overcoming NAT.  Since there is always a NAT at one end of the link (on the sending side or on the receiving side) - simply specifying the address and port of the server (or client) will not work - NAT will interfere.  In the Windows Virt2real Player, it is possible to do a port forwarding using UPnP, but this is not exactly what I wanted.  And what I wanted - it turned out only after thoughtful smoking of <a href="http://en.wikipedia.org/wiki/UDP_hole_punching">UDP Hole Punching</a> technology.  In the end, everything turned out as it should - no matter what the router, no matter where the client or server.  The main thing that was Internet access.  Although lying, there is only one type of NAT, which has not yet been broken through.  All the time I forget how correctly it is called, seemingly symmetric NAT. <br><br>  And yes, the usual TURN and STUN servers are not used in the board, only its own implementation.  As I usually say: if you want to study technology, do it your way, and then compare with generally accepted solutions.  Bicycle lovers will understand me.  However, it often turns out that the bike is not so bad and performs its tasks better than conventional solutions. <br><br>  This is so easy offtop was.  We continue about NAT.  P2P support is currently only in the Virt2real Player Windows application, has not yet been added to the android and iPhone / iPad.  I checked the work with the connection through the Yota whistle, through the Beeline 4G whistle, through the access point on the smartphone, which also went out to the Internet through Beeline 4G.  In all these cases, everything works, but noticed that it is ideal only through Yota.  Through Beeline (in any of the tested types) also works, but the connection takes longer.  Why is this happening - not yet understood.  From the sad one - until we managed to get the link to work (both commands and video) when both the client and the server are connected via 4G whistles.  Perhaps this is just symmetrical NAT and crept up. <br><br><h2>  P2P mode setup, Wi-Fi on board </h2><br>  Wi-Fi whistle is connected to Virturilka on board the machine (i.e. as it has been done so far according to the instructions from this topic).  Only first we managed the machine locally, and now we can give someone to steer from Ineta. <br><br>  To enable p2p mode, go to the web-control panel of the rebordboard, section ‚ÄúLocal Settings‚Äù.  There we set the parameter <br><blockquote>  role = p2p </blockquote><br><br>  Now you need to set the parameters p2p_uid and p2p_hash.  This is a kind of login-password analogue, but there is no full authorization yet (but it will be necessary), so we use just such a bunch.  p2p_uid is better to take from your account on <a href="http://rc.virt2real.ru/remoteconfig/">rc.virt2real.ru/remoteconfig</a> there it is called the ‚Äúuser ID‚Äù, then the mechanism of the invites will work (more on that below).  And p2p_hash should be thought up independently.  Any character set, maximum length 40 characters. <br><br>  Everything, on it setup of a p2p of the rtsbord mode is finished.  You need to make sure that Virturilka has access to the Internet and you can run Virt2real Player Windows.  If you run it on a local network, in the same place where the redboard is installed, the player will detect the local redboard (it does not matter that it is in p2p mode) and you can connect directly.  But if the player runs on a different network, you need to configure it for p2p mode. <br><br>  We right-click on the player window, go to the ‚ÄúNetwork‚Äù -&gt; ‚ÄúNetwork Setup‚Äù menu.  In the "Role" tab, select "P2P", in the "P2P" tab, specify the UID and DevID.  The UID is the same p2p_uid, which was entered in the settings of the redboards, and the DevID is the same p2p_hash.  Save, right click on the video window again, ‚ÄúNetwork‚Äù -&gt; ‚ÄúConnect‚Äù.  In the lower left corner of the player should appear the message "Request a video feast" and "Request a feast of commands."  Everything, process of detection of a feast and pairing went. <br><br>  Sometimes it happens that the messages do not appear, then it is better to just restart the player (my joint, I haven‚Äôt caught it yet), when it starts, it will immediately start to connect with the parameters that we set for it, i.e.  in P2P mode. <br><br>  From the observed nuances - if the player is launched on a computer that goes to the Internet via Yota - the connection is quickly established.  Of course, if Yota has a normal signal.  But if through a Yota router or 4G a whistle from Beeline, the first connection can last up to a minute.  But then all the next ones will be almost instantly.  I know about where I nakosyachil, but fix it until his hands did not reach. <br><br><h2>  P2P mode setting, Yota is on board </h2><br>  We connect the Yota whistle (via the USB-OTG adapter, by itself) to the Virtual USB port of the Virtuerki onboard the machine.  Whistles on sale at Yota <br><br>  Otherwise, everything is similar to the previous paragraph.  If it is good to remove statuswifi module from active scripts in the ‚ÄúAdditional modules‚Äù section of the active scripts and vice versa, put the statusyota module into active scripts in order to see the Yota signal parameters in the player. <br><br><h1>  Illustrations of various types of connections </h1><br>  Unfortunately, at my home Yota barely fries, so you can‚Äôt fully ride.  But the Beeline 4G works fine, the 3 megabit stream (both incoming and outgoing) prolazit without problems. <br><br>  In all the experiments below, all the settings are the same, only the type of communication changes. <br><br><div class="spoiler">  <b class="spoiler_title">Wi-Fi whistle crawler, connecting from the Internet, via Yota</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/mvI8QNhMf0E%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhg7i34JBUHpxR5ESgiqMvnNfhvnfQ" frameborder="0" allowfullscreen=""></iframe></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Crawler whistling Yota, connect from your home network.</b>  <b class="spoiler_title">Yota signal is very bad :-(</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/FIm19_L5Z70%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhjPiva1bQlZ-8-4Bff2WIIfPsisoQ" frameborder="0" allowfullscreen=""></iframe></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Crawler whistle Wi-Fi, from a laptop that has access to the Internet via a smartphone (Beeline 4G)</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/9LhYRA6loQs%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhgKKzoDgvLIxWyTsfJMKfiRMH3Wgg" frameborder="0" allowfullscreen=""></iframe></div></div><br><br><h1>  Invites </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In order to make it easier for someone to pass on the parameters for connecting to our typewriter in P2P mode, invitations were created. What are invites - everyone knows.</font></font> Convenient thing.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So now I will try to tell how to use it. In the player, this is still in the test, raw, kind, but it seems to work. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, open the Windows Virt2real Player, right-click on the window, select ‚ÄúInvite‚Äù -&gt; ‚ÄúCreate an invite‚Äù. An important nuance - the player must be configured for P2P mode, i.e. In the network settings, all the above parameters for connecting to the machine are indicated. Otherwise, an invite will be created, but there will be nothing to connect to. By the way, you should add a warning if the parameters are not filled. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the field "Your user ID" enter all the same our p2p_uid. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the ‚ÄúYour user-magic‚Äù field, enter the contents of the ‚ÄúYour user-magic‚Äù field from the same page </font></font><a href="http://rc.virt2real.ru/remoteconfig/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rc.virt2real.ru/remoteconfig</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the "Invites Name" field, enter the name under which this invite will be </font><font style="vertical-align: inherit;">displayed </font><font style="vertical-align: inherit;">on the page </font></font><a href="http://rc.virt2real.ru/remoteconfig/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rc.virt2real.ru/remoteconfig</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now click the button "Create an invite". The two-logo should spin, after which a long line will appear in the lower field ‚ÄúLine invite‚Äù, starting with the characters INV. </font></font><br><br><img src="https://habrastorage.org/files/83a/562/18b/83a56218b893478a8715ca43c2fdb3af.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now, if you open the remote configuration page of </font></font><a href="http://rc.virt2real.ru/remoteconfig/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rc.virt2real.ru/remoteconfig,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> we‚Äôll see that there was an invite that we just created. </font></font><br><br><img src="https://habrastorage.org/files/e84/4ba/5dc/e844ba5dcad243208c1c450a37613e8b.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Well, then </font><font style="vertical-align: inherit;">all you have </font><font style="vertical-align: inherit;">to do is drop this line to the person you want to let go. And he, in turn, should go into the player in the menu ‚ÄúInvite‚Äù -&gt; ‚ÄúI have an invite!‚Äù And enter this line. After that, all the necessary parameters will be filled by themselves, you will not have to configure anything for the connection, you can immediately ride.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As I said, the system is damp, but it works. </font><font style="vertical-align: inherit;">The plans - to make a normal login authorization password, so as not to have to mess with users and other aydishnikami.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A little about the delay </font></font></h2><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The main requirement for remote control is one thing - as little as possible from pressing a button or moving the joystick to a corresponding change in the image displayed from the device board in the video stream. </font><font style="vertical-align: inherit;">When you publish something on the topic of remote control, usually the first question is ‚Äúwhat is the delay?‚Äù.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After numerous tests, it turned out that the delay is a subjective thing and affects the comfort of the control in different ways. Of course, it all depends on the maximum speed of the driving device. For flying devices (airplanes / copters) the minimum delay is very important, but when controlling driving devices - not always. When I, at the next exhibition, Hobby-Expo cut through the hall on a converted radio-controlled buggy, after ten minutes of taxiing, I caught myself thinking that the delay (whatever it was) ceased to be felt, you start to control it ‚Äúahead of time. At almost half the speed (and my buggy up to 80 km / h can accelerate), I calmly drove around the hall, tacking between pavilions, chairs, people. So here, rather, the stability of the delay is important, and not its absolute value in milliseconds.The minimum delay achieved when connecting to a normal router via a normal Wi-Fi whistle was somewhere around 200 ms, and when connecting through a generally accepted standard - powerful Ubiquity routers, the minimum delay with a confident connection is about 100 ms. The power of a video stream playback device (PC, smartphone) also affects the delay; if it does not have time to decode a raw video stream (H264 codec), there will be no pleasant smooth video.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When I ran a fairly high-speed buggy in Shenzhen, sitting at home in Moscow, it was quite comfortable to steer, although only the network ping from me to the server of the Chinese 4G operator was about 300 ms. </font><font style="vertical-align: inherit;">Plus, another 100 ms ours - a total of half a second runs up. </font><font style="vertical-align: inherit;">However, a great ride :-)</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Some nuances of 4G communication </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After the wild drops when flying on an airplane, what was the problem? </font><font style="vertical-align: inherit;">If the connection is via 4G, then the mtu parameter should be set to 1322 or less. </font><font style="vertical-align: inherit;">Less is not necessary, set mtu = 1322 and do not steam. </font><font style="vertical-align: inherit;">In the local network, I usually put 16,000 (the maximum size of Jumbo Frames), in LAN it works fine, but through the Internet there will already be problems with the passage of packets.</font></font><br><br><h2>  Links </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since the text turned out over-than-dofiga, I will repeat the main links. </font></font><br><br> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firmware rcboard-0.01.002.zip for Virturilki </font></font></a> <br><br> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Distribution Virt2real Player for Windows</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The same, but not the installer, but simply an archive.</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Under Win8 </font><a href=""><font style="vertical-align: inherit;">, it does not</font></a><font style="vertical-align: inherit;"> correctly detect the presence of DirectX, so you can simply unpack the archive. </font><font style="vertical-align: inherit;">Requires .Net 4.5 and DirectX. </font></font><br><br> <a href="http://wiki.virt2real.ru/wiki/%25D0%259A%25D0%25B0%25D0%25BA_%25D1%2581%25D0%25B4%25D0%25B5%25D0%25BB%25D0%25B0%25D1%2582%25D1%258C_%25D1%2583%25D0%25BF%25D1%2580%25D0%25B0%25D0%25B2%25D0%25BB%25D1%258F%25D0%25B5%25D0%25BC%25D1%2583%25D1%258E_%25D1%2582%25D0%25B5%25D0%25BB%25D0%25B5%25D0%25B6%25D0%25BA%25D1%2583_2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description of the previous version of the RCboards and Virt2real Player. </font></font></a> <br> <a href="http://wiki.virt2real.ru/wiki/RCboard"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">More description of the boards, the old protocol. </font></font></a> <br><br> <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.virt2real.player"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Application for Android</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Only local control. </font></font><br> <a href="https://itunes.apple.com/us/app/virt2real-player/id938612930%3Fl%3Dru%26ls%3D1%26mt%3D8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Application for IOS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , only local control, no detection of devices. </font><font style="vertical-align: inherit;">Now there is an old version, a new one is running. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS Ehh, sorry Wheelbarrow Bond did not live up to the appearance of the redboard :-(</font></font><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If anyone does not know</font></font></b> <div class="spoiler_text"> <a href="http://habrahabr.ru/company/virt2real/blog/172167/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habrahabr.ru/company/virt2real/blog/172167</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The latest tests, when from the TV channel Discovery came video to shoot</font></font><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/ZATytcOLM3Q%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhjfyko4qkdl8mU7F1H-H_dDgrOGpw" frameborder="0" allowfullscreen=""></iframe><br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Kxuc5z8bO_g%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhhWJ2u0wyhTSUNGJgkSanqLrsgRVQ" frameborder="0" allowfullscreen=""></iframe><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sach she looks like this </font></font><br><img src="https://habrastorage.org/files/b52/98b/e0a/b5298be0a32c4d1190f4026c6d7aa3b4.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rear gear died, the bottom rusted and fell out. </font><font style="vertical-align: inherit;">In general, kirdyk pupsiku :-(</font></font><br><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/246723/">https://habr.com/ru/post/246723/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../246711/index.html">Named C ++ Parameters. Not useful</a></li>
<li><a href="../246713/index.html">Registration of offshore company in Belize</a></li>
<li><a href="../246717/index.html">Christmas tales engineer post</a></li>
<li><a href="../246719/index.html">InterSystems iKnow. We load data from VKontakte</a></li>
<li><a href="../246721/index.html">DriverPack on the threshold of 2015: statistics</a></li>
<li><a href="../246725/index.html">Brand management mistakes</a></li>
<li><a href="../246727/index.html">Massage and IT</a></li>
<li><a href="../246729/index.html">Earnings in the system of mobile motivation AppBonus. Organizational model of the platform and its use</a></li>
<li><a href="../246733/index.html">One-page store on Phalcon PHP + AngularJS. Bug work</a></li>
<li><a href="../246735/index.html">How an online store uses video to increase sales</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>