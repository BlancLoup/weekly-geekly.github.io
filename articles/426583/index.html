<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ten people at 90 thousand sites: how not to go crazy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, my name is Vera Sivakova. I work with key partners Yandex.Cash - connect large stores and services, launch projects and travel to meetings around ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ten people at 90 thousand sites: how not to go crazy</h1><div class="post__text post__text-html js-mediator-article"><p>  Hi, my name is Vera Sivakova.  I work with key partners Yandex.Cash - connect large stores and services, launch projects and travel to meetings around the world.  In general, I make sure everything is fine. </p><br><p>  Every Yandex.Money employee can change their occupation once a year - choose a department and work there for several days.  Therefore, a month ago I also went to Sapsan and came to Petersburg.  The monitoring department works there, which also ensures that everything is fine with 90,000 websites connected to the Cashier - and we decided to join forces. </p><br><p><img src="https://habrastorage.org/webt/nk/aw/gc/nkawgcaslqu2prxrf2i8t4rp0qy.png"><br>  <em>How not to go crazy?</em>  <em>Similarly, not so</em> (source: reddit.com) </p><br><p>  This is a story about how we monitor, and what I learned in a couple of days in another department. </p><a name="habracut"></a><br><p>  Every second about 600 transactions go through the service and all this needs to be monitored in real time - but at what exact moment is it time to sound the alarm if something happened?  We need a systematic look at everything. </p><br><p>  Good practice is to analyze the system from the technical side and not to forget about the business metrics - the number of payments, turnover and other parameters. </p><br><p>  In small systems there is enough of a keen eye of the main (most often and only) administrator.  But when there are a lot of processes, employees cannot monitor everything manually, so the best strategy would be maximum automation.  Without the expert knowledge and efforts of the team, nothing will work by itself, as monitoring is continuous improvement, analysis and the ability to select competent metrics and triggers.  They will work in case of deviation from the specified conditions and report anomalies. </p><br><p>  We distinguish three levels of monitoring, each of which has its own important indicators - the level of the system, the level of business logic and the level of counterparties. </p><br><h2 id="uroven-sistemy">  System level </h2><br><p>  The most important thing here is round-the-clock monitoring of the infrastructure.  From the tools we use Zabbix to collect data in real time - it notifies about the operation of servers and data centers, the quality of the network, the availability of components and data sources. </p><br><p>  Monitoring IT infrastructure is a very demanding job, since failure at this level is fraught with inoperable systems and desperate measures.  Therefore, it is important not only to respond to ‚Äúflashing‚Äù problems, but also to analyze trends and historical data - this will allow you to warn potential points of failure in time and predict the need for scaling.  The rule works for all indicators and levels of monitoring, including business. </p><br><p>  For critical points, the trigger thresholds should be selected below.  For example, in the case of an increase in response time from one router, we transfer traffic to another and eliminate the reason for the first one.  This triggered a warning trigger that allows you to receive notifications of potential problems well in advance, which gives plenty of time to respond, the ability to predict changes and avoid disasters. </p><br><h2 id="uroven-biznes-logiki">  Business logic level </h2><br><p>  Each team determines the processes that need to be monitored, their priority and personal metrics.  For example, the Cashier team has dozens of business processes, such as payment for each available method - cards, e-wallets, through online banks and terminals, mobile commerce, sending registries, etc.  As the main tool for collecting and displaying data on the work of business logic, we use Graphite in conjunction with Grafana. </p><br><p>  At this level, it is important to adhere to a systematic approach and try to move away from the binary and uninformative ‚Äúworks / does not work‚Äù. </p><br><p>  For example, there is the metric ‚ÄúNumber of successful payments by card‚Äù.  If it starts flashing, it means that the workflow has decreased.  In this case, it is necessary to understand what is the reason, and take into account all the components that are involved in this process.  In the case of a decrease in the number of transactions, you can immediately think about the fact that there are difficulties on the side of the acquiring bank.  But the graphs show that everything is fine with the availability of banks.  Then it is necessary to investigate further, and in the end it will turn out, for example, that all the questions for the layout: for some reason, the ‚ÄúPay‚Äù button has disappeared or it has become inactive. </p><br><h2 id="uroven-kontragentov">  Counterparty Level </h2><br><p>  Here we are talking about specific counterparties - for example, acquiring banks and merchants. </p><br><p>  We have selected separate charts and triggers for acquirers, the availability of which we must track all the time.  For us, as a payment service, stability is very important, so in the event of a failure of one of the banks, we immediately transfer the flow to the reserve. </p><br><p><img src="https://habrastorage.org/webt/go/_c/2e/go_c2eclhtetnklaej4ohkk04qy.png"><br>  <em>One bank failed, but another automatically connected.</em> </p><br><p>  We have learned quite well and in a timely manner to redirect the workflow if errors started. </p><br><p><img src="https://habrastorage.org/webt/fe/kz/hn/fekzhnwwc8rkqb0hf7ms_-cfwjo.png"><br>  <em>In one of the banks recorded an increase in errors when paying</em> </p><br><p><img src="https://habrastorage.org/webt/13/vf/f-/13vff-8knq05k4j59kovhms8yvs.png"><br>  <em>Translated - and everything is in order.</em>  <em>Y-axis values ‚Äã‚Äãare not comparable.</em> </p><br><p>  Acquiring failures can occur for a variety of reasons at the levels already described - systems and business logic.  No one is immune from unforeseen problems and can not guarantee 100% availability.  Also worth remembering about the planned technical work and releases, when you need to closely monitor the progress of affairs.  The issue of reservation and automatic switching is critical, as simple means stopping payments for a business. </p><br><p>  We work immediately with several banks to minimize the risks of downtime and optimize SR card payments.  SR (success rate) or else conversion is a business metric that is calculated as the ratio of the number of successful payments to the total number of transactions.  Different companies measure conversion in their own way: for example, someone starts to stop from the payment page, others after clicking on the "Pay" button.  But in general, SR is influenced by many different factors - MSS, is there 3D-Secure in payment, geography of payers, recurrent payments or not.  ‚ÄúHospital average‚Äù SR cannot be determined and it is not necessary to know - in each case it will be its own value that needs to be optimized. </p><br><p>  All the variety of errors can be divided into two large groups. </p><br><ol><li>  <strong>Errors that can be prevented</strong> - for example, payment from this country is prohibited.  If you are sure that this is not a fraudulent attack and you have users all over the world, then in this case it is necessary to connect the possibility of payment from cards of any issuers.  This, by the way, can be done in your Yandex Cash Desk. </li><li>  <strong>Errors that cannot be affected</strong> - for example, the card is blocked.  Here only reissue or attempt to repeat payment by another card within the framework of a new transaction will help. </li></ol><br><p>  Many choose a payment provider at a rate.  In fact, the rate is not the only value to be taken into account.  It is also necessary to look at the percentage of successful payments (SR) - because no one has 100% conversion and this value varies greatly from bank to bank.  It is also necessary to consider how the user scenario as a whole looks like: how many steps you need to go through before payment, whether the interface is clear, etc. </p><br><h2 id="kak-konversiya-vliyaet-na-pribyl">  How conversion affects profit </h2><br><p><img src="https://habrastorage.org/webt/vy/8x/7m/vy8x7myw1csu5qa3vnrdmusryv8.png"><br>  <em>In the second case, the service fee is higher, but the conversion is also higher, because redundancy and intelligent gateway configuration are used.</em> </p><br><p>  As you can see from the example, it would be beneficial for a business to take a better service and, despite the fact that the commission is higher due to the difference in quality of acquiring, we end up with 3,538,080 - 2,847,000 = 691,080 rubles a month difference!  And this is already 8 million a year, which is very big money for business. </p><br><p>  Conversion, turnover and rates are conditional, but the example shows that the main thing in the service is its stability and quality.  And already this entails an increased conversion and, as a result, a greater turnover for the merchant. </p><br><h2 id="kak-podklyuchaetsya-merchant">  How to connect the merchant </h2><br><p>  As mentioned earlier, we try to maximally cover all with metrics and triggers that automatically trigger on an event.  Let's analyze how everything happens on the example of monitoring one of the merchants. </p><br><p>  After connecting to the Cashier, the merchant, if necessary, is put on monitoring.  We build a graph in Grafana and set up metrics by which automatic alerts are triggered in case of deviations from the specified "normal" values. </p><br><p>  We use Moira to send notifications to the monitoring group chat, which will promptly verify the details.  The notification contains a link to the schedule and details of the incident. </p><br><p><img src="https://habrastorage.org/webt/kr/g-/ef/krg-efr_0h_ou3yxyz0-aqwgdcy.png"><br>  <em>Exactly the real example of a bot message.</em> </p><br><p>  After analyzing the graph, a specialist monitoring team most often uses Kibana to view logs.  Here the situation may be prosaic, and then the error will obviously show an error, or additional analysts will be required to analyze the reasons for the failure. </p><br><p>  In the future, we want to set up auto-notifications of merchants about errors on their side, for example, about server unavailability or non-protocol responses.  This will allow us to quickly respond to a failure and give information to counterparties to eliminate the causes. </p><br><p>  In addition to the technical side, we also carefully look at such business metrics as turnover, income and outflow, but this seems to be a topic for the following stories. </p><br><h3 id="samoe-glavnoe">  The most important thing </h3><br><p>  My ‚Äúdisobedience day‚Äù (namely, this is what we call a temporary transfer to another department) ended, and I returned to Moscow.  For 2 days in the monitoring department I learned a lot of new things and streamlined current knowledge. </p><br><ul><li>  The task of monitoring is to provide current information on the state of the system at all levels; </li><li>  Choose literate metrics and triggers - 90% success; </li><li> In the payment services conversion rate beats; </li><li>  You need to follow the technique and remember about business metrics; </li><li>  We need a systematic view of the processes and the ability to analyze relationships; </li></ul><br><p>  And more - be grateful.  Monitoring guys, thanks! </p><br><hr><br><p>  <em>That's all.</em>  <em>Ask questions, subscribe to our blog and <a href="https://hh.ru/employer/655542">come</a> to visit.</em> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/426583/">https://habr.com/ru/post/426583/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../426571/index.html">System approach to speed: online measurements at the frontend</a></li>
<li><a href="../426573/index.html">ZeroNights 2018. Reload</a></li>
<li><a href="../426575/index.html">Report of the Club of Rome 2018, Chapter 1.12: ‚ÄúFrom the empty world to the complete world‚Äù</a></li>
<li><a href="../426579/index.html">Engie and Ledger have developed a hardware blockchain solution for storing data generated by green energy sources.</a></li>
<li><a href="../426581/index.html">Open lesson "Node.js features overview"</a></li>
<li><a href="../426585/index.html">Under pressure from Instagram and Facebook: why Snapchat can leave the exchange, and why?</a></li>
<li><a href="../426587/index.html">Algorithmic tasks in the frontend. Yandex examples and competition</a></li>
<li><a href="../426589/index.html">On the territory of Skolkovo, unmanned taxi from Yandex starts to run</a></li>
<li><a href="../426591/index.html">Master posture: stay alive</a></li>
<li><a href="../426593/index.html">DJI Phantom 4 RTK: New Generation Cartography</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>