<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Linguistic Epic fail, or How to cram the entire dictionary of the Russian language in Power BI</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Somehow, solving the problem of linguistic analysis in Power BI and at the same time looking for examples for my previous article , I remembered a tas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Linguistic Epic fail, or How to cram the entire dictionary of the Russian language in Power BI</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/ig/jx/ik/igjxikbvwngnl6pdd9voe9ukrvc.jpeg" alt="image"><br><br>  Somehow, solving the problem of linguistic analysis in Power BI and at the same time looking for examples for my <a href="https://habr.com/post/422799/">previous article</a> , I remembered a task that Excel tried to solve several years ago: it was necessary to introduce a Russian language dictionary into the analytical system for linguistic analysis of a large number of queries in natural language.  Moreover, it was desirable to use standard office tools.  The vast majority of people immediately would undertake to solve this problem in Excel, and I once followed the same path.  As a dictionary, I used the open corpus of the Russian language ( <a href="http://opencorpora.org/">http://opencorpora.org/</a> ). <br><br>  But I was disappointed - the dictionary consisted of 300 thousand word forms, more than 5 million entries, and for Excel this is basically an impossible volume.  Even if you push ‚Äúonly‚Äù 1 million lines into it, you can perform any manipulations with them or, God forbid, calculations, only a very patient person who never takes the time and cannot do it can.  But this time I decided to set a more suitable tool on the task - Power BI. <br><a name="habracut"></a><br><h2>  What is Power BI? </h2><br>  I find this product largely undervalued by the professional community.  Power BI is a set of business analysis tools that was created for users who own Excel at a slightly higher level than ‚Äúlump up the amount in columns‚Äù.  If a person is able to write formulas of average complexity in Excel, he will master Power BI in a couple of evenings. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This is not a single product with some kind of internal programmer logic, but a system of three components: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ea3/887/958/ea38879580c8b208c77bf0366d74dc60.png" alt="image"><br><br><ul><li>  <b>Power Query</b> .  This is an ETL in which you use your full-fledged functional programming language for writing queries. For the sake of fairness, it‚Äôs most likely that you don‚Äôt need to program it on the average user: most functions are available directly through the menu or wizard in the component interface.  The M language is completely different from the DAX (PowerPivot) query language.  However, Microsoft brought them together.  There is a certain sense from the point of view of development: ETL is sharpened for receiving and initial data saturation (not fast), and DAX - for calculations that help us visualize this data (quickly).  That is, DAX is designed for the frontend, and Power Query for the backend, for the process of extracting and formatting data. </li><li>  <b>PowerPivot</b> .  Module in-memory-processing, which is based on the engine xVelocity.  Uses the DAX query language, very similar to the Excel formula language. </li><li>  <b>Component visualization</b> .  It is very useful for use in systems where you need to visualize data: on the company's website, or technical support portal (for example, a query cloud), or on an internal corporate resource.  There are tools to do this without Power BI, but many of them will not help when the number of records is in the millions and the data needs to be aggregated somehow.  And with other tools of this kind, Power BI competes due to its simplicity and low cost in-memory processing.  It is clear that if we are talking about terabytes of data, a different approach will be needed here.  And for such cases, Microsoft already has something to offer, but this is a topic for a separate article. </li></ul><br>  The learning curve at the first stage increases very sharply: if you are good at Excel, then 80% of the capabilities of Power BI will be revealed to you after a short study.  This is a very powerful tool, fairly easy to use, but - until a certain point.  To use it at full capacity, you already need experience and deep knowledge of M and DAX languages. <br><br><h2>  What is Power BI Desktop for? </h2><br>  Who can he use?  First of all, any business users who have to process and analyze fairly large amounts of data when Excel can no longer cope or puffs to the limits of its capabilities.  I emphasize - Power BI Desktop is designed <b>for a wide range of users who solve a very diverse range of tasks</b> .  For example, in my case it was about normalizing 5 million text records for the subsequent determination of the frequency of keywords. <br><br>  This is in demand when processing questionnaires, search engine requests, advertisements, dictations / essays, some kind of statistical arrays, etc. Or to solve crossword puzzles ... <br><br>  Another case and implementation variant is considered in the <a href="https://habr.com/company/realweb/blog/264591/">article</a> about the ‚Äúrecognizer‚Äù of Dmitry Tumaykin.  Implemented in classic Excel, but using macros ... <br><br>  Another popular scenario of this use of Power BI is the calculation of the ratio of indicators for the current and the previous period.  For example, we have pre-aggregated revenue data, and we need to compare it by day with the previous quarter, or year, or a similar period.  And you want / need to insert the result of the comparison in the next column in the form of values, and not formulas.  It would seem that for Excel the simplest task is to write a simple comparison formula and stretch the columns across all the cells.  But not if you have several million rows in a table.  In the DAX itself, this problem is solved even easier than in Excel, but also only with the help of post calculations. <br><br>  There are many other practical scenarios for using Power BI, but I think you already understood the essence.  Of course, all these tasks are not a problem for a programmer who owns, for example, Python or R, but such specialists are a priori less orders of magnitude than Excel experts.  Excel is only limited in its capabilities, which cannot be said about Power BI, which uses the formula language DAX, which is very similar to the formula language Excel, and is capable of processing millions and tens of millions of records on the fly.  And then you need to increase the RAM (at least to 100, at least to 300 GB). <br><br><h2>  We help technical support to process requests </h2><br>  But back to my task.  It was necessary to think of how the zero-line technical support automatically evaluate the subject of user requests.  To begin with, I decided to isolate certain word forms and, by the frequency of their appearance in appeals, determine the most important topics that users most often raise. <br><br>  The source dictionary is a simple text file that has a regular structure and looks like this: <br><br><img src="https://habrastorage.org/webt/-j/yj/pi/-jyjpiiq6ttx9cwq3-3ckouy2c0.png" alt="image"><br><br>  For statistical purposes, it was necessary to determine the initial form for each word form: for nouns - the only number of the nominative case, for verbs - the indefinite form, etc.  For programmers, this task was easier: for each word in the left column, find a correspondence to the form immediately after the number of this word in the dictionary. <br><br>  Only an average business user who does not own Python, specialized tools and development skills cannot solve this problem without using self-analytics BI or similar user-friendly tools.  Moreover, if the data needs to be processed for its internal needs or there is no confidential information in them that requires protection, then Power BI in this case will also be free *. <br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  *) This refers to the Power BI Desktop version and the Power BI Services version for personal use at the Free rate. </div></div><br>  To analyze the data, I needed in Power Query, in a table of 5 million records, to add a new column shifted by one position.  At first, I tried to apply the classic approach using Power Query, which was <a href="https://community.powerbi.com/t5/Desktop/Power-Query-previous-row-value-based-on-criteria-O/m-p/125837">described</a> on the Power BI community portal by Marcel Beug, the author of the original interactive Power Query guide (also written in Power Query).  The article proposes two different algorithms: one is inspired by the ideas of Matt Ellington ‚Äî the well-known guru and trainer in Power BI, and the second approach is the original idea of ‚Äã‚ÄãMarcel himself, using an additional function.  Despite the fact that in order to increase the performance, I completely cached the source data, both approaches required a tremendous amount of time - it was already the eighth day, and the process did not end.  The size of the source file was 270 MB, and the current size of the processed data was 17 TB.  I'm sure few Power BI users have seen such numbers in the download window for data from a file source. <br><br><img src="https://habrastorage.org/webt/ox/yq/e_/oxyqe_yrqk_1zhbfscm1rbuvjma.png" alt="image"><br><br>  Why volume is so swollen, it is not clear;  even the Cartesian product of all records turns out to be much less than 16 TB.  Here the internal optimizer was clearly not up to par.  And, for example, DAX-Studio does not allow to trace Power Query queries, only DAX.  Maybe someone will share their experience in PQ trablshuting? <br><br>  Without waiting for the completion of the first process, I decided on another machine to try to solve the problem using DAX by means of a self-written request.  The request was executed ... in about 180 seconds, and memory consumption increased slightly. <br><br><img src="https://habrastorage.org/webt/nb/aw/e2/nbawe2uffzilci2ttxi6ulhqg24.png" alt="image"><br><br>  DAX request source code: <br><br> <code>KeyWord = <br> CALCULATE( <br> TOPN(1; <br> CALCULATETABLE( <br> VALUES(ShiftedList[Word]) <br> ;ALLEXCEPT(ShiftedList;ShiftedList[Word Nr]) <br> ) <br> )//TOPN <br> )//CALCULATE <br> <br></code> <br><br>  That is, for each row in the new [KeyWord] column, the very first value of the [Word] column containing all variants of word forms, having the same number of the base word form (column [Word Nr]) is searched.  As long as the format of the original file remains unchanged, the request should work out without errors and on all subsequent releases of the dictionary. <br><br>  The request code in Power Query, which forms the source table in the required format, was formed ‚Äúon the machine‚Äù and executed in less than a minute: <br><br><img src="https://habrastorage.org/webt/v8/yj/xq/v8yjxq04xubrbgacegv6tiw-q2m.png" alt="image"><br><br>  After a column of keywords has been formed in the PowerPivot interface in three minutes, the search for any word forms in the Power BI interface takes no more than 4 seconds.  Moreover, the control search of the same data in your favorite Notepad ++ x64 could take 20 seconds or more.  But this is not a stone in the NPP garden - it is more difficult (and longer) to search for the entire data array than for the already marked data. <br><br>  By the way, the above DAX request was not born the first time, and the intermediate options consumed all the available memory, worked for a long time and ended with either a data error or an irrelevant result. <br><br><img src="https://habrastorage.org/webt/h0/bm/b_/h0bmb_w7wieehm3olc7lgsfwpnm.png" alt="image"><br><br>  As a result, the size of the saved PBIX file was 60% smaller than the original text dictionary (112 MB), but more than 4 times the size of the ZIP archive with the same dictionary. <br><br>  Returning to the battle between Power Query and DAX: the difference in the duration of the execution of the same operation in different components indicates that Power BI is not a scrap, against which there is no reception.  He has his own character and features of the application that must be considered in his work.  Actually, like any tool.  And the recommendations of even recognized gurus should be treated with caution. <br><br>  It seems that the Nobel laureate Richard Smalley used to say, paraphrasing Clark's first law: ‚ÄúWhen experts say that something is feasible, then probably they are right (they just don‚Äôt know when).  When they say that this is impossible, then, most likely, they are mistaken. ‚Äù <br><br>  Characteristics of the test machine: <br>  <i>Processor: Intel Core i7 4770 @ 3.4 GHz (4 cores)</i> <i><br></i>  <i>RAM: 16 GB</i> <i><br></i>  <i>OS: Windows 7 Enterprise SP1 x64</i> <br><br>  The ready dictionary in Power BI format can be downloaded <a href="https://cloud.mail.ru/public/L79E/N7Lgp9U5J">from here</a> . <br><br>  And <a href="https://app.powerbi.com/view%3Fr%3DeyJrIjoiNjVkOWNlYmUtMTM4MC00ZDI0LWI2N2QtOGE0M2ZhZmRhMmUxIiwidCI6IjU4ZWY5MDU4LWUzYTQtNGZkNy1iOWZmLWQ2NGY4YzExMzEzMyIsImMiOjl9">here</a> is a modified online version of the dictionary.  You can solve crosswords with him at your leisure :) <br><br><img src="https://habrastorage.org/webt/6l/zp/-j/6lzp-jafheccraeyj8hi-ktvt8k.png" alt="image"><br><br>  ... By the way, then, a few years ago, the task was nevertheless solved in Excel, although not 100%.  Just for the analysis of the texts was not used the whole body of the Russian language, and the frequency dictionary.  For the basic text clearing, any of the top100 <a href="http://opencorpora.org/%3Fpage%3Ddownloads">frequency lists of</a> several tens of kilobytes available <a href="http://opencorpora.org/%3Fpage%3Ddownloads">here</a> is quite suitable. <br><br>  <i>Yuri Kolmakov, Expert, Department of Systems of Consolidation and Data Visualization, Jet Infosystems ( <a href="https://habr.com/users/mccow/" class="user_link">McCow</a> )</i> </div><p>Source: <a href="https://habr.com/ru/post/429140/">https://habr.com/ru/post/429140/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../429122/index.html">NetApp Nearest Future</a></li>
<li><a href="../429124/index.html">Atypical organization of videoconferencing in a large chemical company</a></li>
<li><a href="../429126/index.html">On a visit to father</a></li>
<li><a href="../429136/index.html">Samsung introduced a smartphone with a bendable screen</a></li>
<li><a href="../429138/index.html">What hides PDF</a></li>
<li><a href="../429144/index.html">Bending smartphones and other information with Android Dev Summit</a></li>
<li><a href="../429146/index.html">Pulse power unit for teletype from the 1940s (with luminous mercury thyratrons!)</a></li>
<li><a href="../429148/index.html">How "effective managers" drowned Flickr</a></li>
<li><a href="../429150/index.html">Manage your CMS modules using composer</a></li>
<li><a href="../429152/index.html">Android navigation component. Simple things you have to do yourself.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>