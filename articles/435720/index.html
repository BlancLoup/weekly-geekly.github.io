<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Adblock Radio Development</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="tl; dr: Adblock Radio recognizes audio ads using machine learning and Shazam-like techniques. The main open source engine : use it in your products! Y...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Adblock Radio Development</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/so/4b/71/so4b71truayz8-hdmdphw4hgc0e.jpeg"><br><br><blockquote>  <b>tl; dr:</b> <a href="https://www.adblockradio.com/">Adblock Radio</a> recognizes audio ads using machine learning and Shazam-like techniques.  The main <a href="https://github.com/adblockradio/adblockradio">open source engine</a> : use it in your products!  You can join forces to support more radio stations and podcasts. </blockquote><br>  Few people like to listen to radio ads.  I launched the <a href="https://www.adblockradio.com/player">AdblockRadio.com</a> project <a href="https://www.adblockradio.com/player">so</a> that listeners can skip ads on their favorite Internet radio.  The algorithm is published <a href="https://github.com/dest4/adblockradio">open source</a> , and this article describes how it works. <br><br>  Adblock Radio has already tested <a href="https://github.com/adblockradio/available-models/">more than 60 radio stations in seven countries</a> on real data.  It is also compatible with podcasts and works quite well! <br><a name="habracut"></a><br>  Compared to previous implementations, our algorithm offers a universal approach, processing streams from various sources.  From previous implementations, one <a href="https://github.com/quasoft/adblockradio">relies on Internet radio metadata</a> , but only a small portion of the radio is compatible with this method.  Another implementation <a href="https://blog.rekawek.eu/2016/02/24/radio-adblock/">recognizes known jingles</a> , but in many cases the beginning and end of commercial breaks are not marked by a jingle. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In addition to the detection of commercials, the proposed algorithm can distinguish conversation from music.  Therefore, it also avoids chatter and listens to music only. <br><br>  This is a report on my personal work for almost three years.  I launched Adblock Radio at the end of 2015, a few months after graduating from a graduate school in fusion plasma physics.  When Adblock Radio <a href="https://www.adblockradio.com/blog/2016/10/14/ils-parlent-dadblock-radio/">gained some notoriety</a> in 2016, I received threats from lawyers from French radio stations (more details below).  I had to partially close the site, change the system architecture, better study the legal implications, etc. Today, I believe that AdBlock Radio will develop much better in the paradigm of <a href="https://en.wikipedia.org/wiki/Open_innovation">open innovation</a> . <br><br>  This article consists of three parts.  They are intended for different audiences.  You can scroll down or click on the title to go directly to the desired section. <br><br><ul><li>  <b><a href="https://habr.com/ru/post/435720/">Ad detection: proven strategies</a></b> .  For tech-savvy people, scientists, data analysts ... Here are various technical methods that I tried to detect advertisements, including speech recognition, sound prints and machine learning.  Thoughts on options for further work. </li><li>  <b><a href="https://habr.com/ru/post/435720/">It is not recommended to run Adblock Radio in the cloud</a></b> .  For software developers and people interested in copyright.  Let's discuss how difficult it is to find a satisfactory compromise between technical and legal constraints when running Adblock Radio in cloud services.  For these reasons, it is better to run Adblock Radio only on end-user devices. </li><li>  <b><a href="https://habr.com/ru/post/435720/">You can integrate Adblock Radio into your player</a></b> .  For manufacturers, product owners, UX designers, techies ... I am considering ideas for integrating an open source algorithm into final products, including car players, and emphasize the need to get feedback from users about incidents of improper operation.  It is necessary to maintain the system.  Finally, here are tips on how to create the right user interfaces.  I expect a lot of feedback on this topic. </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c1d/ea9/09c/c1dea909ca297c940bf1630652af64a0.png"><br>  <i><font color="gray">Adblock Radio returns the pleasure of listening to the radio</font></i> <br><br><a name="1"></a><h1>  Ad detection: proven strategies </h1><br>  To block an ad, you first need to find it.  The goal is to detect an advertisement in an audio stream without any help from the radio station.  This is not an easy task.  I tried several approaches before getting a good result. <br><br><h2>  1. Simple ways (do not work) </h2><br><h3>  Volume </h3><br>  The first idea is to check the volume of the sound, because the ads are so loud!  For advertising, <a href="https://en.wikipedia.org/wiki/Loudness_war">acoustic compression is</a> often used.  This is an interesting criterion, but it is not enough to distinguish advertising.  For example, this strategy works quite well for classical music stations, where advertising is usually louder than music.  But pop music is as loud as advertising.  Moreover, some advertising on purpose can be made silent to avoid detection. <br><br><h3>  Lock on the clock </h3><br>  Another idea is that advertising is broadcast on a schedule at a specific time.  To some extent this is true, but there is no accuracy here.  For example, I watched as the <a href="http://www.europe1.fr/emissions/la-revue-de-presque-de-nicolas-canteloup">morning show</a> on the French station did not start at exactly the same time, with variations of up to two minutes.  Radio stations can easily bypass such blocking by randomly shifting their programs by several tens of seconds. <br><br><h3>  Metadata </h3><br>  The obvious solution is to rely on <a href="http://www.smackfu.com/stuff/programming/shoutcast.html">ICY / Shoutcast metadata</a> , according to which players like <a href="https://www.videolan.org/">VLC</a> display information about the stream.  Unfortunately, this data is in most cases broken.  It would be possible to take information from a live broadcast on the websites of radio stations (I developed a <a href="https://github.com/adblockradio/webradio-metadata">tool for this</a> ), but more often advertising is not identified as it is.  Usually during the advertising on the site displays the name of the previous song or program.  One notable exception is <a href="http://www.jazzradio.fr/">Jazz Radio</a> , which during the commercials writes <i>‚Äúla musique revient vite ...‚Äù</i> (the music will be back soon).  In conclusion, it should be noted that this is an unreliable strategy, since radios can very easily change metadata. <br><br><h3>  Manual marking </h3><br>  In the end, the detection of advertising is possible without any algorithm at all!  You can simply ask some listeners to press a button when an advertisement begins and ends.  Other listeners will benefit from this.  This is the strategy of the <a href="https://www.engadget.com/2015/09/30/tivo-bolt-4k-commercial-skipmode/">TiVo Bolt</a> set-top box.  It allows you to delete ads on installed channels at a set time.  This gives excellent results, but does not scale to thousands of radio stations. <br><br>  The disadvantage is that it is difficult to start the system from scratch.  At the new station, there may not be enough audience to work properly.  The first listeners will be upset and leave, so the station will never gather a large enough audience. <br><br>  Another difficulty is that radio stations will want to send fake signals to sabotage the system.  It requires a moderation mechanism, a consensus system, or a voting threshold. <br><br>  Crowdsourcing is a good idea.  I think it looks even better if the algorithm does most of the work, leaving a minimum for people.  This is what I did. <br><br><h2>  2. Speech recognition and analysis of the lexical field (failure) </h2><br>  Advertising is always the same subject and lexical field: buying a car, getting supermarket coupons, subscribing to insurance, etc. If you recognize a speech, you can use standard <a href="https://spamassassin.apache.org/">tools to combat spam</a> .  This was my first research path at the end of 2015, but I was unable to implement speech recognition. <br><br>  Being a newcomer to speech processing, I began by reading <a href="https://dl.acm.org/citation.cfm%3Fid%3D560905">Huang's The Oral Processing</a> , an excellent book, although a bit dated.  I put my dirty little hands on <a href="https://cmusphinx.github.io/">CMU Sphinx</a> , the best free speech recognition engine at the time. <br><br>  The first attempt gave very poor results and required intensive computations on the CPU.  I used the default parameters: a standard French dictionary (a list of possible words and corresponding phonemes), a language model (probabilities of word sequences), and an acoustic model (connection of phonemes with a sound waveform). <br><br>  Attempts to improve the system were in vain: recognition still worked poorly.  I set up a dictionary and language model on a small data set, sharing the sound <a href="http://www-lium.univ-lemans.fr/diarization/doku.php/Welcome">with a diarization tool</a> .  Also <a href="https://cmusphinx.github.io/wiki/tutorialadapt">adapted the MLLR acoustic model</a> to the Europe 1 (French) radio station, where he trained the system. <br><br>  In general, the idea of ‚Äã‚Äãspeech recognition had to be abandoned.  This is probably for experts.  However, in the future you can return to it.  Since 2015, significant progress has been made in speech recognition.  New open source tools such as <a href="https://github.com/mozilla/DeepSpeech">Mozilla Deep Speech have been</a> published. <br><br><h2>  3. Crowdsourcing advertising base, the detection of sound prints (encouraging) </h2><br>  <a href="https://twitter.com/PierreCol/status/784851362207137792">The first version of</a> Adblock Radio in 2016 worked with a base of commercials.  The system continuously listened to the sound stream in search of advertising.  The results were really promising, but it turned out to be difficult to keep such a database up to date. <br><br>  The audio fingerprint search technique is similar to what <a href="https://www.ee.columbia.edu/~dpwe/papers/Wang03-shazam.pdf">Shazam does on its</a> song recognition <a href="https://www.ee.columbia.edu/~dpwe/papers/Wang03-shazam.pdf">servers</a> .  This type of algorithm is commonly known as a <i>landmark</i> .  I adapted it for streaming and <a href="https://github.com/adblockradio/stream-audio-fingerprint">opened the source code</a> . <br><br>  Fingerprinting is suitable for the detection of commercials, because they are repeatedly broadcast in the same form.  For the same reason, he recognizes music.  But this technique will not work on speech, because people never utter words the same way.  This is only possible with a re-broadcast of programs at night that does not interest us.  Thus, in the database of prints you need to make and advertising, and music (as "not advertising"), but it makes no sense to process speech. <br><br>  In essence, sound prints are the conversion of some sound characteristics into a series of numbers called fingerprints.  If many prints live on the air coincide with the base, it can be concluded that the advertisement is being broadcast.  For optimal resolution, the time and frequency ranges need some adjustment.  Different samples should vary well.  However, the system should work even with a slight change in the sound compression algorithms, or if the radio station has changed the equalizer settings.  Finally, you should limit the number of prints so as not to load computing resources. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6e7/860/99b/6e786099b35bb12604acae2049d4e26b.png"><br>  <i><font color="gray">An example of the calculation of sound prints.</font></i>  <i><font color="gray">Red background - spectrogram.</font></i>  <i><font color="gray">It reflects the change in sound intensity in frequency (low frequencies below).</font></i>  <i><font color="gray">On this map, spectral peaks are identified (blue dots) and connected (gray lines).</font></i>  <i><font color="gray">The position, length and orientation of each gray line is converted to a unique number, imprint</font></i> <br><br>  Binary classification gives the result: is the sample advertising or not.  If we analyze the cases of errors, the system almost always gave a false negative result, that is, it missed advertising, and very rarely marked good content as advertising.  Users can report undetected ads with one click, providing a great user interface.  The corresponding sound is automatically added to the database.  I moderated these actions a posteriori. <br><br>  It was difficult to keep the database up to date, as commercials change frequently, and ads are broadcast with minor variations.  They are also updated frequently, in some cases every few days.  Some streams with an insufficient number of listeners were very poorly recognized. <br><br>  I researched interesting strategies for partial automation of the work of students.  Ads are broadcast the same way many times every day.  This can be used to identify them.  Records were searched for the <i>most repetitive sequences</i> (MRS).  Other content is also repeated, for example, songs and jingles (screensavers).  I sorted all sequences by length and took samples with a length of about 30 seconds, typical of commercials.  Thus, it was often possible to catch advertising.  But sometimes there were choruses of songs or even recorded weather forecasts. <br><br>  I found a way to filter out most of the music replays: I <a href="https://github.com/dest4/radio-playlist-generator">analyzed the station's playlists, downloaded the songs,</a> and integrated them into the database with the label ‚Äúnot advertising.‚Äù  Therefore, more and more candidates for MRS turned out to be real commercials.  But still not everything, so user assistance remained necessary. <br><br>  It took less manual work, but the load on the servers has already become a problem.  Looking back, the choice of SQLite for these resource-intensive, time-critical database operations turned out to be far from the best. <br><br>  Fortunately, the algorithm had a few seconds to determine whether the sound is advertising or not.  This is because Internet radio uses an audio buffer, typically 4-30 seconds, which is not immediately played on the end-user device.  This helps prevent interruptions in the event of a temporary network loss. <br><br>  I used this buffer latency for post-processing to make the predictions of the algorithm more stable and context-sensitive.  Immediately before playing the sound on the end-user device, the algorithm looks at the results of the predictions that are still in the buffer, as well as the older ones that have already been played.  It cuts out questionable data points with multiple fingerprints, showing a <a href="https://en.wikipedia.org/wiki/Hysteresis">hysteresis</a> .  It also takes into account the weighted average time to smooth out possible failures. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d4f/c7c/04a/d4fc7c04ab0b38f39f48da835f9e277f.jpg"><br>  <i><font color="gray">Adblock Radio at a certain stage in 2016.</font></i>  <i><font color="gray">Highlighting the red radio stations, where advertising is currently sounding, looked really great!</font></i>  <i><font color="gray">Users could mark missed ads with a blue button.</font></i>  <i><font color="gray">The music-in-a-cloud button at the top allows you to export a custom MP3 stream with advertising removed from it and, if such a function is configured, with smooth transitions between radio stations.</font></i>  <i><font color="gray">The following are additional buttons and features.</font></i> <br><br><h3>  4. Classification of advertising, conversations and music in machine learning (almost ready!) </h3><br>  The next version of the algorithm analyzes the acoustics: from low to high sounds and their change over time.  New unknown commercials are detected almost as well as the old ones, where the training took place, only on the basis of noisy and intrusive signs.  This is a more sophisticated method of analyzing the volume of a sound (see previous discussion). <br><br>  For this, I used machine learning tools, namely the <a href="https://keras.io/">Keras</a> library, connected to <a href="https://www.tensorflow.org/">Tensorflow</a> .  This gave very good results with low CPU utilization.  This version has been in production for over a year, from the beginning of 2017 to the middle of 2018.  Now it‚Äôs realistic to distinguish between talk and music, so the classification has become more accurate: instead of ‚Äúadvertising / not advertising‚Äù - ‚Äúadvertising / conversation / music‚Äù. <br><br>  We study the details.  The sound is converted to a 2D map, where the sound intensity is presented as a function of frequency and time (on a scale of about four seconds).  This card is conceptually similar to the red card in the chapter on prints.  The main difference is that instead of the classical Fourier spectrum, I used <a href="https://en.wikipedia.org/wiki/Mel-frequency_cepstrum">Mel-cepstral coefficients</a> that are relevant in the context of speech recognition. <br><br>  Sequential cards with different time stamps were then analyzed as pictures in a <a href="https://en.wikipedia.org/wiki/Recurrent_neural_network">recurrent neural network</a> like <a href="https://en.wikipedia.org/wiki/Long_short-term_memory">LSTM</a> (long short-term memory).  Each card was analyzed independently of the other (RNN <i>stateless</i> ), but the cards overlapped each other.  The cards were 4 seconds long and a new one appeared every second.  The end result for each card was a <a href="https://en.wikipedia.org/wiki/Softmax_function">softmax</a> vector, for example, <code>ad: 72%, talk: 11%, music 17%</code> .  These forecasts were then processed by the same method as described in the section on prints. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd9/625/87e/fd962587ee0d346bf5460541f3b1121c.png"><br>  <i><font color="gray">Preview typical machine learning results for two radio stations.</font></i>  <i><font color="gray">The horizontal axis represents about 17 minutes of time.</font></i>  <i><font color="gray">The green line moves between three positions: advertising at the top, conversation in the middle and music at the bottom (the closest to the uniform gray background).</font></i>  <i><font color="gray">Red areas - intervals of listening to the sound by the user.</font></i>  <i><font color="gray">If the algorithm gives an incorrect prediction, the user can correct it.</font></i> <br><br>  Initially, I trained the neural network on a very small data set.  I developed a UI (see figure above) to visualize forecasts and could add more data to train models with better performance.  At the time of this writing, the training dataset contains about ten days of audio: 66 hours of advertising, 96 hours of conversations and 73 hours of music. <br><br>  Despite the good work, the classification accuracy still turned out to be slightly lower than the users' expectations (see the section below on future improvements).  When training, the accuracy of the forecast category was 95%, but the remaining incorrect classifications left users dissatisfied. <br><br>  <i>Note to data processing professionals: it is common practice to present formal results by breaking the data set into subsets of training and testing.</i>  <i>I think that here it does not make sense, because the data set is gradually built on the data, where previous models were wrong.</i>  <i>This means that the data set contains more pathologies than the average broadcast, and accuracy will be underestimated.</i>  <i>Separate work on measuring real indicators will be required.</i>  <i>The operator can mark continuous segments of regular audio recordings as test data, then calculate the accuracy and recall on them.</i>  <i>Such regular testing will allow you to monitor the performance of filters.</i> <br><br>  The categorization of advertisements / conversations / music added convenience to listeners.  However, this classification has complicated the user interface, and it has become more difficult to work with user reports.  If the flag indicates that some content is not music, is it an advertisement or conversation?  It requires immediate moderation, not after the fact. <br><br>  To further improve quality, I developed the latest version of Adblock Radio, which slightly improves this strategy. <br><br><h3>  5. The combination of sound classification and matching prints (success!) </h3><br>  My best algorithm is <a href="https://github.com/adblockradio/adblockradio">published on Github</a> .  To improve reliability, it combines the concepts of the two previous attempts: acoustic classification and the base of prints. <br><br>  A properly trained machine learning predictor provides the correct classification of most of the source materials, but does not work in some situations (see below in the section on future improvements).  The role of the fingerprint matching module is to reduce the errors of the machine learning module. <br><br>  Not all known training data are entered into the database of prints, but only a small subset where machine learning demonstrates errors.  I call it the ‚Äúhotlist database‚Äù (hotlist database).  The small size helps to reduce the overall error rate while keeping the CPU load low. <br><br>  On an ordinary laptop, the algorithm consumes only 5-10% of CPU on files and 10-20% on live broadcast. <br><br><h2>  Future improvements </h2><br><h3>  Some content is still problematic. </h3><br>  The detector works imperfectly on some specific types of audio content: <br><br><ul><li>  hip-hop music is often recognized as an advertisement.  You can get around the problem by adding tracks to the hotlist, but this is too much music.  A more general neural network could be developed, possibly at the expense of performance. </li><li>  Music album ads are often recognized as music.  But blocking through fingerprints will lead to false positives when the real song is broadcast.  The problem can be solved by a deeper analysis of the context, but it is difficult on the air, where the context is known only for a few seconds ahead. </li><li>  Talk show advertising is often recognized as a conversation.  There are blurred boundaries, because it is both a conversation and an advertisement.  We see the limit of the classifier advertising / conversation / music.  For classification by prints, for some time I used the <i>ad_self</i> class, which contains advertisements for talk shows at specific stations, but with the implementation of the machine learning algorithm I stopped doing this.  It may be wise to recreate this class.  Another option is a better context analysis. </li><li>  native advertising, where the presenter reads the sponsor's text.  On the radio, this is rare, and more often in podcasts.  The logical next step for blocking such advertising is the introduction of speech recognition software. </li></ul><br><h3>  Markov chains for more stable post processing </h3><br>  Postprocessing stability can be improved.  Currently only confidential thresholds are used.  When the threshold value is reached, the last confident forecast is taken.  Thus, the system sometimes saves the error. <br><br>  The cycles of advertising, conversations and music are quite cyclical on every broadcast.  For example, advertising usually lasts a few minutes.  For each period of time in the commercial break, you can calculate the probability of transition to another state (conversation or music).  This probability will help to better interpret the noisy predictions of the algorithm: is it just a short segment of the music in the announcement or is the commercial break completed?  Here, <a href="https://en.wikipedia.org/wiki/Hidden_Markov_model">hidden Markov models</a> will be a good line of research. <br><br><h3>  Analog radio is not yet supported. </h3><br>  Analog signals (FM) have not been tested and are not currently supported.  Analog noise cancels the methods used here.  Filters and / or noise-proof fingerprint recognition algorithms may be required.  If this happens, the program is able to find wider use among users.  However, the radio is increasingly moving to digital technology without noise, such as <a href="https://en.wikipedia.org/wiki/Digital_audio_broadcasting">DAB</a> and Internet radio. <br><br><a name="2"></a><h1>  Do not run Adblock Radio in the cloud </h1><br>  Ideally, Adblock Radio should only be run on end devices.  But now cloud services are in fashion.  Moreover, it is a great business idea!  Adblock Radio tested two versions of the architecture with this paradigm.  However, experience shows that this is not the best option for technical and legal reasons. <br><br><h2>  Option 1. Relay from the server </h2><br>  The server can relay audio content with ad / talk / music tags to listeners.  We tested it in 2016.  There are legal problems here, since stream relaying can be considered as fake and / or copyright infringement (although I am not a lawyer).  It also doesn‚Äôt scale well because you are now a CDN and have to incur costs. <br><br>  For the sake of a joke, on Sunday, when I was absent for family reasons, Adblock Radio got wildly popular, <a href="https://en.wikipedia.org/wiki/Slashdot_effect">from which it fell</a> .  Funny fact: a few days later <i>France Inter</i> , a large French public radio station, <a href="https://www.adblockradio.com/blog/2016/10/14/ils-parlent-dadblock-radio/">advertised Adblock Radio</a> in prime time (though not naming it).  This is an unexpected decision by the editorial board in the context of the fact that regulators decided in 2016 to <a href="https://www.radiofrance.fr/espace-pro/espace-presse/communiques-de-presse/2016/04/nouveau-decret-relatif-la-publicite-sur-radio">relax restrictions on advertising on public radio stations</a> , which aggravated the <a href="http://www.lepoint.fr/medias/les-antennes-de-radio-france-perturbees-par-la-greve-29-06-2016-2050464_260.php">discord between Radio France employees and management</a> . <br><br>  A few weeks later, I received threats from a lawyer at the French private radio network <i><a href="https://en.wikipedia.org/wiki/Les_Ind%25C3%25A9s_Radios">Les Ind√©s Radio</a></i> , allegedly on the basis of copyright and trademark infringement.  Not having financial resources for serious protection, I had to remove some streams from the site, partially close the site and change the system architecture.  At the same time, this radio network refused to cooperate in the search for a compromise.  Since I see in the logs that they continued to monitor my site (sometimes with pseudonymous accounts), they also consulted with <a href="http://oxavocats.com/">their lawyers</a> .  What an honor for me!  In retrospect, they successfully won time, but no more.  Hi guys from Ind√©s!  Hope you enjoy reading this!  <a href="https://www.youtube.com/watch%3Fv%3DdQw4w9WgXcQ">xoxoxo</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/027/237/045/02723704599fab6c9543b33e2f8a4447.jpg"><br>  <i><font color="gray">A declaration of love from Les Ind√©s, a network of 131 French radio stations</font></i> <br><br><h2>  Option 2. The server relays the sound, but privately. </h2><br>  Here it is supposed to analyze on the server and retransmit the cleared sound for a specific user.  Such a system may be subject to an exception to copyright law as its own private copy of the media.  If the server is managed by the end user and the source is legal and officially available in your area, everything is probably legally clean.  For more information, see the discussions of <a href="http://www.feral-avocats.com/fr/publication/stream-ripping-la-question-de-la-liceite-de-la-copie-privee-a-lere-du-streaming-reste-posee/">Station Ripper [FR]</a> and <a href="https://www.nextinpact.com/news/105549-lextension-copie-privee-dans-cloud-entre-mains-justice-europeenne.htm">VCast [FR]</a> .  But users are rarely technically savvy to self-rent and install a server. <br><br>  It is very tempting to put a server under the control of a third party, but this leads to legal problems, because then the operator making the copy and the end user are not the same person.  In this case, legal restrictions are imposed, at least in France.  The French Internet service <a href="https://fr.wikipedia.org/wiki/Wizzgo">Wizzgo [FR]</a> ran into this rule in 2008.  More recently, in the US, the <a href="https://en.wikipedia.org/wiki/Aereo">Aereo</a> television service was closed, although it took precautions to distribute a <a href="http://www.worldtvpc.com/blog/aereo-plan-service-york/">separate tuner to each client</a> (!). <br><br>  At the moment, the service <a href="https://fr.wikipedia.org/wiki/Molotov_TV">Molotov.TV [FR] is</a> fighting with the right holders who want to <a href="https://www.nextinpact.com/news/106506-bras-fer-entre-molotov-tf1-et-m6-pourquoi-nous-saisissons-hadopi.htm">limit its functions [FR]</a> , despite the significant influence of its co-founders.  You must <a href="https://www.legifrance.gouv.fr/affichCodeArticle.do%3FcidTexte%3DLEGITEXT000006069414%26idArticle%3DLEGIARTI000006279076%26dateTexte%3D%26categorieLien%3Dcid">pay to the official organization a <i>tax on a private copy of</i> [FR]</a> .  The amount is determined by <a href="https://www.nextinpact.com/news/106731-copie-privee-bareme-molotov-sera-determine-sans-marche-public.htm">rather opaque calculations [FR]</a> and <a href="https://www.nextinpact.com/news/106730-copie-privee-stream-ripping-prochaine-mine-dor-ayants-droit.htm">increases [FR]</a> every year, reaching several dozen eurocents per user per month.  This board has become so high that Molotov.TV recently <a href="https://www.nextinpact.com/news/106899-copie-privee-trop-chere-fin-bookmarks-sur-abonnements-molotovgratuits.htm">removed the functions of its service for free users [FR]</a> .  (Note: I sincerely thank the journalists of the French site <i><a href="https://www.nextinpact.com/">NextINpact</a></i> for very good coverage of this topic). <br><br>  Paying is not enough: the law requires entities like Molotov.TV <a href="https://www.legifrance.gouv.fr/affichCodeArticle.do%3FcidTexte%3DLEGITEXT000006069414%26idArticle%3DLEGIARTI000020740176">to sign [FR] agreements</a> with copyright companies on the functionality of their service.  Try to reach an agreement with radio companies if you start cutting their ads. <br><br><h2>  Option 3. The server sends only metadata. </h2><br>  Another option is for the user and the server to simultaneously listen to the same Internet radio.  At the same time, the server analyzes the sound and sends classification metadata (ad / talk / music) to the user, but not audio content.  Since 2017, <a href="https://www.adblockradio.com/">adblockradio.com</a> has been working on such an architecture.  It relies on CDN, so it does not incur any costs in terms of audio broadcast. <br><br>  This architecture removes the problem of copyright infringement (disclaimer: I am not a lawyer).  However, there may still be some ambiguity regarding trademark laws.  Recently (October 2018), <a href="https://skyrock.fm/">Skyrock</a> radio <a href="https://skyrock.fm/">owners</a> demanded that content be removed on this basis. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aa8/d87/7c0/aa8d877c0d17111b285fcfd93520025c.jpg"><br>  <i><font color="gray">Romantic message from the Skyrock legal department</font></i> <br><br>  In addition to legal considerations, there is a technical problem of correct synchronization between sound and metadata.  In most cases, everything works fine with a synchronization interval of less than two seconds.  But some radio stations have strange / malicious CDNs or they dynamically insert ads into the stream.  This means that the flow between the server and different clients may differ significantly.  For example, on <a href="https://www.radiofg.com/">Radio FG</a> , lags for up to 20 seconds were observed, and for <a href="http://www.jazzradio.fr/">Jazz Radio</a> - up to 45 seconds.  It disappoints the listeners. <br><br>  Synchronization can be rigidly implemented by comparing data blocks between a server and a user.  Unfortunately, this does not work in web browsers, because most CDNs on Internet radio stations do not use <a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS headers</a> .  Therefore, JavaScript in the browser will not be able to read the audio content for comparison.  You will need separate stand-alone modules (for example, <a href="https://electronjs.org/">Electron</a> ), Flash (aha) modules or web extensions, which seems a bit redundant. <br><br><a name="3"></a><h1>  You can integrate Adblock Radio into your player. </h1><br>  This project is not for end users, but for companies that produce a mass product.  You can do this! <br><br>  Developers have two options for integrating Adblock Radio.  First, the <a href="https://github.com/adblockradio/adblockradio-sdk">SDK</a> just takes the metadata from the adblockradio.com server.  This is not an ideal solution for the reasons described above (legal and timing issues).  It is better to run the full <a href="https://github.com/adblockradio/adblockradio">analysis algorithm</a> . <br><br><h2>  Software </h2><br><ul><li>  Mobile applications for Internet radio and podcasts.  Keras models need to be converted to native Tensorflow, and Keras + Tensorflow can be replaced with <a href="https://www.tensorflow.org/lite/">Tensorflow Lite for Android and iOS</a> .  Node.JS routines are implemented using <a href="https://www.npmjs.com/package/nodejs-mobile-react-native">the React Native plugin</a> or in case of emergency with <a href="https://termux.com/">Termux</a> . </li><li>  browser extensions work with <a href="https://js.tensorflow.org/">Tensorflow JS</a> and <a href="https://github.com/kripken/sql.js/">SQL.js.</a>  The extension can control the volume slider in popular Internet radio directories such as <a href="https://tunein.com/">TuneIn</a> or <a href="http://www.radio.de/">Radio.de</a> .  I have already worked on this extension.  It was fun to tinker with JavaScript players to get this control.  Depending on your implementation, keep in mind the timing issues we discussed above. </li></ul><br><h2>  Hardware </h2><br><ul><li>  digital alarm clocks and amateur projects, subject to the availability of sufficient computing power and access to the network.  Platforms like Raspberry Pi Zero / A / B should be sufficient for analyzing a single stream, although RPi 3B / 3B + is recommended for parallel management of multiple threads.  Tensorflow is on <a href="https://www.tensorflow.org/install/install_raspbian">Raspbian</a> . </li><li>  connected speakers like <a href="https://musicpartners.sonos.com/%3Fq%3Ddocs">Sonos</a> .  The algorithm itself will not work on such equipment, so you need to process data either in the cloud or on a separate device on the same local network (for example, on Raspberry).  Great idea for a crowdfunding campaign. </li></ul><br><h2>  Adblock Radio in the car </h2><br>  The car is one of the most popular places to listen to the radio.  There, people really need an ad blocker.  But this is the context where implementing Adblock Radio is not easy.  After all, the system should receive feedback in order to effectively filter new advertisements, so the program needs a network connection.  I see three possible concepts for automotive products with Adblock Radio. <br><br><ul><li>  <b>Application compatible with the infotainment systems of modern cars</b> .  Probably the easiest way to transfer data is through the user's smartphone.  The smartphone can also be used separately - with a mobile application, streaming Internet radio, via audio output, connecting to the car's AUX or Bluetooth.  It can also be integrated with the car's infotainment system, in the spirit of <a href="https://www.apple.com/ios/carplay/">Apple Car Play</a> , <a href="https://www.android.com/auto/">Android Auto</a> and <a href="https://mirrorlink.com/">MirrorLink</a> .  It would be fantastic to listen to terrestrial radio (FM, DAB).  But work is needed to determine in which configurations Adblock Radio can access the audio output of the radio tuner and, at the same time, control it (volume, channel). </li><li>  <b>Universal hardware adapter, dedicated user interface</b> .  It is also possible to develop non-standard equipment, similar to existing <a href="https://www.autoexpress.co.uk/accessories-tyres/88304/best-dab-car-radio-adaptors-2018-group-test">DAB-adapters for cars</a> .  These devices are tuned to radio stations and transmit audio data to the car system via the AUX connector or via an unused FM channel, like <a href="https://duckduckgo.com/%3Fq%3Dipod%2Bfm%2Badapter%26t%3Dffsb%26iar%3Dimages%26iax%3Dimages%26ia%3Dimages">old iPod FM adapters</a> .  Access to the network can be via a smartphone via a Bluetooth connection.  Alternative solutions could be considered, such as <a href="https://www.sigfox.com/en">Sigfox</a> and <a href="https://lora-alliance.org/">LoRa</a> , if the bitrate and price are appropriate.  A special user interface should be developed, separately from the main car device.  In the end, this may be too expensive solution. </li><li>  <b>The minimalist device that hacks FM-receiver</b> .  Such a small device can, if necessary, manage the tuner.  We need a standard, but easy to connect interface.  <a href="https://tacotunes.com/toyota-tacoma-double-access-cab-xrunner/how-to-install-steering-wheel-controls-to-work-with-new-stereo/">Steering wheel switches are a</a> good candidate, but end users cannot easily modify them for this purpose.  So you need to hack the system. <br><br>  This headless device will have an FM tuner and a microphone for analyzing which station the user is listening to (cross-correlation).  When an advertisement is detected, the device <a href="https://www.adafruit.com/product/1958">emits</a> fake <a href="https://en.wikipedia.org/wiki/Radio_Data_System">RDS</a> data (for example, <a href="https://en.wikipedia.org/wiki/Traffic_announcement_(radio_data_systems)">traffic announcements</a> ) to trick the car's tuner and change the station for the duration of the advertisement.        FM-. <br><br>     ,    .  ,    .  ,     ,    <a href="https://en.wikipedia.org/wiki/Unlicensed_broadcasting">    </a> . , ,           DAB. </li></ul><br>     ,       .  ,    . <br><br><h2>            </h2><br>   Adblock Radio  , ,    .       ,          . <br><br>   :     ()  ,   .   <a href="https://github.com/adblockradio/adblockradio"></a>   . <br><br>    .    ,    ,        adblockradio.com. <b> </b> ,         -.           .    , , <a href="https://www.adblockradio.com/player"> </a>    <a href="https://github.com/adblockradio/available-models"></a> ,      . <br><br><h2>   :  UX </h2><br>     :         .  ,     .         ! <br><br>  adblockradio.com    : <br><br><ul><li>   </li><li>          .  ,     .         . </li><li>     .     . </li></ul><br>       ,   - .   ,        ,   <i>  </i> .      . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dd6/28c/8c1/dd628c8c14e6a64cd7addc417a162c85.png"><br> <i><font color="gray"> <a href="https://www.adblockradio.com/player">-</a> Adblock Radio</font></i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cad/b61/9be/cadb619bed75fa25185e4bfda15c626a.png"><br> <i><font color="gray"> ,     .       .      ,      . .    !  ,       </font></i> <br><br>        .       adblockradio.com   ,  .        ( <a href="https://github.com/adblockradio/buffer-player">   Github</a> ),   <a href="https://en.wikipedia.org/wiki/Digital_video_recorder"> </a> .         10  ( ,  ,  7.30      7.20).         ‚Äî       .                .       ,    . <br><br>    ,      .      ,       ?  ,       ( )  . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/66c/efd/e51/66cefde51490832f5892e7e61f0a2795.png"><br> <i><font color="gray"><a href="https://github.com/adblockradio/buffer-player"> </a>     .    .   ,  ,   ‚Äî .       (ads),   </font></i> <br><br>              ‚Äî          .   ,    ,    . . -,   ¬´¬ª      ,      :  , ,  ,    . . ,   <a href="https://www.adblockradio.com/blog/2018/07/25/better-radio-without-ads/"> -  </a> . <br><br><h1>  Conclusion </h1><br>             ,   .        .  ,      ,   ,     WiFi-.         (FM, DAB+).  ,         ,         . <br><br> <b>    Adblock Radio.</b> <br><br><ul><li>  :  <a href="https://www.adblockradio.com/player"></a> ,      ,    .    ?  ,  <a href="https://github.com/adblockradio/available-models/"></a>   . </li><li>  :   <a href="https://github.com/adblockradio/adblockradio/"></a> ,  ,    .   <a href="https://github.com/adblockradio/buffer-player"></a>    Electron. </li><li>   :   ,    Adblock Radio   .   . </li></ul><br>        ! ,  . </div><p>Source: <a href="https://habr.com/ru/post/435720/">https://habr.com/ru/post/435720/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../435706/index.html">Use rcm to deploy the configuration to any folder</a></li>
<li><a href="../435708/index.html">Faial: a meeting place in the Atlantic</a></li>
<li><a href="../435712/index.html">Procter & Gamble has released a ‚Äúrejuvenating‚Äù skin printer</a></li>
<li><a href="../435714/index.html">Ukrainian developers have been given access to files from all Ring camcorders in the world.</a></li>
<li><a href="../435718/index.html">We pump Angular NGSW with the help of custom logic in the Service Worker</a></li>
<li><a href="../435722/index.html">NB-IoT, Narrow Band Internet of Things. Power saving modes and control commands</a></li>
<li><a href="../435724/index.html">Holding back the imperatives</a></li>
<li><a href="../435728/index.html">[Friday] Tale about how IT-sale of firewood tried to sell, or Baxtage of one tender</a></li>
<li><a href="../435730/index.html">Shell cracked</a></li>
<li><a href="../435732/index.html">Friday JS: Quic, which plays tic-tac-toe</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>