<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Machine Learning for an Insurance Company: Improving the Model through Algorithm Optimization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We leave to the finish line. A little more than two months ago, I shared with you an introductory article about what machine training was needed in an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Machine Learning for an Insurance Company: Improving the Model through Algorithm Optimization</h1><div class="post__text post__text-html js-mediator-article">  We leave to the finish line.  A little more than two months ago, I shared with you an introductory article about what machine training was needed in an insurance company and how the realism of the idea itself was tested.  Then we talked about testing algorithms.  Today there will be the last article in the series in which you will learn about improving the model through the optimization of algorithms and their interaction. <br><br><img src="https://habrastorage.org/web/a15/44e/b74/a1544eb742ad4ef3bb36dca5a17b1318.jpg"><br><a name="habracut"></a><br><h2>  The series of articles "Machine learning for an insurance company" </h2><br>  1. <a href="https://habrahabr.ru/company/microsoft/blog/329082/">Realistic ideas</a> . <br>  2. <a href="https://habrahabr.ru/company/microsoft/blog/331484/">We investigate the algorithms</a> . <br>  3. <a href="https://habrahabr.ru/company/microsoft/blog/334556/">Improving the model through algorithm optimization</a> . <br><br><h2>  Setting the complexity of the model and the boundaries of the definition of classes </h2><br>  Not always the minimum error on the training sample corresponds to the maximum accuracy on the test, since an unnecessarily complex model may lose the ability to generalize. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      An error in machine learning consists of three parts: <b>Bias</b> , <b>Variance</b> and <b>Noise</b> .  With noise ( <b>Noise</b> ), as a rule, nothing can be done: it reflects the influence on the result of factors not considered in the model. <br><br>  With <b>Bias</b> and <b>Variance, the</b> situation is different.  The first displays an error associated with poorly developed dependencies, decreases with increasing complexity and for large values ‚Äã‚Äãindicates that the model is not sufficiently trained.  The second reflects the sensitivity of the model to fluctuations in the values ‚Äã‚Äãof the input data, increases with increasing complexity and indicates retraining.  Hence the concept of <b>bias / variance tradeoff</b> . <br><br>  The following image illustrates it best: <br><img src="https://habrastorage.org/web/799/849/86d/79984986d8954b89a6651f23bcbcc360.jpg"><br>  The graph shows that the optimal complexity of the model corresponds to the function <i>C = min (V + B2)</i> , and this value will not correspond to the minimum <b>Bias</b> value. <br><br>  The complexity of the model consists of two parts.  The first part, common to all, is the number of features used (or the dimension of the input data).  In our example, there are not many of them, so filtering is unlikely to increase the accuracy of the model, but we will demonstrate the principle itself.  In addition, there is always the possibility that some columns may be superfluous, and their removal will not worsen the model.  Since, with the same accuracy, a simpler solution should be chosen, even such a change would be useful. <br><br>  <a href="https://azure.microsoft.com/ru-ru/free/%3Fwt.mc_id%3DAID570629_QSG_BLOG_139069">Azure ML</a> has several feature filtering modules for filtering out the least useful ones.  We will look at <b>Filter Based Feature Selection</b> . <br><br><img src="https://habrastorage.org/web/64d/507/9b1/64d5079b16d94775aa1059ec7b9509c3.png"><br><br>  This module includes seven filtering methods: Pearson correlation, mutual information, Kendall correlation, Spearman correlation, chi-squared, Fisher score, count based.  Take the <b>Kendall correlation</b> because the data is not normally distributed and does not have a well-defined linear relationship.  We set the parameter for the number of desired attributes so that as a result one column is removed. <br><br>  Let's look at the results of assigning the similarity coefficients of the target and input columns. <br><br><img src="https://habrastorage.org/web/446/f4c/c49/446f4cc49b5c4798b495c15bebbe7267.png"><br><br>  The <b>ageLessThan19</b> column has a low level of correlation with the target; it can be neglected.  Let us verify this by training the <b>Random forest</b> model with the same settings that <a href="https://habrahabr.ru/company/microsoft/blog/331484/">were used in the example in the previous article</a> . <br><br><img src="https://habrastorage.org/web/1a5/844/76e/1a584476e898495cb9f83a82887d1b5f.png"><br><br>  The red curve corresponds to the old model.  Removal of the column led to a slight degradation of the model, but within the limits of statistical error.  Therefore, the deleted column really had no significant effect on the model and was not needed. <br><br>  The second part of the complexity of the model depends on the chosen algorithm.  In our case, this is a Random forest, for which the complexity is primarily determined by the maximum depth of the trees under construction.  Other parameters are also important, but to a lesser extent. <br><br>  Consider the Azure ML modules that will help with these tasks.  For starters, take <b>Tune Model Hyperparameters</b> . <br><br><img src="https://habrastorage.org/web/527/ac4/ee4/527ac4ee46cd4b3fba401433f830087f.png"><br><br>  Consider its settings: <br><br><ul><li>  <b>Specify parameter-sweeping mode</b> - set the search mode (in this case, random grid).  The search is performed within the values ‚Äã‚Äãspecified at the algorithm initialization stage. </li><li>  <b>Maximum number of runs on a random grid</b> - the number of tested options for combinations of parameters for training a model. </li><li>  <b>Metric for measuring performance for classification</b> ‚Äî select from a metric as a target value to optimize classification tasks. </li></ul><br>  The remaining parameters in our case have no meaning or do not require a separate description. <br><br>  For the module to work correctly in the algorithm initialization, one of the parameters should be changed, the description of which we omitted in the previous article due to its special purpose.  It's about <b>create trainer mode</b> .  It is necessary to select the <b>parameter range</b> .  In this mode, you can select several values ‚Äã‚Äãfor the numerical parameters of the algorithm.  Also for each of the numerical parameters you can set the mode <b>range</b> .  It is possible to select a range in which potential values ‚Äã‚Äãwill be selected.  This is the mode we need - <b>Tune Model Hyperparameters</b> uses these ranges to find the optimal values.  In our example, to save time, set the range only for the depth of the decision trees. <br><br><img src="https://habrastorage.org/web/5f6/24f/51b/5f624f51bd6441afabecc829832a3880.png"><br><br>  Another module that may be useful is <b>Partition and Sample</b> .  In <b>assign to folds mode,</b> it breaks data into a specified number of parts.  When submitting such input data to the parameter setting module, it begins to work in the cross-validation mode.  The remaining settings allow you to specify the number of parts into which the data will be divided, and the features of the partition (for example, an even distribution of values ‚Äã‚Äãover one of the columns). <br><br><img src="https://habrastorage.org/web/a38/db2/019/a38db2019c3d4ad5933f8d68c5355659.png"><br><br>  With minimal effort, this allowed us to slightly improve our results when evaluating for AUC.  With proper settings and a more thorough search for optimal parameters, the improvement in the result will be more substantial. <br><br><img src="https://habrastorage.org/web/32e/ae6/691/32eae6691f4e406a8d5fc2394814167e.png"><br><br>  Now consider another tool for setting up the output model.  Since in our case the situation of the binary classification is considered, the belonging to one of the classes is determined through the boundary value.  You can check its operation in the <b>Evaluate</b> module tab.  At the output of the classifier, we get not a strict class value, but confidence in the presence of a ‚Äúpositive‚Äù class, which can take values ‚Äã‚Äãfrom 0 to 1. In other words, by default, if the classifier gives a value from 0.5, then in our case the prediction about the presence of a peak will be positive. <br><br>  Not always 0.5 is the optimal limit.  In the case of equivalence of classes, F1 can be a good criterion, although in practice this is rare.  Suppose that FN is 2 times more expensive than FP.  Consider different boundaries and estimate the total cost for them. <br><br>  In the graph below, the total cost of FP errors is shown in blue, the color FN in orange, and the sum in green.  As you can see, the minimum total cost falls on threshold = 0.31 with a value equal to ‚âà40.4k.  For comparison, at the border equal to 0.5, the price is 15k more. <br><br><img src="https://habrastorage.org/web/a50/8cb/0bc/a508cb0bcc16416aa1690e8114f9c349.png"><br><br>  For clarity, we calculate the minimum cost for a model without a previously removed column. <br><br><img src="https://habrastorage.org/web/1b5/eb3/65b/1b5eb365b57c4f1dbe43cc4b0a133143.png"><br><br>  The illustration shows that the cost is greater.  The difference is small, but even such an example is enough to show that more signs do not always give the best model. <br><br><h2>  Search for statistical emissions </h2><br>  Emissions can have a critical impact on model learning outcomes.  If the method used is not robust, they can negatively affect the result. <br><br>  As an example, consider the following case. <br><br><img src="https://habrastorage.org/web/5e3/71c/626/5e371c62679c4fa3a02c27109f421f7f.png"><br><br>  Although most of the data is focused on the diagonal, a single point, being far enough away from the others, changes the slope of the function (green).  Such points are called high-leverage points.  Often they are associated with measurement or recording errors.  This is only one of the types of stat emissions and their effect on the model.  In our case, the chosen model is robust, so there will be no such influence on it.  But to remove the anomalous data in any case is worth it. <br><br>  To find these points, you can use the Clip Values ‚Äã‚Äãmodule.  It processes data that goes beyond the designated limits, and can either substitute a different value in it, or mark it as missing.  For the purity of the experiment we will conduct this operation only for training records. <br><br><img src="https://habrastorage.org/web/b48/ca0/a45/b48ca0a45cd24db181d0d011561d7f82.jpg"><br><br>  Through the module of cleaning the missing values, you can remove rows with missing data, getting an array filtered from anomalies. <br><br>  Check the accuracy on the new data set. <br><br><img src="https://habrastorage.org/web/06b/7bd/2de/06b7bd2de9dd4899895be9c88916140c.png"><br><br>  The model has become a little better in all 4 points.  It is worth recalling that the algorithm we are considering is robust.  In certain situations, the removal of statistical emissions will give an even greater increase in accuracy. <br><br><h2>  Use of committee (ensemble) classifiers </h2><br>  The committee combines several models into one for better results than each of them can provide.  Yes, the algorithm we use is itself a committee, since it consists in building many different decision trees and combining their results into one.  However, it is not necessary to stop there. <br><br>  Consider one of the simplest and, at the same time, popular and effective ways of combining - stacked generalization.  Its essence is in using the outputs of different algorithms as attributes for a model of a higher (in terms of hierarchy) level.  Like any other committee, it does not guarantee an improvement in the outcome.  However, the models obtained through it, as a rule, manifest themselves as more accurate.  For our example, let's take a series of algorithms for the binary classification presented in Azure ML Studio: Averaged Perceptron, Bayes Point Machine, Boosted Decision Tree, Random Forest, Decision Jungle and Logistic Regression.  At this stage, we will not go into their details - check the work of the committee. <br><br><img src="https://habrastorage.org/web/695/79f/662/69579f6626da43a8aa31f0eb20e10745.png"><br><br>  As a result, we obtain one more small improvement of the model for all metrics.  Now remember that the classes in our model are not equivalent, and we have accepted that FN is 2 times more expensive than FP.  To find the optimal point, check different <b>threshold</b> values. <br><br><img src="https://habrastorage.org/web/512/8ed/b07/5128edb073a74263a62d7cf920e13964.png"><br><br>  The minimum amount of the cost of errors is on the border, equal to 0.29, and reaches 40.2.  This is only 0.2 less than the figure obtained before the removal of anomalies and calculations through the committee.  Of course, much depends on what the real monetary equivalent of this difference will be.  But more often, with such a slight improvement, it makes sense to use the principle of Occam's razor and choose a slightly less accurate, but simpler architecture model that we had after adjusting the parameters with the Tune Model Hyperparameters module with a minimum error cost of 40.4. <br><br><h2>  Results </h2><br>  In the final part of the cycle of articles on machine learning, we examined: <br><br><ol><li>  Setting the complexity of the model and the choice of the optimal value of the threshold. </li><li>  Search and delete statistical emissions from training data. </li><li>  Building a committee of several algorithms. </li><li>  The choice of the final structure of the model. </li></ol><br>  In this series of articles, we presented a simplified version of the cost prediction system, which was implemented as part of a comprehensive solution for an insurance company.  On the demonstration model, we described most of the steps necessary to solve problems of this kind: building a prototype, analyzing and processing data, selecting and configuring algorithms, and other tasks. <br><br>  We also considered one of the most important aspects - the choice of the complexity of the model.  The final structure obtained gave the best results in terms of accuracy metrics, f1-score and others.  However, when estimating losses from false positive and false negative results, it gave very little profit.  In this regard, the less complex model described at the beginning of this article looks more attractive. <br><br>  These are not all machine learning opportunities in similar tasks, but we have consciously simplified the demonstration model for greater visibility and, in part, due to NDA.  The features of the model that are not included in the article are specific to the client‚Äôs business and are not well applicable to other projects, since most of the decisions based on machine learning require an individual approach.  The full version of the system is used in the real project of our customer, and we continue to improve it. <br><br><h4>  About the authors </h4><br>  The <a href="http://www.waveaccess.ru/">WaveAccess</a> team creates technically complex, high-load and fault-tolerant software for companies from different countries.  Commentary by Alexander Azarov, Head of Machine Learning at WaveAccess: <br><blockquote>  Machine learning allows you to automate areas where expert opinions currently dominate.  This makes it possible to reduce the influence of the human factor and increase the scalability of the business. </blockquote></div><p>Source: <a href="https://habr.com/ru/post/334556/">https://habr.com/ru/post/334556/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334546/index.html">About Reflect API available language</a></li>
<li><a href="../334548/index.html">The unrealized potential of the Internet of Things</a></li>
<li><a href="../334550/index.html">Company Development with Open Source</a></li>
<li><a href="../334552/index.html">A quarter of a million for the "beetle": Microsoft is beginning an active struggle with bugs</a></li>
<li><a href="../334554/index.html">Characteristics of the PVS-Studio analyzer on the example of EFL Core Libraries, 10-15% of false positives</a></li>
<li><a href="../334558/index.html">Differentiation of access rights in PostgreSQL</a></li>
<li><a href="../334560/index.html">Let's play in Firebase</a></li>
<li><a href="../334562/index.html">hh and in production: how to release a new feature</a></li>
<li><a href="../334564/index.html">Defice ask.mcdonalds.ru</a></li>
<li><a href="../334566/index.html">7 ways to use blue in your company colors</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>