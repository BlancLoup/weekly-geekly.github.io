<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Two-factor authentication for SSH</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="SSH "secure shell" - a network protocol for establishing a secure connection between hosts, standard on port 22 (which is better to change). SSH clien...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Two-factor authentication for SSH</h1><div class="post__text post__text-html js-mediator-article">  SSH "secure shell" - a network protocol for establishing a secure connection between hosts, standard on port 22 (which is better to change).  SSH clients and SSH servers are available for most operating systems.  Virtually any other network protocol works inside SSH, that is, you can remotely work on another computer, transfer an audio stream or video over an encrypted channel, etc.  In addition, <a href="https://habr.com/ru/post/435546/">through a SOCKS proxy on a remote host,</a> you can connect to other hosts on behalf of this remote host. <br><br>  Authentication occurs with a password, but developers and system administrators traditionally use SSH keys.  The problem is that the secret key can be stolen.  Adding a passphrase theoretically protects against theft of the secret key, but in practice they <a href="https://github.com/matrix-org/matrix.org/issues/357">can still be used without confirmation</a> for forwarding and caching keys.  Two-factor authentication solves this problem. <br><a name="habracut"></a><br><h1>  How to implement two-factor authentication </h1><br>  Honeycomb developers recently published <a href="https://gist.github.com/lizthegrey/9c21673f33186a9cc775464afbdce820">detailed instructions</a> on how to implement the appropriate infrastructure on the client and server. <br><br>  The instruction assumes that you have a certain basic host opened in the Internet (bastion).  You want to connect to this host from laptops or computers via the Internet, and get access to all other devices that are behind it.  2FA ensures that an attacker cannot do the same, even if he gains access to your laptop, for example, by installing malware. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  The first option is OTP </h4><br>  OTP - one-time digital passwords, which in this case will be used for SSH authentication along with the key.  Developers write that this is not the ideal option, because an attacker can raise a fake bastion, intercept your OTP and use it.  But this is better than nothing. <br><br>  In this case, the following lines are written to the Chef config on the server side: <br><br><ul><li><code>metadata.rb</code> </li> <li>  <code>attributes/default.rb</code> (from <code>attributes.rb</code> ) </li><li> <code>files/sshd</code> </li> <li>  <code>recipes/default.rb</code> (copy from <code>recipe.rb</code> ) </li><li> <code>templates/default/users.oath.erb</code> </li> </ul><br>  On the client side any OTP application is put: Google Authenticator, Authy, Duo, Lastpass, <code>brew install oath-toolkit</code> or <code>apt install oathtool openssl</code> , then a random string base16 is generated (key).  It is converted to Base32 format, which is used by mobile authenticators, and imported directly into the application. <br><br>  As a result, you can connect to the bastion and make sure that now he requires not only a passphrase, but also an OTP code for authentication: <br><br><pre> <code class="plaintext hljs">‚ûú ssh -A bastion Enter passphrase for key '[snip]': One-time password (OATH) for '[user]': Welcome to Ubuntu 18.04.1 LTS...</code> </pre> <br><h4>  The second option is hardware authentication. </h4><br>  In this case, the user is not required to enter the OTP code each time, since the second factor is the hardware device or biometrics. <br><br>  Here, the Chef configuration is a bit more complicated, and the client configuration depends on the OS.  But after performing all the actions, clients on MacOS can confirm authentication in SSH using a passphrase and finger on the sensor (the second factor). <br><br>  The owners of iOS and Android confirm the entrance <a href="https://krypt.co/docs/start/upload-your-ssh-publickey.html">by pressing a single button on the smartphone</a> .  This is a special technology from Krypt.co that is even safer than OTP. <br><br>  On Linux / ChromeOS, there is the option of working with YubiKey USB tokens.  Of course, an attacker can kidnap your token, but he still does not know the password phrase. </div><p>Source: <a href="https://habr.com/ru/post/448970/">https://habr.com/ru/post/448970/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448958/index.html">How Amazon selects its seemingly random offers of the day. And why are sellers chasing them like that?</a></li>
<li><a href="../448960/index.html">Unlimited XR technologies in the era of distributed computing</a></li>
<li><a href="../448964/index.html">Toaster gives users more rights.</a></li>
<li><a href="../448966/index.html">Android application in memory. Optimization Report for Yandex.Luncher</a></li>
<li><a href="../448968/index.html">Asynchronous PHP. What for?</a></li>
<li><a href="../448976/index.html">Spring activities on game dev in VSBI</a></li>
<li><a href="../448980/index.html">Our first lunch together: why and how we spend a test day</a></li>
<li><a href="../448982/index.html">Headless CMS. Why i write my</a></li>
<li><a href="../448986/index.html">Reverse engineering in production using 3D scanning</a></li>
<li><a href="../448988/index.html">Kingston SSDs have become more capacious, retaining almost the same price - we meet A400-R series</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>